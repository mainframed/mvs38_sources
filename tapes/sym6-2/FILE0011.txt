./  ADD  SSI=40531017,NAME=IGCT005C
         TITLE 'IGCT005C - EXCLUSIVE CONTROL TASK RECOVERY ROUTINE     *00001000
                       '                                                00002000
IGCT005C CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(24)                                             0001 00007000
         DC    C'IGCT005C YM7519 02/11/74'                         0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @09,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@09                                         0001 00013000
         L     @00,@SIZDATD                                        0001 00014000
         GETMAIN R,LV=(0)                                               00015000
         LR    @11,@01                                             0001 00016000
         USING @DATD,@11                                           0001 00017000
         ST    @13,@SA00001+4                                      0001 00018000
         LM    @00,@01,20(@13)                                     0001 00019000
         ST    @11,8(,@13)                                         0001 00020000
         LR    @13,@11                                             0001 00021000
RBPRFXLN EQU 64                                                         00022000
RBPRFLNA EQU 32                                                         00023000
PRBLEN   EQU 136                                                        00024000
SIRBLEN  EQU 200                                                        00025000
TIRBLEN  EQU 136                                                        00026000
IRBLEN   EQU 128                                                        00027000
SVRBLEN  EQU 200                                                        00028000
SPDFID   EQU   X'FE'                                                    00029000
         ENTRY BACRETRY                                                 00030000
*   SDWAPTR=GPR01P;                 /* REG 1 ON ENTRY HAS SDWA       */ 00031000
         LR    SDWAPTR,GPR01P                                      0158 00032000
*   RFY                                                            0159 00033000
*     GPR01P UNRSTD;                                               0159 00034000
*   RBSECPTR=SDWAPARM;              /* SDWA HAS SVRB ADDR            */ 00035000
         L     RBSECPTR,SDWAPARM(,SDWAPTR)                         0160 00036000
*   WKALOCK='0'B;                   /* ENSURE DEBCHECK LOCK SW 0     */ 00037000
         NI    WKALOCK(RBSECPTR),B'10111111'                       0161 00038000
*   IF RBGRS1¬<0 THEN               /* IF RELEX,DCB ADDR PASSED      */ 00039000
         L     @12,RBGRS1(,RBSECPTR)                               0162 00040000
         LTR   @12,@12                                             0162 00041000
         BM    @RF00162                                            0162 00042000
*     DCBPTR=RBGRS1;                /* GET DCB FROM SVRB SAVE        */ 00043000
*                                                                  0163 00044000
         LR    DCBPTR,@12                                          0163 00045000
*/********************************************************************/ 00046000
*/* THE FOLLOWING ROUTINE ANALYZES THE CAUSE AND STAGE OF THE ABEND  */ 00047000
*/* BY DETERMINING IF THE ABEND WAS PERCOLATED, A DUMP WAS TAKEN,    */ 00048000
*/* IF IT WAS A PROGRAM CHECK, IF THERE WAS PREVIOUS RECOVERY, IF    */ 00049000
*/* THE CURRENT RB FAILED OR A PREVIOUS FRR FAILED. BASED ON THIS    */ 00050000
*/* ANALYSIS THE CONTROL IS TRANSFERRED TO A ROUTINE TO: 1) CHECK    */ 00051000
*/* FOR USER INPUT ERRORS,  2) CLEAN UP RESOURCES AND CONTINUE TO    */ 00052000
*/* TERMINATE, OR  3) TAKE AN SVC DUMP BEFORE CONTINUING TO          */ 00053000
*/* TERMINATE.                                                       */ 00054000
*/*          INPUT TO THIS ROUTINE IS AS FOLLOWS:                    */ 00055000
*/*                    REG  5 - SDWA ADDRESS                         */ 00056000
*/*                    REG  6 - DCB ADDRESS (IF RELEX)               */ 00057000
*/*                    REG  8 - SVRB ADDRESS                         */ 00058000
*/*                    REG 13 - RTM SAVEAREA ADDRESS                 */ 00059000
*/********************************************************************/ 00060000
*                                                                  0164 00061000
*ANALYZE:                                                          0164 00062000
*   ;                               /* ANALYZE THE ERROR             */ 00063000
@RF00162 DS    0H                                                  0164 00064000
ANALYZE  DS    0H                                                  0165 00065000
*   DO;                             /* ?IGGSTART USER(USERRTN)     0165 00066000
*                                      SDUMP(DUMPRTN) CLEAN(CLEANRTN)*/ 00067000
*                                                                  0165 00068000
*/*  MACCOMP Y-2 SC1D0/SJ0204                                        */ 00069000
*/*  MACSTAT Y-2 74050/YM7586                                        */ 00070000
*/********************************************************************  00071000
*                                                                    */ 00072000
*/* THIS ROUTINE ANALYSES FLAGS IN THE SDWA TO DETERMINE             */ 00073000
*/* WHAT TYPE OF FUNCTION TO PERFORM                                 */ 00074000
*/* THE FLAG COMBINATIONS TESTED AND THE ACTIONS TAKEN ARE SUMMARIZED*/ 00075000
*/* IN THE FOLLOWING TABLE:                                          */ 00076000
*/*                                                                  */ 00077000
*/*   PREVIOUS  || CAUSE OF ERROR ENTRY                              */ 00078000
*/*  PROCESSING || MCHK/PGIO/TEXC  OTHER                             */ 00079000
*/*  ___________||________________________                           */ 00080000
*/*       *EAS  ||        C          C                               */ 00081000
*/*       *CLUP ||        C          C                               */ 00082000
*/*       *STAF ||        S          S                               */ 00083000
*/*       *PERC ||        C          U                               */ 00084000
*/*       *NRBE ||        C          U                               */ 00085000
*/*        NONE ||        C          U                               */ 00086000
*/*                                                                  */ 00087000
*/*       * THESE BITS ARE NOT ALL MUTUALLY EXCLUSIVE. THEY ARE      */ 00088000
*/*         TESTED IN THE ORDER LISTED.                              */ 00089000
*/*                                                                  */ 00090000
*/*       FUNCTIONS TO BE PERFORMED:                                 */ 00091000
*/*                                                                  */ 00092000
*/* C (CLEANRTN)--CLEAN UP RESOURCES AND PERCOLATE ERROR             */ 00093000
*/*                                                                  */ 00094000
*/* S (DUMPRTN)--PREVIOUS RECOVERY ROUTINE FAILED.                   */ 00095000
*/* TAKE A DUMP FOR IT, THEN TREAT AS C                              */ 00096000
*/*                                                                  */ 00097000
*/* U (USERRTN)--VALIDATE USER INPUT. IF IT IS IN ERROR,             */ 00098000
*/* TAKE PROBLEM DETERMINATION ACTIONS AND THEN CLEAN UP.            */ 00099000
*/* IF IT IS VALID, ASSUME A SYSTEM ERROR IN COVERED FUNCTION.       */ 00100000
*/* TAKE A DUMP, THEN TREAT AS C                                     */ 00101000
*/********************************************************************  00102000
*                                                                    */ 00103000
*                                                                  0166 00104000
*     IF SDWAEAS='1'B               /* LOWER ESTAE ALREADY DUMPED    */ 00105000
*         |SDWACLUP='1'B THEN       /* OR RTM SAYS CLEANUP           */ 00106000
         TM    SDWAEAS(SDWAPTR),B'00001000'                        0166 00107000
         BO    @RT00166                                            0166 00108000
         TM    SDWACLUP(SDWAPTR),B'10000000'                       0166 00109000
         BO    @RT00166                                            0166 00110000
*       GOTO CLEANRTN;              /* GO CLEAN UP & GET OUT         */ 00111000
*     IF SDWASTAF='1'B THEN         /* A LOWER LEVEL ESTAE/FRR       */ 00112000
         TM    SDWASTAF(SDWAPTR),B'10000000'                       0168 00113000
         BO    @RT00168                                            0168 00114000
*       GOTO DUMPRTN;               /* WAS EXECUTING AND FAILED      */ 00115000
*                                   /* TAKE A DUMP FOR IT            */ 00116000
*     IF SDWATEXC='1'B              /* SOME NON-PROGRAM TYPE         */ 00117000
*         |SDWAPGIO='1'B            /* ERROR HAS OCCURRED            */ 00118000
*         |SDWAMCHK='1'B THEN       /* GO CLEAN UP & GET OUT         */ 00119000
         TM    SDWATEXC(SDWAPTR),B'10000011'                       0170 00120000
         BNZ   @RT00170                                            0170 00121000
*       GOTO CLEANRTN;                                             0171 00122000
*     GOTO USERRTN;                 /* CHECK USER INPUT              */ 00123000
*                                                                  0172 00124000
         B     USERRTN                                             0172 00125000
*/********************************************************************  00126000
*                                                                    */ 00127000
*                                                                  0173 00128000
*   END;                            /* ANALYZE ABEND CONDITION       */ 00129000
*                                                                  0173 00130000
*/********************************************************************/ 00131000
*/* THE FOLLOWING ROUTINE VALIDITY CHECKS ALL USER INPUT TO SVC 53   */ 00132000
*/* TO DETERMINE IF THIS CAUSED THE ABEND IN EXCLUSIVE CONTROL.THESE */ 00133000
*/* CONTROL BLOCKS/DATA AREAS WILL BE VALIDATED WHERE APPLICABLE:    */ 00134000
*/* IOB, DCB, BLKREF FIELD, DECB, DEB, AND NEXT WAITING IOB.         */ 00135000
*/*          INPUT TO THIS ROUTINE IS THE SVRB ADDRESS WHICH WAS     */ 00136000
*/* PASSED IN THE SDWA FROM IGC0005C. THE SVRB WILL CONTAIN THE      */ 00137000
*/* INPUT PARAMETERS TO RELEX:  REG 1 - DCB ADDRESS                  */ 00138000
*/*                             REG 0 - BLKREF ADDRESS               */ 00139000
*/* ENTRY TO SVC 53 FOR OTHER THAN A RELEX REQUEST WILL HAVE AS INPUT*/ 00140000
*/*                             REG 1 - IOB ADDRESS,(COMPLEMENTED)   */ 00141000
*/* EACH CONTROL BLOCK IS VALIDATED BY THE SYSTEM VALIDITY CHECK     */ 00142000
*/* ROUTINE.  IF ONE IS FOUND TO BE IN ERROR, CERTAIN CONTROL BLOCKS */ 00143000
*/* ALREADY VALIDATED ARE TRACED, A WTP IS ISSUED AND SETRP TO GIVE  */ 00144000
*/* CONTROL TO THE RETRY ROUTINE.  IF ALL BLOCKS ARE VALID, CONTROL  */ 00145000
*/* IS GIVEN TO THE SYSERRTN ROUTINE. THE REGISTER LABELED BLKCTR    */ 00146000
*/* WILL BE USED TO IDENTIFY THE PARTICULAR CONTROL BLOCK BEING      */ 00147000
*/* VALIDATED.  IT WILL BE INCREMENTED AFTER SUCCESSFUL VALIDATION   */ 00148000
*/* OF EACH BLOCK.  THIS REGISTER IS USED THROUGHOUT THE ESTAE       */ 00149000
*/* HEREAFTER AS AN INDEX TO IDENTIFY/SET THE RETURN CODE ASSOCIATED */ 00150000
*/* WITH THE BLOCK FOUND TO BE IN ERROR.                             */ 00151000
*/*      BLKCTR(R7) VALUES SHOULD BE INTERPRETED AS FOLLOWS:         */ 00152000
*/*            1 = IOB ERROR (NOT RELEX)                             */ 00153000
*/*            2 = DCB ERROR                                         */ 00154000
*/*            3 = BLKREF ERROR (RELEX)                              */ 00155000
*/*            4 = DECB ERROR (NOT RELEX)                            */ 00156000
*/*            5 = DEB ERROR                                         */ 00157000
*/*            6 = NEXT IOB ERROR                                    */ 00158000
*/*            7 = SYSTEM ERROR                                      */ 00159000
*/*           10 = ERROR IN PREVIOUS RECOVERY RTN OR ANOTHER RB LEVEL*/ 00160000
*/*                (BRANCHED TO DUMPRTN OR CLEANRTN)                 */ 00161000
*/********************************************************************/ 00162000
*                                                                  0174 00163000
*USERRTN:                                                          0174 00164000
*   ;                               /* VALIDATE THE CONTROL BLKS     */ 00165000
*                                                                  0174 00166000
USERRTN  DS    0H                                                  0175 00167000
*/*   GET THE LOCAL LOCK BEFORE VALIDATING THE CONTROL BLOCKS        */ 00168000
*                                                                  0175 00169000
*   RFY                                                            0175 00170000
*     GPR00P RSTD;                  /* RESTRICT SAVEAREA SAVE REG    */ 00171000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVEAREA AROUND      */ 00172000
         LR    GPR00P,SAVEPTR                                      0176 00173000
*SETLOCK:                                                          0177 00174000
*   ;                               /* GET LOCAL LOCK                */ 00175000
SETLOCK  DS    0H                                                  0178 00176000
*   DO;                             /* SETLOCK (OBTAIN) MODE(UNCOND)    00177000
*                                      TYPE(LOCAL) RELATED(CNTRLBLK,I   00178000
*                                      GCT005C,(FREELOCK,FREELCKX,FRE   00179000
*                                      ELCK1,FREELCK2,FREELCK3))     */ 00180000
*     RFY                                                          0179 00181000
*      (GPR11P,                                                    0179 00182000
*       GPR12P,                                                    0179 00183000
*       GPR13P,                                                    0179 00184000
*       GPR14P)RSTD;                                               0179 00185000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0180 00186000
*                                      TABLE.                        */ 00187000
         L     GPR13P,PSALITA                                      0180 00188000
*     GEN(LM GPR11P,GPR13P,576(GPR13P));/* LOAD LOCKWORD, CLHT AND 0181 00189000
*                                      ENTRY ADRS.                   */ 00190000
         LM GPR11P,GPR13P,576(GPR13P)                                   00191000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00192000
         BALR GPR14P,GPR13P                                             00193000
*     RFY                                                          0183 00194000
*      (GPR11P,                                                    0183 00195000
*       GPR12P,                                                    0183 00196000
*       GPR13P,                                                    0183 00197000
*       GPR14P)UNRSTD;                                             0183 00198000
*   END;                            /* SETLOCK (OBTAIN) MODE(UNCOND)    00199000
*                                      TYPE(LOCAL) RELATED(CNTRLBLK,I   00200000
*                                      GCT005C,(FREELOCK,FREELCKX,FRE   00201000
*                                      ELCK1,FREELCK2,FREELCK3))     */ 00202000
*   SAVEPTR=GPR00P;                 /* RESTORE RTM SAVEAREA PTR      */ 00203000
         LR    SAVEPTR,GPR00P                                      0185 00204000
*   RFY                                                            0186 00205000
*     GPR00P UNRSTD;                                               0186 00206000
*                                                                  0186 00207000
*/********************************************************************/ 00208000
*/*       SET UP INPUT REGISTERS TO SYSTEM VALIDITY ROUTINE          */ 00209000
*/*                REGISTER 1 - START OF AREA TO VERIFY              */ 00210000
*/*                REGISTER 2 - END OF AREA TO VERIFY                */ 00211000
*/*                REGISTER 4 - ADDRESS OF KEY - 28                  */ 00212000
*/*                REGISTER 14- RETURN ADDRESS                       */ 00213000
*/*                REGISTER 15- ADDRESS OF VALIDITY ROUTINE          */ 00214000
*/* BLOCKS ARE VERIFIED FOR CORE OWNERSHIP AND ALIGNMENT, (WITH THE  */ 00215000
*/* EXCEPTION OF THE DCB AND BLKREF FIELD, WHICH HAVE NO BOUNDARY    */ 00216000
*/* REQUIREMENTS).                                                   */ 00217000
*/********************************************************************/ 00218000
*                                                                  0187 00219000
*   RFY                                                            0187 00220000
*    (GPR01P,                                                      0187 00221000
*     GPR02P,                                                      0187 00222000
*     GPR04P,                                                      0187 00223000
*     GPR14P,                                                      0187 00224000
*     GPR15P)RSTD;                  /* RESTRICT REGS - VALID CHK     */ 00225000
*   GPR04P=(ADDR(RBLINK->RBOPSW(2)))-KEYOFFS;/* ADDR OF KEY-28       */ 00226000
         L     GPR04P,RBLINK(,RBSECPTR)                            0188 00227000
         LA    GPR04P,RBOPSW+1(,GPR04P)                            0188 00228000
         SH    GPR04P,@CH02467                                     0188 00229000
*   BLKCTR=1;                       /* SET CTR TO FIRST BLOCK        */ 00230000
         LA    BLKCTR,1                                            0189 00231000
*IOBCHK1:                                                          0190 00232000
*   ;                               /* VALIDATE THE PASSED IOB       */ 00233000
IOBCHK1  DS    0H                                                  0191 00234000
*   RFY                                                            0191 00235000
*     WRKREG RSTD;                  /* RESTRICT WORKREG        YM7519*/ 00236000
*   IF RBGRS1<0 THEN                /* IF NOT RELEX REQUEST MUST     */ 00237000
         L     @12,RBGRS1(,RBSECPTR)                               0192 00238000
         LTR   @12,@12                                             0192 00239000
         BNM   @RF00192                                            0192 00240000
*     DO;                           /* VALIDATE PASSED IOB           */ 00241000
*       RFY                                                        0194 00242000
*         IOBSTPTR RSTD;                                           0194 00243000
*       IOBSTPTR=ABS(RBGRS1);       /* PUT IOB TO CHK IN BASE REG    */ 00244000
         LR    IOBSTPTR,@12                                        0195 00245000
         LPR   IOBSTPTR,IOBSTPTR                                   0195 00246000
*       RFY                                                        0196 00247000
*         IOBSTDRD BASED(IOBSTPTR); /* BASE IOB ON COMPLEMENT OF REG    00248000
*                                      1 PASSED TO SVC 53            */ 00249000
*       GPR01P=ADDR(IOBDQADA);      /* VALIDATE PREFIX OF IOB 1ST    */ 00250000
         LR    GPR01P,IOBSTPTR                                     0197 00251000
         AL    GPR01P,@CF03514                                     0197 00252000
*       GPR02P=GPR01P+VSPREFLG-1;   /* 8 BYTE PREFIX TO IOB IF     0198 00253000
*                                      VARIABLE SPANNED              */ 00254000
         LR    GPR02P,GPR01P                                       0198 00255000
         SH    GPR02P,@CH03494                                     0198 00256000
*       CALL CVT0VL01;              /* VALIDATE IOB PREFIX+ALIGN     */ 00257000
         L     @12,CVTPTR                                          0199 00258000
         L     @15,CVT0VL01(,@12)                                  0199 00259000
         BALR  @14,@15                                             0199 00260000
*       WRKREG=GPR15P;              /* SAVE RETURN CODE FROM CHCK    */ 00261000
         LR    WRKREG,GPR15P                                       0200 00262000
*       GPR01P=ADDR(IOBSTDRD);      /* BEGINNING OF IOB PROPER       */ 00263000
         LR    GPR01P,IOBSTPTR                                     0201 00264000
*       GPR02P=ADDR(IOBDPLAD)-1;    /* END ADDR THROUGH IOB SIZE     */ 00265000
         LA    GPR02P,IOBDPLAD(,IOBSTPTR)                          0202 00266000
         BCTR  GPR02P,0                                            0202 00267000
*       CALL CVT0VL01;              /* VALIDATE 1ST PART OF IOB      */ 00268000
         L     @12,CVTPTR                                          0203 00269000
         L     @15,CVT0VL01(,@12)                                  0203 00270000
         BALR  @14,@15                                             0203 00271000
*       BC(7,ABEND);                /* IF ERROR,GO TO ABEND RTN      */ 00272000
         BC    7,ABEND                                             0204 00273000
*                                   /* VALIDATE 2ND HALF OF IOB      */ 00274000
*       GPR02P=ADDR(IOBSTDRD)+IOBDIOBS-1;/* END ADDR OF IOB          */ 00275000
         LR    GPR02P,IOBSTPTR                                     0205 00276000
         AH    GPR02P,IOBDIOBS(,IOBSTPTR)                          0205 00277000
         BCTR  GPR02P,0                                            0205 00278000
*       CALL CVT0VL01;              /* VALIDATE 2ND HALF OF IOB      */ 00279000
         L     @12,CVTPTR                                          0206 00280000
         L     @15,CVT0VL01(,@12)                                  0206 00281000
         BALR  @14,@15                                             0206 00282000
*       BC(7,ABEND);                /* IF ERROR, GO TO ABEND RTN     */ 00283000
         BC    7,ABEND                                             0207 00284000
*       DCBPTR=IOBDCBPT;            /* PICK UP DCB PTR               */ 00285000
         L     DCBPTR,IOBDCBPT(,IOBSTPTR)                          0208 00286000
*     END;                                                         0209 00287000
*   ELSE                            /* IF RELEX ZERO REG       YM7519*/ 00288000
*     WRKREG=0;                     /* TO GET BY NEXT TEST     YM7519*/ 00289000
         B     @RC00192                                            0210 00290000
@RF00192 SR    WRKREG,WRKREG                                       0210 00291000
*   BLKCTR=BLKCTR+1;                /* UP BLKCTR TO DCB(=2)          */ 00292000
@RC00192 AH    BLKCTR,@CH00102                                     0211 00293000
*DCBCHK:                                                           0212 00294000
*   ;                               /* VALIDITY CHECK THE DCB        */ 00295000
DCBCHK   DS    0H                                                  0213 00296000
*   GPR01P=DCBPTR+NULLPREF;         /* DCB ADDR+NULL PREFIX          */ 00297000
         LA    GPR01P,16                                           0213 00298000
         AR    GPR01P,DCBPTR                                       0213 00299000
*   GPR02P=GPR01P+DCBLEN-NULLPREF-1;/* ENDING ADDR OF DCB            */ 00300000
         LR    GPR02P,GPR01P                                       0214 00301000
         SH    GPR02P,@CH03496                                     0214 00302000
*   CALL CVT0VL00;                  /* CALL SYS VAL CHCK,NO ALIGN    */ 00303000
         L     @12,CVTPTR                                          0215 00304000
         L     @15,CVT0VL00(,@12)                                  0215 00305000
         BALR  @14,@15                                             0215 00306000
*   BC(7,ABEND);                    /* IF ERROR, GO TO ABEND RTN     */ 00307000
         BC    7,ABEND                                             0216 00308000
*   IF DCBBFTKR='1'B&WRKREG¬=0 THEN /* IF VS RECORDS AND PREFIX      */ 00309000
         LA    @12,DCBIOBAD+16(,DCBPTR)                            0217 00310000
         TM    DCBBFTKR(@12),B'00100000'                           0217 00311000
         BNO   @RF00217                                            0217 00312000
         LTR   WRKREG,WRKREG                                       0217 00313000
         BZ    @RF00217                                            0217 00314000
*     DO;                           /* RETURN COD FROM VALIDATION    */ 00315000
*       BLKCTR=IOBERR;              /* NOT 0, THEN IOB ERROR         */ 00316000
         LA    BLKCTR,1                                            0219 00317000
*       GOTO ABEND;                 /* GO TO ABEND ROUTINE           */ 00318000
         B     ABEND                                               0220 00319000
*       RFY                                                        0221 00320000
*         WRKREG UNRSTD;                                           0221 00321000
*     END;                                                         0222 00322000
*   ELSE                            /* CHECK TO SEE IF DATA SET      */ 00323000
*     IF DCBOFOPN='0'B THEN         /* IS OPEN, IF NOT STILL         */ 00324000
@RF00217 TM    DCBOFOPN+40(DCBPTR),B'00010000'                     0223 00325000
         BZ    @RT00223                                            0223 00326000
*       GOTO ABEND;                 /* IS A DCB ERROR, GO ABEND      */ 00327000
*   BLKCTR=BLKCTR+1;                /* UP BLKID TO BLKREF(=3)        */ 00328000
         AH    BLKCTR,@CH00102                                     0225 00329000
*BLKRFCHK:                                                         0226 00330000
*   ;                               /* VALIDITY CHECK BLKREF         */ 00331000
BLKRFCHK DS    0H                                                  0227 00332000
*   IF RBGRS1¬<0 THEN               /* IF NOT NEG,THERE IS BLKREF    */ 00333000
         ICM   @12,15,RBGRS1(RBSECPTR)                             0227 00334000
         BM    @RF00227                                            0227 00335000
*     DO;                           /* WHICH IS ONLY FOR RELEX       */ 00336000
*       GPR01P=RBGRS0;              /* IF RELEX,BLKREF IN R0         */ 00337000
         L     GPR01P,RBGRS0(,RBSECPTR)                            0229 00338000
*       IF DCBOPTA='1'B|DCBOPTF='0'B THEN/* IF ACTUAL ADDR OR NO     */ 00339000
         TM    DCBOPTA+52(DCBPTR),B'00001000'                      0230 00340000
         BNZ   @RT00230                                            0230 00341000
         TM    DCBOPTF+52(DCBPTR),B'00010000'                      0230 00342000
         BO    @RF00230                                            0230 00343000
@RT00230 DS    0H                                                  0231 00344000
*         GPR02P=GPR01P+MBBCCHHR-1; /* FEEDBACK, LENGTH IS 8         */ 00345000
         LR    GPR02P,GPR01P                                       0231 00346000
         SH    GPR02P,@CH03494                                     0231 00347000
*       ELSE                        /* ELSE, TTR/BLKID IS 3 BYTES    */ 00348000
*         GPR02P=GPR01P+TTRID-1;    /* PUT ENDING ADDR IN REG 2      */ 00349000
         B     @RC00230                                            0232 00350000
@RF00230 LR    GPR02P,GPR01P                                       0232 00351000
         SH    GPR02P,@CH03497                                     0232 00352000
*       CALL CVT0VL00;              /* VALIDITY CHK BLKREF FIELD     */ 00353000
@RC00230 L     @12,CVTPTR                                          0233 00354000
         L     @15,CVT0VL00(,@12)                                  0233 00355000
         BALR  @14,@15                                             0233 00356000
*       BC(7,ABEND);                /* IF ERROR GO TO ABEND RTN      */ 00357000
         BC    7,ABEND                                             0234 00358000
*     END;                                                         0235 00359000
*   BLKCTR=BLKCTR+1;                /* UP BLKCTR TO DECB ID(=4)      */ 00360000
@RF00227 AH    BLKCTR,@CH00102                                     0236 00361000
*DECBCHK:                                                          0237 00362000
*   ;                               /* VALIDITY CHK THE DECB         */ 00363000
DECBCHK  DS    0H                                                  0238 00364000
*   IF RBGRS1<0 THEN                /* IF NOT RELEX REQUEST,         */ 00365000
         ICM   @12,15,RBGRS1(RBSECPTR)                             0238 00366000
         BNM   @RF00238                                            0238 00367000
*     DO;                           /* IOB AND DECB PASSED TO SVC    */ 00368000
*       GPR01P=IOBECBPT;            /* DECB ADDRESS IS IN IOB        */ 00369000
         L     GPR01P,IOBECBPT(,IOBSTPTR)                          0240 00370000
*       RFY                                                        0241 00371000
*         IOBSTPTR UNRSTD;          /* RELEASE THE IOB BASE          */ 00372000
*       GPR02P=GPR01P+DECBLEN-1;    /* ENDING ADDR OF DECB           */ 00373000
         LR    GPR02P,GPR01P                                       0242 00374000
         SH    GPR02P,@CH03498                                     0242 00375000
*       CALL CVT0VL01;              /* GO TO VALIDATE DECB           */ 00376000
         L     @12,CVTPTR                                          0243 00377000
         L     @15,CVT0VL01(,@12)                                  0243 00378000
         BALR  @14,@15                                             0243 00379000
*       BC(7,ABEND);                /* IF ERROR, GO TO ABEND RTN     */ 00380000
         BC    7,ABEND                                             0244 00381000
*     END;                                                         0245 00382000
*   BLKCTR=BLKCTR+1;                /* UP BLKCTR TO DEB ID(=5)       */ 00383000
@RF00238 AH    BLKCTR,@CH00102                                     0246 00384000
*DEBCHK:                                                           0247 00385000
*   ;                               /* VALIDITY CHECK THE DEB        */ 00386000
DEBCHK   DS    0H                                                  0248 00387000
*   WKALOCK='1'B;                   /* SW-DEBCHECK WONT FREE LOCK    */ 00388000
         OI    WKALOCK(RBSECPTR),B'01000000'                       0248 00389000
*   CALL DEBCHECK;                  /* GO TO DEBCHECK ROUTINE        */ 00390000
         BAL   @14,DEBCHECK                                        0249 00391000
*   IF WKADEBXC¬=0 THEN             /* CHECK DEBCHK RET COD FOR 0    */ 00392000
         CLI   WKADEBXC(RBSECPTR),0                                0250 00393000
         BNE   @RT00250                                            0250 00394000
*     GOTO ABEND;                   /* DEB ERROR, THEN ABEND         */ 00395000
*   ELSE                            /* ELSE UP BLKCTR TO NEXT IOB    */ 00396000
*     BLKCTR=BLKCTR+1;              /* POSITION TO NEXT BLK          */ 00397000
         AH    BLKCTR,@CH00102                                     0252 00398000
*IOBCHK2:                                                          0253 00399000
*   ;                               /* VALIDATE THE NEXT IOB         */ 00400000
IOBCHK2  DS    0H                                                  0254 00401000
*   IF WKAIOBQX¬=0 THEN             /* IF THERE IS NEXT IOB SAVED    */ 00402000
         L     @12,WKAIOBQX(,RBSECPTR)                             0254 00403000
         LTR   @12,@12                                             0254 00404000
         BZ    @RF00254                                            0254 00405000
*     DO;                           /* BY SVC, MUST VALIDATE IT      */ 00406000
*       RFY                                                        0256 00407000
*         IOBSTDRD BASED(WKAIOBQX); /* BASE IOB ON ADDR SAVED        */ 00408000
*       IF DCBBFTKR='1'B THEN       /* IF VARIABLE SPANNED RECORD    */ 00409000
         LA    @10,16                                              0257 00410000
         LR    @03,DCBPTR                                          0257 00411000
         AR    @03,@10                                             0257 00412000
         LA    @03,DCBIOBAD(,@03)                                  0257 00413000
         TM    DCBBFTKR(@03),B'00100000'                           0257 00414000
         BNO   @RF00257                                            0257 00415000
*         GPR01P=ADDR(IOBDQADA);    /* BEG IOB ADDR IS PREFIX        */ 00416000
         SR    @12,@10                                             0258 00417000
         LA    GPR01P,IOBDQADA(,@12)                               0258 00418000
*       ELSE                        /* OTHERWISE IOB BEGINS AT       */ 00419000
*         GPR01P=ADDR(IOBSTDRD);    /* STANDARD SECTION              */ 00420000
         B     @RC00257                                            0259 00421000
@RF00257 L     GPR01P,WKAIOBQX(,RBSECPTR)                          0259 00422000
*       GPR02P=ADDR(IOBDPLAD)-1;    /* END ADDR THROUGH IOB SIZE     */ 00423000
@RC00257 L     GPR02P,WKAIOBQX(,RBSECPTR)                          0260 00424000
         LA    GPR02P,IOBDPLAD(,GPR02P)                            0260 00425000
         BCTR  GPR02P,0                                            0260 00426000
*       CALL CVT0VL01;              /* VALIDATE 1ST PART OF IOB      */ 00427000
         L     @12,CVTPTR                                          0261 00428000
         L     @15,CVT0VL01(,@12)                                  0261 00429000
         BALR  @14,@15                                             0261 00430000
*       BC(7,ABEND);                /* IF ERROR,GO TO ABEND RTN      */ 00431000
         BC    7,ABEND                                             0262 00432000
*                                   /* VALIDATE 2ND HALF OF IOB      */ 00433000
*       GPR02P=ADDR(IOBSTDRD)+IOBDIOBS-1;/* END ADDR OF IOB          */ 00434000
         L     @12,WKAIOBQX(,RBSECPTR)                             0263 00435000
         LH    GPR02P,IOBDIOBS(,@12)                               0263 00436000
         AR    GPR02P,@12                                          0263 00437000
         BCTR  GPR02P,0                                            0263 00438000
*       CALL CVT0VL01;              /* VALIDATE 2ND HALF OF IOB      */ 00439000
         L     @12,CVTPTR                                          0264 00440000
         L     @15,CVT0VL01(,@12)                                  0264 00441000
         BALR  @14,@15                                             0264 00442000
*       BC(7,ABEND);                /* IF ERROR, GO TO ABEND RTN     */ 00443000
         BC    7,ABEND                                             0265 00444000
*     END;                                                         0266 00445000
*   BLKCTR=BLKCTR+1;                /* UP BLKCTR TO SYST ERR(=7)     */ 00446000
@RF00254 AH    BLKCTR,@CH00102                                     0267 00447000
*FREELOCK:                                                         0268 00448000
*   ;                               /* FREE THE LOCAL LOCK           */ 00449000
FREELOCK DS    0H                                                  0269 00450000
*   RFY                                                            0269 00451000
*     GPR00P RSTD;                                                 0269 00452000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE AROUND SETLK    */ 00453000
         LR    GPR00P,SAVEPTR                                      0270 00454000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    00455000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00456000
*                                      LOCK))                        */ 00457000
*     RFY                                                          0272 00458000
*      (GPR11P,                                                    0272 00459000
*       GPR12P,                                                    0272 00460000
*       GPR13P,                                                    0272 00461000
*       GPR14P)RSTD;                                               0272 00462000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0273 00463000
*                                      TABLE.                        */ 00464000
         L     GPR13P,PSALITA                                      0273 00465000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0274 00466000
*                                      ENTRY ADRS.                   */ 00467000
         LM GPR11P,GPR13P,588(GPR13P)                                   00468000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00469000
         BALR GPR14P,GPR13P                                             00470000
*     RFY                                                          0276 00471000
*      (GPR11P,                                                    0276 00472000
*       GPR12P,                                                    0276 00473000
*       GPR13P,                                                    0276 00474000
*       GPR14P)UNRSTD;                                             0276 00475000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    00476000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00477000
*                                      LOCK))                        */ 00478000
*   SAVEPTR=GPR00P;                 /* RESTORE RTM SAVEAREA PTR      */ 00479000
         LR    SAVEPTR,GPR00P                                      0278 00480000
*   RFY                                                            0279 00481000
*     GPR00P UNRSTD;                                               0279 00482000
*   GOTO SYSERRTN;                  /* USER CONTROL BLOCKS OK        */ 00483000
*                                                                  0280 00484000
         B     SYSERRTN                                            0280 00485000
*/********************************************************************/ 00486000
*/* THE FOLLOWING ROUTINE ABENDS THE USER WHEN IT IS DETERMINED THAT */ 00487000
*/* A USER CONTROL BLOCK IS INVALID. AN ATTEMPT IS MADE TO CLEAN UP  */ 00488000
*/* THE READ EXCLUSIVE LIST AND UNPOSTED QUEUES,ISSUE WTP IDENTIFYING*/ 00489000
*/* THE PROBLEM AND GTRACE THOSE CONTROL BLOCKS RELATED TO THE ERROR.*/ 00490000
*/********************************************************************/ 00491000
*                                                                  0281 00492000
*ABEND:                                                            0281 00493000
*   ;                               /* ABEND THE USER WITH 235       */ 00494000
ABEND    DS    0H                                                  0282 00495000
*   GTFLAG=GTOFF;                   /* INITIAL GTRACE TO 0     YM4667*/ 00496000
         MVC   GTFLAG(1,SDWAPTR),GTOFF                             0282 00497000
*   IF(BLKCTR<DECBERR)|             /* BLKREF,DCB,IOB BAD, OR        */ 00498000
*       (RBGRS1¬<0&BLKCTR=DECBERR)THEN/* RELEX,NO IOB OR DECB        */ 00499000
         LA    @14,4                                               0283 00500000
         CR    BLKCTR,@14                                          0283 00501000
         BL    @RT00283                                            0283 00502000
         ICM   @12,15,RBGRS1(RBSECPTR)                             0283 00503000
         BM    @RF00283                                            0283 00504000
         CR    BLKCTR,@14                                          0283 00505000
         BNE   @RF00283                                            0283 00506000
@RT00283 DS    0H                                                  0284 00507000
*     DO;                           /* FREE LOCK, NO GTRACE TO DO    */ 00508000
*       RFY                                                        0285 00509000
*         GPR00P RSTD;                                             0285 00510000
*       GPR00P=SAVEPTR;             /* SAVE RTM SAVE AROUND SETLK    */ 00511000
         LR    GPR00P,SAVEPTR                                      0286 00512000
*FREELCKX:                                                         0287 00513000
*       ;                           /* FREE THE LOCAL LOCK           */ 00514000
FREELCKX DS    0H                                                  0288 00515000
*       DO;                         /* SETLOCK (RELEASE) TYPE(LOCAL)    00516000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00517000
*                                      LOCK))                        */ 00518000
*         RFY                                                      0289 00519000
*          (GPR11P,                                                0289 00520000
*           GPR12P,                                                0289 00521000
*           GPR13P,                                                0289 00522000
*           GPR14P)RSTD;                                           0289 00523000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0290 00524000
*                                      TABLE.                        */ 00525000
         L     GPR13P,PSALITA                                      0290 00526000
*         GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT 0291 00527000
*                                      AND ENTRY ADRS.               */ 00528000
         LM GPR11P,GPR13P,588(GPR13P)                                   00529000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 00530000
         BALR GPR14P,GPR13P                                             00531000
*         RFY                                                      0293 00532000
*          (GPR11P,                                                0293 00533000
*           GPR12P,                                                0293 00534000
*           GPR13P,                                                0293 00535000
*           GPR14P)UNRSTD;                                         0293 00536000
*       END;                        /* SETLOCK (RELEASE) TYPE(LOCAL)    00537000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00538000
*                                      LOCK))                        */ 00539000
*       SAVEPTR=GPR00P;             /* RESTORE RTM SAVEAREA PTR      */ 00540000
         LR    SAVEPTR,GPR00P                                      0295 00541000
*       RFY                                                        0296 00542000
*         GPR00P UNRSTD;                                           0296 00543000
*       GOTO CLEAN;                 /* GO TO NEXT ROUTINE            */ 00544000
         B     CLEAN                                               0297 00545000
*     END;                                                         0298 00546000
*                                                                  0298 00547000
*/* GET CORE TO BUILD THE GTRACE BUFFER AREA WHICH WILL CONTAIN THOSE*/ 00548000
*/* CONTROL BLOCKS WHICH WERE VALIDATED. REGS 0,1,3,4,7 ARE USED FOR */ 00549000
*/* INPUT TO GETMAIN - BRANCH ENTRY.REG 4 CONTAINS THE TCB AND REG 7,*/ 00550000
*/* THE ASCB ADDRESS.                                                */ 00551000
*                                                                  0299 00552000
*GETCORE:                                                          0299 00553000
*   RFY                                                            0299 00554000
*    (TRCPTR,                                                      0299 00555000
*     GPR01P)RSTD;                  /* RESTRICT REGS                 */ 00556000
@RF00283 DS    0H                                                  0299 00557000
GETCORE  DS    0H                                                  0300 00558000
*   RFY                                                            0300 00559000
*    (GPR04P,                                                      0300 00560000
*     GPR07P,                                                      0300 00561000
*     WRKREG)RSTD;                  /* RESTR INPUT/SAVE        YM4667*/ 00562000
*   GPR04P=PSATOLD;                 /* PUT TCB ADDR IN R4      YM4667*/ 00563000
         L     GPR04P,PSATOLD                                      0301 00564000
*   WRKREG=BLKCTR;                  /* SAVE BLKCTR CODE        YM4667*/ 00565000
         LR    WRKREG,BLKCTR                                       0302 00566000
*   GPR07P=PSAAOLD;                 /* PUT ASCB ADDR IN R7     YM4667*/ 00567000
         L     GPR07P,PSAAOLD                                      0303 00568000
*   DO;                             /* GETMAIN (RC)                0304 00569000
*                                      LV(LENGTH(SPDBFR)) SP(230)  0304 00570000
*                                      KEY(0) BRANCH                 */ 00571000
*     RESPECIFY                                                    0305 00572000
*      (GPR01F,                                                    0305 00573000
*       GPR03F,                                                    0305 00574000
*       GPR00F)RESTRICTED;                                         0305 00575000
*     GPR01F=0;                     /* REG 1 MUST BE ZERO            */ 00576000
         SR    @14,@14                                             0306 00577000
         LR    GPR01F,@14                                          0306 00578000
*     GPR03F=0;                     /* RC-TYPE GETMAIN               */ 00579000
         LR    GPR03F,@14                                          0307 00580000
*     GPR00F=LENGTH(SPDBFR);        /* LENGTH REQUESTED              */ 00581000
         LA    GPR00F,256                                          0308 00582000
*     GPR03F=GPR03F|((230)*256);    /* SP IN BYTE 2                  */ 00583000
         O     GPR03F,@CF03499                                     0309 00584000
*     GPR03F=GPR03F|((0)*65536*16); /* KEY IN BYTE 1                 */ 00585000
*     CALL CVTCRMN;                 /* BRANCH ENTRY POINT            */ 00586000
         L     @12,CVTPTR                                          0311 00587000
         L     @15,CVTCRMN(,@12)                                   0311 00588000
         BALR  @14,@15                                             0311 00589000
*     RESPECIFY                                                    0312 00590000
*      (GPR01F,                                                    0312 00591000
*       GPR03F,                                                    0312 00592000
*       GPR00F)UNRESTRICTED;                                       0312 00593000
*   END;                            /* GETMAIN (RC)                0313 00594000
*                                      LV(LENGTH(SPDBFR)) SP(230)  0313 00595000
*                                      KEY(0) BRANCH                 */ 00596000
*   RFY                                                            0314 00597000
*     GPR15P RSTD;                  /* RESTRICT RETURN REG           */ 00598000
*   BLKCTR=WRKREG;                  /* RESTORE BLKCTR CODE     YM4667*/ 00599000
         LR    BLKCTR,WRKREG                                       0315 00600000
*   IF GPR15P¬=0 THEN               /* NO CORE,CANT GTRACE           */ 00601000
         LTR   GPR15P,GPR15P                                       0316 00602000
         BZ    @RF00316                                            0316 00603000
*     DO;                           /* FREE LOCK, NO GTRACE TO DO    */ 00604000
*       RFY                                                        0318 00605000
*         GPR00P RSTD;                                             0318 00606000
*       GPR00P=SAVEPTR;             /* SAVE RTM SAVE AROUND SETLK    */ 00607000
         LR    GPR00P,SAVEPTR                                      0319 00608000
*FREELCK3:                                                         0320 00609000
*       ;                           /* FREE THE LOCAL LOCK           */ 00610000
FREELCK3 DS    0H                                                  0321 00611000
*       DO;                         /* SETLOCK (RELEASE) TYPE(LOCAL)    00612000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00613000
*                                      LOCK))                        */ 00614000
*         RFY                                                      0322 00615000
*          (GPR11P,                                                0322 00616000
*           GPR12P,                                                0322 00617000
*           GPR13P,                                                0322 00618000
*           GPR14P)RSTD;                                           0322 00619000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0323 00620000
*                                      TABLE.                        */ 00621000
         L     GPR13P,PSALITA                                      0323 00622000
*         GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT 0324 00623000
*                                      AND ENTRY ADRS.               */ 00624000
         LM GPR11P,GPR13P,588(GPR13P)                                   00625000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 00626000
         BALR GPR14P,GPR13P                                             00627000
*         RFY                                                      0326 00628000
*          (GPR11P,                                                0326 00629000
*           GPR12P,                                                0326 00630000
*           GPR13P,                                                0326 00631000
*           GPR14P)UNRSTD;                                         0326 00632000
*       END;                        /* SETLOCK (RELEASE) TYPE(LOCAL)    00633000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00634000
*                                      LOCK))                        */ 00635000
*       SAVEPTR=GPR00P;             /* RESTORE RTM SAVEAREA PTR      */ 00636000
         LR    SAVEPTR,GPR00P                                      0328 00637000
*       RFY                                                        0329 00638000
*         GPR00P UNRSTD;                                           0329 00639000
*       GOTO CLEAN;                 /* GO TO NEXT ROUTINE            */ 00640000
         B     CLEAN                                               0330 00641000
*     END;                                                         0331 00642000
*   RFY                                                            0332 00643000
*    (GPR04P,                                                      0332 00644000
*     GPR07P,                                                      0332 00645000
*     WRKREG,                                                      0332 00646000
*     GPR15P)UNRSTD;                /* RELEASE                 YM4667*/ 00647000
@RF00316 DS    0H                                                  0333 00648000
*   TRCPTR=GPR01P;                  /* BASE REG FOR TRACE BUFFER     */ 00649000
         LR    TRCPTR,GPR01P                                       0333 00650000
*   RFY                                                            0334 00651000
*     SPDBFR BASED(TRCPTR);         /* ADDRESSABILITY TO BUFFER      */ 00652000
*   RFY                                                            0335 00653000
*     GPR01P UNRSTD;                                               0335 00654000
*                                                                  0335 00655000
*/* MUST VALIDATE TIOT ENTRY BEFORE GETTING DDNAME FOR GTRACE.       */ 00656000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 00657000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 00658000
*/* CHECKED FIRST.                                                   */ 00659000
*                                                                  0336 00660000
*   WKALOCK='1'B;                   /* SW-DEBCHECK WONT FREE LOCK    */ 00661000
         OI    WKALOCK(RBSECPTR),B'01000000'                       0336 00662000
*   CALL DEBCHECK;                  /* MUST 1ST VALIDATE DEB BY    0337 00663000
*                                      CALLING DEBCHK SUBRTN         */ 00664000
         BAL   @14,DEBCHECK                                        0337 00665000
*   RFY                                                            0338 00666000
*     DEBBASIC BASED(WKASVDEB);     /* VALIDATED DEB STORED IN SVRB     00667000
*                                      BY DEBCHECK SUBRTN            */ 00668000
*   IF WKADEBXC=0 THEN              /* IF DEB RET CODE=0,DEB OK      */ 00669000
         CLI   WKADEBXC(RBSECPTR),0                                0339 00670000
         BNE   @RF00339                                            0339 00671000
*     SPDDDNAM=TIOEDDNM;            /* MV DDNAME INTO GTF BUFFER     */ 00672000
         L     @12,WKASVDEB(,RBSECPTR)                             0340 00673000
         L     @12,DEBAPPAD(,@12)                                  0340 00674000
         L     @12,DEBXTNP(,@12)                                   0340 00675000
         L     @12,DEBXDSAB(,@12)                                  0340 00676000
         L     @12,DSABTIOT(,@12)                                  0340 00677000
         MVC   SPDDDNAM(8,TRCPTR),TIOEDDNM(@12)                    0340 00678000
*   ELSE                            /* DEB WAS BAD,USE DUMMY DDN     */ 00679000
*     SPDDDNAM=NODDNAME;            /* MOVE ASTERISKS INTO MESSAG    */ 00680000
         B     @RC00339                                            0341 00681000
@RF00339 MVC   SPDDDNAM(8,TRCPTR),NODDNAME                         0341 00682000
*MVCCD:                                                            0342 00683000
*   ;                               /* ESTABLISH COND CODE           */ 00684000
@RC00339 DS    0H                                                  0342 00685000
MVCCD    DS    0H                                                  0343 00686000
*   SPDABCCD=BLKERR1(BLKCTR);       /* INDEX TO BLKID IN ERROR       */ 00687000
         SR    @12,@12                                             0343 00688000
         IC    @12,BLKERR1-1(BLKCTR)                               0343 00689000
         STC   @12,SPDABCCD(,TRCPTR)                               0343 00690000
*   RFY                                                            0344 00691000
*     MVBLKPTR RSTD;                /* RESTRICT PTR TO MOVE BLK      */ 00692000
*   MVBLKPTR=ADDR(SPDTRACE);        /* ESTABLISH PTR TO TRACE BLK    */ 00693000
         LA    MVBLKPTR,SPDTRACE(,TRCPTR)                          0345 00694000
*   RFY                                                            0346 00695000
*     SPDTRRCD BASED(MVBLKPTR);     /* ESTABLISH ADDRESSABILITY      */ 00696000
*                                                                  0346 00697000
*/*    IF NOT RELEX AND DECB IS BAD, TRACE IOB PASSED                */ 00698000
*                                                                  0347 00699000
*MVIOB:                                                            0347 00700000
*   ;                               /* MV IOB INTO GTRACE BUFFER     */ 00701000
MVIOB    DS    0H                                                  0348 00702000
*   IF BLKCTR=DECBERR THEN          /* DECB ERROR,NOT RELEX, THEN    */ 00703000
         CH    BLKCTR,@CH00095                                     0348 00704000
         BNE   @RF00348                                            0348 00705000
*     DO;                           /* GTRACE IOB WITH DECB PTR      */ 00706000
*       SPDRCDLN=IOBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);/* MV IOB     00707000
*                                      LG+PREFIX LG IN REC           */ 00708000
         MVI   SPDRCDLN(MVBLKPTR),X'4E'                            0350 00709000
*       SPDBLKID=SPDIOB;            /* MV IOB ID=133 INTO REC        */ 00710000
         MVI   SPDBLKID(MVBLKPTR),X'85'                            0351 00711000
*       SPDBLKAD=ABS(RBGRS1);       /* MV IOB ADDR INTO REC PREF     */ 00712000
         L     @12,RBGRS1(,RBSECPTR)                               0352 00713000
         LPR   @12,@12                                             0352 00714000
         ST    @12,SPDBLKAD(,MVBLKPTR)                             0352 00715000
*       RFY                                                        0353 00716000
*         IOBSTDRD BASED(SPDBLKAD); /* IOB ADDR PUT IN BUFFER        */ 00717000
*       SPDDATA2(1:IOBLEN)=IOBSTDRD(1:IOBLEN);/* MV IOB INTO BUF     */ 00718000
         MVC   SPDDATA2(72,MVBLKPTR),IOBSTDRD(@12)                 0354 00719000
*       WKATRXLG=IOBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD)+PREFIXLG;/*   00720000
*                                      LG OF GTRACE RECORD           */ 00721000
         MVI   WKATRXLG(RBSECPTR),X'57'                            0355 00722000
*     END;                                                         0356 00723000
*                                                                  0356 00724000
*/*   IF DEB ERROR, TRACE THE DCB                                    */ 00725000
*                                                                  0357 00726000
*MVDCB:                                                            0357 00727000
*   ;                               /* MV DCB INTO GTRACE BUFFER     */ 00728000
@RF00348 DS    0H                                                  0357 00729000
MVDCB    DS    0H                                                  0358 00730000
*   IF BLKCTR=DEBERR THEN           /* IF DEB ERR,PTR IN DCB BAD     */ 00731000
         CH    BLKCTR,@CH01435                                     0358 00732000
         BNE   @RF00358                                            0358 00733000
*     DO;                                                          0359 00734000
*       SPDRCDLN=DCBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);/* MV    0360 00735000
*                                      LENGTH OF DCB INTO REC        */ 00736000
         MVI   SPDRCDLN(MVBLKPTR),X'6E'                            0360 00737000
*       SPDBLKID=SPDDCB;            /* MV DCB ID=130 INTO REC        */ 00738000
         MVI   SPDBLKID(MVBLKPTR),X'82'                            0361 00739000
*       SPDBLKAD=DCBPTR;            /* MV DCB ADDR INTO RECORD       */ 00740000
         ST    DCBPTR,SPDBLKAD(,MVBLKPTR)                          0362 00741000
*       SPDDATA2(1:DCBLEN)=IHADCB(1:DCBLEN);/* MV DCB INTO BUFFER    */ 00742000
         MVC   SPDDATA2(104,MVBLKPTR),IHADCB(DCBPTR)               0363 00743000
*       WKATRXLG=DCBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD)+PREFIXLG;/*   00744000
*                                      LG OF GTRACE RECORD           */ 00745000
         MVI   WKATRXLG(RBSECPTR),X'77'                            0364 00746000
*     END;                          /* GO GTRACE THE RECORD          */ 00747000
*                                                                  0365 00748000
*/* IF NEXT IOB IN ERROR, TRACE THE READX LIST ENTRY. BEFORE FURTHER */ 00749000
*/* PROCESSING MUST ESTABLISH THE ADDRESS OF THE ENTRY IN THE READ   */ 00750000
*/* EXCLUSIVE LIST WHICH MATCHES THE ARGUMENT IN THE SVRB, IF ONE    */ 00751000
*/* EXISTS. THE ENTRY WILL BE GTRACED.                               */ 00752000
*                                                                  0366 00753000
*MVRDX:                                                            0366 00754000
*   ;                               /* FIND ADDR OF RDXENTRY         */ 00755000
@RF00358 DS    0H                                                  0366 00756000
MVRDX    DS    0H                                                  0367 00757000
*   IF BLKCTR=NXTIOBER THEN         /* IF NEXT IOB IS INVALID        */ 00758000
         CH    BLKCTR,@CH01455                                     0367 00759000
         BNE   @RF00367                                            0367 00760000
*     DO;                           /* MUST GTRACE SOURCE OF IOB     */ 00761000
*       RFY                                                        0369 00762000
*        (RDXPTR,                                                  0369 00763000
*         RDXENTRG)RSTD;            /* RESTRICT BASE REGS            */ 00764000
*       RFY                                                        0370 00765000
*         DEBBASIC BASED(WKASVDEB); /* ESTAB DEB(SAVED IN SVRB)      */ 00766000
*       RFY                                                        0371 00767000
*         DEBXTN BASED(DEBXTNP);    /* DEB EXTENSION BASE            */ 00768000
*       RDXPTR=DEBXXARG;            /* READ EXCLUSIVE LIST PTR       */ 00769000
         L     @12,WKASVDEB(,RBSECPTR)                             0372 00770000
         L     @12,DEBAPPAD(,@12)                                  0372 00771000
         L     @12,DEBXTNP(,@12)                                   0372 00772000
         L     RDXPTR,DEBXXARG(,@12)                               0372 00773000
*       RFY                                                        0373 00774000
*         GPR00P RSTD;              /* RESTRC REG TO SAVE RDXLIST    */ 00775000
*       RFY                                                        0374 00776000
*         RDXLIST BASED(RDXPTR);    /* ESTABLISH BASE FOR RDXLIST    */ 00777000
*       GPR00P=RDXNEXT;             /* SAVE ADDR TO NEXT SEGMENT     */ 00778000
         L     GPR00P,RDXNEXT(,RDXPTR)                             0375 00779000
*RDXLOOP:                                                          0376 00780000
*       DO I=1 TO RDXMAXCT;         /* SEARCH 9 ENTRIES/SEGMENT      */ 00781000
RDXLOOP  LA    I,1                                                 0376 00782000
@DL00376 DS    0H                                                  0377 00783000
*         IF RDXENT(1:8)=WKANQARG THEN/* IF ENTRY MATCHES,SAVE       */ 00784000
         CLC   RDXENT(8,RDXPTR),WKANQARG(RBSECPTR)                 0377 00785000
         BNE   @RF00377                                            0377 00786000
*           DO;                     /* THE ADDR TO MV INTO BUFFER    */ 00787000
*             RDXENTRG=ADDR(RDXENT);/* PUT ENTRY INTO BASE REG       */ 00788000
         LA    RDXENTRG,RDXENT(,RDXPTR)                            0379 00789000
*             RFY                                                  0380 00790000
*               RDXENTRY BASED(RDXENTRG);/* RDXENTRY GETS BASE       */ 00791000
*             WKAXADDR=RDXENTRG;    /* SAVE ENTRY ADDR IN SVRB       */ 00792000
         ST    RDXENTRG,WKAXADDR(,RBSECPTR)                        0381 00793000
*             GOTO BLDENT;          /* CONTINUE GTRACE               */ 00794000
         B     BLDENT                                              0382 00795000
*           END;                                                   0383 00796000
*         ELSE                      /* IF THAT ENTRY NOT THE ONE     */ 00797000
*           RDXPTR=RDXPTR+LENGTH(RDXENTRY);/* GO TO NEXT ENTRY       */ 00798000
@RF00377 AH    RDXPTR,@CH00076                                     0384 00799000
*       END RDXLOOP;                /* RETURN TO CHECK NEXT ENTRY    */ 00800000
         AH    I,@CH00102                                          0385 00801000
         CH    I,@CH01483                                          0385 00802000
         BNH   @DL00376                                            0385 00803000
*       IF GPR00P¬=0 THEN           /* IS THERE ANOTHER SEGMENT      */ 00804000
         LTR   GPR00P,GPR00P                                       0386 00805000
         BZ    @RF00386                                            0386 00806000
*         DO;                       /* IF YES, GO CHECK NEXT SEG     */ 00807000
*           RDXPTR=GPR00P;          /* MAKE SEGMENT BASE FOR LIST    */ 00808000
         LR    RDXPTR,GPR00P                                       0388 00809000
*           GPR00P=RDXNEXT;         /* SAVE SEGMENT AFTER THIS       */ 00810000
         L     GPR00P,RDXNEXT(,RDXPTR)                             0389 00811000
*           GOTO RDXLOOP;           /* REPEAT THE SEARCH             */ 00812000
         B     RDXLOOP                                             0390 00813000
*         END;                                                     0391 00814000
*       ELSE                        /* IF ARGUMENT IS NOT ON LIST    */ 00815000
*         WKAXADDR=0;               /* NO MATCH,0 TO TELL CLEANUP    */ 00816000
@RF00386 SR    @12,@12                                             0392 00817000
         ST    @12,WKAXADDR(,RBSECPTR)                             0392 00818000
*       RFY                                                        0393 00819000
*         GPR00P RSTD;              /* FIRST MUST FREE LOCAL LOCK    */ 00820000
*       GPR00P=SAVEPTR;             /* SAVE RTM SAVE AROUND SETLK    */ 00821000
         LR    GPR00P,SAVEPTR                                      0394 00822000
*FREELCK2:                                                         0395 00823000
*       ;                           /* FREE THE LOCAL LOCK           */ 00824000
FREELCK2 DS    0H                                                  0396 00825000
*       DO;                         /* SETLOCK (RELEASE) TYPE(LOCAL)    00826000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00827000
*                                      LOCK))                        */ 00828000
*         RFY                                                      0397 00829000
*          (GPR11P,                                                0397 00830000
*           GPR12P,                                                0397 00831000
*           GPR13P,                                                0397 00832000
*           GPR14P)RSTD;                                           0397 00833000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0398 00834000
*                                      TABLE.                        */ 00835000
         L     GPR13P,PSALITA                                      0398 00836000
*         GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT 0399 00837000
*                                      AND ENTRY ADRS.               */ 00838000
         LM GPR11P,GPR13P,588(GPR13P)                                   00839000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 00840000
         BALR GPR14P,GPR13P                                             00841000
*         RFY                                                      0401 00842000
*          (GPR11P,                                                0401 00843000
*           GPR12P,                                                0401 00844000
*           GPR13P,                                                0401 00845000
*           GPR14P)UNRSTD;                                         0401 00846000
*       END;                        /* SETLOCK (RELEASE) TYPE(LOCAL)    00847000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00848000
*                                      LOCK))                        */ 00849000
*       SAVEPTR=GPR00P;             /* RESTORE RTM SAVEAREA PTR      */ 00850000
         LR    SAVEPTR,GPR00P                                      0403 00851000
*       RFY                                                        0404 00852000
*         GPR00P UNRSTD;                                           0404 00853000
*       GOTO FREECORE;              /* NO GTRACE, FREE CORE          */ 00854000
         B     FREECORE                                            0405 00855000
*       RFY                                                        0406 00856000
*        (RDXPTR,                                                  0406 00857000
*         GPR00P)UNRSTD;                                           0406 00858000
*BLDENT:                                                           0407 00859000
*       ;                           /* GTRACE XCLUSIVE LIST ENTRY IF    00860000
*                                      BLKCTR=6 -NEXT IOB BAD        */ 00861000
BLDENT   DS    0H                                                  0408 00862000
*       SPDRCDLN=LENGTH(RDXENTRY)+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);    00863000
         MVI   SPDRCDLN(MVBLKPTR),X'16'                            0408 00864000
*                                   /* MV REC LEN TO BUF             */ 00865000
*       SPDBLKID=SPDREADX;          /* MV RDX ID=140 INTO RECORD     */ 00866000
         MVI   SPDBLKID(MVBLKPTR),X'8C'                            0409 00867000
*       SPDBLKAD=WKAXADDR;          /* GET ADDR OF ENTRY FROM WHICH     00868000
*                                      NEXT IOB WAS TAKEN            */ 00869000
         MVC   SPDBLKAD(4,MVBLKPTR),WKAXADDR(RBSECPTR)             0410 00870000
*       SPDDATA2(1:LENGTH(RDXENTRY))=RDXENTRY;/* RDX ENTRY TO BUF    */ 00871000
         MVC   SPDDATA2(16,MVBLKPTR),RDXENTRY(RDXENTRG)            0411 00872000
*       WKATRXLG=LENGTH(RDXENTRY)+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD)+    00873000
*           PREFIXLG;               /* TRC REC LG                    */ 00874000
         MVI   WKATRXLG(RBSECPTR),X'1F'                            0412 00875000
*       RFY                                                        0413 00876000
*         RDXENTRG UNRSTD;                                         0413 00877000
*     END;                                                         0414 00878000
*                                                                  0414 00879000
*/*     FREE THE LOCAL LOCK BEFORE ISSUING GTRACE                    */ 00880000
*                                                                  0415 00881000
*FREELCK1:                                                         0415 00882000
*   ;                               /* FREE THE LOCAL LOCK BEFORE    */ 00883000
@RF00367 DS    0H                                                  0415 00884000
FREELCK1 DS    0H                                                  0416 00885000
*   RFY                                                            0416 00886000
*     GPR00P RSTD;                  /* ISSUING GTRACE                */ 00887000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE AROUND SETLK    */ 00888000
         LR    GPR00P,SAVEPTR                                      0417 00889000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    00890000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00891000
*                                      LOCK))                        */ 00892000
*     RFY                                                          0419 00893000
*      (GPR11P,                                                    0419 00894000
*       GPR12P,                                                    0419 00895000
*       GPR13P,                                                    0419 00896000
*       GPR14P)RSTD;                                               0419 00897000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0420 00898000
*                                      TABLE.                        */ 00899000
         L     GPR13P,PSALITA                                      0420 00900000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0421 00901000
*                                      ENTRY ADRS.                   */ 00902000
         LM GPR11P,GPR13P,588(GPR13P)                                   00903000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00904000
         BALR GPR14P,GPR13P                                             00905000
*     RFY                                                          0423 00906000
*      (GPR11P,                                                    0423 00907000
*       GPR12P,                                                    0423 00908000
*       GPR13P,                                                    0423 00909000
*       GPR14P)UNRSTD;                                             0423 00910000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    00911000
*                                      RELATED(CNTRLBLK,IGCT005C,(SET   00912000
*                                      LOCK))                        */ 00913000
*   SAVEPTR=GPR00P;                 /* RESTORE RTM SAVEAREA PTR      */ 00914000
         LR    SAVEPTR,GPR00P                                      0425 00915000
*   RFY                                                            0426 00916000
*     GPR00P UNRSTD;                                               0426 00917000
*                                                                  0426 00918000
*/*    GTRACE THOSE CONTROL BLOCKS VALIDATED                         */ 00919000
*                                                                  0427 00920000
*TRACE:                                                            0427 00921000
*   ;                               /* GTRACE THE CONTROL BLKS       */ 00922000
TRACE    DS    0H                                                  0428 00923000
*   RFY                                                            0428 00924000
*    (GPR01P,                                                      0428 00925000
*     WRKREG,                                                      0428 00926000
*     GPR15P)RSTD;                                                 0428 00927000
*   WRKREG=WKATRXLG;                /* GET TRACE REC LG FROM SVRB    */ 00928000
         SR    WRKREG,WRKREG                                       0429 00929000
         IC    WRKREG,WKATRXLG(,RBSECPTR)                          0429 00930000
*   GPR01P=ADDR(TRCLIST);           /* GET ADDRESS OF TRACE LIST     */ 00931000
         LA    GPR01P,TRCLIST(,RBSECPTR)                           0430 00932000
*   GEN REFS(SPDBFR,GPR01P,WRKREG)SETS(GPR15P,TRCPTR);             0431 00933000
       GTRACE DATA=(TRCPTR),MF=(E,(1)),LNG=(WRKREG),ID=IGGSP235         00934000
*   IF GPR15P=0 THEN                /* IF RET CODE=0,GTRACE GOOD     */ 00935000
         LTR   GPR15P,GPR15P                                       0432 00936000
         BNZ   @RF00432                                            0432 00937000
*     GTFLAG=GTON;                  /* TURN ON LO BIT IF GTF GOOD    */ 00938000
         MVC   GTFLAG(1,SDWAPTR),GTON                              0433 00939000
*   RFY                                                            0434 00940000
*    (GPR01P,                                                      0434 00941000
*     WRKREG,                                                      0434 00942000
*     GPR15P,                                                      0434 00943000
*     MVBLKPTR)UNRSTD;                                             0434 00944000
@RF00432 DS    0H                                                  0435 00945000
*FREECORE:                                                         0435 00946000
*   ;                               /* FREE THE GTRACE BUFFER        */ 00947000
FREECORE DS    0H                                                  0436 00948000
*   DO;                             /* FREEMAIN(RC)                0436 00949000
*                                      LV(LENGTH(SPDBFR))A(SPDBFR) 0436 00950000
*                                      SP(230)                       */ 00951000
*     RESPECIFY                                                    0437 00952000
*      (GPR01F,                                                    0437 00953000
*       GPR15F,                                                    0437 00954000
*       GPR00F)RESTRICTED;                                         0437 00955000
*     GPR01F=0;                     /* REG 1 MUST BE ZERO            */ 00956000
         SR    GPR01F,GPR01F                                       0438 00957000
*     GPR15F=1;                     /* SET TYPE                      */ 00958000
         LA    GPR15F,1                                            0439 00959000
*     GPR00F=LENGTH(SPDBFR);        /* LENGTH REQUESTED              */ 00960000
         LA    GPR00F,256                                          0440 00961000
*     GPR01F=ADDR(SPDBFR);          /* SET REGISTER ONE              */ 00962000
         LR    GPR01F,TRCPTR                                       0441 00963000
*     GPR15F=GPR15F+((230)*256);    /* SUBPOOL VALUE                 */ 00964000
         A     GPR15F,@CF03499                                     0442 00965000
*     SVC(120);                     /* RC/RU-FORM OF GETMAIN         */ 00966000
         SVC   120                                                 0443 00967000
*     RESPECIFY                                                    0444 00968000
*      (GPR01F,                                                    0444 00969000
*       GPR15F,                                                    0444 00970000
*       GPR00F)UNRESTRICTED;                                       0444 00971000
*   END;                            /* FREEMAIN(RC)                0445 00972000
*                                      LV(LENGTH(SPDBFR))A(SPDBFR) 0445 00973000
*                                      SP(230)                       */ 00974000
*   RFY                                                            0446 00975000
*     TRCPTR UNRSTD;                                               0446 00976000
*   RFY                                                            0447 00977000
*     SPDBFR BASED;                                                0447 00978000
*                                                                  0447 00979000
*/*  CALL CLEANUP ROUTINE TO CLEAN UP RESOURCES WHICH MAY HAVE BEEN  */ 00980000
*/*  IN PARTIAL STAGES OF UPDATE BEFORE THE ABEND.                   */ 00981000
*                                                                  0448 00982000
*CLEAN:                                                            0448 00983000
*   ;                               /* CLEAN UP RESOURCES            */ 00984000
CLEAN    DS    0H                                                  0449 00985000
*   CALL IGCT105C;                  /* GO CLEAN UP RESOURCES         */ 00986000
         L     @15,@CV03373                                        0449 00987000
         BALR  @14,@15                                             0449 00988000
*   RFY                                                            0450 00989000
*     GPR15P RSTD;                  /* DONE BY SUBRTN, IGCT105C      */ 00990000
*   IF GPR15P¬=0 THEN               /* TEST RET CODE FROM CLEAN      */ 00991000
         LTR   GPR15P,GPR15P                                       0451 00992000
         BZ    @RF00451                                            0451 00993000
*     DO;                           /* ERROR IN CLEAN UP             */ 00994000
*       WKACLENX=CLEANRC1(8);       /* SET RC FOR CLEANUP ABEND      */ 00995000
         MVC   WKACLENX(1,RBSECPTR),CLEANRC1+7                     0453 00996000
*       GEN(ESTAE 0);               /* GET RID OF ESTAE              */ 00997000
         ESTAE 0                                                        00998000
*     END;                                                         0455 00999000
*   RFY                                                            0456 01000000
*     GPR15P UNRSTD;                                               0456 01001000
*                                                                  0456 01002000
@RF00451 DS    0H                                                  0457 01003000
*/*    WRITE OUT MESSAGE TO PROGRAMMER DESCRIBING PROBLEM            */ 01004000
*                                                                  0457 01005000
*WTP:                                                              0457 01006000
*   ;                               /* ISSUE WTP IDENTIFYING ERR     */ 01007000
WTP      DS    0H                                                  0458 01008000
*   RFY                                                            0458 01009000
*     WRKREG RSTD;                  /* RESTRICT WORKREG              */ 01010000
*   WRKREG=GTFLAG;                  /* SAVE CONTENTS OF GTRACE SW    */ 01011000
         SR    WRKREG,WRKREG                                       0459 01012000
         IC    WRKREG,GTFLAG(,SDWAPTR)                             0459 01013000
*   MESSAGE=USERER;                 /* MOVE IN MESSAGE               */ 01014000
         MVC   MESSAGE(52,SDWAPTR),USERER                          0460 01015000
*   GTFLAG=WRKREG;                  /* REPLACE GTRACE SW             */ 01016000
         STC   WRKREG,GTFLAG(,SDWAPTR)                             0461 01017000
*   RCODE=BLKERR2(BLKCTR);          /* MV BLK IN ERROR INTO MESS     */ 01018000
         LA    @12,BLKERR2-1(BLKCTR)                               0462 01019000
         MVC   RCODE(1,SDWAPTR),0(@12)                             0462 01020000
*   WRKREG=WKACLENX;                /* LOAD CLEAN RC FOR INDEX       */ 01021000
         SR    WRKREG,WRKREG                                       0463 01022000
         IC    WRKREG,WKACLENX(,RBSECPTR)                          0463 01023000
*   RETCOD2=CLEANRC2(WRKREG);       /* MV CLEANUP RC INTO MESSAGE    */ 01024000
         LR    @12,WRKREG                                          0464 01025000
         AR    @12,@12                                             0464 01026000
         LA    @10,CLEANRC2-2(@12)                                 0464 01027000
         MVC   RETCOD2(2,SDWAPTR),0(@10)                           0464 01028000
*   RFY                                                            0465 01029000
*     WRKREG UNRSTD;                                               0465 01030000
*   MSGJOB=TIOCNJOB;                /* MV IN JOB NAME                */ 01031000
         L     @12,PSATOLD                                         0466 01032000
         L     @12,TCBTIO(,@12)                                    0466 01033000
         MVC   MSGJOB(8,SDWAPTR),TIOCNJOB(@12)                     0466 01034000
*   MSGSTEP=TIOCSTEP;               /* MV IN STEP NAME               */ 01035000
*                                                                  0467 01036000
         MVC   MSGSTEP(8,SDWAPTR),TIOCSTEP(@12)                    0467 01037000
*/* MUST VALIDATE TIOT ENTRY BEFORE GETTING DDNAME FOR MESSAGE.      */ 01038000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 01039000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 01040000
*/* CHECKED FIRST.                                                   */ 01041000
*                                                                  0468 01042000
*   IF(BLKCTR<BLKREFER)|(BLKCTR=DEBERR)THEN/* DCB/DEB INVALID        */ 01043000
         CH    BLKCTR,@CH00320                                     0468 01044000
         BL    @RT00468                                            0468 01045000
         CH    BLKCTR,@CH01435                                     0468 01046000
         BNE   @RF00468                                            0468 01047000
@RT00468 DS    0H                                                  0469 01048000
*     MSGDDN=NODDNAME;              /* MOVE ASTERISKS INTO BUFFER    */ 01049000
         MVC   MSGDDN(8,SDWAPTR),NODDNAME                          0469 01050000
*   ELSE                            /* ELSE OK TO VALIDATE DEB       */ 01051000
*     DO;                                                          0470 01052000
         B     @RC00468                                            0470 01053000
@RF00468 DS    0H                                                  0471 01054000
*       CALL DEBCHECK;              /* MUST 1ST VALIDATE DEB BY    0471 01055000
*                                      CALLING DEBCHK SUBRTN         */ 01056000
         BAL   @14,DEBCHECK                                        0471 01057000
*       RFY                                                        0472 01058000
*         DEBBASIC BASED(WKASVDEB); /* VALIDATED DEB STORED IN SVRB     01059000
*                                      BY DEBCHECK SUBRTN            */ 01060000
*       IF WKADEBXC=0 THEN          /* IF DEB RET CODE=0,DEB OK      */ 01061000
         CLI   WKADEBXC(RBSECPTR),0                                0473 01062000
         BNE   @RF00473                                            0473 01063000
*         MSGDDN=TIOEDDNM;          /* MV DDNAME INTO GTF BUFFER     */ 01064000
         L     @12,WKASVDEB(,RBSECPTR)                             0474 01065000
         L     @12,DEBAPPAD(,@12)                                  0474 01066000
         L     @12,DEBXTNP(,@12)                                   0474 01067000
         L     @12,DEBXDSAB(,@12)                                  0474 01068000
         L     @12,DSABTIOT(,@12)                                  0474 01069000
         MVC   MSGDDN(8,SDWAPTR),TIOEDDNM(@12)                     0474 01070000
*       ELSE                        /* ELSE ASSIGN DDN ASTERISKS     */ 01071000
*         MSGDDN=NODDNAME;          /* MOVE ASTERISKS INTO BUFFER    */ 01072000
         B     @RC00473                                            0475 01073000
@RF00473 MVC   MSGDDN(8,SDWAPTR),NODDNAME                          0475 01074000
*     END;                                                         0476 01075000
@RC00473 DS    0H                                                  0477 01076000
*   DO;                             /* WTOP MF(E,MESSAGE)            */ 01077000
@RC00468 DS    0H                                                  0478 01078000
*     RFY                                                          0478 01079000
*       GPR01P RSTD;                /* RESTRICT REG 1                */ 01080000
*     GPR01P=ADDR(MESSAGE);         /* ADDRESS CONTROL PROGRAM LIST  */ 01081000
         LA    GPR01P,MESSAGE(,SDWAPTR)                            0479 01082000
*     SVC(35);                      /* ISSUE WTO SVC                 */ 01083000
         SVC   35                                                  0480 01084000
*     RFY                                                          0481 01085000
*       GPR01P UNRSTD;              /* RELEASE REG 1                 */ 01086000
*   END;                            /* WTOP MF(E,MESSAGE)            */ 01087000
*                                   /* ISSUE WTP                     */ 01088000
*RETRYNOW:                                                         0483 01089000
*   ;                               /* RETRY ABEND235-USER ERROR     */ 01090000
RETRYNOW DS    0H                                                  0484 01091000
*   IF GTFLAG=GTOFF THEN            /* PASS GTRACE RC TO       YM4667*/ 01092000
         CLC   GTFLAG(1,SDWAPTR),GTOFF                             0484 01093000
         BNE   @RF00484                                            0484 01094000
*     SDWASR00=0;                   /* RETRY,0= NO OR BAD GTRACE     */ 01095000
         SR    @12,@12                                             0485 01096000
         ST    @12,SDWASR00(,SDWAPTR)                              0485 01097000
*   ELSE                            /* IF GTRACE DIDNT GO            */ 01098000
*     SDWASR00=GTRACEOK;            /* PASS GTRACE RC TO RETRY       */ 01099000
         B     @RC00484                                            0486 01100000
@RF00484 MVC   SDWASR00(4,SDWAPTR),@CF00095                        0486 01101000
*   SDWASR07=BLKCTR;                /* PASS BLKID IN ERROR-RETRY     */ 01102000
@RC00484 ST    BLKCTR,SDWASR07(,SDWAPTR)                           0487 01103000
*   SDWASR08=RBSECPTR;              /* GIVE RETRYRTN SVRB ADDR       */ 01104000
         ST    RBSECPTR,SDWASR08(,SDWAPTR)                         0488 01105000
*   SDWASR09=BASEREG;               /* GIVE RETRY RTN BASE REG       */ 01106000
         ST    BASEREG,SDWASR09(,SDWAPTR)                          0489 01107000
*   DO;                             /* SETRP RETADDR(RETRYRTN)     0490 01108000
*                                      DUMP(NO) RECORD(NO)         0490 01109000
*                                      FRESDWA(YES) RC(4)          0490 01110000
*                                      RETREGS(YES) WKAREA(SDWAPTR)  */ 01111000
*     RESPECIFY                                                    0491 01112000
*      (GPR00P,                                                    0491 01113000
*       GPR01P,                                                    0491 01114000
*       GPR14P,                                                    0491 01115000
*       GPR15P)RSTD;                                               0491 01116000
*     GPR01P=SDWAPTR;                                              0492 01117000
         LR    GPR01P,SDWAPTR                                      0492 01118000
*     GPR01P->SDWARCDE=4;           /* STORE RC INTO SDWA            */ 01119000
         MVI   SDWARCDE(GPR01P),X'04'                              0493 01120000
*     GPR01P->SDWARTYA=ADDR(RETRYRTN);/* SAVE RETRY ADDRESS          */ 01121000
         LA    @12,RETRYRTN                                        0494 01122000
         ST    @12,SDWARTYA(,GPR01P)                               0494 01123000
*     GPR01P->SDWAFREE='1'B;        /* SET FLAG TO FREE SDWA         */ 01124000
*     GPR01P->SDWARCRD='0'B;        /* TURN OFF RECORD INDICATOR     */ 01125000
         OI    SDWAFREE(GPR01P),B'00000100'                        0496 01126000
         NI    SDWARCRD(GPR01P),B'01111111'                        0496 01127000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01128000
         NI    SDWAREQ(GPR01P),B'01111111'                         0497 01129000
*     GPR01P->SDWAUPRG='1'B;        /* TURN ON RETREGS INDICATOR     */ 01130000
         OI    SDWAUPRG(GPR01P),B'00001000'                        0498 01131000
*     RESPECIFY                                                    0499 01132000
*      (GPR00P,                                                    0499 01133000
*       GPR01P,                                                    0499 01134000
*       GPR14P,                                                    0499 01135000
*       GPR15P)UNRSTD;                                             0499 01136000
*   END;                            /* RETRY YM7519                  */ 01137000
*   GOTO RETRTM;                    /* GO TO COMMON RET RT     YM7519*/ 01138000
*                                                                  0501 01139000
         B     RETRTM                                              0501 01140000
*/********************************************************************/ 01141000
*/* THE FOLLOWING ROUTINE IS THE RETRY ROUTINE, ENTERED WHEN A USER  */ 01142000
*/* ERROR IS DETECTED AND SETRP HAS BEEN ISSUED TO GIVE THIS ROUTINE */ 01143000
*/* CONTROL TO ISSUE ABEND 235. THIS PREVENTS REPEATED ENTRY INTO    */ 01144000
*/* THE ESTAE, IGCT005C, BY REMOVING IT LOGICALLY FROM THE QUEUE.    */ 01145000
*/* UPON ENTRY THE SVRB ADDRESS WILL BE IN REG 8, BLKCTR IN REG 7 AND*/ 01146000
*/* THE GTRACE RETURN CODE IN REG 0.                                 */ 01147000
*/********************************************************************/ 01148000
*                                                                  0502 01149000
*RETRYRTN:                                                         0502 01150000
*   ;                               /* RETRY ROUTINE WILL ABEND      */ 01151000
RETRYRTN DS    0H                                                  0503 01152000
*   RFY                                                            0503 01153000
*    (GPR00P,                                                      0503 01154000
*     GPR01P,                                                      0503 01155000
*     GPR14P,                                                      0503 01156000
*     GPR15P)RSTD;                  /* RESTRICT REGS                 */ 01157000
*   RFY                                                            0504 01158000
*     WRKREG RSTD;                  /* RESTRICT SAVE REG       YM4667*/ 01159000
*   WRKREG=GPR00P;                  /* GTF RC IN R0 -SAVE      YM4667*/ 01160000
         LR    WRKREG,GPR00P                                       0505 01161000
*   GEN(ESTAE 0);                   /* REMOVE ESTAE FROM QUEUE       */ 01162000
         ESTAE 0                                                        01163000
*   RETURNCD=WKACLENX;              /* PUT CLEANUP RC IN LO ORDER    */ 01164000
         SR    RETURNCD,RETURNCD                                   0507 01165000
         IC    RETURNCD,WKACLENX(,RBSECPTR)                        0507 01166000
*   RETURNCD=RETURNCD*TOPBYTE;      /* MV RC TO HI-ORDER BYTE        */ 01167000
         SLL   RETURNCD,24                                         0508 01168000
*   IF WRKREG¬=0 THEN               /* IF SW SET IN R0¬=0      YM4667*/ 01169000
         LTR   WRKREG,WRKREG                                       0509 01170000
         BZ    @RF00509                                            0509 01171000
*     RETURNCD=RETURNCD|BLKERR3(BLKCTR);/* PUT REG CODE WITH       0510 01172000
*                                      GTRACE-TAKEN BIT ON INTO R15  */ 01173000
         SR    @12,@12                                             0510 01174000
         IC    @12,BLKERR3-1(BLKCTR)                               0510 01175000
         OR    RETURNCD,@12                                        0510 01176000
*   ELSE                            /* IF SW SET IN R0 IS 0 THEN     */ 01177000
*     RETURNCD=RETURNCD|BLKERR1(BLKCTR);/* EITHER GTRACE WAS NOT   0511 01178000
*                                      TAKEN OR NOT SUCCESSFUL, SO 0511 01179000
*                                      GTRACE-TAKEN BIT OFF IN R 15  */ 01180000
         B     @RC00509                                            0511 01181000
@RF00509 SR    @12,@12                                             0511 01182000
         IC    @12,BLKERR1-1(BLKCTR)                               0511 01183000
         OR    RETURNCD,@12                                        0511 01184000
*   GPR14P=ADDR(SNAPLIST);          /* PASS SNAP LIST TO ABEND       */ 01185000
@RC00509 LA    GPR14P,SNAPLIST                                     0512 01186000
*   GPR01P=ERRUSER;                 /* PASS TO ABEND 235 ABD CODE    */ 01187000
         LA    GPR01P,565                                          0513 01188000
*   GEN REFS(RBGRS2,GPR14P);                                       0514 01189000
        LM  @02,@13,RBGRS2(@08)        LOAD USERS REGISTERS             01190000
        ABEND  (1),DUMP,,SYSTEM,DUMPOPT=(GPR14P)    ABEND USER          01191000
*   RFY                                                            0515 01192000
*    (GPR00P,                                                      0515 01193000
*     GPR01P,                                                      0515 01194000
*     WRKREG,                                                      0515 01195000
*     GPR14P,                                                      0515 01196000
*     GPR15P)UNRSTD;                /*                         YM4667*/ 01197000
*                                                                  0515 01198000
*/********************************************************************/ 01199000
*/*   THIS ROUTINE IS ENTERED IF NO USER ERROR WAS FOUND. A SYSTEM   */ 01200000
*/*   ERROR IS ASSUMED. UPON ENTRY BLKCTR WILL HAVE THE VALUE 7.     */ 01201000
*/*   THE LOCAL LOCK WILL NOT BE HELD UPON ENTRY.                    */ 01202000
*/********************************************************************/ 01203000
*                                                                  0516 01204000
*SYSERRTN:                                                         0516 01205000
*   ;                               /* SYSTEM ERROR                  */ 01206000
SYSERRTN DS    0H                                                  0517 01207000
*   CALL SDUMP;                     /* GO TO TAKE SVC DUMP           */ 01208000
         BAL   @14,SDUMP                                           0517 01209000
*   CALL IGCT105C;                  /* GO TRY TO CLEAN UP            */ 01210000
         L     @15,@CV03373                                        0518 01211000
         BALR  @14,@15                                             0518 01212000
*   RFY                                                            0519 01213000
*     GPR15P RSTD;                  /* RESTRICT FOR CLEANUP RC       */ 01214000
*   IF GPR15P¬=0 THEN               /* IF CLEANRTN RC NOT 0, WAS     */ 01215000
         LTR   GPR15P,GPR15P                                       0520 01216000
         BZ    @RF00520                                            0520 01217000
*     DO;                           /* ERROR IN CLEAN UP             */ 01218000
*       WKACLENX=CLEANRC1(8);       /* SET RC FOR CLEANUP ABEND      */ 01219000
         MVC   WKACLENX(1,RBSECPTR),CLEANRC1+7                     0522 01220000
*       GEN(ESTAE 0);               /* GET RID OF ESTAE              */ 01221000
         ESTAE 0                                                        01222000
*     END;                                                         0524 01223000
*   RFY                                                            0525 01224000
*     GPR15P UNRSTD;                                               0525 01225000
*                                                                  0525 01226000
@RF00520 DS    0H                                                  0526 01227000
*/*  MUST BUILD MESSAGE AND ISSUE WTP DESCRIBING ERROR AS SYSTEM     */ 01228000
*                                                                  0526 01229000
*   MESSAGE=SYSER;                  /* SET UP WTP MESSAGE            */ 01230000
         MVC   MESSAGE(52,SDWAPTR),SYSER                           0526 01231000
*   RFY                                                            0527 01232000
*     WRKREG RSTD;                  /* RESTRICT WORK REGISTER        */ 01233000
*   WRKREG=WKACLENX;                /* USE CLEANUP CODE TO INDEX     */ 01234000
         SR    WRKREG,WRKREG                                       0528 01235000
         IC    WRKREG,WKACLENX(,RBSECPTR)                          0528 01236000
*   RETCOD2=CLEANRC2(WRKREG);       /* MV CLEANUP RC INTO MESSAGE    */ 01237000
         LR    @12,WRKREG                                          0529 01238000
         AR    @12,@12                                             0529 01239000
         LA    @10,CLEANRC2-2(@12)                                 0529 01240000
         MVC   RETCOD2(2,SDWAPTR),0(@10)                           0529 01241000
*   RFY                                                            0530 01242000
*     WRKREG UNRSTD;                                               0530 01243000
*   IF WKADMP04='1'B THEN           /* IF DUMP TAKEN SUCCESSFULLY    */ 01244000
         TM    WKADMP04(RBSECPTR),B'00001000'                      0531 01245000
         BNO   @RF00531                                            0531 01246000
*     RETCOD=DUMPRC(1);             /* SET RETURN CODE=4             */ 01247000
         MVC   RETCOD(2,SDWAPTR),DUMPRC                            0532 01248000
*   IF WKADMP08='1'B THEN           /* IF PARTIAL DUMP WAS TAKEN     */ 01249000
@RF00531 TM    WKADMP08(RBSECPTR),B'00010000'                      0533 01250000
         BNO   @RF00533                                            0533 01251000
*     RETCOD=DUMPRC(2);             /* SET RETURN CODE=8             */ 01252000
         MVC   RETCOD(2,SDWAPTR),DUMPRC+2                          0534 01253000
*   IF WKADMP0C='1'B THEN           /* IF DUMP WAS UNSUCCESSFUL      */ 01254000
@RF00533 TM    WKADMP0C(RBSECPTR),B'00100000'                      0535 01255000
         BNO   @RF00535                                            0535 01256000
*     RETCOD=DUMPRC(3);             /* SET RETURN CODE=C             */ 01257000
         MVC   RETCOD(2,SDWAPTR),DUMPRC+4                          0536 01258000
*   MSGJOB=TIOCNJOB;                /* MV IN JOB NAME                */ 01259000
@RF00535 L     @12,PSATOLD                                         0537 01260000
         L     @12,TCBTIO(,@12)                                    0537 01261000
         MVC   MSGJOB(8,SDWAPTR),TIOCNJOB(@12)                     0537 01262000
*   MSGSTEP=TIOCSTEP;               /* MV IN STEP NAME               */ 01263000
*                                                                  0538 01264000
         MVC   MSGSTEP(8,SDWAPTR),TIOCSTEP(@12)                    0538 01265000
*/* MUST VALIDATE THE TIOT ENTRY BEFORE GETTING DDNAME FOR MESSAGE.  */ 01266000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 01267000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 01268000
*/* CHECKED FIRST. IT MAY HAVE BEEN FREED AFTER ITS VALIDATION.      */ 01269000
*                                                                  0539 01270000
*   CALL DEBCHECK;                  /* GO VALIDATE THE DEB           */ 01271000
         BAL   @14,DEBCHECK                                        0539 01272000
*   RFY                                                            0540 01273000
*     DEBBASIC BASED(WKASVDEB);     /* VALIDATED DEB STORED IN SVRB     01274000
*                                      BY DEBCHECK SUBROUTINE        */ 01275000
*   IF WKADEBXC=0 THEN              /* IF DEB RET CODE=0,DEB OK      */ 01276000
         CLI   WKADEBXC(RBSECPTR),0                                0541 01277000
         BNE   @RF00541                                            0541 01278000
*     MSGDDN=TIOEDDNM;              /* MV DDNAME INTO GTF BUFFER     */ 01279000
         L     @12,WKASVDEB(,RBSECPTR)                             0542 01280000
         L     @12,DEBAPPAD(,@12)                                  0542 01281000
         L     @12,DEBXTNP(,@12)                                   0542 01282000
         L     @12,DEBXDSAB(,@12)                                  0542 01283000
         L     @12,DSABTIOT(,@12)                                  0542 01284000
         MVC   MSGDDN(8,SDWAPTR),TIOEDDNM(@12)                     0542 01285000
*   ELSE                            /* ELSE ASSIGN DDN ASTERISKS     */ 01286000
*     MSGDDN=NODDNAME;              /* MOVE ASTERISKS INTO BUFFER    */ 01287000
         B     @RC00541                                            0543 01288000
@RF00541 MVC   MSGDDN(8,SDWAPTR),NODDNAME                          0543 01289000
*   DO;                             /* WTOP MF(E,MESSAGE)            */ 01290000
@RC00541 DS    0H                                                  0545 01291000
*     RFY                                                          0545 01292000
*       GPR01P RSTD;                /* RESTRICT REG 1                */ 01293000
*     GPR01P=ADDR(MESSAGE);         /* ADDRESS CONTROL PROGRAM LIST  */ 01294000
         LA    GPR01P,MESSAGE(,SDWAPTR)                            0546 01295000
*     SVC(35);                      /* ISSUE WTO SVC                 */ 01296000
         SVC   35                                                  0547 01297000
*     RFY                                                          0548 01298000
*       GPR01P UNRSTD;              /* RELEASE REG 1                 */ 01299000
*   END;                            /* WTOP MF(E,MESSAGE)            */ 01300000
*                                   /* ISSUE WTP MESSAGE             */ 01301000
*RECORD1:                                                          0550 01302000
*   CALL RECORD;                    /* GO SET UP RECORDING AREA      */ 01303000
RECORD1  BAL   @14,RECORD                                          0550 01304000
*   DO;                             /* SETRP RECORD(YES) DUMP(NO)  0551 01305000
*                                      COMPCOD(ERRSYS)             0551 01306000
*                                      WKAREA(SDWAPTR)               */ 01307000
*     RESPECIFY                                                    0552 01308000
*      (GPR00P,                                                    0552 01309000
*       GPR01P,                                                    0552 01310000
*       GPR14P,                                                    0552 01311000
*       GPR15P)RSTD;                                               0552 01312000
*     GPR01P=SDWAPTR;                                              0553 01313000
         LR    GPR01P,SDWAPTR                                      0553 01314000
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */ 01315000
         MVI   SDWARCDE(GPR01P),X'00'                              0554 01316000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 01317000
         OI    SDWARCRD(GPR01P),B'10000000'                        0555 01318000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01319000
         NI    SDWAREQ(GPR01P),B'01111111'                         0556 01320000
*     GPR14P=ERRSYS;                /* ACCESS COMPLETION CODE        */ 01321000
         SR    GPR14P,GPR14P                                       0557 01322000
         ICM   GPR14P,7,ERRSYS                                     0557 01323000
*     GPR01P->SDWACMPC=GPR14P;      /* STORE COMPLETION CODE         */ 01324000
         STCM  GPR14P,7,SDWACMPC(GPR01P)                           0558 01325000
*     RESPECIFY                                                    0559 01326000
*      (GPR00P,                                                    0559 01327000
*       GPR01P,                                                    0559 01328000
*       GPR14P,                                                    0559 01329000
*       GPR15P)UNRSTD;                                             0559 01330000
*   END;                            /* RECORD FOR RTM                */ 01331000
*   GOTO RETRTM;                    /* GO TO COMMON RET        YM7519*/ 01332000
*                                                                  0561 01333000
         B     RETRTM                                              0561 01334000
*/********************************************************************/ 01335000
*/*  THE FOLLOWING ROUTINE IS GIVEN CONTROL BY MACRO IGGSTART WHEN IT*/ 01336000
*/*  IS DETERMINED THAT A PREVIOUS RECOVERY ROUTINE FAILED AND NO SVC*/ 01337000
*/*  DUMP WAS TAKEN. THIS ROUTINE CALLS SDUMP RTN TO TAKE AN SVC     */ 01338000
*/*  DUMP AND THEN TRANSFERS CONTROL TO THE CLEANRTN.                */ 01339000
*/********************************************************************/ 01340000
*                                                                  0562 01341000
*DUMPRTN:                                                          0562 01342000
*   ;                               /* RTN TO GET SVC DUMP & RET     */ 01343000
DUMPRTN  DS    0H                                                  0563 01344000
*   CALL SDUMP;                     /* GO TO TAKE SVC DUMP           */ 01345000
*                                                                  0563 01346000
         BAL   @14,SDUMP                                           0563 01347000
*/********************************************************************/ 01348000
*/*  THIS ROUTINE IS GIVEN CONTROL BY MACRO IGGSTART OR DUMPRTN WHEN */ 01349000
*/*  AN ERROR OCCURRED ON OTHER THAN THE ESTAES RB LEVEL OR AN ERROR */ 01350000
*/*  OTHER THAN A PROGRAM CHECK OCCURRED IN THE SVC.                 */ 01351000
*/********************************************************************/ 01352000
*                                                                  0564 01353000
*CLEANRTN:                                                         0564 01354000
*   ;                               /* CLEAN UP AND RETURN           */ 01355000
CLEANRTN DS    0H                                                  0565 01356000
*   BLKCTR=PERCERR;                 /* INITIALIZE BLKID REG TO 10, 0565 01357000
*                                      INDICATING INITIAL BRANCH TO     01358000
*                                      DUMPRTN/CLEANRTN,NOT USER ERR */ 01359000
*                                                                  0565 01360000
         LA    BLKCTR,10                                           0565 01361000
*/*  BEFORE GOING TO THE CLEANUP ROUTINE TO CLEAN UP RESOURCES       */ 01362000
*/*  MUST SET UP DCBPTR WHICH WILL BE REQUIRED BY DEBCHECK(SUBROUTINE*/ 01363000
*/*  CALLED BY IGCT105C).IF RELEX REQUEST, DCBPTR IS ALREADY SET UP  */ 01364000
*/*  BECAUSE IF WAS PASSED BY USER. IF NOT RELEX MUST GET DCB OUT    */ 01365000
*/*  OF IOB WHICH WAS PASSED. THE IOB MUST BE VALIDATED FIRST.       */ 01366000
*/*  THE DCB WILL NOT BE VALIDATED. IF IN ERROR, THE 2ND LEVEL       */ 01367000
*/*  ESTAE WILL RECOVER.                                             */ 01368000
*                                                                  0566 01369000
*IOBCHCK:                                                          0566 01370000
*   ;                               /* VALIDATE THE PASSED IOB       */ 01371000
IOBCHCK  DS    0H                                                  0567 01372000
*   IF RBGRS1<0 THEN                /* IF NOT RELEX REQUEST MUST     */ 01373000
         L     @12,RBGRS1(,RBSECPTR)                               0567 01374000
         LTR   @12,@12                                             0567 01375000
         BNM   @RF00567                                            0567 01376000
*     DO;                           /* VALIDATE PASSED IOB           */ 01377000
*       RFY                                                        0569 01378000
*        (IOBSTPTR,                                                0569 01379000
*         GPR01P,                                                  0569 01380000
*         GPR02P,                                                  0569 01381000
*         GPR04P)RSTD;                                             0569 01382000
*       GPR04P=(ADDR(RBLINK->RBOPSW(2)))-KEYOFFS;/* ADDR OF KEY-28   */ 01383000
         L     GPR04P,RBLINK(,RBSECPTR)                            0570 01384000
         LA    GPR04P,RBOPSW+1(,GPR04P)                            0570 01385000
         SH    GPR04P,@CH02467                                     0570 01386000
*       IOBSTPTR=ABS(RBGRS1);       /* PUT IOB TO CHK IN BASE REG    */ 01387000
         LR    IOBSTPTR,@12                                        0571 01388000
         LPR   IOBSTPTR,IOBSTPTR                                   0571 01389000
*       RFY                                                        0572 01390000
*         IOBSTDRD BASED(IOBSTPTR); /* BASE IOB ON COMPLEMENT OF REG    01391000
*                                      1 PASSED TO SVC 53            */ 01392000
*       GPR01P=ADDR(IOBSTDRD);      /* BEGINNING OF IOB PROPER       */ 01393000
         LR    GPR01P,IOBSTPTR                                     0573 01394000
*       GPR02P=ADDR(IOBDPLAD)-1;    /* END ADDR THROUGH IOB SIZE   0574 01395000
*                                      ENOUGH TO VALIDATE - INCLUDES    01396000
*                                      DCBPTR ADDR.                  */ 01397000
         LA    GPR02P,IOBDPLAD(,IOBSTPTR)                          0574 01398000
         BCTR  GPR02P,0                                            0574 01399000
*       WKACLENX=CLEANRC1(7);       /* INITIALIZE CLEANUP IF ERR     */ 01400000
         MVC   WKACLENX(1,RBSECPTR),CLEANRC1+6                     0575 01401000
*       CALL CVT0VL01;              /* VALIDATE 1ST PART OF IOB      */ 01402000
         L     @12,CVTPTR                                          0576 01403000
         L     @15,CVT0VL01(,@12)                                  0576 01404000
         BALR  @14,@15                                             0576 01405000
*       BC(7,RECORD2);              /* IF ERROR,GO TO RECORD RTN     */ 01406000
         BC    7,RECORD2                                           0577 01407000
*       DCBPTR=IOBDCBPT;            /* PICK UP DCB PTR               */ 01408000
         L     DCBPTR,IOBDCBPT(,IOBSTPTR)                          0578 01409000
*       RFY                                                        0579 01410000
*        (IOBSTPTR,                                                0579 01411000
*         GPR01P,                                                  0579 01412000
*         GPR02P,                                                  0579 01413000
*         GPR04P)UNRSTD;                                           0579 01414000
*     END;                                                         0580 01415000
*   CALL IGCT105C;                  /* GO TO CLEAN UP RESOURCES      */ 01416000
@RF00567 L     @15,@CV03373                                        0581 01417000
         BALR  @14,@15                                             0581 01418000
*   RFY                                                            0582 01419000
*     GPR15P RSTD;                  /* RESTRICT FOR CLEANUP RC       */ 01420000
*   IF GPR15P¬=0 THEN               /* IF CLEANRTN RC NOT 0, WAS     */ 01421000
         LTR   GPR15P,GPR15P                                       0583 01422000
         BZ    @RF00583                                            0583 01423000
*     DO;                           /* ERROR IN CLEAN UP             */ 01424000
*       WKACLENX=CLEANRC1(8);       /* SET RC FOR CLEANUP ABEND      */ 01425000
         MVC   WKACLENX(1,RBSECPTR),CLEANRC1+7                     0585 01426000
*       GEN(ESTAE 0);               /* GET RID OF ESTAE              */ 01427000
         ESTAE 0                                                        01428000
*     END;                                                         0587 01429000
*   RFY                                                            0588 01430000
*     GPR15P UNRSTD;                                               0588 01431000
@RF00583 DS    0H                                                  0589 01432000
*RECORD2:                                                          0589 01433000
*   CALL RECORD;                    /* GO SET UP RECORDING AREA      */ 01434000
RECORD2  BAL   @14,RECORD                                          0589 01435000
*   DO;                             /* SETRP RECORD(YES) DUMP(NO)  0590 01436000
*                                      WKAREA(SDWAPTR)               */ 01437000
*     RESPECIFY                                                    0591 01438000
*      (GPR00P,                                                    0591 01439000
*       GPR01P,                                                    0591 01440000
*       GPR14P,                                                    0591 01441000
*       GPR15P)RSTD;                                               0591 01442000
*     GPR01P=SDWAPTR;                                              0592 01443000
         LR    GPR01P,SDWAPTR                                      0592 01444000
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */ 01445000
         MVI   SDWARCDE(GPR01P),X'00'                              0593 01446000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 01447000
         OI    SDWARCRD(GPR01P),B'10000000'                        0594 01448000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01449000
         NI    SDWAREQ(GPR01P),B'01111111'                         0595 01450000
*     RESPECIFY                                                    0596 01451000
*      (GPR00P,                                                    0596 01452000
*       GPR01P,                                                    0596 01453000
*       GPR14P,                                                    0596 01454000
*       GPR15P)UNRSTD;                                             0596 01455000
*   END;                            /* REC ON LOGREC                 */ 01456000
*   GOTO RETRTM;                    /* GO TO COMMON RET        YM7519*/ 01457000
         B     RETRTM                                              0598 01458000
*                                                                  0599 01459000
*/********************************************************************/ 01460000
*/*                         SUBROUTINES                              */ 01461000
*/********************************************************************/ 01462000
*/********************************************************************/ 01463000
*/*  THE FOLLOWING SUBROUTINE VALIDITY CHECKS THE DEB. A BRANCH ENTRY*/ 01464000
*/*  IS TAKEN WHICH REQUIRES THAT THE LOCAL LOCK BE HELD. INPUT TO   */ 01465000
*/*  DEBCHK IS AS FOLLOWS:                                           */ 01466000
*/*                           REGISTER 1 - DEB ADDRESS               */ 01467000
*/*                           REGISTER 10 - TCB ADDRESS              */ 01468000
*/*                           REGISTER 14 - RETURN ADDRESS           */ 01469000
*/*                           REGISTER 15 - DEBCHK ROUTINE ADDRESS   */ 01470000
*/*  DEBCHK RETURNS TO 4 BYTES PAST REGISTER 14 IF AN ERROR OCCURS.  */ 01471000
*/*  REGISTER 15 WILL HAVE 4 IF THERE IS AN ERROR. REGISTERS 1-14    */ 01472000
*/*  UPON ENTRY TO THIS SUBROUTINE ARE SAVED, AND RESTORED UPON EXIT.*/ 01473000
*/*  INPUT TO THIS ROUTINE ARE: THE DCB ADDRESS IN DCBPTR(R6), SDWA  */ 01474000
*/*  ADDRESS IN SDWAPTR(R5) AND THE SVRB ADDRESS IN RBSECPTR(R8).    */ 01475000
*/*  THE LOCK BIT IS ON WHEN ENTRY IS FROM THE USERRTN OR ABEND RTN. */ 01476000
*/*  WHEN THIS BIT IS ON THIS RTN ASSUMES THE LOCK IS BEING HELD.    */ 01477000
*/*  THE DEB ADDRESS AND DEBCHK RETURN CODE ARE PASSED TO THE CALLING*/ 01478000
*/*  ROUTINE IN THE SVRB.                                            */ 01479000
*/********************************************************************/ 01480000
*                                                                  0599 01481000
*DEBCHECK:                                                         0599 01482000
*   PROC OPTIONS(NOSAVE);           /* DEBCHECK SUBROUTINE           */ 01483000
DEBCHECK DS    0H                                                  0600 01484000
*   RFY                                                            0600 01485000
*    (GPR01P,                                                      0600 01486000
*     GPR14P)RSTD;                                                 0600 01487000
*   STM(GPR01P,GPR14P,SAVESDWA);    /* SAVE REGS 1-14 IN SDWA        */ 01488000
         STM   GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0601 01489000
*   RFY                                                            0602 01490000
*    (GPR01P,                                                      0602 01491000
*     GPR14P)UNRSTD;                                               0602 01492000
*   IF WKALOCK='0'B THEN            /* IF LOCK NOT ON, GET LOCK      */ 01493000
         TM    WKALOCK(RBSECPTR),B'01000000'                       0603 01494000
         BNZ   @RF00603                                            0603 01495000
*     DO;                           /* SOME CALLERS DONT HAVE LCK    */ 01496000
*                                                                  0604 01497000
*/*           GET THE LOCAL LOCK                                     */ 01498000
*                                                                  0605 01499000
*DEBLOCK:                                                          0605 01500000
*       ;                           /* GET LOCAL LOCK FOR DEBCHK     */ 01501000
DEBLOCK  DS    0H                                                  0606 01502000
*       DO;                         /* SETLOCK (OBTAIN) MODE(UNCOND)    01503000
*                                      TYPE(LOCAL) RELATED(DEBDCB,IGC   01504000
*                                      T005C,(DEBFREE))              */ 01505000
*         RFY                                                      0607 01506000
*          (GPR11P,                                                0607 01507000
*           GPR12P,                                                0607 01508000
*           GPR13P,                                                0607 01509000
*           GPR14P)RSTD;                                           0607 01510000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0608 01511000
*                                      TABLE.                        */ 01512000
         L     GPR13P,PSALITA                                      0608 01513000
*         GEN(LM GPR11P,GPR13P,576(GPR13P));/* LOAD LOCKWORD, CLHT 0609 01514000
*                                      AND ENTRY ADRS.               */ 01515000
         LM GPR11P,GPR13P,576(GPR13P)                                   01516000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 01517000
         BALR GPR14P,GPR13P                                             01518000
*         RFY                                                      0611 01519000
*          (GPR11P,                                                0611 01520000
*           GPR12P,                                                0611 01521000
*           GPR13P,                                                0611 01522000
*           GPR14P)UNRSTD;                                         0611 01523000
*       END;                        /* SETLOCK (OBTAIN) MODE(UNCOND)    01524000
*                                      TYPE(LOCAL) RELATED(DEBDCB,IGC   01525000
*                                      T005C,(DEBFREE))              */ 01526000
*                                   /* GET LOCAL LOCK                */ 01527000
*     END;                                                         0613 01528000
*                                                                  0613 01529000
*/*   GO TO DEBCHK ROUTINE - HOWEVER, SINCE THERE IS ONE FIELD IN    */ 01530000
*/*   THE DEB WHICH DEBCHK ASSUMES IS IN KEY 5 CORE (DEBTBLOF) MUST  */ 01531000
*/*   FIRST PASS THIS FIELD TO THE SYSTEM VALIDITY CHECK ROUTINE TO  */ 01532000
*/*   ENSURE ITS CORE LOCATION.                                      */ 01533000
*                                                                  0614 01534000
*   RFY                                                            0614 01535000
*    (GPR01P,                                                      0614 01536000
*     GPR02P,                                                      0614 01537000
*     GPR04P,                                                      0614 01538000
*     GPR10P,                                                      0614 01539000
*     GPR14P,                                                      0614 01540000
*     GPR15P)RSTD;                                                 0614 01541000
@RF00603 DS    0H                                                  0615 01542000
*   GPR01P=DCBDEBA;                 /* PUT DEB ADDR IN R1            */ 01543000
         SR    GPR01P,GPR01P                                       0615 01544000
         ICM   GPR01P,7,DCBDEBA+40(DCBPTR)                         0615 01545000
*   GPR01P=GPR01P-LENGTH(DEBTBLOF); /* GET ADDR OF FIELD       YM5738*/ 01546000
         BCTR  GPR01P,0                                            0616 01547000
         BCTR  GPR01P,0                                            0616 01548000
*   GPR02P=GPR01P+1;                /* END OF FIELD            YM5738*/ 01549000
         LA    GPR02P,1                                            0617 01550000
         AR    GPR02P,GPR01P                                       0617 01551000
*   GPR04P=ADDR(DEBKEY)-KEYOFFS;    /* ADDR OF DEB KEY=5       YM5738*/ 01552000
         LA    GPR04P,DEBKEY                                       0618 01553000
         SH    GPR04P,@CH02467                                     0618 01554000
*   CALL CVT0VL00;                  /* VALIDITY CHECK RTN      YM5738*/ 01555000
         L     @12,CVTPTR                                          0619 01556000
         L     @15,CVT0VL00(,@12)                                  0619 01557000
         BALR  @14,@15                                             0619 01558000
*   BC(8,GOCHKDEB);                 /* DEBTBLOP IS GOOD        YM5738*/ 01559000
         BC    8,GOCHKDEB                                          0620 01560000
*BADDEB:                                                           0621 01561000
*   ;                               /* DEBTBLOP IS BAD         YM5738*/ 01562000
BADDEB   DS    0H                                                  0622 01563000
*   WKASVDEB=GPR01P;                /* PUT INVALID FIELD ADDR WHERE     01564000
*                                      DEB ADDR SHOULD GO      YM5738*/ 01565000
         ST    GPR01P,WKASVDEB(,RBSECPTR)                          0622 01566000
*   WKADEBXC=DEBBAD;                /* RC=4 -INVALID DEB       YM5738*/ 01567000
         MVI   WKADEBXC(RBSECPTR),X'04'                            0623 01568000
*   GOTO CHKLOCK;                   /* GO CHECK LOCK           YM5738*/ 01569000
         B     CHKLOCK                                             0624 01570000
*   RFY                                                            0625 01571000
*    (GPR02P,                                                      0625 01572000
*     GPR04P)UNRSTD;                /* RELEASE REGS 2,4        YM5738*/ 01573000
*                                                                  0625 01574000
*/*      READY TO GO TO DEBCHK ROUTINE                               */ 01575000
*                                                                  0626 01576000
*GOCHKDEB:                                                         0626 01577000
*   ;                               /* GO TO DEBCHK ROUT       YM5738*/ 01578000
GOCHKDEB DS    0H                                                  0627 01579000
*   GPR01P=GPR01P+LENGTH(DEBTBLOF); /* GET DEB ADDR IN R1      YM5738*/ 01580000
         AH    GPR01P,@CH00114                                     0627 01581000
*   GPR10P=PSATOLD;                 /* PUT TCB ADDR IN R10           */ 01582000
         L     GPR10P,PSATOLD                                      0628 01583000
*   CALL CVTDEBVR;                  /* BRANCH ENTRY TO DEBCHK        */ 01584000
         L     @12,CVTPTR                                          0629 01585000
         L     @12,CVTEXT2(,@12)                                   0629 01586000
         L     @15,CVTDEBVR(,@12)                                  0629 01587000
         BALR  @14,@15                                             0629 01588000
*   GEN(NOP 0);                     /* USE UP 4 BYTES ON RETURN      */ 01589000
         NOP 0                                                          01590000
*   WKASVDEB=GPR01P;                /* SAVE VALIDATED DEB ADDR IN  0631 01591000
*                                      SVRB WORKAREA                 */ 01592000
         ST    GPR01P,WKASVDEB(,RBSECPTR)                          0631 01593000
*   WKADEBXC=RETURNCD;              /* RC PASSED IN R15 BY DEBCHK    */ 01594000
         STC   RETURNCD,WKADEBXC(,RBSECPTR)                        0632 01595000
*   RFY                                                            0633 01596000
*     DEBBASIC BASED(WKASVDEB);     /* EST ADDRESSABILITY TO DEB     */ 01597000
*   IF RETURNCD=0&DEBDCBB¬=DCBPTR THEN/* IF DEB VALID THEN ENSURE IS    01598000
*                                      POINTS TO DCB                 */ 01599000
         LTR   RETURNCD,RETURNCD                                   0634 01600000
         BNZ   @RF00634                                            0634 01601000
         L     @12,WKASVDEB(,RBSECPTR)                             0634 01602000
         SR    @04,@04                                             0634 01603000
         ICM   @04,7,DEBDCBB(@12)                                  0634 01604000
         CR    DCBPTR,@04                                          0634 01605000
         BE    @RF00634                                            0634 01606000
*     WKADEBXC=DEBBAD;              /* NO,PUT IN RC=4,INVALID DEB    */ 01607000
         MVI   WKADEBXC(RBSECPTR),X'04'                            0635 01608000
*CHKLOCK:                                                          0636 01609000
*   ;                               /* SHOULD LOCK BE FREE     YM5738*/ 01610000
@RF00634 DS    0H                                                  0636 01611000
CHKLOCK  DS    0H                                                  0637 01612000
*   IF WKALOCK='0'B THEN            /* IF LOCK SW NOT ON, THEN       */ 01613000
         TM    WKALOCK(RBSECPTR),B'01000000'                       0637 01614000
         BNZ   @RF00637                                            0637 01615000
*     DO;                           /* MUST FREE LOCK GOTTEN HERE    */ 01616000
*                                                                  0638 01617000
*/*                   RELEASE THE LOCAL LOCK                         */ 01618000
*                                                                  0639 01619000
*DEBFREE:                                                          0639 01620000
*       ;                           /* RELEASE LOCAL LOCK -DEBCHK    */ 01621000
DEBFREE  DS    0H                                                  0640 01622000
*       DO;                         /* SETLOCK (RELEASE) TYPE(LOCAL)    01623000
*                                      RELATED(DEBDCB,IGCT005C,(DEBLO   01624000
*                                      CK))                          */ 01625000
*         RFY                                                      0641 01626000
*          (GPR11P,                                                0641 01627000
*           GPR12P,                                                0641 01628000
*           GPR13P,                                                0641 01629000
*           GPR14P)RSTD;                                           0641 01630000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0642 01631000
*                                      TABLE.                        */ 01632000
         L     GPR13P,PSALITA                                      0642 01633000
*         GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT 0643 01634000
*                                      AND ENTRY ADRS.               */ 01635000
         LM GPR11P,GPR13P,588(GPR13P)                                   01636000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 01637000
         BALR GPR14P,GPR13P                                             01638000
*         RFY                                                      0645 01639000
*          (GPR11P,                                                0645 01640000
*           GPR12P,                                                0645 01641000
*           GPR13P,                                                0645 01642000
*           GPR14P)UNRSTD;                                         0645 01643000
*       END;                        /* SETLOCK (RELEASE) TYPE(LOCAL)    01644000
*                                      RELATED(DEBDCB,IGCT005C,(DEBLO   01645000
*                                      CK))                          */ 01646000
*                                   /* FREE LOCAL LOCK               */ 01647000
*     END;                                                         0647 01648000
*   RFY                                                            0648 01649000
*     GPR14P RSTD;                                                 0648 01650000
@RF00637 DS    0H                                                  0649 01651000
*   LM(GPR01P,GPR14P,SAVESDWA);     /* RESTORE REGS 1-14             */ 01652000
         LM    GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0649 01653000
*   WKALOCK='0'B;                   /* ZERO LOCK SW IN ALL CASES     */ 01654000
         NI    WKALOCK(RBSECPTR),B'10111111'                       0650 01655000
*   END DEBCHECK;                                                  0651 01656000
@EL00002 DS    0H                                                  0651 01657000
@EF00002 DS    0H                                                  0651 01658000
@ER00002 BR    @14                                                 0651 01659000
*   RFY                                                            0652 01660000
*    (GPR01P,                                                      0652 01661000
*     GPR10P,                                                      0652 01662000
*     GPR14P,                                                      0652 01663000
*     GPR15P)UNRSTD;                                               0652 01664000
*                                                                  0653 01665000
*/********************************************************************/ 01666000
*/* INPUT TO THIS ROUTINE ARE: THE DCB ADDRESS IN DCBPTR(R6), SDWA   */ 01667000
*/* ADDRESS IN SDWAPTR(R5) AND THE SVRB ADDRESS IN RBSECPTR(R8).     */ 01668000
*/* THE LOCK BIT IS ON WHEN ENTRY IS FROM THE USERRTN OR ABEND RTN.  */ 01669000
*/* WHEN THIS BIT IS ON THIS RTN ASSUMES THE LOCK IS BEING HELD.     */ 01670000
*/* THE FOLLOWING SUBROUTINE RECEIVES CONTROL FROM THE DUMPRTN, THE  */ 01671000
*/* SYSERRTN, AND THE 2ND LEVEL ESTAE TO TAKE AN SVC DUMP. A HEADER  */ 01672000
*/* IS BUILT IN THE SDWA TO IDENTIFY THE DUMP. THE ONLY REGS CHANGED */ 01673000
*/* BY THIS SUBROUTINE ARE 0,1 AND 15. UPON ENTRY THE LOCAL LOCK     */ 01674000
*/* IS NOT HELD.  THE SDUMP SVC WILL RETURN A RETURN CODE IN R15,    */ 01675000
*/* THE VALUES FOR WHICH ARE AS FOLLOWS:                             */ 01676000
*/*                                00 - SDUMP SUCCESSFUL             */ 01677000
*/*                                04 - PARTIAL SDUMP TAKEN          */ 01678000
*/*                                08 - SDUMP UNSUCCESSFUL           */ 01679000
*/* THE SDUMP RETURN CODE PRESENTED TO THE USER IS THIS VALUE +4.    */ 01680000
*/*                                04 - SDUMP SUCCESSFUL             */ 01681000
*/*                                08 - PARTIAL SDUMP TAKEN          */ 01682000
*/*                                0C - SDUMP UNSUCCESSFUL           */ 01683000
*/* A BIT IS SET IN THE SVRB WORKAREA TO IDENTIFY THE RETURN CODE.   */ 01684000
*/********************************************************************/ 01685000
*                                                                  0653 01686000
*SDUMP:                                                            0653 01687000
*   PROC OPTIONS(NOSAVE);           /* TAKE AN SVC DUMP              */ 01688000
SDUMP    DS    0H                                                  0654 01689000
*   RFY                                                            0654 01690000
*    (GPR00P,                                                      0654 01691000
*     GPR01P,                                                      0654 01692000
*     GPR14P,                                                      0654 01693000
*     GPR15P)RSTD;                                                 0654 01694000
*   HEADER=HEADING;                 /* SET UP HEADER                 */ 01695000
         MVC   HEADER(27,SDWAPTR),HEADING                          0655 01696000
*   JOBNAME=TIOCNJOB;               /* JOB NAME                      */ 01697000
         L     @12,PSATOLD                                         0656 01698000
         L     @12,TCBTIO(,@12)                                    0656 01699000
         MVC   JOBNAME(8,SDWAPTR),TIOCNJOB(@12)                    0656 01700000
*   STEPNAME=TIOCSTEP;              /* STEP NAME                     */ 01701000
         MVC   STEPNAME(8,SDWAPTR),TIOCSTEP(@12)                   0657 01702000
*   SDUMPLST=DUMPLIST;              /* MOVE LIST FORM TO VAR.AREA    */ 01703000
         MVC   SDUMPLST(24,SDWAPTR),DUMPLIST                       0658 01704000
*   GPR01P=ADDR(SDUMPLST);          /* PUT DUMP LIST ADDR IN REG     */ 01705000
         LA    GPR01P,SDUMPLST(,SDWAPTR)                           0659 01706000
*   GEN REFS(HEADER,GPR01P)SETS(SDUMPLST,GPR00P);                  0660 01707000
        SDUMP HDRAD=HEADER(SDWAPTR),MF=(E,(1))  TAKE SVC DUMP           01708000
*   SDWAEAS='1'B;                   /* SET DUMP TAKEN FLAG           */ 01709000
         OI    SDWAEAS(SDWAPTR),B'00001000'                        0661 01710000
*   IF RETURNCD=SDUMPOK THEN        /* IF SDUMP SUCCESSFUL           */ 01711000
         LTR   RETURNCD,RETURNCD                                   0662 01712000
         BNZ   @RF00662                                            0662 01713000
*     WKADMP04='1'B;                /* SAVE RETURN CODE = 4          */ 01714000
         OI    WKADMP04(RBSECPTR),B'00001000'                      0663 01715000
*   IF RETURNCD=SDUMPART THEN       /* IF PARTIAL SDUMP TAKEN        */ 01716000
@RF00662 CH    RETURNCD,@CH00095                                   0664 01717000
         BNE   @RF00664                                            0664 01718000
*     WKADMP08='1'B;                /* SAVE RETURN CODE = 8          */ 01719000
         OI    WKADMP08(RBSECPTR),B'00010000'                      0665 01720000
*   IF RETURNCD=SDUMPBAD THEN       /* IF SDUMP UNSUCCESSFUL         */ 01721000
@RF00664 CH    RETURNCD,@CH00048                                   0666 01722000
         BNE   @RF00666                                            0666 01723000
*     WKADMP0C='1'B;                /* SAVE RETURN CODE = C          */ 01724000
         OI    WKADMP0C(RBSECPTR),B'00100000'                      0667 01725000
*   END SDUMP;                      /* RETURN TO MAIN ROUTINE        */ 01726000
@EL00003 DS    0H                                                  0668 01727000
@EF00003 DS    0H                                                  0668 01728000
@ER00003 BR    @14                                                 0668 01729000
*   RFY                                                            0669 01730000
*    (GPR00P,                                                      0669 01731000
*     GPR01P,                                                      0669 01732000
*     GPR14P,                                                      0669 01733000
*     GPR15P)UNRSTD;                                               0669 01734000
*                                                                  0670 01735000
*/********************************************************************/ 01736000
*/*  THE FOLLOWING SUBROUTINE IS CALLED BY THE SYSERRTN AND THE      */ 01737000
*/*  CLEANRTN  TO SET UP THE SDWA WHEN A SYSTEM ERROR HAS BEEN       */ 01738000
*/*  DETECTED. THE FOLLOWING RECORDING INFORMATION WILL BE PUT IN    */ 01739000
*/*  THE VARIABLE PORTION OF THE SDWA (FROM WHERE RTM WILL GET IT TO */ 01740000
*/*  WRT ON SYS1.LOGREC):  SVC AUDIT TRAIL BYTE                      */ 01741000
*/*                        RETURN CODE FROM CLEANRTN                 */ 01742000
*/*                        RETURN CODE FROM SDUMP                    */ 01743000
*/*                        REGISTERS 0 AND 1 AT TIME SVC ISSUED      */ 01744000
*/*                        RB OLD PSW CONTAINING THE ADDRESS+2 FROM  */ 01745000
*/*                           WHERE THE SVC WAS ISSUED               */ 01746000
*/*                        OLD ABEND CODE IF PERCOLATED ERROR        */ 01747000
*/*  THE ONLY REGISTER CHANGED BY THIS SUBROUTINE IS REG 1.          */ 01748000
*/*  THE LOCAL LOCK IS NOT HELD UPON ENTRY.                          */ 01749000
*/********************************************************************/ 01750000
*                                                                  0670 01751000
*RECORD:                                                           0670 01752000
*   PROC OPTIONS(NOSAVE);           /* PUT SYSTEM INFO IN SDWA       */ 01753000
RECORD   DS    0H                                                  0671 01754000
*   RFY                                                            0671 01755000
*     GPR14P RSTD;                  /* RESTRICT RETURN ADDR          */ 01756000
*   RECAUDIT=WKATRALX;              /* MV AUDIT TRAIL BIT IN SDWA    */ 01757000
         MVC   RECAUDIT(1,SDWAPTR),WKATRALX(RBSECPTR)              0672 01758000
*   SDWAURAL=LENGTH(RECORDWK);      /* INIT LEN OF RECORDING INFO    */ 01759000
         MVI   SDWAURAL(SDWAPTR),X'17'                             0673 01760000
*   IF WKADMP04='1'B THEN           /* IF SDUMP SUCCESSFUL THEN      */ 01761000
         TM    WKADMP04(RBSECPTR),B'00001000'                      0674 01762000
         BNO   @RF00674                                            0674 01763000
*     RECRCDP=DUMPRC1(1);           /* MV INTO REC AREA RET COD=4    */ 01764000
         MVC   RECRCDP(1,SDWAPTR),DUMPRC1                          0675 01765000
*   IF WKADMP08='1'B THEN           /* IF PARTIAL DUMP TAKEN         */ 01766000
@RF00674 TM    WKADMP08(RBSECPTR),B'00010000'                      0676 01767000
         BNO   @RF00676                                            0676 01768000
*     RECRCDP=DUMPRC1(2);           /* MV INTO REC AREA RET COD=8    */ 01769000
         MVC   RECRCDP(1,SDWAPTR),DUMPRC1+1                        0677 01770000
*   IF WKADMP0C='1'B THEN           /* IF SDUMP WAS UNSUCCESSFUL     */ 01771000
@RF00676 TM    WKADMP0C(RBSECPTR),B'00100000'                      0678 01772000
         BNO   @RF00678                                            0678 01773000
*     RECRCDP=DUMPRC1(3);           /* MV INTO REC AREA RET COD=C    */ 01774000
         MVC   RECRCDP(1,SDWAPTR),DUMPRC1+2                        0679 01775000
*   RECRCLN=WKACLENX;               /* MV CLEANUP RTN RET CODE IN    */ 01776000
@RF00678 MVC   RECRCLN(1,SDWAPTR),WKACLENX(RBSECPTR)               0680 01777000
*   RECREG0=RBGRS0;                 /* REG0 WHEN SVC WAS ISSUED      */ 01778000
         MVC   RECREG0(4,SDWAPTR),RBGRS0(RBSECPTR)                 0681 01779000
*   RECREG1=RBGRS1;                 /* REG1 WHEN SVC WAS ISSUED      */ 01780000
         MVC   RECREG1(4,SDWAPTR),RBGRS1(RBSECPTR)                 0682 01781000
*   RFY                                                            0683 01782000
*     GPR01P RSTD;                  /* RESTRICT WORK REG             */ 01783000
*   GPR01P=RBLINK;                  /* GET PREVIOUS RB ADDR          */ 01784000
         L     GPR01P,RBLINK(,RBSECPTR)                            0684 01785000
*   RFY                                                            0685 01786000
*     RBBASIC BASED(GPR01P);        /* BASE FOR PREVIOUS RB          */ 01787000
*   RECOPSW=RBOPSW;                 /* GET PSW FROM PREVIOUS RB      */ 01788000
         MVC   RECOPSW(8,SDWAPTR),RBOPSW(GPR01P)                   0686 01789000
*   RECPERC=SDWACMPC;               /* PUT IN PREVIOUS ABEND CODE    */ 01790000
         MVC   RECPERC(3,SDWAPTR),SDWACMPC(SDWAPTR)                0687 01791000
*   RFY                                                            0688 01792000
*     RBBASIC BASED(RBSECPTR);      /* RETURN TO RB BASE FOR SVC     */ 01793000
*   END RECORD;                     /* RETURN TO MAIN ROUTINE        */ 01794000
@EL00004 DS    0H                                                  0689 01795000
@EF00004 DS    0H                                                  0689 01796000
@ER00004 BR    @14                                                 0689 01797000
@PB00004 DS    0H                                                  0690 01798000
*   RFY                                                            0690 01799000
*    (GPR01P,                                                      0690 01800000
*     GPR14P)UNRSTD;                                               0690 01801000
*                                                                  0691 01802000
*/********************************************************************/ 01803000
*/*  THE FOLLOWING IS THE RETRY ENTRY POINT FOR THE SECOND LEVEL     */ 01804000
*/*  ESTAE, BACKUP5C (PART OF IGCT105C). THE SECOND LEVEL ESTAE IS   */ 01805000
*/*  ENTERED IF AN ERROR SHOULD OCCUR DURING THE PROCESSING OF THE   */ 01806000
*/*  CLEANUP ROUTINE(THE MAIN SECTION OF IGCT105C). IF IT IS DETER-  */ 01807000
*/*  MINED THAT THE ERROR WAS CAUSED BY OTHER THAN A PROGRAM CHECK   */ 01808000
*/*  IN THE CLEANUP ROUTINE THIS BACRETRY ROUTINE IS ENTERED TO      */ 01809000
*/*  CONTINUE PERCOLATION OF THE ABEND TO RTM. BY RETURNING TO       */ 01810000
*/*  IGCT005C BEFORE RETURNING TO RTM THE SAVEAREA OBTAINED UPON     */ 01811000
*/*  ENTRY TO THIS MODULE WILL BE FREED.                             */ 01812000
*/********************************************************************/ 01813000
*                                                                  0691 01814000
*BACRETRY:                          /* RETRY AFT ABEND IN CLEANUP    */ 01815000
*   GEN(ESTAE 0);                   /* REMOV 2ND EST LEVEL     YM7519*/ 01816000
BACRETRY ESTAE 0                                                        01817000
*   DO;                             /* SETRP RECORD(YES) DUMP(NO)  0692 01818000
*                                      COMPCOD(ERRSYS)             0692 01819000
*                                      WKAREA(SDWAPTR)               */ 01820000
*     RESPECIFY                                                    0693 01821000
*      (GPR00P,                                                    0693 01822000
*       GPR01P,                                                    0693 01823000
*       GPR14P,                                                    0693 01824000
*       GPR15P)RSTD;                                               0693 01825000
*     GPR01P=SDWAPTR;                                              0694 01826000
         LR    GPR01P,SDWAPTR                                      0694 01827000
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */ 01828000
         MVI   SDWARCDE(GPR01P),X'00'                              0695 01829000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 01830000
         OI    SDWARCRD(GPR01P),B'10000000'                        0696 01831000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01832000
         NI    SDWAREQ(GPR01P),B'01111111'                         0697 01833000
*     GPR14P=ERRSYS;                /* ACCESS COMPLETION CODE        */ 01834000
         SR    GPR14P,GPR14P                                       0698 01835000
         ICM   GPR14P,7,ERRSYS                                     0698 01836000
*     GPR01P->SDWACMPC=GPR14P;      /* STORE COMPLETION CODE         */ 01837000
         STCM  GPR14P,7,SDWACMPC(GPR01P)                           0699 01838000
*     RESPECIFY                                                    0700 01839000
*      (GPR00P,                                                    0700 01840000
*       GPR01P,                                                    0700 01841000
*       GPR14P,                                                    0700 01842000
*       GPR15P)UNRSTD;                                             0700 01843000
*   END;                            /* RECORD TO LOGREC THE ERROR    */ 01844000
*   GOTO RETRTM;                    /* GO TO COMMON RET        YM7519*/ 01845000
*                                                                  0702 01846000
         B     RETRTM                                              0702 01847000
*/********************************************************************/ 01848000
*/*              COMMON ROUTINE TO RETURN TO RTM                     */ 01849000
*/********************************************************************/ 01850000
*                                                                  0703 01851000
*RETRTM:                                                           0703 01852000
*   ;                               /* RETURN TO RTM           YM7519*/ 01853000
RETRTM   DS    0H                                                  0704 01854000
*   RFY                                                            0704 01855000
*     WRKREG RSTD;                  /* RESTRICT SAVE REG       YM7519*/ 01856000
*   WRKREG=SAVEPTR;                 /* PUT SAVEAREA PTR IN     YM7519*/ 01857000
         LR    WRKREG,SAVEPTR                                      0705 01858000
*                                   /* R11,EXPECTED BY PLS     YM7519*/ 01859000
*   RETURN;                         /* RETURN TO FREE SAVE     YM7519*/ 01860000
@EL00001 L     @13,4(,@13)                                         0706 01861000
@EF00001 L     @00,@SIZDATD                                        0706 01862000
         LR    @01,@11                                             0706 01863000
         FREEMAIN R,LV=(0),A=(1)                                        01864000
@ER00001 LM    @14,@12,12(@13)                                     0706 01865000
         BR    @14                                                 0706 01866000
*   RFY                                                            0707 01867000
*     WRKREG UNRSTD;                /* RELEASE REG             YM7519*/ 01868000
*                                                                  0707 01869000
*/********************************************************************/ 01870000
*                                                                  0708 01871000
*   END IGCT005C                    /* END OF 1ST LEVEL ESTAE        */ 01872000
*                                                                  0708 01873000
*/********************************************************************/ 01874000
*                                                                  0708 01875000
*                                                                  0708 01876000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 01877000
*/*%INCLUDE SYSLIB  (CVT     )                                       */ 01878000
*/*%INCLUDE SYSLIB  (IHADCBDF)                                       */ 01879000
*/*%INCLUDE SYSLIB  (IHADCB  )                                       */ 01880000
*/*%INCLUDE SYSLIB  (IEZDEB  )                                       */ 01881000
*/*%INCLUDE SYSLIB  (IHADECB )                                       */ 01882000
*/*%INCLUDE SYSLIB  (IHADSAB )                                       */ 01883000
*/*%INCLUDE SYSLIB  (IEZIOB  )                                       */ 01884000
*/*%INCLUDE SYSLIB  (IHAPSA  )                                       */ 01885000
*/*%INCLUDE SYSLIB  (IHARB   )                                       */ 01886000
*/*%INCLUDE SYSLIB  (IEZXRB  )                                       */ 01887000
*/*%INCLUDE SYSLIB  (IKJRB   )                                       */ 01888000
*/*%INCLUDE SYSLIB  (IGGRDX  )                                       */ 01889000
*/*%INCLUDE SYSLIB  (IHASDWA )                                       */ 01890000
*/*%INCLUDE SYSLIB  (IGGSPD  )                                       */ 01891000
*/*%INCLUDE SYSLIB  (IKJTCB  )                                       */ 01892000
*/*%INCLUDE SYSLIB  (IEFTIOT1)                                       */ 01893000
*                                                                  0708 01894000
*       ;                                                          0708 01895000
@DATA    DS    0H                                                       01896000
@CH03496 DC    H'-87'                                                   01897000
@CH03498 DC    H'-27'                                                   01898000
@CH03494 DC    H'-7'                                                    01899000
@CH03497 DC    H'-2'                                                    01900000
@CH00102 DC    H'1'                                                     01901000
@CH00114 DC    H'2'                                                     01902000
@CH00320 DC    H'3'                                                     01903000
@CH01435 DC    H'5'                                                     01904000
@CH01455 DC    H'6'                                                     01905000
@CH00048 DC    H'8'                                                     01906000
@CH01483 DC    H'9'                                                     01907000
@CH00076 DC    H'16'                                                    01908000
@CH02467 DC    H'28'                                                    01909000
@DATD    DSECT                                                          01910000
         DS    0F                                                       01911000
@SA00001 DS    18F                                                      01912000
IGCT005C CSECT                                                          01913000
         DS    0F                                                       01914000
@CF03514 DC    F'-8'                                                    01915000
@CF00095 DC    F'4'                                                     01916000
@CH00095 EQU   @CF00095+2                                               01917000
@CF03499 DC    F'58880'                                                 01918000
@DATD    DSECT                                                          01919000
         DS    0D                                                       01920000
IGCT005C CSECT                                                          01921000
         DS    0F                                                       01922000
@SIZDATD DC    AL1(0)                                                   01923000
         DC    AL3(@ENDDATD-@DATD)                                      01924000
@CV03373 DC    V(IGCT105C)                                              01925000
         DS    0D                                                       01926000
DEBKEY   DC    XL1'50'                                                  01927000
SCHEDKEY DC    AL1(16)                                                  01928000
HEADING  DS    CL27                                                     01929000
         ORG   HEADING                                                  01930000
@NM00162 DC    AL1(26)                                                  01931000
HEADTEXT DC    CL26'IGCT005C,        ,        '                         01932000
         ORG   HEADING+27                                               01933000
         DS    CL1                                                      01934000
PATCH    DS    CL150                                                    01935000
         ORG   PATCH                                                    01936000
PATCHID  DC    CL8'IGCT005C'                                            01937000
PATCHIT  DC    142CL1'*'                                                01938000
         ORG   PATCH+150                                                01939000
ERRSYS   DC    X'135000'                                                01940000
GTON     DC    CL1'8'                                                   01941000
GTOFF    DC    CL1'0'                                                   01942000
MAJNAME  DC    CL8'SYSZGGLG'                                            01943000
NODDNAME DC    CL8'********'                                            01944000
         DS    CL3                                                      01945000
USERER   DS    CL52                                                     01946000
         ORG   USERER                                                   01947000
USERER01 DC    H'48'                                                    01948000
USERER02 DC    B'1000000000000000'                                      01949000
USERER03 DC    CL44'IEC902I 235,00,00,        ,        ,        '       01950000
USERER04 DC    B'0000010000000000'                                      01951000
USERER05 DC    B'0000000000100000'                                      01952000
         ORG   USERER+52                                                01953000
SYSER    DS    CL52                                                     01954000
         ORG   SYSER                                                    01955000
SYSER01  DC    H'48'                                                    01956000
SYSER02  DC    B'1000000000000000'                                      01957000
SYSER03  DC    CL44'IEC903I 135,00,00,        ,        ,        '       01958000
SYSER04  DC    B'0000010000000000'                                      01959000
SYSER05  DC    B'0000000000100000'                                      01960000
         ORG   SYSER+52                                                 01961000
DUMPRC1  DC    AL1(4)                                                   01962000
         DC    AL1(8)                                                   01963000
         DC    AL1(12)                                                  01964000
DUMPRC   DC    CL2'04'                                                  01965000
         DC    CL2'08'                                                  01966000
         DC    CL2'0C'                                                  01967000
CLEANRC1 DC    AL1(1)                                                   01968000
         DC    AL1(2)                                                   01969000
         DC    AL1(3)                                                   01970000
         DC    AL1(4)                                                   01971000
         DC    AL1(5)                                                   01972000
         DC    AL1(6)                                                   01973000
         DC    AL1(7)                                                   01974000
         DC    AL1(8)                                                   01975000
CLEANRC2 DC    CL2'01'                                                  01976000
         DC    CL2'02'                                                  01977000
         DC    CL2'03'                                                  01978000
         DC    CL2'04'                                                  01979000
         DC    CL2'05'                                                  01980000
         DC    CL2'06'                                                  01981000
         DC    CL2'07'                                                  01982000
         DC    CL2'08'                                                  01983000
BLKERR1  DC    AL1(1)                                                   01984000
         DC    AL1(2)                                                   01985000
         DC    AL1(3)                                                   01986000
         DC    AL1(4)                                                   01987000
         DC    AL1(5)                                                   01988000
         DC    AL1(6)                                                   01989000
         DC    AL1(0)                                                   01990000
BLKERR2  DC    CL1'1'                                                   01991000
         DC    CL1'2'                                                   01992000
         DC    CL1'3'                                                   01993000
         DC    CL1'4'                                                   01994000
         DC    CL1'5'                                                   01995000
         DC    CL1'6'                                                   01996000
         DC    CL1'0'                                                   01997000
BLKERR3  DC    AL1(1)                                                   01998000
         DC    AL1(2)                                                   01999000
         DC    AL1(3)                                                   02000000
         DC    AL1(132)                                                 02001000
         DC    AL1(133)                                                 02002000
         DC    AL1(134)                                                 02003000
         DC    AL1(0)                                                   02004000
IGCT005C CSECT                                                          02005000
*                                                   /* LIST FORMS   */  02006000
DUMPLIST SDUMP SDATA=(PSA,NUC,SQA,RGN),MF=L                             02007000
TRACLIST GTRACE FID=SPDFID,MF=L                                         02008000
SNAPLIST SNAP  SDATA=TRT,MF=L                                           02009000
@DATD    DSECT                                                          02010000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                02011000
@ENDDATD EQU   *                                                        02012000
IGCT005C CSECT                                                          02013000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       02014000
@01      EQU   01                                                       02015000
@02      EQU   02                                                       02016000
@03      EQU   03                                                       02017000
@04      EQU   04                                                       02018000
@05      EQU   05                                                       02019000
@06      EQU   06                                                       02020000
@07      EQU   07                                                       02021000
@08      EQU   08                                                       02022000
@09      EQU   09                                                       02023000
@10      EQU   10                                                       02024000
@11      EQU   11                                                       02025000
@12      EQU   12                                                       02026000
@13      EQU   13                                                       02027000
@14      EQU   14                                                       02028000
@15      EQU   15                                                       02029000
WRKREG   EQU   @11                                                      02030000
BASEREG  EQU   @09                                                      02031000
GPR00F   EQU   @00                                                      02032000
GPR01F   EQU   @01                                                      02033000
GPR15F   EQU   @15                                                      02034000
GPR00P   EQU   @00                                                      02035000
GPR01P   EQU   @01                                                      02036000
GPR14P   EQU   @14                                                      02037000
GPR15P   EQU   @15                                                      02038000
GPR02P   EQU   @02                                                      02039000
GPR03F   EQU   @03                                                      02040000
GPR04P   EQU   @04                                                      02041000
GPR07P   EQU   @07                                                      02042000
GPR10P   EQU   @10                                                      02043000
GPR11P   EQU   @11                                                      02044000
GPR12P   EQU   @12                                                      02045000
GPR13P   EQU   @13                                                      02046000
I        EQU   @00                                                      02047000
TRCPTR   EQU   @02                                                      02048000
RDXPTR   EQU   @02                                                      02049000
IOBSTPTR EQU   @03                                                      02050000
MVBLKPTR EQU   @04                                                      02051000
SDWAPTR  EQU   @05                                                      02052000
DCBPTR   EQU   @06                                                      02053000
BLKCTR   EQU   @07                                                      02054000
RBSECPTR EQU   @08                                                      02055000
RDXENTRG EQU   @10                                                      02056000
SAVEPTR  EQU   @13                                                      02057000
RETURNCD EQU   @15                                                      02058000
GPR14F   EQU   @14                                                      02059000
CVTPTR   EQU   16                                                       02060000
PSA      EQU   0                                                        02061000
FLCRNPSW EQU   PSA                                                      02062000
FLCROPSW EQU   PSA+8                                                    02063000
FLCICCW2 EQU   PSA+16                                                   02064000
PSAEEPSW EQU   PSA+132                                                  02065000
PSAESPSW EQU   PSA+136                                                  02066000
FLCSVILC EQU   PSAESPSW+1                                               02067000
PSAEPPSW EQU   PSA+140                                                  02068000
FLCPIILC EQU   PSAEPPSW+1                                               02069000
FLCPICOD EQU   PSAEPPSW+2                                               02070000
PSAPICOD EQU   FLCPICOD+1                                               02071000
FLCTEA   EQU   PSAEPPSW+4                                               02072000
FLCPER   EQU   PSA+152                                                  02073000
FLCMCLA  EQU   PSA+168                                                  02074000
FLCIOEL  EQU   FLCMCLA+4                                                02075000
FLCIOA   EQU   FLCMCLA+16                                               02076000
FLCFSA   EQU   FLCMCLA+80                                               02077000
PSATOLD  EQU   PSA+540                                                  02078000
PSAAOLD  EQU   PSA+548                                                  02079000
PSASUPER EQU   PSA+552                                                  02080000
PSASUP1  EQU   PSASUPER                                                 02081000
PSASUP2  EQU   PSASUPER+1                                               02082000
PSASUP3  EQU   PSASUPER+2                                               02083000
PSASUP4  EQU   PSASUPER+3                                               02084000
PSACLHT  EQU   PSA+640                                                  02085000
PSALKSA  EQU   PSA+696                                                  02086000
PSAHLHI  EQU   PSA+760                                                  02087000
PSALITA  EQU   PSA+764                                                  02088000
PSADSSFL EQU   PSA+836                                                  02089000
PSADSSF1 EQU   PSADSSFL                                                 02090000
PSADSSF3 EQU   PSADSSFL+2                                               02091000
PSADSSF4 EQU   PSADSSFL+3                                               02092000
PSARSVT  EQU   PSA+896                                                  02093000
NOBASE   EQU   0                                                        02094000
CVTMAP   EQU   0                                                        02095000
CVT0VL00 EQU   CVTMAP+24                                                02096000
CVTDAR   EQU   CVTMAP+72                                                02097000
CVTFLGS1 EQU   CVTDAR                                                   02098000
CVTDCB   EQU   CVTMAP+116                                               02099000
CVTIERLC EQU   CVTMAP+144                                               02100000
CVTOPTA  EQU   CVTMAP+182                                               02101000
CVTOPTB  EQU   CVTMAP+183                                               02102000
CVTGTF   EQU   CVTMAP+236                                               02103000
CVTGTFST EQU   CVTGTF                                                   02104000
CVTGTFS  EQU   CVTGTFST                                                 02105000
CVTSTATE EQU   CVTGTFST                                                 02106000
CVTTMODE EQU   CVTGTFST                                                 02107000
CVTFORM  EQU   CVTGTFST                                                 02108000
CVTUSR   EQU   CVTGTFST                                                 02109000
CVTAQAVT EQU   CVTMAP+240                                               02110000
CVTTCMFG EQU   CVTAQAVT                                                 02111000
CVTVOLM2 EQU   CVTMAP+244                                               02112000
CVTTATA  EQU   CVTVOLM2                                                 02113000
CVTTSKS  EQU   CVTTATA                                                  02114000
CVTVOLF2 EQU   CVTTSKS                                                  02115000
CVTTAT   EQU   CVTTATA+1                                                02116000
CVTATER  EQU   CVTMAP+248                                               02117000
CVTEXT1  EQU   CVTMAP+252                                               02118000
CVTPURG  EQU   CVTMAP+260                                               02119000
CVTQMSG  EQU   CVTMAP+268                                               02120000
CVTDMSR  EQU   CVTMAP+272                                               02121000
CVTERPV  EQU   CVTMAP+316                                               02122000
CVTINTLA EQU   CVTMAP+320                                               02123000
CVTAPF   EQU   CVTMAP+324                                               02124000
CVTEXT2  EQU   CVTMAP+328                                               02125000
CVTHJES  EQU   CVTMAP+332                                               02126000
CVTPGSIA EQU   CVTMAP+348                                               02127000
CVTA1F1  EQU   CVTMAP+356                                               02128000
CVTSYSK  EQU   CVTMAP+357                                               02129000
CVTVOLM1 EQU   CVTMAP+380                                               02130000
CVTVOLF1 EQU   CVTVOLM1                                                 02131000
CVTATMCT EQU   CVTMAP+388                                               02132000
CVTXTNT1 EQU   0                                                        02133000
CVTXTNT2 EQU   0                                                        02134000
CVTDSSV  EQU   CVTXTNT2                                                 02135000
CVTRSV90 EQU   CVTXTNT2+5                                               02136000
CVTDEBVR EQU   CVTXTNT2+8                                               02137000
CVTQID   EQU   CVTXTNT2+24                                              02138000
CVTRV400 EQU   CVTXTNT2+52                                              02139000
CVTRV409 EQU   CVTXTNT2+53                                              02140000
CVTATCVT EQU   CVTXTNT2+64                                              02141000
CVTRV429 EQU   CVTXTNT2+84                                              02142000
CVTRV438 EQU   CVTXTNT2+85                                              02143000
CVTRV457 EQU   CVTXTNT2+112                                             02144000
CVTRV466 EQU   CVTXTNT2+113                                             02145000
CVTFIX   EQU   0                                                        02146000
CVTRELNO EQU   CVTFIX+252                                               02147000
IHADCB   EQU   0                                                        02148000
IHADCS00 EQU   0                                                        02149000
DCBFDAD  EQU   IHADCS00+5                                               02150000
IHADCS01 EQU   0                                                        02151000
DCBDVTBL EQU   IHADCS01                                                 02152000
IHADCS11 EQU   0                                                        02153000
DCBRELB  EQU   IHADCS11                                                 02154000
DCBREL   EQU   DCBRELB+1                                                02155000
DCBBUFCB EQU   IHADCS11+4                                               02156000
DCBDSORG EQU   IHADCS11+10                                              02157000
DCBDSRG1 EQU   DCBDSORG                                                 02158000
DCBDSRG2 EQU   DCBDSORG+1                                               02159000
DCBIOBAD EQU   IHADCS11+12                                              02160000
DCBODEB  EQU   DCBIOBAD                                                 02161000
DCBLNP   EQU   DCBODEB                                                  02162000
DCBQSLM  EQU   DCBLNP                                                   02163000
DCBIOBAA EQU   DCBODEB+1                                                02164000
IHADCS50 EQU   0                                                        02165000
DCBSVCXL EQU   IHADCS50                                                 02166000
DCBEODAD EQU   IHADCS50+4                                               02167000
DCBBFALN EQU   DCBEODAD                                                 02168000
DCBHIARC EQU   DCBBFALN                                                 02169000
DCBBFTEK EQU   DCBHIARC                                                 02170000
DCBBFT   EQU   DCBBFTEK                                                 02171000
DCBBFTKR EQU   DCBBFT                                                   02172000
DCBEXLST EQU   IHADCS50+8                                               02173000
DCBRECFM EQU   DCBEXLST                                                 02174000
DCBRECLA EQU   DCBRECFM                                                 02175000
IHADCS24 EQU   0                                                        02176000
DCBOFLGS EQU   IHADCS24+8                                               02177000
DCBOFLWR EQU   DCBOFLGS                                                 02178000
DCBOFOPN EQU   DCBOFLGS                                                 02179000
DCBIFLG  EQU   IHADCS24+9                                               02180000
DCBMACR  EQU   IHADCS24+10                                              02181000
DCBMACR1 EQU   DCBMACR                                                  02182000
DCBMRFE  EQU   DCBMACR1                                                 02183000
DCBMRGET EQU   DCBMRFE                                                  02184000
DCBMRAPG EQU   DCBMACR1                                                 02185000
DCBMRRD  EQU   DCBMRAPG                                                 02186000
DCBMRCI  EQU   DCBMACR1                                                 02187000
DCBMRMVG EQU   DCBMRCI                                                  02188000
DCBMRLCG EQU   DCBMACR1                                                 02189000
DCBMRABC EQU   DCBMACR1                                                 02190000
DCBMRPT1 EQU   DCBMRABC                                                 02191000
DCBMRSBG EQU   DCBMRPT1                                                 02192000
DCBMRCRL EQU   DCBMACR1                                                 02193000
DCBMRCHK EQU   DCBMRCRL                                                 02194000
DCBMRRDX EQU   DCBMRCHK                                                 02195000
DCBMRDMG EQU   DCBMACR1                                                 02196000
DCBMACR2 EQU   DCBMACR+1                                                02197000
DCBMRPUT EQU   DCBMACR2                                                 02198000
DCBMRWRT EQU   DCBMACR2                                                 02199000
DCBMRMVP EQU   DCBMACR2                                                 02200000
DCBMR5WD EQU   DCBMACR2                                                 02201000
DCBMRLDM EQU   DCBMR5WD                                                 02202000
DCBMRLCP EQU   DCBMRLDM                                                 02203000
DCBMR4WD EQU   DCBMACR2                                                 02204000
DCBMRPT2 EQU   DCBMR4WD                                                 02205000
DCBMRTMD EQU   DCBMRPT2                                                 02206000
DCBMR3WD EQU   DCBMACR2                                                 02207000
DCBMRCTL EQU   DCBMR3WD                                                 02208000
DCBMRSTK EQU   DCBMRCTL                                                 02209000
DCBMR1WD EQU   DCBMACR2                                                 02210000
DCBMRSWA EQU   DCBMR1WD                                                 02211000
DCBMRDMD EQU   DCBMRSWA                                                 02212000
IHADCS25 EQU   0                                                        02213000
DCBMACRF EQU   IHADCS25+2                                               02214000
DCBMACF1 EQU   DCBMACRF                                                 02215000
DCBMFFE  EQU   DCBMACF1                                                 02216000
DCBMFGET EQU   DCBMFFE                                                  02217000
DCBMFAPG EQU   DCBMACF1                                                 02218000
DCBMFRD  EQU   DCBMFAPG                                                 02219000
DCBMFCI  EQU   DCBMACF1                                                 02220000
DCBMFMVG EQU   DCBMFCI                                                  02221000
DCBMFLCG EQU   DCBMACF1                                                 02222000
DCBMFABC EQU   DCBMACF1                                                 02223000
DCBMFPT1 EQU   DCBMFABC                                                 02224000
DCBMFSBG EQU   DCBMFPT1                                                 02225000
DCBMFCRL EQU   DCBMACF1                                                 02226000
DCBMFCHK EQU   DCBMFCRL                                                 02227000
DCBMFDMG EQU   DCBMACF1                                                 02228000
DCBMACF2 EQU   DCBMACRF+1                                               02229000
DCBMFPUT EQU   DCBMACF2                                                 02230000
DCBMFWRT EQU   DCBMACF2                                                 02231000
DCBMFMVP EQU   DCBMACF2                                                 02232000
DCBMF5WD EQU   DCBMACF2                                                 02233000
DCBMFLDM EQU   DCBMF5WD                                                 02234000
DCBMFLCP EQU   DCBMFLDM                                                 02235000
DCBMF4WD EQU   DCBMACF2                                                 02236000
DCBMFPT2 EQU   DCBMF4WD                                                 02237000
DCBMFTMD EQU   DCBMFPT2                                                 02238000
DCBMF3WD EQU   DCBMACF2                                                 02239000
DCBMFCTL EQU   DCBMF3WD                                                 02240000
DCBMFSTK EQU   DCBMFCTL                                                 02241000
DCBMF1WD EQU   DCBMACF2                                                 02242000
DCBMFSWA EQU   DCBMF1WD                                                 02243000
DCBMFDMD EQU   DCBMFSWA                                                 02244000
DCBDEBAD EQU   IHADCS25+4                                               02245000
DCBIFLGS EQU   DCBDEBAD                                                 02246000
DCBDEBA  EQU   DCBDEBAD+1                                               02247000
IHADCS26 EQU   0                                                        02248000
DCBWRITE EQU   IHADCS26                                                 02249000
DCBREAD  EQU   DCBWRITE                                                 02250000
DCBWRITA EQU   DCBREAD+1                                                02251000
IHADCS30 EQU   0                                                        02252000
DCBCHECK EQU   IHADCS30                                                 02253000
DCBOPTCD EQU   DCBCHECK                                                 02254000
DCBOPTF  EQU   DCBOPTCD                                                 02255000
DCBOPTA  EQU   DCBOPTCD                                                 02256000
DCBXARG  EQU   IHADCS30+32                                              02257000
DCBDRDX  EQU   IHADCS30+36                                              02258000
DEBBASIC EQU   0                                                        02259000
DEBTCBAD EQU   DEBBASIC                                                 02260000
DEBDEBAD EQU   DEBBASIC+4                                               02261000
DEBIRBAD EQU   DEBBASIC+8                                               02262000
DEBOFLGS EQU   DEBIRBAD                                                 02263000
DEBOPATB EQU   DEBBASIC+12                                              02264000
DEBFLGS1 EQU   DEBBASIC+14                                              02265000
DEBUSRPG EQU   DEBBASIC+16                                              02266000
DEBRRQ   EQU   DEBBASIC+20                                              02267000
DEBECBAD EQU   DEBRRQ                                                   02268000
DEBDCBAD EQU   DEBBASIC+24                                              02269000
DEBPROTG EQU   DEBDCBAD                                                 02270000
DEBDCBB  EQU   DEBDCBAD+1                                               02271000
DEBAPPAD EQU   DEBBASIC+28                                              02272000
DEBBASND EQU   DEBBASIC+32                                              02273000
DEBDASD  EQU   0                                                        02274000
DEBUCBAD EQU   DEBDASD                                                  02275000
DEBACSMD EQU   0                                                        02276000
DEBVOLSQ EQU   DEBACSMD                                                 02277000
DEBVOLBT EQU   DEBVOLSQ                                                 02278000
DEBDSNM  EQU   DEBACSMD+4                                               02279000
DEBUTSAA EQU   DEBDSNM                                                  02280000
DEBACS01 EQU   0                                                        02281000
DEBDSNAM EQU   DEBACS01                                                 02282000
DEBACS02 EQU   0                                                        02283000
DEBDBLK  EQU   DEBACS02                                                 02284000
DEBACS03 EQU   0                                                        02285000
DEBACS04 EQU   0                                                        02286000
DEBTBFRA EQU   DEBACS04                                                 02287000
DEBTCCWA EQU   DEBACS04+4                                               02288000
DEBACS05 EQU   0                                                        02289000
DEBFUCBA EQU   DEBACS05                                                 02290000
DEBLUCBA EQU   DEBACS05+4                                               02291000
DEBACS06 EQU   0                                                        02292000
DEBACS07 EQU   0                                                        02293000
DEBACS08 EQU   0                                                        02294000
DEBSUBNM EQU   0                                                        02295000
DEB      EQU   0                                                        02296000
DEBAVT   EQU   DEB                                                      02297000
DEBEOEA  EQU   DEBAVT                                                   02298000
DEBEOEAB EQU   DEBEOEA                                                  02299000
DEBSIOA  EQU   DEBAVT+4                                                 02300000
DEBSIOAB EQU   DEBSIOA                                                  02301000
DEBPCIA  EQU   DEBAVT+8                                                 02302000
DEBPCIAB EQU   DEBPCIA                                                  02303000
DEBCEA   EQU   DEBAVT+12                                                02304000
DEBCEAB  EQU   DEBCEA                                                   02305000
DEBXCEA  EQU   DEBAVT+16                                                02306000
DEBXCEAB EQU   DEBXCEA                                                  02307000
DEBPREFX EQU   DEB+20                                                   02308000
DEBXTNP  EQU   DEBPREFX+8                                               02309000
DEBTBLOF EQU   DEBPREFX+14                                              02310000
DEBXTN   EQU   0                                                        02311000
DEBXFLG1 EQU   DEBXTN+2                                                 02312000
DEBXDSAB EQU   DEBXTN+4                                                 02313000
DEBXXARG EQU   DEBXTN+20                                                02314000
DECB     EQU   0                                                        02315000
DECBPTR  EQU   DECB+4                                                   02316000
DECTYPE  EQU   DECBPTR                                                  02317000
DECTYPE1 EQU   DECTYPE                                                  02318000
DECTYPE2 EQU   DECTYPE+1                                                02319000
DECNEXT  EQU   DECB+20                                                  02320000
DECBS01  EQU   0                                                        02321000
DECBECB  EQU   DECBS01                                                  02322000
DECBRB   EQU   DECBECB                                                  02323000
DECBECBF EQU   DECBRB                                                   02324000
DECBTYP1 EQU   DECBS01+4                                                02325000
DECBTYP2 EQU   DECBS01+5                                                02326000
DECBEXC1 EQU   DECBS01+24                                               02327000
DECBEXC2 EQU   DECBS01+25                                               02328000
DECBS02  EQU   0                                                        02329000
@NM00020 EQU   DECBS02                                                  02330000
DECCC2   EQU   @NM00020+1                                               02331000
DECCC3   EQU   @NM00020+2                                               02332000
@NM00022 EQU   DECBS02+4                                                02333000
@NM00023 EQU   @NM00022                                                 02334000
@NM00024 EQU   @NM00022+1                                               02335000
DECTYPRU EQU   @NM00024                                                 02336000
DECNA    EQU   DECBS02+28                                               02337000
DECBS03  EQU   0                                                        02338000
DECCPOL  EQU   DECBS03+20                                               02339000
@NM00032 EQU   DECBS03+36                                               02340000
DECBS04  EQU   0                                                        02341000
@NM00035 EQU   DECBS04+4                                                02342000
@NM00036 EQU   @NM00035                                                 02343000
@NM00039 EQU   DECBS04+8                                                02344000
DECBUFCT EQU   @NM00039                                                 02345000
DECONLTT EQU   DECBUFCT                                                 02346000
DECENTRY EQU   DECBS04+20                                               02347000
DECFLAGS EQU   DECBS04+24                                               02348000
DECWACK  EQU   DECFLAGS                                                 02349000
DECREVRS EQU   DECFLAGS                                                 02350000
DECERRST EQU   DECBS04+29                                               02351000
DECPOLPT EQU   DECBS04+36                                               02352000
DSAB     EQU   0                                                        02353000
DSABTIOT EQU   DSAB+16                                                  02354000
DSABGIDP EQU   DSAB+24                                                  02355000
DSABANMP EQU   DSAB+28                                                  02356000
DSABORG  EQU   DSAB+32                                                  02357000
DSABORG1 EQU   DSABORG                                                  02358000
DSABORG2 EQU   DSABORG+1                                                02359000
DSABFLG1 EQU   DSAB+34                                                  02360000
DSABFLG2 EQU   DSAB+35                                                  02361000
DSABFLG3 EQU   DSAB+36                                                  02362000
DSABFLG4 EQU   DSAB+37                                                  02363000
DSABANMI EQU   0                                                        02364000
DSABGIDL EQU   0                                                        02365000
IOBPREFX EQU   0                                                        02366000
IOBCFLG1 EQU   IOBPREFX                                                 02367000
IOBSTDRD EQU   0                                                        02368000
IOBFLAG1 EQU   IOBSTDRD                                                 02369000
IOBCYCCK EQU   IOBFLAG1                                                 02370000
IOBRSTRT EQU   IOBFLAG1                                                 02371000
IOBFLAG2 EQU   IOBSTDRD+1                                               02372000
IOBPURGE EQU   IOBFLAG2                                                 02373000
IOBRDHA0 EQU   IOBFLAG2                                                 02374000
IOBSENS0 EQU   IOBSTDRD+2                                               02375000
IOBS0B7  EQU   IOBSENS0                                                 02376000
IOBSENS1 EQU   IOBSTDRD+3                                               02377000
IOBECBPT EQU   IOBSTDRD+4                                               02378000
IOBFLAG3 EQU   IOBSTDRD+8                                               02379000
IOBFL3   EQU   IOBFLAG3                                                 02380000
IOBCSW   EQU   IOBSTDRD+9                                               02381000
IOBIOCSW EQU   IOBCSW                                                   02382000
IOBSTART EQU   IOBSTDRD+16                                              02383000
IOBDCBPT EQU   IOBSTDRD+20                                              02384000
IOBFLAG4 EQU   IOBDCBPT                                                 02385000
IOBRESTR EQU   IOBSTDRD+24                                              02386000
IOBINCAM EQU   IOBSTDRD+28                                              02387000
IOBBTAMF EQU   IOBINCAM                                                 02388000
RBPRFX   EQU   0                                                        02389000
RBBASIC  EQU   0                                                        02390000
RBEXRTNM EQU   RBBASIC                                                  02391000
RBTMFLD  EQU   RBEXRTNM                                                 02392000
RBSTAB   EQU   RBBASIC+10                                               02393000
XSTAB    EQU   RBSTAB                                                   02394000
RBSTAB1  EQU   XSTAB                                                    02395000
XSTAB1   EQU   RBSTAB1                                                  02396000
RBFTCKPT EQU   XSTAB1                                                   02397000
RBSTAB2  EQU   XSTAB+1                                                  02398000
XSTAB2   EQU   RBSTAB2                                                  02399000
RBTCBNXT EQU   XSTAB2                                                   02400000
RBFACTV  EQU   XSTAB2                                                   02401000
RBFDYN   EQU   XSTAB2                                                   02402000
RBECBWT  EQU   XSTAB2                                                   02403000
RBOPSW   EQU   RBBASIC+16                                               02404000
RBLINK   EQU   RBBASIC+28                                               02405000
XRBLNK   EQU   RBLINK                                                   02406000
RBWCF    EQU   XRBLNK                                                   02407000
RBLINKB  EQU   XRBLNK+1                                                 02408000
RBGRSAVE EQU   RBBASIC+32                                               02409000
XRBREG   EQU   RBGRSAVE                                                 02410000
RBGRS0   EQU   XRBREG                                                   02411000
RBGRS1   EQU   XRBREG+4                                                 02412000
RBGRS2   EQU   XRBREG+8                                                 02413000
RBGRS3   EQU   XRBREG+12                                                02414000
RBGRS4   EQU   XRBREG+16                                                02415000
RBGRS5   EQU   XRBREG+20                                                02416000
RBGRS6   EQU   XRBREG+24                                                02417000
RBGRS7   EQU   XRBREG+28                                                02418000
RBGRS8   EQU   XRBREG+32                                                02419000
RBGRS9   EQU   XRBREG+36                                                02420000
RBGRS10  EQU   XRBREG+40                                                02421000
RBGRS11  EQU   XRBREG+44                                                02422000
RBGRS12  EQU   XRBREG+48                                                02423000
RBGRS13  EQU   XRBREG+52                                                02424000
RBGRS14  EQU   XRBREG+56                                                02425000
RBGRS15  EQU   XRBREG+60                                                02426000
XRBESA   EQU   RBBASIC+96                                               02427000
RBEXSAVE EQU   XRBESA                                                   02428000
RBPREFIX EQU   0                                                        02429000
RBRSV019 EQU   RBPREFIX+14                                              02430000
RBRSV028 EQU   RBPREFIX+15                                              02431000
RBRSV041 EQU   RBPREFIX+27                                              02432000
RBRSV054 EQU   RBPREFIX+39                                              02433000
RBRTOPSW EQU   RBPREFIX+40                                              02434000
RBRTPSW2 EQU   RBRTOPSW+8                                               02435000
RBRTICIL EQU   RBRTPSW2                                                 02436000
RBFLAGS1 EQU   RBPREFIX+56                                              02437000
RBINTCDA EQU   RBPREFIX+61                                              02438000
RBSECT   EQU   0                                                        02439000
RBPPSAV  EQU   RBSECT                                                   02440000
@NM00079 EQU   RBSECT+10                                                02441000
@NM00080 EQU   @NM00079                                                 02442000
RBTRSVRB EQU   @NM00080                                                 02443000
@NM00082 EQU   @NM00079+1                                               02444000
RBETXR   EQU   @NM00082                                                 02445000
RBEP     EQU   RBSECT+12                                                02446000
RBPGMQ   EQU   RBSECT+24                                                02447000
@NM00089 EQU   RBSECT+28                                                02448000
IRBEND   EQU   RBSECT+96                                                02449000
@NM00093 EQU   RBSECT+96                                                02450000
RBRSV138 EQU   @NM00093+7                                               02451000
RBRSV150 EQU   RBSECT+167                                               02452000
RDXLIST  EQU   0                                                        02453000
RDXNEXT  EQU   RDXLIST+4                                                02454000
RDXENT   EQU   RDXLIST+8                                                02455000
RDXENTRY EQU   0                                                        02456000
SDWA     EQU   0                                                        02457000
SDWAPARM EQU   SDWA                                                     02458000
SDWAFIOB EQU   SDWA+4                                                   02459000
SDWAABCC EQU   SDWAFIOB                                                 02460000
SDWACMPF EQU   SDWAABCC                                                 02461000
SDWAREQ  EQU   SDWACMPF                                                 02462000
SDWACMPC EQU   SDWAABCC+1                                               02463000
SDWACTL1 EQU   SDWA+8                                                   02464000
SDWACMKA EQU   SDWACTL1                                                 02465000
SDWAMWPA EQU   SDWACTL1+1                                               02466000
SDWAPMKA EQU   SDWACTL1+4                                               02467000
SDWACTL2 EQU   SDWA+16                                                  02468000
SDWACMKP EQU   SDWACTL2                                                 02469000
SDWAMWPP EQU   SDWACTL2+1                                               02470000
SDWAPMKP EQU   SDWACTL2+4                                               02471000
SDWAGRSV EQU   SDWA+24                                                  02472000
SDWANAME EQU   SDWA+88                                                  02473000
SDWAEC1  EQU   SDWA+104                                                 02474000
SDWAEMK1 EQU   SDWAEC1                                                  02475000
SDWAMWP1 EQU   SDWAEC1+1                                                02476000
SDWAINT1 EQU   SDWAEC1+2                                                02477000
SDWANXT1 EQU   SDWAEC1+4                                                02478000
SDWAAEC1 EQU   SDWA+112                                                 02479000
SDWAILC1 EQU   SDWAAEC1+1                                               02480000
SDWAINC1 EQU   SDWAAEC1+2                                               02481000
SDWAICD1 EQU   SDWAINC1+1                                               02482000
SDWAEC2  EQU   SDWA+120                                                 02483000
SDWAEMK2 EQU   SDWAEC2                                                  02484000
SDWAMWP2 EQU   SDWAEC2+1                                                02485000
SDWAINT2 EQU   SDWAEC2+2                                                02486000
SDWANXT2 EQU   SDWAEC2+4                                                02487000
SDWAAEC2 EQU   SDWA+128                                                 02488000
SDWAILC2 EQU   SDWAAEC2+1                                               02489000
SDWAINC2 EQU   SDWAAEC2+2                                               02490000
SDWAICD2 EQU   SDWAINC2+1                                               02491000
SDWASRSV EQU   SDWA+136                                                 02492000
SDWASR00 EQU   SDWASRSV                                                 02493000
SDWASR07 EQU   SDWASRSV+28                                              02494000
SDWASR08 EQU   SDWASRSV+32                                              02495000
SDWASR09 EQU   SDWASRSV+36                                              02496000
SDWAIDNT EQU   SDWA+200                                                 02497000
SDWAMCH  EQU   SDWA+204                                                 02498000
SDWASTCK EQU   SDWAMCH                                                  02499000
SDWAMCHI EQU   SDWAMCH+8                                                02500000
SDWAMCHS EQU   SDWAMCHI                                                 02501000
SDWAMCHD EQU   SDWAMCHI+1                                               02502000
SDWARSR1 EQU   SDWAMCH+12                                               02503000
SDWARSR2 EQU   SDWAMCH+13                                               02504000
SDWAFLGS EQU   SDWA+232                                                 02505000
SDWAERRA EQU   SDWAFLGS                                                 02506000
SDWAMCHK EQU   SDWAERRA                                                 02507000
SDWATEXC EQU   SDWAERRA                                                 02508000
SDWAPGIO EQU   SDWAERRA                                                 02509000
SDWAERRB EQU   SDWAFLGS+1                                               02510000
SDWAERRC EQU   SDWAFLGS+2                                               02511000
SDWASTAF EQU   SDWAERRC                                                 02512000
SDWAEAS  EQU   SDWAERRC                                                 02513000
SDWAERRD EQU   SDWAFLGS+3                                               02514000
SDWACLUP EQU   SDWAERRD                                                 02515000
SDWAIOFS EQU   SDWA+238                                                 02516000
SDWARTYA EQU   SDWA+240                                                 02517000
SDWACPUA EQU   SDWA+248                                                 02518000
SDWAPARQ EQU   SDWA+252                                                 02519000
SDWARCDE EQU   SDWAPARQ                                                 02520000
SDWAACF2 EQU   SDWAPARQ+1                                               02521000
SDWARCRD EQU   SDWAACF2                                                 02522000
SDWAUPRG EQU   SDWAACF2                                                 02523000
SDWAFREE EQU   SDWAACF2                                                 02524000
SDWAACF3 EQU   SDWAPARQ+2                                               02525000
SDWAACF4 EQU   SDWAPARQ+3                                               02526000
SDWALKWA EQU   SDWA+256                                                 02527000
SDWALKWS EQU   SDWALKWA                                                 02528000
SDWARECP EQU   SDWA+292                                                 02529000
SDWASNPA EQU   SDWA+320                                                 02530000
SDWADUMP EQU   SDWASNPA                                                 02531000
SDWADPFS EQU   SDWADUMP+1                                               02532000
SDWADDAT EQU   SDWASNPA+4                                               02533000
SDWASDAT EQU   SDWADDAT                                                 02534000
SDWAPDAT EQU   SDWADDAT+2                                               02535000
SDWADPSA EQU   SDWA+328                                                 02536000
SDWADPSL EQU   SDWADPSA                                                 02537000
SDWARA   EQU   SDWA+400                                                 02538000
SDWADPVA EQU   SDWARA+2                                                 02539000
SDWAURAL EQU   SDWARA+3                                                 02540000
SDWAVRA  EQU   SDWARA+4                                                 02541000
SPDBFR   EQU   0                                                        02542000
SPDHDR   EQU   SPDBFR                                                   02543000
SPDDDNAM EQU   SPDHDR                                                   02544000
SPDABCCD EQU   SPDHDR+8                                                 02545000
SPDTRACE EQU   SPDBFR+9                                                 02546000
SPDTRRCD EQU   0                                                        02547000
SPDRCDHD EQU   SPDTRRCD                                                 02548000
SPDRCDLN EQU   SPDRCDHD                                                 02549000
SPDBLKID EQU   SPDRCDHD+1                                               02550000
SPDDATA1 EQU   SPDTRRCD+2                                               02551000
SPDBLKAD EQU   SPDDATA1                                                 02552000
SPDDATA2 EQU   SPDDATA1+4                                               02553000
TCBFIX   EQU   0                                                        02554000
TCBFRS   EQU   TCBFIX                                                   02555000
TCB      EQU   0                                                        02556000
TCBPIE   EQU   TCB+4                                                    02557000
TCBPMASK EQU   TCBPIE                                                   02558000
TCBTIO   EQU   TCB+12                                                   02559000
TCBCMP   EQU   TCB+16                                                   02560000
TCBCMPF  EQU   TCBCMP                                                   02561000
TCBCPP   EQU   TCBCMPF                                                  02562000
TCBSTCC  EQU   TCBCMPF                                                  02563000
TCBCDBL  EQU   TCBCMPF                                                  02564000
TCBCWTO  EQU   TCBCMPF                                                  02565000
TCBCIND  EQU   TCBCMPF                                                  02566000
TCBCMSG  EQU   TCBCMPF                                                  02567000
TCBTRN   EQU   TCB+20                                                   02568000
TCBABF   EQU   TCBTRN                                                   02569000
TCBMSS   EQU   TCB+24                                                   02570000
TCBPKF   EQU   TCB+28                                                   02571000
TCBFLGS  EQU   TCB+29                                                   02572000
TCBFLGS1 EQU   TCBFLGS                                                  02573000
TCBFLGS2 EQU   TCBFLGS+1                                                02574000
TCBFLGS3 EQU   TCBFLGS+2                                                02575000
TCBFLGS4 EQU   TCBFLGS+3                                                02576000
TCBFLGS5 EQU   TCBFLGS+4                                                02577000
TCBABWF  EQU   TCBFLGS5                                                 02578000
TCBJPQ   EQU   TCB+44                                                   02579000
TCBPURGE EQU   TCBJPQ                                                   02580000
TCBGRS   EQU   TCB+48                                                   02581000
TCBFSA   EQU   TCB+112                                                  02582000
TCBTME   EQU   TCB+120                                                  02583000
TCBJSTCB EQU   TCB+124                                                  02584000
TCBTSFLG EQU   TCB+148                                                  02585000
TCBTSTSK EQU   TCBTSFLG                                                 02586000
TCBSTAB  EQU   TCB+160                                                  02587000
TCBNSTAE EQU   TCBSTAB                                                  02588000
TCBTCT   EQU   TCB+164                                                  02589000
TCBTCTGF EQU   TCBTCT                                                   02590000
TCBSCNDY EQU   TCB+172                                                  02591000
TCBNDSP  EQU   TCBSCNDY                                                 02592000
TCBNDSP1 EQU   TCBNDSP+1                                                02593000
TCBNDSP2 EQU   TCBNDSP+2                                                02594000
TCBNDSP3 EQU   TCBNDSP+3                                                02595000
TCBJSCB  EQU   TCB+180                                                  02596000
TCBRECDE EQU   TCBJSCB                                                  02597000
TCBEXT1  EQU   TCB+196                                                  02598000
TCBBITS  EQU   TCB+200                                                  02599000
TCBNDSP4 EQU   TCBBITS                                                  02600000
TCBNDSP5 EQU   TCBBITS+1                                                02601000
TCBFLGS6 EQU   TCBBITS+2                                                02602000
TCBFLGS7 EQU   TCBBITS+3                                                02603000
TCBDAR   EQU   TCB+204                                                  02604000
TCBDARC  EQU   TCBDAR                                                   02605000
TCBEXT2  EQU   TCB+208                                                  02606000
TCBFOE   EQU   TCB+244                                                  02607000
TCBESTAE EQU   TCB+264                                                  02608000
TCBESTRM EQU   TCBESTAE+1                                               02609000
TCBFBYT1 EQU   TCB+276                                                  02610000
TCBFBYT2 EQU   TCB+277                                                  02611000
TCBRV124 EQU   TCB+278                                                  02612000
TCBRV133 EQU   TCB+279                                                  02613000
TCBXTNT2 EQU   0                                                        02614000
TCBGTF   EQU   TCBXTNT2                                                 02615000
TCBTFLG  EQU   TCBGTF                                                   02616000
TCBRV146 EQU   TCBXTNT2+28                                              02617000
TCBRV155 EQU   TCBXTNT2+29                                              02618000
TCBRV164 EQU   TCBXTNT2+30                                              02619000
TCBRV173 EQU   TCBXTNT2+31                                              02620000
TIOT1    EQU   0                                                        02621000
TIOCNJOB EQU   TIOT1                                                    02622000
TIOCSTEP EQU   TIOT1+8                                                  02623000
TIOENTRY EQU   0                                                        02624000
TIOESTTA EQU   TIOENTRY+1                                               02625000
TIOERLOC EQU   TIOENTRY+2                                               02626000
TIOELINK EQU   TIOERLOC+1                                               02627000
TIOESYOT EQU   TIOELINK                                                 02628000
TIOEDDNM EQU   TIOENTRY+4                                               02629000
TIOESTTC EQU   TIOENTRY+15                                              02630000
TIOESTTB EQU   TIOENTRY+16                                              02631000
POOLSTAR EQU   TIOENTRY+20                                              02632000
ASUBRTN  EQU   0                                                        02633000
EST2RET  EQU   0                                                        02634000
IKEBC    EQU   0                                                        02635000
IKEBF15  EQU   0                                                        02636000
IKEBF31  EQU   0                                                        02637000
IKEBP15  EQU   0                                                        02638000
IKEBP31  EQU   0                                                        02639000
IKEBP8   EQU   0                                                        02640000
SPDRDATA EQU   0                                                        02641000
CVTS01   EQU   CVTPGSIA                                                 02642000
CVTLPDIA EQU   CVTS01+12                                                02643000
CVTDIRST EQU   CVTLPDIA                                                 02644000
CVTSLIDA EQU   CVTS01+24                                                02645000
CVTCTLFG EQU   CVTS01+50                                                02646000
CVT0VL01 EQU   CVTS01+72                                                02647000
CVTCRMN  EQU   CVTS01+156                                               02648000
CVTRV210 EQU   CVTS01+424                                               02649000
CVTRV219 EQU   CVTS01+425                                               02650000
CVTRV228 EQU   CVTS01+426                                               02651000
CVTRV237 EQU   CVTS01+427                                               02652000
CVTMFRTR EQU   CVTS01+452                                               02653000
CVTRV262 EQU   CVTS01+468                                               02654000
CVTRV271 EQU   CVTS01+469                                               02655000
CVTRV280 EQU   CVTS01+470                                               02656000
CVTRV289 EQU   CVTS01+471                                               02657000
CVTGSDA  EQU   CVTS01+600                                               02658000
DEBBAS02 EQU   DEBBASND                                                 02659000
DEBDDS1  EQU   DEBBAS02                                                 02660000
DEBSUCBA EQU   DEBDDS1                                                  02661000
DEBRDCB  EQU   DEBDDS1+4                                                02662000
DEBPDCB  EQU   DEBDDS1+8                                                02663000
DEBWDCB  EQU   DEBDDS1+12                                               02664000
DEBBAS01 EQU   DEBBASND                                                 02665000
DEBISAM  EQU   DEBBAS01                                                 02666000
DEBFIEAD EQU   DEBISAM                                                  02667000
DEBFPEAD EQU   DEBISAM+4                                                02668000
DEBFOEAD EQU   DEBISAM+8                                                02669000
DEBEXPT  EQU   DEBISAM+12                                               02670000
DEBRPSID EQU   DEBEXPT                                                  02671000
DECBS05  EQU   DECNEXT                                                  02672000
IOBORG01 EQU   IOBPREFX+8                                               02673000
IOBNIOBA EQU   IOBORG01                                                 02674000
IOBNFLG1 EQU   IOBNIOBA                                                 02675000
IOBORG02 EQU   IOBPREFX+8                                               02676000
IOBDQADA EQU   IOBORG02                                                 02677000
IOBDEQIN EQU   IOBDQADA                                                 02678000
IOBORG03 EQU   IOBPREFX+12                                              02679000
IOBORG04 EQU   IOBINCAM                                                 02680000
IOBORG12 EQU   IOBINCAM                                                 02681000
IOBFL4   EQU   IOBORG12                                                 02682000
IOBEXTEN EQU   IOBSTDRD+32                                              02683000
IOBSEEK  EQU   IOBEXTEN                                                 02684000
IOBBB    EQU   IOBSEEK+1                                                02685000
IOBCC    EQU   IOBSEEK+3                                                02686000
IOBHH    EQU   IOBSEEK+5                                                02687000
IOBORG05 EQU   IOBEXTEN                                                 02688000
IOBORG06 EQU   IOBEXTEN                                                 02689000
IOBNXTPT EQU   IOBORG06+4                                               02690000
IOBSTATA EQU   IOBNXTPT                                                 02691000
IOBORG07 EQU   IOBEXTEN+8                                               02692000
W1IEXTEN EQU   IOBORG07                                                 02693000
IOBORG08 EQU   IOBEXTEN+8                                               02694000
IOBINDCT EQU   IOBORG08+4                                               02695000
IOBUNSQR EQU   IOBORG08+5                                               02696000
IOBFCHAD EQU   IOBORG08+8                                               02697000
IOBORG09 EQU   IOBEXTEN+8                                               02698000
IOBDIOBS EQU   IOBORG09+2                                               02699000
IOBDPLAD EQU   IOBORG09+4                                               02700000
IOBDTYPE EQU   IOBORG09+8                                               02701000
IOBDTYP2 EQU   IOBORG09+9                                               02702000
IOBDSTAT EQU   IOBORG09+10                                              02703000
IOBSTAT1 EQU   IOBDSTAT                                                 02704000
IOBORG10 EQU   IOBEXTEN+8                                               02705000
IOBSEEK2 EQU   IOBORG10                                                 02706000
IOBORG11 EQU   IOBEXTEN                                                 02707000
IOBERCT  EQU   IOBORG11                                                 02708000
IOBUCBXV EQU   IOBERCT                                                  02709000
IOBNAME  EQU   IOBORG11+4                                               02710000
PSARSVTE EQU   PSARSVT                                                  02711000
RBSECS03 EQU   RBEP                                                     02712000
RBCDE    EQU   RBSECS03                                                 02713000
RBCDFLGS EQU   RBCDE                                                    02714000
RBSECS05 EQU   RBPGMQ                                                   02715000
RBSQE    EQU   RBSECS05                                                 02716000
RBSECS06 EQU   RBPGMQ                                                   02717000
RBIQE    EQU   RBSECS06                                                 02718000
RBSECS07 EQU   RBPGMQ                                                   02719000
RBIQE2   EQU   RBSECS07                                                 02720000
RBSECS08 EQU   IRBEND                                                   02721000
RBSECS09 EQU   IRBEND                                                   02722000
TIOEDEVE EQU   TIOESTTB                                                 02723000
TIOSTTB  EQU   TIOEDEVE                                                 02724000
WKAREAX  EQU   RBEXSAVE                                                 02725000
WKASW1   EQU   WKAREAX                                                  02726000
WKALOCK  EQU   WKASW1                                                   02727000
WKADMP0C EQU   WKASW1                                                   02728000
WKADMP08 EQU   WKASW1                                                   02729000
WKADMP04 EQU   WKASW1                                                   02730000
WKATRALX EQU   WKAREAX+1                                                02731000
WKACLENX EQU   WKAREAX+3                                                02732000
WKATRXLG EQU   WKACLENX                                                 02733000
WKAIOBQX EQU   WKAREAX+8                                                02734000
WKANQARG EQU   WKAREAX+12                                               02735000
WKAXADDR EQU   WKAREAX+24                                               02736000
WKALST   EQU   WKAREAX+28                                               02737000
WKASVDEB EQU   WKALST                                                   02738000
WKADEBXC EQU   WKASVDEB                                                 02739000
WKANQLST EQU   WKALST+8                                                 02740000
WKATRACX EQU   WKANQLST                                                 02741000
SDWAWORK EQU   SDWAVRA                                                  02742000
MESSAGE  EQU   SDWAWORK                                                 02743000
RETCOD   EQU   MESSAGE+16                                               02744000
GTFLAG   EQU   RETCOD                                                   02745000
RCODE    EQU   RETCOD+1                                                 02746000
RETCOD2  EQU   MESSAGE+19                                               02747000
MSGJOB   EQU   MESSAGE+22                                               02748000
MSGSTEP  EQU   MESSAGE+31                                               02749000
MSGDDN   EQU   MESSAGE+40                                               02750000
SAVESDWA EQU   SDWAWORK+52                                              02751000
HEAD     EQU   MESSAGE                                                  02752000
HEADER   EQU   HEAD                                                     02753000
JOBNAME  EQU   HEADER+10                                                02754000
STEPNAME EQU   HEADER+19                                                02755000
SDUMPLST EQU   HEAD+27                                                  02756000
RECORDWK EQU   MESSAGE                                                  02757000
RECAUDIT EQU   RECORDWK                                                 02758000
RECRCDP  EQU   RECORDWK+1                                               02759000
RECRCLN  EQU   RECORDWK+2                                               02760000
RECREG0  EQU   RECORDWK+4                                               02761000
RECREG1  EQU   RECORDWK+8                                               02762000
RECOPSW  EQU   RECORDWK+12                                              02763000
RECPERC  EQU   RECORDWK+20                                              02764000
TRCLIST  EQU   WKATRACX                                                 02765000
FLC      EQU   PSA                                                      02766000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    02767000
@NM00163 EQU   RECORDWK+3                                               02768000
@NM00161 EQU   HEADER+18                                                02769000
@NM00160 EQU   HEADER+9                                                 02770000
MODNAME  EQU   HEADER+1                                                 02771000
HEADLEN  EQU   HEADER                                                   02772000
@NM00159 EQU   MESSAGE+48                                               02773000
@NM00158 EQU   MESSAGE+39                                               02774000
@NM00157 EQU   MESSAGE+30                                               02775000
@NM00156 EQU   MESSAGE+21                                               02776000
@NM00155 EQU   MESSAGE+18                                               02777000
@NM00154 EQU   MESSAGE+15                                               02778000
ABND     EQU   MESSAGE+12                                               02779000
@NM00153 EQU   MESSAGE+11                                               02780000
MSGNO    EQU   MESSAGE+4                                                02781000
@NM00152 EQU   MESSAGE                                                  02782000
@NM00151 EQU   WKANQLST+8                                               02783000
WKAQPREF EQU   WKALST+4                                                 02784000
@NM00150 EQU   WKASVDEB+1                                               02785000
WKARLCOR EQU   WKAREAX+20                                               02786000
WKASAV14 EQU   WKAREAX+4                                                02787000
WKASVKEY EQU   WKAREAX+2                                                02788000
@NM00149 EQU   WKASW1                                                   02789000
WKADEQRQ EQU   WKASW1                                                   02790000
WKAENQRQ EQU   WKASW1                                                   02791000
WKAD2305 EQU   WKASW1                                                   02792000
TIOUCBP  EQU   TIOEDEVE+1                                               02793000
TIOVERF  EQU   TIOSTTB                                                  02794000
TIOUNLD  EQU   TIOSTTB                                                  02795000
TIOMNTD  EQU   TIOSTTB                                                  02796000
TIOSETU  EQU   TIOSTTB                                                  02797000
TIOVLSR  EQU   TIOSTTB                                                  02798000
TIOPVIO  EQU   TIOSTTB                                                  02799000
TIOREQD  EQU   TIOSTTB                                                  02800000
TIOUSED  EQU   TIOSTTB                                                  02801000
RBRSV161 EQU   RBSECS09+64                                              02802000
RBSIRBWA EQU   RBSECS09                                                 02803000
RBIQEWRK EQU   RBSECS08+4                                               02804000
RBNEXAV  EQU   RBSECS08                                                 02805000
RBIQEA   EQU   RBIQE2                                                   02806000
RBIQE1   EQU   RBIQE+1                                                  02807000
RBUSE    EQU   RBIQE                                                    02808000
RBSQEA   EQU   RBSQE+1                                                  02809000
@NM00094 EQU   RBSQE                                                    02810000
RBCDE1   EQU   RBCDE+1                                                  02811000
RBCDLOAD EQU   RBCDFLGS                                                 02812000
RBCDXCTL EQU   RBCDFLGS                                                 02813000
RBCDSYNC EQU   RBCDFLGS                                                 02814000
RBCDNODE EQU   RBCDFLGS                                                 02815000
RBRSV010 EQU   RBCDFLGS                                                 02816000
RBCDATCH EQU   RBCDFLGS                                                 02817000
RBRSV009 EQU   RBCDFLGS                                                 02818000
RBNOCELL EQU   RBCDFLGS                                                 02819000
PSARSAV  EQU   PSARSVTE+60                                              02820000
PSARSTK  EQU   PSARSVTE+56                                              02821000
PSAESAV3 EQU   PSARSVTE+52                                              02822000
PSAESTK3 EQU   PSARSVTE+48                                              02823000
PSAESAV2 EQU   PSARSVTE+44                                              02824000
PSAESTK2 EQU   PSARSVTE+40                                              02825000
PSAESAV1 EQU   PSARSVTE+36                                              02826000
PSAESTK1 EQU   PSARSVTE+32                                              02827000
PSAPSAV  EQU   PSARSVTE+28                                              02828000
PSAPSTK  EQU   PSARSVTE+24                                              02829000
PSAMSAV  EQU   PSARSVTE+20                                              02830000
PSAMSTK  EQU   PSARSVTE+16                                              02831000
PSASSAV  EQU   PSARSVTE+12                                              02832000
PSASSTK  EQU   PSARSVTE+8                                               02833000
PSANSTK  EQU   PSARSVTE+4                                               02834000
PSACSTK  EQU   PSARSVTE                                                 02835000
IOBCSWSV EQU   IOBORG11+17                                              02836000
IOBSENSV EQU   IOBORG11+16                                              02837000
IOBRCD   EQU   IOBORG11+12                                              02838000
IOBMDREC EQU   IOBORG11+8                                               02839000
IOBNAMEA EQU   IOBNAME+1                                                02840000
IOBNAMSZ EQU   IOBNAME                                                  02841000
IOBERCTA EQU   IOBERCT+1                                                02842000
IOBRTYPE EQU   IOBUCBXV                                                 02843000
IOBRDCHP EQU   IOBORG10+20                                              02844000
IOBNEXTA EQU   IOBORG10+16                                              02845000
IOBREADA EQU   IOBORG10+12                                              02846000
IOBBUFC  EQU   IOBORG10+8                                               02847000
IOBSK2R  EQU   IOBSEEK2+7                                               02848000
IOBSK2HH EQU   IOBSEEK2+5                                               02849000
IOBSK2CC EQU   IOBSEEK2+3                                               02850000
IOBSK2BB EQU   IOBSEEK2+1                                               02851000
IOBSK2M  EQU   IOBSEEK2                                                 02852000
IOBCHNPR EQU   IOBORG09+40                                              02853000
IOBDNCRF EQU   IOBORG09+32                                              02854000
IOBRSV35 EQU   IOBORG09+24                                              02855000
IOBDQPTR EQU   IOBORG09+20                                              02856000
IOBRSV34 EQU   IOBORG09+18                                              02857000
IOBDBYTN EQU   IOBORG09+16                                              02858000
IOBDCPND EQU   IOBORG09+12                                              02859000
IOBSTAT2 EQU   IOBDSTAT+1                                               02860000
IOBSIORT EQU   IOBSTAT1                                                 02861000
IOBADDVU EQU   IOBSTAT1                                                 02862000
IOBBUFF  EQU   IOBSTAT1                                                 02863000
IOBENQUE EQU   IOBSTAT1                                                 02864000
IOBPASS2 EQU   IOBSTAT1                                                 02865000
IOBSYNCH EQU   IOBSTAT1                                                 02866000
IOBNEWVL EQU   IOBSTAT1                                                 02867000
IOBABNRM EQU   IOBSTAT1                                                 02868000
IOBRELEX EQU   IOBDTYP2                                                 02869000
IOBADDTY EQU   IOBDTYP2                                                 02870000
IOBTYPE  EQU   IOBDTYP2                                                 02871000
IOBRQUST EQU   IOBDTYP2                                                 02872000
IOBSUFFX EQU   IOBDTYP2                                                 02873000
IOBSBLKL EQU   IOBDTYP2                                                 02874000
IOBSKEY  EQU   IOBDTYP2                                                 02875000
IOBRELBL EQU   IOBDTYPE                                                 02876000
IOBRDEXC EQU   IOBDTYPE                                                 02877000
IOBDYNBF EQU   IOBDTYPE                                                 02878000
IOBACTAD EQU   IOBDTYPE                                                 02879000
IOBFDBCK EQU   IOBDTYPE                                                 02880000
IOBEXTSC EQU   IOBDTYPE                                                 02881000
IOBOVFLO EQU   IOBDTYPE                                                 02882000
IOBVERFY EQU   IOBDTYPE                                                 02883000
IOBDPLB  EQU   IOBDPLAD+1                                               02884000
IOBDAYLI EQU   IOBDPLAD                                                 02885000
IOBDBYTR EQU   IOBORG09                                                 02886000
IOBBCHAD EQU   IOBORG08+12                                              02887000
IOBFCHNB EQU   IOBFCHAD+1                                               02888000
IOBCOUNT EQU   IOBFCHAD                                                 02889000
IOBASYN  EQU   IOBORG08+7                                               02890000
IOBAPP   EQU   IOBORG08+6                                               02891000
IOBRSV32 EQU   IOBUNSQR                                                 02892000
IOBRSV31 EQU   IOBUNSQR                                                 02893000
IOBRSV30 EQU   IOBUNSQR                                                 02894000
IOBKNRWR EQU   IOBUNSQR                                                 02895000
IOBKNWR  EQU   IOBUNSQR                                                 02896000
IOBNTAV2 EQU   IOBUNSQR                                                 02897000
IOBNTAV1 EQU   IOBUNSQR                                                 02898000
IOBCPBSY EQU   IOBUNSQR                                                 02899000
IOBCHNNL EQU   IOBINDCT                                                 02900000
IOBRSV29 EQU   IOBINDCT                                                 02901000
IOBRSV28 EQU   IOBINDCT                                                 02902000
IOBRSV27 EQU   IOBINDCT                                                 02903000
IOBKEYAD EQU   IOBINDCT                                                 02904000
IOBOVPTR EQU   IOBINDCT                                                 02905000
IOBUNSCH EQU   IOBINDCT                                                 02906000
IOBDEQCP EQU   IOBINDCT                                                 02907000
IOBCCWAD EQU   IOBORG08                                                 02908000
W1OEXTEN EQU   W1IEXTEN                                                 02909000
IOBCCW   EQU   IOBORG06+8                                               02910000
IOBNXTPB EQU   IOBNXTPT+1                                               02911000
IOBRSV26 EQU   IOBSTATA                                                 02912000
IOBRSV25 EQU   IOBSTATA                                                 02913000
IOBRSV24 EQU   IOBSTATA                                                 02914000
IOBRSV23 EQU   IOBSTATA                                                 02915000
IOBRSV22 EQU   IOBSTATA                                                 02916000
IOBRSV21 EQU   IOBSTATA                                                 02917000
IOBRSV20 EQU   IOBSTATA                                                 02918000
IOBAVLFL EQU   IOBSTATA                                                 02919000
IOBRSV37 EQU   IOBORG06+1                                               02920000
IOBUCBXG EQU   IOBORG06                                                 02921000
IOBCPA   EQU   IOBORG05+32                                              02922000
IOBERINF EQU   IOBORG05+16                                              02923000
IOBERCCW EQU   IOBORG05+8                                               02924000
IOBSNDPT EQU   IOBORG05+7                                               02925000
IOBRCVPT EQU   IOBORG05+6                                               02926000
IOBWORK  EQU   IOBORG05+1                                               02927000
IOBUCBX  EQU   IOBORG05                                                 02928000
IOBR     EQU   IOBSEEK+7                                                02929000
IOBHH2   EQU   IOBHH+1                                                  02930000
IOBHH1   EQU   IOBHH                                                    02931000
IOBCC2   EQU   IOBCC+1                                                  02932000
IOBCC1   EQU   IOBCC                                                    02933000
IOBBB2   EQU   IOBBB+1                                                  02934000
IOBBB1   EQU   IOBBB                                                    02935000
IOBM     EQU   IOBSEEK                                                  02936000
IOBRSV46 EQU   IOBFL4                                                   02937000
IOBRSV47 EQU   IOBFL4                                                   02938000
IOBENT   EQU   IOBFL4                                                   02939000
IOBEQP   EQU   IOBFL4                                                   02940000
IOBBUS   EQU   IOBFL4                                                   02941000
IOBDCK   EQU   IOBFL4                                                   02942000
IOBREJ   EQU   IOBFL4                                                   02943000
IOBOVR   EQU   IOBFL4                                                   02944000
IOBCRILC EQU   IOBORG04+1                                               02945000
IOBCRDCC EQU   IOBORG04                                                 02946000
IOBGQECB EQU   IOBORG03                                                 02947000
IOBSWAP  EQU   IOBORG02+4                                               02948000
IOBDQADB EQU   IOBDQADA+1                                               02949000
IOBRSV13 EQU   IOBDEQIN                                                 02950000
IOBRSV12 EQU   IOBDEQIN                                                 02951000
IOBRSV11 EQU   IOBDEQIN                                                 02952000
IOBRSV10 EQU   IOBDEQIN                                                 02953000
IOBRSV09 EQU   IOBDEQIN                                                 02954000
IOBRSV08 EQU   IOBDEQIN                                                 02955000
IOBRSV07 EQU   IOBDEQIN                                                 02956000
IOBDEQ   EQU   IOBDEQIN                                                 02957000
IOBNECB  EQU   IOBORG01+4                                               02958000
IOBNIOBB EQU   IOBNIOBA+1                                               02959000
IOBFIRST EQU   IOBNFLG1                                                 02960000
IOBUPERR EQU   IOBNFLG1                                                 02961000
IOBSPAN  EQU   IOBNFLG1                                                 02962000
IOBBKSPC EQU   IOBNFLG1                                                 02963000
IOBUPDAT EQU   IOBNFLG1                                                 02964000
IOBREAD  EQU   IOBNFLG1                                                 02965000
IOBWRITE EQU   IOBNFLG1                                                 02966000
IOBPRTOV EQU   IOBNFLG1                                                 02967000
DECBLFMT EQU   DECBS05+8                                                02968000
DECBLNNM EQU   DECBS05+4                                                02969000
DECBHDRA EQU   DECBS05                                                  02970000
DEBEXPTA EQU   DEBEXPT+1                                                02971000
DEBRSV12 EQU   DEBRPSID                                                 02972000
DEBRSV11 EQU   DEBRPSID                                                 02973000
DEBRSV10 EQU   DEBRPSID                                                 02974000
DEBRSV09 EQU   DEBRPSID                                                 02975000
DEBRPSAP EQU   DEBRPSID                                                 02976000
DEBRPSO  EQU   DEBRPSID                                                 02977000
DEBRPSI  EQU   DEBRPSID                                                 02978000
DEBRPSP  EQU   DEBRPSID                                                 02979000
DEBFOEB  EQU   DEBFOEAD+1                                               02980000
DEBNOEE  EQU   DEBFOEAD                                                 02981000
DEBFPEB  EQU   DEBFPEAD+1                                               02982000
DEBNPEE  EQU   DEBFPEAD                                                 02983000
DEBFIEB  EQU   DEBFIEAD+1                                               02984000
DEBNIEE  EQU   DEBFIEAD                                                 02985000
DEBWDCBA EQU   DEBWDCB+1                                                02986000
DEBRSV08 EQU   DEBWDCB                                                  02987000
DEBPDCBA EQU   DEBPDCB+1                                                02988000
DEBRSV07 EQU   DEBPDCB                                                  02989000
DEBRDCBA EQU   DEBRDCB+1                                                02990000
DEBRSV06 EQU   DEBRDCB                                                  02991000
DEBSUCBB EQU   DEBSUCBA+1                                               02992000
DEBSDVM  EQU   DEBSUCBA                                                 02993000
CVTTPIO  EQU   CVTS01+608                                               02994000
CVTADV   EQU   CVTS01+604                                               02995000
CVTGSDAB EQU   CVTGSDA                                                  02996000
CVTQV3   EQU   CVTS01+596                                               02997000
CVTQV2   EQU   CVTS01+592                                               02998000
CVTQV1   EQU   CVTS01+588                                               02999000
CVTRPT   EQU   CVTS01+584                                               03000000
CVTSSRB  EQU   CVTS01+580                                               03001000
CVTCSDRL EQU   CVTS01+576                                               03002000
CVTEXP1  EQU   CVTS01+572                                               03003000
CVTRMPMT EQU   CVTS01+568                                               03004000
CVTRMPTT EQU   CVTS01+564                                               03005000
CVTVPSA  EQU   CVTS01+560                                               03006000
CVTVSTOP EQU   CVTS01+556                                               03007000
CVTGTFR8 EQU   CVTS01+552                                               03008000
CVTQUIT  EQU   CVTS01+548                                               03009000
CVTVACR  EQU   CVTS01+544                                               03010000
CVTWTCB  EQU   CVTS01+540                                               03011000
CVTSTPRS EQU   CVTS01+536                                               03012000
CVT0PT02 EQU   CVTS01+532                                               03013000
CVTDARCM EQU   CVTS01+528                                               03014000
CVTIRECM EQU   CVTS01+524                                               03015000
CVTJRECM EQU   CVTS01+520                                               03016000
CVTVEMS0 EQU   CVTS01+516                                               03017000
CVTSPFRR EQU   CVTS01+512                                               03018000
CVTRLSTG EQU   CVTS01+508                                               03019000
CVT0TC0A EQU   CVTS01+504                                               03020000
CVTGMBR  EQU   CVTS01+500                                               03021000
CVTLFRM  EQU   CVTS01+496                                               03022000
CVTRMBR  EQU   CVTS01+492                                               03023000
CVTVIOP  EQU   CVTS01+488                                               03024000
CVTRV307 EQU   CVTS01+486                                               03025000
CVTRV306 EQU   CVTS01+484                                               03026000
CVTRV305 EQU   CVTS01+482                                               03027000
CVTRV304 EQU   CVTS01+480                                               03028000
CVTRV303 EQU   CVTS01+478                                               03029000
CVTRV302 EQU   CVTS01+476                                               03030000
CVTRV301 EQU   CVTS01+475                                               03031000
CVTRV300 EQU   CVTS01+474                                               03032000
CVTRV299 EQU   CVTS01+473                                               03033000
CVTRV298 EQU   CVTS01+472                                               03034000
CVTRV297 EQU   CVTRV289                                                 03035000
CVTRV296 EQU   CVTRV289                                                 03036000
CVTRV295 EQU   CVTRV289                                                 03037000
CVTRV294 EQU   CVTRV289                                                 03038000
CVTRV293 EQU   CVTRV289                                                 03039000
CVTRV292 EQU   CVTRV289                                                 03040000
CVTRV291 EQU   CVTRV289                                                 03041000
CVTRV290 EQU   CVTRV289                                                 03042000
CVTRV288 EQU   CVTRV280                                                 03043000
CVTRV287 EQU   CVTRV280                                                 03044000
CVTRV286 EQU   CVTRV280                                                 03045000
CVTRV285 EQU   CVTRV280                                                 03046000
CVTRV284 EQU   CVTRV280                                                 03047000
CVTRV283 EQU   CVTRV280                                                 03048000
CVTRV282 EQU   CVTRV280                                                 03049000
CVTRV281 EQU   CVTRV280                                                 03050000
CVTRV279 EQU   CVTRV271                                                 03051000
CVTRV278 EQU   CVTRV271                                                 03052000
CVTRV277 EQU   CVTRV271                                                 03053000
CVTRV276 EQU   CVTRV271                                                 03054000
CVTRV275 EQU   CVTRV271                                                 03055000
CVTRV274 EQU   CVTRV271                                                 03056000
CVTRV273 EQU   CVTRV271                                                 03057000
CVTRV272 EQU   CVTRV271                                                 03058000
CVTRV270 EQU   CVTRV262                                                 03059000
CVTRV269 EQU   CVTRV262                                                 03060000
CVTRV268 EQU   CVTRV262                                                 03061000
CVTRV267 EQU   CVTRV262                                                 03062000
CVTRV266 EQU   CVTRV262                                                 03063000
CVTRV265 EQU   CVTRV262                                                 03064000
CVTRV264 EQU   CVTRV262                                                 03065000
CVTRV263 EQU   CVTRV262                                                 03066000
CVTVFP   EQU   CVTS01+464                                               03067000
CVTVSI   EQU   CVTS01+460                                               03068000
CVTVPSIB EQU   CVTS01+456                                               03069000
CVTMFACT EQU   CVTMFRTR                                                 03070000
CVTMFCTL EQU   CVTS01+448                                               03071000
CVTPVBP  EQU   CVTS01+444                                               03072000
CVTPWI   EQU   CVTS01+440                                               03073000
CVTRV254 EQU   CVTS01+438                                               03074000
CVTRV253 EQU   CVTS01+436                                               03075000
CVTRV252 EQU   CVTS01+434                                               03076000
CVTRV251 EQU   CVTS01+433                                               03077000
CVTRV250 EQU   CVTS01+432                                               03078000
CVTRV249 EQU   CVTS01+431                                               03079000
CVTRV248 EQU   CVTS01+430                                               03080000
CVTRV247 EQU   CVTS01+429                                               03081000
CVTRV246 EQU   CVTS01+428                                               03082000
CVTRV245 EQU   CVTRV237                                                 03083000
CVTRV244 EQU   CVTRV237                                                 03084000
CVTRV243 EQU   CVTRV237                                                 03085000
CVTRV242 EQU   CVTRV237                                                 03086000
CVTRV241 EQU   CVTRV237                                                 03087000
CVTRV240 EQU   CVTRV237                                                 03088000
CVTRV239 EQU   CVTRV237                                                 03089000
CVTRV238 EQU   CVTRV237                                                 03090000
CVTRV236 EQU   CVTRV228                                                 03091000
CVTRV235 EQU   CVTRV228                                                 03092000
CVTRV234 EQU   CVTRV228                                                 03093000
CVTRV233 EQU   CVTRV228                                                 03094000
CVTRV232 EQU   CVTRV228                                                 03095000
CVTRV231 EQU   CVTRV228                                                 03096000
CVTRV230 EQU   CVTRV228                                                 03097000
CVTRV229 EQU   CVTRV228                                                 03098000
CVTRV227 EQU   CVTRV219                                                 03099000
CVTRV226 EQU   CVTRV219                                                 03100000
CVTRV225 EQU   CVTRV219                                                 03101000
CVTRV224 EQU   CVTRV219                                                 03102000
CVTRV223 EQU   CVTRV219                                                 03103000
CVTRV222 EQU   CVTRV219                                                 03104000
CVTRV221 EQU   CVTRV219                                                 03105000
CVTRV220 EQU   CVTRV219                                                 03106000
CVTRV218 EQU   CVTRV210                                                 03107000
CVTRV217 EQU   CVTRV210                                                 03108000
CVTRV216 EQU   CVTRV210                                                 03109000
CVTRV215 EQU   CVTRV210                                                 03110000
CVTRV214 EQU   CVTRV210                                                 03111000
CVTRV213 EQU   CVTRV210                                                 03112000
CVTRV212 EQU   CVTRV210                                                 03113000
CVTRV211 EQU   CVTRV210                                                 03114000
CVTLCCAT EQU   CVTS01+420                                               03115000
CVTPCCAT EQU   CVTS01+416                                               03116000
CVTIPCRP EQU   CVTS01+412                                               03117000
CVTIPCRI EQU   CVTS01+408                                               03118000
CVTIPCDS EQU   CVTS01+404                                               03119000
CVTAIDVT EQU   CVTS01+400                                               03120000
CVTSSAP  EQU   CVTS01+396                                               03121000
CVTEHCIR EQU   CVTS01+392                                               03122000
CVTEHDEF EQU   CVTS01+388                                               03123000
CVTDAIR  EQU   CVTS01+384                                               03124000
CVTPERFM EQU   CVTS01+380                                               03125000
CVT044R2 EQU   CVTS01+376                                               03126000
CVTFETCH EQU   CVTS01+372                                               03127000
CVTRSTWD EQU   CVTS01+368                                               03128000
CVTSPOST EQU   CVTS01+364                                               03129000
CVTIOBP  EQU   CVTS01+360                                               03130000
CVTASMVT EQU   CVTS01+356                                               03131000
CVTRECRQ EQU   CVTS01+352                                               03132000
CVTWSAC  EQU   CVTS01+348                                               03133000
CVTRV149 EQU   CVTS01+344                                               03134000
CVTWSAL  EQU   CVTS01+340                                               03135000
CVTSPSA  EQU   CVTS01+336                                               03136000
CVTGLMN  EQU   CVTS01+332                                               03137000
CVTVEAC0 EQU   CVTS01+328                                               03138000
CVT062R1 EQU   CVTS01+324                                               03139000
CVTRPOST EQU   CVTS01+320                                               03140000
CVTDQIQE EQU   CVTS01+316                                               03141000
CVTCSD   EQU   CVTS01+312                                               03142000
CVTLKRMA EQU   CVTS01+308                                               03143000
CVTRSPIE EQU   CVTS01+304                                               03144000
CVTRENQ  EQU   CVTS01+300                                               03145000
CVTLQCB  EQU   CVTS01+296                                               03146000
CVTFQCB  EQU   CVTS01+292                                               03147000
CVTQCS01 EQU   CVTS01+288                                               03148000
CVTAPFT  EQU   CVTS01+284                                               03149000
CVTPARRL EQU   CVTS01+280                                               03150000
CVTVWAIT EQU   CVTS01+276                                               03151000
CVTGSPL  EQU   CVTS01+272                                               03152000
CVTLSMQ  EQU   CVTS01+268                                               03153000
CVTGSMQ  EQU   CVTS01+264                                               03154000
CVTEXPRO EQU   CVTS01+260                                               03155000
CVTOPCTP EQU   CVTS01+256                                               03156000
CVTSIC   EQU   CVTS01+252                                               03157000
CVTTPIOS EQU   CVTS01+248                                               03158000
CVTRTMS  EQU   CVTS01+244                                               03159000
CVTSDBF  EQU   CVTS01+240                                               03160000
CVTSCBP  EQU   CVTS01+236                                               03161000
CVTSDMP  EQU   CVTS01+232                                               03162000
CVTSV60  EQU   CVTS01+228                                               03163000
CVTRTMCT EQU   CVTS01+224                                               03164000
CVTASCBL EQU   CVTS01+220                                               03165000
CVTASCBH EQU   CVTS01+216                                               03166000
CVTGDA   EQU   CVTS01+212                                               03167000
CVTASVT  EQU   CVTS01+208                                               03168000
CVTVVMDI EQU   CVTS01+204                                               03169000
CVTAQTOP EQU   CVTS01+200                                               03170000
CVTIOSCS EQU   CVTS01+196                                               03171000
CVTSDRM  EQU   CVTS01+192                                               03172000
CVTOPTE  EQU   CVTS01+188                                               03173000
CVTSTXU  EQU   CVTS01+184                                               03174000
CVTQUIS  EQU   CVTS01+180                                               03175000
CVTPARS  EQU   CVTS01+176                                               03176000
CVTS1EE  EQU   CVTS01+172                                               03177000
CVTFRAS  EQU   CVTS01+168                                               03178000
CVTQSAS  EQU   CVTS01+164                                               03179000
CVTCRAS  EQU   CVTS01+160                                               03180000
CVTDELCP EQU   CVTS01+152                                               03181000
CVTFRECL EQU   CVTS01+148                                               03182000
CVTGETCL EQU   CVTS01+144                                               03183000
CVTBLDCP EQU   CVTS01+140                                               03184000
CVTAUTHL EQU   CVTS01+136                                               03185000
CVTSCAN  EQU   CVTS01+132                                               03186000
CVTRV144 EQU   CVTS01+130                                               03187000
CVTMAXMP EQU   CVTS01+128                                               03188000
CVTSTCK  EQU   CVTS01+124                                               03189000
CVTRV139 EQU   CVTS01+123                                               03190000
CVTDSSAC EQU   CVTS01+122                                               03191000
CVTRV513 EQU   CVTS01+121                                               03192000
CVTIOSPL EQU   CVTS01+120                                               03193000
CVTPTGT  EQU   CVTS01+116                                               03194000
CVTCSPIE EQU   CVTS01+112                                               03195000
CVTSMFEX EQU   CVTS01+108                                               03196000
CVTOLT0A EQU   CVTS01+104                                               03197000
CVTSRBRT EQU   CVTS01+100                                               03198000
CVTPUTL  EQU   CVTS01+96                                                03199000
CVTRV519 EQU   CVTS01+92                                                03200000
CVTRV327 EQU   CVTS01+88                                                03201000
CVTRV326 EQU   CVTS01+84                                                03202000
CVTRV325 EQU   CVTS01+80                                                03203000
CVTRV324 EQU   CVTS01+76                                                03204000
CVTSHRVM EQU   CVTS01+68                                                03205000
CVTRV332 EQU   CVTS01+64                                                03206000
CVTTAS   EQU   CVTS01+60                                                03207000
CVTRSCN  EQU   CVTS01+56                                                03208000
CVTTRAC2 EQU   CVTS01+54                                                03209000
CVTTRACE EQU   CVTS01+52                                                03210000
CVTAPG   EQU   CVTS01+51                                                03211000
CVTSDTRC EQU   CVTCTLFG                                                 03212000
CVTGTRCE EQU   CVTCTLFG                                                 03213000
CVTNOMP  EQU   CVTCTLFG                                                 03214000
CVTRSV79 EQU   CVTCTLFG                                                 03215000
CVTDSTAT EQU   CVTCTLFG                                                 03216000
CVTRSV78 EQU   CVTCTLFG                                                 03217000
CVTRV333 EQU   CVTCTLFG                                                 03218000
CVTRV323 EQU   CVTCTLFG                                                 03219000
CVTSPVLK EQU   CVTS01+49                                                03220000
CVTRSV77 EQU   CVTS01+48                                                03221000
CVTRV331 EQU   CVTS01+44                                                03222000
CVTRV330 EQU   CVTS01+40                                                03223000
CVTRV329 EQU   CVTS01+36                                                03224000
CVTRV328 EQU   CVTS01+32                                                03225000
CVTRV322 EQU   CVTS01+28                                                03226000
CVTSLID  EQU   CVTSLIDA+1                                               03227000
CVTSYLK  EQU   CVTSLIDA                                                 03228000
CVTRV321 EQU   CVTS01+20                                                03229000
CVTRV320 EQU   CVTS01+16                                                03230000
CVTLPDIR EQU   CVTLPDIA+1                                               03231000
CVTRSV69 EQU   CVTDIRST                                                 03232000
CVTRSV68 EQU   CVTDIRST                                                 03233000
CVTRSV67 EQU   CVTDIRST                                                 03234000
CVTRSV66 EQU   CVTDIRST                                                 03235000
CVTRSV65 EQU   CVTDIRST                                                 03236000
CVTRSV64 EQU   CVTDIRST                                                 03237000
CVTRSV63 EQU   CVTDIRST                                                 03238000
CVTDICOM EQU   CVTDIRST                                                 03239000
CVTPVTP  EQU   CVTS01+8                                                 03240000
CVTLPDSR EQU   CVTS01+4                                                 03241000
CVTGETL  EQU   CVTS01                                                   03242000
TIOTFEND EQU   POOLSTAR+16                                              03243000
TIOPSLOT EQU   POOLSTAR+13                                              03244000
TIOPSTTB EQU   POOLSTAR+12                                              03245000
TIOPPOOL EQU   POOLSTAR+4                                               03246000
TIOPNSRT EQU   POOLSTAR+3                                               03247000
@NM00148 EQU   POOLSTAR+2                                               03248000
TIOPNSLT EQU   POOLSTAR+1                                               03249000
@NM00147 EQU   POOLSTAR                                                 03250000
TIOEFSRT EQU   TIOENTRY+17                                              03251000
TIOSVERF EQU   TIOESTTB                                                 03252000
TIOSUNLD EQU   TIOESTTB                                                 03253000
TIOSMNTD EQU   TIOESTTB                                                 03254000
TIOSSETU EQU   TIOESTTB                                                 03255000
TIOSVLSR EQU   TIOESTTB                                                 03256000
TIOSPVIO EQU   TIOESTTB                                                 03257000
TIOSREQD EQU   TIOESTTB                                                 03258000
TIOSUSED EQU   TIOESTTB                                                 03259000
TIOSBALS EQU   TIOESTTC                                                 03260000
TIOSBALP EQU   TIOESTTC                                                 03261000
TIOSVOLS EQU   TIOESTTC                                                 03262000
TIOSVOLP EQU   TIOESTTC                                                 03263000
TIOSAFFS EQU   TIOESTTC                                                 03264000
TIOSAFFP EQU   TIOESTTC                                                 03265000
TIOSDEFR EQU   TIOESTTC                                                 03266000
TIOSDKCR EQU   TIOESTTC                                                 03267000
TIOEJFCB EQU   TIOENTRY+12                                              03268000
TIOTREM  EQU   TIOELINK                                                 03269000
TIOESSDS EQU   TIOESYOT                                                 03270000
TIOESYIN EQU   TIOELINK                                                 03271000
TIOEQNAM EQU   TIOELINK                                                 03272000
TIOEDYNM EQU   TIOELINK                                                 03273000
TIOTTERM EQU   TIOELINK                                                 03274000
TIOTRV01 EQU   TIOELINK                                                 03275000
TIOSYOUT EQU   TIOELINK                                                 03276000
TIOEWTCT EQU   TIOERLOC                                                 03277000
TIOSDSP2 EQU   TIOESTTA                                                 03278000
TIOSDSP1 EQU   TIOESTTA                                                 03279000
TIOSLABL EQU   TIOESTTA                                                 03280000
TIOSDADS EQU   TIOESTTA                                                 03281000
TIOSJBLB EQU   TIOESTTA                                                 03282000
TIOSPLTS EQU   TIOESTTA                                                 03283000
TIOSPLTP EQU   TIOESTTA                                                 03284000
TIOSLTYP EQU   TIOESTTA                                                 03285000
TIOELNGH EQU   TIOENTRY                                                 03286000
@NM00146 EQU   TCBXTNT2+32                                              03287000
TCBRV181 EQU   TCBRV173                                                 03288000
TCBRV180 EQU   TCBRV173                                                 03289000
TCBRV179 EQU   TCBRV173                                                 03290000
TCBRV178 EQU   TCBRV173                                                 03291000
TCBRV177 EQU   TCBRV173                                                 03292000
TCBRV176 EQU   TCBRV173                                                 03293000
TCBRV175 EQU   TCBRV173                                                 03294000
TCBRV174 EQU   TCBRV173                                                 03295000
TCBRV172 EQU   TCBRV164                                                 03296000
TCBRV171 EQU   TCBRV164                                                 03297000
TCBRV170 EQU   TCBRV164                                                 03298000
TCBRV169 EQU   TCBRV164                                                 03299000
TCBRV168 EQU   TCBRV164                                                 03300000
TCBRV167 EQU   TCBRV164                                                 03301000
TCBRV166 EQU   TCBRV164                                                 03302000
TCBRV165 EQU   TCBRV164                                                 03303000
TCBRV163 EQU   TCBRV155                                                 03304000
TCBRV162 EQU   TCBRV155                                                 03305000
TCBRV161 EQU   TCBRV155                                                 03306000
TCBRV160 EQU   TCBRV155                                                 03307000
TCBRV159 EQU   TCBRV155                                                 03308000
TCBRV158 EQU   TCBRV155                                                 03309000
TCBRV157 EQU   TCBRV155                                                 03310000
TCBRV156 EQU   TCBRV155                                                 03311000
TCBRV154 EQU   TCBRV146                                                 03312000
TCBRV153 EQU   TCBRV146                                                 03313000
TCBRV152 EQU   TCBRV146                                                 03314000
TCBRV151 EQU   TCBRV146                                                 03315000
TCBRV150 EQU   TCBRV146                                                 03316000
TCBRV149 EQU   TCBRV146                                                 03317000
TCBRV148 EQU   TCBRV146                                                 03318000
TCBRV147 EQU   TCBRV146                                                 03319000
TCBRV145 EQU   TCBXTNT2+26                                              03320000
TCBRV144 EQU   TCBXTNT2+24                                              03321000
TCBRV143 EQU   TCBXTNT2+20                                              03322000
TCBRV142 EQU   TCBXTNT2+16                                              03323000
TCBRSV49 EQU   TCBXTNT2+12                                              03324000
TCBRSV48 EQU   TCBXTNT2+8                                               03325000
TCBRCMP  EQU   TCBXTNT2+5                                               03326000
TCBRSVAB EQU   TCBXTNT2+4                                               03327000
TCBGTFA  EQU   TCBGTF+1                                                 03328000
TCBRSV47 EQU   TCBTFLG                                                  03329000
TCBRSV46 EQU   TCBTFLG                                                  03330000
TCBRSV45 EQU   TCBTFLG                                                  03331000
TCBRSV44 EQU   TCBTFLG                                                  03332000
TCBRSV43 EQU   TCBTFLG                                                  03333000
TCBDSPIT EQU   TCBTFLG                                                  03334000
TCBERRTN EQU   TCBTFLG                                                  03335000
TCBASYNC EQU   TCBTFLG                                                  03336000
@NM00145 EQU   TCB+296                                                  03337000
TCBRV185 EQU   TCB+292                                                  03338000
TCBSWASA EQU   TCB+288                                                  03339000
TCBDBTB  EQU   TCB+284                                                  03340000
TCBRPT   EQU   TCB+280                                                  03341000
TCBRV141 EQU   TCBRV133                                                 03342000
TCBRV140 EQU   TCBRV133                                                 03343000
TCBRV139 EQU   TCBRV133                                                 03344000
TCBRV138 EQU   TCBRV133                                                 03345000
TCBRV137 EQU   TCBRV133                                                 03346000
TCBRV136 EQU   TCBRV133                                                 03347000
TCBRV135 EQU   TCBRV133                                                 03348000
TCBRV134 EQU   TCBRV133                                                 03349000
TCBRV132 EQU   TCBRV124                                                 03350000
TCBRV131 EQU   TCBRV124                                                 03351000
TCBRV130 EQU   TCBRV124                                                 03352000
TCBRV129 EQU   TCBRV124                                                 03353000
TCBRV128 EQU   TCBRV124                                                 03354000
TCBRV127 EQU   TCBRV124                                                 03355000
TCBRV126 EQU   TCBRV124                                                 03356000
TCBRV125 EQU   TCBRV124                                                 03357000
TCBRV123 EQU   TCBFBYT2                                                 03358000
TCBRV122 EQU   TCBFBYT2                                                 03359000
TCBECBNV EQU   TCBFBYT2                                                 03360000
TCBSSSYN EQU   TCBFBYT2                                                 03361000
TCBFPRAP EQU   TCBFBYT2                                                 03362000
TCBFDW   EQU   TCBFBYT2                                                 03363000
TCBFMW   EQU   TCBFBYT2                                                 03364000
TCBCNCB  EQU   TCBFBYT2                                                 03365000
TCBLLH   EQU   TCBFBYT1                                                 03366000
TCBRV113 EQU   TCBFBYT1                                                 03367000
TCBEOT   EQU   TCBFBYT1                                                 03368000
TCBRTM2  EQU   TCBFBYT1                                                 03369000
TCBPGNLY EQU   TCBFBYT1                                                 03370000
TCBNDIOS EQU   TCBFBYT1                                                 03371000
TCBACTIV EQU   TCBFBYT1                                                 03372000
TCBEOTFM EQU   TCBFBYT1                                                 03373000
TCBAFFN  EQU   TCB+274                                                  03374000
TCBCCPVI EQU   TCB+272                                                  03375000
TCBUKYSP EQU   TCB+268                                                  03376000
TCBMODE  EQU   TCBESTAE+3                                               03377000
TCBERTYP EQU   TCBESTAE+2                                               03378000
TCBRV314 EQU   TCBESTRM                                                 03379000
TCBRV313 EQU   TCBESTRM                                                 03380000
TCBRV312 EQU   TCBESTRM                                                 03381000
TCBRV311 EQU   TCBESTRM                                                 03382000
TCBRV310 EQU   TCBESTRM                                                 03383000
TCBRV309 EQU   TCBESTRM                                                 03384000
TCBRV308 EQU   TCBESTRM                                                 03385000
TCBETERM EQU   TCBESTRM                                                 03386000
TCBSCBKY EQU   TCBESTAE                                                 03387000
TCBRTM12 EQU   TCB+260                                                  03388000
TCBTCBID EQU   TCB+256                                                  03389000
TCBRSV96 EQU   TCB+252                                                  03390000
TCBSWA   EQU   TCB+248                                                  03391000
TCBFOEA  EQU   TCBFOE+1                                                 03392000
TCBRSV42 EQU   TCBFOE                                                   03393000
TCBRV306 EQU   TCB+240                                                  03394000
TCBRSV41 EQU   TCB+239                                                  03395000
TCBTID   EQU   TCB+238                                                  03396000
TCBRSVAA EQU   TCB+237                                                  03397000
TCBABCUR EQU   TCB+236                                                  03398000
TCBTMSAV EQU   TCB+232                                                  03399000
TCBIOTIM EQU   TCB+228                                                  03400000
TCBRTWA  EQU   TCB+224                                                  03401000
TCBBACK  EQU   TCB+220                                                  03402000
TCBTIRB  EQU   TCB+216                                                  03403000
TCBAECB  EQU   TCB+212                                                  03404000
TCBEXT2A EQU   TCBEXT2+1                                                03405000
TCBRSV39 EQU   TCBEXT2                                                  03406000
TCBSTMCT EQU   TCB+207                                                  03407000
TCBSYSCT EQU   TCB+206                                                  03408000
TCBRSV37 EQU   TCB+205                                                  03409000
TCBEXSVC EQU   TCBDAR                                                   03410000
TCBRSV36 EQU   TCBDAR                                                   03411000
TCBDARWT EQU   TCBDAR                                                   03412000
TCBDARO  EQU   TCBDAR                                                   03413000
TCBDARMC EQU   TCBDARC                                                  03414000
TCBDARD  EQU   TCBDAR                                                   03415000
TCBDARS  EQU   TCBDAR                                                   03416000
TCBDARP  EQU   TCBDAR                                                   03417000
TCBGTOFM EQU   TCBFLGS7                                                 03418000
TCBADMP  EQU   TCBFLGS7                                                 03419000
TCBRSTSK EQU   TCBFLGS7                                                 03420000
TCBRSV35 EQU   TCBFLGS7                                                 03421000
TCBSTACK EQU   TCBFLGS7                                                 03422000
TCBRSV34 EQU   TCBFLGS7                                                 03423000
TCBRSV33 EQU   TCBFLGS7                                                 03424000
TCBGPECB EQU   TCBFLGS7                                                 03425000
TCBNTJS  EQU   TCBFLGS6                                                 03426000
TCBAPG   EQU   TCBFLGS6                                                 03427000
TCBMIGR  EQU   TCBFLGS6                                                 03428000
TCBRV303 EQU   TCBFLGS6                                                 03429000
TCBSPVLK EQU   TCBFLGS6                                                 03430000
TCBCPU   EQU   TCBFLGS6                                                 03431000
TCBPIE17 EQU   TCBFLGS6                                                 03432000
TCBRV    EQU   TCBFLGS6                                                 03433000
TCBRSV79 EQU   TCBNDSP5                                                 03434000
TCBRSV78 EQU   TCBNDSP5                                                 03435000
TCBRSV77 EQU   TCBNDSP5                                                 03436000
TCBRSV76 EQU   TCBNDSP5                                                 03437000
TCBRSV75 EQU   TCBNDSP5                                                 03438000
TCBRSV74 EQU   TCBNDSP5                                                 03439000
TCBRSV95 EQU   TCBNDSP5                                                 03440000
TCBRSV94 EQU   TCBNDSP5                                                 03441000
TCBRSV93 EQU   TCBNDSP4                                                 03442000
TCBRSV92 EQU   TCBNDSP4                                                 03443000
TCBRSV91 EQU   TCBNDSP4                                                 03444000
TCBRSV90 EQU   TCBNDSP4                                                 03445000
TCBRSV89 EQU   TCBNDSP4                                                 03446000
TCBRSV88 EQU   TCBNDSP4                                                 03447000
TCBRSV87 EQU   TCBNDSP4                                                 03448000
TCBRSV86 EQU   TCBNDSP4                                                 03449000
TCBEXT1A EQU   TCBEXT1+1                                                03450000
TCBRSV32 EQU   TCBEXT1                                                  03451000
TCBEXCPD EQU   TCB+192                                                  03452000
TCBIOBRC EQU   TCB+188                                                  03453000
TCBDDWTC EQU   TCB+186                                                  03454000
TCBDDEXC EQU   TCB+184                                                  03455000
TCBJSCBB EQU   TCBJSCB+1                                                03456000
@NM00144 EQU   TCBRECDE                                                 03457000
TCBREC   EQU   TCBRECDE                                                 03458000
TCBMDIDS EQU   TCB+176                                                  03459000
TCBNDINT EQU   TCBNDSP3                                                 03460000
TCBRSV27 EQU   TCBNDSP3                                                 03461000
TCBRSV26 EQU   TCBNDSP3                                                 03462000
TCBRSV25 EQU   TCBNDSP3                                                 03463000
TCBRSV24 EQU   TCBNDSP3                                                 03464000
TCBSRBND EQU   TCBNDSP3                                                 03465000
TCBRV302 EQU   TCBNDSP3                                                 03466000
TCBLJSND EQU   TCBNDSP3                                                 03467000
TCBABE   EQU   TCBNDSP2                                                 03468000
TCBDSS   EQU   TCBNDSP2                                                 03469000
TCBOWAIT EQU   TCBNDSP2                                                 03470000
TCBIWAIT EQU   TCBNDSP2                                                 03471000
TCBNDTS  EQU   TCBNDSP2                                                 03472000
TCBNDSVC EQU   TCBNDSP2                                                 03473000
TCBSTPP  EQU   TCBNDSP2                                                 03474000
TCBABD   EQU   TCBNDSP2                                                 03475000
TCBRSV22 EQU   TCBNDSP1                                                 03476000
TCBPIEND EQU   TCBNDSP1                                                 03477000
TCBTPSP  EQU   TCBNDSP1                                                 03478000
TCBDDRND EQU   TCBNDSP1                                                 03479000
TCBRSPND EQU   TCBNDSP1                                                 03480000
TCBRSTND EQU   TCBNDSP1                                                 03481000
TCBDARPN EQU   TCBNDSP1                                                 03482000
TCBDARTN EQU   TCBNDSP1                                                 03483000
TCBNDSP0 EQU   TCBNDSP                                                  03484000
TCBUSER  EQU   TCB+168                                                  03485000
TCBTCTB  EQU   TCBTCT+1                                                 03486000
TCBRSV9C EQU   TCBTCTGF                                                 03487000
TCBRSV9B EQU   TCBTCTGF                                                 03488000
TCBRSV9A EQU   TCBTCTGF                                                 03489000
TCBRSV99 EQU   TCBTCTGF                                                 03490000
TCBRSV98 EQU   TCBTCTGF                                                 03491000
TCBRSV97 EQU   TCBTCTGF                                                 03492000
TCBRSV20 EQU   TCBTCTGF                                                 03493000
TCBSMFGF EQU   TCBTCTGF                                                 03494000
TCBSTABB EQU   TCBSTAB+1                                                03495000
TCBSTCUR EQU   TCBNSTAE                                                 03496000
TCBRV301 EQU   TCBNSTAE                                                 03497000
TCBSYNCH EQU   TCBNSTAE                                                 03498000
TCBHALT  EQU   TCBNSTAE                                                 03499000
TCBPPSUP EQU   TCBNSTAE                                                 03500000
TCB33E   EQU   TCBNSTAE                                                 03501000
TCBQUIES EQU   TCBNSTAE                                                 03502000
TCBSTABE EQU   TCBNSTAE                                                 03503000
TCBAQE   EQU   TCB+156                                                  03504000
TCBPQE   EQU   TCB+152                                                  03505000
TCBTSDP  EQU   TCB+151                                                  03506000
TCBTSLP  EQU   TCB+150                                                  03507000
TCBSTPCT EQU   TCB+149                                                  03508000
TCBCPUBN EQU   TCBTSFLG                                                 03509000
TCBDYDSP EQU   TCBTSFLG                                                 03510000
TCBRSV18 EQU   TCBTSFLG                                                 03511000
TCBRSV17 EQU   TCBTSFLG                                                 03512000
TCBTIOTG EQU   TCBTSFLG                                                 03513000
TCBATT   EQU   TCBTSFLG                                                 03514000
TCBSTPPR EQU   TCBTSFLG                                                 03515000
TCBRV300 EQU   TCBTSTSK                                                 03516000
TCBECB   EQU   TCB+144                                                  03517000
TCBIQE   EQU   TCB+140                                                  03518000
TCBLTC   EQU   TCB+136                                                  03519000
TCBOTC   EQU   TCB+132                                                  03520000
TCBNTC   EQU   TCB+128                                                  03521000
TCBJSTCA EQU   TCBJSTCB+1                                               03522000
TCBRSV16 EQU   TCBJSTCB                                                 03523000
TCBTQET  EQU   TCBTME                                                   03524000
TCBTCB   EQU   TCB+116                                                  03525000
TCBFSAB  EQU   TCBFSA+1                                                 03526000
TCBQEL   EQU   TCBFSA                                                   03527000
TCBGRS15 EQU   TCBGRS+60                                                03528000
TCBGRS14 EQU   TCBGRS+56                                                03529000
TCBGRS13 EQU   TCBGRS+52                                                03530000
TCBGRS12 EQU   TCBGRS+48                                                03531000
TCBGRS11 EQU   TCBGRS+44                                                03532000
TCBGRS10 EQU   TCBGRS+40                                                03533000
TCBGRS9  EQU   TCBGRS+36                                                03534000
TCBGRS8  EQU   TCBGRS+32                                                03535000
TCBGRS7  EQU   TCBGRS+28                                                03536000
TCBGRS6  EQU   TCBGRS+24                                                03537000
TCBGRS5  EQU   TCBGRS+20                                                03538000
TCBGRS4  EQU   TCBGRS+16                                                03539000
TCBGRS3  EQU   TCBGRS+12                                                03540000
TCBGRS2  EQU   TCBGRS+8                                                 03541000
TCBGRS1  EQU   TCBGRS+4                                                 03542000
TCBGRS0  EQU   TCBGRS                                                   03543000
TCBJPQB  EQU   TCBJPQ+1                                                 03544000
TCBRSV15 EQU   TCBPURGE                                                 03545000
TCBRSV14 EQU   TCBPURGE                                                 03546000
TCBRSV13 EQU   TCBPURGE                                                 03547000
TCBRSV12 EQU   TCBPURGE                                                 03548000
TCBRSV11 EQU   TCBPURGE                                                 03549000
TCBRSV10 EQU   TCBPURGE                                                 03550000
TCBRSV09 EQU   TCBPURGE                                                 03551000
TCBJPQF  EQU   TCBPURGE                                                 03552000
TCBJLB   EQU   TCB+40                                                   03553000
TCBLLS   EQU   TCB+36                                                   03554000
TCBDSP   EQU   TCB+35                                                   03555000
TCBLMP   EQU   TCB+34                                                   03556000
TCBPNDSP EQU   TCBFLGS5                                                 03557000
TCBFCD1  EQU   TCBFLGS5                                                 03558000
TCBSTP   EQU   TCBFLGS5                                                 03559000
TCBSYS   EQU   TCBFLGS5                                                 03560000
TCBANDSP EQU   TCBFLGS5                                                 03561000
TCBPAGE  EQU   TCBFLGS5                                                 03562000
TCBUXNDF EQU   TCBABWF                                                  03563000
TCBFC    EQU   TCBFLGS5                                                 03564000
TCBONDSP EQU   TCBFLGS4                                                 03565000
TCBMPCND EQU   TCBFLGS4                                                 03566000
TCBMPCVQ EQU   TCBFLGS4                                                 03567000
TCBUXNDV EQU   TCBFLGS4                                                 03568000
TCBHNDSP EQU   TCBFLGS4                                                 03569000
TCBRQENA EQU   TCBFLGS4                                                 03570000
TCBSER   EQU   TCBFLGS4                                                 03571000
TCBNDUMP EQU   TCBFLGS4                                                 03572000
TCBDWSTA EQU   TCBFLGS3                                                 03573000
TCBRSV08 EQU   TCBFLGS3                                                 03574000
TCBRSV07 EQU   TCBFLGS3                                                 03575000
TCBRSV06 EQU   TCBFLGS3                                                 03576000
TCBABGM  EQU   TCBFLGS3                                                 03577000
TCBABTRM EQU   TCBFLGS3                                                 03578000
TCBADINP EQU   TCBFLGS3                                                 03579000
TCBFSM   EQU   TCBFLGS3                                                 03580000
TCBFTS   EQU   TCBFLGS2                                                 03581000
TCBFETXR EQU   TCBFLGS2                                                 03582000
TCBFDSOP EQU   TCBFLGS2                                                 03583000
TCBFJMC  EQU   TCBFLGS2                                                 03584000
TCBFSMC  EQU   TCBFLGS2                                                 03585000
TCBFABOP EQU   TCBFLGS2                                                 03586000
TCBFSTI  EQU   TCBFLGS2                                                 03587000
TCBFOINP EQU   TCBFLGS2                                                 03588000
TCBFX    EQU   TCBFLGS1                                                 03589000
TCBFS    EQU   TCBFLGS1                                                 03590000
TCBFT    EQU   TCBFLGS1                                                 03591000
TCBPDUMP EQU   TCBFLGS1                                                 03592000
TCBRSV04 EQU   TCBFLGS1                                                 03593000
TCBFERA  EQU   TCBFLGS1                                                 03594000
TCBFE    EQU   TCBFLGS1                                                 03595000
TCBFA    EQU   TCBFLGS1                                                 03596000
TCBZERO  EQU   TCBPKF                                                   03597000
TCBFLAG  EQU   TCBPKF                                                   03598000
TCBMSSB  EQU   TCBMSS+1                                                 03599000
TCBRSV03 EQU   TCBMSS                                                   03600000
TCBTRNB  EQU   TCBTRN+1                                                 03601000
TCBRSV02 EQU   TCBABF                                                   03602000
TCBOLTEP EQU   TCBABF                                                   03603000
TCBTCP   EQU   TCBABF                                                   03604000
TCBTCPP  EQU   TCBABF                                                   03605000
TCBRSV01 EQU   TCBABF                                                   03606000
TCBGRPH  EQU   TCBABF                                                   03607000
TCBNOCHK EQU   TCBABF                                                   03608000
TCBMOD91 EQU   TCBABF                                                   03609000
TCBCMPC  EQU   TCBCMP+1                                                 03610000
TCBRV318 EQU   TCBCMSG                                                  03611000
TCBRV317 EQU   TCBCIND                                                  03612000
TCBRV316 EQU   TCBCWTO                                                  03613000
TCBCASID EQU   TCBCDBL                                                  03614000
TCBNOCC  EQU   TCBSTCC                                                  03615000
TCBDMPO  EQU   TCBCPP                                                   03616000
TCBCSTEP EQU   TCBCMPF                                                  03617000
TCBCREQ  EQU   TCBCMPF                                                  03618000
TCBDEB   EQU   TCB+8                                                    03619000
TCBPIEA  EQU   TCBPIE+1                                                 03620000
TCBPM    EQU   TCBPMASK                                                 03621000
@NM00143 EQU   TCBPMASK                                                 03622000
TCBRBP   EQU   TCB                                                      03623000
TCBFRS6  EQU   TCBFRS+24                                                03624000
TCBFRS4  EQU   TCBFRS+16                                                03625000
TCBFRS2  EQU   TCBFRS+8                                                 03626000
TCBFRS0  EQU   TCBFRS                                                   03627000
SPDPTRSW EQU   SPDBLKID                                                 03628000
@NM00142 EQU   SDWA+512                                                 03629000
@NM00141 EQU   SDWADPVA                                                 03630000
SDWAEBC  EQU   SDWADPVA                                                 03631000
SDWAHEX  EQU   SDWADPVA                                                 03632000
SDWAVRAL EQU   SDWARA                                                   03633000
@NM00140 EQU   SDWA+396                                                 03634000
SDWACOMP EQU   SDWA+392                                                 03635000
SDWARCPL EQU   SDWA+364                                                 03636000
@NM00139 EQU   SDWADPSA+32                                              03637000
SDWATO4  EQU   SDWADPSL+28                                              03638000
SDWAFRM4 EQU   SDWADPSL+24                                              03639000
SDWATO3  EQU   SDWADPSL+20                                              03640000
SDWAFRM3 EQU   SDWADPSL+16                                              03641000
SDWATO2  EQU   SDWADPSL+12                                              03642000
SDWAFRM2 EQU   SDWADPSL+8                                               03643000
SDWATO1  EQU   SDWADPSL+4                                               03644000
SDWAFRM1 EQU   SDWADPSL                                                 03645000
@NM00138 EQU   SDWADDAT+3                                               03646000
@NM00137 EQU   SDWAPDAT                                                 03647000
SDWAUSPL EQU   SDWAPDAT                                                 03648000
SDWADPSW EQU   SDWAPDAT                                                 03649000
SDWATJPA EQU   SDWAPDAT                                                 03650000
SDWATLPA EQU   SDWAPDAT                                                 03651000
SDWADREG EQU   SDWAPDAT                                                 03652000
SDWADSAH EQU   SDWAPDAT                                                 03653000
SDWADSAS EQU   SDWAPDAT                                                 03654000
@NM00136 EQU   SDWADDAT+1                                               03655000
@NM00135 EQU   SDWASDAT                                                 03656000
SDWAQQS  EQU   SDWASDAT                                                 03657000
SDWACBS  EQU   SDWASDAT                                                 03658000
SDWAGTF  EQU   SDWASDAT                                                 03659000
SDWASWA  EQU   SDWASDAT                                                 03660000
SDWALSQA EQU   SDWASDAT                                                 03661000
SDWASQA  EQU   SDWASDAT                                                 03662000
SDWANUC  EQU   SDWASDAT                                                 03663000
@NM00134 EQU   SDWADUMP+2                                               03664000
@NM00133 EQU   SDWADPFS                                                 03665000
SDWASLST EQU   SDWADPFS                                                 03666000
@NM00132 EQU   SDWADPFS                                                 03667000
SDWADLST EQU   SDWADPFS                                                 03668000
SDWADPT  EQU   SDWADPFS                                                 03669000
SDWADPID EQU   SDWADUMP                                                 03670000
SDWADPLA EQU   SDWA+316                                                 03671000
SDWAREXN EQU   SDWARECP+16                                              03672000
SDWACSCT EQU   SDWARECP+8                                               03673000
SDWAMODN EQU   SDWARECP                                                 03674000
@NM00131 EQU   SDWALKWA+32                                              03675000
SDWATALW EQU   SDWALKWS+28                                              03676000
SDWATDLW EQU   SDWALKWS+24                                              03677000
SDWATNLW EQU   SDWALKWS+20                                              03678000
SDWAAPLW EQU   SDWALKWS+16                                              03679000
SDWAIPLW EQU   SDWALKWS+12                                              03680000
SDWAILLW EQU   SDWALKWS+8                                               03681000
SDWAIULW EQU   SDWALKWS+4                                               03682000
SDWAICLW EQU   SDWALKWS                                                 03683000
SDWAFLLK EQU   SDWAACF4                                                 03684000
SDWACMS  EQU   SDWAACF4                                                 03685000
SDWAOPTM EQU   SDWAACF4                                                 03686000
SDWATADB EQU   SDWAACF4                                                 03687000
SDWATDNB EQU   SDWAACF4                                                 03688000
SDWATNCB EQU   SDWAACF4                                                 03689000
SDWAILCH EQU   SDWAACF4                                                 03690000
SDWAIUCB EQU   SDWAACF4                                                 03691000
SDWAICAT EQU   SDWAACF3                                                 03692000
SDWAIPRG EQU   SDWAACF3                                                 03693000
SDWASALL EQU   SDWAACF3                                                 03694000
SDWAASMP EQU   SDWAACF3                                                 03695000
SDWADISP EQU   SDWAACF3                                                 03696000
@NM00130 EQU   SDWAACF3                                                 03697000
@NM00129 EQU   SDWAACF2                                                 03698000
@NM00128 EQU   SDWAACF2                                                 03699000
SDWASPIN EQU   SDWAACF2                                                 03700000
@NM00127 EQU   SDWAACF2                                                 03701000
SDWALCPU EQU   SDWACPUA+2                                               03702000
@NM00126 EQU   SDWACPUA                                                 03703000
SDWARECA EQU   SDWA+244                                                 03704000
@NM00125 EQU   SDWA+239                                                 03705000
@NM00124 EQU   SDWAIOFS                                                 03706000
SDWANIOP EQU   SDWAIOFS                                                 03707000
SDWANOIO EQU   SDWAIOFS                                                 03708000
SDWAIOHT EQU   SDWAIOFS                                                 03709000
SDWAIOQR EQU   SDWAIOFS                                                 03710000
SDWAFMID EQU   SDWA+236                                                 03711000
@NM00123 EQU   SDWAERRD                                                 03712000
SDWAMCIV EQU   SDWAERRD                                                 03713000
SDWARPIV EQU   SDWAERRD                                                 03714000
SDWAMABD EQU   SDWAERRD                                                 03715000
SDWACTS  EQU   SDWAERRD                                                 03716000
SDWASTAE EQU   SDWAERRD                                                 03717000
SDWANRBE EQU   SDWAERRD                                                 03718000
@NM00122 EQU   SDWAERRC                                                 03719000
SDWAPERC EQU   SDWAERRC                                                 03720000
SDWAIRB  EQU   SDWAERRC                                                 03721000
SDWASTAI EQU   SDWAERRC                                                 03722000
SDWASRBM EQU   SDWAERRB                                                 03723000
SDWALDIS EQU   SDWAERRB                                                 03724000
SDWAENRB EQU   SDWAERRB                                                 03725000
SDWATYP1 EQU   SDWAERRB                                                 03726000
@NM00121 EQU   SDWAERRB                                                 03727000
SDWASVCE EQU   SDWAERRA                                                 03728000
SDWAABTM EQU   SDWAERRA                                                 03729000
SDWASVCD EQU   SDWAERRA                                                 03730000
SDWARKEY EQU   SDWAERRA                                                 03731000
SDWAPCHK EQU   SDWAERRA                                                 03732000
SDWATIME EQU   SDWAMCH+20                                               03733000
SDWARFSA EQU   SDWAMCH+16                                               03734000
@NM00120 EQU   SDWAMCH+14                                               03735000
SDWAVEQR EQU   SDWARSR2                                                 03736000
SDWAPGFX EQU   SDWARSR2                                                 03737000
SDWAFLSQ EQU   SDWARSR2                                                 03738000
SDWAFSQA EQU   SDWARSR2                                                 03739000
SDWANUCL EQU   SDWARSR2                                                 03740000
SDWASPER EQU   SDWARSR2                                                 03741000
SDWAINTC EQU   SDWARSR2                                                 03742000
SDWAOFLN EQU   SDWARSR2                                                 03743000
SDWACHNG EQU   SDWARSR1                                                 03744000
SDWAMSER EQU   SDWARSR1                                                 03745000
@NM00119 EQU   SDWARSR1                                                 03746000
SDWACPID EQU   SDWAMCH+10                                               03747000
SDWATERR EQU   SDWAMCHD                                                 03748000
SDWAFPRX EQU   SDWAMCHD                                                 03749000
SDWAINSF EQU   SDWAMCHD                                                 03750000
SDWAACR  EQU   SDWAMCHD                                                 03751000
SDWASCK  EQU   SDWAMCHD                                                 03752000
SDWAPSWU EQU   SDWAMCHD                                                 03753000
SDWAREGU EQU   SDWAMCHD                                                 03754000
SDWASKYF EQU   SDWAMCHD                                                 03755000
@NM00118 EQU   SDWAMCHS                                                 03756000
SDWARSRF EQU   SDWAMCHS                                                 03757000
SDWARSRC EQU   SDWAMCHS                                                 03758000
SDWAINVP EQU   SDWAMCHS                                                 03759000
SDWATSVL EQU   SDWAMCHS                                                 03760000
SDWARCDF EQU   SDWAMCHS                                                 03761000
SDWASRVL EQU   SDWAMCHS                                                 03762000
SDWASCKE EQU   SDWASTCK+4                                               03763000
SDWASCKB EQU   SDWASTCK                                                 03764000
SDWALNTH EQU   SDWAIDNT+1                                               03765000
SDWASPID EQU   SDWAIDNT                                                 03766000
SDWASR15 EQU   SDWASRSV+60                                              03767000
SDWASR14 EQU   SDWASRSV+56                                              03768000
SDWASR13 EQU   SDWASRSV+52                                              03769000
SDWASR12 EQU   SDWASRSV+48                                              03770000
SDWASR11 EQU   SDWASRSV+44                                              03771000
SDWASR10 EQU   SDWASRSV+40                                              03772000
SDWASR06 EQU   SDWASRSV+24                                              03773000
SDWASR05 EQU   SDWASRSV+20                                              03774000
SDWASR04 EQU   SDWASRSV+16                                              03775000
SDWASR03 EQU   SDWASRSV+12                                              03776000
SDWASR02 EQU   SDWASRSV+8                                               03777000
SDWASR01 EQU   SDWASRSV+4                                               03778000
SDWATRN2 EQU   SDWAAEC2+4                                               03779000
SDWAIPC2 EQU   SDWAICD2                                                 03780000
SDWAIMC2 EQU   SDWAICD2                                                 03781000
SDWAIPR2 EQU   SDWAICD2                                                 03782000
@NM00117 EQU   SDWAINC2                                                 03783000
@NM00116 EQU   SDWAILC2                                                 03784000
SDWAIL2  EQU   SDWAILC2                                                 03785000
@NM00115 EQU   SDWAILC2                                                 03786000
@NM00114 EQU   SDWAAEC2                                                 03787000
SDWAADD2 EQU   SDWANXT2+1                                               03788000
@NM00113 EQU   SDWANXT2                                                 03789000
@NM00112 EQU   SDWAEC2+3                                                03790000
SDWASGN2 EQU   SDWAINT2                                                 03791000
SDWAEXP2 EQU   SDWAINT2                                                 03792000
SDWADEC2 EQU   SDWAINT2                                                 03793000
SDWAFPO2 EQU   SDWAINT2                                                 03794000
SDWACC2  EQU   SDWAINT2                                                 03795000
@NM00111 EQU   SDWAINT2                                                 03796000
SDWAPGM2 EQU   SDWAMWP2                                                 03797000
SDWAWAT2 EQU   SDWAMWP2                                                 03798000
SDWAMCK2 EQU   SDWAMWP2                                                 03799000
SDWAECT2 EQU   SDWAMWP2                                                 03800000
SDWAKEY2 EQU   SDWAMWP2                                                 03801000
SDWAEXT2 EQU   SDWAEMK2                                                 03802000
SDWAIO2  EQU   SDWAEMK2                                                 03803000
SDWATRM2 EQU   SDWAEMK2                                                 03804000
@NM00110 EQU   SDWAEMK2                                                 03805000
SDWAPER2 EQU   SDWAEMK2                                                 03806000
@NM00109 EQU   SDWAEMK2                                                 03807000
SDWATRAN EQU   SDWAAEC1+4                                               03808000
SDWAIPC1 EQU   SDWAICD1                                                 03809000
SDWAIMC1 EQU   SDWAICD1                                                 03810000
SDWAIPR1 EQU   SDWAICD1                                                 03811000
@NM00108 EQU   SDWAINC1                                                 03812000
@NM00107 EQU   SDWAILC1                                                 03813000
SDWAIL1  EQU   SDWAILC1                                                 03814000
@NM00106 EQU   SDWAILC1                                                 03815000
@NM00105 EQU   SDWAAEC1                                                 03816000
SDWAADD1 EQU   SDWANXT1+1                                               03817000
@NM00104 EQU   SDWANXT1                                                 03818000
@NM00103 EQU   SDWAEC1+3                                                03819000
SDWASGN1 EQU   SDWAINT1                                                 03820000
SDWAEXP1 EQU   SDWAINT1                                                 03821000
SDWADEC1 EQU   SDWAINT1                                                 03822000
SDWAFPO1 EQU   SDWAINT1                                                 03823000
SDWACC1  EQU   SDWAINT1                                                 03824000
@NM00102 EQU   SDWAINT1                                                 03825000
SDWAPGM1 EQU   SDWAMWP1                                                 03826000
SDWAWAT1 EQU   SDWAMWP1                                                 03827000
SDWAMCK1 EQU   SDWAMWP1                                                 03828000
SDWAECT1 EQU   SDWAMWP1                                                 03829000
SDWAKEY1 EQU   SDWAMWP1                                                 03830000
SDWAEXT1 EQU   SDWAEMK1                                                 03831000
SDWAIO1  EQU   SDWAEMK1                                                 03832000
SDWATRM1 EQU   SDWAEMK1                                                 03833000
@NM00101 EQU   SDWAEMK1                                                 03834000
SDWAPER1 EQU   SDWAEMK1                                                 03835000
@NM00100 EQU   SDWAEMK1                                                 03836000
SDWAIOBR EQU   SDWA+100                                                 03837000
SDWAEPA  EQU   SDWA+96                                                  03838000
@NM00099 EQU   SDWANAME+4                                               03839000
SDWARBAD EQU   SDWANAME                                                 03840000
SDWAGR15 EQU   SDWAGRSV+60                                              03841000
SDWAGR14 EQU   SDWAGRSV+56                                              03842000
SDWAGR13 EQU   SDWAGRSV+52                                              03843000
SDWAGR12 EQU   SDWAGRSV+48                                              03844000
SDWAGR11 EQU   SDWAGRSV+44                                              03845000
SDWAGR10 EQU   SDWAGRSV+40                                              03846000
SDWAGR09 EQU   SDWAGRSV+36                                              03847000
SDWAGR08 EQU   SDWAGRSV+32                                              03848000
SDWAGR07 EQU   SDWAGRSV+28                                              03849000
SDWAGR06 EQU   SDWAGRSV+24                                              03850000
SDWAGR05 EQU   SDWAGRSV+20                                              03851000
SDWAGR04 EQU   SDWAGRSV+16                                              03852000
SDWAGR03 EQU   SDWAGRSV+12                                              03853000
SDWAGR02 EQU   SDWAGRSV+8                                               03854000
SDWAGR01 EQU   SDWAGRSV+4                                               03855000
SDWAGR00 EQU   SDWAGRSV                                                 03856000
SDWANXTP EQU   SDWACTL2+5                                               03857000
SDWASGP  EQU   SDWAPMKP                                                 03858000
SDWAEUP  EQU   SDWAPMKP                                                 03859000
SDWADOP  EQU   SDWAPMKP                                                 03860000
SDWAFPP  EQU   SDWAPMKP                                                 03861000
SDWACCP  EQU   SDWAPMKP                                                 03862000
SDWAILP  EQU   SDWAPMKP                                                 03863000
SDWAINTP EQU   SDWACTL2+2                                               03864000
SDWASPVP EQU   SDWAMWPP                                                 03865000
SDWAWATP EQU   SDWAMWPP                                                 03866000
SDWAMCKP EQU   SDWAMWPP                                                 03867000
@NM00098 EQU   SDWAMWPP                                                 03868000
SDWAKEYP EQU   SDWAMWPP                                                 03869000
SDWAEXTP EQU   SDWACMKP                                                 03870000
SDWAIOP  EQU   SDWACMKP                                                 03871000
SDWANXTA EQU   SDWACTL1+5                                               03872000
SDWASGA  EQU   SDWAPMKA                                                 03873000
SDWAEUA  EQU   SDWAPMKA                                                 03874000
SDWADOA  EQU   SDWAPMKA                                                 03875000
SDWAFPA  EQU   SDWAPMKA                                                 03876000
SDWACCA  EQU   SDWAPMKA                                                 03877000
SDWAILA  EQU   SDWAPMKA                                                 03878000
SDWAINTA EQU   SDWACTL1+2                                               03879000
SDWASPVA EQU   SDWAMWPA                                                 03880000
SDWAWATA EQU   SDWAMWPA                                                 03881000
SDWAMCKA EQU   SDWAMWPA                                                 03882000
@NM00097 EQU   SDWAMWPA                                                 03883000
SDWAKEYA EQU   SDWAMWPA                                                 03884000
SDWAEXTA EQU   SDWACMKA                                                 03885000
SDWAIOA  EQU   SDWACMKA                                                 03886000
@NM00096 EQU   SDWACMPF                                                 03887000
SDWASTCC EQU   SDWACMPF                                                 03888000
@NM00095 EQU   SDWACMPF                                                 03889000
SDWASTEP EQU   SDWACMPF                                                 03890000
RDXUQND  EQU   RDXENTRY+12                                              03891000
RDXIOBUQ EQU   RDXENTRY+8                                               03892000
RDXNQARG EQU   RDXENTRY                                                 03893000
RDXRSV01 EQU   RDXLIST                                                  03894000
SIRBEND  EQU   RBSECT+168                                               03895000
SVRBEND  EQU   RBSECT+168                                               03896000
RBRSV158 EQU   RBRSV150                                                 03897000
RBRSV157 EQU   RBRSV150                                                 03898000
RBRSV156 EQU   RBRSV150                                                 03899000
RBRSV155 EQU   RBRSV150                                                 03900000
RBRSV154 EQU   RBRSV150                                                 03901000
RBRSV153 EQU   RBRSV150                                                 03902000
RBRSV152 EQU   RBRSV150                                                 03903000
RBRSV151 EQU   RBRSV150                                                 03904000
RBRSV149 EQU   RBSECT+166                                               03905000
RBRSV148 EQU   RBSECT+164                                               03906000
RBSCBB   EQU   RBSECT+144                                               03907000
TIRBEND  EQU   @NM00093+8                                               03908000
PRBEND   EQU   @NM00093+8                                               03909000
RBRSV146 EQU   RBRSV138                                                 03910000
RBRSV145 EQU   RBRSV138                                                 03911000
RBRSV144 EQU   RBRSV138                                                 03912000
RBRSV143 EQU   RBRSV138                                                 03913000
RBRSV142 EQU   RBRSV138                                                 03914000
RBRSV141 EQU   RBRSV138                                                 03915000
RBRSV140 EQU   RBRSV138                                                 03916000
RBRSV139 EQU   RBRSV138                                                 03917000
RBRSV137 EQU   @NM00093+6                                               03918000
RBRSV136 EQU   @NM00093+4                                               03919000
RBRSV135 EQU   @NM00093                                                 03920000
@NM00092 EQU   RBSECT+32                                                03921000
@NM00091 EQU   @NM00089+1                                               03922000
@NM00090 EQU   @NM00089                                                 03923000
RBPGMQ1  EQU   RBPGMQ+1                                                 03924000
@NM00088 EQU   RBPGMQ                                                   03925000
@NM00087 EQU   RBSECT+16                                                03926000
@NM00086 EQU   @NM00082                                                 03927000
@NM00085 EQU   @NM00082                                                 03928000
RBIQETP  EQU   @NM00082                                                 03929000
RBUSIQE  EQU   RBETXR                                                   03930000
RBATTN   EQU   @NM00082                                                 03931000
@NM00084 EQU   @NM00082                                                 03932000
@NM00083 EQU   @NM00082                                                 03933000
RBRSV007 EQU   @NM00080                                                 03934000
RBATNXIT EQU   @NM00080                                                 03935000
@NM00081 EQU   @NM00080                                                 03936000
RBWAITP  EQU   @NM00080                                                 03937000
RBFNSVRB EQU   RBTRSVRB                                                 03938000
RBFTP    EQU   @NM00080                                                 03939000
RBSIZE   EQU   RBSECT+8                                                 03940000
RBABOPSW EQU   RBSECT+4                                                 03941000
RBPPSAV1 EQU   RBPPSAV+1                                                03942000
@NM00078 EQU   RBPPSAV                                                  03943000
RBPRFXND EQU   RBPREFIX+64                                              03944000
RBINTCOD EQU   RBINTCDA+1                                               03945000
RBINLNTH EQU   RBINTCDA                                                 03946000
RBWCSA   EQU   RBPREFIX+60                                              03947000
RBRSV004 EQU   RBPREFIX+57                                              03948000
RBSSSYN  EQU   RBFLAGS1                                                 03949000
RBSCB    EQU   RBFLAGS1                                                 03950000
RBLONGWT EQU   RBFLAGS1                                                 03951000
RBASIR   EQU   RBFLAGS1                                                 03952000
RBRSV159 EQU   RBFLAGS1                                                 03953000
RBABEND  EQU   RBFLAGS1                                                 03954000
RBXWAIT  EQU   RBFLAGS1                                                 03955000
RBSLOCK  EQU   RBFLAGS1                                                 03956000
RBRTRAN  EQU   RBRTPSW2+4                                               03957000
RBRTINCD EQU   RBRTICIL+2                                               03958000
RBRTILC  EQU   RBRTICIL+1                                               03959000
RBRSV160 EQU   RBRTICIL                                                 03960000
RBRTPSW1 EQU   RBRTOPSW                                                 03961000
RBRSV062 EQU   RBRSV054                                                 03962000
RBRSV061 EQU   RBRSV054                                                 03963000
RBRSV060 EQU   RBRSV054                                                 03964000
RBRSV059 EQU   RBRSV054                                                 03965000
RBRSV058 EQU   RBRSV054                                                 03966000
RBRSV057 EQU   RBRSV054                                                 03967000
RBRSV056 EQU   RBRSV054                                                 03968000
RBRSV055 EQU   RBRSV054                                                 03969000
RBRSV053 EQU   RBPREFIX+38                                              03970000
RBRSV052 EQU   RBPREFIX+36                                              03971000
RBRSV051 EQU   RBPREFIX+32                                              03972000
RBPRFXST EQU   RBPREFIX+32                                              03973000
RBRSV050 EQU   RBPREFIX+28                                              03974000
RBRSV049 EQU   RBRSV041                                                 03975000
RBRSV048 EQU   RBRSV041                                                 03976000
RBRSV047 EQU   RBRSV041                                                 03977000
RBRSV046 EQU   RBRSV041                                                 03978000
RBRSV045 EQU   RBRSV041                                                 03979000
RBRSV044 EQU   RBRSV041                                                 03980000
RBRSV043 EQU   RBRSV041                                                 03981000
RBRSV042 EQU   RBRSV041                                                 03982000
RBRSV040 EQU   RBPREFIX+26                                              03983000
RBRSV039 EQU   RBPREFIX+24                                              03984000
RBRSV038 EQU   RBPREFIX+20                                              03985000
RBRSV037 EQU   RBPREFIX+16                                              03986000
RBRSV036 EQU   RBRSV028                                                 03987000
RBRSV035 EQU   RBRSV028                                                 03988000
RBRSV034 EQU   RBRSV028                                                 03989000
RBRSV033 EQU   RBRSV028                                                 03990000
RBRSV032 EQU   RBRSV028                                                 03991000
RBRSV031 EQU   RBRSV028                                                 03992000
RBRSV030 EQU   RBRSV028                                                 03993000
RBRSV029 EQU   RBRSV028                                                 03994000
RBRSV027 EQU   RBRSV019                                                 03995000
RBRSV026 EQU   RBRSV019                                                 03996000
RBRSV025 EQU   RBRSV019                                                 03997000
RBRSV024 EQU   RBRSV019                                                 03998000
RBRSV023 EQU   RBRSV019                                                 03999000
RBRSV022 EQU   RBRSV019                                                 04000000
RBRSV021 EQU   RBRSV019                                                 04001000
RBRSV020 EQU   RBRSV019                                                 04002000
RBRSV018 EQU   RBPREFIX+13                                              04003000
RBRSV017 EQU   RBPREFIX+12                                              04004000
RBSRV016 EQU   RBPREFIX+11                                              04005000
RBRSV015 EQU   RBPREFIX+10                                              04006000
RBRSV014 EQU   RBPREFIX+8                                               04007000
RBRSV013 EQU   RBPREFIX+4                                               04008000
RBRSV012 EQU   RBPREFIX                                                 04009000
XRBREG15 EQU   RBGRS15                                                  04010000
XRBREG14 EQU   RBGRS14                                                  04011000
XRBREG13 EQU   RBGRS13                                                  04012000
XRBREG12 EQU   RBGRS12                                                  04013000
XRBREG11 EQU   RBGRS11                                                  04014000
XRBREG10 EQU   RBGRS10                                                  04015000
XRBREG9  EQU   RBGRS9                                                   04016000
XRBREG8  EQU   RBGRS8                                                   04017000
XRBREG7  EQU   RBGRS7                                                   04018000
XRBREG6  EQU   RBGRS6                                                   04019000
XRBREG5  EQU   RBGRS5                                                   04020000
XRBREG4  EQU   RBGRS4                                                   04021000
XRBREG3  EQU   RBGRS3                                                   04022000
XRBREG2  EQU   RBGRS2                                                   04023000
XRBREG1  EQU   RBGRS1                                                   04024000
XRBREG0  EQU   RBGRS0                                                   04025000
XRBLNKA  EQU   RBLINKB                                                  04026000
XRBWT    EQU   RBWCF                                                    04027000
@NM00077 EQU   RBBASIC+24                                               04028000
XRBPSW   EQU   RBOPSW                                                   04029000
@NM00076 EQU   RBBASIC+12                                               04030000
XRBWAIT  EQU   RBECBWT                                                  04031000
XRBFRRB  EQU   RBFDYN                                                   04032000
@NM00075 EQU   XSTAB2                                                   04033000
XRBACTV  EQU   RBFACTV                                                  04034000
XRBTCBP  EQU   RBTCBNXT                                                 04035000
@NM00074 EQU   XSTAB1                                                   04036000
XRBCKPT  EQU   RBFTCKPT                                                 04037000
@NM00073 EQU   XSTAB1                                                   04038000
@NM00072 EQU   RBBASIC+8                                                04039000
@NM00071 EQU   RBEXRTNM+1                                               04040000
RBTMIND3 EQU   RBTMFLD                                                  04041000
RBTMIND2 EQU   RBTMFLD                                                  04042000
RBTMCMP  EQU   RBTMFLD                                                  04043000
RBWLIM   EQU   RBTMFLD                                                  04044000
RBRSV005 EQU   RBTMFLD                                                  04045000
RBTMTOD  EQU   RBTMFLD                                                  04046000
RBTMQUE  EQU   RBTMFLD                                                  04047000
@NM00070 EQU   RBPRFX                                                   04048000
IOBERRCT EQU   IOBSTDRD+30                                              04049000
IOBRSV19 EQU   IOBINCAM+1                                               04050000
IOBOLTST EQU   IOBBTAMF                                                 04051000
IOBRFTMG EQU   IOBBTAMF                                                 04052000
IOBRSV17 EQU   IOBBTAMF                                                 04053000
IOBRSV16 EQU   IOBBTAMF                                                 04054000
IOBRSV15 EQU   IOBBTAMF                                                 04055000
IOBRSV14 EQU   IOBBTAMF                                                 04056000
IOBINUSE EQU   IOBBTAMF                                                 04057000
IOBPRMER EQU   IOBBTAMF                                                 04058000
IOBRSTRB EQU   IOBRESTR+1                                               04059000
IOBREPOS EQU   IOBRESTR                                                 04060000
IOBDCBPB EQU   IOBDCBPT+1                                               04061000
IOBRSV44 EQU   IOBFLAG4                                                 04062000
IOBRSV43 EQU   IOBFLAG4                                                 04063000
IOBRSV42 EQU   IOBFLAG4                                                 04064000
IOBRSV41 EQU   IOBFLAG4                                                 04065000
IOBRSV40 EQU   IOBFLAG4                                                 04066000
IOBRSV39 EQU   IOBFLAG4                                                 04067000
IOBRSV38 EQU   IOBFLAG4                                                 04068000
IOBGDPOL EQU   IOBFLAG4                                                 04069000
IOBSTRTB EQU   IOBSTART+1                                               04070000
IOBSIOCC EQU   IOBSTART                                                 04071000
IOBSTBYT EQU   IOBIOCSW+3                                               04072000
IOBCMDA  EQU   IOBIOCSW                                                 04073000
IOBLOG   EQU   IOBFL3                                                   04074000
IOBICL   EQU   IOBFL3                                                   04075000
IOBMSG   EQU   IOBFL3                                                   04076000
IOBCNC   EQU   IOBFL3                                                   04077000
IOBACU   EQU   IOBFL3                                                   04078000
IOBCDC   EQU   IOBFL3                                                   04079000
IOBICC   EQU   IOBFL3                                                   04080000
IOBCCC   EQU   IOBFL3                                                   04081000
IOBECBPB EQU   IOBECBPT+1                                               04082000
IOBECBCC EQU   IOBECBPT                                                 04083000
IOBS1B7  EQU   IOBSENS1                                                 04084000
IOBS1B6  EQU   IOBSENS1                                                 04085000
IOBS1B5  EQU   IOBSENS1                                                 04086000
IOBS1B4  EQU   IOBSENS1                                                 04087000
IOBS1B3  EQU   IOBSENS1                                                 04088000
IOBS1B2  EQU   IOBSENS1                                                 04089000
IOBS1B1  EQU   IOBSENS1                                                 04090000
IOBS1B0  EQU   IOBSENS1                                                 04091000
IOBSNSC9 EQU   IOBS0B7                                                  04092000
IOBS0B6  EQU   IOBSENS0                                                 04093000
IOBS0B5  EQU   IOBSENS0                                                 04094000
IOBS0B4  EQU   IOBSENS0                                                 04095000
IOBS0B3  EQU   IOBSENS0                                                 04096000
IOBS0B2  EQU   IOBSENS0                                                 04097000
IOBS0B1  EQU   IOBSENS0                                                 04098000
IOBS0B0  EQU   IOBSENS0                                                 04099000
IOBPNCH  EQU   IOBFLAG2                                                 04100000
IOBSTATO EQU   IOBFLAG2                                                 04101000
IOBSKUPD EQU   IOBFLAG2                                                 04102000
IOBALTTR EQU   IOBFLAG2                                                 04103000
IOBRRT2  EQU   IOBRDHA0                                                 04104000
IOBRRT3  EQU   IOBPURGE                                                 04105000
IOBSENSE EQU   IOBFLAG2                                                 04106000
IOBHALT  EQU   IOBFLAG2                                                 04107000
IOBSPSVC EQU   IOBRSTRT                                                 04108000
IOBUNREL EQU   IOBFLAG1                                                 04109000
IOBIOERR EQU   IOBFLAG1                                                 04110000
IOBFCREX EQU   IOBCYCCK                                                 04111000
IOBRPSTN EQU   IOBFLAG1                                                 04112000
IOBERRTN EQU   IOBFLAG1                                                 04113000
IOBCMDCH EQU   IOBFLAG1                                                 04114000
IOBDATCH EQU   IOBFLAG1                                                 04115000
IOBCNOPA EQU   IOBPREFX+12                                              04116000
IOBCICB  EQU   IOBPREFX+8                                               04117000
IOBCECB  EQU   IOBPREFX+4                                               04118000
IOBCONOP EQU   IOBPREFX+3                                               04119000
IOBCINOP EQU   IOBPREFX+2                                               04120000
IOBRSV05 EQU   IOBPREFX+1                                               04121000
IOBPCI   EQU   IOBCFLG1                                                 04122000
IOBRSTCH EQU   IOBCFLG1                                                 04123000
IOBABAPP EQU   IOBCFLG1                                                 04124000
IOBPTST  EQU   IOBCFLG1                                                 04125000
IOBRSV04 EQU   IOBCFLG1                                                 04126000
IOBRSV03 EQU   IOBCFLG1                                                 04127000
IOBRSV02 EQU   IOBCFLG1                                                 04128000
IOBRSV01 EQU   IOBCFLG1                                                 04129000
DSABGRID EQU   DSABGIDL+4                                               04130000
DSABLLEN EQU   DSABGIDL                                                 04131000
DSABANAM EQU   DSABANMI+1                                               04132000
DSABANML EQU   DSABANMI                                                 04133000
DSABRS04 EQU   DSAB+68                                                  04134000
DSABSIOT EQU   DSAB+64                                                  04135000
DSABRS03 EQU   DSAB+62                                                  04136000
DSABDCBM EQU   DSAB+56                                                  04137000
DSABSSCM EQU   DSAB+52                                                  04138000
DSABSSNM EQU   DSAB+48                                                  04139000
DSABPTTR EQU   DSAB+44                                                  04140000
DSABTCBP EQU   DSAB+40                                                  04141000
DSABRS02 EQU   DSAB+38                                                  04142000
@NM00045 EQU   DSABFLG4                                                 04143000
DSABCKSI EQU   DSABFLG4                                                 04144000
DSABCKVL EQU   DSABFLG4                                                 04145000
DSABCKDS EQU   DSABFLG4                                                 04146000
@NM00044 EQU   DSABFLG3                                                 04147000
DSABJSCT EQU   DSABFLG3                                                 04148000
DSABCATL EQU   DSABFLG3                                                 04149000
DSABVMSC EQU   DSABFLG3                                                 04150000
DSABVAM  EQU   DSABFLG3                                                 04151000
DSABPASS EQU   DSABFLG3                                                 04152000
DSABDEFR EQU   DSABFLG3                                                 04153000
@NM00043 EQU   DSABFLG2                                                 04154000
DSABUNAL EQU   DSABFLG2                                                 04155000
DSABIRM  EQU   DSABFLG2                                                 04156000
DSABOPEN EQU   DSABFLG2                                                 04157000
DSABNUSE EQU   DSABFLG1                                                 04158000
DSABCATM EQU   DSABFLG1                                                 04159000
DSABPCAT EQU   DSABFLG1                                                 04160000
DSABDCAT EQU   DSABFLG1                                                 04161000
DSABCONV EQU   DSABFLG1                                                 04162000
DSABDCNV EQU   DSABFLG1                                                 04163000
DSABPALC EQU   DSABFLG1                                                 04164000
DSABDALC EQU   DSABFLG1                                                 04165000
@NM00042 EQU   DSABORG2                                                 04166000
DSABTR   EQU   DSABORG2                                                 04167000
DSABAM   EQU   DSABORG2                                                 04168000
@NM00041 EQU   DSABORG2                                                 04169000
DSABTQ   EQU   DSABORG2                                                 04170000
DSABTX   EQU   DSABORG2                                                 04171000
DSABGS   EQU   DSABORG2                                                 04172000
DSABU    EQU   DSABORG1                                                 04173000
DSABPO   EQU   DSABORG1                                                 04174000
DSABMQ   EQU   DSABORG1                                                 04175000
DSABCQ   EQU   DSABORG1                                                 04176000
DSABCX   EQU   DSABORG1                                                 04177000
DSABDA   EQU   DSABORG1                                                 04178000
DSABPS   EQU   DSABORG1                                                 04179000
DSABIS   EQU   DSABORG1                                                 04180000
DSABSSVA EQU   DSAB+21                                                  04181000
DSABRS01 EQU   DSAB+20                                                  04182000
DSABOPCT EQU   DSAB+14                                                  04183000
DSABLNTH EQU   DSAB+12                                                  04184000
DSABBCHN EQU   DSAB+8                                                   04185000
DSABFCHN EQU   DSAB+4                                                   04186000
DSABID   EQU   DSAB                                                     04187000
DECWAREA EQU   DECBS04+44                                               04188000
DECWLNG  EQU   DECBS04+42                                               04189000
DECRSV56 EQU   DECBS04+40                                               04190000
DECPOLPA EQU   DECPOLPT+1                                               04191000
DECNDXPL EQU   DECPOLPT                                                 04192000
DECADRPT EQU   DECBS04+32                                               04193000
DECCSWST EQU   DECBS04+30                                               04194000
DECRSV55 EQU   DECERRST                                                 04195000
DECRSV54 EQU   DECERRST                                                 04196000
DECRSV53 EQU   DECERRST                                                 04197000
DECDSABL EQU   DECERRST                                                 04198000
DECDIAGN EQU   DECERRST                                                 04199000
DECERPER EQU   DECERRST                                                 04200000
DECUNDEF EQU   DECERRST                                                 04201000
DECSIO3  EQU   DECERRST                                                 04202000
DECTPCOD EQU   DECBS04+28                                               04203000
DECRESPN EQU   DECBS04+26                                               04204000
DECRLN   EQU   DECBS04+25                                               04205000
DECSTXNQ EQU   DECFLAGS                                                 04206000
DECSSMSG EQU   DECREVRS                                                 04207000
DECNEGRP EQU   DECFLAGS                                                 04208000
DECNOBUF EQU   DECFLAGS                                                 04209000
DECBADID EQU   DECFLAGS                                                 04210000
DECALTAC EQU   DECFLAGS                                                 04211000
DECDIFAC EQU   DECWACK                                                  04212000
DECERRMS EQU   DECWACK                                                  04213000
DECENTRA EQU   DECENTRY+1                                               04214000
DECCMCOD EQU   DECENTRY                                                 04215000
DECCOUNT EQU   DECBS04+18                                               04216000
DECSENS1 EQU   DECBS04+17                                               04217000
DECSENS0 EQU   DECBS04+16                                               04218000
@NM00040 EQU   DECBS04+12                                               04219000
DECDCBAA EQU   @NM00039+1                                               04220000
DECRSV52 EQU   DECONLTT                                                 04221000
DECRSV51 EQU   DECONLTT                                                 04222000
DECRSV50 EQU   DECONLTT                                                 04223000
DECRSV49 EQU   DECONLTT                                                 04224000
DECRSV48 EQU   DECONLTT                                                 04225000
DECRSV47 EQU   DECONLTT                                                 04226000
DECRCVMS EQU   DECONLTT                                                 04227000
DECONLTS EQU   DECONLTT                                                 04228000
@NM00038 EQU   DECBS04+6                                                04229000
@NM00037 EQU   @NM00035+1                                               04230000
DECSLNTH EQU   @NM00036                                                 04231000
DECSAREA EQU   @NM00036                                                 04232000
DECSTRME EQU   @NM00036                                                 04233000
DECRSV46 EQU   @NM00036                                                 04234000
DECRSV45 EQU   @NM00036                                                 04235000
DECRSV44 EQU   @NM00036                                                 04236000
DECRSV43 EQU   @NM00036                                                 04237000
DECRDAPL EQU   @NM00036                                                 04238000
@NM00034 EQU   DECBS04                                                  04239000
@NM00033 EQU   @NM00032+1                                               04240000
DECRSV42 EQU   @NM00032                                                 04241000
DECADRCH EQU   DECBS03+32                                               04242000
DECRSV41 EQU   DECBS03+28                                               04243000
DECRSV40 EQU   DECBS03+26                                               04244000
DECUCBDX EQU   DECBS03+25                                               04245000
DECRSV39 EQU   DECBS03+24                                               04246000
DECCPOLA EQU   DECCPOL+1                                                04247000
DECNMMSG EQU   DECCPOL                                                  04248000
DECRSV38 EQU   DECBS03+16                                               04249000
@NM00031 EQU   DECBS03+12                                               04250000
@NM00030 EQU   DECBS03+8                                                04251000
@NM00029 EQU   DECBS03+6                                                04252000
DECOPCOD EQU   DECBS03+5                                                04253000
DECRSV37 EQU   DECBS03+4                                                04254000
LINEDECB EQU   DECBS03                                                  04255000
DECNAA   EQU   DECNA+1                                                  04256000
DECRSV36 EQU   DECNA                                                    04257000
DECRECPT EQU   DECBS02+24                                               04258000
DECKYADR EQU   DECBS02+20                                               04259000
@NM00028 EQU   DECBS02+16                                               04260000
@NM00027 EQU   DECBS02+12                                               04261000
@NM00026 EQU   DECBS02+8                                                04262000
@NM00025 EQU   DECBS02+6                                                04263000
DECRSV35 EQU   @NM00024                                                 04264000
DECWRADD EQU   @NM00024                                                 04265000
DECSRKEY EQU   @NM00024                                                 04266000
DECOPRD  EQU   @NM00024                                                 04267000
DECTYPR  EQU   DECTYPRU                                                 04268000
DECTYPU  EQU   DECTYPRU                                                 04269000
DECBKLNS EQU   @NM00024                                                 04270000
DECKEYS  EQU   @NM00024                                                 04271000
DECRELBA EQU   @NM00023                                                 04272000
DECRDEX  EQU   @NM00023                                                 04273000
DECDYNBF EQU   @NM00023                                                 04274000
DECACTAD EQU   @NM00023                                                 04275000
DECFDBCK EQU   @NM00023                                                 04276000
DECEXSRC EQU   @NM00023                                                 04277000
DECOFLOW EQU   @NM00023                                                 04278000
DECVERFY EQU   @NM00023                                                 04279000
DECRSV34 EQU   @NM00020+3                                               04280000
DECCCKFF EQU   DECCC3                                                   04281000
DECCCOPT EQU   DECCC3                                                   04282000
DECCCSDK EQU   DECCC3                                                   04283000
DECCCWDI EQU   DECCC3                                                   04284000
DECCCNBK EQU   DECCC3                                                   04285000
DECCCEXS EQU   DECCC3                                                   04286000
DECCCWRI EQU   DECCC3                                                   04287000
DECRSV33 EQU   DECCC3                                                   04288000
DECCCREX EQU   DECCC2                                                   04289000
DECCCUER EQU   DECCC2                                                   04290000
DECCCEOD EQU   DECCC2                                                   04291000
DECCCERR EQU   DECCC2                                                   04292000
DECCCINV EQU   DECCC2                                                   04293000
DECCCNSP EQU   DECCC2                                                   04294000
DECCCRLC EQU   DECCC2                                                   04295000
DECCCRNF EQU   DECCC2                                                   04296000
@NM00021 EQU   @NM00020                                                 04297000
DECEXRKU EQU   DECBEXC2                                                 04298000
DECEXASR EQU   DECBEXC2                                                 04299000
DECRSV32 EQU   DECBEXC2                                                 04300000
DECRSV31 EQU   DECBEXC2                                                 04301000
DECRSV30 EQU   DECBEXC2                                                 04302000
DECRSV29 EQU   DECBEXC2                                                 04303000
DECRSV28 EQU   DECBEXC2                                                 04304000
DECRSV27 EQU   DECBEXC2                                                 04305000
DECEXDUP EQU   DECBEXC1                                                 04306000
DECEXOFL EQU   DECBEXC1                                                 04307000
DECEXUBK EQU   DECBEXC1                                                 04308000
DECEXERR EQU   DECBEXC1                                                 04309000
DECEXINV EQU   DECBEXC1                                                 04310000
DECEXNSP EQU   DECBEXC1                                                 04311000
DECEXRLC EQU   DECBEXC1                                                 04312000
DECEXRNF EQU   DECBEXC1                                                 04313000
DECBKEY  EQU   DECBS01+20                                               04314000
DECBLOGR EQU   DECBS01+16                                               04315000
DECBAREA EQU   DECBS01+12                                               04316000
DECBDCBA EQU   DECBS01+8                                                04317000
DECBLGTH EQU   DECBS01+6                                                04318000
DECRSV26 EQU   DECBTYP2                                                 04319000
DECRSV25 EQU   DECBTYP2                                                 04320000
DECBWRKN EQU   DECBTYP2                                                 04321000
DECBWRK  EQU   DECBTYP2                                                 04322000
DECRSV24 EQU   DECBTYP2                                                 04323000
DECBRDKU EQU   DECBTYP2                                                 04324000
DECRSV23 EQU   DECBTYP2                                                 04325000
DECBRDK  EQU   DECBTYP2                                                 04326000
DECBARS  EQU   DECBTYP1                                                 04327000
DECBLNS  EQU   DECBTYP1                                                 04328000
DECRSV22 EQU   DECBTYP1                                                 04329000
DECRSV21 EQU   DECBTYP1                                                 04330000
DECRSV20 EQU   DECBTYP1                                                 04331000
DECRSV19 EQU   DECBTYP1                                                 04332000
DECRSV18 EQU   DECBTYP1                                                 04333000
DECRSV17 EQU   DECBTYP1                                                 04334000
DECBRBA  EQU   DECBRB+1                                                 04335000
DECRSV16 EQU   DECBECBF                                                 04336000
DECRSV15 EQU   DECBECBF                                                 04337000
DECRSV14 EQU   DECBECBF                                                 04338000
DECRSV13 EQU   DECBECBF                                                 04339000
DECRSV12 EQU   DECBECBF                                                 04340000
DECRSV11 EQU   DECBECBF                                                 04341000
DECBPOST EQU   DECBECBF                                                 04342000
DECBWAIT EQU   DECBECBF                                                 04343000
DECNEXTA EQU   DECNEXT+1                                                04344000
DECRSV10 EQU   DECNEXT                                                  04345000
DECIOBPT EQU   DECB+16                                                  04346000
DECAREA  EQU   DECB+12                                                  04347000
DECDCBAD EQU   DECB+8                                                   04348000
DECLNGTH EQU   DECBPTR+2                                                04349000
DECWRSFR EQU   DECTYPE2                                                 04350000
DECRSV09 EQU   DECTYPE2                                                 04351000
DECWRSZ  EQU   DECTYPE2                                                 04352000
DECRSV08 EQU   DECTYPE2                                                 04353000
DECWRSD  EQU   DECTYPE2                                                 04354000
DECWRSF  EQU   DECTYPE2                                                 04355000
DECRDSB  EQU   DECTYPE2                                                 04356000
DECRDSF  EQU   DECTYPE2                                                 04357000
DECRSV07 EQU   DECTYPE1                                                 04358000
DECRSV06 EQU   DECTYPE1                                                 04359000
DECRSV05 EQU   DECTYPE1                                                 04360000
DECRSV04 EQU   DECTYPE1                                                 04361000
DECRSV03 EQU   DECTYPE1                                                 04362000
DECRSV02 EQU   DECTYPE1                                                 04363000
DECRSV01 EQU   DECTYPE1                                                 04364000
DECLNS   EQU   DECTYPE1                                                 04365000
DECSDECB EQU   DECB                                                     04366000
DEBXRV40 EQU   DEBXTN+28                                                04367000
DEBXRV39 EQU   DEBXTN+24                                                04368000
DEBXMCF2 EQU   DEBXTN+19                                                04369000
DEBXMCF1 EQU   DEBXTN+18                                                04370000
DEBXDSO2 EQU   DEBXTN+17                                                04371000
DEBXDSO1 EQU   DEBXTN+16                                                04372000
DEBXDBPR EQU   DEBXTN+12                                                04373000
DEBXDCBM EQU   DEBXTN+8                                                 04374000
DEBXRV48 EQU   DEBXTN+3                                                 04375000
DEBXRV47 EQU   DEBXFLG1                                                 04376000
DEBXRV46 EQU   DEBXFLG1                                                 04377000
DEBXRV45 EQU   DEBXFLG1                                                 04378000
DEBXRV44 EQU   DEBXFLG1                                                 04379000
DEBXRV43 EQU   DEBXFLG1                                                 04380000
DEBXRV42 EQU   DEBXFLG1                                                 04381000
DEBXTSKC EQU   DEBXFLG1                                                 04382000
DEBXCDCB EQU   DEBXFLG1                                                 04383000
DEBXLNGH EQU   DEBXTN                                                   04384000
DEBAMTYP EQU   DEBPREFX+13                                              04385000
DEBLNGTH EQU   DEBPREFX+12                                              04386000
DEBDCBMK EQU   DEBXTNP                                                  04387000
DEBDSCBA EQU   DEBPREFX+1                                               04388000
DEBWKARA EQU   DEBPREFX                                                 04389000
DEBXCEAD EQU   DEBXCEA+1                                                04390000
DEBXCENP EQU   DEBXCEAB                                                 04391000
DEBRSV35 EQU   DEBXCEAB                                                 04392000
DEBRSV34 EQU   DEBXCEAB                                                 04393000
DEBRSV33 EQU   DEBXCEAB                                                 04394000
DEBRSV32 EQU   DEBXCEAB                                                 04395000
DEBCEAD  EQU   DEBCEA+1                                                 04396000
DEBCENP  EQU   DEBCEAB                                                  04397000
DEBRSV31 EQU   DEBCEAB                                                  04398000
DEBRSV30 EQU   DEBCEAB                                                  04399000
DEBRSV29 EQU   DEBCEAB                                                  04400000
DEBRSV28 EQU   DEBCEAB                                                  04401000
DEBPCIAD EQU   DEBPCIA+1                                                04402000
DEBPCINP EQU   DEBPCIAB                                                 04403000
DEBRSV27 EQU   DEBPCIAB                                                 04404000
DEBRSV26 EQU   DEBPCIAB                                                 04405000
DEBRSV25 EQU   DEBPCIAB                                                 04406000
DEBRSV24 EQU   DEBPCIAB                                                 04407000
DEBSIOAD EQU   DEBSIOA+1                                                04408000
DEBSIONP EQU   DEBSIOAB                                                 04409000
DEBRSV23 EQU   DEBSIOAB                                                 04410000
DEBIOVR  EQU   DEBSIOAB                                                 04411000
DEBSIOX  EQU   DEBSIOAB                                                 04412000
DEBPGFX  EQU   DEBSIOAB                                                 04413000
DEBEOEAD EQU   DEBEOEA+1                                                04414000
DEBEOENP EQU   DEBEOEAB                                                 04415000
DEBRSV22 EQU   DEBEOEAB                                                 04416000
DEBRSV21 EQU   DEBEOEAB                                                 04417000
DEBRSV20 EQU   DEBEOEAB                                                 04418000
DEBRSV19 EQU   DEBEOEAB                                                 04419000
DEBSUBID EQU   DEBSUBNM                                                 04420000
DEBSIOA2 EQU   DEBACS08+24                                              04421000
DEBRPSIO EQU   DEBACS08+20                                              04422000
DEBFREED EQU   DEBACS08+16                                              04423000
@NM00019 EQU   DEBACS08+12                                              04424000
@NM00018 EQU   DEBACS08+8                                               04425000
DEBDISAD EQU   DEBACS08+4                                               04426000
@NM00017 EQU   DEBACS08                                                 04427000
DEBRPSST EQU   DEBACS07+64                                              04428000
DEBARECK EQU   DEBACS07+60                                              04429000
DEBAREWT EQU   DEBACS07+56                                              04430000
DEBACHK  EQU   DEBACS07+52                                              04431000
DEBAWRIT EQU   DEBACS07+48                                              04432000
DEBASETL EQU   DEBACS07+44                                              04433000
DEBAREAD EQU   DEBACS07+40                                              04434000
DEBCRECK EQU   DEBACS07+36                                              04435000
DEBCREWT EQU   DEBACS07+32                                              04436000
DEBCCHK  EQU   DEBACS07+28                                              04437000
DEBCWRIT EQU   DEBACS07+24                                              04438000
DEBCSETL EQU   DEBACS07+20                                              04439000
DEBCREAD EQU   DEBACS07+16                                              04440000
DEBWKPT5 EQU   DEBACS07+12                                              04441000
DEBWKPT4 EQU   DEBACS07+8                                               04442000
DEBGET   EQU   DEBACS07+4                                               04443000
@NM00016 EQU   DEBACS07                                                 04444000
DEBPUT   EQU   DEBACS06+4                                               04445000
DEBDCBFA EQU   DEBACS06                                                 04446000
DEBLUCBB EQU   DEBLUCBA+1                                               04447000
DEBRSV18 EQU   DEBLUCBA                                                 04448000
DEBFUCBB EQU   DEBFUCBA+1                                               04449000
DEBRSV17 EQU   DEBFUCBA                                                 04450000
DEBTCCWB EQU   DEBTCCWA+1                                               04451000
DEBRSV16 EQU   DEBTCCWA                                                 04452000
DEBTBFRB EQU   DEBTBFRA+1                                               04453000
DEBRSV15 EQU   DEBTBFRA                                                 04454000
DEBDBPEF EQU   DEBACS03+8                                               04455000
DEBDBPP  EQU   DEBACS03+4                                               04456000
DEBDTPP  EQU   DEBACS03                                                 04457000
DEBDBPE  EQU   DEBDBLK+1                                                04458000
DEBDBPT  EQU   DEBDBLK                                                  04459000
DEBEXTNM EQU   DEBDSNAM                                                 04460000
DEBRSV14 EQU   DEBDSNM+4                                                04461000
DEBUTSAB EQU   DEBUTSAA+1                                               04462000
DEBRSV13 EQU   DEBUTSAA                                                 04463000
DEBVOLNM EQU   DEBACSMD+2                                               04464000
DEBVLSEQ EQU   DEBVOLSQ+1                                               04465000
DEBRSV42 EQU   DEBVOLBT                                                 04466000
DEBRSV41 EQU   DEBVOLBT                                                 04467000
DEBRSV40 EQU   DEBVOLBT                                                 04468000
DEBRSV39 EQU   DEBVOLBT                                                 04469000
DEBRSV38 EQU   DEBVOLBT                                                 04470000
DEBRSV37 EQU   DEBVOLBT                                                 04471000
DEBRSV36 EQU   DEBVOLBT                                                 04472000
DEBEXFUL EQU   DEBVOLBT                                                 04473000
DEBNMTRK EQU   DEBDASD+14                                               04474000
DEBENDHH EQU   DEBDASD+12                                               04475000
DEBENDCC EQU   DEBDASD+10                                               04476000
DEBSTRHH EQU   DEBDASD+8                                                04477000
DEBSTRCC EQU   DEBDASD+6                                                04478000
DEBBINUM EQU   DEBDASD+4                                                04479000
DEBUCBA  EQU   DEBUCBAD+1                                               04480000
DEBDVMOD EQU   DEBUCBAD                                                 04481000
DEBAPPB  EQU   DEBAPPAD+1                                               04482000
DEBEXSCL EQU   DEBAPPAD                                                 04483000
DEBDEBID EQU   DEBPROTG                                                 04484000
DEBECBB  EQU   DEBECBAD+1                                               04485000
DEBPRIOR EQU   DEBECBAD                                                 04486000
DEBUSRPB EQU   DEBUSRPG+1                                               04487000
DEBNMEXT EQU   DEBUSRPG                                                 04488000
DEBRSV05 EQU   DEBBASIC+15                                              04489000
DEBXTNIN EQU   DEBFLGS1                                                 04490000
DEBAPFIN EQU   DEBFLGS1                                                 04491000
DEBF1CEV EQU   DEBFLGS1                                                 04492000
DEBCINDI EQU   DEBFLGS1                                                 04493000
DEBRSV02 EQU   DEBFLGS1                                                 04494000
DEBRSV01 EQU   DEBFLGS1                                                 04495000
DEBEOFDF EQU   DEBFLGS1                                                 04496000
DEBPWCKD EQU   DEBFLGS1                                                 04497000
DEBQSCNT EQU   DEBBASIC+13                                              04498000
DEBACCS  EQU   DEBOPATB                                                 04499000
DEBPOSIT EQU   DEBOPATB                                                 04500000
DEBZERO  EQU   DEBOPATB                                                 04501000
DEBABEND EQU   DEBOPATB                                                 04502000
DEBIRBB  EQU   DEBIRBAD+1                                               04503000
DEBRERR  EQU   DEBOFLGS                                                 04504000
DEBLABEL EQU   DEBOFLGS                                                 04505000
DEBSPLIT EQU   DEBOFLGS                                                 04506000
DEBDCB   EQU   DEBOFLGS                                                 04507000
DEBRLSE  EQU   DEBOFLGS                                                 04508000
DEBEOF   EQU   DEBOFLGS                                                 04509000
DEBDISP  EQU   DEBOFLGS                                                 04510000
DEBDEBB  EQU   DEBDEBAD+1                                               04511000
DEBAMLNG EQU   DEBDEBAD                                                 04512000
DEBTCBB  EQU   DEBTCBAD+1                                               04513000
DEBNMSUB EQU   DEBTCBAD                                                 04514000
DCBDYNB  EQU   IHADCS30+48                                              04515000
DCBDFBK  EQU   IHADCS30+44                                              04516000
DCBDFOR  EQU   IHADCS30+40                                              04517000
DCBDRDXA EQU   DCBDRDX+1                                                04518000
DCBMVXNO EQU   DCBDRDX                                                  04519000
DCBXARGA EQU   DCBXARG+1                                                04520000
DCBXCNT  EQU   DCBXARG                                                  04521000
DCBLIMCT EQU   IHADCS30+29                                              04522000
@NM00015 EQU   IHADCS30+28                                              04523000
DCBUQND  EQU   IHADCS30+24                                              04524000
DCBIOBUQ EQU   IHADCS30+20                                              04525000
DCBSQND  EQU   IHADCS30+16                                              04526000
DCBIOBSQ EQU   IHADCS30+12                                              04527000
DCBBLKSI EQU   IHADCS30+10                                              04528000
@NM00014 EQU   IHADCS30+8                                               04529000
DCBSYNAD EQU   IHADCS30+4                                               04530000
DCBCHCKA EQU   DCBCHECK+1                                               04531000
DCBOPTRB EQU   DCBOPTCD                                                 04532000
DCBOPTRE EQU   DCBOPTCD                                                 04533000
DCBOPTDB EQU   DCBOPTCD                                                 04534000
DCBOPTE  EQU   DCBOPTCD                                                 04535000
DCBOPTTO EQU   DCBOPTCD                                                 04536000
DCBOPTW  EQU   DCBOPTCD                                                 04537000
DCBREADA EQU   DCBWRITA                                                 04538000
@NM00013 EQU   DCBREAD                                                  04539000
@NM00012 EQU   DCBIFLGS                                                 04540000
DCBIFIOE EQU   DCBIFLGS                                                 04541000
DCBIFPCT EQU   DCBIFLGS                                                 04542000
DCBIFEC  EQU   DCBIFLGS                                                 04543000
DCBMFSTI EQU   DCBMFDMD                                                 04544000
DCBMFAWR EQU   DCBMFSTK                                                 04545000
DCBMFUIP EQU   DCBMFTMD                                                 04546000
DCBMFIDW EQU   DCBMFLCP                                                 04547000
DCBMFWRK EQU   DCBMFMVP                                                 04548000
DCBMFRDQ EQU   DCBMFWRT                                                 04549000
DCBMFGTQ EQU   DCBMFPUT                                                 04550000
DCBMFSTL EQU   DCBMACF2                                                 04551000
DCBMFCK  EQU   DCBMFDMG                                                 04552000
DCBMFRDX EQU   DCBMFCHK                                                 04553000
DCBMFDBF EQU   DCBMFSBG                                                 04554000
DCBMFRDI EQU   DCBMFLCG                                                 04555000
DCBMFRDK EQU   DCBMFMVG                                                 04556000
DCBMFWRQ EQU   DCBMFRD                                                  04557000
DCBMFPTQ EQU   DCBMFGET                                                 04558000
DCBMFECP EQU   DCBMACF1                                                 04559000
DCBTIOT  EQU   IHADCS25                                                 04560000
DCBMRSTI EQU   DCBMRDMD                                                 04561000
DCBMRAWR EQU   DCBMRSTK                                                 04562000
DCBMRUIP EQU   DCBMRTMD                                                 04563000
DCBMRIDW EQU   DCBMRLCP                                                 04564000
DCBMRWRK EQU   DCBMRMVP                                                 04565000
DCBMRRDQ EQU   DCBMRWRT                                                 04566000
DCBMRGTQ EQU   DCBMRPUT                                                 04567000
DCBMRSTL EQU   DCBMACR2                                                 04568000
DCBMRCK  EQU   DCBMRDMG                                                 04569000
DCBPGFXA EQU   DCBMRRDX                                                 04570000
DCBMRDBF EQU   DCBMRSBG                                                 04571000
DCBMRRDI EQU   DCBMRLCG                                                 04572000
DCBMRRDK EQU   DCBMRMVG                                                 04573000
DCBMRWRQ EQU   DCBMRRD                                                  04574000
DCBMRPTQ EQU   DCBMRGET                                                 04575000
DCBMRECP EQU   DCBMACR1                                                 04576000
@NM00011 EQU   DCBIFLG                                                  04577000
DCBIBIOE EQU   DCBIFLG                                                  04578000
DCBIBPCT EQU   DCBIFLG                                                  04579000
DCBIBEC  EQU   DCBIFLG                                                  04580000
DCBOFIOF EQU   DCBOFLGS                                                 04581000
DCBOFUEX EQU   DCBOFLGS                                                 04582000
DCBOFTM  EQU   DCBOFLGS                                                 04583000
DCBOFPPC EQU   DCBOFLGS                                                 04584000
DCBOFEOV EQU   DCBOFLGS                                                 04585000
DCBOFLRB EQU   DCBOFLGS                                                 04586000
DCBOFIOD EQU   DCBOFLWR                                                 04587000
DCBDDNAM EQU   IHADCS24                                                 04588000
DCBEXLSA EQU   DCBEXLST+1                                               04589000
DCBRECKL EQU   DCBRECFM                                                 04590000
DCBRECCC EQU   DCBRECFM                                                 04591000
DCBRECSB EQU   DCBRECFM                                                 04592000
DCBRECBR EQU   DCBRECFM                                                 04593000
DCBRECTO EQU   DCBRECLA                                                 04594000
DCBRECL  EQU   DCBRECLA                                                 04595000
DCBEODA  EQU   DCBEODAD+1                                               04596000
DCBBFA   EQU   DCBBFTEK                                                 04597000
DCBH0    EQU   DCBBFTEK                                                 04598000
DCBBFTKD EQU   DCBBFTEK                                                 04599000
DCBBFTE  EQU   DCBBFT                                                   04600000
DCBBFTS  EQU   DCBBFT                                                   04601000
DCBH1    EQU   DCBBFTEK                                                 04602000
DCBSVCXA EQU   DCBSVCXL+1                                               04603000
@NM00010 EQU   DCBSVCXL                                                 04604000
DCBODEBA EQU   DCBIOBAA                                                 04605000
@NM00009 EQU   DCBQSLM                                                  04606000
DCBUPDBT EQU   DCBQSLM                                                  04607000
DCBUPDCM EQU   DCBQSLM                                                  04608000
DCB1DVDS EQU   DCBQSLM                                                  04609000
@NM00008 EQU   DCBDSRG2                                                 04610000
DCBDSGTR EQU   DCBDSRG2                                                 04611000
DCBACBM  EQU   DCBDSRG2                                                 04612000
@NM00007 EQU   DCBDSRG2                                                 04613000
DCBDSGTQ EQU   DCBDSRG2                                                 04614000
DCBDSGTX EQU   DCBDSRG2                                                 04615000
DCBDSGGS EQU   DCBDSRG2                                                 04616000
DCBDSGU  EQU   DCBDSRG1                                                 04617000
DCBDSGPO EQU   DCBDSRG1                                                 04618000
DCBDSGMQ EQU   DCBDSRG1                                                 04619000
DCBDSGCQ EQU   DCBDSRG1                                                 04620000
DCBDSGCX EQU   DCBDSRG1                                                 04621000
DCBDSGDA EQU   DCBDSRG1                                                 04622000
DCBDSGPS EQU   DCBDSRG1                                                 04623000
DCBDSGIS EQU   DCBDSRG1                                                 04624000
DCBBUFL  EQU   IHADCS11+8                                               04625000
DCBBUFCA EQU   DCBBUFCB+1                                               04626000
DCBBUFNO EQU   DCBBUFCB                                                 04627000
DCBDEVT  EQU   DCBREL                                                   04628000
DCBKEYLE EQU   DCBRELB                                                  04629000
DCBTRBAL EQU   IHADCS01+6                                               04630000
@NM00006 EQU   IHADCS01+5                                               04631000
@NM00005 EQU   IHADCS01+4                                               04632000
DCBDVTBA EQU   DCBDVTBL+1                                               04633000
@NM00004 EQU   DCBDVTBL                                                 04634000
DCBKEYCN EQU   IHADCS00+4                                               04635000
DCBRELAD EQU   IHADCS00                                                 04636000
@NM00003 EQU   IHADCB                                                   04637000
CVTLEVL  EQU   CVTRELNO+2                                               04638000
CVTNUMB  EQU   CVTRELNO                                                 04639000
CVTMDL   EQU   CVTFIX+250                                               04640000
@NM00002 EQU   CVTFIX+248                                               04641000
@NM00001 EQU   CVTFIX                                                   04642000
CVTRV482 EQU   CVTXTNT2+128                                             04643000
CVTRV481 EQU   CVTXTNT2+124                                             04644000
CVTRV480 EQU   CVTXTNT2+120                                             04645000
CVTRV479 EQU   CVTXTNT2+118                                             04646000
CVTRV478 EQU   CVTXTNT2+117                                             04647000
CVTRV477 EQU   CVTXTNT2+116                                             04648000
CVTRV476 EQU   CVTXTNT2+115                                             04649000
CVTRV475 EQU   CVTXTNT2+114                                             04650000
CVTRV474 EQU   CVTRV466                                                 04651000
CVTRV473 EQU   CVTRV466                                                 04652000
CVTRV472 EQU   CVTRV466                                                 04653000
CVTRV471 EQU   CVTRV466                                                 04654000
CVTRV470 EQU   CVTRV466                                                 04655000
CVTRV469 EQU   CVTRV466                                                 04656000
CVTRV468 EQU   CVTRV466                                                 04657000
CVTRV467 EQU   CVTRV466                                                 04658000
CVTRV465 EQU   CVTRV457                                                 04659000
CVTRV464 EQU   CVTRV457                                                 04660000
CVTRV463 EQU   CVTRV457                                                 04661000
CVTRV462 EQU   CVTRV457                                                 04662000
CVTRV461 EQU   CVTRV457                                                 04663000
CVTRV460 EQU   CVTRV457                                                 04664000
CVTRV459 EQU   CVTRV457                                                 04665000
CVTRV458 EQU   CVTRV457                                                 04666000
CVTRV456 EQU   CVTXTNT2+108                                             04667000
CVTRV455 EQU   CVTXTNT2+104                                             04668000
CVTRV454 EQU   CVTXTNT2+100                                             04669000
CVTRV453 EQU   CVTXTNT2+96                                              04670000
CVTRV452 EQU   CVTXTNT2+94                                              04671000
CVTRV451 EQU   CVTXTNT2+92                                              04672000
CVTRV450 EQU   CVTXTNT2+90                                              04673000
CVTRV449 EQU   CVTXTNT2+88                                              04674000
CVTRV448 EQU   CVTXTNT2+87                                              04675000
CVTRV447 EQU   CVTXTNT2+86                                              04676000
CVTRV446 EQU   CVTRV438                                                 04677000
CVTRV445 EQU   CVTRV438                                                 04678000
CVTRV444 EQU   CVTRV438                                                 04679000
CVTRV443 EQU   CVTRV438                                                 04680000
CVTRV442 EQU   CVTRV438                                                 04681000
CVTRV441 EQU   CVTRV438                                                 04682000
CVTRV440 EQU   CVTRV438                                                 04683000
CVTRV439 EQU   CVTRV438                                                 04684000
CVTRV437 EQU   CVTRV429                                                 04685000
CVTRV436 EQU   CVTRV429                                                 04686000
CVTRV435 EQU   CVTRV429                                                 04687000
CVTRV434 EQU   CVTRV429                                                 04688000
CVTRV433 EQU   CVTRV429                                                 04689000
CVTRV432 EQU   CVTRV429                                                 04690000
CVTRV431 EQU   CVTRV429                                                 04691000
CVTRV430 EQU   CVTRV429                                                 04692000
CVTRV428 EQU   CVTXTNT2+80                                              04693000
CVTRV427 EQU   CVTXTNT2+76                                              04694000
CVTRV426 EQU   CVTXTNT2+72                                              04695000
CVTRV425 EQU   CVTXTNT2+68                                              04696000
CVTATACT EQU   CVTATCVT                                                 04697000
CVTRV423 EQU   CVTXTNT2+62                                              04698000
CVTRV422 EQU   CVTXTNT2+60                                              04699000
CVTRV421 EQU   CVTXTNT2+58                                              04700000
CVTRV420 EQU   CVTXTNT2+56                                              04701000
CVTRV419 EQU   CVTXTNT2+55                                              04702000
CVTRV418 EQU   CVTXTNT2+54                                              04703000
CVTRV417 EQU   CVTRV409                                                 04704000
CVTRV416 EQU   CVTRV409                                                 04705000
CVTRV415 EQU   CVTRV409                                                 04706000
CVTRV414 EQU   CVTRV409                                                 04707000
CVTRV413 EQU   CVTRV409                                                 04708000
CVTRV412 EQU   CVTRV409                                                 04709000
CVTRV411 EQU   CVTRV409                                                 04710000
CVTRV410 EQU   CVTRV409                                                 04711000
CVTRV408 EQU   CVTRV400                                                 04712000
CVTRV407 EQU   CVTRV400                                                 04713000
CVTRV406 EQU   CVTRV400                                                 04714000
CVTRV405 EQU   CVTRV400                                                 04715000
CVTRV404 EQU   CVTRV400                                                 04716000
CVTRV403 EQU   CVTRV400                                                 04717000
CVTRV402 EQU   CVTRV400                                                 04718000
CVTRV401 EQU   CVTRV400                                                 04719000
CVTRSVA1 EQU   CVTXTNT2+48                                              04720000
CVTRSVA0 EQU   CVTXTNT2+44                                              04721000
CVTRSV99 EQU   CVTXTNT2+40                                              04722000
CVTRSV98 EQU   CVTXTNT2+36                                              04723000
CVTRSV97 EQU   CVTXTNT2+34                                              04724000
CVTRSV96 EQU   CVTXTNT2+32                                              04725000
CVTOLTEP EQU   CVTXTNT2+28                                              04726000
CVTQIDA  EQU   CVTQID+1                                                 04727000
CVTRSV95 EQU   CVTQID                                                   04728000
CVTRSV94 EQU   CVTXTNT2+20                                              04729000
CVTRSV93 EQU   CVTXTNT2+16                                              04730000
CVTRSV92 EQU   CVTXTNT2+12                                              04731000
CVTRSV91 EQU   CVTXTNT2+6                                               04732000
CVTRSV9H EQU   CVTRSV90                                                 04733000
CVTRSV9G EQU   CVTRSV90                                                 04734000
CVTRSV9F EQU   CVTRSV90                                                 04735000
CVTRSV9E EQU   CVTRSV90                                                 04736000
CVTRSV9D EQU   CVTRSV90                                                 04737000
CVTRSV9C EQU   CVTRSV90                                                 04738000
CVTRSV9B EQU   CVTRSV90                                                 04739000
CVTRSV9A EQU   CVTRSV90                                                 04740000
CVTNUCLS EQU   CVTXTNT2+4                                               04741000
CVTDSSVA EQU   CVTDSSV+1                                                04742000
CVTRSV89 EQU   CVTDSSV                                                  04743000
CVTRSV88 EQU   CVTXTNT1+8                                               04744000
CVTRSV87 EQU   CVTXTNT1+4                                               04745000
CVTFACHN EQU   CVTXTNT1                                                 04746000
CVTRV488 EQU   CVTMAP+412                                               04747000
CVTRV487 EQU   CVTMAP+408                                               04748000
CVTRV486 EQU   CVTMAP+404                                               04749000
CVTRV485 EQU   CVTMAP+400                                               04750000
CVTRV484 EQU   CVTMAP+396                                               04751000
CVTAUTH  EQU   CVTMAP+392                                               04752000
CVTATMCA EQU   CVTATMCT+1                                               04753000
CVTATMST EQU   CVTATMCT                                                 04754000
CVTRSV61 EQU   CVTMAP+384                                               04755000
CVTVOLT1 EQU   CVTVOLM1+1                                               04756000
CVTVOLI1 EQU   CVTVOLF1                                                 04757000
CVTSTOA  EQU   CVTMAP+376                                               04758000
CVTRSV58 EQU   CVTMAP+374                                               04759000
CVTRSV57 EQU   CVTMAP+372                                               04760000
CVTDDCE  EQU   CVTMAP+368                                               04761000
CVTPNWFR EQU   CVTMAP+364                                               04762000
CVTSMF   EQU   CVTMAP+360                                               04763000
CVTSULK  EQU   CVTMAP+358                                               04764000
CVTSLKO  EQU   CVTSYSK                                                  04765000
CVTSLKP  EQU   CVTSYSK                                                  04766000
CVTSLKQ  EQU   CVTSYSK                                                  04767000
CVTSLKR  EQU   CVTSYSK                                                  04768000
CVTRSV56 EQU   CVTSYSK                                                  04769000
CVTRSV55 EQU   CVTSYSK                                                  04770000
CVTRSV54 EQU   CVTSYSK                                                  04771000
CVTRSV53 EQU   CVTSYSK                                                  04772000
CVTRSV52 EQU   CVTA1F1                                                  04773000
CVTRSV51 EQU   CVTA1F1                                                  04774000
CVTRSV50 EQU   CVTA1F1                                                  04775000
CVTRSV49 EQU   CVTA1F1                                                  04776000
CVTRSV48 EQU   CVTA1F1                                                  04777000
CVTRSV47 EQU   CVTA1F1                                                  04778000
CVTSRSW  EQU   CVTA1F1                                                  04779000
CVTPFSW  EQU   CVTA1F1                                                  04780000
CVTPCVT  EQU   CVTMAP+352                                               04781000
CVTRSV46 EQU   CVTMAP+344                                               04782000
CVTRSV45 EQU   CVTMAP+340                                               04783000
CVTRSV44 EQU   CVTMAP+338                                               04784000
CVTRSV43 EQU   CVTMAP+336                                               04785000
CVTHJESA EQU   CVTHJES+1                                                04786000
CVTRSV42 EQU   CVTHJES                                                  04787000
CVTEXT2A EQU   CVTEXT2+1                                                04788000
CVTRSV41 EQU   CVTEXT2                                                  04789000
CVTAPFA  EQU   CVTAPF+1                                                 04790000
CVTRSV40 EQU   CVTAPF                                                   04791000
CVTRV518 EQU   CVTINTLA                                                 04792000
CVTRV517 EQU   CVTERPV                                                  04793000
CVTEORM  EQU   CVTMAP+312                                               04794000
CVTMCHPR EQU   CVTMAP+308                                               04795000
CVTTZ    EQU   CVTMAP+304                                               04796000
CVTJEPS  EQU   CVTMAP+300                                               04797000
CVTJESCT EQU   CVTMAP+296                                               04798000
CVTMODE  EQU   CVTMAP+292                                               04799000
CVTPTRV  EQU   CVTMAP+288                                               04800000
CVTREAL  EQU   CVTMAP+284                                               04801000
CVTRSV39 EQU   CVTMAP+280                                               04802000
CVTRSV38 EQU   CVTMAP+276                                               04803000
CVTDMSRA EQU   CVTDMSR+1                                                04804000
CVTRSV37 EQU   CVTDMSR                                                  04805000
CVTQMSGA EQU   CVTQMSG+1                                                04806000
CVTRSV36 EQU   CVTQMSG                                                  04807000
CVTAMFF  EQU   CVTMAP+264                                               04808000
CVTPURGA EQU   CVTPURG+1                                                04809000
CVTRSV35 EQU   CVTPURG                                                  04810000
CVTCBSP  EQU   CVTMAP+256                                               04811000
CVTATERA EQU   CVTATER+1                                                04812000
CVTSYST  EQU   CVTATER                                                  04813000
CVTVOLT2 EQU   CVTTAT                                                   04814000
CVTVOLI2 EQU   CVTVOLF2                                                 04815000
CVTAQAVB EQU   CVTAQAVT+1                                               04816000
CVTRSV34 EQU   CVTTCMFG                                                 04817000
CVTRSV33 EQU   CVTTCMFG                                                 04818000
CVTRSV32 EQU   CVTTCMFG                                                 04819000
CVTRSV31 EQU   CVTTCMFG                                                 04820000
CVTRSV30 EQU   CVTTCMFG                                                 04821000
CVTRSV29 EQU   CVTTCMFG                                                 04822000
CVTRSV28 EQU   CVTTCMFG                                                 04823000
CVTTCRDY EQU   CVTTCMFG                                                 04824000
CVTGTFA  EQU   CVTGTF+1                                                 04825000
CVTRSV27 EQU   CVTGTFST                                                 04826000
CVTRNIO  EQU   CVTGTFST                                                 04827000
CVTRV319 EQU   CVTUSR                                                   04828000
CVTRV318 EQU   CVTFORM                                                  04829000
CVTRV317 EQU   CVTTMODE                                                 04830000
CVTRV316 EQU   CVTSTATE                                                 04831000
CVTRV315 EQU   CVTGTFS                                                  04832000
CVTGTFAV EQU   CVTGTFS                                                  04833000
CVT0SCR1 EQU   CVTMAP+232                                               04834000
CVTRV515 EQU   CVTMAP+228                                               04835000
CVTRMS   EQU   CVTMAP+224                                               04836000
CVTPATCH EQU   CVTMAP+220                                               04837000
CVTTSCE  EQU   CVTMAP+216                                               04838000
CVTLNKSC EQU   CVTMAP+214                                               04839000
CVTQABST EQU   CVTMAP+212                                               04840000
CVTMDLDS EQU   CVTMAP+208                                               04841000
CVTUSER  EQU   CVTMAP+204                                               04842000
CVTABEND EQU   CVTMAP+200                                               04843000
CVTSMCA  EQU   CVTMAP+196                                               04844000
CVTRSV18 EQU   CVTMAP+192                                               04845000
CVTQLPAQ EQU   CVTMAP+188                                               04846000
CVTQCDSR EQU   CVTMAP+184                                               04847000
CVTRSV17 EQU   CVTOPTB                                                  04848000
CVTRSV16 EQU   CVTOPTB                                                  04849000
CVTFP    EQU   CVTOPTB                                                  04850000
CVTAPTHR EQU   CVTOPTB                                                  04851000
CVTNLOG  EQU   CVTOPTB                                                  04852000
CVTTOD   EQU   CVTOPTB                                                  04853000
CVTCTIMS EQU   CVTOPTB                                                  04854000
CVTPROT  EQU   CVTOPTB                                                  04855000
CVTXPFP  EQU   CVTOPTA                                                  04856000
CVTASCII EQU   CVTOPTA                                                  04857000
CVTRSV13 EQU   CVTOPTA                                                  04858000
CVTRSV12 EQU   CVTOPTA                                                  04859000
CVTNIP   EQU   CVTOPTA                                                  04860000
CVTDDR   EQU   CVTOPTA                                                  04861000
CVTAPR   EQU   CVTOPTA                                                  04862000
CVTCCH   EQU   CVTOPTA                                                  04863000
CVTSNCTR EQU   CVTMAP+180                                               04864000
CVTQMWR  EQU   CVTMAP+176                                               04865000
CVTQOCR  EQU   CVTMAP+172                                               04866000
CVT1EF00 EQU   CVTMAP+168                                               04867000
CVTMZ00  EQU   CVTMAP+164                                               04868000
CVTHEAD  EQU   CVTMAP+160                                               04869000
CVTRSV11 EQU   CVTMAP+156                                               04870000
CVT0PT01 EQU   CVTMAP+152                                               04871000
CVTMSER  EQU   CVTMAP+148                                               04872000
CVTRV516 EQU   CVTIERLC                                                 04873000
CVTILCH  EQU   CVTMAP+140                                               04874000
CVT0DS   EQU   CVTMAP+136                                               04875000
CVTFBOSV EQU   CVTMAP+132                                               04876000
CVTNUCB  EQU   CVTMAP+128                                               04877000
CVTIXAVL EQU   CVTMAP+124                                               04878000
CVTIOQET EQU   CVTMAP+120                                               04879000
CVTDCBA  EQU   CVTMAP+117                                               04880000
CVTMVS2  EQU   CVTDCB                                                   04881000
CVT6DAT  EQU   CVTDCB                                                   04882000
CVT4MPS  EQU   CVTDCB                                                   04883000
CVTRSV09 EQU   CVTDCB                                                   04884000
CVT4MS1  EQU   CVTDCB                                                   04885000
CVT2SPS  EQU   CVTDCB                                                   04886000
CVT1SSS  EQU   CVTDCB                                                   04887000
CVTRSV08 EQU   CVTDCB                                                   04888000
CVTSTB   EQU   CVTMAP+112                                               04889000
CVTQTD00 EQU   CVTMAP+108                                               04890000
CVTQTE00 EQU   CVTMAP+104                                               04891000
CVTCUCB  EQU   CVTMAP+100                                               04892000
CVTSJQ   EQU   CVTMAP+96                                                04893000
CVTPBLDL EQU   CVTMAP+92                                                04894000
CVTTPC   EQU   CVTMAP+88                                                04895000
CVTSVDCB EQU   CVTMAP+84                                                04896000
CVTBRET  EQU   CVTMAP+82                                                04897000
CVTEXIT  EQU   CVTMAP+80                                                04898000
CVT0FN00 EQU   CVTMAP+76                                                04899000
CVTDARA  EQU   CVTDAR+1                                                 04900000
CVTRSV07 EQU   CVTFLGS1                                                 04901000
CVTRSV06 EQU   CVTFLGS1                                                 04902000
CVTRSV05 EQU   CVTFLGS1                                                 04903000
CVTRSV04 EQU   CVTFLGS1                                                 04904000
CVTRSV03 EQU   CVTFLGS1                                                 04905000
CVTRSV02 EQU   CVTFLGS1                                                 04906000
CVTRSV01 EQU   CVTFLGS1                                                 04907000
CVTDMPLK EQU   CVTFLGS1                                                 04908000
CVTXITP  EQU   CVTMAP+68                                                04909000
CVTZDTAB EQU   CVTMAP+64                                                04910000
CVTMSLT  EQU   CVTMAP+60                                                04911000
CVTDATE  EQU   CVTMAP+56                                                04912000
CVTBTERM EQU   CVTMAP+52                                                04913000
CVTSYSAD EQU   CVTMAP+48                                                04914000
CVTXTLER EQU   CVTMAP+44                                                04915000
CVTILK2  EQU   CVTMAP+40                                                04916000
CVTILK1  EQU   CVTMAP+36                                                04917000
CVTPRLTV EQU   CVTMAP+32                                                04918000
CVTPCNVT EQU   CVTMAP+28                                                04919000
CVTXAPG  EQU   CVTMAP+20                                                04920000
CVTBUF   EQU   CVTMAP+16                                                04921000
CVTJOB   EQU   CVTMAP+12                                                04922000
CVTLINK  EQU   CVTMAP+8                                                 04923000
CVT0EF00 EQU   CVTMAP+4                                                 04924000
CVTTCBP  EQU   CVTMAP                                                   04925000
CVT      EQU   CVTMAP                                                   04926000
@NM00069 EQU   PSA+3412                                                 04927000
PSASTAK  EQU   PSA+3072                                                 04928000
@NM00068 EQU   PSA+1032                                                 04929000
PSAUSEND EQU   PSA+1032                                                 04930000
PSAPCPSW EQU   PSA+1024                                                 04931000
PSARV060 EQU   PSA+1020                                                 04932000
PSARV059 EQU   PSA+1018                                                 04933000
PSASVC13 EQU   PSA+1016                                                 04934000
PSALSFCC EQU   PSA+1012                                                 04935000
PSASFACC EQU   PSA+1008                                                 04936000
PSASTOP  EQU   PSA+992                                                  04937000
PSASTART EQU   PSA+976                                                  04938000
PSARSPSW EQU   PSA+968                                                  04939000
PSASRPSW EQU   PSA+960                                                  04940000
PSARV045 EQU   PSA+892                                                  04941000
PSARV044 EQU   PSA+888                                                  04942000
PSARV043 EQU   PSA+884                                                  04943000
PSARV042 EQU   PSA+880                                                  04944000
PSARV041 EQU   PSA+876                                                  04945000
PSARV040 EQU   PSA+872                                                  04946000
PSARV025 EQU   PSA+868                                                  04947000
PSADSSED EQU   PSA+868                                                  04948000
PSADSSPR EQU   PSA+864                                                  04949000
PSADSSFW EQU   PSA+860                                                  04950000
PSADSS14 EQU   PSA+856                                                  04951000
PSADSSPP EQU   PSA+848                                                  04952000
PSADSSRP EQU   PSA+840                                                  04953000
PSADSS05 EQU   PSADSSF4                                                 04954000
PSADSS10 EQU   PSADSSF4                                                 04955000
PSADSSVE EQU   PSADSSF4                                                 04956000
PSADSSDE EQU   PSADSSF4                                                 04957000
PSADSSC0 EQU   PSADSSF4                                                 04958000
PSADSSIE EQU   PSADSSF4                                                 04959000
PSADSS12 EQU   PSADSSF4                                                 04960000
PSADSSRC EQU   PSADSSF4                                                 04961000
PSARV057 EQU   PSADSSF3                                                 04962000
PSARV056 EQU   PSADSSF3                                                 04963000
PSARV055 EQU   PSADSSF3                                                 04964000
PSARV054 EQU   PSADSSF3                                                 04965000
PSADSSRW EQU   PSADSSF3                                                 04966000
PSADSSNM EQU   PSADSSF3                                                 04967000
PSADSSES EQU   PSADSSF3                                                 04968000
PSADSSGP EQU   PSADSSF3                                                 04969000
PSADSSF2 EQU   PSADSSFL+1                                               04970000
PSADSSPI EQU   PSADSSF1                                                 04971000
PSADSSOI EQU   PSADSSF1                                                 04972000
PSADSSSP EQU   PSADSSF1                                                 04973000
PSADSSTP EQU   PSADSSF1                                                 04974000
PSADSSDW EQU   PSADSSF1                                                 04975000
PSADSSDD EQU   PSADSSF1                                                 04976000
PSADSSDM EQU   PSADSSF1                                                 04977000
PSADSSMV EQU   PSADSSF1                                                 04978000
PSADSSTS EQU   PSA+816                                                  04979000
PSADSSWK EQU   PSA+812                                                  04980000
PSADSSR3 EQU   PSA+808                                                  04981000
PSADSSR2 EQU   PSA+804                                                  04982000
PSADSSRS EQU   PSA+800                                                  04983000
PSASTOR  EQU   PSA+796                                                  04984000
PSACPUSA EQU   PSA+794                                                  04985000
PSAVSTAP EQU   PSA+792                                                  04986000
PSAWKVAP EQU   PSA+788                                                  04987000
PSAWKRAP EQU   PSA+784                                                  04988000
PSAMCHIC EQU   PSA+783                                                  04989000
PSARV061 EQU   PSA+782                                                  04990000
PSASYMSK EQU   PSA+781                                                  04991000
PSAMCHFL EQU   PSA+780                                                  04992000
PSACR0   EQU   PSA+776                                                  04993000
PSAPSWSV EQU   PSA+768                                                  04994000
PSACLHS  EQU   PSAHLHI                                                  04995000
PSALKR15 EQU   PSALKSA+60                                               04996000
PSALKR14 EQU   PSALKSA+56                                               04997000
PSALKR13 EQU   PSALKSA+52                                               04998000
PSALKR12 EQU   PSALKSA+48                                               04999000
PSALKR11 EQU   PSALKSA+44                                               05000000
PSALKR10 EQU   PSALKSA+40                                               05001000
PSALKR9  EQU   PSALKSA+36                                               05002000
PSALKR8  EQU   PSALKSA+32                                               05003000
PSALKR7  EQU   PSALKSA+28                                               05004000
PSALKR6  EQU   PSALKSA+24                                               05005000
PSALKR5  EQU   PSALKSA+20                                               05006000
PSALKR4  EQU   PSALKSA+16                                               05007000
PSALKR3  EQU   PSALKSA+12                                               05008000
PSALKR2  EQU   PSALKSA+8                                                05009000
PSALKR1  EQU   PSALKSA+4                                                05010000
PSALKR0  EQU   PSALKSA                                                  05011000
PSARV023 EQU   PSACLHT+52                                               05012000
PSALOCAL EQU   PSACLHT+48                                               05013000
PSACMSL  EQU   PSACLHT+44                                               05014000
PSAOPTL  EQU   PSACLHT+40                                               05015000
PSATPACL EQU   PSACLHT+36                                               05016000
PSATPDNL EQU   PSACLHT+32                                               05017000
PSATPNCL EQU   PSACLHT+28                                               05018000
PSAIOSLL EQU   PSACLHT+24                                               05019000
PSAIOSUL EQU   PSACLHT+20                                               05020000
PSAIOSCL EQU   PSACLHT+16                                               05021000
PSAIOSSL EQU   PSACLHT+12                                               05022000
PSASALCL EQU   PSACLHT+8                                                05023000
PSAASML  EQU   PSACLHT+4                                                05024000
PSADISPL EQU   PSACLHT                                                  05025000
PSASRSA  EQU   PSA+636                                                  05026000
PSARV050 EQU   PSA+634                                                  05027000
PSADSSGO EQU   PSA+633                                                  05028000
PSARECUR EQU   PSA+632                                                  05029000
PSAHLHIS EQU   PSA+628                                                  05030000
PSAIPCSA EQU   PSA+624                                                  05031000
@NM00067 EQU   PSA+621                                                  05032000
PSAIPCDM EQU   PSA+620                                                  05033000
PSAIPCD  EQU   PSA+616                                                  05034000
@NM00066 EQU   PSA+613                                                  05035000
PSAIPCRM EQU   PSA+612                                                  05036000
PSAIPCR  EQU   PSA+608                                                  05037000
PSAMCHEX EQU   PSA+600                                                  05038000
PSAMPSW  EQU   PSA+592                                                  05039000
PSAEXPS2 EQU   PSA+584                                                  05040000
PSAEXPS1 EQU   PSA+576                                                  05041000
PSAPIREG EQU   PSA+572                                                  05042000
PSARSREG EQU   PSA+568                                                  05043000
PSAGPREG EQU   PSA+556                                                  05044000
PSARV022 EQU   PSASUP4                                                  05045000
PSARV021 EQU   PSASUP4                                                  05046000
PSARV020 EQU   PSASUP4                                                  05047000
PSARV019 EQU   PSASUP4                                                  05048000
PSARV018 EQU   PSASUP4                                                  05049000
PSARV017 EQU   PSASUP4                                                  05050000
PSARV016 EQU   PSASUP4                                                  05051000
PSARV015 EQU   PSASUP4                                                  05052000
PSARV014 EQU   PSASUP3                                                  05053000
PSARV013 EQU   PSASUP3                                                  05054000
PSARV012 EQU   PSASUP3                                                  05055000
PSARV011 EQU   PSASUP3                                                  05056000
PSARV010 EQU   PSASUP3                                                  05057000
PSARV009 EQU   PSASUP3                                                  05058000
PSARV008 EQU   PSASUP3                                                  05059000
PSAIOSUP EQU   PSASUP3                                                  05060000
PSALCR   EQU   PSASUP2                                                  05061000
PSARTM   EQU   PSASUP2                                                  05062000
PSAACR   EQU   PSASUP2                                                  05063000
PSAIPCE2 EQU   PSASUP2                                                  05064000
PSAIPCES EQU   PSASUP2                                                  05065000
PSAIPCEC EQU   PSASUP2                                                  05066000
PSAGTF   EQU   PSASUP2                                                  05067000
PSAIPCRI EQU   PSASUP2                                                  05068000
PSAIPCRP EQU   PSASUP1                                                  05069000
PSAIPCDR EQU   PSASUP1                                                  05070000
PSADISP  EQU   PSASUP1                                                  05071000
PSALOCK  EQU   PSASUP1                                                  05072000
PSAPI    EQU   PSASUP1                                                  05073000
PSAEXT   EQU   PSASUP1                                                  05074000
PSASVC   EQU   PSASUP1                                                  05075000
PSAIO    EQU   PSASUP1                                                  05076000
PSAANEW  EQU   PSA+544                                                  05077000
PSATNEW  EQU   PSA+536                                                  05078000
PSALCCAR EQU   PSA+532                                                  05079000
PSALCCAV EQU   PSA+528                                                  05080000
PSAPCCAR EQU   PSA+524                                                  05081000
PSAPCCAV EQU   PSA+520                                                  05082000
PSACPULA EQU   PSA+518                                                  05083000
PSACPUPA EQU   PSA+516                                                  05084000
PSAPSA   EQU   PSA+512                                                  05085000
FLCHDEND EQU   PSA+512                                                  05086000
FLCCRSAV EQU   FLCMCLA+280                                              05087000
FLCGRSAV EQU   FLCMCLA+216                                              05088000
FLCFPSAV EQU   FLCMCLA+184                                              05089000
FLCFLA   EQU   FLCMCLA+88                                               05090000
FLCRGNCD EQU   FLCMCLA+84                                               05091000
FLCFSAA  EQU   FLCFSA+1                                                 05092000
@NM00065 EQU   FLCFSA                                                   05093000
@NM00064 EQU   FLCMCLA+72                                               05094000
FLCMCIC  EQU   FLCMCLA+64                                               05095000
@NM00063 EQU   FLCMCLA+20                                               05096000
FLCIOAA  EQU   FLCIOA+1                                                 05097000
@NM00062 EQU   FLCIOA                                                   05098000
@NM00061 EQU   FLCMCLA+15                                               05099000
@NM00060 EQU   FLCMCLA+14                                               05100000
@NM00059 EQU   FLCMCLA+12                                               05101000
FLCLCL   EQU   FLCMCLA+8                                                05102000
FLCIOELA EQU   FLCIOEL+1                                                05103000
@NM00058 EQU   FLCIOEL                                                  05104000
FLCCHNID EQU   FLCMCLA                                                  05105000
@NM00057 EQU   PSA+160                                                  05106000
FLCMTRCD EQU   PSA+157                                                  05107000
@NM00056 EQU   PSA+156                                                  05108000
FLCPERA  EQU   FLCPER+1                                                 05109000
@NM00055 EQU   FLCPER                                                   05110000
@NM00054 EQU   PSA+151                                                  05111000
FLCPERCD EQU   PSA+150                                                  05112000
FLCMCNUM EQU   PSA+149                                                  05113000
@NM00053 EQU   PSA+148                                                  05114000
FLCTEAA  EQU   FLCTEA+1                                                 05115000
@NM00052 EQU   FLCTEA                                                   05116000
PSAPIPC  EQU   PSAPICOD                                                 05117000
PSAPIMC  EQU   PSAPICOD                                                 05118000
PSAPIPER EQU   PSAPICOD                                                 05119000
PSARV049 EQU   FLCPICOD                                                 05120000
FLCPILCB EQU   FLCPIILC                                                 05121000
@NM00051 EQU   FLCPIILC                                                 05122000
@NM00050 EQU   PSAEPPSW                                                 05123000
FLCSVCN  EQU   PSAESPSW+2                                               05124000
FLCSILCB EQU   FLCSVILC                                                 05125000
@NM00049 EQU   FLCSVILC                                                 05126000
@NM00048 EQU   PSAESPSW                                                 05127000
FLCEICOD EQU   PSAEEPSW+2                                               05128000
PSASPAD  EQU   PSAEEPSW                                                 05129000
@NM00047 EQU   PSA+128                                                  05130000
FLCINPSW EQU   PSA+120                                                  05131000
FLCMNPSW EQU   PSA+112                                                  05132000
FLCPNPSW EQU   PSA+104                                                  05133000
FLCSNPSW EQU   PSA+96                                                   05134000
FLCENPSW EQU   PSA+88                                                   05135000
FLCTRACE EQU   PSA+84                                                   05136000
FLCTIMER EQU   PSA+80                                                   05137000
FLCCVT2  EQU   PSA+76                                                   05138000
FLCCAW   EQU   PSA+72                                                   05139000
FLCCSW   EQU   PSA+64                                                   05140000
FLCIOPSW EQU   PSA+56                                                   05141000
FLCMOPSW EQU   PSA+48                                                   05142000
FLCPOPSW EQU   PSA+40                                                   05143000
FLCSOPSW EQU   PSA+32                                                   05144000
FLCEOPSW EQU   PSA+24                                                   05145000
@NM00046 EQU   FLCICCW2+4                                               05146000
FLCCVT   EQU   FLCICCW2                                                 05147000
FLCICCW1 EQU   FLCROPSW                                                 05148000
FLCIPPSW EQU   FLCRNPSW                                                 05149000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      05150000
@RT00166 EQU   CLEANRTN                                                 05151000
@RT00168 EQU   DUMPRTN                                                  05152000
@RT00170 EQU   CLEANRTN                                                 05153000
@RT00223 EQU   ABEND                                                    05154000
@RT00250 EQU   ABEND                                                    05155000
@RF00666 EQU   @EL00003                                                 05156000
@PB00003 EQU   @PB00004                                                 05157000
@PB00002 EQU   @PB00003                                                 05158000
@ENDDATA EQU   *                                                        05159000
         END   IGCT005C,(C'PL/S-II',0502,74053)                         05160000
./  ADD  SSI=40531044,NAME=IGCT005G
         TITLE 'IGCT005G - FREEDBUF TASK RECOVERY ROUTINE              *00001000
                       '                                                00002000
IGCT005G CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL2(@EP00001-@MAINENT)                                   00007000
         DC    AL1(24)                                             0001 00008000
         DC    C'IGCT005G YM7568 02/15/74'                         0001 00009000
BACKUP5G DS    0H                                                  0001 00010000
         USING *,@15                                               0001 00011000
         B     @PROLOG                                             0001 00012000
         DC    AL2(@EP00739-BACKUP5G)                                   00013000
         ENTRY BACKUP5G                                                 00014000
         DROP  @15                                                      00015000
@PROLOG  BALR  @09,0                                               0001 00016000
@PSTART  DS    0H                                                  0001 00017000
         USING @PSTART,@09                                         0001 00018000
         AH    @15,4(,@15)                                         0001 00019000
         BR    @15                                                 0001 00020000
@EP00001 DS    0H                                                  0002 00021000
RBPRFXLN EQU 64                                                         00022000
RBPRFLNA EQU 32                                                         00023000
PRBLEN   EQU 136                                                        00024000
SIRBLEN  EQU 200                                                        00025000
TIRBLEN  EQU 136                                                        00026000
IRBLEN   EQU 128                                                        00027000
SVRBLEN  EQU 200                                                        00028000
SPDFID   EQU   X'FE'                                                    00029000
*   SDWAPTR=GPR01P;                 /* REG 1 ON ENTRY HAS SDWA       */ 00030000
         LR    SDWAPTR,GPR01P                                      0167 00031000
*   SDWAURAL=LENGTH(RECORDWK);      /* INIT LEN OF RECORDING INFO    */ 00032000
         MVI   SDWAURAL(SDWAPTR),X'17'                             0168 00033000
*   RBSECPTR=SDWAPARM;              /* SDWA HAS SVRB ADDR            */ 00034000
         L     RBSECPTR,SDWAPARM(,SDWAPTR)                         0169 00035000
*   WKALOCK='0'B;                   /* INITIALIZE LOCK SW OFF        */ 00036000
         NI    WKALOCK(RBSECPTR),B'11111110'                       0170 00037000
*   RFY                                                            0171 00038000
*     GPR01P UNRSTD;                                               0171 00039000
*   RFY                                                            0172 00040000
*     USL BASED(DCBDYNB);           /* SET UP PERMANENT USL BASE     */ 00041000
*                                                                  0172 00042000
*/********************************************************************/ 00043000
*/* THE FOLLOWING ROUTINE ANALYZES THE CAUSE AND STAGE OF THE ABEND  */ 00044000
*/* BY DETERMINING IF THE ABEND WAS PERCOLATED, A DUMP WAS TAKEN,    */ 00045000
*/* IF IT WAS A PROGRAM CHECK, IF THERE WAS PREVIOUS RECOVERY, IF    */ 00046000
*/* THE CURRENT RB FAILED OR A PREVIOUS FRR FAILED. BASED ON THIS    */ 00047000
*/* ANALYSIS THE CONTROL IS TRANSFERRED TO A ROUTINE TO: 1) CHECK    */ 00048000
*/* FOR USER INPUT ERRORS,  2) CLEAN UP RESOURCES AND CONTINUE TO    */ 00049000
*/* TERMINATE, OR  3) TAKE AN SVC DUMP BEFORE CONTINUING TO          */ 00050000
*/* TERMINATE.                                                       */ 00051000
*/*          INPUT TO THIS ROUTINE IS AS FOLLOWS:                    */ 00052000
*/*                    REG  5 - SDWA ADDRESS                         */ 00053000
*/*                    REG  8 - SVRB ADDRESS                         */ 00054000
*/*                    REG 13 - RTM SAVEAREA ADDRESS                 */ 00055000
*/********************************************************************/ 00056000
*                                                                  0173 00057000
*ANALYZE:                                                          0173 00058000
*   ;                               /* ANALYZE THE ERROR             */ 00059000
ANALYZE  DS    0H                                                  0174 00060000
*   DO;                             /* ?IGGSTART USER(USERRTN)     0174 00061000
*                                      SDUMP(DUMPRTN) CLEAN(CLEANRTN)*/ 00062000
*                                                                  0174 00063000
*/*  MACCOMP Y-2 SC1D0/SJ0204                                        */ 00064000
*/*  MACSTAT Y-2 74050/YM7586                                        */ 00065000
*/********************************************************************  00066000
*                                                                    */ 00067000
*/* THIS ROUTINE ANALYSES FLAGS IN THE SDWA TO DETERMINE             */ 00068000
*/* WHAT TYPE OF FUNCTION TO PERFORM                                 */ 00069000
*/* THE FLAG COMBINATIONS TESTED AND THE ACTIONS TAKEN ARE SUMMARIZED*/ 00070000
*/* IN THE FOLLOWING TABLE:                                          */ 00071000
*/*                                                                  */ 00072000
*/*   PREVIOUS  || CAUSE OF ERROR ENTRY                              */ 00073000
*/*  PROCESSING || MCHK/PGIO/TEXC  OTHER                             */ 00074000
*/*  ___________||________________________                           */ 00075000
*/*       *EAS  ||        C          C                               */ 00076000
*/*       *CLUP ||        C          C                               */ 00077000
*/*       *STAF ||        S          S                               */ 00078000
*/*       *PERC ||        C          U                               */ 00079000
*/*       *NRBE ||        C          U                               */ 00080000
*/*        NONE ||        C          U                               */ 00081000
*/*                                                                  */ 00082000
*/*       * THESE BITS ARE NOT ALL MUTUALLY EXCLUSIVE. THEY ARE      */ 00083000
*/*         TESTED IN THE ORDER LISTED.                              */ 00084000
*/*                                                                  */ 00085000
*/*       FUNCTIONS TO BE PERFORMED:                                 */ 00086000
*/*                                                                  */ 00087000
*/* C (CLEANRTN)--CLEAN UP RESOURCES AND PERCOLATE ERROR             */ 00088000
*/*                                                                  */ 00089000
*/* S (DUMPRTN)--PREVIOUS RECOVERY ROUTINE FAILED.                   */ 00090000
*/* TAKE A DUMP FOR IT, THEN TREAT AS C                              */ 00091000
*/*                                                                  */ 00092000
*/* U (USERRTN)--VALIDATE USER INPUT. IF IT IS IN ERROR,             */ 00093000
*/* TAKE PROBLEM DETERMINATION ACTIONS AND THEN CLEAN UP.            */ 00094000
*/* IF IT IS VALID, ASSUME A SYSTEM ERROR IN COVERED FUNCTION.       */ 00095000
*/* TAKE A DUMP, THEN TREAT AS C                                     */ 00096000
*/********************************************************************  00097000
*                                                                    */ 00098000
*                                                                  0175 00099000
*     IF SDWAEAS='1'B               /* LOWER ESTAE ALREADY DUMPED    */ 00100000
*         |SDWACLUP='1'B THEN       /* OR RTM SAYS CLEANUP           */ 00101000
         TM    SDWAEAS(SDWAPTR),B'00001000'                        0175 00102000
         BO    @RT00175                                            0175 00103000
         TM    SDWACLUP(SDWAPTR),B'10000000'                       0175 00104000
         BO    @RT00175                                            0175 00105000
*       GOTO CLEANRTN;              /* GO CLEAN UP & GET OUT         */ 00106000
*     IF SDWASTAF='1'B THEN         /* A LOWER LEVEL ESTAE/FRR       */ 00107000
         TM    SDWASTAF(SDWAPTR),B'10000000'                       0177 00108000
         BO    @RT00177                                            0177 00109000
*       GOTO DUMPRTN;               /* WAS EXECUTING AND FAILED      */ 00110000
*                                   /* TAKE A DUMP FOR IT            */ 00111000
*     IF SDWATEXC='1'B              /* SOME NON-PROGRAM TYPE         */ 00112000
*         |SDWAPGIO='1'B            /* ERROR HAS OCCURRED            */ 00113000
*         |SDWAMCHK='1'B THEN       /* GO CLEAN UP & GET OUT         */ 00114000
         TM    SDWATEXC(SDWAPTR),B'10000011'                       0179 00115000
         BNZ   @RT00179                                            0179 00116000
*       GOTO CLEANRTN;                                             0180 00117000
*     GOTO USERRTN;                 /* CHECK USER INPUT              */ 00118000
*                                                                  0181 00119000
         B     USERRTN                                             0181 00120000
*/********************************************************************  00121000
*                                                                    */ 00122000
*                                                                  0182 00123000
*   END;                            /* ANALYZE ABEND CONDITION       */ 00124000
*                                                                  0182 00125000
*/********************************************************************/ 00126000
*/* THE FOLLOWING ROUTINE VALIDITY CHECKS ALL USER INPUT TO SVC 57   */ 00127000
*/* TO DETERMINE IF THIS CAUSED THE ABEND IN FREEDBUF.  THE FOLLOW-  */ 00128000
*/* ING CONTROL BLOCKS/DATA AREAS WILL BE VALIDATED WHERE APPLICA-   */ 00129000
*/* BLE:  DCB, DECB, IOB, USL, AND BCB/BUFFERS/SWAS.                 */ 00130000
*/*          INPUT TO THIS ROUTINE IS THE SVRB ADDRESS WHICH WAS     */ 00131000
*/* PASSED IN THE SDWA FROM IGC0005G. THE SVRB WILL CONTAIN THE      */ 00132000
*/* INPUT PARAMETERS TO FREEDBUF:  REG 1 - DCB ADDRESS               */ 00133000
*/*                                REG 0 - DECB ADDRESS              */ 00134000
*/* EACH CONTROL BLOCK IS VALIDATED BY THE SYSTEM VALIDITY CHECK     */ 00135000
*/* ROUTINE.  IF ONE IS FOUND TO BE IN ERROR, THE CONTROL BLOCKS     */ 00136000
*/* ALREADY VALIDATED ARE TRACED, A WTP IS ISSUED AND SETRP TO GIVE  */ 00137000
*/* CONTROL TO THE RETRY ROUTINE.  IF ALL BLOCKS ARE VALID, CONTROL  */ 00138000
*/* IS GIVEN TO THE SYSERRTN ROUTINE. THE REGISTER LABELED BLKCTR    */ 00139000
*/* WILL BE USED TO IDENTIFY THE PARTICULAR CONTROL BLOCK BEING      */ 00140000
*/* VALIDATED.  IT WILL BE INCREMENTED AFTER SUCCESSFUL VALIDATION   */ 00141000
*/* OF EACH BLOCK.  THIS REGISTER IS USED THROUGHOUT THE ESTAE       */ 00142000
*/* HEREAFTER AS AN INDEX TO IDENTIFY/SET THE RETURN CODE ASSOCIATED */ 00143000
*/* WITH THE BLOCK FOUND TO BE IN ERROR.                             */ 00144000
*/*        BLKCTR(R7) VALUES SHOULD BE INTERPRETED AS FOLLOWS:       */ 00145000
*/*                 1 = DCB ERROR                                    */ 00146000
*/*                 2 = DECB ERROR                                   */ 00147000
*/*                 3 = BCB ERROR                                    */ 00148000
*/*                 4 = USL ERROR (VIRTUAL ONLY)                     */ 00149000
*/*                 5 = NEXT IOB ERROR                               */ 00150000
*/*                 6 = SYSTEM ERROR                                 */ 00151000
*/*                10 = ERROR IN PREVIOUS RECOVERY RTN OR ANOTHER    */ 00152000
*/*                     RB LEVEL(BRANCHED TO DUMPRTN OR CLEANRTN)    */ 00153000
*/********************************************************************/ 00154000
*                                                                  0183 00155000
*USERRTN:                                                          0183 00156000
*   ;                               /* VALIDATE THE CONTROL BLKS     */ 00157000
*                                                                  0183 00158000
USERRTN  DS    0H                                                  0184 00159000
*/*   GET THE LOCAL LOCK BEFORE VALIDATING THE CONTROL BLOCKS        */ 00160000
*                                                                  0184 00161000
*   RFY                                                            0184 00162000
*     GPR00P RSTD;                                                 0184 00163000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVEAREA AROUND      */ 00164000
         LR    GPR00P,SAVEPTR                                      0185 00165000
*SETLOCK:                                                          0186 00166000
*   ;                               /* GET THE LOCAL LOCK            */ 00167000
SETLOCK  DS    0H                                                  0187 00168000
*   DO;                             /* SETLOCK (OBTAIN) MODE(UNCOND)    00169000
*                                      TYPE(LOCAL) RELATED(CNTRLBLK,I   00170000
*                                      GCT005G,(FREELOCK,TRACE,CLEAN)   00171000
*                                      )                             */ 00172000
*     RFY                                                          0188 00173000
*      (GPR11P,                                                    0188 00174000
*       GPR12P,                                                    0188 00175000
*       GPR13P,                                                    0188 00176000
*       GPR14P)RSTD;                                               0188 00177000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0189 00178000
*                                      TABLE.                        */ 00179000
         L     GPR13P,PSALITA                                      0189 00180000
*     GEN(LM GPR11P,GPR13P,576(GPR13P));/* LOAD LOCKWORD, CLHT AND 0190 00181000
*                                      ENTRY ADRS.                   */ 00182000
         LM GPR11P,GPR13P,576(GPR13P)                                   00183000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00184000
         BALR GPR14P,GPR13P                                             00185000
*     RFY                                                          0192 00186000
*      (GPR11P,                                                    0192 00187000
*       GPR12P,                                                    0192 00188000
*       GPR13P,                                                    0192 00189000
*       GPR14P)UNRSTD;                                             0192 00190000
*   END;                            /* SETLOCK (OBTAIN) MODE(UNCOND)    00191000
*                                      TYPE(LOCAL) RELATED(CNTRLBLK,I   00192000
*                                      GCT005G,(FREELOCK,TRACE,CLEAN)   00193000
*                                      )                             */ 00194000
*   SAVEPTR=GPR00P;                 /* RESTORE RTM SAVEAREA PTR      */ 00195000
         LR    SAVEPTR,GPR00P                                      0194 00196000
*   RFY                                                            0195 00197000
*     GPR00P UNRSTD;                                               0195 00198000
*                                                                  0195 00199000
*/********************************************************************/ 00200000
*/*       SET UP INPUT REGISTERS TO SYSTEM VALIDITY ROUTINE          */ 00201000
*/*                REGISTER 1 - START OF AREA TO VERIFY              */ 00202000
*/*                REGISTER 2 - END OF AREA TO VERIFY                */ 00203000
*/*                REGISTER 4 - ADDRESS OF KEY - 28                  */ 00204000
*/*                REGISTER 14- RETURN ADDRESS                       */ 00205000
*/*                REGISTER 15- ADDRESS OF VALIDITY ROUTINE          */ 00206000
*/* BLOCKS ARE VERIFIED FOR CORE OWNERSHIP AND ALIGNMENT, (WITH      */ 00207000
*/* THE EXCEPTION OF THE DCB WHICH HAS NO BOUNDARY REQUIREMENTS.)    */ 00208000
*/********************************************************************/ 00209000
*                                                                  0196 00210000
*   RFY                                                            0196 00211000
*    (GPR01P,                                                      0196 00212000
*     GPR02P,                                                      0196 00213000
*     GPR04P,                                                      0196 00214000
*     GPR14P,                                                      0196 00215000
*     GPR15P)RSTD;                  /* RESTRICT REGS - VALID CHK     */ 00216000
*   GPR04P=(ADDR(RBLINK->RBOPSW(2)))-KEYOFFS;/* ADDR OF KEY-28       */ 00217000
         L     GPR04P,RBLINK(,RBSECPTR)                            0197 00218000
         LA    GPR04P,RBOPSW+1(,GPR04P)                            0197 00219000
         SH    GPR04P,@CH02596                                     0197 00220000
*   BLKCTR=1;                       /* SET CTR TO FIRST BLOCK        */ 00221000
         LA    BLKCTR,1                                            0198 00222000
*DCBCHK:                                                           0199 00223000
*   ;                               /* VALIDITY CHECK THE DCB(=1)    */ 00224000
DCBCHK   DS    0H                                                  0200 00225000
*   GPR01P=RBGRS1+NULLPREF;         /* DCB ADDR+NULL PREFIX          */ 00226000
         LA    GPR01P,16                                           0200 00227000
         A     GPR01P,RBGRS1(,RBSECPTR)                            0200 00228000
*   GPR02P=GPR01P+DCBLEN-NULLPREF-1;/* ENDING ADDR OF DCB            */ 00229000
         LR    GPR02P,GPR01P                                       0201 00230000
         SH    GPR02P,@CH03559                                     0201 00231000
*   CALL CVT0VL00;                  /* CALL SYS VAL CHCK,NO ALIGN    */ 00232000
         L     @12,CVTPTR                                          0202 00233000
         L     @15,CVT0VL00(,@12)                                  0202 00234000
         BALR  @14,@15                                             0202 00235000
*   BC(7,ABEND);                    /* IF ERROR, GO TO ABEND RTN     */ 00236000
         BC    7,ABEND                                             0203 00237000
*   IF DCBOFOPN='0'B THEN           /* CHECK IF DCB OPEN             */ 00238000
         L     @12,DCBPTR(,RBSECPTR)                               0204 00239000
         TM    DCBOFOPN+40(@12),B'00010000'                        0204 00240000
         BZ    @RT00204                                            0204 00241000
*     GOTO ABEND;                   /* ABEND IF DCB NOT OPEN         */ 00242000
*   BLKCTR=BLKCTR+1;                /* UP BLKID TO VALIDATE DECB     */ 00243000
         AH    BLKCTR,@CH00083                                     0206 00244000
*DECBCHK:                                                          0207 00245000
*   ;                               /* VALIDITY CHK THE DECB(=2)     */ 00246000
DECBCHK  DS    0H                                                  0208 00247000
*   GPR01P=ABS(RBGRS0);             /* DECB ADDRESS WAS INPUT        */ 00248000
         L     GPR01P,RBGRS0(,RBSECPTR)                            0208 00249000
         LPR   GPR01P,GPR01P                                       0208 00250000
*                                   /* GET POS IN CASE EXTEND        */ 00251000
*   GPR02P=GPR01P+DECBLEN-1;        /* ENDING ADDR OF DECB           */ 00252000
         LR    GPR02P,GPR01P                                       0209 00253000
         SH    GPR02P,@CH03560                                     0209 00254000
*   CALL CVT0VL01;                  /* CALL SYS VAL CHECK+ALIGN      */ 00255000
         L     @12,CVTPTR                                          0210 00256000
         L     @15,CVT0VL01(,@12)                                  0210 00257000
         BALR  @14,@15                                             0210 00258000
*   BC(7,ABEND);                    /* IF ERROR, GO TO ABEND RTN     */ 00259000
         BC    7,ABEND                                             0211 00260000
*   BLKCTR=BLKCTR+1;                /* UP BLKID TO BCB(=3)           */ 00261000
         AH    BLKCTR,@CH00083                                     0212 00262000
*BCBCHK1:                                                          0213 00263000
*   ;                               /* VALIDATE 1ST PART BCB(=3)     */ 00264000
BCBCHK1  DS    0H                                                  0214 00265000
*   IF TCBRV¬='1'B THEN             /* IS ADDRESS SPACE=REAL/VIRT    */ 00266000
         L     @12,PSATOLD                                         0214 00267000
         TM    TCBRV(@12),B'10000000'                              0214 00268000
         BO    @RF00214                                            0214 00269000
*     DO;                           /* IF ADDRESS SPACE=VIRTUAL      */ 00270000
*       RFY                                                        0216 00271000
*         BCBDEFV BASED(DCBBUFCB);  /* ADDRESSABILITY FOR DSECT      */ 00272000
*       GPR01P=ADDR(BCBDEFV)-USLSZFST;/* SUBTRACT SIZE OF 1ST USL    */ 00273000
         L     @12,DCBPTR(,RBSECPTR)                               0217 00274000
         L     @12,DCBBUFCB+16(,@12)                               0217 00275000
         LR    GPR01P,@12                                          0217 00276000
         SH    GPR01P,@CH01980                                     0217 00277000
*       GPR02P=ADDR(BCBTBRS1)+3;    /* END ADDR THROUGH SIZE FLD     */ 00278000
         LA    GPR02P,BCBTBRS1(,@12)                               0218 00279000
         AH    GPR02P,@CH00107                                     0218 00280000
*     END;                                                         0219 00281000
*   ELSE                            /* IF ADDRESS SPACE=REAL         */ 00282000
*     DO;                           /* GET BUFFER QUEUE ADDR         */ 00283000
         B     @RC00214                                            0220 00284000
@RF00214 DS    0H                                                  0221 00285000
*       RFY                                                        0221 00286000
*         BCBDEFR BASED(DCBBUFCB);  /* ADDRESSBILITY FOR DSECT       */ 00287000
*       GPR01P=ADDR(BCBDEFR);       /* BEGINNING OF BCB,NO USL       */ 00288000
         L     @12,DCBPTR(,RBSECPTR)                               0222 00289000
         L     @12,DCBBUFCB+16(,@12)                               0222 00290000
         LR    GPR01P,@12                                          0222 00291000
*       GPR02P=ADDR(BCBTBRS)+3;     /* END ADDR THROUGH SIZE FLD     */ 00292000
         LA    GPR02P,BCBTBRS(,@12)                                0223 00293000
         AH    GPR02P,@CH00107                                     0223 00294000
*     END;                                                         0224 00295000
*   CALL CVT0VL01;                  /* CALL SYS VAL CHECK+ALIGN      */ 00296000
@RC00214 L     @12,CVTPTR                                          0225 00297000
         L     @15,CVT0VL01(,@12)                                  0225 00298000
         BALR  @14,@15                                             0225 00299000
*   BC(7,ABEND);                    /* IF ERROR, GO TO ABEND RTN     */ 00300000
         BC    7,ABEND                                             0226 00301000
*                                   /* VALIDATE 2ND HALF OF BCB      */ 00302000
*   GPR02P=ADDR(BCBDEFR)+BCBTBRS-1; /* END ADDR BCB/BUFFERS SIZE   0227 00303000
*                                      FIELD IS SAME LOCATION IN BOTH   00304000
*                                      VIRTUAL/ACTUAL BCBS           */ 00305000
         L     @12,DCBPTR(,RBSECPTR)                               0227 00306000
         L     @12,DCBBUFCB+16(,@12)                               0227 00307000
         LR    GPR02P,@12                                          0227 00308000
         A     GPR02P,BCBTBRS(,@12)                                0227 00309000
         BCTR  GPR02P,0                                            0227 00310000
*   CALL CVT0VL01;                  /* CALL SYS VAL CHECK+ALIGN      */ 00311000
         L     @12,CVTPTR                                          0228 00312000
         L     @15,CVT0VL01(,@12)                                  0228 00313000
         BALR  @14,@15                                             0228 00314000
*   BC(7,ABEND);                    /* IF ERROR, GO TO ABEND RTN     */ 00315000
         BC    7,ABEND                                             0229 00316000
*   BLKCTR=BLKCTR+1;                /* UP BLKID TO USL(=4)           */ 00317000
         AH    BLKCTR,@CH00083                                     0230 00318000
*USLCHK1:                                                          0231 00319000
*   ;                               /* VALIDATE 1ST OF USL(=4)       */ 00320000
USLCHK1  DS    0H                                                  0232 00321000
*   IF TCBRV¬='1'B THEN             /* IF ADDRESSPACE=VIRTUAL        */ 00322000
         L     @12,PSATOLD                                         0232 00323000
         TM    TCBRV(@12),B'10000000'                              0232 00324000
         BO    @RF00232                                            0232 00325000
*     DO;                                                          0233 00326000
*       GPR01P=ADDR(USL);           /* PUT USL BASE IN PARM REG      */ 00327000
         L     @12,DCBPTR(,RBSECPTR)                               0234 00328000
         L     @12,DCBDYNB+52(,@12)                                0234 00329000
         LR    GPR01P,@12                                          0234 00330000
*       GPR02P=ADDR(USL)+LENGTH(USLSIZE)-1;/* ADDR OF USL LG FIELD-     00331000
*                                      LG FLD 1ST 2 BYTES IN USL     */ 00332000
         SH    @12,@CH03561                                        0235 00333000
         LR    GPR02P,@12                                          0235 00334000
*       CALL CVT0VL01;              /* VALIDATE 1ST 2 BYTES+ALIGN    */ 00335000
         L     @12,CVTPTR                                          0236 00336000
         L     @15,CVT0VL01(,@12)                                  0236 00337000
         BALR  @14,@15                                             0236 00338000
*       BC(7,ABEND);                /* IF ERROR,GO TO ABEND RTN      */ 00339000
         BC    7,ABEND                                             0237 00340000
*                                   /* VALIDATE REST OF USL          */ 00341000
*       GPR02P=ADDR(USL)+USLSIZE-1; /* ENDING ADDRESS OF USL         */ 00342000
         L     @12,DCBPTR(,RBSECPTR)                               0238 00343000
         L     @12,DCBDYNB+52(,@12)                                0238 00344000
         SR    GPR02P,GPR02P                                       0238 00345000
         ICM   GPR02P,3,USLSIZE(@12)                               0238 00346000
         AR    GPR02P,@12                                          0238 00347000
         BCTR  GPR02P,0                                            0238 00348000
*       CALL CVT0VL01;              /* VALIDATE 1ST 2 BYTES+ALIGN    */ 00349000
         L     @12,CVTPTR                                          0239 00350000
         L     @15,CVT0VL01(,@12)                                  0239 00351000
         BALR  @14,@15                                             0239 00352000
*       BC(7,ABEND);                /* IF ERROR,GO TO ABEND RTN      */ 00353000
         BC    7,ABEND                                             0240 00354000
*     END;                                                         0241 00355000
*   BLKCTR=BLKCTR+1;                /* UP BLKID TO NEXT IOB(=5)      */ 00356000
@RF00232 AH    BLKCTR,@CH00083                                     0242 00357000
*IOBCHK1:                                                          0243 00358000
*   ;                               /* VALIDITY CHCK 1ST HALF(=5)    */ 00359000
IOBCHK1  DS    0H                                                  0244 00360000
*   IF WKABUFAS='1'B|WKAIOBQ='1'B|WKAEXCP='1'B THEN/* NXT IOB EXISTS */ 00361000
         TM    WKABUFAS(RBSECPTR),B'11100000'                      0244 00362000
         BZ    @RF00244                                            0244 00363000
*     DO;                           /* YES, THEN MUST VALIDATE IT    */ 00364000
*       RFY                                                        0246 00365000
*         IOBSTDRD BASED(WKAIOBRG); /* ADDRESSABILITY FOR DSECT      */ 00366000
*       GPR02P=ADDR(IOBDPLAD)-1;    /* END ADDR THROUGH IOB SIZE     */ 00367000
         L     @12,WKAIOBRG(,RBSECPTR)                             0247 00368000
         LA    GPR02P,IOBDPLAD(,@12)                               0247 00369000
         BCTR  GPR02P,0                                            0247 00370000
*       IF DCBBFTKR='1'B THEN       /* IF RECFM=VS RECORDS           */ 00371000
         LA    @06,16                                              0248 00372000
         L     @03,DCBPTR(,RBSECPTR)                               0248 00373000
         AR    @03,@06                                             0248 00374000
         LA    @03,DCBIOBAD(,@03)                                  0248 00375000
         TM    DCBBFTKR(@03),B'00100000'                           0248 00376000
         BNO   @RF00248                                            0248 00377000
*         GPR01P=ADDR(IOBDQADA);    /* VS IOB HAS 8 BYTE PREFIX      */ 00378000
         SR    @12,@06                                             0249 00379000
         LA    GPR01P,IOBDQADA(,@12)                               0249 00380000
*       ELSE                        /* BEGINNING OF IOB-NO PREF      */ 00381000
*         GPR01P=ADDR(IOBSTDRD);    /* BEG OF IOB STANDARD           */ 00382000
         B     @RC00248                                            0250 00383000
@RF00248 L     GPR01P,WKAIOBRG(,RBSECPTR)                          0250 00384000
*       CALL CVT0VL01;              /* VALIDATE 1ST PART OF IOB      */ 00385000
@RC00248 L     @12,CVTPTR                                          0251 00386000
         L     @15,CVT0VL01(,@12)                                  0251 00387000
         BALR  @14,@15                                             0251 00388000
*       BC(7,ABEND);                /* IF ERROR,GO TO ABEND RTN      */ 00389000
         BC    7,ABEND                                             0252 00390000
*                                   /* VALIDATE 2ND HALF OF IOB      */ 00391000
*       GPR02P=ADDR(IOBSTDRD)+IOBDIOBS-1;/* END ADDR OF IOB          */ 00392000
         L     @12,WKAIOBRG(,RBSECPTR)                             0253 00393000
         LH    GPR02P,IOBDIOBS(,@12)                               0253 00394000
         AR    GPR02P,@12                                          0253 00395000
         BCTR  GPR02P,0                                            0253 00396000
*       CALL CVT0VL01;              /* VALIDIATE 2ND HALF IOB        */ 00397000
         L     @12,CVTPTR                                          0254 00398000
         L     @15,CVT0VL01(,@12)                                  0254 00399000
         BALR  @14,@15                                             0254 00400000
*       BC(7,ABEND);                /* IF ERROR,GO TO ABEND RTN      */ 00401000
         BC    7,ABEND                                             0255 00402000
*     END;                                                         0256 00403000
*   BLKCTR=BLKCTR+1;                /* UP BLKCTR TO SYS ERROR(=6)    */ 00404000
@RF00244 AH    BLKCTR,@CH00083                                     0257 00405000
*FREELOCK:                                                         0258 00406000
*   ;                               /* FREE THE LOCAL LOCK           */ 00407000
FREELOCK DS    0H                                                  0259 00408000
*   RFY                                                            0259 00409000
*     GPR00P RSTD;                                                 0259 00410000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE AROUND SETLK    */ 00411000
         LR    GPR00P,SAVEPTR                                      0260 00412000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    00413000
*                                      RELATED(CNTRLBLK,IGCT005G,(SET   00414000
*                                      LOCK))                        */ 00415000
*     RFY                                                          0262 00416000
*      (GPR11P,                                                    0262 00417000
*       GPR12P,                                                    0262 00418000
*       GPR13P,                                                    0262 00419000
*       GPR14P)RSTD;                                               0262 00420000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0263 00421000
*                                      TABLE.                        */ 00422000
         L     GPR13P,PSALITA                                      0263 00423000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0264 00424000
*                                      ENTRY ADRS.                   */ 00425000
         LM GPR11P,GPR13P,588(GPR13P)                                   00426000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00427000
         BALR GPR14P,GPR13P                                             00428000
*     RFY                                                          0266 00429000
*      (GPR11P,                                                    0266 00430000
*       GPR12P,                                                    0266 00431000
*       GPR13P,                                                    0266 00432000
*       GPR14P)UNRSTD;                                             0266 00433000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    00434000
*                                      RELATED(CNTRLBLK,IGCT005G,(SET   00435000
*                                      LOCK))                        */ 00436000
*   SAVEPTR=GPR00P;                 /* RESTORE RTM SAVEAREA PTR      */ 00437000
         LR    SAVEPTR,GPR00P                                      0268 00438000
*   RFY                                                            0269 00439000
*     GPR00P UNRSTD;                                               0269 00440000
*   GOTO SYSERRTN;                  /* USER CONTROL BLOCKS OK        */ 00441000
*                                                                  0270 00442000
         B     SYSERRTN                                            0270 00443000
*/********************************************************************/ 00444000
*/* THE FOLLOWING ROUTINE ABENDS THE USER WHEN IT IS DETERMINED THAT */ 00445000
*/* A USER CONTROL BLOCK IS INVALID. AN ATTEMPT IS MADE TO CLEAN UP  */ 00446000
*/* THE BUFFER QUEUE, ISSUE WTP IDENTIFYING THE PROBLEM AND GTRACE   */ 00447000
*/* THOSE CONTROL BLOCKS RELATED TO THE ERROR.                       */ 00448000
*/********************************************************************/ 00449000
*                                                                  0271 00450000
*ABEND:                                                            0271 00451000
*   ;                               /* ABEND THE USER WITH 239       */ 00452000
ABEND    DS    0H                                                  0272 00453000
*   GTFLAG=GTOFF;                   /* INITIAL GTRACE TO 0     YM4667*/ 00454000
         MVC   GTFLAG(1,SDWAPTR),GTOFF                             0272 00455000
*   IF BLKCTR=DCBERR THEN           /* DCB BAD, NO GTRACE            */ 00456000
         CH    BLKCTR,@CH00083                                     0273 00457000
         BE    @RT00273                                            0273 00458000
*     GOTO CLEAN;                   /* NO GTRACE POSSIBLE            */ 00459000
*                                                                  0274 00460000
*/* GET CORE TO BUILD THE GTRACE BUFFER AREA WHICH WILL CONTAIN THOSE*/ 00461000
*/* CONTROL BLOCKS WHICH WERE VALIDATED. REGS 0,1,3,4,7 ARE USED FOR */ 00462000
*/* INPUT TO GETMAIN-BRANCH ENTRY. REG 4 CONTAINS TCB ADDR AND REG 7,*/ 00463000
*/* THE ASCB ADDRESS.                                                */ 00464000
*                                                                  0275 00465000
*GETCORE:                                                          0275 00466000
*   RFY                                                            0275 00467000
*    (TRCPTR,                                                      0275 00468000
*     GPR01P)RSTD;                  /* RESTRICT REGS                 */ 00469000
GETCORE  DS    0H                                                  0276 00470000
*   RFY                                                            0276 00471000
*    (GPR04P,                                                      0276 00472000
*     GPR07P,                                                      0276 00473000
*     WRKREG)RSTD;                  /* RESTR INPUT/SAVE        YM4667*/ 00474000
*   GPR04P=PSATOLD;                 /* PUT TCB ADDR IN R4      YM4667*/ 00475000
         L     GPR04P,PSATOLD                                      0277 00476000
*   WRKREG=BLKCTR;                  /* SAVE BLKCTR CODE        YM4667*/ 00477000
         LR    WRKREG,BLKCTR                                       0278 00478000
*   GPR07P=PSAAOLD;                 /* PUT ASCB ADDR IN R7     YM4667*/ 00479000
         L     GPR07P,PSAAOLD                                      0279 00480000
*   DO;                             /* GETMAIN (RC)                0280 00481000
*                                      LV(LENGTH(SPDBFR)) SP(230)  0280 00482000
*                                      KEY(0) BRANCH                 */ 00483000
*     RESPECIFY                                                    0281 00484000
*      (GPR01F,                                                    0281 00485000
*       GPR03F,                                                    0281 00486000
*       GPR00F)RESTRICTED;                                         0281 00487000
*     GPR01F=0;                     /* REG 1 MUST BE ZERO            */ 00488000
         SR    @14,@14                                             0282 00489000
         LR    GPR01F,@14                                          0282 00490000
*     GPR03F=0;                     /* RC-TYPE GETMAIN               */ 00491000
         LR    GPR03F,@14                                          0283 00492000
*     GPR00F=LENGTH(SPDBFR);        /* LENGTH REQUESTED              */ 00493000
         LA    GPR00F,256                                          0284 00494000
*     GPR03F=GPR03F|((230)*256);    /* SP IN BYTE 2                  */ 00495000
         O     GPR03F,@CF03562                                     0285 00496000
*     GPR03F=GPR03F|((0)*65536*16); /* KEY IN BYTE 1                 */ 00497000
*     CALL CVTCRMN;                 /* BRANCH ENTRY POINT            */ 00498000
         L     @12,CVTPTR                                          0287 00499000
         L     @15,CVTCRMN(,@12)                                   0287 00500000
         BALR  @14,@15                                             0287 00501000
*     RESPECIFY                                                    0288 00502000
*      (GPR01F,                                                    0288 00503000
*       GPR03F,                                                    0288 00504000
*       GPR00F)UNRESTRICTED;                                       0288 00505000
*   END;                            /* GETMAIN (RC)                0289 00506000
*                                      LV(LENGTH(SPDBFR)) SP(230)  0289 00507000
*                                      KEY(0) BRANCH                 */ 00508000
*                                                                  0289 00509000
*/* GET                                         CORE IN 230, KEY 0 FOR  00510000
*UFFER                                                               */ 00511000
*                                                                  0290 00512000
*   RFY                                                            0290 00513000
*     GPR15P RSTD;                  /* RESTRICT RETURN REG           */ 00514000
*   BLKCTR=WRKREG;                  /* RESTORE BLKCTR CODE     YM4667*/ 00515000
         LR    BLKCTR,WRKREG                                       0291 00516000
*   IF GPR15P¬=0 THEN               /* IF RET FROM GETMAIN NOT 0     */ 00517000
         LTR   GPR15P,GPR15P                                       0292 00518000
         BNZ   @RT00292                                            0292 00519000
*     GO TO CLEAN;                  /* NO CORE, CANT GTRACE          */ 00520000
*   RFY                                                            0294 00521000
*    (GPR04P,                                                      0294 00522000
*     GPR07P,                                                      0294 00523000
*     WRKREG,                                                      0294 00524000
*     GPR15P)UNRSTD;                /* RELEASE                 YM4667*/ 00525000
*   TRCPTR=GPR01P;                  /* BASE REG FOR TRACE BUFFER     */ 00526000
         LR    TRCPTR,GPR01P                                       0295 00527000
*   RFY                                                            0296 00528000
*     SPDBFR BASED(TRCPTR);         /* ADDRESSABILITY TO BUFFER      */ 00529000
*   RFY                                                            0297 00530000
*     GPR01P UNRSTD;                                               0297 00531000
*                                                                  0297 00532000
*/* MUST VALIDATE TIOT ENTRY BEFORE GETTING DDNAME FOR GTRACE.       */ 00533000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 00534000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 00535000
*/* CHECKED FIRST.                                                   */ 00536000
*                                                                  0298 00537000
*   WKALOCK='1'B;                   /* SW-DEBCHECK WONT FREE LOCK    */ 00538000
         OI    WKALOCK(RBSECPTR),B'00000001'                       0298 00539000
*   CALL DEBCHECK;                  /* MUST 1ST VALIDATE DEB BY    0299 00540000
*                                      CALLING DEBCHK SUBRTN         */ 00541000
         BAL   @14,DEBCHECK                                        0299 00542000
*   RFY                                                            0300 00543000
*     DEBBASIC BASED(WKADEB);       /* DEB BASE PASSED IN SVRB       */ 00544000
*   IF WKADEBRC=0 THEN              /* IF DEB RET CODE=0,DEB OK      */ 00545000
         CLI   WKADEBRC(RBSECPTR),0                                0301 00546000
         BNE   @RF00301                                            0301 00547000
*     SPDDDNAM=TIOEDDNM;            /* MV DDNAME INTO GTF BUFFER     */ 00548000
         SR    @12,@12                                             0302 00549000
         ICM   @12,7,WKADEB(RBSECPTR)                              0302 00550000
         L     @12,DEBAPPAD(,@12)                                  0302 00551000
         L     @12,DEBXTNP(,@12)                                   0302 00552000
         L     @12,DEBXDSAB(,@12)                                  0302 00553000
         L     @12,DSABTIOT(,@12)                                  0302 00554000
         MVC   SPDDDNAM(8,TRCPTR),TIOEDDNM(@12)                    0302 00555000
*   ELSE                            /* ELSE ASSIGN DDN ASTERISKS     */ 00556000
*     SPDDDNAM=NODDNAME;            /* MOVE ASTERISKS INTO BUFFER    */ 00557000
         B     @RC00301                                            0303 00558000
@RF00301 MVC   SPDDDNAM(8,TRCPTR),NODDNAME                         0303 00559000
*MVCCD:                                                            0304 00560000
*   ;                               /* ESTABLISH COND CODE           */ 00561000
@RC00301 DS    0H                                                  0304 00562000
MVCCD    DS    0H                                                  0305 00563000
*   SPDABCCD=BLKERR1(BLKCTR);       /* INDEX TO BLKID IN ERROR       */ 00564000
         SR    @12,@12                                             0305 00565000
         IC    @12,BLKERR1-1(BLKCTR)                               0305 00566000
         STC   @12,SPDABCCD(,TRCPTR)                               0305 00567000
*   RFY                                                            0306 00568000
*     MVBLKPTR RSTD;                /* RESTRICT PTR TO BLK MOVE      */ 00569000
*   MVBLKPTR=ADDR(SPDTRACE);        /* ESTABLISH PTR TO TRACE BLK    */ 00570000
         LA    MVBLKPTR,SPDTRACE(,TRCPTR)                          0307 00571000
*   RFY                                                            0308 00572000
*     SPDTRRCD BASED(MVBLKPTR);     /* ESTABLISH ADDRESSABILITY      */ 00573000
*MVDCB:                                                            0309 00574000
*   ;                               /* MV DCB INTO GTRACE BUFFER     */ 00575000
MVDCB    DS    0H                                                  0310 00576000
*   SPDRCDLN=DCBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);/* MV LENGTH OF   00577000
*                                      DCB INTO REC                  */ 00578000
         MVI   SPDRCDLN(MVBLKPTR),X'6E'                            0310 00579000
*   SPDBLKID=SPDDCB;                /* MV DCB ID=130 INTO REC        */ 00580000
         MVI   SPDBLKID(MVBLKPTR),X'82'                            0311 00581000
*   SPDBLKAD=DCBPTR;                /* MV DCB ADDR INTO RECORD       */ 00582000
         L     @12,DCBPTR(,RBSECPTR)                               0312 00583000
         ST    @12,SPDBLKAD(,MVBLKPTR)                             0312 00584000
*   SPDDATA2(1:DCBLEN)=IHADCB(1:DCBLEN);/* MV DCB INTO RECORD        */ 00585000
         MVC   SPDDATA2(104,MVBLKPTR),IHADCB(@12)                  0313 00586000
*   WKATRCLG=DCBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD)+PREFIXLG;/*  0314 00587000
*                                      SIZE OF REC SO FAR            */ 00588000
         MVI   WKATRCLG(RBSECPTR),X'77'                            0314 00589000
*MVDECB:                                                           0315 00590000
*   ;                               /* SHOULD DECB BE TRACED         */ 00591000
MVDECB   DS    0H                                                  0316 00592000
*   IF BLKCTR>DECBERR THEN          /* WAS THE DECB FOUND INVALID    */ 00593000
         CH    BLKCTR,@CH00091                                     0316 00594000
         BNH   @RF00316                                            0316 00595000
*     DO;                           /* DECB PASSED VALIDITY CHECK    */ 00596000
*       MVBLKPTR=TRCPTR+WKATRCLG;   /* SET UP PTR TO NEXT BLK        */ 00597000
         SR    @12,@12                                             0318 00598000
         IC    @12,WKATRCLG(,RBSECPTR)                             0318 00599000
         LR    MVBLKPTR,TRCPTR                                     0318 00600000
         AR    MVBLKPTR,@12                                        0318 00601000
*       SPDRCDLN=DECBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);/* DECB 0319 00602000
*                                      LENGTH + PREFIX               */ 00603000
         MVI   SPDRCDLN(MVBLKPTR),X'22'                            0319 00604000
*       SPDBLKID=SPDDECB;           /* MV DECB ID=131 INTO REC       */ 00605000
         MVI   SPDBLKID(MVBLKPTR),X'83'                            0320 00606000
*       SPDBLKAD=DECBPT;            /* GET DECB ADDR INTO REC        */ 00607000
         L     @06,DECBPT(,RBSECPTR)                               0321 00608000
         ST    @06,SPDBLKAD(,MVBLKPTR)                             0321 00609000
*       SPDDATA2(1:DECBLEN)=DECBS02(1:DECBLEN);/* MV IN DECB         */ 00610000
         MVC   SPDDATA2(28,MVBLKPTR),DECBS02(@06)                  0322 00611000
*       WKATRCLG=WKATRCLG+DECBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);    00612000
         AH    @12,@CH03567                                        0323 00613000
         STC   @12,WKATRCLG(,RBSECPTR)                             0323 00614000
*                                   /* SIZE REC SO FAR               */ 00615000
*     END;                                                         0324 00616000
*MVBCB:                                                            0325 00617000
*   ;                               /* GTRACE BCB IF PASSED CHK      */ 00618000
@RF00316 DS    0H                                                  0325 00619000
MVBCB    DS    0H                                                  0326 00620000
*   IF BLKCTR>BCBERR THEN           /* IF BCB DID NOT HAVE ERROR     */ 00621000
         CH    BLKCTR,@CH00107                                     0326 00622000
         BNH   @RF00326                                            0326 00623000
*     DO;                           /* GTRACE IT FOR NEXT BLK        */ 00624000
*       MVBLKPTR=TRCPTR+WKATRCLG;   /* NEXT BLK TO ADD TO BUFFER     */ 00625000
         SR    @12,@12                                             0328 00626000
         IC    @12,WKATRCLG(,RBSECPTR)                             0328 00627000
         LR    MVBLKPTR,TRCPTR                                     0328 00628000
         AR    MVBLKPTR,@12                                        0328 00629000
*       SPDRCDLN=BCBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);/* BCB   0329 00630000
*                                      LENGTH + PREFIX               */ 00631000
         MVI   SPDRCDLN(MVBLKPTR),X'16'                            0329 00632000
*       SPDBLKAD=DCBBUFCB;          /* BCB ADDRESS FROM DCB          */ 00633000
         L     @06,DCBPTR(,RBSECPTR)                               0330 00634000
         L     @06,DCBBUFCB+16(,@06)                               0330 00635000
         ST    @06,SPDBLKAD(,MVBLKPTR)                             0330 00636000
*       RFY                                                        0331 00637000
*         BCBDEFR BASED(DCBBUFCB);  /* ESTABLISH BASE FOR BCB        */ 00638000
*       SPDDATA2(1:BCBLEN)=BCBDEFR(1:BCBLEN);/* MV 16-BYTE BCB       */ 00639000
         MVC   SPDDATA2(16,MVBLKPTR),BCBDEFR(@06)                  0332 00640000
*       WKATRCLG=WKATRCLG+BCBLEN+LENGTH(SPDRCDHD)+LENGTH(SPDBLKAD);/*   00641000
*                                      SZ OF REC WHEN ALL            */ 00642000
         AH    @12,@CH03569                                        0333 00643000
         STC   @12,WKATRCLG(,RBSECPTR)                             0333 00644000
*     END;                                                         0334 00645000
*TRACE:                                                            0335 00646000
*   ;                               /* FREE THE LOCAL LCK,& TRACE    */ 00647000
@RF00326 DS    0H                                                  0335 00648000
TRACE    DS    0H                                                  0336 00649000
*   RFY                                                            0336 00650000
*     GPR00P RSTD;                                                 0336 00651000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE AROUND SETLK    */ 00652000
         LR    GPR00P,SAVEPTR                                      0337 00653000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    00654000
*                                      RELATED(CNTRLBLK,IGCT005G,(SET   00655000
*                                      LOCK))                        */ 00656000
*     RFY                                                          0339 00657000
*      (GPR11P,                                                    0339 00658000
*       GPR12P,                                                    0339 00659000
*       GPR13P,                                                    0339 00660000
*       GPR14P)RSTD;                                               0339 00661000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0340 00662000
*                                      TABLE.                        */ 00663000
         L     GPR13P,PSALITA                                      0340 00664000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0341 00665000
*                                      ENTRY ADRS.                   */ 00666000
         LM GPR11P,GPR13P,588(GPR13P)                                   00667000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00668000
         BALR GPR14P,GPR13P                                             00669000
*     RFY                                                          0343 00670000
*      (GPR11P,                                                    0343 00671000
*       GPR12P,                                                    0343 00672000
*       GPR13P,                                                    0343 00673000
*       GPR14P)UNRSTD;                                             0343 00674000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    00675000
*                                      RELATED(CNTRLBLK,IGCT005G,(SET   00676000
*                                      LOCK))                        */ 00677000
*   SAVEPTR=GPR00P;                 /* RESTORE RTM SAVEAREA PTR      */ 00678000
         LR    SAVEPTR,GPR00P                                      0345 00679000
*   RFY                                                            0346 00680000
*     GPR00P UNRSTD;                                               0346 00681000
*   RFY                                                            0347 00682000
*    (GPR01P,                                                      0347 00683000
*     WRKREG,                                                      0347 00684000
*     GPR15P)RSTD;                                                 0347 00685000
*   WRKREG=WKATRCLG;                /* GET TRACE REC LG FROM SVRB    */ 00686000
         SR    WRKREG,WRKREG                                       0348 00687000
         IC    WRKREG,WKATRCLG(,RBSECPTR)                          0348 00688000
*   GPR01P=ADDR(TRCLIST);           /* GET ADDRESS OF TRACE LIST     */ 00689000
         LA    GPR01P,TRCLIST(,RBSECPTR)                           0349 00690000
*   TRCLIST=TRACLIST;               /* SET UP GTC PARMLIST     YM5757*/ 00691000
         MVC   TRCLIST(8,RBSECPTR),TRACLIST                        0350 00692000
*   GEN REFS(SPDBFR)SETS(GPR01P,WRKREG,GPR15P,TRCPTR);             0351 00693000
       GTRACE DATA=(TRCPTR),MF=(E,(1)),LNG=(WRKREG),ID=IGGSP239         00694000
*   IF GPR15P=0 THEN                /* IF RET CODE=0,GTRACE GOOD     */ 00695000
         LTR   GPR15P,GPR15P                                       0352 00696000
         BNZ   @RF00352                                            0352 00697000
*     GTFLAG=GTON;                  /* TURN ON LO BIT IF GTF GOOD    */ 00698000
         MVC   GTFLAG(1,SDWAPTR),GTON                              0353 00699000
*   RFY                                                            0354 00700000
*    (GPR01P,                                                      0354 00701000
*     WRKREG,                                                      0354 00702000
*     GPR15P,                                                      0354 00703000
*     MVBLKPTR)UNRSTD;                                             0354 00704000
@RF00352 DS    0H                                                  0355 00705000
*FREECORE:                                                         0355 00706000
*   ;                               /* FREE THE GTRACE BUFFER        */ 00707000
FREECORE DS    0H                                                  0356 00708000
*   DO;                             /* FREEMAIN(RC)                0356 00709000
*                                      LV(LENGTH(SPDBFR))A(SPDBFR) 0356 00710000
*                                      SP(230)                       */ 00711000
*     RESPECIFY                                                    0357 00712000
*      (GPR01F,                                                    0357 00713000
*       GPR15F,                                                    0357 00714000
*       GPR00F)RESTRICTED;                                         0357 00715000
*     GPR01F=0;                     /* REG 1 MUST BE ZERO            */ 00716000
         SR    GPR01F,GPR01F                                       0358 00717000
*     GPR15F=1;                     /* SET TYPE                      */ 00718000
         LA    GPR15F,1                                            0359 00719000
*     GPR00F=LENGTH(SPDBFR);        /* LENGTH REQUESTED              */ 00720000
         LA    GPR00F,256                                          0360 00721000
*     GPR01F=ADDR(SPDBFR);          /* SET REGISTER ONE              */ 00722000
         LR    GPR01F,TRCPTR                                       0361 00723000
*     GPR15F=GPR15F+((230)*256);    /* SUBPOOL VALUE                 */ 00724000
         A     GPR15F,@CF03562                                     0362 00725000
*     SVC(120);                     /* RC/RU-FORM OF GETMAIN         */ 00726000
         SVC   120                                                 0363 00727000
*     RESPECIFY                                                    0364 00728000
*      (GPR01F,                                                    0364 00729000
*       GPR15F,                                                    0364 00730000
*       GPR00F)UNRESTRICTED;                                       0364 00731000
*   END;                            /* FREEMAIN(RC)                0365 00732000
*                                      LV(LENGTH(SPDBFR))A(SPDBFR) 0365 00733000
*                                      SP(230)                       */ 00734000
*                                   /* FREE                          */ 00735000
*   RFY                                                            0366 00736000
*     TRCPTR UNRSTD;                                               0366 00737000
*   RFY                                                            0367 00738000
*     SPDBFR BASED;                                                0367 00739000
*                                                                  0367 00740000
*/*  FREE THE LOCAL LOCK, IN CASE IT HAS NOT ALREADY BEEN FREED,     */ 00741000
*/*  AND CLEAN UP RESOURCES BEFORE WRITING OUT MESSAGE.              */ 00742000
*                                                                  0368 00743000
*CLEAN:                                                            0368 00744000
*   ;                               /* GO CLEAN UP RESOURCES         */ 00745000
CLEAN    DS    0H                                                  0369 00746000
*   RFY                                                            0369 00747000
*     GPR00P RSTD;                                                 0369 00748000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE AROUND SETLK    */ 00749000
         LR    GPR00P,SAVEPTR                                      0370 00750000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    00751000
*                                      RELATED(CNTRLBLK,IGCT005G,(SET   00752000
*                                      LOCK))                        */ 00753000
*     RFY                                                          0372 00754000
*      (GPR11P,                                                    0372 00755000
*       GPR12P,                                                    0372 00756000
*       GPR13P,                                                    0372 00757000
*       GPR14P)RSTD;                                               0372 00758000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0373 00759000
*                                      TABLE.                        */ 00760000
         L     GPR13P,PSALITA                                      0373 00761000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0374 00762000
*                                      ENTRY ADRS.                   */ 00763000
         LM GPR11P,GPR13P,588(GPR13P)                                   00764000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00765000
         BALR GPR14P,GPR13P                                             00766000
*     RFY                                                          0376 00767000
*      (GPR11P,                                                    0376 00768000
*       GPR12P,                                                    0376 00769000
*       GPR13P,                                                    0376 00770000
*       GPR14P)UNRSTD;                                             0376 00771000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    00772000
*                                      RELATED(CNTRLBLK,IGCT005G,(SET   00773000
*                                      LOCK))                        */ 00774000
*   SAVEPTR=GPR00P;                 /* RESTORE RTM SAVEAREA PTR      */ 00775000
         LR    SAVEPTR,GPR00P                                      0378 00776000
*   RFY                                                            0379 00777000
*     GPR00P UNRSTD;                                               0379 00778000
*   CALL CLEANUP;                   /* GO CLEAN UP RESOURCES         */ 00779000
         BAL   @14,CLEANUP                                         0380 00780000
*   RFY                                                            0381 00781000
*     GPR15P RSTD;                                                 0381 00782000
*   IF GPR15P¬=0 THEN               /* IF CLEANRTN RC NOT 0,WAS      */ 00783000
         LTR   GPR15P,GPR15P                                       0382 00784000
         BZ    @RF00382                                            0382 00785000
*     DO;                           /* ERROR IN CLEAN UP             */ 00786000
*       WKACLEAN=CLEANRC1(1);       /* SET RC FOR CLEANUP ABEND      */ 00787000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1                       0384 00788000
*       GEN(ESTAE 0);               /* GET RID OF ESTAE              */ 00789000
         ESTAE 0                                                        00790000
*     END;                                                         0386 00791000
*   RFY                                                            0387 00792000
*     GPR15P UNRSTD;                                               0387 00793000
*                                                                  0387 00794000
@RF00382 DS    0H                                                  0388 00795000
*/*    WRITE OUT MESSAGE TO PROGRAMMER DESCRIBING PROBLEM            */ 00796000
*                                                                  0388 00797000
*WTP:                                                              0388 00798000
*   ;                               /* ISSUE WTP IDENTIFYING ERR     */ 00799000
WTP      DS    0H                                                  0389 00800000
*   RFY                                                            0389 00801000
*     WRKREG RSTD;                  /* RESTRICT WORKREG              */ 00802000
*   WRKREG=GTFLAG;                  /* SAVE CONTENTS OF GTRACE SW    */ 00803000
         SR    WRKREG,WRKREG                                       0390 00804000
         IC    WRKREG,GTFLAG(,SDWAPTR)                             0390 00805000
*   MESSAGE=USERER;                 /* MOVE IN MESSAGE               */ 00806000
         MVC   MESSAGE(52,SDWAPTR),USERER                          0391 00807000
*   GTFLAG=WRKREG;                  /* REPLACE GTRACE SW             */ 00808000
         STC   WRKREG,GTFLAG(,SDWAPTR)                             0392 00809000
*   RCODE=BLKERR2(BLKCTR);          /* MV BLK IN ERROR INTO MESS     */ 00810000
         LA    @12,BLKERR2-1(BLKCTR)                               0393 00811000
         MVC   RCODE(1,SDWAPTR),0(@12)                             0393 00812000
*   WRKREG=WKACLEAN;                /* LOAD CLEAN RC FOR INDEX       */ 00813000
         SR    WRKREG,WRKREG                                       0394 00814000
         IC    WRKREG,WKACLEAN(,RBSECPTR)                          0394 00815000
*   RETCOD2=CLEANRC2(WRKREG);       /* MV CLEANUP RC INTO MESSAGE    */ 00816000
         LR    @12,WRKREG                                          0395 00817000
         AR    @12,@12                                             0395 00818000
         LA    @10,CLEANRC2-2(@12)                                 0395 00819000
         MVC   RETCOD2(2,SDWAPTR),0(@10)                           0395 00820000
*   RFY                                                            0396 00821000
*     WRKREG UNRSTD;                                               0396 00822000
*   MSGJOB=TIOCNJOB;                /* MV IN JOB NAME                */ 00823000
         L     @12,PSATOLD                                         0397 00824000
         L     @12,TCBTIO(,@12)                                    0397 00825000
         MVC   MSGJOB(8,SDWAPTR),TIOCNJOB(@12)                     0397 00826000
*   MSGSTEP=TIOCSTEP;               /* MV IN STEP NAME               */ 00827000
*                                                                  0398 00828000
         MVC   MSGSTEP(8,SDWAPTR),TIOCSTEP(@12)                    0398 00829000
*/* MUST VALIDATE TIOT ENTRY BEFORE GETTING DDNAME FOR MESSAGE.      */ 00830000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 00831000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 00832000
*/* CHECKED FIRST.                                                   */ 00833000
*                                                                  0399 00834000
*   CALL DEBCHECK;                  /* MUST 1ST VALIDATE DEB BY    0399 00835000
*                                      CALLING DEBCHK SUBRTN         */ 00836000
         BAL   @14,DEBCHECK                                        0399 00837000
*   RFY                                                            0400 00838000
*     DEBBASIC BASED(WKADEB);       /* VALID DEB PASSED IN SVRB      */ 00839000
*   IF WKADEBRC=0 THEN              /* IF DEB RET CODE=0,DEB OK      */ 00840000
         CLI   WKADEBRC(RBSECPTR),0                                0401 00841000
         BNE   @RF00401                                            0401 00842000
*     MSGDDN=TIOEDDNM;              /* MV DDNAME INTO GTF BUFFER     */ 00843000
         SR    @12,@12                                             0402 00844000
         ICM   @12,7,WKADEB(RBSECPTR)                              0402 00845000
         L     @12,DEBAPPAD(,@12)                                  0402 00846000
         L     @12,DEBXTNP(,@12)                                   0402 00847000
         L     @12,DEBXDSAB(,@12)                                  0402 00848000
         L     @12,DSABTIOT(,@12)                                  0402 00849000
         MVC   MSGDDN(8,SDWAPTR),TIOEDDNM(@12)                     0402 00850000
*   ELSE                            /* ELSE ASSIGN DDN ASTERISKS     */ 00851000
*     MSGDDN=NODDNAME;              /* MOVE ASTERISKS INTO BUFFER    */ 00852000
         B     @RC00401                                            0403 00853000
@RF00401 MVC   MSGDDN(8,SDWAPTR),NODDNAME                          0403 00854000
*   DO;                             /* WTOP MF(E,MESSAGE)            */ 00855000
@RC00401 DS    0H                                                  0405 00856000
*     RFY                                                          0405 00857000
*       GPR01P RSTD;                /* RESTRICT REG 1                */ 00858000
*     GPR01P=ADDR(MESSAGE);         /* ADDRESS CONTROL PROGRAM LIST  */ 00859000
         LA    GPR01P,MESSAGE(,SDWAPTR)                            0406 00860000
*     SVC(35);                      /* ISSUE WTO SVC                 */ 00861000
         SVC   35                                                  0407 00862000
*     RFY                                                          0408 00863000
*       GPR01P UNRSTD;              /* RELEASE REG 1                 */ 00864000
*   END;                            /* WTOP MF(E,MESSAGE)            */ 00865000
*                                   /* ISSUE WTP                     */ 00866000
*RETRYNOW:                                                         0410 00867000
*   ;                               /* RETRY ABEND239-USER ERROR     */ 00868000
RETRYNOW DS    0H                                                  0411 00869000
*   IF GTFLAG=GTOFF THEN            /* PASS GTRACE RC TO       YM4667*/ 00870000
         CLC   GTFLAG(1,SDWAPTR),GTOFF                             0411 00871000
         BNE   @RF00411                                            0411 00872000
*     SDWASR00=0;                   /* RETRY, 0= NO OR BAD GTRACE    */ 00873000
         SR    @12,@12                                             0412 00874000
         ST    @12,SDWASR00(,SDWAPTR)                              0412 00875000
*   ELSE                            /* IF GTRACE DID GO -NON 0       */ 00876000
*     SDWASR00=GTRACEOK;            /* PASS GTRACE RC TO RETRY       */ 00877000
         B     @RC00411                                            0413 00878000
@RF00411 MVC   SDWASR00(4,SDWAPTR),@CF00096                        0413 00879000
*   SDWASR07=BLKCTR;                /* PASS BLKID IN ERROR-RETRY     */ 00880000
@RC00411 ST    BLKCTR,SDWASR07(,SDWAPTR)                           0414 00881000
*   SDWASR08=RBSECPTR;              /* GIVE RETRYRTN SVRB ADDR       */ 00882000
         ST    RBSECPTR,SDWASR08(,SDWAPTR)                         0415 00883000
*   SDWASR09=BASEREG;               /* GIVE RETRY RTN BASE REG       */ 00884000
         ST    BASEREG,SDWASR09(,SDWAPTR)                          0416 00885000
*   DO;                             /* SETRP RETADDR(RETRYRTN)     0417 00886000
*                                      DUMP(NO) RECORD(NO)         0417 00887000
*                                      FRESDWA(YES) RC(4)          0417 00888000
*                                      RETREGS(YES) WKAREA(SDWAPTR)     00889000
*                                      REGS(14)                      */ 00890000
*     RESPECIFY                                                    0418 00891000
*      (GPR00P,                                                    0418 00892000
*       GPR01P,                                                    0418 00893000
*       GPR14P,                                                    0418 00894000
*       GPR15P)RSTD;                                               0418 00895000
*     GPR01P=SDWAPTR;                                              0419 00896000
         LR    GPR01P,SDWAPTR                                      0419 00897000
*     GPR01P->SDWARCDE=4;           /* STORE RC INTO SDWA            */ 00898000
         MVI   SDWARCDE(GPR01P),X'04'                              0420 00899000
*     GPR01P->SDWARTYA=ADDR(RETRYRTN);/* SAVE RETRY ADDRESS          */ 00900000
         LA    @12,RETRYRTN                                        0421 00901000
         ST    @12,SDWARTYA(,GPR01P)                               0421 00902000
*     GPR01P->SDWAFREE='1'B;        /* SET FLAG TO FREE SDWA         */ 00903000
*     GPR01P->SDWARCRD='0'B;        /* TURN OFF RECORD INDICATOR     */ 00904000
         OI    SDWAFREE(GPR01P),B'00000100'                        0423 00905000
         NI    SDWARCRD(GPR01P),B'01111111'                        0423 00906000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 00907000
         NI    SDWAREQ(GPR01P),B'01111111'                         0424 00908000
*     GPR01P->SDWAUPRG='1'B;        /* TURN ON RETREGS INDICATOR     */ 00909000
         OI    SDWAUPRG(GPR01P),B'00001000'                        0425 00910000
*     GEN(RETURN (14));                                            0426 00911000
         RETURN (14)                                                    00912000
*     RESPECIFY                                                    0427 00913000
*      (GPR00P,                                                    0427 00914000
*       GPR01P,                                                    0427 00915000
*       GPR14P,                                                    0427 00916000
*       GPR15P)UNRSTD;                                             0427 00917000
*   END;                            /* RETRY                         */ 00918000
*                                                                  0428 00919000
*/********************************************************************/ 00920000
*/* THE FOLLOWING ROUTINE IS THE RETRY ROUTINE, ENTERED WHEN A USER  */ 00921000
*/* ERROR IS DETECTED AND SETRP HAS BEEN ISSUED TO GIVE THIS ROUTINE */ 00922000
*/* CONTROL TO ISSUE ABEND 239. THIS PREVENTS REPEATED ENTRY INTO    */ 00923000
*/* THE ESTAE, IGCT005G, BY REMOVING IT LOGICALLY FROM THE QUEUE.    */ 00924000
*/* UPON ENTRY THE SVRB ADDRESS WILL BE IN REG 8, BLKCTR IN REG 7,   */ 00925000
*/* AND THE GTRACE RETURN CODE IN REG 0.                             */ 00926000
*/********************************************************************/ 00927000
*                                                                  0429 00928000
*RETRYRTN:                                                         0429 00929000
*   ;                               /* RETRY ROUTINE WILL ABEND      */ 00930000
RETRYRTN DS    0H                                                  0430 00931000
*   RFY                                                            0430 00932000
*    (GPR00P,                                                      0430 00933000
*     GPR01P,                                                      0430 00934000
*     WRKREG,                                                      0430 00935000
*     GPR14P,                                                      0430 00936000
*     GPR15P)RSTD;                  /* RESTR                   YM4667*/ 00937000
*   WRKREG=GPR00P;                  /* SAVE GTF RC IN R11      YM4667*/ 00938000
         LR    WRKREG,GPR00P                                       0431 00939000
*   GEN(ESTAE 0);                   /* REMOVE ESTAE FROM QUEUE       */ 00940000
         ESTAE 0                                                        00941000
*   RETURNCD=WKACLEAN;              /* PUT CLEANUP RC IN LO ORDER    */ 00942000
         SR    RETURNCD,RETURNCD                                   0433 00943000
         IC    RETURNCD,WKACLEAN(,RBSECPTR)                        0433 00944000
*   RETURNCD=RETURNCD*TOPBYTE;      /* MV RC TO HI-ORDER BYTE        */ 00945000
         SLL   RETURNCD,24                                         0434 00946000
*   IF WRKREG¬=0 THEN               /* IF SW SET IN R0¬=0      YM4667*/ 00947000
         LTR   WRKREG,WRKREG                                       0435 00948000
         BZ    @RF00435                                            0435 00949000
*     RETURNCD=RETURNCD|BLKERR3(BLKCTR);/* PUT RET CODE WITH       0436 00950000
*                                      GTRACE-TAKEN BIT ON INTO R15  */ 00951000
         SR    @12,@12                                             0436 00952000
         IC    @12,BLKERR3-1(BLKCTR)                               0436 00953000
         OR    RETURNCD,@12                                        0436 00954000
*   ELSE                            /* IF SW SET IN R0 IS 0 THEN     */ 00955000
*     RETURNCD=RETURNCD|BLKERR1(BLKCTR);/* EITHER GTRACE WAS NOT   0437 00956000
*                                      TAKEN OR NOT SUCCESSFUL, SO 0437 00957000
*                                      GTRACE-TAKEN BIT OFF IN R15   */ 00958000
         B     @RC00435                                            0437 00959000
@RF00435 SR    @12,@12                                             0437 00960000
         IC    @12,BLKERR1-1(BLKCTR)                               0437 00961000
         OR    RETURNCD,@12                                        0437 00962000
*   GPR01P=ERRUSER;                 /* PASS ABEND 239 ABEND CODE     */ 00963000
@RC00435 LA    GPR01P,569                                          0438 00964000
*   GPR14P=ADDR(SNAPLIST);          /* PASS ABEND ADDR OF     SNAPLST*/ 00965000
         LA    GPR14P,SNAPLIST                                     0439 00966000
*   GEN REFS(RBGRS2,GPR14P);                                       0440 00967000
        LM   @02,@13,RBGRS2(@08)       LOAD USERS REGISTERS             00968000
        ABEND  (1),DUMP,,SYSTEM,DUMPOPT=(GPR14P)     ABEND USER         00969000
*   RFY                                                            0441 00970000
*    (GPR00P,                                                      0441 00971000
*     GPR01P,                                                      0441 00972000
*     WRKREG,                                                      0441 00973000
*     GPR14P,                                                      0441 00974000
*     GPR15P)UNRSTD;                /*                         YM4667*/ 00975000
*                                                                  0441 00976000
*/********************************************************************/ 00977000
*/*   THIS ROUTINE IS ENTERED IF NO USER ERROR WAS FOUND. A SYSTEM   */ 00978000
*/*   ERROR IS ASSUMED. UPON ENTRY BLKCTR WILL HAVE THE VALUE 6.     */ 00979000
*/*   UPON ENTRY THE LOCAL LOCK WILL NOT BE HELD.                    */ 00980000
*/********************************************************************/ 00981000
*                                                                  0442 00982000
*SYSERRTN:                                                         0442 00983000
*   ;                               /* SYSTEM ERROR                  */ 00984000
SYSERRTN DS    0H                                                  0443 00985000
*   CALL SDUMP;                     /* GO TO TAKE SVC DUMP           */ 00986000
         BAL   @14,SDUMP                                           0443 00987000
*   CALL CLEANUP;                   /* GO TRY TO CLEAN UP            */ 00988000
         BAL   @14,CLEANUP                                         0444 00989000
*   RFY                                                            0445 00990000
*     GPR15P RSTD;                  /* RESTRICT FOR CLEANUP RC       */ 00991000
*   IF GPR15P¬=0 THEN               /* IF CLEANRTN RC NOT 0,WAS      */ 00992000
         LTR   GPR15P,GPR15P                                       0446 00993000
         BZ    @RF00446                                            0446 00994000
*     DO;                           /* ERROR IN CLEAN UP             */ 00995000
*       WKACLEAN=CLEANRC1(1);       /* SET RC FOR CLEANUP ABEND      */ 00996000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1                       0448 00997000
*       GEN(ESTAE 0);               /* GET RID OF ESTAE              */ 00998000
         ESTAE 0                                                        00999000
*     END;                                                         0450 01000000
*   RFY                                                            0451 01001000
*     GPR15P UNRSTD;                                               0451 01002000
*                                                                  0451 01003000
@RF00446 DS    0H                                                  0452 01004000
*/*  MUST BUILD MESSAGE AND ISSUE WTP DESCRIBING ERROR AS SYSTEM     */ 01005000
*                                                                  0452 01006000
*   MESSAGE=SYSER;                  /* SET UP WTP MESSAGE            */ 01007000
         MVC   MESSAGE(52,SDWAPTR),SYSER                           0452 01008000
*   RFY                                                            0453 01009000
*     WRKREG RSTD;                  /* RESTRICT WORK REGISTER        */ 01010000
*   WRKREG=WKACLEAN;                /* USE CLEANUP CODE TO INDEX     */ 01011000
         SR    WRKREG,WRKREG                                       0454 01012000
         IC    WRKREG,WKACLEAN(,RBSECPTR)                          0454 01013000
*   RETCOD2=CLEANRC2(WRKREG);       /* MV CLEANUP RC INTO MESSAGE    */ 01014000
         LR    @12,WRKREG                                          0455 01015000
         AR    @12,@12                                             0455 01016000
         LA    @10,CLEANRC2-2(@12)                                 0455 01017000
         MVC   RETCOD2(2,SDWAPTR),0(@10)                           0455 01018000
*   RFY                                                            0456 01019000
*     WRKREG UNRSTD;                                               0456 01020000
*   RETCOD=DUMPRC(WKADUMP/RCDIV);   /* MV DUMP RET CODE INTO MESS    */ 01021000
         SR    @12,@12                                             0457 01022000
         IC    @12,WKADUMP(,RBSECPTR)                              0457 01023000
         SRL   @12,2                                               0457 01024000
         AR    @12,@12                                             0457 01025000
         LA    @06,DUMPRC-2(@12)                                   0457 01026000
         MVC   RETCOD(2,SDWAPTR),0(@06)                            0457 01027000
*   MSGJOB=TIOCNJOB;                /* MV IN JOB NAME                */ 01028000
         L     @12,PSATOLD                                         0458 01029000
         L     @12,TCBTIO(,@12)                                    0458 01030000
         MVC   MSGJOB(8,SDWAPTR),TIOCNJOB(@12)                     0458 01031000
*   MSGSTEP=TIOCSTEP;               /* MV IN STEP NAME               */ 01032000
*                                                                  0459 01033000
         MVC   MSGSTEP(8,SDWAPTR),TIOCSTEP(@12)                    0459 01034000
*/* MUST VALIDATE THE TIOT ENTRY BEFORE GETTING DDNAME FOR MESSAGE.  */ 01035000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 01036000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 01037000
*/* CHECKED FIRST.                                                   */ 01038000
*                                                                  0460 01039000
*   CALL DEBCHECK;                  /* GO VALIDATE THE DEB           */ 01040000
         BAL   @14,DEBCHECK                                        0460 01041000
*   RFY                                                            0461 01042000
*     DEBBASIC BASED(WKADEB);       /* VALID DEB PASSED IN SVRB      */ 01043000
*   IF WKADEBRC=0 THEN              /* IF DEB RET CODE=0,DEB OK      */ 01044000
         CLI   WKADEBRC(RBSECPTR),0                                0462 01045000
         BNE   @RF00462                                            0462 01046000
*     MSGDDN=TIOEDDNM;              /* MV DDNAME INTO GTF BUFFER     */ 01047000
         SR    @12,@12                                             0463 01048000
         ICM   @12,7,WKADEB(RBSECPTR)                              0463 01049000
         L     @12,DEBAPPAD(,@12)                                  0463 01050000
         L     @12,DEBXTNP(,@12)                                   0463 01051000
         L     @12,DEBXDSAB(,@12)                                  0463 01052000
         L     @12,DSABTIOT(,@12)                                  0463 01053000
         MVC   MSGDDN(8,SDWAPTR),TIOEDDNM(@12)                     0463 01054000
*   ELSE                            /* ELSE ASSIGN DDN ASTERISKS     */ 01055000
*     MSGDDN=NODDNAME;              /* MOVE ASTERISKS INTO BUFFER    */ 01056000
         B     @RC00462                                            0464 01057000
@RF00462 MVC   MSGDDN(8,SDWAPTR),NODDNAME                          0464 01058000
*   DO;                             /* WTOP MF(E,MESSAGE)            */ 01059000
@RC00462 DS    0H                                                  0466 01060000
*     RFY                                                          0466 01061000
*       GPR01P RSTD;                /* RESTRICT REG 1                */ 01062000
*     GPR01P=ADDR(MESSAGE);         /* ADDRESS CONTROL PROGRAM LIST  */ 01063000
         LA    GPR01P,MESSAGE(,SDWAPTR)                            0467 01064000
*     SVC(35);                      /* ISSUE WTO SVC                 */ 01065000
         SVC   35                                                  0468 01066000
*     RFY                                                          0469 01067000
*       GPR01P UNRSTD;              /* RELEASE REG 1                 */ 01068000
*   END;                            /* WTOP MF(E,MESSAGE)            */ 01069000
*                                   /* ISSUE WTP MESSAGE             */ 01070000
*RECORD1:                                                          0471 01071000
*   CALL RECORD;                    /* GO SET UP RECORDING AREA      */ 01072000
RECORD1  BAL   @14,RECORD                                          0471 01073000
*   DO;                             /* SETRP RECORD(YES)           0472 01074000
*                                      COMPCOD(ERRSYS)             0472 01075000
*                                      WKAREA(SDWAPTR) REGS(14,12) 0472 01076000
*                                      DUMP(NO)                      */ 01077000
*     RESPECIFY                                                    0473 01078000
*      (GPR00P,                                                    0473 01079000
*       GPR01P,                                                    0473 01080000
*       GPR14P,                                                    0473 01081000
*       GPR15P)RSTD;                                               0473 01082000
*     GPR01P=SDWAPTR;                                              0474 01083000
         LR    GPR01P,SDWAPTR                                      0474 01084000
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */ 01085000
         MVI   SDWARCDE(GPR01P),X'00'                              0475 01086000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 01087000
         OI    SDWARCRD(GPR01P),B'10000000'                        0476 01088000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01089000
         NI    SDWAREQ(GPR01P),B'01111111'                         0477 01090000
*     GPR14P=ERRSYS;                /* ACCESS COMPLETION CODE        */ 01091000
         SR    GPR14P,GPR14P                                       0478 01092000
         ICM   GPR14P,7,ERRSYS                                     0478 01093000
*     GPR01P->SDWACMPC=GPR14P;      /* STORE COMPLETION CODE         */ 01094000
         STCM  GPR14P,7,SDWACMPC(GPR01P)                           0479 01095000
*     GEN(RETURN (14,12));                                         0480 01096000
         RETURN (14,12)                                                 01097000
*     RESPECIFY                                                    0481 01098000
*      (GPR00P,                                                    0481 01099000
*       GPR01P,                                                    0481 01100000
*       GPR14P,                                                    0481 01101000
*       GPR15P)UNRSTD;                                             0481 01102000
*   END;                            /* RETURN TO RTM                 */ 01103000
*                                                                  0482 01104000
*/********************************************************************/ 01105000
*/*  THE FOLLOWING ROUTINE IS GIVEN CONTROL BY MACRO IGGSTART WHEN IT*/ 01106000
*/*  IS DETERMINED THAT A PREVIOUS RECOVERY ROUTINE FAILED AND NO SVC*/ 01107000
*/*  DUMP WAS TAKEN. THIS ROUTINE CALLS SDUMP RTN TO TAKE AN SVC     */ 01108000
*/*  DUMP AND THEN TRANSFERS CONTROL TO THE CLEANRTN.                */ 01109000
*/********************************************************************/ 01110000
*                                                                  0483 01111000
*DUMPRTN:                                                          0483 01112000
*   ;                               /* RTN TO GET SVC DUMP & RET     */ 01113000
DUMPRTN  DS    0H                                                  0484 01114000
*   CALL SDUMP;                     /* GO TO TAKE SVC DUMP           */ 01115000
*                                                                  0484 01116000
         BAL   @14,SDUMP                                           0484 01117000
*/********************************************************************/ 01118000
*/*  THIS ROUTINE IS GIVEN CONTROL BY MACRO IGGSTART OR DUMPRTN WHEN */ 01119000
*/*  AN ERROR OCCURRED ON OTHER THAN THE ESTAES RB LEVEL OR AN ERROR */ 01120000
*/*  OTHER THAN A PROGRAM CHECK OCCURRED IN THE SVC.                 */ 01121000
*/********************************************************************/ 01122000
*                                                                  0485 01123000
*CLEANRTN:                                                         0485 01124000
*   ;                               /* CLEAN UP AND RETURN           */ 01125000
CLEANRTN DS    0H                                                  0486 01126000
*   BLKCTR=PERCERR;                 /* INITIALIZE BLKID REG TO 10, 0486 01127000
*                                      INDICATING INITIAL BRANCH TO     01128000
*                                      DUMPRTN/CLEANRTN,NOT USER ERR */ 01129000
         LA    BLKCTR,10                                           0486 01130000
*   CALL CLEANUP;                   /* GO TO CLEAN UP RESOURCES      */ 01131000
         BAL   @14,CLEANUP                                         0487 01132000
*   RFY                                                            0488 01133000
*     GPR15P RSTD;                  /* RESTRICT FOR CLEANUP RC       */ 01134000
*   IF GPR15P¬=0 THEN               /* IF CLEANRTN RC NOT 0, WAS     */ 01135000
         LTR   GPR15P,GPR15P                                       0489 01136000
         BZ    @RF00489                                            0489 01137000
*     DO;                           /* ERROR IN CLEAN UP             */ 01138000
*       WKACLEAN=CLEANRC1(1);       /* SET RC FOR CLEANUP ABEND      */ 01139000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1                       0491 01140000
*       GEN(ESTAE 0);               /* GET RID OF ESTAE              */ 01141000
         ESTAE 0                                                        01142000
*     END;                                                         0493 01143000
*   RFY                                                            0494 01144000
*     GPR15P UNRSTD;                                               0494 01145000
@RF00489 DS    0H                                                  0495 01146000
*RECORD2:                                                          0495 01147000
*   CALL RECORD;                    /* GO SET UP RECORDING AREA      */ 01148000
RECORD2  BAL   @14,RECORD                                          0495 01149000
*   DO;                             /* SETRP RECORD(YES) DUMP(NO)  0496 01150000
*                                      REGS(14,12) WKAREA(SDWAPTR)   */ 01151000
*     RESPECIFY                                                    0497 01152000
*      (GPR00P,                                                    0497 01153000
*       GPR01P,                                                    0497 01154000
*       GPR14P,                                                    0497 01155000
*       GPR15P)RSTD;                                               0497 01156000
*     GPR01P=SDWAPTR;                                              0498 01157000
         LR    GPR01P,SDWAPTR                                      0498 01158000
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */ 01159000
         MVI   SDWARCDE(GPR01P),X'00'                              0499 01160000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 01161000
         OI    SDWARCRD(GPR01P),B'10000000'                        0500 01162000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01163000
         NI    SDWAREQ(GPR01P),B'01111111'                         0501 01164000
*     GEN(RETURN (14,12));                                         0502 01165000
         RETURN (14,12)                                                 01166000
*     RESPECIFY                                                    0503 01167000
*      (GPR00P,                                                    0503 01168000
*       GPR01P,                                                    0503 01169000
*       GPR14P,                                                    0503 01170000
*       GPR15P)UNRSTD;                                             0503 01171000
*   END;                                                           0504 01172000
*                                                                  0505 01173000
*/********************************************************************/ 01174000
*/*                         SUBROUTINES                              */ 01175000
*/********************************************************************/ 01176000
*/********************************************************************/ 01177000
*/*  THE FOLLOWING SUBROUTINE VALIDITY CHECKS THE DEB. A BRANCH ENTRY*/ 01178000
*/*  IS TAKEN WHICH REQUIRES THAT THE LOCAL LOCK BE HELD. INPUT TO   */ 01179000
*/*  DEBCHK IS AS FOLLOWS:                                           */ 01180000
*/*                           REGISTER 1 - DEB ADDRESS               */ 01181000
*/*                           REGISTER 10 - TCB ADDRESS              */ 01182000
*/*                           REGISTER 14 - RETURN ADDRESS           */ 01183000
*/*                           REGISTER 15 - DEBCHK ROUTINE ADDRESS   */ 01184000
*/*  DEBCHK RETURNS TO 4 BYTES PAST REGISTER 14 IF AN ERROR OCCURS.  */ 01185000
*/*  REGISTER 15 WILL HAVE 4 IF THERE IS AN ERROR. REGISTERS 1-14    */ 01186000
*/*  UPON ENTRY TO THIS SUBROUTINE ARE SAVED, AND RESTORED UPON EXIT.*/ 01187000
*/*  INPUT TO THIS ROUTINE ARE: THE DCB ADDRESS IN DCBPTR(R6), SDWA  */ 01188000
*/*  ADDRESS IN SDWAPTR(R5) AND THE SVRB ADDRESS IN RBSECPTR(R8).    */ 01189000
*/*  THE LOCK BIT IS ON WHEN ENTRY IS FROM THE USERRTN OR ABEND RTN. */ 01190000
*/*  WHEN THIS BIT IS ON THIS RTN ASSUMES THE LOCK IS BEING HELD.    */ 01191000
*/*  THE DEB ADDRESS AND DEBCHK RETURN CODE ARE PASSED TO THE CALLING*/ 01192000
*/*  ROUTINE IN THE SVRB.                                            */ 01193000
*/********************************************************************/ 01194000
*                                                                  0505 01195000
*DEBCHECK:                                                         0505 01196000
*   PROC OPTIONS(NOSAVE);           /* DEBCHECK SUBROUTINE           */ 01197000
         B     @PB00002                                            0505 01198000
DEBCHECK DS    0H                                                  0506 01199000
*   RFY                                                            0506 01200000
*    (GPR01P,                                                      0506 01201000
*     GPR14P)RSTD;                                                 0506 01202000
*   STM(GPR01P,GPR14P,SAVESDWA);    /* SAVE REGS 1-14 IN SDWA        */ 01203000
         STM   GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0507 01204000
*   RFY                                                            0508 01205000
*    (GPR01P,                                                      0508 01206000
*     GPR14P)UNRSTD;                                               0508 01207000
*   IF WKALOCK='0'B THEN            /* IF LOCK NOT ON, GET LOCK      */ 01208000
         TM    WKALOCK(RBSECPTR),B'00000001'                       0509 01209000
         BNZ   @RF00509                                            0509 01210000
*     DO;                           /* SOME CALLERS DONT HAVE LCK    */ 01211000
*                                                                  0510 01212000
*/*           GET THE LOCAL LOCK                                     */ 01213000
*                                                                  0511 01214000
*DEBLOCK:                                                          0511 01215000
*       ;                           /* GET THE LOCAL LOCK            */ 01216000
DEBLOCK  DS    0H                                                  0512 01217000
*       DO;                         /* SETLOCK (OBTAIN) MODE(UNCOND)    01218000
*                                      TYPE(LOCAL) RELATED(DEBDCB,IGC   01219000
*                                      T005G,(DEBFREE))              */ 01220000
*         RFY                                                      0513 01221000
*          (GPR11P,                                                0513 01222000
*           GPR12P,                                                0513 01223000
*           GPR13P,                                                0513 01224000
*           GPR14P)RSTD;                                           0513 01225000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0514 01226000
*                                      TABLE.                        */ 01227000
         L     GPR13P,PSALITA                                      0514 01228000
*         GEN(LM GPR11P,GPR13P,576(GPR13P));/* LOAD LOCKWORD, CLHT 0515 01229000
*                                      AND ENTRY ADRS.               */ 01230000
         LM GPR11P,GPR13P,576(GPR13P)                                   01231000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 01232000
         BALR GPR14P,GPR13P                                             01233000
*         RFY                                                      0517 01234000
*          (GPR11P,                                                0517 01235000
*           GPR12P,                                                0517 01236000
*           GPR13P,                                                0517 01237000
*           GPR14P)UNRSTD;                                         0517 01238000
*       END;                        /* SETLOCK (OBTAIN) MODE(UNCOND)    01239000
*                                      TYPE(LOCAL) RELATED(DEBDCB,IGC   01240000
*                                      T005G,(DEBFREE))              */ 01241000
*                                   /* GET LOCAL LOCK                */ 01242000
*     END;                                                         0519 01243000
*                                                                  0519 01244000
*/*    GO TO DEBCHK ROUTINE - HOWEVER, SINCE THERE IS ONE FIELD IN   */ 01245000
*/*    THE DEB WHICH DEBCHK ASSUMES IS IN KEY 5 CORE (DEBTBLOF) MUST */ 01246000
*/*    FIRST PASS THIS FIELD TO THE SYSTEM VALIDITY CHECK ROUTINE TO */ 01247000
*/*    ENSURE ITS CORE LOCATION.                                     */ 01248000
*                                                                  0520 01249000
*   RFY                                                            0520 01250000
*    (GPR01P,                                                      0520 01251000
*     GPR02P,                                                      0520 01252000
*     GPR04P,                                                      0520 01253000
*     GPR10P,                                                      0520 01254000
*     GPR14P,                                                      0520 01255000
*     GPR15P)RSTD;                                                 0520 01256000
@RF00509 DS    0H                                                  0521 01257000
*   GPR01P=DCBDEBA;                 /* PUT DEB ADDR IN R1            */ 01258000
         L     @12,DCBPTR(,RBSECPTR)                               0521 01259000
         SR    GPR01P,GPR01P                                       0521 01260000
         ICM   GPR01P,7,DCBDEBA+40(@12)                            0521 01261000
*   GPR01P=GPR01P-LENGTH(DEBTBLOF); /* GET ADDR OF FIELD       YM5738*/ 01262000
         BCTR  GPR01P,0                                            0522 01263000
         BCTR  GPR01P,0                                            0522 01264000
*   GPR02P=GPR01P+1;                /* END OF FIELD            YM5738*/ 01265000
         LA    GPR02P,1                                            0523 01266000
         AR    GPR02P,GPR01P                                       0523 01267000
*   GPR04P=ADDR(DEBKEY)-KEYOFFS;    /* ADDR OF DEB KEY=5       YM5738*/ 01268000
         LA    GPR04P,DEBKEY                                       0524 01269000
         SH    GPR04P,@CH02596                                     0524 01270000
*   CALL CVT0VL00;                  /* VALIDITY CHECK RTN      YM5738*/ 01271000
         L     @12,CVTPTR                                          0525 01272000
         L     @15,CVT0VL00(,@12)                                  0525 01273000
         BALR  @14,@15                                             0525 01274000
*   BC(8,GOCHKDEB);                 /* DEBTBLOP IS GOOD        YM5738*/ 01275000
         BC    8,GOCHKDEB                                          0526 01276000
*BADDEB:                                                           0527 01277000
*   ;                               /* DEBTBLOP IS BAD         YM5738*/ 01278000
BADDEB   DS    0H                                                  0528 01279000
*   WKADEB=GPR01P;                  /* PUT INVALID FIELD ADDR WHERE     01280000
*                                      DEB ADDR SHOULD GO      YM5738*/ 01281000
         STCM  GPR01P,7,WKADEB(RBSECPTR)                           0528 01282000
*   WKADEBRC=DEBBAD;                /* RC=4 -INVALID DEB       YM5738*/ 01283000
         MVI   WKADEBRC(RBSECPTR),X'04'                            0529 01284000
*   GOTO CHKLOCK;                   /* GO CHECK LOCK           YM5738*/ 01285000
         B     CHKLOCK                                             0530 01286000
*   RFY                                                            0531 01287000
*    (GPR02P,                                                      0531 01288000
*     GPR04P)UNRSTD;                /* RELEASE REGS 2,4        YM5738*/ 01289000
*                                                                  0531 01290000
*/*         READY TO GO TO DEBCHK ROUTINE                            */ 01291000
*                                                                  0532 01292000
*GOCHKDEB:                                                         0532 01293000
*   ;                               /* GO TO DEBCHK ROUT       YM5738*/ 01294000
GOCHKDEB DS    0H                                                  0533 01295000
*   GPR01P=GPR01P+LENGTH(DEBTBLOF); /* GET DEB ADDR IN R1      YM5738*/ 01296000
         AH    GPR01P,@CH00091                                     0533 01297000
*   GPR10P=PSATOLD;                 /* PUT TCB ADDR IN R10           */ 01298000
         L     GPR10P,PSATOLD                                      0534 01299000
*   CALL CVTDEBVR;                  /* BRANCH ENTRY TO DEBCHK        */ 01300000
         L     @12,CVTPTR                                          0535 01301000
         L     @12,CVTEXT2(,@12)                                   0535 01302000
         L     @15,CVTDEBVR(,@12)                                  0535 01303000
         BALR  @14,@15                                             0535 01304000
*   GEN(NOP 0);                     /* USE UP 4 BYTES ON RETURN      */ 01305000
         NOP 0                                                          01306000
*   WKADEB=GPR01P;                  /* SAVE VALIDATED DEB ADDR IN  0537 01307000
*                                      SVRB WORKAREA                 */ 01308000
         STCM  GPR01P,7,WKADEB(RBSECPTR)                           0537 01309000
*   WKADEBRC=RETURNCD;              /* SAVE DEBCHK RC IN TOP BYTE    */ 01310000
         STC   RETURNCD,WKADEBRC(,RBSECPTR)                        0538 01311000
*   RFY                                                            0539 01312000
*     DEBBASIC BASED(WKADEB);       /* DEB PTR SAVED IN SVRB         */ 01313000
*   IF RETURNCD=0&DEBDCBB¬=DCBPTR THEN/* IF DEB VALID SO FAR ENSURE     01314000
*                                      IT POINTS TO DCB              */ 01315000
         LTR   RETURNCD,RETURNCD                                   0540 01316000
         BNZ   @RF00540                                            0540 01317000
         SR    @12,@12                                             0540 01318000
         ICM   @12,7,WKADEB(RBSECPTR)                              0540 01319000
         SR    @11,@11                                             0540 01320000
         ICM   @11,7,DEBDCBB(@12)                                  0540 01321000
         C     @11,DCBPTR(,RBSECPTR)                               0540 01322000
         BE    @RF00540                                            0540 01323000
*     WKADEBRC=DEBBAD;              /* NO,PUT IN RC=4,INVALID DEB    */ 01324000
         MVI   WKADEBRC(RBSECPTR),X'04'                            0541 01325000
*CHKLOCK:                                                          0542 01326000
*   ;                               /* SHOULD LOCK BE FREE     YM5738*/ 01327000
@RF00540 DS    0H                                                  0542 01328000
CHKLOCK  DS    0H                                                  0543 01329000
*   IF WKALOCK='0'B THEN            /* IF LOCK SW NOT ON,THEN        */ 01330000
         TM    WKALOCK(RBSECPTR),B'00000001'                       0543 01331000
         BNZ   @RF00543                                            0543 01332000
*     DO;                           /* MUST FREE LOCK GOTTEN HERE    */ 01333000
*                                                                  0544 01334000
*/*                   RELEASE THE LOCAL LOCK                         */ 01335000
*                                                                  0545 01336000
*DEBFREE:                                                          0545 01337000
*       ;                           /* FREE THE LOCAL LOCK           */ 01338000
DEBFREE  DS    0H                                                  0546 01339000
*       DO;                         /* SETLOCK (RELEASE) TYPE(LOCAL)    01340000
*                                      RELATED(DEBDCB,IGCT005G,(DEBLO   01341000
*                                      CK))                          */ 01342000
*         RFY                                                      0547 01343000
*          (GPR11P,                                                0547 01344000
*           GPR12P,                                                0547 01345000
*           GPR13P,                                                0547 01346000
*           GPR14P)RSTD;                                           0547 01347000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0548 01348000
*                                      TABLE.                        */ 01349000
         L     GPR13P,PSALITA                                      0548 01350000
*         GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT 0549 01351000
*                                      AND ENTRY ADRS.               */ 01352000
         LM GPR11P,GPR13P,588(GPR13P)                                   01353000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 01354000
         BALR GPR14P,GPR13P                                             01355000
*         RFY                                                      0551 01356000
*          (GPR11P,                                                0551 01357000
*           GPR12P,                                                0551 01358000
*           GPR13P,                                                0551 01359000
*           GPR14P)UNRSTD;                                         0551 01360000
*       END;                        /* SETLOCK (RELEASE) TYPE(LOCAL)    01361000
*                                      RELATED(DEBDCB,IGCT005G,(DEBLO   01362000
*                                      CK))                          */ 01363000
*                                   /* FREE LOCAL LOCK               */ 01364000
*     END;                                                         0553 01365000
*   RFY                                                            0554 01366000
*    (GPR01P,                                                      0554 01367000
*     GPR14P)RSTD;                                                 0554 01368000
@RF00543 DS    0H                                                  0555 01369000
*   LM(GPR01P,GPR14P,SAVESDWA);     /* RESTORE REG 1-14 FROM SDWA    */ 01370000
         LM    GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0555 01371000
*   RFY                                                            0556 01372000
*    (GPR01P,                                                      0556 01373000
*     GPR14P)UNRSTD;                                               0556 01374000
*   WKALOCK='0'B;                   /* TURN OFF LOCK SW FOR ALL      */ 01375000
         NI    WKALOCK(RBSECPTR),B'11111110'                       0557 01376000
*   END DEBCHECK;                                                  0558 01377000
@EL00002 DS    0H                                                  0558 01378000
@EF00002 DS    0H                                                  0558 01379000
@ER00002 BR    @14                                                 0558 01380000
*   RFY                                                            0559 01381000
*    (GPR01P,                                                      0559 01382000
*     GPR10P,                                                      0559 01383000
*     GPR14P,                                                      0559 01384000
*     GPR15P)UNRSTD;                                               0559 01385000
*                                                                  0560 01386000
*/********************************************************************/ 01387000
*/* THE FOLLOWING SUBROUTINE RECEIVES CONTROL FROM THE DUMPRTN, THE  */ 01388000
*/* SYSERRTN, AND THE 2ND LEVEL ESTAE TO TAKE AN SVC DUMP. A HEADER  */ 01389000
*/* IS BUILT IN THE SDWA TO IDENTIFY THE DUMP. THE ONLY REGS CHANGED */ 01390000
*/* BY THIS SUBROUTINE ARE 0,1 AND 15. UPON ENTRY THE LOCAL LOCK     */ 01391000
*/* IS NOT HELD.  THE SDUMP SVC WILL RETURN A RETURN CODE IN R15,    */ 01392000
*/* THE VALUES FOR WHICH ARE AS FOLLOWS:                             */ 01393000
*/*                                00 - SDUMP SUCCESSFUL             */ 01394000
*/*                                04 - PARTIAL SDUMP TAKEN          */ 01395000
*/*                                08 - SDUMP UNSUCCESSFUL           */ 01396000
*/* THE SDUMP RETURN CODE PRESENTED TO THE USER IS THIS VALUE +4.    */ 01397000
*/*                                04 - SDUMP SUCCESSFUL             */ 01398000
*/*                                08 - PARTIAL SDUMP TAKEN          */ 01399000
*/*                                0C - SDUMP UNSUCCESSFUL           */ 01400000
*/* A BIT IS SET IN THE SVRB WORKAREA TO IDENTIFY THE RETURN CODE.   */ 01401000
*/********************************************************************/ 01402000
*                                                                  0560 01403000
*SDUMP:                                                            0560 01404000
*   PROC OPTIONS(NOSAVE);           /* TAKE AN SVC DUMP              */ 01405000
SDUMP    DS    0H                                                  0561 01406000
*   RFY                                                            0561 01407000
*    (GPR00P,                                                      0561 01408000
*     GPR01P,                                                      0561 01409000
*     GPR14P,                                                      0561 01410000
*     GPR15P)RSTD;                                                 0561 01411000
*   HEADER=HEADING;                 /* SET UP HEADER                 */ 01412000
         MVC   HEADER(27,SDWAPTR),HEADING                          0562 01413000
*   JOBNAME=TIOCNJOB;               /* JOB NAME                      */ 01414000
         L     @12,PSATOLD                                         0563 01415000
         L     @12,TCBTIO(,@12)                                    0563 01416000
         MVC   JOBNAME(8,SDWAPTR),TIOCNJOB(@12)                    0563 01417000
*   STEPNAME=TIOCSTEP;              /* STEP NAME                     */ 01418000
         MVC   STEPNAME(8,SDWAPTR),TIOCSTEP(@12)                   0564 01419000
*   SDUMPLST=DUMPLIST;              /* MOVE LIST FORM TO VAR.AREA    */ 01420000
         MVC   SDUMPLST(24,SDWAPTR),DUMPLIST                       0565 01421000
*   GPR01P=ADDR(SDUMPLST);          /* PUT DUMP LIST ADDR IN REG     */ 01422000
         LA    GPR01P,SDUMPLST(,SDWAPTR)                           0566 01423000
*   GEN REFS(HEADER)SETS(SDUMPLST,GPR00P,GPR01P);                  0567 01424000
        SDUMP HDRAD=HEADER(SDWAPTR),MF=(E,(1))  TAKE SVC DUMP           01425000
*   SDWAEAS='1'B;                   /* SET DUMP TAKEN FLAG           */ 01426000
         OI    SDWAEAS(SDWAPTR),B'00001000'                        0568 01427000
*   WKADUMP=RETURNCD+RCDIV;         /* PUT RC+4 FROM DUMP IN WKA     */ 01428000
         LA    @12,4                                               0569 01429000
         AR    @12,RETURNCD                                        0569 01430000
         STC   @12,WKADUMP(,RBSECPTR)                              0569 01431000
*   END SDUMP;                      /* RETURN TO MAIN ROUTINE        */ 01432000
@EL00003 DS    0H                                                  0570 01433000
@EF00003 DS    0H                                                  0570 01434000
@ER00003 BR    @14                                                 0570 01435000
*   RFY                                                            0571 01436000
*    (GPR00P,                                                      0571 01437000
*     GPR01P,                                                      0571 01438000
*     GPR14P,                                                      0571 01439000
*     GPR15P)UNRSTD;                                               0571 01440000
*                                                                  0571 01441000
*/********************************************************************/ 01442000
*/*  THE FOLLOWING SUBROUTINE IS CALLED BY THE SYSERRTN AND THE      */ 01443000
*/*  CLEANRTN  TO SET UP THE SDWA WHEN A SYSTEM ERROR HAS BEEN       */ 01444000
*/*  DETECTED. THE FOLLOWING RECORDING INFORMATION WILL BE PUT IN    */ 01445000
*/*  THE VARIABLE PORTION OF THE SDWA (FROM WHERE RTM WILL PUT IT    */ 01446000
*/*  OUT ON SYS1.LOGREC):  SVC AUDIT TRAIL BYTE                      */ 01447000
*/*                        RETURN CODE FROM CLEANRTN                 */ 01448000
*/*                        RETURN CODE FROM SDUMP                    */ 01449000
*/*                        REGISTERS 0 AND 1 AT TIME SVC ISSUED      */ 01450000
*/*                        RB OLD PSW CONTAINING THE ADDRESS+2 FROM  */ 01451000
*/*                           WHERE THE SVC WAS ISSUED               */ 01452000
*/*                        OLD ABEND CODE IF PERCOLATED ERROR        */ 01453000
*/*  THE ONLY REGISTER CHANGED BY THIS SUBROUTINE IS REG 1.          */ 01454000
*/********************************************************************/ 01455000
*                                                                  0572 01456000
*RECORD:                                                           0572 01457000
*   PROC OPTIONS(NOSAVE);           /* PUT SYSTEM INFO IN SDWA       */ 01458000
RECORD   DS    0H                                                  0573 01459000
*   RFY                                                            0573 01460000
*     GPR14P RSTD;                  /* RESTRICT RETURN ADDR          */ 01461000
*   RECAUDIT=WKATRAIL;              /* MV AUDIT TRAIL BIT IN SDWA    */ 01462000
         MVC   RECAUDIT(1,SDWAPTR),WKATRAIL(RBSECPTR)              0574 01463000
*   RECRCDP=WKADUMP;                /* MV SVC DUMP RET CODE IN       */ 01464000
         MVC   RECRCDP(1,SDWAPTR),WKADUMP(RBSECPTR)                0575 01465000
*   RECRCLN=WKACLEAN;               /* MV CLEANUP RTN RET CODE IN    */ 01466000
         MVC   RECRCLN(1,SDWAPTR),WKACLEAN(RBSECPTR)               0576 01467000
*   RECREG0=RBGRS0;                 /* REG0 WHEN SVC WAS ISSUED      */ 01468000
         MVC   RECREG0(4,SDWAPTR),RBGRS0(RBSECPTR)                 0577 01469000
*   RECREG1=RBGRS1;                 /* REG1 WHEN SVC WAS ISSUED      */ 01470000
         MVC   RECREG1(4,SDWAPTR),RBGRS1(RBSECPTR)                 0578 01471000
*   RFY                                                            0579 01472000
*     GPR01P RSTD;                  /* RESTRICT WORK REG             */ 01473000
*   GPR01P=RBLINK;                  /* GET PREVIOUS RB ADDR          */ 01474000
         L     GPR01P,RBLINK(,RBSECPTR)                            0580 01475000
*   RFY                                                            0581 01476000
*     RBBASIC BASED(GPR01P);        /* BASE FOR PREVIOUS RB          */ 01477000
*   RECOPSW=RBOPSW;                 /* GET PSW FROM PREVIOUS RB      */ 01478000
         MVC   RECOPSW(8,SDWAPTR),RBOPSW(GPR01P)                   0582 01479000
*   RECPERC=SDWACMPC;               /* PUT IN PREVIOUS ABEND CODE    */ 01480000
         MVC   RECPERC(3,SDWAPTR),SDWACMPC(SDWAPTR)                0583 01481000
*   RFY                                                            0584 01482000
*     RBBASIC BASED(RBSECPTR);      /* RETURN TO RB BASE FOR SVC     */ 01483000
*   END RECORD;                     /* RETURN TO MAIN ROUTINE        */ 01484000
@EL00004 DS    0H                                                  0585 01485000
@EF00004 DS    0H                                                  0585 01486000
@ER00004 BR    @14                                                 0585 01487000
*   RFY                                                            0586 01488000
*    (GPR01P,                                                      0586 01489000
*     GPR14P)UNRSTD;                                               0586 01490000
*                                                                  0587 01491000
*/********************************************************************/ 01492000
*/*  THE FOLLOWING SUBROUTINE PERFORMS THE CLEANUP FUNCTION FOR THIS */ 01493000
*/*  ESTAE.  THIS ROUTINE IS ENTERED FOR ALL ERROR CONDITIONS.  INPUT*/ 01494000
*/*  TO THE ROUTINE IS THE AUDIT TRAIL BIT SET BY THE DYNAMIC BUFFER */ 01495000
*/*  MODULE TO INDICATE HOW MUCH PROCESSING WAS COMPLETED BEFORE THE */ 01496000
*/*  ABEND. THIS BIT IS FOUND IN THE FIRST BYTE OF THE SVRB EXTENDED */ 01497000
*/*  SAVEAREA. AS THIS ROUTINE PERFORMS CLEANUP IT LIKEWISE WILL SET */ 01498000
*/*  CLEANUP RC BITS INDICATING WHAT WAS DONE.  A SECOND LEVEL       */ 01499000
*/*  ESTAE WILL BE ESTABLISHED FOR THIS ROUTINE, SHOULD A PROGRAM    */ 01500000
*/*  CHECK OCCUR DURING PROCESSING. THE SECOND LEVEL ESTAE WILL      */ 01501000
*/*  RETURN CONTROL TO THE MAIN ROUTINE.                             */ 01502000
*/*              THE CLEANUP RETURN CODES ARE AS FOLLOWS:            */ 01503000
*/*                  01     CLEANUP UNSUCCESSFUL. UNPREDICTABLE      */ 01504000
*/*                         RESULTS IF DYNAMIC BUFFERING IS USED     */ 01505000
*/*                         WITH FAILING DCB.                        */ 01506000
*/*                  02     CLEANUP SUCCESSFUL                       */ 01507000
*/*                  03     CLEANUP NOT ATTEMPTED. IT WAS DETERMINED */ 01508000
*/*                         AS NOT BEING NECESSARY. DCB IS REUSABLE. */ 01509000
*/*                  04     CLEANUP NOT ATTEMPTED BECAUSE DEBCHK     */ 01510000
*/*                         FOUND INVALID DEB, AUDIT TRAIL BIT WAS   */ 01511000
*/*                         INVALID OR INPUT CONTROL BLOCKS (DCB OR  */ 01512000
*/*                         DECB) WERE INVALID.                      */ 01513000
*/*  NOTE: REGISTERS 1-14 UPON ENTRY TO THIS SUBROUTINE ARE SAVED,   */ 01514000
*/*        AND RESTORED UPON EXIT. HOWEVER, SINCE THE DEBCHECK SUBRTN*/ 01515000
*/*        CALLED BY CLEANUP USES THE SAME SAVEAREA,ONLY THE CONTENTS*/ 01516000
*/*        OF THOSE REGISTERS RESTRICTED THROUGHOUT THE MODULE CAN   */ 01517000
*/*        BE ASSURED. THE REMAINING REGS ARE SAVED FOR MAINTENANCE  */ 01518000
*/*        NEEDS. THEIR CONTENTS CAN NOT BE GUARANTEED ACROSS ANY    */ 01519000
*/*        SUBROUTINE.  UPON RETURN FROM THIS SUBRTN R15 WILL CONTAIN*/ 01520000
*/*        A RC OF EITHER 0=CLEANUP COMPLETED, OR 4=CLEANUP ROUTINE  */ 01521000
*/*        ABENDED BEFORE RETURN.                                    */ 01522000
*/********************************************************************/ 01523000
*                                                                  0587 01524000
*CLEANUP:                                                          0587 01525000
*   PROC OPTIONS(NOSAVE);           /* CLEAN UP RESOURCES            */ 01526000
CLEANUP  DS    0H                                                  0588 01527000
*   RFY                                                            0588 01528000
*    (GPR01P,                                                      0588 01529000
*     GPR14P,                                                      0588 01530000
*     WRKREG)RSTD;                  /* RESTRICT RET ADDR             */ 01531000
*   STM(GPR01P,GPR14P,SAVESDWA);    /* SAVE REGS 1-14 IN SDWA        */ 01532000
         STM   GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0589 01533000
*   WRKREG=GPR14P;                  /* SAVE RETURN AROUND ESTAE      */ 01534000
         LR    WRKREG,GPR14P                                       0590 01535000
*   RFY                                                            0591 01536000
*    (GPR01P,                                                      0591 01537000
*     GPR14P)UNRSTD;                                               0591 01538000
*   WKAESTAE=ELIST;                 /* MV LIST FORM INTO WKAREA      */ 01539000
*                                                                  0592 01540000
         MVC   WKAESTAE(20,RBSECPTR),ELIST                         0592 01541000
*/* ISSUE ESTAE MACRO TO SET UP BACKUP ROUTINE SHOULD CLEANUP ABEND  */ 01542000
*                                                                  0593 01543000
*   GEN REFS(WKAESTAE,SDWAPTR);                                    0593 01544000
*                                      /* ISSUE SECOND LEVEL ESTAE  */  01545000
        ESTAE PARAM=(SDWAPTR),MF=(E,WKAESTAE(RBSECPTR)) SET UP  YM5757  01546000
*   WKARETRN=WRKREG;                /* SAVE RETURN REG IN SVRB -   0594 01547000
*                                      DEBCHECK WILL OVERLAY REG 14     01548000
*                                      SAVED IN SAVESDWA             */ 01549000
         ST    WRKREG,WKARETRN(,RBSECPTR)                          0594 01550000
*   RFY                                                            0595 01551000
*     WRKREG UNRSTD;                                               0595 01552000
*   WKASVREG=SDWAPTR;               /* SAVE SDWA IN SVRB             */ 01553000
         ST    SDWAPTR,WKASVREG(,RBSECPTR)                         0596 01554000
*   WKACLEAN=0;                     /* INITIALIZE CLEAN RC           */ 01555000
*                                                                  0597 01556000
         MVI   WKACLEAN(RBSECPTR),X'00'                            0597 01557000
*/* IF INPUT CONTROL BLOCKS (DECB OR DCB) ARE BAD, DON'T TRY TO      */ 01558000
*/* CLEAN UP - WILL ONLY MAKE THINGS WORSE.                          */ 01559000
*                                                                  0598 01560000
*   IF BLKCTR<BCBERR THEN           /* IF DCB/DECB INVALID     YM4667*/ 01561000
         CH    BLKCTR,@CH00107                                     0598 01562000
         BNL   @RF00598                                            0598 01563000
*     DO;                           /* CANT GET BUF ADDR       YM7500*/ 01564000
*       WKACLEAN=CLEANRC1(4);       /* SET CLEAN CODE=NONE     YM7500*/ 01565000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1+3                     0600 01566000
*       RFY                                                        0601 01567000
*         GPR05P RSTD;              /* RESTRICT REG 5          YM7500*/ 01568000
*       GPR05P=RBSECPTR;            /* EXITCLN EXPECT SVRB     YM7500*/ 01569000
         LR    GPR05P,RBSECPTR                                     0602 01570000
*                                   /* TO BE IN REG 5          YM7500*/ 01571000
*       GOTO EXITCLN;               /* GO TO RETURN            YM7500*/ 01572000
         B     EXITCLN                                             0603 01573000
*       RFY                                                        0604 01574000
*         GPR05P UNRSTD;            /*                         YM7500*/ 01575000
*     END;                          /*                         YM7500*/ 01576000
*                                                                  0605 01577000
*/* IF EXTEND FUNCTION, OR BUFFER ALREADY MADE AVAILABLE OR GIVEN    */ 01578000
*/* TO THE NEXT WAITING IOB WITH EXCP, NO CLEANUP TO BE DONE.        */ 01579000
*                                                                  0606 01580000
*   IF RBGRS0<0 THEN                /* IS DECB NEG FOR EXTEND        */ 01581000
@RF00598 ICM   @12,15,RBGRS0(RBSECPTR)                             0606 01582000
         BNM   @RF00606                                            0606 01583000
*     DO;                           /* YES, NO CLEANUP NECESSARY     */ 01584000
*       WKACLEAN=CLEANRC1(3);       /* TURN ON RC FOR NOCLEAN        */ 01585000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1+2                     0608 01586000
*       RFY                                                        0609 01587000
*         GPR05P RSTD;              /* ON ENTRY EXITCLN EXPECTS      */ 01588000
*       GPR05P=RBSECPTR;            /* SVRB ADDR TO BE IN REG 5      */ 01589000
         LR    GPR05P,RBSECPTR                                     0610 01590000
*       GOTO EXITCLN;               /* RETURN TO MAIN ROUTINE        */ 01591000
         B     EXITCLN                                             0611 01592000
*       RFY                                                        0612 01593000
*         GPR05P UNRSTD;                                           0612 01594000
*     END;                                                         0613 01595000
*   IF WKABUFQ='1'B|WKAEXCP='1'B THEN/* IF BUFFER ADDED TO AVAIL Q OR   01596000
*                                      ALREADY GIVEN TO NEXT IOB     */ 01597000
@RF00606 TM    WKABUFQ(RBSECPTR),B'00110000'                       0614 01598000
         BZ    @RF00614                                            0614 01599000
*     DO;                           /* NO CLEANUP NECESSARY          */ 01600000
*       WKACLEAN=CLEANRC1(3);       /* RETURN CODE MEANING THAT    0616 01601000
*                                      NECESSARY RESOURCES FREED     */ 01602000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1+2                     0616 01603000
*       RFY                                                        0617 01604000
*         GPR05P RSTD;              /* ON ENTRY EXITCLN EXPECTS      */ 01605000
*       GPR05P=RBSECPTR;            /* SVRB ADDR TO BE IN REG 5      */ 01606000
         LR    GPR05P,RBSECPTR                                     0618 01607000
*       GOTO EXITCLN;               /* RETURN TO MAIN ROUTINE        */ 01608000
         B     EXITCLN                                             0619 01609000
*       RFY                                                        0620 01610000
*         GPR05P UNRSTD;                                           0620 01611000
*     END;                                                         0621 01612000
*                                                                  0621 01613000
*/* BEFORE SETTING UP REGS FOR ENTRY INTO DYNAMIC BUFFERING MODULE   */ 01614000
*/* MUST GO TO THE DEBCHK ROUTINE TO VALIDATE THE DEB BEFORE GETTING */ 01615000
*/* THE ADDRESS TO THE DYNAMIC BUFFERING ROUTINE FROM IT.            */ 01616000
*                                                                  0622 01617000
*   CALL DEBCHECK;                  /* GO VALIDATE DEB ADDRESS       */ 01618000
@RF00614 BAL   @14,DEBCHECK                                        0622 01619000
*   IF WKADEBRC¬=0 THEN             /* IF DEB BAD, NO CLEANUP        */ 01620000
         CLI   WKADEBRC(RBSECPTR),0                                0623 01621000
         BE    @RF00623                                            0623 01622000
*     DO;                                                          0624 01623000
*       WKACLEAN=CLEANRC1(4);       /* SET CLEAN UP CODE TO NONE     */ 01624000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1+3                     0625 01625000
*       RFY                                                        0626 01626000
*         GPR05P RSTD;                                             0626 01627000
*       GPR05P=RBSECPTR;            /* ON ENTRY EXITCLN EXPECTS SVRB    01628000
*                                      ADDR TO BE IN REG 5           */ 01629000
         LR    GPR05P,RBSECPTR                                     0627 01630000
*       GOTO EXITCLN;               /* RETURN TO MAIN ROUTINE        */ 01631000
         B     EXITCLN                                             0628 01632000
*       RFY                                                        0629 01633000
*         GPR05P UNRSTD;                                           0629 01634000
*     END;                                                         0630 01635000
*                                                                  0630 01636000
*/*  INITIALIZE REGS REQUIRED FOR ENTRY INTO THE DYN BUF MODULES     */ 01637000
*                                                                  0631 01638000
*   RFY                                                            0631 01639000
*    (GPR01P,                                                      0631 01640000
*     GPR02P,                                                      0631 01641000
*     GPR03P,                                                      0631 01642000
*     GPR05P,                                                      0631 01643000
*     GPR06P,                                                      0631 01644000
*     GPR15P)RSTD;                                                 0631 01645000
@RF00623 DS    0H                                                  0632 01646000
*   RFY                                                            0632 01647000
*    (GPR04P,                                                      0632 01648000
*     GPR00P,                                                      0632 01649000
*     GPR08P)RSTD;                  /* RESTRICT INPUT TO DYNBUF      */ 01650000
*   RFY                                                            0633 01651000
*     DEBBASIC BASED(WKADEB);       /* VALIDATED DEB ADDR AS BASE    */ 01652000
*   GPR15P=DEBSIOA;                 /* GET DYN BUF MOD ADDRESS       */ 01653000
         SR    @12,@12                                             0634 01654000
         ICM   @12,7,WKADEB(RBSECPTR)                              0634 01655000
         L     @12,DEBAPPAD(,@12)                                  0634 01656000
         L     GPR15P,DEBSIOA(,@12)                                0634 01657000
*   GPR05P=RBSECPTR;                /* SVRB IN REG 5 FOR DYN BUF     */ 01658000
         LR    GPR05P,RBSECPTR                                     0635 01659000
*   RFY                                                            0636 01660000
*     RBBASIC BASED(GPR05P);        /* ESTABLISH R5 AS NEW BASE FOR     01661000
*                                      SVRB - SAME AS DYN BUF,     0636 01662000
*                                      CLEANUP SUBRTN DOES NOT HAVE     01663000
*                                      ADDRESSABILITY TO SDWA        */ 01664000
*   GPR00P=DECBPT;                  /* GET DECB ADDR ON ENTRY-R0     */ 01665000
         L     @14,DECBPT(,GPR05P)                                 0637 01666000
         LR    GPR00P,@14                                          0637 01667000
*   GPR06P=DECAREA;                 /* BUFFER ADDR IN R6       YM5757*/ 01668000
         L     GPR06P,DECAREA(,@14)                                0638 01669000
*   IF DECKEYS='1'B THEN            /* IF KEY READ IN BUF      YM5757*/ 01670000
         TM    DECKEYS(@14),B'10000000'                            0639 01671000
         BNO   @RF00639                                            0639 01672000
*     GPR06P=DECKYADR;              /* BEGIN WITH KEY ADDR     YM5757*/ 01673000
         L     GPR06P,DECKYADR(,@14)                               0640 01674000
*   GPR01P=DCBPTR;                  /* GET DCB ADDR ON ENTRY-R1      */ 01675000
@RF00639 L     @14,DCBPTR(,GPR05P)                                 0641 01676000
         LR    GPR01P,@14                                          0641 01677000
*   GPR08P=PSATOLD;                 /* TCB ALREADY IN R8             */ 01678000
         L     @12,PSATOLD                                         0642 01679000
         LR    GPR08P,@12                                          0642 01680000
*   GPR03P=GPR15P;                  /* SET UP BASE REG               */ 01681000
         LR    GPR03P,GPR15P                                       0643 01682000
*   GPR02P=WKAIOBRG;                /* WAITING IOB(IF THERE IS ONE)     01683000
*                                      IN R2 AT TIME OF ABEND (OR 0) */ 01684000
         L     GPR02P,WKAIOBRG(,GPR05P)                            0644 01685000
*   GPR04P=DCBPTR;                  /* DCB IN R4 AT TIME OF ABEND    */ 01686000
*                                                                  0645 01687000
         LR    GPR04P,@14                                          0645 01688000
*/*  ENTRY AT TOP OF DYN BUF MODULE - NO AUDIT TRAIL BITS SET        */ 01689000
*                                                                  0646 01690000
*   IF WKATRAIL=0 THEN              /* IF DYN BUF RTN DIDNT GO       */ 01691000
         CLI   WKATRAIL(GPR05P),0                                  0646 01692000
         BNE   @RF00646                                            0646 01693000
*     DO;                           /* TEST ADDRESS SPACE TO GET     */ 01694000
*       IF TCBRV='1'B THEN          /* CORRECT BUFFER FORMAT         */ 01695000
         TM    TCBRV(@12),B'10000000'                              0648 01696000
         BNO   @RF00648                                            0648 01697000
*         DO;                       /* REAL ADDRESS SPACE            */ 01698000
*           RFY                                                    0650 01699000
*             BCBDEFR BASED(DCBBUFCB);/* BCB BASE              YM5757*/ 01700000
*           IF BCBFRQT¬=WKASAVE THEN/* COMPARE 1ST FIELD CHANGED IN     01701000
*                                      DYN BUF MOD TO FIELD AS SAVED    01702000
*                                      ON ENTRY,TO DETERMINE IF ABEND   01703000
*                                      OCCURRED AFTER CHANGE BUT   0651 01704000
*                                      BEFORE BIT WAS SET.           */ 01705000
         L     @14,DCBBUFCB+16(,@14)                               0651 01706000
         CLC   BCBFRQT(4,@14),WKASAVE(GPR05P)                      0651 01707000
         BE    @RF00651                                            0651 01708000
*             DO;                   /* BCBFRQT WAS ALREADY CHANGE    */ 01709000
*               RFY                                                0653 01710000
*                 IOBSTDRD BASED(GPR02P);/* IOB BASE                 */ 01711000
*               IF GPR02P>0 THEN    /* IF IOB REG WAS SAVE     YM5757*/ 01712000
         SR    @14,@14                                             0654 01713000
         CR    GPR02P,@14                                          0654 01714000
         BNH   @RF00654                                            0654 01715000
*                 DO;               /* ENTRY NOT AT TOP        YM5757*/ 01716000
*                   DO;             /* MODESET KEYADDR(WKASVKEY)     */ 01717000
*                     SPKA(WKASVKEY);/* SET PSW KEY                  */ 01718000
         SR    @12,@12                                             0657 01719000
         IC    @12,WKASVKEY(,GPR05P)                               0657 01720000
         SPKA  0(@12)                                              0657 01721000
*                   END;            /* MODESET KEYADDR(WKASVKEY)     */ 01722000
*                                   /* USER KEY YM5757               */ 01723000
*                   IOBDQPTR=0;     /* MAKE SURE FIELD IS 0          */ 01724000
         ST    @14,IOBDQPTR(,GPR02P)                               0659 01725000
*                   DO;             /* MODESET EXTKEY(SUPR)          */ 01726000
*                     SPKA(0);      /* SET PSW KEY                   */ 01727000
         SPKA  0(@14)                                              0661 01728000
*                   END;            /* MODESET EXTKEY(SUPR)          */ 01729000
*                                   /* SUPER KEY YM5757              */ 01730000
*                   WKAIOBQ='1'B;   /* ENTRY +12 IN MOD              */ 01731000
         OI    WKAIOBQ(GPR05P),B'10000000'                         0663 01732000
*                   GOTO ESTENTA;   /* IOB IS DEQUEUED               */ 01733000
         B     ESTENTA                                             0664 01734000
*                 END;                                             0665 01735000
*             END;                                                 0666 01736000
@RF00654 DS    0H                                                  0667 01737000
*           IF WKASAVE2¬=BCBNABFR&WKASAVE2¬=0 THEN/* IF YM7563 BUFFER   01738000
*                                      ALREADY ADDED YM7563 TO     0667 01739000
*                                      AVAILABLE BUF QUE             */ 01740000
@RF00651 L     @14,WKASAVE2(,GPR05P)                               0667 01741000
         L     @12,DCBPTR(,GPR05P)                                 0667 01742000
         L     @12,DCBBUFCB+16(,@12)                               0667 01743000
         C     @14,BCBNABFR(,@12)                                  0667 01744000
         BE    @RF00667                                            0667 01745000
         LTR   @14,@14                                             0667 01746000
         BZ    @RF00667                                            0667 01747000
*             DO;                   /* ALL WORK COMPLETED            */ 01748000
*               WKACLEAN=CLEANRC1(3);/* SET CLEANUP CODE-OK          */ 01749000
         MVC   WKACLEAN(1,GPR05P),CLEANRC1+2                       0669 01750000
*               GOTO EXITCLN;       /* RETURN TO MAIN RTN            */ 01751000
         B     EXITCLN                                             0670 01752000
*             END;                                                 0671 01753000
*           ELSE                    /* NO FIELDS CHANGED       YM7563*/ 01754000
*             GOTO ESTENT;          /* CAN START AT TOP        YM7563*/ 01755000
*         END;                      /* END OF REAL ADRSPACE LOGIC    */ 01756000
*       ELSE                        /* VIRTUAL ADDRESS SPACE         */ 01757000
*         DO;                       /* WHICH USES UNSCHEDULED LST    */ 01758000
@RF00648 DS    0H                                                  0675 01759000
*           IF WKASAVE=0&WKASAVE2=0 THEN/* IF FIELDS 0         YM7563*/ 01760000
         SR    @14,@14                                             0675 01761000
         C     @14,WKASAVE(,GPR05P)                                0675 01762000
         BNE   @RF00675                                            0675 01763000
         C     @14,WKASAVE2(,GPR05P)                               0675 01764000
         BE    @RT00675                                            0675 01765000
*             GOTO ESTENT;          /* STILL, START AT TOP     YM7563*/ 01766000
*           RFY                                                    0677 01767000
*             BCBDEFV BASED(DCBBUFCB);/* BASE FOR BCB          YM5757*/ 01768000
@RF00675 DS    0H                                                  0678 01769000
*           IF USLBFRQT¬=WKASAVE THEN/* COMPARE 1ST FIELD CHANGE IN     01770000
*                                      DYN BUF MOD TO FIELD AS SAVED    01771000
*                                      ON ENTRY, TO DETERMINE IF   0678 01772000
*                                      ABEND OCCURRED AFTER CHANGE 0678 01773000
*                                      BUT BEFORE BIT WAS SET.       */ 01774000
         L     @14,DCBPTR(,GPR05P)                                 0678 01775000
         L     @14,DCBDYNB+52(,@14)                                0678 01776000
         CLC   USLBFRQT(4,@14),WKASAVE(GPR05P)                     0678 01777000
         BE    @RF00678                                            0678 01778000
*             DO;                   /* IF USL FIELDS WERE CHANGED    */ 01779000
*               WKAIOBQ='1'B;       /* IOB DEQUEUED +12 ENTRY        */ 01780000
         OI    WKAIOBQ(GPR05P),B'10000000'                         0680 01781000
*               GOTO ESTENTA;       /* ENTER IN THE MIDDLE           */ 01782000
         B     ESTENTA                                             0681 01783000
*             END;                                                 0682 01784000
*           IF USLIOB1=0&WKASAVE2¬=BCBBFAVL THEN/* IF YM5757 NO IOB     01785000
*                                      WAITING, AND IF FREED BUFFER     01786000
*                                      IS ALREADY PUT ON BUFFER QUEUE   01787000
*                                      AGAIN THEN                    */ 01788000
@RF00678 L     @14,DCBPTR(,GPR05P)                                 0683 01789000
         L     @12,DCBDYNB+52(,@14)                                0683 01790000
         ICM   @11,7,USLIOB1(@12)                                  0683 01791000
         BNZ   @RF00683                                            0683 01792000
         L     @14,DCBBUFCB+16(,@14)                               0683 01793000
         L     @12,WKASAVE2(,GPR05P)                               0683 01794000
         SR    @11,@11                                             0683 01795000
         IC    @11,BCBBFAVL(,@14)                                  0683 01796000
         CR    @12,@11                                             0683 01797000
         BE    @RF00683                                            0683 01798000
*             DO;                   /* ALL WORK COMPLETED            */ 01799000
*               WKACLEAN=CLEANRC1(3);/* SET CLEANUP CODE-OK          */ 01800000
         MVC   WKACLEAN(1,GPR05P),CLEANRC1+2                       0685 01801000
*               GOTO EXITCLN;       /* RETURN TO MAIN RTN            */ 01802000
         B     EXITCLN                                             0686 01803000
*             END;                                                 0687 01804000
*         END;                      /* END OF VIRTUAL LOGIC          */ 01805000
@RF00683 DS    0H                                                  0689 01806000
*     END;                          /* END OF WKATRAIL=0 LOGIC       */ 01807000
*   ELSE                            /* AUDIT TRAIL BIT SET     YM5757*/ 01808000
*     GOTO ESTENTA;                 /* GO TEST WHICH BIT       YM5757*/ 01809000
*                                                                  0690 01810000
*/* THE FOLLOWING DSECT FORMATS THE THREE ENTRY POINTS INTO THE DYN  */ 01811000
*/* BUFFERING MODULE WHICH MAY BE TAKEN BY THE CLEANUP SUBROUTINE.   */ 01812000
*/* THE DYN BUF MOD IS ENTERED AT OFFSET 8,12, OR 16 FROM REGISTER 15*/ 01813000
*/* WHICH IS THE BRANCHING REGISTER AND BASE FOR THE DYN BUF MOD.    */ 01814000
*                                                                  0691 01815000
*   DCL                                                            0691 01816000
*    (DYNBUF,                                                      0691 01817000
*     ESTENT0,                                                     0691 01818000
*     ESTENTAA,                                                    0691 01819000
*     ESTENTBB)                     /* DSECT FOR DYN BUF             */ 01820000
*         LABEL LOCAL GEND;         /* MODULES ENTRY POINTS          */ 01821000
*   GEN DATA;                                                      0692 01822000
*   GEN REFS(DYNBUF);                                              0693 01823000
*                                                                  0693 01824000
        USING DYNBUF,GPR15P            SET UP ADDRESSABILITY TO DSECT   01825000
*                                      MAPPING DYN BUF MOD ENTRY PTS    01826000
*/*    ENTRY AT BEGINNING OF DYNAMIC BUF MODULE IF WKATRAIL = 0      */ 01827000
*/*    AND IT IS DETERMINED THAT NO FIELDS WERE CHANGED              */ 01828000
*                                                                  0694 01829000
*ESTENT:                                                           0694 01830000
*   ;                               /* ENTER AT TOP OF MOD     YM7563*/ 01831000
ESTENT   DS    0H                                                  0695 01832000
*   RFY                                                            0695 01833000
*     GPR14P RSTD;                                                 0695 01834000
*   GPR14P=ADDR(EXITCLNA);          /* EST RET ADDR FROM DYN BUF     */ 01835000
         LA    GPR14P,EXITCLNA                                     0696 01836000
*   GOTO ESTENT0;                   /* BR TO BEGINNING OF DYN BUF    */ 01837000
         B     ESTENT0                                             0697 01838000
*   RFY                                                            0698 01839000
*     GPR14P UNRSTD;                                               0698 01840000
*                                                                  0698 01841000
*/*      ENTRY AT ESTENTA IN DYN BUF MOD IF WKATRAIL = WKAIOBQ       */ 01842000
*                                                                  0699 01843000
*ESTENTA:                                                          0699 01844000
*   IF WKAIOBQ='1'B THEN            /* CHPGM SET UP FOR NEXT IOB     */ 01845000
ESTENTA  TM    WKAIOBQ(GPR05P),B'10000000'                         0699 01846000
         BNO   @RF00699                                            0699 01847000
*     DO;                           /* YES,OFFSET OF 12 IN DYNBUF    */ 01848000
*       WKAREG14=ADDR(EXITCLNA);    /* RET ADDR FOR DYN BUF RTN      */ 01849000
         LA    @14,EXITCLNA                                        0701 01850000
         ST    @14,WKAREG14(,GPR05P)                               0701 01851000
*       GOTO ESTENTAA;              /* BR TO THIS ENTRY IN DYNBUF    */ 01852000
         B     ESTENTAA                                            0702 01853000
*     END;                                                         0703 01854000
*                                                                  0703 01855000
*/*  ENTRY AT ESTENTB IN DYN BUF MOD IF WKATRAIL = WKABUFAS          */ 01856000
*                                                                  0704 01857000
*ESTENTB:                                                          0704 01858000
*   IF WKABUFAS='1'B THEN           /* BUFFER ASSIGNED BUT EXCP      */ 01859000
@RF00699 DS    0H                                                  0704 01860000
ESTENTB  TM    WKABUFAS(GPR05P),B'01000000'                        0704 01861000
         BNO   @RF00704                                            0704 01862000
*     DO;                           /* HAS NOT BEEN ISSUED YET       */ 01863000
*       WKAREG14=ADDR(EXITCLNA);    /* RET ADDR FOR DYN BUF RTN      */ 01864000
         LA    @14,EXITCLNA                                        0706 01865000
         ST    @14,WKAREG14(,GPR05P)                               0706 01866000
*       GOTO ESTENTBB;              /* BR TO THIS ENTRY IN DYNBUF    */ 01867000
         B     ESTENTBB                                            0707 01868000
*     END;                                                         0708 01869000
*   ELSE                            /* AUDIT TRAIL BIT INVALID       */ 01870000
*     WKACLEAN=CLEANRC1(4);         /* SET CLEAN UP CODE TO 4        */ 01871000
@RF00704 MVC   WKACLEAN(1,GPR05P),CLEANRC1+3                       0709 01872000
*   GOTO EXITCLN;                   /* RETURN TO MAIN RTN            */ 01873000
         B     EXITCLN                                             0710 01874000
*   RFY                                                            0711 01875000
*    (GPR00P,                                                      0711 01876000
*     GPR01P,                                                      0711 01877000
*     GPR02P,                                                      0711 01878000
*     GPR03P,                                                      0711 01879000
*     GPR04P,                                                      0711 01880000
*     GPR06P)UNRSTD;                                               0711 01881000
*                                                                  0711 01882000
*/*THE FOLLOWING ROUTINE SETS UP FOR RETURN FROM THE CLEANUP SUBRTN. */ 01883000
*/*IF THIS ROUTINE IS ENTERED THE SECONDARY ESTAE WAS NOT ENTERED.   */ 01884000
*/*THE SECONDARY ESTAE IS THEREFORE DELETED AND REGISTER 15 IS ZEROED*/ 01885000
*/*TO INDICATE TO THE MAIN ROUTINE THAT THE SECONDARY ESTAE HAS BEEN */ 01886000
*/*RELEASED. UPON ENTRY THE SVRB BASE IS STILL GPR05P.               */ 01887000
*                                                                  0712 01888000
*EXITCLNA:                                                         0712 01889000
*   ;                               /* ENTRY FROM DYN BUF MOD        */ 01890000
EXITCLNA DS    0H                                                  0713 01891000
*   DO;                             /* MODESET EXTKEY(SUPR)          */ 01892000
*     SPKA(0);                      /* SET PSW KEY                   */ 01893000
         SR    @14,@14                                             0714 01894000
         SPKA  0(@14)                                              0714 01895000
*   END;                            /* MODESET EXTKEY(SUPR)          */ 01896000
*                                   /* RETURN TO SUPERVISOR KEY IN 0716 01897000
*                                      CASE NOT ALREADY              */ 01898000
*   SDWAPTR=WKASVREG;               /* GET SDWA IN SVRB        YM7568*/ 01899000
         L     SDWAPTR,WKASVREG(,GPR05P)                           0716 01900000
*   RFY                                                            0717 01901000
*     SDWA BASED(SDWAPTR);          /* REEST SDWA ADDRESS      YM7568*/ 01902000
*   RFY                                                            0718 01903000
*    (GPR01P,                                                      0718 01904000
*     GPR14P)RSTD;                  /*                         YM7568*/ 01905000
*   LM(GPR01P,GPR14P,SAVESDWA);     /* RESTORE MAIN REGS       YM7568*/ 01906000
         LM    GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0719 01907000
*   RFY                                                            0720 01908000
*    (GPR01P,                                                      0720 01909000
*     GPR14P)UNRSTD;                /* RELEASE REGS            YM7568*/ 01910000
*   RFY                                                            0721 01911000
*     RBBASIC BASED(RBSECPTR);      /* ESTAE REGS-SVRB BAS     YM7568*/ 01912000
*   WKACLEAN=CLEANRC1(2);           /* SET CLEANUP RC-OK             */ 01913000
         MVC   WKACLEAN(1,RBSECPTR),CLEANRC1+1                     0722 01914000
*   GOTO REMEST;                    /* GO REMOVE ESTAE         YM7568*/ 01915000
         B     REMEST                                              0723 01916000
*EXITCLN:                                                          0724 01917000
*   ;                               /* RETURN TO MAIN ROUTINE        */ 01918000
EXITCLN  DS    0H                                                  0725 01919000
*   RFY                                                            0725 01920000
*     RBBASIC BASED(GPR05P);        /* ON ENTRY R5=RB PTR      YM7568*/ 01921000
*   SDWAPTR=WKASVREG;               /* GET SDWA SAVED IN SVRB        */ 01922000
         L     SDWAPTR,WKASVREG(,GPR05P)                           0726 01923000
*   RFY                                                            0727 01924000
*     SDWA BASED(SDWAPTR);          /* REEST SDWA ADDRESSABILITY     */ 01925000
*   RFY                                                            0728 01926000
*    (GPR01P,                                                      0728 01927000
*     GPR14P)RSTD;                  /* RESTRICT REGS           YM7568*/ 01928000
*   LM(GPR01P,GPR14P,SAVESDWA);     /* RESTORE MAINLINE REGS         */ 01929000
         LM    GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0729 01930000
*   RFY                                                            0730 01931000
*    (GPR01P,                                                      0730 01932000
*     GPR14P)UNRSTD;                /* RELEASE REGS            YM7568*/ 01933000
*   RFY                                                            0731 01934000
*     RBBASIC BASED(RBSECPTR);      /* ESTAE REGS-SVRB BAS     YM7568*/ 01935000
*                                                                  0731 01936000
*/*      REMOVE SECOND ESTAE SO AS NOT TO GO TO THE BACKUP           */ 01937000
*                                                                  0732 01938000
*REMEST:                                                           0732 01939000
*   ;                               /* REMOVE THE ESTAE        YM7568*/ 01940000
REMEST   DS    0H                                                  0733 01941000
*   GEN(ESTAE 0);                   /* DELETE SECONDARY ESTAE        */ 01942000
         ESTAE 0                                                        01943000
*   RFY                                                            0734 01944000
*    (GPR14P,                                                      0734 01945000
*     GPR15P)RSTD;                  /* RESTR RET REGS          YM7568*/ 01946000
*   GPR14P=WKARETRN;                /* RESTORE RETURN ADDR           */ 01947000
         L     GPR14P,WKARETRN(,RBSECPTR)                          0735 01948000
*   GPR15P=0;                       /* ZERO REGISTER 15              */ 01949000
         SR    GPR15P,GPR15P                                       0736 01950000
*   END CLEANUP;                    /* RETURN TO MAIN ROUTINE        */ 01951000
@EL00005 DS    0H                                                  0737 01952000
@EF00005 DS    0H                                                  0737 01953000
@ER00005 BR    @14                                                 0737 01954000
*   RFY                                                            0738 01955000
*    (GPR14P,                                                      0738 01956000
*     GPR15P)UNRSTD;                /* RELEASE RETURN REGS     YM7568*/ 01957000
*                                                                  0739 01958000
*/********************************************************************/ 01959000
*/*  THE FOLLOWING ROUTINE IS THE SECOND LEVEL ESTAE FOR IGCT005G.   */ 01960000
*/*  IT IS ENTERED ONLY IF AN ERROR OCCURS DURING THE PROCESSING OF  */ 01961000
*/*  THE CLEANUP ROUTINE.  IT WILL EXECUTE MANY OF THE FUNCTIONS OF  */ 01962000
*/*  THE FIRST LEVEL ESTAE, BUT WILL DO NO VALIDATION OR CLEANUP.ITS */ 01963000
*/*  PRIMARY FUNCTION IS TO RETURN CONTROL TO THE PRIMARY ESTAE AFTER*/ 01964000
*/*  RECORDING THAT A SECONDARY ESTAE WAS ENTERED.                   */ 01965000
*/*                     INPUT PARM: SDWA(NEW FOR THIS ESTAE) ADDRESS */ 01966000
*/*                                 SDWA(FOR PRIMARY ESTAE) WHICH    */ 01967000
*/*                                   CONTAINS SVRB ADDR FOR SVC 57  */ 01968000
*/********************************************************************/ 01969000
*                                                                  0739 01970000
*BACKUP5G:                                                         0739 01971000
*   ENTRY;                          /* SECOND LEVEL ESTAE FUNCT      */ 01972000
@EP00739 DS    0H                                                  0739 01973000
@EC00739 DS    0H                                                  0740 01974000
*   GEN(STM @14,@12,12(@13));       /* ST REGS IN 2ND RTM     SAVAREA*/ 01975000
         STM @14,@12,12(@13)                                            01976000
*   RFY                                                            0741 01977000
*     GPR01P RSTD;                  /* INPUT,RETRY                   */ 01978000
*   SDWAPTR=GPR01P;                 /* GET ADDRESS OF SDWA           */ 01979000
         LR    SDWAPTR,GPR01P                                      0742 01980000
*   SDWASR15=CLEANERR;              /* RC=4(TESTED BY 1ST LEVEL ON 0743 01981000
*                                      RET FROM CLEANUP INDICATES  0743 01982000
*                                      ENTRY INTO 2ND LEVEL ESTAE    */ 01983000
         MVC   SDWASR15(4,SDWAPTR),@CF00096                        0743 01984000
*   SDWACSCT='IGCT005G';            /* PUT CSECT ID IN SDWA          */ 01985000
         MVC   SDWACSCT(8,SDWAPTR),@CC03338                        0744 01986000
*   SDWAREXN='BACKUP5G';            /* PUT ESTAE ID IN SDWA          */ 01987000
         MVC   SDWAREXN(8,SDWAPTR),@CC03549                        0745 01988000
*   GPR01P=SDWAPARM;                /* GET OLD SDWA IN REG 1,PASSED     01989000
*                                      AS PARM IN NEW SDWA ( WILL USE   01990000
*                                      OLD SDWA FOR USERRTN1       0746 01991000
*                                      PROCESSING)                   */ 01992000
         L     GPR01P,SDWAPARM(,SDWAPTR)                           0746 01993000
*   RBSECPTR=GPR01P->SDWAPARM;      /* RESTORE SVRB FROM OLD SDWA    */ 01994000
*                                                                  0747 01995000
         L     RBSECPTR,SDWAPARM(,GPR01P)                          0747 01996000
*/********************************************************************/ 01997000
*/*  ISSUE MACRO TO ANALYZE ABEND AND GIVE CONTROL TO APPROPRIATE RTN*/ 01998000
*/********************************************************************/ 01999000
*                                                                  0748 02000000
*   DO;                             /* ?IGGSTART USER(USERRTN1)    0748 02001000
*                                      SDUMP(DUMPRTN1)             0748 02002000
*                                      CLEAN(DUMPRTN1)               */ 02003000
*                                                                  0748 02004000
*/*  MACCOMP Y-2 SC1D0/SJ0204                                        */ 02005000
*/*  MACSTAT Y-2 74050/YM7586                                        */ 02006000
*/********************************************************************  02007000
*                                                                    */ 02008000
*/* THIS ROUTINE ANALYSES FLAGS IN THE SDWA TO DETERMINE             */ 02009000
*/* WHAT TYPE OF FUNCTION TO PERFORM                                 */ 02010000
*/* THE FLAG COMBINATIONS TESTED AND THE ACTIONS TAKEN ARE SUMMARIZED*/ 02011000
*/* IN THE FOLLOWING TABLE:                                          */ 02012000
*/*                                                                  */ 02013000
*/*   PREVIOUS  || CAUSE OF ERROR ENTRY                              */ 02014000
*/*  PROCESSING || MCHK/PGIO/TEXC  OTHER                             */ 02015000
*/*  ___________||________________________                           */ 02016000
*/*       *EAS  ||        C          C                               */ 02017000
*/*       *CLUP ||        C          C                               */ 02018000
*/*       *STAF ||        S          S                               */ 02019000
*/*       *PERC ||        C          U                               */ 02020000
*/*       *NRBE ||        C          U                               */ 02021000
*/*        NONE ||        C          U                               */ 02022000
*/*                                                                  */ 02023000
*/*       * THESE BITS ARE NOT ALL MUTUALLY EXCLUSIVE. THEY ARE      */ 02024000
*/*         TESTED IN THE ORDER LISTED.                              */ 02025000
*/*                                                                  */ 02026000
*/*       FUNCTIONS TO BE PERFORMED:                                 */ 02027000
*/*                                                                  */ 02028000
*/* C (DUMPRTN1)--CLEAN UP RESOURCES AND PERCOLATE ERROR             */ 02029000
*/*                                                                  */ 02030000
*/* S (DUMPRTN1)--PREVIOUS RECOVERY ROUTINE FAILED.                  */ 02031000
*/* TAKE A DUMP FOR IT, THEN TREAT AS C                              */ 02032000
*/*                                                                  */ 02033000
*/* U (USERRTN1)--VALIDATE USER INPUT. IF IT IS IN ERROR,            */ 02034000
*/* TAKE PROBLEM DETERMINATION ACTIONS AND THEN CLEAN UP.            */ 02035000
*/* IF IT IS VALID, ASSUME A SYSTEM ERROR IN COVERED FUNCTION.       */ 02036000
*/* TAKE A DUMP, THEN TREAT AS C                                     */ 02037000
*/********************************************************************  02038000
*                                                                    */ 02039000
*                                                                  0749 02040000
*     IF SDWAEAS='1'B               /* LOWER ESTAE ALREADY DUMPED    */ 02041000
*         |SDWACLUP='1'B THEN       /* OR RTM SAYS CLEANUP           */ 02042000
         TM    SDWAEAS(SDWAPTR),B'00001000'                        0749 02043000
         BO    @RT00749                                            0749 02044000
         TM    SDWACLUP(SDWAPTR),B'10000000'                       0749 02045000
         BO    @RT00749                                            0749 02046000
*       GOTO DUMPRTN1;              /* GO CLEAN UP & GET OUT         */ 02047000
*     IF SDWASTAF='1'B THEN         /* A LOWER LEVEL ESTAE/FRR       */ 02048000
         TM    SDWASTAF(SDWAPTR),B'10000000'                       0751 02049000
         BO    @RT00751                                            0751 02050000
*       GOTO DUMPRTN1;              /* WAS EXECUTING AND FAILED      */ 02051000
*                                   /* TAKE A DUMP FOR IT            */ 02052000
*     IF SDWATEXC='1'B              /* SOME NON-PROGRAM TYPE         */ 02053000
*         |SDWAPGIO='1'B            /* ERROR HAS OCCURRED            */ 02054000
*         |SDWAMCHK='1'B THEN       /* GO CLEAN UP & GET OUT         */ 02055000
         TM    SDWATEXC(SDWAPTR),B'10000011'                       0753 02056000
         BNZ   @RT00753                                            0753 02057000
*       GOTO DUMPRTN1;                                             0754 02058000
*     GOTO USERRTN1;                /* CHECK USER INPUT              */ 02059000
*                                                                  0755 02060000
         B     USERRTN1                                            0755 02061000
*/********************************************************************  02062000
*                                                                    */ 02063000
*                                                                  0756 02064000
*   END;                                                           0756 02065000
*                                                                  0756 02066000
*/********************************************************************/ 02067000
*/*  THE USERRTN1 RECEIVES CONTROL IF IT IS DETERMINED THAT A PROGRAM*/ 02068000
*/*  CHECK OCCURRED DURING CLEANUP, OR A LOWER RB OR ESTAE CALLED    */ 02069000
*/*  RTM OR ISSUED AN ABEND.  THIS ROUTINE WILL ISSUE A SETRP        */ 02070000
*/*  TO RETRY BY RETURNING TO THE FIRST LEVEL ESTAE AT THE POINT     */ 02071000
*/*  WHERE THE CLEANUP ROUTINE WAS CALLED.  THIS ADDRESS WAS STORED  */ 02072000
*/*  IN THE SVRB WORKAREA AT WKARETRN BY THE CLEANUP SUBROUTINE.     */ 02073000
*/********************************************************************/ 02074000
*                                                                  0757 02075000
*USERRTN1:                                                         0757 02076000
*   ;                               /* PGM CHK OCCURRED IN CLEAN     */ 02077000
USERRTN1 DS    0H                                                  0758 02078000
*   SDWASRSV(5:4+LENGTH(SAVESDWA))=GPR01P->SAVESDWA;/* PUT REGS 1-14,   02079000
*                                      WHICH WERE LAST SAVED IN OLD     02080000
*                                      SDWA, BY EITHER DEBCHECK OR 0758 02081000
*                                      CLEANUP ROUTINE, INTO NEW SDWA   02082000
*                                      AT LABEL SDWASRSV+4- THIS   0758 02083000
*                                      ENSURES ALL RESTRICTED REGS 0758 02084000
*                                      WILL BE SAME ON RETURN TO   0758 02085000
*                                      PRIMARY ESTAE. NO OTHER REGS     02086000
*                                      ARE NECESSARY EXCEPT FOR    0758 02087000
*                                      MAINTENANCE PURPOSES.         */ 02088000
         MVC   SDWASRSV+4(56,SDWAPTR),SAVESDWA(GPR01P)             0758 02089000
*   DO;                             /* SETRP                       0759 02090000
*                                      RETADDR(WKARETRN->EST2RET)  0759 02091000
*                                      DUMP(NO) RECORD(YES) RC(4)  0759 02092000
*                                      FRESDWA(YES) RETREGS(YES)   0759 02093000
*                                      REGS(14)                      */ 02094000
*     RESPECIFY                                                    0760 02095000
*      (GPR00P,                                                    0760 02096000
*       GPR01P,                                                    0760 02097000
*       GPR14P,                                                    0760 02098000
*       GPR15P)RSTD;                                               0760 02099000
*     GPR01P->SDWARCDE=4;           /* STORE RC INTO SDWA            */ 02100000
         MVI   SDWARCDE(GPR01P),X'04'                              0761 02101000
*     GPR01P->SDWARTYA=ADDR(WKARETRN->EST2RET);/* SAVE RETRY ADDRESS */ 02102000
         MVC   SDWARTYA(4,GPR01P),WKARETRN(RBSECPTR)               0762 02103000
*     GPR01P->SDWAFREE='1'B;        /* SET FLAG TO FREE SDWA         */ 02104000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 02105000
         OI    SDWAFREE(GPR01P),B'10000100'                        0764 02106000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 02107000
         NI    SDWAREQ(GPR01P),B'01111111'                         0765 02108000
*     GPR01P->SDWAUPRG='1'B;        /* TURN ON RETREGS INDICATOR     */ 02109000
         OI    SDWAUPRG(GPR01P),B'00001000'                        0766 02110000
*     GEN(RETURN (14));                                            0767 02111000
         RETURN (14)                                                    02112000
*     RESPECIFY                                                    0768 02113000
*      (GPR00P,                                                    0768 02114000
*       GPR01P,                                                    0768 02115000
*       GPR14P,                                                    0768 02116000
*       GPR15P)UNRSTD;                                             0768 02117000
*   END;                            /* RETURN TO MAIN RTN            */ 02118000
*   RFY                                                            0770 02119000
*     GPR01P UNRSTD;                /* RELEASE RETURN REG AND OLD  0770 02120000
*                                      SDWA PTR-THATS ALL FOLKS      */ 02121000
*                                                                  0770 02122000
*/********************************************************************/ 02123000
*/* THE DUMPRTN2 RECEIVES CONTROL IF IT IS DETERMINED THAT OTHER     */ 02124000
*/* THAN A PROGRAM CHECK OCCURRED IN THE CLEANUP ROUTINE. THIS ESTAE */ 02125000
*/* WILL ATTEMPT NO FURTHER ERROR ANALYSIS. IT WILL TAKE A SYSTEM    */ 02126000
*/* DUMP, ASSUMING A SYSTEM ERROR, RECORD THE ERROR AND RETURN TO RTM*/ 02127000
*/* FOR PERCOLATION. THE FIRST LEVEL ESTAE WILL NOT RECEIVE CONTROL. */ 02128000
*/********************************************************************/ 02129000
*                                                                  0771 02130000
*DUMPRTN1:                                                         0771 02131000
*   ;                               /* MUST BE A SYSTEM ERROR        */ 02132000
DUMPRTN1 DS    0H                                                  0772 02133000
*   CALL SDUMP;                     /* GO TAKE SVC DUMP              */ 02134000
         BAL   @14,SDUMP                                           0772 02135000
*   MESSAGE=SYSER;                  /* SET UP WTP MESSAGE            */ 02136000
         MVC   MESSAGE(52,SDWAPTR),SYSER                           0773 02137000
*   RETCOD2=CLEANRC2(1);            /* CLEANUP RC -BAD CLEANUP       */ 02138000
         MVC   RETCOD2(2,SDWAPTR),CLEANRC2                         0774 02139000
*   RETCOD=DUMPRC(WKADUMP/RCDIV);   /* MV DUMP RC INTO MESSAGE       */ 02140000
         SR    @12,@12                                             0775 02141000
         IC    @12,WKADUMP(,RBSECPTR)                              0775 02142000
         SRL   @12,2                                               0775 02143000
         AR    @12,@12                                             0775 02144000
         LA    @06,DUMPRC-2(@12)                                   0775 02145000
         MVC   RETCOD(2,SDWAPTR),0(@06)                            0775 02146000
*   MSGJOB=TIOCNJOB;                /* MV IN JOB NAME                */ 02147000
         L     @12,PSATOLD                                         0776 02148000
         L     @12,TCBTIO(,@12)                                    0776 02149000
         MVC   MSGJOB(8,SDWAPTR),TIOCNJOB(@12)                     0776 02150000
*   MSGSTEP=TIOCSTEP;               /* MV IN STEP NAME               */ 02151000
*                                                                  0777 02152000
         MVC   MSGSTEP(8,SDWAPTR),TIOCSTEP(@12)                    0777 02153000
*/* MUST VALIDATE THE TIOT ENTRY BEFORE GETTING DDNAME FOR MESSAGE.  */ 02154000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 02155000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 02156000
*/* CHECKED FIRST.                                                   */ 02157000
*                                                                  0778 02158000
*   CALL DEBCHECK;                  /* GO VALIDATE THE DEB           */ 02159000
         BAL   @14,DEBCHECK                                        0778 02160000
*   RFY                                                            0779 02161000
*     DEBBASIC BASED(WKADEB);       /* VALID DEB PASSED IN SVRB      */ 02162000
*   IF WKADEBRC=0 THEN              /* IF DEB RET CODE=0,DEB OK      */ 02163000
         CLI   WKADEBRC(RBSECPTR),0                                0780 02164000
         BNE   @RF00780                                            0780 02165000
*     MSGDDN=TIOEDDNM;              /* MV DDNAME INTO GTF BUFFER     */ 02166000
         SR    @12,@12                                             0781 02167000
         ICM   @12,7,WKADEB(RBSECPTR)                              0781 02168000
         L     @12,DEBAPPAD(,@12)                                  0781 02169000
         L     @12,DEBXTNP(,@12)                                   0781 02170000
         L     @12,DEBXDSAB(,@12)                                  0781 02171000
         L     @12,DSABTIOT(,@12)                                  0781 02172000
         MVC   MSGDDN(8,SDWAPTR),TIOEDDNM(@12)                     0781 02173000
*   ELSE                            /* IF DEB BAD,MUST DUMMY DDN     */ 02174000
*     MSGDDN=NODDNAME;              /* ASSIGN DDN AS ASTERISKS       */ 02175000
         B     @RC00780                                            0782 02176000
@RF00780 MVC   MSGDDN(8,SDWAPTR),NODDNAME                          0782 02177000
*   DO;                             /* WTOP MF(E,MESSAGE)            */ 02178000
@RC00780 DS    0H                                                  0784 02179000
*     RFY                                                          0784 02180000
*       GPR01P RSTD;                /* RESTRICT REG 1                */ 02181000
*     GPR01P=ADDR(MESSAGE);         /* ADDRESS CONTROL PROGRAM LIST  */ 02182000
         LA    GPR01P,MESSAGE(,SDWAPTR)                            0785 02183000
*     SVC(35);                      /* ISSUE WTO SVC                 */ 02184000
         SVC   35                                                  0786 02185000
*     RFY                                                          0787 02186000
*       GPR01P UNRSTD;              /* RELEASE REG 1                 */ 02187000
*   END;                            /* WTOP MF(E,MESSAGE)            */ 02188000
*                                   /* ISSUE WTP                     */ 02189000
*RECORD1A:                                                         0789 02190000
*   CALL RECORD;                    /* GO PUT RECORD INFO IN SDWA    */ 02191000
RECORD1A BAL   @14,RECORD                                          0789 02192000
*   DO;                             /* SETRP RECORD(YES)           0790 02193000
*                                      COMPCOD(ERRSYS) REGS(14,12) 0790 02194000
*                                      WKAREA(SDWAPTR) DUMP(NO)      */ 02195000
*     RESPECIFY                                                    0791 02196000
*      (GPR00P,                                                    0791 02197000
*       GPR01P,                                                    0791 02198000
*       GPR14P,                                                    0791 02199000
*       GPR15P)RSTD;                                               0791 02200000
*     GPR01P=SDWAPTR;                                              0792 02201000
         LR    GPR01P,SDWAPTR                                      0792 02202000
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */ 02203000
         MVI   SDWARCDE(GPR01P),X'00'                              0793 02204000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 02205000
         OI    SDWARCRD(GPR01P),B'10000000'                        0794 02206000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 02207000
         NI    SDWAREQ(GPR01P),B'01111111'                         0795 02208000
*     GPR14P=ERRSYS;                /* ACCESS COMPLETION CODE        */ 02209000
         SR    GPR14P,GPR14P                                       0796 02210000
         ICM   GPR14P,7,ERRSYS                                     0796 02211000
*     GPR01P->SDWACMPC=GPR14P;      /* STORE COMPLETION CODE         */ 02212000
         STCM  GPR14P,7,SDWACMPC(GPR01P)                           0797 02213000
*     GEN(RETURN (14,12));                                         0798 02214000
         RETURN (14,12)                                                 02215000
*     RESPECIFY                                                    0799 02216000
*      (GPR00P,                                                    0799 02217000
*       GPR01P,                                                    0799 02218000
*       GPR14P,                                                    0799 02219000
*       GPR15P)UNRSTD;                                             0799 02220000
*   END;                            /* DIAGNOSTIC INFO.TO BE PUT OUT    02221000
*                                      ON SYSTEM DATA SET            */ 02222000
*                                                                  0800 02223000
*/********************************************************************/ 02224000
*                                                                  0801 02225000
*   END IGCT005G                    /* END OF 1ST LEVEL ESTAE        */ 02226000
*                                                                  0801 02227000
*/********************************************************************/ 02228000
*                                                                  0801 02229000
*                                                                  0801 02230000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 02231000
*/*%INCLUDE SYSLIB  (IGGBCB  )                                       */ 02232000
*/*%INCLUDE SYSLIB  (CVT     )                                       */ 02233000
*/*%INCLUDE SYSLIB  (IHADCBDF)                                       */ 02234000
*/*%INCLUDE SYSLIB  (IHADCB  )                                       */ 02235000
*/*%INCLUDE SYSLIB  (IEZDEB  )                                       */ 02236000
*/*%INCLUDE SYSLIB  (IHADECB )                                       */ 02237000
*/*%INCLUDE SYSLIB  (IHADSAB )                                       */ 02238000
*/*%INCLUDE SYSLIB  (IEZIOB  )                                       */ 02239000
*/*%INCLUDE SYSLIB  (IHAPSA  )                                       */ 02240000
*/*%INCLUDE SYSLIB  (IHARB   )                                       */ 02241000
*/*%INCLUDE SYSLIB  (IEZXRB  )                                       */ 02242000
*/*%INCLUDE SYSLIB  (IKJRB   )                                       */ 02243000
*/*%INCLUDE SYSLIB  (IGGFRWKA)                                       */ 02244000
*/*%INCLUDE SYSLIB  (IGGSPD  )                                       */ 02245000
*/*%INCLUDE SYSLIB  (IHASDWA )                                       */ 02246000
*/*%INCLUDE SYSLIB  (IKJTCB  )                                       */ 02247000
*/*%INCLUDE SYSLIB  (IEFTIOT1)                                       */ 02248000
*/*%INCLUDE SYSLIB  (IGGUSL  )                                       */ 02249000
*                                                                  0801 02250000
*       ;                                                          0801 02251000
@EL00001 L     @13,4(,@13)                                         0801 02252000
@EF00001 DS    0H                                                  0801 02253000
@ER00001 BR    @14                                                 0801 02254000
@DATA    DS    0H                                                       02255000
@CH03559 DC    H'-87'                                                   02256000
@CH03560 DC    H'-27'                                                   02257000
@CH03561 DC    H'-1'                                                    02258000
@CH00083 DC    H'1'                                                     02259000
@CH00091 DC    H'2'                                                     02260000
@CH00107 DC    H'3'                                                     02261000
@CH03569 DC    H'22'                                                    02262000
@CH02596 DC    H'28'                                                    02263000
@CH03567 DC    H'34'                                                    02264000
@CH01980 DC    H'64'                                                    02265000
@DATD    DSECT                                                          02266000
         DS    0F                                                       02267000
@SA00001 DS    18F                                                      02268000
IGCT005G CSECT                                                          02269000
         DS    0F                                                       02270000
@CF00096 DC    F'4'                                                     02271000
@CF03562 DC    F'58880'                                                 02272000
@DATD    DSECT                                                          02273000
         DS    0D                                                       02274000
DEBPTR   DS    A                                                        02275000
IOBSTPTR DS    A                                                        02276000
IGCT005G CSECT                                                          02277000
         DS    0F                                                       02278000
@SIZDATD DC    AL1(0)                                                   02279000
         DC    AL3(@ENDDATD-@DATD)                                      02280000
         DS    0D                                                       02281000
DEBKEY   DC    XL1'50'                                                  02282000
SCHEDKEY DC    AL1(16)                                                  02283000
@CC03338 DC    C'IGCT005G'                                              02284000
@CC03549 DC    C'BACKUP5G'                                              02285000
HEADING  DS    CL27                                                     02286000
         ORG   HEADING                                                  02287000
@NM00173 DC    AL1(26)                                                  02288000
HEADTEXT DC    CL26'IGCT005G,        ,        '                         02289000
         ORG   HEADING+27                                               02290000
         DS    CL1                                                      02291000
PATCH    DS    CL150                                                    02292000
         ORG   PATCH                                                    02293000
PATCHID  DC    CL8'IGCT005G'                                            02294000
PATCHIT  DC    142CL1'*'                                                02295000
         ORG   PATCH+150                                                02296000
ERRSYS   DC    X'139000'                                                02297000
GTON     DC    CL1'8'                                                   02298000
GTOFF    DC    CL1'0'                                                   02299000
NODDNAME DC    CL8'********'                                            02300000
         DS    CL3                                                      02301000
USERER   DS    CL52                                                     02302000
         ORG   USERER                                                   02303000
USERER01 DC    H'48'                                                    02304000
USERER02 DC    B'1000000000000000'                                      02305000
USERER03 DC    CL44'IEC904I 239,00,00,        ,        ,        '       02306000
USERER04 DC    B'0000010000000000'                                      02307000
USERER05 DC    B'0000000000100000'                                      02308000
         ORG   USERER+52                                                02309000
SYSER    DS    CL52                                                     02310000
         ORG   SYSER                                                    02311000
SYSER01  DC    H'48'                                                    02312000
SYSER02  DC    B'1000000000000000'                                      02313000
SYSER03  DC    CL44'IEC905I 139,00,00,        ,        ,        '       02314000
SYSER04  DC    B'0000010000000000'                                      02315000
SYSER05  DC    B'0000000000100000'                                      02316000
         ORG   SYSER+52                                                 02317000
DUMPRC   DC    CL2'04'                                                  02318000
         DC    CL2'08'                                                  02319000
         DC    CL2'0C'                                                  02320000
CLEANRC1 DC    AL1(1)                                                   02321000
         DC    AL1(2)                                                   02322000
         DC    AL1(3)                                                   02323000
         DC    AL1(4)                                                   02324000
CLEANRC2 DC    CL2'01'                                                  02325000
         DC    CL2'02'                                                  02326000
         DC    CL2'03'                                                  02327000
         DC    CL2'04'                                                  02328000
BLKERR1  DC    AL1(1)                                                   02329000
         DC    AL1(2)                                                   02330000
         DC    AL1(3)                                                   02331000
         DC    AL1(4)                                                   02332000
         DC    AL1(5)                                                   02333000
         DC    AL1(0)                                                   02334000
BLKERR2  DC    CL1'1'                                                   02335000
         DC    CL1'2'                                                   02336000
         DC    CL1'3'                                                   02337000
         DC    CL1'4'                                                   02338000
         DC    CL1'5'                                                   02339000
         DC    CL1'0'                                                   02340000
BLKERR3  DC    AL1(1)                                                   02341000
         DC    AL1(130)                                                 02342000
         DC    AL1(131)                                                 02343000
         DC    AL1(132)                                                 02344000
         DC    AL1(133)                                                 02345000
         DC    AL1(0)                                                   02346000
IGCT005G CSECT                                                          02347000
DUMPLIST SDUMP SDATA=(PSA,NUC,SQA,RGN),MF=L                             02348000
ELIST    ESTAE BACKUP5G,RECORD=YES,MF=L                                 02349000
TRACLIST GTRACE FID=SPDFID,MF=L                                         02350000
SNAPLIST SNAP  SDATA=TRT,MF=L                                           02351000
@DATD    DSECT                                                          02352000
DYNBUF   DSECT                                                          02353000
         DS   XL8                                                       02354000
ESTENT0  NOP  0                        EST ENTRY AT +8 -FREEDBUF ENTRY  02355000
ESTENTAA NOP  0                        EST ENTRY AT +12-MIDDLE ENTRY    02356000
ESTENTBB NOP  0                        EST ENTRY AT +16-MIDDLE ENTRY    02357000
IGCT005G CSECT                                                          02358000
@DATD    DSECT                                                          02359000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                02360000
@ENDDATD EQU   *                                                        02361000
IGCT005G CSECT                                                          02362000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       02363000
@01      EQU   01                                                       02364000
@02      EQU   02                                                       02365000
@03      EQU   03                                                       02366000
@04      EQU   04                                                       02367000
@05      EQU   05                                                       02368000
@06      EQU   06                                                       02369000
@07      EQU   07                                                       02370000
@08      EQU   08                                                       02371000
@09      EQU   09                                                       02372000
@10      EQU   10                                                       02373000
@11      EQU   11                                                       02374000
@12      EQU   12                                                       02375000
@13      EQU   13                                                       02376000
@14      EQU   14                                                       02377000
@15      EQU   15                                                       02378000
GPR00F   EQU   @00                                                      02379000
GPR01F   EQU   @01                                                      02380000
GPR15F   EQU   @15                                                      02381000
GPR00P   EQU   @00                                                      02382000
GPR01P   EQU   @01                                                      02383000
GPR14P   EQU   @14                                                      02384000
GPR15P   EQU   @15                                                      02385000
GPR02P   EQU   @02                                                      02386000
GPR03P   EQU   @03                                                      02387000
GPR03F   EQU   @03                                                      02388000
GPR04P   EQU   @04                                                      02389000
GPR05P   EQU   @05                                                      02390000
GPR06P   EQU   @06                                                      02391000
GPR07P   EQU   @07                                                      02392000
GPR08P   EQU   @08                                                      02393000
GPR10P   EQU   @10                                                      02394000
GPR11P   EQU   @11                                                      02395000
GPR12P   EQU   @12                                                      02396000
GPR13P   EQU   @13                                                      02397000
TRCPTR   EQU   @02                                                      02398000
MVBLKPTR EQU   @04                                                      02399000
SDWAPTR  EQU   @05                                                      02400000
BLKCTR   EQU   @07                                                      02401000
RBSECPTR EQU   @08                                                      02402000
BASEREG  EQU   @09                                                      02403000
WRKREG   EQU   @11                                                      02404000
SAVEPTR  EQU   @13                                                      02405000
RETURNCD EQU   @15                                                      02406000
GPR14F   EQU   @14                                                      02407000
CVTPTR   EQU   16                                                       02408000
PSA      EQU   0                                                        02409000
FLCRNPSW EQU   PSA                                                      02410000
FLCROPSW EQU   PSA+8                                                    02411000
FLCICCW2 EQU   PSA+16                                                   02412000
PSAEEPSW EQU   PSA+132                                                  02413000
PSAESPSW EQU   PSA+136                                                  02414000
FLCSVILC EQU   PSAESPSW+1                                               02415000
PSAEPPSW EQU   PSA+140                                                  02416000
FLCPIILC EQU   PSAEPPSW+1                                               02417000
FLCPICOD EQU   PSAEPPSW+2                                               02418000
PSAPICOD EQU   FLCPICOD+1                                               02419000
FLCTEA   EQU   PSAEPPSW+4                                               02420000
FLCPER   EQU   PSA+152                                                  02421000
FLCMCLA  EQU   PSA+168                                                  02422000
FLCIOEL  EQU   FLCMCLA+4                                                02423000
FLCIOA   EQU   FLCMCLA+16                                               02424000
FLCFSA   EQU   FLCMCLA+80                                               02425000
PSATOLD  EQU   PSA+540                                                  02426000
PSAAOLD  EQU   PSA+548                                                  02427000
PSASUPER EQU   PSA+552                                                  02428000
PSASUP1  EQU   PSASUPER                                                 02429000
PSASUP2  EQU   PSASUPER+1                                               02430000
PSASUP3  EQU   PSASUPER+2                                               02431000
PSASUP4  EQU   PSASUPER+3                                               02432000
PSACLHT  EQU   PSA+640                                                  02433000
PSALKSA  EQU   PSA+696                                                  02434000
PSAHLHI  EQU   PSA+760                                                  02435000
PSALITA  EQU   PSA+764                                                  02436000
PSADSSFL EQU   PSA+836                                                  02437000
PSADSSF1 EQU   PSADSSFL                                                 02438000
PSADSSF3 EQU   PSADSSFL+2                                               02439000
PSADSSF4 EQU   PSADSSFL+3                                               02440000
PSARSVT  EQU   PSA+896                                                  02441000
NOBASE   EQU   0                                                        02442000
BCBLK    EQU   0                                                        02443000
BCBBUFPT EQU   BCBLK                                                    02444000
BCBFLGS  EQU   BCBLK+4                                                  02445000
BCBLRIAR EQU   BCBLK+8                                                  02446000
LRIAREA  EQU   0                                                        02447000
LRILOC   EQU   LRIAREA                                                  02448000
LRILGTH  EQU   LRILOC                                                   02449000
LRIFLG1  EQU   LRILGTH                                                  02450000
LRIFLG2  EQU   LRILOC+4                                                 02451000
LRITRKAD EQU   LRIAREA+8                                                02452000
LRINIOB  EQU   LRIAREA+16                                               02453000
LRIALIGN EQU   0                                                        02454000
BUFFER   EQU   0                                                        02455000
BCBDEFV  EQU   0                                                        02456000
BCBBFAVL EQU   BCBDEFV+8                                                02457000
BCBTBRS1 EQU   BCBDEFV+12                                               02458000
BCBDEFR  EQU   0                                                        02459000
BCBIOBS  EQU   BCBDEFR                                                  02460000
BCBFRQT  EQU   BCBIOBS                                                  02461000
BCBNABFR EQU   BCBDEFR+8                                                02462000
BCBTBRS  EQU   BCBDEFR+12                                               02463000
BCBDEFS  EQU   0                                                        02464000
CVTMAP   EQU   0                                                        02465000
CVT0VL00 EQU   CVTMAP+24                                                02466000
CVTDAR   EQU   CVTMAP+72                                                02467000
CVTFLGS1 EQU   CVTDAR                                                   02468000
CVTDCB   EQU   CVTMAP+116                                               02469000
CVTIERLC EQU   CVTMAP+144                                               02470000
CVTOPTA  EQU   CVTMAP+182                                               02471000
CVTOPTB  EQU   CVTMAP+183                                               02472000
CVTGTF   EQU   CVTMAP+236                                               02473000
CVTGTFST EQU   CVTGTF                                                   02474000
CVTGTFS  EQU   CVTGTFST                                                 02475000
CVTSTATE EQU   CVTGTFST                                                 02476000
CVTTMODE EQU   CVTGTFST                                                 02477000
CVTFORM  EQU   CVTGTFST                                                 02478000
CVTUSR   EQU   CVTGTFST                                                 02479000
CVTAQAVT EQU   CVTMAP+240                                               02480000
CVTTCMFG EQU   CVTAQAVT                                                 02481000
CVTVOLM2 EQU   CVTMAP+244                                               02482000
CVTTATA  EQU   CVTVOLM2                                                 02483000
CVTTSKS  EQU   CVTTATA                                                  02484000
CVTVOLF2 EQU   CVTTSKS                                                  02485000
CVTTAT   EQU   CVTTATA+1                                                02486000
CVTATER  EQU   CVTMAP+248                                               02487000
CVTEXT1  EQU   CVTMAP+252                                               02488000
CVTPURG  EQU   CVTMAP+260                                               02489000
CVTQMSG  EQU   CVTMAP+268                                               02490000
CVTDMSR  EQU   CVTMAP+272                                               02491000
CVTERPV  EQU   CVTMAP+316                                               02492000
CVTINTLA EQU   CVTMAP+320                                               02493000
CVTAPF   EQU   CVTMAP+324                                               02494000
CVTEXT2  EQU   CVTMAP+328                                               02495000
CVTHJES  EQU   CVTMAP+332                                               02496000
CVTPGSIA EQU   CVTMAP+348                                               02497000
CVTA1F1  EQU   CVTMAP+356                                               02498000
CVTSYSK  EQU   CVTMAP+357                                               02499000
CVTVOLM1 EQU   CVTMAP+380                                               02500000
CVTVOLF1 EQU   CVTVOLM1                                                 02501000
CVTATMCT EQU   CVTMAP+388                                               02502000
CVTXTNT1 EQU   0                                                        02503000
CVTXTNT2 EQU   0                                                        02504000
CVTDSSV  EQU   CVTXTNT2                                                 02505000
CVTRSV90 EQU   CVTXTNT2+5                                               02506000
CVTDEBVR EQU   CVTXTNT2+8                                               02507000
CVTQID   EQU   CVTXTNT2+24                                              02508000
CVTRV400 EQU   CVTXTNT2+52                                              02509000
CVTRV409 EQU   CVTXTNT2+53                                              02510000
CVTATCVT EQU   CVTXTNT2+64                                              02511000
CVTRV429 EQU   CVTXTNT2+84                                              02512000
CVTRV438 EQU   CVTXTNT2+85                                              02513000
CVTRV457 EQU   CVTXTNT2+112                                             02514000
CVTRV466 EQU   CVTXTNT2+113                                             02515000
CVTFIX   EQU   0                                                        02516000
CVTRELNO EQU   CVTFIX+252                                               02517000
IHADCB   EQU   0                                                        02518000
IHADCS00 EQU   0                                                        02519000
DCBFDAD  EQU   IHADCS00+5                                               02520000
IHADCS01 EQU   0                                                        02521000
DCBDVTBL EQU   IHADCS01                                                 02522000
IHADCS11 EQU   0                                                        02523000
DCBRELB  EQU   IHADCS11                                                 02524000
DCBREL   EQU   DCBRELB+1                                                02525000
DCBBUFCB EQU   IHADCS11+4                                               02526000
DCBDSORG EQU   IHADCS11+10                                              02527000
DCBDSRG1 EQU   DCBDSORG                                                 02528000
DCBDSRG2 EQU   DCBDSORG+1                                               02529000
DCBIOBAD EQU   IHADCS11+12                                              02530000
DCBODEB  EQU   DCBIOBAD                                                 02531000
DCBLNP   EQU   DCBODEB                                                  02532000
DCBQSLM  EQU   DCBLNP                                                   02533000
DCBIOBAA EQU   DCBODEB+1                                                02534000
IHADCS50 EQU   0                                                        02535000
DCBSVCXL EQU   IHADCS50                                                 02536000
DCBEODAD EQU   IHADCS50+4                                               02537000
DCBBFALN EQU   DCBEODAD                                                 02538000
DCBHIARC EQU   DCBBFALN                                                 02539000
DCBBFTEK EQU   DCBHIARC                                                 02540000
DCBBFT   EQU   DCBBFTEK                                                 02541000
DCBBFTKR EQU   DCBBFT                                                   02542000
DCBEXLST EQU   IHADCS50+8                                               02543000
DCBRECFM EQU   DCBEXLST                                                 02544000
DCBRECLA EQU   DCBRECFM                                                 02545000
IHADCS24 EQU   0                                                        02546000
DCBOFLGS EQU   IHADCS24+8                                               02547000
DCBOFLWR EQU   DCBOFLGS                                                 02548000
DCBOFOPN EQU   DCBOFLGS                                                 02549000
DCBIFLG  EQU   IHADCS24+9                                               02550000
DCBMACR  EQU   IHADCS24+10                                              02551000
DCBMACR1 EQU   DCBMACR                                                  02552000
DCBMRFE  EQU   DCBMACR1                                                 02553000
DCBMRGET EQU   DCBMRFE                                                  02554000
DCBMRAPG EQU   DCBMACR1                                                 02555000
DCBMRRD  EQU   DCBMRAPG                                                 02556000
DCBMRCI  EQU   DCBMACR1                                                 02557000
DCBMRMVG EQU   DCBMRCI                                                  02558000
DCBMRLCG EQU   DCBMACR1                                                 02559000
DCBMRABC EQU   DCBMACR1                                                 02560000
DCBMRPT1 EQU   DCBMRABC                                                 02561000
DCBMRSBG EQU   DCBMRPT1                                                 02562000
DCBMRCRL EQU   DCBMACR1                                                 02563000
DCBMRCHK EQU   DCBMRCRL                                                 02564000
DCBMRRDX EQU   DCBMRCHK                                                 02565000
DCBMRDMG EQU   DCBMACR1                                                 02566000
DCBMACR2 EQU   DCBMACR+1                                                02567000
DCBMRPUT EQU   DCBMACR2                                                 02568000
DCBMRWRT EQU   DCBMACR2                                                 02569000
DCBMRMVP EQU   DCBMACR2                                                 02570000
DCBMR5WD EQU   DCBMACR2                                                 02571000
DCBMRLDM EQU   DCBMR5WD                                                 02572000
DCBMRLCP EQU   DCBMRLDM                                                 02573000
DCBMR4WD EQU   DCBMACR2                                                 02574000
DCBMRPT2 EQU   DCBMR4WD                                                 02575000
DCBMRTMD EQU   DCBMRPT2                                                 02576000
DCBMR3WD EQU   DCBMACR2                                                 02577000
DCBMRCTL EQU   DCBMR3WD                                                 02578000
DCBMRSTK EQU   DCBMRCTL                                                 02579000
DCBMR1WD EQU   DCBMACR2                                                 02580000
DCBMRSWA EQU   DCBMR1WD                                                 02581000
DCBMRDMD EQU   DCBMRSWA                                                 02582000
IHADCS25 EQU   0                                                        02583000
DCBMACRF EQU   IHADCS25+2                                               02584000
DCBMACF1 EQU   DCBMACRF                                                 02585000
DCBMFFE  EQU   DCBMACF1                                                 02586000
DCBMFGET EQU   DCBMFFE                                                  02587000
DCBMFAPG EQU   DCBMACF1                                                 02588000
DCBMFRD  EQU   DCBMFAPG                                                 02589000
DCBMFCI  EQU   DCBMACF1                                                 02590000
DCBMFMVG EQU   DCBMFCI                                                  02591000
DCBMFLCG EQU   DCBMACF1                                                 02592000
DCBMFABC EQU   DCBMACF1                                                 02593000
DCBMFPT1 EQU   DCBMFABC                                                 02594000
DCBMFSBG EQU   DCBMFPT1                                                 02595000
DCBMFCRL EQU   DCBMACF1                                                 02596000
DCBMFCHK EQU   DCBMFCRL                                                 02597000
DCBMFDMG EQU   DCBMACF1                                                 02598000
DCBMACF2 EQU   DCBMACRF+1                                               02599000
DCBMFPUT EQU   DCBMACF2                                                 02600000
DCBMFWRT EQU   DCBMACF2                                                 02601000
DCBMFMVP EQU   DCBMACF2                                                 02602000
DCBMF5WD EQU   DCBMACF2                                                 02603000
DCBMFLDM EQU   DCBMF5WD                                                 02604000
DCBMFLCP EQU   DCBMFLDM                                                 02605000
DCBMF4WD EQU   DCBMACF2                                                 02606000
DCBMFPT2 EQU   DCBMF4WD                                                 02607000
DCBMFTMD EQU   DCBMFPT2                                                 02608000
DCBMF3WD EQU   DCBMACF2                                                 02609000
DCBMFCTL EQU   DCBMF3WD                                                 02610000
DCBMFSTK EQU   DCBMFCTL                                                 02611000
DCBMF1WD EQU   DCBMACF2                                                 02612000
DCBMFSWA EQU   DCBMF1WD                                                 02613000
DCBMFDMD EQU   DCBMFSWA                                                 02614000
DCBDEBAD EQU   IHADCS25+4                                               02615000
DCBIFLGS EQU   DCBDEBAD                                                 02616000
DCBDEBA  EQU   DCBDEBAD+1                                               02617000
IHADCS26 EQU   0                                                        02618000
DCBWRITE EQU   IHADCS26                                                 02619000
DCBREAD  EQU   DCBWRITE                                                 02620000
DCBWRITA EQU   DCBREAD+1                                                02621000
IHADCS30 EQU   0                                                        02622000
DCBCHECK EQU   IHADCS30                                                 02623000
DCBOPTCD EQU   DCBCHECK                                                 02624000
DCBXARG  EQU   IHADCS30+32                                              02625000
DCBDRDX  EQU   IHADCS30+36                                              02626000
DCBDYNB  EQU   IHADCS30+48                                              02627000
DEBBASIC EQU   0                                                        02628000
DEBTCBAD EQU   DEBBASIC                                                 02629000
DEBDEBAD EQU   DEBBASIC+4                                               02630000
DEBIRBAD EQU   DEBBASIC+8                                               02631000
DEBOFLGS EQU   DEBIRBAD                                                 02632000
DEBOPATB EQU   DEBBASIC+12                                              02633000
DEBFLGS1 EQU   DEBBASIC+14                                              02634000
DEBUSRPG EQU   DEBBASIC+16                                              02635000
DEBRRQ   EQU   DEBBASIC+20                                              02636000
DEBECBAD EQU   DEBRRQ                                                   02637000
DEBDCBAD EQU   DEBBASIC+24                                              02638000
DEBPROTG EQU   DEBDCBAD                                                 02639000
DEBDCBB  EQU   DEBDCBAD+1                                               02640000
DEBAPPAD EQU   DEBBASIC+28                                              02641000
DEBBASND EQU   DEBBASIC+32                                              02642000
DEBDASD  EQU   0                                                        02643000
DEBUCBAD EQU   DEBDASD                                                  02644000
DEBACSMD EQU   0                                                        02645000
DEBVOLSQ EQU   DEBACSMD                                                 02646000
DEBVOLBT EQU   DEBVOLSQ                                                 02647000
DEBDSNM  EQU   DEBACSMD+4                                               02648000
DEBUTSAA EQU   DEBDSNM                                                  02649000
DEBACS01 EQU   0                                                        02650000
DEBDSNAM EQU   DEBACS01                                                 02651000
DEBACS02 EQU   0                                                        02652000
DEBDBLK  EQU   DEBACS02                                                 02653000
DEBACS03 EQU   0                                                        02654000
DEBACS04 EQU   0                                                        02655000
DEBTBFRA EQU   DEBACS04                                                 02656000
DEBTCCWA EQU   DEBACS04+4                                               02657000
DEBACS05 EQU   0                                                        02658000
DEBFUCBA EQU   DEBACS05                                                 02659000
DEBLUCBA EQU   DEBACS05+4                                               02660000
DEBACS06 EQU   0                                                        02661000
DEBACS07 EQU   0                                                        02662000
DEBACS08 EQU   0                                                        02663000
DEBSUBNM EQU   0                                                        02664000
DEB      EQU   0                                                        02665000
DEBAVT   EQU   DEB                                                      02666000
DEBEOEA  EQU   DEBAVT                                                   02667000
DEBEOEAB EQU   DEBEOEA                                                  02668000
DEBSIOA  EQU   DEBAVT+4                                                 02669000
DEBSIOAB EQU   DEBSIOA                                                  02670000
DEBPCIA  EQU   DEBAVT+8                                                 02671000
DEBPCIAB EQU   DEBPCIA                                                  02672000
DEBCEA   EQU   DEBAVT+12                                                02673000
DEBCEAB  EQU   DEBCEA                                                   02674000
DEBXCEA  EQU   DEBAVT+16                                                02675000
DEBXCEAB EQU   DEBXCEA                                                  02676000
DEBPREFX EQU   DEB+20                                                   02677000
DEBXTNP  EQU   DEBPREFX+8                                               02678000
DEBTBLOF EQU   DEBPREFX+14                                              02679000
DEBXTN   EQU   0                                                        02680000
DEBXFLG1 EQU   DEBXTN+2                                                 02681000
DEBXDSAB EQU   DEBXTN+4                                                 02682000
DECB     EQU   0                                                        02683000
DECBPTR  EQU   DECB+4                                                   02684000
DECTYPE  EQU   DECBPTR                                                  02685000
DECTYPE1 EQU   DECTYPE                                                  02686000
DECTYPE2 EQU   DECTYPE+1                                                02687000
DECAREA  EQU   DECB+12                                                  02688000
DECNEXT  EQU   DECB+20                                                  02689000
DECBS01  EQU   0                                                        02690000
DECBECB  EQU   DECBS01                                                  02691000
DECBRB   EQU   DECBECB                                                  02692000
DECBECBF EQU   DECBRB                                                   02693000
DECBTYP1 EQU   DECBS01+4                                                02694000
DECBTYP2 EQU   DECBS01+5                                                02695000
DECBEXC1 EQU   DECBS01+24                                               02696000
DECBEXC2 EQU   DECBS01+25                                               02697000
DECBS02  EQU   0                                                        02698000
@NM00029 EQU   DECBS02                                                  02699000
DECCC2   EQU   @NM00029+1                                               02700000
DECCC3   EQU   @NM00029+2                                               02701000
@NM00031 EQU   DECBS02+4                                                02702000
@NM00032 EQU   @NM00031                                                 02703000
@NM00033 EQU   @NM00031+1                                               02704000
DECKEYS  EQU   @NM00033                                                 02705000
DECTYPRU EQU   @NM00033                                                 02706000
DECKYADR EQU   DECBS02+20                                               02707000
DECNA    EQU   DECBS02+28                                               02708000
DECBS03  EQU   0                                                        02709000
DECCPOL  EQU   DECBS03+20                                               02710000
@NM00041 EQU   DECBS03+36                                               02711000
DECBS04  EQU   0                                                        02712000
@NM00044 EQU   DECBS04+4                                                02713000
@NM00045 EQU   @NM00044                                                 02714000
@NM00048 EQU   DECBS04+8                                                02715000
DECBUFCT EQU   @NM00048                                                 02716000
DECONLTT EQU   DECBUFCT                                                 02717000
DECENTRY EQU   DECBS04+20                                               02718000
DECFLAGS EQU   DECBS04+24                                               02719000
DECWACK  EQU   DECFLAGS                                                 02720000
DECREVRS EQU   DECFLAGS                                                 02721000
DECERRST EQU   DECBS04+29                                               02722000
DECPOLPT EQU   DECBS04+36                                               02723000
DSAB     EQU   0                                                        02724000
DSABTIOT EQU   DSAB+16                                                  02725000
DSABGIDP EQU   DSAB+24                                                  02726000
DSABANMP EQU   DSAB+28                                                  02727000
DSABORG  EQU   DSAB+32                                                  02728000
DSABORG1 EQU   DSABORG                                                  02729000
DSABORG2 EQU   DSABORG+1                                                02730000
DSABFLG1 EQU   DSAB+34                                                  02731000
DSABFLG2 EQU   DSAB+35                                                  02732000
DSABFLG3 EQU   DSAB+36                                                  02733000
DSABFLG4 EQU   DSAB+37                                                  02734000
DSABANMI EQU   0                                                        02735000
DSABGIDL EQU   0                                                        02736000
IOBPREFX EQU   0                                                        02737000
IOBCFLG1 EQU   IOBPREFX                                                 02738000
IOBSTDRD EQU   0                                                        02739000
IOBFLAG1 EQU   IOBSTDRD                                                 02740000
IOBCYCCK EQU   IOBFLAG1                                                 02741000
IOBRSTRT EQU   IOBFLAG1                                                 02742000
IOBFLAG2 EQU   IOBSTDRD+1                                               02743000
IOBPURGE EQU   IOBFLAG2                                                 02744000
IOBRDHA0 EQU   IOBFLAG2                                                 02745000
IOBSENS0 EQU   IOBSTDRD+2                                               02746000
IOBS0B7  EQU   IOBSENS0                                                 02747000
IOBSENS1 EQU   IOBSTDRD+3                                               02748000
IOBECBPT EQU   IOBSTDRD+4                                               02749000
IOBFLAG3 EQU   IOBSTDRD+8                                               02750000
IOBFL3   EQU   IOBFLAG3                                                 02751000
IOBCSW   EQU   IOBSTDRD+9                                               02752000
IOBIOCSW EQU   IOBCSW                                                   02753000
IOBSTART EQU   IOBSTDRD+16                                              02754000
IOBDCBPT EQU   IOBSTDRD+20                                              02755000
IOBFLAG4 EQU   IOBDCBPT                                                 02756000
IOBRESTR EQU   IOBSTDRD+24                                              02757000
IOBINCAM EQU   IOBSTDRD+28                                              02758000
IOBBTAMF EQU   IOBINCAM                                                 02759000
RBPRFX   EQU   0                                                        02760000
RBBASIC  EQU   0                                                        02761000
RBEXRTNM EQU   RBBASIC                                                  02762000
RBTMFLD  EQU   RBEXRTNM                                                 02763000
RBSTAB   EQU   RBBASIC+10                                               02764000
XSTAB    EQU   RBSTAB                                                   02765000
RBSTAB1  EQU   XSTAB                                                    02766000
XSTAB1   EQU   RBSTAB1                                                  02767000
RBFTCKPT EQU   XSTAB1                                                   02768000
RBSTAB2  EQU   XSTAB+1                                                  02769000
XSTAB2   EQU   RBSTAB2                                                  02770000
RBTCBNXT EQU   XSTAB2                                                   02771000
RBFACTV  EQU   XSTAB2                                                   02772000
RBFDYN   EQU   XSTAB2                                                   02773000
RBECBWT  EQU   XSTAB2                                                   02774000
RBOPSW   EQU   RBBASIC+16                                               02775000
RBLINK   EQU   RBBASIC+28                                               02776000
XRBLNK   EQU   RBLINK                                                   02777000
RBWCF    EQU   XRBLNK                                                   02778000
RBLINKB  EQU   XRBLNK+1                                                 02779000
RBGRSAVE EQU   RBBASIC+32                                               02780000
XRBREG   EQU   RBGRSAVE                                                 02781000
RBGRS0   EQU   XRBREG                                                   02782000
RBGRS1   EQU   XRBREG+4                                                 02783000
RBGRS2   EQU   XRBREG+8                                                 02784000
RBGRS3   EQU   XRBREG+12                                                02785000
RBGRS4   EQU   XRBREG+16                                                02786000
RBGRS5   EQU   XRBREG+20                                                02787000
RBGRS6   EQU   XRBREG+24                                                02788000
RBGRS7   EQU   XRBREG+28                                                02789000
RBGRS8   EQU   XRBREG+32                                                02790000
RBGRS9   EQU   XRBREG+36                                                02791000
RBGRS10  EQU   XRBREG+40                                                02792000
RBGRS11  EQU   XRBREG+44                                                02793000
RBGRS12  EQU   XRBREG+48                                                02794000
RBGRS13  EQU   XRBREG+52                                                02795000
RBGRS14  EQU   XRBREG+56                                                02796000
RBGRS15  EQU   XRBREG+60                                                02797000
XRBESA   EQU   RBBASIC+96                                               02798000
RBEXSAVE EQU   XRBESA                                                   02799000
RBPREFIX EQU   0                                                        02800000
RBRSV019 EQU   RBPREFIX+14                                              02801000
RBRSV028 EQU   RBPREFIX+15                                              02802000
RBRSV041 EQU   RBPREFIX+27                                              02803000
RBRSV054 EQU   RBPREFIX+39                                              02804000
RBRTOPSW EQU   RBPREFIX+40                                              02805000
RBRTPSW2 EQU   RBRTOPSW+8                                               02806000
RBRTICIL EQU   RBRTPSW2                                                 02807000
RBFLAGS1 EQU   RBPREFIX+56                                              02808000
RBINTCDA EQU   RBPREFIX+61                                              02809000
RBSECT   EQU   0                                                        02810000
RBPPSAV  EQU   RBSECT                                                   02811000
@NM00088 EQU   RBSECT+10                                                02812000
@NM00089 EQU   @NM00088                                                 02813000
RBTRSVRB EQU   @NM00089                                                 02814000
@NM00091 EQU   @NM00088+1                                               02815000
RBETXR   EQU   @NM00091                                                 02816000
RBEP     EQU   RBSECT+12                                                02817000
RBPGMQ   EQU   RBSECT+24                                                02818000
@NM00098 EQU   RBSECT+28                                                02819000
IRBEND   EQU   RBSECT+96                                                02820000
@NM00102 EQU   RBSECT+96                                                02821000
RBRSV138 EQU   @NM00102+7                                               02822000
RBRSV150 EQU   RBSECT+167                                               02823000
SPDBFR   EQU   0                                                        02824000
SPDHDR   EQU   SPDBFR                                                   02825000
SPDDDNAM EQU   SPDHDR                                                   02826000
SPDABCCD EQU   SPDHDR+8                                                 02827000
SPDTRACE EQU   SPDBFR+9                                                 02828000
SPDTRRCD EQU   0                                                        02829000
SPDRCDHD EQU   SPDTRRCD                                                 02830000
SPDRCDLN EQU   SPDRCDHD                                                 02831000
SPDBLKID EQU   SPDRCDHD+1                                               02832000
SPDDATA1 EQU   SPDTRRCD+2                                               02833000
SPDBLKAD EQU   SPDDATA1                                                 02834000
SPDDATA2 EQU   SPDDATA1+4                                               02835000
SDWA     EQU   0                                                        02836000
SDWAPARM EQU   SDWA                                                     02837000
SDWAFIOB EQU   SDWA+4                                                   02838000
SDWAABCC EQU   SDWAFIOB                                                 02839000
SDWACMPF EQU   SDWAABCC                                                 02840000
SDWAREQ  EQU   SDWACMPF                                                 02841000
SDWACMPC EQU   SDWAABCC+1                                               02842000
SDWACTL1 EQU   SDWA+8                                                   02843000
SDWACMKA EQU   SDWACTL1                                                 02844000
SDWAMWPA EQU   SDWACTL1+1                                               02845000
SDWAPMKA EQU   SDWACTL1+4                                               02846000
SDWACTL2 EQU   SDWA+16                                                  02847000
SDWACMKP EQU   SDWACTL2                                                 02848000
SDWAMWPP EQU   SDWACTL2+1                                               02849000
SDWAPMKP EQU   SDWACTL2+4                                               02850000
SDWAGRSV EQU   SDWA+24                                                  02851000
SDWANAME EQU   SDWA+88                                                  02852000
SDWAEC1  EQU   SDWA+104                                                 02853000
SDWAEMK1 EQU   SDWAEC1                                                  02854000
SDWAMWP1 EQU   SDWAEC1+1                                                02855000
SDWAINT1 EQU   SDWAEC1+2                                                02856000
SDWANXT1 EQU   SDWAEC1+4                                                02857000
SDWAAEC1 EQU   SDWA+112                                                 02858000
SDWAILC1 EQU   SDWAAEC1+1                                               02859000
SDWAINC1 EQU   SDWAAEC1+2                                               02860000
SDWAICD1 EQU   SDWAINC1+1                                               02861000
SDWAEC2  EQU   SDWA+120                                                 02862000
SDWAEMK2 EQU   SDWAEC2                                                  02863000
SDWAMWP2 EQU   SDWAEC2+1                                                02864000
SDWAINT2 EQU   SDWAEC2+2                                                02865000
SDWANXT2 EQU   SDWAEC2+4                                                02866000
SDWAAEC2 EQU   SDWA+128                                                 02867000
SDWAILC2 EQU   SDWAAEC2+1                                               02868000
SDWAINC2 EQU   SDWAAEC2+2                                               02869000
SDWAICD2 EQU   SDWAINC2+1                                               02870000
SDWASRSV EQU   SDWA+136                                                 02871000
SDWASR00 EQU   SDWASRSV                                                 02872000
SDWASR07 EQU   SDWASRSV+28                                              02873000
SDWASR08 EQU   SDWASRSV+32                                              02874000
SDWASR09 EQU   SDWASRSV+36                                              02875000
SDWASR15 EQU   SDWASRSV+60                                              02876000
SDWAIDNT EQU   SDWA+200                                                 02877000
SDWAMCH  EQU   SDWA+204                                                 02878000
SDWASTCK EQU   SDWAMCH                                                  02879000
SDWAMCHI EQU   SDWAMCH+8                                                02880000
SDWAMCHS EQU   SDWAMCHI                                                 02881000
SDWAMCHD EQU   SDWAMCHI+1                                               02882000
SDWARSR1 EQU   SDWAMCH+12                                               02883000
SDWARSR2 EQU   SDWAMCH+13                                               02884000
SDWAFLGS EQU   SDWA+232                                                 02885000
SDWAERRA EQU   SDWAFLGS                                                 02886000
SDWAMCHK EQU   SDWAERRA                                                 02887000
SDWATEXC EQU   SDWAERRA                                                 02888000
SDWAPGIO EQU   SDWAERRA                                                 02889000
SDWAERRB EQU   SDWAFLGS+1                                               02890000
SDWAERRC EQU   SDWAFLGS+2                                               02891000
SDWASTAF EQU   SDWAERRC                                                 02892000
SDWAEAS  EQU   SDWAERRC                                                 02893000
SDWAERRD EQU   SDWAFLGS+3                                               02894000
SDWACLUP EQU   SDWAERRD                                                 02895000
SDWAIOFS EQU   SDWA+238                                                 02896000
SDWARTYA EQU   SDWA+240                                                 02897000
SDWACPUA EQU   SDWA+248                                                 02898000
SDWAPARQ EQU   SDWA+252                                                 02899000
SDWARCDE EQU   SDWAPARQ                                                 02900000
SDWAACF2 EQU   SDWAPARQ+1                                               02901000
SDWARCRD EQU   SDWAACF2                                                 02902000
SDWAUPRG EQU   SDWAACF2                                                 02903000
SDWAFREE EQU   SDWAACF2                                                 02904000
SDWAACF3 EQU   SDWAPARQ+2                                               02905000
SDWAACF4 EQU   SDWAPARQ+3                                               02906000
SDWALKWA EQU   SDWA+256                                                 02907000
SDWALKWS EQU   SDWALKWA                                                 02908000
SDWARECP EQU   SDWA+292                                                 02909000
SDWACSCT EQU   SDWARECP+8                                               02910000
SDWAREXN EQU   SDWARECP+16                                              02911000
SDWASNPA EQU   SDWA+320                                                 02912000
SDWADUMP EQU   SDWASNPA                                                 02913000
SDWADPFS EQU   SDWADUMP+1                                               02914000
SDWADDAT EQU   SDWASNPA+4                                               02915000
SDWASDAT EQU   SDWADDAT                                                 02916000
SDWAPDAT EQU   SDWADDAT+2                                               02917000
SDWADPSA EQU   SDWA+328                                                 02918000
SDWADPSL EQU   SDWADPSA                                                 02919000
SDWARA   EQU   SDWA+400                                                 02920000
SDWADPVA EQU   SDWARA+2                                                 02921000
SDWAURAL EQU   SDWARA+3                                                 02922000
SDWAVRA  EQU   SDWARA+4                                                 02923000
TCBFIX   EQU   0                                                        02924000
TCBFRS   EQU   TCBFIX                                                   02925000
TCB      EQU   0                                                        02926000
TCBPIE   EQU   TCB+4                                                    02927000
TCBPMASK EQU   TCBPIE                                                   02928000
TCBTIO   EQU   TCB+12                                                   02929000
TCBCMP   EQU   TCB+16                                                   02930000
TCBCMPF  EQU   TCBCMP                                                   02931000
TCBCPP   EQU   TCBCMPF                                                  02932000
TCBSTCC  EQU   TCBCMPF                                                  02933000
TCBCDBL  EQU   TCBCMPF                                                  02934000
TCBCWTO  EQU   TCBCMPF                                                  02935000
TCBCIND  EQU   TCBCMPF                                                  02936000
TCBCMSG  EQU   TCBCMPF                                                  02937000
TCBTRN   EQU   TCB+20                                                   02938000
TCBABF   EQU   TCBTRN                                                   02939000
TCBMSS   EQU   TCB+24                                                   02940000
TCBPKF   EQU   TCB+28                                                   02941000
TCBFLGS  EQU   TCB+29                                                   02942000
TCBFLGS1 EQU   TCBFLGS                                                  02943000
TCBFLGS2 EQU   TCBFLGS+1                                                02944000
TCBFLGS3 EQU   TCBFLGS+2                                                02945000
TCBFLGS4 EQU   TCBFLGS+3                                                02946000
TCBFLGS5 EQU   TCBFLGS+4                                                02947000
TCBABWF  EQU   TCBFLGS5                                                 02948000
TCBJPQ   EQU   TCB+44                                                   02949000
TCBPURGE EQU   TCBJPQ                                                   02950000
TCBGRS   EQU   TCB+48                                                   02951000
TCBFSA   EQU   TCB+112                                                  02952000
TCBTME   EQU   TCB+120                                                  02953000
TCBJSTCB EQU   TCB+124                                                  02954000
TCBTSFLG EQU   TCB+148                                                  02955000
TCBTSTSK EQU   TCBTSFLG                                                 02956000
TCBSTAB  EQU   TCB+160                                                  02957000
TCBNSTAE EQU   TCBSTAB                                                  02958000
TCBTCT   EQU   TCB+164                                                  02959000
TCBTCTGF EQU   TCBTCT                                                   02960000
TCBSCNDY EQU   TCB+172                                                  02961000
TCBNDSP  EQU   TCBSCNDY                                                 02962000
TCBNDSP1 EQU   TCBNDSP+1                                                02963000
TCBNDSP2 EQU   TCBNDSP+2                                                02964000
TCBNDSP3 EQU   TCBNDSP+3                                                02965000
TCBJSCB  EQU   TCB+180                                                  02966000
TCBRECDE EQU   TCBJSCB                                                  02967000
TCBEXT1  EQU   TCB+196                                                  02968000
TCBBITS  EQU   TCB+200                                                  02969000
TCBNDSP4 EQU   TCBBITS                                                  02970000
TCBNDSP5 EQU   TCBBITS+1                                                02971000
TCBFLGS6 EQU   TCBBITS+2                                                02972000
TCBRV    EQU   TCBFLGS6                                                 02973000
TCBFLGS7 EQU   TCBBITS+3                                                02974000
TCBDAR   EQU   TCB+204                                                  02975000
TCBDARC  EQU   TCBDAR                                                   02976000
TCBEXT2  EQU   TCB+208                                                  02977000
TCBFOE   EQU   TCB+244                                                  02978000
TCBESTAE EQU   TCB+264                                                  02979000
TCBESTRM EQU   TCBESTAE+1                                               02980000
TCBFBYT1 EQU   TCB+276                                                  02981000
TCBFBYT2 EQU   TCB+277                                                  02982000
TCBRV124 EQU   TCB+278                                                  02983000
TCBRV133 EQU   TCB+279                                                  02984000
TCBXTNT2 EQU   0                                                        02985000
TCBGTF   EQU   TCBXTNT2                                                 02986000
TCBTFLG  EQU   TCBGTF                                                   02987000
TCBRV146 EQU   TCBXTNT2+28                                              02988000
TCBRV155 EQU   TCBXTNT2+29                                              02989000
TCBRV164 EQU   TCBXTNT2+30                                              02990000
TCBRV173 EQU   TCBXTNT2+31                                              02991000
TIOT1    EQU   0                                                        02992000
TIOCNJOB EQU   TIOT1                                                    02993000
TIOCSTEP EQU   TIOT1+8                                                  02994000
TIOENTRY EQU   0                                                        02995000
TIOESTTA EQU   TIOENTRY+1                                               02996000
TIOERLOC EQU   TIOENTRY+2                                               02997000
TIOELINK EQU   TIOERLOC+1                                               02998000
TIOESYOT EQU   TIOELINK                                                 02999000
TIOEDDNM EQU   TIOENTRY+4                                               03000000
TIOESTTC EQU   TIOENTRY+15                                              03001000
TIOESTTB EQU   TIOENTRY+16                                              03002000
POOLSTAR EQU   TIOENTRY+20                                              03003000
USL      EQU   0                                                        03004000
USLSIZE  EQU   USL                                                      03005000
USLBFRQT EQU   USL+4                                                    03006000
USLIOB1  EQU   USLBFRQT+1                                               03007000
USLBFRQB EQU   USL+8                                                    03008000
EST2RET  EQU   0                                                        03009000
ASUBRTN  EQU   0                                                        03010000
IEA0VL00 EQU   0                                                        03011000
IEA0VL01 EQU   0                                                        03012000
IKEBC    EQU   0                                                        03013000
IKEBF15  EQU   0                                                        03014000
IKEBF31  EQU   0                                                        03015000
IKEBP15  EQU   0                                                        03016000
IKEBP31  EQU   0                                                        03017000
IKEBP8   EQU   0                                                        03018000
SPDRDATA EQU   0                                                        03019000
DCBPTR   EQU   RBGRS1                                                   03020000
DECBPT   EQU   RBGRS0                                                   03021000
BUFNXPTA EQU   BUFFER                                                   03022000
CVTS01   EQU   CVTPGSIA                                                 03023000
CVTLPDIA EQU   CVTS01+12                                                03024000
CVTDIRST EQU   CVTLPDIA                                                 03025000
CVTSLIDA EQU   CVTS01+24                                                03026000
CVTCTLFG EQU   CVTS01+50                                                03027000
CVT0VL01 EQU   CVTS01+72                                                03028000
CVTCRMN  EQU   CVTS01+156                                               03029000
CVTRV210 EQU   CVTS01+424                                               03030000
CVTRV219 EQU   CVTS01+425                                               03031000
CVTRV228 EQU   CVTS01+426                                               03032000
CVTRV237 EQU   CVTS01+427                                               03033000
CVTMFRTR EQU   CVTS01+452                                               03034000
CVTRV262 EQU   CVTS01+468                                               03035000
CVTRV271 EQU   CVTS01+469                                               03036000
CVTRV280 EQU   CVTS01+470                                               03037000
CVTRV289 EQU   CVTS01+471                                               03038000
CVTGSDA  EQU   CVTS01+600                                               03039000
DEBBAS02 EQU   DEBBASND                                                 03040000
DEBDDS1  EQU   DEBBAS02                                                 03041000
DEBSUCBA EQU   DEBDDS1                                                  03042000
DEBRDCB  EQU   DEBDDS1+4                                                03043000
DEBPDCB  EQU   DEBDDS1+8                                                03044000
DEBWDCB  EQU   DEBDDS1+12                                               03045000
DEBBAS01 EQU   DEBBASND                                                 03046000
DEBISAM  EQU   DEBBAS01                                                 03047000
DEBFIEAD EQU   DEBISAM                                                  03048000
DEBFPEAD EQU   DEBISAM+4                                                03049000
DEBFOEAD EQU   DEBISAM+8                                                03050000
DEBEXPT  EQU   DEBISAM+12                                               03051000
DEBRPSID EQU   DEBEXPT                                                  03052000
DECBS05  EQU   DECNEXT                                                  03053000
IOBORG01 EQU   IOBPREFX+8                                               03054000
IOBNIOBA EQU   IOBORG01                                                 03055000
IOBNFLG1 EQU   IOBNIOBA                                                 03056000
IOBORG02 EQU   IOBPREFX+8                                               03057000
IOBDQADA EQU   IOBORG02                                                 03058000
IOBDEQIN EQU   IOBDQADA                                                 03059000
IOBORG03 EQU   IOBPREFX+12                                              03060000
IOBORG04 EQU   IOBINCAM                                                 03061000
IOBORG12 EQU   IOBINCAM                                                 03062000
IOBFL4   EQU   IOBORG12                                                 03063000
IOBEXTEN EQU   IOBSTDRD+32                                              03064000
IOBSEEK  EQU   IOBEXTEN                                                 03065000
IOBBB    EQU   IOBSEEK+1                                                03066000
IOBCC    EQU   IOBSEEK+3                                                03067000
IOBHH    EQU   IOBSEEK+5                                                03068000
IOBORG05 EQU   IOBEXTEN                                                 03069000
IOBORG06 EQU   IOBEXTEN                                                 03070000
IOBNXTPT EQU   IOBORG06+4                                               03071000
IOBSTATA EQU   IOBNXTPT                                                 03072000
IOBORG07 EQU   IOBEXTEN+8                                               03073000
W1IEXTEN EQU   IOBORG07                                                 03074000
IOBORG08 EQU   IOBEXTEN+8                                               03075000
IOBINDCT EQU   IOBORG08+4                                               03076000
IOBUNSQR EQU   IOBORG08+5                                               03077000
IOBFCHAD EQU   IOBORG08+8                                               03078000
IOBORG09 EQU   IOBEXTEN+8                                               03079000
IOBDIOBS EQU   IOBORG09+2                                               03080000
IOBDPLAD EQU   IOBORG09+4                                               03081000
IOBDTYPE EQU   IOBORG09+8                                               03082000
IOBDTYP2 EQU   IOBORG09+9                                               03083000
IOBDSTAT EQU   IOBORG09+10                                              03084000
IOBSTAT1 EQU   IOBDSTAT                                                 03085000
IOBDQPTR EQU   IOBORG09+20                                              03086000
IOBORG10 EQU   IOBEXTEN+8                                               03087000
IOBSEEK2 EQU   IOBORG10                                                 03088000
IOBORG11 EQU   IOBEXTEN                                                 03089000
IOBERCT  EQU   IOBORG11                                                 03090000
IOBUCBXV EQU   IOBERCT                                                  03091000
IOBNAME  EQU   IOBORG11+4                                               03092000
PSARSVTE EQU   PSARSVT                                                  03093000
RBSECS03 EQU   RBEP                                                     03094000
RBCDE    EQU   RBSECS03                                                 03095000
RBCDFLGS EQU   RBCDE                                                    03096000
RBSECS05 EQU   RBPGMQ                                                   03097000
RBSQE    EQU   RBSECS05                                                 03098000
RBSECS06 EQU   RBPGMQ                                                   03099000
RBIQE    EQU   RBSECS06                                                 03100000
RBSECS07 EQU   RBPGMQ                                                   03101000
RBIQE2   EQU   RBSECS07                                                 03102000
RBSECS08 EQU   IRBEND                                                   03103000
RBSECS09 EQU   IRBEND                                                   03104000
WKAREA   EQU   RBEXSAVE                                                 03105000
WKATRAIL EQU   WKAREA                                                   03106000
WKAIOBQ  EQU   WKATRAIL                                                 03107000
WKABUFAS EQU   WKATRAIL                                                 03108000
WKAEXCP  EQU   WKATRAIL                                                 03109000
WKABUFQ  EQU   WKATRAIL                                                 03110000
WKALOCK  EQU   WKATRAIL                                                 03111000
WKASVKEY EQU   WKAREA+1                                                 03112000
WKACLEAN EQU   WKAREA+2                                                 03113000
WKADUMP  EQU   WKAREA+3                                                 03114000
WKAREG14 EQU   WKAREA+8                                                 03115000
WKADEBRC EQU   WKAREG14                                                 03116000
WKADEB   EQU   WKAREG14+1                                               03117000
WKAIOBRG EQU   WKAREA+16                                                03118000
WKASAVE  EQU   WKAREA+20                                                03119000
WKASAVE2 EQU   WKAREA+24                                                03120000
WKAESTAE EQU   WKAREA+28                                                03121000
WKATRACE EQU   WKAESTAE                                                 03122000
WKARETRN EQU   WKATRACE                                                 03123000
WKASVREG EQU   WKATRACE+4                                               03124000
WKATRCLG EQU   WKAESTAE+8                                               03125000
TIOEDEVE EQU   TIOESTTB                                                 03126000
TIOSTTB  EQU   TIOEDEVE                                                 03127000
SDWAWORK EQU   SDWAVRA                                                  03128000
MESSAGE  EQU   SDWAWORK                                                 03129000
RETCOD   EQU   MESSAGE+16                                               03130000
GTFLAG   EQU   RETCOD                                                   03131000
RCODE    EQU   RETCOD+1                                                 03132000
RETCOD2  EQU   MESSAGE+19                                               03133000
MSGJOB   EQU   MESSAGE+22                                               03134000
MSGSTEP  EQU   MESSAGE+31                                               03135000
MSGDDN   EQU   MESSAGE+40                                               03136000
SAVESDWA EQU   SDWAWORK+52                                              03137000
HEAD     EQU   MESSAGE                                                  03138000
HEADER   EQU   HEAD                                                     03139000
JOBNAME  EQU   HEADER+10                                                03140000
STEPNAME EQU   HEADER+19                                                03141000
SDUMPLST EQU   HEAD+27                                                  03142000
RECORDWK EQU   MESSAGE                                                  03143000
RECAUDIT EQU   RECORDWK                                                 03144000
RECRCDP  EQU   RECORDWK+1                                               03145000
RECRCLN  EQU   RECORDWK+2                                               03146000
RECREG0  EQU   RECORDWK+4                                               03147000
RECREG1  EQU   RECORDWK+8                                               03148000
RECOPSW  EQU   RECORDWK+12                                              03149000
RECPERC  EQU   RECORDWK+20                                              03150000
TRCLIST  EQU   WKATRACE                                                 03151000
FLC      EQU   PSA                                                      03152000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    03153000
@NM00174 EQU   RECORDWK+3                                               03154000
@NM00172 EQU   HEADER+18                                                03155000
@NM00171 EQU   HEADER+9                                                 03156000
MODNAME  EQU   HEADER+1                                                 03157000
HEADLEN  EQU   HEADER                                                   03158000
@NM00170 EQU   MESSAGE+48                                               03159000
@NM00169 EQU   MESSAGE+39                                               03160000
@NM00168 EQU   MESSAGE+30                                               03161000
@NM00167 EQU   MESSAGE+21                                               03162000
@NM00166 EQU   MESSAGE+18                                               03163000
@NM00165 EQU   MESSAGE+15                                               03164000
ABND     EQU   MESSAGE+12                                               03165000
@NM00164 EQU   MESSAGE+11                                               03166000
MSGNO    EQU   MESSAGE+4                                                03167000
@NM00163 EQU   MESSAGE                                                  03168000
TIOUCBP  EQU   TIOEDEVE+1                                               03169000
TIOVERF  EQU   TIOSTTB                                                  03170000
TIOUNLD  EQU   TIOSTTB                                                  03171000
TIOMNTD  EQU   TIOSTTB                                                  03172000
TIOSETU  EQU   TIOSTTB                                                  03173000
TIOVLSR  EQU   TIOSTTB                                                  03174000
TIOPVIO  EQU   TIOSTTB                                                  03175000
TIOREQD  EQU   TIOSTTB                                                  03176000
TIOUSED  EQU   TIOSTTB                                                  03177000
@NM00105 EQU   WKAESTAE+9                                               03178000
WKABUFRG EQU   WKAREA+12                                                03179000
WKASVC14 EQU   WKAREA+4                                                 03180000
@NM00104 EQU   WKATRAIL                                                 03181000
RBRSV161 EQU   RBSECS09+64                                              03182000
RBSIRBWA EQU   RBSECS09                                                 03183000
RBIQEWRK EQU   RBSECS08+4                                               03184000
RBNEXAV  EQU   RBSECS08                                                 03185000
RBIQEA   EQU   RBIQE2                                                   03186000
RBIQE1   EQU   RBIQE+1                                                  03187000
RBUSE    EQU   RBIQE                                                    03188000
RBSQEA   EQU   RBSQE+1                                                  03189000
@NM00103 EQU   RBSQE                                                    03190000
RBCDE1   EQU   RBCDE+1                                                  03191000
RBCDLOAD EQU   RBCDFLGS                                                 03192000
RBCDXCTL EQU   RBCDFLGS                                                 03193000
RBCDSYNC EQU   RBCDFLGS                                                 03194000
RBCDNODE EQU   RBCDFLGS                                                 03195000
RBRSV010 EQU   RBCDFLGS                                                 03196000
RBCDATCH EQU   RBCDFLGS                                                 03197000
RBRSV009 EQU   RBCDFLGS                                                 03198000
RBNOCELL EQU   RBCDFLGS                                                 03199000
PSARSAV  EQU   PSARSVTE+60                                              03200000
PSARSTK  EQU   PSARSVTE+56                                              03201000
PSAESAV3 EQU   PSARSVTE+52                                              03202000
PSAESTK3 EQU   PSARSVTE+48                                              03203000
PSAESAV2 EQU   PSARSVTE+44                                              03204000
PSAESTK2 EQU   PSARSVTE+40                                              03205000
PSAESAV1 EQU   PSARSVTE+36                                              03206000
PSAESTK1 EQU   PSARSVTE+32                                              03207000
PSAPSAV  EQU   PSARSVTE+28                                              03208000
PSAPSTK  EQU   PSARSVTE+24                                              03209000
PSAMSAV  EQU   PSARSVTE+20                                              03210000
PSAMSTK  EQU   PSARSVTE+16                                              03211000
PSASSAV  EQU   PSARSVTE+12                                              03212000
PSASSTK  EQU   PSARSVTE+8                                               03213000
PSANSTK  EQU   PSARSVTE+4                                               03214000
PSACSTK  EQU   PSARSVTE                                                 03215000
IOBCSWSV EQU   IOBORG11+17                                              03216000
IOBSENSV EQU   IOBORG11+16                                              03217000
IOBRCD   EQU   IOBORG11+12                                              03218000
IOBMDREC EQU   IOBORG11+8                                               03219000
IOBNAMEA EQU   IOBNAME+1                                                03220000
IOBNAMSZ EQU   IOBNAME                                                  03221000
IOBERCTA EQU   IOBERCT+1                                                03222000
IOBRTYPE EQU   IOBUCBXV                                                 03223000
IOBRDCHP EQU   IOBORG10+20                                              03224000
IOBNEXTA EQU   IOBORG10+16                                              03225000
IOBREADA EQU   IOBORG10+12                                              03226000
IOBBUFC  EQU   IOBORG10+8                                               03227000
IOBSK2R  EQU   IOBSEEK2+7                                               03228000
IOBSK2HH EQU   IOBSEEK2+5                                               03229000
IOBSK2CC EQU   IOBSEEK2+3                                               03230000
IOBSK2BB EQU   IOBSEEK2+1                                               03231000
IOBSK2M  EQU   IOBSEEK2                                                 03232000
IOBCHNPR EQU   IOBORG09+40                                              03233000
IOBDNCRF EQU   IOBORG09+32                                              03234000
IOBRSV35 EQU   IOBORG09+24                                              03235000
IOBRSV34 EQU   IOBORG09+18                                              03236000
IOBDBYTN EQU   IOBORG09+16                                              03237000
IOBDCPND EQU   IOBORG09+12                                              03238000
IOBSTAT2 EQU   IOBDSTAT+1                                               03239000
IOBSIORT EQU   IOBSTAT1                                                 03240000
IOBADDVU EQU   IOBSTAT1                                                 03241000
IOBBUFF  EQU   IOBSTAT1                                                 03242000
IOBENQUE EQU   IOBSTAT1                                                 03243000
IOBPASS2 EQU   IOBSTAT1                                                 03244000
IOBSYNCH EQU   IOBSTAT1                                                 03245000
IOBNEWVL EQU   IOBSTAT1                                                 03246000
IOBABNRM EQU   IOBSTAT1                                                 03247000
IOBRELEX EQU   IOBDTYP2                                                 03248000
IOBADDTY EQU   IOBDTYP2                                                 03249000
IOBTYPE  EQU   IOBDTYP2                                                 03250000
IOBRQUST EQU   IOBDTYP2                                                 03251000
IOBSUFFX EQU   IOBDTYP2                                                 03252000
IOBSBLKL EQU   IOBDTYP2                                                 03253000
IOBSKEY  EQU   IOBDTYP2                                                 03254000
IOBRELBL EQU   IOBDTYPE                                                 03255000
IOBRDEXC EQU   IOBDTYPE                                                 03256000
IOBDYNBF EQU   IOBDTYPE                                                 03257000
IOBACTAD EQU   IOBDTYPE                                                 03258000
IOBFDBCK EQU   IOBDTYPE                                                 03259000
IOBEXTSC EQU   IOBDTYPE                                                 03260000
IOBOVFLO EQU   IOBDTYPE                                                 03261000
IOBVERFY EQU   IOBDTYPE                                                 03262000
IOBDPLB  EQU   IOBDPLAD+1                                               03263000
IOBDAYLI EQU   IOBDPLAD                                                 03264000
IOBDBYTR EQU   IOBORG09                                                 03265000
IOBBCHAD EQU   IOBORG08+12                                              03266000
IOBFCHNB EQU   IOBFCHAD+1                                               03267000
IOBCOUNT EQU   IOBFCHAD                                                 03268000
IOBASYN  EQU   IOBORG08+7                                               03269000
IOBAPP   EQU   IOBORG08+6                                               03270000
IOBRSV32 EQU   IOBUNSQR                                                 03271000
IOBRSV31 EQU   IOBUNSQR                                                 03272000
IOBRSV30 EQU   IOBUNSQR                                                 03273000
IOBKNRWR EQU   IOBUNSQR                                                 03274000
IOBKNWR  EQU   IOBUNSQR                                                 03275000
IOBNTAV2 EQU   IOBUNSQR                                                 03276000
IOBNTAV1 EQU   IOBUNSQR                                                 03277000
IOBCPBSY EQU   IOBUNSQR                                                 03278000
IOBCHNNL EQU   IOBINDCT                                                 03279000
IOBRSV29 EQU   IOBINDCT                                                 03280000
IOBRSV28 EQU   IOBINDCT                                                 03281000
IOBRSV27 EQU   IOBINDCT                                                 03282000
IOBKEYAD EQU   IOBINDCT                                                 03283000
IOBOVPTR EQU   IOBINDCT                                                 03284000
IOBUNSCH EQU   IOBINDCT                                                 03285000
IOBDEQCP EQU   IOBINDCT                                                 03286000
IOBCCWAD EQU   IOBORG08                                                 03287000
W1OEXTEN EQU   W1IEXTEN                                                 03288000
IOBCCW   EQU   IOBORG06+8                                               03289000
IOBNXTPB EQU   IOBNXTPT+1                                               03290000
IOBRSV26 EQU   IOBSTATA                                                 03291000
IOBRSV25 EQU   IOBSTATA                                                 03292000
IOBRSV24 EQU   IOBSTATA                                                 03293000
IOBRSV23 EQU   IOBSTATA                                                 03294000
IOBRSV22 EQU   IOBSTATA                                                 03295000
IOBRSV21 EQU   IOBSTATA                                                 03296000
IOBRSV20 EQU   IOBSTATA                                                 03297000
IOBAVLFL EQU   IOBSTATA                                                 03298000
IOBRSV37 EQU   IOBORG06+1                                               03299000
IOBUCBXG EQU   IOBORG06                                                 03300000
IOBCPA   EQU   IOBORG05+32                                              03301000
IOBERINF EQU   IOBORG05+16                                              03302000
IOBERCCW EQU   IOBORG05+8                                               03303000
IOBSNDPT EQU   IOBORG05+7                                               03304000
IOBRCVPT EQU   IOBORG05+6                                               03305000
IOBWORK  EQU   IOBORG05+1                                               03306000
IOBUCBX  EQU   IOBORG05                                                 03307000
IOBR     EQU   IOBSEEK+7                                                03308000
IOBHH2   EQU   IOBHH+1                                                  03309000
IOBHH1   EQU   IOBHH                                                    03310000
IOBCC2   EQU   IOBCC+1                                                  03311000
IOBCC1   EQU   IOBCC                                                    03312000
IOBBB2   EQU   IOBBB+1                                                  03313000
IOBBB1   EQU   IOBBB                                                    03314000
IOBM     EQU   IOBSEEK                                                  03315000
IOBRSV46 EQU   IOBFL4                                                   03316000
IOBRSV47 EQU   IOBFL4                                                   03317000
IOBENT   EQU   IOBFL4                                                   03318000
IOBEQP   EQU   IOBFL4                                                   03319000
IOBBUS   EQU   IOBFL4                                                   03320000
IOBDCK   EQU   IOBFL4                                                   03321000
IOBREJ   EQU   IOBFL4                                                   03322000
IOBOVR   EQU   IOBFL4                                                   03323000
IOBCRILC EQU   IOBORG04+1                                               03324000
IOBCRDCC EQU   IOBORG04                                                 03325000
IOBGQECB EQU   IOBORG03                                                 03326000
IOBSWAP  EQU   IOBORG02+4                                               03327000
IOBDQADB EQU   IOBDQADA+1                                               03328000
IOBRSV13 EQU   IOBDEQIN                                                 03329000
IOBRSV12 EQU   IOBDEQIN                                                 03330000
IOBRSV11 EQU   IOBDEQIN                                                 03331000
IOBRSV10 EQU   IOBDEQIN                                                 03332000
IOBRSV09 EQU   IOBDEQIN                                                 03333000
IOBRSV08 EQU   IOBDEQIN                                                 03334000
IOBRSV07 EQU   IOBDEQIN                                                 03335000
IOBDEQ   EQU   IOBDEQIN                                                 03336000
IOBNECB  EQU   IOBORG01+4                                               03337000
IOBNIOBB EQU   IOBNIOBA+1                                               03338000
IOBFIRST EQU   IOBNFLG1                                                 03339000
IOBUPERR EQU   IOBNFLG1                                                 03340000
IOBSPAN  EQU   IOBNFLG1                                                 03341000
IOBBKSPC EQU   IOBNFLG1                                                 03342000
IOBUPDAT EQU   IOBNFLG1                                                 03343000
IOBREAD  EQU   IOBNFLG1                                                 03344000
IOBWRITE EQU   IOBNFLG1                                                 03345000
IOBPRTOV EQU   IOBNFLG1                                                 03346000
DECBLFMT EQU   DECBS05+8                                                03347000
DECBLNNM EQU   DECBS05+4                                                03348000
DECBHDRA EQU   DECBS05                                                  03349000
DEBEXPTA EQU   DEBEXPT+1                                                03350000
DEBRSV12 EQU   DEBRPSID                                                 03351000
DEBRSV11 EQU   DEBRPSID                                                 03352000
DEBRSV10 EQU   DEBRPSID                                                 03353000
DEBRSV09 EQU   DEBRPSID                                                 03354000
DEBRPSAP EQU   DEBRPSID                                                 03355000
DEBRPSO  EQU   DEBRPSID                                                 03356000
DEBRPSI  EQU   DEBRPSID                                                 03357000
DEBRPSP  EQU   DEBRPSID                                                 03358000
DEBFOEB  EQU   DEBFOEAD+1                                               03359000
DEBNOEE  EQU   DEBFOEAD                                                 03360000
DEBFPEB  EQU   DEBFPEAD+1                                               03361000
DEBNPEE  EQU   DEBFPEAD                                                 03362000
DEBFIEB  EQU   DEBFIEAD+1                                               03363000
DEBNIEE  EQU   DEBFIEAD                                                 03364000
DEBWDCBA EQU   DEBWDCB+1                                                03365000
DEBRSV08 EQU   DEBWDCB                                                  03366000
DEBPDCBA EQU   DEBPDCB+1                                                03367000
DEBRSV07 EQU   DEBPDCB                                                  03368000
DEBRDCBA EQU   DEBRDCB+1                                                03369000
DEBRSV06 EQU   DEBRDCB                                                  03370000
DEBSUCBB EQU   DEBSUCBA+1                                               03371000
DEBSDVM  EQU   DEBSUCBA                                                 03372000
CVTTPIO  EQU   CVTS01+608                                               03373000
CVTADV   EQU   CVTS01+604                                               03374000
CVTGSDAB EQU   CVTGSDA                                                  03375000
CVTQV3   EQU   CVTS01+596                                               03376000
CVTQV2   EQU   CVTS01+592                                               03377000
CVTQV1   EQU   CVTS01+588                                               03378000
CVTRPT   EQU   CVTS01+584                                               03379000
CVTSSRB  EQU   CVTS01+580                                               03380000
CVTCSDRL EQU   CVTS01+576                                               03381000
CVTEXP1  EQU   CVTS01+572                                               03382000
CVTRMPMT EQU   CVTS01+568                                               03383000
CVTRMPTT EQU   CVTS01+564                                               03384000
CVTVPSA  EQU   CVTS01+560                                               03385000
CVTVSTOP EQU   CVTS01+556                                               03386000
CVTGTFR8 EQU   CVTS01+552                                               03387000
CVTQUIT  EQU   CVTS01+548                                               03388000
CVTVACR  EQU   CVTS01+544                                               03389000
CVTWTCB  EQU   CVTS01+540                                               03390000
CVTSTPRS EQU   CVTS01+536                                               03391000
CVT0PT02 EQU   CVTS01+532                                               03392000
CVTDARCM EQU   CVTS01+528                                               03393000
CVTIRECM EQU   CVTS01+524                                               03394000
CVTJRECM EQU   CVTS01+520                                               03395000
CVTVEMS0 EQU   CVTS01+516                                               03396000
CVTSPFRR EQU   CVTS01+512                                               03397000
CVTRLSTG EQU   CVTS01+508                                               03398000
CVT0TC0A EQU   CVTS01+504                                               03399000
CVTGMBR  EQU   CVTS01+500                                               03400000
CVTLFRM  EQU   CVTS01+496                                               03401000
CVTRMBR  EQU   CVTS01+492                                               03402000
CVTVIOP  EQU   CVTS01+488                                               03403000
CVTRV307 EQU   CVTS01+486                                               03404000
CVTRV306 EQU   CVTS01+484                                               03405000
CVTRV305 EQU   CVTS01+482                                               03406000
CVTRV304 EQU   CVTS01+480                                               03407000
CVTRV303 EQU   CVTS01+478                                               03408000
CVTRV302 EQU   CVTS01+476                                               03409000
CVTRV301 EQU   CVTS01+475                                               03410000
CVTRV300 EQU   CVTS01+474                                               03411000
CVTRV299 EQU   CVTS01+473                                               03412000
CVTRV298 EQU   CVTS01+472                                               03413000
CVTRV297 EQU   CVTRV289                                                 03414000
CVTRV296 EQU   CVTRV289                                                 03415000
CVTRV295 EQU   CVTRV289                                                 03416000
CVTRV294 EQU   CVTRV289                                                 03417000
CVTRV293 EQU   CVTRV289                                                 03418000
CVTRV292 EQU   CVTRV289                                                 03419000
CVTRV291 EQU   CVTRV289                                                 03420000
CVTRV290 EQU   CVTRV289                                                 03421000
CVTRV288 EQU   CVTRV280                                                 03422000
CVTRV287 EQU   CVTRV280                                                 03423000
CVTRV286 EQU   CVTRV280                                                 03424000
CVTRV285 EQU   CVTRV280                                                 03425000
CVTRV284 EQU   CVTRV280                                                 03426000
CVTRV283 EQU   CVTRV280                                                 03427000
CVTRV282 EQU   CVTRV280                                                 03428000
CVTRV281 EQU   CVTRV280                                                 03429000
CVTRV279 EQU   CVTRV271                                                 03430000
CVTRV278 EQU   CVTRV271                                                 03431000
CVTRV277 EQU   CVTRV271                                                 03432000
CVTRV276 EQU   CVTRV271                                                 03433000
CVTRV275 EQU   CVTRV271                                                 03434000
CVTRV274 EQU   CVTRV271                                                 03435000
CVTRV273 EQU   CVTRV271                                                 03436000
CVTRV272 EQU   CVTRV271                                                 03437000
CVTRV270 EQU   CVTRV262                                                 03438000
CVTRV269 EQU   CVTRV262                                                 03439000
CVTRV268 EQU   CVTRV262                                                 03440000
CVTRV267 EQU   CVTRV262                                                 03441000
CVTRV266 EQU   CVTRV262                                                 03442000
CVTRV265 EQU   CVTRV262                                                 03443000
CVTRV264 EQU   CVTRV262                                                 03444000
CVTRV263 EQU   CVTRV262                                                 03445000
CVTVFP   EQU   CVTS01+464                                               03446000
CVTVSI   EQU   CVTS01+460                                               03447000
CVTVPSIB EQU   CVTS01+456                                               03448000
CVTMFACT EQU   CVTMFRTR                                                 03449000
CVTMFCTL EQU   CVTS01+448                                               03450000
CVTPVBP  EQU   CVTS01+444                                               03451000
CVTPWI   EQU   CVTS01+440                                               03452000
CVTRV254 EQU   CVTS01+438                                               03453000
CVTRV253 EQU   CVTS01+436                                               03454000
CVTRV252 EQU   CVTS01+434                                               03455000
CVTRV251 EQU   CVTS01+433                                               03456000
CVTRV250 EQU   CVTS01+432                                               03457000
CVTRV249 EQU   CVTS01+431                                               03458000
CVTRV248 EQU   CVTS01+430                                               03459000
CVTRV247 EQU   CVTS01+429                                               03460000
CVTRV246 EQU   CVTS01+428                                               03461000
CVTRV245 EQU   CVTRV237                                                 03462000
CVTRV244 EQU   CVTRV237                                                 03463000
CVTRV243 EQU   CVTRV237                                                 03464000
CVTRV242 EQU   CVTRV237                                                 03465000
CVTRV241 EQU   CVTRV237                                                 03466000
CVTRV240 EQU   CVTRV237                                                 03467000
CVTRV239 EQU   CVTRV237                                                 03468000
CVTRV238 EQU   CVTRV237                                                 03469000
CVTRV236 EQU   CVTRV228                                                 03470000
CVTRV235 EQU   CVTRV228                                                 03471000
CVTRV234 EQU   CVTRV228                                                 03472000
CVTRV233 EQU   CVTRV228                                                 03473000
CVTRV232 EQU   CVTRV228                                                 03474000
CVTRV231 EQU   CVTRV228                                                 03475000
CVTRV230 EQU   CVTRV228                                                 03476000
CVTRV229 EQU   CVTRV228                                                 03477000
CVTRV227 EQU   CVTRV219                                                 03478000
CVTRV226 EQU   CVTRV219                                                 03479000
CVTRV225 EQU   CVTRV219                                                 03480000
CVTRV224 EQU   CVTRV219                                                 03481000
CVTRV223 EQU   CVTRV219                                                 03482000
CVTRV222 EQU   CVTRV219                                                 03483000
CVTRV221 EQU   CVTRV219                                                 03484000
CVTRV220 EQU   CVTRV219                                                 03485000
CVTRV218 EQU   CVTRV210                                                 03486000
CVTRV217 EQU   CVTRV210                                                 03487000
CVTRV216 EQU   CVTRV210                                                 03488000
CVTRV215 EQU   CVTRV210                                                 03489000
CVTRV214 EQU   CVTRV210                                                 03490000
CVTRV213 EQU   CVTRV210                                                 03491000
CVTRV212 EQU   CVTRV210                                                 03492000
CVTRV211 EQU   CVTRV210                                                 03493000
CVTLCCAT EQU   CVTS01+420                                               03494000
CVTPCCAT EQU   CVTS01+416                                               03495000
CVTIPCRP EQU   CVTS01+412                                               03496000
CVTIPCRI EQU   CVTS01+408                                               03497000
CVTIPCDS EQU   CVTS01+404                                               03498000
CVTAIDVT EQU   CVTS01+400                                               03499000
CVTSSAP  EQU   CVTS01+396                                               03500000
CVTEHCIR EQU   CVTS01+392                                               03501000
CVTEHDEF EQU   CVTS01+388                                               03502000
CVTDAIR  EQU   CVTS01+384                                               03503000
CVTPERFM EQU   CVTS01+380                                               03504000
CVT044R2 EQU   CVTS01+376                                               03505000
CVTFETCH EQU   CVTS01+372                                               03506000
CVTRSTWD EQU   CVTS01+368                                               03507000
CVTSPOST EQU   CVTS01+364                                               03508000
CVTIOBP  EQU   CVTS01+360                                               03509000
CVTASMVT EQU   CVTS01+356                                               03510000
CVTRECRQ EQU   CVTS01+352                                               03511000
CVTWSAC  EQU   CVTS01+348                                               03512000
CVTRV149 EQU   CVTS01+344                                               03513000
CVTWSAL  EQU   CVTS01+340                                               03514000
CVTSPSA  EQU   CVTS01+336                                               03515000
CVTGLMN  EQU   CVTS01+332                                               03516000
CVTVEAC0 EQU   CVTS01+328                                               03517000
CVT062R1 EQU   CVTS01+324                                               03518000
CVTRPOST EQU   CVTS01+320                                               03519000
CVTDQIQE EQU   CVTS01+316                                               03520000
CVTCSD   EQU   CVTS01+312                                               03521000
CVTLKRMA EQU   CVTS01+308                                               03522000
CVTRSPIE EQU   CVTS01+304                                               03523000
CVTRENQ  EQU   CVTS01+300                                               03524000
CVTLQCB  EQU   CVTS01+296                                               03525000
CVTFQCB  EQU   CVTS01+292                                               03526000
CVTQCS01 EQU   CVTS01+288                                               03527000
CVTAPFT  EQU   CVTS01+284                                               03528000
CVTPARRL EQU   CVTS01+280                                               03529000
CVTVWAIT EQU   CVTS01+276                                               03530000
CVTGSPL  EQU   CVTS01+272                                               03531000
CVTLSMQ  EQU   CVTS01+268                                               03532000
CVTGSMQ  EQU   CVTS01+264                                               03533000
CVTEXPRO EQU   CVTS01+260                                               03534000
CVTOPCTP EQU   CVTS01+256                                               03535000
CVTSIC   EQU   CVTS01+252                                               03536000
CVTTPIOS EQU   CVTS01+248                                               03537000
CVTRTMS  EQU   CVTS01+244                                               03538000
CVTSDBF  EQU   CVTS01+240                                               03539000
CVTSCBP  EQU   CVTS01+236                                               03540000
CVTSDMP  EQU   CVTS01+232                                               03541000
CVTSV60  EQU   CVTS01+228                                               03542000
CVTRTMCT EQU   CVTS01+224                                               03543000
CVTASCBL EQU   CVTS01+220                                               03544000
CVTASCBH EQU   CVTS01+216                                               03545000
CVTGDA   EQU   CVTS01+212                                               03546000
CVTASVT  EQU   CVTS01+208                                               03547000
CVTVVMDI EQU   CVTS01+204                                               03548000
CVTAQTOP EQU   CVTS01+200                                               03549000
CVTIOSCS EQU   CVTS01+196                                               03550000
CVTSDRM  EQU   CVTS01+192                                               03551000
CVTOPTE  EQU   CVTS01+188                                               03552000
CVTSTXU  EQU   CVTS01+184                                               03553000
CVTQUIS  EQU   CVTS01+180                                               03554000
CVTPARS  EQU   CVTS01+176                                               03555000
CVTS1EE  EQU   CVTS01+172                                               03556000
CVTFRAS  EQU   CVTS01+168                                               03557000
CVTQSAS  EQU   CVTS01+164                                               03558000
CVTCRAS  EQU   CVTS01+160                                               03559000
CVTDELCP EQU   CVTS01+152                                               03560000
CVTFRECL EQU   CVTS01+148                                               03561000
CVTGETCL EQU   CVTS01+144                                               03562000
CVTBLDCP EQU   CVTS01+140                                               03563000
CVTAUTHL EQU   CVTS01+136                                               03564000
CVTSCAN  EQU   CVTS01+132                                               03565000
CVTRV144 EQU   CVTS01+130                                               03566000
CVTMAXMP EQU   CVTS01+128                                               03567000
CVTSTCK  EQU   CVTS01+124                                               03568000
CVTRV139 EQU   CVTS01+123                                               03569000
CVTDSSAC EQU   CVTS01+122                                               03570000
CVTRV513 EQU   CVTS01+121                                               03571000
CVTIOSPL EQU   CVTS01+120                                               03572000
CVTPTGT  EQU   CVTS01+116                                               03573000
CVTCSPIE EQU   CVTS01+112                                               03574000
CVTSMFEX EQU   CVTS01+108                                               03575000
CVTOLT0A EQU   CVTS01+104                                               03576000
CVTSRBRT EQU   CVTS01+100                                               03577000
CVTPUTL  EQU   CVTS01+96                                                03578000
CVTRV519 EQU   CVTS01+92                                                03579000
CVTRV327 EQU   CVTS01+88                                                03580000
CVTRV326 EQU   CVTS01+84                                                03581000
CVTRV325 EQU   CVTS01+80                                                03582000
CVTRV324 EQU   CVTS01+76                                                03583000
CVTSHRVM EQU   CVTS01+68                                                03584000
CVTRV332 EQU   CVTS01+64                                                03585000
CVTTAS   EQU   CVTS01+60                                                03586000
CVTRSCN  EQU   CVTS01+56                                                03587000
CVTTRAC2 EQU   CVTS01+54                                                03588000
CVTTRACE EQU   CVTS01+52                                                03589000
CVTAPG   EQU   CVTS01+51                                                03590000
CVTSDTRC EQU   CVTCTLFG                                                 03591000
CVTGTRCE EQU   CVTCTLFG                                                 03592000
CVTNOMP  EQU   CVTCTLFG                                                 03593000
CVTRSV79 EQU   CVTCTLFG                                                 03594000
CVTDSTAT EQU   CVTCTLFG                                                 03595000
CVTRSV78 EQU   CVTCTLFG                                                 03596000
CVTRV333 EQU   CVTCTLFG                                                 03597000
CVTRV323 EQU   CVTCTLFG                                                 03598000
CVTSPVLK EQU   CVTS01+49                                                03599000
CVTRSV77 EQU   CVTS01+48                                                03600000
CVTRV331 EQU   CVTS01+44                                                03601000
CVTRV330 EQU   CVTS01+40                                                03602000
CVTRV329 EQU   CVTS01+36                                                03603000
CVTRV328 EQU   CVTS01+32                                                03604000
CVTRV322 EQU   CVTS01+28                                                03605000
CVTSLID  EQU   CVTSLIDA+1                                               03606000
CVTSYLK  EQU   CVTSLIDA                                                 03607000
CVTRV321 EQU   CVTS01+20                                                03608000
CVTRV320 EQU   CVTS01+16                                                03609000
CVTLPDIR EQU   CVTLPDIA+1                                               03610000
CVTRSV69 EQU   CVTDIRST                                                 03611000
CVTRSV68 EQU   CVTDIRST                                                 03612000
CVTRSV67 EQU   CVTDIRST                                                 03613000
CVTRSV66 EQU   CVTDIRST                                                 03614000
CVTRSV65 EQU   CVTDIRST                                                 03615000
CVTRSV64 EQU   CVTDIRST                                                 03616000
CVTRSV63 EQU   CVTDIRST                                                 03617000
CVTDICOM EQU   CVTDIRST                                                 03618000
CVTPVTP  EQU   CVTS01+8                                                 03619000
CVTLPDSR EQU   CVTS01+4                                                 03620000
CVTGETL  EQU   CVTS01                                                   03621000
BUFNXPTB EQU   BUFNXPTA+1                                               03622000
@NM00009 EQU   BUFNXPTA                                                 03623000
@NM00162 EQU   USL+20                                                   03624000
USLSLOT1 EQU   USL+16                                                   03625000
USLCHAIN EQU   USL+12                                                   03626000
USLIOB2  EQU   USLBFRQB+1                                               03627000
@NM00161 EQU   USLBFRQB                                                 03628000
USLFLAGS EQU   USLBFRQT                                                 03629000
@NM00160 EQU   USL+2                                                    03630000
TIOTFEND EQU   POOLSTAR+16                                              03631000
TIOPSLOT EQU   POOLSTAR+13                                              03632000
TIOPSTTB EQU   POOLSTAR+12                                              03633000
TIOPPOOL EQU   POOLSTAR+4                                               03634000
TIOPNSRT EQU   POOLSTAR+3                                               03635000
@NM00159 EQU   POOLSTAR+2                                               03636000
TIOPNSLT EQU   POOLSTAR+1                                               03637000
@NM00158 EQU   POOLSTAR                                                 03638000
TIOEFSRT EQU   TIOENTRY+17                                              03639000
TIOSVERF EQU   TIOESTTB                                                 03640000
TIOSUNLD EQU   TIOESTTB                                                 03641000
TIOSMNTD EQU   TIOESTTB                                                 03642000
TIOSSETU EQU   TIOESTTB                                                 03643000
TIOSVLSR EQU   TIOESTTB                                                 03644000
TIOSPVIO EQU   TIOESTTB                                                 03645000
TIOSREQD EQU   TIOESTTB                                                 03646000
TIOSUSED EQU   TIOESTTB                                                 03647000
TIOSBALS EQU   TIOESTTC                                                 03648000
TIOSBALP EQU   TIOESTTC                                                 03649000
TIOSVOLS EQU   TIOESTTC                                                 03650000
TIOSVOLP EQU   TIOESTTC                                                 03651000
TIOSAFFS EQU   TIOESTTC                                                 03652000
TIOSAFFP EQU   TIOESTTC                                                 03653000
TIOSDEFR EQU   TIOESTTC                                                 03654000
TIOSDKCR EQU   TIOESTTC                                                 03655000
TIOEJFCB EQU   TIOENTRY+12                                              03656000
TIOTREM  EQU   TIOELINK                                                 03657000
TIOESSDS EQU   TIOESYOT                                                 03658000
TIOESYIN EQU   TIOELINK                                                 03659000
TIOEQNAM EQU   TIOELINK                                                 03660000
TIOEDYNM EQU   TIOELINK                                                 03661000
TIOTTERM EQU   TIOELINK                                                 03662000
TIOTRV01 EQU   TIOELINK                                                 03663000
TIOSYOUT EQU   TIOELINK                                                 03664000
TIOEWTCT EQU   TIOERLOC                                                 03665000
TIOSDSP2 EQU   TIOESTTA                                                 03666000
TIOSDSP1 EQU   TIOESTTA                                                 03667000
TIOSLABL EQU   TIOESTTA                                                 03668000
TIOSDADS EQU   TIOESTTA                                                 03669000
TIOSJBLB EQU   TIOESTTA                                                 03670000
TIOSPLTS EQU   TIOESTTA                                                 03671000
TIOSPLTP EQU   TIOESTTA                                                 03672000
TIOSLTYP EQU   TIOESTTA                                                 03673000
TIOELNGH EQU   TIOENTRY                                                 03674000
@NM00157 EQU   TCBXTNT2+32                                              03675000
TCBRV181 EQU   TCBRV173                                                 03676000
TCBRV180 EQU   TCBRV173                                                 03677000
TCBRV179 EQU   TCBRV173                                                 03678000
TCBRV178 EQU   TCBRV173                                                 03679000
TCBRV177 EQU   TCBRV173                                                 03680000
TCBRV176 EQU   TCBRV173                                                 03681000
TCBRV175 EQU   TCBRV173                                                 03682000
TCBRV174 EQU   TCBRV173                                                 03683000
TCBRV172 EQU   TCBRV164                                                 03684000
TCBRV171 EQU   TCBRV164                                                 03685000
TCBRV170 EQU   TCBRV164                                                 03686000
TCBRV169 EQU   TCBRV164                                                 03687000
TCBRV168 EQU   TCBRV164                                                 03688000
TCBRV167 EQU   TCBRV164                                                 03689000
TCBRV166 EQU   TCBRV164                                                 03690000
TCBRV165 EQU   TCBRV164                                                 03691000
TCBRV163 EQU   TCBRV155                                                 03692000
TCBRV162 EQU   TCBRV155                                                 03693000
TCBRV161 EQU   TCBRV155                                                 03694000
TCBRV160 EQU   TCBRV155                                                 03695000
TCBRV159 EQU   TCBRV155                                                 03696000
TCBRV158 EQU   TCBRV155                                                 03697000
TCBRV157 EQU   TCBRV155                                                 03698000
TCBRV156 EQU   TCBRV155                                                 03699000
TCBRV154 EQU   TCBRV146                                                 03700000
TCBRV153 EQU   TCBRV146                                                 03701000
TCBRV152 EQU   TCBRV146                                                 03702000
TCBRV151 EQU   TCBRV146                                                 03703000
TCBRV150 EQU   TCBRV146                                                 03704000
TCBRV149 EQU   TCBRV146                                                 03705000
TCBRV148 EQU   TCBRV146                                                 03706000
TCBRV147 EQU   TCBRV146                                                 03707000
TCBRV145 EQU   TCBXTNT2+26                                              03708000
TCBRV144 EQU   TCBXTNT2+24                                              03709000
TCBRV143 EQU   TCBXTNT2+20                                              03710000
TCBRV142 EQU   TCBXTNT2+16                                              03711000
TCBRSV49 EQU   TCBXTNT2+12                                              03712000
TCBRSV48 EQU   TCBXTNT2+8                                               03713000
TCBRCMP  EQU   TCBXTNT2+5                                               03714000
TCBRSVAB EQU   TCBXTNT2+4                                               03715000
TCBGTFA  EQU   TCBGTF+1                                                 03716000
TCBRSV47 EQU   TCBTFLG                                                  03717000
TCBRSV46 EQU   TCBTFLG                                                  03718000
TCBRSV45 EQU   TCBTFLG                                                  03719000
TCBRSV44 EQU   TCBTFLG                                                  03720000
TCBRSV43 EQU   TCBTFLG                                                  03721000
TCBDSPIT EQU   TCBTFLG                                                  03722000
TCBERRTN EQU   TCBTFLG                                                  03723000
TCBASYNC EQU   TCBTFLG                                                  03724000
@NM00156 EQU   TCB+296                                                  03725000
TCBRV185 EQU   TCB+292                                                  03726000
TCBSWASA EQU   TCB+288                                                  03727000
TCBDBTB  EQU   TCB+284                                                  03728000
TCBRPT   EQU   TCB+280                                                  03729000
TCBRV141 EQU   TCBRV133                                                 03730000
TCBRV140 EQU   TCBRV133                                                 03731000
TCBRV139 EQU   TCBRV133                                                 03732000
TCBRV138 EQU   TCBRV133                                                 03733000
TCBRV137 EQU   TCBRV133                                                 03734000
TCBRV136 EQU   TCBRV133                                                 03735000
TCBRV135 EQU   TCBRV133                                                 03736000
TCBRV134 EQU   TCBRV133                                                 03737000
TCBRV132 EQU   TCBRV124                                                 03738000
TCBRV131 EQU   TCBRV124                                                 03739000
TCBRV130 EQU   TCBRV124                                                 03740000
TCBRV129 EQU   TCBRV124                                                 03741000
TCBRV128 EQU   TCBRV124                                                 03742000
TCBRV127 EQU   TCBRV124                                                 03743000
TCBRV126 EQU   TCBRV124                                                 03744000
TCBRV125 EQU   TCBRV124                                                 03745000
TCBRV123 EQU   TCBFBYT2                                                 03746000
TCBRV122 EQU   TCBFBYT2                                                 03747000
TCBECBNV EQU   TCBFBYT2                                                 03748000
TCBSSSYN EQU   TCBFBYT2                                                 03749000
TCBFPRAP EQU   TCBFBYT2                                                 03750000
TCBFDW   EQU   TCBFBYT2                                                 03751000
TCBFMW   EQU   TCBFBYT2                                                 03752000
TCBCNCB  EQU   TCBFBYT2                                                 03753000
TCBLLH   EQU   TCBFBYT1                                                 03754000
TCBRV113 EQU   TCBFBYT1                                                 03755000
TCBEOT   EQU   TCBFBYT1                                                 03756000
TCBRTM2  EQU   TCBFBYT1                                                 03757000
TCBPGNLY EQU   TCBFBYT1                                                 03758000
TCBNDIOS EQU   TCBFBYT1                                                 03759000
TCBACTIV EQU   TCBFBYT1                                                 03760000
TCBEOTFM EQU   TCBFBYT1                                                 03761000
TCBAFFN  EQU   TCB+274                                                  03762000
TCBCCPVI EQU   TCB+272                                                  03763000
TCBUKYSP EQU   TCB+268                                                  03764000
TCBMODE  EQU   TCBESTAE+3                                               03765000
TCBERTYP EQU   TCBESTAE+2                                               03766000
TCBRV314 EQU   TCBESTRM                                                 03767000
TCBRV313 EQU   TCBESTRM                                                 03768000
TCBRV312 EQU   TCBESTRM                                                 03769000
TCBRV311 EQU   TCBESTRM                                                 03770000
TCBRV310 EQU   TCBESTRM                                                 03771000
TCBRV309 EQU   TCBESTRM                                                 03772000
TCBRV308 EQU   TCBESTRM                                                 03773000
TCBETERM EQU   TCBESTRM                                                 03774000
TCBSCBKY EQU   TCBESTAE                                                 03775000
TCBRTM12 EQU   TCB+260                                                  03776000
TCBTCBID EQU   TCB+256                                                  03777000
TCBRSV96 EQU   TCB+252                                                  03778000
TCBSWA   EQU   TCB+248                                                  03779000
TCBFOEA  EQU   TCBFOE+1                                                 03780000
TCBRSV42 EQU   TCBFOE                                                   03781000
TCBRV306 EQU   TCB+240                                                  03782000
TCBRSV41 EQU   TCB+239                                                  03783000
TCBTID   EQU   TCB+238                                                  03784000
TCBRSVAA EQU   TCB+237                                                  03785000
TCBABCUR EQU   TCB+236                                                  03786000
TCBTMSAV EQU   TCB+232                                                  03787000
TCBIOTIM EQU   TCB+228                                                  03788000
TCBRTWA  EQU   TCB+224                                                  03789000
TCBBACK  EQU   TCB+220                                                  03790000
TCBTIRB  EQU   TCB+216                                                  03791000
TCBAECB  EQU   TCB+212                                                  03792000
TCBEXT2A EQU   TCBEXT2+1                                                03793000
TCBRSV39 EQU   TCBEXT2                                                  03794000
TCBSTMCT EQU   TCB+207                                                  03795000
TCBSYSCT EQU   TCB+206                                                  03796000
TCBRSV37 EQU   TCB+205                                                  03797000
TCBEXSVC EQU   TCBDAR                                                   03798000
TCBRSV36 EQU   TCBDAR                                                   03799000
TCBDARWT EQU   TCBDAR                                                   03800000
TCBDARO  EQU   TCBDAR                                                   03801000
TCBDARMC EQU   TCBDARC                                                  03802000
TCBDARD  EQU   TCBDAR                                                   03803000
TCBDARS  EQU   TCBDAR                                                   03804000
TCBDARP  EQU   TCBDAR                                                   03805000
TCBGTOFM EQU   TCBFLGS7                                                 03806000
TCBADMP  EQU   TCBFLGS7                                                 03807000
TCBRSTSK EQU   TCBFLGS7                                                 03808000
TCBRSV35 EQU   TCBFLGS7                                                 03809000
TCBSTACK EQU   TCBFLGS7                                                 03810000
TCBRSV34 EQU   TCBFLGS7                                                 03811000
TCBRSV33 EQU   TCBFLGS7                                                 03812000
TCBGPECB EQU   TCBFLGS7                                                 03813000
TCBNTJS  EQU   TCBFLGS6                                                 03814000
TCBAPG   EQU   TCBFLGS6                                                 03815000
TCBMIGR  EQU   TCBFLGS6                                                 03816000
TCBRV303 EQU   TCBFLGS6                                                 03817000
TCBSPVLK EQU   TCBFLGS6                                                 03818000
TCBCPU   EQU   TCBFLGS6                                                 03819000
TCBPIE17 EQU   TCBFLGS6                                                 03820000
TCBRSV79 EQU   TCBNDSP5                                                 03821000
TCBRSV78 EQU   TCBNDSP5                                                 03822000
TCBRSV77 EQU   TCBNDSP5                                                 03823000
TCBRSV76 EQU   TCBNDSP5                                                 03824000
TCBRSV75 EQU   TCBNDSP5                                                 03825000
TCBRSV74 EQU   TCBNDSP5                                                 03826000
TCBRSV95 EQU   TCBNDSP5                                                 03827000
TCBRSV94 EQU   TCBNDSP5                                                 03828000
TCBRSV93 EQU   TCBNDSP4                                                 03829000
TCBRSV92 EQU   TCBNDSP4                                                 03830000
TCBRSV91 EQU   TCBNDSP4                                                 03831000
TCBRSV90 EQU   TCBNDSP4                                                 03832000
TCBRSV89 EQU   TCBNDSP4                                                 03833000
TCBRSV88 EQU   TCBNDSP4                                                 03834000
TCBRSV87 EQU   TCBNDSP4                                                 03835000
TCBRSV86 EQU   TCBNDSP4                                                 03836000
TCBEXT1A EQU   TCBEXT1+1                                                03837000
TCBRSV32 EQU   TCBEXT1                                                  03838000
TCBEXCPD EQU   TCB+192                                                  03839000
TCBIOBRC EQU   TCB+188                                                  03840000
TCBDDWTC EQU   TCB+186                                                  03841000
TCBDDEXC EQU   TCB+184                                                  03842000
TCBJSCBB EQU   TCBJSCB+1                                                03843000
@NM00155 EQU   TCBRECDE                                                 03844000
TCBREC   EQU   TCBRECDE                                                 03845000
TCBMDIDS EQU   TCB+176                                                  03846000
TCBNDINT EQU   TCBNDSP3                                                 03847000
TCBRSV27 EQU   TCBNDSP3                                                 03848000
TCBRSV26 EQU   TCBNDSP3                                                 03849000
TCBRSV25 EQU   TCBNDSP3                                                 03850000
TCBRSV24 EQU   TCBNDSP3                                                 03851000
TCBSRBND EQU   TCBNDSP3                                                 03852000
TCBRV302 EQU   TCBNDSP3                                                 03853000
TCBLJSND EQU   TCBNDSP3                                                 03854000
TCBABE   EQU   TCBNDSP2                                                 03855000
TCBDSS   EQU   TCBNDSP2                                                 03856000
TCBOWAIT EQU   TCBNDSP2                                                 03857000
TCBIWAIT EQU   TCBNDSP2                                                 03858000
TCBNDTS  EQU   TCBNDSP2                                                 03859000
TCBNDSVC EQU   TCBNDSP2                                                 03860000
TCBSTPP  EQU   TCBNDSP2                                                 03861000
TCBABD   EQU   TCBNDSP2                                                 03862000
TCBRSV22 EQU   TCBNDSP1                                                 03863000
TCBPIEND EQU   TCBNDSP1                                                 03864000
TCBTPSP  EQU   TCBNDSP1                                                 03865000
TCBDDRND EQU   TCBNDSP1                                                 03866000
TCBRSPND EQU   TCBNDSP1                                                 03867000
TCBRSTND EQU   TCBNDSP1                                                 03868000
TCBDARPN EQU   TCBNDSP1                                                 03869000
TCBDARTN EQU   TCBNDSP1                                                 03870000
TCBNDSP0 EQU   TCBNDSP                                                  03871000
TCBUSER  EQU   TCB+168                                                  03872000
TCBTCTB  EQU   TCBTCT+1                                                 03873000
TCBRSV9C EQU   TCBTCTGF                                                 03874000
TCBRSV9B EQU   TCBTCTGF                                                 03875000
TCBRSV9A EQU   TCBTCTGF                                                 03876000
TCBRSV99 EQU   TCBTCTGF                                                 03877000
TCBRSV98 EQU   TCBTCTGF                                                 03878000
TCBRSV97 EQU   TCBTCTGF                                                 03879000
TCBRSV20 EQU   TCBTCTGF                                                 03880000
TCBSMFGF EQU   TCBTCTGF                                                 03881000
TCBSTABB EQU   TCBSTAB+1                                                03882000
TCBSTCUR EQU   TCBNSTAE                                                 03883000
TCBRV301 EQU   TCBNSTAE                                                 03884000
TCBSYNCH EQU   TCBNSTAE                                                 03885000
TCBHALT  EQU   TCBNSTAE                                                 03886000
TCBPPSUP EQU   TCBNSTAE                                                 03887000
TCB33E   EQU   TCBNSTAE                                                 03888000
TCBQUIES EQU   TCBNSTAE                                                 03889000
TCBSTABE EQU   TCBNSTAE                                                 03890000
TCBAQE   EQU   TCB+156                                                  03891000
TCBPQE   EQU   TCB+152                                                  03892000
TCBTSDP  EQU   TCB+151                                                  03893000
TCBTSLP  EQU   TCB+150                                                  03894000
TCBSTPCT EQU   TCB+149                                                  03895000
TCBCPUBN EQU   TCBTSFLG                                                 03896000
TCBDYDSP EQU   TCBTSFLG                                                 03897000
TCBRSV18 EQU   TCBTSFLG                                                 03898000
TCBRSV17 EQU   TCBTSFLG                                                 03899000
TCBTIOTG EQU   TCBTSFLG                                                 03900000
TCBATT   EQU   TCBTSFLG                                                 03901000
TCBSTPPR EQU   TCBTSFLG                                                 03902000
TCBRV300 EQU   TCBTSTSK                                                 03903000
TCBECB   EQU   TCB+144                                                  03904000
TCBIQE   EQU   TCB+140                                                  03905000
TCBLTC   EQU   TCB+136                                                  03906000
TCBOTC   EQU   TCB+132                                                  03907000
TCBNTC   EQU   TCB+128                                                  03908000
TCBJSTCA EQU   TCBJSTCB+1                                               03909000
TCBRSV16 EQU   TCBJSTCB                                                 03910000
TCBTQET  EQU   TCBTME                                                   03911000
TCBTCB   EQU   TCB+116                                                  03912000
TCBFSAB  EQU   TCBFSA+1                                                 03913000
TCBQEL   EQU   TCBFSA                                                   03914000
TCBGRS15 EQU   TCBGRS+60                                                03915000
TCBGRS14 EQU   TCBGRS+56                                                03916000
TCBGRS13 EQU   TCBGRS+52                                                03917000
TCBGRS12 EQU   TCBGRS+48                                                03918000
TCBGRS11 EQU   TCBGRS+44                                                03919000
TCBGRS10 EQU   TCBGRS+40                                                03920000
TCBGRS9  EQU   TCBGRS+36                                                03921000
TCBGRS8  EQU   TCBGRS+32                                                03922000
TCBGRS7  EQU   TCBGRS+28                                                03923000
TCBGRS6  EQU   TCBGRS+24                                                03924000
TCBGRS5  EQU   TCBGRS+20                                                03925000
TCBGRS4  EQU   TCBGRS+16                                                03926000
TCBGRS3  EQU   TCBGRS+12                                                03927000
TCBGRS2  EQU   TCBGRS+8                                                 03928000
TCBGRS1  EQU   TCBGRS+4                                                 03929000
TCBGRS0  EQU   TCBGRS                                                   03930000
TCBJPQB  EQU   TCBJPQ+1                                                 03931000
TCBRSV15 EQU   TCBPURGE                                                 03932000
TCBRSV14 EQU   TCBPURGE                                                 03933000
TCBRSV13 EQU   TCBPURGE                                                 03934000
TCBRSV12 EQU   TCBPURGE                                                 03935000
TCBRSV11 EQU   TCBPURGE                                                 03936000
TCBRSV10 EQU   TCBPURGE                                                 03937000
TCBRSV09 EQU   TCBPURGE                                                 03938000
TCBJPQF  EQU   TCBPURGE                                                 03939000
TCBJLB   EQU   TCB+40                                                   03940000
TCBLLS   EQU   TCB+36                                                   03941000
TCBDSP   EQU   TCB+35                                                   03942000
TCBLMP   EQU   TCB+34                                                   03943000
TCBPNDSP EQU   TCBFLGS5                                                 03944000
TCBFCD1  EQU   TCBFLGS5                                                 03945000
TCBSTP   EQU   TCBFLGS5                                                 03946000
TCBSYS   EQU   TCBFLGS5                                                 03947000
TCBANDSP EQU   TCBFLGS5                                                 03948000
TCBPAGE  EQU   TCBFLGS5                                                 03949000
TCBUXNDF EQU   TCBABWF                                                  03950000
TCBFC    EQU   TCBFLGS5                                                 03951000
TCBONDSP EQU   TCBFLGS4                                                 03952000
TCBMPCND EQU   TCBFLGS4                                                 03953000
TCBMPCVQ EQU   TCBFLGS4                                                 03954000
TCBUXNDV EQU   TCBFLGS4                                                 03955000
TCBHNDSP EQU   TCBFLGS4                                                 03956000
TCBRQENA EQU   TCBFLGS4                                                 03957000
TCBSER   EQU   TCBFLGS4                                                 03958000
TCBNDUMP EQU   TCBFLGS4                                                 03959000
TCBDWSTA EQU   TCBFLGS3                                                 03960000
TCBRSV08 EQU   TCBFLGS3                                                 03961000
TCBRSV07 EQU   TCBFLGS3                                                 03962000
TCBRSV06 EQU   TCBFLGS3                                                 03963000
TCBABGM  EQU   TCBFLGS3                                                 03964000
TCBABTRM EQU   TCBFLGS3                                                 03965000
TCBADINP EQU   TCBFLGS3                                                 03966000
TCBFSM   EQU   TCBFLGS3                                                 03967000
TCBFTS   EQU   TCBFLGS2                                                 03968000
TCBFETXR EQU   TCBFLGS2                                                 03969000
TCBFDSOP EQU   TCBFLGS2                                                 03970000
TCBFJMC  EQU   TCBFLGS2                                                 03971000
TCBFSMC  EQU   TCBFLGS2                                                 03972000
TCBFABOP EQU   TCBFLGS2                                                 03973000
TCBFSTI  EQU   TCBFLGS2                                                 03974000
TCBFOINP EQU   TCBFLGS2                                                 03975000
TCBFX    EQU   TCBFLGS1                                                 03976000
TCBFS    EQU   TCBFLGS1                                                 03977000
TCBFT    EQU   TCBFLGS1                                                 03978000
TCBPDUMP EQU   TCBFLGS1                                                 03979000
TCBRSV04 EQU   TCBFLGS1                                                 03980000
TCBFERA  EQU   TCBFLGS1                                                 03981000
TCBFE    EQU   TCBFLGS1                                                 03982000
TCBFA    EQU   TCBFLGS1                                                 03983000
TCBZERO  EQU   TCBPKF                                                   03984000
TCBFLAG  EQU   TCBPKF                                                   03985000
TCBMSSB  EQU   TCBMSS+1                                                 03986000
TCBRSV03 EQU   TCBMSS                                                   03987000
TCBTRNB  EQU   TCBTRN+1                                                 03988000
TCBRSV02 EQU   TCBABF                                                   03989000
TCBOLTEP EQU   TCBABF                                                   03990000
TCBTCP   EQU   TCBABF                                                   03991000
TCBTCPP  EQU   TCBABF                                                   03992000
TCBRSV01 EQU   TCBABF                                                   03993000
TCBGRPH  EQU   TCBABF                                                   03994000
TCBNOCHK EQU   TCBABF                                                   03995000
TCBMOD91 EQU   TCBABF                                                   03996000
TCBCMPC  EQU   TCBCMP+1                                                 03997000
TCBRV318 EQU   TCBCMSG                                                  03998000
TCBRV317 EQU   TCBCIND                                                  03999000
TCBRV316 EQU   TCBCWTO                                                  04000000
TCBCASID EQU   TCBCDBL                                                  04001000
TCBNOCC  EQU   TCBSTCC                                                  04002000
TCBDMPO  EQU   TCBCPP                                                   04003000
TCBCSTEP EQU   TCBCMPF                                                  04004000
TCBCREQ  EQU   TCBCMPF                                                  04005000
TCBDEB   EQU   TCB+8                                                    04006000
TCBPIEA  EQU   TCBPIE+1                                                 04007000
TCBPM    EQU   TCBPMASK                                                 04008000
@NM00154 EQU   TCBPMASK                                                 04009000
TCBRBP   EQU   TCB                                                      04010000
TCBFRS6  EQU   TCBFRS+24                                                04011000
TCBFRS4  EQU   TCBFRS+16                                                04012000
TCBFRS2  EQU   TCBFRS+8                                                 04013000
TCBFRS0  EQU   TCBFRS                                                   04014000
@NM00153 EQU   SDWA+512                                                 04015000
@NM00152 EQU   SDWADPVA                                                 04016000
SDWAEBC  EQU   SDWADPVA                                                 04017000
SDWAHEX  EQU   SDWADPVA                                                 04018000
SDWAVRAL EQU   SDWARA                                                   04019000
@NM00151 EQU   SDWA+396                                                 04020000
SDWACOMP EQU   SDWA+392                                                 04021000
SDWARCPL EQU   SDWA+364                                                 04022000
@NM00150 EQU   SDWADPSA+32                                              04023000
SDWATO4  EQU   SDWADPSL+28                                              04024000
SDWAFRM4 EQU   SDWADPSL+24                                              04025000
SDWATO3  EQU   SDWADPSL+20                                              04026000
SDWAFRM3 EQU   SDWADPSL+16                                              04027000
SDWATO2  EQU   SDWADPSL+12                                              04028000
SDWAFRM2 EQU   SDWADPSL+8                                               04029000
SDWATO1  EQU   SDWADPSL+4                                               04030000
SDWAFRM1 EQU   SDWADPSL                                                 04031000
@NM00149 EQU   SDWADDAT+3                                               04032000
@NM00148 EQU   SDWAPDAT                                                 04033000
SDWAUSPL EQU   SDWAPDAT                                                 04034000
SDWADPSW EQU   SDWAPDAT                                                 04035000
SDWATJPA EQU   SDWAPDAT                                                 04036000
SDWATLPA EQU   SDWAPDAT                                                 04037000
SDWADREG EQU   SDWAPDAT                                                 04038000
SDWADSAH EQU   SDWAPDAT                                                 04039000
SDWADSAS EQU   SDWAPDAT                                                 04040000
@NM00147 EQU   SDWADDAT+1                                               04041000
@NM00146 EQU   SDWASDAT                                                 04042000
SDWAQQS  EQU   SDWASDAT                                                 04043000
SDWACBS  EQU   SDWASDAT                                                 04044000
SDWAGTF  EQU   SDWASDAT                                                 04045000
SDWASWA  EQU   SDWASDAT                                                 04046000
SDWALSQA EQU   SDWASDAT                                                 04047000
SDWASQA  EQU   SDWASDAT                                                 04048000
SDWANUC  EQU   SDWASDAT                                                 04049000
@NM00145 EQU   SDWADUMP+2                                               04050000
@NM00144 EQU   SDWADPFS                                                 04051000
SDWASLST EQU   SDWADPFS                                                 04052000
@NM00143 EQU   SDWADPFS                                                 04053000
SDWADLST EQU   SDWADPFS                                                 04054000
SDWADPT  EQU   SDWADPFS                                                 04055000
SDWADPID EQU   SDWADUMP                                                 04056000
SDWADPLA EQU   SDWA+316                                                 04057000
SDWAMODN EQU   SDWARECP                                                 04058000
@NM00142 EQU   SDWALKWA+32                                              04059000
SDWATALW EQU   SDWALKWS+28                                              04060000
SDWATDLW EQU   SDWALKWS+24                                              04061000
SDWATNLW EQU   SDWALKWS+20                                              04062000
SDWAAPLW EQU   SDWALKWS+16                                              04063000
SDWAIPLW EQU   SDWALKWS+12                                              04064000
SDWAILLW EQU   SDWALKWS+8                                               04065000
SDWAIULW EQU   SDWALKWS+4                                               04066000
SDWAICLW EQU   SDWALKWS                                                 04067000
SDWAFLLK EQU   SDWAACF4                                                 04068000
SDWACMS  EQU   SDWAACF4                                                 04069000
SDWAOPTM EQU   SDWAACF4                                                 04070000
SDWATADB EQU   SDWAACF4                                                 04071000
SDWATDNB EQU   SDWAACF4                                                 04072000
SDWATNCB EQU   SDWAACF4                                                 04073000
SDWAILCH EQU   SDWAACF4                                                 04074000
SDWAIUCB EQU   SDWAACF4                                                 04075000
SDWAICAT EQU   SDWAACF3                                                 04076000
SDWAIPRG EQU   SDWAACF3                                                 04077000
SDWASALL EQU   SDWAACF3                                                 04078000
SDWAASMP EQU   SDWAACF3                                                 04079000
SDWADISP EQU   SDWAACF3                                                 04080000
@NM00141 EQU   SDWAACF3                                                 04081000
@NM00140 EQU   SDWAACF2                                                 04082000
@NM00139 EQU   SDWAACF2                                                 04083000
SDWASPIN EQU   SDWAACF2                                                 04084000
@NM00138 EQU   SDWAACF2                                                 04085000
SDWALCPU EQU   SDWACPUA+2                                               04086000
@NM00137 EQU   SDWACPUA                                                 04087000
SDWARECA EQU   SDWA+244                                                 04088000
@NM00136 EQU   SDWA+239                                                 04089000
@NM00135 EQU   SDWAIOFS                                                 04090000
SDWANIOP EQU   SDWAIOFS                                                 04091000
SDWANOIO EQU   SDWAIOFS                                                 04092000
SDWAIOHT EQU   SDWAIOFS                                                 04093000
SDWAIOQR EQU   SDWAIOFS                                                 04094000
SDWAFMID EQU   SDWA+236                                                 04095000
@NM00134 EQU   SDWAERRD                                                 04096000
SDWAMCIV EQU   SDWAERRD                                                 04097000
SDWARPIV EQU   SDWAERRD                                                 04098000
SDWAMABD EQU   SDWAERRD                                                 04099000
SDWACTS  EQU   SDWAERRD                                                 04100000
SDWASTAE EQU   SDWAERRD                                                 04101000
SDWANRBE EQU   SDWAERRD                                                 04102000
@NM00133 EQU   SDWAERRC                                                 04103000
SDWAPERC EQU   SDWAERRC                                                 04104000
SDWAIRB  EQU   SDWAERRC                                                 04105000
SDWASTAI EQU   SDWAERRC                                                 04106000
SDWASRBM EQU   SDWAERRB                                                 04107000
SDWALDIS EQU   SDWAERRB                                                 04108000
SDWAENRB EQU   SDWAERRB                                                 04109000
SDWATYP1 EQU   SDWAERRB                                                 04110000
@NM00132 EQU   SDWAERRB                                                 04111000
SDWASVCE EQU   SDWAERRA                                                 04112000
SDWAABTM EQU   SDWAERRA                                                 04113000
SDWASVCD EQU   SDWAERRA                                                 04114000
SDWARKEY EQU   SDWAERRA                                                 04115000
SDWAPCHK EQU   SDWAERRA                                                 04116000
SDWATIME EQU   SDWAMCH+20                                               04117000
SDWARFSA EQU   SDWAMCH+16                                               04118000
@NM00131 EQU   SDWAMCH+14                                               04119000
SDWAVEQR EQU   SDWARSR2                                                 04120000
SDWAPGFX EQU   SDWARSR2                                                 04121000
SDWAFLSQ EQU   SDWARSR2                                                 04122000
SDWAFSQA EQU   SDWARSR2                                                 04123000
SDWANUCL EQU   SDWARSR2                                                 04124000
SDWASPER EQU   SDWARSR2                                                 04125000
SDWAINTC EQU   SDWARSR2                                                 04126000
SDWAOFLN EQU   SDWARSR2                                                 04127000
SDWACHNG EQU   SDWARSR1                                                 04128000
SDWAMSER EQU   SDWARSR1                                                 04129000
@NM00130 EQU   SDWARSR1                                                 04130000
SDWACPID EQU   SDWAMCH+10                                               04131000
SDWATERR EQU   SDWAMCHD                                                 04132000
SDWAFPRX EQU   SDWAMCHD                                                 04133000
SDWAINSF EQU   SDWAMCHD                                                 04134000
SDWAACR  EQU   SDWAMCHD                                                 04135000
SDWASCK  EQU   SDWAMCHD                                                 04136000
SDWAPSWU EQU   SDWAMCHD                                                 04137000
SDWAREGU EQU   SDWAMCHD                                                 04138000
SDWASKYF EQU   SDWAMCHD                                                 04139000
@NM00129 EQU   SDWAMCHS                                                 04140000
SDWARSRF EQU   SDWAMCHS                                                 04141000
SDWARSRC EQU   SDWAMCHS                                                 04142000
SDWAINVP EQU   SDWAMCHS                                                 04143000
SDWATSVL EQU   SDWAMCHS                                                 04144000
SDWARCDF EQU   SDWAMCHS                                                 04145000
SDWASRVL EQU   SDWAMCHS                                                 04146000
SDWASCKE EQU   SDWASTCK+4                                               04147000
SDWASCKB EQU   SDWASTCK                                                 04148000
SDWALNTH EQU   SDWAIDNT+1                                               04149000
SDWASPID EQU   SDWAIDNT                                                 04150000
SDWASR14 EQU   SDWASRSV+56                                              04151000
SDWASR13 EQU   SDWASRSV+52                                              04152000
SDWASR12 EQU   SDWASRSV+48                                              04153000
SDWASR11 EQU   SDWASRSV+44                                              04154000
SDWASR10 EQU   SDWASRSV+40                                              04155000
SDWASR06 EQU   SDWASRSV+24                                              04156000
SDWASR05 EQU   SDWASRSV+20                                              04157000
SDWASR04 EQU   SDWASRSV+16                                              04158000
SDWASR03 EQU   SDWASRSV+12                                              04159000
SDWASR02 EQU   SDWASRSV+8                                               04160000
SDWASR01 EQU   SDWASRSV+4                                               04161000
SDWATRN2 EQU   SDWAAEC2+4                                               04162000
SDWAIPC2 EQU   SDWAICD2                                                 04163000
SDWAIMC2 EQU   SDWAICD2                                                 04164000
SDWAIPR2 EQU   SDWAICD2                                                 04165000
@NM00128 EQU   SDWAINC2                                                 04166000
@NM00127 EQU   SDWAILC2                                                 04167000
SDWAIL2  EQU   SDWAILC2                                                 04168000
@NM00126 EQU   SDWAILC2                                                 04169000
@NM00125 EQU   SDWAAEC2                                                 04170000
SDWAADD2 EQU   SDWANXT2+1                                               04171000
@NM00124 EQU   SDWANXT2                                                 04172000
@NM00123 EQU   SDWAEC2+3                                                04173000
SDWASGN2 EQU   SDWAINT2                                                 04174000
SDWAEXP2 EQU   SDWAINT2                                                 04175000
SDWADEC2 EQU   SDWAINT2                                                 04176000
SDWAFPO2 EQU   SDWAINT2                                                 04177000
SDWACC2  EQU   SDWAINT2                                                 04178000
@NM00122 EQU   SDWAINT2                                                 04179000
SDWAPGM2 EQU   SDWAMWP2                                                 04180000
SDWAWAT2 EQU   SDWAMWP2                                                 04181000
SDWAMCK2 EQU   SDWAMWP2                                                 04182000
SDWAECT2 EQU   SDWAMWP2                                                 04183000
SDWAKEY2 EQU   SDWAMWP2                                                 04184000
SDWAEXT2 EQU   SDWAEMK2                                                 04185000
SDWAIO2  EQU   SDWAEMK2                                                 04186000
SDWATRM2 EQU   SDWAEMK2                                                 04187000
@NM00121 EQU   SDWAEMK2                                                 04188000
SDWAPER2 EQU   SDWAEMK2                                                 04189000
@NM00120 EQU   SDWAEMK2                                                 04190000
SDWATRAN EQU   SDWAAEC1+4                                               04191000
SDWAIPC1 EQU   SDWAICD1                                                 04192000
SDWAIMC1 EQU   SDWAICD1                                                 04193000
SDWAIPR1 EQU   SDWAICD1                                                 04194000
@NM00119 EQU   SDWAINC1                                                 04195000
@NM00118 EQU   SDWAILC1                                                 04196000
SDWAIL1  EQU   SDWAILC1                                                 04197000
@NM00117 EQU   SDWAILC1                                                 04198000
@NM00116 EQU   SDWAAEC1                                                 04199000
SDWAADD1 EQU   SDWANXT1+1                                               04200000
@NM00115 EQU   SDWANXT1                                                 04201000
@NM00114 EQU   SDWAEC1+3                                                04202000
SDWASGN1 EQU   SDWAINT1                                                 04203000
SDWAEXP1 EQU   SDWAINT1                                                 04204000
SDWADEC1 EQU   SDWAINT1                                                 04205000
SDWAFPO1 EQU   SDWAINT1                                                 04206000
SDWACC1  EQU   SDWAINT1                                                 04207000
@NM00113 EQU   SDWAINT1                                                 04208000
SDWAPGM1 EQU   SDWAMWP1                                                 04209000
SDWAWAT1 EQU   SDWAMWP1                                                 04210000
SDWAMCK1 EQU   SDWAMWP1                                                 04211000
SDWAECT1 EQU   SDWAMWP1                                                 04212000
SDWAKEY1 EQU   SDWAMWP1                                                 04213000
SDWAEXT1 EQU   SDWAEMK1                                                 04214000
SDWAIO1  EQU   SDWAEMK1                                                 04215000
SDWATRM1 EQU   SDWAEMK1                                                 04216000
@NM00112 EQU   SDWAEMK1                                                 04217000
SDWAPER1 EQU   SDWAEMK1                                                 04218000
@NM00111 EQU   SDWAEMK1                                                 04219000
SDWAIOBR EQU   SDWA+100                                                 04220000
SDWAEPA  EQU   SDWA+96                                                  04221000
@NM00110 EQU   SDWANAME+4                                               04222000
SDWARBAD EQU   SDWANAME                                                 04223000
SDWAGR15 EQU   SDWAGRSV+60                                              04224000
SDWAGR14 EQU   SDWAGRSV+56                                              04225000
SDWAGR13 EQU   SDWAGRSV+52                                              04226000
SDWAGR12 EQU   SDWAGRSV+48                                              04227000
SDWAGR11 EQU   SDWAGRSV+44                                              04228000
SDWAGR10 EQU   SDWAGRSV+40                                              04229000
SDWAGR09 EQU   SDWAGRSV+36                                              04230000
SDWAGR08 EQU   SDWAGRSV+32                                              04231000
SDWAGR07 EQU   SDWAGRSV+28                                              04232000
SDWAGR06 EQU   SDWAGRSV+24                                              04233000
SDWAGR05 EQU   SDWAGRSV+20                                              04234000
SDWAGR04 EQU   SDWAGRSV+16                                              04235000
SDWAGR03 EQU   SDWAGRSV+12                                              04236000
SDWAGR02 EQU   SDWAGRSV+8                                               04237000
SDWAGR01 EQU   SDWAGRSV+4                                               04238000
SDWAGR00 EQU   SDWAGRSV                                                 04239000
SDWANXTP EQU   SDWACTL2+5                                               04240000
SDWASGP  EQU   SDWAPMKP                                                 04241000
SDWAEUP  EQU   SDWAPMKP                                                 04242000
SDWADOP  EQU   SDWAPMKP                                                 04243000
SDWAFPP  EQU   SDWAPMKP                                                 04244000
SDWACCP  EQU   SDWAPMKP                                                 04245000
SDWAILP  EQU   SDWAPMKP                                                 04246000
SDWAINTP EQU   SDWACTL2+2                                               04247000
SDWASPVP EQU   SDWAMWPP                                                 04248000
SDWAWATP EQU   SDWAMWPP                                                 04249000
SDWAMCKP EQU   SDWAMWPP                                                 04250000
@NM00109 EQU   SDWAMWPP                                                 04251000
SDWAKEYP EQU   SDWAMWPP                                                 04252000
SDWAEXTP EQU   SDWACMKP                                                 04253000
SDWAIOP  EQU   SDWACMKP                                                 04254000
SDWANXTA EQU   SDWACTL1+5                                               04255000
SDWASGA  EQU   SDWAPMKA                                                 04256000
SDWAEUA  EQU   SDWAPMKA                                                 04257000
SDWADOA  EQU   SDWAPMKA                                                 04258000
SDWAFPA  EQU   SDWAPMKA                                                 04259000
SDWACCA  EQU   SDWAPMKA                                                 04260000
SDWAILA  EQU   SDWAPMKA                                                 04261000
SDWAINTA EQU   SDWACTL1+2                                               04262000
SDWASPVA EQU   SDWAMWPA                                                 04263000
SDWAWATA EQU   SDWAMWPA                                                 04264000
SDWAMCKA EQU   SDWAMWPA                                                 04265000
@NM00108 EQU   SDWAMWPA                                                 04266000
SDWAKEYA EQU   SDWAMWPA                                                 04267000
SDWAEXTA EQU   SDWACMKA                                                 04268000
SDWAIOA  EQU   SDWACMKA                                                 04269000
@NM00107 EQU   SDWACMPF                                                 04270000
SDWASTCC EQU   SDWACMPF                                                 04271000
@NM00106 EQU   SDWACMPF                                                 04272000
SDWASTEP EQU   SDWACMPF                                                 04273000
SPDPTRSW EQU   SPDBLKID                                                 04274000
SIRBEND  EQU   RBSECT+168                                               04275000
SVRBEND  EQU   RBSECT+168                                               04276000
RBRSV158 EQU   RBRSV150                                                 04277000
RBRSV157 EQU   RBRSV150                                                 04278000
RBRSV156 EQU   RBRSV150                                                 04279000
RBRSV155 EQU   RBRSV150                                                 04280000
RBRSV154 EQU   RBRSV150                                                 04281000
RBRSV153 EQU   RBRSV150                                                 04282000
RBRSV152 EQU   RBRSV150                                                 04283000
RBRSV151 EQU   RBRSV150                                                 04284000
RBRSV149 EQU   RBSECT+166                                               04285000
RBRSV148 EQU   RBSECT+164                                               04286000
RBSCBB   EQU   RBSECT+144                                               04287000
TIRBEND  EQU   @NM00102+8                                               04288000
PRBEND   EQU   @NM00102+8                                               04289000
RBRSV146 EQU   RBRSV138                                                 04290000
RBRSV145 EQU   RBRSV138                                                 04291000
RBRSV144 EQU   RBRSV138                                                 04292000
RBRSV143 EQU   RBRSV138                                                 04293000
RBRSV142 EQU   RBRSV138                                                 04294000
RBRSV141 EQU   RBRSV138                                                 04295000
RBRSV140 EQU   RBRSV138                                                 04296000
RBRSV139 EQU   RBRSV138                                                 04297000
RBRSV137 EQU   @NM00102+6                                               04298000
RBRSV136 EQU   @NM00102+4                                               04299000
RBRSV135 EQU   @NM00102                                                 04300000
@NM00101 EQU   RBSECT+32                                                04301000
@NM00100 EQU   @NM00098+1                                               04302000
@NM00099 EQU   @NM00098                                                 04303000
RBPGMQ1  EQU   RBPGMQ+1                                                 04304000
@NM00097 EQU   RBPGMQ                                                   04305000
@NM00096 EQU   RBSECT+16                                                04306000
@NM00095 EQU   @NM00091                                                 04307000
@NM00094 EQU   @NM00091                                                 04308000
RBIQETP  EQU   @NM00091                                                 04309000
RBUSIQE  EQU   RBETXR                                                   04310000
RBATTN   EQU   @NM00091                                                 04311000
@NM00093 EQU   @NM00091                                                 04312000
@NM00092 EQU   @NM00091                                                 04313000
RBRSV007 EQU   @NM00089                                                 04314000
RBATNXIT EQU   @NM00089                                                 04315000
@NM00090 EQU   @NM00089                                                 04316000
RBWAITP  EQU   @NM00089                                                 04317000
RBFNSVRB EQU   RBTRSVRB                                                 04318000
RBFTP    EQU   @NM00089                                                 04319000
RBSIZE   EQU   RBSECT+8                                                 04320000
RBABOPSW EQU   RBSECT+4                                                 04321000
RBPPSAV1 EQU   RBPPSAV+1                                                04322000
@NM00087 EQU   RBPPSAV                                                  04323000
RBPRFXND EQU   RBPREFIX+64                                              04324000
RBINTCOD EQU   RBINTCDA+1                                               04325000
RBINLNTH EQU   RBINTCDA                                                 04326000
RBWCSA   EQU   RBPREFIX+60                                              04327000
RBRSV004 EQU   RBPREFIX+57                                              04328000
RBSSSYN  EQU   RBFLAGS1                                                 04329000
RBSCB    EQU   RBFLAGS1                                                 04330000
RBLONGWT EQU   RBFLAGS1                                                 04331000
RBASIR   EQU   RBFLAGS1                                                 04332000
RBRSV159 EQU   RBFLAGS1                                                 04333000
RBABEND  EQU   RBFLAGS1                                                 04334000
RBXWAIT  EQU   RBFLAGS1                                                 04335000
RBSLOCK  EQU   RBFLAGS1                                                 04336000
RBRTRAN  EQU   RBRTPSW2+4                                               04337000
RBRTINCD EQU   RBRTICIL+2                                               04338000
RBRTILC  EQU   RBRTICIL+1                                               04339000
RBRSV160 EQU   RBRTICIL                                                 04340000
RBRTPSW1 EQU   RBRTOPSW                                                 04341000
RBRSV062 EQU   RBRSV054                                                 04342000
RBRSV061 EQU   RBRSV054                                                 04343000
RBRSV060 EQU   RBRSV054                                                 04344000
RBRSV059 EQU   RBRSV054                                                 04345000
RBRSV058 EQU   RBRSV054                                                 04346000
RBRSV057 EQU   RBRSV054                                                 04347000
RBRSV056 EQU   RBRSV054                                                 04348000
RBRSV055 EQU   RBRSV054                                                 04349000
RBRSV053 EQU   RBPREFIX+38                                              04350000
RBRSV052 EQU   RBPREFIX+36                                              04351000
RBRSV051 EQU   RBPREFIX+32                                              04352000
RBPRFXST EQU   RBPREFIX+32                                              04353000
RBRSV050 EQU   RBPREFIX+28                                              04354000
RBRSV049 EQU   RBRSV041                                                 04355000
RBRSV048 EQU   RBRSV041                                                 04356000
RBRSV047 EQU   RBRSV041                                                 04357000
RBRSV046 EQU   RBRSV041                                                 04358000
RBRSV045 EQU   RBRSV041                                                 04359000
RBRSV044 EQU   RBRSV041                                                 04360000
RBRSV043 EQU   RBRSV041                                                 04361000
RBRSV042 EQU   RBRSV041                                                 04362000
RBRSV040 EQU   RBPREFIX+26                                              04363000
RBRSV039 EQU   RBPREFIX+24                                              04364000
RBRSV038 EQU   RBPREFIX+20                                              04365000
RBRSV037 EQU   RBPREFIX+16                                              04366000
RBRSV036 EQU   RBRSV028                                                 04367000
RBRSV035 EQU   RBRSV028                                                 04368000
RBRSV034 EQU   RBRSV028                                                 04369000
RBRSV033 EQU   RBRSV028                                                 04370000
RBRSV032 EQU   RBRSV028                                                 04371000
RBRSV031 EQU   RBRSV028                                                 04372000
RBRSV030 EQU   RBRSV028                                                 04373000
RBRSV029 EQU   RBRSV028                                                 04374000
RBRSV027 EQU   RBRSV019                                                 04375000
RBRSV026 EQU   RBRSV019                                                 04376000
RBRSV025 EQU   RBRSV019                                                 04377000
RBRSV024 EQU   RBRSV019                                                 04378000
RBRSV023 EQU   RBRSV019                                                 04379000
RBRSV022 EQU   RBRSV019                                                 04380000
RBRSV021 EQU   RBRSV019                                                 04381000
RBRSV020 EQU   RBRSV019                                                 04382000
RBRSV018 EQU   RBPREFIX+13                                              04383000
RBRSV017 EQU   RBPREFIX+12                                              04384000
RBSRV016 EQU   RBPREFIX+11                                              04385000
RBRSV015 EQU   RBPREFIX+10                                              04386000
RBRSV014 EQU   RBPREFIX+8                                               04387000
RBRSV013 EQU   RBPREFIX+4                                               04388000
RBRSV012 EQU   RBPREFIX                                                 04389000
XRBREG15 EQU   RBGRS15                                                  04390000
XRBREG14 EQU   RBGRS14                                                  04391000
XRBREG13 EQU   RBGRS13                                                  04392000
XRBREG12 EQU   RBGRS12                                                  04393000
XRBREG11 EQU   RBGRS11                                                  04394000
XRBREG10 EQU   RBGRS10                                                  04395000
XRBREG9  EQU   RBGRS9                                                   04396000
XRBREG8  EQU   RBGRS8                                                   04397000
XRBREG7  EQU   RBGRS7                                                   04398000
XRBREG6  EQU   RBGRS6                                                   04399000
XRBREG5  EQU   RBGRS5                                                   04400000
XRBREG4  EQU   RBGRS4                                                   04401000
XRBREG3  EQU   RBGRS3                                                   04402000
XRBREG2  EQU   RBGRS2                                                   04403000
XRBREG1  EQU   RBGRS1                                                   04404000
XRBREG0  EQU   RBGRS0                                                   04405000
XRBLNKA  EQU   RBLINKB                                                  04406000
XRBWT    EQU   RBWCF                                                    04407000
@NM00086 EQU   RBBASIC+24                                               04408000
XRBPSW   EQU   RBOPSW                                                   04409000
@NM00085 EQU   RBBASIC+12                                               04410000
XRBWAIT  EQU   RBECBWT                                                  04411000
XRBFRRB  EQU   RBFDYN                                                   04412000
@NM00084 EQU   XSTAB2                                                   04413000
XRBACTV  EQU   RBFACTV                                                  04414000
XRBTCBP  EQU   RBTCBNXT                                                 04415000
@NM00083 EQU   XSTAB1                                                   04416000
XRBCKPT  EQU   RBFTCKPT                                                 04417000
@NM00082 EQU   XSTAB1                                                   04418000
@NM00081 EQU   RBBASIC+8                                                04419000
@NM00080 EQU   RBEXRTNM+1                                               04420000
RBTMIND3 EQU   RBTMFLD                                                  04421000
RBTMIND2 EQU   RBTMFLD                                                  04422000
RBTMCMP  EQU   RBTMFLD                                                  04423000
RBWLIM   EQU   RBTMFLD                                                  04424000
RBRSV005 EQU   RBTMFLD                                                  04425000
RBTMTOD  EQU   RBTMFLD                                                  04426000
RBTMQUE  EQU   RBTMFLD                                                  04427000
@NM00079 EQU   RBPRFX                                                   04428000
IOBERRCT EQU   IOBSTDRD+30                                              04429000
IOBRSV19 EQU   IOBINCAM+1                                               04430000
IOBOLTST EQU   IOBBTAMF                                                 04431000
IOBRFTMG EQU   IOBBTAMF                                                 04432000
IOBRSV17 EQU   IOBBTAMF                                                 04433000
IOBRSV16 EQU   IOBBTAMF                                                 04434000
IOBRSV15 EQU   IOBBTAMF                                                 04435000
IOBRSV14 EQU   IOBBTAMF                                                 04436000
IOBINUSE EQU   IOBBTAMF                                                 04437000
IOBPRMER EQU   IOBBTAMF                                                 04438000
IOBRSTRB EQU   IOBRESTR+1                                               04439000
IOBREPOS EQU   IOBRESTR                                                 04440000
IOBDCBPB EQU   IOBDCBPT+1                                               04441000
IOBRSV44 EQU   IOBFLAG4                                                 04442000
IOBRSV43 EQU   IOBFLAG4                                                 04443000
IOBRSV42 EQU   IOBFLAG4                                                 04444000
IOBRSV41 EQU   IOBFLAG4                                                 04445000
IOBRSV40 EQU   IOBFLAG4                                                 04446000
IOBRSV39 EQU   IOBFLAG4                                                 04447000
IOBRSV38 EQU   IOBFLAG4                                                 04448000
IOBGDPOL EQU   IOBFLAG4                                                 04449000
IOBSTRTB EQU   IOBSTART+1                                               04450000
IOBSIOCC EQU   IOBSTART                                                 04451000
IOBSTBYT EQU   IOBIOCSW+3                                               04452000
IOBCMDA  EQU   IOBIOCSW                                                 04453000
IOBLOG   EQU   IOBFL3                                                   04454000
IOBICL   EQU   IOBFL3                                                   04455000
IOBMSG   EQU   IOBFL3                                                   04456000
IOBCNC   EQU   IOBFL3                                                   04457000
IOBACU   EQU   IOBFL3                                                   04458000
IOBCDC   EQU   IOBFL3                                                   04459000
IOBICC   EQU   IOBFL3                                                   04460000
IOBCCC   EQU   IOBFL3                                                   04461000
IOBECBPB EQU   IOBECBPT+1                                               04462000
IOBECBCC EQU   IOBECBPT                                                 04463000
IOBS1B7  EQU   IOBSENS1                                                 04464000
IOBS1B6  EQU   IOBSENS1                                                 04465000
IOBS1B5  EQU   IOBSENS1                                                 04466000
IOBS1B4  EQU   IOBSENS1                                                 04467000
IOBS1B3  EQU   IOBSENS1                                                 04468000
IOBS1B2  EQU   IOBSENS1                                                 04469000
IOBS1B1  EQU   IOBSENS1                                                 04470000
IOBS1B0  EQU   IOBSENS1                                                 04471000
IOBSNSC9 EQU   IOBS0B7                                                  04472000
IOBS0B6  EQU   IOBSENS0                                                 04473000
IOBS0B5  EQU   IOBSENS0                                                 04474000
IOBS0B4  EQU   IOBSENS0                                                 04475000
IOBS0B3  EQU   IOBSENS0                                                 04476000
IOBS0B2  EQU   IOBSENS0                                                 04477000
IOBS0B1  EQU   IOBSENS0                                                 04478000
IOBS0B0  EQU   IOBSENS0                                                 04479000
IOBPNCH  EQU   IOBFLAG2                                                 04480000
IOBSTATO EQU   IOBFLAG2                                                 04481000
IOBSKUPD EQU   IOBFLAG2                                                 04482000
IOBALTTR EQU   IOBFLAG2                                                 04483000
IOBRRT2  EQU   IOBRDHA0                                                 04484000
IOBRRT3  EQU   IOBPURGE                                                 04485000
IOBSENSE EQU   IOBFLAG2                                                 04486000
IOBHALT  EQU   IOBFLAG2                                                 04487000
IOBSPSVC EQU   IOBRSTRT                                                 04488000
IOBUNREL EQU   IOBFLAG1                                                 04489000
IOBIOERR EQU   IOBFLAG1                                                 04490000
IOBFCREX EQU   IOBCYCCK                                                 04491000
IOBRPSTN EQU   IOBFLAG1                                                 04492000
IOBERRTN EQU   IOBFLAG1                                                 04493000
IOBCMDCH EQU   IOBFLAG1                                                 04494000
IOBDATCH EQU   IOBFLAG1                                                 04495000
IOBCNOPA EQU   IOBPREFX+12                                              04496000
IOBCICB  EQU   IOBPREFX+8                                               04497000
IOBCECB  EQU   IOBPREFX+4                                               04498000
IOBCONOP EQU   IOBPREFX+3                                               04499000
IOBCINOP EQU   IOBPREFX+2                                               04500000
IOBRSV05 EQU   IOBPREFX+1                                               04501000
IOBPCI   EQU   IOBCFLG1                                                 04502000
IOBRSTCH EQU   IOBCFLG1                                                 04503000
IOBABAPP EQU   IOBCFLG1                                                 04504000
IOBPTST  EQU   IOBCFLG1                                                 04505000
IOBRSV04 EQU   IOBCFLG1                                                 04506000
IOBRSV03 EQU   IOBCFLG1                                                 04507000
IOBRSV02 EQU   IOBCFLG1                                                 04508000
IOBRSV01 EQU   IOBCFLG1                                                 04509000
DSABGRID EQU   DSABGIDL+4                                               04510000
DSABLLEN EQU   DSABGIDL                                                 04511000
DSABANAM EQU   DSABANMI+1                                               04512000
DSABANML EQU   DSABANMI                                                 04513000
DSABRS04 EQU   DSAB+68                                                  04514000
DSABSIOT EQU   DSAB+64                                                  04515000
DSABRS03 EQU   DSAB+62                                                  04516000
DSABDCBM EQU   DSAB+56                                                  04517000
DSABSSCM EQU   DSAB+52                                                  04518000
DSABSSNM EQU   DSAB+48                                                  04519000
DSABPTTR EQU   DSAB+44                                                  04520000
DSABTCBP EQU   DSAB+40                                                  04521000
DSABRS02 EQU   DSAB+38                                                  04522000
@NM00054 EQU   DSABFLG4                                                 04523000
DSABCKSI EQU   DSABFLG4                                                 04524000
DSABCKVL EQU   DSABFLG4                                                 04525000
DSABCKDS EQU   DSABFLG4                                                 04526000
@NM00053 EQU   DSABFLG3                                                 04527000
DSABJSCT EQU   DSABFLG3                                                 04528000
DSABCATL EQU   DSABFLG3                                                 04529000
DSABVMSC EQU   DSABFLG3                                                 04530000
DSABVAM  EQU   DSABFLG3                                                 04531000
DSABPASS EQU   DSABFLG3                                                 04532000
DSABDEFR EQU   DSABFLG3                                                 04533000
@NM00052 EQU   DSABFLG2                                                 04534000
DSABUNAL EQU   DSABFLG2                                                 04535000
DSABIRM  EQU   DSABFLG2                                                 04536000
DSABOPEN EQU   DSABFLG2                                                 04537000
DSABNUSE EQU   DSABFLG1                                                 04538000
DSABCATM EQU   DSABFLG1                                                 04539000
DSABPCAT EQU   DSABFLG1                                                 04540000
DSABDCAT EQU   DSABFLG1                                                 04541000
DSABCONV EQU   DSABFLG1                                                 04542000
DSABDCNV EQU   DSABFLG1                                                 04543000
DSABPALC EQU   DSABFLG1                                                 04544000
DSABDALC EQU   DSABFLG1                                                 04545000
@NM00051 EQU   DSABORG2                                                 04546000
DSABTR   EQU   DSABORG2                                                 04547000
DSABAM   EQU   DSABORG2                                                 04548000
@NM00050 EQU   DSABORG2                                                 04549000
DSABTQ   EQU   DSABORG2                                                 04550000
DSABTX   EQU   DSABORG2                                                 04551000
DSABGS   EQU   DSABORG2                                                 04552000
DSABU    EQU   DSABORG1                                                 04553000
DSABPO   EQU   DSABORG1                                                 04554000
DSABMQ   EQU   DSABORG1                                                 04555000
DSABCQ   EQU   DSABORG1                                                 04556000
DSABCX   EQU   DSABORG1                                                 04557000
DSABDA   EQU   DSABORG1                                                 04558000
DSABPS   EQU   DSABORG1                                                 04559000
DSABIS   EQU   DSABORG1                                                 04560000
DSABSSVA EQU   DSAB+21                                                  04561000
DSABRS01 EQU   DSAB+20                                                  04562000
DSABOPCT EQU   DSAB+14                                                  04563000
DSABLNTH EQU   DSAB+12                                                  04564000
DSABBCHN EQU   DSAB+8                                                   04565000
DSABFCHN EQU   DSAB+4                                                   04566000
DSABID   EQU   DSAB                                                     04567000
DECWAREA EQU   DECBS04+44                                               04568000
DECWLNG  EQU   DECBS04+42                                               04569000
DECRSV56 EQU   DECBS04+40                                               04570000
DECPOLPA EQU   DECPOLPT+1                                               04571000
DECNDXPL EQU   DECPOLPT                                                 04572000
DECADRPT EQU   DECBS04+32                                               04573000
DECCSWST EQU   DECBS04+30                                               04574000
DECRSV55 EQU   DECERRST                                                 04575000
DECRSV54 EQU   DECERRST                                                 04576000
DECRSV53 EQU   DECERRST                                                 04577000
DECDSABL EQU   DECERRST                                                 04578000
DECDIAGN EQU   DECERRST                                                 04579000
DECERPER EQU   DECERRST                                                 04580000
DECUNDEF EQU   DECERRST                                                 04581000
DECSIO3  EQU   DECERRST                                                 04582000
DECTPCOD EQU   DECBS04+28                                               04583000
DECRESPN EQU   DECBS04+26                                               04584000
DECRLN   EQU   DECBS04+25                                               04585000
DECSTXNQ EQU   DECFLAGS                                                 04586000
DECSSMSG EQU   DECREVRS                                                 04587000
DECNEGRP EQU   DECFLAGS                                                 04588000
DECNOBUF EQU   DECFLAGS                                                 04589000
DECBADID EQU   DECFLAGS                                                 04590000
DECALTAC EQU   DECFLAGS                                                 04591000
DECDIFAC EQU   DECWACK                                                  04592000
DECERRMS EQU   DECWACK                                                  04593000
DECENTRA EQU   DECENTRY+1                                               04594000
DECCMCOD EQU   DECENTRY                                                 04595000
DECCOUNT EQU   DECBS04+18                                               04596000
DECSENS1 EQU   DECBS04+17                                               04597000
DECSENS0 EQU   DECBS04+16                                               04598000
@NM00049 EQU   DECBS04+12                                               04599000
DECDCBAA EQU   @NM00048+1                                               04600000
DECRSV52 EQU   DECONLTT                                                 04601000
DECRSV51 EQU   DECONLTT                                                 04602000
DECRSV50 EQU   DECONLTT                                                 04603000
DECRSV49 EQU   DECONLTT                                                 04604000
DECRSV48 EQU   DECONLTT                                                 04605000
DECRSV47 EQU   DECONLTT                                                 04606000
DECRCVMS EQU   DECONLTT                                                 04607000
DECONLTS EQU   DECONLTT                                                 04608000
@NM00047 EQU   DECBS04+6                                                04609000
@NM00046 EQU   @NM00044+1                                               04610000
DECSLNTH EQU   @NM00045                                                 04611000
DECSAREA EQU   @NM00045                                                 04612000
DECSTRME EQU   @NM00045                                                 04613000
DECRSV46 EQU   @NM00045                                                 04614000
DECRSV45 EQU   @NM00045                                                 04615000
DECRSV44 EQU   @NM00045                                                 04616000
DECRSV43 EQU   @NM00045                                                 04617000
DECRDAPL EQU   @NM00045                                                 04618000
@NM00043 EQU   DECBS04                                                  04619000
@NM00042 EQU   @NM00041+1                                               04620000
DECRSV42 EQU   @NM00041                                                 04621000
DECADRCH EQU   DECBS03+32                                               04622000
DECRSV41 EQU   DECBS03+28                                               04623000
DECRSV40 EQU   DECBS03+26                                               04624000
DECUCBDX EQU   DECBS03+25                                               04625000
DECRSV39 EQU   DECBS03+24                                               04626000
DECCPOLA EQU   DECCPOL+1                                                04627000
DECNMMSG EQU   DECCPOL                                                  04628000
DECRSV38 EQU   DECBS03+16                                               04629000
@NM00040 EQU   DECBS03+12                                               04630000
@NM00039 EQU   DECBS03+8                                                04631000
@NM00038 EQU   DECBS03+6                                                04632000
DECOPCOD EQU   DECBS03+5                                                04633000
DECRSV37 EQU   DECBS03+4                                                04634000
LINEDECB EQU   DECBS03                                                  04635000
DECNAA   EQU   DECNA+1                                                  04636000
DECRSV36 EQU   DECNA                                                    04637000
DECRECPT EQU   DECBS02+24                                               04638000
@NM00037 EQU   DECBS02+16                                               04639000
@NM00036 EQU   DECBS02+12                                               04640000
@NM00035 EQU   DECBS02+8                                                04641000
@NM00034 EQU   DECBS02+6                                                04642000
DECRSV35 EQU   @NM00033                                                 04643000
DECWRADD EQU   @NM00033                                                 04644000
DECSRKEY EQU   @NM00033                                                 04645000
DECOPRD  EQU   @NM00033                                                 04646000
DECTYPR  EQU   DECTYPRU                                                 04647000
DECTYPU  EQU   DECTYPRU                                                 04648000
DECBKLNS EQU   @NM00033                                                 04649000
DECRELBA EQU   @NM00032                                                 04650000
DECRDEX  EQU   @NM00032                                                 04651000
DECDYNBF EQU   @NM00032                                                 04652000
DECACTAD EQU   @NM00032                                                 04653000
DECFDBCK EQU   @NM00032                                                 04654000
DECEXSRC EQU   @NM00032                                                 04655000
DECOFLOW EQU   @NM00032                                                 04656000
DECVERFY EQU   @NM00032                                                 04657000
DECRSV34 EQU   @NM00029+3                                               04658000
DECCCKFF EQU   DECCC3                                                   04659000
DECCCOPT EQU   DECCC3                                                   04660000
DECCCSDK EQU   DECCC3                                                   04661000
DECCCWDI EQU   DECCC3                                                   04662000
DECCCNBK EQU   DECCC3                                                   04663000
DECCCEXS EQU   DECCC3                                                   04664000
DECCCWRI EQU   DECCC3                                                   04665000
DECRSV33 EQU   DECCC3                                                   04666000
DECCCREX EQU   DECCC2                                                   04667000
DECCCUER EQU   DECCC2                                                   04668000
DECCCEOD EQU   DECCC2                                                   04669000
DECCCERR EQU   DECCC2                                                   04670000
DECCCINV EQU   DECCC2                                                   04671000
DECCCNSP EQU   DECCC2                                                   04672000
DECCCRLC EQU   DECCC2                                                   04673000
DECCCRNF EQU   DECCC2                                                   04674000
@NM00030 EQU   @NM00029                                                 04675000
DECEXRKU EQU   DECBEXC2                                                 04676000
DECEXASR EQU   DECBEXC2                                                 04677000
DECRSV32 EQU   DECBEXC2                                                 04678000
DECRSV31 EQU   DECBEXC2                                                 04679000
DECRSV30 EQU   DECBEXC2                                                 04680000
DECRSV29 EQU   DECBEXC2                                                 04681000
DECRSV28 EQU   DECBEXC2                                                 04682000
DECRSV27 EQU   DECBEXC2                                                 04683000
DECEXDUP EQU   DECBEXC1                                                 04684000
DECEXOFL EQU   DECBEXC1                                                 04685000
DECEXUBK EQU   DECBEXC1                                                 04686000
DECEXERR EQU   DECBEXC1                                                 04687000
DECEXINV EQU   DECBEXC1                                                 04688000
DECEXNSP EQU   DECBEXC1                                                 04689000
DECEXRLC EQU   DECBEXC1                                                 04690000
DECEXRNF EQU   DECBEXC1                                                 04691000
DECBKEY  EQU   DECBS01+20                                               04692000
DECBLOGR EQU   DECBS01+16                                               04693000
DECBAREA EQU   DECBS01+12                                               04694000
DECBDCBA EQU   DECBS01+8                                                04695000
DECBLGTH EQU   DECBS01+6                                                04696000
DECRSV26 EQU   DECBTYP2                                                 04697000
DECRSV25 EQU   DECBTYP2                                                 04698000
DECBWRKN EQU   DECBTYP2                                                 04699000
DECBWRK  EQU   DECBTYP2                                                 04700000
DECRSV24 EQU   DECBTYP2                                                 04701000
DECBRDKU EQU   DECBTYP2                                                 04702000
DECRSV23 EQU   DECBTYP2                                                 04703000
DECBRDK  EQU   DECBTYP2                                                 04704000
DECBARS  EQU   DECBTYP1                                                 04705000
DECBLNS  EQU   DECBTYP1                                                 04706000
DECRSV22 EQU   DECBTYP1                                                 04707000
DECRSV21 EQU   DECBTYP1                                                 04708000
DECRSV20 EQU   DECBTYP1                                                 04709000
DECRSV19 EQU   DECBTYP1                                                 04710000
DECRSV18 EQU   DECBTYP1                                                 04711000
DECRSV17 EQU   DECBTYP1                                                 04712000
DECBRBA  EQU   DECBRB+1                                                 04713000
DECRSV16 EQU   DECBECBF                                                 04714000
DECRSV15 EQU   DECBECBF                                                 04715000
DECRSV14 EQU   DECBECBF                                                 04716000
DECRSV13 EQU   DECBECBF                                                 04717000
DECRSV12 EQU   DECBECBF                                                 04718000
DECRSV11 EQU   DECBECBF                                                 04719000
DECBPOST EQU   DECBECBF                                                 04720000
DECBWAIT EQU   DECBECBF                                                 04721000
DECNEXTA EQU   DECNEXT+1                                                04722000
DECRSV10 EQU   DECNEXT                                                  04723000
DECIOBPT EQU   DECB+16                                                  04724000
DECDCBAD EQU   DECB+8                                                   04725000
DECLNGTH EQU   DECBPTR+2                                                04726000
DECWRSFR EQU   DECTYPE2                                                 04727000
DECRSV09 EQU   DECTYPE2                                                 04728000
DECWRSZ  EQU   DECTYPE2                                                 04729000
DECRSV08 EQU   DECTYPE2                                                 04730000
DECWRSD  EQU   DECTYPE2                                                 04731000
DECWRSF  EQU   DECTYPE2                                                 04732000
DECRDSB  EQU   DECTYPE2                                                 04733000
DECRDSF  EQU   DECTYPE2                                                 04734000
DECRSV07 EQU   DECTYPE1                                                 04735000
DECRSV06 EQU   DECTYPE1                                                 04736000
DECRSV05 EQU   DECTYPE1                                                 04737000
DECRSV04 EQU   DECTYPE1                                                 04738000
DECRSV03 EQU   DECTYPE1                                                 04739000
DECRSV02 EQU   DECTYPE1                                                 04740000
DECRSV01 EQU   DECTYPE1                                                 04741000
DECLNS   EQU   DECTYPE1                                                 04742000
DECSDECB EQU   DECB                                                     04743000
DEBXRV40 EQU   DEBXTN+28                                                04744000
DEBXRV39 EQU   DEBXTN+24                                                04745000
DEBXXARG EQU   DEBXTN+20                                                04746000
DEBXMCF2 EQU   DEBXTN+19                                                04747000
DEBXMCF1 EQU   DEBXTN+18                                                04748000
DEBXDSO2 EQU   DEBXTN+17                                                04749000
DEBXDSO1 EQU   DEBXTN+16                                                04750000
DEBXDBPR EQU   DEBXTN+12                                                04751000
DEBXDCBM EQU   DEBXTN+8                                                 04752000
DEBXRV48 EQU   DEBXTN+3                                                 04753000
DEBXRV47 EQU   DEBXFLG1                                                 04754000
DEBXRV46 EQU   DEBXFLG1                                                 04755000
DEBXRV45 EQU   DEBXFLG1                                                 04756000
DEBXRV44 EQU   DEBXFLG1                                                 04757000
DEBXRV43 EQU   DEBXFLG1                                                 04758000
DEBXRV42 EQU   DEBXFLG1                                                 04759000
DEBXTSKC EQU   DEBXFLG1                                                 04760000
DEBXCDCB EQU   DEBXFLG1                                                 04761000
DEBXLNGH EQU   DEBXTN                                                   04762000
DEBAMTYP EQU   DEBPREFX+13                                              04763000
DEBLNGTH EQU   DEBPREFX+12                                              04764000
DEBDCBMK EQU   DEBXTNP                                                  04765000
DEBDSCBA EQU   DEBPREFX+1                                               04766000
DEBWKARA EQU   DEBPREFX                                                 04767000
DEBXCEAD EQU   DEBXCEA+1                                                04768000
DEBXCENP EQU   DEBXCEAB                                                 04769000
DEBRSV35 EQU   DEBXCEAB                                                 04770000
DEBRSV34 EQU   DEBXCEAB                                                 04771000
DEBRSV33 EQU   DEBXCEAB                                                 04772000
DEBRSV32 EQU   DEBXCEAB                                                 04773000
DEBCEAD  EQU   DEBCEA+1                                                 04774000
DEBCENP  EQU   DEBCEAB                                                  04775000
DEBRSV31 EQU   DEBCEAB                                                  04776000
DEBRSV30 EQU   DEBCEAB                                                  04777000
DEBRSV29 EQU   DEBCEAB                                                  04778000
DEBRSV28 EQU   DEBCEAB                                                  04779000
DEBPCIAD EQU   DEBPCIA+1                                                04780000
DEBPCINP EQU   DEBPCIAB                                                 04781000
DEBRSV27 EQU   DEBPCIAB                                                 04782000
DEBRSV26 EQU   DEBPCIAB                                                 04783000
DEBRSV25 EQU   DEBPCIAB                                                 04784000
DEBRSV24 EQU   DEBPCIAB                                                 04785000
DEBSIOAD EQU   DEBSIOA+1                                                04786000
DEBSIONP EQU   DEBSIOAB                                                 04787000
DEBRSV23 EQU   DEBSIOAB                                                 04788000
DEBIOVR  EQU   DEBSIOAB                                                 04789000
DEBSIOX  EQU   DEBSIOAB                                                 04790000
DEBPGFX  EQU   DEBSIOAB                                                 04791000
DEBEOEAD EQU   DEBEOEA+1                                                04792000
DEBEOENP EQU   DEBEOEAB                                                 04793000
DEBRSV22 EQU   DEBEOEAB                                                 04794000
DEBRSV21 EQU   DEBEOEAB                                                 04795000
DEBRSV20 EQU   DEBEOEAB                                                 04796000
DEBRSV19 EQU   DEBEOEAB                                                 04797000
DEBSUBID EQU   DEBSUBNM                                                 04798000
DEBSIOA2 EQU   DEBACS08+24                                              04799000
DEBRPSIO EQU   DEBACS08+20                                              04800000
DEBFREED EQU   DEBACS08+16                                              04801000
@NM00028 EQU   DEBACS08+12                                              04802000
@NM00027 EQU   DEBACS08+8                                               04803000
DEBDISAD EQU   DEBACS08+4                                               04804000
@NM00026 EQU   DEBACS08                                                 04805000
DEBRPSST EQU   DEBACS07+64                                              04806000
DEBARECK EQU   DEBACS07+60                                              04807000
DEBAREWT EQU   DEBACS07+56                                              04808000
DEBACHK  EQU   DEBACS07+52                                              04809000
DEBAWRIT EQU   DEBACS07+48                                              04810000
DEBASETL EQU   DEBACS07+44                                              04811000
DEBAREAD EQU   DEBACS07+40                                              04812000
DEBCRECK EQU   DEBACS07+36                                              04813000
DEBCREWT EQU   DEBACS07+32                                              04814000
DEBCCHK  EQU   DEBACS07+28                                              04815000
DEBCWRIT EQU   DEBACS07+24                                              04816000
DEBCSETL EQU   DEBACS07+20                                              04817000
DEBCREAD EQU   DEBACS07+16                                              04818000
DEBWKPT5 EQU   DEBACS07+12                                              04819000
DEBWKPT4 EQU   DEBACS07+8                                               04820000
DEBGET   EQU   DEBACS07+4                                               04821000
@NM00025 EQU   DEBACS07                                                 04822000
DEBPUT   EQU   DEBACS06+4                                               04823000
DEBDCBFA EQU   DEBACS06                                                 04824000
DEBLUCBB EQU   DEBLUCBA+1                                               04825000
DEBRSV18 EQU   DEBLUCBA                                                 04826000
DEBFUCBB EQU   DEBFUCBA+1                                               04827000
DEBRSV17 EQU   DEBFUCBA                                                 04828000
DEBTCCWB EQU   DEBTCCWA+1                                               04829000
DEBRSV16 EQU   DEBTCCWA                                                 04830000
DEBTBFRB EQU   DEBTBFRA+1                                               04831000
DEBRSV15 EQU   DEBTBFRA                                                 04832000
DEBDBPEF EQU   DEBACS03+8                                               04833000
DEBDBPP  EQU   DEBACS03+4                                               04834000
DEBDTPP  EQU   DEBACS03                                                 04835000
DEBDBPE  EQU   DEBDBLK+1                                                04836000
DEBDBPT  EQU   DEBDBLK                                                  04837000
DEBEXTNM EQU   DEBDSNAM                                                 04838000
DEBRSV14 EQU   DEBDSNM+4                                                04839000
DEBUTSAB EQU   DEBUTSAA+1                                               04840000
DEBRSV13 EQU   DEBUTSAA                                                 04841000
DEBVOLNM EQU   DEBACSMD+2                                               04842000
DEBVLSEQ EQU   DEBVOLSQ+1                                               04843000
DEBRSV42 EQU   DEBVOLBT                                                 04844000
DEBRSV41 EQU   DEBVOLBT                                                 04845000
DEBRSV40 EQU   DEBVOLBT                                                 04846000
DEBRSV39 EQU   DEBVOLBT                                                 04847000
DEBRSV38 EQU   DEBVOLBT                                                 04848000
DEBRSV37 EQU   DEBVOLBT                                                 04849000
DEBRSV36 EQU   DEBVOLBT                                                 04850000
DEBEXFUL EQU   DEBVOLBT                                                 04851000
DEBNMTRK EQU   DEBDASD+14                                               04852000
DEBENDHH EQU   DEBDASD+12                                               04853000
DEBENDCC EQU   DEBDASD+10                                               04854000
DEBSTRHH EQU   DEBDASD+8                                                04855000
DEBSTRCC EQU   DEBDASD+6                                                04856000
DEBBINUM EQU   DEBDASD+4                                                04857000
DEBUCBA  EQU   DEBUCBAD+1                                               04858000
DEBDVMOD EQU   DEBUCBAD                                                 04859000
DEBAPPB  EQU   DEBAPPAD+1                                               04860000
DEBEXSCL EQU   DEBAPPAD                                                 04861000
DEBDEBID EQU   DEBPROTG                                                 04862000
DEBECBB  EQU   DEBECBAD+1                                               04863000
DEBPRIOR EQU   DEBECBAD                                                 04864000
DEBUSRPB EQU   DEBUSRPG+1                                               04865000
DEBNMEXT EQU   DEBUSRPG                                                 04866000
DEBRSV05 EQU   DEBBASIC+15                                              04867000
DEBXTNIN EQU   DEBFLGS1                                                 04868000
DEBAPFIN EQU   DEBFLGS1                                                 04869000
DEBF1CEV EQU   DEBFLGS1                                                 04870000
DEBCINDI EQU   DEBFLGS1                                                 04871000
DEBRSV02 EQU   DEBFLGS1                                                 04872000
DEBRSV01 EQU   DEBFLGS1                                                 04873000
DEBEOFDF EQU   DEBFLGS1                                                 04874000
DEBPWCKD EQU   DEBFLGS1                                                 04875000
DEBQSCNT EQU   DEBBASIC+13                                              04876000
DEBACCS  EQU   DEBOPATB                                                 04877000
DEBPOSIT EQU   DEBOPATB                                                 04878000
DEBZERO  EQU   DEBOPATB                                                 04879000
DEBABEND EQU   DEBOPATB                                                 04880000
DEBIRBB  EQU   DEBIRBAD+1                                               04881000
DEBRERR  EQU   DEBOFLGS                                                 04882000
DEBLABEL EQU   DEBOFLGS                                                 04883000
DEBSPLIT EQU   DEBOFLGS                                                 04884000
DEBDCB   EQU   DEBOFLGS                                                 04885000
DEBRLSE  EQU   DEBOFLGS                                                 04886000
DEBEOF   EQU   DEBOFLGS                                                 04887000
DEBDISP  EQU   DEBOFLGS                                                 04888000
DEBDEBB  EQU   DEBDEBAD+1                                               04889000
DEBAMLNG EQU   DEBDEBAD                                                 04890000
DEBTCBB  EQU   DEBTCBAD+1                                               04891000
DEBNMSUB EQU   DEBTCBAD                                                 04892000
DCBDFBK  EQU   IHADCS30+44                                              04893000
DCBDFOR  EQU   IHADCS30+40                                              04894000
DCBDRDXA EQU   DCBDRDX+1                                                04895000
DCBMVXNO EQU   DCBDRDX                                                  04896000
DCBXARGA EQU   DCBXARG+1                                                04897000
DCBXCNT  EQU   DCBXARG                                                  04898000
DCBLIMCT EQU   IHADCS30+29                                              04899000
@NM00024 EQU   IHADCS30+28                                              04900000
DCBUQND  EQU   IHADCS30+24                                              04901000
DCBIOBUQ EQU   IHADCS30+20                                              04902000
DCBSQND  EQU   IHADCS30+16                                              04903000
DCBIOBSQ EQU   IHADCS30+12                                              04904000
DCBBLKSI EQU   IHADCS30+10                                              04905000
@NM00023 EQU   IHADCS30+8                                               04906000
DCBSYNAD EQU   IHADCS30+4                                               04907000
DCBCHCKA EQU   DCBCHECK+1                                               04908000
DCBOPTRB EQU   DCBOPTCD                                                 04909000
DCBOPTRE EQU   DCBOPTCD                                                 04910000
DCBOPTDB EQU   DCBOPTCD                                                 04911000
DCBOPTA  EQU   DCBOPTCD                                                 04912000
DCBOPTF  EQU   DCBOPTCD                                                 04913000
DCBOPTE  EQU   DCBOPTCD                                                 04914000
DCBOPTTO EQU   DCBOPTCD                                                 04915000
DCBOPTW  EQU   DCBOPTCD                                                 04916000
DCBREADA EQU   DCBWRITA                                                 04917000
@NM00022 EQU   DCBREAD                                                  04918000
@NM00021 EQU   DCBIFLGS                                                 04919000
DCBIFIOE EQU   DCBIFLGS                                                 04920000
DCBIFPCT EQU   DCBIFLGS                                                 04921000
DCBIFEC  EQU   DCBIFLGS                                                 04922000
DCBMFSTI EQU   DCBMFDMD                                                 04923000
DCBMFAWR EQU   DCBMFSTK                                                 04924000
DCBMFUIP EQU   DCBMFTMD                                                 04925000
DCBMFIDW EQU   DCBMFLCP                                                 04926000
DCBMFWRK EQU   DCBMFMVP                                                 04927000
DCBMFRDQ EQU   DCBMFWRT                                                 04928000
DCBMFGTQ EQU   DCBMFPUT                                                 04929000
DCBMFSTL EQU   DCBMACF2                                                 04930000
DCBMFCK  EQU   DCBMFDMG                                                 04931000
DCBMFRDX EQU   DCBMFCHK                                                 04932000
DCBMFDBF EQU   DCBMFSBG                                                 04933000
DCBMFRDI EQU   DCBMFLCG                                                 04934000
DCBMFRDK EQU   DCBMFMVG                                                 04935000
DCBMFWRQ EQU   DCBMFRD                                                  04936000
DCBMFPTQ EQU   DCBMFGET                                                 04937000
DCBMFECP EQU   DCBMACF1                                                 04938000
DCBTIOT  EQU   IHADCS25                                                 04939000
DCBMRSTI EQU   DCBMRDMD                                                 04940000
DCBMRAWR EQU   DCBMRSTK                                                 04941000
DCBMRUIP EQU   DCBMRTMD                                                 04942000
DCBMRIDW EQU   DCBMRLCP                                                 04943000
DCBMRWRK EQU   DCBMRMVP                                                 04944000
DCBMRRDQ EQU   DCBMRWRT                                                 04945000
DCBMRGTQ EQU   DCBMRPUT                                                 04946000
DCBMRSTL EQU   DCBMACR2                                                 04947000
DCBMRCK  EQU   DCBMRDMG                                                 04948000
DCBPGFXA EQU   DCBMRRDX                                                 04949000
DCBMRDBF EQU   DCBMRSBG                                                 04950000
DCBMRRDI EQU   DCBMRLCG                                                 04951000
DCBMRRDK EQU   DCBMRMVG                                                 04952000
DCBMRWRQ EQU   DCBMRRD                                                  04953000
DCBMRPTQ EQU   DCBMRGET                                                 04954000
DCBMRECP EQU   DCBMACR1                                                 04955000
@NM00020 EQU   DCBIFLG                                                  04956000
DCBIBIOE EQU   DCBIFLG                                                  04957000
DCBIBPCT EQU   DCBIFLG                                                  04958000
DCBIBEC  EQU   DCBIFLG                                                  04959000
DCBOFIOF EQU   DCBOFLGS                                                 04960000
DCBOFUEX EQU   DCBOFLGS                                                 04961000
DCBOFTM  EQU   DCBOFLGS                                                 04962000
DCBOFPPC EQU   DCBOFLGS                                                 04963000
DCBOFEOV EQU   DCBOFLGS                                                 04964000
DCBOFLRB EQU   DCBOFLGS                                                 04965000
DCBOFIOD EQU   DCBOFLWR                                                 04966000
DCBDDNAM EQU   IHADCS24                                                 04967000
DCBEXLSA EQU   DCBEXLST+1                                               04968000
DCBRECKL EQU   DCBRECFM                                                 04969000
DCBRECCC EQU   DCBRECFM                                                 04970000
DCBRECSB EQU   DCBRECFM                                                 04971000
DCBRECBR EQU   DCBRECFM                                                 04972000
DCBRECTO EQU   DCBRECLA                                                 04973000
DCBRECL  EQU   DCBRECLA                                                 04974000
DCBEODA  EQU   DCBEODAD+1                                               04975000
DCBBFA   EQU   DCBBFTEK                                                 04976000
DCBH0    EQU   DCBBFTEK                                                 04977000
DCBBFTKD EQU   DCBBFTEK                                                 04978000
DCBBFTE  EQU   DCBBFT                                                   04979000
DCBBFTS  EQU   DCBBFT                                                   04980000
DCBH1    EQU   DCBBFTEK                                                 04981000
DCBSVCXA EQU   DCBSVCXL+1                                               04982000
@NM00019 EQU   DCBSVCXL                                                 04983000
DCBODEBA EQU   DCBIOBAA                                                 04984000
@NM00018 EQU   DCBQSLM                                                  04985000
DCBUPDBT EQU   DCBQSLM                                                  04986000
DCBUPDCM EQU   DCBQSLM                                                  04987000
DCB1DVDS EQU   DCBQSLM                                                  04988000
@NM00017 EQU   DCBDSRG2                                                 04989000
DCBDSGTR EQU   DCBDSRG2                                                 04990000
DCBACBM  EQU   DCBDSRG2                                                 04991000
@NM00016 EQU   DCBDSRG2                                                 04992000
DCBDSGTQ EQU   DCBDSRG2                                                 04993000
DCBDSGTX EQU   DCBDSRG2                                                 04994000
DCBDSGGS EQU   DCBDSRG2                                                 04995000
DCBDSGU  EQU   DCBDSRG1                                                 04996000
DCBDSGPO EQU   DCBDSRG1                                                 04997000
DCBDSGMQ EQU   DCBDSRG1                                                 04998000
DCBDSGCQ EQU   DCBDSRG1                                                 04999000
DCBDSGCX EQU   DCBDSRG1                                                 05000000
DCBDSGDA EQU   DCBDSRG1                                                 05001000
DCBDSGPS EQU   DCBDSRG1                                                 05002000
DCBDSGIS EQU   DCBDSRG1                                                 05003000
DCBBUFL  EQU   IHADCS11+8                                               05004000
DCBBUFCA EQU   DCBBUFCB+1                                               05005000
DCBBUFNO EQU   DCBBUFCB                                                 05006000
DCBDEVT  EQU   DCBREL                                                   05007000
DCBKEYLE EQU   DCBRELB                                                  05008000
DCBTRBAL EQU   IHADCS01+6                                               05009000
@NM00015 EQU   IHADCS01+5                                               05010000
@NM00014 EQU   IHADCS01+4                                               05011000
DCBDVTBA EQU   DCBDVTBL+1                                               05012000
@NM00013 EQU   DCBDVTBL                                                 05013000
DCBKEYCN EQU   IHADCS00+4                                               05014000
DCBRELAD EQU   IHADCS00                                                 05015000
@NM00012 EQU   IHADCB                                                   05016000
CVTLEVL  EQU   CVTRELNO+2                                               05017000
CVTNUMB  EQU   CVTRELNO                                                 05018000
CVTMDL   EQU   CVTFIX+250                                               05019000
@NM00011 EQU   CVTFIX+248                                               05020000
@NM00010 EQU   CVTFIX                                                   05021000
CVTRV482 EQU   CVTXTNT2+128                                             05022000
CVTRV481 EQU   CVTXTNT2+124                                             05023000
CVTRV480 EQU   CVTXTNT2+120                                             05024000
CVTRV479 EQU   CVTXTNT2+118                                             05025000
CVTRV478 EQU   CVTXTNT2+117                                             05026000
CVTRV477 EQU   CVTXTNT2+116                                             05027000
CVTRV476 EQU   CVTXTNT2+115                                             05028000
CVTRV475 EQU   CVTXTNT2+114                                             05029000
CVTRV474 EQU   CVTRV466                                                 05030000
CVTRV473 EQU   CVTRV466                                                 05031000
CVTRV472 EQU   CVTRV466                                                 05032000
CVTRV471 EQU   CVTRV466                                                 05033000
CVTRV470 EQU   CVTRV466                                                 05034000
CVTRV469 EQU   CVTRV466                                                 05035000
CVTRV468 EQU   CVTRV466                                                 05036000
CVTRV467 EQU   CVTRV466                                                 05037000
CVTRV465 EQU   CVTRV457                                                 05038000
CVTRV464 EQU   CVTRV457                                                 05039000
CVTRV463 EQU   CVTRV457                                                 05040000
CVTRV462 EQU   CVTRV457                                                 05041000
CVTRV461 EQU   CVTRV457                                                 05042000
CVTRV460 EQU   CVTRV457                                                 05043000
CVTRV459 EQU   CVTRV457                                                 05044000
CVTRV458 EQU   CVTRV457                                                 05045000
CVTRV456 EQU   CVTXTNT2+108                                             05046000
CVTRV455 EQU   CVTXTNT2+104                                             05047000
CVTRV454 EQU   CVTXTNT2+100                                             05048000
CVTRV453 EQU   CVTXTNT2+96                                              05049000
CVTRV452 EQU   CVTXTNT2+94                                              05050000
CVTRV451 EQU   CVTXTNT2+92                                              05051000
CVTRV450 EQU   CVTXTNT2+90                                              05052000
CVTRV449 EQU   CVTXTNT2+88                                              05053000
CVTRV448 EQU   CVTXTNT2+87                                              05054000
CVTRV447 EQU   CVTXTNT2+86                                              05055000
CVTRV446 EQU   CVTRV438                                                 05056000
CVTRV445 EQU   CVTRV438                                                 05057000
CVTRV444 EQU   CVTRV438                                                 05058000
CVTRV443 EQU   CVTRV438                                                 05059000
CVTRV442 EQU   CVTRV438                                                 05060000
CVTRV441 EQU   CVTRV438                                                 05061000
CVTRV440 EQU   CVTRV438                                                 05062000
CVTRV439 EQU   CVTRV438                                                 05063000
CVTRV437 EQU   CVTRV429                                                 05064000
CVTRV436 EQU   CVTRV429                                                 05065000
CVTRV435 EQU   CVTRV429                                                 05066000
CVTRV434 EQU   CVTRV429                                                 05067000
CVTRV433 EQU   CVTRV429                                                 05068000
CVTRV432 EQU   CVTRV429                                                 05069000
CVTRV431 EQU   CVTRV429                                                 05070000
CVTRV430 EQU   CVTRV429                                                 05071000
CVTRV428 EQU   CVTXTNT2+80                                              05072000
CVTRV427 EQU   CVTXTNT2+76                                              05073000
CVTRV426 EQU   CVTXTNT2+72                                              05074000
CVTRV425 EQU   CVTXTNT2+68                                              05075000
CVTATACT EQU   CVTATCVT                                                 05076000
CVTRV423 EQU   CVTXTNT2+62                                              05077000
CVTRV422 EQU   CVTXTNT2+60                                              05078000
CVTRV421 EQU   CVTXTNT2+58                                              05079000
CVTRV420 EQU   CVTXTNT2+56                                              05080000
CVTRV419 EQU   CVTXTNT2+55                                              05081000
CVTRV418 EQU   CVTXTNT2+54                                              05082000
CVTRV417 EQU   CVTRV409                                                 05083000
CVTRV416 EQU   CVTRV409                                                 05084000
CVTRV415 EQU   CVTRV409                                                 05085000
CVTRV414 EQU   CVTRV409                                                 05086000
CVTRV413 EQU   CVTRV409                                                 05087000
CVTRV412 EQU   CVTRV409                                                 05088000
CVTRV411 EQU   CVTRV409                                                 05089000
CVTRV410 EQU   CVTRV409                                                 05090000
CVTRV408 EQU   CVTRV400                                                 05091000
CVTRV407 EQU   CVTRV400                                                 05092000
CVTRV406 EQU   CVTRV400                                                 05093000
CVTRV405 EQU   CVTRV400                                                 05094000
CVTRV404 EQU   CVTRV400                                                 05095000
CVTRV403 EQU   CVTRV400                                                 05096000
CVTRV402 EQU   CVTRV400                                                 05097000
CVTRV401 EQU   CVTRV400                                                 05098000
CVTRSVA1 EQU   CVTXTNT2+48                                              05099000
CVTRSVA0 EQU   CVTXTNT2+44                                              05100000
CVTRSV99 EQU   CVTXTNT2+40                                              05101000
CVTRSV98 EQU   CVTXTNT2+36                                              05102000
CVTRSV97 EQU   CVTXTNT2+34                                              05103000
CVTRSV96 EQU   CVTXTNT2+32                                              05104000
CVTOLTEP EQU   CVTXTNT2+28                                              05105000
CVTQIDA  EQU   CVTQID+1                                                 05106000
CVTRSV95 EQU   CVTQID                                                   05107000
CVTRSV94 EQU   CVTXTNT2+20                                              05108000
CVTRSV93 EQU   CVTXTNT2+16                                              05109000
CVTRSV92 EQU   CVTXTNT2+12                                              05110000
CVTRSV91 EQU   CVTXTNT2+6                                               05111000
CVTRSV9H EQU   CVTRSV90                                                 05112000
CVTRSV9G EQU   CVTRSV90                                                 05113000
CVTRSV9F EQU   CVTRSV90                                                 05114000
CVTRSV9E EQU   CVTRSV90                                                 05115000
CVTRSV9D EQU   CVTRSV90                                                 05116000
CVTRSV9C EQU   CVTRSV90                                                 05117000
CVTRSV9B EQU   CVTRSV90                                                 05118000
CVTRSV9A EQU   CVTRSV90                                                 05119000
CVTNUCLS EQU   CVTXTNT2+4                                               05120000
CVTDSSVA EQU   CVTDSSV+1                                                05121000
CVTRSV89 EQU   CVTDSSV                                                  05122000
CVTRSV88 EQU   CVTXTNT1+8                                               05123000
CVTRSV87 EQU   CVTXTNT1+4                                               05124000
CVTFACHN EQU   CVTXTNT1                                                 05125000
CVTRV488 EQU   CVTMAP+412                                               05126000
CVTRV487 EQU   CVTMAP+408                                               05127000
CVTRV486 EQU   CVTMAP+404                                               05128000
CVTRV485 EQU   CVTMAP+400                                               05129000
CVTRV484 EQU   CVTMAP+396                                               05130000
CVTAUTH  EQU   CVTMAP+392                                               05131000
CVTATMCA EQU   CVTATMCT+1                                               05132000
CVTATMST EQU   CVTATMCT                                                 05133000
CVTRSV61 EQU   CVTMAP+384                                               05134000
CVTVOLT1 EQU   CVTVOLM1+1                                               05135000
CVTVOLI1 EQU   CVTVOLF1                                                 05136000
CVTSTOA  EQU   CVTMAP+376                                               05137000
CVTRSV58 EQU   CVTMAP+374                                               05138000
CVTRSV57 EQU   CVTMAP+372                                               05139000
CVTDDCE  EQU   CVTMAP+368                                               05140000
CVTPNWFR EQU   CVTMAP+364                                               05141000
CVTSMF   EQU   CVTMAP+360                                               05142000
CVTSULK  EQU   CVTMAP+358                                               05143000
CVTSLKO  EQU   CVTSYSK                                                  05144000
CVTSLKP  EQU   CVTSYSK                                                  05145000
CVTSLKQ  EQU   CVTSYSK                                                  05146000
CVTSLKR  EQU   CVTSYSK                                                  05147000
CVTRSV56 EQU   CVTSYSK                                                  05148000
CVTRSV55 EQU   CVTSYSK                                                  05149000
CVTRSV54 EQU   CVTSYSK                                                  05150000
CVTRSV53 EQU   CVTSYSK                                                  05151000
CVTRSV52 EQU   CVTA1F1                                                  05152000
CVTRSV51 EQU   CVTA1F1                                                  05153000
CVTRSV50 EQU   CVTA1F1                                                  05154000
CVTRSV49 EQU   CVTA1F1                                                  05155000
CVTRSV48 EQU   CVTA1F1                                                  05156000
CVTRSV47 EQU   CVTA1F1                                                  05157000
CVTSRSW  EQU   CVTA1F1                                                  05158000
CVTPFSW  EQU   CVTA1F1                                                  05159000
CVTPCVT  EQU   CVTMAP+352                                               05160000
CVTRSV46 EQU   CVTMAP+344                                               05161000
CVTRSV45 EQU   CVTMAP+340                                               05162000
CVTRSV44 EQU   CVTMAP+338                                               05163000
CVTRSV43 EQU   CVTMAP+336                                               05164000
CVTHJESA EQU   CVTHJES+1                                                05165000
CVTRSV42 EQU   CVTHJES                                                  05166000
CVTEXT2A EQU   CVTEXT2+1                                                05167000
CVTRSV41 EQU   CVTEXT2                                                  05168000
CVTAPFA  EQU   CVTAPF+1                                                 05169000
CVTRSV40 EQU   CVTAPF                                                   05170000
CVTRV518 EQU   CVTINTLA                                                 05171000
CVTRV517 EQU   CVTERPV                                                  05172000
CVTEORM  EQU   CVTMAP+312                                               05173000
CVTMCHPR EQU   CVTMAP+308                                               05174000
CVTTZ    EQU   CVTMAP+304                                               05175000
CVTJEPS  EQU   CVTMAP+300                                               05176000
CVTJESCT EQU   CVTMAP+296                                               05177000
CVTMODE  EQU   CVTMAP+292                                               05178000
CVTPTRV  EQU   CVTMAP+288                                               05179000
CVTREAL  EQU   CVTMAP+284                                               05180000
CVTRSV39 EQU   CVTMAP+280                                               05181000
CVTRSV38 EQU   CVTMAP+276                                               05182000
CVTDMSRA EQU   CVTDMSR+1                                                05183000
CVTRSV37 EQU   CVTDMSR                                                  05184000
CVTQMSGA EQU   CVTQMSG+1                                                05185000
CVTRSV36 EQU   CVTQMSG                                                  05186000
CVTAMFF  EQU   CVTMAP+264                                               05187000
CVTPURGA EQU   CVTPURG+1                                                05188000
CVTRSV35 EQU   CVTPURG                                                  05189000
CVTCBSP  EQU   CVTMAP+256                                               05190000
CVTATERA EQU   CVTATER+1                                                05191000
CVTSYST  EQU   CVTATER                                                  05192000
CVTVOLT2 EQU   CVTTAT                                                   05193000
CVTVOLI2 EQU   CVTVOLF2                                                 05194000
CVTAQAVB EQU   CVTAQAVT+1                                               05195000
CVTRSV34 EQU   CVTTCMFG                                                 05196000
CVTRSV33 EQU   CVTTCMFG                                                 05197000
CVTRSV32 EQU   CVTTCMFG                                                 05198000
CVTRSV31 EQU   CVTTCMFG                                                 05199000
CVTRSV30 EQU   CVTTCMFG                                                 05200000
CVTRSV29 EQU   CVTTCMFG                                                 05201000
CVTRSV28 EQU   CVTTCMFG                                                 05202000
CVTTCRDY EQU   CVTTCMFG                                                 05203000
CVTGTFA  EQU   CVTGTF+1                                                 05204000
CVTRSV27 EQU   CVTGTFST                                                 05205000
CVTRNIO  EQU   CVTGTFST                                                 05206000
CVTRV319 EQU   CVTUSR                                                   05207000
CVTRV318 EQU   CVTFORM                                                  05208000
CVTRV317 EQU   CVTTMODE                                                 05209000
CVTRV316 EQU   CVTSTATE                                                 05210000
CVTRV315 EQU   CVTGTFS                                                  05211000
CVTGTFAV EQU   CVTGTFS                                                  05212000
CVT0SCR1 EQU   CVTMAP+232                                               05213000
CVTRV515 EQU   CVTMAP+228                                               05214000
CVTRMS   EQU   CVTMAP+224                                               05215000
CVTPATCH EQU   CVTMAP+220                                               05216000
CVTTSCE  EQU   CVTMAP+216                                               05217000
CVTLNKSC EQU   CVTMAP+214                                               05218000
CVTQABST EQU   CVTMAP+212                                               05219000
CVTMDLDS EQU   CVTMAP+208                                               05220000
CVTUSER  EQU   CVTMAP+204                                               05221000
CVTABEND EQU   CVTMAP+200                                               05222000
CVTSMCA  EQU   CVTMAP+196                                               05223000
CVTRSV18 EQU   CVTMAP+192                                               05224000
CVTQLPAQ EQU   CVTMAP+188                                               05225000
CVTQCDSR EQU   CVTMAP+184                                               05226000
CVTRSV17 EQU   CVTOPTB                                                  05227000
CVTRSV16 EQU   CVTOPTB                                                  05228000
CVTFP    EQU   CVTOPTB                                                  05229000
CVTAPTHR EQU   CVTOPTB                                                  05230000
CVTNLOG  EQU   CVTOPTB                                                  05231000
CVTTOD   EQU   CVTOPTB                                                  05232000
CVTCTIMS EQU   CVTOPTB                                                  05233000
CVTPROT  EQU   CVTOPTB                                                  05234000
CVTXPFP  EQU   CVTOPTA                                                  05235000
CVTASCII EQU   CVTOPTA                                                  05236000
CVTRSV13 EQU   CVTOPTA                                                  05237000
CVTRSV12 EQU   CVTOPTA                                                  05238000
CVTNIP   EQU   CVTOPTA                                                  05239000
CVTDDR   EQU   CVTOPTA                                                  05240000
CVTAPR   EQU   CVTOPTA                                                  05241000
CVTCCH   EQU   CVTOPTA                                                  05242000
CVTSNCTR EQU   CVTMAP+180                                               05243000
CVTQMWR  EQU   CVTMAP+176                                               05244000
CVTQOCR  EQU   CVTMAP+172                                               05245000
CVT1EF00 EQU   CVTMAP+168                                               05246000
CVTMZ00  EQU   CVTMAP+164                                               05247000
CVTHEAD  EQU   CVTMAP+160                                               05248000
CVTRSV11 EQU   CVTMAP+156                                               05249000
CVT0PT01 EQU   CVTMAP+152                                               05250000
CVTMSER  EQU   CVTMAP+148                                               05251000
CVTRV516 EQU   CVTIERLC                                                 05252000
CVTILCH  EQU   CVTMAP+140                                               05253000
CVT0DS   EQU   CVTMAP+136                                               05254000
CVTFBOSV EQU   CVTMAP+132                                               05255000
CVTNUCB  EQU   CVTMAP+128                                               05256000
CVTIXAVL EQU   CVTMAP+124                                               05257000
CVTIOQET EQU   CVTMAP+120                                               05258000
CVTDCBA  EQU   CVTMAP+117                                               05259000
CVTMVS2  EQU   CVTDCB                                                   05260000
CVT6DAT  EQU   CVTDCB                                                   05261000
CVT4MPS  EQU   CVTDCB                                                   05262000
CVTRSV09 EQU   CVTDCB                                                   05263000
CVT4MS1  EQU   CVTDCB                                                   05264000
CVT2SPS  EQU   CVTDCB                                                   05265000
CVT1SSS  EQU   CVTDCB                                                   05266000
CVTRSV08 EQU   CVTDCB                                                   05267000
CVTSTB   EQU   CVTMAP+112                                               05268000
CVTQTD00 EQU   CVTMAP+108                                               05269000
CVTQTE00 EQU   CVTMAP+104                                               05270000
CVTCUCB  EQU   CVTMAP+100                                               05271000
CVTSJQ   EQU   CVTMAP+96                                                05272000
CVTPBLDL EQU   CVTMAP+92                                                05273000
CVTTPC   EQU   CVTMAP+88                                                05274000
CVTSVDCB EQU   CVTMAP+84                                                05275000
CVTBRET  EQU   CVTMAP+82                                                05276000
CVTEXIT  EQU   CVTMAP+80                                                05277000
CVT0FN00 EQU   CVTMAP+76                                                05278000
CVTDARA  EQU   CVTDAR+1                                                 05279000
CVTRSV07 EQU   CVTFLGS1                                                 05280000
CVTRSV06 EQU   CVTFLGS1                                                 05281000
CVTRSV05 EQU   CVTFLGS1                                                 05282000
CVTRSV04 EQU   CVTFLGS1                                                 05283000
CVTRSV03 EQU   CVTFLGS1                                                 05284000
CVTRSV02 EQU   CVTFLGS1                                                 05285000
CVTRSV01 EQU   CVTFLGS1                                                 05286000
CVTDMPLK EQU   CVTFLGS1                                                 05287000
CVTXITP  EQU   CVTMAP+68                                                05288000
CVTZDTAB EQU   CVTMAP+64                                                05289000
CVTMSLT  EQU   CVTMAP+60                                                05290000
CVTDATE  EQU   CVTMAP+56                                                05291000
CVTBTERM EQU   CVTMAP+52                                                05292000
CVTSYSAD EQU   CVTMAP+48                                                05293000
CVTXTLER EQU   CVTMAP+44                                                05294000
CVTILK2  EQU   CVTMAP+40                                                05295000
CVTILK1  EQU   CVTMAP+36                                                05296000
CVTPRLTV EQU   CVTMAP+32                                                05297000
CVTPCNVT EQU   CVTMAP+28                                                05298000
CVTXAPG  EQU   CVTMAP+20                                                05299000
CVTBUF   EQU   CVTMAP+16                                                05300000
CVTJOB   EQU   CVTMAP+12                                                05301000
CVTLINK  EQU   CVTMAP+8                                                 05302000
CVT0EF00 EQU   CVTMAP+4                                                 05303000
CVTTCBP  EQU   CVTMAP                                                   05304000
CVT      EQU   CVTMAP                                                   05305000
BCBBFLG  EQU   BCBDEFS+6                                                05306000
BCBBFNUM EQU   BCBDEFS+4                                                05307000
BCBNXBUF EQU   BCBDEFS                                                  05308000
BCBFRQB  EQU   BCBIOBS+4                                                05309000
BCBRAOFS EQU   BCBDEFV+9                                                05310000
BCBBUFL  EQU   BCBDEFV+4                                                05311000
BCBBUF1  EQU   BCBDEFV                                                  05312000
LRIDATA  EQU   LRIALIGN                                                 05313000
@NM00008 EQU   LRIAREA+22                                               05314000
LRICOUNT EQU   LRIAREA+20                                               05315000
LRINXIOB EQU   LRINIOB+1                                                05316000
@NM00007 EQU   LRINIOB                                                  05317000
LRIRECAD EQU   LRITRKAD+5                                               05318000
LRIMBBCC EQU   LRITRKAD                                                 05319000
LRIPOS   EQU   LRILOC+6                                                 05320000
LRIINDEX EQU   LRILOC+5                                                 05321000
LRIASSEM EQU   LRIFLG2                                                  05322000
@NM00006 EQU   LRIFLG2                                                  05323000
LRINTSPN EQU   LRIFLG2                                                  05324000
@NM00005 EQU   LRIFLG2                                                  05325000
LRISEG   EQU   LRIFLG2                                                  05326000
@NM00004 EQU   LRIFLG2                                                  05327000
LRIRELSE EQU   LRIFLG2                                                  05328000
@NM00003 EQU   LRIFLG2                                                  05329000
LRILNGTH EQU   LRILGTH+1                                                05330000
LRIEOB   EQU   LRIFLG1                                                  05331000
LRICOD   EQU   LRIFLG1                                                  05332000
LRIEOD   EQU   LRIFLG1                                                  05333000
BCBPAD   EQU   BCBLK+12                                                 05334000
BCBLRIAD EQU   BCBLRIAR+1                                               05335000
@NM00002 EQU   BCBLRIAR                                                 05336000
BCBBUFSZ EQU   BCBLK+6                                                  05337000
BCBBUFNO EQU   BCBLK+5                                                  05338000
BCBEXTND EQU   BCBFLGS                                                  05339000
BCBLRI   EQU   BCBFLGS                                                  05340000
BCBBUFAD EQU   BCBBUFPT+1                                               05341000
@NM00001 EQU   BCBBUFPT                                                 05342000
@NM00078 EQU   PSA+3412                                                 05343000
PSASTAK  EQU   PSA+3072                                                 05344000
@NM00077 EQU   PSA+1032                                                 05345000
PSAUSEND EQU   PSA+1032                                                 05346000
PSAPCPSW EQU   PSA+1024                                                 05347000
PSARV060 EQU   PSA+1020                                                 05348000
PSARV059 EQU   PSA+1018                                                 05349000
PSASVC13 EQU   PSA+1016                                                 05350000
PSALSFCC EQU   PSA+1012                                                 05351000
PSASFACC EQU   PSA+1008                                                 05352000
PSASTOP  EQU   PSA+992                                                  05353000
PSASTART EQU   PSA+976                                                  05354000
PSARSPSW EQU   PSA+968                                                  05355000
PSASRPSW EQU   PSA+960                                                  05356000
PSARV045 EQU   PSA+892                                                  05357000
PSARV044 EQU   PSA+888                                                  05358000
PSARV043 EQU   PSA+884                                                  05359000
PSARV042 EQU   PSA+880                                                  05360000
PSARV041 EQU   PSA+876                                                  05361000
PSARV040 EQU   PSA+872                                                  05362000
PSARV025 EQU   PSA+868                                                  05363000
PSADSSED EQU   PSA+868                                                  05364000
PSADSSPR EQU   PSA+864                                                  05365000
PSADSSFW EQU   PSA+860                                                  05366000
PSADSS14 EQU   PSA+856                                                  05367000
PSADSSPP EQU   PSA+848                                                  05368000
PSADSSRP EQU   PSA+840                                                  05369000
PSADSS05 EQU   PSADSSF4                                                 05370000
PSADSS10 EQU   PSADSSF4                                                 05371000
PSADSSVE EQU   PSADSSF4                                                 05372000
PSADSSDE EQU   PSADSSF4                                                 05373000
PSADSSC0 EQU   PSADSSF4                                                 05374000
PSADSSIE EQU   PSADSSF4                                                 05375000
PSADSS12 EQU   PSADSSF4                                                 05376000
PSADSSRC EQU   PSADSSF4                                                 05377000
PSARV057 EQU   PSADSSF3                                                 05378000
PSARV056 EQU   PSADSSF3                                                 05379000
PSARV055 EQU   PSADSSF3                                                 05380000
PSARV054 EQU   PSADSSF3                                                 05381000
PSADSSRW EQU   PSADSSF3                                                 05382000
PSADSSNM EQU   PSADSSF3                                                 05383000
PSADSSES EQU   PSADSSF3                                                 05384000
PSADSSGP EQU   PSADSSF3                                                 05385000
PSADSSF2 EQU   PSADSSFL+1                                               05386000
PSADSSPI EQU   PSADSSF1                                                 05387000
PSADSSOI EQU   PSADSSF1                                                 05388000
PSADSSSP EQU   PSADSSF1                                                 05389000
PSADSSTP EQU   PSADSSF1                                                 05390000
PSADSSDW EQU   PSADSSF1                                                 05391000
PSADSSDD EQU   PSADSSF1                                                 05392000
PSADSSDM EQU   PSADSSF1                                                 05393000
PSADSSMV EQU   PSADSSF1                                                 05394000
PSADSSTS EQU   PSA+816                                                  05395000
PSADSSWK EQU   PSA+812                                                  05396000
PSADSSR3 EQU   PSA+808                                                  05397000
PSADSSR2 EQU   PSA+804                                                  05398000
PSADSSRS EQU   PSA+800                                                  05399000
PSASTOR  EQU   PSA+796                                                  05400000
PSACPUSA EQU   PSA+794                                                  05401000
PSAVSTAP EQU   PSA+792                                                  05402000
PSAWKVAP EQU   PSA+788                                                  05403000
PSAWKRAP EQU   PSA+784                                                  05404000
PSAMCHIC EQU   PSA+783                                                  05405000
PSARV061 EQU   PSA+782                                                  05406000
PSASYMSK EQU   PSA+781                                                  05407000
PSAMCHFL EQU   PSA+780                                                  05408000
PSACR0   EQU   PSA+776                                                  05409000
PSAPSWSV EQU   PSA+768                                                  05410000
PSACLHS  EQU   PSAHLHI                                                  05411000
PSALKR15 EQU   PSALKSA+60                                               05412000
PSALKR14 EQU   PSALKSA+56                                               05413000
PSALKR13 EQU   PSALKSA+52                                               05414000
PSALKR12 EQU   PSALKSA+48                                               05415000
PSALKR11 EQU   PSALKSA+44                                               05416000
PSALKR10 EQU   PSALKSA+40                                               05417000
PSALKR9  EQU   PSALKSA+36                                               05418000
PSALKR8  EQU   PSALKSA+32                                               05419000
PSALKR7  EQU   PSALKSA+28                                               05420000
PSALKR6  EQU   PSALKSA+24                                               05421000
PSALKR5  EQU   PSALKSA+20                                               05422000
PSALKR4  EQU   PSALKSA+16                                               05423000
PSALKR3  EQU   PSALKSA+12                                               05424000
PSALKR2  EQU   PSALKSA+8                                                05425000
PSALKR1  EQU   PSALKSA+4                                                05426000
PSALKR0  EQU   PSALKSA                                                  05427000
PSARV023 EQU   PSACLHT+52                                               05428000
PSALOCAL EQU   PSACLHT+48                                               05429000
PSACMSL  EQU   PSACLHT+44                                               05430000
PSAOPTL  EQU   PSACLHT+40                                               05431000
PSATPACL EQU   PSACLHT+36                                               05432000
PSATPDNL EQU   PSACLHT+32                                               05433000
PSATPNCL EQU   PSACLHT+28                                               05434000
PSAIOSLL EQU   PSACLHT+24                                               05435000
PSAIOSUL EQU   PSACLHT+20                                               05436000
PSAIOSCL EQU   PSACLHT+16                                               05437000
PSAIOSSL EQU   PSACLHT+12                                               05438000
PSASALCL EQU   PSACLHT+8                                                05439000
PSAASML  EQU   PSACLHT+4                                                05440000
PSADISPL EQU   PSACLHT                                                  05441000
PSASRSA  EQU   PSA+636                                                  05442000
PSARV050 EQU   PSA+634                                                  05443000
PSADSSGO EQU   PSA+633                                                  05444000
PSARECUR EQU   PSA+632                                                  05445000
PSAHLHIS EQU   PSA+628                                                  05446000
PSAIPCSA EQU   PSA+624                                                  05447000
@NM00076 EQU   PSA+621                                                  05448000
PSAIPCDM EQU   PSA+620                                                  05449000
PSAIPCD  EQU   PSA+616                                                  05450000
@NM00075 EQU   PSA+613                                                  05451000
PSAIPCRM EQU   PSA+612                                                  05452000
PSAIPCR  EQU   PSA+608                                                  05453000
PSAMCHEX EQU   PSA+600                                                  05454000
PSAMPSW  EQU   PSA+592                                                  05455000
PSAEXPS2 EQU   PSA+584                                                  05456000
PSAEXPS1 EQU   PSA+576                                                  05457000
PSAPIREG EQU   PSA+572                                                  05458000
PSARSREG EQU   PSA+568                                                  05459000
PSAGPREG EQU   PSA+556                                                  05460000
PSARV022 EQU   PSASUP4                                                  05461000
PSARV021 EQU   PSASUP4                                                  05462000
PSARV020 EQU   PSASUP4                                                  05463000
PSARV019 EQU   PSASUP4                                                  05464000
PSARV018 EQU   PSASUP4                                                  05465000
PSARV017 EQU   PSASUP4                                                  05466000
PSARV016 EQU   PSASUP4                                                  05467000
PSARV015 EQU   PSASUP4                                                  05468000
PSARV014 EQU   PSASUP3                                                  05469000
PSARV013 EQU   PSASUP3                                                  05470000
PSARV012 EQU   PSASUP3                                                  05471000
PSARV011 EQU   PSASUP3                                                  05472000
PSARV010 EQU   PSASUP3                                                  05473000
PSARV009 EQU   PSASUP3                                                  05474000
PSARV008 EQU   PSASUP3                                                  05475000
PSAIOSUP EQU   PSASUP3                                                  05476000
PSALCR   EQU   PSASUP2                                                  05477000
PSARTM   EQU   PSASUP2                                                  05478000
PSAACR   EQU   PSASUP2                                                  05479000
PSAIPCE2 EQU   PSASUP2                                                  05480000
PSAIPCES EQU   PSASUP2                                                  05481000
PSAIPCEC EQU   PSASUP2                                                  05482000
PSAGTF   EQU   PSASUP2                                                  05483000
PSAIPCRI EQU   PSASUP2                                                  05484000
PSAIPCRP EQU   PSASUP1                                                  05485000
PSAIPCDR EQU   PSASUP1                                                  05486000
PSADISP  EQU   PSASUP1                                                  05487000
PSALOCK  EQU   PSASUP1                                                  05488000
PSAPI    EQU   PSASUP1                                                  05489000
PSAEXT   EQU   PSASUP1                                                  05490000
PSASVC   EQU   PSASUP1                                                  05491000
PSAIO    EQU   PSASUP1                                                  05492000
PSAANEW  EQU   PSA+544                                                  05493000
PSATNEW  EQU   PSA+536                                                  05494000
PSALCCAR EQU   PSA+532                                                  05495000
PSALCCAV EQU   PSA+528                                                  05496000
PSAPCCAR EQU   PSA+524                                                  05497000
PSAPCCAV EQU   PSA+520                                                  05498000
PSACPULA EQU   PSA+518                                                  05499000
PSACPUPA EQU   PSA+516                                                  05500000
PSAPSA   EQU   PSA+512                                                  05501000
FLCHDEND EQU   PSA+512                                                  05502000
FLCCRSAV EQU   FLCMCLA+280                                              05503000
FLCGRSAV EQU   FLCMCLA+216                                              05504000
FLCFPSAV EQU   FLCMCLA+184                                              05505000
FLCFLA   EQU   FLCMCLA+88                                               05506000
FLCRGNCD EQU   FLCMCLA+84                                               05507000
FLCFSAA  EQU   FLCFSA+1                                                 05508000
@NM00074 EQU   FLCFSA                                                   05509000
@NM00073 EQU   FLCMCLA+72                                               05510000
FLCMCIC  EQU   FLCMCLA+64                                               05511000
@NM00072 EQU   FLCMCLA+20                                               05512000
FLCIOAA  EQU   FLCIOA+1                                                 05513000
@NM00071 EQU   FLCIOA                                                   05514000
@NM00070 EQU   FLCMCLA+15                                               05515000
@NM00069 EQU   FLCMCLA+14                                               05516000
@NM00068 EQU   FLCMCLA+12                                               05517000
FLCLCL   EQU   FLCMCLA+8                                                05518000
FLCIOELA EQU   FLCIOEL+1                                                05519000
@NM00067 EQU   FLCIOEL                                                  05520000
FLCCHNID EQU   FLCMCLA                                                  05521000
@NM00066 EQU   PSA+160                                                  05522000
FLCMTRCD EQU   PSA+157                                                  05523000
@NM00065 EQU   PSA+156                                                  05524000
FLCPERA  EQU   FLCPER+1                                                 05525000
@NM00064 EQU   FLCPER                                                   05526000
@NM00063 EQU   PSA+151                                                  05527000
FLCPERCD EQU   PSA+150                                                  05528000
FLCMCNUM EQU   PSA+149                                                  05529000
@NM00062 EQU   PSA+148                                                  05530000
FLCTEAA  EQU   FLCTEA+1                                                 05531000
@NM00061 EQU   FLCTEA                                                   05532000
PSAPIPC  EQU   PSAPICOD                                                 05533000
PSAPIMC  EQU   PSAPICOD                                                 05534000
PSAPIPER EQU   PSAPICOD                                                 05535000
PSARV049 EQU   FLCPICOD                                                 05536000
FLCPILCB EQU   FLCPIILC                                                 05537000
@NM00060 EQU   FLCPIILC                                                 05538000
@NM00059 EQU   PSAEPPSW                                                 05539000
FLCSVCN  EQU   PSAESPSW+2                                               05540000
FLCSILCB EQU   FLCSVILC                                                 05541000
@NM00058 EQU   FLCSVILC                                                 05542000
@NM00057 EQU   PSAESPSW                                                 05543000
FLCEICOD EQU   PSAEEPSW+2                                               05544000
PSASPAD  EQU   PSAEEPSW                                                 05545000
@NM00056 EQU   PSA+128                                                  05546000
FLCINPSW EQU   PSA+120                                                  05547000
FLCMNPSW EQU   PSA+112                                                  05548000
FLCPNPSW EQU   PSA+104                                                  05549000
FLCSNPSW EQU   PSA+96                                                   05550000
FLCENPSW EQU   PSA+88                                                   05551000
FLCTRACE EQU   PSA+84                                                   05552000
FLCTIMER EQU   PSA+80                                                   05553000
FLCCVT2  EQU   PSA+76                                                   05554000
FLCCAW   EQU   PSA+72                                                   05555000
FLCCSW   EQU   PSA+64                                                   05556000
FLCIOPSW EQU   PSA+56                                                   05557000
FLCMOPSW EQU   PSA+48                                                   05558000
FLCPOPSW EQU   PSA+40                                                   05559000
FLCSOPSW EQU   PSA+32                                                   05560000
FLCEOPSW EQU   PSA+24                                                   05561000
@NM00055 EQU   FLCICCW2+4                                               05562000
FLCCVT   EQU   FLCICCW2                                                 05563000
FLCICCW1 EQU   FLCROPSW                                                 05564000
FLCIPPSW EQU   FLCRNPSW                                                 05565000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      05566000
@RT00175 EQU   CLEANRTN                                                 05567000
@RT00177 EQU   DUMPRTN                                                  05568000
@RT00179 EQU   CLEANRTN                                                 05569000
@RT00204 EQU   ABEND                                                    05570000
@RT00273 EQU   CLEAN                                                    05571000
@RT00292 EQU   CLEAN                                                    05572000
@RF00667 EQU   ESTENT                                                   05573000
@RT00675 EQU   ESTENT                                                   05574000
@RF00646 EQU   ESTENTA                                                  05575000
@PB00005 EQU   @EC00739                                                 05576000
@RT00749 EQU   DUMPRTN1                                                 05577000
@RT00751 EQU   DUMPRTN1                                                 05578000
@RT00753 EQU   DUMPRTN1                                                 05579000
@PB00004 EQU   @PB00005                                                 05580000
@PB00003 EQU   @PB00004                                                 05581000
@PB00002 EQU   @PB00003                                                 05582000
@ENDDATA EQU   *                                                        05583000
         END   IGCT005G,(C'PL/S-II',0502,74053)                         05584000
./  ADD  SSI=80250078,NAME=IGCT105C
         TITLE 'IGCT105C - EXCLUSIVE CONTROL TASK RECOVERY CLEANUP RTN *00001000
                        '                                               00002000
IGCT105C CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL2(@EP00001-@MAINENT)                                   00007000
         DC    AL1(24)                                             0001 00008000
         DC    C'IGCT105C Z25827 01/19/78'                         0001 00009000
BACKUP5C DS    0H                                                  0001 00010000
         USING *,@15                                               0001 00011000
         B     @PROLOG                                             0001 00012000
         DC    AL2(@EP00665-BACKUP5C)                                   00013000
         ENTRY BACKUP5C                                                 00014000
         DROP  @15                                                      00015000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00016000
         BALR  @09,0                                               0001 00017000
@PSTART  DS    0H                                                  0001 00018000
         USING @PSTART,@09                                         0001 00019000
         AH    @15,4(,@15)                                         0001 00020000
         BR    @15                                                 0001 00021000
@EP00001 DS    0H                                                  0002 00022000
RBPRFXLN EQU 64                                                         00023000
RBPRFLNA EQU 32                                                         00024000
PRBLEN   EQU 136                                                        00025000
SIRBLEN  EQU 200                                                        00026000
TIRBLEN  EQU 136                                                        00027000
IRBLEN   EQU 128                                                        00028000
SVRBLEN  EQU 200                                                        00029000
SPDFID   EQU   X'FE'                                                    00030000
*/********************************************************************/ 00031000
*                                                                  0158 00032000
*                                                                  0158 00033000
*/********************************************************************/ 00034000
*/*  THE FOLLOWING ROUTINE PERFORMS THE CLEANUP FUNCTION FOR THE     */ 00035000
*/*  ESTAE.  THIS ROUTINE IS ENTERED FOR ALL ERROR CONDITIONS.  INPUT*/ 00036000
*/*  TO THE ROUTINE IS THE AUDIT TRAIL BIT SET BY EXCLUSIVE CONTROL  */ 00037000
*/*  MODULE TO INDICATE HOW MUCH PROCESSING WAS COMPLETED BEFORE THE */ 00038000
*/*  ABEND.THIS BIT IS FOUND IN THE SECOND BYTE OF THE SVRB EXTENDED */ 00039000
*/*  SAVEAREA. AS THIS ROUTINE PERFORMS CLEANUP IT LIKEWISE WILL SET */ 00040000
*/*  CLEANUP RC BITS INDICATING WHAT WAS DONE.  A SECOND LEVEL       */ 00041000
*/*  ESTAE WILL BE ESTABLISHED FOR THIS ROUTINE, SHOULD A PROGRAM    */ 00042000
*/*  CHECK OCCUR DURING PROCESSING. THE SECOND LEVEL ESTAE WILL      */ 00043000
*/*  RETURN CONTROL TO THE CALLING ROUTINE.                          */ 00044000
*/*              THE CLEANUP RETURN CODES ARE AS FOLLOWS:            */ 00045000
*/*                  01     CLEANUP NOT ATTEMPTED. THE REQUEST FOR   */ 00046000
*/*                         WHICH THE SVC WAS ENTERED IS UNFULFILLED.*/ 00047000
*/*                         ALL CONTROL BLOCKS REMAIN AS THEY WERE   */ 00048000
*/*                         BEFORE THE SVC WAS ISSUED.               */ 00049000
*/*                  02     AN ATTEMPT WAS MADE TO COMPLETE ENQ/DEQ  */ 00050000
*/*                         PROCESSING FOR THE CURRENT REQUEST. IF   */ 00051000
*/*                         USER ERROR THE CURRENT REQUEST WAS RE-   */ 00052000
*/*                         MOVED FROM ALL QUEUES. IF NOT A USER     */ 00053000
*/*                         ERROR PROCESSING OF THE CURRENT REQUEST  */ 00054000
*/*                         WAS COMPLETED. IN ALL CASES IF THERE WAS */ 00055000
*/*                         A WAITING IOB SUFFICIENTLY PROCESSED, THE*/ 00056000
*/*                         I/0 WAS STARTED. THE DCB WITH EXCLUSIVE  */ 00057000
*/*                         CONTROL SHOULD BE REUSABLE.              */ 00058000
*/*                  03     ENQ - AN ATTEMPT WAS MADE TO RESTORE ALL */ 00059000
*/*                         CONTROL BLOCKS TO THEIR STATE BEFORE THE */ 00060000
*/*                         SVC WAS ISSUED.THE BLOCK WAS NOT ENQUEUED*/ 00061000
*/*                         THE DCB WITH EXCLUSIVE CONTROL SHOULD BE */ 00062000
*/*                         REUSABLE.                                */ 00063000
*/*                  04     ENQ/DEQ - NO CLEANUP WAS DONE. IT WAS    */ 00064000
*/*                         DETERMINED THAT NONE WAS REQUIRED AS ALL */ 00065000
*/*                         SVC PROCESSING HAD COMPLETED.THE DCB WITH*/ 00066000
*/*                         EXCLUSIVE CONTROL SHOULD BE REUSABLE.    */ 00067000
*/*                         PROCEED CAUTIOUSLY,SINCE ERROR MAY BE    */ 00068000
*/*                         ASSOCIATED WITH COMPLETED REQUEST.       */ 00069000
*/*                  05     ENQ/DEQ - NO CLEANUP WAS DONE. ABENDING  */ 00070000
*/*                         TASK IS ENQUEUED ON A BLOCK WHICH IS INAC*/ 00071000
*/*                         CESSIBLE TO OTHER USERS. USE OF EXCLUSIVE*/ 00072000
*/*                         CONTROL IS UNPREDICTABLE.                */ 00073000
*/*                  06     DEQ - NO CLEANUP WAS ATTEMPTED. THE BLOCK*/ 00074000
*/*                         FOR WHICH THE ABENDING TASK HAD CONTROL  */ 00075000
*/*                         WAS DEQUEUED FROM THE SYSTEM QUEUE BUT   */ 00076000
*/*                         REMAINS ON THE EXCLUSIVE CONTROL LIST.   */ 00077000
*/*                         THIS BLOCK IS INACCESSIBLE TO OTHER USERS*/ 00078000
*/*                  07     CLEANUP NOT ATTEMPTED BECAUSE DEBCHK     */ 00079000
*/*                         FOUND INVALID DEB, AUDIT TRAIL BIT WAS   */ 00080000
*/*                         DETERMINED TO BE INVALID, OR CONDITION   */ 00081000
*/*                         IS UNKNOWN. RESULTS ARE UNPREDICTABLE.   */ 00082000
*/*                  08     CLEANUP ROUTINE ABENDED. CONDITION IS    */ 00083000
*/*                         UNKNOWN. RESULTS ARE UNPREDICTABLE.      */ 00084000
*/*                                                                  */ 00085000
*/*  NOTE1:REGISTERS 0-15 UPON ENTRY TO THIS MODULE ARE SAVED(R13)   */ 00086000
*/*        AND RESTORED UPON EXIT. UPON RETURN FROM THIS MODULE R15  */ 00087000
*/*        WILL HAVE A RC OF EITHER 0=CLEANUP COMPLETED, OR 4=CLEANUP*/ 00088000
*/*        ABENDED BEFORE RETURN.                                    */ 00089000
*/*                                                                  */ 00090000
*/*  NOTE2:BLKCTR(R7) VALUES IDENTIFY THE RESULTS OF VALIDATING THE  */ 00091000
*/*        CONTROL BLOCKS. THEY SHOULD BE INTERPRETED AS FOLLOWS:    */ 00092000
*/*            1 = IOB ERROR (NOT RELEX)                             */ 00093000
*/*            2 = DCB ERROR                                         */ 00094000
*/*            3 = BLKREF ERROR (RELEX)                              */ 00095000
*/*            4 = DECB ERROR (NOT RELEX)                            */ 00096000
*/*            5 = DEB ERROR                                         */ 00097000
*/*            6 = NEXT IOB ERROR                                    */ 00098000
*/*            7 = SYSTEM ERROR                                      */ 00099000
*/*           10 = ERROR IN PREVIOUS RECOVERY RTN OR ANOTHER RB LEVEL*/ 00100000
*/*                (BRANCHED TO DUMPRTN OR CLEANRTN)                 */ 00101000
*/********************************************************************/ 00102000
*                                                                  0158 00103000
*CLEANUP:                                                          0158 00104000
*   ;                               /* CLEAN UP RESOURCES            */ 00105000
CLEANUP  DS    0H                                                  0159 00106000
*   RFY                                                            0159 00107000
*    (GPR14P) RSTD;                 /* RESTRICT RETURN ADDR          */ 00108000
*   WKASAV14=GPR14P;                /* SAVE RET ADDR FOR BACKUP      */ 00109000
         ST    GPR14P,WKASAV14(,RBSECPTR)                          0160 00110000
*   RFY                                                            0161 00111000
*     GPR14P UNRSTD;                                               0161 00112000
*   WKALST=ELIST;                   /* MV LIST FORM INTO WKAREA      */ 00113000
         MVC   WKALST(20,RBSECPTR),ELIST                           0162 00114000
*   WKACLENX=0;                     /* INITIALIZE CLEANUP RET COD    */ 00115000
         MVI   WKACLENX(RBSECPTR),X'00'                            0163 00116000
*   WKALOCK='0'B;                   /* MAKE SURE DEBCHK GETS LOCK    */ 00117000
         NI    WKALOCK(RBSECPTR),B'10111111'                       0164 00118000
*/* ISSUE ESTAE MACRO TO SET UP BACKUP ROUTINE SHOULD CLEANUP ABEND  */ 00119000
*                                                                  0165 00120000
*   GEN REFS(WKALST,SDWAPTR);                                      0165 00121000
*                                                                  0165 00122000
*                                      /* ISSUE SECOND LEVEL ESTAE  */  00123000
        ESTAE PARAM=(SDWAPTR),MF=(E,WKALST(RBSECPTR))  SET UP YM5757*/  00124000
*/* NO CONTROL BLOCKS CHANGED, NO CLEANUP NECESSARY - ALL WILL REMAIN*/ 00125000
*/* AS IT WAS BEFORE THE SVC WAS ISSUED.                             */ 00126000
*                                                                  0166 00127000
*   IF WKATRALX¬>WKAVALRC THEN      /* IF ONLY ARG PUT IN SVRB OR  0166 00128000
*                                      NOTHING DONE AT ALL           */ 00129000
         CLI   WKATRALX(RBSECPTR),1                                0166 00130000
         BH    @RF00166                                            0166 00131000
*     DO;                           /* NO CHANGES WERE MADE          */ 00132000
*       WKACLENX=CLEANRC1(1);       /* SET CLEANUP CODE FOR NONE     */ 00133000
         IC    @12,CLEANRC1                                        0168 00134000
         STC   @12,WKACLENX(,RBSECPTR)                             0168 00135000
*       GOTO EXITCLN;               /* GO RETURN TO MAIN RTN         */ 00136000
         B     EXITCLN                                             0169 00137000
*     END;                                                         0170 00138000
*                                                                  0170 00139000
*/* BEFORE FURTHER PROCESSING MUST ESTABLISH THE ADDRESS OF THE ENTRY*/ 00140000
*/* IN THE READX LIST WHICH MATCHES THE ARGUMENT IN THE SVRB, IF ONE */ 00141000
*/* EXISTS. THE ENTRY MAY HAVE TO BE CLEARED, OR THE IOBS CHANGED.   */ 00142000
*                                                                  0171 00143000
*CLNLOCK:                                                          0171 00144000
*   ;                               /* LOCAL LOCK BEFORE CHG BLKS    */ 00145000
@RF00166 DS    0H                                                  0171 00146000
CLNLOCK  DS    0H                                                  0172 00147000
*   RFY                                                            0172 00148000
*     GPR00P RSTD;                  /* RESTRICT SAVE REG       YM7519*/ 00149000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE ADDR      YM7519*/ 00150000
         LR    GPR00P,SAVEPTR                                      0173 00151000
*   DO;                             /* SETLOCK (OBTAIN) MODE(UNCOND)    00152000
*                                      TYPE(LOCAL) RELATED(RDXLST,IGC   00153000
*                                      T105C,(POSTREQ,ENQ,EXCPNXT,EXI   00154000
*                                      TCLN))                        */ 00155000
*     RFY                                                          0175 00156000
*      (GPR11P,                                                    0175 00157000
*       GPR12P,                                                    0175 00158000
*       GPR13P,                                                    0175 00159000
*       GPR14P) RSTD;                                              0175 00160000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0176 00161000
*                                      TABLE.                        */ 00162000
         L     GPR13P,PSALITA                                      0176 00163000
*     GEN(LM GPR11P,GPR13P,576(GPR13P));/* LOAD LOCKWORD, CLHT AND 0177 00164000
*                                      ENTRY ADRS.                   */ 00165000
         LM GPR11P,GPR13P,576(GPR13P)                                   00166000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00167000
         BALR GPR14P,GPR13P                                             00168000
*     RFY                                                          0179 00169000
*      (GPR11P,                                                    0179 00170000
*       GPR12P,                                                    0179 00171000
*       GPR13P,                                                    0179 00172000
*       GPR14P) UNRSTD;                                            0179 00173000
*   END;                            /* SETLOCK (OBTAIN) MODE(UNCOND)    00174000
*                                      TYPE(LOCAL) RELATED(RDXLST,IGC   00175000
*                                      T105C,(POSTREQ,ENQ,EXCPNXT,EXI   00176000
*                                      TCLN))                        */ 00177000
*   SAVEPTR=GPR00P;                 /* RESTOR RTM SAVE AD      YM7519*/ 00178000
         LR    SAVEPTR,GPR00P                                      0181 00179000
*   RFY                                                            0182 00180000
*     GPR00P UNRSTD;                /*                         YM7519*/ 00181000
*   WKALOCK='1'B;                   /* SET LOCK BIT ON FOR DEBCHK    */ 00182000
         OI    WKALOCK(RBSECPTR),B'01000000'                       0183 00183000
*   CALL DEBCHECK;                  /* MUST FIRST VALIDATE DEB       */ 00184000
         BAL   @14,DEBCHECK                                        0184 00185000
*   IF WKADEBXC¬=0 THEN             /* IF DEB IS BAD,NO CLEANUP      */ 00186000
         CLI   WKADEBXC(RBSECPTR),0                                0185 00187000
         BE    @RF00185                                            0185 00188000
*     DO;                           /* SET UP TO RETURN              */ 00189000
*       WKACLENX=CLEANRC1(7);       /* CLEANUP RC = BAD DEB          */ 00190000
         IC    @12,CLEANRC1+6                                      0187 00191000
         STC   @12,WKACLENX(,RBSECPTR)                             0187 00192000
*       GOTO EXITCLN;               /* RETURN TO MAIN ROUTINE        */ 00193000
         B     EXITCLN                                             0188 00194000
*     END;                                                         0189 00195000
*   RFY                                                            0190 00196000
*    (RDXPTR,                                                      0190 00197000
*     RDXENTRG) RSTD;               /* RESTRICT BASE REGS            */ 00198000
@RF00185 DS    0H                                                  0191 00199000
*   RFY                                                            0191 00200000
*     DEBBASIC BASED(WKASVDEB);     /* ESTABLISH DEB BASE            */ 00201000
*   RFY                                                            0192 00202000
*     DEBXTN BASED(DEBXTNP);        /* DEB EXTENSION BASE            */ 00203000
*   RDXPTR=DEBXXARG;                /* READ EXCLUSIVE LIST PTR       */ 00204000
         L     @12,WKASVDEB(,RBSECPTR)                             0193 00205000
         L     @12,DEBAPPAD(,@12)                                  0193 00206000
         L     @12,DEBXTNP(,@12)                                   0193 00207000
         L     RDXPTR,DEBXXARG(,@12)                               0193 00208000
*   RFY                                                            0194 00209000
*     GPR00P RSTD;                  /* RESTRC REG TO SAVE SEG PTR    */ 00210000
*   RFY                                                            0195 00211000
*     RDXLIST BASED(RDXPTR);        /* ESTABLISH BASE FOR RDXLIST    */ 00212000
*   GPR00P=RDXNEXT;                 /* SAVE ADDR TO NEXT SEGMENT     */ 00213000
         L     GPR00P,RDXNEXT(,RDXPTR)                             0196 00214000
*RDXLOOP:                                                          0197 00215000
*   DO I=1 TO RDXMAXCT;             /* SEARCH 9 ENTRIES/SEGMENT      */ 00216000
RDXLOOP  LA    I,1                                                 0197 00217000
@DL00197 DS    0H                                                  0198 00218000
*     IF RDXENT(1:8)=WKANQARG THEN  /* IF ENTRY MATCHES,SAVE         */ 00219000
         CLC   RDXENT(8,RDXPTR),WKANQARG(RBSECPTR)                 0198 00220000
         BNE   @RF00198                                            0198 00221000
*       DO;                         /* THE ADDRESS IN THE SVRB       */ 00222000
*         RDXENTRG=ADDR(RDXENT);    /* PUT ENTRY INTO BASE REG       */ 00223000
         LA    RDXENTRG,RDXENT(,RDXPTR)                            0200 00224000
*         RFY                                                      0201 00225000
*           RDXENTRY BASED(RDXENTRG);/* RDXENTRY GETS A BASE         */ 00226000
*         WKAXADDR=RDXENTRG;        /* SAVE ENTRY ADDR IN SVRB       */ 00227000
         ST    RDXENTRG,WKAXADDR(,RBSECPTR)                        0202 00228000
*         GOTO CHKENQ;              /* CONTINUE CLEANUP              */ 00229000
         B     CHKENQ                                              0203 00230000
*       END;                                                       0204 00231000
*     ELSE                          /* IF THAT ENTRY NOT THE ONE     */ 00232000
*       RDXPTR=RDXPTR+LENGTH(RDXENTRY);/* GO TO NEXT ENTRY           */ 00233000
@RF00198 AL    RDXPTR,@CF00073                                     0205 00234000
*   END RDXLOOP;                    /* RETURN TO CHECK NEXT ENTRY    */ 00235000
         AL    I,@CF00099                                          0206 00236000
         C     I,@CF01554                                          0206 00237000
         BNH   @DL00197                                            0206 00238000
*   IF GPR00P¬=0 THEN               /* IS THERE ANOTHER SEGMENT      */ 00239000
         LTR   GPR00P,GPR00P                                       0207 00240000
         BZ    @RF00207                                            0207 00241000
*     DO;                           /* IF YES, GO CHECK NEXT SEG     */ 00242000
*       RDXPTR=GPR00P;              /* YES, MAKE IT BASE FOR LIST    */ 00243000
         LR    RDXPTR,GPR00P                                       0209 00244000
*       GPR00P=RDXNEXT;             /* SAVE SEGMENT AFTER THIS       */ 00245000
         L     GPR00P,RDXNEXT(,RDXPTR)                             0210 00246000
*       GOTO RDXLOOP;               /* REPEAT THE SEARCH             */ 00247000
         B     RDXLOOP                                             0211 00248000
*     END;                                                         0212 00249000
*   ELSE                            /* NO MATCH FOR ARG IS FOUND     */ 00250000
*     WKAXADDR=0;                   /* CANT CLEAN UP                 */ 00251000
@RF00207 SLR   @12,@12                                             0213 00252000
         ST    @12,WKAXADDR(,RBSECPTR)                             0213 00253000
*   RFY                                                            0214 00254000
*    (RDXPTR,                                                      0214 00255000
*     GPR00P) UNRSTD;                                              0214 00256000
*                                                                  0214 00257000
*/* ENQ REQUESTS: IF CONTROL BLOCKS WERE PARTIALLY CHANGED AND NOT   */ 00258000
*/* USER ERROR,CONTINUE STEPS NOT COMPLETED BY SVC BEFORE ABEND. USER*/ 00259000
*/* ERROR WAS DETERMINED, ATTEMPT TO UNDO WHAT THE SVC HAD DONE, BY  */ 00260000
*/* EITHER DEQUEUING THE REQUEST FROM THE SYSTEM QUEUE AND EXCLUSIVE */ 00261000
*/* LIST OR BY REMOVING THE CURRENT REQUESTOR IOB FROM THE WAIT QUEUE*/ 00262000
*/* IF ALL CONTROL BLOCKS WERE CHANGED,IE. PROCESSING WAS ESSENTIALLY*/ 00263000
*/* COMPLETE, NO CLEANUP IS DONE, REGARDLESS OF CAUSE OF ERROR.      */ 00264000
*                                                                  0215 00265000
*CHKENQ:                                                           0215 00266000
*   IF WKAENQRQ='1'B THEN           /* CHECK FOR ENQ REQUEST         */ 00267000
CHKENQ   TM    WKAENQRQ(RBSECPTR),B'00000100'                      0215 00268000
         BNO   @RF00215                                            0215 00269000
*     DO;                           /* WAS IOB PUT ON UNPOST QUE     */ 00270000
*       IF(WKATRALX=WKAIOBST)&(BLKCTR>NXTIOBER) THEN/* IF IOB TO GET    00271000
*                                      CONTROL BEFORE CUR IOB SAVED     00272000
*                                      IN WORKAREA BUT CURRENT IOB 0217 00273000
*                                      NOT YET ADDED TO UNPOSTED QUE    00274000
*                                      & NOT USERERR, PUT ON         */ 00275000
         CLI   WKATRALX(RBSECPTR),80                               0217 00276000
         BNE   @RF00217                                            0217 00277000
         C     BLKCTR,@CF01050                                     0217 00278000
         BNH   @RF00217                                            0217 00279000
*         DO;                       /* UNPOSTED QUEUE                */ 00280000
*           IF WKAXADDR=0 THEN      /* IF NO RDXENTRY ADDR           */ 00281000
         L     @12,WKAXADDR(,RBSECPTR)                             0219 00282000
         LTR   @12,@12                                             0219 00283000
         BNZ   @RF00219                                            0219 00284000
*             DO;                   /* CANNOT CLEAN UP               */ 00285000
*               WKACLENX=CLEANRC1(7);/* CLEANUP CODE = UNCERTAIN     */ 00286000
         IC    @12,CLEANRC1+6                                      0221 00287000
         STC   @12,WKACLENX(,RBSECPTR)                             0221 00288000
*               GOTO EXITCLN;       /* RETURN TO MAIN ROUTINE        */ 00289000
         B     EXITCLN                                             0222 00290000
*             END;                                                 0223 00291000
*           RFY                                                    0224 00292000
*             IOBSTDRD BASED(RDXUQND);/* CONTINUE ADDING NEW IOB TO     00293000
*                                      UNPOST QUE-LAST IOB ADDED IS     00294000
*                                      LAST IOB IN RDXLIST ENTRY- IT    00295000
*                                      SHOULD BE SAME AS WKAIOBQX    */ 00296000
@RF00219 DS    0H                                                  0225 00297000
*           DO;                     /* MODESET KEYADDR(WKASVKEY)     */ 00298000
*             SPKA(WKASVKEY);       /* SET PSW KEY                   */ 00299000
         SLR   @12,@12                                             0226 00300000
         IC    @12,WKASVKEY(,RBSECPTR)                             0226 00301000
         SPKA  0(@12)                                              0226 00302000
*           END;                    /* MODESET KEYADDR(WKASVKEY)   0227 00303000
*                                      CHANGE TO USER KEY            */ 00304000
*           IOBDQPTR=ABS(RBGRS1);   /* ST CURRENT IOB IN PREVIOUS- 0228 00305000
*                                      FINISH CHAINING IOB(IOBDQPTR) */ 00306000
         L     @12,RDXUQND(,RDXENTRG)                              0228 00307000
         L     @11,RBGRS1(,RBSECPTR)                               0228 00308000
         LPR   @11,@11                                             0228 00309000
         ST    @11,IOBDQPTR(,@12)                                  0228 00310000
*           DO;                     /* MODESET EXTKEY(DATAMGT)       */ 00311000
*             SPKA(80);             /* SET PSW KEY                   */ 00312000
         LA    @12,80                                              0230 00313000
         SPKA  0(@12)                                              0230 00314000
*           END;                    /* MODESET EXTKEY(DATAMGT) CHANGE   00315000
*                                      TO DATAMGT KEY                */ 00316000
*           RDXUQND=ABS(RBGRS1);    /* PUT CURRENT IOB LAST ON Q     */ 00317000
         ST    @11,RDXUQND(,RDXENTRG)                              0232 00318000
*           IF RDXIOBUQ=0 THEN      /* IF NO OTHER IOB IS WAITING    */ 00319000
         L     @12,RDXIOBUQ(,RDXENTRG)                             0233 00320000
         LTR   @12,@12                                             0233 00321000
         BNZ   @RF00233                                            0233 00322000
*             RDXIOBUQ=ABS(RBGRS1); /* MAKE CUR IOB FIRST ON QUE     */ 00323000
         ST    @11,RDXIOBUQ(,RDXENTRG)                             0234 00324000
*           DO;                     /* MODESET EXTKEY(SUPR)          */ 00325000
@RF00233 DS    0H                                                  0236 00326000
*             SPKA(0);              /* SET PSW KEY                   */ 00327000
         SLR   @12,@12                                             0236 00328000
         SPKA  0(@12)                                              0236 00329000
*           END;                    /* MODESET EXTKEY(SUPR) RETURN TO   00330000
*                                      SUPER KEY                     */ 00331000
*           WKACLENX=CLEANRC1(2);   /* ESTABLISH CLEANUP RC - OK     */ 00332000
         IC    @12,CLEANRC1+1                                      0238 00333000
         STC   @12,WKACLENX(,RBSECPTR)                             0238 00334000
*           GOTO EXITCLN;           /* GO RETURN TO MAIN RTN         */ 00335000
         B     EXITCLN                                             0239 00336000
*         END;                      /* CUR IOB PUT ON UNPOST QUE     */ 00337000
*       ELSE                        /* IF IOB IS TO BE QUEUED AND    */ 00338000
*         IF(WKATRALX=WKAIOBST)&(BLKCTR¬>NXTIOBER) THEN/* IF A USER     00339000
*                                      ERROR WAS FOUND               */ 00340000
@RF00217 CLI   WKATRALX(RBSECPTR),80                               0241 00341000
         BNE   @RF00241                                            0241 00342000
         C     BLKCTR,@CF01050                                     0241 00343000
         BH    @RF00241                                            0241 00344000
*           DO;                     /* UNDO ANY CHANGES MADE         */ 00345000
*             IF WKAXADDR=0 THEN    /* IF NO RDXENTRY ADDR           */ 00346000
         L     @12,WKAXADDR(,RBSECPTR)                             0243 00347000
         LTR   @12,@12                                             0243 00348000
         BNZ   @RF00243                                            0243 00349000
*               DO;                 /* CANNOT CLEAN UP               */ 00350000
*                 WKACLENX=CLEANRC1(7);/* CLEANUP CODE = UNCERTAIN   */ 00351000
         IC    @12,CLEANRC1+6                                      0245 00352000
         STC   @12,WKACLENX(,RBSECPTR)                             0245 00353000
*                 GOTO EXITCLN;     /* RETURN TO MAIN ROUTINE        */ 00354000
         B     EXITCLN                                             0246 00355000
*               END;                                               0247 00356000
*             ELSE                  /* TRY TO CLEAN UP IN CASE       */ 00357000
*               DO;                 /* IOB WAS STORED IN PREVIOUS    */ 00358000
@RF00243 DS    0H                                                  0249 00359000
*                 RFY                                              0249 00360000
*                   IOBSTDRD BASED(WKAIOBQX);/* PREV IOB IS BASE     */ 00361000
*                 IF IOBDQPTR=ABS(RBGRS1) THEN/* IF PREVIOUS IOB     */ 00362000
         L     @12,WKAIOBQX(,RBSECPTR)                             0250 00363000
         L     @11,RBGRS1(,RBSECPTR)                               0250 00364000
         LPR   @11,@11                                             0250 00365000
         C     @11,IOBDQPTR(,@12)                                  0250 00366000
         BNE   @RF00250                                            0250 00367000
*                   DO;             /* PTS TO CUR IOB,DEQUEUE CUR    */ 00368000
*                     DO;           /* MODESET KEYADDR(WKASVKEY)     */ 00369000
*                       SPKA(WKASVKEY);/* SET PSW KEY                */ 00370000
         SLR   @11,@11                                             0253 00371000
         IC    @11,WKASVKEY(,RBSECPTR)                             0253 00372000
         SPKA  0(@11)                                              0253 00373000
*                     END;          /* MODESET KEYADDR(WKASVKEY)   0254 00374000
*                                      CHANGE TO USER KEY            */ 00375000
*                     IOBDQPTR=0;   /* ZERO FORWARD CHAIN OF PREV    */ 00376000
         SLR   @11,@11                                             0255 00377000
         ST    @11,IOBDQPTR(,@12)                                  0255 00378000
*                     DO;           /* MODESET EXTKEY(DATAMGT)       */ 00379000
*                       SPKA(80);   /* SET PSW KEY                   */ 00380000
         LA    @04,80                                              0257 00381000
         SPKA  0(@04)                                              0257 00382000
*                     END;          /* MODESET EXTKEY(DATAMGT) CHANGE   00383000
*                                      TO DATAMGT KEY                */ 00384000
*                     RDXUQND=ADDR(IOBSTDRD);/* MAKE PREV IOB LAST   */ 00385000
         ST    @12,RDXUQND(,RDXENTRG)                              0259 00386000
*                     DO;           /* MODESET EXTKEY(SUPR)          */ 00387000
*                       SPKA(0);    /* SET PSW KEY                   */ 00388000
         SPKA  0(@11)                                              0261 00389000
*                     END;          /* MODESET EXTKEY(SUPR) RETURN TO   00390000
*                                      SUPER KEY                     */ 00391000
*                     WKACLENX=CLEANRC1(3);/* CLEANUP RC=CLEANUP OK  */ 00392000
         IC    @12,CLEANRC1+2                                      0263 00393000
         STC   @12,WKACLENX(,RBSECPTR)                             0263 00394000
*                   END;                                           0264 00395000
*                 ELSE              /* IF ANOTHER IOB HAS BEEN       */ 00396000
*                   WKACLENX=CLEANRC1(7);/* QUEUED,DONT CLEANUP MAY     00397000
*                                      BE OK, MAY NOT-UNCERT         */ 00398000
         B     @RC00250                                            0265 00399000
@RF00250 IC    @12,CLEANRC1+6                                      0265 00400000
         STC   @12,WKACLENX(,RBSECPTR)                             0265 00401000
*               END;                                               0266 00402000
*             GOTO EXITCLN;         /* RETURN TO MAIN ROUTINE        */ 00403000
         B     EXITCLN                                             0267 00404000
*           END;                                                   0268 00405000
*       IF WKATRALX=WKAIOBQD THEN   /* USER/SYSTEM ERROR - ALL       */ 00406000
@RF00241 CLI   WKATRALX(RBSECPTR),96                               0269 00407000
         BNE   @RF00269                                            0269 00408000
*         DO;                       /* CHANGES MADE SO LEAVE THEM    */ 00409000
*           WKACLENX=CLEANRC1(4);   /* CLEANUP RC =OK BUT CAUTION    */ 00410000
         IC    @12,CLEANRC1+3                                      0271 00411000
         STC   @12,WKACLENX(,RBSECPTR)                             0271 00412000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00413000
         B     EXITCLN                                             0272 00414000
*         END;                                                     0273 00415000
*       IF WKATRALX=WKARDXAD THEN   /* ENTRY PUT ON RDXLIST BUT      */ 00416000
@RF00269 CLI   WKATRALX(RBSECPTR),32                               0274 00417000
         BNE   @RF00274                                            0274 00418000
*         DO;                       /* NOT ON SYSTEM QUEUE           */ 00419000
*           IF BLKCTR>NXTIOBER THEN /* SYSERR-PUT ON SYSTEM QUEUE    */ 00420000
         C     BLKCTR,@CF01050                                     0276 00421000
         BNH   @RF00276                                            0276 00422000
*             DO;                   /* ABEND TASK MUST RELEASE IT    */ 00423000
*               WKAIOBQX=ABS(RBGRS1);/* PASS IOB TO ENQ IN SVRB      */ 00424000
         L     @12,RBGRS1(,RBSECPTR)                               0278 00425000
         LPR   @12,@12                                             0278 00426000
         ST    @12,WKAIOBQX(,RBSECPTR)                             0278 00427000
*               GOTO ENQ;           /* GO TO ENQ ROUTINE             */ 00428000
         B     ENQ                                                 0279 00429000
*             END;                                                 0280 00430000
*           ELSE                    /* ELSE CLEAR ENTRY IN RDXLST    */ 00431000
*             DO;                   /* 1ST CHECK IF ENTRY FOUND AND     00432000
*                                      NO OTHER IOBS ARE WAITING     */ 00433000
@RF00276 DS    0H                                                  0282 00434000
*               IF WKAXADDR=0 THEN  /* IF NO RDXENTRY ADDR           */ 00435000
         L     @12,WKAXADDR(,RBSECPTR)                             0282 00436000
         LTR   @12,@12                                             0282 00437000
         BNZ   @RF00282                                            0282 00438000
*                 DO;               /* CANNOT CLEAN UP               */ 00439000
*                   WKACLENX=CLEANRC1(7);/* CLEAN CODE = UNCERTAIN   */ 00440000
         IC    @12,CLEANRC1+6                                      0284 00441000
         STC   @12,WKACLENX(,RBSECPTR)                             0284 00442000
*                   GOTO EXITCLN;   /* RETURN TO MAIN ROUTINE        */ 00443000
         B     EXITCLN                                             0285 00444000
*                 END;                                             0286 00445000
*               IF RDXIOBUQ¬=0 THEN /* ANOTHER IOB ALREADY WAITNG    */ 00446000
@RF00282 SLR   @12,@12                                             0287 00447000
         L     @11,RDXIOBUQ(,RDXENTRG)                             0287 00448000
         CR    @11,@12                                             0287 00449000
         BE    @RF00287                                            0287 00450000
*                 DO;               /* TRY TO START NEXT REQUEST     */ 00451000
*                   WKAIOBQX=RDXIOBUQ;/* PASS IOB TO EXCP IN SVRB    */ 00452000
         ST    @11,WKAIOBQX(,RBSECPTR)                             0289 00453000
*                   RFY                                            0290 00454000
*                     IOBSTDRD BASED(RDXIOBUQ);/* IOB BASE WAITS     */ 00455000
*                   DO;             /* MODESET EXTKEY(DATAMGT)       */ 00456000
*                     SPKA(80);     /* SET PSW KEY                   */ 00457000
         LA    @04,80                                              0292 00458000
         SPKA  0(@04)                                              0292 00459000
*                   END;            /* MODESET EXTKEY(DATAMGT) CHANGE   00460000
*                                      TO KEY 5                      */ 00461000
*                   IF IOBDQPTR=0 THEN/* IF WAITING IOB ONLY ONE     */ 00462000
         C     @12,IOBDQPTR(,@11)                                  0294 00463000
         BNE   @RF00294                                            0294 00464000
*                     DO;           /* GIVE CONTROL TO THAT IOB      */ 00465000
*                       RDXIOBUQ=0; /* AND CLEAR UNPOSTED QUEUE,     */ 00466000
         ST    @12,RDXIOBUQ(,RDXENTRG)                             0296 00467000
*                       RDXUQND=0;  /* FIRST AND LAST IOB PTRS       */ 00468000
         ST    @12,RDXUQND(,RDXENTRG)                              0297 00469000
*                     END;                                         0298 00470000
*                   ELSE            /* IF MORE THAN ONE IOB WAITS    */ 00471000
*                     RDXIOBUQ=IOBDQPTR;/* GIVE CONTROL TO 1ST AND 0299 00472000
*                                      MAKE NEXT IOB 1ST WAITING     */ 00473000
         B     @RC00294                                            0299 00474000
@RF00294 L     @12,RDXIOBUQ(,RDXENTRG)                             0299 00475000
         L     @12,IOBDQPTR(,@12)                                  0299 00476000
         ST    @12,RDXIOBUQ(,RDXENTRG)                             0299 00477000
*                   DO;             /* MODESET EXTKEY(SUPR)          */ 00478000
@RC00294 DS    0H                                                  0301 00479000
*                     SPKA(0);      /* SET PSW KEY                   */ 00480000
         SLR   @12,@12                                             0301 00481000
         SPKA  0(@12)                                              0301 00482000
*                   END;            /* MODESET EXTKEY(SUPR) CHANGE TO   00483000
*                                      KEY ZERO                      */ 00484000
*                   GOTO ENQ;       /* GO TO ENQ FOR NEXT IOB        */ 00485000
         B     ENQ                                                 0303 00486000
*                 END;                                             0304 00487000
*               ELSE                /* CLEAR RDXENTRY ENTRY          */ 00488000
*                 DO;               /* REMOVE CUR REQ FROM XLIST     */ 00489000
@RF00287 DS    0H                                                  0306 00490000
*                   DO;             /* MODESET EXTKEY(DATAMGT)       */ 00491000
*                     SPKA(80);     /* SET PSW KEY                   */ 00492000
         LA    @12,80                                              0307 00493000
         SPKA  0(@12)                                              0307 00494000
*                   END;            /* MODESET EXTKEY(DATAMGT) CHANGE   00495000
*                                      TO KEY 5                      */ 00496000
*                   RDXENTRY=RDXENTRY&&RDXENTRY;/* CLEAR READX ENTRY */ 00497000
         XC    RDXENTRY(16,RDXENTRG),RDXENTRY(RDXENTRG)            0309 00498000
*                   DO;             /* MODESET EXTKEY(SUPR)          */ 00499000
*                     SPKA(0);      /* SET PSW KEY                   */ 00500000
         SLR   @12,@12                                             0311 00501000
         SPKA  0(@12)                                              0311 00502000
*                   END;            /* MODESET EXTKEY(SUPR) CHANGE TO   00503000
*                                      KEY ZERO                      */ 00504000
*                   WKACLENX=CLEANRC1(3);/* CLEANUP RC-WORK UNDONE   */ 00505000
         IC    @12,CLEANRC1+2                                      0313 00506000
         STC   @12,WKACLENX(,RBSECPTR)                             0313 00507000
*                   GOTO EXITCLN;   /* RETURN TO MAIN ROUTINE        */ 00508000
         B     EXITCLN                                             0314 00509000
*                 END;                                             0315 00510000
*             END;                                                 0316 00511000
*         END;                                                     0317 00512000
*       IF(WKATRALX=WKAENQ)&(BLKCTR>NXTIOBER) THEN/* IF ENQD, AND NO    00513000
*                                      USER ERROR                    */ 00514000
@RF00274 CLI   WKATRALX(RBSECPTR),48                               0318 00515000
         BNE   @RF00318                                            0318 00516000
         C     BLKCTR,@CF01050                                     0318 00517000
         BNH   @RF00318                                            0318 00518000
*         DO;                       /* FINISH REQUEST BY EXCPING     */ 00519000
*           WKAIOBQX=ABS(RBGRS1);   /* PASS IOB TO EXCP IN SVRB      */ 00520000
         L     @12,RBGRS1(,RBSECPTR)                               0320 00521000
         LPR   @12,@12                                             0320 00522000
         ST    @12,WKAIOBQX(,RBSECPTR)                             0320 00523000
*           GOTO EXCPNXT;           /* GO TO EXCP ROUTINE            */ 00524000
         B     EXCPNXT                                             0321 00525000
*         END;                                                     0322 00526000
*       IF(WKATRALX=WKAENQ)&(BLKCTR¬>NXTIOBER) THEN/* USER ERR       */ 00527000
@RF00318 CLI   WKATRALX(RBSECPTR),48                               0323 00528000
         BNE   @RF00323                                            0323 00529000
         C     BLKCTR,@CF01050                                     0323 00530000
         BH    @RF00323                                            0323 00531000
*         DO;                       /* DONT TRY CLEANUP,IOBS MAY     */ 00532000
*           WKACLENX=CLEANRC1(5);   /* BE WAITING -CNTRL BLKS BAD    */ 00533000
         IC    @12,CLEANRC1+4                                      0325 00534000
         STC   @12,WKACLENX(,RBSECPTR)                             0325 00535000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00536000
         B     EXITCLN                                             0326 00537000
*         END;                                                     0327 00538000
*       IF WKATRALX=WKAEXCPE THEN   /* IF EXCP ALREADY ISSUED        */ 00539000
@RF00323 CLI   WKATRALX(RBSECPTR),64                               0328 00540000
         BNE   @RF00328                                            0328 00541000
*         DO;                       /* THERE IS NOTHING TO DO        */ 00542000
*           WKACLENX=CLEANRC1(4);   /* CLEANUP RC=PROCESSING DONE    */ 00543000
         IC    @12,CLEANRC1+3                                      0330 00544000
         STC   @12,WKACLENX(,RBSECPTR)                             0330 00545000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00546000
         B     EXITCLN                                             0331 00547000
*         END;                                                     0332 00548000
*     END;                          /* END OF ENQ REQUESTS           */ 00549000
@RF00328 DS    0H                                                  0334 00550000
*/* DEQ REQUESTS: IF CONTROL BLOCKS WERE PARTIALLY CHANGED AND USER  */ 00551000
*/* ERROR WAS DETERMINED, CONTINUE DEQUEUING REQUEST IF NO OTHER RE- */ 00552000
*/* QUESTS ARE WAITING. DONT CLEANUP - MAY INVALIDATE CONTROL BLOCKS */ 00553000
*/* FURTHER. IF NOT A USER ERROR CONTINUE DEQUEUING THIS REQUEST.    */ 00554000
*/* GIVE THE BLOCK TO NEXT WAITING IOB AND ISSUE A NEW EXCP (SO THE  */ 00555000
*/* ASI CAN POST THE REQUEST) OR ISSUE DEQ AND CLEAR RDXLIST ENTRY.  */ 00556000
*                                                                  0334 00557000
*   IF WKADEQRQ='1'B THEN           /* IS IT A DEQ REQUEST           */ 00558000
@RF00215 TM    WKADEQRQ(RBSECPTR),B'00000010'                      0334 00559000
         BNO   @RF00334                                            0334 00560000
*     DO;                           /* COMPLETE OR UNDO CHANGES      */ 00561000
*       IF(WKATRALX=WKAIOBSV)&(BLKCTR>NXTIOBER) THEN/* IOB WAITING,     00562000
*                                      AND NOT A                     */ 00563000
         CLI   WKATRALX(RBSECPTR),4                                0336 00564000
         BNE   @RF00336                                            0336 00565000
         C     BLKCTR,@CF01050                                     0336 00566000
         BNH   @RF00336                                            0336 00567000
*         DO;                       /* USER ERROR,CONTINUE DEQING    */ 00568000
*           IF WKAXADDR=0 THEN      /* IF NO RDXENTRY ADDR           */ 00569000
         L     @12,WKAXADDR(,RBSECPTR)                             0338 00570000
         LTR   @12,@12                                             0338 00571000
         BNZ   @RF00338                                            0338 00572000
*             DO;                   /* CANNOT CLEAN UP               */ 00573000
*               WKACLENX=CLEANRC1(7);/* CLEANUP CODE = UNCERTAIN     */ 00574000
         IC    @12,CLEANRC1+6                                      0340 00575000
         STC   @12,WKACLENX(,RBSECPTR)                             0340 00576000
*               GOTO EXITCLN;       /* RETURN TO MAIN ROUTINE        */ 00577000
         B     EXITCLN                                             0341 00578000
*             END;                                                 0342 00579000
*           RFY                                                    0343 00580000
*             IOBSTDRD BASED(WKAIOBQX);/* MAKE NEXT IOB BASE- IT WAS    00581000
*                                      SAVED IN SVRB BY SVC          */ 00582000
@RF00338 DS    0H                                                  0344 00583000
*           DO;                     /* MODESET EXTKEY(DATAMGT)       */ 00584000
*             SPKA(80);             /* SET PSW KEY                   */ 00585000
         LA    @12,80                                              0345 00586000
         SPKA  0(@12)                                              0345 00587000
*           END;                    /* MODESET EXTKEY(DATAMGT) CHANGE   00588000
*                                      TO KEY 5                      */ 00589000
*           RDXIOBUQ=IOBDQPTR;      /* TAKE NEXT IOB OFF QUE-PUT 1ST    00590000
*                                      IOB AFTER,1ST ON UNPOSTED     */ 00591000
         L     @12,WKAIOBQX(,RBSECPTR)                             0347 00592000
         L     @12,IOBDQPTR(,@12)                                  0347 00593000
         ST    @12,RDXIOBUQ(,RDXENTRG)                             0347 00594000
*           IF IOBDQPTR=0 THEN      /* IF NEX IOB IS ONLY WAITING    */ 00595000
         SLR   @11,@11                                             0348 00596000
         CR    @12,@11                                             0348 00597000
         BNE   @RF00348                                            0348 00598000
*             RDXUQND=0;            /* ZERO LAST IOB IN UNPOSTED     */ 00599000
         ST    @11,RDXUQND(,RDXENTRG)                              0349 00600000
*           DO;                     /* MODESET EXTKEY(SUPR)          */ 00601000
@RF00348 DS    0H                                                  0351 00602000
*             SPKA(0);              /* SET PSW KEY                   */ 00603000
         SLR   @12,@12                                             0351 00604000
         SPKA  0(@12)                                              0351 00605000
*           END;                    /* MODESET EXTKEY(SUPR) CHANGE TO   00606000
*                                      SUPER KEY                     */ 00607000
*           GOTO EXCPNXT;           /* RESTART NEXT IOB REQUEST      */ 00608000
         B     EXCPNXT                                             0353 00609000
*         END;                                                     0354 00610000
*       IF(WKATRALX=WKAIOBSV)&(BLKCTR¬>NXTIOBER) THEN/* USER         */ 00611000
@RF00336 CLI   WKATRALX(RBSECPTR),4                                0355 00612000
         BNE   @RF00355                                            0355 00613000
         C     BLKCTR,@CF01050                                     0355 00614000
         BH    @RF00355                                            0355 00615000
*         DO;                       /* ERR IOB WAITS,DONT TAMPER     */ 00616000
*           WKACLENX=CLEANRC1(5);   /* CLEANUP RC = CAUTION          */ 00617000
         IC    @12,CLEANRC1+4                                      0357 00618000
         STC   @12,WKACLENX(,RBSECPTR)                             0357 00619000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00620000
         B     EXITCLN                                             0358 00621000
*         END;                                                     0359 00622000
*       IF WKATRALX=WKAIOBDQ&BLKCTR>NXTIOBER THEN/* IOB DEQD,NOT USER   00623000
*                                      ERROR,START NEXT REQUEST      */ 00624000
@RF00355 CLI   WKATRALX(RBSECPTR),5                                0360 00625000
         BNE   @RF00360                                            0360 00626000
         C     BLKCTR,@CF01050                                     0360 00627000
         BH    @RT00360                                            0360 00628000
*         GOTO EXCPNXT;             /* GO TO EXCP,ASI WILL FINISH  0361 00629000
*                                      PROCESSING NEXT IOB REQUEST   */ 00630000
*       IF(WKATRALX=WKAIOBDQ)&(BLKCTR¬>NXTIOBER) THEN/* IF IOB WAS 0362 00631000
*                                      DEQUEUED                      */ 00632000
@RF00360 CLI   WKATRALX(RBSECPTR),5                                0362 00633000
         BNE   @RF00362                                            0362 00634000
         C     BLKCTR,@CF01050                                     0362 00635000
         BH    @RF00362                                            0362 00636000
*         DO;                       /* AND USER ERROR, DONT CLEAN    */ 00637000
*           WKACLENX=CLEANRC1(5);   /* CLEANUP RC = CAUTION          */ 00638000
         IC    @12,CLEANRC1+4                                      0364 00639000
         STC   @12,WKACLENX(,RBSECPTR)                             0364 00640000
*           GOTO EXITCLN;           /* RETURN TO MAIN RTN            */ 00641000
         B     EXITCLN                                             0365 00642000
*         END;                                                     0366 00643000
*       IF(WKATRALX=WKADEQ)&(BLKCTR>NXTIOBER) THEN/* REQ DEQD        */ 00644000
@RF00362 CLI   WKATRALX(RBSECPTR),2                                0367 00645000
         BNE   @RF00367                                            0367 00646000
         C     BLKCTR,@CF01050                                     0367 00647000
         BNH   @RF00367                                            0367 00648000
*         DO;                       /* BUT RDXENTRY NOT CLEARED      */ 00649000
*           IF WKAXADDR=0 THEN      /* IF NO RDXENTRY ADDR           */ 00650000
         L     @12,WKAXADDR(,RBSECPTR)                             0369 00651000
         LTR   @12,@12                                             0369 00652000
         BNZ   @RF00369                                            0369 00653000
*             DO;                   /* CANNOT CLEAN UP               */ 00654000
*               WKACLENX=CLEANRC1(7);/* CLEAN CODE = UNCERTAIN       */ 00655000
         IC    @12,CLEANRC1+6                                      0371 00656000
         STC   @12,WKACLENX(,RBSECPTR)                             0371 00657000
*               GOTO EXITCLN;       /* RETURN TO MAIN ROUTINE        */ 00658000
         B     EXITCLN                                             0372 00659000
*             END;                                                 0373 00660000
*           IF RDXIOBUQ¬=0 THEN     /* IF NOT USER ERROR,MUST        */ 00661000
@RF00369 SLR   @12,@12                                             0374 00662000
         L     @11,RDXIOBUQ(,RDXENTRG)                             0374 00663000
         CR    @11,@12                                             0374 00664000
         BE    @RF00374                                            0374 00665000
*             DO;                   /* CLEAR RDXENTRY OR GIVE BLK TO    00666000
*                                      NEXT IOB-1ST ON UNPOSTED Q    */ 00667000
*               RFY                                                0376 00668000
*                 IOBSTDRD BASED(RDXIOBUQ);/* NEX IOB IS IOB BASE    */ 00669000
*               WKAIOBQX=RDXIOBUQ;  /* PUT IOB IN SVRB TO EXCP       */ 00670000
         ST    @11,WKAIOBQX(,RBSECPTR)                             0377 00671000
*               DO;                 /* MODESET EXTKEY(DATAMGT)       */ 00672000
*                 SPKA(80);         /* SET PSW KEY                   */ 00673000
         LA    @04,80                                              0379 00674000
         SPKA  0(@04)                                              0379 00675000
*               END;                /* MODESET EXTKEY(DATAMGT) CHANGE   00676000
*                                      TO KEY 5                      */ 00677000
*               RDXIOBUQ=IOBDQPTR;  /* MAKE IOB CHAINED TO IT 1ST ON    00678000
*                                      UNPOSTED QUEUE                */ 00679000
         L     @11,IOBDQPTR(,@11)                                  0381 00680000
         ST    @11,RDXIOBUQ(,RDXENTRG)                             0381 00681000
*               IF IOBDQPTR=0 THEN  /* IF NEXT IOB IS ONLY IOB,      */ 00682000
         C     @12,IOBDQPTR(,@11)                                  0382 00683000
         BNE   @RF00382                                            0382 00684000
*                 RDXUQND=0;        /* ZERO LAST IOB-NONE WAITING    */ 00685000
         ST    @12,RDXUQND(,RDXENTRG)                              0383 00686000
*               DO;                 /* MODESET EXTKEY(SUPR)          */ 00687000
@RF00382 DS    0H                                                  0385 00688000
*                 SPKA(0);          /* SET PSW KEY                   */ 00689000
         SLR   @12,@12                                             0385 00690000
         SPKA  0(@12)                                              0385 00691000
*               END;                /* MODESET EXTKEY(SUPR) RETURN TO   00692000
*                                      KEY 0                         */ 00693000
*               GOTO ENQ;           /* REISSUE ENQ AND EXCP FOR NEXT    00694000
*                                      IOB ADDED AFTER DEQ           */ 00695000
         B     ENQ                                                 0387 00696000
*             END;                                                 0388 00697000
*           ELSE                    /* IF NO IOB WAITING FOR BLK     */ 00698000
*             DO;                   /* MUST CLEAR ENTRY IN RDXLST    */ 00699000
@RF00374 DS    0H                                                  0390 00700000
*               DO;                 /* MODESET EXTKEY(DATAMGT)       */ 00701000
*                 SPKA(80);         /* SET PSW KEY                   */ 00702000
         LA    @12,80                                              0391 00703000
         SPKA  0(@12)                                              0391 00704000
*               END;                /* MODESET EXTKEY(DATAMGT) CHANGE   00705000
*                                      TO KEY 5                      */ 00706000
*               RDXENTRY=RDXENTRY&&RDXENTRY;/* CLEAR READX ENTRY     */ 00707000
         XC    RDXENTRY(16,RDXENTRG),RDXENTRY(RDXENTRG)            0393 00708000
*               DO;                 /* MODESET EXTKEY(SUPR)          */ 00709000
*                 SPKA(0);          /* SET PSW KEY                   */ 00710000
         SLR   @12,@12                                             0395 00711000
         SPKA  0(@12)                                              0395 00712000
*               END;                /* MODESET EXTKEY(SUPR) CHANGE TO   00713000
*                                      KEY ZERO                      */ 00714000
*               WKACLENX=CLEANRC1(2);/* CLEANRC = TRIED & LOOKS OK   */ 00715000
         IC    @12,CLEANRC1+1                                      0397 00716000
         STC   @12,WKACLENX(,RBSECPTR)                             0397 00717000
*               GOTO EXITCLN;       /* RETURN TO MAIN ROUTINE        */ 00718000
         B     EXITCLN                                             0398 00719000
*             END;                                                 0399 00720000
*         END;                      /* END OF DEQD,NOT USER ERROR    */ 00721000
*       IF(WKATRALX=WKADEQ)&(BLKCTR¬>NXTIOBER) THEN/* REQ DEQD       */ 00722000
@RF00367 CLI   WKATRALX(RBSECPTR),2                                0401 00723000
         BNE   @RF00401                                            0401 00724000
         C     BLKCTR,@CF01050                                     0401 00725000
         BH    @RF00401                                            0401 00726000
*         DO;                       /* USER ERROR - NO CLEANUP       */ 00727000
*           WKACLENX=CLEANRC1(6);   /* CLEANUP RC = CAUTION          */ 00728000
         IC    @12,CLEANRC1+5                                      0403 00729000
         STC   @12,WKACLENX(,RBSECPTR)                             0403 00730000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00731000
         B     EXITCLN                                             0404 00732000
*         END;                                                     0405 00733000
*       IF WKATRALX=WKARDXZR THEN   /* RDXENTRY IS CLEARED-ALL OK    */ 00734000
@RF00401 CLI   WKATRALX(RBSECPTR),3                                0406 00735000
         BNE   @RF00406                                            0406 00736000
*         DO;                       /* PROCESSING COMPLETE FOR       */ 00737000
*           WKACLENX=CLEANRC1(4);   /* THIS IOB. CLEANUP RC = OK     */ 00738000
         IC    @12,CLEANRC1+3                                      0408 00739000
         STC   @12,WKACLENX(,RBSECPTR)                             0408 00740000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00741000
         B     EXITCLN                                             0409 00742000
*         END;                                                     0410 00743000
*       IF WKATRALX=WKAENQRD THEN   /* IOB PUT ON WAIT QUE DURING DEQ   00744000
*                                      - MUST ENQ AND EXCP ON NEXT 0411 00745000
*                                      IOB SAVED IN SVRB BY SVC 53   */ 00746000
@RF00406 CLI   WKATRALX(RBSECPTR),10                               0411 00747000
         BE    @RT00411                                            0411 00748000
*         GOTO ENQ;                 /* GO TO ROUTINE, ENQ & EXCP     */ 00749000
*       IF WKATRALX=WKAENQX THEN    /* IF ENQD ON WAITING REQUEST  0413 00750000
*                                      ISSUE EXCP TO COMPLETE IT     */ 00751000
         CLI   WKATRALX(RBSECPTR),8                                0413 00752000
         BE    @RT00413                                            0413 00753000
*         GOTO EXCPNXT;             /* GO EXCP-NEXT IOB IN SVRB      */ 00754000
*       IF WKATRALX=WKAEXCPX THEN   /* IF EXCP DONE, ALL OK          */ 00755000
         CLI   WKATRALX(RBSECPTR),9                                0415 00756000
         BNE   @RF00415                                            0415 00757000
*         DO;                       /* THE PROCESSING IS COMPLETE    */ 00758000
*           WKACLENX=CLEANRC1(4);   /* CLEANUP RC = OK               */ 00759000
         IC    @12,CLEANRC1+3                                      0417 00760000
         STC   @12,WKACLENX(,RBSECPTR)                             0417 00761000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00762000
         B     EXITCLN                                             0418 00763000
*         END;                                                     0419 00764000
*       IF WKATRALX=WKAFEED THEN    /* FEEDBK DONE, BUT NO POST      */ 00765000
@RF00415 CLI   WKATRALX(RBSECPTR),6                                0420 00766000
         BNE   @RF00420                                            0420 00767000
*         DO;                       /* POST REQUEST REGARDLESS       */ 00768000
*POSTREQ:                                                          0422 00769000
*           ;                       /* FREE LOCK BEFORE POST SVC     */ 00770000
POSTREQ  DS    0H                                                  0423 00771000
*           RFY                                                    0423 00772000
*             GPR00P RSTD;          /* RESTRICT SAVE REG       YM7519*/ 00773000
*           GPR00P=SAVEPTR;         /* SAVE RTM SAVE ADDR      YM7519*/ 00774000
         LR    GPR00P,SAVEPTR                                      0424 00775000
*           DO;                     /* SETLOCK (RELEASE) TYPE(LOCAL)    00776000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   00777000
*                                      CK))                          */ 00778000
*             RFY                                                  0426 00779000
*              (GPR11P,                                            0426 00780000
*               GPR12P,                                            0426 00781000
*               GPR13P,                                            0426 00782000
*               GPR14P) RSTD;                                      0426 00783000
*             GPR13P=PSALITA;       /* ADDRESS OF LOCK INTERFACE   0427 00784000
*                                      TABLE.                        */ 00785000
         L     GPR13P,PSALITA                                      0427 00786000
*             GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD,  0428 00787000
*                                      CLHT AND ENTRY ADRS.          */ 00788000
         LM GPR11P,GPR13P,588(GPR13P)                                   00789000
*             GEN(BALR GPR14P,GPR13P);/* BALR TO SETLOCK RTN.        */ 00790000
         BALR GPR14P,GPR13P                                             00791000
*             RFY                                                  0430 00792000
*              (GPR11P,                                            0430 00793000
*               GPR12P,                                            0430 00794000
*               GPR13P,                                            0430 00795000
*               GPR14P) UNRSTD;                                    0430 00796000
*           END;                    /* SETLOCK (RELEASE) TYPE(LOCAL)    00797000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   00798000
*                                      CK)) FREE LOCAL LOCK          */ 00799000
*           SAVEPTR=GPR00P;         /* RESTOR RTM SAV ADDR     YM7519*/ 00800000
         LR    SAVEPTR,GPR00P                                      0432 00801000
*           RFY                                                    0433 00802000
*            (GPR01P,                                              0433 00803000
*             WRKREG) RSTD;         /* OF CAUSE OF ERROR             */ 00804000
*           RFY                                                    0434 00805000
*             IOBSTDRD BASED(ABS(RBGRS1));/* BASE IOB ON CURRENT     */ 00806000
*           WRKREG=WKAIOBQX;        /* SET UP WORKREG WITH NEXT      */ 00807000
         L     WRKREG,WKAIOBQX(,RBSECPTR)                          0435 00808000
*           IF RBGRS1<0 THEN        /* IF NOT RELEX REQ              */ 00809000
         L     @12,RBGRS1(,RBSECPTR)                               0436 00810000
         LTR   @12,@12                                             0436 00811000
         BNM   @RF00436                                            0436 00812000
*             DO;                   /* CHECK IF WA,WRITTEN OUT       */ 00813000
*               IF IOBADDTY='1'B&IOBADDVU='1'B THEN/* IF WRITE-ADD,  */ 00814000
         LPR   @12,@12                                             0438 00815000
         TM    IOBADDTY(@12),B'00000010'                           0438 00816000
         BNO   @RF00438                                            0438 00817000
         TM    IOBADDVU(@12),B'00000010'                           0438 00818000
         BNO   @RF00438                                            0438 00819000
*                 WRKREG=ABS(RBGRS1);/* REC WRITTEN OUT, THEN FINISH    00820000
*                                      PROCESSING CURRENT IOB -SELF     00821000
*                                      FORMAT MOD WILL HANDLE NEXT   */ 00822000
         LR    WRKREG,@12                                          0439 00823000
*             END;                                                 0440 00824000
@RF00438 DS    0H                                                  0441 00825000
*           RFY                                                    0441 00826000
*             IOBSTDRD BASED(WRKREG);/* IOB BASE CURRENT OR NEX      */ 00827000
@RF00436 DS    0H                                                  0442 00828000
*           GPR00P=IOBSTAT2;        /* PUT CONDITION CODE IN REG     */ 00829000
         SLR   GPR00P,GPR00P                                       0442 00830000
         IC    GPR00P,IOBSTAT2(,WRKREG)                            0442 00831000
*           GEN(SLL  GPR00P,16);    /* MOVE RC TO THIRD BYTE         */ 00832000
         SLL  GPR00P,16                                                 00833000
*           GPR01P=IOBECBPT;        /* PUT ECB ADDR IN R 1           */ 00834000
         L     GPR01P,IOBECBPT(,WRKREG)                            0444 00835000
*           GEN(POST (1),(0));      /* POST THE REQUEST COMPLETE     */ 00836000
         POST (1),(0)                                                   00837000
*           IF DCBMRCK¬='1'B THEN   /* IF CHECK ISNT SPECIFIED       */ 00838000
         TM    DCBMRCK+40(DCBPTR),B'00000001'                      0446 00839000
         BO    @RF00446                                            0446 00840000
*             DO;                   /* MUST RELEASE IOB HERE         */ 00841000
*               DO;                 /* MODESET KEYADDR(WKASVKEY)     */ 00842000
*                 SPKA(WKASVKEY);   /* SET PSW KEY                   */ 00843000
         SLR   @12,@12                                             0449 00844000
         IC    @12,WKASVKEY(,RBSECPTR)                             0449 00845000
         SPKA  0(@12)                                              0449 00846000
*               END;                /* MODESET KEYADDR(WKASVKEY)   0450 00847000
*                                      CHANGE TO USER KEY            */ 00848000
*               IOBDAYLI=0;         /* MAKE THIS IOB AVAILABLE       */ 00849000
         MVI   IOBDAYLI(WRKREG),X'00'                              0451 00850000
*               DO;                 /* MODESET EXTKEY(SUPR)          */ 00851000
*                 SPKA(0);          /* SET PSW KEY                   */ 00852000
         SLR   @12,@12                                             0453 00853000
         SPKA  0(@12)                                              0453 00854000
*               END;                /* MODESET EXTKEY(SUPR) RETURN TO   00855000
*                                      SUPER KEY                     */ 00856000
*             END;                                                 0455 00857000
*           WKACLENX=CLEANRC1(2);   /* CLEANUP RC = OK,HOPEFULLY     */ 00858000
@RF00446 IC    @12,CLEANRC1+1                                      0456 00859000
         STC   @12,WKACLENX(,RBSECPTR)                             0456 00860000
*           IF WRKREG¬=ABS(RBGRS1) THEN/* IF JUST POSTED NEXT IOB, 0457 00861000
*                                      THE CURRENT IOB WILL NOT GET     00862000
*                                      POSTED,BUT READX Q CLEANED UP */ 00863000
         L     @12,RBGRS1(,RBSECPTR)                               0457 00864000
         LPR   @12,@12                                             0457 00865000
         CR    WRKREG,@12                                          0457 00866000
         BNE   @RT00457                                            0457 00867000
*             GOTO EXITCLN;         /* SO RETURN TO MAIN ROUTINE     */ 00868000
*           RFY                                                    0459 00869000
*            (WRKREG) UNRSTD;       /* RELEASE TEMPORARY IOB BASE    */ 00870000
*         END;                      /* END IF FEEDBK DONE            */ 00871000
*       RFY                                                        0461 00872000
*         IOBSTDRD BASED(ABS(RBGRS1));/* CURRENT IOB BASE            */ 00873000
@RF00420 DS    0H                                                  0462 00874000
*       IF IOBADDTY='1'B&IOBADDVU='1'B&WKAIOBQX¬=0 THEN/* WA REQ     */ 00875000
         L     @12,RBGRS1(,RBSECPTR)                               0462 00876000
         LPR   @12,@12                                             0462 00877000
         TM    IOBADDTY(@12),B'00000010'                           0462 00878000
         BNO   @RF00462                                            0462 00879000
         TM    IOBADDVU(@12),B'00000010'                           0462 00880000
         BNO   @RF00462                                            0462 00881000
         L     @12,WKAIOBQX(,RBSECPTR)                             0462 00882000
         LTR   @12,@12                                             0462 00883000
         BNZ   @RT00462                                            0462 00884000
*         GOTO EXCPNXT;             /* REC WRITTEN,START NEXT REQ    */ 00885000
*       IF WKATRALX=WKAPOST THEN    /* IF IOB POSTED, ALL OK         */ 00886000
@RF00462 CLI   WKATRALX(RBSECPTR),7                                0464 00887000
         BNE   @RF00464                                            0464 00888000
*         DO;                       /* PROCESSING COMPLETED          */ 00889000
*           WKACLENX=CLEANRC1(4);   /* CLEANRC = OK                  */ 00890000
         IC    @12,CLEANRC1+3                                      0466 00891000
         STC   @12,WKACLENX(,RBSECPTR)                             0466 00892000
*           GOTO EXITCLN;           /* RETURN TO MAIN ROUTINE        */ 00893000
         B     EXITCLN                                             0467 00894000
*         END;                                                     0468 00895000
*     END;                          /* END OF DEQ PROCESSING         */ 00896000
*/* IF NEITHER ENQ NOR DEQ AUDIT TRAIL BIT ON, UNKNOWN CONDITION     */ 00897000
*                                                                  0470 00898000
*   ELSE                            /* ALL BITS CHECK AND STILL      */ 00899000
*     DO;                           /* NO HIT,EITHER EARLY ABEND,    */ 00900000
         B     @RC00334                                            0470 00901000
@RF00334 DS    0H                                                  0471 00902000
*       WKACLENX=CLEANRC1(7);       /* AUDIT TRAIL BIT INVALID       */ 00903000
         IC    @12,CLEANRC1+6                                      0471 00904000
         STC   @12,WKACLENX(,RBSECPTR)                             0471 00905000
*       GOTO EXITCLN;               /* RETURN TO MAIN ROUTINE        */ 00906000
         B     EXITCLN                                             0472 00907000
*     END;                                                         0473 00908000
*                                                                  0473 00909000
*/* THE FOLLOWING ENQ/EXCP ROUTINE WILL ENQ ON THE BLOCK IN THE SVRB */ 00910000
*/* UNDER THE TCB WHICH OPENED THE DCB IF THE RECORD IS IMMEDIATELY  */ 00911000
*/* AVAILABLE.  IF IT IS NOT AVAILABLE, ENQ UNDER THE CURRENT TCB,   */ 00912000
*/* WAIT FOR CONTROL, THEN QUICKLY DEQ IT AND ENQ AGAIN UNDER THE    */ 00913000
*/* TCB WHICH OPENED THE DCB.  ONCE CONTROL IS OBTAINED IN THIS      */ 00914000
*/* CLEVER, EFFICIENT, ECONOMICAL, DIRECT, UNCOMPLICATED FASHION,    */ 00915000
*/* EXCP ON THE REQUEST SO YOU CAN GET OUT OF HERE AND GET HELP.     */ 00916000
*                                                                  0474 00917000
*ENQ:                                                              0474 00918000
*   ;                               /* ENQ ON REQUEST                */ 00919000
@RC00334 DS    0H                                                  0474 00920000
ENQ      DS    0H                                                  0475 00921000
*   RFY                                                            0475 00922000
*     GPR00P RSTD;                  /* RESTRICT SAVE REG       YM7519*/ 00923000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE ADDR      YM7519   00924000
*                                      FREE LOCK BEFORE ENQ SVC      */ 00925000
         LR    GPR00P,SAVEPTR                                      0476 00926000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    00927000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   00928000
*                                      CK))                          */ 00929000
*     RFY                                                          0478 00930000
*      (GPR11P,                                                    0478 00931000
*       GPR12P,                                                    0478 00932000
*       GPR13P,                                                    0478 00933000
*       GPR14P) RSTD;                                              0478 00934000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0479 00935000
*                                      TABLE.                        */ 00936000
         L     GPR13P,PSALITA                                      0479 00937000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0480 00938000
*                                      ENTRY ADRS.                   */ 00939000
         LM GPR11P,GPR13P,588(GPR13P)                                   00940000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 00941000
         BALR GPR14P,GPR13P                                             00942000
*     RFY                                                          0482 00943000
*      (GPR11P,                                                    0482 00944000
*       GPR12P,                                                    0482 00945000
*       GPR13P,                                                    0482 00946000
*       GPR14P) UNRSTD;                                            0482 00947000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    00948000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   00949000
*                                      CK)) FREE LOCAL LOCK          */ 00950000
*   SAVEPTR=GPR00P;                 /* RESTOR RTM SAVE AD      YM7519*/ 00951000
         LR    SAVEPTR,GPR00P                                      0484 00952000
*   RFY                                                            0485 00953000
*     GPR00P UNRSTD;                /*                         YM7519*/ 00954000
*   IF BLKCTR=DEBERR THEN           /* DEB ERROR, CANT CLEANUP       */ 00955000
         C     BLKCTR,@CF01507                                     0486 00956000
         BNE   @RF00486                                            0486 00957000
*     DO;                           /* NEED VALID DEB TO ENQ BLK     */ 00958000
*       WKACLENX=CLEANRC1(7);       /* CLEANUP RC= CAUTION           */ 00959000
         IC    @12,CLEANRC1+6                                      0488 00960000
         STC   @12,WKACLENX(,RBSECPTR)                             0488 00961000
*       GOTO EXITCLN;               /* RETURN TO MAIN ROUTINE        */ 00962000
         B     EXITCLN                                             0489 00963000
*     END;                                                         0490 00964000
*   CALL DEBCHECK;                  /* TO COMPARE TCBS MUST HAVE   0491 00965000
*                                      VALIDATED DEB                 */ 00966000
@RF00486 BAL   @14,DEBCHECK                                        0491 00967000
*   IF WKADEBXC¬=0 THEN             /* IF DEB BAD SET RC AND RET     */ 00968000
         CLI   WKADEBXC(RBSECPTR),0                                0492 00969000
         BE    @RF00492                                            0492 00970000
*     DO;                           /* SET RET CODE FOR UNKNOWN      */ 00971000
*       WKACLENX=CLEANRC1(7);       /* CLEANUP RC = CAUTION          */ 00972000
         IC    @12,CLEANRC1+6                                      0494 00973000
         STC   @12,WKACLENX(,RBSECPTR)                             0494 00974000
*       GOTO EXITCLN;               /* RETURN TO MAIN ROUTINE        */ 00975000
         B     EXITCLN                                             0495 00976000
*     END;                                                         0496 00977000
*   RFY                                                            0497 00978000
*     DEBBASIC BASED(WKASVDEB);     /* ESTABLISH DEB,PTR IN SVRB     */ 00979000
@RF00492 DS    0H                                                  0498 00980000
*   WKANQLST=ENQLIST;               /* MV ENQ LIST INTO WORKAREA     */ 00981000
         MVC   WKANQLST(12,RBSECPTR),ENQLIST                       0498 00982000
*   RFY                                                            0499 00983000
*     WRKREG RSTD;                  /* RESTRICT WORK REG             */ 00984000
*/*            THE FOLLOWING MACRO WILL ENQ ON THE RECORD UNDER      */ 00985000
*/*            THE TCB WHICH OPENED THE DCB IF THE RECORD IS         */ 00986000
*/*            IMMEDIATELY AVAILABLE.                                */ 00987000
*                                                                  0500 00988000
*ENQUSE:                                                           0500 00989000
*   ;                               /* ENQ ON TCB IN DEB FIRST       */ 00990000
ENQUSE   DS    0H                                                  0501 00991000
*   IF PSATOLD¬=DEBTCBB THEN        /* TCBS NOT SAME,MAY NEED 2      */ 00992000
         L     @12,WKASVDEB(,RBSECPTR)                             0501 00993000
         L     @12,DEBTCBB-1(,@12)                                 0501 00994000
         LA    @12,0(,@12)                                         0501 00995000
         C     @12,PSATOLD                                         0501 00996000
         BE    @RF00501                                            0501 00997000
*     DO;                           /* ENQ,CANT ENQ ONLY ON TCB IN 0502 00998000
*                                      DEB CUZ DIRECT ENQ WONT WAIT  */ 00999000
*       WRKREG=DEBTCBB;             /* PUT DEB TCB IN REG            */ 01000000
         LR    WRKREG,@12                                          0503 01001000
*       RFY                                                        0504 01002000
*         GPR01P RSTD;              /* RESTRICT PARM REG       YM7597*/ 01003000
*       GPR01P=ADDR(WKANQLST);      /* ENQ PARM LST IN R1      YM7597*/ 01004000
         LA    GPR01P,WKANQLST(,RBSECPTR)                          0505 01005000
*       GEN REFS(WKANQARG,WKANQLST);                               0506 01006000
           ENQ  (,WKANQARG(RBSECPTR),E,,SYSTEM),TCB=(11),RET=USE,     XX01007000
               MF=(E,(1))                                       YM7597  01008000
*       RFY                                                        0507 01009000
*         GPR01P UNRSTD;            /* RELEASE PARM REG        YM7597*/ 01010000
*       RFY                                                        0508 01011000
*         GPR15P RSTD;              /* RESTRICT RETURN REG           */ 01012000
*       IF GPR15P=0 THEN            /* IF GOT CONTROL OF RECORD      */ 01013000
         LTR   GPR15P,GPR15P                                       0509 01014000
         BZ    @RT00509                                            0509 01015000
*         GOTO EXCPNXT;             /* GO EXCP AGAIN TO READ IT      */ 01016000
*       RFY                                                        0511 01017000
*        (WRKREG,                                                  0511 01018000
*         GPR15P) UNRSTD;                                          0511 01019000
*     END;                                                         0512 01020000
*                                                                  0512 01021000
*/*            THE FOLLOWING MACRO WILL REQUEST THE RECORD           */ 01022000
*/*            UNDER THIS TCB, AND WAIT UNTIL THE RECORD IS          */ 01023000
*/*            AVAILABLE.                                            */ 01024000
*                                                                  0513 01025000
*ENQHAVE:                                                          0513 01026000
*   ;                               /* ENQ UNDER CURRENT TCB         */ 01027000
@RF00501 DS    0H                                                  0513 01028000
ENQHAVE  DS    0H                                                  0514 01029000
*   GEN REFS(WKANQARG,WKANQLST);                                   0514 01030000
*                                                                  0514 01031000
        ENQ   (,WKANQARG(RBSECPTR),E,,SYSTEM),RET=HAVE,               XX01032000
               MF=(E,WKANQLST(RBSECPTR))                        YM7597  01033000
*/*            THE FOLLOWING MACRO WILL DEQ THE RECORD IN ORDER      */ 01034000
*/*            TO SUBSEQUENTLY ENQ IT UNDER THE RIGHT TCB.           */ 01035000
*                                                                  0515 01036000
*   IF PSATOLD¬=DEBTCBB THEN        /* IF WAS ENQ UNDER WRONG TCB    */ 01037000
         L     @12,WKASVDEB(,RBSECPTR)                             0515 01038000
         L     @11,PSATOLD                                         0515 01039000
         L     @12,DEBTCBB-1(,@12)                                 0515 01040000
         LA    @12,0(,@12)                                         0515 01041000
         CR    @11,@12                                             0515 01042000
         BE    @RF00515                                            0515 01043000
*     DO;                           /* DEQ AND REENQ AGAIN FAST      */ 01044000
*       GEN REFS(WKANQLST);                                        0517 01045000
           DEQ   (,,,SYSTEM),MF=(E,WKANQLST(RBSECPTR)),RET=NONE YM7597  01046000
*       GOTO ENQUSE;                /* GO RE-ENQ ON RIGHT TCB        */ 01047000
         B     ENQUSE                                              0518 01048000
*     END;                                                         0519 01049000
*                                                                  0519 01050000
*/* EXCP ON REQUEST NOW THAT EXCLUSIVE CONTROL HAS BEEN OBTAINED     */ 01051000
*                                                                  0520 01052000
*EXCPNXT:                                                          0520 01053000
*   ;                               /* START NEXT REQUEST            */ 01054000
@RF00515 DS    0H                                                  0520 01055000
EXCPNXT  DS    0H                                                  0521 01056000
*   RFY                                                            0521 01057000
*     GPR00P RSTD;                  /* RESTRICT SAVE REG       YM7519*/ 01058000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE ADDR      YM7519   01059000
*                                      FREE LOCK BEFORE ENQ SVC      */ 01060000
         LR    GPR00P,SAVEPTR                                      0522 01061000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    01062000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   01063000
*                                      CK))                          */ 01064000
*     RFY                                                          0524 01065000
*      (GPR11P,                                                    0524 01066000
*       GPR12P,                                                    0524 01067000
*       GPR13P,                                                    0524 01068000
*       GPR14P) RSTD;                                              0524 01069000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0525 01070000
*                                      TABLE.                        */ 01071000
         L     GPR13P,PSALITA                                      0525 01072000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0526 01073000
*                                      ENTRY ADRS.                   */ 01074000
         LM GPR11P,GPR13P,588(GPR13P)                                   01075000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 01076000
         BALR GPR14P,GPR13P                                             01077000
*     RFY                                                          0528 01078000
*      (GPR11P,                                                    0528 01079000
*       GPR12P,                                                    0528 01080000
*       GPR13P,                                                    0528 01081000
*       GPR14P) UNRSTD;                                            0528 01082000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    01083000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   01084000
*                                      CK)) FREE LOCAL LOCK          */ 01085000
*   SAVEPTR=GPR00P;                 /* RESTOR RTM SAVE AD      YM7519*/ 01086000
         LR    SAVEPTR,GPR00P                                      0530 01087000
*   RFY                                                            0531 01088000
*     GPR00P UNRSTD;                /*                         YM7519*/ 01089000
*   RFY                                                            0532 01090000
*     IOBSTDRD BASED(WKAIOBQX);     /* ESTABLISH IOB BASE-NEX IOB    */ 01091000
*   DO;                             /* MODESET KEYADDR(WKASVKEY)     */ 01092000
*     SPKA(WKASVKEY);               /* SET PSW KEY                   */ 01093000
         SLR   @12,@12                                             0534 01094000
         IC    @12,WKASVKEY(,RBSECPTR)                             0534 01095000
         SPKA  0(@12)                                              0534 01096000
*   END;                            /* MODESET KEYADDR(WKASVKEY)   0535 01097000
*                                      CHANGE TO USER KEY            */ 01098000
*   IOBENQUE='1'B;                  /* TURN ON ENQ BIT-THIS IOB HAS     01099000
*                                      EXCLUSIVE CONTROL             */ 01100000
         L     @12,WKAIOBQX(,RBSECPTR)                             0536 01101000
         OI    IOBENQUE(@12),B'00001000'                           0536 01102000
*   IOBDQPTR=IOBECBPT;              /* SAVE USER ECB ADDR IN CHAIN 0537 01103000
*                                      FIELD,RESTORED BY CEA         */ 01104000
         L     @11,IOBECBPT(,@12)                                  0537 01105000
         ST    @11,IOBDQPTR(,@12)                                  0537 01106000
*   IOBECBPT=ADDR(IOBSTBYT);        /* GIVE IOS DUMMY ECB      YM7570*/ 01107000
         LA    @11,IOBSTBYT(,@12)                                  0538 01108000
         ST    @11,IOBECBPT(,@12)                                  0538 01109000
*   RFY                                                            0539 01110000
*     GPR01P RSTD;                  /* RESTRICT EXCP PARM REG        */ 01111000
*   GPR01P=ADDR(IOBSTDRD);          /* PUT ADDR OF IOB IN PARMREG    */ 01112000
         LR    GPR01P,@12                                          0540 01113000
*   GENERATE;                                                      0541 01114000
        EXCP  (1)                      INITIATE I/O '1'B THIS REQ       01115000
*   DO;                             /* MODESET EXTKEY(SUPR)          */ 01116000
*     SPKA(0);                      /* SET PSW KEY                   */ 01117000
         SLR   @12,@12                                             0543 01118000
         SPKA  0(@12)                                              0543 01119000
*   END;                            /* MODESET EXTKEY(SUPR) RETURN TO   01120000
*                                      SUPER KEY(0)                  */ 01121000
*   WKACLENX=CLEANRC1(2);           /* CLEANUP CODE-WORK COMPLETE    */ 01122000
         IC    @12,CLEANRC1+1                                      0545 01123000
         STC   @12,WKACLENX(,RBSECPTR)                             0545 01124000
*   RFY                                                            0546 01125000
*     GPR01P UNRSTD;                                               0546 01126000
*                                                                  0546 01127000
*/*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *   */ 01128000
*/*THE FOLLOWING ROUTINE SETS UP FOR RETURN FROM THE CLEANUP SUBRTN. */ 01129000
*/*IF THIS ROUTINE IS ENTERED THE SECONDARY ESTAE WAS NOT ENTERED.   */ 01130000
*/*THE SECONDARY ESTAE IS THEREFORE DELETED AND REGISTER 15 IS ZEROED*/ 01131000
*/*TO INDICATE TO THE MAIN ROUTINE THAT THE SECONDARY ESTAE HAS BEEN */ 01132000
*/*RELEASED.                                                         */ 01133000
*/*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *   */ 01134000
*                                                                  0547 01135000
*EXITCLN:                                                          0547 01136000
*   ;                               /* RETURN TO MAIN ROUTINE        */ 01137000
EXITCLN  DS    0H                                                  0548 01138000
*   RFY                                                            0548 01139000
*     GPR00P RSTD;                  /* RESTRICT SAVE REG       YM7519*/ 01140000
*   GPR00P=SAVEPTR;                 /* SAVE RTM SAVE ADDR      YM7519*/ 01141000
         LR    GPR00P,SAVEPTR                                      0549 01142000
*   DO;                             /* SETLOCK (RELEASE) TYPE(LOCAL)    01143000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   01144000
*                                      CK))                          */ 01145000
*     RFY                                                          0551 01146000
*      (GPR11P,                                                    0551 01147000
*       GPR12P,                                                    0551 01148000
*       GPR13P,                                                    0551 01149000
*       GPR14P) RSTD;                                              0551 01150000
*     GPR13P=PSALITA;               /* ADDRESS OF LOCK INTERFACE   0552 01151000
*                                      TABLE.                        */ 01152000
         L     GPR13P,PSALITA                                      0552 01153000
*     GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT AND 0553 01154000
*                                      ENTRY ADRS.                   */ 01155000
         LM GPR11P,GPR13P,588(GPR13P)                                   01156000
*     GEN(BALR GPR14P,GPR13P);      /* BALR TO SETLOCK RTN.          */ 01157000
         BALR GPR14P,GPR13P                                             01158000
*     RFY                                                          0555 01159000
*      (GPR11P,                                                    0555 01160000
*       GPR12P,                                                    0555 01161000
*       GPR13P,                                                    0555 01162000
*       GPR14P) UNRSTD;                                            0555 01163000
*   END;                            /* SETLOCK (RELEASE) TYPE(LOCAL)    01164000
*                                      RELATED(RDXLST,IGCT105C,(CLNLO   01165000
*                                      CK)) FREE LOCAL LOCK          */ 01166000
*   SAVEPTR=GPR00P;                 /* RESTOR RTM SAVE AD      YM7519*/ 01167000
         LR    SAVEPTR,GPR00P                                      0557 01168000
*   RFY                                                            0558 01169000
*     GPR00P UNRSTD;                /*                         YM7519*/ 01170000
*   IF WKARLCOR¬=0 THEN             /* CORE FOR RELEX STILL THERE    */ 01171000
         L     @12,WKARLCOR(,RBSECPTR)                             0559 01172000
         LTR   @12,@12                                             0559 01173000
         BZ    @RF00559                                            0559 01174000
*     DO;                           /* FREE THE RELEX WORKAREA       */ 01175000
*       DO;                         /* FREEMAIN(RU)                0561 01176000
*                                      LV(RELEXWKA)A(RELAREA) SP(250)*/ 01177000
*         RESPECIFY                                                0562 01178000
*          (GPR01F,                                                0562 01179000
*           GPR15F,                                                0562 01180000
*           GPR00F) RESTRICTED;                                    0562 01181000
*         GPR01F=0;                 /* REG 1 MUST BE ZERO            */ 01182000
         SLR   GPR01F,GPR01F                                       0563 01183000
*         GPR15F=3;                 /* SET TYPE                      */ 01184000
         LA    GPR15F,3                                            0564 01185000
*         GPR00F=RELEXWKA;          /* LENGTH REQUESTED              */ 01186000
         LA    GPR00F,132                                          0565 01187000
*         GPR01F=ADDR(RELAREA);     /* SET REGISTER ONE              */ 01188000
         LR    GPR01F,@12                                          0566 01189000
*         GPR15F=GPR15F+((250)*256);/* SUBPOOL VALUE                 */ 01190000
         AL    GPR15F,@CF03559                                     0567 01191000
*         SVC(120);                 /* RC/RU-FORM OF GETMAIN         */ 01192000
         SVC   120                                                 0568 01193000
*         RESPECIFY                                                0569 01194000
*          (GPR01F,                                                0569 01195000
*           GPR15F,                                                0569 01196000
*           GPR00F) UNRESTRICTED;                                  0569 01197000
*       END;                        /* FREEMAIN(RU)                0570 01198000
*                                      LV(RELEXWKA)A(RELAREA) SP(250)   01199000
*                                      YM7519                        */ 01200000
*     END;                                                         0571 01201000
*   GEN(ESTAE 0);                   /* REMOVE ESTAE FROM QUE         */ 01202000
@RF00559 DS    0H                                                  0572 01203000
         ESTAE 0                                                        01204000
*   RETURN CODE(0);                 /* RETURN TO CALLING ROUTINE,  0573 01205000
*                                      PASS BACK RC=0 IN R15         */ 01206000
         SLR   @15,@15                                             0573 01207000
         L     @14,12(,@13)                                        0573 01208000
         LM    @00,@12,20(@13)                                     0573 01209000
         BR    @14                                                 0573 01210000
*                                                                  0574 01211000
*/********************************************************************/ 01212000
*/*                         SUBROUTINES                              */ 01213000
*/********************************************************************/ 01214000
*/********************************************************************/ 01215000
*/*  THE FOLLOWING SUBROUTINE VALIDITY CHECKS THE DEB. A BRANCH ENTRY*/ 01216000
*/*  IS TAKEN WHICH REQUIRES THAT THE LOCAL LOCK BE HELD. INPUT TO   */ 01217000
*/*  DEBCHK IS AS FOLLOWS:                                           */ 01218000
*/*                           REGISTER 1 - DEB ADDRESS               */ 01219000
*/*                           REGISTER 10 - TCB ADDRESS              */ 01220000
*/*                           REGISTER 14 - RETURN ADDRESS           */ 01221000
*/*                           REGISTER 15 - DEBCHK ROUTINE ADDRESS   */ 01222000
*/*  DEBCHK RETURNS TO 4 BYTES PAST REGISTER 14 IF AN ERROR OCCURS.  */ 01223000
*/*  REGISTER 15 WILL HAVE 4 IF THERE IS AN ERROR. REGISTERS 1-14    */ 01224000
*/*  UPON ENTRY TO THIS SUBROUTINE ARE SAVED, AND RESTORED UPON EXIT.*/ 01225000
*/*  INPUT TO THIS ROUTINE ARE: THE DCB ADDRESS IN DCBPTR(R6), SDWA  */ 01226000
*/*  ADDRESS IN SDWAPTR(R5) AND THE SVRB ADDRESS IN RBSECPTR(R8).    */ 01227000
*/*  THE LOCK BIT IS ON WHEN ENTRY IS FROM THE CLEANUP ROUTINE.      */ 01228000
*/*  WHEN THIS BIT IS ON THIS RTN ASSUMES THE LOCK IS BEING HELD.    */ 01229000
*/*  THE DEB ADDRESS AND DEBCHK RETURN CODE ARE PASSED TO THE CALLING*/ 01230000
*/*  ROUTINE IN THE SVRB.                                            */ 01231000
*/********************************************************************/ 01232000
*                                                                  0574 01233000
*DEBCHECK:                                                         0574 01234000
*   PROC OPTIONS(NOSAVE);           /* DEBCHECK SUBROUTINE           */ 01235000
DEBCHECK DS    0H                                                  0575 01236000
*   RFY                                                            0575 01237000
*    (GPR01P,                                                      0575 01238000
*     GPR14P) RSTD;                                                0575 01239000
*   STM(GPR01P,GPR14P,SAVESDWA);    /* SAVE REGS 1-14 IN SDWA        */ 01240000
         STM   GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0576 01241000
*   RFY                                                            0577 01242000
*    (GPR01P,                                                      0577 01243000
*     GPR14P) UNRSTD;                                              0577 01244000
*   IF WKALOCK='0'B THEN            /* IF LOCK NOT ON, GET LOCK      */ 01245000
         TM    WKALOCK(RBSECPTR),B'01000000'                       0578 01246000
         BNZ   @RF00578                                            0578 01247000
*     DO;                           /* SOME CALLERS DONT HAVE LCK    */ 01248000
*/*           GET THE LOCAL LOCK                                     */ 01249000
*                                                                  0580 01250000
*DEBLOCK:                                                          0580 01251000
*       ;                           /* GET LOCAL LOCK FOR DEBCHK     */ 01252000
DEBLOCK  DS    0H                                                  0581 01253000
*       DO;                         /* SETLOCK (OBTAIN) MODE(UNCOND)    01254000
*                                      TYPE(LOCAL) RELATED(DEBDCB,IGC   01255000
*                                      T105C,(DEBFREE))              */ 01256000
*         RFY                                                      0582 01257000
*          (GPR11P,                                                0582 01258000
*           GPR12P,                                                0582 01259000
*           GPR13P,                                                0582 01260000
*           GPR14P) RSTD;                                          0582 01261000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0583 01262000
*                                      TABLE.                        */ 01263000
         L     GPR13P,PSALITA                                      0583 01264000
*         GEN(LM GPR11P,GPR13P,576(GPR13P));/* LOAD LOCKWORD, CLHT 0584 01265000
*                                      AND ENTRY ADRS.               */ 01266000
         LM GPR11P,GPR13P,576(GPR13P)                                   01267000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 01268000
         BALR GPR14P,GPR13P                                             01269000
*         RFY                                                      0586 01270000
*          (GPR11P,                                                0586 01271000
*           GPR12P,                                                0586 01272000
*           GPR13P,                                                0586 01273000
*           GPR14P) UNRSTD;                                        0586 01274000
*       END;                        /* SETLOCK (OBTAIN) MODE(UNCOND)    01275000
*                                      TYPE(LOCAL) RELATED(DEBDCB,IGC   01276000
*                                      T105C,(DEBFREE)) GET LOCAL  0587 01277000
*                                      LOCK                          */ 01278000
*     END;                                                         0588 01279000
*                                                                  0588 01280000
*/*   GO TO DEBCHK ROUTINE  - HOWEVER, SINCE THERE IS ONE FIELD IN   */ 01281000
*/*   THE DEB WHICH DEBCHK ASSUMES IS IN KEY 5 CORE (DEBTBLOF) MUST  */ 01282000
*/*   FIRST PASS THIS FIELD TO THE SYSTEM VALIDITY CHECK ROUTINE TO  */ 01283000
*/*   ENSURE ITS CORE LOCATION.                                      */ 01284000
*                                                                  0589 01285000
*   RFY                                                            0589 01286000
*    (GPR01P,                                                      0589 01287000
*     GPR02P,                                                      0589 01288000
*     GPR04P,                                                      0589 01289000
*     GPR10P,                                                      0589 01290000
*     GPR14P,                                                      0589 01291000
*     GPR15P) RSTD;                                                0589 01292000
@RF00578 DS    0H                                                  0590 01293000
*   GPR01P=DCBDEBA;                 /* PUT DEB ADDR IN R1            */ 01294000
         L     GPR01P,DCBDEBA+39(,DCBPTR)                          0590 01295000
         LA    GPR01P,0(,GPR01P)                                   0590 01296000
*   GPR01P=GPR01P-LENGTH(DEBTBLOF); /* GET ADDR OF FIELD       YM5738*/ 01297000
         BCTR  GPR01P,0                                            0591 01298000
         BCTR  GPR01P,0                                            0591 01299000
*   GPR02P=GPR01P+1;                /* END OF FIELD            YM5738*/ 01300000
         LA    GPR02P,1                                            0592 01301000
         ALR   GPR02P,GPR01P                                       0592 01302000
*   GPR04P=ADDR(DEBKEY)-KEYOFFS;    /* ADDR OF DEB KEY=5       YM5738*/ 01303000
         LA    GPR04P,DEBKEY                                       0593 01304000
         SL    GPR04P,@CF02573                                     0593 01305000
*   CALL CVT0VL00;                  /* VALIDITY CHECK RTN      YM5738*/ 01306000
         L     @12,CVTPTR                                          0594 01307000
         L     @15,CVT0VL00(,@12)                                  0594 01308000
         BALR  @14,@15                                             0594 01309000
*   BC(8,GOCHKDEB);                 /* DEBTBLOP IS GOOD        YM5738*/ 01310000
         BC    8,GOCHKDEB                                          0595 01311000
*BADDEB:                                                           0596 01312000
*   ;                               /* DEBTBLOP IS BAD         YM5738*/ 01313000
BADDEB   DS    0H                                                  0597 01314000
*   WKASVDEB=GPR01P;                /* PUT INVALID FIELD ADDR WHERE     01315000
*                                      DEB ADDR SHOULD GO      YM5738*/ 01316000
         ST    GPR01P,WKASVDEB(,RBSECPTR)                          0597 01317000
*   WKADEBXC=DEBBAD;                /* RC=4 -INVALID DEB       YM5738*/ 01318000
         MVI   WKADEBXC(RBSECPTR),X'04'                            0598 01319000
*   GOTO CHKLOCK;                   /* GO CHECK LOCK           YM5738*/ 01320000
         B     CHKLOCK                                             0599 01321000
*   RFY                                                            0600 01322000
*    (GPR02P,                                                      0600 01323000
*     GPR04P) UNRSTD;               /* RELEASE REGS 2,4        YM5738*/ 01324000
*/*       READY TO GO TO DEBCHK ROUTINE                              */ 01325000
*                                                                  0601 01326000
*GOCHKDEB:                                                         0601 01327000
*   ;                               /* GO TO DEBCHK ROUT       YM5738*/ 01328000
GOCHKDEB DS    0H                                                  0602 01329000
*   GPR01P=GPR01P+LENGTH(DEBTBLOF); /* GET DEB ADDR IN R1      YM5738*/ 01330000
         AL    GPR01P,@CF00111                                     0602 01331000
*   GPR10P=PSATOLD;                 /* PUT TCB ADDR IN R10           */ 01332000
         L     GPR10P,PSATOLD                                      0603 01333000
*   CALL CVTDEBVR;                  /* BRANCH ENTRY TO DEBCHK        */ 01334000
         L     @12,CVTPTR                                          0604 01335000
         L     @12,CVTEXT2(,@12)                                   0604 01336000
         L     @15,CVTDEBVR(,@12)                                  0604 01337000
         BALR  @14,@15                                             0604 01338000
*   GEN(NOP 0);                     /* USE UP 4 BYTES ON RETURN      */ 01339000
         NOP 0                                                          01340000
*   WKASVDEB=GPR01P;                /* SAVE VALIDATED DEB ADDR IN  0606 01341000
*                                      SVRB WORKAREA                 */ 01342000
         ST    GPR01P,WKASVDEB(,RBSECPTR)                          0606 01343000
*   WKADEBXC=RETURNCD;              /* SAVE DEBCHK RC IN TOP BYTE    */ 01344000
         STC   RETURNCD,WKADEBXC(,RBSECPTR)                        0607 01345000
*   RFY                                                            0608 01346000
*     DEBBASIC BASED(WKASVDEB);     /* EST ADDRESSABILITY TO DEB     */ 01347000
*   IF(RETURNCD=0)&(DEBDCBB¬=DCBPTR) THEN/* IF DEB VALID ENSURE IT 0609 01348000
*                                      POINTS TO DCB                 */ 01349000
         LTR   RETURNCD,RETURNCD                                   0609 01350000
         BNZ   @RF00609                                            0609 01351000
         L     @12,WKASVDEB(,RBSECPTR)                             0609 01352000
         L     @12,DEBDCBB-1(,@12)                                 0609 01353000
         LA    @12,0(,@12)                                         0609 01354000
         CR    DCBPTR,@12                                          0609 01355000
         BE    @RF00609                                            0609 01356000
*     WKADEBXC=DEBBAD;              /* NO,PUT IN RC=4-INVALID DEB    */ 01357000
         MVI   WKADEBXC(RBSECPTR),X'04'                            0610 01358000
*CHKLOCK:                                                          0611 01359000
*   ;                               /* SHOULD LOCK BE FREE     YM5738*/ 01360000
@RF00609 DS    0H                                                  0611 01361000
CHKLOCK  DS    0H                                                  0612 01362000
*   IF WKALOCK='0'B THEN            /* IF LOCK SW NOT ON, THEN       */ 01363000
         TM    WKALOCK(RBSECPTR),B'01000000'                       0612 01364000
         BNZ   @RF00612                                            0612 01365000
*     DO;                           /* MUST FREE LOCK GOTTEN HERE    */ 01366000
*/*                   RELEASE THE LOCAL LOCK                         */ 01367000
*                                                                  0614 01368000
*DEBFREE:                                                          0614 01369000
*       ;                           /* RELEASE LOCAL LOCK -DEBCHK    */ 01370000
DEBFREE  DS    0H                                                  0615 01371000
*       DO;                         /* SETLOCK (RELEASE) TYPE(LOCAL)    01372000
*                                      RELATED(DEBDCB,IGCT105C,(DEBLO   01373000
*                                      CK))                          */ 01374000
*         RFY                                                      0616 01375000
*          (GPR11P,                                                0616 01376000
*           GPR12P,                                                0616 01377000
*           GPR13P,                                                0616 01378000
*           GPR14P) RSTD;                                          0616 01379000
*         GPR13P=PSALITA;           /* ADDRESS OF LOCK INTERFACE   0617 01380000
*                                      TABLE.                        */ 01381000
         L     GPR13P,PSALITA                                      0617 01382000
*         GEN(LM GPR11P,GPR13P,588(GPR13P));/* LOAD LOCKWORD, CLHT 0618 01383000
*                                      AND ENTRY ADRS.               */ 01384000
         LM GPR11P,GPR13P,588(GPR13P)                                   01385000
*         GEN(BALR GPR14P,GPR13P);  /* BALR TO SETLOCK RTN.          */ 01386000
         BALR GPR14P,GPR13P                                             01387000
*         RFY                                                      0620 01388000
*          (GPR11P,                                                0620 01389000
*           GPR12P,                                                0620 01390000
*           GPR13P,                                                0620 01391000
*           GPR14P) UNRSTD;                                        0620 01392000
*       END;                        /* SETLOCK (RELEASE) TYPE(LOCAL)    01393000
*                                      RELATED(DEBDCB,IGCT105C,(DEBLO   01394000
*                                      CK)) FREE LOCAL LOCK          */ 01395000
*     END;                                                         0622 01396000
*   RFY                                                            0623 01397000
*     GPR14P RSTD;                                                 0623 01398000
@RF00612 DS    0H                                                  0624 01399000
*   LM(GPR01P,GPR14P,SAVESDWA);     /* RESTORE REGS1-14 FROM SDWA    */ 01400000
         LM    GPR01P,GPR14P,SAVESDWA(SDWAPTR)                     0624 01401000
*   WKALOCK='0'B;                   /* ZERO LOCK SW IN ALL CASES     */ 01402000
         NI    WKALOCK(RBSECPTR),B'10111111'                       0625 01403000
*   END DEBCHECK;                                                  0626 01404000
@EL00002 DS    0H                                                  0626 01405000
@EF00002 DS    0H                                                  0626 01406000
@ER00002 BR    @14                                                 0626 01407000
*   RFY                                                            0627 01408000
*    (GPR01P,                                                      0627 01409000
*     GPR10P,                                                      0627 01410000
*     GPR14P,                                                      0627 01411000
*     GPR15P) UNRSTD;                                              0627 01412000
*                                                                  0628 01413000
*/********************************************************************/ 01414000
*/* THE FOLLOWING SUBROUTINE RECEIVES CONTROL FROM THE 2ND LEVEL     */ 01415000
*/* ESTAE, THE DUMPRTN1 ROUTINE, TO TAKE AN SVC DUMP. A HEADER       */ 01416000
*/* IS BUILT IN THE SDWA TO IDENTIFY THE DUMP. THE ONLY REGS CHANGED */ 01417000
*/* BY THIS SUBROUTINE ARE 0,1 AND 15. UPON ENTRY THE LOCAL LOCK     */ 01418000
*/* IS NOT HELD.  THE SDUMP SVC WILL RETURN A RETURN CODE IN R15,    */ 01419000
*/* THE VALUES FOR WHICH ARE AS FOLLOWS:                             */ 01420000
*/*                                00 - SDUMP SUCCESSFUL             */ 01421000
*/*                                04 - PARTIAL SDUMP TAKEN          */ 01422000
*/*                                08 - SDUMP UNSUCCESSFUL           */ 01423000
*/* THE SDUMP RETURN CODE PRESENTED TO THE USER IS THIS VALUE +4.    */ 01424000
*/*                                04 - SDUMP SUCCESSFUL             */ 01425000
*/*                                08 - PARTIAL SDUMP TAKEN          */ 01426000
*/*                                0C - SDUMP UNSUCCESSFUL           */ 01427000
*/* A BIT IS SET IN THE SVRB WORKAREA TO IDENTIFY THE RETURN CODE.   */ 01428000
*/********************************************************************/ 01429000
*                                                                  0628 01430000
*SDUMP:                                                            0628 01431000
*   PROC OPTIONS(NOSAVE);           /* TAKE AN SVC DUMP              */ 01432000
SDUMP    DS    0H                                                  0629 01433000
*   RFY                                                            0629 01434000
*    (GPR00P,                                                      0629 01435000
*     GPR01P,                                                      0629 01436000
*     GPR14P,                                                      0629 01437000
*     GPR15P) RSTD;                                                0629 01438000
*   HEADER=HEADING;                 /* SET UP HEADER                 */ 01439000
         MVC   HEADER(27,SDWAPTR),HEADING                          0630 01440000
*   JOBNAME=TIOCNJOB;               /* JOB NAME                      */ 01441000
         L     @12,PSATOLD                                         0631 01442000
         L     @12,TCBTIO(,@12)                                    0631 01443000
         MVC   JOBNAME(8,SDWAPTR),TIOCNJOB(@12)                    0631 01444000
*   STEPNAME=TIOCSTEP;              /* STEP NAME                     */ 01445000
         MVC   STEPNAME(8,SDWAPTR),TIOCSTEP(@12)                   0632 01446000
*   SDUMPLST=DUMPLIST;              /* MOVE LIST FORM TO VAR.AREA    */ 01447000
         MVC   SDUMPLST(24,SDWAPTR),DUMPLIST                       0633 01448000
*   GPR01P=ADDR(SDUMPLST);          /* PUT DUMP LIST ADDR IN REG     */ 01449000
         LA    GPR01P,SDUMPLST(,SDWAPTR)                           0634 01450000
*   GEN REFS(HEADER) SETS(SDUMPLST,GPR00P,GPR01P);                 0635 01451000
        SDUMP HDRAD=HEADER(SDWAPTR),MF=(E,(1))  TAKE SVC DUMP           01452000
*   SDWAEAS='1'B;                   /* SET DUMP TAKEN FLAG           */ 01453000
         OI    SDWAEAS(SDWAPTR),B'00001000'                        0636 01454000
*   IF RETURNCD=0 THEN              /* IF SDUMP SUCCESSFUL           */ 01455000
         LTR   RETURNCD,RETURNCD                                   0637 01456000
         BNZ   @RF00637                                            0637 01457000
*     WKADMP04='1'B;                /* SAVE RETURN CODE = 4          */ 01458000
         OI    WKADMP04(RBSECPTR),B'00001000'                      0638 01459000
*   IF RETURNCD=DUMPRC4 THEN        /* IF PARTIAL SDUMP TAKEN        */ 01460000
@RF00637 C     RETURNCD,@CF00092                                   0639 01461000
         BNE   @RF00639                                            0639 01462000
*     WKADMP08='1'B;                /* SAVE RETURN CODE = 8          */ 01463000
         OI    WKADMP08(RBSECPTR),B'00010000'                      0640 01464000
*   IF RETURNCD=DUMPRC8 THEN        /* IF SDUMP UNSUCCESSFUL         */ 01465000
@RF00639 C     RETURNCD,@CF00047                                   0641 01466000
         BNE   @RF00641                                            0641 01467000
*     WKADMP0C='1'B;                /* SAVE RETURN CODE = C          */ 01468000
         OI    WKADMP0C(RBSECPTR),B'00100000'                      0642 01469000
*   END SDUMP;                      /* RETURN TO MAIN ROUTINE        */ 01470000
@EL00003 DS    0H                                                  0643 01471000
@EF00003 DS    0H                                                  0643 01472000
@ER00003 BR    @14                                                 0643 01473000
*   RFY                                                            0644 01474000
*    (GPR00P,                                                      0644 01475000
*     GPR01P,                                                      0644 01476000
*     GPR14P,                                                      0644 01477000
*     GPR15P) UNRSTD;                                              0644 01478000
*                                                                  0645 01479000
*/********************************************************************/ 01480000
*/*  THE FOLLOWING SUBROUTINE IS CALLED BY THE DUMPRTN1 IN THE SECOND*/ 01481000
*/*  LEVEL ESTAE TO SET UP THE SDWA WHEN A SYSTEM ERROR HAS BEEN     */ 01482000
*/*  DETECTED. THE FOLLOWING RECORDING INFORMATION WILL BE PUT IN    */ 01483000
*/*  THE VARIABLE PORTION OF THE SDWA (FROM WHERE RTM WILL GET IT TO */ 01484000
*/*  WRT ON SYS1.LOGREC):  SVC AUDIT TRAIL BYTE                      */ 01485000
*/*                        RETURN CODE FROM CLEANRTN                 */ 01486000
*/*                        RETURN CODE FROM SDUMP                    */ 01487000
*/*                        REGISTERS 0 AND 1 AT TIME SVC ISSUED      */ 01488000
*/*                        RB OLD PSW CONTAINING THE ADDRESS+2 FROM  */ 01489000
*/*                           WHERE THE SVC WAS ISSUED               */ 01490000
*/*                        OLD ABEND CODE IF PERCOLATED ERROR        */ 01491000
*/*  THE ONLY REGISTER CHANGED BY THIS SUBROUTINE IS REG 1.          */ 01492000
*/********************************************************************/ 01493000
*                                                                  0645 01494000
*RECORD:                                                           0645 01495000
*   PROC OPTIONS(NOSAVE);           /* PUT SYSTEM INFO IN SDWA       */ 01496000
RECORD   DS    0H                                                  0646 01497000
*   RFY                                                            0646 01498000
*     GPR14P RSTD;                  /* RESTRICT RETURN ADDR          */ 01499000
*   RECAUDIT=WKATRALX;              /* MV AUDIT TRAIL BIT IN SDWA    */ 01500000
         IC    @15,WKATRALX(,RBSECPTR)                             0647 01501000
         STC   @15,RECAUDIT(,SDWAPTR)                              0647 01502000
*   IF WKADMP04='1'B THEN           /* IF SDUMP SUCCESSFUL THEN      */ 01503000
         TM    WKADMP04(RBSECPTR),B'00001000'                      0648 01504000
         BNO   @RF00648                                            0648 01505000
*     RECRCDP=DUMPRC1(1);           /* MV INTO REC AREA RET COD=4    */ 01506000
         IC    @15,DUMPRC1                                         0649 01507000
         STC   @15,RECRCDP(,SDWAPTR)                               0649 01508000
*   IF WKADMP08='1'B THEN           /* IF PARTIAL SDUMP TAKEN        */ 01509000
@RF00648 TM    WKADMP08(RBSECPTR),B'00010000'                      0650 01510000
         BNO   @RF00650                                            0650 01511000
*     RECRCDP=DUMPRC1(2);           /* MV INTO REC AREA RET COD=8    */ 01512000
         IC    @15,DUMPRC1+1                                       0651 01513000
         STC   @15,RECRCDP(,SDWAPTR)                               0651 01514000
*   IF WKADMP0C='1'B THEN           /* IF SDUMP WAS UNSUCCESSFUL     */ 01515000
@RF00650 TM    WKADMP0C(RBSECPTR),B'00100000'                      0652 01516000
         BNO   @RF00652                                            0652 01517000
*     RECRCDP=DUMPRC1(3);           /* MV INTO REC AREA RET COD=C    */ 01518000
         IC    @15,DUMPRC1+2                                       0653 01519000
         STC   @15,RECRCDP(,SDWAPTR)                               0653 01520000
*   RECRCLN=WKACLENX;               /* MV CLEANUP RTN RET CODE IN    */ 01521000
@RF00652 IC    @15,WKACLENX(,RBSECPTR)                             0654 01522000
         STC   @15,RECRCLN(,SDWAPTR)                               0654 01523000
*   RECREG0=RBGRS0;                 /* REG0 WHEN SVC WAS ISSUED      */ 01524000
         L     @15,RBGRS0(,RBSECPTR)                               0655 01525000
         ST    @15,RECREG0(,SDWAPTR)                               0655 01526000
*   RECREG1=RBGRS1;                 /* REG1 WHEN SVC WAS ISSUED      */ 01527000
         L     @15,RBGRS1(,RBSECPTR)                               0656 01528000
         ST    @15,RECREG1(,SDWAPTR)                               0656 01529000
*   RFY                                                            0657 01530000
*     GPR01P RSTD;                  /* RESTRICT WORK REG             */ 01531000
*   GPR01P=RBLINK;                  /* GET PREVIOUS RB ADDR          */ 01532000
         L     GPR01P,RBLINK(,RBSECPTR)                            0658 01533000
*   RFY                                                            0659 01534000
*     RBBASIC BASED(GPR01P);        /* BASE FOR PREVIOUS RB          */ 01535000
*   RECOPSW=RBOPSW;                 /* GET PSW FROM PREVIOUS RB      */ 01536000
         MVC   RECOPSW(8,SDWAPTR),RBOPSW(GPR01P)                   0660 01537000
*   RECPERC=SDWACMPC;               /* PUT IN PREVIOUS ABEND CODE    */ 01538000
         MVC   RECPERC(3,SDWAPTR),SDWACMPC(SDWAPTR)                0661 01539000
*   RFY                                                            0662 01540000
*     RBBASIC BASED(RBSECPTR);      /* RETURN TO RB BASE FOR SVC     */ 01541000
*   END RECORD;                     /* RETURN TO MAIN ROUTINE        */ 01542000
@EL00004 DS    0H                                                  0663 01543000
@EF00004 DS    0H                                                  0663 01544000
@ER00004 BR    @14                                                 0663 01545000
*   RFY                                                            0664 01546000
*    (GPR01P,                                                      0664 01547000
*     GPR14P) UNRSTD;                                              0664 01548000
*                                                                  0665 01549000
*/********************************************************************/ 01550000
*/*  THE FOLLOWING ROUTINE IS THE SECOND LEVEL ESTAE FOR IGCT105C.   */ 01551000
*/*  IT IS ENTERED ONLY IF AN ERROR OCCURS DURING THE PROCESSING OF  */ 01552000
*/*  THE CLEANUP ROUTINE.  IT WILL EXECUTE MANY OF THE FUNCTIONS OF  */ 01553000
*/*  THE FIRST LEVEL ESTAE, BUT WILL DO NO VALIDATION OR CLEANUP.ITS */ 01554000
*/*  PRIMARY PURPOSE IS TO RETURN CONTROL TO THE MAIN ESTAE AFTER    */ 01555000
*/*  RECORDING THAT A SECONDARY ESTAE WAS ENTERED.                   */ 01556000
*/*                          INPUT: SDWA(NEW FOR THIS ESTAE) ADDRESS */ 01557000
*/*                                 SDWA(FOR PRIMARY ESTAE) WHICH    */ 01558000
*/*                                   CONTAINS SVRB ADDR FOR SVC 53  */ 01559000
*/********************************************************************/ 01560000
*                                                                  0665 01561000
*BACKUP5C:                                                         0665 01562000
*   ENTRY;                          /* SECOND LEVEL ESTAE FUNCT      */ 01563000
@EP00665 DS    0H                                                  0666 01564000
*   IF GPR00F=12 THEN               /* IF SAVE AREA AND      @ZA25827*/ 01565000
         C     GPR00F,@CF03306                                     0666 01566000
         BNE   @RF00666                                            0666 01567000
*     DO;                           /* SDWA NOT PRESENT,     @ZA25827*/ 01568000
*       GEN(LM 14,12,12(13));       /* RESTORE REGISTERS     @ZA25827*/ 01569000
         LM 14,12,12(13)                                                01570000
*       GEN(BR (14));               /* AND RETURN TO         @ZA25827*/ 01571000
         BR (14)                                                        01572000
*     END;                          /* RTM                   @ZA25827*/ 01573000
*   ELSE                            /*                       @ZA25827*/ 01574000
*     DO;                           /*                       @ZA25827*/ 01575000
         B     @RC00666                                            0671 01576000
@RF00666 DS    0H                                                  0672 01577000
*       GEN(STM @14,@12,12(@13));   /* ST REGS IN 2ND RTN     SAVAREA*/ 01578000
         STM @14,@12,12(@13)                                            01579000
*     END;                          /*                       @ZA25827*/ 01580000
*   RFY                                                            0674 01581000
*    (GPR01P) RSTD;                 /* RESTRICT INPUT AND RETRY      */ 01582000
@RC00666 DS    0H                                                  0675 01583000
*   SDWAPTR=GPR01P;                 /* GET ADDRESS OF NEW SDWA       */ 01584000
         LR    SDWAPTR,GPR01P                                      0675 01585000
*   SDWASR15=CLEANERR;              /* RC=4(TESTED BY 1ST LEVEL ON 0676 01586000
*                                      RET FROM CLEANUP INDICATES  0676 01587000
*                                      ENTRY INTO 2ND LEVEL ESTAE    */ 01588000
         MVC   SDWASR15(4,SDWAPTR),@CF00092                        0676 01589000
*   SDWACSCT='IGCT105C';            /* PUT CSECT ID IN NEW SDWA      */ 01590000
         MVC   SDWACSCT(8,SDWAPTR),@CC03380                        0677 01591000
*   SDWAREXN='BACKUP5C';            /* PUT ESTAE ID IN NEW SDWA      */ 01592000
         MVC   SDWAREXN(8,SDWAPTR),@CC03549                        0678 01593000
*   GPR01P=SDWAPARM;                /* RESTORE OLD SDWA PASSED AS  0679 01594000
*                                      PARM IN NEW SDWA- SAVE IN REG1   01595000
*                                      (WILL USE OLD SDWA FOR      0679 01596000
*                                      USERRTN1 PROCESSING)          */ 01597000
         L     GPR01P,SDWAPARM(,SDWAPTR)                           0679 01598000
*   RBSECPTR=GPR01P->SDWAPARM;      /* RESTORE SVRB FROM OLD SDWA    */ 01599000
         L     RBSECPTR,SDWAPARM(,GPR01P)                          0680 01600000
*/********************************************************************/ 01601000
*/*  ISSUE MACRO TO ANALYZE ABEND AND GIVE CONTROL TO APPROPRIATE RTN*/ 01602000
*/********************************************************************/ 01603000
*                                                                  0681 01604000
*   DO;                             /* ?IGGSTART USER(USERRTN1)SDUMP(   01605000
*                                      DUMPRTN1)CLEAN(DUMPRTN1)      */ 01606000
*/*  MACCOMP Y-2 SC1D0/SJ0082                                        */ 01607000
*/*  MACSTAT Y-2 75030/ZA02517                                       */ 01608000
*/********************************************************************  01609000
*                                                                    */ 01610000
*/* THIS ROUTINE ANALYSES FLAGS IN THE SDWA TO DETERMINE             */ 01611000
*/* WHAT TYPE OF FUNCTION TO PERFORM                                 */ 01612000
*/* THE FLAG COMBINATIONS TESTED AND THE ACTIONS TAKEN ARE SUMMARIZED*/ 01613000
*/* IN THE FOLLOWING TABLE:                                          */ 01614000
*/*                                                                  */ 01615000
*/*   PREVIOUS  || CAUSE OF ERROR ENTRY                              */ 01616000
*/*  PROCESSING || MCHK/PGIO/TEXC  OTHER                             */ 01617000
*/*  ___________||________________________                           */ 01618000
*/*       *EAS  ||        C          C                               */ 01619000
*/*       *CLUP ||        C          C                               */ 01620000
*/*       *STAF ||        S          S                               */ 01621000
*/*       *PERC ||        C          U                               */ 01622000
*/*       *NRBE ||        C          U                               */ 01623000
*/*        NONE ||        C          U                               */ 01624000
*/*                                                                  */ 01625000
*/*       * THESE BITS ARE NOT ALL MUTUALLY EXCLUSIVE. THEY ARE      */ 01626000
*/*         TESTED IN THE ORDER LISTED.                              */ 01627000
*/*                                                                  */ 01628000
*/*       * USER ABENDS ALWAYS GO TO THE CLEANRTN.                   */ 01629000
*/*                                                                  */ 01630000
*/*       FUNCTIONS TO BE PERFORMED:                                 */ 01631000
*/*                                                                  */ 01632000
*/* C (DUMPRTN1)--CLEAN UP RESOURCES AND PERCOLATE ERROR             */ 01633000
*/*                                                                  */ 01634000
*/* S (DUMPRTN1)--PREVIOUS RECOVERY ROUTINE FAILED.                  */ 01635000
*/* TAKE A DUMP FOR IT, THEN TREAT AS C                              */ 01636000
*/*                                                                  */ 01637000
*/* U (USERRTN1)--VALIDATE USER INPUT. IF IT IS IN ERROR,            */ 01638000
*/* TAKE PROBLEM DETERMINATION ACTIONS AND THEN CLEAN UP.            */ 01639000
*/* IF IT IS VALID, ASSUME A SYSTEM ERROR IN COVERED FUNCTION.       */ 01640000
*/* TAKE A DUMP, THEN TREAT AS C                                     */ 01641000
*/********************************************************************  01642000
*                                                                    */ 01643000
*                                                                  0682 01644000
*     IF SDWAEAS='1'B               /* LOWER ESTAE ALREADY DUMPED    */ 01645000
*         |SDWACLUP='1'B THEN       /* OR RTM SAYS CLEANUP           */ 01646000
         TM    SDWAEAS(SDWAPTR),B'00001000'                        0682 01647000
         BO    @RT00682                                            0682 01648000
         TM    SDWACLUP(SDWAPTR),B'10000000'                       0682 01649000
         BO    @RT00682                                            0682 01650000
*       GOTO DUMPRTN1;              /* GO CLEAN UP & GET OUT         */ 01651000
*     RFY                                                          0684 01652000
*       GPR15F RSTD;                /* RESTRICT WORKREG 15 ZA02517   */ 01653000
*     GPR15F='FFF'X;                /* SET USER ABEND MASK ZA02517   */ 01654000
         LA    GPR15F,4095                                         0685 01655000
*     GEN REFS(SDWACMPC,SDWAPTR)(N GPR15F,SDWACMPC-1(SDWAPTR));    0686 01656000
         N GPR15F,SDWACMPC-1(SDWAPTR)                                   01657000
*     IF GPR15F¬=0 THEN             /* IF USER ABEND CODE ZA02517    */ 01658000
         LTR   GPR15F,GPR15F                                       0687 01659000
         BNZ   @RT00687                                            0687 01660000
*       GOTO DUMPRTN1;              /* GO CLEAN UP & EXIT ZA02517    */ 01661000
*     RFY                                                          0689 01662000
*       GPR15F UNRSTD;              /* RELEASE WORKREG 15 ZA02517    */ 01663000
*     IF SDWASTAF='1'B THEN         /* A LOWER LEVEL ESTAE/FRR       */ 01664000
         TM    SDWASTAF(SDWAPTR),B'10000000'                       0690 01665000
         BO    @RT00690                                            0690 01666000
*       GOTO DUMPRTN1;              /* WAS EXECUTING AND FAILED TAKE    01667000
*                                      A DUMP FOR IT                 */ 01668000
*     IF SDWATEXC='1'B              /* SOME NON-PROGRAM TYPE         */ 01669000
*         |SDWAPGIO='1'B            /* ERROR HAS OCCURRED            */ 01670000
*         |SDWAMCHK='1'B THEN       /* GO CLEAN UP & GET OUT         */ 01671000
         TM    SDWATEXC(SDWAPTR),B'10000011'                       0692 01672000
         BNZ   @RT00692                                            0692 01673000
*       GOTO DUMPRTN1;                                             0693 01674000
*     GOTO USERRTN1;                /* CHECK USER INPUT              */ 01675000
         B     USERRTN1                                            0694 01676000
*/********************************************************************  01677000
*                                                                    */ 01678000
*                                                                  0695 01679000
*   END;                                                           0695 01680000
*                                                                  0695 01681000
*/********************************************************************/ 01682000
*/*  THE USERRTN1 RECEIVES CONTROL IF IT IS DETERMINED THAT A PROGRAM*/ 01683000
*/*  CHECK OCCURRED DURING CLEANUP, OR A LOWER RB OR ESTAE CALLED    */ 01684000
*/*  RTM OR ISSUED AN ABEND. THIS ROUTINE WILL ISSUE A SETRP         */ 01685000
*/*  TO RETRY BY RETURNING TO THE FIRST LEVEL ESTAE AT THE POINT     */ 01686000
*/*  WHERE THE CLEANUP ROUTINE WAS CALLED.  THIS ADDRESS WAS STORED  */ 01687000
*/*  IN THE SVRB WORKAREA AT WKASAV14 BY THE CLEANUP SUBROUTINE.     */ 01688000
*/********************************************************************/ 01689000
*                                                                  0696 01690000
*USERRTN1:                                                         0696 01691000
*   ;                               /* PGM CHK OCCURRED IN CLEAN     */ 01692000
USERRTN1 DS    0H                                                  0697 01693000
*   SDWASRSV(5:4+LENGTH(SAVESDWA))=GPR01P->SAVESDWA;/* PUT REGS 1-14,   01694000
*                                      WHICH WERE LAST SAVED IN OLD     01695000
*                                      SDWA, BY EITHER DEBCHECK OR 0697 01696000
*                                      CLEANUP ROUTINE, INTO NEW SDWA   01697000
*                                      AT LABEL SDWASRSV - THIS    0697 01698000
*                                      ENSURES ALL RESTRICTED REGS 0697 01699000
*                                      WILL BE SAME ON RETURN TO   0697 01700000
*                                      PRIMARY ESTAE. NO OTHER REGS     01701000
*                                      ARE NECESSARY EXCEPT FOR    0697 01702000
*                                      MAINTENANCE PURPOSES.         */ 01703000
         MVC   SDWASRSV+4(56,SDWAPTR),SAVESDWA(GPR01P)             0697 01704000
*   DO;                             /* SETRP RETADDR(WKASAV14->EST2RE   01705000
*                                      T)DUMP(NO)RECORD(NO)RC(4)FRESD   01706000
*                                      WA(YES)RETREGS(YES)WKAREA(SDWA   01707000
*                                      PTR)REGS(14)                  */ 01708000
*     RESPECIFY                                                    0699 01709000
*      (GPR00P,                                                    0699 01710000
*       GPR01P,                                                    0699 01711000
*       GPR14P,                                                    0699 01712000
*       GPR15P) RSTD;                                              0699 01713000
*     GPR01P=SDWAPTR;                                              0700 01714000
         LR    GPR01P,SDWAPTR                                      0700 01715000
*     GPR01P->SDWARCDE=4;           /* STORE RC INTO SDWA            */ 01716000
         MVI   SDWARCDE(GPR01P),X'04'                              0701 01717000
*     GPR01P->SDWARTYA=ADDR(WKASAV14->EST2RET);/* SAVE RETRY ADDRESS */ 01718000
         L     @12,WKASAV14(,RBSECPTR)                             0702 01719000
         ST    @12,SDWARTYA(,GPR01P)                               0702 01720000
*     GPR01P->SDWAFREE='1'B;        /* SET FLAG TO FREE SDWA         */ 01721000
*     GPR01P->SDWARCRD='0'B;        /* TURN OFF RECORD INDICATOR     */ 01722000
         OI    SDWAFREE(GPR01P),B'00000100'                        0704 01723000
         NI    SDWARCRD(GPR01P),B'01111111'                        0704 01724000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01725000
         NI    SDWAREQ(GPR01P),B'01111111'                         0705 01726000
*     GPR01P->SDWAUPRG='1'B;        /* TURN ON RETREGS INDICATOR     */ 01727000
         OI    SDWAUPRG(GPR01P),B'00001000'                        0706 01728000
*     GEN(RETURN (14));                                            0707 01729000
         RETURN (14)                                                    01730000
*     RESPECIFY                                                    0708 01731000
*      (GPR00P,                                                    0708 01732000
*       GPR01P,                                                    0708 01733000
*       GPR14P,                                                    0708 01734000
*       GPR15P) UNRSTD;                                            0708 01735000
*   END;                                                           0709 01736000
*   RFY                                                            0710 01737000
*    (GPR01P,                                                      0710 01738000
*     GPR14P) UNRSTD;               /* RELEASE RETURN ADDRESS AND OLD   01739000
*                                      SDWA PTR-THATS ALL FOLKS      */ 01740000
*/********************************************************************/ 01741000
*/* THE DUMPRTN1 RECEIVES CONTROL IF IT IS DETERMINED THAT OTHER     */ 01742000
*/* THAN A PROGRAM CHECK OCCURRED IN THE CLEANUP ROUTINE. THIS ESTAE */ 01743000
*/* WILL ATTEMPT NO FURTHER ERROR ANALYSIS. IT WILL TAKE A SYSTEM    */ 01744000
*/* DUMP, ASSUMING A SYSTEM ERROR, RECORD THE ERROR AND RETURN TO RTM*/ 01745000
*/* FOR PERCOLATION. IT WILL RETURN TO RTM, HOWEVER, VIA IGCT005C, SO*/ 01746000
*/* THAT THE SAVEAREA OBTAINED UPON ENTRY TO IGCT005C MAY BE FREED.  */ 01747000
*/* THE RETRY EXIT WILL THEREFORE BE USED IN THIS CASE TO RETURN TO  */ 01748000
*/* AN ENTRY POINT IN THE MAIN ROUTINE(BACRETRY) FROM WHICH A SETRP  */ 01749000
*/* BACK TO RTM WILL BE ISSUED.                                      */ 01750000
*/********************************************************************/ 01751000
*                                                                  0711 01752000
*DUMPRTN1:                                                         0711 01753000
*   ;                               /* MUST BE A SYSTEM ERROR        */ 01754000
DUMPRTN1 DS    0H                                                  0712 01755000
*   RFY                                                            0712 01756000
*    (WRKREG,                                                      0712 01757000
*     GPR01P) RSTD;                 /* RESTRICT SAVE REG       YM7597*/ 01758000
*   WRKREG=GPR01P;                  /* SAVE OLD SDWA PTR       YM7519*/ 01759000
         LR    WRKREG,GPR01P                                       0713 01760000
*   RFY                                                            0714 01761000
*     GPR01P UNRSTD;                /* RELEASE REG             YM7597*/ 01762000
*   CALL SDUMP;                     /* GO TAKE SVC DUMP              */ 01763000
         BAL   @14,SDUMP                                           0715 01764000
*   MESSAGE=SYSER;                  /* SET UP WTP MESSAGE            */ 01765000
         MVC   MESSAGE(52,SDWAPTR),SYSER                           0716 01766000
*   RETCOD2=CLEANRC2(8);            /* CLEANUP RC -BAD CLEANUP       */ 01767000
         MVC   RETCOD2(2,SDWAPTR),CLEANRC2+14                      0717 01768000
*   IF WKADMP04='1'B THEN           /* IF DUMP TAKEN SUCCESSFULLY    */ 01769000
         TM    WKADMP04(RBSECPTR),B'00001000'                      0718 01770000
         BNO   @RF00718                                            0718 01771000
*     RETCOD=DUMPRC(1);             /* MV INTO MESSAGE RET CODE=4    */ 01772000
         MVC   RETCOD(2,SDWAPTR),DUMPRC                            0719 01773000
*   IF WKADMP08='1'B THEN           /* IF PARTIAL DUMP TAKEN         */ 01774000
@RF00718 TM    WKADMP08(RBSECPTR),B'00010000'                      0720 01775000
         BNO   @RF00720                                            0720 01776000
*     RETCOD=DUMPRC(2);             /* MV INTO MESSAGE RET CODE=8    */ 01777000
         MVC   RETCOD(2,SDWAPTR),DUMPRC+2                          0721 01778000
*   IF WKADMP0C='1'B THEN           /* IF DUMP UNSUCCESSFUL          */ 01779000
@RF00720 TM    WKADMP0C(RBSECPTR),B'00100000'                      0722 01780000
         BNO   @RF00722                                            0722 01781000
*     RETCOD=DUMPRC(3);             /* MV INTO MESSAGE RET CODE=C    */ 01782000
         MVC   RETCOD(2,SDWAPTR),DUMPRC+4                          0723 01783000
*   MSGJOB=TIOCNJOB;                /* MV IN JOB NAME                */ 01784000
@RF00722 L     @12,PSATOLD                                         0724 01785000
         L     @12,TCBTIO(,@12)                                    0724 01786000
         MVC   MSGJOB(8,SDWAPTR),TIOCNJOB(@12)                     0724 01787000
*   MSGSTEP=TIOCSTEP;               /* MV IN STEP NAME               */ 01788000
         MVC   MSGSTEP(8,SDWAPTR),TIOCSTEP(@12)                    0725 01789000
*/* MUST VALIDATE THE TIOT ENTRY BEFORE GETTING DDNAME FOR MESSAGE.  */ 01790000
*/* THIS IS DONE BY GETTING THE PROTECTED ADDRESS OF THE TIOT ENTRY  */ 01791000
*/* FROM THE DSAB, POINTED TO BY THE DEB.  THE DEB MUST BE VALIDITY  */ 01792000
*/* CHECKED FIRST.                                                   */ 01793000
*                                                                  0726 01794000
*   CALL DEBCHECK;                  /* GO VALIDATE THE DEB           */ 01795000
         BAL   @14,DEBCHECK                                        0726 01796000
*   RFY                                                            0727 01797000
*     DEBBASIC BASED(WKASVDEB);     /* VALID DEB SAVED IN SVRB       */ 01798000
*   IF WKADEBXC=0 THEN              /* IF DEB RET CODE=0, DEB OK     */ 01799000
         CLI   WKADEBXC(RBSECPTR),0                                0728 01800000
         BNE   @RF00728                                            0728 01801000
*     MSGDDN=TIOEDDNM;              /* MV DDNAME INTO GTF BUFFER     */ 01802000
         L     @12,WKASVDEB(,RBSECPTR)                             0729 01803000
         L     @12,DEBAPPAD(,@12)                                  0729 01804000
         L     @12,DEBXTNP(,@12)                                   0729 01805000
         L     @12,DEBXDSAB(,@12)                                  0729 01806000
         L     @12,DSABTIOT(,@12)                                  0729 01807000
         MVC   MSGDDN(8,SDWAPTR),TIOEDDNM(@12)                     0729 01808000
*   ELSE                            /* IF DEB BAD,MUST DUMMY DDN     */ 01809000
*     MSGDDN=NODDNAME;              /* ASSIGN DDN AS ASTERISKS       */ 01810000
         B     @RC00728                                            0730 01811000
@RF00728 MVC   MSGDDN(8,SDWAPTR),NODDNAME                          0730 01812000
*   DO;                             /* WTOP MF(E,MESSAGE)            */ 01813000
@RC00728 DS    0H                                                  0732 01814000
*     RFY                                                          0732 01815000
*       GPR01P RSTD;                /* RESTRICT REG 1                */ 01816000
*     GPR01P=ADDR(MESSAGE);         /* ADDRESS CONTROL PROGRAM LIST  */ 01817000
         LA    GPR01P,MESSAGE(,SDWAPTR)                            0733 01818000
*     SVC(35);                      /* ISSUE WTO SVC                 */ 01819000
         SVC   35                                                  0734 01820000
*     RFY                                                          0735 01821000
*       GPR01P UNRSTD;              /* RELEASE REG 1                 */ 01822000
*   END;                            /* WTOP MF(E,MESSAGE) ISSUE WTP  */ 01823000
*RECORD1A:                                                         0737 01824000
*   CALL RECORD;                    /* GO PUT RECORD INFO IN SDWA    */ 01825000
RECORD1A BAL   @14,RECORD                                          0737 01826000
*   SDWASRSV(5:4+LENGTH(SAVESDWA))=WRKREG->SAVESDWA;/* PUT YM7519  0738 01827000
*                                      1-14, WHICH WERE LAST SAVED IN   01828000
*                                      OLD SDWA, BY EITHER DEBCHECK     01829000
*                                      OR CLEANUP ROUTINE, INTO NEW     01830000
*                                      SDWA AT LABEL SDWASRSV - THIS    01831000
*                                      ENSURES ALL RESTRICTED REGS 0738 01832000
*                                      WILL BE SAME ON RETURN TO   0738 01833000
*                                      PRIMARY ESTAE. NO OTHER REGS     01834000
*                                      ARE NECESSARY EXCEPT FOR    0738 01835000
*                                      MAINTENANCE PURPOSES.         */ 01836000
         MVC   SDWASRSV+4(56,SDWAPTR),SAVESDWA(WRKREG)             0738 01837000
*   DO;                             /* SETRP RETADDR(BACRETRY)DUMP(NO   01838000
*                                      )RECORD(YES)REGS(14)WKAREA(SDW   01839000
*                                      APTR)RC(4)FRESDWA(YES)RETREGS(   01840000
*                                      YES)                          */ 01841000
*     RESPECIFY                                                    0740 01842000
*      (GPR00P,                                                    0740 01843000
*       GPR01P,                                                    0740 01844000
*       GPR14P,                                                    0740 01845000
*       GPR15P) RSTD;                                              0740 01846000
*     GPR01P=SDWAPTR;                                              0741 01847000
         LR    GPR01P,SDWAPTR                                      0741 01848000
*     GPR01P->SDWARCDE=4;           /* STORE RC INTO SDWA            */ 01849000
         MVI   SDWARCDE(GPR01P),X'04'                              0742 01850000
*     GPR01P->SDWARTYA=ADDR(BACRETRY);/* SAVE RETRY ADDRESS          */ 01851000
         L     @12,@CV03471                                        0743 01852000
         ST    @12,SDWARTYA(,GPR01P)                               0743 01853000
*     GPR01P->SDWAFREE='1'B;        /* SET FLAG TO FREE SDWA         */ 01854000
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */ 01855000
         OI    SDWAFREE(GPR01P),B'10000100'                        0745 01856000
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */ 01857000
         NI    SDWAREQ(GPR01P),B'01111111'                         0746 01858000
*     GPR01P->SDWAUPRG='1'B;        /* TURN ON RETREGS INDICATOR     */ 01859000
         OI    SDWAUPRG(GPR01P),B'00001000'                        0747 01860000
*     GEN(RETURN (14));                                            0748 01861000
         RETURN (14)                                                    01862000
*     RESPECIFY                                                    0749 01863000
*      (GPR00P,                                                    0749 01864000
*       GPR01P,                                                    0749 01865000
*       GPR14P,                                                    0749 01866000
*       GPR15P) UNRSTD;                                            0749 01867000
*   END;                            /* YM7519 DIAGNOSTIC INFO.TO BE     01868000
*                                      PUT OUT ON SYSTEM DATA SET    */ 01869000
*   RFY                                                            0751 01870000
*     WRKREG UNRSTD;                /* RELEASE WORKREG         YM7519*/ 01871000
*/********************************************************************/ 01872000
*                                                                  0752 01873000
*   END IGCT105C                    /* END OF CLEANUP SUB- ESTAE     */ 01874000
*/********************************************************************/ 01875000
*                                                                  0752 01876000
*                                                                  0752 01877000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 01878000
*/*%INCLUDE SYSLIB  (CVT     )                                       */ 01879000
*/*%INCLUDE SYSLIB  (IHADCBDF)                                       */ 01880000
*/*%INCLUDE SYSLIB  (IHADCB  )                                       */ 01881000
*/*%INCLUDE SYSLIB  (IEZDEB  )                                       */ 01882000
*/*%INCLUDE SYSLIB  (IHADECB )                                       */ 01883000
*/*%INCLUDE SYSLIB  (IHADSAB )                                       */ 01884000
*/*%INCLUDE SYSLIB  (IEZIOB  )                                       */ 01885000
*/*%INCLUDE SYSLIB  (IHAPSA  )                                       */ 01886000
*/*%INCLUDE SYSLIB  (IHARB   )                                       */ 01887000
*/*%INCLUDE SYSLIB  (IKJRB   )                                       */ 01888000
*/*%INCLUDE SYSLIB  (IGGRDX  )                                       */ 01889000
*/*%INCLUDE SYSLIB  (IHASDWA )                                       */ 01890000
*/*%INCLUDE SYSLIB  (IGGSPD  )                                       */ 01891000
*/*%INCLUDE SYSLIB  (IKJTCB  )                                       */ 01892000
*/*%INCLUDE SYSLIB  (IEFTIOT1)                                       */ 01893000
*                                                                  0752 01894000
*       ;                                                          0752 01895000
@EL00001 DS    0H                                                  0752 01896000
@EF00001 DS    0H                                                  0752 01897000
@ER00001 LM    @14,@12,12(@13)                                     0752 01898000
         BR    @14                                                 0752 01899000
@DATA    DS    0H                                                       01900000
@DATD    DSECT                                                          01901000
         DS    0F                                                       01902000
IGCT105C CSECT                                                          01903000
         DS    0F                                                       01904000
@CF00099 DC    F'1'                                                     01905000
@CF00111 DC    F'2'                                                     01906000
@CF00092 DC    F'4'                                                     01907000
@CF01507 DC    F'5'                                                     01908000
@CF01050 DC    F'6'                                                     01909000
@CF00047 DC    F'8'                                                     01910000
@CF01554 DC    F'9'                                                     01911000
@CF03306 DC    F'12'                                                    01912000
@CF00073 DC    F'16'                                                    01913000
@CF02573 DC    F'28'                                                    01914000
@CF03559 DC    F'64000'                                                 01915000
@DATD    DSECT                                                          01916000
         DS    0D                                                       01917000
IGCT105C CSECT                                                          01918000
         DS    0F                                                       01919000
@SIZDATD DC    AL1(0)                                                   01920000
         DC    AL3(@ENDDATD-@DATD)                                      01921000
@CV03471 DC    V(BACRETRY)                                              01922000
         DS    0D                                                       01923000
ERRUSER  DC    F'565'                                                   01924000
DEBKEY   DC    XL1'50'                                                  01925000
SCHEDKEY DC    AL1(16)                                                  01926000
@CC03380 DC    C'IGCT105C'                                              01927000
@CC03549 DC    C'BACKUP5C'                                              01928000
HEADING  DS    CL27                                                     01929000
         ORG   HEADING                                                  01930000
@NM00166 DC    AL1(26)                                                  01931000
HEADTEXT DC    CL26'IGCT105C,        ,        '                         01932000
         ORG   HEADING+27                                               01933000
         DS    CL1                                                      01934000
PATCH    DS    CL150                                                    01935000
         ORG   PATCH                                                    01936000
PATCHID  DC    CL8'IGCT105C'                                            01937000
PATCHIT  DC    142CL1'*'                                                01938000
         ORG   PATCH+150                                                01939000
ERRSYS   DC    X'135000'                                                01940000
GTON     DC    CL1'8'                                                   01941000
MAJNAME  DC    CL8'SYSZGGLG'                                            01942000
NODDNAME DC    CL8'********'                                            01943000
USERER   DS    CL52                                                     01944000
         ORG   USERER                                                   01945000
USERER01 DC    H'48'                                                    01946000
USERER02 DC    B'1000000000000000'                                      01947000
USERER03 DC    CL44'IEC902I 235,00,00,        ,        ,        '       01948000
USERER04 DC    B'0000010000000000'                                      01949000
USERER05 DC    B'0000000000100000'                                      01950000
         ORG   USERER+52                                                01951000
SYSER    DS    CL52                                                     01952000
         ORG   SYSER                                                    01953000
SYSER01  DC    H'48'                                                    01954000
SYSER02  DC    B'1000000000000000'                                      01955000
SYSER03  DC    CL44'IEC903I 135,00,00,        ,        ,        '       01956000
SYSER04  DC    B'0000010000000000'                                      01957000
SYSER05  DC    B'0000000000100000'                                      01958000
         ORG   SYSER+52                                                 01959000
DUMPRC1  DC    AL1(4)                                                   01960000
         DC    AL1(8)                                                   01961000
         DC    AL1(12)                                                  01962000
DUMPRC   DC    CL2'04'                                                  01963000
         DC    CL2'08'                                                  01964000
         DC    CL2'0C'                                                  01965000
CLEANRC1 DC    AL1(1)                                                   01966000
         DC    AL1(2)                                                   01967000
         DC    AL1(3)                                                   01968000
         DC    AL1(4)                                                   01969000
         DC    AL1(5)                                                   01970000
         DC    AL1(6)                                                   01971000
         DC    AL1(7)                                                   01972000
         DC    AL1(8)                                                   01973000
CLEANRC2 DC    CL2'01'                                                  01974000
         DC    CL2'02'                                                  01975000
         DC    CL2'03'                                                  01976000
         DC    CL2'04'                                                  01977000
         DC    CL2'05'                                                  01978000
         DC    CL2'06'                                                  01979000
         DC    CL2'07'                                                  01980000
         DC    CL2'08'                                                  01981000
BLKERR1  DC    AL1(1)                                                   01982000
         DC    AL1(2)                                                   01983000
         DC    AL1(3)                                                   01984000
         DC    AL1(4)                                                   01985000
         DC    AL1(5)                                                   01986000
         DC    AL1(6)                                                   01987000
         DC    AL1(0)                                                   01988000
BLKERR2  DC    CL1'1'                                                   01989000
         DC    CL1'2'                                                   01990000
         DC    CL1'3'                                                   01991000
         DC    CL1'4'                                                   01992000
         DC    CL1'5'                                                   01993000
         DC    CL1'6'                                                   01994000
         DC    CL1'0'                                                   01995000
BLKERR3  DC    AL1(1)                                                   01996000
         DC    AL1(2)                                                   01997000
         DC    AL1(3)                                                   01998000
         DC    AL1(132)                                                 01999000
         DC    AL1(133)                                                 02000000
         DC    AL1(134)                                                 02001000
         DC    AL1(0)                                                   02002000
IGCT105C CSECT                                                          02003000
DUMPLIST SDUMP SDATA=(PSA,NUC,SQA,RGN),MF=L                             02004000
ELIST    ESTAE BACKUP5C,RECORD=YES,MF=L                                 02005000
ENQLIST  ENQ   (MAJNAME,,S,8),MF=L                                      02006000
@DATD    DSECT                                                          02007000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                02008000
@ENDDATD EQU   *                                                        02009000
IGCT105C CSECT                                                          02010000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       02011000
@01      EQU   01                                                       02012000
@02      EQU   02                                                       02013000
@03      EQU   03                                                       02014000
@04      EQU   04                                                       02015000
@05      EQU   05                                                       02016000
@06      EQU   06                                                       02017000
@07      EQU   07                                                       02018000
@08      EQU   08                                                       02019000
@09      EQU   09                                                       02020000
@10      EQU   10                                                       02021000
@11      EQU   11                                                       02022000
@12      EQU   12                                                       02023000
@13      EQU   13                                                       02024000
@14      EQU   14                                                       02025000
@15      EQU   15                                                       02026000
BASEREG  EQU   @09                                                      02027000
GPR00F   EQU   @00                                                      02028000
GPR01F   EQU   @01                                                      02029000
GPR15F   EQU   @15                                                      02030000
GPR00P   EQU   @00                                                      02031000
GPR01P   EQU   @01                                                      02032000
GPR14P   EQU   @14                                                      02033000
GPR15P   EQU   @15                                                      02034000
GPR02P   EQU   @02                                                      02035000
GPR04P   EQU   @04                                                      02036000
GPR10P   EQU   @10                                                      02037000
GPR11P   EQU   @11                                                      02038000
GPR12P   EQU   @12                                                      02039000
GPR13P   EQU   @13                                                      02040000
I        EQU   @00                                                      02041000
RDXPTR   EQU   @02                                                      02042000
SDWAPTR  EQU   @05                                                      02043000
DCBPTR   EQU   @06                                                      02044000
BLKCTR   EQU   @07                                                      02045000
RBSECPTR EQU   @08                                                      02046000
RDXENTRG EQU   @10                                                      02047000
WRKREG   EQU   @11                                                      02048000
SAVEPTR  EQU   @13                                                      02049000
RETURNCD EQU   @15                                                      02050000
GPR14F   EQU   @14                                                      02051000
MVBLKPTR EQU   @04                                                      02052000
TRCPTR   EQU   @02                                                      02053000
CVTPTR   EQU   16                                                       02054000
PSA      EQU   0                                                        02055000
FLCRNPSW EQU   PSA                                                      02056000
FLCROPSW EQU   PSA+8                                                    02057000
FLCICCW2 EQU   PSA+16                                                   02058000
PSAEEPSW EQU   PSA+132                                                  02059000
PSAESPSW EQU   PSA+136                                                  02060000
FLCSVILC EQU   PSAESPSW+1                                               02061000
PSAEPPSW EQU   PSA+140                                                  02062000
FLCPIILC EQU   PSAEPPSW+1                                               02063000
FLCPICOD EQU   PSAEPPSW+2                                               02064000
PSAPICOD EQU   FLCPICOD+1                                               02065000
FLCTEA   EQU   PSAEPPSW+4                                               02066000
FLCPER   EQU   PSA+152                                                  02067000
FLCMCLA  EQU   PSA+168                                                  02068000
FLCIOEL  EQU   FLCMCLA+4                                                02069000
FLCIOA   EQU   FLCMCLA+16                                               02070000
FLCFSA   EQU   FLCMCLA+80                                               02071000
PSATOLD  EQU   PSA+540                                                  02072000
PSASUPER EQU   PSA+552                                                  02073000
PSASUP1  EQU   PSASUPER                                                 02074000
PSASUP2  EQU   PSASUPER+1                                               02075000
PSASUP3  EQU   PSASUPER+2                                               02076000
PSASUP4  EQU   PSASUPER+3                                               02077000
PSACLHT  EQU   PSA+640                                                  02078000
PSALKSA  EQU   PSA+696                                                  02079000
PSAHLHI  EQU   PSA+760                                                  02080000
PSALITA  EQU   PSA+764                                                  02081000
PSADSSFL EQU   PSA+836                                                  02082000
PSADSSF1 EQU   PSADSSFL                                                 02083000
PSADSSF3 EQU   PSADSSFL+2                                               02084000
PSADSSF4 EQU   PSADSSFL+3                                               02085000
PSARSVT  EQU   PSA+896                                                  02086000
NOBASE   EQU   0                                                        02087000
CVTMAP   EQU   0                                                        02088000
CVT0VL00 EQU   CVTMAP+24                                                02089000
CVTDAR   EQU   CVTMAP+72                                                02090000
CVTFLGS1 EQU   CVTDAR                                                   02091000
CVTDCB   EQU   CVTMAP+116                                               02092000
CVTIOQET EQU   CVTMAP+120                                               02093000
CVTIERLC EQU   CVTMAP+144                                               02094000
CVTHEAD  EQU   CVTMAP+160                                               02095000
CVTSV76C EQU   CVTHEAD                                                  02096000
CVTOPTA  EQU   CVTMAP+182                                               02097000
CVTOPTB  EQU   CVTMAP+183                                               02098000
CVTGTF   EQU   CVTMAP+236                                               02099000
CVTGTFST EQU   CVTGTF                                                   02100000
CVTGTFS  EQU   CVTGTFST                                                 02101000
CVTSTATE EQU   CVTGTFST                                                 02102000
CVTTMODE EQU   CVTGTFST                                                 02103000
CVTFORM  EQU   CVTGTFST                                                 02104000
CVTAQAVT EQU   CVTMAP+240                                               02105000
CVTTCMFG EQU   CVTAQAVT                                                 02106000
CVTVOLM2 EQU   CVTMAP+244                                               02107000
CVTTATA  EQU   CVTVOLM2                                                 02108000
CVTTSKS  EQU   CVTTATA                                                  02109000
CVTVOLF2 EQU   CVTTSKS                                                  02110000
CVTTAT   EQU   CVTTATA+1                                                02111000
CVTATER  EQU   CVTMAP+248                                               02112000
CVTEXT1  EQU   CVTMAP+252                                               02113000
CVTPURG  EQU   CVTMAP+260                                               02114000
CVTQMSG  EQU   CVTMAP+268                                               02115000
CVTDMSR  EQU   CVTMAP+272                                               02116000
CVTRSV37 EQU   CVTDMSR                                                  02117000
CVTDMSRF EQU   CVTRSV37                                                 02118000
CVTERPV  EQU   CVTMAP+316                                               02119000
CVTINTLA EQU   CVTMAP+320                                               02120000
CVTAPF   EQU   CVTMAP+324                                               02121000
CVTEXT2  EQU   CVTMAP+328                                               02122000
CVTHJES  EQU   CVTMAP+332                                               02123000
CVTPGSIA EQU   CVTMAP+348                                               02124000
CVTA1F1  EQU   CVTMAP+356                                               02125000
CVTSYSK  EQU   CVTMAP+357                                               02126000
CVTVOLM1 EQU   CVTMAP+380                                               02127000
CVTVOLF1 EQU   CVTVOLM1                                                 02128000
CVTATMCT EQU   CVTMAP+388                                               02129000
CVTXTNT1 EQU   0                                                        02130000
CVTXTNT2 EQU   0                                                        02131000
CVTDSSV  EQU   CVTXTNT2                                                 02132000
CVTFLGBT EQU   CVTXTNT2+5                                               02133000
CVTDEBVR EQU   CVTXTNT2+8                                               02134000
CVTQID   EQU   CVTXTNT2+24                                              02135000
CVTRV400 EQU   CVTXTNT2+52                                              02136000
CVTRV409 EQU   CVTXTNT2+53                                              02137000
CVTATCVT EQU   CVTXTNT2+64                                              02138000
CVTRV429 EQU   CVTXTNT2+84                                              02139000
CVTRV438 EQU   CVTXTNT2+85                                              02140000
CVTRV457 EQU   CVTXTNT2+112                                             02141000
CVTRV466 EQU   CVTXTNT2+113                                             02142000
CVTFIX   EQU   0                                                        02143000
CVTRELNO EQU   CVTFIX+252                                               02144000
IHADCB   EQU   0                                                        02145000
IHADCS00 EQU   0                                                        02146000
DCBFDAD  EQU   IHADCS00+5                                               02147000
IHADCS01 EQU   0                                                        02148000
DCBDVTBL EQU   IHADCS01                                                 02149000
IHADCS11 EQU   0                                                        02150000
DCBRELB  EQU   IHADCS11                                                 02151000
DCBREL   EQU   DCBRELB+1                                                02152000
DCBBUFCB EQU   IHADCS11+4                                               02153000
DCBDSORG EQU   IHADCS11+10                                              02154000
DCBDSRG1 EQU   DCBDSORG                                                 02155000
DCBDSRG2 EQU   DCBDSORG+1                                               02156000
DCBIOBAD EQU   IHADCS11+12                                              02157000
DCBODEB  EQU   DCBIOBAD                                                 02158000
DCBLNP   EQU   DCBODEB                                                  02159000
DCBQSLM  EQU   DCBLNP                                                   02160000
DCBIOBAA EQU   DCBODEB+1                                                02161000
IHADCS50 EQU   0                                                        02162000
DCBSVCXL EQU   IHADCS50                                                 02163000
DCBEODAD EQU   IHADCS50+4                                               02164000
DCBBFALN EQU   DCBEODAD                                                 02165000
DCBHIARC EQU   DCBBFALN                                                 02166000
DCBBFTEK EQU   DCBHIARC                                                 02167000
DCBBFT   EQU   DCBBFTEK                                                 02168000
DCBEXLST EQU   IHADCS50+8                                               02169000
DCBRECFM EQU   DCBEXLST                                                 02170000
DCBRECLA EQU   DCBRECFM                                                 02171000
IHADCS24 EQU   0                                                        02172000
DCBOFLGS EQU   IHADCS24+8                                               02173000
DCBOFLWR EQU   DCBOFLGS                                                 02174000
DCBIFLG  EQU   IHADCS24+9                                               02175000
DCBIBPCT EQU   DCBIFLG                                                  02176000
DCBMACR  EQU   IHADCS24+10                                              02177000
DCBMACR1 EQU   DCBMACR                                                  02178000
DCBMRFE  EQU   DCBMACR1                                                 02179000
DCBMRGET EQU   DCBMRFE                                                  02180000
DCBMRAPG EQU   DCBMACR1                                                 02181000
DCBMRRD  EQU   DCBMRAPG                                                 02182000
DCBMRCI  EQU   DCBMACR1                                                 02183000
DCBMRMVG EQU   DCBMRCI                                                  02184000
DCBMRLCG EQU   DCBMACR1                                                 02185000
DCBMRABC EQU   DCBMACR1                                                 02186000
DCBMRPT1 EQU   DCBMRABC                                                 02187000
DCBMRSBG EQU   DCBMRPT1                                                 02188000
DCBMRCRL EQU   DCBMACR1                                                 02189000
DCBMRCHK EQU   DCBMRCRL                                                 02190000
DCBMRRDX EQU   DCBMRCHK                                                 02191000
DCBMRDMG EQU   DCBMACR1                                                 02192000
DCBMRCK  EQU   DCBMRDMG                                                 02193000
DCBMACR2 EQU   DCBMACR+1                                                02194000
DCBMRPUT EQU   DCBMACR2                                                 02195000
DCBMRWRT EQU   DCBMACR2                                                 02196000
DCBMRMVP EQU   DCBMACR2                                                 02197000
DCBMR5WD EQU   DCBMACR2                                                 02198000
DCBMRLDM EQU   DCBMR5WD                                                 02199000
DCBMRLCP EQU   DCBMRLDM                                                 02200000
DCBMR4WD EQU   DCBMACR2                                                 02201000
DCBMRPT2 EQU   DCBMR4WD                                                 02202000
DCBMRTMD EQU   DCBMRPT2                                                 02203000
DCBMR3WD EQU   DCBMACR2                                                 02204000
DCBMRCTL EQU   DCBMR3WD                                                 02205000
DCBMRSTK EQU   DCBMRCTL                                                 02206000
DCBMR1WD EQU   DCBMACR2                                                 02207000
DCBMRSWA EQU   DCBMR1WD                                                 02208000
DCBMRDMD EQU   DCBMRSWA                                                 02209000
IHADCS25 EQU   0                                                        02210000
DCBMACRF EQU   IHADCS25+2                                               02211000
DCBMACF1 EQU   DCBMACRF                                                 02212000
DCBMFFE  EQU   DCBMACF1                                                 02213000
DCBMFGET EQU   DCBMFFE                                                  02214000
DCBMFAPG EQU   DCBMACF1                                                 02215000
DCBMFRD  EQU   DCBMFAPG                                                 02216000
DCBMFCI  EQU   DCBMACF1                                                 02217000
DCBMFMVG EQU   DCBMFCI                                                  02218000
DCBMFLCG EQU   DCBMACF1                                                 02219000
DCBMFABC EQU   DCBMACF1                                                 02220000
DCBMFPT1 EQU   DCBMFABC                                                 02221000
DCBMFSBG EQU   DCBMFPT1                                                 02222000
DCBMFCRL EQU   DCBMACF1                                                 02223000
DCBMFCHK EQU   DCBMFCRL                                                 02224000
DCBMFDMG EQU   DCBMACF1                                                 02225000
DCBMACF2 EQU   DCBMACRF+1                                               02226000
DCBMFPUT EQU   DCBMACF2                                                 02227000
DCBMFWRT EQU   DCBMACF2                                                 02228000
DCBMFMVP EQU   DCBMACF2                                                 02229000
DCBMF5WD EQU   DCBMACF2                                                 02230000
DCBMFLDM EQU   DCBMF5WD                                                 02231000
DCBMFLCP EQU   DCBMFLDM                                                 02232000
DCBMF4WD EQU   DCBMACF2                                                 02233000
DCBMFPT2 EQU   DCBMF4WD                                                 02234000
DCBMFTMD EQU   DCBMFPT2                                                 02235000
DCBMF3WD EQU   DCBMACF2                                                 02236000
DCBMFCTL EQU   DCBMF3WD                                                 02237000
DCBMFSTK EQU   DCBMFCTL                                                 02238000
DCBMF1WD EQU   DCBMACF2                                                 02239000
DCBMFSWA EQU   DCBMF1WD                                                 02240000
DCBMFDMD EQU   DCBMFSWA                                                 02241000
DCBDEBAD EQU   IHADCS25+4                                               02242000
DCBIFLGS EQU   DCBDEBAD                                                 02243000
DCBIFPCT EQU   DCBIFLGS                                                 02244000
DCBDEBA  EQU   DCBDEBAD+1                                               02245000
IHADCS26 EQU   0                                                        02246000
DCBWRITE EQU   IHADCS26                                                 02247000
DCBREAD  EQU   DCBWRITE                                                 02248000
DCBWRITA EQU   DCBREAD+1                                                02249000
IHADCS30 EQU   0                                                        02250000
DCBCHECK EQU   IHADCS30                                                 02251000
DCBOPTCD EQU   DCBCHECK                                                 02252000
DCBXARG  EQU   IHADCS30+32                                              02253000
DCBDRDX  EQU   IHADCS30+36                                              02254000
DEBBASIC EQU   0                                                        02255000
DEBTCBAD EQU   DEBBASIC                                                 02256000
DEBTCBB  EQU   DEBTCBAD+1                                               02257000
DEBDEBAD EQU   DEBBASIC+4                                               02258000
DEBIRBAD EQU   DEBBASIC+8                                               02259000
DEBOFLGS EQU   DEBIRBAD                                                 02260000
DEBOPATB EQU   DEBBASIC+12                                              02261000
DEBFLGS1 EQU   DEBBASIC+14                                              02262000
DEBUSRPG EQU   DEBBASIC+16                                              02263000
DEBRRQ   EQU   DEBBASIC+20                                              02264000
DEBECBAD EQU   DEBRRQ                                                   02265000
DEBDCBAD EQU   DEBBASIC+24                                              02266000
DEBPROTG EQU   DEBDCBAD                                                 02267000
DEBDCBB  EQU   DEBDCBAD+1                                               02268000
DEBAPPAD EQU   DEBBASIC+28                                              02269000
DEBBASND EQU   DEBBASIC+32                                              02270000
DEBDASD  EQU   0                                                        02271000
DEBUCBAD EQU   DEBDASD                                                  02272000
DEBACSMD EQU   0                                                        02273000
DEBVOLSQ EQU   DEBACSMD                                                 02274000
DEBVOLBT EQU   DEBVOLSQ                                                 02275000
DEBDSNM  EQU   DEBACSMD+4                                               02276000
DEBUTSAA EQU   DEBDSNM                                                  02277000
DEBACS01 EQU   0                                                        02278000
DEBDSNAM EQU   DEBACS01                                                 02279000
DEBACS02 EQU   0                                                        02280000
DEBDBLK  EQU   DEBACS02                                                 02281000
DEBACS03 EQU   0                                                        02282000
DEBACS04 EQU   0                                                        02283000
DEBTBFRA EQU   DEBACS04                                                 02284000
DEBTCCWA EQU   DEBACS04+4                                               02285000
DEBACS05 EQU   0                                                        02286000
DEBFUCBA EQU   DEBACS05                                                 02287000
DEBLUCBA EQU   DEBACS05+4                                               02288000
DEBACS06 EQU   0                                                        02289000
DEBACS07 EQU   0                                                        02290000
DEBACS08 EQU   0                                                        02291000
DEBSUBNM EQU   0                                                        02292000
DEB      EQU   0                                                        02293000
DEBAVT   EQU   DEB                                                      02294000
DEBEOEA  EQU   DEBAVT                                                   02295000
DEBEOEAB EQU   DEBEOEA                                                  02296000
DEBSIOA  EQU   DEBAVT+4                                                 02297000
DEBSIOAB EQU   DEBSIOA                                                  02298000
DEBPCIA  EQU   DEBAVT+8                                                 02299000
DEBPCIAB EQU   DEBPCIA                                                  02300000
DEBCEA   EQU   DEBAVT+12                                                02301000
DEBCEAB  EQU   DEBCEA                                                   02302000
DEBXCEA  EQU   DEBAVT+16                                                02303000
DEBXCEAB EQU   DEBXCEA                                                  02304000
DEBPREFX EQU   DEB+20                                                   02305000
DEBXTNP  EQU   DEBPREFX+8                                               02306000
DEBTBLOF EQU   DEBPREFX+14                                              02307000
DEBXTN   EQU   0                                                        02308000
DEBXFLG1 EQU   DEBXTN+2                                                 02309000
DEBXDSAB EQU   DEBXTN+4                                                 02310000
DEBXXARG EQU   DEBXTN+20                                                02311000
DECB     EQU   0                                                        02312000
DECBPTR  EQU   DECB+4                                                   02313000
DECTYPE  EQU   DECBPTR                                                  02314000
DECTYPE1 EQU   DECTYPE                                                  02315000
DECTYPE2 EQU   DECTYPE+1                                                02316000
DECNEXT  EQU   DECB+20                                                  02317000
DECBS01  EQU   0                                                        02318000
DECBECB  EQU   DECBS01                                                  02319000
DECBRB   EQU   DECBECB                                                  02320000
DECBECBF EQU   DECBRB                                                   02321000
DECBTYP1 EQU   DECBS01+4                                                02322000
DECBTYP2 EQU   DECBS01+5                                                02323000
DECBEXC1 EQU   DECBS01+24                                               02324000
DECBEXC2 EQU   DECBS01+25                                               02325000
DECBS02  EQU   0                                                        02326000
@NM00022 EQU   DECBS02                                                  02327000
DECCC2   EQU   @NM00022+1                                               02328000
DECCC3   EQU   @NM00022+2                                               02329000
@NM00024 EQU   DECBS02+4                                                02330000
@NM00025 EQU   @NM00024                                                 02331000
@NM00026 EQU   @NM00024+1                                               02332000
DECTYPRU EQU   @NM00026                                                 02333000
DECNA    EQU   DECBS02+28                                               02334000
DECBS03  EQU   0                                                        02335000
DECCPOL  EQU   DECBS03+20                                               02336000
@NM00034 EQU   DECBS03+36                                               02337000
DECBS04  EQU   0                                                        02338000
@NM00037 EQU   DECBS04+4                                                02339000
@NM00038 EQU   @NM00037                                                 02340000
@NM00041 EQU   DECBS04+8                                                02341000
DECBUFCT EQU   @NM00041                                                 02342000
DECONLTT EQU   DECBUFCT                                                 02343000
DECENTRY EQU   DECBS04+20                                               02344000
DECFLAGS EQU   DECBS04+24                                               02345000
DECWACK  EQU   DECFLAGS                                                 02346000
DECREVRS EQU   DECFLAGS                                                 02347000
DECERRST EQU   DECBS04+29                                               02348000
DECPOLPT EQU   DECBS04+36                                               02349000
DSAB     EQU   0                                                        02350000
DSABTIOT EQU   DSAB+16                                                  02351000
DSABGIDP EQU   DSAB+24                                                  02352000
DSABANMP EQU   DSAB+28                                                  02353000
DSABORG  EQU   DSAB+32                                                  02354000
DSABORG1 EQU   DSABORG                                                  02355000
DSABORG2 EQU   DSABORG+1                                                02356000
DSABFLG1 EQU   DSAB+34                                                  02357000
DSABFLG2 EQU   DSAB+35                                                  02358000
DSABFLG3 EQU   DSAB+36                                                  02359000
DSABFLG4 EQU   DSAB+37                                                  02360000
DSABANMI EQU   0                                                        02361000
DSABGIDL EQU   0                                                        02362000
IOBPREFX EQU   0                                                        02363000
IOBCFLG1 EQU   IOBPREFX                                                 02364000
IOBSTDRD EQU   0                                                        02365000
IOBFLAG1 EQU   IOBSTDRD                                                 02366000
IOBCYCCK EQU   IOBFLAG1                                                 02367000
IOBRSTRT EQU   IOBFLAG1                                                 02368000
IOBFLAG2 EQU   IOBSTDRD+1                                               02369000
IOBPURGE EQU   IOBFLAG2                                                 02370000
IOBRDHA0 EQU   IOBFLAG2                                                 02371000
IOBSENS0 EQU   IOBSTDRD+2                                               02372000
IOBS0B7  EQU   IOBSENS0                                                 02373000
IOBSENS1 EQU   IOBSTDRD+3                                               02374000
IOBECBPT EQU   IOBSTDRD+4                                               02375000
IOBFLAG3 EQU   IOBSTDRD+8                                               02376000
IOBFL3   EQU   IOBFLAG3                                                 02377000
IOBCNC   EQU   IOBFL3                                                   02378000
IOBICL   EQU   IOBFL3                                                   02379000
IOBCSW   EQU   IOBSTDRD+9                                               02380000
IOBIOCSW EQU   IOBCSW                                                   02381000
IOBSTBYT EQU   IOBIOCSW+3                                               02382000
IOBUSTAT EQU   IOBSTBYT                                                 02383000
IOBCSTAT EQU   IOBSTBYT+1                                               02384000
IOBSTART EQU   IOBSTDRD+16                                              02385000
IOBDCBPT EQU   IOBSTDRD+20                                              02386000
IOBFLAG4 EQU   IOBDCBPT                                                 02387000
IOBRESTR EQU   IOBSTDRD+24                                              02388000
IOBINCAM EQU   IOBSTDRD+28                                              02389000
IOBBTAMF EQU   IOBINCAM                                                 02390000
RBPRFX   EQU   0                                                        02391000
RBBASIC  EQU   0                                                        02392000
RBEXRTNM EQU   RBBASIC                                                  02393000
RBTMFLD  EQU   RBEXRTNM                                                 02394000
RBSTAB   EQU   RBBASIC+10                                               02395000
XSTAB    EQU   RBSTAB                                                   02396000
RBSTAB1  EQU   XSTAB                                                    02397000
XSTAB1   EQU   RBSTAB1                                                  02398000
RBFTCKPT EQU   XSTAB1                                                   02399000
RBSTAB2  EQU   XSTAB+1                                                  02400000
XSTAB2   EQU   RBSTAB2                                                  02401000
RBTCBNXT EQU   XSTAB2                                                   02402000
RBFACTV  EQU   XSTAB2                                                   02403000
RBFDYN   EQU   XSTAB2                                                   02404000
RBECBWT  EQU   XSTAB2                                                   02405000
RBOPSW   EQU   RBBASIC+16                                               02406000
XRBPSW   EQU   RBOPSW                                                   02407000
RBOPSWB2 EQU   XRBPSW+1                                                 02408000
RBLINK   EQU   RBBASIC+28                                               02409000
XRBLNK   EQU   RBLINK                                                   02410000
RBWCF    EQU   XRBLNK                                                   02411000
RBLINKB  EQU   XRBLNK+1                                                 02412000
RBGRSAVE EQU   RBBASIC+32                                               02413000
XRBREG   EQU   RBGRSAVE                                                 02414000
RBGRS0   EQU   XRBREG                                                   02415000
RBGRS1   EQU   XRBREG+4                                                 02416000
RBGRS2   EQU   XRBREG+8                                                 02417000
RBGRS3   EQU   XRBREG+12                                                02418000
RBGRS4   EQU   XRBREG+16                                                02419000
RBGRS5   EQU   XRBREG+20                                                02420000
RBGRS6   EQU   XRBREG+24                                                02421000
RBGRS7   EQU   XRBREG+28                                                02422000
RBGRS8   EQU   XRBREG+32                                                02423000
RBGRS9   EQU   XRBREG+36                                                02424000
RBGRS10  EQU   XRBREG+40                                                02425000
RBGRS11  EQU   XRBREG+44                                                02426000
RBGRS12  EQU   XRBREG+48                                                02427000
RBGRS13  EQU   XRBREG+52                                                02428000
RBGRS14  EQU   XRBREG+56                                                02429000
RBGRS15  EQU   XRBREG+60                                                02430000
XRBESA   EQU   RBBASIC+96                                               02431000
RBEXSAVE EQU   XRBESA                                                   02432000
RBPREFIX EQU   0                                                        02433000
RBRSV019 EQU   RBPREFIX+14                                              02434000
RBRSV028 EQU   RBPREFIX+15                                              02435000
RBRSV041 EQU   RBPREFIX+27                                              02436000
RBRSV054 EQU   RBPREFIX+39                                              02437000
RBRTOPSW EQU   RBPREFIX+40                                              02438000
RBRTPSW2 EQU   RBRTOPSW+8                                               02439000
RBRTICIL EQU   RBRTPSW2                                                 02440000
RBFLAGS1 EQU   RBPREFIX+56                                              02441000
RBINTCDA EQU   RBPREFIX+61                                              02442000
RBSECT   EQU   0                                                        02443000
RBPPSAV  EQU   RBSECT                                                   02444000
@NM00083 EQU   RBSECT+10                                                02445000
@NM00084 EQU   @NM00083                                                 02446000
RBTRSVRB EQU   @NM00084                                                 02447000
@NM00086 EQU   @NM00083+1                                               02448000
RBETXR   EQU   @NM00086                                                 02449000
RBEP     EQU   RBSECT+12                                                02450000
RBPGMQ   EQU   RBSECT+24                                                02451000
@NM00093 EQU   RBSECT+28                                                02452000
IRBEND   EQU   RBSECT+96                                                02453000
@NM00097 EQU   RBSECT+96                                                02454000
RBRSV138 EQU   @NM00097+7                                               02455000
RBRSV150 EQU   RBSECT+167                                               02456000
RDXLIST  EQU   0                                                        02457000
RDXNEXT  EQU   RDXLIST+4                                                02458000
RDXENT   EQU   RDXLIST+8                                                02459000
RDXENTRY EQU   0                                                        02460000
RDXIOBUQ EQU   RDXENTRY+8                                               02461000
RDXUQND  EQU   RDXENTRY+12                                              02462000
SDWA     EQU   0                                                        02463000
SDWAPARM EQU   SDWA                                                     02464000
SDWAFIOB EQU   SDWA+4                                                   02465000
SDWAABCC EQU   SDWAFIOB                                                 02466000
SDWACMPF EQU   SDWAABCC                                                 02467000
SDWAREQ  EQU   SDWACMPF                                                 02468000
SDWACMPC EQU   SDWAABCC+1                                               02469000
SDWACTL1 EQU   SDWA+8                                                   02470000
SDWACMKA EQU   SDWACTL1                                                 02471000
SDWAMWPA EQU   SDWACTL1+1                                               02472000
SDWAPMKA EQU   SDWACTL1+4                                               02473000
SDWACTL2 EQU   SDWA+16                                                  02474000
SDWACMKP EQU   SDWACTL2                                                 02475000
SDWAMWPP EQU   SDWACTL2+1                                               02476000
SDWAPMKP EQU   SDWACTL2+4                                               02477000
SDWAGRSV EQU   SDWA+24                                                  02478000
SDWANAME EQU   SDWA+88                                                  02479000
SDWAEC1  EQU   SDWA+104                                                 02480000
SDWAEMK1 EQU   SDWAEC1                                                  02481000
SDWAMWP1 EQU   SDWAEC1+1                                                02482000
SDWAINT1 EQU   SDWAEC1+2                                                02483000
SDWANXT1 EQU   SDWAEC1+4                                                02484000
SDWAAEC1 EQU   SDWA+112                                                 02485000
SDWAILC1 EQU   SDWAAEC1+1                                               02486000
SDWAINC1 EQU   SDWAAEC1+2                                               02487000
SDWAICD1 EQU   SDWAINC1+1                                               02488000
SDWAEC2  EQU   SDWA+120                                                 02489000
SDWAEMK2 EQU   SDWAEC2                                                  02490000
SDWAMWP2 EQU   SDWAEC2+1                                                02491000
SDWAINT2 EQU   SDWAEC2+2                                                02492000
SDWANXT2 EQU   SDWAEC2+4                                                02493000
SDWAAEC2 EQU   SDWA+128                                                 02494000
SDWAILC2 EQU   SDWAAEC2+1                                               02495000
SDWAINC2 EQU   SDWAAEC2+2                                               02496000
SDWAICD2 EQU   SDWAINC2+1                                               02497000
SDWASRSV EQU   SDWA+136                                                 02498000
SDWASR15 EQU   SDWASRSV+60                                              02499000
SDWAIDNT EQU   SDWA+200                                                 02500000
SDWAMCH  EQU   SDWA+204                                                 02501000
SDWASTCK EQU   SDWAMCH                                                  02502000
SDWAMCHI EQU   SDWAMCH+8                                                02503000
SDWAMCHS EQU   SDWAMCHI                                                 02504000
SDWAMCHD EQU   SDWAMCHI+1                                               02505000
SDWARSR1 EQU   SDWAMCH+12                                               02506000
SDWARSR2 EQU   SDWAMCH+13                                               02507000
SDWAFLGS EQU   SDWA+232                                                 02508000
SDWAERRA EQU   SDWAFLGS                                                 02509000
SDWAMCHK EQU   SDWAERRA                                                 02510000
SDWATEXC EQU   SDWAERRA                                                 02511000
SDWAPGIO EQU   SDWAERRA                                                 02512000
SDWAERRB EQU   SDWAFLGS+1                                               02513000
SDWAERRC EQU   SDWAFLGS+2                                               02514000
SDWASTAF EQU   SDWAERRC                                                 02515000
SDWAEAS  EQU   SDWAERRC                                                 02516000
SDWAERRD EQU   SDWAFLGS+3                                               02517000
SDWACLUP EQU   SDWAERRD                                                 02518000
SDWAIOFS EQU   SDWA+238                                                 02519000
SDWARTYA EQU   SDWA+240                                                 02520000
SDWACPUA EQU   SDWA+248                                                 02521000
SDWAPARQ EQU   SDWA+252                                                 02522000
SDWARCDE EQU   SDWAPARQ                                                 02523000
SDWAACF2 EQU   SDWAPARQ+1                                               02524000
SDWARCRD EQU   SDWAACF2                                                 02525000
SDWAUPRG EQU   SDWAACF2                                                 02526000
SDWAFREE EQU   SDWAACF2                                                 02527000
SDWAACF3 EQU   SDWAPARQ+2                                               02528000
SDWAACF4 EQU   SDWAPARQ+3                                               02529000
SDWALKWA EQU   SDWA+256                                                 02530000
SDWALKWS EQU   SDWALKWA                                                 02531000
SDWARECP EQU   SDWA+292                                                 02532000
SDWACSCT EQU   SDWARECP+8                                               02533000
SDWAREXN EQU   SDWARECP+16                                              02534000
SDWASNPA EQU   SDWA+320                                                 02535000
SDWADUMP EQU   SDWASNPA                                                 02536000
SDWADPFS EQU   SDWADUMP+1                                               02537000
SDWADDAT EQU   SDWASNPA+4                                               02538000
SDWASDAT EQU   SDWADDAT                                                 02539000
SDWAPDAT EQU   SDWADDAT+2                                               02540000
SDWADPSA EQU   SDWA+328                                                 02541000
SDWADPSL EQU   SDWADPSA                                                 02542000
SDWARA   EQU   SDWA+400                                                 02543000
SDWADPVA EQU   SDWARA+2                                                 02544000
SDWAVRA  EQU   SDWARA+4                                                 02545000
SPDBFR   EQU   0                                                        02546000
SPDHDR   EQU   SPDBFR                                                   02547000
SPDTRRCD EQU   0                                                        02548000
SPDRCDHD EQU   SPDTRRCD                                                 02549000
SPDBLKID EQU   SPDRCDHD+1                                               02550000
SPDDATA1 EQU   SPDTRRCD+2                                               02551000
TCBFIX   EQU   0                                                        02552000
TCBFRS   EQU   TCBFIX                                                   02553000
TCB      EQU   0                                                        02554000
TCBPIE   EQU   TCB+4                                                    02555000
TCBPMASK EQU   TCBPIE                                                   02556000
TCBTIO   EQU   TCB+12                                                   02557000
TCBCMP   EQU   TCB+16                                                   02558000
TCBCMPF  EQU   TCBCMP                                                   02559000
TCBCPP   EQU   TCBCMPF                                                  02560000
TCBSTCC  EQU   TCBCMPF                                                  02561000
TCBCDBL  EQU   TCBCMPF                                                  02562000
TCBCWTO  EQU   TCBCMPF                                                  02563000
TCBCIND  EQU   TCBCMPF                                                  02564000
TCBCMSG  EQU   TCBCMPF                                                  02565000
TCBTRN   EQU   TCB+20                                                   02566000
TCBABF   EQU   TCBTRN                                                   02567000
TCBMSS   EQU   TCB+24                                                   02568000
TCBPKF   EQU   TCB+28                                                   02569000
TCBFLGS  EQU   TCB+29                                                   02570000
TCBFLGS1 EQU   TCBFLGS                                                  02571000
TCBFLGS2 EQU   TCBFLGS+1                                                02572000
TCBFLGS3 EQU   TCBFLGS+2                                                02573000
TCBFLGS4 EQU   TCBFLGS+3                                                02574000
TCBFLGS5 EQU   TCBFLGS+4                                                02575000
TCBABWF  EQU   TCBFLGS5                                                 02576000
TCBJPQ   EQU   TCB+44                                                   02577000
TCBPURGE EQU   TCBJPQ                                                   02578000
TCBGRS   EQU   TCB+48                                                   02579000
TCBFSA   EQU   TCB+112                                                  02580000
TCBTME   EQU   TCB+120                                                  02581000
TCBJSTCB EQU   TCB+124                                                  02582000
TCBTSFLG EQU   TCB+148                                                  02583000
TCBTSTSK EQU   TCBTSFLG                                                 02584000
TCBSTAB  EQU   TCB+160                                                  02585000
TCBNSTAE EQU   TCBSTAB                                                  02586000
TCBTCT   EQU   TCB+164                                                  02587000
TCBTCTGF EQU   TCBTCT                                                   02588000
TCBSCNDY EQU   TCB+172                                                  02589000
TCBNDSP  EQU   TCBSCNDY                                                 02590000
TCBNDSP1 EQU   TCBNDSP+1                                                02591000
TCBNDSP2 EQU   TCBNDSP+2                                                02592000
TCBNDSP3 EQU   TCBNDSP+3                                                02593000
TCBJSCB  EQU   TCB+180                                                  02594000
TCBRECDE EQU   TCBJSCB                                                  02595000
TCBEXT1  EQU   TCB+196                                                  02596000
TCBBITS  EQU   TCB+200                                                  02597000
TCBNDSP4 EQU   TCBBITS                                                  02598000
TCBNDSP5 EQU   TCBBITS+1                                                02599000
TCBFLGS6 EQU   TCBBITS+2                                                02600000
TCBFLGS7 EQU   TCBBITS+3                                                02601000
TCBDAR   EQU   TCB+204                                                  02602000
TCBDARC  EQU   TCBDAR                                                   02603000
TCBEXT2  EQU   TCB+208                                                  02604000
TCBFOE   EQU   TCB+244                                                  02605000
TCBESTAE EQU   TCB+264                                                  02606000
TCBESTRM EQU   TCBESTAE+1                                               02607000
TCBFBYT1 EQU   TCB+276                                                  02608000
TCBFBYT2 EQU   TCB+277                                                  02609000
TCBRV124 EQU   TCB+278                                                  02610000
TCBRV133 EQU   TCB+279                                                  02611000
TCBXTNT2 EQU   0                                                        02612000
TCBGTF   EQU   TCBXTNT2                                                 02613000
TCBTFLG  EQU   TCBGTF                                                   02614000
TCBRV146 EQU   TCBXTNT2+28                                              02615000
TCBRV155 EQU   TCBXTNT2+29                                              02616000
TCBRV164 EQU   TCBXTNT2+30                                              02617000
TCBRV173 EQU   TCBXTNT2+31                                              02618000
TIOT1    EQU   0                                                        02619000
TIOCNJOB EQU   TIOT1                                                    02620000
TIOCSTEP EQU   TIOT1+8                                                  02621000
TIOENTRY EQU   0                                                        02622000
TIOESTTA EQU   TIOENTRY+1                                               02623000
TIOERLOC EQU   TIOENTRY+2                                               02624000
TIOELINK EQU   TIOERLOC+1                                               02625000
TIOESYOT EQU   TIOELINK                                                 02626000
TIOEDDNM EQU   TIOENTRY+4                                               02627000
TIOESTTC EQU   TIOENTRY+15                                              02628000
TIOESTTB EQU   TIOENTRY+16                                              02629000
POOLSTAR EQU   TIOENTRY+20                                              02630000
EST2RET  EQU   0                                                        02631000
RELAREA  EQU   0                                                        02632000
ASUBRTN  EQU   0                                                        02633000
IKEBC    EQU   0                                                        02634000
IKEBF15  EQU   0                                                        02635000
IKEBF31  EQU   0                                                        02636000
IKEBP15  EQU   0                                                        02637000
IKEBP31  EQU   0                                                        02638000
IKEBP8   EQU   0                                                        02639000
SPDRDATA EQU   0                                                        02640000
CVTS01   EQU   CVTPGSIA                                                 02641000
CVTLPDIA EQU   CVTS01+12                                                02642000
CVTDIRST EQU   CVTLPDIA                                                 02643000
CVTSLIDA EQU   CVTS01+24                                                02644000
CVTCTLFG EQU   CVTS01+50                                                02645000
CVTRV210 EQU   CVTS01+424                                               02646000
CVTRV219 EQU   CVTS01+425                                               02647000
CVTRV228 EQU   CVTS01+426                                               02648000
CVTRV237 EQU   CVTS01+427                                               02649000
CVTMFRTR EQU   CVTS01+452                                               02650000
CVTRV262 EQU   CVTS01+468                                               02651000
CVTRV271 EQU   CVTS01+469                                               02652000
CVTRV280 EQU   CVTS01+470                                               02653000
CVTRV289 EQU   CVTS01+471                                               02654000
CVTGSDA  EQU   CVTS01+600                                               02655000
DEBBAS02 EQU   DEBBASND                                                 02656000
DEBDDS1  EQU   DEBBAS02                                                 02657000
DEBSUCBA EQU   DEBDDS1                                                  02658000
DEBDEVED EQU   DEBDDS1+4                                                02659000
DEBRDCB  EQU   DEBDDS1+4                                                02660000
DEBPDCB  EQU   DEBDDS1+8                                                02661000
DEBWDCB  EQU   DEBDDS1+12                                               02662000
DEBACS09 EQU   DEBDEVED                                                 02663000
DEBASC09 EQU   DEBACS09                                                 02664000
DEBEAMFG EQU   DEBASC09+3                                               02665000
DEBDSID  EQU   DEBASC09+4                                               02666000
DEBEOD   EQU   DEBASC09+12                                              02667000
DEBBOE   EQU   DEBEOD                                                   02668000
DEBEODRV EQU   DEBBOE                                                   02669000
DEBEODTT EQU   DEBBOE+1                                                 02670000
DEBEOD0  EQU   DEBBOE+2                                                 02671000
DEBEODSS EQU   DEBBOE+3                                                 02672000
DEBBAS01 EQU   DEBBASND                                                 02673000
DEBISAM  EQU   DEBBAS01                                                 02674000
DEBFIEAD EQU   DEBISAM                                                  02675000
DEBFPEAD EQU   DEBISAM+4                                                02676000
DEBFOEAD EQU   DEBISAM+8                                                02677000
DEBEXPT  EQU   DEBISAM+12                                               02678000
DEBRPSID EQU   DEBEXPT                                                  02679000
DECBS05  EQU   DECNEXT                                                  02680000
IOBORG01 EQU   IOBPREFX+8                                               02681000
IOBNIOBA EQU   IOBORG01                                                 02682000
IOBNFLG1 EQU   IOBNIOBA                                                 02683000
IOBPRTOV EQU   IOBNFLG1                                                 02684000
IOBORG02 EQU   IOBPREFX+8                                               02685000
IOBDQADA EQU   IOBORG02                                                 02686000
IOBDEQIN EQU   IOBDQADA                                                 02687000
IOBORG03 EQU   IOBPREFX+12                                              02688000
IOBORG04 EQU   IOBINCAM                                                 02689000
IOBORG12 EQU   IOBINCAM                                                 02690000
IOBFL4   EQU   IOBORG12                                                 02691000
IOBEXTEN EQU   IOBSTDRD+32                                              02692000
IOBSEEK  EQU   IOBEXTEN                                                 02693000
IOBBB    EQU   IOBSEEK+1                                                02694000
IOBCC    EQU   IOBSEEK+3                                                02695000
IOBHH    EQU   IOBSEEK+5                                                02696000
IOBORG05 EQU   IOBEXTEN                                                 02697000
IOBORG06 EQU   IOBEXTEN                                                 02698000
IOBNXTPT EQU   IOBORG06+4                                               02699000
IOBSTATA EQU   IOBNXTPT                                                 02700000
IOBORG07 EQU   IOBEXTEN+8                                               02701000
W1IEXTEN EQU   IOBORG07                                                 02702000
IOBORG08 EQU   IOBEXTEN+8                                               02703000
IOBINDCT EQU   IOBORG08+4                                               02704000
IOBUNSQR EQU   IOBORG08+5                                               02705000
IOBFCHAD EQU   IOBORG08+8                                               02706000
IOBORG09 EQU   IOBEXTEN+8                                               02707000
IOBDPLAD EQU   IOBORG09+4                                               02708000
IOBDAYLI EQU   IOBDPLAD                                                 02709000
IOBDTYPE EQU   IOBORG09+8                                               02710000
IOBDTYP2 EQU   IOBORG09+9                                               02711000
IOBADDTY EQU   IOBDTYP2                                                 02712000
IOBDSTAT EQU   IOBORG09+10                                              02713000
IOBSTAT1 EQU   IOBDSTAT                                                 02714000
IOBENQUE EQU   IOBSTAT1                                                 02715000
IOBADDVU EQU   IOBSTAT1                                                 02716000
IOBSTAT2 EQU   IOBDSTAT+1                                               02717000
IOBDQPTR EQU   IOBORG09+20                                              02718000
IOBORG10 EQU   IOBEXTEN+8                                               02719000
IOBSEEK2 EQU   IOBORG10                                                 02720000
IOBORG11 EQU   IOBEXTEN                                                 02721000
IOBERCT  EQU   IOBORG11                                                 02722000
IOBUCBXV EQU   IOBERCT                                                  02723000
IOBNAME  EQU   IOBORG11+4                                               02724000
IOBORG13 EQU   IOBEXTEN                                                 02725000
IOBSKADR EQU   IOBORG13                                                 02726000
PSARSVTE EQU   PSARSVT                                                  02727000
RBSECS03 EQU   RBEP                                                     02728000
RBCDE    EQU   RBSECS03                                                 02729000
RBCDFLGS EQU   RBCDE                                                    02730000
RBSECS05 EQU   RBPGMQ                                                   02731000
RBSQE    EQU   RBSECS05                                                 02732000
RBSECS06 EQU   RBPGMQ                                                   02733000
RBIQE    EQU   RBSECS06                                                 02734000
RBSECS07 EQU   RBPGMQ                                                   02735000
RBIQE2   EQU   RBSECS07                                                 02736000
RBSECS08 EQU   IRBEND                                                   02737000
RBSECS09 EQU   IRBEND                                                   02738000
TIOEDEVE EQU   TIOESTTB                                                 02739000
TIOSTTB  EQU   TIOEDEVE                                                 02740000
WKAREAX  EQU   RBEXSAVE                                                 02741000
WKASW1   EQU   WKAREAX                                                  02742000
WKALOCK  EQU   WKASW1                                                   02743000
WKADMP0C EQU   WKASW1                                                   02744000
WKADMP08 EQU   WKASW1                                                   02745000
WKADMP04 EQU   WKASW1                                                   02746000
WKAENQRQ EQU   WKASW1                                                   02747000
WKADEQRQ EQU   WKASW1                                                   02748000
WKATRALX EQU   WKAREAX+1                                                02749000
WKASVKEY EQU   WKAREAX+2                                                02750000
WKACLENX EQU   WKAREAX+3                                                02751000
WKASAV14 EQU   WKAREAX+4                                                02752000
WKAIOBQX EQU   WKAREAX+8                                                02753000
WKANQARG EQU   WKAREAX+12                                               02754000
WKARLCOR EQU   WKAREAX+20                                               02755000
WKAXADDR EQU   WKAREAX+24                                               02756000
WKALST   EQU   WKAREAX+28                                               02757000
WKASVDEB EQU   WKALST                                                   02758000
WKADEBXC EQU   WKASVDEB                                                 02759000
WKANQLST EQU   WKALST+8                                                 02760000
WKATRACX EQU   WKANQLST                                                 02761000
SDWAWORK EQU   SDWAVRA                                                  02762000
MESSAGE  EQU   SDWAWORK                                                 02763000
RETCOD   EQU   MESSAGE+16                                               02764000
RETCOD2  EQU   MESSAGE+19                                               02765000
MSGJOB   EQU   MESSAGE+22                                               02766000
MSGSTEP  EQU   MESSAGE+31                                               02767000
MSGDDN   EQU   MESSAGE+40                                               02768000
SAVESDWA EQU   SDWAWORK+52                                              02769000
HEAD     EQU   MESSAGE                                                  02770000
HEADER   EQU   HEAD                                                     02771000
JOBNAME  EQU   HEADER+10                                                02772000
STEPNAME EQU   HEADER+19                                                02773000
SDUMPLST EQU   HEAD+27                                                  02774000
RECORDWK EQU   MESSAGE                                                  02775000
RECAUDIT EQU   RECORDWK                                                 02776000
RECRCDP  EQU   RECORDWK+1                                               02777000
RECRCLN  EQU   RECORDWK+2                                               02778000
RECREG0  EQU   RECORDWK+4                                               02779000
RECREG1  EQU   RECORDWK+8                                               02780000
RECOPSW  EQU   RECORDWK+12                                              02781000
RECPERC  EQU   RECORDWK+20                                              02782000
FLC      EQU   PSA                                                      02783000
TRCLIST  EQU   WKATRACX                                                 02784000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    02785000
@NM00167 EQU   RECORDWK+3                                               02786000
@NM00165 EQU   HEADER+18                                                02787000
@NM00164 EQU   HEADER+9                                                 02788000
MODNAME  EQU   HEADER+1                                                 02789000
HEADLEN  EQU   HEADER                                                   02790000
@NM00163 EQU   MESSAGE+48                                               02791000
@NM00162 EQU   MESSAGE+39                                               02792000
@NM00161 EQU   MESSAGE+30                                               02793000
@NM00160 EQU   MESSAGE+21                                               02794000
@NM00159 EQU   MESSAGE+18                                               02795000
RCODE    EQU   RETCOD+1                                                 02796000
GTFLAG   EQU   RETCOD                                                   02797000
@NM00158 EQU   MESSAGE+15                                               02798000
ABND     EQU   MESSAGE+12                                               02799000
@NM00157 EQU   MESSAGE+11                                               02800000
MSGNO    EQU   MESSAGE+4                                                02801000
@NM00156 EQU   MESSAGE                                                  02802000
@NM00155 EQU   WKANQLST+8                                               02803000
WKAQPREF EQU   WKALST+4                                                 02804000
@NM00154 EQU   WKASVDEB+1                                               02805000
WKATRXLG EQU   WKACLENX                                                 02806000
@NM00153 EQU   WKASW1                                                   02807000
WKAD2305 EQU   WKASW1                                                   02808000
TIOUCBP  EQU   TIOEDEVE+1                                               02809000
TIOVERF  EQU   TIOSTTB                                                  02810000
TIOUNLD  EQU   TIOSTTB                                                  02811000
TIOMNTD  EQU   TIOSTTB                                                  02812000
TIOSETU  EQU   TIOSTTB                                                  02813000
TIOVLSR  EQU   TIOSTTB                                                  02814000
TIOPVIO  EQU   TIOSTTB                                                  02815000
TIOREQD  EQU   TIOSTTB                                                  02816000
TIOUSED  EQU   TIOSTTB                                                  02817000
RBRSV161 EQU   RBSECS09+64                                              02818000
RBSIRBWA EQU   RBSECS09                                                 02819000
RBIQEWRK EQU   RBSECS08+4                                               02820000
RBNEXAV  EQU   RBSECS08                                                 02821000
RBIQEA   EQU   RBIQE2                                                   02822000
RBIQE1   EQU   RBIQE+1                                                  02823000
RBUSE    EQU   RBIQE                                                    02824000
RBSQEA   EQU   RBSQE+1                                                  02825000
@NM00098 EQU   RBSQE                                                    02826000
RBCDE1   EQU   RBCDE+1                                                  02827000
RBCDLOAD EQU   RBCDFLGS                                                 02828000
RBCDXCTL EQU   RBCDFLGS                                                 02829000
RBCDSYNC EQU   RBCDFLGS                                                 02830000
RBCDNODE EQU   RBCDFLGS                                                 02831000
RBCDSAVE EQU   RBCDFLGS                                                 02832000
RBCDATCH EQU   RBCDFLGS                                                 02833000
RBRSV009 EQU   RBCDFLGS                                                 02834000
RBNOCELL EQU   RBCDFLGS                                                 02835000
PSARSAV  EQU   PSARSVTE+60                                              02836000
PSARSTK  EQU   PSARSVTE+56                                              02837000
PSAESAV3 EQU   PSARSVTE+52                                              02838000
PSAESTK3 EQU   PSARSVTE+48                                              02839000
PSAESAV2 EQU   PSARSVTE+44                                              02840000
PSAESTK2 EQU   PSARSVTE+40                                              02841000
PSAESAV1 EQU   PSARSVTE+36                                              02842000
PSAESTK1 EQU   PSARSVTE+32                                              02843000
PSAPSAV  EQU   PSARSVTE+28                                              02844000
PSAPSTK  EQU   PSARSVTE+24                                              02845000
PSAMSAV  EQU   PSARSVTE+20                                              02846000
PSAMSTK  EQU   PSARSVTE+16                                              02847000
PSASSAV  EQU   PSARSVTE+12                                              02848000
PSASSTK  EQU   PSARSVTE+8                                               02849000
PSANSTK  EQU   PSARSVTE+4                                               02850000
PSACSTK  EQU   PSARSVTE                                                 02851000
IOBSKSS  EQU   IOBSKADR+3                                               02852000
IOBSK0   EQU   IOBSKADR+2                                               02853000
IOBSKTT  EQU   IOBSKADR+1                                               02854000
IOBSKRV  EQU   IOBSKADR                                                 02855000
IOBCSWSV EQU   IOBORG11+17                                              02856000
IOBSENSV EQU   IOBORG11+16                                              02857000
IOBRCD   EQU   IOBORG11+12                                              02858000
IOBMDREC EQU   IOBORG11+8                                               02859000
IOBNAMEA EQU   IOBNAME+1                                                02860000
IOBNAMSZ EQU   IOBNAME                                                  02861000
IOBERCTA EQU   IOBERCT+1                                                02862000
IOBRTYPE EQU   IOBUCBXV                                                 02863000
IOBRDCHP EQU   IOBORG10+20                                              02864000
IOBNEXTA EQU   IOBORG10+16                                              02865000
IOBREADA EQU   IOBORG10+12                                              02866000
IOBBUFC  EQU   IOBORG10+8                                               02867000
IOBSK2R  EQU   IOBSEEK2+7                                               02868000
IOBSK2HH EQU   IOBSEEK2+5                                               02869000
IOBSK2CC EQU   IOBSEEK2+3                                               02870000
IOBSK2BB EQU   IOBSEEK2+1                                               02871000
IOBSK2M  EQU   IOBSEEK2                                                 02872000
IOBCHNPR EQU   IOBORG09+40                                              02873000
IOBDNCRF EQU   IOBORG09+32                                              02874000
IOBRSV35 EQU   IOBORG09+24                                              02875000
IOBRSV34 EQU   IOBORG09+18                                              02876000
IOBDBYTN EQU   IOBORG09+16                                              02877000
IOBDCPND EQU   IOBORG09+12                                              02878000
IOBSIORT EQU   IOBSTAT1                                                 02879000
IOBBUFF  EQU   IOBSTAT1                                                 02880000
IOBPASS2 EQU   IOBSTAT1                                                 02881000
IOBSYNCH EQU   IOBSTAT1                                                 02882000
IOBNEWVL EQU   IOBSTAT1                                                 02883000
IOBABNRM EQU   IOBSTAT1                                                 02884000
IOBRELEX EQU   IOBDTYP2                                                 02885000
IOBTYPE  EQU   IOBDTYP2                                                 02886000
IOBRQUST EQU   IOBDTYP2                                                 02887000
IOBSUFFX EQU   IOBDTYP2                                                 02888000
IOBSBLKL EQU   IOBDTYP2                                                 02889000
IOBSKEY  EQU   IOBDTYP2                                                 02890000
IOBRELBL EQU   IOBDTYPE                                                 02891000
IOBRDEXC EQU   IOBDTYPE                                                 02892000
IOBDYNBF EQU   IOBDTYPE                                                 02893000
IOBACTAD EQU   IOBDTYPE                                                 02894000
IOBFDBCK EQU   IOBDTYPE                                                 02895000
IOBEXTSC EQU   IOBDTYPE                                                 02896000
IOBOVFLO EQU   IOBDTYPE                                                 02897000
IOBVERFY EQU   IOBDTYPE                                                 02898000
IOBDPLB  EQU   IOBDPLAD+1                                               02899000
IOBDIOBS EQU   IOBORG09+2                                               02900000
IOBDBYTR EQU   IOBORG09                                                 02901000
IOBBCHAD EQU   IOBORG08+12                                              02902000
IOBFCHNB EQU   IOBFCHAD+1                                               02903000
IOBCOUNT EQU   IOBFCHAD                                                 02904000
IOBASYN  EQU   IOBORG08+7                                               02905000
IOBAPP   EQU   IOBORG08+6                                               02906000
IOBRSV32 EQU   IOBUNSQR                                                 02907000
IOBRSV31 EQU   IOBUNSQR                                                 02908000
IOBRSV30 EQU   IOBUNSQR                                                 02909000
IOBKNRWR EQU   IOBUNSQR                                                 02910000
IOBKNWR  EQU   IOBUNSQR                                                 02911000
IOBNTAV2 EQU   IOBUNSQR                                                 02912000
IOBNTAV1 EQU   IOBUNSQR                                                 02913000
IOBCPBSY EQU   IOBUNSQR                                                 02914000
IOBCHNNL EQU   IOBINDCT                                                 02915000
IOBRSV29 EQU   IOBINDCT                                                 02916000
IOBRSV28 EQU   IOBINDCT                                                 02917000
IOBRSV27 EQU   IOBINDCT                                                 02918000
IOBKEYAD EQU   IOBINDCT                                                 02919000
IOBOVPTR EQU   IOBINDCT                                                 02920000
IOBUNSCH EQU   IOBINDCT                                                 02921000
IOBDEQCP EQU   IOBINDCT                                                 02922000
IOBCCWAD EQU   IOBORG08                                                 02923000
W1OEXTEN EQU   W1IEXTEN                                                 02924000
IOBCCW   EQU   IOBORG06+8                                               02925000
IOBNXTPB EQU   IOBNXTPT+1                                               02926000
IOBRSV26 EQU   IOBSTATA                                                 02927000
IOBRSV25 EQU   IOBSTATA                                                 02928000
IOBRSV24 EQU   IOBSTATA                                                 02929000
IOBRSV23 EQU   IOBSTATA                                                 02930000
IOBRSV22 EQU   IOBSTATA                                                 02931000
IOBRSV21 EQU   IOBSTATA                                                 02932000
IOBRSV20 EQU   IOBSTATA                                                 02933000
IOBAVLFL EQU   IOBSTATA                                                 02934000
IOBRSV37 EQU   IOBORG06+1                                               02935000
IOBUCBXG EQU   IOBORG06                                                 02936000
IOBCPA   EQU   IOBORG05+32                                              02937000
IOBERINF EQU   IOBORG05+16                                              02938000
IOBERCCW EQU   IOBORG05+8                                               02939000
IOBSNDPT EQU   IOBORG05+7                                               02940000
IOBRCVPT EQU   IOBORG05+6                                               02941000
IOBWORK  EQU   IOBORG05+1                                               02942000
IOBUCBX  EQU   IOBORG05                                                 02943000
IOBR     EQU   IOBSEEK+7                                                02944000
IOBHH2   EQU   IOBHH+1                                                  02945000
IOBHH1   EQU   IOBHH                                                    02946000
IOBCC2   EQU   IOBCC+1                                                  02947000
IOBCC1   EQU   IOBCC                                                    02948000
IOBBB2   EQU   IOBBB+1                                                  02949000
IOBBB1   EQU   IOBBB                                                    02950000
IOBM     EQU   IOBSEEK                                                  02951000
IOBRSV46 EQU   IOBFL4                                                   02952000
IOBRSV47 EQU   IOBFL4                                                   02953000
IOBENT   EQU   IOBFL4                                                   02954000
IOBEQP   EQU   IOBFL4                                                   02955000
IOBBUS   EQU   IOBFL4                                                   02956000
IOBDCK   EQU   IOBFL4                                                   02957000
IOBREJ   EQU   IOBFL4                                                   02958000
IOBOVR   EQU   IOBFL4                                                   02959000
IOBCRILC EQU   IOBORG04+1                                               02960000
IOBCRDCC EQU   IOBORG04                                                 02961000
IOBGQECB EQU   IOBORG03                                                 02962000
IOBSWAP  EQU   IOBORG02+4                                               02963000
IOBDQADB EQU   IOBDQADA+1                                               02964000
IOBRSV13 EQU   IOBDEQIN                                                 02965000
IOBRSV12 EQU   IOBDEQIN                                                 02966000
IOBRSV11 EQU   IOBDEQIN                                                 02967000
IOBRSV10 EQU   IOBDEQIN                                                 02968000
IOBRSV09 EQU   IOBDEQIN                                                 02969000
IOBRSV08 EQU   IOBDEQIN                                                 02970000
IOBRSV07 EQU   IOBDEQIN                                                 02971000
IOBDEQ   EQU   IOBDEQIN                                                 02972000
IOBNECB  EQU   IOBORG01+4                                               02973000
IOBNIOBB EQU   IOBNIOBA+1                                               02974000
IOBFIRST EQU   IOBNFLG1                                                 02975000
IOBUPERR EQU   IOBNFLG1                                                 02976000
IOBSPAN  EQU   IOBNFLG1                                                 02977000
IOBBKSPC EQU   IOBNFLG1                                                 02978000
IOBUPDAT EQU   IOBNFLG1                                                 02979000
IOBREAD  EQU   IOBNFLG1                                                 02980000
IOBWRITE EQU   IOBNFLG1                                                 02981000
IOBSEGMT EQU   IOBPRTOV                                                 02982000
DECBLFMT EQU   DECBS05+8                                                02983000
DECBLNNM EQU   DECBS05+4                                                02984000
DECBHDRA EQU   DECBS05                                                  02985000
DEBEXPTA EQU   DEBEXPT+1                                                02986000
DEBRSV12 EQU   DEBRPSID                                                 02987000
DEBRSV11 EQU   DEBRPSID                                                 02988000
DEBRSV10 EQU   DEBRPSID                                                 02989000
DEBRSV09 EQU   DEBRPSID                                                 02990000
DEBRPSAP EQU   DEBRPSID                                                 02991000
DEBRPSO  EQU   DEBRPSID                                                 02992000
DEBRPSI  EQU   DEBRPSID                                                 02993000
DEBRPSP  EQU   DEBRPSID                                                 02994000
DEBFOEB  EQU   DEBFOEAD+1                                               02995000
DEBNOEE  EQU   DEBFOEAD                                                 02996000
DEBFPEB  EQU   DEBFPEAD+1                                               02997000
DEBNPEE  EQU   DEBFPEAD                                                 02998000
DEBFIEB  EQU   DEBFIEAD+1                                               02999000
DEBNIEE  EQU   DEBFIEAD                                                 03000000
DEBBOESS EQU   DEBEODSS                                                 03001000
DEBBOE0  EQU   DEBEOD0                                                  03002000
DEBBOETT EQU   DEBEODTT                                                 03003000
DEBBOERV EQU   DEBEODRV                                                 03004000
DEBRV008 EQU   DEBDSID+7                                                03005000
DEBWTPTI EQU   DEBDSID+6                                                03006000
DEBEXDTE EQU   DEBDSID                                                  03007000
DEBRV007 EQU   DEBEAMFG                                                 03008000
DEBRV006 EQU   DEBEAMFG                                                 03009000
DEBRV005 EQU   DEBEAMFG                                                 03010000
DEBRV004 EQU   DEBEAMFG                                                 03011000
DEBSECVL EQU   DEBEAMFG                                                 03012000
DEBVAMSG EQU   DEBEAMFG                                                 03013000
DEBDSOPN EQU   DEBEAMFG                                                 03014000
DEBMULTI EQU   DEBEAMFG                                                 03015000
DEBVSEQU EQU   DEBASC09+2                                               03016000
DEBDSSQL EQU   DEBASC09+1                                               03017000
DEBVOLAC EQU   DEBASC09                                                 03018000
DEBWDCBA EQU   DEBWDCB+1                                                03019000
DEBRSV08 EQU   DEBWDCB                                                  03020000
DEBPDCBA EQU   DEBPDCB+1                                                03021000
DEBRSV07 EQU   DEBPDCB                                                  03022000
DEBRDCBA EQU   DEBRDCB+1                                                03023000
DEBRSV06 EQU   DEBRDCB                                                  03024000
DEBSUCBB EQU   DEBSUCBA+1                                               03025000
DEBSDVM  EQU   DEBSUCBA                                                 03026000
CVTRV628 EQU   CVTS01+728                                               03027000
CVTRV627 EQU   CVTS01+724                                               03028000
CVTRV626 EQU   CVTS01+720                                               03029000
CVTRV625 EQU   CVTS01+716                                               03030000
CVTRV624 EQU   CVTS01+712                                               03031000
CVTRV623 EQU   CVTS01+708                                               03032000
CVTRV622 EQU   CVTS01+704                                               03033000
CVTRV621 EQU   CVTS01+700                                               03034000
CVTIHASU EQU   CVTS01+696                                               03035000
CVTRV619 EQU   CVTS01+692                                               03036000
CVTRV618 EQU   CVTS01+688                                               03037000
CVTRV617 EQU   CVTS01+684                                               03038000
CVTRV616 EQU   CVTS01+680                                               03039000
CVTRV615 EQU   CVTS01+676                                               03040000
CVTRV614 EQU   CVTS01+672                                               03041000
CVTRV613 EQU   CVTS01+668                                               03042000
CVTTCASP EQU   CVTS01+664                                               03043000
CVT0PT03 EQU   CVTS01+660                                               03044000
CVT0PT0E EQU   CVTS01+656                                               03045000
CVTRV609 EQU   CVTS01+652                                               03046000
CVTCGK   EQU   CVTS01+648                                               03047000
CVTRAC   EQU   CVTS01+644                                               03048000
CVTHSM   EQU   CVTS01+640                                               03049000
CVTRV605 EQU   CVTS01+636                                               03050000
CVTRV604 EQU   CVTS01+632                                               03051000
CVTEFF02 EQU   CVTS01+628                                               03052000
CVTCBBR  EQU   CVTS01+624                                               03053000
CVTSSCR  EQU   CVTS01+620                                               03054000
CVTEVENT EQU   CVTS01+616                                               03055000
CVTCRCA  EQU   CVTS01+612                                               03056000
CVTTPIO  EQU   CVTS01+608                                               03057000
CVTADV   EQU   CVTS01+604                                               03058000
CVTGSDAB EQU   CVTGSDA                                                  03059000
CVTQV3   EQU   CVTS01+596                                               03060000
CVTQV2   EQU   CVTS01+592                                               03061000
CVTQV1   EQU   CVTS01+588                                               03062000
CVTRPT   EQU   CVTS01+584                                               03063000
CVTSSRB  EQU   CVTS01+580                                               03064000
CVTCSDRL EQU   CVTS01+576                                               03065000
CVTEXP1  EQU   CVTS01+572                                               03066000
CVTRMPMT EQU   CVTS01+568                                               03067000
CVTRMPTT EQU   CVTS01+564                                               03068000
CVTVPSA  EQU   CVTS01+560                                               03069000
CVTVSTOP EQU   CVTS01+556                                               03070000
CVTGTFR8 EQU   CVTS01+552                                               03071000
CVTQUIT  EQU   CVTS01+548                                               03072000
CVTVACR  EQU   CVTS01+544                                               03073000
CVTWTCB  EQU   CVTS01+540                                               03074000
CVTSTPRS EQU   CVTS01+536                                               03075000
CVT0PT02 EQU   CVTS01+532                                               03076000
CVTDARCM EQU   CVTS01+528                                               03077000
CVTIRECM EQU   CVTS01+524                                               03078000
CVTJRECM EQU   CVTS01+520                                               03079000
CVTVEMS0 EQU   CVTS01+516                                               03080000
CVTSPFRR EQU   CVTS01+512                                               03081000
CVTRLSTG EQU   CVTS01+508                                               03082000
CVT0TC0A EQU   CVTS01+504                                               03083000
CVTGMBR  EQU   CVTS01+500                                               03084000
CVTLFRM  EQU   CVTS01+496                                               03085000
CVTRMBR  EQU   CVTS01+492                                               03086000
CVTVIOP  EQU   CVTS01+488                                               03087000
CVTRV307 EQU   CVTS01+486                                               03088000
CVTRV306 EQU   CVTS01+484                                               03089000
CVTRV305 EQU   CVTS01+482                                               03090000
CVTRV304 EQU   CVTS01+480                                               03091000
CVTRV303 EQU   CVTS01+478                                               03092000
CVTRV302 EQU   CVTS01+476                                               03093000
CVTTRCA  EQU   CVTS01+472                                               03094000
CVTRV297 EQU   CVTRV289                                                 03095000
CVTRV296 EQU   CVTRV289                                                 03096000
CVTRV295 EQU   CVTRV289                                                 03097000
CVTRV294 EQU   CVTRV289                                                 03098000
CVTRV293 EQU   CVTRV289                                                 03099000
CVTRV292 EQU   CVTRV289                                                 03100000
CVTRV291 EQU   CVTRV289                                                 03101000
CVTRV290 EQU   CVTRV289                                                 03102000
CVTRV288 EQU   CVTRV280                                                 03103000
CVTRV287 EQU   CVTRV280                                                 03104000
CVTRV286 EQU   CVTRV280                                                 03105000
CVTRV285 EQU   CVTRV280                                                 03106000
CVTRV284 EQU   CVTRV280                                                 03107000
CVTRV283 EQU   CVTRV280                                                 03108000
CVTRV282 EQU   CVTRV280                                                 03109000
CVTRV281 EQU   CVTRV280                                                 03110000
CVTRV279 EQU   CVTRV271                                                 03111000
CVTRV278 EQU   CVTRV271                                                 03112000
CVTRV277 EQU   CVTRV271                                                 03113000
CVTRV276 EQU   CVTRV271                                                 03114000
CVTRV275 EQU   CVTRV271                                                 03115000
CVTRV274 EQU   CVTRV271                                                 03116000
CVTRV273 EQU   CVTRV271                                                 03117000
CVTRV272 EQU   CVTRV271                                                 03118000
CVTRV270 EQU   CVTRV262                                                 03119000
CVTRV269 EQU   CVTRV262                                                 03120000
CVTRV268 EQU   CVTRV262                                                 03121000
CVTRV267 EQU   CVTRV262                                                 03122000
CVTRV266 EQU   CVTRV262                                                 03123000
CVTRV265 EQU   CVTRV262                                                 03124000
CVTRV264 EQU   CVTRV262                                                 03125000
CVTRV263 EQU   CVTRV262                                                 03126000
CVTVFP   EQU   CVTS01+464                                               03127000
CVTVSI   EQU   CVTS01+460                                               03128000
CVTVPSIB EQU   CVTS01+456                                               03129000
CVTMFACT EQU   CVTMFRTR                                                 03130000
CVTMFCTL EQU   CVTS01+448                                               03131000
CVTPVBP  EQU   CVTS01+444                                               03132000
CVTPWI   EQU   CVTS01+440                                               03133000
CVTRV254 EQU   CVTS01+438                                               03134000
CVTRV253 EQU   CVTS01+436                                               03135000
CVTRV252 EQU   CVTS01+434                                               03136000
CVTRV251 EQU   CVTS01+433                                               03137000
CVTRV250 EQU   CVTS01+432                                               03138000
CVTRV249 EQU   CVTS01+431                                               03139000
CVTRV248 EQU   CVTS01+430                                               03140000
CVTRV247 EQU   CVTS01+429                                               03141000
CVTRV246 EQU   CVTS01+428                                               03142000
CVTRV245 EQU   CVTRV237                                                 03143000
CVTRV244 EQU   CVTRV237                                                 03144000
CVTRV243 EQU   CVTRV237                                                 03145000
CVTRV242 EQU   CVTRV237                                                 03146000
CVTRV241 EQU   CVTRV237                                                 03147000
CVTRV240 EQU   CVTRV237                                                 03148000
CVTRV239 EQU   CVTRV237                                                 03149000
CVTRV238 EQU   CVTRV237                                                 03150000
CVTRV236 EQU   CVTRV228                                                 03151000
CVTRV235 EQU   CVTRV228                                                 03152000
CVTRV234 EQU   CVTRV228                                                 03153000
CVTRV233 EQU   CVTRV228                                                 03154000
CVTRV232 EQU   CVTRV228                                                 03155000
CVTRV231 EQU   CVTRV228                                                 03156000
CVTRV230 EQU   CVTRV228                                                 03157000
CVTRV229 EQU   CVTRV228                                                 03158000
CVTRV227 EQU   CVTRV219                                                 03159000
CVTRV226 EQU   CVTRV219                                                 03160000
CVTRV225 EQU   CVTRV219                                                 03161000
CVTRV224 EQU   CVTRV219                                                 03162000
CVTRV223 EQU   CVTRV219                                                 03163000
CVTRV222 EQU   CVTRV219                                                 03164000
CVTRV221 EQU   CVTRV219                                                 03165000
CVTRV220 EQU   CVTRV219                                                 03166000
CVTRV218 EQU   CVTRV210                                                 03167000
CVTRV217 EQU   CVTRV210                                                 03168000
CVTRV216 EQU   CVTRV210                                                 03169000
CVTRV215 EQU   CVTRV210                                                 03170000
CVTRV214 EQU   CVTRV210                                                 03171000
CVTRV213 EQU   CVTRV210                                                 03172000
CVTRV212 EQU   CVTRV210                                                 03173000
CVTRV211 EQU   CVTRV210                                                 03174000
CVTLCCAT EQU   CVTS01+420                                               03175000
CVTPCCAT EQU   CVTS01+416                                               03176000
CVTIPCRP EQU   CVTS01+412                                               03177000
CVTIPCRI EQU   CVTS01+408                                               03178000
CVTIPCDS EQU   CVTS01+404                                               03179000
CVTAIDVT EQU   CVTS01+400                                               03180000
CVTSSAP  EQU   CVTS01+396                                               03181000
CVTEHCIR EQU   CVTS01+392                                               03182000
CVTEHDEF EQU   CVTS01+388                                               03183000
CVTDAIR  EQU   CVTS01+384                                               03184000
CVTPERFM EQU   CVTS01+380                                               03185000
CVT044R2 EQU   CVTS01+376                                               03186000
CVTFETCH EQU   CVTS01+372                                               03187000
CVTRSTWD EQU   CVTS01+368                                               03188000
CVTSPOST EQU   CVTS01+364                                               03189000
CVTIOBP  EQU   CVTS01+360                                               03190000
CVTASMVT EQU   CVTS01+356                                               03191000
CVTRECRQ EQU   CVTS01+352                                               03192000
CVTWSAC  EQU   CVTS01+348                                               03193000
CVTRV149 EQU   CVTS01+344                                               03194000
CVTWSAL  EQU   CVTS01+340                                               03195000
CVTSPSA  EQU   CVTS01+336                                               03196000
CVTGLMN  EQU   CVTS01+332                                               03197000
CVTVEAC0 EQU   CVTS01+328                                               03198000
CVT062R1 EQU   CVTS01+324                                               03199000
CVTRPOST EQU   CVTS01+320                                               03200000
CVTDQIQE EQU   CVTS01+316                                               03201000
CVTCSD   EQU   CVTS01+312                                               03202000
CVTLKRMA EQU   CVTS01+308                                               03203000
CVTRSPIE EQU   CVTS01+304                                               03204000
CVTRENQ  EQU   CVTS01+300                                               03205000
CVTLQCB  EQU   CVTS01+296                                               03206000
CVTFQCB  EQU   CVTS01+292                                               03207000
CVTQCS01 EQU   CVTS01+288                                               03208000
CVTAPFT  EQU   CVTS01+284                                               03209000
CVTPARRL EQU   CVTS01+280                                               03210000
CVTVWAIT EQU   CVTS01+276                                               03211000
CVTGSPL  EQU   CVTS01+272                                               03212000
CVTLSMQ  EQU   CVTS01+268                                               03213000
CVTGSMQ  EQU   CVTS01+264                                               03214000
CVTEXPRO EQU   CVTS01+260                                               03215000
CVTOPCTP EQU   CVTS01+256                                               03216000
CVTSIC   EQU   CVTS01+252                                               03217000
CVTTPIOS EQU   CVTS01+248                                               03218000
CVTRTMS  EQU   CVTS01+244                                               03219000
CVTSDBF  EQU   CVTS01+240                                               03220000
CVTSCBP  EQU   CVTS01+236                                               03221000
CVTSDMP  EQU   CVTS01+232                                               03222000
CVTSV60  EQU   CVTS01+228                                               03223000
CVTRTMCT EQU   CVTS01+224                                               03224000
CVTASCBL EQU   CVTS01+220                                               03225000
CVTASCBH EQU   CVTS01+216                                               03226000
CVTGDA   EQU   CVTS01+212                                               03227000
CVTASVT  EQU   CVTS01+208                                               03228000
CVTVVMDI EQU   CVTS01+204                                               03229000
CVTAQTOP EQU   CVTS01+200                                               03230000
CVTIOSCS EQU   CVTS01+196                                               03231000
CVTSDRM  EQU   CVTS01+192                                               03232000
CVTOPTE  EQU   CVTS01+188                                               03233000
CVTSTXU  EQU   CVTS01+184                                               03234000
CVTQUIS  EQU   CVTS01+180                                               03235000
CVTPARS  EQU   CVTS01+176                                               03236000
CVTS1EE  EQU   CVTS01+172                                               03237000
CVTFRAS  EQU   CVTS01+168                                               03238000
CVTQSAS  EQU   CVTS01+164                                               03239000
CVTCRAS  EQU   CVTS01+160                                               03240000
CVTCRMN  EQU   CVTS01+156                                               03241000
CVTDELCP EQU   CVTS01+152                                               03242000
CVTFRECL EQU   CVTS01+148                                               03243000
CVTGETCL EQU   CVTS01+144                                               03244000
CVTBLDCP EQU   CVTS01+140                                               03245000
CVTAUTHL EQU   CVTS01+136                                               03246000
CVTSCAN  EQU   CVTS01+132                                               03247000
CVTRV144 EQU   CVTS01+130                                               03248000
CVTMAXMP EQU   CVTS01+128                                               03249000
CVTSTCK  EQU   CVTS01+124                                               03250000
CVTRV139 EQU   CVTS01+123                                               03251000
CVTDSSAC EQU   CVTS01+122                                               03252000
CVTRV513 EQU   CVTS01+121                                               03253000
CVTIOSPL EQU   CVTS01+120                                               03254000
CVTPTGT  EQU   CVTS01+116                                               03255000
CVTCSPIE EQU   CVTS01+112                                               03256000
CVTSMFEX EQU   CVTS01+108                                               03257000
CVTOLT0A EQU   CVTS01+104                                               03258000
CVTSRBRT EQU   CVTS01+100                                               03259000
CVTPUTL  EQU   CVTS01+96                                                03260000
CVTASCRL EQU   CVTS01+92                                                03261000
CVTASCRF EQU   CVTS01+88                                                03262000
CVTRV326 EQU   CVTS01+84                                                03263000
CVTRV325 EQU   CVTS01+80                                                03264000
CVTRV324 EQU   CVTS01+76                                                03265000
CVT0VL01 EQU   CVTS01+72                                                03266000
CVTSHRVM EQU   CVTS01+68                                                03267000
CVTRV332 EQU   CVTS01+64                                                03268000
CVTTAS   EQU   CVTS01+60                                                03269000
CVTRSCN  EQU   CVTS01+56                                                03270000
CVTTRAC2 EQU   CVTS01+54                                                03271000
CVTTRACE EQU   CVTS01+52                                                03272000
CVTAPG   EQU   CVTS01+51                                                03273000
CVTSDTRC EQU   CVTCTLFG                                                 03274000
CVTGTRCE EQU   CVTCTLFG                                                 03275000
CVTNOMP  EQU   CVTCTLFG                                                 03276000
CVTRSV79 EQU   CVTCTLFG                                                 03277000
CVTDSTAT EQU   CVTCTLFG                                                 03278000
CVTRSV78 EQU   CVTCTLFG                                                 03279000
CVTRV333 EQU   CVTCTLFG                                                 03280000
CVTRV323 EQU   CVTCTLFG                                                 03281000
CVTSPVLK EQU   CVTS01+49                                                03282000
CVTRSV77 EQU   CVTS01+48                                                03283000
CVTRV331 EQU   CVTS01+44                                                03284000
CVTRV330 EQU   CVTS01+40                                                03285000
CVTRV329 EQU   CVTS01+36                                                03286000
CVTRV328 EQU   CVTS01+32                                                03287000
CVTRV322 EQU   CVTS01+28                                                03288000
CVTSLID  EQU   CVTSLIDA+1                                               03289000
CVTSYLK  EQU   CVTSLIDA                                                 03290000
CVTRV321 EQU   CVTS01+20                                                03291000
CVTRV320 EQU   CVTS01+16                                                03292000
CVTLPDIR EQU   CVTLPDIA+1                                               03293000
CVTRSV69 EQU   CVTDIRST                                                 03294000
CVTRSV68 EQU   CVTDIRST                                                 03295000
CVTRSV67 EQU   CVTDIRST                                                 03296000
CVTRSV66 EQU   CVTDIRST                                                 03297000
CVTRSV65 EQU   CVTDIRST                                                 03298000
CVTRSV64 EQU   CVTDIRST                                                 03299000
CVTRSV63 EQU   CVTDIRST                                                 03300000
CVTDICOM EQU   CVTDIRST                                                 03301000
CVTPVTP  EQU   CVTS01+8                                                 03302000
CVTLPDSR EQU   CVTS01+4                                                 03303000
CVTGETL  EQU   CVTS01                                                   03304000
TIOTFEND EQU   POOLSTAR+16                                              03305000
TIOPSLOT EQU   POOLSTAR+13                                              03306000
TIOPSTTB EQU   POOLSTAR+12                                              03307000
TIOPPOOL EQU   POOLSTAR+4                                               03308000
TIOPNSRT EQU   POOLSTAR+3                                               03309000
@NM00152 EQU   POOLSTAR+2                                               03310000
TIOPNSLT EQU   POOLSTAR+1                                               03311000
@NM00151 EQU   POOLSTAR                                                 03312000
TIOEFSRT EQU   TIOENTRY+17                                              03313000
TIOSVERF EQU   TIOESTTB                                                 03314000
TIOSUNLD EQU   TIOESTTB                                                 03315000
TIOSMNTD EQU   TIOESTTB                                                 03316000
TIOSSETU EQU   TIOESTTB                                                 03317000
TIOSVLSR EQU   TIOESTTB                                                 03318000
TIOSPVIO EQU   TIOESTTB                                                 03319000
TIOSREQD EQU   TIOESTTB                                                 03320000
TIOSUSED EQU   TIOESTTB                                                 03321000
TIOSBALS EQU   TIOESTTC                                                 03322000
TIOSBALP EQU   TIOESTTC                                                 03323000
TIOSVOLS EQU   TIOESTTC                                                 03324000
TIOSVOLP EQU   TIOESTTC                                                 03325000
TIOSAFFS EQU   TIOESTTC                                                 03326000
TIOSAFFP EQU   TIOESTTC                                                 03327000
TIOSDEFR EQU   TIOESTTC                                                 03328000
TIOSDKCR EQU   TIOESTTC                                                 03329000
TIOEJFCB EQU   TIOENTRY+12                                              03330000
TIOTREM  EQU   TIOELINK                                                 03331000
TIOESSDS EQU   TIOESYOT                                                 03332000
TIOESYIN EQU   TIOELINK                                                 03333000
TIOEQNAM EQU   TIOELINK                                                 03334000
TIOEDYNM EQU   TIOELINK                                                 03335000
TIOTTERM EQU   TIOELINK                                                 03336000
TIOTRV01 EQU   TIOELINK                                                 03337000
TIOSYOUT EQU   TIOELINK                                                 03338000
TIOEWTCT EQU   TIOERLOC                                                 03339000
TIOSDSP2 EQU   TIOESTTA                                                 03340000
TIOSDSP1 EQU   TIOESTTA                                                 03341000
TIOSLABL EQU   TIOESTTA                                                 03342000
TIOSDADS EQU   TIOESTTA                                                 03343000
TIOSJBLB EQU   TIOESTTA                                                 03344000
TIOSPLTS EQU   TIOESTTA                                                 03345000
TIOSPLTP EQU   TIOESTTA                                                 03346000
TIOSLTYP EQU   TIOESTTA                                                 03347000
TIOELNGH EQU   TIOENTRY                                                 03348000
@NM00150 EQU   TCBXTNT2+32                                              03349000
TCBRV181 EQU   TCBRV173                                                 03350000
TCBRV180 EQU   TCBRV173                                                 03351000
TCBRV179 EQU   TCBRV173                                                 03352000
TCBRV178 EQU   TCBRV173                                                 03353000
TCBRV177 EQU   TCBRV173                                                 03354000
TCBRV176 EQU   TCBRV173                                                 03355000
TCBRV175 EQU   TCBRV173                                                 03356000
TCBRV174 EQU   TCBRV173                                                 03357000
TCBRV172 EQU   TCBRV164                                                 03358000
TCBRV171 EQU   TCBRV164                                                 03359000
TCBRV170 EQU   TCBRV164                                                 03360000
TCBRV169 EQU   TCBRV164                                                 03361000
TCBRV168 EQU   TCBRV164                                                 03362000
TCBRV167 EQU   TCBRV164                                                 03363000
TCBRV166 EQU   TCBRV164                                                 03364000
TCBRV165 EQU   TCBRV164                                                 03365000
TCBRV163 EQU   TCBRV155                                                 03366000
TCBRV162 EQU   TCBRV155                                                 03367000
TCBRV161 EQU   TCBRV155                                                 03368000
TCBRV160 EQU   TCBRV155                                                 03369000
TCBRV159 EQU   TCBRV155                                                 03370000
TCBRV158 EQU   TCBRV155                                                 03371000
TCBRV157 EQU   TCBRV155                                                 03372000
TCBRV156 EQU   TCBRV155                                                 03373000
TCBRV154 EQU   TCBRV146                                                 03374000
TCBRV153 EQU   TCBRV146                                                 03375000
TCBRV152 EQU   TCBRV146                                                 03376000
TCBRV151 EQU   TCBRV146                                                 03377000
TCBRV150 EQU   TCBRV146                                                 03378000
TCBRV149 EQU   TCBRV146                                                 03379000
TCBRV148 EQU   TCBRV146                                                 03380000
TCBRV147 EQU   TCBRV146                                                 03381000
TCBRV145 EQU   TCBXTNT2+26                                              03382000
TCBRV144 EQU   TCBXTNT2+24                                              03383000
TCBRV143 EQU   TCBXTNT2+20                                              03384000
TCBRV142 EQU   TCBXTNT2+16                                              03385000
TCBRSV49 EQU   TCBXTNT2+12                                              03386000
TCBEVENT EQU   TCBXTNT2+8                                               03387000
TCBRCMP  EQU   TCBXTNT2+5                                               03388000
TCBRSVAB EQU   TCBXTNT2+4                                               03389000
TCBGTFA  EQU   TCBGTF+1                                                 03390000
TCBRSV47 EQU   TCBTFLG                                                  03391000
TCBRSV46 EQU   TCBTFLG                                                  03392000
TCBRSV45 EQU   TCBTFLG                                                  03393000
TCBRSV44 EQU   TCBTFLG                                                  03394000
TCBRSV43 EQU   TCBTFLG                                                  03395000
TCBDSPIT EQU   TCBTFLG                                                  03396000
TCBERRTN EQU   TCBTFLG                                                  03397000
TCBASYNC EQU   TCBTFLG                                                  03398000
@NM00149 EQU   TCB+296                                                  03399000
TCBSVCA2 EQU   TCB+292                                                  03400000
TCBSWASA EQU   TCB+288                                                  03401000
TCBDBTB  EQU   TCB+284                                                  03402000
TCBRPT   EQU   TCB+280                                                  03403000
TCBRV141 EQU   TCBRV133                                                 03404000
TCBRV140 EQU   TCBRV133                                                 03405000
TCBRV139 EQU   TCBRV133                                                 03406000
TCBRV138 EQU   TCBRV133                                                 03407000
TCBRV137 EQU   TCBRV133                                                 03408000
TCBRV136 EQU   TCBRV133                                                 03409000
TCBRV135 EQU   TCBRV133                                                 03410000
TCBRV134 EQU   TCBRV133                                                 03411000
TCBRV132 EQU   TCBRV124                                                 03412000
TCBRV131 EQU   TCBRV124                                                 03413000
TCBRV130 EQU   TCBRV124                                                 03414000
TCBRV129 EQU   TCBRV124                                                 03415000
TCBRV128 EQU   TCBRV124                                                 03416000
TCBRV127 EQU   TCBRV124                                                 03417000
TCBRV126 EQU   TCBRV124                                                 03418000
TCBRV125 EQU   TCBRV124                                                 03419000
TCBRV123 EQU   TCBFBYT2                                                 03420000
TCBRV122 EQU   TCBFBYT2                                                 03421000
TCBECBNV EQU   TCBFBYT2                                                 03422000
TCBSSSYN EQU   TCBFBYT2                                                 03423000
TCBFPRAP EQU   TCBFBYT2                                                 03424000
TCBFDW   EQU   TCBFBYT2                                                 03425000
TCBFMW   EQU   TCBFBYT2                                                 03426000
TCBCNCB  EQU   TCBFBYT2                                                 03427000
TCBLLH   EQU   TCBFBYT1                                                 03428000
TCBRV113 EQU   TCBFBYT1                                                 03429000
TCBEOT   EQU   TCBFBYT1                                                 03430000
TCBRTM2  EQU   TCBFBYT1                                                 03431000
TCBPGNLY EQU   TCBFBYT1                                                 03432000
TCBNDIOS EQU   TCBFBYT1                                                 03433000
TCBACTIV EQU   TCBFBYT1                                                 03434000
TCBEOTFM EQU   TCBFBYT1                                                 03435000
TCBAFFN  EQU   TCB+274                                                  03436000
TCBCCPVI EQU   TCB+272                                                  03437000
TCBUKYSP EQU   TCB+268                                                  03438000
TCBMODE  EQU   TCBESTAE+3                                               03439000
TCBERTYP EQU   TCBESTAE+2                                               03440000
TCBRV314 EQU   TCBESTRM                                                 03441000
TCBRV313 EQU   TCBESTRM                                                 03442000
TCBRV312 EQU   TCBESTRM                                                 03443000
TCBRV311 EQU   TCBESTRM                                                 03444000
TCBRV310 EQU   TCBESTRM                                                 03445000
TCBRV309 EQU   TCBESTRM                                                 03446000
TCBRV308 EQU   TCBESTRM                                                 03447000
TCBETERM EQU   TCBESTRM                                                 03448000
TCBSCBKY EQU   TCBESTAE                                                 03449000
TCBRTM12 EQU   TCB+260                                                  03450000
TCBTCBID EQU   TCB+256                                                  03451000
TCBRSV96 EQU   TCB+252                                                  03452000
TCBSWA   EQU   TCB+248                                                  03453000
TCBFOEA  EQU   TCBFOE+1                                                 03454000
TCBRSV42 EQU   TCBFOE                                                   03455000
TCBRV306 EQU   TCB+240                                                  03456000
TCBRSV41 EQU   TCB+239                                                  03457000
TCBTID   EQU   TCB+238                                                  03458000
TCBRSVAA EQU   TCB+237                                                  03459000
TCBABCUR EQU   TCB+236                                                  03460000
TCBTMSAV EQU   TCB+232                                                  03461000
TCBIOTIM EQU   TCB+228                                                  03462000
TCBRTWA  EQU   TCB+224                                                  03463000
TCBBACK  EQU   TCB+220                                                  03464000
TCBTIRB  EQU   TCB+216                                                  03465000
TCBAECB  EQU   TCB+212                                                  03466000
TCBEXT2A EQU   TCBEXT2+1                                                03467000
TCBRSV39 EQU   TCBEXT2                                                  03468000
TCBSTMCT EQU   TCB+207                                                  03469000
TCBSYSCT EQU   TCB+206                                                  03470000
TCBRSV37 EQU   TCB+205                                                  03471000
TCBEXSVC EQU   TCBDAR                                                   03472000
TCBDARMS EQU   TCBDAR                                                   03473000
TCBDARWT EQU   TCBDAR                                                   03474000
TCBDARO  EQU   TCBDAR                                                   03475000
TCBDARMC EQU   TCBDARC                                                  03476000
TCBDARD  EQU   TCBDAR                                                   03477000
TCBDARS  EQU   TCBDAR                                                   03478000
TCBDARP  EQU   TCBDAR                                                   03479000
TCBGTOFM EQU   TCBFLGS7                                                 03480000
TCBADMP  EQU   TCBFLGS7                                                 03481000
TCBRSTSK EQU   TCBFLGS7                                                 03482000
TCBSVCS  EQU   TCBFLGS7                                                 03483000
TCBSTACK EQU   TCBFLGS7                                                 03484000
TCBRSV34 EQU   TCBFLGS7                                                 03485000
TCBRSV33 EQU   TCBFLGS7                                                 03486000
TCBGPECB EQU   TCBFLGS7                                                 03487000
TCBNTJS  EQU   TCBFLGS6                                                 03488000
TCBAPG   EQU   TCBFLGS6                                                 03489000
TCBMIGR  EQU   TCBFLGS6                                                 03490000
TCBRV303 EQU   TCBFLGS6                                                 03491000
TCBSPVLK EQU   TCBFLGS6                                                 03492000
TCBCPU   EQU   TCBFLGS6                                                 03493000
TCBPIE17 EQU   TCBFLGS6                                                 03494000
TCBRV    EQU   TCBFLGS6                                                 03495000
TCBRSV79 EQU   TCBNDSP5                                                 03496000
TCBRSV78 EQU   TCBNDSP5                                                 03497000
TCBRSV77 EQU   TCBNDSP5                                                 03498000
TCBRSV76 EQU   TCBNDSP5                                                 03499000
TCBRSV75 EQU   TCBNDSP5                                                 03500000
TCBRSV74 EQU   TCBNDSP5                                                 03501000
TCBRSV95 EQU   TCBNDSP5                                                 03502000
TCBRSV94 EQU   TCBNDSP5                                                 03503000
TCBRSV93 EQU   TCBNDSP4                                                 03504000
TCBRSV92 EQU   TCBNDSP4                                                 03505000
TCBRSV91 EQU   TCBNDSP4                                                 03506000
TCBRSV90 EQU   TCBNDSP4                                                 03507000
TCBRSV89 EQU   TCBNDSP4                                                 03508000
TCBRSV88 EQU   TCBNDSP4                                                 03509000
TCBRSV87 EQU   TCBNDSP4                                                 03510000
TCBRSV86 EQU   TCBNDSP4                                                 03511000
TCBEXT1A EQU   TCBEXT1+1                                                03512000
TCBRSV32 EQU   TCBEXT1                                                  03513000
TCBEXCPD EQU   TCB+192                                                  03514000
TCBIOBRC EQU   TCB+188                                                  03515000
TCBDDWTC EQU   TCB+186                                                  03516000
TCBDDEXC EQU   TCB+184                                                  03517000
TCBJSCBB EQU   TCBJSCB+1                                                03518000
@NM00148 EQU   TCBRECDE                                                 03519000
TCBREC   EQU   TCBRECDE                                                 03520000
TCBMDIDS EQU   TCB+176                                                  03521000
TCBNDINT EQU   TCBNDSP3                                                 03522000
TCBRSV27 EQU   TCBNDSP3                                                 03523000
TCBRSV26 EQU   TCBNDSP3                                                 03524000
TCBRSV25 EQU   TCBNDSP3                                                 03525000
TCBRSV24 EQU   TCBNDSP3                                                 03526000
TCBSRBND EQU   TCBNDSP3                                                 03527000
TCBRV302 EQU   TCBNDSP3                                                 03528000
TCBLJSND EQU   TCBNDSP3                                                 03529000
TCBABE   EQU   TCBNDSP2                                                 03530000
TCBDSS   EQU   TCBNDSP2                                                 03531000
TCBOWAIT EQU   TCBNDSP2                                                 03532000
TCBIWAIT EQU   TCBNDSP2                                                 03533000
TCBNDTS  EQU   TCBNDSP2                                                 03534000
TCBNDSVC EQU   TCBNDSP2                                                 03535000
TCBSTPP  EQU   TCBNDSP2                                                 03536000
TCBABD   EQU   TCBNDSP2                                                 03537000
TCBRSV22 EQU   TCBNDSP1                                                 03538000
TCBPIEND EQU   TCBNDSP1                                                 03539000
TCBTPSP  EQU   TCBNDSP1                                                 03540000
TCBDDRND EQU   TCBNDSP1                                                 03541000
TCBRSPND EQU   TCBNDSP1                                                 03542000
TCBRSTND EQU   TCBNDSP1                                                 03543000
TCBDARPN EQU   TCBNDSP1                                                 03544000
TCBDARTN EQU   TCBNDSP1                                                 03545000
TCBNDSP0 EQU   TCBNDSP                                                  03546000
TCBUSER  EQU   TCB+168                                                  03547000
TCBTCTB  EQU   TCBTCT+1                                                 03548000
TCBRSV9C EQU   TCBTCTGF                                                 03549000
TCBRSV9B EQU   TCBTCTGF                                                 03550000
TCBRSV9A EQU   TCBTCTGF                                                 03551000
TCBRSV99 EQU   TCBTCTGF                                                 03552000
TCBRSV98 EQU   TCBTCTGF                                                 03553000
TCBRSV97 EQU   TCBTCTGF                                                 03554000
TCBRSV20 EQU   TCBTCTGF                                                 03555000
TCBSMFGF EQU   TCBTCTGF                                                 03556000
TCBSTABB EQU   TCBSTAB+1                                                03557000
TCBSTCUR EQU   TCBNSTAE                                                 03558000
TCBRV301 EQU   TCBNSTAE                                                 03559000
TCBSYNCH EQU   TCBNSTAE                                                 03560000
TCBHALT  EQU   TCBNSTAE                                                 03561000
TCBPPSUP EQU   TCBNSTAE                                                 03562000
TCB33E   EQU   TCBNSTAE                                                 03563000
TCBQUIES EQU   TCBNSTAE                                                 03564000
TCBSTABE EQU   TCBNSTAE                                                 03565000
TCBAQE   EQU   TCB+156                                                  03566000
TCBPQE   EQU   TCB+152                                                  03567000
TCBTSDP  EQU   TCB+151                                                  03568000
TCBTSLP  EQU   TCB+150                                                  03569000
TCBSTPCT EQU   TCB+149                                                  03570000
TCBCPUBN EQU   TCBTSFLG                                                 03571000
TCBDYDSP EQU   TCBTSFLG                                                 03572000
TCBRSV18 EQU   TCBTSFLG                                                 03573000
TCBRSV17 EQU   TCBTSFLG                                                 03574000
TCBTIOTG EQU   TCBTSFLG                                                 03575000
TCBATT   EQU   TCBTSFLG                                                 03576000
TCBSTPPR EQU   TCBTSFLG                                                 03577000
TCBRV300 EQU   TCBTSTSK                                                 03578000
TCBECB   EQU   TCB+144                                                  03579000
TCBIQE   EQU   TCB+140                                                  03580000
TCBLTC   EQU   TCB+136                                                  03581000
TCBOTC   EQU   TCB+132                                                  03582000
TCBNTC   EQU   TCB+128                                                  03583000
TCBJSTCA EQU   TCBJSTCB+1                                               03584000
TCBRSV16 EQU   TCBJSTCB                                                 03585000
TCBTQET  EQU   TCBTME                                                   03586000
TCBTCB   EQU   TCB+116                                                  03587000
TCBFSAB  EQU   TCBFSA+1                                                 03588000
TCBQEL   EQU   TCBFSA                                                   03589000
TCBGRS15 EQU   TCBGRS+60                                                03590000
TCBGRS14 EQU   TCBGRS+56                                                03591000
TCBGRS13 EQU   TCBGRS+52                                                03592000
TCBGRS12 EQU   TCBGRS+48                                                03593000
TCBGRS11 EQU   TCBGRS+44                                                03594000
TCBGRS10 EQU   TCBGRS+40                                                03595000
TCBGRS9  EQU   TCBGRS+36                                                03596000
TCBGRS8  EQU   TCBGRS+32                                                03597000
TCBGRS7  EQU   TCBGRS+28                                                03598000
TCBGRS6  EQU   TCBGRS+24                                                03599000
TCBGRS5  EQU   TCBGRS+20                                                03600000
TCBGRS4  EQU   TCBGRS+16                                                03601000
TCBGRS3  EQU   TCBGRS+12                                                03602000
TCBGRS2  EQU   TCBGRS+8                                                 03603000
TCBGRS1  EQU   TCBGRS+4                                                 03604000
TCBGRS0  EQU   TCBGRS                                                   03605000
TCBJPQB  EQU   TCBJPQ+1                                                 03606000
TCBRSV15 EQU   TCBPURGE                                                 03607000
TCBRSV14 EQU   TCBPURGE                                                 03608000
TCBRSV13 EQU   TCBPURGE                                                 03609000
TCBRSV12 EQU   TCBPURGE                                                 03610000
TCBRSV11 EQU   TCBPURGE                                                 03611000
TCBRSV10 EQU   TCBPURGE                                                 03612000
TCBRSV09 EQU   TCBPURGE                                                 03613000
TCBJPQF  EQU   TCBPURGE                                                 03614000
TCBJLB   EQU   TCB+40                                                   03615000
TCBLLS   EQU   TCB+36                                                   03616000
TCBDSP   EQU   TCB+35                                                   03617000
TCBLMP   EQU   TCB+34                                                   03618000
TCBPNDSP EQU   TCBFLGS5                                                 03619000
TCBFCD1  EQU   TCBFLGS5                                                 03620000
TCBSTP   EQU   TCBFLGS5                                                 03621000
TCBSYS   EQU   TCBFLGS5                                                 03622000
TCBANDSP EQU   TCBFLGS5                                                 03623000
TCBPAGE  EQU   TCBFLGS5                                                 03624000
TCBUXNDF EQU   TCBABWF                                                  03625000
TCBFC    EQU   TCBFLGS5                                                 03626000
TCBONDSP EQU   TCBFLGS4                                                 03627000
TCBMPCND EQU   TCBFLGS4                                                 03628000
TCBMPCVQ EQU   TCBFLGS4                                                 03629000
TCBUXNDV EQU   TCBFLGS4                                                 03630000
TCBHNDSP EQU   TCBFLGS4                                                 03631000
TCBRQENA EQU   TCBFLGS4                                                 03632000
TCBSER   EQU   TCBFLGS4                                                 03633000
TCBNDUMP EQU   TCBFLGS4                                                 03634000
TCBDWSTA EQU   TCBFLGS3                                                 03635000
TCBRSV08 EQU   TCBFLGS3                                                 03636000
TCBRSV07 EQU   TCBFLGS3                                                 03637000
TCBRSV06 EQU   TCBFLGS3                                                 03638000
TCBABGM  EQU   TCBFLGS3                                                 03639000
TCBABTRM EQU   TCBFLGS3                                                 03640000
TCBADINP EQU   TCBFLGS3                                                 03641000
TCBFSM   EQU   TCBFLGS3                                                 03642000
TCBFTS   EQU   TCBFLGS2                                                 03643000
TCBFETXR EQU   TCBFLGS2                                                 03644000
TCBFDSOP EQU   TCBFLGS2                                                 03645000
TCBFJMC  EQU   TCBFLGS2                                                 03646000
TCBFSMC  EQU   TCBFLGS2                                                 03647000
TCBFABOP EQU   TCBFLGS2                                                 03648000
TCBFSTI  EQU   TCBFLGS2                                                 03649000
TCBFOINP EQU   TCBFLGS2                                                 03650000
TCBFX    EQU   TCBFLGS1                                                 03651000
TCBFS    EQU   TCBFLGS1                                                 03652000
TCBFT    EQU   TCBFLGS1                                                 03653000
TCBPDUMP EQU   TCBFLGS1                                                 03654000
TCBNONPR EQU   TCBFLGS1                                                 03655000
TCBFERA  EQU   TCBFLGS1                                                 03656000
TCBFE    EQU   TCBFLGS1                                                 03657000
TCBFA    EQU   TCBFLGS1                                                 03658000
TCBZERO  EQU   TCBPKF                                                   03659000
TCBFLAG  EQU   TCBPKF                                                   03660000
TCBMSSB  EQU   TCBMSS+1                                                 03661000
TCBRSV03 EQU   TCBMSS                                                   03662000
TCBTRNB  EQU   TCBTRN+1                                                 03663000
TCBRSV02 EQU   TCBABF                                                   03664000
TCBOLTEP EQU   TCBABF                                                   03665000
TCBTCP   EQU   TCBABF                                                   03666000
TCBTCPP  EQU   TCBABF                                                   03667000
TCBRSV01 EQU   TCBABF                                                   03668000
TCBGRPH  EQU   TCBABF                                                   03669000
TCBNOCHK EQU   TCBABF                                                   03670000
TCBMOD91 EQU   TCBABF                                                   03671000
TCBCMPC  EQU   TCBCMP+1                                                 03672000
TCBRV318 EQU   TCBCMSG                                                  03673000
TCBRV317 EQU   TCBCIND                                                  03674000
TCBRV316 EQU   TCBCWTO                                                  03675000
TCBCASID EQU   TCBCDBL                                                  03676000
TCBNOCC  EQU   TCBSTCC                                                  03677000
TCBDMPO  EQU   TCBCPP                                                   03678000
TCBCSTEP EQU   TCBCMPF                                                  03679000
TCBCREQ  EQU   TCBCMPF                                                  03680000
TCBDEB   EQU   TCB+8                                                    03681000
TCBPIEA  EQU   TCBPIE+1                                                 03682000
TCBPM    EQU   TCBPMASK                                                 03683000
@NM00147 EQU   TCBPMASK                                                 03684000
TCBRBP   EQU   TCB                                                      03685000
TCBFRS6  EQU   TCBFRS+24                                                03686000
TCBFRS4  EQU   TCBFRS+16                                                03687000
TCBFRS2  EQU   TCBFRS+8                                                 03688000
TCBFRS0  EQU   TCBFRS                                                   03689000
SPDDATA2 EQU   SPDDATA1+4                                               03690000
SPDBLKAD EQU   SPDDATA1                                                 03691000
SPDPTRSW EQU   SPDBLKID                                                 03692000
SPDRCDLN EQU   SPDRCDHD                                                 03693000
SPDTRACE EQU   SPDBFR+9                                                 03694000
SPDABCCD EQU   SPDHDR+8                                                 03695000
SPDDDNAM EQU   SPDHDR                                                   03696000
@NM00146 EQU   SDWA+512                                                 03697000
SDWAURAL EQU   SDWARA+3                                                 03698000
@NM00145 EQU   SDWADPVA                                                 03699000
SDWAEBC  EQU   SDWADPVA                                                 03700000
SDWAHEX  EQU   SDWADPVA                                                 03701000
SDWAVRAL EQU   SDWARA                                                   03702000
@NM00144 EQU   SDWA+396                                                 03703000
SDWACOMP EQU   SDWA+392                                                 03704000
SDWARCPL EQU   SDWA+364                                                 03705000
@NM00143 EQU   SDWADPSA+32                                              03706000
SDWATO4  EQU   SDWADPSL+28                                              03707000
SDWAFRM4 EQU   SDWADPSL+24                                              03708000
SDWATO3  EQU   SDWADPSL+20                                              03709000
SDWAFRM3 EQU   SDWADPSL+16                                              03710000
SDWATO2  EQU   SDWADPSL+12                                              03711000
SDWAFRM2 EQU   SDWADPSL+8                                               03712000
SDWATO1  EQU   SDWADPSL+4                                               03713000
SDWAFRM1 EQU   SDWADPSL                                                 03714000
@NM00142 EQU   SDWADDAT+3                                               03715000
@NM00141 EQU   SDWAPDAT                                                 03716000
SDWAUSPL EQU   SDWAPDAT                                                 03717000
SDWADPSW EQU   SDWAPDAT                                                 03718000
SDWATJPA EQU   SDWAPDAT                                                 03719000
SDWATLPA EQU   SDWAPDAT                                                 03720000
SDWADREG EQU   SDWAPDAT                                                 03721000
SDWADSAH EQU   SDWAPDAT                                                 03722000
SDWADSAS EQU   SDWAPDAT                                                 03723000
@NM00140 EQU   SDWADDAT+1                                               03724000
@NM00139 EQU   SDWASDAT                                                 03725000
SDWAQQS  EQU   SDWASDAT                                                 03726000
SDWACBS  EQU   SDWASDAT                                                 03727000
SDWAGTF  EQU   SDWASDAT                                                 03728000
SDWASWA  EQU   SDWASDAT                                                 03729000
SDWALSQA EQU   SDWASDAT                                                 03730000
SDWASQA  EQU   SDWASDAT                                                 03731000
SDWANUC  EQU   SDWASDAT                                                 03732000
@NM00138 EQU   SDWADUMP+2                                               03733000
@NM00137 EQU   SDWADPFS                                                 03734000
SDWASLST EQU   SDWADPFS                                                 03735000
@NM00136 EQU   SDWADPFS                                                 03736000
SDWADLST EQU   SDWADPFS                                                 03737000
SDWADPT  EQU   SDWADPFS                                                 03738000
SDWADPID EQU   SDWADUMP                                                 03739000
SDWADPLA EQU   SDWA+316                                                 03740000
SDWAMODN EQU   SDWARECP                                                 03741000
@NM00135 EQU   SDWALKWA+32                                              03742000
SDWATALW EQU   SDWALKWS+28                                              03743000
SDWATDLW EQU   SDWALKWS+24                                              03744000
SDWATNLW EQU   SDWALKWS+20                                              03745000
SDWAAPLW EQU   SDWALKWS+16                                              03746000
SDWAIPLW EQU   SDWALKWS+12                                              03747000
SDWAILLW EQU   SDWALKWS+8                                               03748000
SDWAIULW EQU   SDWALKWS+4                                               03749000
SDWAICLW EQU   SDWALKWS                                                 03750000
SDWAFLLK EQU   SDWAACF4                                                 03751000
SDWACMS  EQU   SDWAACF4                                                 03752000
SDWAOPTM EQU   SDWAACF4                                                 03753000
SDWATADB EQU   SDWAACF4                                                 03754000
SDWATDNB EQU   SDWAACF4                                                 03755000
SDWATNCB EQU   SDWAACF4                                                 03756000
SDWAILCH EQU   SDWAACF4                                                 03757000
SDWAIUCB EQU   SDWAACF4                                                 03758000
SDWAICAT EQU   SDWAACF3                                                 03759000
SDWAIPRG EQU   SDWAACF3                                                 03760000
SDWASALL EQU   SDWAACF3                                                 03761000
SDWAASMP EQU   SDWAACF3                                                 03762000
SDWADISP EQU   SDWAACF3                                                 03763000
@NM00134 EQU   SDWAACF3                                                 03764000
@NM00133 EQU   SDWAACF2                                                 03765000
@NM00132 EQU   SDWAACF2                                                 03766000
SDWASPIN EQU   SDWAACF2                                                 03767000
@NM00131 EQU   SDWAACF2                                                 03768000
SDWALCPU EQU   SDWACPUA+2                                               03769000
@NM00130 EQU   SDWACPUA                                                 03770000
SDWARECA EQU   SDWA+244                                                 03771000
@NM00129 EQU   SDWA+239                                                 03772000
@NM00128 EQU   SDWAIOFS                                                 03773000
SDWANIOP EQU   SDWAIOFS                                                 03774000
SDWANOIO EQU   SDWAIOFS                                                 03775000
SDWAIOHT EQU   SDWAIOFS                                                 03776000
SDWAIOQR EQU   SDWAIOFS                                                 03777000
SDWAFMID EQU   SDWA+236                                                 03778000
@NM00127 EQU   SDWAERRD                                                 03779000
SDWAMCIV EQU   SDWAERRD                                                 03780000
SDWARPIV EQU   SDWAERRD                                                 03781000
SDWAMABD EQU   SDWAERRD                                                 03782000
SDWACTS  EQU   SDWAERRD                                                 03783000
SDWASTAE EQU   SDWAERRD                                                 03784000
SDWANRBE EQU   SDWAERRD                                                 03785000
@NM00126 EQU   SDWAERRC                                                 03786000
SDWAPERC EQU   SDWAERRC                                                 03787000
SDWAIRB  EQU   SDWAERRC                                                 03788000
SDWASTAI EQU   SDWAERRC                                                 03789000
SDWASRBM EQU   SDWAERRB                                                 03790000
SDWALDIS EQU   SDWAERRB                                                 03791000
SDWAENRB EQU   SDWAERRB                                                 03792000
SDWATYP1 EQU   SDWAERRB                                                 03793000
@NM00125 EQU   SDWAERRB                                                 03794000
SDWASVCE EQU   SDWAERRA                                                 03795000
SDWAABTM EQU   SDWAERRA                                                 03796000
SDWASVCD EQU   SDWAERRA                                                 03797000
SDWARKEY EQU   SDWAERRA                                                 03798000
SDWAPCHK EQU   SDWAERRA                                                 03799000
SDWATIME EQU   SDWAMCH+20                                               03800000
SDWARFSA EQU   SDWAMCH+16                                               03801000
@NM00124 EQU   SDWAMCH+14                                               03802000
SDWAVEQR EQU   SDWARSR2                                                 03803000
SDWAPGFX EQU   SDWARSR2                                                 03804000
SDWAFLSQ EQU   SDWARSR2                                                 03805000
SDWAFSQA EQU   SDWARSR2                                                 03806000
SDWANUCL EQU   SDWARSR2                                                 03807000
SDWASPER EQU   SDWARSR2                                                 03808000
SDWAINTC EQU   SDWARSR2                                                 03809000
SDWAOFLN EQU   SDWARSR2                                                 03810000
SDWACHNG EQU   SDWARSR1                                                 03811000
SDWAMSER EQU   SDWARSR1                                                 03812000
@NM00123 EQU   SDWARSR1                                                 03813000
SDWACPID EQU   SDWAMCH+10                                               03814000
SDWATERR EQU   SDWAMCHD                                                 03815000
SDWAFPRX EQU   SDWAMCHD                                                 03816000
SDWAINSF EQU   SDWAMCHD                                                 03817000
SDWAACR  EQU   SDWAMCHD                                                 03818000
SDWASCK  EQU   SDWAMCHD                                                 03819000
SDWAPSWU EQU   SDWAMCHD                                                 03820000
SDWAREGU EQU   SDWAMCHD                                                 03821000
SDWASKYF EQU   SDWAMCHD                                                 03822000
@NM00122 EQU   SDWAMCHS                                                 03823000
SDWARSRF EQU   SDWAMCHS                                                 03824000
SDWARSRC EQU   SDWAMCHS                                                 03825000
SDWAINVP EQU   SDWAMCHS                                                 03826000
SDWATSVL EQU   SDWAMCHS                                                 03827000
SDWARCDF EQU   SDWAMCHS                                                 03828000
SDWASRVL EQU   SDWAMCHS                                                 03829000
SDWASCKE EQU   SDWASTCK+4                                               03830000
SDWASCKB EQU   SDWASTCK                                                 03831000
SDWALNTH EQU   SDWAIDNT+1                                               03832000
SDWASPID EQU   SDWAIDNT                                                 03833000
SDWASR14 EQU   SDWASRSV+56                                              03834000
SDWASR13 EQU   SDWASRSV+52                                              03835000
SDWASR12 EQU   SDWASRSV+48                                              03836000
SDWASR11 EQU   SDWASRSV+44                                              03837000
SDWASR10 EQU   SDWASRSV+40                                              03838000
SDWASR09 EQU   SDWASRSV+36                                              03839000
SDWASR08 EQU   SDWASRSV+32                                              03840000
SDWASR07 EQU   SDWASRSV+28                                              03841000
SDWASR06 EQU   SDWASRSV+24                                              03842000
SDWASR05 EQU   SDWASRSV+20                                              03843000
SDWASR04 EQU   SDWASRSV+16                                              03844000
SDWASR03 EQU   SDWASRSV+12                                              03845000
SDWASR02 EQU   SDWASRSV+8                                               03846000
SDWASR01 EQU   SDWASRSV+4                                               03847000
SDWASR00 EQU   SDWASRSV                                                 03848000
SDWATRN2 EQU   SDWAAEC2+4                                               03849000
SDWAIPC2 EQU   SDWAICD2                                                 03850000
SDWAIMC2 EQU   SDWAICD2                                                 03851000
SDWAIPR2 EQU   SDWAICD2                                                 03852000
@NM00121 EQU   SDWAINC2                                                 03853000
@NM00120 EQU   SDWAILC2                                                 03854000
SDWAIL2  EQU   SDWAILC2                                                 03855000
@NM00119 EQU   SDWAILC2                                                 03856000
@NM00118 EQU   SDWAAEC2                                                 03857000
SDWAADD2 EQU   SDWANXT2+1                                               03858000
@NM00117 EQU   SDWANXT2                                                 03859000
@NM00116 EQU   SDWAEC2+3                                                03860000
SDWASGN2 EQU   SDWAINT2                                                 03861000
SDWAEXP2 EQU   SDWAINT2                                                 03862000
SDWADEC2 EQU   SDWAINT2                                                 03863000
SDWAFPO2 EQU   SDWAINT2                                                 03864000
SDWACC2  EQU   SDWAINT2                                                 03865000
@NM00115 EQU   SDWAINT2                                                 03866000
SDWAPGM2 EQU   SDWAMWP2                                                 03867000
SDWAWAT2 EQU   SDWAMWP2                                                 03868000
SDWAMCK2 EQU   SDWAMWP2                                                 03869000
SDWAECT2 EQU   SDWAMWP2                                                 03870000
SDWAKEY2 EQU   SDWAMWP2                                                 03871000
SDWAEXT2 EQU   SDWAEMK2                                                 03872000
SDWAIO2  EQU   SDWAEMK2                                                 03873000
SDWATRM2 EQU   SDWAEMK2                                                 03874000
@NM00114 EQU   SDWAEMK2                                                 03875000
SDWAPER2 EQU   SDWAEMK2                                                 03876000
@NM00113 EQU   SDWAEMK2                                                 03877000
SDWATRAN EQU   SDWAAEC1+4                                               03878000
SDWAIPC1 EQU   SDWAICD1                                                 03879000
SDWAIMC1 EQU   SDWAICD1                                                 03880000
SDWAIPR1 EQU   SDWAICD1                                                 03881000
@NM00112 EQU   SDWAINC1                                                 03882000
@NM00111 EQU   SDWAILC1                                                 03883000
SDWAIL1  EQU   SDWAILC1                                                 03884000
@NM00110 EQU   SDWAILC1                                                 03885000
@NM00109 EQU   SDWAAEC1                                                 03886000
SDWAADD1 EQU   SDWANXT1+1                                               03887000
@NM00108 EQU   SDWANXT1                                                 03888000
@NM00107 EQU   SDWAEC1+3                                                03889000
SDWASGN1 EQU   SDWAINT1                                                 03890000
SDWAEXP1 EQU   SDWAINT1                                                 03891000
SDWADEC1 EQU   SDWAINT1                                                 03892000
SDWAFPO1 EQU   SDWAINT1                                                 03893000
SDWACC1  EQU   SDWAINT1                                                 03894000
@NM00106 EQU   SDWAINT1                                                 03895000
SDWAPGM1 EQU   SDWAMWP1                                                 03896000
SDWAWAT1 EQU   SDWAMWP1                                                 03897000
SDWAMCK1 EQU   SDWAMWP1                                                 03898000
SDWAECT1 EQU   SDWAMWP1                                                 03899000
SDWAKEY1 EQU   SDWAMWP1                                                 03900000
SDWAEXT1 EQU   SDWAEMK1                                                 03901000
SDWAIO1  EQU   SDWAEMK1                                                 03902000
SDWATRM1 EQU   SDWAEMK1                                                 03903000
@NM00105 EQU   SDWAEMK1                                                 03904000
SDWAPER1 EQU   SDWAEMK1                                                 03905000
@NM00104 EQU   SDWAEMK1                                                 03906000
SDWAIOBR EQU   SDWA+100                                                 03907000
SDWAEPA  EQU   SDWA+96                                                  03908000
@NM00103 EQU   SDWANAME+4                                               03909000
SDWARBAD EQU   SDWANAME                                                 03910000
SDWAGR15 EQU   SDWAGRSV+60                                              03911000
SDWAGR14 EQU   SDWAGRSV+56                                              03912000
SDWAGR13 EQU   SDWAGRSV+52                                              03913000
SDWAGR12 EQU   SDWAGRSV+48                                              03914000
SDWAGR11 EQU   SDWAGRSV+44                                              03915000
SDWAGR10 EQU   SDWAGRSV+40                                              03916000
SDWAGR09 EQU   SDWAGRSV+36                                              03917000
SDWAGR08 EQU   SDWAGRSV+32                                              03918000
SDWAGR07 EQU   SDWAGRSV+28                                              03919000
SDWAGR06 EQU   SDWAGRSV+24                                              03920000
SDWAGR05 EQU   SDWAGRSV+20                                              03921000
SDWAGR04 EQU   SDWAGRSV+16                                              03922000
SDWAGR03 EQU   SDWAGRSV+12                                              03923000
SDWAGR02 EQU   SDWAGRSV+8                                               03924000
SDWAGR01 EQU   SDWAGRSV+4                                               03925000
SDWAGR00 EQU   SDWAGRSV                                                 03926000
SDWANXTP EQU   SDWACTL2+5                                               03927000
SDWASGP  EQU   SDWAPMKP                                                 03928000
SDWAEUP  EQU   SDWAPMKP                                                 03929000
SDWADOP  EQU   SDWAPMKP                                                 03930000
SDWAFPP  EQU   SDWAPMKP                                                 03931000
SDWACCP  EQU   SDWAPMKP                                                 03932000
SDWAILP  EQU   SDWAPMKP                                                 03933000
SDWAINTP EQU   SDWACTL2+2                                               03934000
SDWASPVP EQU   SDWAMWPP                                                 03935000
SDWAWATP EQU   SDWAMWPP                                                 03936000
SDWAMCKP EQU   SDWAMWPP                                                 03937000
@NM00102 EQU   SDWAMWPP                                                 03938000
SDWAKEYP EQU   SDWAMWPP                                                 03939000
SDWAEXTP EQU   SDWACMKP                                                 03940000
SDWAIOP  EQU   SDWACMKP                                                 03941000
SDWANXTA EQU   SDWACTL1+5                                               03942000
SDWASGA  EQU   SDWAPMKA                                                 03943000
SDWAEUA  EQU   SDWAPMKA                                                 03944000
SDWADOA  EQU   SDWAPMKA                                                 03945000
SDWAFPA  EQU   SDWAPMKA                                                 03946000
SDWACCA  EQU   SDWAPMKA                                                 03947000
SDWAILA  EQU   SDWAPMKA                                                 03948000
SDWAINTA EQU   SDWACTL1+2                                               03949000
SDWASPVA EQU   SDWAMWPA                                                 03950000
SDWAWATA EQU   SDWAMWPA                                                 03951000
SDWAMCKA EQU   SDWAMWPA                                                 03952000
@NM00101 EQU   SDWAMWPA                                                 03953000
SDWAKEYA EQU   SDWAMWPA                                                 03954000
SDWAEXTA EQU   SDWACMKA                                                 03955000
SDWAIOA  EQU   SDWACMKA                                                 03956000
@NM00100 EQU   SDWACMPF                                                 03957000
SDWASTCC EQU   SDWACMPF                                                 03958000
@NM00099 EQU   SDWACMPF                                                 03959000
SDWASTEP EQU   SDWACMPF                                                 03960000
RDXNQARG EQU   RDXENTRY                                                 03961000
RDXRSV01 EQU   RDXLIST                                                  03962000
SIRBEND  EQU   RBSECT+168                                               03963000
SVRBEND  EQU   RBSECT+168                                               03964000
RBRSV158 EQU   RBRSV150                                                 03965000
RBRSV157 EQU   RBRSV150                                                 03966000
RBRSV156 EQU   RBRSV150                                                 03967000
RBRSV155 EQU   RBRSV150                                                 03968000
RBRSV154 EQU   RBRSV150                                                 03969000
RBRSV153 EQU   RBRSV150                                                 03970000
RBRSV152 EQU   RBRSV150                                                 03971000
RBRSV151 EQU   RBRSV150                                                 03972000
RBRSV149 EQU   RBSECT+166                                               03973000
RBRSV148 EQU   RBSECT+164                                               03974000
RBSCBB   EQU   RBSECT+144                                               03975000
TIRBEND  EQU   @NM00097+8                                               03976000
PRBEND   EQU   @NM00097+8                                               03977000
RBRSV146 EQU   RBRSV138                                                 03978000
RBRSV145 EQU   RBRSV138                                                 03979000
RBRSV144 EQU   RBRSV138                                                 03980000
RBRSV143 EQU   RBRSV138                                                 03981000
RBRSV142 EQU   RBRSV138                                                 03982000
RBRSV141 EQU   RBRSV138                                                 03983000
RBRSV140 EQU   RBRSV138                                                 03984000
RBRSV139 EQU   RBRSV138                                                 03985000
RBRSV137 EQU   @NM00097+6                                               03986000
RBRSV136 EQU   @NM00097+4                                               03987000
RBRSV135 EQU   @NM00097                                                 03988000
@NM00096 EQU   RBSECT+32                                                03989000
@NM00095 EQU   @NM00093+1                                               03990000
@NM00094 EQU   @NM00093                                                 03991000
RBPGMQ1  EQU   RBPGMQ+1                                                 03992000
@NM00092 EQU   RBPGMQ                                                   03993000
@NM00091 EQU   RBSECT+16                                                03994000
@NM00090 EQU   @NM00086                                                 03995000
@NM00089 EQU   @NM00086                                                 03996000
RBIQETP  EQU   @NM00086                                                 03997000
RBUSIQE  EQU   RBETXR                                                   03998000
RBATTN   EQU   @NM00086                                                 03999000
@NM00088 EQU   @NM00086                                                 04000000
@NM00087 EQU   @NM00086                                                 04001000
RBPMSVRB EQU   @NM00084                                                 04002000
RBATNXIT EQU   @NM00084                                                 04003000
@NM00085 EQU   @NM00084                                                 04004000
RBWAITP  EQU   @NM00084                                                 04005000
RBFNSVRB EQU   RBTRSVRB                                                 04006000
RBFTP    EQU   @NM00084                                                 04007000
RBSIZE   EQU   RBSECT+8                                                 04008000
RBABOPSW EQU   RBSECT+4                                                 04009000
RBPPSAV1 EQU   RBPPSAV+1                                                04010000
@NM00082 EQU   RBPPSAV                                                  04011000
RBPRFXND EQU   RBPREFIX+64                                              04012000
RBINTCOD EQU   RBINTCDA+1                                               04013000
RBINLNTH EQU   RBINTCDA                                                 04014000
RBWCSA   EQU   RBPREFIX+60                                              04015000
RBRSV004 EQU   RBPREFIX+57                                              04016000
RBSSSYN  EQU   RBFLAGS1                                                 04017000
RBSCB    EQU   RBFLAGS1                                                 04018000
RBLONGWT EQU   RBFLAGS1                                                 04019000
RBASIR   EQU   RBFLAGS1                                                 04020000
RBRSV159 EQU   RBFLAGS1                                                 04021000
RBABEND  EQU   RBFLAGS1                                                 04022000
RBXWAIT  EQU   RBFLAGS1                                                 04023000
RBSLOCK  EQU   RBFLAGS1                                                 04024000
RBRTRAN  EQU   RBRTPSW2+4                                               04025000
RBRTINCD EQU   RBRTICIL+2                                               04026000
RBRTILC  EQU   RBRTICIL+1                                               04027000
RBRSV160 EQU   RBRTICIL                                                 04028000
RBRTPSW1 EQU   RBRTOPSW                                                 04029000
RBRSV062 EQU   RBRSV054                                                 04030000
RBRSV061 EQU   RBRSV054                                                 04031000
RBRSV060 EQU   RBRSV054                                                 04032000
RBRSV059 EQU   RBRSV054                                                 04033000
RBRSV058 EQU   RBRSV054                                                 04034000
RBRSV057 EQU   RBRSV054                                                 04035000
RBRSV056 EQU   RBRSV054                                                 04036000
RBRSV055 EQU   RBRSV054                                                 04037000
RBRSV053 EQU   RBPREFIX+38                                              04038000
RBRSV052 EQU   RBPREFIX+36                                              04039000
RBRSV051 EQU   RBPREFIX+32                                              04040000
RBPRFXST EQU   RBPREFIX+32                                              04041000
RBRSV050 EQU   RBPREFIX+28                                              04042000
RBRSV049 EQU   RBRSV041                                                 04043000
RBRSV048 EQU   RBRSV041                                                 04044000
RBRSV047 EQU   RBRSV041                                                 04045000
RBRSV046 EQU   RBRSV041                                                 04046000
RBRSV045 EQU   RBRSV041                                                 04047000
RBRSV044 EQU   RBRSV041                                                 04048000
RBRSV043 EQU   RBRSV041                                                 04049000
RBRSV042 EQU   RBRSV041                                                 04050000
RBRSV040 EQU   RBPREFIX+26                                              04051000
RBRSV039 EQU   RBPREFIX+24                                              04052000
RBRSV038 EQU   RBPREFIX+20                                              04053000
RBRSV037 EQU   RBPREFIX+16                                              04054000
RBRSV036 EQU   RBRSV028                                                 04055000
RBRSV035 EQU   RBRSV028                                                 04056000
RBRSV034 EQU   RBRSV028                                                 04057000
RBRSV033 EQU   RBRSV028                                                 04058000
RBRSV032 EQU   RBRSV028                                                 04059000
RBRSV031 EQU   RBRSV028                                                 04060000
RBRSV030 EQU   RBRSV028                                                 04061000
RBRSV029 EQU   RBRSV028                                                 04062000
RBRSV027 EQU   RBRSV019                                                 04063000
RBRSV026 EQU   RBRSV019                                                 04064000
RBRSV025 EQU   RBRSV019                                                 04065000
RBRSV024 EQU   RBRSV019                                                 04066000
RBRSV023 EQU   RBRSV019                                                 04067000
RBRSV022 EQU   RBRSV019                                                 04068000
RBRSV021 EQU   RBRSV019                                                 04069000
RBRSV020 EQU   RBRSV019                                                 04070000
RBRSV018 EQU   RBPREFIX+13                                              04071000
RBRSV017 EQU   RBPREFIX+12                                              04072000
RBSRV016 EQU   RBPREFIX+11                                              04073000
RBRSV015 EQU   RBPREFIX+10                                              04074000
RBRSV014 EQU   RBPREFIX+8                                               04075000
RBRSV013 EQU   RBPREFIX+4                                               04076000
RBRSV012 EQU   RBPREFIX                                                 04077000
XRBREG15 EQU   RBGRS15                                                  04078000
XRBREG14 EQU   RBGRS14                                                  04079000
XRBREG13 EQU   RBGRS13                                                  04080000
XRBREG12 EQU   RBGRS12                                                  04081000
XRBREG11 EQU   RBGRS11                                                  04082000
XRBREG10 EQU   RBGRS10                                                  04083000
XRBREG9  EQU   RBGRS9                                                   04084000
XRBREG8  EQU   RBGRS8                                                   04085000
XRBREG7  EQU   RBGRS7                                                   04086000
XRBREG6  EQU   RBGRS6                                                   04087000
XRBREG5  EQU   RBGRS5                                                   04088000
XRBREG4  EQU   RBGRS4                                                   04089000
XRBREG3  EQU   RBGRS3                                                   04090000
XRBREG2  EQU   RBGRS2                                                   04091000
XRBREG1  EQU   RBGRS1                                                   04092000
XRBREG0  EQU   RBGRS0                                                   04093000
XRBLNKA  EQU   RBLINKB                                                  04094000
XRBWT    EQU   RBWCF                                                    04095000
@NM00081 EQU   RBBASIC+24                                               04096000
RBOPSWPS EQU   RBOPSWB2                                                 04097000
@NM00080 EQU   RBOPSWB2                                                 04098000
@NM00079 EQU   XRBPSW                                                   04099000
@NM00078 EQU   RBBASIC+12                                               04100000
XRBWAIT  EQU   RBECBWT                                                  04101000
XRBFRRB  EQU   RBFDYN                                                   04102000
@NM00077 EQU   XSTAB2                                                   04103000
XRBACTV  EQU   RBFACTV                                                  04104000
XRBTCBP  EQU   RBTCBNXT                                                 04105000
@NM00076 EQU   XSTAB1                                                   04106000
XRBCKPT  EQU   RBFTCKPT                                                 04107000
@NM00075 EQU   XSTAB1                                                   04108000
@NM00074 EQU   RBBASIC+8                                                04109000
@NM00073 EQU   RBEXRTNM+1                                               04110000
RBTMIND3 EQU   RBTMFLD                                                  04111000
RBTMIND2 EQU   RBTMFLD                                                  04112000
RBTMCMP  EQU   RBTMFLD                                                  04113000
RBWLIM   EQU   RBTMFLD                                                  04114000
RBRSV005 EQU   RBTMFLD                                                  04115000
RBTMTOD  EQU   RBTMFLD                                                  04116000
RBTMQUE  EQU   RBTMFLD                                                  04117000
@NM00072 EQU   RBPRFX                                                   04118000
IOBERRCT EQU   IOBSTDRD+30                                              04119000
IOBRSV19 EQU   IOBINCAM+1                                               04120000
IOBOLTST EQU   IOBBTAMF                                                 04121000
IOBRFTMG EQU   IOBBTAMF                                                 04122000
IOBRSV17 EQU   IOBBTAMF                                                 04123000
IOBRSV16 EQU   IOBBTAMF                                                 04124000
IOBRSV15 EQU   IOBBTAMF                                                 04125000
IOBRSV14 EQU   IOBBTAMF                                                 04126000
IOBINUSE EQU   IOBBTAMF                                                 04127000
IOBPRMER EQU   IOBBTAMF                                                 04128000
IOBRSTRB EQU   IOBRESTR+1                                               04129000
IOBREPOS EQU   IOBRESTR                                                 04130000
IOBDCBPB EQU   IOBDCBPT+1                                               04131000
IOBRSV44 EQU   IOBFLAG4                                                 04132000
IOBJES3I EQU   IOBFLAG4                                                 04133000
IOBRSV42 EQU   IOBFLAG4                                                 04134000
IOBRSV41 EQU   IOBFLAG4                                                 04135000
IOBRSV40 EQU   IOBFLAG4                                                 04136000
IOBPMERR EQU   IOBFLAG4                                                 04137000
IOBCC3WE EQU   IOBFLAG4                                                 04138000
IOBGDPOL EQU   IOBFLAG4                                                 04139000
IOBSTRTB EQU   IOBSTART+1                                               04140000
IOBSIOCC EQU   IOBSTART                                                 04141000
IOBCSB7  EQU   IOBCSTAT                                                 04142000
IOBCSB6  EQU   IOBCSTAT                                                 04143000
IOBCSB5  EQU   IOBCSTAT                                                 04144000
IOBCSB4  EQU   IOBCSTAT                                                 04145000
IOBCSB3  EQU   IOBCSTAT                                                 04146000
IOBCSB2  EQU   IOBCSTAT                                                 04147000
IOBCSB1  EQU   IOBCSTAT                                                 04148000
IOBCSB0  EQU   IOBCSTAT                                                 04149000
IOBUSB7  EQU   IOBUSTAT                                                 04150000
IOBUSB6  EQU   IOBUSTAT                                                 04151000
IOBUSB5  EQU   IOBUSTAT                                                 04152000
IOBUSB4  EQU   IOBUSTAT                                                 04153000
IOBUSB3  EQU   IOBUSTAT                                                 04154000
IOBUSB2  EQU   IOBUSTAT                                                 04155000
IOBUSB1  EQU   IOBUSTAT                                                 04156000
IOBUSB0  EQU   IOBUSTAT                                                 04157000
IOBCMDA  EQU   IOBIOCSW                                                 04158000
IOBLOG   EQU   IOBFL3                                                   04159000
IOBJAM   EQU   IOBICL                                                   04160000
IOBMSG   EQU   IOBFL3                                                   04161000
IOBSDR   EQU   IOBCNC                                                   04162000
IOBACU   EQU   IOBFL3                                                   04163000
IOBCDC   EQU   IOBFL3                                                   04164000
IOBICC   EQU   IOBFL3                                                   04165000
IOBCCC   EQU   IOBFL3                                                   04166000
IOBECBPB EQU   IOBECBPT+1                                               04167000
IOBECBCC EQU   IOBECBPT                                                 04168000
IOBS1B7  EQU   IOBSENS1                                                 04169000
IOBS1B6  EQU   IOBSENS1                                                 04170000
IOBS1B5  EQU   IOBSENS1                                                 04171000
IOBS1B4  EQU   IOBSENS1                                                 04172000
IOBS1B3  EQU   IOBSENS1                                                 04173000
IOBS1B2  EQU   IOBSENS1                                                 04174000
IOBS1B1  EQU   IOBSENS1                                                 04175000
IOBS1B0  EQU   IOBSENS1                                                 04176000
IOBSNSC9 EQU   IOBS0B7                                                  04177000
IOBS0B6  EQU   IOBSENS0                                                 04178000
IOBS0B5  EQU   IOBSENS0                                                 04179000
IOBS0B4  EQU   IOBSENS0                                                 04180000
IOBS0B3  EQU   IOBSENS0                                                 04181000
IOBS0B2  EQU   IOBSENS0                                                 04182000
IOBS0B1  EQU   IOBSENS0                                                 04183000
IOBS0B0  EQU   IOBSENS0                                                 04184000
IOBPNCH  EQU   IOBFLAG2                                                 04185000
IOBSTATO EQU   IOBFLAG2                                                 04186000
IOBSKUPD EQU   IOBFLAG2                                                 04187000
IOBALTTR EQU   IOBFLAG2                                                 04188000
IOBRRT2  EQU   IOBRDHA0                                                 04189000
IOBRRT3  EQU   IOBPURGE                                                 04190000
IOBSENSE EQU   IOBFLAG2                                                 04191000
IOBHALT  EQU   IOBFLAG2                                                 04192000
IOBSPSVC EQU   IOBRSTRT                                                 04193000
IOBUNREL EQU   IOBFLAG1                                                 04194000
IOBIOERR EQU   IOBFLAG1                                                 04195000
IOBFCREX EQU   IOBCYCCK                                                 04196000
IOBRPSTN EQU   IOBFLAG1                                                 04197000
IOBERRTN EQU   IOBFLAG1                                                 04198000
IOBCMDCH EQU   IOBFLAG1                                                 04199000
IOBDATCH EQU   IOBFLAG1                                                 04200000
IOBCNOPA EQU   IOBPREFX+12                                              04201000
IOBCICB  EQU   IOBPREFX+8                                               04202000
IOBCECB  EQU   IOBPREFX+4                                               04203000
IOBCONOP EQU   IOBPREFX+3                                               04204000
IOBCINOP EQU   IOBPREFX+2                                               04205000
IOBRSV05 EQU   IOBPREFX+1                                               04206000
IOBPCI   EQU   IOBCFLG1                                                 04207000
IOBRSTCH EQU   IOBCFLG1                                                 04208000
IOBABAPP EQU   IOBCFLG1                                                 04209000
IOBPTST  EQU   IOBCFLG1                                                 04210000
IOBRSV04 EQU   IOBCFLG1                                                 04211000
IOBRSV03 EQU   IOBCFLG1                                                 04212000
IOBRSV02 EQU   IOBCFLG1                                                 04213000
IOBRSV01 EQU   IOBCFLG1                                                 04214000
DSABGRID EQU   DSABGIDL+4                                               04215000
DSABLLEN EQU   DSABGIDL                                                 04216000
DSABANAM EQU   DSABANMI+1                                               04217000
DSABANML EQU   DSABANMI                                                 04218000
DSABRS04 EQU   DSAB+68                                                  04219000
DSABSIOT EQU   DSAB+64                                                  04220000
DSABRS03 EQU   DSAB+62                                                  04221000
DSABDCBM EQU   DSAB+56                                                  04222000
DSABSSCM EQU   DSAB+52                                                  04223000
DSABSSNM EQU   DSAB+48                                                  04224000
DSABPTTR EQU   DSAB+44                                                  04225000
DSABTCBP EQU   DSAB+40                                                  04226000
DSABRS02 EQU   DSAB+38                                                  04227000
@NM00047 EQU   DSABFLG4                                                 04228000
DSABCKSI EQU   DSABFLG4                                                 04229000
DSABCKVL EQU   DSABFLG4                                                 04230000
DSABCKDS EQU   DSABFLG4                                                 04231000
@NM00046 EQU   DSABFLG3                                                 04232000
DSABJSCT EQU   DSABFLG3                                                 04233000
DSABCATL EQU   DSABFLG3                                                 04234000
DSABVMSC EQU   DSABFLG3                                                 04235000
DSABVAM  EQU   DSABFLG3                                                 04236000
DSABPASS EQU   DSABFLG3                                                 04237000
DSABDEFR EQU   DSABFLG3                                                 04238000
@NM00045 EQU   DSABFLG2                                                 04239000
DSABUNAL EQU   DSABFLG2                                                 04240000
DSABIRM  EQU   DSABFLG2                                                 04241000
DSABOPEN EQU   DSABFLG2                                                 04242000
DSABNUSE EQU   DSABFLG1                                                 04243000
DSABCATM EQU   DSABFLG1                                                 04244000
DSABPCAT EQU   DSABFLG1                                                 04245000
DSABDCAT EQU   DSABFLG1                                                 04246000
DSABCONV EQU   DSABFLG1                                                 04247000
DSABDCNV EQU   DSABFLG1                                                 04248000
DSABPALC EQU   DSABFLG1                                                 04249000
DSABDALC EQU   DSABFLG1                                                 04250000
@NM00044 EQU   DSABORG2                                                 04251000
DSABTR   EQU   DSABORG2                                                 04252000
DSABAM   EQU   DSABORG2                                                 04253000
@NM00043 EQU   DSABORG2                                                 04254000
DSABTQ   EQU   DSABORG2                                                 04255000
DSABTX   EQU   DSABORG2                                                 04256000
DSABGS   EQU   DSABORG2                                                 04257000
DSABU    EQU   DSABORG1                                                 04258000
DSABPO   EQU   DSABORG1                                                 04259000
DSABMQ   EQU   DSABORG1                                                 04260000
DSABCQ   EQU   DSABORG1                                                 04261000
DSABCX   EQU   DSABORG1                                                 04262000
DSABDA   EQU   DSABORG1                                                 04263000
DSABPS   EQU   DSABORG1                                                 04264000
DSABIS   EQU   DSABORG1                                                 04265000
DSABSSVA EQU   DSAB+21                                                  04266000
DSABRS01 EQU   DSAB+20                                                  04267000
DSABOPCT EQU   DSAB+14                                                  04268000
DSABLNTH EQU   DSAB+12                                                  04269000
DSABBCHN EQU   DSAB+8                                                   04270000
DSABFCHN EQU   DSAB+4                                                   04271000
DSABID   EQU   DSAB                                                     04272000
DECWAREA EQU   DECBS04+44                                               04273000
DECWLNG  EQU   DECBS04+42                                               04274000
DECRSV56 EQU   DECBS04+40                                               04275000
DECPOLPA EQU   DECPOLPT+1                                               04276000
DECNDXPL EQU   DECPOLPT                                                 04277000
DECADRPT EQU   DECBS04+32                                               04278000
DECCSWST EQU   DECBS04+30                                               04279000
DECRSV55 EQU   DECERRST                                                 04280000
DECRSV54 EQU   DECERRST                                                 04281000
DECRSV53 EQU   DECERRST                                                 04282000
DECDSABL EQU   DECERRST                                                 04283000
DECDIAGN EQU   DECERRST                                                 04284000
DECERPER EQU   DECERRST                                                 04285000
DECUNDEF EQU   DECERRST                                                 04286000
DECSIO3  EQU   DECERRST                                                 04287000
DECTPCOD EQU   DECBS04+28                                               04288000
DECRESPN EQU   DECBS04+26                                               04289000
DECRLN   EQU   DECBS04+25                                               04290000
DECSTXNQ EQU   DECFLAGS                                                 04291000
DECSSMSG EQU   DECREVRS                                                 04292000
DECNEGRP EQU   DECFLAGS                                                 04293000
DECNOBUF EQU   DECFLAGS                                                 04294000
DECBADID EQU   DECFLAGS                                                 04295000
DECALTAC EQU   DECFLAGS                                                 04296000
DECDIFAC EQU   DECWACK                                                  04297000
DECERRMS EQU   DECWACK                                                  04298000
DECENTRA EQU   DECENTRY+1                                               04299000
DECCMCOD EQU   DECENTRY                                                 04300000
DECCOUNT EQU   DECBS04+18                                               04301000
DECSENS1 EQU   DECBS04+17                                               04302000
DECSENS0 EQU   DECBS04+16                                               04303000
@NM00042 EQU   DECBS04+12                                               04304000
DECDCBAA EQU   @NM00041+1                                               04305000
DECRSV52 EQU   DECONLTT                                                 04306000
DECRSV51 EQU   DECONLTT                                                 04307000
DECRSV50 EQU   DECONLTT                                                 04308000
DECRSV49 EQU   DECONLTT                                                 04309000
DECRSV48 EQU   DECONLTT                                                 04310000
DECRSV47 EQU   DECONLTT                                                 04311000
DECRCVMS EQU   DECONLTT                                                 04312000
DECONLTS EQU   DECONLTT                                                 04313000
@NM00040 EQU   DECBS04+6                                                04314000
@NM00039 EQU   @NM00037+1                                               04315000
DECSLNTH EQU   @NM00038                                                 04316000
DECSAREA EQU   @NM00038                                                 04317000
DECSTRME EQU   @NM00038                                                 04318000
DECRSV46 EQU   @NM00038                                                 04319000
DECRSV45 EQU   @NM00038                                                 04320000
DECRSV44 EQU   @NM00038                                                 04321000
DECRSV43 EQU   @NM00038                                                 04322000
DECRDAPL EQU   @NM00038                                                 04323000
@NM00036 EQU   DECBS04                                                  04324000
@NM00035 EQU   @NM00034+1                                               04325000
DECRSV42 EQU   @NM00034                                                 04326000
DECADRCH EQU   DECBS03+32                                               04327000
DECRSV41 EQU   DECBS03+28                                               04328000
DECRSV40 EQU   DECBS03+26                                               04329000
DECUCBDX EQU   DECBS03+25                                               04330000
DECRSV39 EQU   DECBS03+24                                               04331000
DECCPOLA EQU   DECCPOL+1                                                04332000
DECNMMSG EQU   DECCPOL                                                  04333000
DECRSV38 EQU   DECBS03+16                                               04334000
@NM00033 EQU   DECBS03+12                                               04335000
@NM00032 EQU   DECBS03+8                                                04336000
@NM00031 EQU   DECBS03+6                                                04337000
DECOPCOD EQU   DECBS03+5                                                04338000
DECRSV37 EQU   DECBS03+4                                                04339000
LINEDECB EQU   DECBS03                                                  04340000
DECNAA   EQU   DECNA+1                                                  04341000
DECRSV36 EQU   DECNA                                                    04342000
DECRECPT EQU   DECBS02+24                                               04343000
DECKYADR EQU   DECBS02+20                                               04344000
@NM00030 EQU   DECBS02+16                                               04345000
@NM00029 EQU   DECBS02+12                                               04346000
@NM00028 EQU   DECBS02+8                                                04347000
@NM00027 EQU   DECBS02+6                                                04348000
DECRSV35 EQU   @NM00026                                                 04349000
DECWRADD EQU   @NM00026                                                 04350000
DECSRKEY EQU   @NM00026                                                 04351000
DECOPRD  EQU   @NM00026                                                 04352000
DECTYPR  EQU   DECTYPRU                                                 04353000
DECTYPU  EQU   DECTYPRU                                                 04354000
DECBKLNS EQU   @NM00026                                                 04355000
DECKEYS  EQU   @NM00026                                                 04356000
DECRELBA EQU   @NM00025                                                 04357000
DECRDEX  EQU   @NM00025                                                 04358000
DECDYNBF EQU   @NM00025                                                 04359000
DECACTAD EQU   @NM00025                                                 04360000
DECFDBCK EQU   @NM00025                                                 04361000
DECEXSRC EQU   @NM00025                                                 04362000
DECOFLOW EQU   @NM00025                                                 04363000
DECVERFY EQU   @NM00025                                                 04364000
DECRSV34 EQU   @NM00022+3                                               04365000
DECCCKFF EQU   DECCC3                                                   04366000
DECCCOPT EQU   DECCC3                                                   04367000
DECCCSDK EQU   DECCC3                                                   04368000
DECCCWDI EQU   DECCC3                                                   04369000
DECCCNBK EQU   DECCC3                                                   04370000
DECCCEXS EQU   DECCC3                                                   04371000
DECCCWRI EQU   DECCC3                                                   04372000
DECRSV33 EQU   DECCC3                                                   04373000
DECCCREX EQU   DECCC2                                                   04374000
DECCCUER EQU   DECCC2                                                   04375000
DECCCEOD EQU   DECCC2                                                   04376000
DECCCERR EQU   DECCC2                                                   04377000
DECCCINV EQU   DECCC2                                                   04378000
DECCCNSP EQU   DECCC2                                                   04379000
DECCCRLC EQU   DECCC2                                                   04380000
DECCCRNF EQU   DECCC2                                                   04381000
@NM00023 EQU   @NM00022                                                 04382000
DECEXRKU EQU   DECBEXC2                                                 04383000
DECEXASR EQU   DECBEXC2                                                 04384000
DECRSV32 EQU   DECBEXC2                                                 04385000
DECRSV31 EQU   DECBEXC2                                                 04386000
DECRSV30 EQU   DECBEXC2                                                 04387000
DECRSV29 EQU   DECBEXC2                                                 04388000
DECRSV28 EQU   DECBEXC2                                                 04389000
DECRSV27 EQU   DECBEXC2                                                 04390000
DECEXDUP EQU   DECBEXC1                                                 04391000
DECEXOFL EQU   DECBEXC1                                                 04392000
DECEXUBK EQU   DECBEXC1                                                 04393000
DECEXERR EQU   DECBEXC1                                                 04394000
DECEXINV EQU   DECBEXC1                                                 04395000
DECEXNSP EQU   DECBEXC1                                                 04396000
DECEXRLC EQU   DECBEXC1                                                 04397000
DECEXRNF EQU   DECBEXC1                                                 04398000
DECBKEY  EQU   DECBS01+20                                               04399000
DECBLOGR EQU   DECBS01+16                                               04400000
DECBAREA EQU   DECBS01+12                                               04401000
DECBDCBA EQU   DECBS01+8                                                04402000
DECBLGTH EQU   DECBS01+6                                                04403000
DECRSV26 EQU   DECBTYP2                                                 04404000
DECRSV25 EQU   DECBTYP2                                                 04405000
DECBWRKN EQU   DECBTYP2                                                 04406000
DECBWRK  EQU   DECBTYP2                                                 04407000
DECRSV24 EQU   DECBTYP2                                                 04408000
DECBRDKU EQU   DECBTYP2                                                 04409000
DECRSV23 EQU   DECBTYP2                                                 04410000
DECBRDK  EQU   DECBTYP2                                                 04411000
DECBARS  EQU   DECBTYP1                                                 04412000
DECBLNS  EQU   DECBTYP1                                                 04413000
DECRSV22 EQU   DECBTYP1                                                 04414000
DECRSV21 EQU   DECBTYP1                                                 04415000
DECRSV20 EQU   DECBTYP1                                                 04416000
DECRSV19 EQU   DECBTYP1                                                 04417000
DECRSV18 EQU   DECBTYP1                                                 04418000
DECRSV17 EQU   DECBTYP1                                                 04419000
DECBRBA  EQU   DECBRB+1                                                 04420000
DECRSV16 EQU   DECBECBF                                                 04421000
DECRSV15 EQU   DECBECBF                                                 04422000
DECRSV14 EQU   DECBECBF                                                 04423000
DECRSV13 EQU   DECBECBF                                                 04424000
DECRSV12 EQU   DECBECBF                                                 04425000
DECRSV11 EQU   DECBECBF                                                 04426000
DECBPOST EQU   DECBECBF                                                 04427000
DECBWAIT EQU   DECBECBF                                                 04428000
DECNEXTA EQU   DECNEXT+1                                                04429000
DECRSV10 EQU   DECNEXT                                                  04430000
DECIOBPT EQU   DECB+16                                                  04431000
DECAREA  EQU   DECB+12                                                  04432000
DECDCBAD EQU   DECB+8                                                   04433000
DECLNGTH EQU   DECBPTR+2                                                04434000
DECWRSFR EQU   DECTYPE2                                                 04435000
DECRSV09 EQU   DECTYPE2                                                 04436000
DECWRSZ  EQU   DECTYPE2                                                 04437000
DECRSV08 EQU   DECTYPE2                                                 04438000
DECWRSD  EQU   DECTYPE2                                                 04439000
DECWRSF  EQU   DECTYPE2                                                 04440000
DECRDSB  EQU   DECTYPE2                                                 04441000
DECRDSF  EQU   DECTYPE2                                                 04442000
DECRSV07 EQU   DECTYPE1                                                 04443000
DECRSV06 EQU   DECTYPE1                                                 04444000
DECRSV05 EQU   DECTYPE1                                                 04445000
DECRSV04 EQU   DECTYPE1                                                 04446000
DECRSV03 EQU   DECTYPE1                                                 04447000
DECRSV02 EQU   DECTYPE1                                                 04448000
DECRSV01 EQU   DECTYPE1                                                 04449000
DECLNS   EQU   DECTYPE1                                                 04450000
DECSDECB EQU   DECB                                                     04451000
DEBXSAMB EQU   DEBXTN+28                                                04452000
DEBXOPNJ EQU   DEBXTN+24                                                04453000
DEBXMCF2 EQU   DEBXTN+19                                                04454000
DEBXMCF1 EQU   DEBXTN+18                                                04455000
DEBXDSO2 EQU   DEBXTN+17                                                04456000
DEBXDSO1 EQU   DEBXTN+16                                                04457000
DEBXDBPR EQU   DEBXTN+12                                                04458000
DEBXDCBM EQU   DEBXTN+8                                                 04459000
DEBXRV48 EQU   DEBXTN+3                                                 04460000
DEBXRV47 EQU   DEBXFLG1                                                 04461000
DEBXRV46 EQU   DEBXFLG1                                                 04462000
DEBXRV45 EQU   DEBXFLG1                                                 04463000
DEBXRV44 EQU   DEBXFLG1                                                 04464000
DEBXRV43 EQU   DEBXFLG1                                                 04465000
DEBXDSSI EQU   DEBXFLG1                                                 04466000
DEBXTSKC EQU   DEBXFLG1                                                 04467000
DEBXCDCB EQU   DEBXFLG1                                                 04468000
DEBXLNGH EQU   DEBXTN                                                   04469000
DEBAMTYP EQU   DEBPREFX+13                                              04470000
DEBLNGTH EQU   DEBPREFX+12                                              04471000
DEBDCBMK EQU   DEBXTNP                                                  04472000
DEBDSCBA EQU   DEBPREFX+1                                               04473000
DEBWKARA EQU   DEBPREFX                                                 04474000
DEBXCEAD EQU   DEBXCEA+1                                                04475000
DEBXCENP EQU   DEBXCEAB                                                 04476000
DEBRSV35 EQU   DEBXCEAB                                                 04477000
DEBRSV34 EQU   DEBXCEAB                                                 04478000
DEBRSV33 EQU   DEBXCEAB                                                 04479000
DEBRSV32 EQU   DEBXCEAB                                                 04480000
DEBCEAD  EQU   DEBCEA+1                                                 04481000
DEBCENP  EQU   DEBCEAB                                                  04482000
DEBRSV31 EQU   DEBCEAB                                                  04483000
DEBRSV30 EQU   DEBCEAB                                                  04484000
DEBRSV29 EQU   DEBCEAB                                                  04485000
DEBRSV28 EQU   DEBCEAB                                                  04486000
DEBPCIAD EQU   DEBPCIA+1                                                04487000
DEBPCINP EQU   DEBPCIAB                                                 04488000
DEBRSV27 EQU   DEBPCIAB                                                 04489000
DEBRSV26 EQU   DEBPCIAB                                                 04490000
DEBRSV25 EQU   DEBPCIAB                                                 04491000
DEBRSV24 EQU   DEBPCIAB                                                 04492000
DEBSIOAD EQU   DEBSIOA+1                                                04493000
DEBSIONP EQU   DEBSIOAB                                                 04494000
DEBFIX   EQU   DEBSIOAB                                                 04495000
DEBIOVR  EQU   DEBSIOAB                                                 04496000
DEBSIOX  EQU   DEBSIOAB                                                 04497000
DEBPGFX  EQU   DEBSIOAB                                                 04498000
DEBEOEAD EQU   DEBEOEA+1                                                04499000
DEBEOENP EQU   DEBEOEAB                                                 04500000
DEBRSV22 EQU   DEBEOEAB                                                 04501000
DEBRSV21 EQU   DEBEOEAB                                                 04502000
DEBRSV20 EQU   DEBEOEAB                                                 04503000
DEBESMVR EQU   DEBEOEAB                                                 04504000
DEBSUBID EQU   DEBSUBNM                                                 04505000
DEBSIOA2 EQU   DEBACS08+24                                              04506000
DEBRPSIO EQU   DEBACS08+20                                              04507000
DEBFREED EQU   DEBACS08+16                                              04508000
@NM00021 EQU   DEBACS08+12                                              04509000
@NM00020 EQU   DEBACS08+8                                               04510000
DEBDISAD EQU   DEBACS08+4                                               04511000
@NM00019 EQU   DEBACS08                                                 04512000
DEBRPSST EQU   DEBACS07+64                                              04513000
DEBARECK EQU   DEBACS07+60                                              04514000
DEBAREWT EQU   DEBACS07+56                                              04515000
DEBACHK  EQU   DEBACS07+52                                              04516000
DEBAWRIT EQU   DEBACS07+48                                              04517000
DEBASETL EQU   DEBACS07+44                                              04518000
DEBAREAD EQU   DEBACS07+40                                              04519000
DEBCRECK EQU   DEBACS07+36                                              04520000
DEBCREWT EQU   DEBACS07+32                                              04521000
DEBCCHK  EQU   DEBACS07+28                                              04522000
DEBCWRIT EQU   DEBACS07+24                                              04523000
DEBCSETL EQU   DEBACS07+20                                              04524000
DEBCREAD EQU   DEBACS07+16                                              04525000
DEBWKPT5 EQU   DEBACS07+12                                              04526000
DEBWKPT4 EQU   DEBACS07+8                                               04527000
DEBGET   EQU   DEBACS07+4                                               04528000
@NM00018 EQU   DEBACS07                                                 04529000
DEBPUT   EQU   DEBACS06+4                                               04530000
DEBDCBFA EQU   DEBACS06                                                 04531000
DEBLUCBB EQU   DEBLUCBA+1                                               04532000
DEBRSV18 EQU   DEBLUCBA                                                 04533000
DEBFUCBB EQU   DEBFUCBA+1                                               04534000
DEBRSV17 EQU   DEBFUCBA                                                 04535000
DEBTCCWB EQU   DEBTCCWA+1                                               04536000
DEBRSV16 EQU   DEBTCCWA                                                 04537000
DEBTBFRB EQU   DEBTBFRA+1                                               04538000
DEBRSV15 EQU   DEBTBFRA                                                 04539000
DEBDBPEF EQU   DEBACS03+8                                               04540000
DEBDBPP  EQU   DEBACS03+4                                               04541000
DEBDTPP  EQU   DEBACS03                                                 04542000
DEBDBPE  EQU   DEBDBLK+1                                                04543000
DEBDBPT  EQU   DEBDBLK                                                  04544000
DEBEXTNM EQU   DEBDSNAM                                                 04545000
DEBLRECL EQU   DEBACSMD+14                                              04546000
DEBBLKSI EQU   DEBACSMD+12                                              04547000
DEBRSV14 EQU   DEBDSNM+4                                                04548000
DEBUTSAB EQU   DEBUTSAA+1                                               04549000
DEBRSV13 EQU   DEBUTSAA                                                 04550000
DEBVOLNM EQU   DEBACSMD+2                                               04551000
DEBVLSEQ EQU   DEBVOLSQ+1                                               04552000
DEBRSV42 EQU   DEBVOLBT                                                 04553000
DEBRSV41 EQU   DEBVOLBT                                                 04554000
DEBRSV40 EQU   DEBVOLBT                                                 04555000
DEBRSV39 EQU   DEBVOLBT                                                 04556000
DEBRSV38 EQU   DEBVOLBT                                                 04557000
DEBRSV37 EQU   DEBVOLBT                                                 04558000
DEBRSV36 EQU   DEBVOLBT                                                 04559000
DEBEXFUL EQU   DEBVOLBT                                                 04560000
DEBNMTRK EQU   DEBDASD+14                                               04561000
DEBENDHH EQU   DEBDASD+12                                               04562000
DEBENDCC EQU   DEBDASD+10                                               04563000
DEBSTRHH EQU   DEBDASD+8                                                04564000
DEBSTRCC EQU   DEBDASD+6                                                04565000
DEBBINUM EQU   DEBDASD+4                                                04566000
DEBUCBA  EQU   DEBUCBAD+1                                               04567000
DEBDVMOD EQU   DEBUCBAD                                                 04568000
DEBAPPB  EQU   DEBAPPAD+1                                               04569000
DEBEXSCL EQU   DEBAPPAD                                                 04570000
DEBDEBID EQU   DEBPROTG                                                 04571000
DEBECBB  EQU   DEBECBAD+1                                               04572000
DEBPRIOR EQU   DEBECBAD                                                 04573000
DEBUSRPB EQU   DEBUSRPG+1                                               04574000
DEBNMEXT EQU   DEBUSRPG                                                 04575000
DEBRSV05 EQU   DEBBASIC+15                                              04576000
DEBXTNIN EQU   DEBFLGS1                                                 04577000
DEBAPFIN EQU   DEBFLGS1                                                 04578000
DEBF1CEV EQU   DEBFLGS1                                                 04579000
DEBCINDI EQU   DEBFLGS1                                                 04580000
DEBRSV02 EQU   DEBFLGS1                                                 04581000
DEBRSIOA EQU   DEBFLGS1                                                 04582000
DEBEOFDF EQU   DEBFLGS1                                                 04583000
DEBPWCKD EQU   DEBFLGS1                                                 04584000
DEBQSCNT EQU   DEBBASIC+13                                              04585000
DEBACCS  EQU   DEBOPATB                                                 04586000
DEBPOSIT EQU   DEBOPATB                                                 04587000
DEBZERO  EQU   DEBOPATB                                                 04588000
DEBABEND EQU   DEBOPATB                                                 04589000
DEBIRBB  EQU   DEBIRBAD+1                                               04590000
DEBRERR  EQU   DEBOFLGS                                                 04591000
DEBLABEL EQU   DEBOFLGS                                                 04592000
DEBSPLIT EQU   DEBOFLGS                                                 04593000
DEBDCB   EQU   DEBOFLGS                                                 04594000
DEBRLSE  EQU   DEBOFLGS                                                 04595000
DEBEOF   EQU   DEBOFLGS                                                 04596000
DEBDISP  EQU   DEBOFLGS                                                 04597000
DEBDEBB  EQU   DEBDEBAD+1                                               04598000
DEBAMLNG EQU   DEBDEBAD                                                 04599000
DEBNMSUB EQU   DEBTCBAD                                                 04600000
DCBDYNB  EQU   IHADCS30+48                                              04601000
DCBDFBK  EQU   IHADCS30+44                                              04602000
DCBDFOR  EQU   IHADCS30+40                                              04603000
DCBDRDXA EQU   DCBDRDX+1                                                04604000
DCBMVXNO EQU   DCBDRDX                                                  04605000
DCBXARGA EQU   DCBXARG+1                                                04606000
DCBXCNT  EQU   DCBXARG                                                  04607000
DCBLIMCT EQU   IHADCS30+29                                              04608000
@NM00017 EQU   IHADCS30+28                                              04609000
DCBUQND  EQU   IHADCS30+24                                              04610000
DCBIOBUQ EQU   IHADCS30+20                                              04611000
DCBSQND  EQU   IHADCS30+16                                              04612000
DCBIOBSQ EQU   IHADCS30+12                                              04613000
DCBBLKSI EQU   IHADCS30+10                                              04614000
@NM00016 EQU   IHADCS30+8                                               04615000
DCBSYNAD EQU   IHADCS30+4                                               04616000
DCBCHCKA EQU   DCBCHECK+1                                               04617000
DCBOPTRB EQU   DCBOPTCD                                                 04618000
DCBOPTRE EQU   DCBOPTCD                                                 04619000
DCBOPTDB EQU   DCBOPTCD                                                 04620000
DCBOPTA  EQU   DCBOPTCD                                                 04621000
DCBOPTF  EQU   DCBOPTCD                                                 04622000
DCBOPTE  EQU   DCBOPTCD                                                 04623000
DCBOPTTO EQU   DCBOPTCD                                                 04624000
DCBOPTW  EQU   DCBOPTCD                                                 04625000
DCBREADA EQU   DCBWRITA                                                 04626000
@NM00015 EQU   DCBREAD                                                  04627000
@NM00014 EQU   DCBIFLGS                                                 04628000
DCBIFIOE EQU   DCBIFLGS                                                 04629000
DCBCH12  EQU   DCBIFPCT                                                 04630000
DCBCH9   EQU   DCBIFPCT                                                 04631000
DCBIFEC  EQU   DCBIFLGS                                                 04632000
DCBMFSTI EQU   DCBMFDMD                                                 04633000
DCBMFAWR EQU   DCBMFSTK                                                 04634000
DCBMFUIP EQU   DCBMFTMD                                                 04635000
DCBMFIDW EQU   DCBMFLCP                                                 04636000
DCBMFWRK EQU   DCBMFMVP                                                 04637000
DCBMFRDQ EQU   DCBMFWRT                                                 04638000
DCBMFGTQ EQU   DCBMFPUT                                                 04639000
DCBMFSTL EQU   DCBMACF2                                                 04640000
DCBMFCK  EQU   DCBMFDMG                                                 04641000
DCBMFRDX EQU   DCBMFCHK                                                 04642000
DCBMFDBF EQU   DCBMFSBG                                                 04643000
DCBMFRDI EQU   DCBMFLCG                                                 04644000
DCBMFRDK EQU   DCBMFMVG                                                 04645000
DCBMFWRQ EQU   DCBMFRD                                                  04646000
DCBMFPTQ EQU   DCBMFGET                                                 04647000
DCBMFECP EQU   DCBMACF1                                                 04648000
DCBTIOT  EQU   IHADCS25                                                 04649000
DCBMRSTI EQU   DCBMRDMD                                                 04650000
DCBMRAWR EQU   DCBMRSTK                                                 04651000
DCBMRUIP EQU   DCBMRTMD                                                 04652000
DCBMRIDW EQU   DCBMRLCP                                                 04653000
DCBMRWRK EQU   DCBMRMVP                                                 04654000
DCBMRRDQ EQU   DCBMRWRT                                                 04655000
DCBMRGTQ EQU   DCBMRPUT                                                 04656000
DCBMRSTL EQU   DCBMACR2                                                 04657000
DCBPGFXA EQU   DCBMRRDX                                                 04658000
DCBMRDBF EQU   DCBMRSBG                                                 04659000
DCBMRRDI EQU   DCBMRLCG                                                 04660000
DCBMRRDK EQU   DCBMRMVG                                                 04661000
DCBMRWRQ EQU   DCBMRRD                                                  04662000
DCBMRPTQ EQU   DCBMRGET                                                 04663000
DCBMRECP EQU   DCBMACR1                                                 04664000
@NM00013 EQU   DCBIFLG                                                  04665000
DCBIBIOE EQU   DCBIFLG                                                  04666000
DCBICH12 EQU   DCBIBPCT                                                 04667000
DCBICH9  EQU   DCBIBPCT                                                 04668000
DCBIBEC  EQU   DCBIFLG                                                  04669000
DCBOFIOF EQU   DCBOFLGS                                                 04670000
DCBOFUEX EQU   DCBOFLGS                                                 04671000
DCBOFTM  EQU   DCBOFLGS                                                 04672000
DCBOFPPC EQU   DCBOFLGS                                                 04673000
DCBOFOPN EQU   DCBOFLGS                                                 04674000
DCBOFEOV EQU   DCBOFLGS                                                 04675000
DCBOFLRB EQU   DCBOFLGS                                                 04676000
DCBOFIOD EQU   DCBOFLWR                                                 04677000
DCBDDNAM EQU   IHADCS24                                                 04678000
DCBEXLSA EQU   DCBEXLST+1                                               04679000
DCBRECKL EQU   DCBRECFM                                                 04680000
DCBRECCC EQU   DCBRECFM                                                 04681000
DCBRECSB EQU   DCBRECFM                                                 04682000
DCBRECBR EQU   DCBRECFM                                                 04683000
DCBRECTO EQU   DCBRECLA                                                 04684000
DCBRECL  EQU   DCBRECLA                                                 04685000
DCBEODA  EQU   DCBEODAD+1                                               04686000
DCBBFA   EQU   DCBBFTEK                                                 04687000
DCBH0    EQU   DCBBFTEK                                                 04688000
DCBBFTKD EQU   DCBBFTEK                                                 04689000
DCBBFTE  EQU   DCBBFT                                                   04690000
DCBBFTKR EQU   DCBBFT                                                   04691000
DCBBFTS  EQU   DCBBFT                                                   04692000
DCBH1    EQU   DCBBFTEK                                                 04693000
DCBSVCXA EQU   DCBSVCXL+1                                               04694000
@NM00012 EQU   DCBSVCXL                                                 04695000
DCBODEBA EQU   DCBIOBAA                                                 04696000
@NM00011 EQU   DCBQSLM                                                  04697000
DCBUPDBT EQU   DCBQSLM                                                  04698000
DCBUPDCM EQU   DCBQSLM                                                  04699000
DCB1DVDS EQU   DCBQSLM                                                  04700000
@NM00010 EQU   DCBDSRG2                                                 04701000
DCBDSGTR EQU   DCBDSRG2                                                 04702000
DCBACBM  EQU   DCBDSRG2                                                 04703000
@NM00009 EQU   DCBDSRG2                                                 04704000
DCBDSGTQ EQU   DCBDSRG2                                                 04705000
DCBDSGTX EQU   DCBDSRG2                                                 04706000
DCBDSGGS EQU   DCBDSRG2                                                 04707000
DCBDSGU  EQU   DCBDSRG1                                                 04708000
DCBDSGPO EQU   DCBDSRG1                                                 04709000
@NM00008 EQU   DCBDSRG1                                                 04710000
@NM00007 EQU   DCBDSRG1                                                 04711000
DCBDSGCX EQU   DCBDSRG1                                                 04712000
DCBDSGDA EQU   DCBDSRG1                                                 04713000
DCBDSGPS EQU   DCBDSRG1                                                 04714000
DCBDSGIS EQU   DCBDSRG1                                                 04715000
DCBBUFL  EQU   IHADCS11+8                                               04716000
DCBBUFCA EQU   DCBBUFCB+1                                               04717000
DCBBUFNO EQU   DCBBUFCB                                                 04718000
DCBDEVT  EQU   DCBREL                                                   04719000
DCBKEYLE EQU   DCBRELB                                                  04720000
DCBTRBAL EQU   IHADCS01+6                                               04721000
@NM00006 EQU   IHADCS01+5                                               04722000
@NM00005 EQU   IHADCS01+4                                               04723000
DCBDVTBA EQU   DCBDVTBL+1                                               04724000
@NM00004 EQU   DCBDVTBL                                                 04725000
DCBKEYCN EQU   IHADCS00+4                                               04726000
DCBRELAD EQU   IHADCS00                                                 04727000
@NM00003 EQU   IHADCB                                                   04728000
CVTLEVL  EQU   CVTRELNO+2                                               04729000
CVTNUMB  EQU   CVTRELNO                                                 04730000
CVTMDL   EQU   CVTFIX+250                                               04731000
@NM00002 EQU   CVTFIX+248                                               04732000
@NM00001 EQU   CVTFIX                                                   04733000
CVTRV482 EQU   CVTXTNT2+128                                             04734000
CVTRV481 EQU   CVTXTNT2+124                                             04735000
CVTRV480 EQU   CVTXTNT2+120                                             04736000
CVTRV479 EQU   CVTXTNT2+118                                             04737000
CVTRV478 EQU   CVTXTNT2+117                                             04738000
CVTRV477 EQU   CVTXTNT2+116                                             04739000
CVTRV476 EQU   CVTXTNT2+115                                             04740000
CVTRV475 EQU   CVTXTNT2+114                                             04741000
CVTRV474 EQU   CVTRV466                                                 04742000
CVTRV473 EQU   CVTRV466                                                 04743000
CVTRV472 EQU   CVTRV466                                                 04744000
CVTRV471 EQU   CVTRV466                                                 04745000
CVTRV470 EQU   CVTRV466                                                 04746000
CVTRV469 EQU   CVTRV466                                                 04747000
CVTRV468 EQU   CVTRV466                                                 04748000
CVTRV467 EQU   CVTRV466                                                 04749000
CVTRV465 EQU   CVTRV457                                                 04750000
CVTRV464 EQU   CVTRV457                                                 04751000
CVTRV463 EQU   CVTRV457                                                 04752000
CVTRV462 EQU   CVTRV457                                                 04753000
CVTRV461 EQU   CVTRV457                                                 04754000
CVTRV460 EQU   CVTRV457                                                 04755000
CVTRV459 EQU   CVTRV457                                                 04756000
CVTRV458 EQU   CVTRV457                                                 04757000
CVTRV456 EQU   CVTXTNT2+108                                             04758000
CVTRV455 EQU   CVTXTNT2+104                                             04759000
CVTRV454 EQU   CVTXTNT2+100                                             04760000
CVTRV453 EQU   CVTXTNT2+96                                              04761000
CVTRV452 EQU   CVTXTNT2+94                                              04762000
CVTRV451 EQU   CVTXTNT2+92                                              04763000
CVTRV450 EQU   CVTXTNT2+90                                              04764000
CVTRV449 EQU   CVTXTNT2+88                                              04765000
CVTRV448 EQU   CVTXTNT2+87                                              04766000
CVTRV447 EQU   CVTXTNT2+86                                              04767000
CVTRV446 EQU   CVTRV438                                                 04768000
CVTRV445 EQU   CVTRV438                                                 04769000
CVTRV444 EQU   CVTRV438                                                 04770000
CVTRV443 EQU   CVTRV438                                                 04771000
CVTRV442 EQU   CVTRV438                                                 04772000
CVTRV441 EQU   CVTRV438                                                 04773000
CVTRV440 EQU   CVTRV438                                                 04774000
CVTRV439 EQU   CVTRV438                                                 04775000
CVTRV437 EQU   CVTRV429                                                 04776000
CVTRV436 EQU   CVTRV429                                                 04777000
CVTRV435 EQU   CVTRV429                                                 04778000
CVTRV434 EQU   CVTRV429                                                 04779000
CVTRV433 EQU   CVTRV429                                                 04780000
CVTRV432 EQU   CVTRV429                                                 04781000
CVTRV431 EQU   CVTRV429                                                 04782000
CVTRV430 EQU   CVTRV429                                                 04783000
CVTRV428 EQU   CVTXTNT2+80                                              04784000
CVTRV427 EQU   CVTXTNT2+76                                              04785000
CVTRV426 EQU   CVTXTNT2+72                                              04786000
CVTRV425 EQU   CVTXTNT2+68                                              04787000
CVTATACT EQU   CVTATCVT                                                 04788000
CVTRV423 EQU   CVTXTNT2+62                                              04789000
CVTRV422 EQU   CVTXTNT2+60                                              04790000
CVTRV421 EQU   CVTXTNT2+58                                              04791000
CVTRV420 EQU   CVTXTNT2+56                                              04792000
CVTRV419 EQU   CVTXTNT2+55                                              04793000
CVTRV418 EQU   CVTXTNT2+54                                              04794000
CVTRV417 EQU   CVTRV409                                                 04795000
CVTRV416 EQU   CVTRV409                                                 04796000
CVTRV415 EQU   CVTRV409                                                 04797000
CVTRV414 EQU   CVTRV409                                                 04798000
CVTRV413 EQU   CVTRV409                                                 04799000
CVTRV412 EQU   CVTRV409                                                 04800000
CVTRV411 EQU   CVTRV409                                                 04801000
CVTRV410 EQU   CVTRV409                                                 04802000
CVTRV408 EQU   CVTRV400                                                 04803000
CVTRV407 EQU   CVTRV400                                                 04804000
CVTRV406 EQU   CVTRV400                                                 04805000
CVTRV405 EQU   CVTRV400                                                 04806000
CVTRV404 EQU   CVTRV400                                                 04807000
CVTRV403 EQU   CVTRV400                                                 04808000
CVTRV402 EQU   CVTRV400                                                 04809000
CVTRV401 EQU   CVTRV400                                                 04810000
CVTICB   EQU   CVTXTNT2+48                                              04811000
CVTSKTA  EQU   CVTXTNT2+44                                              04812000
CVTCCVT  EQU   CVTXTNT2+40                                              04813000
CVTRSV98 EQU   CVTXTNT2+36                                              04814000
CVTRSV97 EQU   CVTXTNT2+34                                              04815000
CVTRSV96 EQU   CVTXTNT2+32                                              04816000
CVTOLTEP EQU   CVTXTNT2+28                                              04817000
CVTQIDA  EQU   CVTQID+1                                                 04818000
CVTRSV95 EQU   CVTQID                                                   04819000
CVTRSV94 EQU   CVTXTNT2+20                                              04820000
CVTRSV93 EQU   CVTXTNT2+16                                              04821000
CVTRSV92 EQU   CVTXTNT2+12                                              04822000
CVTRSV91 EQU   CVTXTNT2+6                                               04823000
CVTRSV9H EQU   CVTFLGBT                                                 04824000
CVTRSV9G EQU   CVTFLGBT                                                 04825000
CVTRSV9F EQU   CVTFLGBT                                                 04826000
CVTRSV9E EQU   CVTFLGBT                                                 04827000
CVTRSV9D EQU   CVTFLGBT                                                 04828000
CVTRSV9C EQU   CVTFLGBT                                                 04829000
CVTVME   EQU   CVTFLGBT                                                 04830000
CVTNPE   EQU   CVTFLGBT                                                 04831000
CVTNUCLS EQU   CVTXTNT2+4                                               04832000
CVTDSSVA EQU   CVTDSSV+1                                                04833000
CVTRSV89 EQU   CVTDSSV                                                  04834000
CVTRSV88 EQU   CVTXTNT1+8                                               04835000
CVTRSV87 EQU   CVTXTNT1+4                                               04836000
CVTFACHN EQU   CVTXTNT1                                                 04837000
CVTRV488 EQU   CVTMAP+412                                               04838000
CVTRV487 EQU   CVTMAP+408                                               04839000
CVTRV486 EQU   CVTMAP+404                                               04840000
CVTRV485 EQU   CVTMAP+400                                               04841000
CVTACTAP EQU   CVTMAP+396                                               04842000
CVTAUTH  EQU   CVTMAP+392                                               04843000
CVTATMCA EQU   CVTATMCT+1                                               04844000
CVTATMST EQU   CVTATMCT                                                 04845000
CVTRSV61 EQU   CVTMAP+384                                               04846000
CVTVOLT1 EQU   CVTVOLM1+1                                               04847000
CVTVOLI1 EQU   CVTVOLF1                                                 04848000
CVTSTOA  EQU   CVTMAP+376                                               04849000
CVTRSV58 EQU   CVTMAP+374                                               04850000
CVTRSV57 EQU   CVTMAP+372                                               04851000
CVTDDCE  EQU   CVTMAP+368                                               04852000
CVTPNWFR EQU   CVTMAP+364                                               04853000
CVTSMF   EQU   CVTMAP+360                                               04854000
CVTSULK  EQU   CVTMAP+358                                               04855000
CVTSLKO  EQU   CVTSYSK                                                  04856000
CVTSLKP  EQU   CVTSYSK                                                  04857000
CVTSLKQ  EQU   CVTSYSK                                                  04858000
CVTSLKR  EQU   CVTSYSK                                                  04859000
CVTRSV56 EQU   CVTSYSK                                                  04860000
CVTRSV55 EQU   CVTSYSK                                                  04861000
CVTRSV54 EQU   CVTSYSK                                                  04862000
CVTRSV53 EQU   CVTSYSK                                                  04863000
CVTRSV52 EQU   CVTA1F1                                                  04864000
CVTRSV51 EQU   CVTA1F1                                                  04865000
CVTRSV50 EQU   CVTA1F1                                                  04866000
CVTRSV49 EQU   CVTA1F1                                                  04867000
CVTRSV48 EQU   CVTA1F1                                                  04868000
CVTRSV47 EQU   CVTA1F1                                                  04869000
CVTSRSW  EQU   CVTA1F1                                                  04870000
CVTPFSW  EQU   CVTA1F1                                                  04871000
CVTPCVT  EQU   CVTMAP+352                                               04872000
CVTRSV46 EQU   CVTMAP+344                                               04873000
CVTRSV45 EQU   CVTMAP+340                                               04874000
CVTRSV44 EQU   CVTMAP+338                                               04875000
CVTRSV43 EQU   CVTMAP+336                                               04876000
CVTHJESA EQU   CVTHJES+1                                                04877000
CVTRSV42 EQU   CVTHJES                                                  04878000
CVTEXT2A EQU   CVTEXT2+1                                                04879000
CVTRSV41 EQU   CVTEXT2                                                  04880000
CVTAPFA  EQU   CVTAPF+1                                                 04881000
CVTRSV40 EQU   CVTAPF                                                   04882000
CVTRV518 EQU   CVTINTLA                                                 04883000
CVTRV517 EQU   CVTERPV                                                  04884000
CVTEORM  EQU   CVTMAP+312                                               04885000
CVTMCHPR EQU   CVTMAP+308                                               04886000
CVTTZ    EQU   CVTMAP+304                                               04887000
CVTJEPS  EQU   CVTMAP+300                                               04888000
CVTJESCT EQU   CVTMAP+296                                               04889000
CVTMODE  EQU   CVTMAP+292                                               04890000
CVTPTRV  EQU   CVTMAP+288                                               04891000
CVTREAL  EQU   CVTMAP+284                                               04892000
CVTRSV39 EQU   CVTMAP+280                                               04893000
CVTRSV38 EQU   CVTMAP+276                                               04894000
CVTDMSRA EQU   CVTDMSR+1                                                04895000
CVTRV634 EQU   CVTDMSRF                                                 04896000
CVTRV633 EQU   CVTDMSRF                                                 04897000
CVTRV632 EQU   CVTDMSRF                                                 04898000
CVTRV631 EQU   CVTDMSRF                                                 04899000
CVTRV630 EQU   CVTDMSRF                                                 04900000
CVTRV629 EQU   CVTDMSRF                                                 04901000
CVTUDUMP EQU   CVTDMSRF                                                 04902000
CVTSDUMP EQU   CVTDMSRF                                                 04903000
CVTQMSGA EQU   CVTQMSG+1                                                04904000
CVTRSV36 EQU   CVTQMSG                                                  04905000
CVTAMFF  EQU   CVTMAP+264                                               04906000
CVTPURGA EQU   CVTPURG+1                                                04907000
CVTRSV35 EQU   CVTPURG                                                  04908000
CVTCBSP  EQU   CVTMAP+256                                               04909000
CVTATERA EQU   CVTATER+1                                                04910000
CVTSYST  EQU   CVTATER                                                  04911000
CVTVOLT2 EQU   CVTTAT                                                   04912000
CVTVOLI2 EQU   CVTVOLF2                                                 04913000
CVTAQAVB EQU   CVTAQAVT+1                                               04914000
CVTRSV34 EQU   CVTTCMFG                                                 04915000
CVTRSV33 EQU   CVTTCMFG                                                 04916000
CVTRSV32 EQU   CVTTCMFG                                                 04917000
CVTRSV31 EQU   CVTTCMFG                                                 04918000
CVTRSV30 EQU   CVTTCMFG                                                 04919000
CVTRSV29 EQU   CVTTCMFG                                                 04920000
CVTRSV28 EQU   CVTTCMFG                                                 04921000
CVTTCRDY EQU   CVTTCMFG                                                 04922000
CVTGTFA  EQU   CVTGTF+1                                                 04923000
CVTRSV27 EQU   CVTGTFST                                                 04924000
CVTRNIO  EQU   CVTGTFST                                                 04925000
CVTUSR   EQU   CVTGTFST                                                 04926000
CVTRV318 EQU   CVTFORM                                                  04927000
CVTRV317 EQU   CVTTMODE                                                 04928000
CVTRV316 EQU   CVTSTATE                                                 04929000
CVTRV315 EQU   CVTGTFS                                                  04930000
CVTGTFAV EQU   CVTGTFS                                                  04931000
CVT0SCR1 EQU   CVTMAP+232                                               04932000
CVTRV515 EQU   CVTMAP+228                                               04933000
CVTRMS   EQU   CVTMAP+224                                               04934000
CVTPATCH EQU   CVTMAP+220                                               04935000
CVTTSCE  EQU   CVTMAP+216                                               04936000
CVTLNKSC EQU   CVTMAP+214                                               04937000
CVTQABST EQU   CVTMAP+212                                               04938000
CVTMDLDS EQU   CVTMAP+208                                               04939000
CVTUSER  EQU   CVTMAP+204                                               04940000
CVTABEND EQU   CVTMAP+200                                               04941000
CVTSMCA  EQU   CVTMAP+196                                               04942000
CVTRSV18 EQU   CVTMAP+192                                               04943000
CVTQLPAQ EQU   CVTMAP+188                                               04944000
CVTQCDSR EQU   CVTMAP+184                                               04945000
CVTRSV17 EQU   CVTOPTB                                                  04946000
CVTRSV16 EQU   CVTOPTB                                                  04947000
CVTFP    EQU   CVTOPTB                                                  04948000
CVTAPTHR EQU   CVTOPTB                                                  04949000
CVTNLOG  EQU   CVTOPTB                                                  04950000
CVTTOD   EQU   CVTOPTB                                                  04951000
CVTCTIMS EQU   CVTOPTB                                                  04952000
CVTPROT  EQU   CVTOPTB                                                  04953000
CVTXPFP  EQU   CVTOPTA                                                  04954000
CVTASCII EQU   CVTOPTA                                                  04955000
CVTRSV13 EQU   CVTOPTA                                                  04956000
CVTRSV12 EQU   CVTOPTA                                                  04957000
CVTNIP   EQU   CVTOPTA                                                  04958000
CVTDDR   EQU   CVTOPTA                                                  04959000
CVTAPR   EQU   CVTOPTA                                                  04960000
CVTCCH   EQU   CVTOPTA                                                  04961000
CVTSNCTR EQU   CVTMAP+180                                               04962000
CVTQMWR  EQU   CVTMAP+176                                               04963000
CVTQOCR  EQU   CVTMAP+172                                               04964000
CVT1EF00 EQU   CVTMAP+168                                               04965000
CVTMZ00  EQU   CVTMAP+164                                               04966000
CVTSV76Q EQU   CVTSV76C                                                 04967000
CVTRSV11 EQU   CVTMAP+156                                               04968000
CVT0PT01 EQU   CVTMAP+152                                               04969000
CVTMSER  EQU   CVTMAP+148                                               04970000
CVTRV516 EQU   CVTIERLC                                                 04971000
CVTILCH  EQU   CVTMAP+140                                               04972000
CVT0DS   EQU   CVTMAP+136                                               04973000
CVTFBOSV EQU   CVTMAP+132                                               04974000
CVTNUCB  EQU   CVTMAP+128                                               04975000
CVTIXAVL EQU   CVTMAP+124                                               04976000
CVTSV76M EQU   CVTIOQET                                                 04977000
CVTDCBA  EQU   CVTMAP+117                                               04978000
CVTMVS2  EQU   CVTDCB                                                   04979000
CVT6DAT  EQU   CVTDCB                                                   04980000
CVT4MPS  EQU   CVTDCB                                                   04981000
CVTRSV09 EQU   CVTDCB                                                   04982000
CVT4MS1  EQU   CVTDCB                                                   04983000
CVT2SPS  EQU   CVTDCB                                                   04984000
CVT1SSS  EQU   CVTDCB                                                   04985000
CVTRSV08 EQU   CVTDCB                                                   04986000
CVTSTB   EQU   CVTMAP+112                                               04987000
CVTQTD00 EQU   CVTMAP+108                                               04988000
CVTQTE00 EQU   CVTMAP+104                                               04989000
CVTCUCB  EQU   CVTMAP+100                                               04990000
CVTSJQ   EQU   CVTMAP+96                                                04991000
CVTPBLDL EQU   CVTMAP+92                                                04992000
CVTTPC   EQU   CVTMAP+88                                                04993000
CVTSVDCB EQU   CVTMAP+84                                                04994000
CVTBRET  EQU   CVTMAP+82                                                04995000
CVTEXIT  EQU   CVTMAP+80                                                04996000
CVT0FN00 EQU   CVTMAP+76                                                04997000
CVTDARA  EQU   CVTDAR+1                                                 04998000
CVTRSV07 EQU   CVTFLGS1                                                 04999000
CVTRSV06 EQU   CVTFLGS1                                                 05000000
CVTRSV05 EQU   CVTFLGS1                                                 05001000
CVTRSV04 EQU   CVTFLGS1                                                 05002000
CVTRSV03 EQU   CVTFLGS1                                                 05003000
CVTRSV02 EQU   CVTFLGS1                                                 05004000
CVTRSV01 EQU   CVTFLGS1                                                 05005000
CVTDMPLK EQU   CVTFLGS1                                                 05006000
CVTXITP  EQU   CVTMAP+68                                                05007000
CVTZDTAB EQU   CVTMAP+64                                                05008000
CVTMSLT  EQU   CVTMAP+60                                                05009000
CVTDATE  EQU   CVTMAP+56                                                05010000
CVTBTERM EQU   CVTMAP+52                                                05011000
CVTSYSAD EQU   CVTMAP+48                                                05012000
CVTXTLER EQU   CVTMAP+44                                                05013000
CVTILK2  EQU   CVTMAP+40                                                05014000
CVTILK1  EQU   CVTMAP+36                                                05015000
CVTPRLTV EQU   CVTMAP+32                                                05016000
CVTPCNVT EQU   CVTMAP+28                                                05017000
CVTXAPG  EQU   CVTMAP+20                                                05018000
CVTBUF   EQU   CVTMAP+16                                                05019000
CVTJOB   EQU   CVTMAP+12                                                05020000
CVTLINK  EQU   CVTMAP+8                                                 05021000
CVT0EF00 EQU   CVTMAP+4                                                 05022000
CVTTCBP  EQU   CVTMAP                                                   05023000
CVT      EQU   CVTMAP                                                   05024000
@NM00071 EQU   PSA+3668                                                 05025000
PSASTAK  EQU   PSA+3072                                                 05026000
@NM00070 EQU   PSA+1048                                                 05027000
PSAUSEND EQU   PSA+1048                                                 05028000
PSARV062 EQU   PSA+1044                                                 05029000
PSACDAL  EQU   PSA+1040                                                 05030000
PSAWTCOD EQU   PSA+1036                                                 05031000
PSAATCVT EQU   PSA+1032                                                 05032000
PSAPCPSW EQU   PSA+1024                                                 05033000
PSAPIR2  EQU   PSA+1020                                                 05034000
PSARV059 EQU   PSA+1018                                                 05035000
PSASVC13 EQU   PSA+1016                                                 05036000
PSALSFCC EQU   PSA+1012                                                 05037000
PSASFACC EQU   PSA+1008                                                 05038000
PSASTOP  EQU   PSA+992                                                  05039000
PSASTART EQU   PSA+976                                                  05040000
PSARSPSW EQU   PSA+968                                                  05041000
PSASRPSW EQU   PSA+960                                                  05042000
PSARV045 EQU   PSA+892                                                  05043000
PSARV044 EQU   PSA+888                                                  05044000
PSARV043 EQU   PSA+884                                                  05045000
PSARV042 EQU   PSA+880                                                  05046000
PSARV041 EQU   PSA+876                                                  05047000
PSARV040 EQU   PSA+872                                                  05048000
PSARV025 EQU   PSA+868                                                  05049000
PSADSSED EQU   PSA+868                                                  05050000
PSADSSPR EQU   PSA+864                                                  05051000
PSADSSFW EQU   PSA+860                                                  05052000
PSADSS14 EQU   PSA+856                                                  05053000
PSADSSPP EQU   PSA+848                                                  05054000
PSADSSRP EQU   PSA+840                                                  05055000
PSADSS05 EQU   PSADSSF4                                                 05056000
PSADSS10 EQU   PSADSSF4                                                 05057000
PSADSSVE EQU   PSADSSF4                                                 05058000
PSADSSDE EQU   PSADSSF4                                                 05059000
PSADSSC0 EQU   PSADSSF4                                                 05060000
PSADSSIE EQU   PSADSSF4                                                 05061000
PSADSS12 EQU   PSADSSF4                                                 05062000
PSADSSRC EQU   PSADSSF4                                                 05063000
PSARV057 EQU   PSADSSF3                                                 05064000
PSARV056 EQU   PSADSSF3                                                 05065000
PSARV055 EQU   PSADSSF3                                                 05066000
PSADSSMC EQU   PSADSSF3                                                 05067000
PSADSSRW EQU   PSADSSF3                                                 05068000
PSADSSNM EQU   PSADSSF3                                                 05069000
PSADSSES EQU   PSADSSF3                                                 05070000
PSADSSGP EQU   PSADSSF3                                                 05071000
PSADSSF2 EQU   PSADSSFL+1                                               05072000
PSADSSPI EQU   PSADSSF1                                                 05073000
PSADSSOI EQU   PSADSSF1                                                 05074000
PSADSSSP EQU   PSADSSF1                                                 05075000
PSADSSTP EQU   PSADSSF1                                                 05076000
PSADSSDW EQU   PSADSSF1                                                 05077000
PSADSSDD EQU   PSADSSF1                                                 05078000
PSADSSDM EQU   PSADSSF1                                                 05079000
PSADSSMV EQU   PSADSSF1                                                 05080000
PSADSSTS EQU   PSA+816                                                  05081000
PSADSSWK EQU   PSA+812                                                  05082000
PSADSSR3 EQU   PSA+808                                                  05083000
PSADSSR2 EQU   PSA+804                                                  05084000
PSADSSRS EQU   PSA+800                                                  05085000
PSASTOR  EQU   PSA+796                                                  05086000
PSACPUSA EQU   PSA+794                                                  05087000
PSAVSTAP EQU   PSA+792                                                  05088000
PSAWKVAP EQU   PSA+788                                                  05089000
PSAWKRAP EQU   PSA+784                                                  05090000
PSAMCHIC EQU   PSA+783                                                  05091000
PSARV061 EQU   PSA+782                                                  05092000
PSASYMSK EQU   PSA+781                                                  05093000
PSAMCHFL EQU   PSA+780                                                  05094000
PSACR0   EQU   PSA+776                                                  05095000
PSAPSWSV EQU   PSA+768                                                  05096000
PSACLHS  EQU   PSAHLHI                                                  05097000
PSALKR15 EQU   PSALKSA+60                                               05098000
PSALKR14 EQU   PSALKSA+56                                               05099000
PSALKR13 EQU   PSALKSA+52                                               05100000
PSALKR12 EQU   PSALKSA+48                                               05101000
PSALKR11 EQU   PSALKSA+44                                               05102000
PSALKR10 EQU   PSALKSA+40                                               05103000
PSALKR9  EQU   PSALKSA+36                                               05104000
PSALKR8  EQU   PSALKSA+32                                               05105000
PSALKR7  EQU   PSALKSA+28                                               05106000
PSALKR6  EQU   PSALKSA+24                                               05107000
PSALKR5  EQU   PSALKSA+20                                               05108000
PSALKR4  EQU   PSALKSA+16                                               05109000
PSALKR3  EQU   PSALKSA+12                                               05110000
PSALKR2  EQU   PSALKSA+8                                                05111000
PSALKR1  EQU   PSALKSA+4                                                05112000
PSALKR0  EQU   PSALKSA                                                  05113000
PSARV023 EQU   PSACLHT+52                                               05114000
PSALOCAL EQU   PSACLHT+48                                               05115000
PSACMSL  EQU   PSACLHT+44                                               05116000
PSAOPTL  EQU   PSACLHT+40                                               05117000
PSATPACL EQU   PSACLHT+36                                               05118000
PSATPDNL EQU   PSACLHT+32                                               05119000
PSATPNCL EQU   PSACLHT+28                                               05120000
PSAIOSLL EQU   PSACLHT+24                                               05121000
PSAIOSUL EQU   PSACLHT+20                                               05122000
PSAIOSCL EQU   PSACLHT+16                                               05123000
PSAIOSSL EQU   PSACLHT+12                                               05124000
PSASALCL EQU   PSACLHT+8                                                05125000
PSAASML  EQU   PSACLHT+4                                                05126000
PSADISPL EQU   PSACLHT                                                  05127000
PSASRSA  EQU   PSA+636                                                  05128000
PSARV050 EQU   PSA+634                                                  05129000
PSADSSGO EQU   PSA+633                                                  05130000
PSARECUR EQU   PSA+632                                                  05131000
PSAHLHIS EQU   PSA+628                                                  05132000
PSAIPCSA EQU   PSA+624                                                  05133000
@NM00069 EQU   PSA+621                                                  05134000
PSAIPCDM EQU   PSA+620                                                  05135000
PSAIPCD  EQU   PSA+616                                                  05136000
@NM00068 EQU   PSA+613                                                  05137000
PSAIPCRM EQU   PSA+612                                                  05138000
PSAIPCR  EQU   PSA+608                                                  05139000
PSAMCHEX EQU   PSA+600                                                  05140000
PSAMPSW  EQU   PSA+592                                                  05141000
PSAEXPS2 EQU   PSA+584                                                  05142000
PSAEXPS1 EQU   PSA+576                                                  05143000
PSAPIREG EQU   PSA+572                                                  05144000
PSARSREG EQU   PSA+568                                                  05145000
PSAGPREG EQU   PSA+556                                                  05146000
PSARV022 EQU   PSASUP4                                                  05147000
PSARV021 EQU   PSASUP4                                                  05148000
PSARV020 EQU   PSASUP4                                                  05149000
PSARV019 EQU   PSASUP4                                                  05150000
PSARV018 EQU   PSASUP4                                                  05151000
PSARV017 EQU   PSASUP4                                                  05152000
PSARV016 EQU   PSASUP4                                                  05153000
PSARV015 EQU   PSASUP4                                                  05154000
PSARV014 EQU   PSASUP3                                                  05155000
PSARV013 EQU   PSASUP3                                                  05156000
PSARV012 EQU   PSASUP3                                                  05157000
PSAESTA  EQU   PSASUP3                                                  05158000
PSASPR   EQU   PSASUP3                                                  05159000
PSAPSREG EQU   PSASUP3                                                  05160000
PSAPI2   EQU   PSASUP3                                                  05161000
PSAIOSUP EQU   PSASUP3                                                  05162000
PSALCR   EQU   PSASUP2                                                  05163000
PSARTM   EQU   PSASUP2                                                  05164000
PSAACR   EQU   PSASUP2                                                  05165000
PSAIPCE2 EQU   PSASUP2                                                  05166000
PSAIPCES EQU   PSASUP2                                                  05167000
PSAIPCEC EQU   PSASUP2                                                  05168000
PSAGTF   EQU   PSASUP2                                                  05169000
PSAIPCRI EQU   PSASUP2                                                  05170000
PSATYPE6 EQU   PSASUP1                                                  05171000
PSATCTL  EQU   PSASUP1                                                  05172000
PSADISP  EQU   PSASUP1                                                  05173000
PSALOCK  EQU   PSASUP1                                                  05174000
PSAPI    EQU   PSASUP1                                                  05175000
PSAEXT   EQU   PSASUP1                                                  05176000
PSASVC   EQU   PSASUP1                                                  05177000
PSAIO    EQU   PSASUP1                                                  05178000
PSAAOLD  EQU   PSA+548                                                  05179000
PSAANEW  EQU   PSA+544                                                  05180000
PSATNEW  EQU   PSA+536                                                  05181000
PSALCCAR EQU   PSA+532                                                  05182000
PSALCCAV EQU   PSA+528                                                  05183000
PSAPCCAR EQU   PSA+524                                                  05184000
PSAPCCAV EQU   PSA+520                                                  05185000
PSACPULA EQU   PSA+518                                                  05186000
PSACPUPA EQU   PSA+516                                                  05187000
PSAPSA   EQU   PSA+512                                                  05188000
FLCHDEND EQU   PSA+512                                                  05189000
FLCCRSAV EQU   FLCMCLA+280                                              05190000
FLCGRSAV EQU   FLCMCLA+216                                              05191000
FLCFPSAV EQU   FLCMCLA+184                                              05192000
FLCFLA   EQU   FLCMCLA+88                                               05193000
FLCRGNCD EQU   FLCMCLA+84                                               05194000
FLCFSAA  EQU   FLCFSA+1                                                 05195000
@NM00067 EQU   FLCFSA                                                   05196000
@NM00066 EQU   FLCMCLA+72                                               05197000
FLCMCIC  EQU   FLCMCLA+64                                               05198000
@NM00065 EQU   FLCMCLA+20                                               05199000
FLCIOAA  EQU   FLCIOA+1                                                 05200000
@NM00064 EQU   FLCIOA                                                   05201000
@NM00063 EQU   FLCMCLA+15                                               05202000
@NM00062 EQU   FLCMCLA+14                                               05203000
@NM00061 EQU   FLCMCLA+12                                               05204000
FLCLCL   EQU   FLCMCLA+8                                                05205000
FLCIOELA EQU   FLCIOEL+1                                                05206000
@NM00060 EQU   FLCIOEL                                                  05207000
FLCCHNID EQU   FLCMCLA                                                  05208000
@NM00059 EQU   PSA+160                                                  05209000
FLCMTRCD EQU   PSA+157                                                  05210000
@NM00058 EQU   PSA+156                                                  05211000
FLCPERA  EQU   FLCPER+1                                                 05212000
@NM00057 EQU   FLCPER                                                   05213000
@NM00056 EQU   PSA+151                                                  05214000
FLCPERCD EQU   PSA+150                                                  05215000
FLCMCNUM EQU   PSA+149                                                  05216000
@NM00055 EQU   PSA+148                                                  05217000
FLCTEAA  EQU   FLCTEA+1                                                 05218000
@NM00054 EQU   FLCTEA                                                   05219000
PSAPIPC  EQU   PSAPICOD                                                 05220000
PSAPIMC  EQU   PSAPICOD                                                 05221000
PSAPIPER EQU   PSAPICOD                                                 05222000
PSARV049 EQU   FLCPICOD                                                 05223000
FLCPILCB EQU   FLCPIILC                                                 05224000
@NM00053 EQU   FLCPIILC                                                 05225000
@NM00052 EQU   PSAEPPSW                                                 05226000
FLCSVCN  EQU   PSAESPSW+2                                               05227000
FLCSILCB EQU   FLCSVILC                                                 05228000
@NM00051 EQU   FLCSVILC                                                 05229000
@NM00050 EQU   PSAESPSW                                                 05230000
FLCEICOD EQU   PSAEEPSW+2                                               05231000
PSASPAD  EQU   PSAEEPSW                                                 05232000
@NM00049 EQU   PSA+128                                                  05233000
FLCINPSW EQU   PSA+120                                                  05234000
FLCMNPSW EQU   PSA+112                                                  05235000
FLCPNPSW EQU   PSA+104                                                  05236000
FLCSNPSW EQU   PSA+96                                                   05237000
FLCENPSW EQU   PSA+88                                                   05238000
FLCTRACE EQU   PSA+84                                                   05239000
FLCTIMER EQU   PSA+80                                                   05240000
FLCCVT2  EQU   PSA+76                                                   05241000
FLCCAW   EQU   PSA+72                                                   05242000
FLCCSW   EQU   PSA+64                                                   05243000
FLCIOPSW EQU   PSA+56                                                   05244000
FLCMOPSW EQU   PSA+48                                                   05245000
FLCPOPSW EQU   PSA+40                                                   05246000
FLCSOPSW EQU   PSA+32                                                   05247000
FLCEOPSW EQU   PSA+24                                                   05248000
@NM00048 EQU   FLCICCW2+4                                               05249000
FLCCVT   EQU   FLCICCW2                                                 05250000
FLCICCW1 EQU   FLCROPSW                                                 05251000
FLCIPPSW EQU   FLCRNPSW                                                 05252000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      05253000
@RC00250 EQU   EXITCLN                                                  05254000
@RT00360 EQU   EXCPNXT                                                  05255000
@RT00411 EQU   ENQ                                                      05256000
@RT00413 EQU   EXCPNXT                                                  05257000
@RT00457 EQU   EXITCLN                                                  05258000
@RT00462 EQU   EXCPNXT                                                  05259000
@RF00464 EQU   @RC00334                                                 05260000
@RT00509 EQU   EXCPNXT                                                  05261000
@RF00641 EQU   @EL00003                                                 05262000
@RT00682 EQU   DUMPRTN1                                                 05263000
@RT00687 EQU   DUMPRTN1                                                 05264000
@RT00690 EQU   DUMPRTN1                                                 05265000
@RT00692 EQU   DUMPRTN1                                                 05266000
@ENDDATA EQU   *                                                        05267000
         END   IGCT105C,(C'PLS0956',0701,78025)                         05268000
./  ADD  SSI=81280492,NAME=IGC0005C
         TITLE 'IGC0005C -- BDAM EXCLUSIVE CONTROL SVC.'                00003002
*********************************************************************** 00013002
*                                                                     * 00015002
* MODULE NAME = IGC0005C                                              * 00017002
*                                                                     * 00019002
* DESCRIPTIVE NAME = BDAM EXCLUSIVE CONTROL SVC                       * 00019402
*                                                                     * 00019802
* COPYRIGHT = NONE                                                    * 00019902
*                                                                     * 00023202
* STATUS = VS2 RELEASE 2, LEVEL 0                                     * 00025202
*                                                                     * 00027202
* FUNCTION = THIS MODULE IS INVOKED TO HANDLE THE SUPERVISORY         * 00029202
*            FUNCTIONS NECESSARY FOR EXCLUSIVE CONTROL IN BDAM.       * 00029602
*            EXCLUSIVE CONTROL IS NECESSARY FOR HANDLING OF THE       * 00029702
*            FOLLOWING MACROS:                                        * 00029802
*                 READ       TYPES DIX AND DKX                        * 00029902
*                 WRITE      TYPES DIX AND DKX                        * 00030602
*                 RELEX                                               * 00031002
*                 WRITE      TYPES DA AND DAF WHEN THE RECORD FORMAT  * 00031402
*                            IS VARIABLE OR UNDEFINED, OR THE RECORD  * 00031802
*                            FORMAT IS FIXED AND THE DEVICE IS A 2305 * 00031902
*            THIS MODULE REQUIRES SUPERVISORY STATE TO PERFORM THE    * 00033202
*            FOLLOWING FUNCTIONS:                                     * 00035202
*              +  MODIFY THE PROTECTED EXCLUSIVE CONTROL LIST (DATA   * 00035602
*                 MANAGEMENT KEY), AND IF NECESSARY GET ADDITIONAL    * 00035702
*                 STORAGE FOR THIS LIST.                              * 00035802
*              +  ACQUIRE THE LOCAL LOCK TO PROTECT THE INTEGRITY OF  * 00035902
*                 THE EXCLUSIVE CONTROL LIST, A SERIALLY REUSABLE     * 00037202
*                 RESOURCE, DURING SEARCH AND UPDATE OPERATIONS.      * 00039202
*              +  ISSUE ENQ/DEQ MACROS DIRECTED TO THE TCB WHICH      * 00039602
*                 OPENED THE DCB.                                     * 00039702
*              +  ISSUE AN AUTHORIZED SYSTEM ENQ (QNAME = SYSZ...)    * 00039802
*                 SO AS TO AVOID A SITUATION WHERE A NON-SYSTEM USER  * 00039902
*                 COULD ENQUEUE ON RECORDS OF A BDAM DATASET WHICH HE * 00046602
*                 COULD NOT ACCESS, AND THEREBY PREVENT AN AUTHORIZED * 00056602
*                 USER FROM GAINING ACCESS TO THESE RECORDS.          * 00058602
*                                                                     * 00059002
* OPERATION = EACH EXECUTION REQUIRES THE FOLLOWING STEPS:            * 00059102
*             + GENERAL INITIALIZATION - ESTABLISH RECOVERY ROUTINE   * 00059202
*             + RELEX INITIALIZATION (FOR RELEX REQUESTS ONLY) -      * 00059302
*               GETMAIN CORE FOR IOB/DECB AND CONVERT BLOCK REFERENCE * 00059402
*               TO ACTUAL DASD ADDRESS FORMAT.                        * 00059502
*             + EXCLUSIVE CONTROL LIST SEARCH ARGUMENT GENERATION AND * 00059602
*               ARGUMENT VALIDATION.                                  * 00059702
*             + SEARCH OF EXCLUSIVE CONTROL LIST.                     * 00061702
*             FOR REQUESTS TO GAIN EXCLUSIVE CONTROL, ON THE BASIS OF * 00063702
*             THE SEARCH OF THE EXCLUSIVE CONTROL LIST, ONE OF THE    * 00064102
*             FOLLOWING ACTIONS IS TAKEN:                             * 00064502
*               + IF NO MATCH IS FOUND, REQUEST IS GIVEN IMMEDIATE    * 00064902
*                 CONTROL OF THE RECORD.                              * 00065302
*               + IF A MATCH IS FOUND, IOB IS PLACED ON UNPOSTED      * 00066102
*                 QUEUE.                                              * 00066502
*             FOR REQUESTS TO RELEASE EXCLUSIVE CONTROL, ONE OF THE   * 00067602
*             FOLLOWING ACTIONS IS TAKEN:                             * 00069602
*               + IF NO MATCH IS FOUND, THE REQUEST IS MARKED IN      * 00070002
*                 ERROR.                                              * 00070302
*               + IF A MATCH IS FOUND, AND NO IOB IS WAITING FOR THIS * 00070702
*                 RECORD ON THE UNPOSTED QUEUE, CONTROL OF THE RECORD * 00070802
*                 IS RELINQUISHED.                                    * 00070902
*               + IF A MATCH IS FOUND, AND AN IOB IS WAITING ON THE   * 00071702
*                 UNPOSTED QUEUE FOR THIS RECORD, CONTROL OF THE      * 00072102
*                 RECORD IS GIVEN TO THE FIRST WAITING IOB.           * 00072502
*               + FOR ALL REQUESTS, EXIT LOGIC                        * 00072902
*             FOR ALL REQUESTS AUDIT TRAIL BITS WILL BE SET BY THIS   * 00073002
*             MODULE IN THE SVRB EXTENDED WORKAREA. THESE BITS WILL   * 00073102
*             BE INTERROGATED BY THE BACKUP ESTAE, IGCT005C,SHOULD AN * 00073202
*             ABEND OCCUR AT THIS RB LEVEL. THESE BITS WILL TRACK     * 00074802
*             THE WORK DONE BY THIS SVC, PARTICULARLY ANY CONTROL     * 00076802
*             BLOCKS WHICH ARE ALTERED DURING PROCESSING. IN ADDITION * 00077202
*             TO AUDIT TRAIL BITS, ADDRESSES TO THE FOLLOWING ARE     * 00077302
*             SAVED FOR THE ESTAE:  CORE OBTAINED FOR RELEX CNTRL BLKS* 00077702
*                                   NEXT(DEQ)/LAST(ENQ) IOB PROCESSED * 00078102
*             THE ESTAE WILL USE THIS INFORMATION TO CLEANUP THE      * 00078702
*             CONTROL BLOCKS EITHER COMPLETING OR UNDOING THE WORK    * 00079102
*             ACCOMPLISHED BY THIS SVC BEFORE ABENDING.               * 00079302
*                                                                     * 00079702
* NOTES = SEE BELOW                                                   * 00079902
*                                                                     * 00080602
*     DEPENDENCIES = NONE                                             * 00082202
*                                                                     * 00083802
*     RESTRICTIONS = NONE                                             * 00085402
*                                                                     * 00087002
*     REGISTER CONVENTIONS = R3 MODULE BASE REGISTER                  * 00088602
*                            R4 POINTS TO THE DCB                     * 00090202
*                            R5 POINTS TO THE SVRB                    * 00091802
*                            R6 POINTS TO THE DECB                    * 00093402
*                            R7 POINTS TO THE IOB                     * 00095002
*                            OTHERS USED AS REQUIRED BY EXTERNAL      * 00096602
*                            ROUTINES, OR AS WORK REGISTERS.          * 00098602
*                                                                     * 00099002
*     PATCH LABEL = PATCH, A DC STATEMENT DEFINED AS 5% OF THE        * 00099402
*                   MODULE'S STORAGE EXCLUSIVE OF THE PATCH SPACE.    * 00099802
*                                                                     * 00099902
*     HISTORICAL NOTE = THIS MODULE INCORPORATES LOGIC THAT WAS       * 00101902
*                       FORMERLY CONTAINED IN MODULES IGC0005C AND    * 00105902
*                       IGG019LG.                                     * 00106002
*                                                                     * 00106302
* MODULE TYPE = SUPERVISOR CALL ROUTINE                               * 00106602
*                                                                     * 00116602
*     PROCESSOR = ASSEMBLER XF                                        * 00118602
*                                                                     * 00119002
*     MODULE SIZE = 8D0 HEXADECIMAL BYTES                             * 00119402
*                                                                     * 00119802
*     ATTRIBUTES = REENTRANT, REFRESHABLE, SUPERVISOR STATE, ENABLED  * 00119902
*                                                                     * 00126602
* ENTRY POINT = IGC0005C                                              * 00136602
*                                                                     * 00138602
*     PURPOSE = RELEX MACRO                                           * 00139002
*                                                                     * 00139102
*     LINKAGE = THROUGH THE SVC INTERRUPT HANDLER VIA SVC 53 DECIMAL  * 00139402
*                                                                     * 00139502
*     INPUT REGISTERS = R0 POINTS TO BLOCK REFERENCE FIELD            * 00139802
*                       R1 POINTS TO DCB                              * 00139902
*                       R5 POINTS TO SVRB                             * 00146602
*                       R14 LOADED WITH RETURN ADDRESS                * 00156602
*                                                                     * 00157002
*     OUTPUT REGISTERS = R15 CONTAINS RETURN CODE (SEE EXITS)         * 00157402
*                                                                     * 00158602
*     PURPOSE = ALL OTHER BDAM EXCLUSIVE CONTROL FUNCTIONS            * 00159002
*                                                                     * 00159102
*     LINKAGE = AS DESCRIBED FOR RELEX MACRO                          * 00159402
*                                                                     * 00159502
*     INPUT REGISTERS = R1 POINTS TO IOB,COMPLEMENTED                 * 00159802
*                       R5, R14 AS DESCRIBED FOR RELEX MACRO          * 00159902
*                                                                     * 00161902
*     OUTPUT REGISTERS =R0 POINTS TO IOB REMOVED FROM UNPOSTED        * 00163902
*                             QUEUE                                   * 00165902
*                       R1 POINTS TO INPUT IOB                        * 00167902
*                                                                     * 00169902
* ENTRY POINT = ESTAERTN                                              * 00179902
*                                                                     * 00186602
*     PURPOSE = TASK RECOVERY ROUTINE                                 * 00196602
*                                                                     * 00198602
*     LINKAGE = THROUGH RECOVERY/TERMINATION MANAGER                  * 00199002
*                                                                     * 00199402
*     INPUT REGISTERS = R0 CONTAINS A CODE VALUE                      * 00199802
*                       R1 POINTS TO SDWA IF CODE VALUE NE 12,        * 00199902
*                        OTHERWISE, R1 CONTAINS CODE VALUES           * 00206602
*                       R13 POINTS TO REGISTER SAVEAREA               * 00216602
*                                                                     * 00217002
*   NOTE:  THE FOLLOWING INPUT, OUTPUT, & WORK AREA DESCRIPTIONS      * 00217402
*          COVER ONLY THOSE FIELDS REFERRED TO OR SET BY CODE CON-    * 00217802
*          TAINED IN THIS MODULE.  IT DOES NOT INCLUDE CODE GENERATED * 00218202
*          BY MACRO EXPANSIONS.                                       * 00218302
*                                                                     * 00218602
* INPUT =IOB FIELDS REFERENCED FOR NON-RELEX REQUESTS:                * 00219002
*           IOBDCBPT, IOBECBPT FOR DCB & DECB ADDRESSES RESPECTIVELY  * 00219402
*           IOBDTYP2, BIT IOBADDTY  TO IDENTIFY WRITE-ADD REQUESTS    * 00219802
*           IOBDTYP2, BIT IOBRQUST  TO DISTINGUISH READ FROM WRITE    * 00221802
*             RELEASE OR RELEX REQUESTS                               * 00223802
*           IOBDSTAT, BIT IOBENQUE  TO DISTINGUISH ENQ FROM DEQ       * 00226602
*             WRITE-ADD REQUESTS                                      * 00236602
*           IOBM -- EXTENT NUMBER                                     * 00237002
*           IOBSEEK+3 -- BLOCK ID(CCHHR) FOR WRITE-ADD REQUESTS       * 00238602
*           IOBDNCRF+2 -- BLOCK ID FOR EXCLUSIVE CONTROL REQUESTS     * 00239002
*         DCB FIELDS REFERENCED ARE:                                  * 00239402
*           DCBOPTCD TO DETERMINE FORM OF BLOCK REFERENCE FOR RELEX   * 00239802
*           DCBRECFM & DCBOPTCD TO DISTINGUISH 2305 WRITE-ADD REQS    * 00239902
*           DCBREAD -- ADDRESS OF FOUNDATION MODULE                   * 00246602
*           DCBDEBAD -- DEB ADDRESS                                   * 00256602
*         DEB FIELDS REFERENCED ARE:                                  * 00258602
*           EXTENT DESCRIPTION FOR CURRENT EXTENT OR FOR FIRST EXTENT * 00259002
*             (FOR 2305 WRITE-ADD, FIXED FORMAT, EXTENDED SEARCH)     * 00259402
*           DEBXXARG (LOCATED IN DEB EXTENSION) ADDRESS OF EXCLUSIVE  * 00259802
*             CONTROL LIST                                            * 00259902
*           DEBTCBAD -- ADDRESS OF TCB WHICH OPENED DCB               * 00266602
*         EXCLUSIVE CONTROL LIST                                      * 00276602
*         SVRB FIELDS REFERENCED ARE:                                 * 00278602
*           RBLINK -- ADDRESS OF CALLER'S RB                          * 00279002
*           RBGRS0, RBGRS1 -- INPUT REGISTERS 0 & 1                   * 00279402
*         CALLER'S RB FIELDS REFERENCED ARE:                          * 00279802
*           RBOPSW+1 -- CALLER'S PROTECTION KEY                       * 00279902
*         TCB FIELDS REFERENCED ARE:                                  * 00329902
*           TCBRBP -- ADDRESS OF SVRB                                 * 00339902
*         CVT FIELDS REFERENCED ARE:                                  * 00349902
*           CVTPCNVT -- ADDRESS OF IECPCNVT                           * 00359902
*           CVTPRLTV -- ADDRESS OF IECPRLTV                           * 00369902
*           CVTEXT2  -- CVT EXTENSION POINTER                         * 00371902
*           CVTDEBVR -- DEBCHK BRANCH ENTRY POINT ADDRESS             * 00373902
*         PSA FIELDS REFERENCED ARE:                                  * 00375902
*           PSAAOLD -- ADDRESS OF CURRENT (CALLER'S) ASCB             * 00377902
*           PSATOLD -- ADDRESS OF CURRENT (CALLER'S) TCB              * 00378302
*                                                                     * 00379702
* OUTPUT = IOB FIELDS SET ARE:                                        * 00379802
*           IOBDSTAT, BIT IOBENQUE SET WHEN THE IOB IS GIVEN CONTROL  * 00429802
*             OF THE RESOURCE                                         * 00439802
*           IOBDNCRF -- SET TO THE CURRENT TRACK CAPACITY RECORD, IN  * 00449802
*             ALL IOBS ON THE UNPOSTED QUEUE FOR THAT TRACK, FOR A    * 00459802
*             WRITE DA DEQ REQUEST.                                   * 00469802
*           IOBDAYLI -- POSTED IOB MADE AVAILABLE IF CHECK NOT USED.  * 00471802
*         EXCLUSIVE CONTROL LIST -- UPDATED TO REFLECT CHANGES IN     * 00475802
*             EXCLUSIVE CONTROL; ENTRY ADDED WHEN CONTROL OF A        * 00477802
*             RESOURCE IS GOTTEN, ZEROED WHEN CONTROL OF A RESOURCE   * 00478202
*             IS FREED.  AN ADDITIONAL SEGMENT MAY BE CHAINED TO THE  * 00478602
*             LIST.                                                   * 00479002
*         THE BUFFERS OF ANY REQUESTS FOR THE RELEASED RECORD (WRITE  * 00479402
*             DX) ON THE UNPOSTED QUEUE ARE UPDATED WITH THE LATEST   * 00479502
*             COPY OF THE RECORD.                                     * 00479602
*                                                                     * 00529602
* WORK AREAS = SVRB EXTENDED SAVEAREA, 48 BYTES. SEE DETAILED         * 00539602
*             DESCRIPTION AT LABEL WKAREAX.                           * 00549602
*           IOB/DECB -- 132 BYTES IN SUBPOOL 0 GOTTEN WHEN PROCESSING * 00559602
*             A RELEX REQUEST.                                        * 00569602
*                                                                     * 00571602
* EXITS - NORMAL = RETURN TO CALLER VIA SVC INTERRUPT HANDLER, SEE    * 00573602
*             OUTPUT REGISTER DESCRIPTION UNDER LINKAGE.  RETURN      * 00575602
*             CODES IN REGISTER 15 ARE:                               * 00577602
*               00 - OPERATION PERFORMED AS REQUESTED                 * 00578002
*               04 - BLOCK NOT UNDER EXCLUSIVE CONTROL                * 00578402
*               08 - BLOCK NOT IN DATA SET (REQUEST TO RELEASE        * 00578802
*                    CONTROL ONLY)                                    * 00579202
*                                                                     * 00579302
* EXITS - ERROR = ABENDS ARE ISSUED WITH THE FOLLOWING SYSTEM         * 00579402
*             COMPLETION CODES:                                       * 00579502
*               335 - REQUEST TO OBTAIN CONTROL OF A BLOCK OUTSIDE    * 00610202
*                     THE DATA SET                                    * 00612202
*               435 - INVALID DEB                                     * 00616002
*               535 - INSUFFICIENT CORE TO PERFORM THE REQUESTED      * 00620702
*                     OPERATION                                       * 00624502
*                                                                     * 00628302
* EXTERNAL REFERENCES = SEE BELOW                                     * 00632102
*                                                                     * 00635902
*    ROUTINES = IECPCNVT TO CONVERT TTR TO MBBCCHHR                   * 00639702
*               IECPRLTV TO CONVERT MBBCCHHR TO TTR                   * 00643502
*               DEBCHK ROUTINE (VIA BRANCH ENTRY POINT)               * 00647302
*               IGG019KE (NO TRACK OVERFLOW), OR                      * 00651102
*               IGG019KF (TRACK OVERFLOW) TO CONVERT RELATIVE         * 00654902
*                 BLOCK ADDRESS TO MBBCCHHR                           * 00658702
*               IGG019KG (NO TRACK OVERFLOW), OR                      * 00662502
*               IGG019KH (TRACK OVERFLOW) TO CALCULATE FEEDBACK       * 00666302
*                                                                     * 00670102
*    DATA AREAS = NONE                                                * 00673902
*                                                                     * 00723902
*    CONTROL BLOCKS = IOB, DECB, DEB, EXCLUSIVE CONTROL LIST, PSA,    * 00733902
*                     CVT, TCB, SVRB, CALLER'S RB, RTCA               * 00743902
*                                                                     * 00753902
* TABLES = NONE                                                       * 00763902
*                                                                     * 00765902
* MACROS = SEE BELOW                                                  * 00767902
*                                                                     * 00769902
*    EXECUTABLE MACROS = ABEND, DEQ, ENQ, ESTAE, EXCP, FREEMAIN,      * 00771902
*                        GETMAIN, IGGSTAE, MODESET, POST, SETLOCK,    * 00772302
*                        SYNCH                                        * 00772702
*                                                                     * 00773102
*    MAPPING MACROS = DCBD, IEZDEB, IEZIOB, IGGRDX, IHADECB, IHAPSA,  * 00773502
*                     IHASDWA, IKJRB, IKJTCB                          * 00773602
*                                                                     * 00773702
* CHANGE ACTIVITY = AS FOLLOWS:                                       * 00773802
*                                                                     * 00823802
*              VS2-2 CHANGES/DELETIONS                                  00825802
*                                                                YM1152 00826602
*                                                                YM1371 00827002
*                                                                YM1474 00827402
*                                                                YM3019 00827502
*                                                                YM5762 00827602
*                                                                YM6585 00827737
*              CHANGES SINCE VS2-3.7                                    00828437
*A274393-274396,313331                                         @ZA24816 00829137
*A10138100-10148100                                            @ZA28583 00829937
*C015985,A015945-015981                                        @ZA29870 00830737
*A015350,A015390                                               @ZA31947 00831737
*********************************************************************** 00833802
         EJECT                                                          00843802
IGC0005C CSECT                                                          00873802
*                                                                       00923802
*          RETURN CODES ON 'NORMAL' EXIT FROM RELEX REQUEST             00973802
*                                                                       00983802
NOTFOUND EQU   4                        RETURN CODE IF RELEX     Y02072 00997202
*                                       FOR NON-EXCLUSIVE REC    Y02072 00997902
INVALBLK EQU   8                        BLOCK NOT IN DATA SET    Y02072 00998002
*                                                                       00998102
*                       ABEND COMPLETION CODES                          00998202
*                                                                       00998302
CANTENQ  EQU   X'335'                   REQUEST TO OBTAIN CON-   Y02072 00998602
*                                       TROL OF A BLOCK OUTSIDE THE     00998702
*                                       DATA SET.                       00999102
INVALCB  EQU   X'435'                   ABEND CODE FOR INVALID   Y02072 01003802
*                                       DEB                      Y02072 01004702
INSUFCOR EQU   X'535'                   INSUFFICIENT CORE TO     Y02072 01006502
*                                       PERFORM REQUESTED OPERATION     01007402
*********************************************************************** 01008302
*                      REGISTER EQUATES                               * 01009202
*********************************************************************** 01010102
R0       EQU   0              REG 0 FOR SYSTEM INTERFACES        Y02072 01011002
PARREG0  EQU   0              ADDRESS OF THE BLOCK REFERENCE            01011902
WKREG0   EQU   0              WORK REGISTER                             01013702
R1       EQU   1              REG 1 FOR SYSTEM INTERFACES        Y02072 01014602
PARREG1  EQU   1              ADDRESS OF THE DCB                        01015502
RIOBFBK  EQU   1              IOB ADDR FOR FEEDBACK MODULES      Y02072 01017302
BUFREG1  EQU   1              BUFFER PTR OF RELEASOR OF BLK             01018602
R2       EQU   2              INTERFACE REG FOR SYSTEM CONVERT   Y02072 01022402
*                             ROUTINES                           Y02072 01024402
BUFREG2  EQU   2              BUFFER PTR OF NEXT TO GET BLK             01029202
TCBREG   EQU   2              TCB ADDRESS                        Y02072 01029302
WKREG2   EQU   2              WORK REGISTER                      Y02072 01029402
BASEREG  EQU   3              BASE REGISTER FOR THIS MODULE             01029502
RRLBDEB  EQU   3              DEB ADDR FOR IGG019KE AND IGG019KF Y02072 01030002
DCBREG   EQU   4              ADDRESS OF THE DCB FOR CONVERT ROUTINES   01040000
DEBTCBRG EQU   4              ADDR OF TCB WHICH OPENED DCB       Y02072 01060002
SVRBREG  EQU   5              SVRB ADDRESS                       Y02072 01060402
RRLBDECB EQU   5              DECB ADDR - REL BLK CONVERT RTNES  Y02072 01062002
DECBREG  EQU   6              DECB ADDRESS FOR THIS MODULE       Y02072 01090002
R7       EQU   7              ASCB INPUT REG FOR BRANCH ENTRY    Y02072 01092002
*                             TO GETMAIN                         Y02072 01094002
IOBREG   EQU   7              ADDRESS OF THE IOB FOR CONVERT ROUTINES   01100000
RTCODRG2 EQU   8              REG USED TO SAVE RETURN CODE       Y02072 01102002
*                             AROUND FREEMAIN                    Y02072 01104002
RIOB2    EQU   8              ADDR OF DEQUEUED IOB               Y02072 01104402
WKREG1   EQU   8              WORK REGISTER                             01104802
RDXENTRG EQU   8              BASE FOR READX LIST ENTRY                 01105202
DEBEXTRG EQU   8              BASE REG FOR DASD PART OF DEB             01105602
RDXSEGRG EQU   9              ADDR OF CURRENT SEGMENT OF READ    Y02072 01106002
*                             EXCLUSIVE LIST                     Y02072 01108002
WKREG9   EQU   9              WORK REGISTER                             01158002
LENREG1  EQU   9              REG WITH DECB LENGTH VALUE                01168002
*                             OF IOB RELEASING THE BLOCK                01178002
BLKREFRG EQU   9              BLKREF ADDRESS PASSED IN R0 BY USER       01180002
DEBREG   EQU   9              DEB ADDRESS DURING ARGUMENT CREATE Y02072 01180402
RLINK2   EQU   9              LINKAGE REGISTER                   Y02072 01182002
R10      EQU   10             TCB ADDR INPUT REG FOR BRANCH      Y02072 01184002
*                             ENTRY TO DEBCHK                    Y02072 01186002
RDXCTREG EQU   10             REG FOR COUNTING ENTRIES IN               01188002
*                             THE READX LIST                            01198002
IOBQREG1 EQU   10             IOB RELEASING CONTROL OF BLK              01200002
LENREG2  EQU   10             DECB LENGTH VALUE OF NEXT                 01200402
*                             IOB TO GET CONTROL OF BLK                 01200802
WKREG4   EQU   10             WORK REGISTER                      Y02072 01201002
RDXREG   EQU   11             BASE FOR READX LIST                       01201202
IOBQREG2 EQU   11             NEXT IOB TO GET CONTROL OF BLK            01201602
ENQREG   EQU   12             ADDR OF COMPARE ARG FOR RDX LST    Y02072 01201702
RRLBRC   EQU   12             RETURN CODE REG FROM REL BLK RTNES Y02072 01202002
WKREG3   EQU   12             WORKING REGISTER                          01204002
DECBREG2 EQU   12             DECB POINTED TO BY NEXT IOB TO            01208002
*                             GET CONTROL OF THE BLOCK                  01208402
RDCBFBK  EQU   13             ADDR OF DCB FOR FEEDBACK ROUTINE   Y02072 01210002
R14      EQU   14             REG 14 FOR SYSTEM INTERFACES       Y02072 01210402
RLINK    EQU   14             INTERNAL LINKAGE REGISTER          Y02072 01212002
RSYNCHRT EQU   14             BASE USED AFTER RETURN FROM SYNCH  Y02072 01220002
RRETURN  EQU   14             RETURN ADDRESS                     Y02072 01238002
R15      EQU   15             REG 15 FOR SYSTEM INTERFACES       Y02072 01238402
RETCODRG EQU   15             RETURN CODE REGISTER                      01252002
         EJECT                                                          01360000
*********************************************************************** 01360402
*                                                                     * 01360802
*        GENERAL INITIALIZATION:                                      * 01361202
*              CLEAR SVRB EXTENDED SAVEAREA, SAVE RETURN REGISTER     * 01361602
*                (WKASAV14), SAVE CALLER'S PROTECT KEY (WKASVKEY)     * 01361702
*              ISSUE ESTAE.                                           * 01361802
*              INITIALIZE IOB POINTER (GR7), DCB POINTER (GR4),       * 01361902
*                DECB POINTER (GR6), FOR NON-RELEX REQUEST.           * 01365502
*              SET BIT WTAD2305 FOR 2305 FORMAT F WRITE-ADD           * 01367502
*              EXIT TO RELEX INITIALIZATION (LABEL RELEX) FOR         * 01367902
*                RELEX; OTHERWISE EXIT TO CREATE ENQUEUE ARGUMENT     * 01368302
*                (LABEL NQARG01).                                     * 01368702
*              THIS CODE IS EXECUTED IN KEY 0.                        * 01369102
*                                                                     * 01369402
*********************************************************************** 01369802
*                                                                       01369902
         USING PSA,0                    PREFIXED SAVE AREA IS    Y02072 01370002
*                                       ALWAYS ADDRESSABLE       Y02072 01372802
         USING RBSECT,SVRBREG           SVRB ADDRESSABILITY      Y02072 01376402
         BALR  BASEREG,0                 SET BASE REGISTER              01380002
         USING *,BASEREG                                                01390002
BASEVAL  EQU   *                        VALUE IN BASE REGISTER   Y02072 01400002
         XC    RBEXSAVE,RBEXSAVE        CLEAR EXTENDED SAVEAREA  Y02072 01440002
*                                       FOR WORKAREA             Y02072 01490002
         ST    RRETURN,WKASAV14         SAVE RETURN ADDRESS      Y02072 01500002
*                                       MOVE LIST FORM OF ESTAE  Y02072 01502002
         MVC   WKALST(ESTAELN),ESTAELST      TO WORKAREA         Y02072 01510002
*                                       ESTABLISH RECOVERY RTNE  Y02072 01512002
         ESTAE PARAM=(SVRBREG),MF=(E,WKALST)                     Y02072 01520002
*                                                                       01530002
         L     WKREG2,RBLINK            GET CALLER'S RB ADDR     Y02072 01530102
         USING RBSECT,WKREG2            ADDRESS THIS RB          Y02072 01530202
         DROP  SVRBREG                                           Y02072 01530302
         IC    WKREG2,RBOPSW+1          GET CALLER'S KEY         Y02072 01530502
         USING RBSECT,SVRBREG           RESTORE ADDRESSABILITY   Y02072 01530902
         DROP  WKREG2                    TO SVRB                 Y02072 01531202
         STC   WKREG2,WKASVKEY          SAVE CALLER'S KEY IN     Y02072 01531602
*                                       SVRB                     Y02072 01532002
*                                                                       01532702
         LM    PARREG0,PARREG1,RBGRS0   GET ENTRY REGS 0 AND 1   Y02072 01534002
         LCR   IOBREG,PARREG1           RELEX MACRO CALL?        Y02072 01534402
         BNP   RELEX                    BRANCH IF YES            Y02072 01534802
         MODESET  KEYADDR=WKASVKEY,WORKREG=2 CHG TO USER KEY   @ZA31947 01535037
         USING IOBSTDRD,IOBREG          IOB ADDRESSABILITY       Y02072 01535302
         L     DCBREG,IOBDCBPT          GET DCB ADDRESS          Y02072 01536802
         USING IHADCB,DCBREG                                     Y02072 01537202
         L     DECBREG,IOBECBPT         GET DECB ADDRESS         Y02072 01538802
         MODESET  EXTKEY=ZERO           CHG BACK TO ZERO KEY   @ZA31947 01539037
*                                                                       01539302
*              DETERMINE IF THIS IS A WRITE-ADD REQUEST WITH FIXED      01539702
*              RECORD FORMAT.  IF SO, DEVICE MUST BE A 2305.            01540102
*                                                                       01540202
         TM    IOBDTYP2,IOBADDTY        IS THIS A WRITE-ADD?     Y02072 01540302
         BZ    NQARG01                  BRANCH IF NOT            Y02072 01540602
         TM    DCBRECFM,DCBRECF         IS RECORD FORMAT FIXED?  Y02072 01541002
         BZ    NQARG01                  BRANCH IF NOT            Y02072 01541102
         TM    DCBRECFM,DCBRECU         CHECK UNDEFINED FORMAT   Y02072 01541202
         BO    NQARG01                  BRANCH IF UNDEFINED      Y02072 01541302
         OI    WKASW1,WKAD2305          SET 2305 INDICATOR       Y02072 01544202
         B     NQARG01                                           Y02072 01544402
         DROP  DCBREG                                            Y02072 01544602
*                                                                       01544802
         EJECT                                                          01544902
*********************************************************************** 01545002
*                                                                     * 01547002
*        ADDITIONAL RELEX INITIALIZATION:                             * 01547402
*              ISSUE GETMAIN FOR 132 BYTES SUBPOOL ZERO CORE TO BE    * 01547802
*                USED AS IOB & DECB.  IF CORE IS NOT AVAILABLE,       * 01548202
*                BRANCH TO ABEND WITH COMPLETION CODE 535.            * 01548602
*              SAVE ADDRESS OF CORE OBTAINED (WKARLCOR).              * 01548702
*              INITIALIZE IOB AND DECB FIELDS -- IOBDCBPT, IOBDIOBS,  * 01548802
*                IOBDTYP2, DECRECPT.  ALL OTHER FIELDS ARE ZEROES.    * 01551702
*              CONVERT BLOCK REFERENCE FIELD PASSED BY USER FROM      * 01553702
*                RELATIVE TRACK ADDRESS (TTR) OR RELATIVE BLOCK       * 01554102
*                ADDRESS FORMAT TO ACTUAL ADDRESS FORMAT (MBBCCHHR).  * 01554502
*                IF BLOCK ADDRESS IS NOT CONVERTIBLE BECAUSE IT IS    * 01557602
*                INVALID, BRANCH TO EXIT WITH RETURN CODE 08.  ONE OF * 01559602
*                THE EXTERNAL ROUTINES, IECPCNVT, IGG019KE, IGG019KF, * 01560002
*                WILL BE USED FOR THE CONVERSION.  FOR SYSTEM INTEG-  * 01560402
*                RITY REASONS, IGG019KE AND IGG019KF ARE GIVEN CON-   * 01560802
*                TROL VIA A SYNCH MACRO INSTRUCTION AND MODULE REGI-  * 01560902
*                STERS WHICH POINT TO SYSTEM INFORMATION (I.E. THE    * 01561002
*                BASE REGISTER AND SVRB POINTER) ARE REINITIALIZED    * 01566502
*                UPON RETURN OF CONTROL BY THE INTERNAL ROUTINE,      * 01568502
*                SYNRETRN.                                            * 01570502
*              ACTUAL BLOCK ADDRESS IS PLACED IN IOBSEEK.             * 01570902
*              EXIT TO CREATE ENQUEUE ARGUMENT (LABEL NQARG00), OR TO * 01571302
*                ABEND FOR INSUFFICIENT MAIN STORAGE (LABEL           * 01571702
*                ABEND535), OR TO RETURN TO USER WITH RETURN CODE 08  * 01572102
*                FOR AN INVALID BLOCK ADDRESS (LABEL RELEXIT2).       * 01572202
*              THIS CODE EXECUTES IN THE CALLER'S KEY EXCEPT WHEN     * 01572302
*                INITIALIZING WKARLCOR.                               * 01572402
*                                                                     * 01574302
*********************************************************************** 01578102
*                                                                       01580002
RELEX    MODESET KEYADDR=WKASVKEY,WORKREG=2                      Y02072 01583502
*                                                                       01589002
         L     DCBREG,44(PARREG1)       DEB ADDRESS            @ZA29870 01594537
         LA    DEBREG,X'10'                                    @ZA29870 01594937
         SR    DCBREG,DEBREG            DEB PREFIX ADDRESS     @ZA29870 01595337
         L     DCBREG,8(DCBREG)         DEB EXTENSION ADDRESS  @ZA29870 01595737
         L     DEBREG,20(DCBREG)        EXCL CTRL LIST ADDRESS @ZA29870 01596137
         LA    DEBREG,0(DEBREG)         CLEAR HIGH BYTE        @ZA29870 01596537
         LTR   DEBREG,DEBREG            IS THERE A LIST?       @ZA29870 01596937
         BNZ   OKLIST                   YES - BYPASS ERROR     @ZA29870 01597337
         LA    RTCODRG2,INVALBLK        NO - LOAD ERROR CODE   @ZA29870 01597737
         B     EXIT1                    AND GO TO EXIT RTN     @ZA29870 01598137
OKLIST   LR    BLKREFRG,PARREG0         SAVE BLKREF ADDRESS    @ZA29870 01598537
         LR    DCBREG,PARREG1           MOVE DCB ADDRESS TO DCBREG      01600002
         USING IHADCB,DCBREG            ESTABLISH BASE FOR DCB          01602002
*                                                                       01652002
*                                       GET CORE FOR DUMMY IOB   Y02072 01662002
         GETMAIN RC,SP=SPIOB,LV=IOBLG                            Y02072 01672002
*                                                                       01674002
         LTR   R15,R15                  TEST RETURN CODE         Y02072 01676002
         BNZ   ABEND535                 GO ABEND IF NO CORE      Y02072 01678002
         SPACE                                                          01680002
*  CHANGE KEY AND SAVE THE ADDRESS OF THE CORE OBTAINED FOR THIS REQ. * 01688002
*  THE ESTAE WILL FREE THIS CORE, SHOULD AN ABEND OCCUR DURING SVC    * 01688402
*  PROCESSING.                                                        * 01688802
*                                                                       01689202
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 01689602
*                                                                       01689702
         ST    R1,WKARLCOR              SAVE CORE ADDRESS        Y02072 01689802
*                                                                       01689902
         MODESET  KEYADDR=WKASVKEY,WORKREG=2  RETURN TO USER KEY Y02072 01692402
*                                                                       01694402
*                                                                       01695002
*              INITIALIZE GOTTEN CORE AS IOB AND DECB                   01697502
*                                                                       01700002
         LR    IOBREG,R1                PUT ADDRESS OF GOTTEN CORE      01702502
         USING IOBSTDRD,IOBREG          ESTABLISH BASE FOR IOB          01705002
         XC    IOBSTDRD(IOBLG),IOBSTDRD CLEAR DUMMY IOB AREA            01707502
         ST    DCBREG,IOBDCBPT          STORE DCB ADDR IN IOB    Y02072 01710002
         LA    WKREG1,IOBLG             LOAD LENGTH OF IOB              01720002
         STH   WKREG1,IOBDIOBS          STORE LENGTH IN IOB             01740002
         MVI   IOBDTYP2,IOBRELEX        SET TYPE FIELDS TO INDI- Y02072 01752002
*                                       CATE RELEX ONLY          Y02072 01754002
         LR    DECBREG,IOBREG           DECB OVERLAYS IOB        Y02072 01760002
         USING DECB,DECBREG             ESTABLISH BASE FOR DECB         01770002
         ST    BLKREFRG,DECRECPT        STORE BLKREF ADDRESS IN DECB    01800002
*********************************************************************** 01890002
*   THIS ROUTINE WILL CONVERT THE TTR OR REL BLK ID TO MBBCCHHR IF    * 01892002
*   NECESSARY.                                                        * 01894002
*********************************************************************** 01896002
         TM    DCBOPTCD,DCBOPTF         IS FEEDBACK SPECIFIED IN DCB    01920002
         BZ    ACTUAL                   NO, FDBACK ACTUAL FOR READX     01940002
         TM    DCBOPTCD,DCBOPTRB        IS ADDRESSING SCHEME            01960002
         BO    RELBLK                   BY RELATIVE BLOCK BRANCH        01980000
         TM    DCBOPTCD,DCBOPTA         IS ADDRESSING (HENCE ALSO FEED- 02000002
         BO    ACTUAL                   BACK) BY ACTUAL ADDRESS BRANCH  02020002
**********************************************************************  02030002
*                                                                       02032002
TTR      EQU   *                        ADDRESSING IS REL TRK           02040002
*                                                                       02090002
*        THE FOLLOWING LOGIC USES THE SYSTEM CONVERT ROUTINE,           02100002
*        IECPCNVT, TO CONVERT A RELATIVE TRACK ADDRESS (TTR) TO         02110002
*        A DASD ADDRESS OF THE FORM MBBCCHHR.                           02112002
*                                                                       02112402
*              INPUT TO THE CONVERT ROUTINE IS:                         02112802
*                  R0    CONTAINS TTR0                                  02113202
*                  R1    DEB ADDRESS                                    02113302
*                  R2    ADDRESS OF IOBSEEK                             02113402
*                  R14   RETURN ADDRESS                                 02113502
*                  R15   IECPCNVT ENTRY POINT ADDRESS                   02113902
*              OUTPUT IS:                                               02114002
*                  R9 - R13 CONTENTS DESTROYED                          02114102
*                  R15   RETURN CODE                                    02114202
*                        THE RETURN CODE IS ZERO IF THE INPUT TTR       02114302
*                        CORRESPONDS TO SOME MBBCCHHR IN THE DATASET    02114402
*                        EXTENTS DESCRIBED BY THE DEB, OTHERWISE        02114502
*                        THE RETURN CODE IS FOUR.                       02114602
*                  IOBSEEK -- OUTPUT MBBCCHHR ( IF RETCODE = 0 )        02114702
*                                                                       02114802
**********************************************************************  02114902
*                                                                       02115002
*              IOBDCPND IS USED AS A WORK FIELD TO LOAD R0.             02115102
*                                                                       02115202
         MVC   IOBDCPND(LTTR),0(BLKREFRG)  ALIGN TTR FOR LOAD    Y02072 02115302
         MVI   IOBDCPND+LTTR,0          0 FOR TTR0               Y02072 02115402
         L     R0,IOBDCPND              TTR0 TO R0               Y02072 02115502
*                                                                       02115602
         L     R1,DCBDEBAD              LOAD INPUT DEB ADDR      Y02072 02115702
         LA    R2,IOBSEEK               INPUT PTR TO IOBSEEK     Y02072 02115802
         L     R15,CVTPTR               ADDRESS OF CVT           Y02072 02115902
         USING CVT,R15                                           Y02072 02116002
         L     R15,CVTPCNVT             ADDRESS OF IECPCNVT      Y02072 02116102
         DROP  R15                                               Y02072 02116202
         BALR  R14,R15                  GO TO CONVERT ROUTINE    Y02072 02116302
         LTR   R15,R15                  WAS ADDRESS VALID        Y02072 02116402
         BZ    NQARG00                  YES, CONTINUE PROCESSING Y02072 02116502
         LA    RTCODRG2,INVALBLK        NO, LOAD ERROR CODE      Y02072 02116602
         B     RELEXIT2                 PREPARE TO EXIT          Y02072 02116702
*                                                                       02116802
ACTUAL   MVC   IOBSEEK,0(BLKREFRG)      MOVE ADDRESS TO SEEK FIELD      02116902
         B     NQARG00                  GO TO READ EXCLUSIVE RTN        02117002
*                                                                       02117102
*********************************************************************** 02117502
*                                                                       02117902
RELBLK   EQU   *                                                 Y02072 02118002
*                                                                       02118102
*        THE FOLLOWING LOGIC USES ONE OF THE BDAM RELATIVE BLOCK        02118502
*        ADDRESS CONVERSION ROUTINES, IGG019KE OR IGG019KF, TO          02120502
*        CONVERT A RELATIVE BLOCK ADDRESS TO A DASD ADDRESS OF THE      02120902
*        FORM MBBCCHHR.                                                 02121302
*                                                                       02121702
*        THE ENTRY POINT OF THE CONVERSION ROUTINE IS GOTTEN FROM       02121802
*        THE FOUNDATION MODULE, AND THE ADDRESS OF THE FOUNDATION       02121902
*        MODULE IS GOTTEN FROM THE DCB; THEREFORE THE CONVERSION        02122202
*        MODULE MUST BE GIVEN CONTROL IN PROBLEM PROGRAM STATE AND      02122602
*        KEY, VIA SYNCH.  UPON RETURN FROM THE MODULE, NO REGISTER      02123002
*        CONTENTS CAN BE RELIED ON.                                     02123402
*                                                                       02123802
*              INPUT TO THE RELATIVE BLOCK CONVERSION MODULE IS:        02123902
*                  R3    DEB ADDRESS                                    02124002
*                  R4    DCB ADDRESS (SAME USAGE AS THIS MODULE)        02124102
*                  R5    DECB ADDRESS                                   02124202
*                  R7    IOB ADDRESS (SAME USAGE AS THIS MODULE)        02124302
*                  R15   ENTRY POINT OF IGG019KE OR IGG019KF            02124402
*                  DECRECPT -- POINTER TO RELATIVE BLOCK ADDRESS        02124502
*                              TO CONVERT                               02124602
*                  IOBSTAT1, BIT IOBSYNCH -- SET TO ONE TO INDICATE     02125002
*                              ENTRY WAS VIA SYNCH                      02125102
*                  IOBCSW-1 (LENGTH 4) -- SET TO ZERO FOR USE AS A      02125202
*                              WORKAREA BY CONVERSION MODULES           02125302
*              OUTPUT IS:                                               02125402
*                  R12   RETURN CODE; = 0 IF RELATIVE BLOCK ADDRESS     02125802
*                              IS WITHIN DATA SET, OTHERWISE = 16       02125902
*                  IOBSEEK -- SET TO MBBCCHHR CORRESPONDING TO          02126002
*                              RELATIVE BLOCK ADDRESS                   02126102
*                                                                       02126202
*********************************************************************** 02126602
*                                                                       02126702
         L     R15,DCBREAD              GET FOUNDATION ADDRESS          02127002
         USING FOUNDENT,R15             ESTABLISH BASE FOR VECTOR TABLE 02127102
*                                       THIS VECTOR TABLE IS REAL ONE   02127202
         SR    WKREG1,WKREG1            SET REG TO ZERO          Y02072 02127602
         ST    WKREG1,IOBCSW-1          ZERO OUT CSW FIELD OF IOB       02130002
         TM    DCBRECFM,DCBRECTO        IS RECFM OVERFLOW       SA53131 02130402
         BZ    NOTOVFLO                 IF NOT, LOAD 19KE FROM  SA53131 02130802
*                                       FRONT OF FOUNDATION MODULE      02131202
         L     R15,RROVAD               OR ,LOAD 19KF FROM 19KA SA53131 02131602
         B     RELBLK1                  BRANCH TO SETUP         SA53131 02132002
NOTOVFLO EQU   *                        REL BLK,NOT OVFLO       SA53131 02132402
         L     R15,RRAD                 GET RELATIVE BLOCK ADDRESS AND  02132802
         DROP  R15                                                      02133202
RELBLK1  EQU   *                                                        02133602
         L     RRLBDEB,DCBDEBAD         DEB ADDRESS              Y02072 02134002
         LR    RRLBDECB,DECBREG         DECB ADDRESS             Y02072 02134402
         OI    IOBSTAT1,IOBSYNCH        INDICATE ENTRY VIA SYNCH Y02072 02134802
         SYNCH (15)                     BR TO REL BLK ADRS IN PP A35339 02135202
         DROP  BASEREG                  CANNOT RELY ON RETURNED  Y02072 02135602
*                                       REGISTERS                Y02072 02136002
         BALR  RSYNCHRT,0               ESTABLISH TEMP BASE      Y02072 02136402
         USING *,RSYNCHRT               TEMP ADDRESSABILITY      Y02072 02136802
         BAL   RLINK,SYNRETRN           GO RESTORE REGISTERS     Y02072 02137202
         DROP  RSYNCHRT                                          Y02072 02137602
         USING BASEVAL,BASEREG          MODULE ADDRESSABILITY    Y02072 02138002
         LA    RTCODRG2,INVALBLK        LOAD ERROR CODE          Y02072 02138102
         LTR   RRLBRC,RRLBRC            WAS ADDRESS VALID        Y02072 02138402
         BNZ   RELEXIT2                 NO, PREPARE TO EXIT      Y02072 02139602
*                                                                       02382002
         EJECT                                                          02432002
*********************************************************************** 09228102
*                                                                     * 09238102
*  BUILD ENQ/DEQ ARGUMENT AND VALIDATE IT                             * 09248102
*        THE 8 BYTE ARGUMENTS CONSISTS OF:                            * 09250102
*              3 BYTES - UCB ADDRESS                                  * 09252102
*              5 BYTES - CCHHR OF BLOCK                               * 09254102
*        THE FOLLOWING ROUTINE BUILDS THE ENQ/DEQ ARGUMENT            * 09256102
*        IN THE SVRB EXTENDED SAVEAREA (AT LABEL WKANQARG) IF         * 09256502
*        THE DEBCHK ROUTINE DETERMINED THAT THE DCB CONTAINED         * 09256602
*        A VALID DEB ADDRESS. ONCE THE ARGUMENT IS BUILT IT IS        * 09256702
*        MATCHED WITH THE DEB EXTENTS TO ENSURE THAT THE BLOCK        * 09256802
*        ADDRESS IS WITHIN THE BOUNDARIES OF THE DATA SET. IF         * 09262102
*        IT IS FOUND NOT TO BE, AN ABEND 335 IS ISSUED.               * 09264102
*                                                                     * 09272802
*        THE BLOCK FOR WHICH EXCLUSIVE CONTROL IS OBTAINED OR         * 09274802
*        RELEASED DEPENDS ON THE TYPE OF REQUEST:                     * 09276802
*              RELEX - THE BLOCK ID SPECIFIED IN THE MACRO            * 09277202
*              READ/WRITE UPDATE - THE BLOCK SPECIFIED IN             * 09277602
*                   THE DECB, WHICH IS ALSO THE VALUE IN IOBSEEK+3    * 09278002
*              WRITE-ADD - REC 0 OF THE TRACK UPON WHICH SPACE        * 09294702
*                   IS TO BE FOUND, ALSO THE VALUE IN IOBDNCRF+2      * 09304702
*              WRITE-ADD,FIXED,2305,NO EXTENDED SEARCH - REC 0        * 09306702
*                   OF THE TRACK UPON WHICH SPACE IS TO BE FOUND      * 09308702
*              WRITE-ADD,FIXED,2305,EXTENDED SEARCH - REC 0 OF        * 09310702
*                   THE FIRST TRACK IN THE DATA SET                   * 09311102
*                                                                     * 09361102
*********************************************************************** 09378102
NQARG00  EQU   *                        SET UP ENQ LIST                 09628102
*                                                                       09638102
         MODESET EXTKEY=ZERO            CHANGE TO KEY ZERO       Y02072 09648102
*                                                                       09650102
NQARG01  EQU   *                        E.P. IF ALREADY KEY 0    Y02072 09650502
*                                                                       09650902
*                                       GET THE LOCAL LOCK       Y02072 09652102
LOCKSCAN SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02072X09654102
               RELATED=(EXCLCTLQ,IGC0005C(FRELCK1,FRELCK2,FRELCK3,FRELCX09656102
               K4,FRELCK7))                                      Y02072 09656502
*                                                                       09658102
         BAL   RLINK2,DEBCHKRT          VALIDATE DEB             Y02072 09708102
         L     DEBREG,WKASVDEB          SAVE DEB ADDR IN REG     Y02072 09718102
         USING DEBBASIC,DEBREG          ADDRESS DEB              Y02072 09728102
*                                                                       09740402
         TM    IOBDTYP2,IOBRQUST+IOBADDTY READ OR WRITE ADD REQ? Y02072 09750402
         BZ    DEQREQ                   NO, MUST BE WRT REL      Y02072 09760402
WAREAD   EQU   *                        IF WRT ADD OR READ       Y02072 09770402
         TM    IOBDSTAT,IOBENQUE        IS THIS DEQ REQUEST      Y02072 09790402
         BNO   ENQREQ                   NO BR AROUND NEXT INST   Y02072 09800402
DEQREQ   EQU   *                        SET BIT FOR DEQ REQ      Y02072 09802402
         OI    WKASW1,WKADEQRQ          SET DEQ BIT IN SVRB WKA  Y02072 09810402
         B     TEST2305                 BR AROUND NEXT INST      Y02072 09820402
ENQREQ   EQU   *                        ENQ REQ BIT SET          Y02072 09822402
         OI    WKASW1,WKAENQRQ          SET ENQ BIT IN SVRB WKA  Y02072 09824402
TEST2305 EQU   *                        TEST FOR WA              Y02072 09826402
         TM    IOBDTYP2,IOBADDTY        IS THIS A WRITE ADD             09828102
         BZ    NOTADD                   BRANCH IF NO                    09878102
         TM    WKASW1,WKAD2305          IS THIS A 2305 FIXED     Y02072 09878502
*                                       WRITE-ADD REQUEST?       Y02072 09878902
         BZ    WRTADD                   BRANCH NO                Y02072 09879302
*                                                                       09879402
*              FOR A 2305 FIXED-FORMAT WRITE-ADD WITHOUT                09879702
*              EXTENDED SEARCH, THE REQUEST REQUIRES EXCLUSIVE          09879802
*              CONTROL OF A SINGLE TRACK.  AN EXTENDED SEARCH           09879902
*              REQUEST GETS CONTROL OF THE WHOLE DATA SET,              09880002
*              REPRESENTED BY R0 OF THE FIRST TRACK.                    09892002
*                                                                       09902002
         TM    DCBOPTCD,DCBOPTE         IS IT EXTENDED SEARCH    Y02072 09904002
         BZ    WRTADD                   BRANCH NO, ENQ ON TRK    Y02072 09906002
         USING DEBDASD-(DEBBASND-DEBBASIC),DEBREG                YM5762 09920002
         MVC   WKANQUCB,DEBUCBA         UCB ADDR TO ENQ AREA     Y02072 09941602
*                                       TRK 1 ADDR TO ENQ AREA   Y02072 09941702
         MVC   WKANQCC(L'WKANQCC+L'WKANQHH),DEBSTRCC             Y02072 09942002
         MVI   WKANQR,0                 REC# = 0                 Y02072 09942402
         B     SCAN0                    BRANCH TO SCAN LIST      Y02072 09942802
         DROP  DEBREG                   DROP DEB BASE            YM5762 09942902
*                                                                       09943202
WRTADD   MVI   WKANQR,X'00'             ZERO OUT REC# FIELD      Y02072 09943302
*                                       MOVE RECORD ADDRESS TO   Y02072 09954902
         MVC   WKANQDEV(L'WKANQCC+L'WKANQHH),IOBCC   ENQ AREA    Y02072 09966502
         B     LOADEXTN                 BRANCH AROUND NEXT INST         09978102
NOTADD   TM    IOBDTYP2,IOBRELEX        IS THIS A RELEX REQUEST? Y02072 09988102
         BZ    EXCLCTL                  NO, MUST BE EXCL CTL     Y02072 09998102
         MVC   WKANQDEV,IOBCC           SEARCH ARG IN IOBSEEK    Y02072 10008102
         B     LOADEXTN                 BR TO GET UCB ADDR       Y02072 10018102
EXCLCTL  MVC   WKANQDEV,IOBDNCRF+2      MOVE REC ADDR TO ENQ     Y02072 10028102
*                                       AREA                     Y02072 10038102
*                                                                       10078102
LOADEXTN SR    DEBEXTRG,DEBEXTRG        CLEAR REGISTER                  10128102
         CLC   IOBM(1),16(DEBREG)       COMPARE EXTENTS        @ZA28583 10138137
         BH    ABEND435                 BRANCH IF IN EXCESS    @ZA28583 10148137
         IC    DEBEXTRG,IOBM            GET EXTENT NUMBER               10178102
         SLL   DEBEXTRG,4               TIMES 16                        10228102
         AR    DEBEXTRG,DEBREG          PLUS DEB ADDRESS         Y02072 10278102
         USING DEBDASD-(DEBBASND-DEBBASIC),DEBEXTRG    ADDRESS   Y02072 10378102
*                                       EXTENT DESCRIPTION       Y02072 10388102
         MVC   WKANQUCB,DEBUCBA         UCB ADDR TO ENQ AREA     Y02072 10428102
*                                                                       10430102
*              IT IS NOW NECESSARY TO VERIFY THAT THE TRACK             10438102
*              WE WILL ENQUEUE ON IS IN THE DATA SET DESCRIBED          10448102
*              BY THIS VALID DEB.                                       10458102
*                                                                       10468102
         CLC   WKANQCC,DEBSTRCC         COMPARE CYL : START CLY  Y02072 10474102
         BL    ABEND335                 ABEND, NOT IN EXTENT     Y02072 10476102
         BH    TSTHICYL                 CYL IS NOT 1ST IN EXT    Y02072 10476502
         CLC   WKANQHH,DEBSTRHH         CYL IS 1ST IN EXTENT,    Y02072 10476902
*                                        IS HEAD IN EXTENT?      Y02072 10477302
         BL    ABEND335                 BRANCH NO, ABEND         Y02072 10477702
         B     SCAN0                    YES, GOOD ADDRESS        Y02072 10477802
*                                                                       10477902
TSTHICYL CLC   WKANQCC,DEBENDCC         COMPARE CYL : END CYL    Y02072 10478002
         BH    ABEND335                 ABEND, NOT IN EXTENT     Y02072 10528002
         BL    SCAN0                    BRANCH, TRK IN EXTENT    Y02072 10538002
         CLC   WKANQHH,DEBENDHH         CYL IS LAST IN EXTENT,   Y02072 10548002
*                                        IS HEAD IN EXTENT       Y02072 10558002
         BH    ABEND335                 BRANCH NO, ABEND         Y02072 10568002
*                                                                       10570002
         DROP  DEBEXTRG                                                 10757602
         EJECT                                                          10759602
*********************************************************************** 10761002
*                                                                     * 10763002
*   FOR ALL REQUESTS - SCAN EXCLUSIVE CONTROL LIST FOR MATCH          * 10763402
*                                                                     * 10763502
*        THE FOLLOWING ROUTINE SCANS THE EXCLUSIVE CONTROL LIST,      * 10763802
*        INCLUDING ALL SEGMENTS IF THERE BE MORE THAN ONE, LOOKING    * 10764202
*        FOR A MATCH WITH THE ENQ/DEQ ARGUMENT WHICH HAS JUST         * 10764302
*        BEEN BUILT AND VERIFIED IN THE SVRB EXTENDED SAVEAREA.       * 10767702
*                                                                     * 10769702
*        WHEN THE SEARCH IS COMPLETED, EITHER BY FINDING A MATCH      * 10774902
*        OR REACHING THE END OF THE LIST, THE TYPE OF REQUEST         * 10776902
*        IS INTERROGATED, TO DETERMINE WHAT ROUTINE SHOULD            * 10777302
*        RECEIVE CONTROL.                                             * 10777402
*                                                                     * 10777502
*   IN SUMMARY, THE FOLLOWING ACTIONS WILL BE TAKEN:                  * 10777602
*                                                                     * 10777702
*        IF THE REQUEST IS A DEQ REQUEST AND NO MATCH IS FOUND,       * 10778002
*        AN ERROR CONDITION EXISTS, RESULTING IN A RETURN CODE        * 10778102
*        OF 4 IF A RELEX REQUEST.                                     * 10788702
*                                                                     * 10799902
*        IF THE REQUEST IS A DEQ REQUEST AND A MATCH IS FOUND,        * 10809902
*        CONTROL OF THE BLOCK WILL BE GIVEN TO THE FIRST IOB          * 10810302
*        WAITING ON THE UNPOSTED QUEUE, OR IF NONE ARE WAITING,       * 10810702
*        THE BLOCK WILL BE DEQUEUED AND REMOVED FROM THE LIST.        * 10810802
*                                                                     * 10810902
*        IF THE REQUEST IS AN ENQ REQUEST AND A MATCH IS FOUND,       * 10814602
*        THE IOB FOR THIS REQUEST WILL BE ADDED TO THE UNPOSTED       * 10816602
*        QUEUE ASSOCIATED WITH THIS BLOCK.                            * 10817002
*                                                                     * 10817402
*        IF THE REQUEST IS AN ENQ REQUEST AND NO MATCH IS FOUND,      * 10817802
*        THE ENQ ARGUMENT IS PUT ON THE EXCLUSIVE CONTROL LIST,       * 10818202
*        AN ENQ MACRO AND EXCP MACRO ARE ISSUED, GIVING THE           * 10818302
*        CURRENT REQUESTOR CONTROL OF THE BLOCK.                      * 10820902
*                                                                     * 10822902
*********************************************************************** 10824502
*                                                                       10827102
SCAN0    EQU   *                        SCAN THE READX LIST      Y02072 10829702
         MVI   WKATRALX,WKAVALRC        AUDIT TRAIL INDICATES    Y02072 10832302
*                                       THAT VALIDATED REC HAS   Y02072 10834902
*                                       BEEN SAVED IN SVRB       Y02072 10837502
*                                       CHANGE TO CALLER'S       Y02072 10840102
         MODESET KEYADDR=WKASVKEY,WORKREG=2     PROTECT KEY      Y02072 10842702
*                                                                       10845302
*                                                                       10847902
SCANXARG EQU   *                        LOOK FOR MATCH ON READX LIST    10861402
*                                                                       10878102
*              GET EXCLUSIVE CONTROL LIST ADDRESS                       10928102
*                                                                       10938102
         LA    WKREG1,DEBBASIC-DEBPREFX LENGTH OF DEB PREFIX     Y02072 10970102
         SR    DEBREG,WKREG1            ADDR OF DEB PREFIX       Y02072 10972102
         USING DEBPREFX,DEBREG                                   Y02072 10974102
         L     DEBREG,DEBXTNP           ADDR OF DEB EXTENSION    Y02072 10976102
         USING DEBXTN,DEBREG            EXTENSION ADDRESSABILITY Y02072 10976502
         L     RDXREG,DEBXXARG          READ EXCLUSIVE LIST ADDR Y02072 10976902
         DROP  DEBREG                                            Y02072 10977302
         USING RDXLIST,RDXREG           SET UP ADDRESSABILITY           10978102
*                                                                       10988102
         LA    RDXREG,0(0,RDXREG)       CLEAR HIGH ORDER BYTE           11028102
         LR    WKREG2,RDXREG            SAVE PTR TO READX LIST   Y02072 11030102
         LA    ENQREG,WKANQARG          POINT TO ENQ MINOR NAME  Y02072 11038102
         USING WKANQARG,ENQREG                                   Y02072 11048102
NXTSEG   LR    RDXSEGRG,RDXREG          PTR TO CURRENT SEGMENT   Y02072 11078102
         LA    RDXCTREG,RDXMAXCT        PICK UP # SLOTS PER SEG  Y02072 11428102
         LA    RDXENTRG,RDXENT          ESTABLISH BASE FOR ENTRY        11478102
         USING RDXENTRY,RDXENTRG        IN THE READX LIST               11528102
SCANLIST EQU   *                        DOES ENTRY ALREADY EXIST        11578102
         CLC   RDXNQARG,WKANQARG        COMPARE ENQ ENTRY        Y02072 11628102
         BE    TYPETST                  YES-DETERMINE TYPE OF REQUEST   11678102
         LA    RDXENTRG,RDXENTLN(RDXENTRG) NO, UP PTR TO CK NEXT ENTR   11728102
         BCT   RDXCTREG,SCANLIST        MORE ENTRIES CONTINUE IF YES    11778102
GETPTR   L     RDXREG,RDXNEXT           GET ADDR OF NEXT SEGMENT        11828102
         LA    RDXREG,0(0,RDXREG)       ZERO HI ORDER BTYE              11878102
         LTR   RDXREG,RDXREG            TEST FOR ZERO(NO POINTER)       11928102
         BNZ   NXTSEG                   GO SEARCH NEW SEGMENT    Y02072 11978102
         DROP  RDXREG                                                   12078102
*********************************************************************** 12178102
*  THIS ROUTINE INTERROGATES THE KIND OF REQUEST.  IT MUST BE A READX,* 12228102
*  WRITE ADD, WRITE RELEASE OR RELEX.  IF THE REQUEST IS A WRITE REL, * 12278102
*  RELEX OR WRITE ADD TO RELEASE AN ENQ'D TRK, CONTROL IS PASSED TO   * 12328102
*  THE 'WRTTYPE' ROUTINE.  ELSE IT IS ASSUMED THAT ENTRY IS TO ENQ ON * 12378102
*  A BLOCK.  ONE OR TWO SEARCHES HAVE ALREADY BEEN MADE THROUGH THE   * 12428102
*  READX LIST.  THE FIRST PASS THROUGH THE LIST IS TO FIND A COMPARE  * 12478102
*  EQUAL ON THE BLOCK ID ASSOCIATED WITH THE CURRENT REQUEST.  THE    * 12528102
*  SECOND PASS IS TO FIND AN EMPTY SLOT FOR AN ENQ REQUEST ENTRY WHEN * 12578102
*  NO COMPARE WAS FOUND ON THE FIRST PASS.                            * 12628102
*********************************************************************** 12678102
TYPETST  EQU   *                        FIND OUT TYPE OF REQUEST        12728102
         TM    IOBDTYP2,IOBRQUST+IOBADDTY  READ OR WRITE ADD?           12778102
         BZ    WRTTYPE                  NO, MUST BE WRT REL             12828102
         TM    IOBDSTAT,IOBENQUE        WAS THE WRITE ADD ENQ'D ALREADY 12878102
         BO    WRTTYPE                  YES GO ON TO DEQ                12928102
         CLC   AVAIL,0(ENQREG)          IS THIS THE 2ND PASS?    Y02072 12978102
         BE    POSTQ                    YES-GO TO ENTER ON LIST  Y02072 13028102
         LTR   RDXCTREG,RDXCTREG        NO- TEST FOR NO EQUAL FOUND     13078102
         BNZ   PUTONQ                   BRANCH IF EQUAL FOUND    Y02072 13128102
*********************************************************************** 13178102
*  SET UP FOR SECOND PASS THROUGH READX LIST IN SEARCH FOR EMPTY SLOT * 13188102
*  TO ADD NEW ENQ ENTRY.                                              * 13198102
*********************************************************************** 13208102
SCANZERO EQU   *                        LOOK FOR EMPTY SLOT ON RDX LIST 13218102
         LA    ENQREG,AVAIL             SEARCH FOR EMPTY SLOT    Y02072 13220102
         LR    RDXREG,WKREG2            GET ADDR OF 1ST SEGMENT  Y02072 13222502
*                                       OF READX LIST            Y02072 13222902
         B     NXTSEG                   SEARCH FOR AN EMPTY SLOT Y02072 13224102
         EJECT                                                          13226102
*********************************************************************** 13228102
*                                                                     * 13230102
*     ENQ REQUESTS                                                    * 13238102
*                                                                     * 13248102
*        THE FOLLOWING ROUTINE PROCESSES REQUESTS FOR EXCLUSIVE       * 13258102
*        CONTROL OF A BLOCK.                                          * 13268102
*                                                                     * 13270102
*        PUTONQ - THIS SECTION ADDS THE CURRENT IOB TO THE            * 13270502
*           UNPOSTED QUEUE ASSOCIATED WITH THE BLOCK. IT IS           * 13270902
*           EXECUTED WHEN A MATCH FOR THE ENQ ARGUMENT IS FOUND       * 13271302
*           TO ALREADY EXIST ON THE EXCLUSIVE CONTROL LIST.           * 13271702
*                                                                     * 13272102
*        POSTQ - THIS SECTION ADDS THE ENQ ARGUMENT TO THE            * 13322102
*           EXCLUSIVE CONTROL LIST WHEN NO MATCH WAS FOUND.           * 13372102
*           ONCE IT HAS BEEN PUT ON THE LIST, AN ENQ MACRO            * 13422102
*           IS ISSUED TO ENSURE SYSTEM-WIDE CONTROL OF THE            * 13472102
*           RESOURCE, AND AN EXCP IS ISSUED TO GET THE                * 13522102
*           MOST RECENT COPY OF THE BLOCK.                            * 13572102
*                                                                     * 13574102
*********************************************************************** 13578102
*                                                                       13624102
*                                                                       13624202
*********************************************************************** 13624502
*     ADD THE CURRENT IOB TO THE UNPOSTED QUEUE FOR THIS BLOCK          13626102
*********************************************************************** 13626202
PUTONQ   MVC   IOBCSW-1(L'WKANQARG),WKANQARG                     Y02072 13628102
*              NOTE:  THE ABOVE INSTRUCTION PLACES THE                  13638102
*                     ENQUEUE ARGUMENT IN IOBCSW.  IT SHOULD            13648102
*                     AID IN DETERMINING WHAT RECORD AN IOB IS          13658102
*                     WAITING FOR.  HOWEVER, NO CODE IS DEPEN-          13668102
*                     DENT ON EXECUTION OF THIS INSTRUCTION.            13670102
         SR    IOBQREG1,IOBQREG1        CLEAR REGISTER           Y02072 13678102
         TM    WKASW1,WKAD2305          2305 WRITE-ADD?          Y02072 13680102
         BZ    PUTONQ1                  BRANCH IF NOT            Y02072 13682102
         ST    IOBQREG1,DECSDECB        ZERO ECB, USER CAN WAIT  Y02072 13684102
PUTONQ1  ST    IOBQREG1,IOBDQPTR        ZERO IOB'S LINK FIELD    Y02072 13688102
         L     IOBQREG1,RDXUQND         ADDR OF LAST IOB WAITING Y02072 13728102
*                                       ON THE UNPOSTED QUEUE           13778102
         LTR   IOBQREG1,IOBQREG1        WERE THERE ANY ?         Y02072 13828102
         BZ    PUTONQ2                  BRANCH IF NONE           Y02072 13878102
         SPACE                                                          13878502
*  CHANGE KEY AND SAVE THE IOB ADDRESS OF LAST IOB ON UNPOSTED QUEUE, * 13880102
*  SETTING A BIT INDICATING THAT THIS IOB WAS SAVED IN THE SVRB WKA.  * 13882102
*  THIS INFORMATION MAY BE REQUIRED BY THE ESTAE SHOULD AN ABEND OCCUR* 13884102
         SPACE                                                          13886102
*                                                                       13886502
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 13886902
*                                                                       13887302
         ST    IOBQREG1,WKAIOBQX        SAVE LAST IOB IN WKA     Y02072 13887702
         MVI   WKATRALX,WKAIOBST        SET BIT FOR LAST IOB     Y02072 13887802
*                                                                       13887902
         MODESET  KEYADDR=WKASVKEY,WORKREG=14  RET TO USER KEY   Y02072 13888002
*                                                                       13891302
         ST    IOBREG,IOBDQPTR-IOBSTDRD(IOBQREG1) POINT LAST IOB Y02072 13894802
*                                       ON QUEUE TO THIS ONE     Y02072 13898102
*                                                                       13908102
         MODESET EXTKEY=DATAMGT         KEY OF READX LIST        Y02072 13918102
*                                                                       13920102
         ST    IOBREG,RDXUQND           MAKE THIS IOB LAST ON Q  Y02072 13922102
         B     PUTONQ3                  Q UPDATE COMPLETE        Y02072 13924102
*                                                                       13926102
PUTONQ2  MODESET EXTKEY=DATAMGT         KEY OF READX LIST        Y02072 13926502
*                                                                       13926902
         ST    IOBREG,RDXUQND           MAKE THIS IOB LAST Q     Y02072 13927302
         ST    IOBREG,RDXIOBUQ          ALSO FIRST ON Q          Y02072 13928102
PUTONQ3  EQU   *                        Q UPDATE COMPLETE        Y02072 13978102
         DROP  ENQREG                                            Y02072 14228502
*                                                                       14230102
         MODESET EXTKEY=ZERO            KEY ZERO FOR SETLOCK     Y02072 14232102
*                                                                       14234102
         MVI   WKATRALX,WKAIOBQD        SET AUDIT BIT WHEN IOB   Y02072 14234502
*                                       ADDED TO UNPOSTED QUEUE  Y02072 14234902
*                                                                       14235302
FRELCK2  SETLOCK RELEASE,TYPE=LOCAL,                             Y02072X14236102
               RELATED=(EXCLCTLQ,IGC0005C(LOCKSCAN))             Y02072 14236502
*                                                                       14236902
         SR    RETCODRG,RETCODRG        ZERO RETURN CODE         Y02072 14238102
         B     EXIT3                    RETURN                   Y02072 14278102
*                                                                       14328102
*                                                                       14528102
*********************************************************************** 14928102
*  THE FOLLOWING ROUTINE ADDS A NEW ENTRY (BLOCK ID) TO THE READX     * 14978102
*  LIST.  THIS IS ALWAYS FOLLOWED BY A SYSTEM ENQ TO PUT THE SAME     * 15028102
*  ENTRY ON THE SYSTEM QUEUE, AND AN EXCP TO PROVIDE THE EXCLUSIVE    * 15078102
*  USER WITH THE LATEST COPY OF THE BLOCK HE REQUESTED.               * 15128102
*********************************************************************** 15178102
POSTQ    EQU   *                        ADD ENTRY TO LIST               15228102
*                                                                       15522602
         BAL   RLINK,GETTCBA            ADDR OF DEB'S TCB IN R4, Y02072 15524602
         DROP  DCBREG                   ADDR OF CURRENT TCB R2   Y02072 15526602
*                                       FOR GETMAIN OR ENQ       Y02072 15530102
*                                                                       15532102
*              PLACE THE ENTRY IN THE EXCLUSIVE CONTROL LIST.           15533602
*                                                                       15537102
         LTR   RDXCTREG,RDXCTREG        IS THERE AN EMPTY SLOT?  Y02072 15540602
         BNZ   ENQ04                    BRANCH YES               Y02072 15542602
*                                                                       15546502
*              IT IS FIRST NECESSARY TO GET CORE FOR ANOTHER            15548502
*              SEGMENT OF THE READ EXCLUSIVE LIST, AND TO               15550502
*              CHAIN IT TO THE CURRENT LAST SEGMENT.                    15554402
*                                                                       15556402
*              THE LOGIC MUST USE THE BRANCH ENTRY TO GETMAIN           15558402
*              BECAUSE THE LOCAL LOCK IS HELD.                          15562302
*              THE BRANCH ENTRY USES R3 (BASEREG) AS A PARAMETER        15564302
*              REGISTER.   GETMAIN BRANCH ENTRY REQUIRES THAT           15566302
*              GR4 CONTAIN THE TCB ADDRESS AND GR7 CONTAIN THE          15576302
*              ASCB ADDRESS.                                            15576402
*                                                                       15576602
         LR    WKREG3,IOBREG            SAVE IOB ADDRESS         Y02072 15578602
         LR    WKREG4,BASEREG           TEMPORARY BASE REGISTER  Y02072 15586602
         USING BASEVAL,WKREG4           ADDRESSABILITY           Y02072 15586702
         DROP  BASEREG                                           Y02072 15586802
         L     R7,PSAAOLD               CURRENT ASCB ADDRESS     Y02072 15591302
*                                                                       15591702
         MODESET EXTKEY=ZERO            KEY ZERO FOR GETMAIN     Y02072 15592102
*                                                                       15592702
*              REQUEST AN ADDITIONAL SEGMENT, CONDITIONALLY,            15593902
*              FROM SUBPOOL 230 IN DATA MANAGEMENT KEY.                 15595102
*                                                                       15596302
         GETMAIN RC,SP=SPDMGTNF,KEY=DATAMGT,LV=RDXLSTLG,         Y02072X15597502
               BRANCH=YES                                        Y02072 15597902
*                                                                       15598702
         LR    BASEREG,WKREG4           RESTORE BASE REGISTER    Y02072 15599902
         USING BASEVAL,BASEREG          MODULE ADDRESSABILITY    Y02072 15601102
         DROP  WKREG4                                            Y02072 15602302
         LR    IOBREG,WKREG3            RESTORE IOB POINTER      Y02072 15602702
         USING IOBSTDRD,IOBREG          AND ADDRESSABILITY       Y02072 15603102
         LTR   R15,R15                  WAS GETMAIN SUCCESSFUL   Y02072 15603502
         BNZ   ABND535A                 NO, GO ABEND             Y02072 15605502
         LR    RDXREG,R1                NEW SEGMENT ADDR         Y02072 15605902
         USING RDXLIST,RDXREG           ESTABLISH BASE FOR READX LIST   15607502
*                                                                       15617502
*                                       CHANGE TO DATAMGT KEY TO Y02072 15620102
         MODESET EXTKEY=DATAMGT          MODIFY READX LIST       Y02072 15622902
*                                                                       15624902
         XC    RDXLIST(RDXLSTLG),RDXLIST   CLEAR OUT THE LIST           15625502
         ST    RDXREG,RDXNEXT-RDXLIST(RDXSEGRG)   STORE ADDR IN CHAIN   15628102
*                                       FIELD OF PRIOR READX SEGMENT    15678102
         LA    RDXENTRG,RDXENT          GET ADDR OF 1ST ENT IN NEW SEG  15728102
         DROP  RDXREG                                                   15778102
         B     ENQ04A                   GO TO MOVE ENTRY         Y02072 15788102
*                                                                       15798102
ENQ04    MODESET EXTKEY=DATAMGT         KEY OF READX LIST        Y02072 15848102
*                                                                       15898102
ENQ04A   MVC   RDXNQARG,WKANQARG        MOVE ENTRY TO READX LIST Y02072 15948102
*                                                                       15998102
         MODESET EXTKEY=ZERO            GET KEY ZERO FOR SETLOCK Y02072 16048102
*                                                                       16098102
         MVI   WKATRALX,WKARDXAD        SET AUDIT BIT WHEN RDX   Y02072 16100102
*                                       ENTRY ADDED              Y02072 16102102
*                                                                       16104102
FRELCK1  SETLOCK RELEASE,TYPE=LOCAL,                             Y02072X16108102
               RELATED=(EXCLCTLQ,IGC0005C(LOCKSCAN))             Y02072 16118102
*                                                                       16127802
*              INVOKE A RESTRICTED (SYSZ) ENQUEUE FOR THE               16137802
*              TCB WHICH OPENED THIS DCB.                               16147802
*                                                                       16147902
         BAL   RLINK2,ENQRTNE           GET ENQUEUED             Y02072 16157902
*                                                                       16159902
         MVI   WKATRALX,WKAENQ          SET AUDIT BIT WHEN       Y02072 16160002
*                                       RECORD IS ENQUEUED       Y02072 16168002
*                                                                       16176102
*                                       CHANGE TO CALLER'S       Y02072 16184102
         MODESET KEYADDR=WKASVKEY,WORKREG=2     PROTECT KEY      Y02072 16192102
*                                                                       16200102
         OI    IOBDSTAT,IOBENQUE        INDICATE THE RECORD ENQUEUED    16208102
         TM    WKASW1,WKAD2305          IF 2305 EXCP AFTER ENQ,  YM6585 16218102
         BO    EXCPNOW                  ITS 1ST REQ FOR BLK SO   YM6585 16220102
*                                       LET IOS CLEAR ECB        YM6585 16222102
         L     WKREG1,IOBECBPT          GET THE ECB ADDRESS             16228102
         LA    WKREG9,IOBCSW+3          LOAD 2ND HALF OF CSW TO USE AS  16278102
*                                       DUMMY ECB FOR IOS        A39071 16328102
         ST    WKREG9,IOBECBPT          ST CSW ADDR IN ECB       A39071 16378102
         ST    WKREG1,IOBDQPTR          SAVE USER ECB ADDR IN    Y02072 16388102
*                                       IOB. IT WILL BE RESTORED Y02072 16398102
*                                       TO IOBECBPT BY THE CEA   Y02072 16408102
*                                       OR EOE APPENDAGE         Y02072 16418102
EXCPNOW  EQU   *                        ENTRY IF 1ST 2305 REQ    YM6585 16420102
         EXCP  (IOBREG)                 ISSUE EXCP                      16428102
*                                       IOB                      A39071 16528102
*                                                                       16530102
         MODESET  EXTKEY=ZERO           CHANGE KEY TO SVRB KEY   Y02072 16532102
*                                                                       16534102
         MVI   WKATRALX,WKAEXCPE        SET AUDIT BIT WHEN       Y02072 16536102
*                                       EXCP ISSUED              Y02072 16536502
         SR    RTCODRG2,RTCODRG2        ZERO RETURN CODE         Y02072 16538102
         SR    PARREG0,PARREG0          SHOW NO IOB DEQUEUED     Y02072 16548102
         B     EXIT2                    RETURN                   Y02072 16578102
         EJECT                                                          16588102
*********************************************************************** 16628102
*                                                                     * 16630102
*    DEQ REQUESTS                                                     * 16638102
*                                                                     * 16648102
*        THE FOLLOWING ROUTINE PROCESSES WRITE RELEASE REQUESTS,      * 16658102
*        WRITE ADD REQUESTS TO RELEASE CONTROL OF A PREVIOUSLY        * 16668102
*        ENQ'D TRACK, AND RELEX REQUESTS. AT THIS POINT A SCAN        * 16670102
*        HAS ALREADY BEEN MADE OF THE EXCLUSIVE CONTROL LIST          * 16672102
*        TO FIND THE ENTRY WHICH IS TO BE DEQUEUED.                   * 16674102
*                                                                     * 16676102
*        DEQ01 - THIS SECTION IS EXECUTED IF NO IOBS ARE FOUND        * 16676502
*             TO BE WAITING FOR THE BLOCK IN QUESTION. A DEQ          * 16676902
*             MACRO IS ISSUED 1ST. THEN THE ENTRY IN THE EX-          * 16677302
*             CLUSIVE CONTROL LIST FOR THAT BLOCK IS CLEARED.         * 16677702
*             HOWEVER, IF DURING THE DEQ, ANOTHER IOB IS ADDED        * 16677802
*             TO THE UNPOSTED QUEUE, WAITING FOR THE SAME BLOCK,      * 16677902
*             AN ENQ IS ONCE AGAIN ISSUED FOR THAT BLOCK, FOL-        * 16678002
*             LOWED BY AN EXCP TO GET THE LATEST COPY. IF NO          * 16694702
*             IOB HAS BEEN PUT ON THE UNPOSTED QUEUE FOR THAT         * 16704702
*             BLOCK, THE ENTRY IS CLEARED.                            * 16706702
*                                                                     * 16708702
*        UPOSTIOB - THIS SECTION IS EXECUTED IF AN IOB IS FOUND       * 16710702
*             TO BE WAITING FOR THE BLOCK IN QUESTION. IN THIS        * 16711102
*             CASE THE FIRST WAITING IOB IS REMOVED FROM THE          * 16711202
*             UNPOSTED QUEUE, THE LATEST COPY OF THE BLOCK IS         * 16711302
*             MOVED INTO HIS BUFFER(UNLESS IT IS A RELEX REQUEST)     * 16716902
*             AND ALL PROCESSING FOR THIS WAITING IOB IS COM-         * 16718902
*             PLETED, INCLUDING CALCULATING FEEDBACK IF REQ-          * 16720902
*             UESTED AND POSTING THE REQUEST COMPLETE. (IN THE        * 16721302
*             CASE OF A COMPLETED WRITE ADD REQUEST, THE CURRENT      * 16721702
*             REQUEST, RATHER THAN THE NEXT WAITING REQUEST,          * 16722102
*             IS COMPLETED. THE NEXT WAITING IOB IS PASSED            * 16722202
*             BACK TO THE CALLER -THE ASI,WHICH PASSES IT ON TO       * 16722302
*             THE SELF-FORMAT MODULE, OR THE SELF-FORMAT MODULE.)     * 16722402
*                                                                     * 16736302
*********************************************************************** 16978102
WRTTYPE  EQU   *                        WRITE RELEASE REQUEST           17028102
         USING IHADCB,DCBREG                                     Y02072 17030102
         USING RDXENTRY,RDXENTRG                                 Y02072 17038102
         TM    WKASW1,WKADEQD           HAS DEQ ALREADY OCCURRED Y02072 17048102
         BO    DEQ10                    BRANCH IF SO             Y02072 17058102
         LTR   RDXCTREG,RDXCTREG        TEST TO SEE IF MATCH WAS FOUND  17078102
         BZ    ERRWRT                   NO-GO SET EXCEPTION CODE Y02072 17128102
         BAL   RLINK,SRCHUPST           SEARCH UNPOSTED QUEUE    Y02072 17178102
*                                       FOR WAITING IOBS         Y02072 17228102
         LTR   IOBQREG2,IOBQREG2        WAS ONE FOUND?           Y02072 17278102
         BNZ   UPOSTIOB                 BR YES TO DEQUEUE IT     Y02072 17328102
*                                                                       17428102
DEQ01    EQU   *                                                 Y02072 17478102
*                                                                       17528102
*              NO IOB WAS FOUND WAITING FOR THE RECORD.  WE             17578102
*              MUST DEQ AND CLEAR THE READ EXCLUSIVE LIST               17628102
*              ENTRY.                                                   17678102
*                                                                       17728102
         MODESET EXTKEY=ZERO            KEY ZERO FOR SETLOCK     Y02072 17778102
*                                                                       17828102
*                                       MUST RELEASE LOCAL LOCK  Y02072 17878102
FRELCK4  SETLOCK RELEASE,TYPE=LOCAL,      BEFORE DEQ MACRO CALL  Y02072X17928102
               RELATED=(EXCLCTLQ,IGC0005C(LOCKSCAN))             Y02072 17978102
*                                                                       18028102
         DROP  RDXENTRG                                          Y02072 18038102
         LR    WKREG3,DCBREG            SAVE DCB ADDR AROUND RTN Y02072 18048102
         BAL   RLINK,GETTCBB            GET ADDR OF DEB'S TCB    Y02072 18078102
         DROP  DCBREG                   ADDR WAS RETURNED IN R4  Y02072 18128102
         MVC   WKANQLST(ENQLN),ENQLIST  MOVE DEQ LIST TO SVRB    Y02072 18178102
*                                                                       18228102
*                                       RELEASE CONTROL OF THIS  Y02072 18278102
         DEQ   (,WKANQARG,,SYSTEM),TCB=(DEBTCBRG),   RECORD      YM1371X18328102
               MF=(E,WKANQLST)                                   Y02072 18378102
*                                                                       18388102
         MVI   WKATRALX,WKADEQ          SET AUDIT BIT AFTER      Y02072 18398102
*                                       DEQ IS ISSUED            Y02072 18408102
         LR    DCBREG,WKREG3            RESTORE DCB ADDR         Y02072 18418102
         USING IHADCB,DCBREG            ESTABLISH ADDRESSABILITY Y02072 18420102
*                                                                       18428102
*              IT IS POSSIBLE THAT SOME TIME AFTER WE RELEASED          18478102
*              THE LOCAL LOCK (AT FRELCK4) ANOTHER ENQ REQUEST          18528102
*              FOR THIS RECORD WAS PROCESSED.  SINCE THE ENTRY          18578102
*              FOR THIS RECORD IS STILL IN THE READ EXCLUSIVE           18628102
*              LIST, THE ENQ REQUEST WOULD HAVE BEEN PLACED ON          18678102
*              THE UNPOSTED QUEUE.  IT IS THUS NECESSARY TO             18728102
*              REACQUIRE THE LOCAL LOCK AND SEARCH THE UNPOSTED         18778102
*              QUEUE FOR A REQUEST FOR THIS RECORD.                     18828102
*                                                                       18878102
SCANLCK2 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02072X18928102
               RELATED=(EXCLCTLQ,IGC0005C(FRELCK5,FRELCK6,FRELCK7))     18978102
*                                                                       19028102
*              BECAUSE WE HAVE NOT CONTINUOUSLY HELD THE LOCAL LOCK     19030102
*              SINCE WE VALIDATED THE DEB AND LOCATED THE EXCLUSIVE     19032102
*              CONTROL LIST, WE CANNOT BE SURE THAT WE CAN MODIFY       19034102
*              THE CORE THAT RDXENTRG POINTS TO.  IT IS POSSIBLE        19036102
*              (THOUGH HIGHLY UNLIKELY) THAT THE DCB HAS BEEN CLOSED    19036502
*              AND THAT THE DEB IS NO LONGER VALID.                     19036902
*                                                                       19037302
         BAL   RLINK2,DEBCHKRT          VALIDATE DEB AGAIN       Y02072 19038102
*                                                                       19048102
*              IT IS ALSO POSSIBLE (ALTHOUGH EVEN MORE UNLIKELY),       19058102
*              THAT THE DCB WAS CLOSED AND THEN REOPENED, AND THAT      19068102
*              EVEN THOUGH THE DEB IS VALID, RDXENTRG DOES NOT POINT    19070102
*              TO THE EXCLUSIVE CONTROL LIST ENTRY FOR THIS RECORD.     19072102
*              WE WILL AGAIN GET THE READ EXCLUSIVE LIST POINTER        19074102
*              FROM THE DEB, AND SEARCH THE LIST FOR AN ENTRY FOR       19076102
*              THIS RECORD.                                             19076502
*                                                                       19076902
         OI    WKASW1,WKADEQD           INDICATE SECOND SEARCH   Y02072 19077302
         L     DEBREG,WKASVDEB          GET DEB ADDRESS          Y02072 19077702
         B     SCANXARG                 GO SEARCH EXCLUSIVE CON- Y02072 19077802
*                                       TROL LIST AGAIN.         Y02072 19077902
DEQ10    EQU   *                        RETURN HERE AFTER SEARCH Y02072 19078002
         LTR   RDXCTREG,RDXCTREG        WAS THE ENTRY FOUND?     Y02072 19094702
         BZ    ABEND435                 THE IMPROBABLE (& ILLE-  Y02072 19104702
*                                       GAL) HAS OCCURRED, ABEND Y02072 19106702
*                                                                       19108702
*              EVERYTHING'S OK. RDXENTRG POINTS TO OUR EXCLUSIVE        19110702
*              CONTROL LIST ENTRY.                                      19111102
*                                                                       19115302
         USING RDXENTRY,RDXENTRG                                 Y02072 19119702
*                                       CHANGE TO CALLER'S       Y02072 19123902
         MODESET KEYADDR=WKASVKEY,WORKREG=2     PROTECT KEY      Y02072 19128102
*                                                                       19178102
         BAL   RLINK,SRCHUPST           SEARCH UNPOSTED QUEUE    Y02072 19228102
         LTR   IOBQREG2,IOBQREG2        WAS AN IOB FOUND?        Y02072 19278102
         BNZ   DEQ02                    BRANCH YES               Y02072 19328102
*                                                                       19378102
*              NO IOB WAS FOUND.  CLEAR THE READ EXCLUSIVE LIST         19428102
*              ENTRY AND EXIT.                                          19478102
*                                                                       19528102
         MODESET EXTKEY=DATAMGT         KEY OF READX LIST        Y02072 19578102
*                                                                       19628102
         XC    RDXENTRY(RDXENTLN),RDXENTRY   CLEAR ENTRY         Y02072 19678102
         DROP  RDXENTRG                                          Y02072 19688102
*                                                                       19728102
         MODESET EXTKEY=ZERO            KEY ZERO FOR SETLOCK     Y02072 19778102
*                                                                       19828102
         MVI   WKATRALX,WKARDXZR        SET AUDIT BIT WHEN       Y02072 19838102
*                                       READX ENTRY ZEROED       Y02072 19848102
*                                                                       19858102
FRELCK5  SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02072X19878102
               RELATED=(EXCLCTLQ,IGC0005C(SCANLCK2))             Y02072 19928102
*                                                                       19978102
         SR    RTCODRG2,RTCODRG2        NORMAL RETURN CODE       Y02072 20028102
         TM    IOBDTYP2,IOBRELEX        WAS REQUEST RELEX?       YM1474 20078102
         BO    RELEXIT1                 BRANCH YES TO FREE CORE  Y02072 20128102
         SR    PARREG0,PARREG0          SHOW NO IOB DEQUEUED     Y02072 20178102
         B     EXIT2                    GO TO EXIT               Y02072 20228102
*                                                                       20328102
DEQ02    EQU   *                                                 Y02072 20378102
         LR    RIOB2,IOBQREG2           R11 WILL BE DESTROYED BY Y02072 20428102
         USING IOBSTDRD,RIOB2            SETLOCK                 Y02072 20478102
*                                                                       20528102
*              AN IOB WAS FOUND WAITING FOR THIS RECORD ON THE          20578102
*              UNPOSTED QUEUE.  IT IS NECESSARY TO RE-ENQUEUE           20628102
*              ON THIS RECORD FOR THAT IOB.  IT IS ALSO NECESSARY       20678102
*              TO REISSUE THE EXCP FOR THAT REQUEST IN CASE THE         20688102
*              RECORD HAS BEEN ALTERED SINCE THE DEQ.                   20698102
*                                                                       20708102
         MODESET EXTKEY=ZERO            KEY ZERO FOR SETLOCK     Y02072 20718102
*                                                                       20720102
         MVI   WKATRALX,WKAENQRD        SET AUDIT BIT IF NEW     Y02072 20720502
*                                       ENQ REQUIRED AFTER DEQ   Y02072 20720902
*                                       RELEASE THE LOCK PRIOR   Y02072 20722102
FRELCK6  SETLOCK RELEASE,TYPE=LOCAL,     TO ENQ                  Y02072X20724102
               RELATED=(EXCLCTL,IGC0005C(SCANLCK2))              Y02072 20726102
*                                                                       20726502
*              THE ENQ LIST IS STILL GOOD FROM THE DEQ MACRO.           20726902
*                                                                       20727302
         BAL   RLINK,GETTCBA            GET ADDRESS OF DEB TCB   Y02072 20727702
*                                       AND CURRENT TCB          Y02072 20727802
         BAL   RLINK2,ENQRTNE           GO ENQUEUE               Y02072 20727902
*                                                                       20744602
         MVI   WKATRALX,WKAENQX         SET AUDIT BIT AFTER NEW  Y02072 20754602
*                                       ENQ FOLLOWING DEQ        Y02072 20756602
*                                                                       20761302
*                                       CHANGE TO CALLER'S       Y02072 20778002
         MODESET KEYADDR=WKASVKEY,WORKREG=2     PROTECT KEY      Y02072 20788002
*                                                                       20798002
DEQEXCP  L     WKREG9,IOBECBPT          GET DECB ADDRESS         Y02072 20808002
         ST    WKREG9,IOBDQPTR          SAVE IT IN IOBDQPTR FOR  Y02072 20818002
*                                       RESTORATION BY CEA OR    Y02072 20820002
*                                       EOE APPENDAGE            Y02072 20820402
         LA    WKREG3,IOBCSW+3          ADDR OF DUMMY ECB        Y02072 20822002
         ST    WKREG3,IOBECBPT          FOR EXCP TO CLEAR        Y02072 20824002
*                                                                       20826002
         EXCP  (RIOB2)                  RE-ISSUE EXCP            Y02072 20826402
*                                                                       20826802
*                                                                       20827302
         MODESET  EXTKEY=ZERO           CHANGE TO SVRB KEY       Y02072 20827702
*                                                                       20829202
         MVI   WKATRALX,WKAEXCPX        SET AUDIT BIT FOR EXCP   Y02072 20829602
*                                                                       20830002
         MODESET  KEYADDR=WKASVKEY,WORKREG=2    RET TO USER KEY  Y02072 20830402
*                                                                       20830802
         LR    PARREG0,RIOB2            ADDR OF DEQUEUED IOB     Y02072 20831102
         B     EXIT0                    EXIT                     Y02072 20832802
         DROP  RIOB2                                             Y02072 20834502
*                                                                       20834902
*                                                                       20835302
*                                                                       20835702
*                                                                       20836202
*********************************************************************** 20837902
*  THE FOLLOWING SECTION PROCESSES THE NEXT IOB WAITING ON THE        * 20887902
*  UNPOSTED QUEUE. THIS INCLUDES MOVING THE DATA INTO HIS BUFFER,     * 20947302
*  CALCULATING FEEDBACK, AND POSTING THE REQUEST COMPLETE.            * 20949302
*********************************************************************** 20955002
*                                                                       20962702
UPOSTIOB LR    WKREG0,IOBQREG2          SAVE PTR TO UNPOSTED IOB Y02072 20970402
         USING IOBSTDRD,IOBREG                                   Y02072 20972402
         TM    IOBDTYP2,IOBRELEX+IOBADDTY ENTRY FROM RELEX OR WRITE ADD 20978102
         BM    READPOST                 YES- BRANCH AROUND MOVING DATA  21028102
*                                                                       21038102
*                                       CHANGE TO CALLER'S       Y02072 21070102
         MODESET KEYADDR=WKASVKEY,WORKREG=2     PROTECT KEY      Y02072 21072102
*                                                                       21074102
*********************************************************************** 21078102
*  THE FOLLOWING ROUTINE MOVES THE DATA FROM THE BUFFER OF THE        * 21128102
*  RELEASING IOB TO THE BUFFERS OF ALL IOBS WAITING FOR THE BLOCK     * 21178102
*  BEING RELEASED. THE SMALLER OF THE TWO DECB LENGTH FIELDS CONTROLS * 21228102
*  THE NUMBER OF BYTES OF DATA MOVED. THE LONGER BUFFER IS PADDED     * 21278102
*  WITH ZEROES.                                                       * 21328102
*********************************************************************** 21378102
DATAMOVE EQU   *                        MOVE DATE INTO NEXT BUFFER      21428102
*                                       ESTABLISH BASE FOR DECB         21528102
         L     DECBREG2,IOBECBPT-IOBSTDRD(IOBQREG2) ON UNPOSTED QUEUE   21578102
         CLC   DECLNGTH-DECB(L'DECLNGTH,DECBREG2),DECLNGTH  COMPARE     21678102
*                                       THE LENGTH OF EACH BLOCK        21728102
         BH    WRITELOW                 BRANCH IF WRITTEN AREA IS LESS  21778102
         LH    LENREG1,DECLNGTH-DECB(DECBREG2)   LOAD CONTROLLING       21828102
*                                       LENGTH FOR MOVE TO NEXT BUFFER  21878102
AREAPTRS EQU   *                        SET UP BUFFER POINTERS          21928102
         L     BUFREG1,DECAREA          LOAD ADDRESS OF THE TWO AREAS   21978102
         L     BUFREG2,DECAREA-DECB(DECBREG2)  PRIOR TO THE MOVE        22028102
         B     TEST256                  BR TO DETERMINE AMT TO MOVE     22078102
MOVE256  EQU   *                        MV 256 BYTES OF DATA AT A TIME  22128102
         MVC   0(MAXLG,BUFREG2),0(BUFREG1)  MOVE 256 BYTES TO BUFFER    22178102
*                                       OF IOB ON  UNPOSTED QUEUE       22228102
         LA    BUFREG1,MAXLG(BUFREG1)   UPDATE THE TWO                  22278102
         LA    BUFREG2,MAXLG(BUFREG2)   BUFFER POINTERS                 22328102
TEST256  EQU   *                        MOVE THE REMAINING DATA         22378102
         SH    LENREG1,CON256           CAN 256 BYTES BE MOVED          22428102
         BP    MOVE256                  YES, GO TO MOVE IT              22478102
         LA    LENREG1,MAXLG-1(LENREG1) NO-RESTORE REMAINING LENGTH     22528102
         EX    LENREG1,MOVEREST         MOVE REST OF THE DATA           22578102
         AR    BUFREG2,LENREG1          UPDATE 2ND BUFFER AREA POINTER  22628102
         LA    BUFREG2,1(BUFREG2)       ADD BYTE SUBTRACTED FOR EX INST 22678102
         CLC   DECLNGTH-DECB(L'DECLNGTH,DECBREG2),DECLNGTH  WAS READ    22728102
*                                       BUFFER(NEXT IOB) LARGER THAN    22778102
*                                       WRITE BUFFER (CURRENT IOB)      22828102
         BNH   TST4MORE                 NO-GO TEST FOR MORE READS ON    22878102
*                                       UNPOSTED QUEUE                  22928102
PADTST   EQU   *                        YES-PAD REMAINDER OF BLOCK      22978102
         SH    LENREG2,CON256           IS PADDING GREATER THAN 256     23028102
         BP    PAD256                   YES, GO PAD SOME MORE           23078102
         LA    LENREG2,MAXLG-1(LENREG2) NO-RESTORE LENGTH-1(FOR EX INS) 23128102
         EX    LENREG2,PADBLOCK         PAD REST OF BLOCK               23178102
TST4MORE EQU   *                        ARE MORE IOBS WAITING FOR BLOCK 23228102
         L     IOBQREG2,IOBDQPTR-IOBSTDRD(IOBQREG2) LOAD ADDR OF NEXT   23238102
*                                       IOB ON THE UNPOSTED QUEUE       23248102
         LTR   IOBQREG2,IOBQREG2        IS THERE ANOTHER IOB ON THE Q   23258102
         BZ    READPOST                 NO-GO POST FIRST IOB FOUND      23268102
         B     DATAMOVE                 YES-GO TO MOVE DATA             23270102
PAD256   EQU   *                        PAD BUFFER IF LENGTHS VARY      23278102
         XC    0(MAXLG,BUFREG2),0(BUFREG2) CLEAR 256 BYTES              23328102
         LA    BUFREG2,MAXLG(BUFREG2)   UPDATE AREA POINTER             23378102
         B     PADTST                   GO TO PAD BUFFER                23428102
WRITELOW EQU   *                        SMALLER LENGTH IS CONTROLLER    23478102
         LH    LENREG1,DECLNGTH         USE WRITTEN AREA AS DATA LENGTH 23528102
         LH    LENREG2,DECLNGTH-DECB(DECBREG2)  CALCULATE THE AMOUNT    23578102
         SR    LENREG2,LENREG1          OF PADDING REQUIRED IN BIG BUF  23628102
         B     AREAPTRS                 GO SET UP FOR DATA MOVE         23678102
*                                                                       24178102
MOVEREST EQU   *                         EXEC INST FOR MOVING DATA      24228102
         MVC   0(1,BUFREG2),0(BUFREG1)   EXECUTED DATA MOVE             24238102
PADBLOCK EQU   *                         PAD REMAINDER OF BUFFER        24248102
         XC    0(1,BUFREG2),0(BUFREG1)   EXECUTED CLEARING OF BLOCK     24258102
*                                                                       24268202
*********************************************************************** 24576802
*                                                                       24577202
         USING IHADCB,DCBREG            ENTRY REGISTER           Y02072 24577602
READPOST EQU   *                        SET UP TO GO TO ASI ROUTINE     24578102
*                                                                       24588102
         MODESET EXTKEY=ZERO            KEY ZERO FOR SETLOCK     Y02072 24598102
*                                                                       24608102
*                                       RELEASE THE LOCAL LOCK   Y02072 24610102
FRELCK3  SETLOCK RELEASE,TYPE=LOCAL,                             Y02072X24618102
               RELATED=(EXCLCTLQ,IGC0005C(SCANLOCK))             Y02072 24620102
*                                                                       24622102
*                                       CHANGE TO CALLER'S       Y02072 24626902
         MODESET KEYADDR=WKASVKEY,WORKREG=2     PROTECT KEY      Y02072 24627302
*                                                                       24627702
         LR    RIOB2,WKREG0             ADDR OF DEQUEUED IOB     Y02072 24627802
         TM    IOBDTYP2,IOBADDTY        WRITE ADD REQUEST               24628102
         BNO   TSTFDB                   NO, TEST FOR FEEDBACK    Y02072 24678102
         TM    WKASW1,WKAD2305          TEST FOR 2305 RECFM=F    Y02072 24688102
         BO    DEQEXCP                  YES, GO ISSUE EXCP       Y02072 24718102
WTADVU   MVC   IOBDNCRF-IOBSTDRD(CAPRECLG,RIOB2),IOBSEEK+3       YM1152 24728102
*                                       MV CAPACITY RECORD TO NEW IOB   24778102
         SR    RTCODRG2,RTCODRG2        INDICATE NO ERROR RETURN Y02072 24788102
         TM    IOBDSTAT,IOBADDVU        DID CURRENT RECORD FIT          24828102
         BZ    EXIT1                    NO, RETURN TO SELF-      Y02072 24878102
*                                       FORMAT ROUTINE           Y02072 24928102
         LR    RIOB2,IOBREG             YES, COMPLETE PROCESSING Y02072 24938102
         B     TSTFDB1                  OF CURRENT REQUEST       Y02072 24948102
*                                                                       24958102
*                                                                       24968102
*********************************************************************** 24978102
* IT IS NOW NECESSARY TO COMPLETE THE PROCESSING OF THE IOB WHICH       25028102
* WAS REMOVED FROM THE UNPOSTED QUEUE, OR (IF A COMPLETED SELF-FORMAT   25078102
* WRITE-ADD REQ WITH AN IOB WAITING) THE CURRENT REQUEST. (THE WAITING  25088102
* REQUEST WILL BE PROCESSED BY THE SELF FORMAT MODULE.) THE REMAINING   25098102
* PROCESSING INCLUDES PROVIDING FEEDBACK, AS APPROPRIATE, MAKING THE    25148102
* IOB AVAILABLE, AND POSTING THE DECB.                                  25158102
*                                                                       25278102
**********************************************************************  25328102
TSTFDB   EQU   *                        ADDR OF DEQUEUED IOB     Y02072 25428102
         USING IOBSTDRD,RIOB2                                    Y02072 25478102
         DROP  IOBREG                                            Y02072 25528102
         MVC   IOBCC(L'IOBCC+L'IOBHH+L'IOBR),IOBDNCRF+2  MOVE    Y02072 25578102
*                                       ACTUAL ADDR TO IOBSEEK   Y02072 25628102
TSTFDB1  TM    DCBOPTCD,DCBOPTF         IS FEEDBACK SPECIFIED?   Y02072 25678102
         BZ    ACTFDBK                  NO, PROVIDE ACTUAL ADDR  Y02072 25728102
         TM    IOBDTYPE,IOBACTAD        DOES REQUEST SPECIFY     Y02072 25778102
*                                       ACTUAL ADDRESSING        Y02072 25828102
         BZ    TESTREL                  NO, TEST FOR RELATIVE    Y02072 25878102
ACTFDBK  L     DECBREG2,IOBECBPT        DECB FOR THIS REQUEST    Y02072 25928102
         USING DECB,DECBREG2                                     Y02072 25978102
         L     WKREG9,DECRECPT          ADDR OF BLOCK REFERENCE  Y02072 26028102
         MVC   0(L'IOBSEEK,WKREG9),IOBSEEK  MOVE IN ACTUAL ADDR  Y02072 26078102
         DROP  DECBREG2                                          Y02072 26128102
         B     POSTIOB                  GO POST IOB COMPLETE     Y02072 26178102
TESTREL  TM    IOBDTYPE,IOBRELBL        IS RELATIVE BLOCK ADDR-  Y02072 26228102
*                                       ESSING SPECIFIED?        Y02072 26278102
         BZ    RELTRK                   NO, ASSUME RELATIVE      Y02072 26328102
*                                       TRACK ADDRESSING         Y02072 26378102
*                                                                       26428102
*                        SET UP INPUT FOR THE FEEDBACK MODULES,         26478102
*                        IGG019KG AND IGG019KH.                         26488102
*                             R1     IOB ADDRESS                        26498102
*                             R13    DCB ADDRESS                        26508102
*                                                                       26518102
*              THE FEEDBACK MODULE WILL PLACE THE RELATIVE BLOCK        26518502
*              ADDRESS IN THE AREA POINTED TO BY DECRECPT.              26518902
*                                                                       26519302
         OI    IOBSTAT1,IOBSYNCH        INDICATE ENTRY VIA SYNCH Y02072 26520102
         L     R15,DCBDFBK              FEEDBACK MODULE E.P.     Y02072 26522102
         LR    WKREG4,IOBREG            SAV CUR IOB AROUND SYNCH YM6585 26522202
         LR    RIOBFBK,RIOB2            IOB ADDR TO REG 1        Y02072 26522502
         LR    RDCBFBK,DCBREG           DCB ADDRESS TO REG 13    Y02072 26524102
         SYNCH (15)                                              Y02072 26526102
         BALR  RSYNCHRT,0               ESTABLISH TEMP BASE      Y02072 26526202
         USING *,RSYNCHRT               TEMPORARY ADDRESSABILITY Y02072 26526502
         BAL   RLINK,SYNRETRN           GO TO RESTORE REGS       Y02072 26526902
         DROP  RSYNCHRT                                          Y02072 26527302
         USING BASEVAL,BASEREG          REESTABLISH BASE         Y02072 26527402
         LR    RIOB2,RIOBFBK            RESTORE FDBCK IOB        YM6585 26528402
         LR    DCBREG,RDCBFBK           RESTORE DCB REG          YM6585 26530402
         LR    IOBREG,WKREG4            RESTORE CURRENT IOB      YM6585 26530802
         NI    IOBSTAT1,X'FF'-IOBSYNCH  RESET SYNCH INDICATOR    Y02072 26531502
         B     POSTIOB                  GO TO POST THIS IOB      Y02072 26532502
RELTRK   EQU   *                                                        26533502
*                       THE FOLLOWING LOGIC USES THE SYSTEM      Y02072 26534502
*                       CONVERT ROUTINE, IECPRLTV, TO PROVIDE    Y02072 26535502
*                       RELATIVE TRACK (TTR) FEEDBACK.           Y02072 26536502
*                       INPUT TO THE CONVERT ROUTINE IS:         Y02072 26537502
*                            R1   DEB ADDRESS                    Y02072 26538502
*                            R2   ADDR OF MBBCCHHR               Y02072 26539502
*                            R14  RETURN ADDRESS                 Y02072 26540502
*                            R15  ENTRY-POINT ADDRESS            Y02072 26541502
*                       OUTPUT IS:                               Y02072 26542502
*                             R0   CONTAINS TTR0                 Y02072 26543502
*                             R9 - R13 DESTROYED                 Y02072 26544502
*                                                                       26545502
         LA    R2,IOBSEEK               POINT TO MBBCCHHR        Y02072 26546502
         L     R1,DCBDEBAD              GET DEB ADDR             Y02072 26547502
         L     R15,CVTPTR               GET ADDR OF CVT          Y02072 26548502
         USING CVT,R15                                           Y02072 26549502
         L     R15,CVTPRLTV             ENTRY-POINT OF IECPRLTV  Y02072 26550502
         DROP  R15                                               Y02072 26551502
         BALR  R14,R15                  GO TO CONVERT ROUTINE    Y02072 26552502
         L     WKREG9,IOBECBPT          GET DECB ADDRESS         Y02072 26553502
         USING DECB,WKREG9              DECB ADDRESSABILITY      Y02072 26554502
         L     WKREG9,DECRECPT          GET BLK REF ADDRESS      YM3019 26555502
         DROP  WKREG9                                            Y02072 26556502
         STCM  R0,B'1110',0(WKREG9)     STORE FEEDBACK (TOP 3 BY)YM3019 26557502
POSTIOB  EQU   *                        POST THE IOB             Y02072 26558502
*                                                                       26559502
         MODESET  EXTKEY=ZERO           CHANGE TO SVRB KEY       Y02072 26560502
*                                                                       26561502
         MVI   WKATRALX,WKAFEED         SET AUDIT BIT FOR        Y02072 26562502
*                                       FEEDBACK PROVIDED        Y02072 26563502
         MODESET  KEYADDR=WKASVKEY,WORKREG=1 RETURN TO USER KEY  Y02072 26564502
*                                                                       26565502
         SR    R0,R0                    REGISTER WILL CONTAIN    Y02072 26566502
*                                       POST CODE                Y02072 26567502
         IC    R0,IOBSTAT2                                       Y02072 26568502
         SLL   R0,16                    SHIFT TO PRODUCE 24-BIT  Y02072 26569502
*                                       COMPLETION CODE          Y02072 26570502
         L     R1,IOBECBPT              GET ECB ADDRESS          Y02072 26571502
         POST  (1),(0)                                           Y02072 26572502
*                                                                       26573502
         MODESET  EXTKEY=ZERO           CHANGE TO SVRB KEY       Y02072 26574502
*                                                                       26575502
         MVI   WKATRALX,WKAPOST         SET AUDIT BIT FOR POST   Y02072 26576502
*                                       COMPLETION               Y02072 26577502
         MODESET  KEYADDR=WKASVKEY,WORKREG=2  RET TO USER KEY    Y02072 26578502
*                                                                       26579502
MAKEAVL  TM    DCBMACF1,DCBMRCK         TEST IF CHECK IS USED    Y02072 26580502
         BO    NOCHECK                  IF SO, DON'T MAKE IOB    Y02072 26581502
*                                       AVAILABLE                Y02072 26582502
         MVI   IOBDAYLI,AVAILIOB        MARK IOB AVAILABLE       Y02072 26583502
NOCHECK  L     PARREG0,WKAIOBQX         ADDR OF DEQUEUED IOB     Y02072 26584502
         DROP  RIOB2                                             Y02072 26585502
*                                                                       26586502
         EJECT                                                          26587502
*********************************************************************** 26588502
*              SET UP PARAMETERS FOR EXIT                               26589502
*********************************************************************** 26590502
*                                                                       26591502
         USING IOBSTDRD,IOBREG                                   Y02072 26592502
EXIT0    EQU   *                        NORMAL EXIT FOR WRITE    Y02072 26593502
*                                       RELEASE AND RELEX        Y02072 26594502
         SR    RTCODRG2,RTCODRG2        SET ZERO RETURN CODE     Y02072 26595502
         TM    IOBDTYP2,IOBRELEX        WAS REQUEST RELEX        YM1474 26596502
         BO    RELEXIT2                 BRANCH IF YES            Y02072 26597502
*                                                                       26598502
EXIT1    EQU   *                        EXIT IF IN USER KEY      Y02072 26599502
*                                                                       26609502
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02072 26619502
*                                                                       26619902
EXIT2    EQU   *                        EXIT IF IN KEY ZERO      Y02072 26620302
         LR    RETCODRG,RTCODRG2        RETURN CODE TO R15       Y02072 26620402
EXIT3    LR    PARREG1,IOBREG           IOB ADDR IN R1           Y02072 26623902
         L     RRETURN,WKASAV14         LOAD RETURN ADDRESS      Y02072 26625902
         BR    RRETURN                  RETURN                   Y02072 26627902
*                                                                       26628002
*              THE FOLLOWING ERROR EXIT IS TAKEN IF A RELEASE           26628102
*              REQUEST SPECIFIES A BLOCK THAT IS NOT UNDER              26628202
*              EXCLUSIVE CONTROL.                                       26628302
ERRWRT   EQU   *                                                 Y02072 26629002
         OI    IOBSTAT2,DECCCREX        SET ERROR INDIC FOR ASI  Y02072 26629402
         LA    RTCODRG2,NOTFOUND        ERROR RETURN CODE        Y02072 26629802
*                                                                       26630202
         MODESET EXTKEY=ZERO            KEY ZERO FOR SETLOCK     Y02072 26630302
*                                                                       26630802
FRELCKER SETLOCK RELEASE,TYPE=LOCAL,    RELEASE THE LOCAL LOCK   Y02072X26631202
               RELATED=(EXCLCTLQ,IGC0005C(LOCKSCAN))             Y02072 26631602
*                                                                       26631702
         TM    IOBDTYP2,IOBRELEX        RELEX REQUEST?           YM1474 26631802
         BNO   EXIT2                    NO, BRANCH               Y02072 26632002
RELEXIT1 EQU   *                        RETURN TO CALLER'S KEY   Y02072 26632402
         MODESET KEYADDR=WKASVKEY,WORKREG=2     FOR FREEMAIN     Y02072 26633302
*                                                                       26633402
RELEXIT2 EQU   *                        FREE GOTTEN IOB AREA     Y02072 26633802
         L     R1,WKARLCOR              GET ADDR OF RELEX WKAREA Y02072 26633902
         FREEMAIN RU,SP=SPIOB,LV=IOBLG,A=(1)                     Y02072 26634002
*                                                                       26634802
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02072 26635202
*                                                                       26635602
         XC    WKARLCOR,WKARLCOR        CLEAR CORE ADDR IN SVRB  Y02072 26635702
         TM    WKASW1,WKAABEND          SHOULD I ABEND?          Y02072 26636002
         BO    DEESTAE                  BRANCH YES               Y02072 26636102
*                                                                       26636202
         LR    RETCODRG,RTCODRG2        GET RETURN CODE INTO REG.15     26636402
         L     RRETURN,WKASAV14         LOAD RETURN ADDRESS      Y02072 26636802
         BR    RRETURN                  RETURN                   Y02072 26637202
*                                                                       26638002
         EJECT                                                          26638402
*********************************************************************** 26638502
*********************************************************************** 26638702
*              SUBROUTINES                                              26640702
*********************************************************************** 26640802
*********************************************************************** 26640902
*     SEARCH THE UNPOSTED QUEUE                                       * 26641002
*        THE FOLLOWING SUBROUTINE SEARCHES THE UNPOSTED QUEUE         * 26641102
*        FOR THE PARTICULAR ENTRY, REMOVING THE FIRST WAITING         * 26641502
*        IOB FROM THE QUEUE. THIS WAITING IOB IS PASSED BACK          * 26641602
*        TO THE CALLING ROUTINE IN REG IOBQREG2. IT WILL CONTAIN      * 26641702
*        ZEROES IF NO IOBS WERE WAITING. RETURN REG IS RLINK(R14).    * 26643202
*********************************************************************** 26643602
         USING RDXENTRY,RDXENTRG                                 Y02072 26645102
SRCHUPST L     IOBQREG2,RDXIOBUQ        LOAD POINTER TO FIRST    Y02072 26646602
*                                       IOB ON THE QUEUE                26648102
         LTR   IOBQREG2,IOBQREG2        ANY IOBS ON THE QUEUE?   Y02072 26649602
         BZR   RLINK                    NO, RETURN TO CALLER     Y02072 26651102
DEQUEUEU EQU   *                        REMOVE IOB FROM IOB QUEUE       26652602
         USING IOBSTDRD,IOBQREG2        ADDRESS THIS IOB         Y02072 26662602
         DROP  IOBREG                                            Y02072 26663002
         L     WKREG0,IOBDQPTR          LOAD ADDRESS OF NEXT     Y02072 26663102
*                                       IOB ON THE QUEUE                26666602
         OI    IOBDSTAT,IOBENQUE        SET RECORD WAS ENQUEUED  Y02072 26668602
*                                                                       26669002
         MODESET  EXTKEY=ZERO           CHANGE TO SVRB KEY       Y02072 26669402
*                                                                       26669802
         ST    IOBQREG2,WKAIOBQX        SAVE NEXT IOB TO GET     Y02072 26669902
*                                       CONTROL OF RECORD        Y02072 26670002
         MVI   WKATRALX,WKAIOBSV        SET AUDIT BIT INDICATING Y02072 26670102
*                                       IOB HAS BEEN SAVED       Y02072 26673102
*                                                                       26675102
         MODESET EXTKEY=DATAMGT         KEY OF RDX LIST          Y02072 26677102
*                                                                       26677502
         ST    WKREG0,RDXIOBUQ          SET NEXT IOB ADDR IN Q   Y02072 26677902
         LTR   WKREG0,WKREG0            WAS THE IOB UNQUEUED THE ONLY   26678002
*                                       IOB ON THE QUEUE                26678102
         BNZ   SETBIT                   NO, OTHER IOBS ARE ON Q  Y02072 26678902
         ST    WKREG0,RDXUQND           ZERO END OF QUEUE PTR    Y02072 26679302
SETBIT   EQU   *                        SET AUDIT BIT BEFORE RET Y02072 26679702
*                                                                       26680102
         MODESET  EXTKEY=ZERO           CHANGE TO SVRB KEY       Y02072 26680502
*                                                                       26680602
         MVI   WKATRALX,WKAIOBDQ        SET AUDIT BIT WHEN IOB   Y02072 26681702
*                                       REMOVED FROM UNPOSTED Q  Y02072 26683702
*                                                                       26684102
         MODESET  KEYADDR=WKASVKEY,WORKREG=13    RET TO USER KEY Y02072 26684202
*                                                                       26684302
         BR    RLINK                    RETURN TO CALLER         Y02072 26684802
         DROP  IOBQREG2,RDXENTRG                                 Y02072 26685602
*********************************************************************** 26686002
*    GET TCB ADDRESS FROM DEB                                         * 26686102
*        THE FOLLOWING SUBROUTINE GETS THE TCB ADDRESS FROM THE       * 26686202
*        DEB, WHOSE ADDRESS HAS BEEN SAVED IN THE SVRB EXTENDED       * 26686302
*        SAVEAREA. THE TCB ADDRESS IS PASSED BACK TO THE CALLER       * 26686402
*        IN REG DEBTCBRG(R4). RETURN REG IS RLINK(R14).               * 26686502
*********************************************************************** 26687102
*                                                                       26688802
GETTCBA  L     TCBREG,PSATOLD           CURRENT TCB ADDR         Y02072 26689402
GETTCBB  L     DEBTCBRG,WKASVDEB        GET DEB ADDRESS          Y02072 26690002
         USING DEBBASIC,DEBTCBRG        ADDRESSABILITY           Y02072 26690602
         L     DEBTCBRG,DEBTCBAD        DEB'S TCB ADDRESS        Y02072 26691202
         LA    DEBTCBRG,0(DEBTCBRG)     CLEAR HI-ORDER BYTE      Y02072 26693202
         BR    RLINK                    RETURN TO CALLER         Y02072 26696202
*                                                                       26699202
*********************************************************************** 26702202
*   RESTORE REGISTERS AFTER SYNCH                                     * 26705202
*        THE FOLLOWING SUBROUTINE RESTORES THE BASE REG AND SVRB REG  * 26707202
*        AFTER RETURNING FROM A MODULE THAT WAS SYNCHED TO.  THIS IS  * 26707602
*        NECESSARY TO ENSURE THE INTEGRITY OF THE TWO REGISTERS, WHICH* 26708002
*        IF CLOBBERED COULD THREATEN SYSTEM INTEGRITY. RETURN REG     * 26708102
*        IS RLINK(R14). THE SVRB REG AND BASE REG ARE INITIALIZED.    * 26708202
*********************************************************************** 26708302
SYNRETRN EQU   *                        THIS ROUTINE RESTORES    Y02072 26708702
*                                                                       26717202
*              THE NEXT SEQUENCE OF INSTRUCTIONS REINITIALIZES   Y02072 26720202
*              THE BASE REGISTER.                                Y02072 26723202
*                                                                       26726202
         BALR  BASEREG,0                ADDR OF THIS INSTRUC     Y02072 26729202
         USING *,BASEREG                                         Y02072 26732202
SYNCHVAL EQU   *                                                 Y02072 26735202
         LA    WKREG0,SYNCHVAL-BASEVAL  DISP INTO MODULE         Y02072 26738202
         SR    BASEREG,WKREG0           GET BASE VALUE FOR MOD   Y02072 26741202
         USING BASEVAL,BASEREG          MODULE ADDRESSABILITY    Y02072 26744202
         L     SVRBREG,PSATOLD          GET THIS TCB ADDRESS     Y02072 26747202
         USING TCB,SVRBREG                                       Y02072 26750702
         L     SVRBREG,TCBRBP           SVRB ADDRESS             Y02072 26754202
         USING RBSECT,SVRBREG                                    Y02072 26757702
*                                                                       26807702
         BR    RLINK                    RETURN TO CALLER         Y02072 27257702
*                                                                       27314402
*********************************************************************** 27316402
*   ENQ THE RESOURCE                                                  * 27317602
*        THE FOLLOWING SUBROUTINE ISSUES AN ENQ MACRO TO ADD A BLOCK  * 27319602
*        TO THE SYSTEM QUEUE. THE ENQ MUST BE ISSUED ULTIMATELY FOR   * 27321602
*        THE TCB WHICH OPENED THE DATA SET(AND IS IN THE DEB). IF THIS* 27323602
*        IS THE TASK WHICH REQUESTED EXCLUSIVE CONTROL, THERE IS NO   * 27323702
*        PROBLEM. HOWEVER, IF AN0THER TASK IS ASKING FOR EXCLUSIVE    * 27323902
*        CONTROL, A DIRECTED ENQ MUST BE REQUESTED. SINCE THIS TYPE   * 27324002
*        OF ENQ DOES NOT SUPPORT THE WAIT-FOR-CONTROL OPTION, AN ENQ  * 27324102
*        IS FIRST ISSUED ON THE CURRENT TASK WITH THE WAIT OPTION,    * 27324202
*        AND WHEN CONTROL IS OBTAINED, IT IS QUICKLY DEQUEUED AND     * 27324302
*        REENQ'D DIRECT. THE LOOP IS REPEATED UNTIL THE RIGHT TCB     * 27324402
*        IS REPRESENTED ON THE SYSTEM QUEUE. RETURN REG IS RLINK2(R9) * 27324502
*********************************************************************** 27324902
*                                                                       27325002
ENQRTNE  MVC   WKANQLST(ENQLN),ENQLIST  MOVE ENQ LIST TO SVRB    Y02072 27325102
         CR    TCBREG,DEBTCBRG          IS THIS THE TCB WHICH    Y02072 27326102
*                                       OPENED THIS DCB?         Y02072 27327302
         BE    ENQHAVE                  IF SO, A DIRECTED ENQ    Y02072 27328502
*                                       IS NOT NEEDED, BRANCH    Y02072 27329702
*                                                                       27330902
*              THE FOLLOWING MACRO WILL ENQ ON THE RECORD UNDER         27332102
*              THE TCB WHICH OPENED THE DCB IF THE RECORD IS            27333302
*              IMMEDIATELY AVAILABLE.                                   27334502
*                                                                       27335702
ENQUSE   ENQ   (,WKANQARG,E,,SYSTEM),TCB=(DEBTCBRG),RET=USE,     Y02072X27336902
               MF=(E,WKANQLST)                                   Y02072 27338102
*                                                                       27339302
         LTR   R15,R15                  WAS IT AVAILABLE?        Y02072 27340502
         BZR   RLINK2                   YES, RETURN TO CALLER    Y02072 27341702
*                                                                       27342902
*              THE FOLLOWING MACRO WILL REQUEST THE RECORD              27344102
*              UNDER THIS TCB, AND WAIT UNTIL THE RECORD IS             27345302
*              AVAILABLE.                                               27346502
*                                                                       27347702
ENQHAVE  ENQ   (,WKANQARG,E,,SYSTEM),RET=HAVE,MF=(E,WKANQLST)    Y02072 27348902
*                                                                       27350102
         CR    TCBREG,DEBTCBRG          IS THE RECORD ENQ'ED     Y02072 27351302
*                                       UNDER THE CORRECT TCB    Y02072 27352502
         BER   RLINK2                   BRANCH YES TO RETURN     Y02072 27353702
*                                                                       27354902
*              THE FOLLOWING MACRO WILL DEQ THE RECORD IN ORDER         27356102
*              TO SUBSEQUENTLY ENQ IT UNDER THE RIGHT TCB.              27357302
*                                                                       27358502
         DEQ   (,,,SYSTEM),MF=(E,WKANQLST),RET=NONE              Y02072 27359702
*                                                                       27360902
         B     ENQUSE                   GO TRY AGAIN (FAST)      Y02072 27362102
*                                                                       27363302
*********************************************************************** 27364502
*    VALIDATE THE DEB                                                 * 27364902
*        THE FOLLOWING SUBROUTINE USES THE DEBCHK BRANCH ENTRY TO     * 27365302
*        VALIDATE THIS JOB STEP'S ACCESS TO THE DATA SET DEFINED      * 27365402
*        IN THE DEB REFERENCED BY THE DCB. RETURN REG IS RLINK2(R9).  * 27365502
*********************************************************************** 27365602
*                                                                       27365702
DEBCHKRT EQU   *                                                        27366902
*                                                                       27376902
*        THE DEBCHK BRANCH ENTRY REQUIRES KEY ZERO AND THE              27416902
*        LOCAL LOCK.                                                    27426902
*                                                                       27428902
*             INPUT TO DEBCHK (BRANCH ENTRY) IS:                        27429302
*                  R1    DEB ADDRESS                                    27429702
*                  R10   TCB ADDRESS                                    27430102
*                  R14   NORMAL RETURN ADDRESS                          27430202
*                  R15   DEBCHK ENTRY POINT                             27430302
*             OUTPUT IS:                                                27430402
*                  R10-R11 DESTROYED                                    27430902
*                  R15   0 OR 4 DEPENDING ON WHETHER DEB IS             27431302
*                        IN DEB TABLE OR NOT                            27431702
*        IF DEB IS NOT IN DEB TABLE, RETURN IS TO NORMAL                27431802
*        RETURN ADDRESS PLUS 4.                                         27432202
*                                                                       27432602
*                 GET ADDRESS OF CURRENT TCB                            27433002
*                                                                       27433402
         USING IHADCB,DCBREG                                     Y02072 27433502
         L     R10,CVTPTR               CVT ADDRESS              Y02072 27433902
         USING CVT,R10                                           Y02072 27434202
         L     R15,CVTEXT2              CVT EXTENSION POINTER    Y02072 27434602
         USING CVTXTNT2,R15             ADDRESS EXTENSION        Y02072 27435002
         L     R15,CVTDEBVR             DEBCHK E.P. ADDR         Y02072 27435402
         DROP  R15                                                      27435502
*                                                                       27435902
         L     R10,PSATOLD              CURRENT TCB ADDR         Y02072 27436002
         DROP  R10                                                      27436102
*                                                                       27436402
         L     R1,DCBDEBAD              GET DEB ADDR             Y02072 27436802
         LA    R1,0(R1)                 CLEAR HI-ORDER BYTE      Y02072 27436902
*                                                                       27437002
         USING DEBBASIC,R1              ESTABLISH DEB BASE       Y02072 27437102
         CLM   DCBREG,B'0111',DEBDCBB   ENSURE THAT DEB POINTS   Y02072 27437202
*                                       TO THIS DCB-DEBCHK BR    Y02072 27437302
*                                       ENTRY SKIPS THIS CHECK   Y02072 27437402
         BNE   ABEND435                 IF NOT EQUAL-WRONG DEB   Y02072 27437502
         DROP  R1                                                       27437602
         BALR  R14,R15                  GO TO DEBCHK             Y02072 27438002
*                                                                       27438102
         B     DEBSAVE                  GOOD DEB, SAVE IT        Y02072 27438202
         B     ABEND435                 INVALID, GO ABEND        Y02072 27438302
DEBSAVE  EQU   *                        SAVE VALID DEB IN SVRB   Y02072 27438502
         ST    R1,WKASVDEB              SAVE DEB IN SVRB WKAREA  Y02072 27438902
         SH    R1,XTNPTR                GET DEB EXTN.....      @ZA24816 27439337
         L     R1,0(R1)                 AND TEST FOR.....      @ZA24816 27439437
         TM    16(R1),X'20'             BDAM DATA SET          @ZA24816 27439537
         BNO   ABEND435                 NOT BDAM - ABEND       @ZA24816 27439637
         BR    RLINK2                   RETURN TO MAIN ROUTINE   Y02072 27439737
*                                                                       27439837
*********************************************************************** 27439937
*     ABEND ROUTINE                                                   * 27440037
*              THE FOLLOWING ABENDS ARE ISSUED:                       * 27440137
*                   335  ENQUEUE REQUEST FOR INVALID BLOCK            * 27440402
*                   435  INVALID DEB                                  * 27440502
*                   535  INSUFFICIENT CORE TO PROCESS                 * 27440902
*              THEY ARE NOT INTERCEPTED BY OUR RECOVERY RTNE          * 27441002
*********************************************************************** 27441302
*                                                                       27442102
         USING IOBSTDRD,IOBREG                                   Y02072 27442202
ABND535A LA    WKREG1,INSUFCOR          ABEND CODE TO WORK REG   Y02072 27442402
         B     FRELCK7                  GO RELEASE LOCAL LOCK    Y02072 27442702
ABEND435 LA    WKREG1,INVALCB           LOAD ABEND CODE          Y02072 27443002
         B     ABESETSW                 GO SET FREEMAIN SWITCH   Y02072 27443302
ABEND335 LA    WKREG1,CANTENQ           LOAD ABEND CODE          Y02072 27443602
ABESETSW TM    IOBDTYP2,IOBRELEX        IS REQUEST RELEX         YM1474 27443902
         BZ    FRELCK7                  BRANCH IF NOT            Y02072 27444902
         OI    WKASW1,WKAABEND          INDICATES MUST FREE IOB  Y02072 27446102
*                                                                       27447302
FRELCK7  SETLOCK RELEASE,TYPE=LOCAL,    RELEASE THE LOCAL LOCK   Y02072X27448502
               RELATED=(EXCLCTLQ,IGC0005C(SCANLOCK,SCANLCK2))    Y02072 27449702
*                                                                       27450902
         TM    WKASW1,WKAABEND          MUST I FREE IOB?         Y02072 27452102
         BO    RELEXIT1                 BRANCH YES               Y02072 27453302
*                                                                       27454502
DEESTAE  ESTAE 0                         REMOVE ESTAE COVERAGE   Y02072 27455702
*                                                                       27456902
         ABEND (WKREG1),DUMP,,SYSTEM    TERMINATE TASK           Y02072 27458102
*                                                                       27459302
ABEND535 LA    WKREG1,INSUFCOR          LOAD ABEND CODE          Y02072 27460502
         B     DEESTAE                  GET RID OF ESTAE         Y02072 27461702
*                                                                       27462902
         EJECT                                                          27463302
*********************************************************************** 27464102
*  THE FOLLOWING IS THE ESTAE EXIT ROUTINE, ENTERED BY RTM IF AN      * 27464502
*  ABEND SHOULD OCCUR AT THIS RB LEVEL DURING EXCLUSIVE CONTROL       * 27464902
*  PROCESSING.  THIS ROUTINE FINDS THE ADDRESS OF THE EXCLUSIVE       * 27465002
*  CONTROL ESTAE ROUTINE, IGCT005C, IN THE LPALIB AND BRANCHES TO     * 27465102
*  IT.  THE ROUTINE ISSUES THE MACRO, IGGSTAE, WHICH USES THE CON-    * 27465202
*  TENTS SUPERVISOR ROUTINE, IEAVVMSR. THE ROUTINE IS ENTERED IN      * 27515202
*  SUPERVISOR STATE AND SUPERVISOR KEY.                               * 27525202
*********************************************************************** 27535202
*                                                                       27565202
ESTAERTN IGGSTAE TRRNAME                GENERATE BOOTSTRAP       Y02072 27615202
*                                                                       27665202
*                                                                       27715202
*                                                                       27765202
*********************************************************************** 30038102
*                          MISCELLANEOUS EQUATES                      * 30048102
*********************************************************************** 30058102
CAPRECLG EQU   7                        DATA LENGTH OF R0-1      YM1152 30068102
IOBLG    EQU   132                      LENGTH OF CORE GOTTEN FOR IOB   30076102
LTTR     EQU   3                        LENGTH OF TTR            Y02072 30126102
MAXLG    EQU   256                      MAX LENGTH THAT CAN BE MOVED    30378102
SPIOB    EQU   0                        SUBPOOL OF IOB IS 0      Y02072 30428102
SPDMGTNF EQU   230                      SUBPOOL FOR DATA MANAGE- Y02072 30478102
*                                       MENT KEY, NOT FETCH      Y02072 30528102
*                                       PROTECTED CORE           Y02072 30578102
AVAILIOB EQU   0                        IOB IS AVAILABLE         Y02072 30738102
DATAMGT  EQU   5                        DATA MANAGEMENT KEY      Y02072 30770102
*********************************************************************** 30778102
*                     CONSTANTS                                       * 30828102
*********************************************************************** 30878102
AVAIL    DC    1D'0'                     ZERO CONSTANT FOR RDX ENTRY    31078102
MAJNAME  DC    C'SYSZGGLG'               MAJOR QUEUE NAME               31128102
TRRNAME  DC    C'IGCT005C'              MODULE NAME FOR TRR      Y02072 31178102
CON256   DC    H'256'                                                   31328102
XTNPTR   DC    H'8'                     CONSTANT FOR SUBTRACT  @ZA24816 31333137
*                                                                       31338102
ESTAELST ESTAE ESTAERTN,RECORD=YES,MF=L                          Y02072 31348102
ESTAELN  EQU   *-ESTAELST                                        Y02072 31358102
*                                                                       31368102
ENQLIST  ENQ   (MAJNAME,,S,L'WKANQARG),MF=L                      Y02072 31418102
ENQLN    EQU   *-ENQLIST                LENGTH OF ENQ LIST       Y02072 31468102
*                                                                       31470102
MODID    DC    C'IGC0005C'              MODULE ID                Y02072 31470502
FIX      DC    C'OZ31947 '              LATEST FIX IN MODULE     YM6585 31470937
DATE     DC    CL8'&SYSDATE'            DATE OF LATEST FIX     @ZA24816 31471337
PATCH    DC    XL((*-IGC0005C)/20)'0'   5% PATCH SPACE           Y02072 31472102
         EJECT                                                          31478102
*********************************************************************** 31528102
*                              DSECTS                                 * 31578102
*********************************************************************** 31628102
         DCBD  DSORG=DA                                                 31678102
         EJECT                                                          31728102
         IEZIOB                                                         31778102
         EJECT                                                          31786502
*********************************************************************** 31788102
*  THE FOLLOWING FORMATS THE ADDRESS VECTOR TABLE WHICH APPEARS IN    * 31798102
*  THE FRONT OF THE FOUNDATION MODULES.  THE WORKAREA WHICH FUNCTIONS * 31808102
*  SIMULTANEOUSLY AS AN IOB, DECB AND VECTOR TABLE FOR ROUTINES       * 31818102
*  WHICH INTERFACE WITH THE READ EXCLUSIVE FUNCTION WILL CONTAIN      * 31820102
*  FIELDS RELEVANT TO EACH, INCLUDING THE FOUNDATION MODULE ERROR     * 31822102
*  ROUTINE ADDRESS, ALTERED TO POINT TO THIS MODULE.  IN ADDITION     * 31824102
*  THE IOBCSW FIELD IS DEFINED ON A BOUNDARY AS IT IS SUBSEQUENTLY    * 31826102
*  REFERENCED BY THE READ EXCLUSIVE FUNCTION.                         * 31826502
*********************************************************************** 31826902
FMVECTOR DSECT                     FOUNDATION MOD VECTOR TABLE          31827302
FOUNDENT DS    XL4                                                      31827702
RRAD     DS    A                   ADDRESS OF REL BLK MOD, IGG019KE     31827802
RTAD     DS    A                   ADDRESS OF REL TRK MOD, IGG019KC     31827902
VERAD    DS    A                   ADDRESS OF WRT VERIFY, IGG019KQ      31828002
ASIAD    DS    A                   ADDRESS OF ASI FOR THIS MOD          31844702
ERRENTRY DS    A                   ADDRESS OF ERROR RTN IN FOUND MOD    31854702
KEYMODAD DS    A                   ADDRESS OF CHN PGM BY KEY, 19KI      31856702
IDMODAD  DS    A                   ADDRESS OF CHN PGM BY ID, 19KK       31858702
RROVAD   DS    A                   ADDRESS OF REL BLK TRK OVERFLO, 19KF 31860702
         EJECT                                                          31872502
         IEZDEB                                                         31878102
         EJECT                                                          31928102
         IGGRDX                                                         31978102
         EJECT                                                          32111402
         IHADECB                                                        32128102
         EJECT                                                          32130102
         CVT   DSECT=YES                                                32138102
         EJECT                                                          32148102
         IKJTCB                                                         32158102
         EJECT                                                          32168102
         IKJRB                                                          32170102
         EJECT                                                          32170502
RBPRFX   DSECT                          RESUME RB DSECT                 32170902
         ORG   RBEXSAVE                                                 32172102
WKAREAX  DS    0XL48                    SVC/ESTAE WORKAREA       Y02072 32172502
WKASW1   DS    XL1                      SWITCH                   Y02072 32174102
WKAD2305 EQU   BIT0                     2305 EXCLUSIVE REQ       Y02072 32174202
WKAABEND EQU   BIT1                     SET IF RELEX IOB MUST BE Y02072 32174502
*                                       FREED BEFORE ABEND       Y02072 32174902
WKADEQD  EQU   BIT2                     DEQ HAS BEEN ISSUED      Y02072 32175002
WKAENQRQ EQU   BIT5                     ENQ REQUEST              Y02072 32175302
WKADEQRQ EQU   BIT6                     DEQ REQUEST              Y02072 32175702
WKATRALX DS    XL1                      AUDIT TRAIL BYTE         Y02072 32176102
*  THE FOLLOWING ARE AUDIT TRAIL BITS SET BY THIS SVC AND INTERROGATED* 32178102
*  BY ITS BACKUP ESTAE, IGCT005C, SHOULD AN ABEND OCCUR DURING ITS    * 32180102
*  PROCESSING. IT TRACKS THE COMPLETED OPERATIONS OF THIS SVC.        * 32182102
WKAVALRC EQU   X'01'                    RECORD SAVED IN SVRB     Y02072 32184102
WKADEQ   EQU   X'02'                    DEQ HAS BEEN ISSUED      Y02072 32184502
WKARDXZR EQU   X'03'                    RDXENTRY IS CLEARED      Y02072 32184902
WKAIOBSV EQU   X'04'                    NEXT IOB SAVED IN SVRB   Y02072 32185302
WKAIOBDQ EQU   X'05'                    IOB DEQ'D FROM UNPOSTQ   Y02072 32185702
WKAFEED  EQU   X'06'                    FEEDBACK FOR NEXT IOB    Y02072 32185802
WKAPOST  EQU   X'07'                    NEXT IOB IS POSTED       Y02072 32185902
WKAENQX  EQU   X'08'                    ENQ COMPLETED AFTER DEQ  Y02072 32186002
WKAEXCPX EQU   X'09'                    EXCP COMPLETED AFTER DEQ Y02072 32191602
WKAENQRD EQU   X'0A'                    ENQ REQUIRED AFTER DEQ   Y02072 32193602
WKARDXAD EQU   X'20'                    RDXENTRY ADDED TO LIST   Y02072 32195602
WKAENQ   EQU   X'30'                    ENQ ISSUED=ENQ REQUEST   Y02072 32196002
WKAEXCPE EQU   X'40'                    EXCP ISSUED=ENQ REQUEST  Y02072 32196402
WKAIOBST EQU   X'50'                    LAST IOB ON POSTQ SAVED  Y02072 32196802
WKAIOBQD EQU   X'60'                    CURRENT IOB PUT ON POSTQ Y02072 32197202
*                                                                       32197302
WKASVKEY DS    XL1                      CALLERS PROTECT KEY      Y02072 32197602
WKACLENX DS    XL1                      CLEANUP SW USED BY ESTAE Y02072 32203202
WKASAV14 DS    A                        REGISTER 14 SAVEAREA     Y02072 32208802
WKAIOBQX DS    A                        NEXT/LAST IOB ADDR       Y02072 32214402
WKANQARG DS    0XL8                     MINOR NAME FOR ENQUEUE   Y02072 32220002
WKANQUCB DS    AL3                      UCB ADDRESS              Y02072 32225602
WKANQDEV DS    0XL5                     RECORD ADDR (CCHHR)      Y02072 32231202
WKANQCC  DS    XL2                      CYLINDER NUMBER          Y02072 32236802
WKANQHH  DS    XL2                      HEAD NUMBER              Y02072 32246802
WKANQR   DS    X                        RECORD NUMBER            Y02072 32256802
WKARLCOR DS    A                        RELEX CORE ADDRESS       Y02072 32258802
WKASVDEB DS    A                        DEB ADDR FOR VALIDITY CK Y02072 32266802
WKALST   EQU   *                        FOR MACRO LISTS          Y02072 32276802
WKANQLST EQU   WKALST+4                 ALLOWS FOR 4-BYTE PREFIX Y02072 32286802
WKALSTLN EQU   RBEXSAVE+L'RBEXSAVE-WKALST   MAXIMUM LIST LENGTH  Y02072 32386802
         EJECT                                                          32426802
         IHAPSA                                                         32476802
         EJECT                                                          32486802
         IHASDWA                                                        32496802
         END                                                            32526802
./  ADD  SSI=81250136,NAME=IGC0005G
         TITLE 'IGC0005G - FREE DYNAMIC BUFFER SVC ROUTINE (SVC 57).'   00010021
IGC0005G CSECT                                                          00010402
*********************************************************************** 00012002
*                                                                     * 00014002
*  MODULE NAME = IGC0005G                                             * 00016002
*                                                                     * 00018002
*  DESCRIPTIVE NAME = FREEDBUF SVC                                    * 00018402
*                                                                     * 00018802
*  COPYRIGHT = NONE                                                   * 00019202
*                                                                     * 00019602
*  STATUS = 001                                                       * 00019702
*                                                                     * 00019802
*  FUNCTION = THIS ROUTINE IS ENTERED WHEN THE PROBLEM PROGRAM ISSUES * 00019902
*    AN SVC 57(VIA THE FREEDBUF MACRO).THIS ROUTINE SETS UP FOR ENTRY * 00120000
*    TO THE BDAM AND ISAM FREEDBUF ROUTINES.UPON RETURN FROM THESE    * 00140000
*    ROUTINES REGISTER 15 IS CLEARED AND CONTROL IS GIVEN TO THE      * 00160000
*    PROBLEM PROGRAM ONCE AGAIN.                                      * 00180000
*                                                                     * 00200000
*    FOR BDAM ENTRY TO FREEDBUF, AN ESTAE MACRO IS ISSUED TO SET UP   * 00210002
*    AN ERROR EXIT SHOULD THERE BE AN ABEND AT THIS RB LEVEL DURING   * 00212002
*    SVC 57 OR DYN BUFFER PROCESSING.  THE ESTAE MACRO IDENTIFIES     * 00214002
*    AN ENTRY POINT WITHIN THIS SVC AS THE ERROR EXIT.  THIS ERROR    * 00216002
*    EXIT WILL LOAD AND TRANSFER CONTROL TO THE FREEDBUF ESTAE        * 00218002
*    MODULE, IGCT005G.                                                * 00218402
*                                                                     * 00218802
*    BEFORE TRANSFERRING CONTROL TO THE DYNAMIC BUFFERING MODULES,    * 00219602
*    MODESET WILL CHANGE FURTHER PROCESSING TO USER KEY.              * 00219702
*                                                                     * 00219802
*  NOTES = NONE                                                       * 00219902
*                                                                     * 00226602
*     DEPENDENCIES = NONE                                             * 00228602
*                                                                     * 00230602
*     DATA AREAS = NONE                                               * 00231002
*                                                                     * 00231402
*     RESTRICTIONS = NONE                                             * 00232602
*                                                                     * 00233002
*     REGISTER CONVENTIONS = SEE REGISTER EQUATES BELOW               * 00233102
*                                                                     * 00233202
*     PATCH LABEL = NONE                                              * 00239902
*                                                                     * 00241902
*  MODULE TYPE = SVC ROUTINE                                          * 00243902
*                                                                     * 00245902
*     PROCESSOR = ASSEMBLER XF                                        * 00246302
*                                                                     * 00246402
*     MODULE SIZE = 360 DECIMAL BYTES                                 * 00246502
*                                                                     * 00253202
*     ATTRIBUTES = REENTRANT,ENABLED,PRIVILEGED, ENTERED IN SUPERVISOR* 00255202
*       KEY.  MODESET IS ISSUED TO DO ALL PROCESSING IN USER KEY.     * 00257202
*       CONTROL IS PASSED TO DYN BUF MODULES IN SUPERVISOR KEY.       * 00259202
*                                                                     * 00259802
*                                                                     * 00259902
*                                                                     * 00261502
*  ENTRY POINT = 'BEGIN'(THE SECOND ENTRY POINT,'EXITRTN', IS         * 00265602
*     DESCRIBED IN A SEPARATE SECTION BELOW)                          * 00267202
*                                                                     * 00268802
*     PURPOSE = SEE FUNCTION                                          * 00270402
*                                                                     * 00272002
*     LINKAGE = WHEN AN SVC 57 IS ISSUED THIS ROUTINE IS READ INTO THE* 00273602
*       TRANSIENT AREA AND GIVEN CONTROL AT ITS ENTRY POINT.          * 00275202
*       THE MACRO IS ISSUED AS FOLLOWS:                               * 00276802
*                                                                     * 00277202
*                FREEDBUF  DECBADDR,K/D,DCBADDR                       * 00278402
*                                                                     * 00280002
*     INPUT - INPUTS TO THIS ROUTINE ARE                              * 00570002
*        REGISTER 1 - DCB ADDRESS                                     * 00572002
*        REGISTER 0 - DECB ADDRESS                                    * 00574002
*        REGISTER 4 - TCB ADDRESS                                     * 00576002
*        REGISTER 5 - SVRB ADDRESS                                    * 00578002
*        REGISTER 14- RETURN ADDRESS                                  * 00578402
*        REGISTER 15- ENTRY ADDRESS                                   * 00578802
*                                                                     * 00580000
*     OUTPUT = THIS ROUTINE SETS UP FOR BALR TO BDAM AND ISAM FREEDBUF* 00582002
*        ROUTINES AS FOLLOWS:                                         * 00584002
*        FOR ISAM REGISTER  2 - DECB ADDRESS                          * 00588002
*                           3 - DEB ADDRESS                           * 00588102
*        FOR BOTH REGISTER  4 - DCB ADDRESS                           * 00588402
*                           5 - SVRB ADDRESS                          * 00588802
*                           8 - TCB ADDRESS                           * 00588902
*                          14 - RETURN REGISTER                       * 00589202
*                          15 - ENTRY POINT REGISTER                  * 00589602
*                          SUPERVISOR KEY WITHOUT LOCAL LOCK          * 00590002
*                                                                     * 00590602
*     OUTPUT TO CALLER: A) AUDIT TRAIL BITS ARE SET IN SVRB EXT SAVE  * 00594002
*        FOR ESTAE RTN TO USE, B) RELEASE OF BUFFER TO A WAITING      * 00595002
*        USER OR TO THE AVAILABLE BUFFER QUEUE, C) RETURN CODE IN     * 00596002
*        REGISTER 15 IF EXTEND FUNCTION WAS NOT SUCCESSFUL.           * 00597002
*                                                                     * 00598002
*     EXIT-NORMAL = SVC EXIT IS ISSUED AFTER RETURN FROM BDAM OR ISAM * 00599002
*        DYNAMIC BUFFERING ROUTINES.  ON EXTEND EXIT, R15 IS ZERO.    * 00600002
*                                                                     * 00601002
*     EXIT-ABNORMAL = AN ESTAE EXIT IS PROVIDED FOR THE BDAM ENTRY TO * 00602002
*        INTERCEPT ANY ABEND AT THIS RB LEVEL. BRANCH IS THEN MADE TO * 00603002
*        FREEDBUF ESTAE, IGCT005G.                                    * 00604002
*     EXIT-ABEND = ABEND 339 IS ISSUED IF THE DEB IS INVALID.         * 00604402
*                                                                     * 00605002
*                                                                     * 00605402
*                                                                     * 00606002
*  ENTRY POINT = EXITRTN                                              * 00607002
*                                                                     * 00608002
*     PURPOSE = ENTERED FROM RTM VIA A SYNCH IN KEY ZERO ENABLED      * 00609002
*               WHEN THERE IS AN ATTEMPT TO ABNORMALLY TERMINATE THE  * 00610002
*               RB LEVEL ON WHICH THIS SVC IS ACTIVE.  THIS ROUTINE   * 00611602
*               WILL FIND THE ADDRESS OF THE TRR BY CALLING IEAVVMSR  * 00612002
*               TO SEARCH THE LPA DIRECTORY.  IT WILL ALSO FILL IN    * 00612402
*               SDWACSCT AND SDWAREXN.                                * 00612802
*                                                                     * 00612902
*     LINKAGE = REGISTER 0 - CODE.  IF 12 NO RTCA IS PASSED           * 00613202
*               REGISTER 1 - ADDRESS OF THE RTCA.                     * 00613602
*               REGISTER 13- ADDRESS OF A 16 FULLWORD SAVE AREA.      * 00613702
*               REGISTER 14- RETURN ADDRESS                           * 00613802
*               REGISTER 15- ADDRESS OF THE BOOTSTRAP ROUTINE.        * 00613902
*                                                                     * 00614902
*     INPUT = RTCA.                                                   * 00616902
*                                                                     * 00617202
*     OUTPUT = REGS AS PASSED FROM RTM EXCEPT 15 SET TO ADDR OF TRR.  * 00617602
*              SDWACSCT SET TO CSECT NAME.                            * 00618002
*              SDWAREXN SET TO TRR NAME.                              * 00618202
*                                                                     * 00618302
*     EXIT - NORMAL = BRANCH TO TRR.                                  * 00618402
*                                                                     * 00618502
*     EXIT - ERROR = A BRANCH ON REGISTER 14 BACK TO RTM IF NO RTCA   * 00618802
*                    PASSED.                                          * 00619202
*                    A PROGRAM CHECK TO CAUSE RTM TO PERCOLATE        * 00619302
*                    IF THE TRR NAME COULD NOT BE FOUND IN THE SEARCH * 00622602
*                    OF THE LPA DIRECTORY.                            * 00624602
*                                                                     * 00626602
*                                                                     * 00628202
*                                                                     * 00630202
*  EXTERNAL REFERENCES = NONE                                         * 00632002
*                                                                     * 00633602
*     ROUTINES:    'IGG019LE' BDAM SIO APPENDAGE FREES BUFFERS IF     * 00635202
*                   RECFM IN NOT VS AND ADDRESS SPACE = REAL.         * 00636802
*                  'IGG019LE' BDAM SIO APPENDAGE FREES BUFFERS IF     * 00638437
*                   RECFM IS VS AND ADDRESS SPACE = REAL.             * 00640002
*                  'IGG019JA' BDAM SIO APPENDAGE FREES BUFFERS IF     * 00640202
*                   RECFM IS NOT VS AND ADDRESS SPACE = VIRTUAL.      * 00643502
*                  'IGG019JA' BDAM SIO APPENDAGE FREES BUFFERS IF     * 00646837
*                   RECFM IS VS AND ADDRESS SPACE = VIRTUAL.          * 00650102
*                                                                     * 00653402
*                  'IGG019JI' ISAM ROUTINE FOR FREEING A BUFFER.      * 00656702
*                                                                     * 00660000
*                   DEBCHK(SVC 117) IS CALLED FOR DEB VALIDITY CHECK  * 00710002
*                   ESTAE(SVC 60) IS CALLED TO ESTABLISH ESTAE EXIT   * 00760002
*                                                                     * 00780000
*     DATA AREAS = NONE                                               * 00830002
*                                                                     * 00840000
*     CONTROL BLOCKS = DCB, DECB, AND SVRB                            * 00850002
*                                                                     * 00860000
*  TABLES = SVRB EXTENDED SAVEAREA IS USED AS SAVEAREA FOR REG 14 AND * 00862002
*    IS PASSED AS A PARAMETER LIST TO THE ESTAE ROUTINE.  IT IS ALSO  * 00864002
*    PASSED TO THE DYNAMIC BUFFERING ROUTINES TO BE USED AS A WORKAREA* 00866002
*                                                                     * 00868002
*  MACROS = ESTAE, DEBCHK, MODESET, IGGSTAE                           * 00868402
*                                                                     * 00868802
*                                                                     * 00868902
*                                                                     * 00869002
*  CHANGE ACTIVITY = AS FOLLOWS:                                      * 00869202
*                                                                     * 00869602
*                    OS 21 DELETIONS/CHANGES                          * 00869702
*1061016200                                                      S21045 00870002
*1061014600-014800,016080                                        M0079  00870402
*1061                                                            A49370 00870802
*1061004000-004800,006000,007600,010800,011500,013800-015600,    A30797 00870902
*1061016080,016160,017720,017800-018000                          A30797 00871002
*                    VS1-1 DELETIONS/CHANGES                            00871102
*                                                                XM8240 00871202
*                    VS1-2 DELETIONS/CHANGES                            00871402
*                    VS1-3 DELETIONS/CHANGES                            00871702
*                    VS2-1 DELETIONS/CHANGES                            00872002
*1061                                                            Y01021 00872402
*                    VS2-2 DELETIONS/CHANGES                            00873502
*                    VS2-3 DELETIONS/CHANGES                            00883537
*D012295-012299                                                @ZA08000 00884437
*                    CHANGES SUBSEQUENT TO VS2-3.7                      00885337
*A011540,012980-013260,013400,017636                           @ZA12955 00886237
*A012311,012315,017643                                         @ZA14605 00887137
*A013230,013240,013360,C013350,014600                          @ZA24838 00887737
*A012300,A012302,A012418,A012420                               @ZA31948 00888037
         EJECT                                                          00888402
*********************************************************************** 00890002
*                      REGISTER EQUATES                               * 00892002
*********************************************************************** 00894002
PARREG1  EQU   0                        INPUT PARAM REG WITH DECB       00900002
PARREG2  EQU   1                        INPUT PARAM REG WITH DCB        00920002
*                                       DEB PASSED TO DEBCHK-R1  Y02072 00930002
PARREG3  EQU   2                        PARAM REG WITH DECB ADDRESS     00940002
*                                       WHEN BR TO ISAM DYN BUF RTN     00950002
DEBREG   EQU   3                        BASE REG FOR DEB                00960002
DCBREG   EQU   4                        BASE REG FOR DCB                00980002
PARREG4  EQU   4                        TCB ADDR ON ENTRY        Y02072 00990002
SVRBREG  EQU   5                        REG IN WHICH SVRB IS PASSED     01000002
BASEREG  EQU   6                        BASE REGISTER FOR THIS MODULE   01020002
DECBREG  EQU   7                        BASE REG FOR DECB               01040002
TCBREG   EQU   8                        BASE REG FOR TCB         Y02072 01050002
SUBRTREG EQU   9                        RET REG FROM FREELOCK    Y02072 01052002
IOBREG   EQU   10                       REG WITH IOB ADDRESS            01100002
WORKREGY EQU   10                       USED AS WORK REGISTER    Y02072 01110002
WORKREGX EQU   11                       USED AS WORK REGISTER           01112002
RETREG   EQU   14                       RETURN REGISTER                 01120002
EPREG    EQU   15                       LINK REGISTER                   01140002
DEBAVTRG EQU   15                       REG CONTAINING AVT ADDRESS      01142002
DEBEXREG EQU   15                       REG CONTAINING DEB EXT PTR      01144002
DEBXTNRG EQU   15                       REG FOR PTR TO DEBXTN  @ZA12955 01154037
*                                                                       01154402
BEGIN    EQU   *                        ENTRY POINT - FREEDBUF   Y02072 01154802
         BALR  BASEREG,0                ESTABLISH ADDRESSABILITY        01154902
         USING *,BASEREG                FOR THIS ROUTINE                01160602
         USING RBSECT,SVRBREG           ESTABLISH BASE FOR SVRB  A30797 01166302
         LR    DECBREG,PARREG1          LOAD DECB BASEREG        A49370 01172021
         USING DECB,DECBREG             ESTABLISH BASE FOR DECB  A49370 01174002
         LR    TCBREG,PARREG4           LOAD TCB INTO ITS BASE   Y02072 01210002
         USING TCB,TCBREG               ESTABLISH TCB BASE       Y02072 01212002
*                                       TCB ADDR WILL BE PASSED  Y02072 01214002
*                                       TO DYN BUF RTN IN R8     Y02072 01216002
         LR    DCBREG,PARREG2           PUT DCB ADDRESS INTO DCBREG     01220002
         USING IHADCB,DCBREG            ESTABLISH BASE FOR DCB          01220402
         XC    WKAREA,WKAREA            CLEAR SVRB WORKAREA      Y02072 01220502
         ST    RETREG,WKASVC14          SAVE RET ADDR IN SVRB    Y02072 01221402
         L     WORKREGX,RBLINK          GET THE CALLERS RB ADDR  Y02072 01221702
         USING RBSECT,WORKREGX          ESTABLISH NEW SVRB BASE  Y02072 01222102
         DROP  SVRBREG                  DROP EARLIER BASE        Y02072 01222202
         IC    WORKREGX,RBOPSW+1        GET CALLER'S KEY         Y02072 01222302
         USING RBSECT,SVRBREG           REESTABLISH SVRB BASE    Y02072 01222402
         DROP  WORKREGX                 DROP NEW SVRB BASE       Y02072 01223102
         STC   WORKREGX,WKASVKEY        SAVE CALLER'S KEY IN WKA Y02072 01223502
         TM    DCBDSORG,DCBDSGDA        IS THIS BDAM DATA SET    Y02072 01223702
         BNO   CHECKDEB                 NO, GO ISSUE DEBCHK      Y02072 01223902
*                                                                       01224202
*********************************************************************** 01224502
*  BDAM WILL ESTABLISH AN ESTAE TO BACK UP FREEDBUF IN CASE OF ERROR. * 01224802
*  THE ESTAE WILL ESTABLISH AN EXIT ROUTINE ADDRESS IN THIS MODULE.   * 01225102
*********************************************************************** 01225402
*                        MOVE THE PARM LIST                      Y02072 01225737
         MVC   WKAESTAE(ESTAELEN),ELIST MOVE ESTAE PARM LIST     Y02072 01226002
*                                       INTO SVRB EXT SAVE       Y02072 01226302
*                                                                       01228002
        ESTAE PARAM=(SVRBREG),MF=(E,WKAESTAE) ESTAB ESTAE EXIT   Y02072 01228702
*                                                                       01229102
*     TEST IF BDAM FREEDBUF REQUEST IS VALID - IS THERE AN IOB?       * 01229202
*                                                                       01229302
         MODESET  KEYADDR=WKASVKEY,WORKREG=2  CHG TO USER KEY  @ZA31948 01230037
         L     IOBREG,DECIOBPT          LOAD IOBPTR IN DECB      A49370 01230137
         MODESET  EXTKEY=ZERO           RETURN TO KEY ZERO     @ZA31948 01230237
         LTR   IOBREG,IOBREG            WAS IO REQ INVALID?      A49370 01230637
         BZ    RETURN                   YES, NO BUFFER TO FREE   A49370 01230702
         TM    DECTYPE1,DECDYNBF        DYN BFR REQUESTED?     @ZA14605 01231137
         BZ    RETURN                   NO - GET OUT           @ZA14605 01231537
*********************************************************************** 01231902
*  THE FOLLOWING ROUTINE VALIDITY CHECKS THE DEB, WHOSE ADDRESS IS IN * 01232202
*  DCBDEBAD.  THE BRANCH ENTRY IS USED TO ALLOW THE LOCAL LOCK TO BE  * 01232502
*  HELD AFTER RETURN FROM DEBCHK UNTIL THE BRANCHING ADDRESSES ARE    * 01232902
*  LOADED FROM THE VALIDATED DEB. IF THE DEB IS FOUND TO BE INVALID,  * 01233302
*  ABEND 339 RESULTS. THE BRANCH ENTRY TO DEBCHK REQUIRES THAT THE    * 01233702
*  LOCAL LOCK BE HELD AND KEY ZERO USED.  INPUT TO THE BRANCH ENTRY OF* 01233802
*  DEBCHK IS AS FOLLOWS:                                              * 01234002
*                                  REG 1 - DEB ADDRESS                * 01234302
*                                  REG 10- TCB ADDRESS                * 01234702
*                                  REG 14- RETURN ADDRESS             * 01235102
*                                  REG 15- DEBCHK ENTRY POINT         * 01235502
*  OUTPUT IS AS FOLLOWS:                                              * 01235602
*                                  REG 10,11 - DESTROYED              * 01235802
*                                  REG 15- 0 IF DEB VALID,            * 01236102
*                                          4 IF DEB INVALID           * 01236502
*  RETURN IS 4 BYTES BEYOND THE NORMAL RETURN IF THE DEB IS INVALID.  * 01236902
*********************************************************************** 01237202
CHECKDEB EQU   *                        VALIDITY CHECK THE DEB   Y02072 01239702
         MODESET  KEYADDR=WKASVKEY,WORKREG=2  CHG TO USER KEY  @ZA31948 01241837
         L     DEBREG,DCBDEBAD          GET DEB ADDRESS          M0079  01241937
         MODESET  EXTKEY=ZERO           RETURN TO KEY ZERO     @ZA31948 01242037
         USING DEBBASIC,DEBREG          ESTABLISH BASE FOR DEB   A30797 01242402
         TM    DCBDSORG,DCBDSGDA        IS THIS BDAM DATA SET    Y01021 01249002
         BO    GETLOCK                  YES, ISSUE MACRO         Y01021 01252002
         TM    DCBDSORG,DCBDSGIS        IS THIS SVC CALLED FOR ISAM     01258002
         BO    GETLOCK                  YES, ISSUE MACRO         Y01021 01261002
         BR    RETREG                   ELSE, RETURN TO CALLER          01264002
*                                                                       01264402
GETLOCK  EQU   *                        GET THE LOCAL LOCK       Y02072 01266002
*                                                                       01266402
*     SETLOCK USES REGISTERS 11-14 WITHOUT RESTORING THEM             * 01266802
*                                                                       01266902
         SETLOCK  OBTAIN,TYPE=LOCAL,RELATED=('DEBFLDS,IGC0005G(FREELOCKX01267202
               ,ABNFREE)'),MODE=UNCOND  GET LOCAL LOCK           Y02072 01267302
*                                                                       01267602
*                        SET UP REGS FOR DEBCHK                  Y02072 01269037
         CLM   DCBREG,MASK,DEBDCBB      ENSURE THAT DEB POINTS   Y02072 01269102
*                                       TO THIS DCB-DEBCHK BR    Y02072 01269202
*                                       ENTRY SKIPS THIS CHECK   Y02072 01269302
         BNE   ABEND                    IF NOT EQUAL,WRONG DEB   Y02072 01270602
         LA    PARREG2,0(DEBREG)        PUT DEB PTR IN REG 1     Y02072 01273302
         LR    WORKREGY,TCBREG          PUT TCB PTR IN REG 10    Y02072 01274602
         L     WORKREGX,CVTPTR          CVT ADDRESS              Y02072 01275902
         USING CVT,WORKREGX             ESTABLISH CVT BASE       Y02072 01277202
         L     WORKREGX,CVTEXT2         GET CVT EXTENSION        Y02072 01278502
         DROP  WORKREGX                 DROP CVT BASE            Y02072 01279802
         USING CVTXTNT2,WORKREGX        ESTABLISH CVT EXT BASE   Y02072 01281102
         L     EPREG,CVTDEBVR           GET DEBCHK ENTRY         Y02072 01282402
         DROP  WORKREGX                 DROP CVT EXT BASE        Y02072 01283702
         BALR  RETREG,EPREG             BR TO DEBCHK RTN         Y02072 01285002
         B     DEBOK                    BRANCH AROUND ERROR RET  Y02072 01286302
         B     ABEND                    DEB INVALID - ABEND 339  Y02072 01287602
DEBOK    EQU   *                        DEB PASSED VALIDITY CHK  Y02072 01288902
         LR    DEBREG,PARREG2           GET VALIDATED DEB ADDR   Y02072 01290202
         LR    PARREG1,DECBREG          RESTORE REGISTER 0       Y02072 01291502
         LR    PARREG2,DCBREG           RESTORE REGISTER 1       Y02072 01292802
*********************************************************************** 01294102
*            DETERMINE IF ENTRY FOR ISAM OR BDAM                      * 01295402
*********************************************************************** 01296702
         LA    DEBXTNRG,0(DEBREG)       GET DEB EXTENSION      @ZA12955 01298037
         SH    DEBXTNRG,XTNPTR          ADDRESS TO SEE IF      @ZA12955 01305037
         L     DEBXTNRG,0(DEBXTNRG)     THIS IS BDAM OR ISAM   @ZA12955 01312037
         USING DEBXTN,DEBXTNRG                                 @ZA12955 01319037
         TM    DEBXDSO1,DCBDSGDA        BDAM DATA SET?         @ZA12955 01326037
         BO    DOBDAM                   YES-GO DO IT           @ZA24838 01333037
         TM    DEBXDSO1,DCBDSGIS        ISAM DATA SET?         @ZA24838 01334037
         BO    FREEDBUF                 YES-SKIP ESTAE         @ZA24838 01335037
         B     ABEND                    NEITHER-ABEND          @ZA24838 01336037
         DROP  DEBXTNRG                                        @ZA12955 01340037
*********************************************************************** 01350002
*                      BDAM ENTRY                                     * 01352002
*********************************************************************** 01354002
*                        DETERMINE REASON FOR ENTRY                     01360037
DOBDAM   L     DEBAVTRG,DEBAPPAD        LOAD PTR TO AVT        @ZA24838 01460037
         USING  DEBAVT,DEBAVTRG         ESTABLISH BASE FOR AVT   A30797 01480002
         L     EPREG,DEBSIOA            SAVE ADDR TO SIO APPEND  Y02072 01500002
         DROP  DEBAVTRG                                          A30797 01520002
         BAL   SUBRTREG,FREELOCK        BRANCH TO FREE LOCK AND  Y02072 01530002
*                                       MODESET TO USER KEY      Y02072 01532002
         BAL   RETREG,DYNBUF(EPREG)     BR TO SIO APPEND TO FREE A30797 01540021
*                                       BUFFER                   A30797 01560002
         L     RETREG,WKASVC14          LOAD RET ADDR TO SVCIH   Y02072 01562002
         BR    RETREG                   RETURN TO CALLER         Y02072 01564002
*                                                                       01580002
*********************************************************************** 01590002
*                       ISAM ENTRY                                    * 01592002
*********************************************************************** 01594002
FREEDBUF LR    PARREG3,DECBREG          PUT DECB ADDRESS INTO PARM REG  01600002
         L     DEBEXREG,DEBEXPT         LOAD ADDR OF DEB EXT     A30797 01608002
         USING DEBACSMD,DEBEXREG        ESTABLISH BASE FOR EXT   A30797 01616002
         L     EPREG,DEBFREED           DYN BUFR POINTER         S21045 01624002
         DROP  DEBEXREG                                          S21045 01632002
         BAL   SUBRTREG,FREELOCK        BRANCH TO FREE LOCK AND  Y02072 01634002
*                                       MODESET TO USER KEY      Y02072 01636002
         BALR  RETREG,EPREG             ROUTINE AND BRANCH TO IT.       01640002
         SPACE 3                                                        01646002
RETURN   EQU   *                        RETURN TO CALLER         A30797 01652002
         SR    EPREG,EPREG              GIVE RETURN CODE=0              01660002
         L     RETREG,WKASVC14          LOAD RET ADDR TO SVCIH   Y02072 01670002
         BR    RETREG                   RETURN TO CALLER         Y02072 01672002
         SPACE 3                                                        01682002
*********************************************************************** 01682402
*  THE FOLLOWING ROUTINE RECEIVES CONTROL JUST BEFORE THE BRANCH IS   * 01682802
*  MADE TO THE DYNAMIC BUFFERING MODULE. THE LOCAL LOCK IS RELEASED.  * 01683202
*********************************************************************** 01683702
FREELOCK EQU   *                        FREE LOCAL LOCK          Y02072 01683802
*                                                                       01683902
         SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('DEBFLDS,IGC0005G(GETLOCKX01684002
               )')                      RELEASE THE LOCAL LOCK   Y02072 01684102
*                                                                       01684302
         BR    SUBRTREG                 RETURN TO MAIN ROUTINE   Y02072 01687002
         SPACE 3                                                        01687102
*********************************************************************** 01687302
*   THE FOLLOWING ROUTINE ABENDS THE CALLER OF THE SVC IF THE DEB IS  * 01687602
*   FOUND TO BE INVALID.  THE LOCAL LOCK MUST BE RELEASED AND THE     * 01687902
*   ESTAE SET UP BY THIS SVC MUST BE REMOVED FROM THE QUEUE.          * 01688202
*********************************************************************** 01688502
ABEND    EQU   *                        ABEND 339 - DEB INVALID  Y02072 01688802
*                                                                       01689102
ABNFREE  SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('DEBFLDS,IGC0005G(GETLOCKX01689502
               )')                      RELEASE THE LOCAL LOCK   Y02072 01689602
*                                                                       01689702
         ESTAE 0                        REMOVE THE ESTAE         Y02072 01690002
         LA    PARREG2,X'339'           LOAD ABEND CODE          Y02072 01690402
         ABEND (1),DUMP,,SYSTEM         ABEND 339-BAD DEB        Y02072 01690802
*********************************************************************** 01691202
         EJECT                                                          01691602
*********************************************************************** 01692002
*  THE FOLLOWING IS THE ESTAE EXIT ROUTINE, ENTERED BY RTM IF AN      * 01692402
*  ABEND SHOULD OCCUR AT THIS RB LEVEL DURING FREEDBUF PROCESSING.    * 01692802
*  THIS ROUTINE FINDS THE ADDRESS OF THE FREEDBUF ESTAE ROUTINE,      * 01693202
*  IGCT005G, IN THE LPALIB AND BRANCHES TO IT.  THE ROUTINE ISSUES    * 01693602
*  THE MACRO, IGGSTAE, WHICH USES THE CONTENTS SUPERVISOR ROUTINE,    * 01694002
*  IEAVVMSR. THE ROUTINE IS ENTERED IN SUPERVISOR STATE AND SUPER-    * 01694402
*  VISOR KEY WITH THE LOCAL LOCK HELD.                                * 01694802
*********************************************************************** 01695202
*                                                                       01695602
EXITRTN  IGGSTAE  ESTAEID               FIND ADDRESS OF ESTAE    Y02072 01696002
*                                                                       01700202
         EJECT                                                          01702202
*********************************************************************** 01708802
*                        EQUATES                                      * 01717102
*********************************************************************** 01725402
EXIT     EQU   3                        SVC 3 TO EXIT                   01733702
DYNBUF   EQU   8                        OFFSET IN DYN BUF RTNS FOR      01742002
*                                       ENTRY FROM FREEDBUF             01744002
MASK     EQU   B'0111'                  MASK TO COMPARE LOW-     Y02072 01744402
*                                       ORDER 3 BYTES OF REG     Y02072 01744802
*********************************************************************** 01746002
*                       CONSTANTS                                     * 01748802
*********************************************************************** 01749202
         DS    0D                                                       01753602
ESTAEID  DC    CL8'IGCT005G'            ESTAE RTN ID TO LOCATE   Y02072 01753702
         SPACE                                                          01756102
ELIST    ESTAE  EXITRTN,RECORD=YES,MF=L  LIST FORM OF ESTAE MAC  Y02072 01759202
ESTAELEN EQU   *-ELIST                  LENGTH OF LIST FORM      Y02072 01761602
XTNPTR   DC    H'8'                     DECREMENT FOR EXT PTR  @ZA12955 01763637
         SPACE                                                          01764137
PATCH    DC    32X'0'                   PATCH AREA             @ZA14605 01764337
MODID    DC    CL8'IGC0005G'            SVC ID                   A30797 01764637
DATE     DC    CL8'&SYSDATE'            LAST SHIP DATE         @ZA08000 01765137
FIX      DC    CL8'@OZ31948'            LAST FIX               @ZA08000 01765637
        EJECT                                                           01766402
*********************************************************************** 01768802
*                           DSECTS                                    * 01771202
*********************************************************************** 01773602
         IHASDWA                                                 Y02072 01776002
         EJECT                                                          01778002
         IHAPSA                                                  Y02072 01778102
         EJECT                                                          01778402
         DCBD  DSORG=(IS,DA)                                            01780802
         EJECT                                                          01783202
         CVT   DSECT=YES                                         Y02072 01785202
         EJECT                                                          01785302
         IKJTCB                                                  Y02072 01785602
         EJECT                                                          01788002
         IHADECB                                                        01790402
         EJECT                                                          01792802
         IEZDEB                                                         01795202
         EJECT                                                          01797602
         IKJRB                                                   Y02072 01800002
         IGGFRWKA                                                Y02072 01810402
         END                                                            01820000
./  ADD  SSI=72350440,NAME=IGG019BR
         TITLE 'IGG019BR-WRITE RTN, BDAM VRE, LOAD MOAD'         20201  00030020
IGG019BR CSECT                                                          00061019
*MODULE NAME = IGG019BR                                               * 00061402
*                                                                     * 00061802
*DESCRIPTIVE NAME = BDAM CREATE WRITE, VARIABLE SPANNED FORMAT        * 00061902
*                                                                     * 00064202
*COPYRIGHT = NONE                                                     * 00066202
*                                                                     * 00068202
*CHANGE ACTIVITY                                                      * 00070202
*                                                                     * 00072302
*        RELEASE 20 CHANGES/DELETIONS                                   00079202
*0961091200,205800,263400-264000,265800,270000-277200,298200-    20201  00081502
*0961298800,451800-456600,464400,466800,657000,675000-675600,    20201  00083802
*0961711600,741000                                               20201  00086102
*                                                                A29270 00088402
*0961438000                                                      A33103 00090702
*        RELEASE 21 CHANGES/DELETIONS                                   00092702
*D088800,093700-094800                                          SA50661 00092802
*        VS1-1 CHANGES/DELETIONS                                        00092902
*        VS2-1 CHANGES/DELETIONS                                        00093202
*        VS1-2 CHANGES/DELETIONS                                        00093602
*        VS2-2 CHANGES/DELETIONS                                        00093702
*046800-047400                                                   Y02072 00093802
*                                                                YM1171 00093902
*680400,749400                                                   YM3849 00096702
*                                                                YM2865 00098702
*375660-375690,708060-708090                                     YM7542 00100702
*        VS2-4CHANGES/DELETIONS                                         00101737
*D541860-541920,A541801-541810,A865210-865220,A045610           ZM40313 00102737
*A706800,761000                                                 ZA10211 00105237
*D706800,C167400,C169500,A028200,A030000,A167700-168300        @ZA15097 00106137
*A733870-734290                                                @ZA15097 00107037
*STATUS CHANGE LEVEL 004                                                00108002
*                                                                       00110802
*FUNCTIONS - THIS WRITE ROUTINE IS LOAD AT OPEN TIME IF DCB SPECIFIES,  00113602
*            MACRF=(WL),DSORG=PS,RECFM=VS,BFTEK=R AND DD CARD SPECIFIES 00116402
*            DSORG=DA                                                   00119202
*            IT OPERATES AS FOLLOWS                                     00122002
*           *WRITE-SF REQUST                                            00124802
*               IF THE RECORD FIT ON THE TRACK,THE ROUTINE DETERMINES   00127602
*              TRACK BALANCE.IF TRACK BALANCE IS LESS THAN 9,IT CONST-  00130402
*              RUCT CHANNEL PROGRAM TO UPDATE R0.IT THEN ISSUES EXCP.   00133202
*                                                                       00136002
*              IF THE RECORD DOES NOT FIT ON THE TRACK,AND DOES FIT     00138802
*              ON THE CURRENT EXTENT,THE ROUTINE CONSTRUCT CHANNEL      00141602
*              PROGRAM TO WRITE 1ST SEGMENT AND R0 OF THE TRACK (THE    00144402
*              SUCCESSIVE SEGMENTS WILL BE WRITTEN BY A.S.I. ROUTINE)   00147202
*                                                                       00150002
*              IF THE RECORD DOES NOT FIT ON THE CURRENT EXTENT,THE     00152802
*              ROUTINE WILL CONSTRUCT CHANNEL PROGRAM TO WRITE R0 OF    00155602
*              THE TRACK.THE R0 OF THE REST OF TRACKS IN CURRENT EXTENT 00158402
*              WILL BE WRITTEN BY A.S.I. ROUTINE.AFTER THE SECONDARY    00161202
*              SPACE ALLOCATION,THE RECORD WILL BE WRITTEN ON THE NEW   00164002
*              VOLUME IF THE ALLOCATION IS ON THE NEW VOLUME. IF IT IS  00166802
*              ON THE SAME VOLUME,THE RECORD WILL BE RE-WRITTEN SPANN-  00169602
*              ING EXTENTS.                                             00172402
*                                                                       00175202
*           *WRITE REQUEST                                              00178002
*              THE ROUTINE CONSTRUCT CHANNEL PROGRAM TO WRITE R0 .      00180802
*                                                                       00183602
*                                                                       00186402
*           *ASYCHROUNOUS EXIT ROUTINE                                  00189202
*              THE ROUTINE RECEIVES CONTROL FROM THE CHANNEL END APP.   00192002
*              THROUGH EXIT EFFECTOR WHEN A SPANNED RECORD IS TO BE     00194802
*              PROCESSED.                                               00197602
*                                                                       00200402
*              WHEN THE RECORD IS A SPANNED RECORD IT CONSTRUCTS A      00203202
*              SEGMENT FROM THE REMAINING PART OF THE RECORD AND ISSUES 00206002
*              EXCP TO WRITE THE SEGMENT.                               00208802
*                                                                       00211602
*              WHEN THE RECORD IS A SPANNED VOLUME RECORD,IT ISSUES     00214402
*              EXCP TO THE WRITE R0 FOR THE REST OF EXTENT              00217202
*                                                                       00220002
*                                                                       00222802
*ENTRY POINTS- 'WRTENTRY' IS THE NORMAL ENTRY POINT FROM THE WRITE      00225602
*    MACRO EXPANSION. CALLING SEQUENCE IS     L     15,DCBWRITE         00228402
*                                             BALR  14,15               00231202
*                                                                       00234002
*    'EOVENTRY' IS THE ENTRY FROM THE BSAM END-OF-VOLUME EXECUTOR TO    00236802
*    RESTART A WRITE WHICH WAS ISSUED AFTER THE CURRENT SPACE           00239602
*     ALLOCATION WAS FILLED. THE RECORD WILL NOW BE WRITTEN INTO THE    00242402
*    SPACE OBTAINED AS SECONDARY ALLOCATION. CALLING SEQUENCE IS        00245202
*                                              L    15,DCBWRITE         00248002
*                                              BAL  14,4(15)            00250802
*   'ASYENTRY' IS THE ENTRY FROM EXIT EFFECTOR TO SCHEDULE EXCP ON THE  00253602
*   SUCCESSIVE SEGMENTS.                                                00256402
*INPUT- TO 'WRTENTRY'- DECB ADDRESS IN REGISTER 1                       00259202
*       TO 'EOVENTRY'- IOB ADDRESS IN REGISTER 3                        00262002
*                      DCB ADDRESS IN REGISTER 2                        00264802
*                      DEB ADDRESS IN REGISTER 5                        00267602
*                                                                       00270402
*OUTPUT- AN IOB FROM THE POOL OF IOBS WILL BE ASSIGNED TO THIS DECB     00273202
*    AND ITS ADDRESS PLACED IN THE DECB, EXCP WILL BE ISSUED TO         00276002
*    SCHEDULE THIS WRITE.                                               00278802
*                                                                       00281602
*       TO - 'ASYENTRY' - RQE ADDRESS IN REGISTER 1                     00284402
*                                                                       00287202
*EXTERNAL ROUTINES-                                                     00290002
*                                                                       00292802
*EXITS- 'RETURN' IS AN EXIT BACK TO THE USER, REGISTER 15 WILL CONTAIN  00295602
*    A RETURN CODE AS FOLLOWS,                                          00298402
*        0 = RECORD WAS WRITTEN, THERE IS MORE SPACE ON THE TRACK       00301202
*        4 = RECORD NOT WRITTEN, THE TRACK IS FILLED, TYPE SZ SHOULD BE 00304002
*            ISSUED AND THEN THE TYPE SF MAY BE REISSUED.               00306802
*        8 = RECORD WAS WRITTEN, DATA SET IS FILLED                     00309602
*        12= RECORD NOT WRITTEN, NO IOB IS AVAILABLE UNTIL 'CHECK' HAS  00312402
*            BEEN ISSUED.                                               00315202
*    'EOVEXIT' IS A RETURN TO THE END-OF-VOLUME EXECUTOR.               00318002
*                                                                       00320802
*     'ASYENTRY' IS AN EXIT TO EXIT EFFECTOR.                           00323602
*                                                                       00326402
*TABLES  1. DIRECT ACCESS DEVICE TABLE IS USED TO CALCULATE THE BYTES   00329202
*           OF OVERHEAD FOR THIS RECORD AND TO DETERMINE THE NEXT       00332002
*           VALID TRACK ADDRESS AND TRACK LENGTH.                       00334802
*                                                                       00337602
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.            00340402
*                                                                       00343202
*NOTES- THE REGISTER USAGE IN THIS MODULE AND THE BSAM END-OF-VOLUME    00346002
*    EXECUTOR MUST REMAIN CONSISTENT.                                   00348802
*                                                                       00351602
*********************************************************************** 00354402
*                                                                       00357202
*   REGISTER CONVENTIONS                                                00360021
*                                                                       00420019
*********************************************************************** 00480019
*                                                                       00540019
WKREG    EQU   0                   WORK REGISTER                        00600019
PARAM1   EQU   1                   PARAMETER REGISTER                   00660019
DECBREG  EQU   1                   DECB ADDRESS                         00720019
INDEXR   EQU   1                   INDEX REG. USED IN NEXTCCHH RTN      00780019
DCBREG   EQU   2                   DCB ADDRESS                          00840019
CCHHRG   EQU   2                   CCHH REG USED IN NEXTCCHH RTN        00900019
IOBREG   EQU   3                   IOB ADDRESS                          00960019
EOVRTRN  EQU   4                   EOV RETURN ADDRESS                   01020019
DEBREG   EQU   5                   DEB ADDRESS                          01080019
WKREG6   EQU   6                   WORK REGISTER                        01140019
WKREG7   EQU   7                   WORK REGISTER                        01200019
WKREG8   EQU   8                   WORK REGISTER                        01260019
WKREG9   EQU   9                   WORK REGISTER                        01320019
WKREG10  EQU   10                  WORK REGISTER                        01380019
WKREG11  EQU   11                  WORK REGISTER                        01440019
BASEREG  EQU   12                  BASE REGISTER                        01500019
SAVEREG  EQU   13                  USER'S SAVE AREA                     01560019
RETREG   EQU   14                  RETURN ADDRESS WHEN ENTERED          01620019
EPREG    EQU   15                  ENTRY POINT.                         01680019
*                                                                       01740019
*********************************************************************** 01800019
*                                                                       01980019
*********************************************************************** 02040019
*                                                                       02100019
*   EQUATES AND MASKS                                                   02160019
*                                                                       02220019
*********************************************************************** 02280019
*                                                                       02340019
TBOVHD   EQU   X'08'                    2305 MASK FOR DEV TABL   20201  02360020
SETSECT  EQU   X'23'                    SET SECTOR CCW           20201  02380020
OFFSDW   EQU   4                   OFFSET TO SEGMENT DESCRIPTOR WORD    02400019
OFFLAGBT EQU   2                   OFFSET TO FLAG BYTE IN SEG.DES. WORD 02460019
*                                                                       02520019
RTNCD0C  EQU   X'0C'               RETURN CODE = 0C                     02580019
RTNCD00  EQU   X'00'               RETURN CODE = 00                     02640019
RTNCD04  EQU   X'04'               RETURN CODE = 04                     02700019
RTNCD08  EQU   X'08'               RETURN CODE = 08                     02760019
NXT      EQU   X'08'               NEXT TRACK FOR NEXT WRITE   @ZA15097 02820037
WZEROBIT EQU   X'40'               PREVIOUS WRITE WAS WRITE-R0          02880037
VOLFULL  EQU   X'20'               VOLUME IS FULL                       02940037
NXTOFF   EQU   X'F7'               MASK TO TURN OFF NXT        @ZA15097 03000037
SEVEN    EQU   7                   CONSTANT '7'                         03060019
NULL     EQU   0                   CONSTANT '0'                         03120019
MSKFF    EQU   X'FF'               CONSTANT 'FF'                        03180019
NOSCHDL  EQU   X'80'               SET IOB IS NOT SCHEDULED             03240019
EIGHT    EQU   8                   CONSTANT '8'                         03300019
ONE      EQU   1                   CONSTANT '1'                         03360019
FIVE     EQU   5                   CONSTANT '5'                         03420019
THREE    EQU   3                   CONSTANT '3'                         03480019
SIX      EQU   6                   CONSTANT '6'                         03540019
SPANBIT  EQU   X'04'               RECORD IS SPANNED                    03600019
WRTCHK   EQU   X'80'               DCB OPTCD=WRITE CHECK                03660019
CCHAIN   EQU   X'40'               COMMAND CHAINNING                    03720019
FOUR     EQU   4                   CONSTANT '4'                         03780019
ONEMIX   EQU   X'07'               CONDITION CODE = NOT ZERO            03840019
WRITESZ  EQU   X'04'               TYPE=SZ                              03900019
NINE     EQU   9                   CONSTANT '9'                         03960019
TWO      EQU   2                   CONSTANT '2'                         04020019
ECBPTR   EQU   12                  OFFSET IN IOB TO ECB                 04080019
COMPLETE EQU   X'7F'               ECB COMPLETE CODE                    04140019
ZEROMIXD EQU   5                   CONDITION CODE = 5                   04200019
ERASEOFF EQU   44                  OFFSET TO ERASE CCW                  04260019
SIXTEEN  EQU   16                  CONSTANT '16'                        04320019
EOVBIT   EQU   X'80'               EOV BIT IN IOB                       04380019
FRSTSEG  EQU   X'01'               FLAG = 1ST SEGMENT                   04440019
MDLSEG   EQU   X'03'               FLAG = MIDDLE SEGMENT                04500019
ENDSEG   EQU   X'02'               FLAG = LAST SEGMENT                  04560019
DEBBASE  EQU   X'20'               DEB BASIC SECTION LENGTH     ZM40313 04590037
*                                                                       04620019
FSTENTRY EQU   X'FF'               1ST ENTRY FROM EOV                   04800019
IOBDCB   EQU   20                  OFFSET TO DCB FROM IOS/IOB           04860019
*                                                                       04920019
*********************************************************************** 04980019
*                                                                       05040019
*                                                                       05160019
*                                                                       05220019
*********************************************************************** 05280019
*                                                                       05340019
*   INITIALIZE REGISTERS                                                05400019
*                                                                       05460019
*********************************************************************** 05520019
*                                                                       05580019
         USING IGG019BR,EPREG      ESTABLISH ENTRY POINT                05640019
         USING IHADCB,DCBREG       ESTABLISH DCB REGISTER               05700019
         USING IOBDEF,IOBREG       ESTABLISH IOB REGISTER               05760019
         USING DEB,DEBREG          ESTABLISH DEB REGISTER               05820019
         USING DECBDEF,DECBREG     ESTABLISH DECB REGISTER              05880019
*                                                                       05940019
*********************************************************************** 06000019
*                                                                       06060019
WRTENTRY EQU   *                                                        06120019
*                                                                       06180019
*********************************************************************** 06240019
*                                                                       06300019
*   NORMAL ENTRY FROM 'WRITE' MACRO EXPANSION                           06360019
*                                                                       06420019
*********************************************************************** 06480019
*                                                                       06540019
         B     GOGOGO              GOTO BEGINNING OF 'WRITE' CODE       06600019
*                                                                       06660019
         DROP  EPREG               DROP ENTRY REG AND                   06720019
         USING IGG019BR,BASEREG    RE-ESTABLISH BASE                    06780019
*                                                                       06840019
*********************************************************************** 06900019
*                                                                       06960019
*   ENTRY FROM EOV EXECUTOR - IFG0551L                                  07020002
*                                                                       07080019
*********************************************************************** 07140019
*                                                                       07200019
         B     EIGHT(EPREG)        GOTO EOV ENTRY                       07260019
*                                                                       07320019
*********************************************************************** 07380019
*                                                                       07440019
ASYPTR   DC    A(ASYENTRY)              OFFSET TO ASYNCHRONOUS   Y02072 07500002
*                                       ROUTINE ENTRY                   07560019
*                                                                       07620019
*********************************************************************** 07680019
*                                                                       07740019
*********************************************************************** 07800019
*                                                                       07860019
EOVENTRY EQU   *                                                        07920019
*                                                                       07980019
*********************************************************************** 08040019
*                                                                       08100019
*   EOV ENTRY FROM IFG0551L TO SCHEDULE ALL REQUESTS ON SECONDARY       08160002
*   ALLOCATION                                                          08220019
*      1.IF SECONDARY ALLOCATION IS ON THE SAME VOLUME,THE SPANNED      08280019
*        RECORD WILL BE RE-WRITTEN SPANNING THE PREVIOUS EXTENT TO THE  08340019
*        SECONDARY ALLOCATION.                                          08400019
*      2.IF IT IS ON THE DIFFERENT VOLUME, THE SPANNED RECORD WILL BE   08460002
*        WRITTEN ON THE NEW VOLUME                                      08520019
*                                                                       08580019
*********************************************************************** 08640019
*                                                                       08700019
         L     DECBREG,IOBECBPT    LOAD DECB ADDR                       08760019
         L     BASEREG,DCBWRITE    SET BASE REGISTER                    08820019
         NI    IOBLINK,MSKFF-SPANBIT   RESET 'SPANNED' BIT              08940019
         OI    IOBLINK,NOSCHDL     SET ENTRY IS FROM EOV                09000019
*                                                                       09060019
         SR    EPREG,EPREG              ZERO OUT A REGISTER      20201  09090020
         IC    EPREG,DCBOFFSW           GET OFFSET TO WRT CCW    20201  09120020
         L     EPREG,NULL(EPREG,IOBREG) LOAD ADDR OF S.W.A.      20201  09150020
         SH    EPREG,CONST10       POINT TO THE BEGINNING OG SWA        09180019
*                                                                       09240019
         USING SGWKAREA,EPREG      ESTABLISH BASE FOR SWA               09300019
         USING EOVLAST,EOVRTRN     551L PASSES THE EOV WORKAREA  Y02072 09350002
*                                  IN R4-ESTABLISH BASE          Y02072 09352002
*                                                                       09360019
         CLI   EOVENT1,FSTENTRY    TEST IF 1ST ENTRY FROM EOV    Y02072 09370002
         BNE   TESTR01             NO,GOTO TEST TYPE OF         SA50661 09380021
*                                  PREVIOUS ENTRY               SA50661 09382021
         CLI   EOVVOLSW+3,ONE      TEST IF ALLOCATION WAS ON     YM1171 09420002
*                                  THE SAME VOLUME              SA50661 09480002
         DROP  EOVRTRN             DROP EOV WORKAREA BASE        Y02072 09490002
         LR    EOVRTRN,RETREG      SAVE EOV RETURN IN R4        SA50661 09530002
         BE    SAMEVOL             YES,GOTO SAME VOLUME                 09540019
*                                                                       09600019
*   WHEN ALLOCATION WAS ON THE DIFFERENT VOLUME THE MASTER 'TT' IN SWA  09660002
*   C.B. HAS TO BE UPDATED AND THE RECORD WILL BE WRITTEN ON THE        09720019
*   NEW VOLUME                                                          09780019
*                                                                       09840019
         L     WKREG7,DCBEOBW      LOAD ADDR OF SWA. C.B.               09900019
         USING SWACB,WKREG7        ESTABLISH BASE FOR SWA C.B.          09960019
*                                                                       10020019
         LH    RETREG,SWACBTT      LOAD VOLUME 'TT' OF PREVIOUS VOLUME  10080019
         AH    RETREG,SWACBTT+TWO  ADD MASTER 'TT' AND VOLUME 'TT'      10140019
         STH   RETREG,SWACBTT+TWO  STORE IT AS NEW MASTER 'TT'          10200019
         OI    DCBCIND2,WZEROBIT   SET PREVIOUS WRITE WAS 'SZ' BIT      10260019
         DROP  WKREG7              DROP BASE FOR SWACB                  10320019
*                                                                       10560019
         NI    SGWKFLAG,MSKFF-SPANVLM   RESET SPANNED VOLUME BIT        10590019
         B     TSTTYPE             GOTO TEST IF TYPE IS 'SF' OR 'SZ'    10620019
TESTR01  LR    EOVRTRN,RETREG      SAVE EOV RETURN IN R4        SA50661 10670021
         B     TESTR0                                           SA50661 10672021
*                                                                       10680019
SAMEVOL  EQU   *                                                        10740019
*                                                                       10800019
*   WHEN ALLOCATION WAS ON THE SAME VOLUME THE MBBCCHHR AND TRACK       10860019
*   BALANCE OF THE PREVIOUS RECORD ARE TO BE RESTORED IN THE DCB.       10920019
*                                                                       10980019
         TM    SGWKFLAG,SPANVLM    TEST IF SPAN VOLUME IS ON            11040019
         BNO   SETR0BIT            NO,GOTO SET WRITE/R0 BIT 'ON'        11100019
*                                                                       11160019
         MVC   DCBFDAD,SGWKDATA    MOVE MBBCCHHR OF PREVIOUS RECORD     11220019
         MVC   DCBTRBAL(TWO),IOBDNRCF  MOVE TRACK BALANCE               11280019
         NI    SGWKFLAG,MSKFF-SPANVLM   RESET SPANNED VOLUME BIT        11310019
         B     TSTTYPE             GOTO TEST REQUEST TYPE               11340019
*                                                                       11400019
SETR0BIT EQU   *                                                        11460019
*                                                                       11520019
         OI    DCBCIND2,WZEROBIT   SET PREVIOUS WRITE WAS 'SZ' 'ON'     11820019
         B     TSTTYPE             GOTO TEST TYPE IS 'SF' OR 'SZ        11880019
*                                                                       11940019
*********************************************************************** 12000019
*                                                                       12060019
GOGOGO   EQU   *                                                        12120019
*                                                                       12180019
         SAVE  (14,12)             SAVE USER'S REGISTERS                12240019
*                                                                       12300019
         L     DCBREG,DECDCBAD     LOAD DCB ADDR FROM DECB              12360019
         L     DEBREG,DCBDEBAD     LOAD DEB ADDR FROM DCB               12420019
         LR    BASEREG,EPREG       MOVE ENTRY POINT TO BASE REG.        12480019
*                                                                       12540019
*********************************************************************** 12600019
*                                                                       12660019
*   TEST IF THE CURRENT IOB OR THE NEXT IOB AVAILABLE                   12720019
*        YES - PROCEED                                                  12780019
*        NO - RETURN WITH CODE=12                                       12840019
*                                                                       12900019
*********************************************************************** 12960019
*                                                                       13020019
         L     IOBREG,DCBIOBA      LOAD ADDR OF NEXT IOB                13080019
*                                                                       13140019
         TS    IOBIOBA             TEST IF THE CURRENT IOB IS AVAILABLE 13200019
         BZ    USEIOB              YES,PROCEED TO NEXT ROUTINE          13260019
*                                                                       13320019
*   GET TO NEXT IOB AND EXAMINE IT                                      13380019
*                                                                       13440019
         L     IOBREG,IOBLINK      LOAD NEXT IOB ADDR                   13500019
*                                                                       13560019
         TS    IOBIOBA             TEST IF THE IOB IS AVAILABLE         13620019
         BZ    USEIOB              YES,PROCEED TO NEXT ROUTINE          13680019
*                                                                       13740019
*********************************************************************** 13800019
*                                                                       13860019
*   WHEN THE CURRENT IOB AND THE NEXT IOB IS NOT AVAILABLE,RETURN TO    13920019
*   USER WITH CODE=0C                                                   13980019
*       'BLOCK WILL NOT BE WRITTEN.ISSUE A CHECK MACRO INSTRUCTION      14040019
*        FOR PREVIOUS WRITE MACRO INSTRUCTION,THEN RE-ISSUE'            14100019
*                                                                       14160019
*********************************************************************** 14220019
*                                                                       14280019
         LA    EPREG,RTNCD0C       LOAD RETURN CODE = 0C                14340019
*                                                                       14400019
RETURN   EQU   *                                                        14460019
*                                                                       14520019
         RETURN (14,12),RC=(15)    RETURN TO THE USER                   14580019
*                                                                       14640019
*********************************************************************** 14700019
*                                                                       14760019
USEIOB   EQU   *                                                        14820019
*                                                                       14880019
         LA    IOBREG,NULL(IOBREG)  CLEAR 1ST BYTES                     14940019
         ST    IOBREG,DCBIOBA      STORE CURRENT IOB ADDR IN DCB        15000019
         LA    WKREG,IOBFLAG1      LOAD  ADDR OF IOB FOR EXCP AND       15060019
         ST    WKREG,DECIOBPT      STORE IT IN DECB                     15120019
         ST    DECBREG,IOBECBPT    STORE DECB ADDR IN IOB               15180019
*                                                                       15240019
*********************************************************************** 15300019
*                                                                       15360019
*   THIS ROUTINE WILL CHECK IF VOLUME FULL CONDITION EXITS              15420019
*        YES - GOTO NORMAL RETURN                                       15480019
*        NO  - PROCEED TO NEXT ROUTINE                                  15540019
*                                                                       15600019
*********************************************************************** 15660019
*                                                                       15720019
         TM    DCBCIND1,VOLFULL    TEST IF VOLUME FULL IS 'ON'          15780019
         BO    NOSCHRTN            GOTO NORMAL RETURN                   15840019
*                                                                       15900019
*********************************************************************** 15960019
*                                                                       16020019
TESTR0   EQU   *                                                        16080019
*                                                                       16140019
*********************************************************************** 16200019
*                                                                       16260019
*   TEST IF PREVIOUS WRITE WAS WRITE/R0                                 16320019
*       YES - GOTO GET NEXT CCHH                                        16380019
*       NO -  PROCEED TO NEXT ROUTINE                                   16440019
*                                                                       16500019
*********************************************************************** 16560019
*                                                                       16620019
         TM    DCBCIND2,WZEROBIT   TEST IF PREVIOUS REQUEST WAS W/R0    16680019
         BO    GETNEXT             YES - GET NEXT TRK          @ZA15097 16740037
         TM    DCBCIND1,NXT        NEED NEXT TRK?              @ZA15097 16770037
         BZ    TSTTYPE             NO - BRANCH                 @ZA15097 16800037
         NI    DCBCIND1,NXTOFF     YES - TURN OFF IND          @ZA15097 16830037
*                                                                       16860037
*   GOTO CALCULATE NEXT CCHH ROUTINE                                    16890037
*                                                                       16920037
GETNEXT  MVC   IOBR0DAT,DCBFDAD    MBBCCHHR TO IOB WRK AREA    @ZA15097 16950037
*                                                                       17040019
         BAL   WKREG11,NEXTCCHH    GOTO CALCULATE NEXT CCHH ROUTINE     17100019
*                                                                       17160019
*   TEST DCBIND1 FOR 'VOLUME FULL' CONDITION                            17220019
*                                                                       17280019
         TM    DCBCIND1,VOLFULL    TEST IF VOLUME FULL BIT IS 'ON'      17340019
         BNO   MOVECCHH            NO,GOTO UPDATE CCHH                  17400019
*                                                                       17460019
*********************************************************************** 17520019
*                                                                       17580019
*   WHEN 'VOLUME FULL' IS ON THE IOB IS MARKED NON-SCHEDULED SO THAT    17640019
*   THIS REQUEST WILL BE SCHEDULED AT EOV TIME. THE RETURN CODE=0 IS    17700019
*   RETURNED TO THE USER                                                17760019
*                                                                       17820019
*********************************************************************** 17880019
*                                                                       17940019
         TM    IOBLINK,EOVBIT      TEST IF ENTRY IS FROM EOV            18000019
         BNO   NOSCHRTN            NO,GOTO SET NON-SCHDL BIT            18060019
*                                                                       18120019
         BR    EOVRTRN             YES,GO BACK TO EOV ROUTINE           18180019
*                                                                       18240019
NOSCHRTN EQU   *                                                        18300019
*                                                                       18360019
         OI    IOBLINK,NOSCHDL     SET THIS IOB IS NOT SCHEDULED        18420019
*                                                                       18480019
NORMALRT EQU   *                                                        18540019
*                                                                       18600019
         SR    EPREG,EPREG         RESET REG.15 TO '0'                  18660019
*                                                                       18720019
         B     RETURN              GOTO RETURN                          18780019
*                                                                       18840019
*********************************************************************** 18900019
*                                                                       18960019
MOVECCHH EQU   *                                                        19020019
*                                                                       19080019
*   UPDATE DCBFDAD WITH NEW CCHH                                        19140019
*                                                                       19200019
         MVC   DCBFDAD,IOBR0DAT    MOVE NEW MBBCCHHR INTO DCBFDAD       19260019
*                                                                       19320019
*   RESET TRACK BALANCE TO MAXIMUM                                      19380019
*                                                                       19440019
         L     WKREG9,DCBDVTBL     LOAD DEVICE TABLE ADDR               19500019
         USING DASDTBL,WKREG9      ESTABLISH BASE FOR DEVICE TABLE      19560019
*                                                                       19620019
         MVC   DCBTRBAL,DASDLNGH   UPDATE TRACK CAPACITY                19680019
*                                                                       19740019
*********************************************************************** 19800019
*                                                                       19860019
TSTTYPE  EQU   *                                                        19920019
*                                                                       19980019
*********************************************************************** 20040019
*                                                                       20100019
*   TEST TYPE FIELD                                                     20160019
*        'SZ' - GOTO 'SZ ROUTINE'                                       20220019
*        'SF' - GOTO 'SF ROUTINE'                                       20280019
*                                                                       20340019
*********************************************************************** 20400019
*                                                                       20460019
         SR    RETREG,RETREG            ZERO OUT A REG           20201  20500020
         IC    RETREG,DCBOFFSW          GET OFFSET TO WRT CCW    20201  20540020
         L     RETREG,NULL(RETREG,IOBREG) GET ADDR OF SWA        20201  20580020
         SH    RETREG,CONST10      POINT TO THE BEGINNING OF S.W.A.     20640019
*                                                                       20700019
         DROP  EPREG               DROP BASE FOR S.W.A. FOR NEW         20760019
         USING SGWKAREA,RETREG     ESTABLISH BASE FOR S.W.A.            20820019
*                                                                       20880019
         TM    DECTYPE+ONE,WRITESZ TEST IF THIS IS A WRITE-SZ           20940019
         BO    WRTSZRTN            YES,GOTO WRITE-SZ ROUTINE            21000019
*                                                                       21060019
*                                                                       21120019
*********************************************************************** 21180019
*                                                                       21240019
*   WRITE-SF ROUTINE                                                    21300019
*                                                                       21360019
*********************************************************************** 21420019
*                                                                       21480019
TESTFIT  EQU   *                                                        21540019
*                                                                       21600019
*********************************************************************** 21660019
*                                                                       21720019
*   THIS ROUTINE TEST IF RECORD FITS ON THE TRACK                       21780019
*     NO - GOTO SPANNED RECORD ROUTINE                                  21840019
*     YES- IT EXAMINES IF THE RECORD IS THE LAST RECORD ON THE TRACK    21900019
*                                                                       21960019
*********************************************************************** 22020019
*                                                                       22080019
         L     WKREG7,DECAREA      LOAD RECORD AREA ADDR                22140019
*                                                                       22200019
         SR    WKREG8,WKREG8       RESET WKREG8 TO '0'                  22260019
         IC    WKREG8,DCBKEYLE     INSERT KEY LENGTH INTO REG.7         22320019
*                                                                       22380019
         SR    WKREG6,WKREG6       RESET REG.6 TO '0'                   22440019
         IC    WKREG6,NULL(WKREG8,WKREG7)    INSERT 1ST CHAR OF 'LL'    22500019
         SLL   WKREG6,EIGHT        MOVE 1ST CHAR OF 'LL' 1 POSITION     22560019
         IC    WKREG6,ONE(WKREG8,WKREG7)     INSERT 2ND CHAR OF 'LL'    22620019
         LA    WKREG10,NULL(WKREG8,WKREG7)  OBTAIN ADDR OF 'LL'         22680019
         ST    WKREG10,SGWKRCRD    STORE ADDR OF 'LL' INTO RECORD ADDR  22740019
         STH   WKREG6,SGWKOFF      STORE 'LL' INTO OFFSET               22800019
         STH   WKREG6,IOBDNRCF+TWO STORE 'LL' INTO SAVE AREA            22860019
         STH   WKREG8,IOBDNRCF     STORE KEYLEN IN SAVE AREA            22920019
*                                                                       22980019
         AR    WKREG6,WKREG8       ADD DATA LENGTH=KEY + BLKSIZE        23040019
*                                                                       23100019
         BAL   WKREG11,OVERHEAD    GOTO CALCULATE OVERHEAD              23160019
*                                                                       23220019
*   AFTER CALCULATION OF 'RECORD LENGTH PLUS OVERHEAD'.                 23280019
*        WKREG7 = SIZE OF INTERMEDIATE RECORD                           23340019
*        WKREG8 = SIZE OF LAST RECORD ON TRACK                          23400019
*                                                                       23460019
         CH    WKREG8,DCBTRBAL     DOES RECORD FIT AS THE LAST RECORD   23520019
         BH    SPANNED             NO,GOTO SPANNED RECORD ROUTINE       23580019
*                                                                       23640019
         LH    WKREG8,DCBTRBAL     GET TRACK BALANCE FROM DCB           23700019
         SR    WKREG8,WKREG7       NEW DCBTRBAL=(OLD - INTERMEDIATE)    23760019
         LTR   WKREG8,WKREG8       TEST IF TRACK BALANCE IS '-'         23820019
         BP    OKBAL               +,GOTO STORE BALANCE                 23880019
*                                                                       23940019
         SR    WKREG8,WKREG8       TRACK BALANCE=0                      24000019
*                                                                       24060019
OKBAL    EQU   *                                                        24120019
*                                                                       24180019
         STH   WKREG8,DCBTRBAL     STORE IT INTO DCBTRBAL               24240019
*                                                                       24300019
*********************************************************************** 24360019
*                                                                       24420019
*   NORMAL RECORD(NO RECORD SPANNING)                                   24480019
*        THE ROUTINE DETERMINES WHETHER THE RECORD IS THE LAST RECORD   24540019
*        ON THE TRACK (CAN TRACK HOLD MORE THAN 8 BYTES DATA FIELD)     24600019
*          YES - CCWS=WRITE/RN CHAINED TO WRITE/R0 OF THAT TRACK        24660019
*          NO  - CCWS=WRITE/RN                                          24720019
*                                                                       24780019
*********************************************************************** 24840019
*                                                                       24900019
         NI    IOBLINK,MSKFF-SPANBIT    RESET SPANNED BIT OFF           24960019
*                                                                       25020019
*   GOTO MOVE CHARACTER ROUTINE                                         25080019
*                                                                       25140019
         L     WKREG8,DECAREA      LOAD ADDR OF RECORD AREA             25200019
         BAL   WKREG11,MOVEDATA    GOTO MOVE DATA ROUTINE               25260019
*                                                                       25320019
         MVC   IOBSEEK,DCBFDAD     MOVE MBBCCHHR(N-1) TO SEEK FIELD     25380019
         SR    WKREG9,WKREG9       RESET TO '0'                         25440019
         IC    WKREG9,DCBFDAD+SEVEN INSERT 'R' OF MBBCCHHR              25500019
         LA    WKREG9,ONE(WKREG9)  INCREMENT 'R' TO 'R+1'               25560019
         STC   WKREG9,DCBFDAD+SEVEN STORE 'R+1' INTO DCBFDAD            25620019
*                                                                       25680019
         MVC   IOBDNRCF(FIVE),DCBFDAD+THREE  MOVE CURRENT CCHHR TO CNT  25740019
*                                                                       25800019
CCWGOGO  EQU   *                                                        25860019
*                                                                       25920019
         NI    DCBCIND2,MSKFF-WZEROBIT  SET WRITE/R0 BIT OFF            25980019
         SR    WKREG9,WKREG9       RESET WKREG9                         26040019
         IC    WKREG9,DCBKEYLE     INSERT KEY LENGTH                    26100019
         STC   WKREG9,IOBDNRCF+FIVE  INSERT KEY LENGTH INTO COUNT       26160019
         LA    WKREG8,SGWKDATA     LOAD ADDR OF DATA AREA               26220019
         AR    WKREG8,WKREG9       ADD KEY LENGTH TO DATA ADDR          26280019
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  26300020
         IC    WKREG11,DCBOFFSW         GET OFFSET TO WRT CCW    20201  26320020
         AR    WKREG11,IOBREG           PT TO WRT CCW            20201  26340020
         MVC   SIX(TWO,WKREG11),NULL(WKREG8) MOVE 'LL' TO WRT    20201  26360020
*                                       CCW                      20201  26380020
         LH    WKREG8,SIX(WKREG11)      LOAD 'LL' INTO REG       20201  26400020
         STH   WKREG8,IOBDNRCF+SIX  STORE 'LL' INTO COUNT FIELD         26460019
         AR    WKREG8,WKREG9       ADD 'LL' + 'K6'=DATA LENGTH          26520019
         STH   WKREG8,SIX(WKREG11)      ST IT IN WRT DATA CCW    20201  26580020
*                                                                       26640019
         LA    EPREG,IOBCCW1       LOAD ADDR OF FIRST CCW               26700019
         ST    EPREG,IOBSTART      SET CCW PTR TO WRITE/RN              26760019
*                                                                       26820019
*   OBTAIN OFFSET TO WRITE/R0 CCWS                                      26880019
*                                                                       26940019
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  27040020
         IC    WKREG11,DCBWCPO          GET OFFSET TO WRT/R0     20201  27140020
*                                       C.P.                     20201  27240020
         AR    WKREG11,IOBREG           POINT TO IT              20201  27340020
         SH    WKREG11,CONST8           PT TO PRECEEDING CCW     20201  27440020
*                                                                       27780019
CHKTRBAL EQU   *                                                        27840019
*                                                                       27900019
*   TEST IF SPANNED RECORD                                              27960019
*        YES - WRITE/R0 IS REQUIRED                                     28020019
*        NO  - CHECK IF WRITE0R0 IS REQUIRED                            28080019
*                                                                       28140019
         TM    IOBLINK,SPANBIT     TEST IF SPANNED RECORD               28200019
         BO    BUILDR0             YES,GOTO BUILD WRITE/R0              28260019
*                                                                       28320019
*   WHETHER THE RECORD IS THE LAST RECORD ON THE TRACK                  28380019
*        * WKREG CONTAINS THE MINIMUM BYTES REQUIRED ON A TRACK         28440019
*                                                                       28500019
         NI    FOUR(WKREG11),MSKFF-CCHAIN    RESET COMMAND CHAIN TO R0  28560019
*                                                                       28620019
         CH    WKREG,DCBTRBAL      TEST IF MINIMUM .LE. TRACK BALANCE   28680019
         BL    SCHEXCP             YES,GOTO SCHEDULE EXCP               28740019
*                                                                       28800019
*   WHEN TRACK BALANCE IS .LE. 8,COMMAND CHAIN TO WRITE/R0 AND BUILD    28860019
*   R0 RECORD                                                           28920019
*                                                                       28980019
         XC    DCBTRBAL(TWO),DCBTRBAL   RESET DCB TRACK BALANCE TO '0'  29040019
*                                                                       29100019
*********************************************************************** 29160019
*                                                                       29220019
BUILDR0  EQU   *                                                        29280019
*                                                                       29340019
*********************************************************************** 29400019
*                                                                       29460019
*   THIS ROUTINE WILL BUILD WRITE/R0 DATA FOR WRITE/R0 CCW              29520019
*                                                                       29580019
*********************************************************************** 29640019
*                                                                       29700019
         OI    FOUR(WKREG11),CCHAIN     SET COMMAND CHAIN TO WRITE/R0   29760019
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  29790020
         IC    WKREG11,DCBOFFSR         GET OFFSET TO RD CCW     20201  29820020
         AR    WKREG11,IOBREG           POINT TO RD CCW          20201  29850020
         NI    FOUR(WKREG11),MSKFF-CCHAIN RESET CC TO ERASE CCW  20201  29880020
*                                                                       29940019
         MVC   IOBR0CNT(FOUR),IOBDNRCF       MOVE CCHH TO COUNT FOR R0  30000019
         MVI   IOBR0CNT+FOUR,NULL  SET R TO '0'                         30060019
         MVC   IOBR0DAT(FIVE),IOBDNRCF       MOVE CCHHR TO DATA FOR R0  30120019
         XC    IOBR0DAT+FIVE(THREE),IOBR0DAT+FIVE SET TRACK BALANCE=0   30180019
*                                                                       30240019
*   IF THE LAST SEGMENT IS THE LAST RECORD ON THAT TRACK                30300019
*        YES - SET WRITE/R0 BIT IN DCBCIND2                             30360019
*                                                                       30420019
         CH    WKREG,DCBTRBAL      TEST IF TRACK BAL .GT. MINIMUM       30480019
         BL    SCHEXCP             YES,GOTO EXCP                        30540019
*                                                                       30600019
         OI    DCBCIND2,WZEROBIT   SET WRITE/R0 BIT IN DCB              30660019
         OI    SGWKFLAG,WRITESZ    SET THIS I/O C.C. TO WRITE/R0        30720019
         XC    DCBTRBAL(TWO),DCBTRBAL   CLEAR TRACK BALANCE TO '0'      30780019
*                                                                       30840019
*********************************************************************** 30900019
*                                                                       30960019
SCHEXCP  EQU   *                                                        31020019
*                                                                       31080019
*********************************************************************** 31140019
*                                                                       31200019
*   THIS ROUTINE EXECUTE THE FOLLOWING FUNCTION                         31260019
*                                                                       31320019
*        1. IT EXAMINES THE PREVIOUS IOB. IF IT IS FOR A SPANNED        31380019
*           RECORD,THE ROUTINE ISSUES WAIT ON THE COMPLETION OF THE     31440019
*           SPANNED RECORD PROCESSING BEFORE IT ISSUES EXCP             31500019
*        2.IT ISSUES EXCP                                               31560019
*        3.IT THEN DETERMINES IF THE NEXT RECORD REQUIRES               31620019
*          SECONDARY ALLOCATION                                         31680019
*          YES - RETURN CODE = X'08'                                    31740019
*          NO  - RETURN CODE = X'00'                                    31800019
*                                                                       31860019
*********************************************************************** 31920019
*                                                                       31980019
         LR    WKREG11,IOBREG      LOAD IOB ADDR TO WKREG.11            32040019
*                                                                       32100019
LOOP03   EQU   *                                                        32160019
*                                                                       32220019
         LR    WKREG9,WKREG11      SAVE ADDR OF PREVIOUS IOB            32280019
         L     WKREG11,NULL(WKREG9) LOAD NEXT IOB ADDR                  32340019
         LA    WKREG11,NULL(WKREG11) CLEAR 1ST BYTE OF IOB ADDR         32400019
         CR    IOBREG,WKREG11      TEST IF SAME ADDR                    32460019
         BNE   LOOP03              NO,REPEAT UNTILL GET TO NEXT IOB     32520019
*                                                                       32580019
         LR    WKREG11,DECBREG          SAVE DECB POINTER               32590019
         TM    NULL(WKREG9),SPANBIT     TEST IF SPAN BIT IS ON          32640019
         BNO   EXCPGO              NO,GOTO ISSUE EXCP                   32700019
*                                                                       32760019
         CR    IOBREG,WKREG9       TEST IF THE SAME IOB(ONLY ONE IOB)   32820019
         BE    EXCPGO              YES,GOTO ISSUE EXCP                  32880019
*                                                                       32940019
PREVREQ  EQU   *                        WAIT ON PREVIOUS REQ     YM2865 32990002
         L     PARAM1,ECBPTR(WKREG9)    LOAD ADDR OF ECB                33000019
         LA    PARAM1,0(PARAM1)         CLEAR TOP BYTE OF ECBAD  YM2865 33050002
         LA    WKREG,IOBCSW-IOBDEF(WKREG9) SET UP IOBCSW ADDR    YM2865 33052002
         CR    WKREG,PARAM1             IS ECB ADDR DUMMY        YM2865 33054002
         BNE   TESTCOMP                 NO, CONTINUE TESTING     YM2865 33056002
         ICM   PARAM1,B'0111',IOBIOBA+1-IOBDEF(WKREG9) YES, GET  YM2865 33058002
*                                       USER ECB SAVED BY ASI    YM2865 33058402
         LTR   PARAM1,PARAM1            IS IT ZERO -IE. HAS AN   YM2865 33058802
*                                       INTERRUPT RESTORED ECB   YM2865 33059202
*                                       CORRECTLY SINCE TEST -   YM2865 33059602
*                                       DONE BY CEA, 19BT        YM2865 33059802
         BZ    PREVREQ                  YES, GO GET USER ECB PTR YM2865 33059902
TESTCOMP EQU   *                        IS PREVIOUS REQ COMPLETE YM2865 33079902
         TM    NULL(PARAM1),COMPLETE    TEST IF NOT COMPLETE            33100002
         BC    ONEMIX,EXCPGO            COMPLETE, GO ISSUE EXCP         33120019
*                                                                       33180019
*   ISSUE WAIT                                                          33240019
*                                                                       33300019
         WAIT  ,ECB=(1)            ISSUE WAIT ON SPANNED RECORD         33360019
*                                                                       33420019
EXCPGO   EQU   *                                                        33480019
*                                                                       33540019
         LA    PARAM1,IOBFLAG1     LOAD IOB ADDR FOR IOS                33600019
*                                                                       33660019
         EXCP  (1)                 ISSUE EXCP                           33720019
         LR    DECBREG,WKREG11     RESTORE DECB POINTER                 33730019
*                                                                       33780019
*   TEST IF ENTRY IS FROM EOV                                           33840019
*                                                                       33900019
         TM    IOBLINK,EOVBIT      TEST IF EOV BIT IS ON IN IOB         33960019
         BO    EOVOUT              YES,GOTO EOV EXIT                    34020019
*                                                                       34080019
         TM    DECTYPE+ONE,WRITESZ TEST IF WRITE/SZ REQUEST             34140019
         BNO   NORMALRT            NO,GOTO NORMAL RETURN                34200019
*                                                                       34260019
         BAL   WKREG11,EXTNTCHK    GOTO EXTENT CHECK ROUTINE            34320019
         BL    NORMALRT            IF NOT,GOTO NORMAL RETURN            34380019
*                                                                       34440019
*   IF THIS IS THE LAST TRACK  RETURN CODE=X'08'                        34500019
*                                                                       34560019
         LA    EPREG,RTNCD08       SET RETURN CODE=08                   34620019
         B     RETURN              GOTO RETURN                          34680019
*                                                                       34740019
*                                                                       34800019
EOVOUT   EQU   *                                                        34860019
*                                                                       34920019
*   EXIT EOV ENTRY POINT (IGG0551A)                                     34980019
*                                                                       35040019
         NI    IOBLINK,MSKFF-EOVBIT  RESET EOV BIT OF IOB               35100019
         BR    EOVRTRN             GO BACK TO EOV ROUTINE               35160019
*                                                                       35220019
*********************************************************************** 35280019
*                                                                       35340019
SPANNED  EQU   *                                                        35400019
*                                                                       35460019
*********************************************************************** 35520019
*                                                                       35580019
*   THIS ROUTINE FUNCTIONS AS FOLLOWS                                   35640019
*     1. IF THE RECORD CAN BE WRITTEN WITHIN THE ALLOCATED SPACE,       35700019
*        IT SCHEDULES WRITE/RN(1ST SEGMENT) COMMAND CHAINED TO WRITE/R0 35760019
*     2. IF THE RECORD CAN NOT BE WRITTEN WITHIN THE ALLOCATED SPACE,   35820019
*        IT SETS SPANNED BIT IN IOB AND SCHEDULES WRITE/R0 FOR THE REST 35880019
*        OF THE ALLOCATED TRACK.EVENTUALLY EOV ALLOCATE SECONDARY SPACE 35940019
*      * IF THE SECONDARY SPACE IS ALLOCATED ON THE SAME VOLUME,THE     36000019
*        RECORD WILL BE RE-SCHEDULED SO THAT IT WILL BE WRITTEN SPAN-   36060019
*        NING THE EXTENT ON THE SAME VOLUME                             36120019
*      * IF THE SECONDARY SPACE IS ON THE DEFERENT VOLUME,THE RECORD    36180019
*        WILL BE RE-SCHEDULED SO THAT IT WILL BE WRITTEN ON THE NEXT    36240019
*        VOLUME                                                         36300019
*                                                                       36360019
*********************************************************************** 36420019
*                                                                       36480019
         OI    IOBLINK,SPANBIT     SET THIS IS A SPANNED RECORD         36540019
*                                                                       36600019
         SH    WKREG10,IOBDNRCF    'SL'=NO OF BYTES CAN GO-KEYLEN       36660019
         STH   WKREG10,IOBDNRCF+TWO  STORE 'SL' INTO SAVE AREA          36720019
         L     WKREG8,DECAREA      LOAD ADDR OF RECORD AREA             36780019
*                                                                       36840019
         BAL   WKREG11,MOVEDATA    GOTO CONSTRUCT AND MOVE 1ST SEGMENT  36900019
*                                                                       36960019
         SH    WKREG10,CONST4      POINT TO THE S.D.W.                  37020019
         MVI   TWO(WKREG10),FRSTSEG  SET FIRST SEGMENT FLAG ON          37080019
         LH    WKREG10,SGWKOFF     LOAD 'LL' OF UPTO LAST SEG           37140019
         SH    WKREG10,IOBDNRCF+TWO  'DL'='LL'-'SL'                     37200019
         STH   WKREG10,IOBDNRCF+FOUR STORE 'DL' INTO SAVE AREA          37260019
*                                                                       37320019
*   GOTO CALCULATE NEXT CCHH ROUTINE                                    37380019
*                                                                       37440019
         MVC   IOBR0DAT,DCBFDAD    MOVE MBBCCHHR FROM DCB TO WORK AREA  37500019
         MVC   IOBSEEK,IOBR0DAT    SAVE THIS MBBCCHHR                   37560019
*                                                                       37563020
         SR    EPREG,EPREG              ZERO OUT A REG           20201  37572020
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  37575020
         IC    WKREG11,DASDINTR         GET REC OVERHEAD         20201  37578020
         TM    DASDFLAG,TBOVHD          DEVICE WITH 2 BYTE OVHD  20201  37581020
         BNO   LOTRPS2A                 BR AROUND HALFWD RTN     20201  37584020
         LH    WKREG11,DASDINTR         GET OVERHEAD IF TOW      20201  37587020
*                                       BYTES                    20201  37590020
LOTRPS2A EQU *                                                   20201  37593020
         IC    EPREG,DASDKEY            GET KEY OVERHEAD         20201  37596020
         SR    WKREG11,EPREG            GET REC OVHD - KEY OVHD  20201  37599020
         LH    EPREG,DASDLNGH           GET TRK CAPACITY         20201  37602020
         SR    EPREG,WKREG11            GET TRK CAP - OVHD - KEY 20201  37605020
*                                       OVHD                     20201  37608020
         SH    EPREG,CONST8             ALLOW FOR SDW & BDW      20201  37611020
*                                                                       37620019
LOOP01   EQU   *                                                        37680019
*                                                                       37740019
         BAL   WKREG11,NEXTCCHH    GOTO CALCULATE NEXT CCHH ROUTINE     37800019
*                                                                       37860019
*   TEST IF VOLUME IS FULL                                              37920019
*                                                                       37980019
         TM    DCBCIND1,VOLFULL    TEST IF VOLUME FULL IS 'ON'          38040019
         BO    SPANVOL             GOTO SPANNED VOLUME PROCESSING       38100019
*                                                                       38160019
         MVC   IOBSEEK,IOBR0DAT    SAVE THIS MBBCCHHR                   38220019
*                                                                       38280019
*   IF THE VOLUME IS NOT FULL,TEST WHETHER THE REMAINNG SEGMENT FITS ON 38340019
*   THE NEXT TRACK                                                      38400019
*   EPREG  =NO.OF BYTES CAN BE WRITTEN ON A TRACK                       38460019
*                                                                       38520019
         CH    EPREG,IOBDNRCF+FOUR  TEST IF REMAINNING BYTES FIT        38580019
         BNL   ITFITS              YES,GOTO SCHEDULE 1ST SEGMENT        38640019
*                                                                       38700019
*   WHEN REMAING SEGMENT CANNOT FIT ON A TRACK UPDATE REMAINNG SEGMENT  38760019
*   LENGTH BY TRACK SIZE AND REPEAT THIS PROCESS                        38820019
*                                                                       38880019
         LH    WKREG11,IOBDNRCF+FOUR  LOAD REMINNING BYTES              38940019
         SR    WKREG11,EPREG       NEW REMAINNING BYTE=REMAIN - TRACK   39000019
         STH   WKREG11,IOBDNRCF+FOUR STORE REMINNING BYTES              39060019
*                                                                       39120019
         B     LOOP01              GO BACK TO CALCULATE NEXT CCHH       39180019
*                                                                       39240019
*********************************************************************** 39300019
*                                                                       39360019
ITFITS   EQU   *                                                        39420019
*                                                                       39480019
*********************************************************************** 39540019
*                                                                       39600019
*                                                                       39660019
*   THE ROUTINE DOES THE FOLLOWING                                      39720019
*     1. SETS 'SPANNED' BIT IN IOB FOR C.E.A.                           39780019
*     2. MOVES THE MBBCCHHR OF THE LAST SEGMENT TO DCBFDAD              39840019
*     3. UPDATE TRACK BALANCE WITH THE TRACK WHICH HAVE LAST SEGMENT    39900019
*     4. CONSTRUCT WRITE/RN COMMAND CHAINND TO WRITE/R0 OF THAT TRACK   39960019
*                                                                       40020019
*********************************************************************** 40080019
*                                                                       40140019
*   MOVE PREVIOUS MBBCCHHR INTO IOBSEEK AND MOVE THE MBBCCHHR OF THE    40200019
*   LAST SEGMENT INTO DCBFDAD                                           40260019
*                                                                       40320019
         MVC   IOBSEEK,DCBFDAD     MOVE CCHHR OF PREVIOUS RECORD        40380019
         MVC   SGWKOFF(TWO),IOBDNRCF+TWO  MOVE 'SL' AS OFFSET OF 'LL'   40440019
*                                                                       40500019
*   CALCULATE TRACK BALANCE FOR THE LAST SEGMENT                        40560019
*                                                                       40620019
         LH    WKREG6,IOBDNRCF+FOUR LOAD REMAINNING BYTE LENGTH         40680019
         LA    WKREG6,EIGHT(WKREG6)  ADD '8' FOR 'SDW/BDW'              40740019
         MVC   IOBR0CNT(ONE),DCBKEYLE   SAVE KEYLEN                     40800019
         MVI   DCBKEYLE,NULL       SET KEYLEN=0                         40860019
         MVC   IOBDNRCF+TWO(TWO),IOBDNRCF+FOUR  MOVE 'DL' OF LAST SEG.  40920019
*                                                                       40980019
         BAL   WKREG11,OVERHEAD    GOTO CALCULATE OVERHEAD              41040019
*                                                                       41100019
         MVC   DCBKEYLE(ONE),IOBR0CNT   RESTORE KEYLEN                  41160019
         SR    WKREG11,WKREG11          ZERO WKREG11                    41170019
         SR    WKREG,WKREG              ZERO WKREG                      41180019
         CLI   DCBKEYLE,NULL            IS KEY LENGTH = 0               41190019
         BE    NOKEYBAL                 BR IF YES                       41200019
         IC    WKREG11,DASDLAST-DASDTBL(WKREG9)  GET LAST OVERHEAD      41210019
         TM    DASDFLAG,TBOVHD          IS IT A 2305             20201  41210220
         BNO   MZ001                    IF NOT, OVERHEAD O.K.    20201  41210420
         LH    WKREG11,DASDINTR         ELSE GET 2 BYTES INSTEAD 20201  41210620
MZ001    EQU   *                                                 20201  41210820
         IC    WKREG,DCBKEYLE           GET KEY LENGTH                  41211019
         AR    WKREG,WKREG11            ADD OVERHEAD AND KEYLENGTH      41211119
NOKEYBAL EQU   *                                                        41212019
         AH    WKREG,CONST8             ADD MIN DATA LENGTH             41213019
*                                                                       41220019
         AH    EPREG,CONST8        OBTAIN TRACK CAPACITY                41280019
         SR    EPREG,WKREG7        TRACK CAPACITY - INTERMEDIATE RECORD 41340019
         LTR   EPREG,EPREG         TEST IF TRACK BALANCE .LE.0          41400019
         BP    OKGOGO              .GT.,THEN TRACK BAL IS AS IS         41460019
         SR    EPREG,EPREG         .LE.0,TRACK BALANCE=0                41520019
*                                                                       41580019
OKGOGO   EQU   *                                                        41640019
*                                                                       41700019
         STH   EPREG,DCBTRBAL      STORE TRACK BALANCE FOR THE TRACK    41760019
*                                                                       41820019
         SR    WKREG11,WKREG11     RESET REG. TO '0'                    41880019
         MVI   IOBR0DAT+SEVEN,ONE  SET R=1                              41940019
         MVC   DCBFDAD,IOBR0DAT    MOVE HIGHEST MBBCCHHR TO DCBFDAD     42000019
*                                                                       42060019
         MVC   IOBDNRCF(FIVE),IOBSEEK+THREE  MOVE NEW MBBCCHHR          42120019
         SR    WKREG11,WKREG11     RESET WKREG11 TO '0'                 42180019
         IC    WKREG11,IOBDNRCF+FOUR   INSERT R OF PREVIOUS CCHHR       42240019
         LA    WKREG11,ONE(WKREG11)  INCREMENT BY '1' TO R+1            42300019
         STC   WKREG11,IOBDNRCF+FOUR  STORE IT (R+1)                    42360019
*                                                                       42420019
         B     CCWGOGO             GOTO CONSTRUCT CCW AND EXCP          42480019
*                                                                       42540019
*********************************************************************** 42600019
*                                                                       42660019
SPANVOL  EQU   *                                                        42720019
*                                                                       42780019
*********************************************************************** 42840019
*                                                                       42900019
*   WHEN THE RECORD CANNOT BE WRITTEN ON ALLOCATED SPACE,THE R0 OF ALL  42960019
*   THE TRACKS WILL BE WRITTEN.AFTER EOV PROCESSING THE RECORD MAY BE   43020019
*   WRITTEN ON THE SAME VOLUME OR ON THE NEXT VOLUME                    43080019
*                                                                       43140019
*********************************************************************** 43200019
*                                                                       43260019
         MVC   IOBR0DAT,IOBSEEK    MOVE CCHHR OF THE LAST SEGMENT       43320019
         MVC   IOBSEEK,DCBFDAD     MOVE PREVIOUS CCHHR AS SEEK FIELD    43380019
         MVC   SGWKDATA(EIGHT),DCBFDAD  SAVE MBBCCHHR OF PREVIOUS RCD   43440019
         MVC   IOBDNRCF(TWO),DCBTRBAL   SAVE TRACK BALANCE OF THE TRACK 43500019
         MVC   DCBFDAD,IOBR0DAT    MOVE CCHHR OF LAST SEGMENT           43560019
         OI    SGWKFLAG,SPANVLM    SET SPAN VOLUME BIT                  43620019
*                                                                       43680019
         BAL   WKREG11,EXTNTCHK    GOTO EXTENT CHECK ROUTINE            43740019
         BL    WRTSZRTN            DON'T SET LAST SEG BIT,UPDATE A33103 43780020
*                                       SEEK                     A33103 43820020
*                                                                       43860019
         OI    SGWKFLAG,LASTSEG    SET LAST SEGMENT BIT                 43920019
         B     WRTR0CCW            GOTO WRITE/R0 CONSTRUCTION           43980019
*                                                                       44040019
*********************************************************************** 44100019
*                                                                       44160019
WRTSZRTN EQU   *                                                        44220019
*                                                                       44280019
*********************************************************************** 44340019
*                                                                       44400019
*   WRITE-SZ ROUTINE                                                    44460019
*                                                                       44520019
*     1. IT CONSTRUCTS WRITE-R0 CHANNEL PROGRAM                         44580019
*     2. IT DETERMINES IF ERASE COMMAND IS TO BE COMMAND CHAINED.       44640019
*     3. IT THEN ISSUES EXCP                                            44700019
*                                                                       44760019
*********************************************************************** 44820019
*                                                                       44880019
         MVC   IOBSEEK,DCBFDAD     MOVE MBBCCHHR                        44940019
         OI    SGWKFLAG,LASTSEG        TURN ON BIT FOR LAST      A33103 44960020
*                                       SEGMENT                  A33103 44980020
*                                                                       45000019
WRTR0CCW EQU   *                                                        45060019
*                                                                       45120019
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  45220020
         IC    WKREG11,DCBWCPO          GET OFFSET TO WRT R0     20201  45320020
*                                       C.P.                     20201  45420020
         AR    WKREG11,IOBREG           POINT TO IT              20201  45520020
*                                                                       45720019
STORECCW EQU   *                                                        45780019
*                                                                       45840019
         ST    WKREG11,IOBSTART    STORE IT AS START ADDR               45900019
         MVC   IOBR0CNT(FOUR),IOBSEEK+THREE  MOVE CCHH TO COUNT FLD     45960019
         MVI   IOBR0CNT+FOUR,NULL  SET R=0                              46020019
         MVC   IOBR0DAT(FIVE),DCBFDAD+THREE  MOVE CCHHR TO R0 DATA FLD  46080019
         MVC   IOBR0DAT+FIVE(TWO),DCBTRBAL  MOVE TRACK BALANCE TO R0    46140019
*                                                                       46200019
*   IF PREVIOUS WRITE WAS WRITE/SZ THEN IT COMMAND CHAINS TO 'ERASE'    46260019
*   CCW                                                                 46320019
*                                                                       46380019
         SR    WKREG11,WKREG11          ZERO OUT A REGISTER      20201  46390020
         IC    WKREG11,DCBOFFSR         GET OFFSET TO READ R0    20201  46400020
*                                       CCW                      20201  46410020
         AR    WKREG11,IOBREG           POINT TO IT              20201  46420020
         NI    FOUR(WKREG11),MSKFF-CCHAIN  SET  CC OFF           20201  46430020
         CLI   DCBFDAD+SEVEN,NULL       FIRST RECORD ON THIS     A29270 46450019
*                                       TRACK                    A29270 46460019
         BE    SETCC                    BR IF YES, INDICATE      A29270 46470019
*                                       TRACK                    A29270 46480019
*                                       MUST BE ZEROED OUT              46490019
         TM    DCBCIND2,WZEROBIT   TEST IF THE PREVIOUS WRITE IS 'SZ'   46500019
         BNO   NOWRTSZ             NO,DON'T C.C. TO 'ERASE'             46560019
*                                                                       46620019
SETCC    EQU   *                                                 A29270 46650019
         OI    FOUR(WKREG11),CCHAIN     SET CC TO ERASE          20201  46690020
*                                                                       46740019
NOWRTSZ  EQU   *                                                        46800019
*                                                                       46860019
         OI    DCBCIND2,WZEROBIT   SET WRITE/SZ REQUEST BIT             46920019
         OI    SGWKFLAG,WRITESZ    SET THIS I/O C.C. TO WRITE/R0        46980019
*                                                                       47040019
         B     SCHEXCP             GOTO ISSUE EXCP                      47100019
*                                                                       47160019
*                                                                       47220019
*********************************************************************** 47280019
*                                                                       47340019
*                                                                       47400019
*********************************************************************** 47460019
*                                                                       47520019
MOVEDATA EQU   *                                                        47580019
*                                                                       47640019
*********************************************************************** 47700019
*                                                                       47760019
*   MOVE DATA FROM USER'S RECORD AREA TO S.W.A. WHICH IS POINTED BY     47820019
*   S.W.A                                                               47880019
*        WKREG6 - LENGTH OF DATA TO BE MOVED                            47940019
*        WKREG7 - ADDR OF AREA TO WHICH DATA IS MOVED                   48000019
*        WKREG8 - ADDR OF DATA TO BE MOVED                              48060019
*                                                                       48120019
*********************************************************************** 48180019
*                                                                       48240019
         ST    WKREG11,IOBR0DAT    SAVE RETURN ADDR                     48300019
         LA    WKREG7,SGWKDATA     LOAD ADDR OF S.W.A. DATA FIELD       48360019
*                                                                       48420019
         LH    WKREG6,IOBDNRCF     LOAD KEYLEN                          48480019
         LTR   WKREG6,WKREG6       TEST IF KEYLEN .EQ. '0'              48540019
         BZ    MOVESEG             YES,GOTO MOVE SEGMENT                48600019
*                                                                       48660019
*   MOVE KEY TO S.W.A.                                                  48720019
*                                                                       48780019
         BAL   WKREG11,SMOVE       GOTO MOVE DATA ROUTINE               48840019
*                                                                       48900019
MOVESEG  EQU   *                                                        48960019
*                                                                       49020019
*   MOVE 1 ST SEGMENT INTO S.W.A. AND SETUP B.D.W. AND S.D.W.           49080019
*                                                                       49140019
         AH    WKREG7,IOBDNRCF     ADD KEYLEN TO ADDR OF SDW            49200019
         XC    NULL(EIGHT,WKREG7),NULL(WKREG7)    CLEAR BDW/SDW         49260019
*                                                                       49320019
         AH    WKREG8,IOBDNRCF     ADD KEYLEN TO RECORD ADDR            49380019
         LH    WKREG10,IOBDNRCF+TWO  LOAD 'SL'OR 'LL'                   49440019
*                                                                       49500019
*   SETUP B.D.W. AND S.D.W.FOR THE 1ST SEGMENT                          49560019
*                                                                       49620019
         SH    WKREG10,CONST4      MINUS '4' TO ALLOW FOR SDW           49680019
         STC   WKREG10,FIVE(WKREG7)  STORE 'RL/SL' INTO SDW             49740019
         SRL   WKREG10,EIGHT       MOVE IT TO THE HIGH ORDER BYTE       49800019
         STC   WKREG10,FOUR(WKREG7)  STORE 1ST CHAR OF 'RL/SL'          49860019
*                                                                       49920019
         LH    WKREG6,IOBDNRCF+TWO LOAD 'LL' INTO REG.                  49980019
         MVC   NULL(TWO,WKREG7),IOBDNRCF+TWO MOVE 'LL' INTO BDW         50040019
         SH    WKREG6,CONST8       DATA LENGTH='LL'-8                   50100019
*                                                                       50160019
         LA    WKREG7,EIGHT(WKREG7) INCREMENT TO ADDR BY '8' FOR D.W'S  50220019
         LA    WKREG8,EIGHT(WKREG8)  INCREMENT BY '8' FOR 'DW'S'        50280019
         LR    WKREG10,WKREG7      SAVE RECORD AREA ADDRESS             50340019
*                                                                       50400019
*   MOVE 1ST SEGMENT TO WORK AREA                                       50460019
*                                                                       50520019
         BAL   WKREG11,SMOVE       GOTO MOVE DATA ROUTINE               50580019
*                                                                       50640019
         L     WKREG11,IOBR0DAT    RESTORE RETURN REG.                  50700019
*                                                                       50760019
         BR    WKREG11             RETURN TO THE MAIN ROUTINE           50820019
*                                                                       50880019
*                                                                       50940019
MOVE     MVC   NULL(NULL,WKREG7),NULL(WKREG8)     MOVE .LT. 256 BYTES   51000019
*                                                                       51060019
MOVE256  EQU   *                                                        51120019
*                                                                       51180019
         MVC   NULL(MSKFF+ONE,WKREG7),NULL(WKREG8)  MOVE 256 BYTES      51240019
         AH    WKREG7,CONST256     INCREMENT BY '256'                   51300019
         AH    WKREG8,CONST256     INCREMENT BY '256'                   51360019
*                                                                       51420019
SMOVE    EQU   *                                                        51480019
*                                                                       51540019
         SH    WKREG6,CONST256     SUBTRACT 256                         51600019
         BP    MOVE256             IF GT 0,MOVE 256 BYTES AT A TIME     51660019
*                                                                       51720019
         AH    WKREG6,CONST255     CORRECT TO ORIGINAL LENGTH-1         51780019
         EX    WKREG6,MOVE         MOVE REST OF BYTES                   51840019
*                                                                       51900019
         BR    WKREG11             RETURN TO MAIN                       51960019
*                                                                       52020019
*********************************************************************** 52080019
*                                                                       52140019
*********************************************************************** 52200019
*                                                                       52260019
OVERHEAD EQU   *                                                        52320019
*                                                                       52380019
*********************************************************************** 52440019
*                                                                       52500019
*   CALCULATE THE FOLLOWINGS                                            52560019
*     1. INTERMEDIATE RECORD LENGTH IN WKREG7                           52620019
*     2. LAST RECORD LENGTH IN WKREG8                                   52680019
*     3. MINIMUM RECORD LENGTH IN WKREG                                 52740019
*     4. TRACK CAPACITY IN EPREG                                        52800019
*     5. NO. OF BYTES CAN BE WRITTEN ON THE CURRENT TRACK IN WKREG10    52860019
*                                                                       52920019
*     AT ENTRY WKREG6 CONTAINS 'LL+KL'                                  52980019
*                                                                       53040019
*********************************************************************** 53100019
*                                                                       53160019
         L     WKREG9,DCBDVTBL     LOAD ADDR OF DEVICE TABLE            53220019
         USING DASDTBL,WKREG9      ESTABLISH BASE FOR DEVICE TABLE      53280019
*                                                                       53340019
         SR    EPREG,EPREG         RESET REG.0 TO '0'                   53400019
*                                                                       53460019
         CLI   DCBKEYLE,NULL       TEST IF KEY IS SPECIFIED             53520019
         BNE   KEYGOGO             NO, SKIP KEY OVERHEAD                53580019
*                                                                       53640019
         IC    EPREG,DASDKEY       INSERT OVERHEAD FOR KEY              53700019
*                                                                       53760019
KEYGOGO  EQU   *                                                        53820019
*                                                                       53880019
         SR    WKREG8,WKREG8       RESET REG. TO '0'                    53940019
         IC    WKREG8,DASDLAST     INSERT LAST RECORD OVERHEAD          54000019
         TM    DASDFLAG,TBOVHD          2305 DEVICE ONLINE       20201  54010020
         BNO   MZ002                    IF NOT OVERHEAD O.K.     20201  54020020
         LH    WKREG8,DASDINTR         IF SO GET 2 BYTE OVERHEAD 20201  54030020
MZ002    EQU   *                                                 20201  54040020
*                                                                       54060019
         LH    WKREG10,DCBTRBAL    LOAD TRACK BALANCE                   54120019
*                                                                       54180019
         USING UCB,WKREG7                                      ZM40313  54186037
         SR    WKREG7,WKREG7           CLEAR REGISTER          ZM40313  54187037
         IC    WKREG7,IOBSEEK          'M' FROM IOBSEEK        ZM40313  54188037
         SLL   WKREG7,FOUR             MPY BY 16 FOR EXTENTS   ZM40313  54189037
         AR    WKREG7,DEBREG           ADD DEB ADDRESS         ZM40313  54190037
         L     WKREG7,DEBBASE(WKREG7)  ADD DEB BASIC SECTION   ZM40313  54191037
*                                      FOR UCB ADDRESS         ZM40313  54192037
         TM    UCBTBYT2,UCBRPS         RPS DEVICE?             ZM40313  54193037
         BNO   NODEVRPS                NO - BRANCH             ZM40313  54194037
         DROP  WKREG7                                          ZM40313  54195037
         AR    WKREG10,EPREG            OTHERWISE ADD THE KEY    20201  54198020
*                                       OVHD IF THERE ARE NO KEYS       54204020
*                                       (SOUNDS DUMB DOESNT IT?)        54210020
         B     RPSDEV                   GO SUBTRACT OFF THELAST  20201  54216020
*                                       REC OVERHD                      54222020
NODEVRPS EQU   *                                                 20201  54228020
         CLI   DCBKEYLE,NULL            TEST IF KEYLEN=0                54240019
         BE    NOKEY               NO,GOTO SKIP KEY OVERHEAD            54300019
*                                                                       54360019
RPSDEV   EQU   *                                                 20201  54390020
         SR    WKREG10,WKREG8      TRACK BALANCE - LAST RECORD OVERHEAD 54420019
*                                                                       54480019
NOKEY    EQU   *                                                        54540019
*                                                                       54600019
         AR    WKREG8,WKREG6       ADD DL + KL + LAST RECORD OVERHEAD   54660019
*                                                                       54720019
         SR    WKREG8,EPREG        LAST RECORD=DL+KL+OVERHEAD           54780019
*                                                                       54840019
         SR    WKREG7,WKREG7       REST REG.                            54900019
         IC    WKREG7,DASDINTR     INSERT INTERMEDIATE RECORD OVERHEAD  54960019
         TM    DASDFLAG,TBOVHD          SOME DEVICES LIKE A 2305 20201  54970020
         BNO   MZ003                      HAVE 2 BYTE OVERHEADS  20201  54980020
         LH    WKREG7,DASDINTR          INSTEAD OF ONE           20201  54990020
MZ003    EQU   *                                                 20201  55000020
         LR    WKREG,WKREG6        MOVE KL+DL                           55020019
         MH    WKREG,DASDTOL       CALCULATE TOLERANCE*(KL+DL) AND      55080019
         SRL   WKREG,NINE          DIVIDE THE ABOVE BY 512              55140019
         AR    WKREG7,WKREG        ADJUST BY INTERMEDIATE RECORD OVERH  55200019
         SR    WKREG7,EPREG        ADJUST BY KEY OVERHEAD               55260019
*                                                                       55320019
         LR    WKREG,WKREG8        LOAD LAST RECORD LENGTH AND          55380019
         SH    WKREG,IOBDNRCF+TWO  SUBTRACT 'LL' FROM IT.THEN           55440019
         AH    WKREG,CONST8        ADD '8' TO IT.                       55500019
*                                                                       55560019
         LH    EPREG,DASDLNGH      LOAD TRACK CAPACITY INTO EPREG       55620019
         SH    EPREG,CONST8        TRACK CAPACITY - 8 FOR SDW/BDW       55680019
*                                                                       55740019
         BR    WKREG11             GO BACK TO ENTRY POINT               55800019
*                                                                       55860019
*********************************************************************** 55920019
*                                                                       55980019
EXTNTCHK EQU   *                                                        56040019
*                                                                       56100019
*********************************************************************** 56160019
*                                                                       56220019
*   CHECK IF THIS IS THE LAST TRACK OF THE LAST EXTENT                  56280019
*                                                                       56340019
*********************************************************************** 56400019
*                                                                       56460019
         SR    WKREG6,WKREG6       RESET REG.6 TO '0'                   56520019
         IC    WKREG6,DEBNMEXT     INSERT DEB NO. OF EXTENT             56580019
         BCTR  WKREG6,NULL         DECREMENT BY '1'                     56640019
         SLL   WKREG6,FOUR         MULTIPLY BY '16'                     56700019
         AR    WKREG6,DEBREG       ADD DEB ADDR TO GET TO THE LAST EXT. 56760019
*                                                                       56820019
         CLC   IOBSEEK+THREE(FOUR),DEBENDCC-DEB(WKREG6) IS THIS LAST TR 56880019
         BR    WKREG11             GO BACK TO THE ENTRY                 56940019
*                                                                       57000019
*********************************************************************** 57060019
*                                                                       57120019
NEXTCCHH EQU   *                                                        57180019
*                                                                       57240019
*********************************************************************** 57300019
*                                                                       57360019
*   THIS ROUTINE CALCULATE NEXT CCHH                                    57420019
*                                                                       57480019
*        AT ENTRY IOBR0DAT CONTAINS THE MBBCCHHR OF CURRENT TRACK       57540019
*        AT EXIT  IOBR0DAT CONTAINS THE MBBCCHHR OF NEXT TRACK          57600019
*                                                                       57660019
*********************************************************************** 57720019
*                                                                       57780019
         LA    IOBREG,NULL(IOBREG) CLEAR 1ST BYTE                       57840019
*                                                                       57900019
         L     WKREG9,DCBDVTBL     LOAD ADDR OF DEVICE TABLE            57960019
         STM   DECBREG,DCBREG,IOBR0CNT SAVE REGISTERS TEMPORARILY       58020019
*                                                                       58080019
         MVC   IOBCSW(FOUR),DASDCYL  MOVE MAX. CCHH INTO WORK AREA      58140019
         MVC   IOBCSW+FOUR(FOUR),IOBR0DAT+THREE  MOVE CURRENT TO AREA   58200019
*                                                                       58260019
         SR    WKREG6,WKREG6       RESET REG TO '0'                     58320019
         IC    WKREG6,IOBR0DAT     INSERT 'M' OF CURRENT TO GET TO THE  58380019
         SLL   WKREG6,FOUR         PROPER DEB EXTENT                    58440019
         AR    WKREG6,DEBREG       WKREG9 POINT TO PROPER EXTENT IN DEB 58500019
*                                                                       58560019
         LA    INDEXR,THREE(IOBREG)     SET CCHH VALUE TO HH            58620019
         L     CCHHRG,IOBCSW+FOUR  LOAD CURRENT CCHH                    58680019
*                                                                       58740019
         TM    DASDFLAG,BYTEMODE   ARE BYTES NON-CONTIGUOUS             58800019
         BZ    DOWNONE             NO,GOTO CONTIGUOUS                   58860019
*                                                                       58920019
ADDONE   EQU   *                                                        58980019
*                                                                       59040019
         AH    CCHHRG,CONST1       ADD '1' TO NEXT ADDR                 59100019
*                                                                       59160019
         TM    DASDFLAG,BYTEMODE   TEST IF NON-CONTIGUOUS               59220019
         BO    USEBYTE             YES,TREAT EACH SEPARATELY            59280019
*                                                                       59340019
         STH   CCHHRG,OFFTONEW(INDEXR)  STORE NEW CC OR HH              59400019
*                                                                       59460019
         CLC   OFFTONEW(TWO,INDEXR),OFFTOMAX(INDEXR) CHK FOR VALIDITY   59520019
         BL    TSTEXT              VALID,CHECK IF WITHIN EXTENT         59580019
*                                                                       59640019
*   ADDR IS NOT VALID                                                   59700019
*                                                                       59760019
         SRL   CCHHRG,SIXTEEN      SHIFT IT TO 'CC'                     59820019
         XC    OFFTONEW(TWO,INDEXR),OFFTONEW(INDEXR) SET ZERO THE BYTES 59880019
*                                                    PROCESSED OF CCHH  59940019
*                                                                       60000019
         BCTR  INDEXR,NULL         DECREMENT INDEX BY '1'.(FOR NON-CONT 60060019
*                                  IGUOUS NEXT BCTR WILL DECREMENT      60120019
DOWNONE  EQU   *                   AGAIN)                               60180019
*                                                                       60240019
         BCTR  INDEXR,NULL         DECREMENT INDEX BY '1'               60300019
*                                                                       60360019
         CR    INDEXR,IOBREG       TEST IF ALL ADDR BEEN PROCESSED      60420019
         BNL   ADDONE              NO,LOOP TO ADD ONE TO NEXT BYTE      60480019
*                                                                       60540019
NEXTENT  EQU   *                                                        60600019
*                                                                       60660019
         IC    INDEXR,IOBR0DAT     INCREMENT M AND SEE IF THIS WAS THE  60720019
         LA    INDEXR,ONE(INDEXR)  LAST EXTENT.                         60780019
         STC   INDEXR,IOBR0DAT     REPLACE M BY 'M+1'                   60840019
*                                                                       60900019
         CLC   IOBR0DAT(ONE),DEBNMEXT   IF THE M+1 .GT. NO OF EXTENT    60960019
         BE    SETEOV                YES,GOTO SET 'VOLUME FULL'         61020019
*                                                                       61080019
         LA    WKREG6,SIXTEEN(WKREG6)   INCREMENT TO NEXT EXTENT        61140019
         MVC   IOBR0DAT+ONE(SIX),DEBBINUM-DEB(WKREG6)  MOVE BBCCHH OF   61200019
*                                                      THE NEXT EXTENT  61260019
GOOUT    EQU   *                                                        61320019
*                                                                       61380019
         MVI   IOBR0DAT+SEVEN,NULL SET R=0                              61440019
*                                                                       61500019
         LM    DECBREG,DCBREG,IOBR0CNT  RESTORE DECB/DCB REGISTERS      61560019
*                                                                       61620019
         BR    WKREG11             RETURN TO THE MAIN ROUTINE           61680019
*                                                                       61740019
USEBYTE  EQU   *                                                        61800019
*                                                                       61860019
         STC   CCHHRG,OFFTONEW(INDEXR)  STORE THE BYTE PROCEED AND      61920019
         SRL   CCHHRG,EIGHT             SHIFT TO THE NEXT ONE           61980019
*                                                                       62040019
         CLC   OFFTONEW(ONE,INDEXR),OFFTOMAX(INDEXR) TEST VALIDITY      62100019
         BL    TSTEXT              VALID,GOTO CHECK EXTENT LIMIT        62160019
*                                                                       62220019
         MVI   OFFTONEW(INDEXR),NULL SET THE BYTE TO '0'                62280019
         B     DOWNONE             GOTO NEXT BYTE                       62340019
*                                                                       62400019
TSTEXT   EQU   *                                                        62460019
*                                                                       62520019
         CLC   IOBCSW+FOUR(FOUR),DEBENDCC-DEB(WKREG6)  TEST IF WITHIN   62580019
*                                                      EXTENT           62640019
         BH    NEXTENT             NO,GOTO CHECK NEXT EXTENT            62700019
*                                                                       62760019
         MVC   IOBR0DAT+THREE(FOUR),IOBCSW+FOUR   YES,MOVE NEW CCHH     62820019
*                                                                       62880019
         B     GOOUT               GOTO RETURN                          62940019
*                                                                       63000019
SETEOV   EQU   *                                                        63060019
*                                                                       63120019
         LM    DECBREG,DCBREG,IOBR0CNT  RESTORE DECB/DCB REGISTER       63180019
         OI    DCBCIND1,VOLFULL    SET VOLUME IS FULL                   63240019
*                                                                       63300019
         B     GOOUT               GOTO RETURN                          63360019
*                                                                       63420019
*********************************************************************** 63480019
         EJECT                                                          63540019
 TITLE 'IGG019BR-ASYNCHRONOUS EXIT ROUTINE FOR BSAM WRITE(CREATE BDAM)-X63600019
               VS FORMAT'                                               63660019
*                                                                       63720019
*********************************************************************** 63780019
*                                                                       63840019
*FUNCTION - 1. FOR SPANNED VOLUME RECORD THE ROUTINE SCHEDULES WRITE/R0 63900019
*              CHANNEL PROGRAM SO THAT ALL THE REMAINNG TRACK WILL      63960019
*              HAVE CAPACITY RECORD                                     64020019
*           2. FOR REGULAR SPANNED RECORD IT SCHEDULES WRITE/SN C.C. TO 64080019
*                                                                       64140019
*********************************************************************** 64200019
*                                                                       64260019
ASYENTRY EQU   *                                                        64320019
*              WRITE/RO CHANNEL PROGRAM.                                64380019
*                                                                       64440019
*ENTRY - FROM EXIT EFFECTOR WHICH HAS GAINNED CONTROL FROM C.E.A.       64500019
*        REGISTERS                                                      64560019
*        R1 - ADDRESS OF RQE                                            64620019
*        R14- RETURN ADDRESS TO SUPERVISOR                              64680019
*        R15- ENTRY                                                     64740019
*                                                                       64800019
*********************************************************************** 64860019
*                                                                       64920019
*   ESTABLISH REGISTERS                                                 64980019
*                                                                       65040019
*********************************************************************** 65100019
*                                                                       65160019
         L     IOBREG,FOUR(PARAM1) LOAD IOB ADDR FROM RQE               65220019
         LA    IOBREG,NULL(IOBREG) CLEAR 1ST BYTE OF IOB REG.           65280019
         L     DCBREG,IOBDCB(IOBREG)  LOAD DCB REG                      65340019
         L     BASEREG,DCBWRITE    ESTABLISH BASE ADDR                  65400019
         SH    IOBREG,CONST8       IOB ADDR - 8                         65460019
         L     DEBREG,DCBDEBAD     LOAD DEB ADDR                        65520019
*                                                                       65580019
         LR    SAVEREG,RETREG      SAVE RETURN TO SUPERVISOR ADDR       65640019
         SR    RETREG,RETREG            ZERO OUT A REGISTER      20201  65670020
         IC    RETREG,DCBOFFSW          GET OFFSET TO WRT CCW    20201  65700020
         L     RETREG,NULL(RETREG,IOBREG) LOAD ADDR OF S.W.A.    20201  65730020
         SH    RETREG,CONST10      POINT TO THE START OF S.W.A.         65760019
*                                                                       65820019
         OI    SGWKFLAG,ASYCNTRL   SET A.S.I. IS IN CONTROL BIT         65880019
*                                                                       65940019
         MVC   IOBR0DAT,IOBSEEK    MOVE PREVIOUS MBBCCHH INTO WORK AREA 66000019
         BAL   WKREG11,NEXTCCHH    OBTAIN CCHH+1                        66060019
*                                                                       66120019
         MVC   IOBSEEK,IOBR0DAT    MOVE NEW MBBCCH TO SEEK FIELD        66180019
         MVC   IOBR0CNT(FIVE),IOBR0DAT+THREE MOVE NEW CCHHR INTO COUNT  66240019
         MVC   IOBR0DAT(FIVE),IOBR0CNT       MOVE NEW CCHHR INTO DATA   66300019
         XC    IOBR0DAT+FIVE(THREE),IOBR0DAT+FIVE  CLEAR TRACK BALANCE  66360019
*                                                                       66420019
         TM    SGWKFLAG,SPANVLM    TEST IF SPAN VOLUME BIT IS ON        66480019
         BNO   NEXTSEG             NO,GOTO PROCESS NEXT SEGMENT         66540019
*                                                                       66600019
         USING DASDTBL,WKREG9      ESTABLISH BASE FOR DEVICE TABLE      66660019
         L     WKREG9,DCBDVTBL     LOAD DEVICE TABLE ADDR               66720019
*                                                                       66780019
         MVC   IOBR0DAT+FIVE(TWO),DASDLNGH  MOVE TRACK CAPACITY         66840019
*                                                                       66900019
*********************************************************************** 66960019
*                                                                       67020019
*   SPANNED VOLUME HANDLING                                             67080019
*                                                                       67140019
*        CONSTRUCT WRITE/R0 C.C. TO ERASE CHANNEL PROGRAM               67200019
*                                                                       67260019
*********************************************************************** 67320019
*                                                                       67380019
*                                                                       67440019
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  67470020
         IC    WKREG11,DCBOFFSR         GET OFFSET TO READ R0    20201  67500020
*                                       CCW                      20201  67530020
         AR    WKREG11,IOBREG           PT TO READ R0 CCW        20201  67560020
         OI    FOUR(WKREG11),CCHAIN     SET COMMAND CHN TO ERASE 20201  67590020
*                                                                       67620019
         LA    PARAM1,IOBFLAG1     LOAD ADDR OF IOB                     67680019
         L     WKREG6,IOBECBPT          LOAD USER DECB ADDR      YM3849 67690002
         STCM  WKREG6,B'0111',IOBIOBA+1 SAVE IN IOB PREF+4       YM3849 67700002
         LA    WKREG11,IOBCSW           GET CSW ADDRESS TO USE   YM3849 67730002
         ST    WKREG11,IOBECBPT         AS DUMMY ECB FOR IOS     YM3849 67732002
*                                       USER ECB PTR WILL BE     YM3849 67734002
*                                       RESTORED BY CEA(19BT)    YM3849 67736002
*                                                                       67860019
         EXCP  (1)                                                      67920019
*                                                                       67980019
         BAL   WKREG11,EXTNTCHK    GOTO CHECK IF THIS IS THE LAST TRACK 68100019
*                                                                       68160019
         BL    ASYEXIT             NO,EXIT TO SUPERVISOR                68220019
*                                                                       68280019
         OI    SGWKFLAG,LASTSEG    SET THIS IS THE LAST SEGMENT BIT     68340019
*                                                                       68400019
*********************************************************************** 68460019
*                                                                       68520019
ASYEXIT  EQU   *                                                        68580019
*                                                                       68640019
*********************************************************************** 68700019
*                                                                       68760019
*   EXIT TO SUPERVISOR ON REGISTER 14                                   68820019
*                                                                       68880019
*********************************************************************** 68940019
*                                                                       69000019
         LR    RETREG,SAVEREG      RESTORE RETURN REGISTER              69060019
         BR    RETREG              RETURN TO SUPERVISOR                 69120019
*                                                                       69180019
*********************************************************************** 69240019
*                                                                       69300019
NEXTSEG  EQU   *                                                        69360019
*                                                                       69420019
*********************************************************************** 69480019
*                                                                       69540019
*   THIS ROUTINE CONSTRUCTS WRITE/SN+N C.C. TO WRITE/R0 CHANNEL PROGRAM 69600019
*   AND ISSUES EXCP                                                     69660019
*                                                                       69720019
*********************************************************************** 69780019
*                                                                       69840019
         MVC   IOBDNRCF+SIX(ONE),DCBKEYLE    MOVE KEYLEN INTO SAVE AREA 69900019
         MVI   DCBKEYLE,NULL       SET KEYLEN=0                         69960019
*                                                                       70020019
         L     WKREG7,SGWKRCRD     OBTAIN RECORD AREA ADDRESS           70080019
         SR    WKREG6,WKREG6       RESET REG.6 TO '0'                   70140019
         STH   WKREG6,IOBDNRCF     STORE KEYLEN=0 INTO SAVE AREA        70200019
         IC    WKREG6,NULL(WKREG7) INSERT 1ST BYTE OF 'LL'              70260019
         SLL   WKREG6,EIGHT        SHIFT 1 BYTE LEFT                    70320019
         IC    WKREG6,ONE(WKREG7)  INSERT 2ND BYTE OF 'LL'              70380019
*                                                                       70440019
         SH    WKREG6,SGWKOFF      DATA LENGTH = 'LL' - SL (SEG. LNGTH) 70500019
         STH   WKREG6,IOBDNRCF+TWO STORE 'DL' INTO SAVE AREA            70560019
         AH    WKREG6,CONST8       ADD '8' TO 'DL' FOR 'SDW AND BDW'    70620019
         BAL   WKREG11,OVERHEAD    GOTO CALCULATE OVERHEAD              70740019
*                                                                       70800019
*                                                                       70803020
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  70812020
         SR    EPREG,EPREG              ZERO OUT A REGISTER      20201  70815020
         IC    WKREG11,DASDINTR         GET INTERMED REC OVHD    20201  70818020
         TM    DASDFLAG,TBOVHD          DEVICE WITH 2 BYTE OVHD  20201  70821020
         BNO   NOTRPS2A                 NO, USE INSERT IN REG    20201  70824020
         LH    WKREG11,DASDINTR         ELSE, GET 2 BYTE OVHD    20201  70827020
NOTRPS2A EQU  *                                                  20201  70830020
         IC    EPREG,DASDKEY            GET KEY OVERHEAD         20201  70833020
         SR    WKREG11,EPREG            GET REC OVHD - KEY OVHD  20201  70836020
         LH    EPREG,DASDLNGH           GET TRK CAPACITY         20201  70839020
         SR    EPREG,WKREG11            TRKCAP - REC OVHD - KEY  20201  70842020
*                                       OVHD                     20201  70845020
         SH    EPREG,CONST8             ALLOW FOR SDW & BDW      20201  70848020
         CH    EPREG,IOBDNRCF+TWO  TEST IF REMAINNING BYTES FITS        70860019
         BL    NOTFIT              NO,GOTO WRITE MIDLE SEGMENT          70920019
*                                                                       70980019
*   THIS IS TO WRITE/LAST SEGMENT                                       71040019
*                                                                       71100019
         LH    WKREG11,DASDLNGH         GET CAP OF TRK           20201  71160020
         SR    WKREG11,WKREG7           TRACK BAL=CAPACITY-INTERMEDIATE 71220019
         STC   WKREG11,IOBR0DAT+SIX     STORE LAST CHAR OF TRACK BAL    71280019
         SRL   WKREG11,EIGHT       SHIFT TO NEXT BYTES                  71340019
         STC   WKREG11,IOBR0DAT+FIVE    STORE 1ST CHAR OF TRACK BAL     71400019
*                                                                       71460019
         OI    SGWKFLAG,LASTSEG    SET THIS IS THE LAST SEGMENT BIT ON  71520019
         B     SKIP01              GOTO MOVE DATA ROUTINE               71580019
*                                                                       71640019
NOTFIT   EQU   *                                                        71700019
*                                                                       71760019
*   WHEN THE REMAINNING DATA IS LONGER THAN TRACK CAPACITY,SET TRACK    71820019
*   CAPACITY AS SEGMENT LENGTH                                          71880019
*                                                                       71940019
         STH   EPREG,IOBDNRCF+TWO  SAVE 'DL' IN WORK AREA               72000019
*                                                                       72060019
SKIP01   EQU   *                                                        72120019
*                                                                       72180019
         L     WKREG8,SGWKRCRD     LOAD ADDR OF 'LL' FIELD IN RECORD    72240019
         AH    WKREG8,SGWKOFF      ADD 'LL' TO POINT TO THE 1ST CHAR OF 72300019
*                                  THIS SEGMENT                         72360019
         LH    WKREG7,SGWKOFF      LOAD 'SL' OF PREVIOUS SEGMENTS       72420019
         AH    WKREG7,IOBDNRCF+TWO ADD 'SL'+'DL'='SL' UPTO THIS SEGMENT 72480019
         STH   WKREG7,SGWKOFF      STORE NEW 'SL' INTO 'OFFSET'         72540019
*                                                                       72600019
         LH    WKREG7,IOBDNRCF+TWO LOAD 'DL' OF THIS SEGMENT            72660019
         LA    WKREG7,EIGHT(WKREG7) ADD '8' FOR DW'S                    72720019
         STH   WKREG7,IOBDNRCF+TWO STORE 'DL+8' AS SEGMENT LENGTH       72780019
         SH    WKREG8,CONST8       MINUS '8' TO POINT TO THIS SEGMENT   72840019
*                                  -8                                   72900019
*                                                                       72960019
         BAL   WKREG11,MOVEDATA    GOTO MOVE SEGMENT                    73020019
*                                                                       73080019
         MVC   DCBKEYLE(ONE),IOBDNRCF+SIX    RESTORE KEYLEN INTO DCB    73140019
         TM    SGWKFLAG,LASTSEG    TEST IF LAST SEGMENT FLAG IS ON      73200019
         BNO   SETMDDLE            GOTO SET MIDDLE SEGMENT FLAG         73260019
*                                                                       73320019
         MVI   SGWKDATA+SIX,ENDSEG SET LAST SEGMENT BIT ON              73380019
         SR    WKREG6,WKREG6       DEVELOP MINIMUM SPACE...    @ZA15097 73387037
         IC    WKREG6,DASDLAST     ...REQD FOR...              @ZA15097 73394037
         AH    WKREG6,CONST8       ...ONE MORE RECORD          @ZA15097 73401037
         CH    WKREG6,DCBTRBAL     GREATER THAN TRBAL?         @ZA15097 73408037
         BNH   WRTSGCCW            NO - GO WRITE SEGMENT       @ZA15097 73415037
         OI    SGWKFLAG,WRITESZ    YES - IN R0 FOR CHK RTN     @ZA15097 73422037
         OI    DCBCIND1,NXT        AND NEXT WRITE REQUEST      @ZA15097 73429037
         B     WRTSGCCW            GOTO CONSTRUCT WRITE/SG CCW          73440019
*                                                                       73500019
SETMDDLE EQU   *                                                        73560019
*                                                                       73620019
         MVI   SGWKDATA+SIX,MDLSEG SET 'MIDLE SEGENT' BITS ON           73680019
*                                                                       73740019
WRTSGCCW EQU   *                                                        73800019
*                                                                       73860019
*                                                                       73920019
*   CONSTRUCTS WRITE/SEGMENT CHANNEL PROGRAM                            73980019
*                                                                       74040019
         SR    WKREG11,WKREG11          ZERO OUT A REG           20201  74060020
         IC    WKREG11,DCBOFFSW         GET OFFSET TO WRT CCW    20201  74080020
         AR    WKREG11,IOBREG           POINT TO WRT CCW         20201  74100020
         MVC   SIX(TWO,WKREG11),SGWKDATA  MOVE DATA LEN TO CCW   20201  74120020
         MVI   IOBDNRCF+FOUR,ONE        SET R=1                         74160019
         MVC   IOBDNRCF(FOUR),IOBSEEK+THREE  MOVE CCHH OF THIS TRACK    74220019
         MVI   IOBDNRCF+FIVE,NULL  SET KEY LENGTH = 0                   74280019
         MVC   IOBDNRCF+SIX(TWO),SGWKDATA MOVE 'DATA LENGTH'            74340019
*                                                                       74400019
         MVC   IOBR0DAT(FIVE),IOBDNRCF  MOVE 'CCHHR' TO R0 DATA FIELD   74460019
*                                                                       74520019
         LA    PARAM1,IOBFLAG1     LOAD IOS/IOB ADDR                    74580019
         L     WKREG6,IOBECBPT          LOAD USER DECB ADDR      YM3849 74630002
         STCM  WKREG6,B'0111',IOBIOBA+1 SAVE IN IOB PREF+4       YM3849 74632002
         LA    WKREG11,IOBCSW           GET CSW ADDRESS TO USE   YM3849 74634002
         ST    WKREG11,IOBECBPT         AS DUMMY ECB FOR IOS     YM3849 74636002
*                                       USER ECB PTR WILL BE     YM3849 74638002
*                                       RESTORED BY CEA(19BT)    YM3849 74638402
*                                                                       74760019
         EXCP  (1)                                                      74820019
*                                                                       74880019
         LR    RETREG,SAVEREG      RESTORE RETURN REGISTER              75000019
*                                                                       75060019
         BR    RETREG              GO BACK TO SUPERVISOR                75120019
*                                                                       75180019
*********************************************************************** 75240019
*                                                                       75300019
*********************************************************************** 75360019
*                                                                       75420019
*   CONSTANTS                                                           75480019
*                                                                       75540019
*********************************************************************** 75600019
*                                                                       75660019
CONST1   DC    H'1'                CONSTANT = 1                         75720019
CONST4   DC    H'4'                CONSTANT = 4                         75780019
CONST8   DC    H'8'                CONSTANT=8                           75840019
CONST10  DC    H'10'               CONSTANT=10                          75900019
*                                                                       75960019
CONST256 DC    H'256'              CONSTANT = 256                       76020019
CONST255 DC    H'255'              CONSTANT = 255                       76080019
MODID    DC    CL8'IGG019BR'            MODULE ID                Y02072 76090002
FIX      DC    C' Z15097 '              LATEST FIX              ZA10211 76100037
DATE     DC    CL8'&SYSDATE'            DATE OF LATEST FIX      ZA10211 76150037
PATCH    DC    XL100'0'                 PATCH AREA              ZA10211 76200037
         EJECT                                                          76260019
**********************************************************************  76320019
*                                                                       76380019
*    CONTROL BLOCK DEFINITIONS FOLLOW                                   76440019
*                                                                       76500019
**********************************************************************  76560019
         SPACE 2                                                        76620019
*                                                                       76680019
**********************************************************************  76740019
*                                                                       76800019
         DCBD  DSORG=(PS),DEVD=(DA)                                     76860019
*                                                                       76920019
*********************************************************************** 76980019
         EJECT                                                          77030002
         IECDSECS  EOVLAST,EXPAND=YES                            Y02072 77090002
         EJECT                                                          77100002
*                                                                       77160019
DEB      DSECT                          THIS DSECT DESCRIBES A DEB      77220019
DEBNMSUB DS    0CL1                    NO. OF SUB RTNS                  77280019
DEBTCBAD DS    CL4                     TASK CONTROL BLOCK ADDR          77340019
DEBAMLNG DS    0CL1                    LENGTH OF ACCESS METHOD SEC      77400019
DEBDEBAD DS    CL4                     ADDR OF NEXT DEB IN DEB CHAIN    77460019
DEBOFLGS DS    0CL1                    DEB OPEN FLAGS                   77520019
DEBIRBAD DS    CL4                     ADDR OF THE IRB CONTROL BLOCK    77580019
DEBOPATB DS    0CL1                    OPEN ATRIBUTES                   77640019
DEBSYSPG DS    CL4                     SYSTEM PURGE FIELD               77700019
DEBNMEXT DS    0CL1                    NUMBER OF EXTENTS IN DEB         77760019
DEBUSRPG DS    CL4                     USER PURGE FIELD                 77820019
DEBPRIOR DS    0CL1                    INFO BYTE                        77880019
DEBECBAD DS    CL4                     EVENT CONTROL BLOCK ADDR         77940019
DEBPROTG DS    0CL1                    INFO BYTE                        78000019
DEBDEBID DS    0CL1                    INFO BYTE                        78060019
DEBDCBAD DS    CL4                     ADDR OF DCB                      78120019
DEBEXSCL DS    0CL1                    SCALING FACTOR OF DEB EXTENT     78180019
DEBAPPAD DS    CL4                     APPENDAGE TABLE ADDR             78240019
DEBDVMOD DS    0CL1                    DEVICE MODIFIER BYTE             78300019
DEBUCBAD DS    CL4                     UNIT CTL BLOCK ADDR              78360019
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     78420019
DEBBINUM DS    CL2                     BIN NUMBER                       78480019
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   78540019
DEBSTRCC DS    CL2                     START CYLINDER NUMBER            78600019
DEBSTRHH DS    CL2                     START HEAD NUMBER                78660019
DEBENDCC DS    CL2                     END CYLINDER NUMBER              78720019
DEBENDHH DS    CL2                     END HEAD NUMBER                  78780019
DEBNMTRK DS    CL2                     NUMBER OF TRACKS                 78840019
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          78900019
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              78960019
DEBVOLSQ DS    H                       VOL SEQUENCE NUMBER              79020019
DEBVOLNM DS    H                       VOLUME NUMBER                    79080019
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     79140019
DEBSUBID DS    H                       SUBROUTINE ID ( 2 BYTES )        79200019
*                                                                       79260019
*********************************************************************** 79320019
*                                                                       79380019
         SPACE 5                                                        79440002
*********************************************************************** 79500019
*                                                                       79560019
IOBDEF   DSECT      I/O BLOCK DEFINITION                                79620019
IOBLINK  DS    F         IOB LINK ADDRESS                               79680019
IOBIOBA  DS    F         IOB ADDRESS FOR EOV                            79740019
IOBFLAG1 DS    CL1       ERROR FLAG 1                                   79800019
IOBFLAG2 DS    CL1       ERROR FLAG 2                                   79860019
IOBSENSE DS    CL2       I/O SENSE BITS                                 79920019
IOBECBPT DS    F         ECB ADDRESS                                    79980019
IOBCSW   DS    D         CSW STORED BY IOS                              80040019
IOBSIOCC DS    0BL1      SIO CONDITION CODE                             80100019
IOBSTART DS    F         CHANNEL PROGRAM STARTING CCW                   80160019
IOBDCBPT DS    F         DCB ADDRESS                                    80220019
IOBRESTR DS    F         CHANNEL PROGRAM RESTART ADDRESS                80280019
IOBINCAM DS    CL2       BLOCK INCREMENT AMOUNT                         80340019
IOBERRCT DS    CL2       ERROR COUNTS                                   80400019
IOBSEEK  DS    D         SEEK ADDRESS                                   80460019
IOBDNRCF DS    D         NEW RECORD COUNT FIELD                         80520019
IOBR0CNT DS    D         COUNT FIELD OF R0                              80580019
IOBR0DAT DS    D         DATA FIELD OF R0                               80640019
IOBCCW1  DS    D         FIRST CCW OF CHANNEL PROGRAM                   80700019
IOBCCW2  DS    D         2ND CCW OF CHANNEL PROGRAM                     80760019
IOBCCW3  DS    D         3RD CCW OF CHANNEL PROGRAM                     80820019
IOBCCW4  DS    D         4TH CCW OF CHANNEL PROGRAM                     80880019
IOBCCW5  DS    D         5TH CCW OF CHANNEL PROGRAM                     80940019
IOBCCW6  DS    D         6TH CCW OF CHANNEL PROGRAM                     81000019
IOBCCW7  DS    D         7TH CCW OF CHANNEL PROGRAM                     81060019
IOBCCW8  DS    D         8TH CCW OF CHANNEL PROGRAM                     81120019
IOBCCW9  DS    D         9TH CCW OF CHANNEL PROGRAM                     81180019
IOBCCW10 DS    D         10TH CCW OF CHANNEL PROGRAM                    81240019
IOBCCW11 DS    D         11TH CCW OF CHANNEL PROGRAM                    81300019
IOBCCW12 DS    D         12TH CCW OF CHANNEL PROGRAM                    81360019
IOBCCW13 DS    D         13TH CCW OF CHANNEL PROGRAM                    81420019
IOBCCW14 DS    D         LAST CCW OF LONGEST CHANNEL PROGRAM            81480019
*                                                                       81540019
OFFTOMAX EQU   IOBCSW-IOBDEF                                            81600019
OFFTONEW EQU   IOBCSW+FOUR-IOBDEF                                       81660019
*                                                                       81720019
         SPACE 2                                                        81780019
**********************************************************************  81840019
*                                                                       81900019
*  DSECT FOR DECB                                                       81960019
*                                                                       82020019
*********************************************************************** 82080019
DECBDEF  DSECT     DATA EVENT CONTROL BLOCK                             82140019
DECSDECB DS    F         STANDARD ECB                                   82200019
DECTYPE  DS    CL2       TYPE AND OPTIONS                               82260019
DECLNGTH DS    CL2       DATA LENGTH                                    82320019
DECDCBAD DS    F         DCB ADDRESS                                    82380019
DECAREA  DS    F         AREA ADDRESS                                   82440019
DECIOBPT DS    F         IOB ADDRESS                                    82500019
DECNEXT  DS    F                   NEXT ADDRESS                         82560019
         SPACE 2                                                        82620019
*********************************************************************** 82680019
*                                                                       82740019
         SPACE 3                                                        82800019
*                                                                       82860019
*********************************************************************** 82920019
*                                                                       82980019
*   DSECT FOR SEGMENT WORK AREA CONTROL BLOCK - 8 BYTES                 83040019
*                                                                       83100019
*********************************************************************** 83160019
*                                                                       83220019
SWACB    DSECT                                                          83280019
*                                                                       83340019
SWACBPTR DS    AL4                 POINTER TO THE 1ST SEG. WORK AREA    83400019
SWACBNO  DS    H                   NUMBER OF SEGMENT WORK AREAS         83460019
SWACBLNG DS    H                   LENGTH OF A SEGMENT WORK AREA        83520019
SWACBTT  DS    H                   TT OF THIS VOLUME RELATIVE TO THE    83580019
*                                  BEGINNING OF DATA SET                83640019
         DS    H                   NOT USED                             83700019
*                                                                       83760019
         SPACE 3                                                        83820019
*                                                                       83880019
*********************************************************************** 83940019
*                                                                       84000019
*   DSECT FOR SEGMENT WORK AREA                                         84060019
*                                                                       84120019
*********************************************************************** 84180019
*                                                                       84240019
SGWKAREA DSECT                                                          84300019
*                                                                       84360019
SGWKPTR  DS    AL4                 POINTER TO NEXT SEG WORK AREA        84420019
SGWKRCRD DS    AL4                 POINTER TO RECORD AREA               84480019
*                                                                       84540019
SGWKFLAG EQU   SGWKRCRD            FLAG BYTES                           84600019
*                                                                       84660019
SPANVLM  EQU   X'80'               SPAN VOLUME                          84720019
LASTSEG  EQU   X'40'               LAST SEGMENT WAS WRITTEN             84780019
ASYCNTRL EQU   X'20'               ASYNCHRONOU RTN IS IN CONTROL        84840019
*                                                                       84900019
SGWKOFF  DS    H                   OFFSET OF THE CURRENT SEGMENT        84960019
SGWKDATA DS    0H                  SEGMENT AREA                         85020019
*                                                                       85080019
         SPACE 3                                                        85140019
*                                                                       85200019
*********************************************************************** 85260019
*                                                                       85320019
*   DSECT FOR DASD DEVICE CHARACTERISTIC TABLE                          85380019
*                                                                       85440019
*********************************************************************** 85500019
*                                                                       85560019
DASDTBL  DSECT                                                          85620019
*                                                                       85680019
DASDCYL  DS    H                   NO. OF CYLINDERS                     85740019
DASDTRK  DS    H                   NO. OF TRACKS/CYLINDER               85800019
DASDLNGH DS    H                   TRACK LENGTH                         85860019
DASDINTR DS    AL1                 OVERHEAD FOR INTERMEDIATE RECORD     85920019
DASDLAST DS    AL1                 OVERHEAD FOR LAST RECORD             85980019
DASDKEY  DS    AL1                 OVERHEAD FOR KEY                     86040019
DASDFLAG DS    AL1                 FLAGS                                86100019
*                                                                       86160019
BYTEMODE EQU   X'02'               MBBCCHHR IS BY BYTE (2321)           86220019
TOLERANC EQU   X'01'               TOLERANCE FACTOR MUST BE ADDED       86280019
*                                                                       86340019
DASDTOL  DS    AL2                 TOLERANCE FACTOR                     86400019
*                                                                       86460019
         SPACE 2                                                        86520019
UCB      DSECT                                                  ZM40313 86580037
         IEFUCBOB   LIST=YES                                    ZM40313 89580037
         END                                                            92580037
./  ADD  SSI=31360164,NAME=IGG019BS
   TITLE 'IGG019BS - CHECK ROUTINE, VS-BDAM DATA SET CREATION'          00012019
IGG019BS CSECT                                                          00013019
*MODULE NAME = IGG019BS                                               * 00015002
*                                                                     * 00017002
*DESCRIPTIVE NAME = BDAM CREATE CHECK MODULE FOR VS RECORD FORMAT     * 00019002
*                                                                     * 00019402
*COPYRIGHT = NONE                                                     * 00019802
*                                                                     * 00019902
*CHANGE ACTIVITY                                                      * 00023202
*                                                                     * 00025202
*        VS1-1 CHANGES/DELETIONS                                        00080002
*        VS2-1 CHANGES/DELETIONS                                        00090002
*        VS1-2 CHANGES/DELETIONS                                        00100002
*        VS2-2 CHANGES/DELETIONS                                        00100402
*153000,201000,219000,222000,267000,270000,285000,291000-297000,309000, 00100802
*312000,522000,552000-561000                                     Y02072 00100902
*                                                                       00101019
*STATUS CHANGE LEVEL 1                                                  00110002
*                                                                       00111019
*FUNCTIONS- THIS ROUTINE IS ENTERED BY THE CHECK MACRO ISSUED BY THE    00120019
*    PROBLEM PROGRAM FOLLOWING A WRITE.                                 00130019
*    1. IT RECEIVES CONTROL WHEN THE PROCESSING PROGRAM USES THE        00140019
*       CHECK MACRO-INSTRUCTION.                                        00150019
*    2. IF THE CHANNEL PROGRAM IS NOT YET EXECUTED, THE MODULE          00160019
*       ISSUES A WAIT MACRO-INSTRUCTION.                                00170019
*    3. IF A USER SPECIFIES WRITE-SFR, THE NEXT RECORD ADDRESS          00180019
*       (TTR) IS SUPPLIED IN THE NEXT ADDRESS FIELD OF THE DECB.        00190019
*    4. IF THE EXECUTION OF THE CHANNEL PROGRAM ENCOUNTERED A           00200019
*       PERMANENT ERROR CONDITION, THE MODULE PASSES CONTROL TO         00210019
*       THE PROCESSING PROGRAM'S SYNAD ROUTINE.  IF CONTROL IS          00220019
*       RETURNED FROM THE SYNAD ROUTINE, OR IF THERE IS NO SYNAD        00230019
*       ROUTINE, THE MODULE ISSUES AN DMABCOND OR EOV MACRO.            00240002
*    5. IF THE WRITE ROUTINE ENCOUNTERED AN EOV CONDITION (AND,         00250019
*       THEREFORE DID NOT REQUEST SCHEDULING OF THE CHANNEL PROGRAM     00260019
*       FOR EXECUTION), THIS MODULE PASSES CONTROL TO THE SYNAD/EOV     00270019
*       EXECUTOR (IGG0005E) BY ISSUING AN SVC 55 INSTRUCTION.  ON       00280019
*       RETURN OF CONTROL THIS MODULE TESTS FOR COMPLETION OF THE       00290019
*       CHANNEL PROGRAM.                                                00291019
*                                                                       00291119
*ENTRY POINTS- 'IGG019BS' IS THE ENTRY FROM THE CHECK MACRO EXPANSION   00292019
*    BY THE CALLING SEQUENCE-      L    15,DCBCHECK                     00293019
*                                  BALR 14,15                           00294019
*                                                                       00295019
*INPUT- INPUT TO THE CHECK MACRO IS THE ADDRESS OF THE DECB ASSIGNED TO 00296019
*    THE WRITE TO BE CHECKED. THIS ADDRESS WILL BE LOADED INTO          00297019
*    REGISTER 1 PRIOR TO ENTERING THIS ROUTINE.                         00298019
*                                                                       00299019
*OUTPUT- THE IOB USED FOR THE WRITE IS MADE AVAILABLE SO THAT IT MAY    00299119
*    BE REUSED BY THE WRITE ROUTINE.                                    00299219
*    IF THE EXIT TO THE USER'S ERROR ROUTINE IS TAKEN, REGISTER 0 WILL  00299319
*    CONTAIN THE DECB ADDRESS AND REGISTER 1 THE DCB ADDRESS AND A      00299419
*    WRITE INDICATOR.                                                   00299519
*    IF THE USER SPECIFIED 'NEXT ADDRESS' THE RELATIVE ADDRESS (TTR)    00299619
*    OF THE NEXT RECORD (NOT YET WRITTEN) WILL BE RETURNED              00299719
*                                                                       00299819
*EXTERNAL ROUTINES-                                                     00299919
*                                                                       00300019
*EXITS- 'USEREXIT' IS THE EXIT TO RETURN TO THE PROBLEM PROGRAM ON      00300119
*    NORMAL COMPLETION.                                                 00300219
*    'SYNCEXIT' IS THE EXIT TO THE USER'S SYNCHRONOUS ERROR ROUTINE.    00300319
*    'ABEXIT' IS AN EOV EXIT WHEN THE WRITE COMPLETED IN ERROR AND NO   00300502
*    SYNCHRONOUS ERROR ROUTINE IS SPECIFIED. ABEND 001 AND WTP RESULTS. 00300602
*    'SYNCRET' AND 'SYNCRET1' ARE ABENDS WHICH WILL OCCUR IF THE USER   00300702
*    RETURNS FROM HIS SYNAD ROUTINE EITHER WHEN NO SPACE ON THE         00338102
*    VOLUMES IS AVAILABLE OR THE USER HAS HAD AN IO ERROR AND WENT TO   00348102
*    HIS SYNAD ROUTINE FIRST. DMABCOND MACRO IS ISSUED TO TRANSFER      00358102
*    CONTROL TO PROBLEM DETERMINATION WHICH WILL ISSUE A WTP MESSAGE    00368102
*    AND GTRACE PERTINENT CONTROL BLOCKS BEFORE ABENDING WITH A 008.    00370102
*                                                                       00413002
*TABLES/WORK AREAS-                                                     00450402
*                                                                       00487802
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.            00525202
*                                                                       00562602
*                                                                       00600019
*                         REGISTER EQUATES                              00900019
*                                                                       01200019
RWORK0   EQU   0                        WORK REG                        01500019
R0       EQU   0                        DECB REG-USER SYNAD EXIT Y02072 01550002
RPARM    EQU   1                        PARAMETER REG                   01800019
RWORK3   EQU   1                        WORK REG                 Y02072 01850002
R1       EQU   1                        DCB REG-USER SYNAD EXIT  Y02072 01900002
RPARM2   EQU   2                        PARM REG FOR CONVERSION ROUT    02100019
R2       EQU   2                        SAVE/RESTORE REG         Y02072 02150002
RDCB     EQU   3                        DCB REG                         02400019
RDECB    EQU   4                        DECB REG                        02700019
RIOB     EQU   5                        IOB REG                         03000019
RBASE    EQU   6                        BASE REG                        03300019
RWORK1   EQU   7                        WORK REG                        03600019
RCVT     EQU   8                        CVT REG                         03900019
R8       EQU   8                        SAVE/RESTORE REG         Y02072 03950002
R10      EQU   10                       SAVE/RESTORE REG         Y02072 04000002
R11      EQU   11                       SAVE/RESTORE REG         Y02072 04050002
R12      EQU   12                       SAVE/RESTORE REG                04210002
SAVEREG  EQU   13                       SAVE REGISTER                   04500019
RETURN   EQU   14                       RETURN REG                      04800019
R14      EQU   14                       SAVE/RESTORE REG         Y02072 04850002
RENTER   EQU   15                       ENTRY REG                       05100019
*                                                                       05400019
*                         CONSTANT EQUATES                              05700019
*                                                                       06000019
NULL     EQU   0                        ZERO                            06300019
TWO      EQU   2                        CONSTANT = 2                    06600019
ADDRLEN  EQU   3                        LENGTH OF AN ADDRESS            06900019
MBBLEN   EQU   3                        LENGTH OF MBB FIELD             07200019
CHAIN    EQU   4                        OFFSET TO IOB CHAIN             07500019
FOUR     EQU   4                        CONSTANT                        07800019
CCHHRLEN EQU   5                        LENGTH OF CCHHR FIELD           08100019
VOLMTT   EQU   8                        OFFSET TO THE VOL TT IN SWA CB  08400019
MSTRTT   EQU   10                       OFFSET TO MASTER TT IN SWA CB   08700019
BYTELEN  EQU   8                        BITS PER BYTE                   09000019
DECBERBT EQU   X'60'                    DECB ERROR BITS                 09600019
AVAIL    EQU   X'7F'                    AVAILABILITY BIT                09900019
UNITEXCP EQU   X'01'                    UNIT EXCEPTION BIT              10200019
WRITE    EQU   X'40'                    WRITE INDICATOR IN DECB         10500019
SYNADBIT EQU   X'01'                    SYNC ROUTINE BIT IN DCB         10800019
EOVBIT   EQU   X'80'                    EOV BIT IN IOB                  11100019
APRLTV   EQU   X'20'                    OFFSET TO CONVERSION ROUTINE    11400019
R0WRITE  EQU   X'04'                    WRITE R0 BIT IN SWA             11700019
NXTADDR  EQU   X'01'                    TYPE = 'R'                      12000019
INCRTT   EQU   X'000101'                TO INCREMENT RELATIVE TRACK     12300019
INCRR    EQU   X'000001'                TO INCREMENT RELATIVE RECORD    12600019
ONE      EQU   1                        CONSTANT = 1                    12900019
NOT      EQU   X'FF'                    CONSTANT = X'FF'                13200019
         USING IGG019BS,RBASE                                           13500019
         USING IOBDEF,RIOB                                              13800019
         USING IHADCB,RDCB                                              14100019
         USING DECBDEF,RDECB                                            14400019
         USING SAVEAREA,SAVEREG                                  Y02072 14450002
         USING SGWKAREA,RWORK1                                          14700019
         USING CVT,RCVT                                                 15000019
SAVEREGS EQU   *                        INITIALIZE REGS          Y02072 15050002
*                                                                       15052002
*  REGISTERS 14-10 ARE SAVED AT AN OFFSET OF 20 IN THE SAVEAREA TO      15060002
*  MAINTAIN COMPATABILITY WITH SAM AND PROVIDE EOV WITH A SINGLE        15070002
*  SAM/DAM INTERFACE. IT IS LIKEWISE NECESSARY, HOWEVER, TO SAVE REGS   15080002
*  11 AND 12 BECAUSE THEY ARE CLOBBERED BY THE SYSTEM CONVERT ROUTINE.  15090002
*                                                                       15092002
         STM   R14,R10,SAVER14          SAVE USER REGS           Y02072 15100002
         STM   R11,R12,SAVER11          SAVE REGS 11 AND 12 TOO  Y02072 15150002
         LR    RBASE,RENTER             SET BASE REG                    15600019
         LR    RDECB,RPARM              SAVE DECB ADDR                  15900019
         L     RDCB,DECDCBAD            DCB ADDR                        16200019
         L     RIOB,DECIOBPT            IOB ADDR                        16500019
         SH    RIOB,PREFXLEN            SAM IOB ADDR                    16800019
         TM    IOBLINK,EOVBIT           WAS THIS IOB SCHEDULED          17100019
         BZ    POSTCHK                  YES--BRANCH                     17400019
*                                       NO--SET UP FOR  EOV             17700019
EOVGO    EQU   *                                                        18000019
         L     RWORK1,DCBIOBA           ADDR OF LAST IOB USED           18300019
         IC    RWORK0,CHAIN(RWORK1)     SAVE FIRST BYTE OF EOV IOB PTR  18600019
         ST    RIOB,CHAIN(RWORK1)       LINK THIS IOB TO EOV IOB        18900019
         STC   RWORK0,CHAIN(RWORK1)     RESTORE FIRST BYTE              19200019
         LR    RWORK0,RIOB              IOB ADDR                        19500019
         OI    IOBSTAT1,UNITEXCP        TURN ON UNIT EXCEPTION BIT      19800019
         EOV   (RDCB)                   GO TO EOV                Y02072 20400002
         LTR   RENTER,RENTER            OUT OF SPACE                    20700019
         BZ    SPACE                    NO--BRANCH                      21000019
         BALR  RETURN,RENTER            YES--GO TO SYNAD, EOV HAS       21300002
*                                       LOADED USER SYNAD ADDR IN R15   21350002
         USING *,RETURN                                                 21600019
SYNCRET1 EQU   *                        GO TO PROB DET-NO SPACE  Y02072 21650002
         L     RDECB,SAVER1             GET INPUT DECB ADDR      Y02072 21652002
         L     RDCB,DECDCBAD            GET DCB ADDR AGAIN       Y02072 21654002
         DMABCOND  209,SVC=YES,DCB=(RDCB)  BR TO PROB DETERMIN   Y02072 21700002
*                                       TO ABEND WITH 008        Y02072 21750002
         DROP  RETURN                                                   22500019
*                                                                       22800019
SPACE    EQU   *                                                        23100019
*                                                                       23400019
         L     RDCB,DECDCBAD            RESTORE DCB ADDR                23700019
POSTCHK  EQU   *                                                        24000019
         TM    DECSDECB,DECBERBT        WAS DECB POSTED WITHOUT ERROR   24300019
         BO    TTRFDBAK                 YES--GO CALCULATE NEXT ADDR     24600019
         BZ    CHKWAIT                  NOT POSTED--SET UP FOR WAIT     24900019
*                                       ERROR CONDITION                 25200019
         TM    DCBSYNAD+ADDRLEN,SYNADBIT WAS SYNAD SPECIFIED            25500019
         BZ    SYNCEXIT                 YES                             25800019
*                                                                       26100019
ABEXIT   EQU   *                                                        26400019
         LH    RWORK0,ABCODE1           PUT 001 ABEND CODE IN R0 Y02072 27100002
         EOV   (RDCB)                   GO TO EOV TO ABEND 001   Y02072 27150002
*                                                                       27300019
SYNCEXIT EQU   *                                                        27600019
*  SET UP FOR USER'S SYNCHRONOUS ERROR ROUTINE                          27900019
*                                                                       28200019
         LR    R0,RDECB                 PUT DECB ADDR IN R0      Y02072 28250002
         MVI   DECDCBAD,WRITE           SET WRITE INDICATOR IN DECB     28800019
         L     R1,DECDCBAD              PUT DCB ADDR IN R1       Y02072 28850002
         L     RENTER,DCBSYNAD          PUT SYNAD ADDR IN R15    Y02072 28900002
         LM    R2,R8,SAVER2             RESTORE REGS 2-8         Y02072 28950002
         BALR  RETURN,RENTER            GO TO SYNC ERROR ROUTINE        30000019
         USING *,RETURN                                                 30300019
*                                                                       30600019
SYNCRET  EQU   *                        ABEND WITH IO ERROR      Y02072 30650002
         L     RDECB,SAVER1             GET INPUT DECB ADDR      Y02072 30652002
         L     RDCB,DECDCBAD            GET DCB ADDR AGAIN       Y02072 30654002
         DMABCOND  210,SVC=YES,DCB=(RDCB)  BR TO PROB DETERMIN   Y02072 30700002
*                                       ABEND 008 WITH IO ERROR  Y02072 30750002
         DROP  RETURN                                                   31500019
*                                                                       31800019
TTRFDBAK EQU   *                                                        32100019
*                                                                       32400019
*   THE WRITE HAS COMPLETED SUCCESSFULLY, NOW THE RELATIVE TTR OF       32700019
*   WHERE THE NEXT RECORD WILL BE WRITTEN MUST BE CALCULATED.  THIS     33000019
*   TTR WILL BE RELATIVE TO THE BEGINNING OF THE DATA SET, NOT THE      33300019
*   EXTENT.                                                             33600019
*                                                                       33900019
         LA    RPARM2,IOBSEEK           ADDR OF ACTUAL BLK ADDR         34200019
         L     RPARM,DCBDEBAD           ADDR OF DEB                     34500019
         L     RCVT,CVTPTR              CVT ADDR                        34800019
         L     RENTER,CVTPRLTV          CONVERSION ROUTINE ADDR         35100019
         LR    RCVT,SAVEREG             SAVE REG                        35400019
         BALR  RETURN,RENTER            BRANCH TO IECPRLTV              35700019
         LR    SAVEREG,RCVT             RESTORE REG                     36000019
         SRL   RWORK0,BYTELEN           RIGHT ADJUST TTR IN REGISTER    36300019
         IC    RWORK0,IOBDNRCF+FOUR     SET R=R                         36600019
         LR    RPARM2,RWORK0            SAVE TTR REG.                   36900019
*                                                                       37200019
*   IF A TRACK HAS JUST BEEN FILLED, RELATIVE TRACK MUST BE INCREMENTED 37500019
*   IF NOT, RELATIVE RECORD MUST BE INCREMENTED.                        37800019
*                                                                       38100019
         LR    RWORK1,RIOB              IOB ADDR                        38400019
         LA    RWORK1,NULL(RWORK1)                                      38700019
         SR    RWORK3,RWORK3            CLEAR FOR IC                    39000019
         IC    RWORK3,DCBOFFSW          OFFSET TO WRITE CCW             39300019
         AR    RWORK1,RWORK3            WRITE CCW ADDR                  39600019
         L     RWORK1,NULL(RWORK1)      PTR TO SWA + 10                 39900019
         LA    RWORK1,NULL(RWORK1)                                      40200019
         SH    RWORK1,SWAPRFXL          SWA ADDR                        40500019
         TM    SGWKRCRD,R0WRITE         WAS R0 INCLUDED IN LAST WRITE   40800019
         BZ    INCRMNTR                 NO--BRANCH                      41100019
         NI    SGWKFLAG,NOT-R0WRITE     RESET WRITE/R0 BIT              41400019
         SRL   RPARM2,BYTELEN           ZERO RELATIVE RECORD            41700019
         SLL   RPARM2,BYTELEN           SET TO TTR R=0                  42000019
         LA    RPARM2,INCRTT(RPARM2)    INCREMENT RELATIVE TRACK        42300019
         B     ADDMASTR                 GO TO ADD TTR TO MASTER TTR     42600019
INCRMNTR EQU   *                                                        42900019
         LA    RPARM2,INCRR(RPARM2)     INCREMENT RELATIVE RECORD       43200019
ADDMASTR EQU   *                                                        43500019
         L     RCVT,DCBEOBW             SWA CONTROL BLOCK ADDR          43800019
         LH    RWORK3,MSTRTT(RCVT)      MASTER TTR                      44100019
         SLL   RWORK3,BYTELEN           SHIFT FOR 0TTR ALLIGNMENT       44400019
         LR    RETURN,RPARM2            SAVE VOLUME 'TT'                44700019
         AR    RPARM2,RWORK3            ADD TTR AND MASTER TT           45000019
         TM    DECTYPE+ONE,NXTADDR      TEST IF NEXT ADDR IS SPECIFIED  45300019
         BNO   GOSPNVLM                 NO,GOTO CHECK SPAN VOLUME       45600019
         L     RPARM,DECNEXT            PTR TO NEXT ADDRESS FIELD       45900019
         STC   RPARM2,TWO(RPARM)        STORE R OF TTR IN USER'S AREA   46200019
         SRL   RPARM2,BYTELEN           DELETE LAST BYTE                46500019
         STC   RPARM2,ONE(RPARM)        STORE T1 OF TTR IN USER'S AREA  46800019
         SRL   RPARM2,BYTELEN           DELETE LAST BYTE                47100019
         STC   RPARM2,NULL(RPARM)       STORE T2 OF TTR IN USER'S AREA  47400019
*                                                                       47700019
GOSPNVLM EQU   *                                                        48000019
*                                                                       48300019
*   TEST IF THIS WAS A SPANNED VOLUME RECORD                            48600019
*        YES - GOTO EOV ROUTINE TO ALLOCATE MORE SPACE                  48900019
*        NO  - GO BACK TO THE USER                                      49200019
*                                                                       49500019
         SRL   RETURN,BYTELEN           SET TO TT                       49800019
         STH   RETURN,VOLMTT(RCVT)      STORE UPDATED MASTER TTR        50100019
*                                                                       50400019
         TM    SGWKFLAG,SPANVLM         TEST IF THIS IS SPANNED VOLUME  50700019
         BO    EOVGO                    YES,GOTO TO ISSUE EOV           51000019
*                                                                       51300019
USEREXIT EQU   *                                                        51600019
         NI    IOBIOBA,AVAIL            MAKE IOB AVAILABLE              51900019
         LM    R14,R10,SAVER14          RESTORE USER REGS        Y02072 52250002
         LM    R11,R12,SAVER11          RESTORE R11 AND R12      Y02072 52260002
         BR    R14                      RETURN TO USER           Y02072 52300002
*                                                                       52500019
*                                                                       52800019
CHKWAIT  EQU   *                                                        53100019
         LR    RPARM,RDECB              PUT DECB ADDR IN R1 FOR WAIT    53400002
         WAIT  ,ECB=(1)                 WAIT FOR WRITE TO COMPLETE      53700019
         B     SPACE                    GO TO CHECK FOR ERROR           54000019
*                                                                       54300019
*                                                                       54600019
         DS    0H                       ALIGNMENT                Y02072 54900002
ABCODE1  DC    XL2'1000'                NO SYNAD RTN - IO ERROR  Y02072 55500002
PREFXLEN DC    H'8'                     IOB PREFIX LENGTH               56400019
SWAPRFXL DC    H'10'                    SWA PREFIX LENGTH               56700019
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 56750002
         EJECT                                                          57000019
**********************************************************************  57300019
*                                                                       57600019
*    CONTROL BLOCK DEFINITIONS FOLLOW                                   57900019
*                                                                       58200019
**********************************************************************  58500019
SAVEAREA DSECT                          USER SAVEAREA            Y02072 58750002
         DS    XL12                     UNUSED BY THIS MOD       Y02072 58760002
SAVER11  DS    A                        REG 11 SAVED             Y02072 58762002
SAVER12  DS    A                        REG 12 SAVED             Y02072 58764002
SAVER14  DS    A                        REG 14 SAVED             Y02072 58770002
SAVER15  DS    A                        REG 15 SAVED             Y02072 58780002
SAVER0   DS    A                        REG 0 SAVED              Y02072 58790002
SAVER1   DS    A                        REG 1 SAVED              Y02072 58792002
SAVER2   DS    A                        REG 2 SAVED              Y02072 58794002
SAVER3   DS    A                        REG 3 SAVED              Y02072 58796002
SAVER4   DS    A                        REG 4 SAVED              Y02072 58798002
SAVER5   DS    A                        REG 5 SAVED              Y02072 58798402
SAVER6   DS    A                        REG 6 SAVED              Y02072 58798802
SAVER7   DS    A                        REG 7 SAVED              Y02072 58799202
SAVER8   DS    A                        REG 8 SAVED              Y02072 58799602
SAVER9   DS    A                        REG 9 SAVED              Y02072 58799702
SAVER10  DS    A                        REG 10 SAVED             Y02072 58849702
*                                                                       58949702
*                                                                       60000019
CVT      DSECT                                                          60300019
*                                                                       60600019
         CVT                                                            60900019
*                                                                       61200019
         SPACE 2                                                        61500019
*                                                                       61800019
**********************************************************************  62100019
*                                                                       62400019
         DCBD  DSORG=(PS),DEVD=(DA)                                     62700019
*                                                                       63000019
*********************************************************************** 63300019
*                                                                       63600019
*   DSECT FOR IOB                                                       63900019
*********************************************************************** 64200019
*                                                                       64500019
IOBDEF   DSECT           I/O BLOCK DEFINITION                           64800019
IOBLINK  DS    F         IOB LINK ADDRESS                               65100019
IOBIOBA  DS    F         IOB ADDRESS FOR EOV                            65400019
IOBFLAG1 DS    CL1       ERROR FLAG 1                                   65700019
IOBFLAG2 DS    CL1       ERROR FLAG 2                                   66000019
IOBSENSE DS    CL2       I/O SENSE BITS                                 66300019
IOBECBPT DS    F         ECB ADDRESS                                    66600019
IOBCSW   DS    D         CSW STORED BY IOS                              66900019
IOBSTAT1 EQU   IOBCSW+4  CSW STATUS BYTE                                67200019
IOBSIOCC DS    0BL1      SIO CONDITION CODE                             67500019
IOBSTART DS    F         CHANNEL PROGRAM STARTING CCW                   67800019
IOBDCBPT DS    F         DCB ADDRESS                                    68100019
IOBRESTR DS    F         CHANNEL PROGRAM RESTART ADDRESS                68400019
IOBINCAM DS    CL2       BLOCK INCREMENT AMOUNT                         68700019
IOBERRCT DS    CL2       ERROR COUNTS                                   69000019
IOBSEEK  DS    D         SEEK ADDRESS                                   69300019
IOBDNRCF DS    D         NEW RECORD COUNT FIELD                         69600019
IOBR0CNT DS    D         COUNT FIELD OF R0                              69900019
IOBR0DAT DS    D         DATA FIELD OF R0                               70200019
IOBCCW1  DS    D         FIRST CCW OF CHANNEL PROGRAM                   70500019
IOBCCW2  DS    D         2ND CCW OF CHANNEL PROGRAM                     70800019
IOBCCW3  DS    D         3RD CCW OF CHANNEL PROGRAM                     71100019
IOBCCW4  DS    D         4TH CCW OF CHANNEL PROGRAM                     71400019
IOBCCW5  DS    D         5TH CCW OF CHANNEL PROGRAM                     71700019
IOBCCW6  DS    D         6TH CCW OF CHANNEL PROGRAM                     72000019
IOBCCW7  DS    D         7TH CCW OF CHANNEL PROGRAM                     72300019
IOBCCW8  DS    D         8TH CCW OF CHANNEL PROGRAM                     72600019
IOBCCW9  DS    D         9TH CCW OF CHANNEL PROGRAM                     72900019
IOBCCW10 DS    D         10TH CCW OF CHANNEL PROGRAM                    73200019
IOBCCW11 DS    D         11TH CCW OF CHANNEL PROGRAM                    73500019
IOBCCW12 DS    D         12TH CCW OF CHANNEL PROGRAM                    73800019
IOBCCW13 DS    D         13TH CCW OF CHANNEL PROGRAM                    74100019
IOBCCW14 DS    D         LAST CCW OF LONGEST CHANNEL PROGRAM            74400019
*                                                                       74700019
OFFTOMAX EQU   IOBCSW-IOBDEF                                            75000019
OFFTONEW EQU   IOBCSW+FOUR-IOBDEF                                       75300019
*                                                                       75600019
         SPACE 2                                                        75900019
**********************************************************************  76200019
*                                                                       76500019
*  DSECT FOR DECB                                                       76800019
*                                                                       77100019
*********************************************************************** 77400019
DECBDEF  DSECT           DATA EVENT CONTROL BLOCK                       77700019
DECSDECB DS    F         STANDARD ECB                                   78000019
DECTYPE  DS    CL2       TYPE AND OPTIONS                               78300019
DECLNGTH DS    CL2       DATA LENGTH                                    78600019
DECDCBAD DS    F         DCB ADDRESS                                    78900019
DECAREA  DS    F         AREA ADDRESS                                   79200019
DECIOBPT DS    F         IOB ADDRESS                                    79500019
DECNEXT  DS    F         NEXT ADDRESS                                   79800019
         SPACE 2                                                        80100019
         SPACE 3                                                        81000019
*                                                                       81300019
*********************************************************************** 81600019
*                                                                       81900019
*   DSECT FOR SEGMENT WORK AREA CONTROL BLOCK - 8 BYTES                 82200019
*                                                                       82500019
*********************************************************************** 82800019
*                                                                       83100019
SWACB    DSECT                                                          83400019
*                                                                       83700019
SWACBPTR DS    AL4       POINTER TO THE 1ST SEG. WORK AREA              84000019
SWACBNO  DS    H         NUMBER OF SEGMENT WORK AREAS                   84300019
SWACBLNG DS    H         LENGTH OF A SEGMENT WORK AREA                  84600019
SWACBTT  DS    H         TT OF THIS VOLUME RELATIVE TO THE              84900019
*                        BEGINNING OF DATA SET                          85200019
         DS    H         NOT USED                                       85500019
*                                                                       85800019
         SPACE 3                                                        86100019
*********************************************************************** 86700019
*                                                                       87000019
*   DSECT FOR SEGMENT WORK AREA                                         87300019
*                                                                       87600019
*********************************************************************** 87900019
*                                                                       88200019
SGWKAREA DSECT                                                          88500019
*                                                                       88800019
SGWKPTR  DS    AL4       POINTER TO NEXT SEG WORK AREA                  89100019
SGWKRCRD DS    AL4       POINTER TO RECORD AREA                         89400019
*                                                                       89700019
SGWKFLAG EQU   SGWKRCRD  FLAG BYTES                                     90000019
*                                                                       90300019
SPANVLM  EQU   X'80'     SPAN VOLUME                                    90600019
LASTSEG  EQU   X'40'     LAST SEGMENT WAS WRITTEN                       90900019
*                                                                       91200019
SGWKOFF  DS    H         OFFSET OF THE CURRENT SEGMENT                  91500019
SGWKDATA DS    0H        SEGMENT AREA                                   91800019
*                                                                       92100019
         SPACE 3                                                        92400019
*********************************************************************** 93000019
*                                                                       93300019
*   DSECT FOR DASD DEVICE CHARACTERISTIC TABLE                          93600019
*                                                                       93900019
*********************************************************************** 94200019
*                                                                       94500019
DASDTBL  DSECT                                                          94800019
*                                                                       95100019
DASDCYL  DS    H         NO. OF CYLINDERS                               95400019
DASDTRK  DS    H         NO. OF TRACKS/CYLINDER                         95700019
DASDLNGH DS    H         TRACK LENGTH                                   96000019
DASDINTR DS    AL1       OVERHEAD FOR INTERMEDIATE RECORD               96300019
DASDLAST DS    AL1       OVERHEAD FOR LAST RECORD                       96600019
DASDKEY  DS    AL1       OVERHEAD FOR KEY                               96900019
DASDFLAG DS    AL1       FLAGS                                          97200019
*                                                                       97500019
BYTEMODE EQU   X'02'     MBBCCHHR IS BY BYTE (2321)                     97800019
TOLERANC EQU   X'01'     TOLERANCE FACTOR MUST BE ADDED                 98100019
*                                                                       98400019
DASDTOL  DS    AL2       TOLERANCE FACTOR                               98700019
*                                                                       99000019
         END                                                            99600019
./  ADD  SSI=32720046,NAME=IGG019BT
 TITLE 'IGG019BT--C.E.A. FOR BSAM CREATION OF VS-BDAM DATA SET'         00200019
*                                                                       00600019
IGG019BT CSECT                                                          00800019
*                                                                     * 00810002
*MODULE NAME - IGG019BT                                               * 00850002
*                                                                     * 00900002
*DESCRIPTIVE NAME - BDAM CREATE CHANNEL END APPENDAGE, VS FORMAT      * 00950002
*                                                                     * 00960002
*COPYRIGHT - NONE                                                     * 00970002
*                                                                     * 00980002
*CHANGE ACTIVITY                                                      * 00990002
*                                                                     * 01000002
*          RELEASE 20 DELETIONS                                         01010019
*3631334000                                                      20201  01015020
*          RELEASE 21 DELETIONS                                         01020019
*                                                                       01100019
*          RELEASE VS2-2 DELETIONS                                      01102002
*002500,140000,142800-143600,144400-145600,150000-151000,152400-153600, 01104002
*192500-194080,194120-208600,218000-225000,296000-298000,380000,        01106002
*390000-392000,484000,540000-798000,846200-847200                Y02072 01108002
*                                                                YM3849 01108102
*                                                                       01108402
*STATUS CHANGE LEVEL 003                                                01110002
*                                                                       01120019
*FUNCTIONS - THIS ROUTINE IS LOADED TOGETHER WITH IGGO19BR,IGGO19BS     01200019
*            WHEN DCB SPECIFIES MACRF=(WL),RECFM=VS,BUFTEK=R,DSORG=PS   01400002
*            AND DD STATEMENT SPECIFIES DSORG=DA                        01600019
*                                                                       01800019
*            THE ROUTINE OPERATES AS FOLLOWS                            02000019
*            WHEN THE WRITE-SZ WAS ISSUED,IT RETURNS CONTROL BACK TO    02200002
*            IOS                                                        02400002
*                                                                       02600019
*            WHEN THE WRITE-SF WAS ISSUED,IT DETERMINES WHETHER THE     02800002
*            BLOCK IS SPANNED RECORD.IF NOT SPANNED,IT RETURNS CONTROL  03000002
*            BACK TO IOS                                                03200002
*                                                                       03400019
*            WHEN A SPANNED RECORD IS BEING PROCESSED,IT DETERMINES     03600002
*            IF THE ENTIRE RECORD HAS BEEN WRITTEN.IF THE RECORD HAS    03800002
*            BEEN WRITTEN,THE ROUTINE RETURNS CONTROL TO IOS.WHEN THE   04000002
*            ENTIRE RECORD HAS NOT BEEN WRITTEN,THE ROUTINE SCHEDULES   04200002
*            THE ASYNCHRONOUS EXIT ROUTINE SO THAT THE ASYNCHRONOUS     04400002
*            EXIT ROUTINE WILL SCHEDULE EXCP TO WRITE A MIDDLE OR THE   04600002
*            LAST SEGMENT OF THE RECORD.                                04800002
*                                                                       05000019
*                                                                       05200019
*ENTRY - THIS ROUTINE IS ENTERED WHEN A CHANNEL END,CHANNEL END WITH    05400019
*        UNIT EXCEPTION,OR CHANNEL END WITH WRONG LENGTH RECORD OCCUR   05600019
*        WITHOUT ANY OTHER ABNORMAL END CONDITIONS                      05800019
*                                                                       06000019
*INPUT - ENTRY PARAMETERS                                               06200019
*        R1 - ADDRESS OF RQE (MUST NEVER BE TOUCHED)                    06400019
*        R2 - ADDRESS OF IOB                                            06600019
*        R3 - ADDRESS OF DEB                                            06800019
*        R4 - ADDRESS OF DCB                                            07000019
*        R7 - ADDRESS OF UCB                                            07200019
*        R13- ADDRESS OF IOS SAVEAREA                            Y02072 07250002
*        R14- RETURN ADDRESS                                            07400019
*                                                                       07600019
*                                                                       07800019
*OUTPUT - REGISTERS                                                     08000001
*        ALL REGISTER CONTENTS ARE RESTORED BEFORE RETURNING TO IOS     08010002
*                                                                       08200019
*EXIT - TO IOS                                                          08400019
*        +0(R14) - I/O COMPLETE AND RB IS MADE AVAILABLE                08800019
*      'ASYOUT' TO EXIT EFFECTOR TO SCHEDULE ASYNCHRONOUS ROUTINE       09000019
*                                                                       09200019
*EXTERNAL ROUTINES -                                                    09400019
*                                                                       09600019
*MACROS - MODESET                                                       09800002
*                                                                       10000019
*ATTRIBUTES - THIS ROUTINE IS RE-ENTRANT, ENABLED, AND PRIVILEGED.      10200002
*         ENTRY IS IN KEY ZERO, BUT MOST PROCESSING IS IN USER KEY.     10400002
*         THE APPENDAGE RUNS WITH THE LOCAL LOCK HELD.                  10450002
*NOTES -                                                                10600019
*                                                                       11000019
*********************************************************************** 11200019
*   REGISTER CONVENTIONS                                                11600019
*********************************************************************** 12000019
R0       EQU   0                   PARAMETER REGISTER                   12400019
RQER     EQU   1                   ADDR OF RQE (NEVER USE)              12600019
RIOB     EQU   2                   ADDR OF IOB                          12800019
RDEB     EQU   3                   ADDR OF DEB (ALSO MODESET WORKREG)   13000002
RDCB     EQU   4                   ADDR OF DCB                          13200019
R5       EQU   5                                                        13400019
R6       EQU   6                   WORKREG FOR MODESET           Y02072 13600002
RUCB     EQU   7                   ADDR OF UCB                          13800019
RDECB    EQU   8                   ADDR OF DECB                  Y02072 14000002
SGWKR    EQU   9                   SEGMENT WORK REG.(MUST BE SET TO 0)  14200002
RWKR9    EQU   9                   WORK REGISTER                        14240002
WKR10    EQU   10                  WORK REGISTER                        14400019
WKR11    EQU   11                  WORK REGISTER                        14600019
RBASE    EQU   12                  BASE REGISTER                        14800019
RSAVE    EQU   13                  WORK REGISTER                 Y02072 15100002
RTNR     EQU   14                  RETURN REGISTER                      15200019
R15      EQU   15                  WORK REGISTER                 Y02072 15400002
*                                                                       15600019
*********************************************************************** 16000019
*   EQUATES AND MASKS                                                   16400019
*********************************************************************** 16800019
SETSECT  EQU   X'23'                    SET SECTOR CC MASK       20201  17100020
WRITESZ  EQU   X'04'               TYPE OF WRITE = 'SZ'                 17200019
SPANNED  EQU   X'04'               RECORD IS A SPANNED RECORD           17400019
NOT      EQU   X'FF'               CONSTANT 'FF'                        17600019
TWELVE   EQU   12                  CONSTANT '12'                        17800019
NULL     EQU   0                   CONSTANT '0'                         18200019
ONE      EQU   1                   CONSTANT '1'                         18400019
FOUR     EQU   4                   CONSTANT '4                          18600019
ADDRLG   EQU   3                        3 BYTE LENGTH OF ADDR    YM3849 18650002
UNITCHK  EQU   X'02'                    UNIT CHECK BIT                  19200002
STATBITS EQU   3                        OFFSET IN CSW TO STATUS  Y02072 19250002
IOSEXIT  EQU   12                       RETURN TO IOS AT 12 OFF  Y02072 19300002
*                                       R14 FOR NO POST,SAVE RQE Y02072 19350002
*********************************************************************** 19424001
*                       ESTABLISH REGISTERS                             19428002
*********************************************************************** 19432001
START    EQU   *                                                 Y02072 19434002
         STM   R0,R15,0(RSAVE)          SAVE IOS REGISTERS       Y02072 19434102
         USING IHADCB,RDCB                                              19434402
         USING RQE,RQER                 ESTABLISH RQE BASE       Y02072 19484402
         BALR  RBASE,NULL               ESTABLISH                       21000002
         USING *,RBASE                  BASE FOR C.E.A.          Y02072 21200002
*                                                                       21460002
         MODESET  KEYADDR=RQEPRT,WORKREG=6   CHANGE TO USER KEY  Y02072 21500002
*                                                                       21600019
         SH    RIOB,KIOBPREF            BACK UP TO VS IOB PREFIX        21650002
         USING IOBBSAMN,RIOB            SET UP IOB BASE REG             21700002
*********************************************************************** 21750002
*  THE FOLLOWING ROUTINE RESTORES THE USER'S ECB IN THE IOB.  IF        21800002
*  MULTIPLE SEGMENTS WERE REQUIRED, THE USER'S DECB ADDRESS WILL        21850002
*  HAVE BEEN SAVED IN THE IOBIOBA FIELD IN THE IOB(-4) BEFORE THE       21900002
*  SECOND AND SUBSEQUENT EXCPS WERE ISSUED BY THE ASI ROUTINE.          21950002
*  THIS WAS NECESSARY TO PREVENT EXCP PROCESSING OF SECONDARY EXCPS     22050002
*  FROM OVERLAYING ANY CHANGE IN THE STATUS OF THE ECB.                 22100002
*********************************************************************** 22150002
ECBCHK   EQU   *                        CHECK DECB ADDR          YM3849 22200002
         L     WKR10,IOBECBPT           GET ADDR IN IOB FOR DECB YM3849 22400002
         LA    WKR10,0(WKR10)           CLEAR OUT TOP BYTE       YM3849 22450002
         LA    WKR11,IOBCSW-1           GET ADDR OF IOBCSW WORD  YM3849 22500002
         CR    WKR11,WKR10              DOES IOBECBPT PT TO CSW  YM3849 22550002
         BNE   TESTCSW                  IF NOT, DECB PTR OK      YM3849 22600002
         MVC   IOBECBPB(ADDRLG),IOBNECB+1  MV REAL DECB PTR BACK YM3849 22650002
         XC    IOBNECB+1(ADDRLG),IOBNECB+1   CLEAR IOB FIELD     YM3849 22750002
*******                                                                 22800002
TESTCSW  EQU   *                        TEST CSW FOR ERROR       YM3849 22850002
         TM    IOBCSW+STATBITS,UNITCHK  TEST UNIT CHECK          Y02072 23000002
         BO    NORMAL                   BRANCH IF ON                    23200002
*                                                                       23800019
         L     RDECB,IOBECBPT           LOAD ADDR OF DECB               24000002
         USING DECB,RDECB               ESTABLISH DECB BASE      Y02072 24200002
*********************************************************************** 24600019
*   DETERMINE THE TYPE OF I/O REQUEST AND ITS HANDLING                  25000002
*     1. WRITE/SZ - RETURN TO +0(IOS)                                   25200019
*     2. NON-SPANNED RECORD - RETURN TO +0(IOS)                         25400019
*     3. SPANNED RECORD - FURTHER ANALYSIS                              25600002
*********************************************************************** 26000019
         TM    DECTYPE2,DECWRSZ         TEST IF WRITE/SZ REQUEST Y02072 26400002
         BO    NORMAL                   YES,GO TO IOS IMMEDIATELY       26600002
*                                                                       26800019
         TM    IOBNFLG1,IOBSPAN         TEST IF SPANNED RECORD   Y02072 27000002
         BO    CHKSPAN                  YES, GO TO CHECK SPANNED RECORD 27200002
*********************************************************************** 28400019
*   NORMAL RETURN TO IOS  - +0(IOS)                                     28800019
*********************************************************************** 29200019
NORMAL   EQU   *                                                        29450002
*                                                                       29510002
         MODESET  KEYADDR=IOSKEY,WORKREG=3   RETURN TO IOS KEY   Y02072 29550002
*                                                                       30000019
         LM    R0,R15,0(RSAVE)          RESTORE IOS REGS         Y02072 30050002
         BR    RTNR                     GO BACK TO IOS                  30200002
*********************************************************************** 31800019
*   DETERMINE WHETHER ANY MORE I/O IS REQUIRED                          32200019
*        YES - SCHEDULE ASYNCHRONOUS EXIT ROUTINE                       32400019
*        NO  - RESET SPAN BIT AND GO BACK TO IOS                        32600019
*********************************************************************** 33000019
CHKSPAN  EQU   *                                                        33050002
         SR    SGWKR,SGWKR              ZERO OUT REG 9           20201  33300020
         IC    SGWKR,DCBOFFSW           GET OFFSET TO WRT CCW    20201  33400020
         L     SGWKR,NULL(SGWKR,RIOB)   GET SEG WRK AREA ADDR    20201  33500020
         SH    SGWKR,SWACBLG            MINUS SWA CONTROL FIELD  Y02072 33600002
         USING SWA,SGWKR           ESTABLISH BASE FOR SEG.WKAREA Y02072 33800002
         TM    SWAFLAG,SWALAST     TEST IF PREVIOUS I/O WAS LAST Y02072 34200002
         BNO   ASYOUT              NO,GOTO EXIT TO ASYNCHRONOUS EXIT    34400019
*                                                                       34600019
         NI    IOBNFLG1,NOT-SPANNED RESET SPANNED BIT IN IOB            34800002
         B     NORMAL              GO BACK TO +0(IOS)                   35200019
*********************************************************************** 35600019
*********************************************************************** 36400019
*   EXIT TO EXIT EFFECTOR TO SCHEDULE ASYNCHRONOUS EXIT ROUTINE.        36800019
*   THE ROUTINE WILL ISSUE EXCP TO WRITE NEXT SEGMENT OF THE RECORD.    37000002
*********************************************************************** 37600019
ASYOUT   EQU   *                                                        37850002
         L     R15,CVTPTR           GET CVTPTR                   Y02072 38200002
         USING CVT,R15              LOCATE EXIT EFFECTOR ADDR    Y02072 38400002
         L     R15,CVT0EF00             FROM CVT                 Y02072 38600002
*                                                                       38860002
         MODESET  KEYADDR=IOSKEY,WORKREG=3   RETURN TO IOS KEY   Y02072 38900002
*                                                                       39400019
         BALR  RTNR,R15                 GO TO EXIT EFFECTOR      Y02072 39410002
         LM    R0,R15,0(RSAVE)          RESTORE IOS REGS         Y02072 39450002
         B     IOSEXIT(RTNR)            RETURN TO IOS            Y02072 39600002
*********************************************************************** 47000019
*   CONSTANTS                                                           47400019
*********************************************************************** 47800019
KIOBPREF DC    H'8'                     LENGTH OF IOBPREFIX             48200002
SWACBLG  DC    H'10'                    LENGTH OF SWA CNTRL BLK  Y02072 48300002
IOSKEY   DC    X'00'                    KEY FOR IOS              Y02072 48310002
MODID    DC    CL8'IGG019BT'            MODULE ID                Y02072 48350002
*                                                                       48600019
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 48650002
         LTORG                                                          48800019
         EJECT                                                          49000019
*********************************************************************** 49200002
*                                                                       49400019
*    CONTROL BLOCK DEFINITIONS FOLLOW                                   49600019
*                                                                       49800019
*********************************************************************** 50000002
         IECDRQE                                                 Y02072 50250002
         EJECT                                                          50300002
         IEZDEB                                                  Y02072 50310002
         EJECT                                                          50320002
         IEZIOB                                                  Y02072 50350002
         EJECT                                                          50360002
         IHADECB                                                 Y02072 50370002
         EJECT                                                          50420002
         CVT  DSECT=YES                                                 51600002
**********************************************************************  52400019
*                                                                       52600019
         DCBD  DSORG=(PS),DEVD=(DA)                                     52800019
*                                                                       53000019
*********************************************************************** 53200019
*                                                                       74000019
         IGGSWA                                                  Y02072 74050002
*                                                                       80400019
*********************************************************************** 80600019
*                                                                       80800019
*   DSECT FOR DASD DEVICE CHARACTERISTIC TABLE                          81000019
*                                                                       81200019
*********************************************************************** 81400019
*                                                                       81600019
DASDTBL  DSECT                                                          81800019
*                                                                       82000019
DASDCYL  DS    H                   NO. OF CYLINDERS                     82200019
DASDTRK  DS    H                   NO. OF TRACKS/CYLINDER               82400019
DASDLNGH DS    H                   TRACK LENGTH                         82600019
DASDINTR DS    AL1                 OVERHEAD FOR INTERMEDIATE RECORD     82800019
DASDLAST DS    AL1                 OVERHEAD FOR LAST RECORD             83000019
DASDKEY  DS    AL1                 OVERHEAD FOR KEY                     83200019
DASDFLAG DS    AL1                 FLAGS                                83400019
*                                                                       83600019
BYTEMODE EQU   X'02'               MBBCCHHR IS BY BYTE (2321)           83800019
TOLERANC EQU   X'01'               TOLERANCE FACTOR MUST BE ADDED       84000019
*                                                                       84200019
DASDTOL  DS    AL2                 TOLERANCE FACTOR                     84400019
*                                                                       84600019
         END                                                            85000019
./  ADD  SSI=33380804,NAME=IGG019BU
         TITLE 'IGG019BU--OFFSET READ OF A KEYED, VS, BDAM DATA SET'    00041019
IGG019BU CSECT                                                          00400019
*                                                                       00410019
*        RELEASE 20 DELETIONS                                           01200019
*        RELEASE 21 DELETIONS                                           01600019
*        RELEASE 22 DELETIONS                                           02000019
*        RELEASE 23 DELETIONS                                           02400019
*        RELEASE 24 DELETIONS                                           02800019
*        RELEASE 25 DELETIONS                                           03200019
*        RELEASE 26 DELETIONS                                           03600019
*        RELEASE 27 DELETIONS                                           04000019
*        RELEASE 28 DELETIONS                                           04010019
*                                                                       04020019
*STATUS CHANGE LEVEL 000                                                04400019
*                                                                       04410019
*FUNCTION-OPERATION--OFFSET READ ROUTINE FOR BDAM DATA SETS             04800019
*     1. THE ROUTINE RECEIVES CONTROL WHEN A READ MACRO-INSTRUCTION     05200019
*        IS ENCOUNTERED IN THE PROCESSING PROGRAM.                      05600019
*     2. IT ENTERS THE ADDRESS OF THE IOB INTO THE DECB TO PER-         06000019
*        MIT THE CHECK ROUTINE TO LATER TEST EXECUTION OF THE           06400019
*        CHANNEL PROGRAM.                                               06800019
*     3. IT COMPLETES THE CHANNEL PROGRAM BY INSERTING THE BUFFER       07200019
*        ADDRESS AND THE RECORD LENGTH.  THE BUFFER ADDRESS IS OBTAINED 07600019
*        FROM THE DECB AND OFFSET BY KEY LENGTH IF THERE IS NO KEY      08000019
*        WITH THIS SEGMENT (I.E., IF THIS IS A SEGMENT SUBSEQUENT TO    08400019
*        THE FIRST SEGMENT OF A RECORD).  THIS DETERMINATION IS MADE    08800019
*        BY CHECKING TO SEE IF THE CCW HAS BEEN CHANGED BY MODULE       09200019
*        IGG019BV TO READ JUST DATA.  THE RECORD LENGTH IS OBTAINED     09600019
*        FROM THE DCB AND MODIFIED BY KEY LENGTH IF APPROPRIATE.        10000019
*     4. IT THEN ISSUES EXCP                                            10400019
*                                                                       10800019
*ENTRY POINT--IGG019BU IS ENTERED FROM A READ MACRO EXPANSION           11200019
*              LA    1,DECB                                             11600019
*              LA    14,DCB                                             12000019
*              L     15,48(14)                                          12400019
*              BALR  14,15                                              12800019
*                                                                       13200019
*INPUT--DECB                                                            13600019
*                                                                       14000019
*OUTPUT--DECB                                                           14400019
*         DECSDECB--ECB                                                 14800019
*         DECIOBPT--ADDRESS OF IOS IOB (SAM IOB + 8)                    15200019
*        DCB                                                            15600019
*         DCBIOBA--ADDRESS OF CURRENT IOB                               16000019
*        IOB                                                            16400019
*         IOBFLAG0--READ INDICATED--X'20'                               16800019
*         IOBECBPT--ADDRESS OF ECB                                      17200019
*         IOBSTART--STARTING ADDRESS OF CHANNEL PROGRAM                 17600019
*        CHANNEL PROGRAM                                                18000019
*         ADDRESS OF I/O AREA (OFFSET BY KEY LENGTH IF APPROPRIATE)     18400019
*         LENGTH OF RECORD (INCLUDING KEY LENGTH IF APPROPRIATE)        18800019
*                                                                       19200019
*EXTERNAL ROUTINES--NONE                                                19600019
*                                                                       20000019
*EXITS NORMAL--RETURN TO CALLER ON REG 14 AFTER SCHEDULING I/0          20400019
*                                                                       20800019
*EXITS ERROR--NONE                                                      21200019
*                        REGISTER ASSIGNMENTS                           21600019
*                                                                       22000019
WORKR    EQU   0                        WORK REG                        22400019
DECBR    EQU   1                        DECB ADDR                       22800019
PARMR    EQU   DECBR                    REG FOR PASSING PARAMETERS      23200019
DCBR     EQU   2                        DCB ADDR                        23600019
IOBR     EQU   3                        ADDR OF IOB (SAM, PAM, PREFIX)  24000019
KEYLEN   EQU   4                        KEY LENGTH                      24400019
WORKR2   EQU   5                        WORK REG                        24800019
BLKSIZE  EQU   6                        BLOCK SIZE                      25200019
CPR      EQU   7                        CHANNEL PROG ADDR               25600019
BASER    EQU   8                        BASE REG                        26000019
SAVER    EQU   13                       SAVE AREA ADDR                  26400019
RETRNR   EQU   14                       RETURN ADDR                     26800019
ENTRYR   EQU   15                       ENTRY POINT ADDR                27200019
*                                                                       27600019
         USING IGG019BU,BASER           BASE FOR MODULE                 28000019
         USING IHADCB,DCBR              BASE FOR DCB                    28400019
         USING DEFDECB,DECBR            BASE FOR DECB                   28800019
         USING DEFIOB,IOBR              BASE FOR IOB                    29200019
         USING DEFCP,CPR                BASE FOR CHANNEL PROG           29600019
*                                                                       30000019
*                          CONSTANT EQUATES                             30400019
*                                                                       30800019
IOBSIZE  EQU   48                       IOB SIZE                        31200019
ADDRLEN  EQU   3                        LENGTH OF ADDRESS               31600019
CCHHRLEN EQU   5                        LENGTH OF BLOCK ID (CCHHR)      32000019
PREFXLEN EQU   8                        LENGTH OF IOB PREFIX            32400019
ADOFFSET EQU   1                        OFFSET TO ADDR FROM FULL WORD   32800019
SAVOFFST EQU   20                       OFFSET IN SAVE AREA             33200019
RDKYDATA EQU   X'08'                    BIT=1 MEANS READ KEY & DATA     33600019
BITSOFF  EQU   X'7F'                    TURN OFF BITS IN DCBOFLGS       34000019
BITOFF   EQU   X'01'                    TURN OFF BIT IN IOBFLAG0        34400019
READBIT  EQU   X'20'                    READ BIT IN IOBFLAG1            34800019
INVLDNPT EQU   X'41'                    CODE FOR INVALID NOTE-POINT     35200019
ERRORMSK EQU   X'FF'                    TEST FOR ERROR FROM POINT RTN   35600019
RDBKBIT  EQU   X'BF'                    READ BACK BIT IN DCBOFLGS       36000019
*                                                                       36400019
*                                                                       36800019
ENTRY    EQU   *                                                        37200019
         STM   RETRNR,BASER,SAVOFFST(SAVER)  SAVE USER REGS             38000019
         LR    BASER,ENTRYR             ESTABLISH ADDRESSABILITY        38010019
         L     DCBR,DECDCBAD            DCB ADDR                        38400019
         L     IOBR,DCBIOBA             IOB ADDR (MINUS 8)              38800019
         L     IOBR,IOBCHAIN            NEXT IOB ON CHAIN               39200019
         LA    CPR,IOBSIZE(IOBR)        CHANNEL PROG ADDR               39600019
         NI    DCBOFLGS,RDBKBIT         TURN OFF READ BACK BIT IN OFLGS 40000019
         LA    WORKR,IOBFLAG1           IOS IOB POINTER                 40400019
         ST    WORKR,DECIOBPT           PLACE IN DECB                   40800019
         ST    DECBR,IOBECBPT           PUT ECB PTR IN IOB              41200019
         CLI   IOBECB,ERRORMSK          ERROR IN A POINT RTN            41600019
         BNE   PROCESS                  NO--BRANCH TO PROCESS           42000019
         MVI   DECSDECB,INVLDNPT        YES--INDICATE ERROR IN ECB      42400019
         LM    RETRNR,BASER,SAVOFFST(SAVER)  RESTORE USER REGS          42800019
         BR    RETRNR                   RETURN TO USER                  43200019
*                                                                       43600019
*                                                                       44000019
PROCESS  EQU   *                                                        44400019
         NI    IOBFLAG0,BITOFF          TURN OFF BITS IN IOB            44800019
         OI    IOBFLAG0,READBIT         TURN ON READ BIT                45200019
         ST    CPR,IOBSTART             PUT ADDR OF CHANNEL PROG IN IOB 45600019
         NI    DCBOFLGS,BITSOFF         TURN OFF OFLAGS                 46000019
         SR    KEYLEN,KEYLEN                                            46400019
         IC    KEYLEN,DCBKEYLE          GET KEY LENGTH                  46800019
         LH    BLKSIZE,DCBBLKSI         BLOCK SIZE FROM DCB             47200019
         L     WORKR2,DECAREA           BUFFER ADDR                     47600019
         LA    WORKR2,0(WORKR2)         CLEAR HIGH ORDER BYTE           48000019
*                                                                       48400019
*  THIS SECTION OF CODE DETERMINES IF THE RECORD ABOUT TO BE READ IS A  48800019
*  SEGMENT OF A SEGMENTED RECORD.  IF IT IS AND IT IS NOT THE FIRST     49200019
*  SEGMENT, THEN THE READ WILL BE OFFSET IN THE BUFFER BY KEY LENGTH.   49600019
*  THE DETERMINATION IS MADE BY CHECKING TO SEE IF THE CCW HAS BEEN     50000019
*  CHANGED BY THE CHANNEL END APPENDAGE TO READ JUST DATA RATHER THAN   50400019
*  KEY AND DATA                                                         50800019
*                                                                       51200019
         TM    RKDCC,RDKYDATA           IS CCW FOR READ JUST DATA       51600019
         BO    NOOFFSET                 NO--OFFSET NOT NEEDED           52000019
         AR    WORKR2,KEYLEN            ADD KEY LENGTH                  52400019
FILLCCW  EQU   *                                                        52800019
         IC    WORKR,RKDCC              SAVE CCW OP CODE                53200019
         ST    WORKR2,RKDCC             PUT BUFFER ADDR IN CCW          53600019
         STC   WORKR,RKDCC              PUT OP CODE BACK                54000019
         STH   BLKSIZE,RKDBYTCT         PUT LENGTH IN CCW               54400019
         B     UPDATDCB                 GO TO UPDATE DCB                54800019
*                                                                       55200019
NOOFFSET EQU   *                                                        55600019
         AR    BLKSIZE,KEYLEN           ADJUST LENGTH FOR KEY           56000019
         B     FILLCCW                  GO TO COMPLETE CCW              56400019
UPDATDCB EQU   *                                                        56800019
         ST    IOBR,DCBIOBA             UPDATE DCB IOB POINTER          57200019
         MVC   IOBSKCC(CCHHRLEN),CPCOUNT   MOVE CCHHR INTO IOBSEEK      57600019
         LA    PARMR,PREFXLEN(IOBR)     ADDR OF IOS IOB                 58000019
         EXCP  (1)                                                      58400019
*                                                                       58800019
         LM    RETRNR,BASER,SAVOFFST(SAVER) RESTORE USER REGS           59200019
         BR    RETRNR                   RETURN TO USER                  59600019
*                                                                       60000019
DEFDECB  DSECT                          DECB STRUCTURE                  60400019
DECSDECB DS    CL4                      ECB                             60800019
DECTYPE  DS    CL2                      TYPE OF I/O MACRO & OPTIONS     61200019
DECLNGTH DS    CL2                      LENGTH OF DATA OR KEY & DATA    61600019
DECDCBAD DS    A                        ADDR OF DCB                     62000019
DECAREA  DS    A                        ADDR OF READ/WRITE AREA         62400019
DECIOBPT DS    A                        ADDR OF IOB                     62800019
*                                                                       63200019
DEFIOB   DSECT                          IOB STRUCTURE                   63600019
IOBFLAG0 DS    0BL1                     I/O FLAGS                       64000019
IOBCHAIN DS    A                        ADDR OF NEXT IOB                64400019
IOBECB   DS    F                        ECB                             64800019
IOBFLAG1 DS    BL1                      I/O FLAGS                       65200019
IOBFLAG2 DS    BL1                      I/O FLAGS                       65600019
IOBSENS0 DS    BL1                      FIRST SENSE BYTE                66000019
IOBSENS1 DS    BL1                      SECOND SENSE BYTE               66400019
IOBECBCC DS    0X                       COMPLETION CODE                 66800019
IOBECBPT DS    A                        ADDR OF ECB                     67200019
IOBFLAG3 DS    BL1                      I/O FLAGS                       67600019
IOBCSW   DS    CL7                      LOW ORDER BYTES OF LAST CSW     68000019
IOBSIOCC DS    0X                       SIO CONDITION CODE              68400019
IOBSTART DS    A                        ADDR OF CHANNEL PROG            68800019
         DS    0C                       RESERVED                        69200019
IOBDCBPT DS    A                        ADDR OF DCB                     69600019
IOBRESTR DS    CL4                      PURGE CHAIN/CCHH/COMMAND,CP     70000019
IOBINCAM DS    2C                       USE VARIES                      70400019
IOBERRCT DS    2X                       NO OF ERROR RETRIES             70800019
IOBSEEK  DS    0D                       SEEK FIELD FOR DA               71200019
IOBSKM   DS    1X                       EXTENT NUMBER                   71600019
IOBSKBB  DS    2X                       BIN                             72000019
IOBSKCC  DS    2X                       CYLINDER                        72400019
IOBSKHH  DS    2X                       HEAD                            72800019
IOBSKR   DS    1X                       RECORD                          73200019
*                                                                       73600019
DEFCP    DSECT                          OFFSET READ CHANNEL PROG        74000019
CPNOP1   DS    0D                       NOP                             74400019
NOP1CC   DS    0X                       COMMAND CODE                    74800019
NOP1DATA DS    A                        DATA ADDR                       75200019
NOP1FLAG DS    BL1                      FLAGS                           75600019
         DS    1X                       NOT USED                        76000019
NOP1BYTC DS    2X                       BYTE COUNT                      76400019
CPSCH    DS    D                        SEARCH ID EQUAL                 76800019
CPTIC1   DS    D                        TIC TO SEARCH                   77200019
CPTIC2   DS    D                        TIC TO READ COUNT               77600019
CPRDCNT  DS    0D                       READ COUNT                      78000019
RCTCC    DS    0X                       COMMAND CODE                    78400019
RCTDATAD DS    A                        DATA ADDR                       78800019
RCTFLAGS DS    BL1                      FLAGS                           79200019
         DS    1X                       NOT USED                        79600019
RCTBYTCT DS    2X                       BYTE COUNT                      80000019
CPRDKD   DS    0D                       READ (KEY) DATA                 80400019
RKDCC    DS    0X                       COMMAND CODE                    80800019
RKDDATAD DS    A                        DATA ADDR                       81200019
RKDFLAGS DS    BL1                      FLAGS                           81600019
         DS    1X                       NOT USED                        82000019
RKDBYTCT DS    2X                       BYTE COUNT                      82400019
CPNOP2   DS    0D                       NOP                             82800019
NOP2CC   DS    0X                       COMMAND CODE                    83200019
NOP2DATA DS    A                        DATA ADDR                       83600019
NOP2FLAG DS    BL1                      FLAGS                           84000019
         DS    1X                       NOT USED                        84400019
NOP2BYTC DS    2X                       BYTE COUNT                      84800019
CPCOUNT  DS    D                        FIELD TO READ COUNT INTO        85200019
         ORG   *-3                      BACK TO KEY LENGTH FIELD        85600019
KEYLNGTH DS    1X                       KEY LENGTH IN COUNT             86000019
*                                                                       86400019
         DCBD  DSORG=BS,DEVD=DA         DCB DSECT                       86800019
         END                                                            87200019
./  ADD  SSI=33380806,NAME=IGG019BV
 TITLE 'IGG019BV--CHANNEL AND ABNORMAL END APPENDAGES FOR OFFSET READ'  00001019
IGG019BV CSECT                                                          00400019
*                                                                     * 00410002
*MODULE NAME - IGG019BV                                               * 00460002
*                                                                     * 00510002
*DESCRIPTIVE NAME - CHANNEL AND ABNORMAL END APPENDAGES, OFFSET READ  * 00560002
*             OF A KEYED VARIABLE SPANNED BDAM DATA SET               * 00570002
*                                                                     * 00610002
*COPYRIGHT - NONE                                                     * 00660002
*                                                                     * 00710002
*CHANGE ACTIVITY                                                      * 00760002
*                                                                     * 00810002
*        RELEASE 20 DELETIONS                                           01200019
*3495416000,572000                                               20201  01400020
*        RELEASE 21 DELETIONS                                           01600019
*                                                                       01610002
*        RELEASE VS2-2 DELETIONS                                        01650002
*688000,756000-792000,804000-856000                              Y02072 01700002
*                                                                       04020019
*STATUS CHANGE LEVEL 003                                                04320002
*                                                                       04800019
*FUNCTION-OPERATION--CHANNEL END APPENDAGE FOR OFFSET READ FUNCTION     05200019
*                    OF A KEYED VS BDAM DATA SET USING THE SEQUENTIAL   05250002
*                    ACCESS METHOD                                      05300002
*     1. THE MODULE RECEIVES CONTROL FROM THE I/O INTERRUPTION          05600019
*        SUPERVISOR AT CHANNEL END EXIT.                                06000019
*     2. IF THE APPENDAGE FINDS A UNIT EXCEPTION BIT ON IN THE CHANNEL  06400019
*        STATUS WORD, IT RETURNS TO THE I/O INTERRUPTION SUPERVISOR     06800019
*        IMMEDIATELY.                                                   07200019
*     3. IF THE UNIT CHECK BIT IS ON, THE ABNORMAL ROUTINE IS BRANCHED  07210019
*        TO.  THE ABNORMAL ROUTINE CHANGES9                             07220019
*     4. IF A KEY WAS NOT READ (READ DATA IN CCW) THE COMMAND IS        07600019
*        CHANGED BACK TO READ KEY AND DATA.                             08000019
*     5. IF A KEY WAS EXPECTED (READ KEY AND DATA IN CCW) AND THERE     08400019
*        WAS NO KEY TO READ (KEY LENGTH=0 IN COUNT JUST READ), THEN     08800019
*        THE READ MUST BE RESCHEDULED WITH AN OFFSET.                   09200019
*     6. THE APPENDAGE CALCULATES THE LENGTH OF THE BLOCK AND COMPARES  09600019
*        IT TO THAT IN THE BLOCK LENGTH FIELD.  IF THE LENGTHS ARE      10000019
*        EQUAL, IT TURNS OFF ERROR INDICATORS IN THE ECB.               10400019
*     7. IF THE LENGTHS ARE UNEQUAL, THE CURRENT CHANNEL PROGRAM IS     10800019
*        CHANGED TO READ KEY AND DATA AND CONTROL IS RETURNED TO THE    11200019
*        I/O INTERRUPT SUPERVISOR IMMEDIATELY.  THE I/O INTERRUPTION    11600019
*        SUPERVISOR THEN SETS THE ECB TO SHOW THAT THE CHANNEL PROGRAM  12000019
*        EXECUTED WITH AN ERROR CONDITION.                              12400019
*     8. THE APPENDAGE CHECKS THE SEGMENT DESCRIPTOR WORD TO SEE IF     12800002
*        ANOTHER SEGMENT IS TO FOLLOW.  IF THERE IS, THE NEXT CHANNEL   13200019
*        PROGRAM IS CHANGED TO READ DATA.                               13600019
*                                                                       14000019
*ENTRY POINTS--ENTRY TO THIS ROUTINE IS FROM IOS AFTER CHANNEL END      14400019
*              FROM A READ COMMAND                                      14800019
*                                                                       15200019
*INPUT--IOB AND USERS RECORD                                            15600019
*                                                                       16000019
*OUTPUT--THE INCORRECT LENGTH INDICATOR IN THE CSW IS RESET IF THE      16400002
*        LENGTH OF THE RECORD BEING CHECKED IS CORRECT, AND THE NEXT    16800019
*        CHANNEL PROGRAM IS READIED FOR AN OFFSET READ IF APPLICABLE.   17200019
*                                                                       17600019
*EXTERNAL ROUTINES--NONE                                                18000019
*                                                                       18400019
*EXITS NORMAL--THE CSW WRONG LENGTH INDICATOR IS TURNED OFF AND THE     18800019
*              IOB EXCEPTION FLAG IS TURNED OFF AND CONTROL IS PASSED   19200019
*              TO IOS.                                                  19600019
*                                                                       20000019
*EXITS ERROR--RETURN TO IOS WITH THE CSW WRONG LENGTH INDICATOR AND     20400019
*             THE IOB EXCEPTION FLAG ON.                                20800019
*                                                                       21200019
*MACROS--MODESET                                                        21250002
*                                                                       21300002
*ATTRIBUTES--ENABLED, REENTRANT,SUPERVISOR STATE.  ENTRY IS IN SUPER-   21600002
*             VISOR KEY.  MODESET IS ISSUED TO PROCESS IN USER KEY      21650002
*             THE LOCAL LOCK IS HELD THROUGHOUT PROCESSING.             21660002
         EJECT                                                          21700002
*                                                                       22000019
*                       REGISTER EQUATES                                22050002
*                                                                       22100002
R0       EQU   0                        REGISTER SAVED           Y02072 22150002
RQER     EQU   1                        POINTER TO RQE           Y02072 22200002
IOBRR    EQU   2                        BASE FOR IOS IOB                22400002
DCBR     EQU   4                        BASE FOR DCB                    22800019
CPR      EQU   6                        BASE FOR CHANNEL PGM     Y02072 22802002
BLKDESWD EQU   9                        ADDR OF BLK DESCRIPTOR WORD     22810019
KEYLEN   EQU   10                       REG FOR KEY LENGTH              23600019
WORKR    EQU   11                       WORK REGISTER                   24000019
RESIDCTR EQU   WORKR                    REG FOR CSW RESIDUAL COUNT      24400019
WORKR2   EQU   12                       WORK REGISTER                   24800019
SAVER    EQU   13                       POINTER TO IOS SAVEAREA         25210002
RETRNR   EQU   14                       RETURN REGISTER                 25600019
BASER    EQU   15                       BASE FOR MODULE                 26000019
R15      EQU   15                       WORK REGISTER            Y02072 26050002
*                                                                       26400019
*                         CONSTANT EQUATES                              26800019
*                                                                       27200019
UNITEXCP EQU   X'01'                    UNIT EXCEPTION BIT IN CSW       27600019
UNITCHEK EQU   X'02'                    UNIT CHECK BIT IN CSW           27610019
CYLNEND  EQU   X'20'                    CYLINDER END BIT IN SENSE BYTE  27620019
FILEPRTK EQU   X'04'                    FILE PROTECT SENSE BIT          27630019
RDKYDATA EQU   X'8E'                    READ KEY & DATA COMMAND         28000019
READDATA EQU   X'86'                    READ DATA COMMAND               28400019
RDKEYBIT EQU   X'08'                    READ KEY BIT                    28800019
KEYBTOFF EQU   X'F7'                    TO TURN KEY BIT OFF             29200019
NOKEY    EQU   0                        TEST COUNT FIELD FOR KEY        29600019
CLRBYTE  EQU   0                        TO CLEAR HIGH ORDER BYTE        30000019
CCHHRLEN EQU   5                        LENGTH OF CCHHR                 30010019
ONEIOB   EQU   1                        TO TEST FOR ONE IOB             30020019
IOBLNGTH EQU   40                       LENGTH OF IOB                   30400019
SEGCODE  EQU   6                        OFFSET TO SEGMENT CODE FROM     30800019
*                                       BLOCK DESCRIPTOR WORD           31200002
LASTSEG  EQU   8                        BCR CODE FOR LAST SEG IN RCD    31600019
BYTELEN  EQU   8                        NUMBER OF BITS/BYTE FOR A SLL   32000019
CPRETRY  EQU   8                        RETURN OFFSET TO IOS FOR A      32400019
*                                       CHANNEL PROGRAM RETRY           32800002
LLDIS    EQU   0                        OFFSET TO LL IN BLK DESCRIPTOR  33200019
*                                       WORD                            33600002
SCNDBYT  EQU   1                        SECOND BYTE OF LL IN BDW        34000019
ONES     EQU   1                        BCR CODE FOR TM--ONES           34400019
NOTEQUAL EQU   7                        BCR CODE FOR NOT EQUAL          34800019
IFLGERBT EQU   X'3F'                    ERROR BIT IN DCBIFLG            35200019
FLG1ERBT EQU   X'FB'                    ERROR BIT IN IOBFLAG1           35600019
SKIPFLAG EQU   X'10'                    SKIP FLAG IN CCW                36000019
SLIBIT   EQU   X'BF'                    SLI BIT IN CCW                  36400019
RCDCONTN EQU   X'01'                                                    36800019
         EJECT                                                          36850002
         USING IHADCB,DCBR              BASE FOR DCB                    37200019
         USING IGG019BV,BASER           BASE FOR MODULE                 37600019
         USING IOBSTDRD,IOBRR           BASE FOR IOB             Y02072 38000002
         USING DEFCP,CPR                BASE FOR CHANNEL PROGRAM        38010019
         USING RQE,RQER                 ESTABLISH RQE BASE       Y02072 38060002
*                                                                       39200019
BEGIN    EQU   *                                                        39600019
         STM   R0,R15,0(SAVER)          ST REGS IN IOS SAVEAREA  Y02072 39650002
         TM    CSWSTAT1,UNITEXCP        TEST FOR UNIT EXCEPTION         40400019
         BOR   RETRNR                   RETURN IF ON             Y02072 40800002
*                                                                       40800102
         MODESET  KEYADDR=RQEPRT,WORKREG=6  CHANGE TO USER KEY   Y02072 40800402
*                                                                       40800802
         CLI   DCBNCP,ONEIOB            ONE IOB                         40801019
         BE    ONECP                    YES--BRANCH                     40802019
         LR    WORKR,IOBRR               ADDR OF IOS IOB                40803002
         SH    WORKR,PREFXLEN           ADDR OF IOB CHAIN               40804019
         LR    WORKR2,IOBRR              SAVE IOB ADDR                  40805002
         L     IOBRR,0(WORKR)            NEXT IOB                       40806002
         AH    IOBRR,PREFXLEN            IOS IOB                        40807002
         LA    CPR,IOBLNGTH(IOBRR)       ADDR OF CHANNEL PROGRAM        40808002
         MVC   IOBCC(CCHHRLEN),CPCOUNT  MOVE SEEK ADDR INTO IOBSEEK     40809002
         LR    IOBRR,WORKR2              RESTORE CURRENT IOB ADDR       40809102
ONECP    EQU   *                                                 Y02072 40809202
         LA    CPR,IOBLNGTH(IOBRR)       RESET TO CURRENT IOB           40809302
         TM    CSWSTAT1,UNITCHEK        TEST FOR UNIT CHECK             40810019
         BO    ABNORML                  ABNORMAL CHANNEL END            40820019
         TM    RKDFLAGS,SKIPFLAG        TEST FOR SKIP FLAG              41200019
         BO    RETURN                   YES, BRANCH              20201  41400020
         SR    KEYLEN,KEYLEN            ZERO FOR IC                     41610019
         IC    KEYLEN,DCBKEYLE          GET KEY LENGTH                  41620019
         TM    RKDCC,RDKEYBIT           IS COMMAND READ KEY & DATA      42000019
         BZ    CHNGCP                   NO-BRANCH                       42400019
         LR    WORKR,IOBRR               ADDR OF IOS IOB                42410002
         SH    WORKR,PREFXLEN           ADDR OF IOB CHAIN               42420019
         L     CPR,0(WORKR)             NEXT IOB                        42430019
         AH    CPR,PREFXLEN             IOS IOB                         42440019
         LA    CPR,IOBLNGTH(CPR)        ADDR OF CHANNEL PROGRAM         42450019
         CLI   KEYLNGTH,NOKEY           CHECK COUNT FOR ZERO KEY LENGTH 42800019
         LA    CPR,IOBLNGTH(IOBRR)       RESET TO CURRENT IOB           42810002
         BNE   CKLENGTH                 BRANCH IF KEY WAS READ          43200019
*                                                                       43600019
* A KEY WAS EXPECTED BUT NOT READ, THEREFORE THE SEGMENT IS NOT OFFSET  44000019
* IN THE BUFFER.  THE READ MUST BE RESCHEDULED WITH THE REQUIRED        44400019
* OFFSET.                                                               44800019
*                                                                       45200019
         L     WORKR,RKDDATAD           GET BUFFER ADDR                 46400019
         LA    WORKR,CLRBYTE(WORKR)     CLEAR HIGH ORDER BYTE           46800019
         AR    WORKR,KEYLEN             OFFSET BUFFER ADDR BY KEY LEN   47200019
         ST    WORKR,RKDDATAD           STORE NEW BUFFER ADDR           47600019
         MVI   RKDCC,READDATA           COMMAND CODE--READ DATA         48000019
         LH    WORKR,RKDBYTCT           GET BYTE COUNT                  48400019
         SR    WORKR,KEYLEN             DECREMENT BYTE COUNT BY KEY LEN 48410019
         STH   WORKR,RKDBYTCT           INSERT NEW BYTE COUNT           49200019
         NI    DCBIFLGS,IFLGERBT        TURN OFF ERROR BITS IN DCBIFLG  49600019
         NI    IOBFLAG1,FLG1ERBT        TURN OFF ERROR BIT IN IOBFLAG1  50000019
         MVC   IOBERRCT,ZERO            ZERO OUT ERROR COUNT IN IOB     50400019
*                                                                       50450002
         MODESET  KEYADDR=IOSKEY,WORKREG=3   RETURN TO IOS KEY   Y02072 50500002
*                                                                       50510002
         LM    R0,R15,0(SAVER)          RESTORE IOS REGISTERS    Y02072 50550002
         LA    RETRNR,CPRETRY(RETRNR)   IOS ENTRY FOR RETRY             50800019
         BR    RETRNR                   RETURN                          51200019
*                                                                       51600019
CHNGCP   EQU   *                                                        52000019
* THERE WAS NO KEY READ WITH THIS SEGMENT, THEREFORE THE CHANNEL        52400019
* PROGRAM MUST BE REINITIALIZED WITH A COMMAND CODE TO READ KEY & DATA  52800019
*                                                                       53600019
         LTR   KEYLEN,KEYLEN            TEST FOR ZERO KEY LENGTH M4877  53700019
         BZ    AFTRKDCC                 BYPASS COMMAND CHANGE    M4877  53800019
         OI    RKDCC,RDKEYBIT           CHANGE COMMAND--READ KEY & DATA 54000019
*                                                                       55600019
AFTRKDCC EQU   *                                                 M4877  55605019
         L     BLKDESWD,RKDCC           ADDR OF BUFFER                  55610019
         LA    BLKDESWD,CLRBYTE(BLKDESWD)  CLEAR HIGH ORDER BYTE        55620019
         B     CKLEN2                   GO TO CHECK LENGTH              55630019
*                                                                       55640019
CKLENGTH EQU   *                                                        56000019
* HERE, A CHECK IS MADE TO VERIFY THAT THE SEGMENT READ WAS THE         56400019
* CORRECT LENGTH.                                                       56800019
*                                                                       56870020
* CHECK FOR RPS AND UPDATE SECTOR IF USED                               56940020
*                                                                       57010020
         CLI   SECTCCW,SETSC            RPS USED                 20201  57080020
         BNE   NORPS                    BRANCH NO                20201  57150020
         L     BLKDESWD,SECTCCW         GET SECTOR ADDR          20201  57220020
         MVC   0(ONES,BLKDESWD),ONES(BLKDESWD) UPDATE SECTOR     20201  57290020
*                                                                       57360020
NORPS    EQU   *                                                 20201  57430020
*                                                                       57500020
         L     BLKDESWD,RKDCC           ADDR OF BUFFER                  57600019
         LA    BLKDESWD,CLRBYTE(BLKDESWD)  CLEAR HIGH ORDER BYTE        57610019
         AR    BLKDESWD,KEYLEN          ADDR OF BLOCK DESCRIPTOR WORD   58000019
CKLEN2   EQU   *                                                        58010019
         LH    RESIDCTR,CSWBYTCT        GET  RESIDUAL COUNT FROM CSW    58400019
         SR    WORKR2,WORKR2            CLEAR FOR LL INSERTION          58800019
         IC    WORKR2,LLDIS(BLKDESWD)   FIRST BYTE OF LL FIELD          59200019
         SLL   WORKR2,BYTELEN                                           59600019
         IC    WORKR2,SCNDBYT(BLKDESWD) SECOND BYTE OF LL               60000019
         AR    WORKR2,RESIDCTR          ADD RESIDUAL COUNT AND LL       60400019
         CH    WORKR2,DCBBLKSI          SUM SHOULD EQUAL BLOCK SIZE     60800019
         BNE   RETURN                   RETURN TO IOS WITH FLAGS ON     61200019
*                                                                       61600019
* LENGTH CHECK CONFIRMED, ERROR FLAGS CAN BE TURNED OFF.                62000019
*                                                                       62400019
         NI    CSWSTAT2,SLIBIT          TURN OFF SLI BIT IN CSW         62800019
         NI    IOBFLAG1,FLG1ERBT        TURN OFF IOB EXCEPTION FLAG     63200019
*                                                                       63600019
* THE SEGMENT DESCRIPTOR WORD WILL BE CHECKED TO SEE IF THERE IS        64000019
* ANOTHER SEGMENT TO THIS RECORD.  IF THERE IS, THE NEXT CHANNEL        64400019
* PROGRAM WILL HAVE TO BE READIED BY CHANGING THE COMMAND TO READ DATA  64800019
*                                                                       65200019
         TM    SEGCODE(BLKDESWD),RCDCONTN ANOTHER SEGMENT TO FOLLOW     65600019
         BC    LASTSEG,RETURN           NO--RETURN TO IOS               66000019
         LR    WORKR,IOBRR               ADDR OF IOS IOB                66400002
         SH    WORKR,PREFXLEN           ADDR OF IOB CHAIN               66800019
         L     CPR,0(WORKR)             NEXT IOB                        67200019
         AH    CPR,PREFXLEN             IOS IOB                         67201019
         LA    CPR,IOBLNGTH(CPR)        ADDR OF CHANNEL PROGRAM         67210019
         L     WORKR,RKDCC              BUFFER ADDR                     67220019
         LA    WORKR,0(WORKR)           CLEAR HIGH ORDER BYTE           67230019
         AR    WORKR,KEYLEN             OFFSET BY KEY LENGTH            67240019
         ST    WORKR,RKDCC              OFFSET BUFFER ADDR              67250019
         MVI   RKDCC,READDATA           READ DATE COMMAND               67260019
         LH    WORKR,RKDBYTCT           BYTE COUNT                      67270019
         SR    WORKR,KEYLEN             DECREMENT BY KEY LENGTH         67280019
         STH   WORKR,RKDBYTCT                                           67290019
*                                                                       68400019
RETURN   EQU   *                                                        68410019
*                                                                       68460002
         MODESET   KEYADDR=IOSKEY,WORKREG=3    RETURN TO IOS KEY Y02072 68510002
*                                                                       68520002
         LM    R0,R15,0(SAVER)          RESTORE IOS REGS         Y02072 68560002
         BR    RETRNR                   RETURN TO IOS                   69200019
*                                                                       69600019
ABNORML  EQU   *                                                        70000019
         TM    IOBSENS1,CYLNEND         CYLINDER END                    70410019
         BO    RETURN                   YES--RETURN TO IOS       Y02072 70420002
         TM    IOBSENS1,FILEPRTK        FILE PROTECT (END OF TRACK)     70430019
         BO    RETURN                   YES--RETURN TO IOS       Y02072 70432002
         OI    RKDCC,RDKEYBIT           CHANGE COMMAND--READ KEY & DATA 70800019
         B     RETURN                   RETURN TO IOS            Y02072 73600002
*                                                                       73610002
*                           CONSTANTS                                   73620002
*                                                                       73650002
ZERO     DC    H'0'                     TO ZERO OUT A TWO BYTE FIELD    73700002
PREFXLEN DC    H'8'                     IOB PREFIX LENGTH               73750002
IOSKEY   DC    X'00'                    IOS KEY IS ZERO          Y02072 73800002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 73810002
         EJECT                                                          73850002
*********************************************************************** 73900002
*                             DSECTS                                    73910002
*********************************************************************** 73920002
         IECDRQE                                                 Y02072 73970002
         EJECT                                                          74020002
         IEZIOB                                                  Y02072 74050002
         ORG   IOBCSW+3                 BACK TO STATUS BYTES     Y02072 79200002
CSWSTAT1 DS    XL1                      FIRST STATUS BYTE               79210019
CSWSTAT2 DS    XL1                      SECOND STATUS BYTE              79600019
CSWBYTCT DS    XL2                      BYTE COUNT                      80000019
         EJECT                                                          85650002
DEFCP    DSECT                          CHANNEL PROGRAM                 86000019
CPNOP1   DS    0D                       NOP                             86400019
SETSC    EQU   X'23'                    SET SECTOR CCW           20201  86500020
SECTCCW  EQU   CPNOP1                   SET SECTOR CCW CMND      20201  86600020
NOP1CC   DS    0X                       COMMAND CODE                    86800019
NOP1DATA DS    A                        DATA ADDR                       87200019
NOP1FLAG DS    BL1                      FLAGS                           87600019
         DS    1X                       NOT USED                        88000019
NOP1BYTC DS    2X                       BYTE COUNT                      88400019
CPSCH    DS    D                        SEARCH ID EQUAL                 88800019
CPTIC1   DS    D                        TIC BACK TO SEARCH              89200019
CPTIC2   DS    D                        TIC TO READ COUNT               89600019
CPRDCNT  DS    0D                       READ COUNT                      90000019
RCTCC    DS    0X                       COMMAND CODE                    90400019
RCTDATAD DS    A                        DATA ADDR                       90800019
RCTFLAGS DS    BL1                      FLAGS                           91200019
         DS    1X                       NOT USED                        91600019
RCTBYTCT DS    2X                       BYTE COUNT                      92000019
CPRDKD   DS    0D                       READ (KEY) DATA                 92400019
RKDCC    DS    0X                       COMMAND CODE                    92800019
RKDDATAD DS    A                        DATA ADDR                       93200019
RKDFLAGS DS    BL1                      FLAGS                           93600019
         DS    1X                       NOT USED                        94000019
RKDBYTCT DS    2X                       BYTE COUNT                      94400019
CPNOP2   DS    0D                       NOP                             94800019
NOP2CC   DS    0X                       COMMAND CODE                    95200019
NOP2DATA DS    A                        DATA ADDR                       95600019
NOP2FLAG DS    BL1                      FLAGS                           96000019
         DS    1X                       NOT USED                        96400019
NOP2BYTC DS    2X                       BYTE COUNT                      96800019
CPCOUNT  DS    D                        FIELD TO READ COUNT INTO        97200019
         ORG   *-3                      BACK TO KEY LENGTH FIELD        97600019
KEYLNGTH DS    1X                       KEY LENGTH IN COUNT             98000019
*                                                                       98400019
         EJECT                                                          98450002
         DCBD  DSORG=BS,DEVD=DA         DCB DSECT                       98800019
         END                                                            99200019
./  ADD  SSI=80960264,NAME=IGG019DA
 TITLE   'IGG019DA - WRITE FORMAT F, LOAD MODE'                         00008021
IGG019DA CSECT                                                          00008421
*MODULE NAME = IGG019DA                                               * 00008802
*                                                                     * 00008902
*DESCRIPTIVE NAME = BDAM CREATE, WRITE FIXED FORMAT                   * 00012302
*                                                                     * 00014302
*COPYRIGHT = NONE                                                     * 00014702
*                                                                     * 00015102
*CHANGE ACTIVITY                                                      * 00015502
*                                                                     * 00015902
*          RELEASE 19 CHANGES/DELETIONS                                 00030002
*2040053400                                                      A27066 00033020
*          RELEASE 20 CHANGES/DELETIONS                                 00036402
*0000053290                                                      M6477  00039802
*3511                                                            A34944 00043202
*3511000120-000180,000420-000600,053000-053200,053270            20201  00046602
*0000053240,053290                                               M6283  00050020
*          RELEASE 21 CHANGES/DELETIONS                                 00060002
*                                                                XM6362 00062002
*040500-040520                                                  SA58617 00062402
*          VS1-1 CHANGES/DELETIONS                                      00064002
*          VS2-1 CHANGES/DELETIONS                                      00066002
*          VS1-2 CHANGES/DELETIONS                                      00068002
*          VS2-2 CHANGES/DELETIONS                                      00068402
*053010-053070,056200-056600                                     Y02072 00068802
*                                                                YM3919 00068902
*                                                                YM6555 00069002
*                                                                YM7563 00069102
*          CHANGES SINCE VS2-3.7                                        00069200
*D042400,A048650-048750                                        @ZA30898 00069400
*STATUS CHANGE LEVEL 009                                                00070002
*FUNCTIONS- THIS ROUTINE OBTAINS AN IOB, INITIALIZES THE CHANNEL        00100020
*    PROGRAM, AND ISSUES THE 'EXCP' FOR A WRITE TYPE SF OR SD TO A      00120020
*    FORMAT 'F' DATA SET.                                               00140020
*    IF THIS WRITE FILLS THE CURRENT TRACK, THE CAPACITY RECORD WILL    00160020
*    BE WRITTEN BY SETTING THE COMMAND CHAIN FLAG IN THE LAST REGULAR   00180020
*    WRITE CCW.                                                         00200020
*                                                                       00220020
*ENTRY POINTS- 'WRTENTRY' IS THE NORMAL ENTRY POINT FROM THE WRITE      00240020
*    MACRO EXPANSION. CALLING SEQUENCE IS     L     15,DCBWRITE         00260020
*                                             BALR  14,15               00280020
*    'EOVENTRY' IS THE ENTRY FROM THE BSAM END-OF-VOLUME EXECUTOR TO    00300020
*    RESTART A WRITE WHICH WAS ISSUED AFTER THE CURRENT SPACE           00320020
*    ALLOCATION WAS FILLED. THE RECORD WILL NOW BE WRITTEN INTO THE     00340020
*    SPACE OBTAINED AS SECONDARY ALLOCATION. CALLING SEQUENCE IS        00360020
*                                              L    15,DCBWRITE         00380020
*                                              BAL  14,4(15)            00400020
*INPUT- TO 'WRTENTRY'- DECB ADDRESS IN REGISTER 1                       00420020
*       TO 'EOVENTRY'- IOB ADDRESS IN REGISTER 3                        00440020
*                      DCB ADDRESS IN REGISTER 2                        00460020
*                      DEB ADDRESS IN REGISTER 5                        00480020
*                                                                       00500020
*OUTPUT- AN IOB FROM THE POOL OF IOBS WILL BE ASSIGNED TO THIS DECB     00520020
*    AND ITS ADDRESS PLACED IN THE DECB, EXCP WILL BE ISSUED TO         00540020
*    SCHEDULE THIS WRITE.                                               00560020
*                                                                       00580020
*EXTERNAL ROUTINES-                                                     00600020
*                                                                       00620020
*EXITS- 'RETURN' IS AN EXIT BACK TO THE USER, REGISTER 15 WILL CONTAIN  00640020
*    A RETURN CODE AS FOLLOWS,                                          00660020
*        0 = RECORD WAS WRITTEN, THERE IS MORE SPACE ON THE TRACK       00680020
*        4 = RECORD WAS WRITTEN, THIS TRACK IS FULL                     00700020
*        8 = RECORD WAS WRITTEN, DATA SET IS FILLED                     00720020
*        12= RECORD NOT WRITTEN, NO IOB IS AVAILABLE UNTIL 'CHECK' HAS  00740020
*            BEEN ISSUED.                                               00760020
*    'EOVEXIT' IS A RETURN TO THE END-OF-VOLUME EXECUTOR.               00780020
*                                                                       00800020
*    'ABEXIT' IS AN EXIT WHEN THE RECORD WILL NOT FIT ON AN EMPTY       00820002
*      TRACK. A DMABCOND MACRO IS ISSUED TO TRANSFER CONTROL TO         00840002
*      THE PROBLEM DETERMINATION MODULES WHICH WILL ISSUE A WTP         00850002
*      MESSAGE AND GTRACE PERTINENT CONTROL BLOCKS BEFORE ISSUING       00852002
*      ABEND.  A RETURN CODE ACCOMPANYING THE ABEND WILL                00854002
*      IDENTIFY THE EXACT CAUSE OF THE ERROR.                           00856002
*                                                                       00860020
*TABLES- 1. DIRECT ACCESS DEVICE TABLE IS USED TO CALCULATE THE BYTES   00880020
*           OF OVERHEAD FOR THIS RECORD AND TO DETERMINE THE NEXT       00900020
*           VALID TRACK ADDRESS AND THE TRACK LENGTH.                   00920020
*                                                                       00940020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.            00960020
*                                                                       00980020
*NOTES- THE REGISTER USAGE IN THIS MODULE AND THE BSAM END-OF-VOLUME    01000020
*    EXECUTOR MUST REMAIN CONSISTENT.                                   01020020
*                                                                       01040020
*                                                                       01060020
*  REGISTER USAGE                                                       01080020
*                                                                       01100020
         USING IGG019DA,EPREG                                           01120020
         USING IHADCB,DCBREG                                            01140020
         USING IOBDEF,IOBREG                                            01160020
         USING DEB,DEBREG                                               01180020
         USING DECBDEF,DECBREG                                          01200020
*                                                                       01220020
WKREG    EQU   0         WORK REGISTER                                  01240020
PARAM1   EQU   1         PARAMETER REGISTER                             01260020
DECBREG  EQU   1         DECB ADDRESS                                   01280020
DCBREG   EQU   2         DCB ADDRESS                                    01300020
IOBREG   EQU   3         IOB ADDRESS                                    01320020
EOVRETRN EQU   4         EOV RETURN ADDRESS                             01340020
DEBREG   EQU   5         DEB ADDRESS                                    01360020
WKREG1   EQU   6         WORK REGISTERS                                 01380020
WKREG2   EQU   7                                                        01400020
WKREG3   EQU   8                                                        01420020
WKREG4   EQU   9                                                        01440020
CCHH     EQU   9                                                        01460020
WKREG5   EQU   10                                                       01480020
WKREG6   EQU   11                                                       01500020
BASE     EQU   12        BASE OF THIS MODULE                            01520020
SAVE     EQU   13        USER'S SAVE AREA                               01540020
RETREG   EQU   14        RETURN ADDRESS WHEN ENTERED                    01560020
EPREG    EQU   15        ENTRY POINT                                    01580020
*                                                                       01600020
*                                                                       01620020
*                                                                       01640020
*                                                                       01660020
*  ENTRY POINTS TO THIS ROUTINE                                         01680020
*                                                                       01700020
WRTENTRY B     BEGIN                   GO TO BEGINNING OF WRITE CODE    01720020
*                                                                       01740020
         DROP  EPREG                                                    01760020
         USING IGG019DA,BASE                                            01780020
*                                                                       01800020
EOVENTRY L     DECBREG,IOBECBPT        LOAD DECB BASE ADDRESS           01820020
         L     BASE,DCBWRITE           SET BASE REGISTER                01840020
         OI    IOBLINK,EOVRET           INDICATE EOV ENTRY       YM6555 01850002
         LR    EOVRETRN,RETREG         MOVE RETURN TO EOV ADDRESS       01860020
         TM    DCBCIND1,VOLFUL         IS THE EXTENT FULL YET    YM7563 01870002
         BO    EOVON                   BR IF YES,SET BIT AND RET YM7563 01872002
         B     TST1FIT                 GO CALC RECORD LENGTH+OVERHEAD   01880020
*                                                                       01900020
*                                                                       01920020
BEGIN    SAVE  (14,12)                 SAVE THE USER'S REGISTER         01940020
         L     DCBREG,DECDCBAD         LOAD DCB BASE ADDRESS FROM DECB  01960020
         L     DEBREG,DCBDEBAD         LOAD DEB BASE ADDRESS FROM DCB   01980020
         LR    BASE,EPREG              MOVE ENTRY POINT TO BASE REG.    02000020
*                                                                       02020020
         L     IOBREG,DCBIOBA          USE CURRENT IOB TO LOCATE THE    02040020
         TM    DCBCIND2,X'20'           ARE WE HERE TO WRITE R0  A27066 02045020
*                                       ONLY                     A27066 02050020
         BO    WRTR0                    YES - BR TO DO IT        A27066 02055020
         L     IOBREG,IOBLINK           NEXT IOB ADDRESS                02060020
         TS    IOBLINK+4               IF NEXT IOB IS AVAILABLE         02080020
         BC    8,OKIOB                  GO INITIALIZE IT                02100020
*                                      ELSE RETURN WITH ERROR CODE 12   02120020
         LA    15,12                                                    02140020
         B     RETURN                                                   02160020
*                                                                       02180020
*                                                                       02200020
OKIOB    ST    IOBREG,DCBIOBA          STORE CURRENT IOB ADDRESS IN DCB 02220020
         LA    WKREG1,8(0,IOBREG)      STORE IOS IOB ADDRESS IN         02240020
         ST    WKREG1,DECIOBPT          THE DECB                        02260020
         ST    DECBREG,IOBECBPT        STORE DECB ADDRESS IN IOB        02280020
         CLI   IOBCCW1,SETSECT          IS THIS AN RPS CHAN      20201  02281020
*                                       PROGM                    20201  02282020
         BNE   NONCARN                  IF NOT, FORGET FOLLOWING 20201  02283020
*                                       RTN                      20201  02284020
         NI    IOBCCW10+D4,DCCHN        ELSE CLR DC FLAG         20201  02285020
         TM    DCBOPTCD,WRTCHK          IS WRT CHK SPECIFIED     20201  02286020
         BO    RPSVOLF                  YES THEN BRANCH TO TEST  XM6362 02287021
*                                         IF VOL IS FULL                02288021
         NI    IOBCCW6+D4,DCCHN         ELSE CLR COMMAND/DATA    20201  02289020
*                                         CHAIN                         02290020
RPSVOLF  TM    DCBCIND1,VOLFUL          IS THE VOLUME FULL       XM6362 02290421
         BO    EOVON                    BR IF YES                XM6362 02290821
         B     MVCAREA2                 BRANCH AROUND RPS        20201  02291020
NONCARN  EQU   *                                                 20201  02292020
         NI    IOBCCW7+4,X'3F'          CLEAR COMMAND CHAIN FLAG WHICH  02300020
         TM    DCBOPTCD,WRTCHK          ALLOWED R0 TO BE WRITTEN        02320020
         BC    1,MVCAREA                                                02340020
         NI    IOBCCW4+4,X'3F'            (FLAG IS IN CCW4 OR CCW7)     02360020
MVCAREA  MVC   IOBCCW4+1(3),DECAREA+1  MOVE AREA ADDRESS TO WRITE CCW   02380020
         TM    DCBCIND1,VOLFUL          IS THE VOLUME FULL       A34944 02384020
*                                       ALREADY?                 A34944 02388020
         BO    EOVON                    IF YES, DONT EXCP, GET   A34944 02392020
*                                       OUT                      A34944 02396020
*                                                                       02400020
*                                                                       02420020
*  CALCULATE RECORD LENGTH PLUS OVERHEAD                                02440020
*                                                                       02460020
TST1FIT  EQU   *                                                        02480020
         LH    WKREG2,IOBCCW4+6        GET KL+DL FROM THE WRITE CCW     02500020
MVCAREA2  EQU  *                                                 20201  02502020
         CLI   IOBCCW1,SETSECT          IS THIS AN RPS CHAN RGM  20201  02504020
         BNE   NOCARN                   IF NOT, NEGLECT NEXT     20201  02506020
*                                       INSTRS                   20201  02508020
         MVC   IOBCCW5+D1(Q3),DECAREA+D1 MOVE AREA ADDR TO WRT   20201  02510020
*                                             CCW                       02512020
         LH    WKREG2,IOBCCW5+D6        GET KL+DL FROM WRT CCW   20201  02514020
NOCARN   EQU   *                                                 20201  02516020
         L     WKREG1,DCBDVTBL         LOAD ADDRESS OF DADT ENTRY       02520020
         SR    WKREG,WKREG             IF NO KEYS ARE BEING WRITTEN,    02540020
         CLI   DCBKEYLE,0               WKREG WILL CONTAIN THE OVERHEAD 02560020
         BC    7,*+8                     TO BE SUBTRACTED               02580020
         IC    WKREG,OVERK(0,WKREG1)      FOR UNKEYED RECORDS           02600020
         SR    WKREG5,WKREG5                                            02620020
         IC    WKREG5,OVERL(0,WKREG1)  DEVELOP BYTES NEEDED FOR A       02640020
         TM    BYTEDEV(WKREG1),TBOVHD   TWO BYTE OVERHEAD USED   20201  02644020
         BNO   MZ0010                   BRANCH NO                20201  02648020
         LH    WKREG5,OVERI(WKREG1)     GET TWO BYTE OVERHEAD    20201  02652020
MZ0010   EQU   *                                                 20201  02656020
         AR    WKREG5,WKREG2               LAST RECORD BY               02660020
         SR    WKREG5,WKREG                KL+DL+OVERHEAD.              02680020
         SR    WKREG6,WKREG6              DEVELOP BYTES NEEDED FOR AN   02700020
         IC    WKREG6,OVERI(0,WKREG1)      INTERRMEDIATE RECORD BY      02720020
         TM    BYTEDEV(WKREG1),TBOVHD   TWO BYTE OVERHEAD USED   20201  02724020
         BNO   MZ0020                   BRANCH NO                20201  02728020
         LH    WKREG6,OVERI(WKREG1)     GET TWO BYTE OVERHEAD    20201  02732020
MZ0020   EQU   *                                                 20201  02736020
         MH    WKREG2,TOLER(0,WKREG1)       (KL+DL)TOLER + OVERHEAD     02740020
         SRL   WKREG2,9                                                 02760020
         AR    WKREG6,WKREG2                                            02780020
         SR    WKREG6,WKREG            WKREG5=LAST REC, WKREG6=INTER.   02800020
*                                                                       02820020
         TM    DCBCIND2,WZEROBIT       WAS LAST WRITE A WRITE R0        02840020
         BC    1,WZEROFF                YES, GO INCREMENT TRACK NO.     02860020
*                                                                       02880020
*   UPDATE DCB FIELDS                                                   02900020
*                                                                       02920020
FITS     LH    WKREG3,DCBTRBAL         DECREMENT TRACK BALANCE BY       02940020
         SR    WKREG3,WKREG6            THE SIZE OF AN                  02960020
         STH   WKREG3,DCBTRBAL          INTERMEDIATE RECORD             02980020
         MVC   IOBSEEK(8),DCBFDAD      MOVE PRIOR RECORD AS SEARCH ARG  03000020
         IC    WKREG3,DCBFDAD+7        INCREMENT THE R BYTE             03020020
         LA    WKREG3,1(0,WKREG3)       OF MBBCCHHR                     03040020
         STC   WKREG3,DCBFDAD+7         BY ONE                          03060020
         MVC   IOBDNRCF(5),DCBFDAD+3   MOVE CURRENT CCHHR TO NEW COUNT  03080020
*                                                                       03100020
TSTDUMMY TM    DECTYPE+1,DUMMY         IF TYPE IS WRITE DUMMY           03120020
         BC    8,TST2FIT                AND RECORDS HAVE KEYS           03140020
         SR    WKREG1,WKREG1                                            03160020
         IC    WKREG1,DCBKEYLE                                          03180020
         LTR   WKREG1,WKREG1                                            03200020
         BC    8,TST2FIT                                                03220020
         L     WKREG4,DECAREA                                           03240020
         STC   WKREG3,0(WKREG1,WKREG4)  MOVE R TO FIRST DATA BYTE       03260020
         MVI   0(WKREG4),X'FF'          AND DUMMY KEY TO FIRST KEY BYTE 03280020
TST2FIT  CH    WKREG5,DCBTRBAL         WILL ANOTHER RCD. FIT ON TRACK   03300020
         BC    3,WRTR0                  NO, PREPARE TO WRITE R0 TOO     03320020
*                                                                       03340020
         LA    WKREG1,NORMAL           SET RETURN ADDRESS FOR NOT EOV   03360020
         B     EXCP                    GO EXCP, TEST FOR ENTRY FROM EOV 03380020
*                                                                       03400020
*                                                                       03420020
*   SET UP TO WRITE CAPACITY RECORD                                     03440020
*                                                                       03460020
WRTR0    EQU   *                                                        03480020
         OI    DCBCIND2,WZEROBIT       SET- LAST I/O WAS WRITE R0 BIT   03500020
         CLI   IOBCCW1,SETSECT          RPS CHAN PROGRAM         20201  03502020
         BNE   NOTCARN                  IF NOT BRANCH OUT        20201  03504020
         OI    IOBCCW6+D4,CCHN          RESET COMMAND CHAIN      20201  03506020
         TM    DCBOPTCD,WRTCHK          IS WRT CHK SPECIFIED     20201  03508020
         BNO   NOWRTCHK                 NO, LEAVE FLAGS AS IS    20201  03510020
         OI    IOBCCW10+D4,CCHN         YES, RESET COMMAND CHN   20201  03512020
         B     NOWRTCHK                 BRANCH AROUND NON CARN   20201  03514020
*                                       RTN                      20201  03516020
NOTCARN  EQU   *                                                 20201  03518020
         OI    IOBCCW4+4,CCHN          THIS WRITE MUST ALSO WRITE OUT   03520020
         TM    DCBOPTCD,WRTCHK           THE CAPACITY RECORD SO SET ON  03540020
         BC    8,*+8                     THE COMMAND CHAIN FLAG         03560020
         OI    IOBCCW7+4,CCHN             (CCW4 OR CCW7)                03580020
NOWRTCHK EQU   *                                                 20201  03590020
         MVC   IOBR0CNT(4),DCBFDAD+3   MOVE CCHH0 TO R0 COUNT           03600020
         MVC   IOBR0DAT(5),DCBFDAD+3   MOVE CCHHR AS HIGHEST ID ON TRK  03620020
*                                                                       03640020
         BAL   WKREG1,EXCP              EXCP, TEST FOR ENTRY FROM EOV   03660002
*                                                                       03680020
EOECHK   EQU   *                        CHECK END OF EXTENT     SA58617 03690002
         SR    WKREG2,WKREG2            FIND LAST EXTENT IN THE DEB     03700002
         IC    WKREG2,DEBNMEXT          BY NUMBER OF EXTENTS            03720020
         BCTR  WKREG2,0                 MINUS ONE                       03740002
         SLL   WKREG2,4                 TIMES 16                        03760020
         AR    WKREG2,DEBREG            PLUS DEB BASE ADDRESS           03780020
         CLC   DCBFDAD+3(4),DEBENDCC-DEB(WKREG2)  IS THIS LAST TRACK    03800020
         LA    15,4                    SET RETURN CODE OF FULL TRACK(4) 03820020
         BC    7,RETURN                IF NOT LAST TRACK, RETURN        03840020
*                                                                       03890002
         LA    15,8                     SET RETURN CODE TO LAST TRK(8)  03900002
         B     RETURN                   AND RETURN TO THE USER          03910002
*                                                                       03920020
*                                                                       03940020
*  BYPASS EXCP FOR REQUESTS AFTER EOV                                   03960020
*                                                                       03980020
SETEOV   OI    DCBCIND1,VOLFUL         MARK DCB SO FUTURE REQ.S BYPASS  04000020
         BCTR  WKREG3,0                 RESTORE DCBFDAD           12987 04006020
         STC   WKREG3,DCBFDAD                                     12987 04012020
POSTEOV  OI    IOBLINK,EOVBIT          MARK IOB AS NOT EXCP'D           04020020
*                                                                       04040020
         LH    EPREG,DCBTRBAL           DECREMENT TRACK BALANCE BY15366 04042020
         SR    EPREG,WKREG6             SIZE OF INTERMEDIATE RECD 15366 04044020
         CR    EPREG,WKREG5             WILL ANOTHER RECORD FIT   15366 04046020
         BNL   NORMAL                   YES BRANCH                15366 04048020
         B     EOECHK                   BR TO SEE IF END OF EXT SA58617 04050002
*                                                                       04052002
EOVON    OI    IOBLINK,EOVBIT           TURN ON SWITCH, IOB NOT  A34944 04054020
*                                       EXCP'D                   A34944 04056020
NORMAL   SR    15,15                   SET RETURN CODE TO ZERO          04060020
*                                                                       04080020
RETURN   EQU   *                        RETURN TO CALLER         YM6555 04090002
         TM    IOBLINK,EOVRET           IS CALLER EOV            YM6555 04092002
         BNO   USERRET                  NO, RETURN TO USER       YM6555 04094002
         NI    IOBLINK,X'FF'-EOVRET     TURN OF EOV ENTRY BIT    YM6555 04096002
         BR    EOVRETRN                 RET TO EOV - HAVE RUN    YM6555 04098002
*                                       OUT OF SPACE ON NEW EXT  YM6555 04098402
USERRET  RETURN (14,12),T,RC=(15)       RETURN TO THE USER       YM6555 04100002
*                                                                       04120020
*   INCREMENT TRACK ADDRESS BY 1 AND CHECK VALIDITY                     04140020
*                                                                       04160020
WZEROFF  XI    DCBCIND2,WZEROBIT       TURN OFF WRITE R0 FLAG           04180020
         MVC   IOBCSW(4),MAXCC(WKREG1) MOVE NO. OF CYL.S, TRACKS TO IOB 04200020
         MVC   IOBCSW+4(4),DCBFDAD+3   MOVE CURRENT CCHH FOR ALIGNMENT  04220020
         SR    WKREG2,WKREG2                                            04260020
         IC    WKREG2,DCBFDAD          DEVELOP POINTER TO CURRENT       04280020
         SLL   WKREG2,4                 EXTENT IN THE DEB               04300020
         AR    WKREG2,DEBREG                                            04320020
         LA    IOBREG,0(0,IOBREG)      BE SURE HI-ORDER BYTE IS ZERO    04340020
         LA    WKREG3,3(0,IOBREG)       SET CCHH INDEX TO LAST H        04360020
         L     CCHH,IOBCSW+4           LOAD CURRENT CCHH TO AN ACCUM.   04380020
         TM    BYTEDEV(WKREG1),BYTE     ARE BYTES NON-CONTIGUOUS        04386020
         BZ    DOWNONE                  BRANCH IF CONTIGUOUS ADDRESS    04392020
ADDONE   AH    CCHH,ONE                ADD ONE TO THE LO-ORDER BYTE     04400020
         TM    BYTEDEV(WKREG1),BYTE    ARE BYTES NON-CONTIGUOUS         04420020
         BC    1,USEBYTE                YES, TREAT EACH SEPARATELY      04440020
         STH   CCHH,IOBCSW+4-IOBDEF(0,WKREG3)  STORE NEW CC OR HH       04460020
         CLC   IOBCSW+4-IOBDEF(2,WKREG3),IOBCSW-IOBDEF(WKREG3)          04480020
*                                            CHECK FOR VALID VALUE      04500020
         BC    4,TSTEXT                ADDRESS VALID, CHECK EXTENT      04520020
         SRL   CCHH,16                 SHIFT TO CC VALUE                04540020
         MVC   IOBCSW-IOBDEF+4(2,WKREG3),ZEROS  ZERO BYTES PROCESSED    04580020
         BCTR  WKREG3,0                DECREMENT THE CCHH INDEX         04620020
DOWNONE  BCTR  WKREG3,0                                                 04640020
         CR    WKREG3,IOBREG           HAVE ALL BYTES BEEN PROCESSED    04660020
         BC    10,ADDONE                NO, LOOP TO ADD ONE TO NEXT BYT 04680020
*                                                                       04700020
NEXTEXT  IC    WKREG3,DCBFDAD          INCREMENT M AND SEE IF THIS WAS  04720020
         LA    WKREG3,1(0,WKREG3)       THE LAST EXTENT.                04740020
         STC   WKREG3,DCBFDAD                                           04760020
         CLC   DCBFDAD(1),DEBNMEXT                                      04780020
         BC    8,SETEOV                 YES, GO SET EOV BIT             04800020
         LA    WKREG2,16(0,WKREG2)     INCREMENT TO NEXT EXTENT         04820020
         MVC   DCBFDAD+1(6),DEBBINUM-DEB(WKREG2)  MOVE BBCCHH TO DCB    04840020
RESETBAL MVI   DCBFDAD+7,0             MOVE A ZERO TO R BYTE            04860020
         L     WKREG3,IOBCCW1          MOVE A ZERO TO          @ZA30898 04865000
         MVI   ONEBYTE(WKREG3),0             SECTOR VALUE      @ZA30898 04870000
         MVC   DCBTRBAL,TRKL(WKREG1)   RESET TRACK BALANCE     @ZA30898 04875000
*                                                                       04880020
         CH    WKREG5,DCBTRBAL         WILL THE NEW TRACK HOLD ONE RCD. 04900020
         BC    12,FITS                  YES, GO DECREMENT TRACK BALANCE 04920020
ABEXIT   EQU   *                        ABEND EXIT               YM3919 04930002
         OI    DCBIFLGS,DCBIFEC         SET ERROR FLAGS ON       YM3919 04940002
*                                       TO PREVENT IOS FROM      YM3919 04950002
*                                       WRITING R0 DURING CLOSE  YM3919 04952002
*                                       IF AN ATTEMPT IS MADE    YM3919 04954002
         DMABCOND  205,SVC=YES,DCB=(DCBREG) BR PROB DET TO ABEND Y02072 04960002
*                                                                       04980020
USEBYTE  STC   CCHH,IOBCSW+4-IOBDEF(0,WKREG3)  STORE THIS BYTE AND      05000020
         SRL   CCHH,8                   SHIFT TO THE NEXT ONE           05020020
         CLC   IOBCSW+4-IOBDEF(1,WKREG3),IOBCSW-IOBDEF(WKREG3)          05040020
*                                                 THIS BYTE VALID       05060020
         BC    4,TSTEXT                YES, GO CHECK EXTENT LIMIT       05080020
         MVI   IOBCSW+4-IOBDEF(WKREG3),0  NO,ZERO INVALID BYTE AND      05100020
         BC    15,DOWNONE               GO LOOK AT THE NEXT ONE         05120020
*                                                                       05140020
TSTEXT   CLC   IOBCSW+4(4),DEBENDCC-DEB(WKREG2)  ADDRESS WITHIN EXTENT  05160020
         BC    2,NEXTEXT               NO, SEE IF THERE'S ANOTHER EXT   05180020
         MVC   DCBFDAD+3(4),IOBCSW+4   YES, MOVE NEW CCHH TO DCB        05200020
         BC    15,RESETBAL              AND GO RESET TRACK BALANCE      05220020
*                                                                       05240020
*                                                                       05260020
*                                                                       05280020
EXCP     EQU   *                                                 20201  05283020
         SR    PARAM1,PARAM1            PRIME FOR NON RPS        20201  05286020
         CLI   IOBCCW1,SETSECT          IS THIS RPS CHANNEL PGM  20201  05289020
         BNE   SKIPCARN                 IF NOT, SKIP MOVING OF   20201  05292020
*                                       SECTOR                   20201  05295020
*                                            VALUE TO SECTOR1           05298020
         LA    PARAM1,D16               PRIME FOR RPS            20201  05310020
SKIPCARN EQU   *                                                 20201  05313020
         TM    DCBCIND2,X'20'           ARE WE HERE TO WRITE R0  A27066 05321020
*                                       ONLY                     A27066 05322020
         BNO   EXCPA                    NO BR TO EXCP            A27066 05323020
         LA    PARAM1,IOBCCW5(PARAM1)  PUT ADDR OF WRT R0 CCW    M6283  05324020
         TM    DCBOPTCD,WRTCHK          STRING IN IOB CHANNEL    A27066 05325020
*                                       PROGRAM                  A27066 05326020
         BZ    NOVERIFY                 START ADDR. (CCW5 OR     20201  05327020
*                                       CCW8                     A27066 05328020
         LA    PARAM1,IOBCCW8          DEPENDING IF WRITE        M6477  05329020
*                                       VALIDITY                 A27066 05330020
         CLI   IOBCCW1,SETSECT          IS THIS RPS              20201  05330220
         BNE   NOVERIFY                 NO, DONT INCREMENT & BR  20201  05330420
         LA    PARAM1,D24(0,PARAM1)     YES INCREMENT            20201  05330620
NOVERIFY EQU   *                                                 20201  05330820
         ST    PARAM1,IOBSTART          CHECK WAS SPECIFIED)     A27066 05331020
EXCPA    EQU   *                                                 A27066 05332020
         LA    PARAM1,8(0,IOBREG)       SET IOS IOB POINTER      A27066 05333020
         EXCP  (1)                                                      05360020
*                                                                       05380020
         TM    DCBCIND2,X'20'           IF ENTERED FROM CLOSE TO A27066 05385020
*                                       WRITE                    A27066 05390020
         BO    RETURN                   R0-RETURN TO CLOSE       A27066 05395020
*                                                                       05400020
EOVTST   TM    IOBLINK,EOVBIT           IF ENTERED BY EOV        YM6555 05420002
         BNOR  WKREG1                   RETURN TO THE BAL+4             05440002
*                                                                       05460020
         NI    IOBLINK,X'FF'-EOVBIT     TURN OFF EOV BIT         YM6555 05470002
         NI    IOBLINK,X'FF'-EOVRET     TURN OFF EOV RETURN BIT  YM6555 05472002
         BR    EOVRETRN                 ELSE RETURN TO EOV              05520020
*                                                                       05540020
**********************************************************************  05560020
*                                                                       05580020
ZEROS    DC    H'0'                     ZERO CONSTANT                   05590020
ONE      DC    H'1'      CONSTANT ONE                                   05600020
SETSECT  EQU   X'23'                    SET SECTOR COMMAND       20201  05665020
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD INDIC  20201  05670020
DCCHN    EQU   X'3F'                    DATA/COMMAND CHN USE     20201  05675020
CCHN     EQU   X'40'     COMMAND CHAIN FLAG                             05680020
WRTCHK   EQU   X'80'     WRITE CHECK OPTION                             05700020
DUMMY    EQU   X'10'     WRITE DUMMY TYPE                               05720020
WZEROBIT EQU   X'40'     LAST I/O WAS WRITE R0                          05740020
EOVBIT   EQU   X'80'     THIS WRITE NOT SCHEDULED BECAUSE OF EOV        05760020
NOTEOV   EQU   X'7F'     ALL BITS EXCEPT USCHEDULED BECAUSE OF EOV      05780020
VOLFUL   EQU   X'20'     VOLUME FULL BIT                                05800020
*                                                                       05820020
*      DIRECT ACCESS DEVICE TABLE DEFINITION                            05840020
D1       EQU   1                        1 BYTE DISPLACEMENT      20201  05842020
ONEBYTE  EQU   1                        ONE BYTE QTY AND         20201  05844020
*                                       DISPLACEMENT             20201  05846020
Q3       EQU   3                        3 BYTE QUANTITY          20201  05848020
D4       EQU   4                        4 BYTE DISPLACEMENT      20201  05850020
D6       EQU   6                        6 BYTE DISPLACEMENT      20201  05852020
D16      EQU   16                       SIXTEEN BYTE             20201  05854020
*                                       DISPLACEMENT             20201  05856020
D24      EQU   24                       24 BYTE DISPLACEMENT     20201  05858020
BYTE     EQU   2         BYTES OF  CCHH ARE NON-CONTIGUOUS              05860020
OVERK    EQU   8         OFFSET TO KEY OVERHEAD                         05880020
OVERI    EQU   6                   INTERMEDIATE RECORD OVERHEAD         05900020
OVERL    EQU   7                   LAST RECORD OVERHEAD                 05920020
TOLER    EQU   10                  TOLERANCE FACTOR                     05940020
TRKL     EQU   4                   BYTES ON TRACK                       05960020
MAXCC    EQU   0                   NO. OF CYLINDERS, TRACKS             05980020
BYTEDEV  EQU   9                   FLAG, BYTES ARE NON-CONTIGUOUS       06000020
EOVRET   EQU   X'10'                    BIT INDICATING CALLER    YM6555 06002002
*                                       OF THIS MODULE WAS EOV   YM6555 06004002
MODID    DC    C'IGG019DA'              MODULE ID                Y02072 06010002
FIX      DC    C'OZ30898 '              LATEST FIX IN MODULE     YM7563 06012000
DATE     DC    CL8'&SYSDATE'            DATE OF LATEST FIX       YM7563 06013000
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 06017002
         EJECT                                                          06067002
*************************  DCB DEFINITION  **************************** 06120020
         DCBD  DSORG=(PS),DEVD=(DA)                                     06140020
         EJECT                                                          06160020
*************************  IOB DEFINITION  **************************** 06180020
IOBDEF   DSECT      I/O BLOCK DEFINITION                                06200020
IOBLINK  DS    F         IOB LINK ADDRESS                               06220020
IOBIOBA  DS    F         IOB ADDRESS FOR EOV                            06240020
IOBFLAG1 DS    CL1       ERROR FLAG 1                                   06260020
IOBFLAG2 DS    CL1       ERROR FLAG 2                                   06280020
IOBSENSE DS    CL2       I/O SENSE BITS                                 06300020
IOBECBPT DS    F         ECB ADDRESS                                    06320020
IOBCSW   DS    D         CSW STORED BY IOS                              06340020
IOBSIOCC DS    0BL1      SIO CONDITION CODE                             06360020
IOBSTART DS    F         CHANNEL PROGRAM STARTING CCW                   06380020
IOBDCBPT DS    F         DCB ADDRESS                                    06400020
IOBRESTR DS    F         CHANNEL PROGRAM RESTART ADDRESS                06420020
IOBINCAM DS    CL2       BLOCK INCREMENT AMOUNT                         06440020
IOBERRCT DS    CL2       ERROR COUNTS                                   06460020
IOBSEEK  DS    D         SEEK ADDRESS                                   06480020
IOBDNRCF DS    D         NEW RECORD COUNT FIELD                         06500020
IOBR0CNT DS    D         COUNT FIELD OF R0                              06520020
IOBR0DAT DS    D         DATA FIELD OF R0                               06540020
IOBCCW1  DS    D         FIRST CCW OF CHANNEL PROGRAM                   06560020
IOBCCW2  DS    D                                                        06580020
IOBCCW3  DS    D                                                        06600020
IOBCCW4  DS    D                                                        06620020
IOBCCW5  DS    D                                                        06640020
IOBCCW6  DS    D                                                        06660020
IOBCCW7  DS    D                                                        06680020
IOBCCW8  DS    D                                                        06700020
IOBCCW9  DS    D                                                        06720020
IOBCCW10 DS    D                                                        06740020
IOBCCW11 DS    D                                                        06760020
IOBCCW12 DS    D                                                        06780020
IOBCCW13 DS    D                                                        06800020
IOBCCW14 DS    D         LAST CCW OF LONGEST CHANNEL PROGRAM            06820020
*                                                                       06840020
*************************  DECB DEFINITION  *************************** 06860020
*                                                                       06880020
DECBDEF  DSECT     DATA EVENT CONTROL BLOCK                             06900020
DECSDECB DS    F         STANDARD ECB                                   06920020
DECTYPE  DS    CL2       TYPE AND OPTIONS                               06940020
DECLNGTH DS    CL2       DATA LENGTH                                    06960020
DECDCBAD DS    F         DCB ADDRESS                                    06980020
DECAREA  DS    F         AREA ADDRESS                                   07000020
DECIOBPT DS    F         IOB ADDRESS                                    07020020
DECKYADR DS    F                                                        07040020
DECOFSET DS    CL2                                                      07060020
DECRESPN DS    CL1                                                      07080020
         EJECT                                                          07100020
*************************  DEB DEFINITION  **************************** 07120020
*                                                                       07140020
DEB      DSECT                                                          07160020
         DS    0F                                                       07180020
DEBNMSUB DS    0CL1                                                     07200020
DEBTCBAD DS    CL4                                                      07220020
DEBAMLNG DS    0CL1                                                     07240020
DEBDEBAD DS    CL4                                                      07260020
DEBOGLGS DS    0CL1                                                     07280020
DEBIRBAD DS    CL4                                                      07300020
DEBOPATB DS    0CL1                                                     07320020
DEBSYSPG DS    CL4                                                      07340020
DEBNMEXT DS    0CL1                                                     07360020
DEBUSRPG DS    CL4                                                      07380020
DEBPRIOR DS    0CL1                                                     07400020
DEBECBAD DS    CL4                                                      07420020
DEBPROTG DS    0CL1                                                     07440020
DEBDEBID DS    0CL1                                                     07460020
DEBDCBAD DS    CL4                                                      07480020
DEBEXSCL DS    0CL1                                                     07500020
DEBAPPAD DS    CL4                                                      07520020
DEBDVMOD DS    0CL1                                                     07540020
DEBUCBAD DS    CL4                                                      07560020
DEBBINUM DS    CL2                                                      07580020
DEBSTRCC DS    CL2                                                      07600020
DEBSTRHH DS    CL2                                                      07620020
DEBENDCC DS    CL2                                                      07640020
DEBENDHH DS    CL2                                                      07660020
DEBNMTRK DS    CL2                                                      07680020
DEBSUBID EQU   0         SUBROUTINE ID'S                                07700020
         END                                                            07720020
./  ADD  SSI=31320980,NAME=IGG019DB
   TITLE 'IGG019DB - BDAM CREATE WRITE, VARIABLE/UNDEFINED FORMAT'      00006402
IGG019DB CSECT                                                          00006802
*MODULE NAME = IGG019DB                                               * 00008002
*                                                                     * 00008402
*DESCRIPTIVE NAME = BDAM CREATE WRITE, VARIABLE & UNDEFINED FORMAT    * 00008902
*                                                                     * 00009002
*COPYRIGHT = NONE                                                     * 00011002
*                                                                     * 00011402
*CHANGE ACTIVITY                                                      * 00011802
*                                                                     * 00012002
*        RELEASE 20 CHANGES/DELETIONS                                   00036002
*0833000120-000180,000420-000600                                 20201  00039020
*        RELEASE 21 CHANGES/DELETIONS                                   00049002
*0410                                                            A46868 00051002
*        VS1-1 CHANGES/DELETIONS                                        00053002
*        VS2-1 CHANGES/DELETIONS                                        00055002
*        VS1-2 CHANGES/DELETIONS                                        00057002
*        VS2-2 CHANGES/DELETIONS                                        00057402
*062820-062960,065600-066000                                     Y02072 00057802
*                                                                       00058202
*STATUS CHANGE LEVEL 005                                                00059002
*                                                                       00069002
*FUNCTIONS- THIS ROUTINE OBTAINS AN IOB, INITIALIZES THE CHANNEL        00100020
*    PROGRAM, AND ISSUES THE 'EXCP' FOR A WRITE TYPE SF OR SZ TO A      00120020
*    FORMAT 'V' OR 'U' DATA SET.                                        00140020
*    IF THIS WRITE IS FOR A RECORD WHICH WILL NOT FIT ON THIS TRACK,    00160020
*    A RETURN CODE OF 4 WILL BE RETURNED AND THE USER SHOULD NEXT ISSUE 00180020
*    A WRITE TYPE 'SZ'. THIS WILL CAUSE THE CAPACITY RECORD TO BE       00200020
*    WRITTEN ON THE CURRENT TRACK.                                      00220020
*    IF A TYPE 'SZ' IS ISSUED AND THERE HAVE BEEN NO RECORDS WRITTEN    00240020
*    ON THIS TRACK, THE CAPACITY RECORD WILL BE WRITTEN AND AN ERASE    00260020
*    CCW INCLUDED TO CLEAR THE REMAINDER OF THE TRACK.                  00280020
*                                                                       00300020
*ENTRY POINTS- 'WRTENTRY' IS THE NORMAL ENTRY POINT FROM THE WRITE      00320020
*    MACRO EXPANSION. CALLING SEQUENCE IS     L     15,DCBWRITE         00340020
*                                             BALR  14,15               00360020
*                                                                       00380020
*    'EOVENTRY' IS THE ENTRY FROM THE BSAM END-OF-VOLUME EXECUTOR TO    00400020
*    RESTART A WRITE WHICH WAS ISSUED AFTER THE CURRENT SPACE           00420020
*    ALLOCATION WAS FILLED. THE RECORD WILL NOW BE WRITTEN INTO THE     00440020
*    SPACE OBTAINED AS SECONDARY ALLOCATION. CALLING SEQUENCE IS        00460020
*                                              L    15,DCBWRITE         00480020
*                                              BAL  14,4(15)            00500020
*INPUT- TO 'WRTENTRY'- DECB ADDRESS IN REGISTER 1                       00520020
*       TO 'EOVENTRY'- IOB ADDRESS IN REGISTER 3                        00540020
*                      DCB ADDRESS IN REGISTER 2                        00560020
*                      DEB ADDRESS IN REGISTER 5                        00580020
*                                                                       00600020
*OUTPUT- AN IOB FROM THE POOL OF IOBS WILL BE ASSIGNED TO THIS DECB     00620020
*    AND ITS ADDRESS PLACED IN THE DECB, EXCP WILL BE ISSUED TO         00640020
*    SCHEDULE THIS WRITE.                                               00660020
*                                                                       00680020
*EXTERNAL ROUTINES-                                                     00700020
*                                                                       00720020
*EXITS- 'RETURN' IS AN EXIT BACK TO THE USER, REGISTER 15 WILL CONTAIN  00740020
*    A RETURN CODE AS FOLLOWS,                                          00760020
*        0 = RECORD WAS WRITTEN, THERE IS MORE SPACE ON THE TRACK       00780020
*        4 = RECORD NOT WRITTEN, THE TRACK IS FILLED, TYPE SZ SHOULD BE 00800020
*            ISSUED AND THEN THE TYPE SF MAY BE REISSUED.               00820020
*        8 = RECORD WAS WRITTEN, DATA SET IS FILLED                     00840020
*        12= RECORD NOT WRITTEN, NO IOB IS AVAILABLE UNTIL 'CHECK' HAS  00860020
*            BEEN ISSUED.                                               00880020
*    'EOVEXIT' IS A RETURN TO THE END-OF-VOLUME EXECUTOR.               00900020
*                                                                       00920020
*    'ABEXIT' IS AN EXIT WHEN THE RECORD WILL NOT FIT ON AN EMPTY       00940002
*      TRACK. A DMABCOND MACRO IS ISSUED TO TRANSFER CONTROL TO         00960002
*      THE PROBLEM DETERMINATION MODULES WHICH WILL ISSUE A WTP         00970002
*      MESSAGE AND GTRACE PERTINENT CONTROL BLOCKS BEFORE ISSUING       00972002
*      THE ABEND. A RETURN CODE ACCOMPANYING THE ABEND WILL             00974002
*      IDENTIFY THE EXACT CAUSE OF THE ERROR.                           00976002
*                                                                       00980020
*TABLES  1. DIRECT ACCESS DEVICE TABLE IS USED TO CALCULATE THE BYTES   01000020
*           OF OVERHEAD FOR THIS RECORD AND TO DETERMINE THE NEXT       01020020
*           VALID TRACK ADDRESS AND TRACK LENGTH.                       01040020
*                                                                       01060020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.            01080020
*                                                                       01100020
*NOTES- THE REGISTER USAGE IN THIS MODULE AND THE BSAM END-OF-VOLUME    01120020
*    EXECUTOR MUST REMAIN CONSISTENT.                                   01140020
*                                                                       01160020
*                                                                       01180020
*  REGISTER USAGE                                                       01200020
*                                                                       01220020
         USING IGG019DB,EPREG                                           01240020
         USING IHADCB,DCBREG                                            01260020
         USING IOBDEF,IOBREG                                            01280020
         USING DEB,DEBREG                                               01300020
         USING DECBDEF,DECBREG                                          01320020
*                                                                       01340020
WKREG    EQU   0         WORK REGISTER                                  01360020
PARAM1   EQU   1         PARAMETER REGISTER                             01380020
DECBREG  EQU   1         DECB ADDRESS                                   01400020
DCBREG   EQU   2         DCB ADDRESS                                    01420020
IOBREG   EQU   3         IOB ADDRESS                                    01440020
EOVRETRN EQU   4         EOV RETURN ADDRESS                             01460020
DEBREG   EQU   5         DEB ADDRESS                                    01480020
WKREG1   EQU   6         WORK REGISTERS                                 01500020
WKREG2   EQU   7                                                        01520020
WKREG3   EQU   8                                                        01540020
WKREG4   EQU   9                                                        01560020
CCHH     EQU   9                                                        01580020
WKREG5   EQU   10                                                       01600020
WKREG6   EQU   11                                                       01620020
BASE     EQU   12        BASE OF THIS MODULE                            01640020
SAVE     EQU   13        USER'S SAVE AREA                               01660020
RETREG   EQU   14        RETURN ADDRESS WHEN ENTERED                    01680020
EPREG    EQU   15        ENTRY POINT                                    01700020
*                                                                       01720020
*                                                                       01740020
*                                                                       01760020
*                                                                       01780020
*  ENTRY POINTS TO THIS ROUTINE                                         01800020
*                                                                       01820020
WRTENTRY B     BEGIN                   GO TO BEGINNING OF WRITE CODE    01840020
*                                                                       01860020
         DROP  EPREG                                                    01880020
         USING IGG019DB,BASE                                            01900020
*                                                                       01920020
EOVENTRY L     DECBREG,IOBECBPT        LOAD DECB BASE ADDRESS           01940020
         L     BASE,DCBWRITE           SET BASE REGISTER                01960020
         LR    EOVRETRN,RETREG         MOVE RETURN TO EOV ADDRESS       01980020
         B     TSTSZ                   GO DETERMINE TYPE OF WRITE       02000020
*                                                                       02020020
*                                                                       02040020
BEGIN    SAVE  (14,12)                 SAVE THE USER'S REGISTER         02060020
         L     DCBREG,DECDCBAD         LOAD DCB BASE ADDRESS FROM DECB  02080020
         L     DEBREG,DCBDEBAD         LOAD DEB BASE ADDRESS FROM DCB   02100020
         LR    BASE,EPREG              MOVE ENTRY POINT TO BASE REG.    02120020
         L     IOBREG,DCBIOBA          LOAD CURRENT IOB ADDRESS         02140020
         TS    IOBLINK+4               IS CURRENT IOB AVAILABLE         02160020
         BC    8,OKIOB                 BR YES (PREV RCD DIDN'T FIT TRK) 02180020
*                                                                       02200020
         L     IOBREG,IOBLINK          LOAD ADDRESS OF NEXT IOB         02220020
         TS    IOBLINK+4               IF NEXT IOB IS AVAILABLE         02240020
         BC    8,OKIOB                  GO INITIALIZE IT                02260020
*                                      ELSE RETURN WITH ERROR CODE 12   02280020
         LA    15,12                                                    02300020
         B     RETURN                                                   02320020
*                                                                       02340020
*                                                                       02360020
USEBLKS  LH    WKREG4,DCBBLKSI         USE MAXIMUM LENGTH AS DATA LNG   02380020
         B     ADDKEY                   GO ADD KEY LENGTH               02400020
*                                                                       02420020
USELL    LA    WKREG4,0(WKREG1,WKREG3) FIND THE FIRST TWO BYTES OF THE  02440020
         MVC   IOBCSW(2),0(WKREG4)      USER'S RECORD, ALIGN THEM,      02460020
         LH    WKREG4,IOBCSW            USE AS DATA LENGTH.             02480020
         B     ADDKEY                  GO ADD KEY LENGTH                02500020
*                                                                       02520020
*                                                                       02540020
OKIOB    ST    IOBREG,DCBIOBA          STORE CURRENT IOB ADDRESS IN DCB 02560020
         LA    WKREG,8(0,IOBREG)       STORE ADDRESS OF IOS IOB IN      02580020
         ST    WKREG,DECIOBPT            THE DECB                       02600020
         ST    DECBREG,IOBECBPT        STORE DECB ADDRESS IN IOB        02620020
         TM    DCBCIND1,VOLFUL          IS THE VOLUME FULL YET   A46868 02625021
         BO    POSTEOV                  YES, SET EOV BIT AND     A46868 02630021
*                                       RETURN                   A46868 02635021
TSTSZ    TM    DECTYPE+1,WZERO         IS THIS A WRITE R0 REQUEST       02640020
         BC    1,WZERORTN               YES, GO TO WZERO ROUTINE        02660020
         LA    WKREG,IOBCCW1           BE SURE IOBSTART IS              02680020
         ST    WKREG,IOBSTART           RESET TO CCW1                   02700020
*                                                                       02720020
         SR    WKREG1,WKREG1           INSERT KEY LENGTH FROM THE DCB   02740020
         IC    WKREG1,DCBKEYLE          (MAY BE ZERO)                   02760020
         L     WKREG3,DECAREA          LOAD ADDRESS OF OUTPUT AREA      02780020
TSTV     TM    DCBRECFM,UNKWN          IF FORMAT IS VARIABLE            02800020
         BC    8,USELL                  GO USE LL FROM RECORD           02820020
         TM    DECTYPE,SOPT     IF THE OPTION TO USE DCBBLOCK SIZE 6991 02840020
         BC    1,USEBLKS                WAS SPECIFIED, GO USE IT        02860020
         LH    WKREG4,DECLNGTH         USE DECB LENGTH AS DATA LENGTH   02880020
*                                                                       02900020
ADDKEY   LA    WKREG2,0(WKREG1,WKREG4) ADD KEY LENGTH + DATA LENGTH     02920020
         STH   WKREG4,IOBDNRCF+6       STORE DATA LNG IN NEW COUNT FLD  02940020
         CLI   IOBCCW1,SETSECT          IS THIS RPS              20201  02941020
         BNE   NOTCARN                  IF NOT, TREAT C.P. AS    20201  02942020
*                                       USUAL                    20201  02943020
         LTR   WKREG2,WKREG2            TEST IF ANY BYTES ARE    20201  02944020
*                                       WRITTEN                  20201  02945020
         BNZ   REALRIT                  YES GO ON                20201  02946020
         NI    IOBCCW4+D4,CCHNOFF       TURN OFF CHAIN BIT       20201  02947020
         B     NEXT01                   BRANCH                   20201  02948020
REALRIT  EQU   *                                                 20201  02949020
         OI    IOBCCW4+D4,CCHN                                   20201  02950020
NEXT01   EQU   *                                                 20201  02951020
         MVC   IOBCCW5+D1(THREE),DECAREA+D1  MOVE AREA TO WRT    20201  02952020
*                                                                       02953020
         STH   WKREG2,IOBCCW5+D6        ST KL+DL IN WRT CCW CNT  20201  02954020
         B     CALCLGN                  BRANCH AROUND NON RPS    20201  02955020
*                                       RTN                      20201  02956020
NOTCARN  EQU   *                                                 20201  02957020
         LTR   WKREG2,WKREG2           TEST IF ANY BYTES ARE WRITTEN    02960020
         BC    7,REALRITE              YES GO ON                        02980020
         NI    IOBCCW3+4,X'BF'          TURN OFF COMMAND CHAIN BIT      03000020
         B     *+8                                                      03020020
REALRITE EQU   *                                                        03040020
         OI    IOBCCW3+4,CCHN          TURN ON COMMAND CHAIN BIT        03060020
         MVC   IOBCCW4+1(3),DECAREA+1  MOVE AREA TO WRITE CCW ADDRESS   03080020
         STH   WKREG2,IOBCCW4+6        STORE KL+DL IN WRITE CCW COUNT   03100020
*                                                                       03120020
*                                                                       03140020
*  CALCULATE RECORD LENGTH PLUS OVERHEAD                                03160020
*                                                                       03180020
CALCLGN  L     WKREG3,DCBDVTBL         LOAD ADDR. OF DADT ENTRY         03200020
         SR    WKREG,WKREG             IF NO KEYS ARE BEING WRITTEN,    03220020
         CLI   DCBKEYLE,0               WKREG WILL CONTAIN THE OVERHEAD 03240020
         BC    7,*+8                     TO BE SUBTRACTED               03260020
         IC    WKREG,OVERK(0,WKREG3)     FOR UNKEYED RECORDS            03280020
         SR    WKREG5,WKREG5                                            03300020
         IC    WKREG5,OVERL(0,WKREG3)  DEVELOP BYTES NEEDED FOR A       03320020
         TM    BYTEDEV(WKREG3),TBOVHD   TWO BYTE OVERHEAD USED   20201  03324020
         BNO   MZ0010                   BRANCH NO                20201  03328020
         LH    WKREG5,OVERI(WKREG3)     GET TWO BYTE OVERHEAD    20201  03332020
MZ0010   EQU   *                                                 20201  03336020
         AR    WKREG5,WKREG2               LAST RECORD BY               03340020
         SR    WKREG5,WKREG                KL+DL+OVERHEAD.              03360020
*                                                                       03380020
         SR    WKREG6,WKREG6              DEVELOP BYTES NEEDED FOR AN   03400020
         IC    WKREG6,OVERI(0,WKREG3)      INTERMEDIATE RECORD BY       03420020
         TM    BYTEDEV(WKREG3),TBOVHD   TWO BYTE OVERHEAD USED   20201  03424020
         BNO   MZ0020                   BRANCH NO                20201  03428020
         LH    WKREG6,OVERI(WKREG3)     GET TWO BYTE OVERHEAD    20201  03432020
MZ0020   EQU   *                                                 20201  03436020
         MH    WKREG2,TOLER(0,WKREG3)       (KL+DL)TOLER+OVERHEAD       03440020
         SRL   WKREG2,9                                                 03460020
         AR    WKREG6,WKREG2                                            03480020
         SR    WKREG6,WKREG                                             03500020
*                              WKREG5 = SIZE OF A LAST RECORD ON TRACK  03520020
*                              WKREG6 = SIZE OF AN INTERMEDIATE RECORD  03540020
*                                                                       03560020
*                                                                       03580020
         TM    DCBCIND2,WZEROBIT       WAS PREVIOUS WRITE A WRITE R0    03600020
         BC    1,WZEROFF                YES, GO INCREMENT TO NEXT TRACK 03620020
*                                                                       03640020
         CH    WKREG5,DCBTRBAL         DOES RECORD FIT AS LAST ON TRACK 03660020
         BC    2,FULLTRK                NO, USE RETURN CODE OF 4        03680020
*                                                                       03700020
*   UPDATE DCB FIELDS                                                   03720020
*                                                                       03740020
FITS     LH    WKREG3,DCBTRBAL         DECREMENT TRACK BALANCE BY       03760020
         SR    WKREG3,WKREG6            THE SIZE OF AN                  03780020
         STH   WKREG3,DCBTRBAL          INTERMEDIATE RECORD             03800020
         MVC   IOBSEEK(8),DCBFDAD      MOVE PRIOR RECORD AS SEARCH ARG  03820020
         IC    WKREG3,DCBFDAD+7        INCREMENT THE R BYTE             03840020
         LA    WKREG3,1(0,WKREG3)       OF MBBCCHHR                     03860020
         STC   WKREG3,DCBFDAD+7         BY ONE                          03880020
         MVC   IOBDNRCF(5),DCBFDAD+3   MOVE CURRENT CCHHR TO NEW COUNT  03900020
*                                                                       03920020
         BAL   WKREG1,EXCP             GO SCHEDULE THIS WRITE AND       03940020
*                                       TEST FOR ENTRY FROM EOV         03960020
*                                                                       03980020
NORMAL   SR    15,15                                                    04000020
*                                                                       04020020
RETURN   RETURN (14,12),T,RC=(15)      RETURN TO THE USER               04040020
*                                                                       04060020
*                                                                       04080020
*                                                                       04100020
SETEOV   OI    DCBCIND1,VOLFUL         MARK DCB SO FUTURE REQ.S BYPASS  04120020
         BCTR  WKREG3,0                 RESTORE DCBFDAD           12987 04126020
         STC   WKREG3,DCBFDAD                                     12987 04132020
POSTEOV  OI    IOBLINK,EOVBIT          MARK IOB AS NOT SCHEDULED BY IOS 04140020
         B     NORMAL                  RETURN TO THE USER               04160020
*                                                                       04180020
*  WRITE ZERO ROUTINE                                                   04200020
*                                                                       04220020
WZERORTN LA    WKREG1,IOBCCW5          RESET START ADDR. TO SEARCH R0   04240020
         CLI   IOBCCW1,SETSECT          IS RPS FEATURED          20201  04241020
         BNE   NONCARN                  IF NOT, SKIP RPS RTN     20201  04242020
         LA    WKREG1,IOBCCW7           RESET START ADDR TO SET  20201  04243020
*                                       SECT                     20201  04244020
         TM    DCBOPTCD,WRTCHK            CCW7 FOR NO WRTCHK     20201  04245020
*                                       WHITH REC                20201  04246020
         BZ    SETCHAIN                   REDY. ELSE START ADDR  20201  04247020
*                                       IS                       20201  04248020
         LA    WKREG1,IOBCCW11            CCW11 FOR WRT CHK WITH 20201  04249020
*                                       REC                      20201  04250020
SETCHAIN OI    D28(WKREG1),CCHN          REDY. ALSO SET COMMAND  20201  04251020
         OI    D60(WKREG1),CCHN          CHAINS FOR VERIFY AND   20201  04252020
*                                         ERASE AND BR AROUND           04253020
         B     SKPUSUAL                   USUAL WRT0 RTN         20201  04254020
NONCARN  EQU   *                                                 20201  04255020
         TM    DCBOPTCD,WRTCHK          CCW. IF WRITE CHECK IS NOT      04260020
         BC    8,SETCCHN                SPECIFIED ADDRESS IS CCW5       04280020
         LA    WKREG1,IOBCCW8           ELSE START ADDRESS IS CCW8      04300020
SETCCHN  OI    20(WKREG1),CCHN          TURN ON VERIFY COMMAND CHAIN    04320020
         OI    44(WKREG1),CCHN           AND ERASE COMMAND CHAIN        04340020
SKPUSUAL EQU   *                                                 20201  04350020
         ST    WKREG1,IOBSTART          STORE STARTING ADDRESS IN IOB   04360020
         TM    DCBCIND2,WZEROBIT       SHOULD THIS WRITE ERASE TRACK    04380020
         BC    1,UPTRACK                YES, GO INCREMENT TRACK NUMBER  04400020
         CLI   DCBFDAD+7,0             FIRST WRITE MAY BE TO WRITE R0   04420020
         BC    8,TURNONR0               IF SO, ERASE TRACK ONE          04440020
         CLI   IOBCCW1,SETSECT          IS RPS FEATURED          20201  04442020
         BNE   NOTRECR                  BRANCH IF NOT            20201  04444020
         NI    D60(WKREG1),SILSKP       TURN OFF ERASE CC        20201  04446020
         TM    DCBOPTCD,WRTCHK          IS WRT CHK SPECIFIED     20201  04448020
         BO    TURNONR0                 YES, GO SET UP WRITE     20201  04450020
         NI    D28(WKREG1),SILSKP       TURN OFF VERIFY C.C.     20201  04452020
         B     TURNONR0                 BRANCH AROUND NON RPS    20201  04454020
*                                       RTN                      20201  04456020
NOTRECR  EQU   *                                                 20201  04458020
         NI    44(WKREG1),X'30'         TURN OFF ERASE COMMAND CHAIN    04460020
         TM    DCBOPTCD,WRTCHK          IS WRITE CHECK SPECIFIED        04480020
         BC    1,TURNONR0                YES, GO SET UP TO WRITE.  NO,  04500020
         NI    20(WKREG1),X'30'         TURN OFF VERIFY COMMAND CHAIN   04520020
*                                                                       04540020
TURNONR0 MVC   IOBR0CNT(4),DCBFDAD+3   MOVE CCHH0 TO R0 COUNT           04560020
         MVC   IOBR0DAT(5),DCBFDAD+3   MOVE CCHHR AS HIGHEST ID ON TRK  04580020
         MVC   IOBR0DAT+5(2),DCBTRBAL  MOVE TRBAL AS BYTES REMAINING    04600020
         MVC   IOBSEEK,DCBFDAD         MOVE CURRENT ADDR AS SEEK ADDR   04620020
         OI    DCBCIND2,WZEROBIT       SET- LAST I/O WAS A WRITE R0 BIT 04640020
*                                                                       04660020
         BAL   WKREG1,EXCP             GO SCHEDULE THIS WRITE AND       04680020
*                                       TEST FOR ENTRY FROM EOV         04700020
*                                                                       04720020
         SR    WKREG2,WKREG2           FIND LAST EXTENT IN THE DEB      04740020
         IC    WKREG2,DEBNMEXT          BY NUMBER OF EXTENTS            04760020
         BCTR  WKREG2,0                  MINUS ONE                      04780020
         SLL   WKREG2,4                 TIMES 16                        04800020
         AR    WKREG2,DEBREG            PLUS DEB BASE ADDRESS           04820020
         CLC   DCBFDAD+3(4),DEBENDCC-DEB(WKREG2)  IS THIS LAST TRACK    04840020
         BC    7,NORMAL                 NO, USE RETURN CODE OF 0        04860020
*                                                                       04880020
EOV      LA    15,8          SET RETURN CODE-LAST TRACK WRITTEN         04900020
         B     RETURN         GO BACK TO THE USER                       04920020
*                                                                       04940020
*                                                                       04960020
FULLTRK  MVI   IOBLINK+4,0             MARK THIS IOB AVAILABLE AGAIN    04980020
         LA    15,4                    SET RETURN CODE-TRACK IS FULL    05000020
         B     RETURN                  GO BACK TO THE USER              05020020
*                                                                       05040020
*                                                                       05060020
*   INCREMENT TRACK ADDRESS BY 1 AND CHECK VALIDITY                     05080020
*                                                                       05100020
WZEROFF  XI    DCBCIND2,WZEROBIT       TURN OFF WRITE R0 FLAG           05120020
UPTRACK  L     WKREG1,DCBDVTBL         LOAD ADDRESS OF DADT ENTRY       05140020
         MVC   IOBCSW(4),MAXCC(WKREG1) MOVE NO. OF CYL.S, TRACKS TO IOB 05160020
         MVC   IOBCSW+4(4),DCBFDAD+3   MOVE CURRENT CCHH FOR ALIGNMENT  05180020
         MVC   DCBTRBAL,TRKL(WKREG1)   RESET TRACK BALANCE TO FULL AMT  05200020
         SR    WKREG2,WKREG2                                            05220020
         IC    WKREG2,DCBFDAD          DEVELOP POINTER TO CURRENT       05240020
         SLL   WKREG2,4                 EXTENT IN THE DEB               05260020
         AR    WKREG2,DEBREG                                            05280020
         LA    IOBREG,0(0,IOBREG)      BE SURE HI-ORDER BYTE IS ZERO    05300020
         LA    WKREG3,3(0,IOBREG)       SET CCHH VALUE TO HH      12748 05320020
         L     CCHH,IOBCSW+4           LOAD CURRENT CCHH TO AN ACCUM.   05340020
         TM    BYTEDEV(WKREG1),BYTE     ARE BYTES NON-CONTIGUOUS  12748 05346020
         BZ    DOWNONE                  BRANCH IF CONTIGUOUS      12748 05352020
ADDONE   AH    CCHH,ONE                ADD ONE TO THE LO-ORDER BYTE     05360020
         TM    BYTEDEV(WKREG1),BYTE    ARE BYTES NON-CONTIGUOUS         05380020
         BC    1,USEBYTE                YES, TREAT EACH SEPARATELY      05400020
         STH   CCHH,IOBCSW+4-IOBDEF(0,WKREG3)     STORE NEW CC OR HH    05420020
         CLC   IOBCSW+4-IOBDEF(2,WKREG3),IOBCSW-IOBDEF(WKREG3)          05440020
*                                                 CHECK FOR VALID VALUE 05460020
         BC    4,TSTEXT                ADDRESS VALID, CHECK EXTENT      05480020
         SRL   CCHH,16                 SHIFT TO CC VALUE                05500020
         XC    IOBCSW-IOBDEF+4(2,WKREG3),IOBCSW-IOBDEF+4(WKREG3)  12748 05520020
*        ZERO THE BYTES PROCESSED                                 12748 05540020
*                                                OF CCHH                05560020
         BCTR  WKREG3,0                DECREMENT THE CCHH INDEX         05580020
DOWNONE  BCTR  WKREG3,0                                                 05600020
         CR    WKREG3,IOBREG           HAVE ALL BYTES BEEN PROCESSED    05620020
         BC    10,ADDONE                NO, LOOP TO ADD ONE TO NEXT BYT 05640020
*                                                                       05660020
NEXTEXT  IC    WKREG3,DCBFDAD          INCREMENT M AND SEE IF THIS WAS  05680020
         LA    WKREG3,1(0,WKREG3)       THE LAST EXTENT.                05700020
         STC   WKREG3,DCBFDAD                                           05720020
         CLC   DCBFDAD(1),DEBNMEXT                                      05740020
         BC    8,SETEOV                 YES, GO SET EOV BIT             05760020
*                                                                       05780020
         LA    WKREG2,16(0,WKREG2)     INCREMENT TO NEXT EXTENT         05800020
         MVC   DCBFDAD+1(6),DEBBINUM-DEB(WKREG2) MOVE BBCCHH TO DCB     05820020
RESETBAL MVI   DCBFDAD+7,0             MOVE A ZERO TO R BYTE            05840020
         TM    DECTYPE+1,WZERO         THIS A WRITE ZERO REQUEST        05860020
         BC    1,TURNONR0               YES GO TO SET UP FOR WRITE R0   05880020
         CH    WKREG5,DCBTRBAL         WILL THE NEW TRACK HOLD ONE RCD. 05900020
         BC    12,FITS                  YES, GO UPDATE DCB              05920020
ABEXIT   DMABCOND  205,SVC=YES,DCB=(DCBREG) BR PROB DET TO ABEND Y02072 05960002
*                                                                       05980020
USEBYTE  STC   CCHH,IOBCSW+4-IOBDEF(0,WKREG3) STORE AND           12748 06000020
         SRL   CCHH,8                   SHIFT TO THE NEXT ONE           06020020
         CLC   IOBCSW+4-IOBDEF(1,WKREG3),IOBCSW-IOBDEF(WKREG3)    12748 06040020
*                                               THIS BYTE VALID         06060020
         BC    4,TSTEXT                YES, GO CHECK EXTENT LIMIT       06080020
         MVI   IOBCSW+4-IOBDEF(WKREG3),0  ZERO INVALID BYTE       12748 06100020
         BC    15,DOWNONE               GO LOOK AT THE NEXT ONE         06120020
*                                                                       06140020
TSTEXT   CLC   IOBCSW+4(4),DEBENDCC-DEB(WKREG2) ADDRESS WITHIN EXTENT   06160020
         BC    2,NEXTEXT               NO, SEE IF THERE'S ANOTHER EXT   06180020
         MVC   DCBFDAD+3(4),IOBCSW+4   YES, MOVE NEW CCHH TO DCB        06200020
         BC    15,RESETBAL              AND GO RESET TRACK BALANCE      06220020
*                                                                       06240020
*                                                                       06260020
EXCP     EQU   *                                                        06280020
         LA    PARAM1,8(0,IOBREG)      SET IOS IOB PARAMETER            06300020
         EXCP  (1)                                                      06320020
*                                                                       06340020
*                                                                       06360020
EOVTST   TM    IOBLINK,EOVBIT          IF ENTERED BY A WRITE MACRO      06380020
         BCR   8,WKREG1                 RETURN TO THE BAL+4             06400020
*                                                                       06420020
         NI    IOBLINK,NOTEOV                                           06440020
EOVEXIT  EQU   *                                                        06460020
         BR    EOVRETRN                 ELSE RETURN TO EOV              06480020
         EJECT                                                          06500020
*                                                                       06520020
ONE      DC    H'1'      CONSTANT ONE                                   06540020
CCHN     EQU   X'40'     COMMAND CHAIN FLAG                             06620020
SILI     EQU   X'20'     SUPPRESS INCORRECT LENGTH FLAG                 06640020
WRTCHK   EQU   X'80'     WRITE CHECK OPTION                             06660020
UNKWN    EQU   X'80'     UNKNOWN FORMAT                                 06680020
NOTEOV   EQU   X'7F'     ALL BITS EXCEPT EOV FLAG                       06700020
SOPT     EQU   X'80'          LENGTH CODED AS 'S'                  6991 06720020
WZERO    EQU   X'04'     TYPE WRITE R0                                  06740020
WZEROBIT EQU   X'40'     LAST I/O WAS WRITE R0                          06760020
EOVBIT   EQU   X'80'     THIS WRITE NOT SCHEDULED BECAUSE OF EOV        06780020
VOLFUL   EQU   X'20'     VOLUME FULL BIT                                06800020
*                                                                       06801020
* RPS DEVELOPED CONSTANTS AND EQUATES                                   06802020
*                                                                       06803020
SETSECT  EQU   X'23'     SET SECTOR TEST BYTE                    20201  06804020
SILSKP   EQU   X'30'                    TURNS OFF DC AND CC      20201  06805020
CCHNOFF  EQU   X'BF'                    TURNS OFF C. C.          20201  06806020
*                                                                       06807020
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD INDIC  20201  06808020
*                                                                       06809020
D0       EQU   0                        ZERO DISPLACEMENT        20201  06810020
D1       EQU   1                        ONE BYTE DISPLACEMENT    20201  06811020
THREE    EQU   3                        THREE BYTES              20201  06812020
D4       EQU   4                        4 BYTE DISPLACEMENT      20201  06813020
D6       EQU   6                        6 BYTE DISPLACEMENT      20201  06814020
D8       EQU   8                        8 BYTE DISPLACEMENT      20201  06815020
D28      EQU   28                       28BYTE DISPLACEMENT      20201  06816020
D60      EQU   60                       60BYTE DISPLACEMENT      20201  06817020
*                                                                       06820020
*      DIRECT ACCESS DEVICE TABLE DEFINITION                            06840020
BYTE     EQU   2         BYTES OF  CCHH ARE NON-CONTIGUOUS              06860020
OVERK    EQU   8         OFFSET TO KEY OVERHEAD                         06880020
OVERI    EQU   6                   INTERMEDIATE RECORD OVERHEAD         06900020
OVERL    EQU   7                   LAST RECORD OVERHEAD                 06920020
TOLER    EQU   10                  TOLERANCE FACTOR                     06940020
TRKL     EQU   4                   BYTES ON TRACK                       06960020
MAXCC    EQU   0                   NO. OF CYLINDERS, TRACKS             06980020
BYTEDEV  EQU   9                   FLAG, BYTES ARE NON-CONTIGUOUS       07000020
         DC    C'IGGR'                  THIS IS A ROTATIONAL     20201  07005020
*                                         POSITION SENSING              07010020
*                                         MODULE                        07015020
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 07017002
         EJECT                                                          07067002
**********************************************************************  07120020
*    CONTROL BLOCK DEFINITIONS FOLLOW                                   07160020
**********************************************************************  07170002
         DCBD  DSORG=(PS),DEVD=(DA)                                     07180020
*                                                                       07200020
**********************************************************************  07220020
*                                                                       07240020
DECBDEF  DSECT     DATA EVENT CONTROL BLOCK                             07260020
DECSDECB DS    F         STANDARD ECB                                   07280020
DECTYPE  DS    CL2       TYPE AND OPTIONS                               07300020
DECLNGTH DS    CL2       DATA LENGTH                                    07320020
DECDCBAD DS    F         DCB ADDRESS                                    07340020
DECAREA  DS    F         AREA ADDRESS                                   07360020
DECIOBPT DS    F         IOB ADDRESS                                    07380020
DECKYADR DS    F                                                        07400020
DECOFSET DS    CL2                                                      07420020
DECRESPN DS    CL1                                                      07440020
         SPACE 2                                                        07460020
*                                                                       07480020
**********************************************************************  07500020
*                                                                       07520020
         SPACE 2                                                        07540020
IOBDEF   DSECT      I/O BLOCK DEFINITION                                07560020
IOBLINK  DS    F         IOB LINK ADDRESS                               07580020
IOBIOBA  DS    F         IOB ADDRESS FOR EOV                            07600020
IOBFLAG1 DS    CL1       ERROR FLAG 1                                   07620020
IOBFLAG2 DS    CL1       ERROR FLAG 2                                   07640020
IOBSENSE DS    CL2       I/O SENSE BITS                                 07660020
IOBECBPT DS    F         ECB ADDRESS                                    07680020
IOBCSW   DS    D         CSW STORED BY IOS                              07700020
IOBSIOCC DS    0BL1      SIO CONDITION CODE                             07720020
IOBSTART DS    F         CHANNEL PROGRAM STARTING CCW                   07740020
IOBDCBPT DS    F         DCB ADDRESS                                    07760020
IOBRESTR DS    F         CHANNEL PROGRAM RESTART ADDRESS                07780020
IOBINCAM DS    CL2       BLOCK INCREMENT AMOUNT                         07800020
IOBERRCT DS    CL2       ERROR COUNTS                                   07820020
IOBSEEK  DS    D         SEEK ADDRESS                                   07840020
IOBDNRCF DS    D         NEW RECORD COUNT FIELD                         07860020
IOBR0CNT DS    D         COUNT FIELD OF R0                              07880020
IOBR0DAT DS    D         DATA FIELD OF R0                               07900020
IOBCCW1  DS    D         FIRST CCW OF CHANNEL PROGRAM                   07920020
IOBCCW2  DS    D                                                        07940020
IOBCCW3  DS    D                                                        07960020
IOBCCW4  DS    D                                                        07980020
IOBCCW5  DS    D                                                        08000020
IOBCCW6  DS    D                                                        08020020
IOBCCW7  DS    D                                                        08040020
IOBCCW8  DS    D                                                        08060020
IOBCCW9  DS    D                                                        08080020
IOBCCW10 DS    D                                                        08100020
IOBCCW11 DS    D                                                        08120020
IOBCCW12 DS    D                                                        08140020
IOBCCW13 DS    D                                                        08160020
IOBCCW14 DS    D         LAST CCW OF LONGEST CHANNEL PROGRAM            08180020
*                                                                       08200020
**********************************************************************  08220020
*                                                                       08240020
*                                                                       08260020
DEB      DSECT                                                          08280020
         DS    0F                                                       08300020
DEBNMSUB DS    0CL1                                                     08320020
DEBTCBAD DS    CL4                                                      08340020
DEBAMLNG DS    0CL1                                                     08360020
DEBDEBAD DS    CL4                                                      08380020
DEBOGLGS DS    0CL1                                                     08400020
DEBIRBAD DS    CL4                                                      08420020
DEBOPATB DS    0CL1                                                     08440020
DEBSYSPG DS    CL4                                                      08460020
DEBNMEXT DS    0CL1                                                     08480020
DEBUSRPG DS    CL4                                                      08500020
DEBPRIOR DS    0CL1                                                     08520020
DEBECBAD DS    CL4                                                      08540020
DEBPROTG DS    0CL1                                                     08560020
DEBDEBID DS    0CL1                                                     08580020
DEBDCBAD DS    CL4                                                      08600020
DEBEXSCL DS    0CL1                                                     08620020
DEBAPPAD DS    CL4                                                      08640020
DEBDVMOD DS    0CL1                                                     08660020
DEBUCBAD DS    CL4                                                      08680020
DEBBINUM DS    CL2                                                      08700020
DEBSTRCC DS    CL2                                                      08720020
DEBSTRHH DS    CL2                                                      08740020
DEBENDCC DS    CL2                                                      08760020
DEBENDHH DS    CL2                                                      08780020
DEBNMTRK DS    CL2                                                      08800020
DEBSUBID EQU   0         SUBROUTINE ID'S                                08820020
         END                                                            08840020
./  ADD  SSI=32360022,NAME=IGG019DC
         TITLE 'IGG019DC - CHECK ROUTINE, CREATE A BDAM DATA SET'       00027000
IGG019DC CSECT                                                          00029002
*MODULE NAME = IGG019DC                                               * 00037002
*                                                                     * 00047002
*DESCRIPTIVE NAME = BDAM CREATE CHECK MODULE FOR NON VS RECORD FORMAT * 00057002
*                                                                     * 00059002
*COPYRIGHT = NONE                                                     * 00061002
*                                                                     * 00061402
*CHANGE ACTIVITY                                                      * 00061802
*                                                                     * 00061902
*        VS1-1 CHANGES/DELETIONS                                        00079002
*        VS2-1 CHANGES/DELETIONS                                        00089002
*        VS1-2 CHANGES/DELETIONS                                        00099002
*        VS2-2 CHANGES/DELETIONS                                        00101002
*014000,017200-017240,021700,021800,024800,024820,025000-025600  Y02072 00103002
*                                                                YM3029 00103402
*                                                                       00105002
*STATUS CHANGE LEVEL 007                                          7M524 00107002
*                                                                       00117002
*FUNCTIONS- THIS ROUTINE IS ENTERED BY THE CHECK MACRO ISSUED BY THE    00120000
*    PROBLEM PROGRAM FOLLOWING A WRITE TYPE SF, SD, OR SZ.              00140000
*    IF THE WRITE COULD NOT BE SCHEDULED (DUE TO NO MORE ROOM IN THE    00160000
*    DATA SET) CONTROL IS PASSED TO THE END-OF-VOLUME ROUTINE.          00180000
*    IF THE WRITE WAS SCHEDULED AND THE USER HAS NOT ISSUED A WAIT,     00200000
*    THIS ROUTINE WILL WAIT FOR COMPLETION TO BE POSTED.                00220000
*    WHEN THE WRITE IS COMPLETE, ONE OF THE FOLLOWING WILL OCCUR,       00240000
*    1. IF THE WRITE COMPLETED WITHOUT ERROR CONTROL WILL BE RETURNED   00260000
*       TO THE PROBLEM PROGRAM,                                         00280000
*    2. IF THE WRITE COMPLETED IN ERROR CONTROL WILL BE PASSED TO THE   00300000
*       USER'S SYNCHRONOUS ERROR ROUTINE IF ONE IS SPECIFIED IN THE DCB 00320000
*       IF NO ERROR ROUTINE IS SPECIFIED, A DMABCOND MACRO WILL BE      00340002
*       ISSUED TO TRANSFER CONTROL TO PROBLEM DETERMINATION, WHICH      00350002
*       WILL ISSUE A WTP MESSAGE AND GTRACE PERTINENT CONTROL BLOCKS    00352002
*       BEFORE ABENDING WITH A 008.  AN ACCOMPANYING                    00354002
*       RETURN CODE WILL IDENTIFY THE EXACT CAUSE OF THE ERROR.         00356002
*      IF THE ERROR IS AN IO ERROR AN SVC 55 IS ISSUED.  EOV WILL       00358002
*      IN THIS CASE ISSUE A WTP MESSAGE BEFORE ABENDING WITH A 001.     00358402
*                                                                       00360000
*ENTRY POINTS- 'SAVEREGS' IS THE ENTRY FROM THE CHECK MACRO EXPANSION   00380000
*    BY THE CALLING SEQUENCE-      L    15,DCBCHECK                     00400000
*                                  BALR 14,15                           00420000
*    'POSTCHK' IS THE RETURN FROM END-OF-VOLUME IF THE USER HAD         00440000
*    SPECIFIED SECONDARY ALLOCATION. ADDITIONAL SPACE HAS BEEN ASSIGNED 00460000
*    AND THE WRITE SCHEDULED BY THE WRITE ROUTINE.                      00480000
*                                                                       00500000
*INPUT- INPUT TO THE CHECK MACRO IS THE ADDRESS OF THE DECB ASSIGNED TO 00520000
*    THE WRITE TO BE CHECKED. THIS ADDRESS WILL BE LOADED INTO          00540000
*    REGISTER 1 PRIOR TO ENTERING THIS ROUTINE.                         00560000
*                                                                       00580000
*OUTPUT- THE IOB USED FOR THE WRITE IS MADE AVAILABLE SO THAT IT MAY    00600000
*    BE REUSED BY THE WRITE ROUTINE.                                    00620000
*    IF THE EXIT TO THE USER'S ERROR ROUTINE IS TAKEN, REGISTER 0 WILL  00640000
*    CONTAIN THE DECB ADDRESS AND REGISTER 1 THE DCB ADDRESS AND A      00660000
*    WRITE INDICATOR.                                                   00680000
*                                                                       00700000
*EXTERNAL ROUTINES-                                                     00720000
*                                                                       00740000
*EXITS- 'USEREXIT' IS THE EXIT TO RETURN TO THE PROBLEM PROGRAM ON      00760000
*    NORMAL COMPLETION.                                                 00780000
*    'SYNCEXIT' IS THE EXIT TO THE USER'S SYNCHRONOUS ERROR ROUTINE.    00800000
*                                                                       00820000
*    'ABEXIT' IS AN EOV ABEND EXIT WHEN THE WRITE HAD AN IO ERROR       00840002
*    AND NO SYNAD  ROUTINE IS SPECIFIED. EOV ISSUES A 001 ABEND.        00860002
*                                                                       00870002
*    'SYNCRET' AND 'SYNCRET1' ARE  EXITS WHEN THE USER RETURNS FROM     00880002
*    SYNAD ROUTINE. DMABCOND IS ISSUED TO TRANSFER CONTROL TO PROB.     00890002
*    DETERMINATION WHICH WILL ISSUE A WTP MESSAGE AND GTRACE            00900002
*    PERTINENT CONTROL BLOCKS BEFORE ABENDING WITH 008.                 00910002
*                                                                       00912002
*                                                                       00920000
*TABLES/WORK AREAS-                                                     00940000
*                                                                       00960000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.            00980000
*                                                                       01000000
*                                                                       01020000
*                                                                       01040000
         USING IGG019DC,BASE                                            01060000
         USING IOBDEF,IOBR                                              01080000
         USING IHADCB,DCBR                                              01100000
         USING DECBDEF,DECBR                                            01120000
         USING SAVEAREA,SAVE                                     Y02072 01130002
*                                                                       01140000
*              REGISTER USAGE                                           01160000
*                                                                       01180000
WKREG0   EQU   0                        WORK REGISTER                   01200000
DCBR     EQU   1                        DCB POINTER                     01220000
DECBR    EQU   2                        DECB POINTER                    01240000
R2       EQU   2                        SAVE/RESTORE REG         Y02072 01250002
IOBR     EQU   3                        IOB POINTER                     01260000
WKREG1   EQU   4                        WORK REGISTER                   01280000
BASE     EQU   5                        BASE REGISTER FOR CHECK         01300000
R8       EQU   8                        SAVE/RESTORE REG         Y02072 01310002
SAVE     EQU   13                       SAVE AREA POINTER               01320000
RETR     EQU   14                       RETURN REGISTER                 01340000
R14      EQU   14                       SAVE/RESTORE REG         Y02072 01350002
EPREG    EQU   15                       ENTRY POINT REGISTER            01360002
         EJECT                                                          01380000
SAVEREGS EQU   *                        INITIALIZE BASE REGS     Y02072 01400002
         STM   R14,R8,SAVER14           SAVE REGS 14-8 IN SAVEAR Y02072 01410002
         LR    BASE,EPREG               SET BASE REGISTER               01420002
         LR    DECBR,DCBR               SAVE DECB POINTER               01440000
         L     DCBR,DECDCBAD            SET POINTER TO DCB              01460000
         ST    DCBR,SAVEDCBR            SAV DCB ADDR IN SAVEAREA Y02072 01470002
         L     IOBR,DECIOBPT            SET POINTER TO IOS IOB          01480002
         SH    IOBR,EIGHT               SET IOB POINTER TO BSAM IOB     01500002
         TM    IOBLINK,EOVBIT           WAS THIS IOB SCHEDULED          01520000
         BZ    POSTCHK                  YES                             01540000
*                                       NO-SET UP FOR END-OF-VOLUME     01560000
         L     WKREG1,DCBIOBA           LOAD ADDRESS OF LAST IOB USED   01580002
         IC    WKREG0,4(0,WKREG1)       SAVE FIRST BYTE OF EOV POINTER  01600000
         ST    IOBR,4(0,WKREG1)         LINK THIS IOB TO EOV IOB        01620000
         STC   WKREG0,4(0,WKREG1)       RESTORE FIRST BYTE              01640000
         LR    WKREG0,IOBR              LOAD IOB ADDR INTO REG 0        01660002
         OI    20(IOBR),X'01'           TURN ON UNIT EXCEPTION BIT      01680002
         EOV   (DCBR)                   GO TO END OF VOLUME      Y02072 01700002
         LTR   EPREG,EPREG     NO SPACE RETURN                    7M524 01704000
         BZ    AROUND          NO                                 7M524 01708000
         BALR  RETR,EPREG      GO TO SYNAD                        7M524 01712000
         USING *,RETR                                             7M524 01716000
SYNCRET1 EQU   *                        NO SPACE - ABEND         Y02072 01718002
         L     DCBR,SAVEDCBR            RESTORE DCB ADDR         Y02072 01720002
         DMABCOND  209,SVC=YES,DCB=(DCBR)  BR TO PROB DETERMIN   Y02072 01726002
*                                       WHICH WILL ABEND 008     Y02072 01726402
*                                       BECAUSE NO SPACE ON VOL  Y02072 01727202
         DROP  RETR                                               7M524 01728000
AROUND   L     DCBR,DECDCBAD   RESTORE DCB ADDRESS                7M524 01732000
*                                                                       01740000
POSTCHK  TM    DECSDECB,X'60'           WAS DECB POSTED WITHOUT ERROR   01760000
         BO    USEREXIT                 YES-GO TO SET UP FOR RETURN     01780000
         BZ    CHKWAIT                  NOT POSTED  SET UP FOR WAIT     01800000
*                                                                       01820000
         TM    DCBSYNAD+3,X'01'         IS USER SYNCHRONOUS ERROR       01840000
*                                       ROUTINE SPECIFIED IN DCB        01860002
         BZ    SYNCEXIT                 YES                             01880000
*                                                                       01900000
ABEXIT   EQU   *                                                        01920000
         LH    WKREG0,ABCODE1           ABEND CODE X'00001000'   Y02072 01940002
         EOV   (DCBR)                   BR TO EOV TO ABEND       Y02072 01960002
*                                                                       01980000
*            SET UP FOR USER SYNCHRONOUS ERROR ROUTINE                  02000000
SYNCEXIT LR    WKREG0,DECBR             SET POINTER TO DECB IN REG. 0   02020000
         MVI   DECDCBAD,WRITE           SET WRITE INDICATOR IN DECB     02040000
         L     15,DCBSYNAD              SET USER BASE REGISTER          02060002
         L     DCBR,DECDCBAD            SET DCB POINTER AND WRITE       02080002
*                                       INDICATOR IN REG. 1             02100002
         LM    R2,R8,SAVER2             RESTORE REGS 2-8         Y02072 02110002
         BALR  RETR,EPREG               GO TO SYNC ERROR ROUTINE        02140002
         USING *,RETR                                             11184 02150014
*                                                                       02160000
SYNCRET  EQU   *                        RET FROM SYNAD ABEND 008 Y02072 02162002
         L     DCBR,SAVEDCBR            RESTORE DCB ADDR         Y02072 02164002
         DMABCOND  210,SVC=YES,DCB=(DCBR)  BR TO PROB DETERMIN   Y02072 02172002
*                                       TO ABEND 008 WITH IO ERR Y02072 02182002
         DROP  RETR                                                     02232002
*                                                                       02282002
*                                                                       02332002
USEREXIT NI    IOBIOBA,AVAIL            MAKE IOB AVAILABLE              02382002
*          RESTORE USER REGISTERS AND RETURN                            02432002
         LM    R14,R8,SAVER14           RESTORE REGS 14-8        Y02072 02484002
         MVI   SAVER14,X'FF'            SET RETURN INDICATION    Y02072 02486002
         BR    R14                      RETURN TO USER           Y02072 02488002
*                                                                       02492002
*                                                                       02494002
CHKWAIT  LR    DCBR,DECBR               LOAD ECB ADDRESS FOR WAIT       02496002
         WAIT  ,ECB=(1)                 WAIT FOR WRITE TO COMPLETE      02498002
         L     DCBR,DECDCBAD            RESTORE DCB POINTER             02498402
         BC    15,POSTCHK               GO TO CHECK FOR ERROR           02498802
*                                                                       02499202
*                                                                       02499602
*                                                                       02499702
         DS    0H                                                Y02072 02499802
ABCODE1  DC    XL2'1000'                NO SYNAD RTN -IO ERROR   Y02072 02499902
*                                                                       02580002
EIGHT    DC    H'8'      CONSTANT EIGHT                                 02600000
MODID    DC    C'IGG019DC'              MODULE ID                Y02072 02602002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 02610002
WRITE    EQU   X'40'                                                    02620000
AVAIL    EQU   X'7F'                                                    02640000
EOVBIT   EQU   X'80'                                                    02660000
*                                                                       02680000
         EJECT                                                          02740000
*********************************************************************** 02750002
*                           DSECTS                                    * 02752002
*********************************************************************** 02754002
SAVEAREA DSECT                          USER SAVEAREA            Y02072 02756002
         DS    XL20                     UNUSED BY THIS MOD       Y02072 02758002
SAVER14  DS    A                        REG 14 SAVED             Y02072 02758402
SAVER15  DS    A                        REG 15 SAVED             Y02072 02758802
SAVER0   DS    A                        REG 0 SAVED              Y02072 02759202
SAVER1   DS    A                        REG 1 SAVED              Y02072 02759602
SAVER2   DS    A                        REG 2 SAVED              Y02072 02759702
SAVER3   DS    A                        REG 3 SAVED              Y02072 02759802
SAVER4   DS    A                        REG 4 SAVED              Y02072 02759902
SAVER5   DS    A                        REG 5 SAVED              Y02072 02766602
SAVER6   DS    A                        REG 6 SAVED              Y02072 02768602
SAVER7   DS    A                        REG 7 SAVED              Y02072 02770602
SAVER8   DS    A                        REG 8 SAVED              Y02072 02772602
SAVEDCBR DS    A                        DCB ADDR SAVED           Y02072 02773002
         DS    XL4                      UNUSED BY THIS MOD       Y02072 02773102
         DCBD  DSORG=(PS),DEVD=(DA)                                     02773302
         EJECT                                                          02780000
IOBDEF   DSECT      I/O BLOCK DEFINITION                                02800000
IOBLINK  DS    F         IOB LINK ADDRESS                               02820000
IOBIOBA  DS    F         IOB ADDRESS FOR EOV                            02840000
IOBFLAG1 DS    CL1       ERROR FLAG 1                                   02860000
IOBFLAG2 DS    CL1       ERROR FLAG 2                                   02880000
IOBSENSE DS    CL2       I/O SENSE BITS                                 02900000
IOBECBPT DS    F         ECB ADDRESS                                    02920000
IOBCSW   DS    D         CSW STORED BY IOS                              02940000
IOBSIOCC DS    0BL1      SIO CONDITION CODE                             02960000
IOBSTART DS    F         CHANNEL PROGRAM STARTING CCW                   02980000
IOBDCBPT DS    F         DCB ADDRESS                                    03000000
IOBRESTR DS    F         CHANNEL PROGRAM RESTART ADDRESS                03020000
IOBINCAM DS    CL2       BLOCK INCREMENT AMOUNT                         03040000
IOBERRCT DS    CL2       ERROR COUNTS                                   03060000
IOBSEEK  DS    D         SEEK ADDRESS                                   03080000
IOBDNRCF DS    D         NEW RECORD COUNT FIELD                         03100000
IOBR0CNT DS    D         COUNT FIELD OF R0                              03120000
IOBR0DAT DS    D         DATA FIELD OF R0                               03140000
IOBCCW1  DS    D         FIRST CCW OF CHANNEL PROGRAM                   03160000
IOBCCW2  DS    D                                                        03180000
IOBCCW3  DS    D                                                        03200000
IOBCCW4  DS    D                                                        03220000
IOBCCW5  DS    D                                                        03240000
IOBCCW6  DS    D                                                        03260000
IOBCCW7  DS    D                                                        03280000
IOBCCW8  DS    D                                                        03300000
IOBCCW9  DS    D                                                        03320000
IOBCCW10 DS    D                                                        03340000
IOBCCW11 DS    D                                                        03360000
IOBCCW12 DS    D                                                        03380000
IOBCCW13 DS    D                                                        03400000
IOBCCW14 DS    D         LAST CCW OF LONGEST CHANNEL PROGRAM            03420000
         EJECT                                                          03440000
DECBDEF  DSECT     DATA EVENT CONTROL BLOCK                             03460000
DECSDECB DS    F         STANDARD ECB                                   03480000
DECTYPE  DS    CL2       TYPE AND OPTIONS                               03500000
DECLNGTH DS    CL2       DATA LENGTH                                    03520000
DECDCBAD DS    F         DCB ADDRESS                                    03540000
DECAREA  DS    F         AREA ADDRESS                                   03560000
DECIOBPT DS    F         IOB ADDRESS                                    03580000
DECKYADR DS    F                                                        03600000
DECOFSET DS    CL2                                                      03620000
DECRESPN DS    CL1                                                      03640000
         EJECT                                                          03660000
*                                                                       03680000
DEB      DSECT                                                          03700000
         DS    0F                                                       03720000
DEBNMSUB DS    0CL1                                                     03740000
DEBTCBAD DS    CL4                                                      03760000
DEBAMLNG DS    0CL1                                                     03780000
DEBDEBAD DS    CL4                                                      03800000
DEBOGLGS DS    0CL1                                                     03820000
DEBIRBAD DS    CL4                                                      03840000
DEBOPATB DS    0CL1                                                     03860000
DEBSYSPG DS    CL4                                                      03880000
DEBNMEXT DS    0CL1                                                     03900000
DEBUSRPG DS    CL4                                                      03920000
DEBPRIOR DS    0CL1                                                     03940000
DEBECBAD DS    CL4                                                      03960000
DEBPROTG DS    0CL1                                                     03980000
DEBDEBID DS    0CL1                                                     04000000
DEBDCBAD DS    CL4                                                      04020000
DEBEXSCL DS    0CL1                                                     04040000
DEBAPPAD DS    CL4                                                      04060000
DEBDVMOD DS    0CL1                                                     04080000
DEBUCBAD DS    CL4                                                      04100000
DEBBINUM DS    CL2                                                      04120000
DEBSTRCC DS    CL2                                                      04140000
DEBSTRHH DS    CL2                                                      04160000
DEBENDCC DS    CL2                                                      04180000
DEBENDHH DS    CL2                                                      04200000
DEBNMTRK DS    CL2                                                      04220000
DEBSUBID EQU   0         SUBROUTINE ID'S                                04240000
         END                                                            04260000
./  ADD  SSI=61470760,NAME=IGG019DD
         TITLE 'IGG019DD-WRITE FORMAT F,TRACK OVERFLOW,LOAD MODE'       00004020
IGG019DD CSECT                                                          00008020
*MODULE NAME = IGG019DD                                               * 00010002
*                                                                     * 00010402
*DESCRIPTIVE NAME = BDAM CREATE WRITE MODULE, FIXED TRACK OVERFLOW    * 00010802
*                                                                     * 00011202
*COPYRIGHT = NONE                                                     * 00011602
*                                                                     * 00011702
*CHANGE ACTIVITY                                                      * 00011802
*                                                                     * 00012002
*        RELEASE 20 CHANGES/DELETIONS                                   00048002
*0000042023-042030,042050-042100                                 M6477  00048520
*0000020200,020400,026100-026200,056100-056200,063400,066260,    M5894  00049020
*0000066330,082200,085200,089800                                 M5894  00050020
*0832026200,056200,082200,089800                                 A33537 00052020
*0832000160-000240,000560-000800,049800,058400,061000-061200     S20201 00054020
*0000042030                                                      M5313  00064020
*0000                                                            M6283  00074020
*        RELEASE 21 CHANGES/DELETIONS                                   00076002
*1390                                                            M0169  00078002
*        VS1-1 CHANGES/DELETIONS                                        00080002
*        VS2-1 CHANGES/DELETIONS                                        00082002
*        VS1-2 CHANGES/DELETIONS                                        00082402
*        VS2-2 CHANGES/DELETIONS                                        00082802
*025060,091400-091800                                            Y02072 00083202
*                                                                YM3919 00083302
*                                                                YM6555 00083402
*                                                                YM7563 00083502
*                                                                       00083602
*        VS2-3 CHANGES/DELETIONS                                        00083702
*A042078-042213                                                 ZA01362 00083802
*        UPDATES TO VS2-3                                               00084000
*A086260,086320                                                 ZA07617 00087000
*STATUS CHANGE LEVEL 003                                                00090000
*                                                                       00094002
*FUNCTIONS- THIS ROUTINE OBTAINS AN IOB, INITIALIZES THE CHANNEL        00100020
*    PROGRAM, AND ISSUES THE 'EXCP' FOR A WRITE TYPE SF OR SD TO A      00120020
*    FORMAT 'F' DATA SET WITH THE TRACK OVERFLOW OPTION SPECIFIED.      00140020
*    IF THE BLOCK WILL NOT FIT ON THE CURRENT TRACK, IT WILL BE         00160020
*    SEGMENTED AS MANY TIMES AS ARE REQUIRED TO COMPLETELY WRITE THE    00180020
*    BLOCK.                                                             00200020
*    CAPACITY RECORDS WILL BE WRITTEN AS EACH TRACK IS FILLED.          00220020
*                                                                       00240020
*    PRIOR TO WRITING THE FIRST BLOCK IN AN ALLOCATED EXTENT, A TEST IS 00260020
*    MADE FOR TRACKS AT THE END OF THE PREVIOUS EXTENT WHICH COULD NOT  00280020
*    BE USED AND MUST BE ERASED. IF THERE ARE UNUSED TRACKS THEY ARE    00300020
*    ERASED BY A COMMON SEQUENCE OF CCWS EXECUTED AS A SEPARATE REQUEST 00320020
*    AND WHEN THAT REQUEST COMPLETES, THE NEW BLOCK WILL BE WRITTEN.    00340020
*                                                                       00360020
*ENTRY POINTS- 'WRTENTRY' IS THE NORMAL ENTRY POINT FROM THE WRITE      00380020
*    MACRO EXPANSION. CALLING SEQUENCE IS     L     15,DCBWRITE         00400020
*                                             BALR  14,15               00420020
*    'EOVENTRY' IS THE ENTRY FROM THE BSAM END-OF-VOLUME EXECUTOR TO    00440020
*    RESTART A WRITE WHICH WAS ISSUED AFTER THE CURRENT SPACE           00460020
*    ALLOCATION WAS FILLED. THE RECORD WILL NOW BE WRITTEN INTO THE     00480020
*    SPACE OBTAINED AS SECONDARY ALLOCATION. CALLING SEQUENCE IS        00500020
*                                              L    15,DCBWRITE         00520020
*                                              BAL  14,4(15)            00540020
*INPUT- TO 'WRTENTRY'- DECB ADDRESS IN REGISTER 1                       00560020
*       TO 'EOVENTRY'- IOB ADDRESS IN REGISTER 3                        00580020
*                      DCB ADDRESS IN REGISTER 2                        00600020
*                      DEB ADDRESS IN REGISTER 5                        00620020
*                                                                       00640020
*OUTPUT- AN IOB FROM THE POOL OF IOBS WILL BE ASSIGNED TO THIS DECB     00660020
*    AND ITS ADDRESS PLACED IN THE DECB, EXCP WILL BE ISSUED TO         00680020
*    SCHEDULE THIS WRITE.                                               00700020
*                                                                       00720020
*EXTERNAL ROUTINES-                                                     00740020
*                                                                       00760020
*EXITS- 'RETURN' IS AN EXIT BACK TO THE USER, REGISTER 15 WILL CONTAIN  00780020
*    A RETURN CODE AS FOLLOWS,                                          00800020
*        0 = RECORD WAS WRITTEN, THERE IS MORE SPACE ON THE TRACK       00820020
*        8 = RECORD WAS WRITTEN, DATA SET IS FILLED                     00840020
*        12= RECORD NOT WRITTEN, NO IOB IS AVAILABLE UNTIL 'CHECK' HAS  00860020
*            BEEN ISSUED.                                               00880020
*    'EOVEXIT' IS A RETURN TO THE END-OF-VOLUME EXECUTOR.               00900020
*                                                                       00905020
*ERROR EXITS-                                                           00910020
*   DMABCOND MACRO IS ISSUED TO TRANSFER CONTROL TO PROBLEM DETER-      00915002
*   MINATION WHEN BLOCK DOES NOT FIT ON SECONDARY EXTENT OR CURRENT     00917002
*   EXTENT.  THE PROBLEM DETERMINATION MODULES WILL ISSUE A WTP MESSAGE 00919002
*   AND GTRACE PERTINENT CONTROL BLOCKS BEFORE ISSUING A 002 ABEND.     00919402
*   THE RETURN CODE ACCOMPANYING THE ABEND WILL IDENTIFY THE EXACT      00919802
*   CAUSE OF THE ERROR.                                                 00919902
*                                                                       00920020
*TABLES- 1. DIRECT ACCESS DEVICE TABLE IS USED TO CALCULATE THE BYTES   00940020
*           OF OVERHEAD FOR THIS RECORD AND TO DETERMINE THE NEXT       00960020
*           VALID TRACK ADDRESS AND THE TRACK LENGTH.                   00980020
*                                                                       01000020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.            01020020
*                                                                       01040020
*NOTES- THE REGISTER USAGE IN THIS MODULE AND THE BSAM END-OF-VOLUME    01060020
*    EXECUTOR MUST REMAIN CONSISTENT.                                   01080020
*                                                                       01100020
*                                                                       01120020
*  REGISTER USAGE                                                       01140020
*                                                                       01160020
         USING IGG019DD,EPREG                                           01180020
         USING IHADCB,DCBREG                                            01200020
         USING IOBDEF,IOBREG                                            01220020
         USING DEB,DEBREG                                               01240020
         USING DECBDEF,DECBREG                                          01260020
*                                                                       01280020
WKREG    EQU   0         WORK REGISTER                                  01300020
CCHH     EQU   0                                                        01320020
PARAM1   EQU   1         PARAMETER REGISTER                             01340020
DECBREG  EQU   1         DECB ADDRESS                                   01360020
DCBREG   EQU   2         DCB ADDRESS                                    01380020
IOBREG   EQU   3         IOB ADDRESS                                    01400020
EOVRETRN EQU   4         EOV RETURN ADDRESS                             01420020
DEBREG   EQU   5         DEB ADDRESS                                    01440020
WKREG1   EQU   6         WORK REGISTERS                                 01460020
WKREG2   EQU   7                                                        01480020
WKREG3   EQU   8                                                        01500020
WKREG4   EQU   9                                                        01520020
WKREG5   EQU   10                                                       01540020
WKREG6   EQU   11                                                       01560020
BASE     EQU   12        BASE OF THIS MODULE                            01580020
SAVE     EQU   13        USER'S SAVE AREA                               01600020
RETREG   EQU   14        RETURN ADDRESS WHEN ENTERED                    01620020
EPREG    EQU   15        ENTRY POINT                                    01640020
*                                                                       01660020
*                                                                       01680020
*                                                                       01700020
*                                                                       01720020
*  ENTRY POINTS TO THIS ROUTINE                                         01740020
*                                                                       01760020
WRTENTRY B     BEGIN                   GO TO BEGINNING OF WRITE CODE    01780020
*                                                                       01800020
         DROP  EPREG                                                    01820020
         USING IGG019DD,BASE                                            01840020
*                                                                       01860020
EOVENTRY L     DECBREG,IOBECBPT        LOAD DECB BASE ADDRESS           01880020
         TM    DCBCIND1,VOLFUL          IS THE VOLUME FULL       M5894  01886020
         BCR   1,RETREG                 YES,RETURN TO EOV        M5894  01892020
         L     BASE,DCBWRITE           SET BASE REGISTER                01900020
         LR    EOVRETRN,RETREG         MOVE RETURN TO EOV ADDRESS       01920020
         SR    WKREG2,WKREG2           SET INDEX TO THE CURRENT EXTENT  01940020
         IC    WKREG2,DCBFDAD           IN THE DEB                      01960020
         SLL   WKREG2,4                                                 01980020
         AR    WKREG2,DEBREG                                            02000020
         L     EPREG,DCBDVTBL           LOAD POINTER TO DEVICE   M5894  02005020
*                                       CHAR                     M5894  02010020
         LH    WKREG,DEBNMTRK-DEB(0,WKREG2) GET NO. TRKS IN EXT  M5894  02015020
         MH    WKREG,TRKL(0,EPREG)   MULTIPLY NO. BY TRK LENGTH  M5894  02020020
         CH    WKREG,DCBOFFSR           WILL BLK FIT ON EXTENT?  M5894  02025020
         BL    ABENDSEC                 NO, ABEND WITH 002       Y02072 02030002
*                                       SECONDARY EXT TOO SMALL  Y02072 02032002
         OI    IOBLINK,EOVRET           SET BIT FOR EOV ENTRY    YM6555 02034002
         TM    DCBCIND1,VOLFUL          IS THIS EXTENT FULL YET  YM7563 02034402
         BO    EOVON                    YES,SET EOVFULL BIT &RET YM7563 02034802
         B     BOTHENT                  BRANCH TO COMMON ROUTINE M5894  02035020
*                                                                       02060020
*                                                                       02080020
BEGIN    SAVE  (14,12)                 SAVE THE USER'S REGISTER         02100020
         L     DCBREG,DECDCBAD         LOAD DCB BASE ADDRESS FROM DECB  02120020
         L     DEBREG,DCBDEBAD         LOAD DEB BASE ADDRESS FROM DCB   02140020
         LR    BASE,EPREG              MOVE ENTRY POINT TO BASE REG.    02160020
*                                                                       02180020
         L     IOBREG,DCBIOBA          USE CURRENT IOB TO LOCATE THE    02200020
         TM    DCBCIND2,CLOSEDCB        DID WE ENTER FROM CLOSE  S20201 02205020
         BO    LDBLKSI                  IF SO, GO INIT SOME      S20201 02210020
*                                       THINGS                   S20201 02215020
         L     IOBREG,IOBLINK           NEXT IOB ADDRESS                02220020
         TS    IOBLINK+4               IF NEXT IOB IS AVAILABLE         02240020
         BC    8,OKIOB                  GO INITIALIZE IT                02260020
*                                      ELSE RETURN WITH ERROR CODE 12   02280020
         LA    15,12                                                    02300020
         B     RETURN                                                   02320020
*                                                                       02340020
*                                                                       02360020
OKIOB    ST    IOBREG,DCBIOBA          STORE CURRENT IOB ADDRESS IN DCB 02380020
         LA    WKREG1,8(0,IOBREG)      STORE IOS IOB ADDRESS IN         02400020
         ST    WKREG1,DECIOBPT          THE DECB                        02420020
         ST    DECBREG,IOBECBPT        STORE DECB ADDRESS IN IOB        02440020
         TM    DCBCIND1,VOLFUL         IS VOLUME FULL            M5894  02446020
         BO    EOVON                IF YES GO TO TURN ON BIT     M5894  02452020
BOTHENT  EQU   *                                                        02460020
         L     EPREG,DCBDVTBL          LOAD POINTER TO DEVICE CHAR.     02480020
*                                                                       02500020
         L     WKREG4,IOBSTART          POINT TO FIRST CCW       S20201 02501020
         CLI   0(WKREG4),SETSECT        IS IT AN RPS COMMAND     S20201 02502020
         BNE   NOTRECR                  NO, SKIP MOVING SECTOR   S20201 02503020
*                                       BYTE                     S20201 02504020
         L     WKREG4,D0(WKREG4)        PT TO SECTOR BYTES       S20201 02505020
         TM    DCBCIND2,WZEROBIT        DID LAST WRITE PUT OUT   S20201 02507020
*                                       REC ZERO TOO                    02508020
         BNO   NOTRECR                  NO, LEAVE SECTOR VALUEAS S20201 02509020
*                                       IS                       S20201 02510020
         MVI   D0(WKREG4),D0            INITIALIZE SECTOR VALUE  S20201 02511020
*                                        ZERO                           02512020
NOTRECR  EQU   *                                                 S20201 02513020
         TM    DCBCIND2,WZEROBIT       DID LAST WRITE FILL A TRACK      02520020
         BZ    MVCSRCH                  NO, CONTINUE ON THIS TRACK      02540020
         XI    DCBCIND2,WZEROBIT         YES,TURN OFF R0 FLAG    A30241 02550020
         BAL   RETREG,WZEROFF           YES, GO INCREMENT TRACK NUMBER  02560020
*                                                                       02580020
MVCSRCH  MVC   IOBSEEK,DCBFDAD         MOVE DCB TRACK ADDRESS TO IOB    02600020
         TM    DCBCIND1,ERASEBIT       ARE THERE UNUSED TRACKS   M5894E 02610020
*                                       TO ERAS                  M5894  02620020
         BC    1,ERSRTN                 YES, GO BUILD ERASE REQUEST     02640020
*                                                                       02660020
*                                                                       02680020
         L     WKREG4,DECAREA          LOAD AREA START ADDRESS          02700020
         IC    WKREG2,DCBFDAD+7        INCREMENT BLOCK ID (R) OF        02720020
         LA    WKREG2,1(0,WKREG2)       DCB ADDRESS                     02740020
         STC   WKREG2,DCBFDAD+7                                         02760020
*                                                                       02780020
         SR    WKREG3,WKREG3           ZERO REGISTER                    02800020
         IC    WKREG3,DCBKEYLE          INSERT KEY LENGTH               02820020
         LTR   WKREG3,WKREG3            AND TEST FOR ZERO               02840020
         BZ    LDBLKSI                 IF NO KEYS, SKIP WRITE DUMMY TST 02860020
*                                                                       02880020
*                                                                       02900020
         TM    DECTYPE+1,DUMMY         THIS A WRITE DUMMY               02920020
         BZ    LDBLKSI                  NO                              02940020
         MVI   0(WKREG4),X'FF'          YES, SET FIRST BYTE OF KEY TO 1 02960020
         STC   WKREG2,0(WKREG4,WKREG3)   FIRST BYTE OF DATA TO BLOCK ID 02980020
*                                                                       03000020
LDBLKSI  LH    WKREG5,DCBBLKSI         INITIALIZE DATA FIELD LENGTH     03020020
         LA    WKREG1,IOBDNRCF         SET COUNT FIELD INDEX            03040020
         L     WKREG6,IOBSTART          AND CCW INDEX                   03060020
*                        WKREG1 = COUNT FIELD INDEX                     03080020
*                        WKREG4 = AREA ADDRESS                          03100020
*                        WKREG5 = TOTAL BYTES OF DATA TO BE WRITTEN     03120020
*                        WKREG6 = CCW INDEX                             03140020
MVCAREA  EQU   *                                                        03160020
         L     WKREG2,IOBSTART          POINT TO FIRST CCW       S20201 03162020
         CLI   D0(WKREG2),SETSECT       IS 1ST CCW AN RPS CCW    S20201 03164020
         BNE   NOTCARN                  NO, SKIP UPDATING THE    S20201 03166020
*                                       PTR                      S20201 03168020
         LA    WKREG6,ONECCW(0,WKREG6)  ELSE UPDATE PTR OVER SET S20201 03170020
*                                       SECT                     S20201 03172020
NOTCARN  EQU   *                                                 S20201 03174020
         TM    DCBCIND2,CLOSEDCB        DID WE ENTER FROM CLOSE  S20201 03176020
         BO    WRTR0                    GO WRITE OUT REC 0       S20201 03178020
         ST    WKREG4,CCW4(0,WKREG6)   STORE ADDR INTO WRITE CCW        03180020
         MVI   CCW4(WKREG6),WRTCKD      RESET THE OP-CODE               03200020
*                                                                       03220020
         SR    WKREG,WKREG             CLEAR WORK REGISTERS             03240020
         SR    WKREG2,WKREG2                                            03260020
         SR    WKREG3,WKREG3                                            03280020
         IC    WKREG3,DNRCF+5(0,WKREG1) INSERT KEY LENGTH FOR THIS SEG. 03300020
         IC    WKREG,OVERK(0,EPREG)     AND O'HEAD FOR KEYS             03320020
         LTR   WKREG3,WKREG3           IS A KEY BEING WRITTEN           03340020
         BZ    NOKEYS                   NO, LET O'HEAD SUB. FROM TOTAL  03360020
         SR    WKREG,WKREG              YES, ZERO AMOUNT TO BE SUB.     03380020
NOKEYS   EQU   *                    DEVELOP BYTES REQUIRED FOR LAST RCD 03400020
         IC    WKREG2,OVERL(0,EPREG)                                    03420020
         TM    BYTEDEV(EPREG),TBOVHD    TWO BYTE OVERHEAD USED   S20201 03424020
         BNO   MZ0010                   BRANCH NO                S20201 03428020
         LH    WKREG2,OVERI(EPREG)      IF YES GET TWO BYTE      S20201 03432020
MZ0010   EQU   *                                                 S20201 03436020
         SR    WKREG2,WKREG            IF NO KEY, SUB. O'HEAD FOR KEYS  03440020
         AR    WKREG2,WKREG3            (O'HEAD + KEY LENGTH            03460020
         LH    WKREG3,DCBTRBAL           + DATA LENGTH) THIS SUM WILL   03480020
         SR    WKREG3,WKREG2           BE SUBTRACTED FROM TRACK BALANCE 03500020
         SR    WKREG3,WKREG5           IF RESULT IS NEGATIVE, RECORD    03520020
         BM    SEGMENT                 WILL NOT FIT                     03540020
*                   WKREG2 = KEY LENGTH + O'HEAD FOR A LAST RECORD      03560020
*                                                                       03580020
*                                                                       03600020
         SR    WKREG4,WKREG4           CALCULATE BYTES REQUIRED FOR AN  03620020
         IC    WKREG4,DNRCF+5(0,WKREG1) INTERMEDIATE RECORD.            03640020
         AR    WKREG4,WKREG5          ((KEY LENGTH + DATA LENGTH) TOLER 03660020
         MH    WKREG4,TOLER(0,EPREG)    + O'HEAD)                       03680020
         SRL   WKREG4,9                                                 03700020
         SR    WKREG4,WKREG                                             03720020
         IC    WKREG,OVERI(0,EPREG)                                     03740020
         TM    BYTEDEV(EPREG),TBOVHD    TWO BYTE OVERHEAD USED   S20201 03744020
         BNO   MZ0020                   BRANCH NO                S20201 03748020
         LH    WKREG,OVERI(EPREG)       GET TWO BYTE OVERHEAD    S20201 03752020
MZ0020   EQU   *                                                 S20201 03756020
         AR    WKREG4,WKREG                                             03760020
*                                                                       03780020
         LH    WKREG,DCBTRBAL          DECREMENT TRACK BALANCE BY THE   03800020
         SR    WKREG,WKREG4             CALCULATED VALUE                03820020
         STH   WKREG,DCBTRBAL                                           03840020
         NI    CCW4+4(WKREG6),0        PRE-SET CHAN. PRGM. TO END HERE  03860020
         MVI   CCW3(WKREG6),WRTCKD     TURN OFF WRITE-SPECIAL BIT       03880020
*                                                                       03900020
         CH    WKREG,DCBEOBR+2         WILL A MINIMUM SEGMENT FIT ON    03920020
         LR    WKREG,WKREG5             THIS TRACK. (MOVE DATA LENGTH)  03940020
         BNL   SETCNTS                  YES, GO PREPARE TO WRITE BLOCK  03960020
WRTR0    EQU   *                                                 S20201 03970020
         OI    DCBCIND2,WZEROBIT       SET TRACK-FULL INDICATION        03980020
         XC    DCBTRBAL(2),DCBTRBAL     ZERO TRACK BALANCE       M5894  03990020
         B     SETR0CNT                GO PREPARE TO WRITE R0 AND BLOCK 04000020
*                                                                       04020020
*                                                                       04040020
SEGMENT  EQU   *                                                        04060020
         LH    WKREG,DCBTRBAL          CALC. BYTES OF DATA FIELD WHICH  04080020
         SR    WKREG,WKREG2             WILL FIT ON THIS TRACK          04100020
         MVI   CCW3(WKREG6),WRTSP      MOVE IN WRITE SPECIAL CKD OPCODE 04120020
SETR0CNT EQU   *                                                        04140020
         MVC   R0CNT(4,WKREG1),DCBFDAD+3  MOVE CCHH TO R0 COUNT AND     04160020
         MVC   R0DATA(5,WKREG1),DCBFDAD+3  CCHHR OF LAST BLOCK TO R0    04180020
*                                          DATA FIELD                   04200020
         TM    DCBCIND2,CLOSEDCB        ARE WE HERE FROM CLOSE   S20201 04201020
         BNO   NOTCLOSE                 IF NOT, DKIP THIS RTN    S20201 04202020
         L     WKREG2,IOBSTART         POINT TO 1ST CCW          M6283  04202120
         CLI   D0(WKREG2),SETSECT      IS 1ST CCW AN RPS CCW     M6283  04202220
         LA    WKREG2,CCW5(WKREG2)     LOAD PTR TO R0 CCW        M6477  04202320
         BNE   NOTRPS                  IF NOT RPS R0 CCW OK      M6477  04202420
         LA    WKREG2,TWOCCW(WKREG2)   UP R0 PTR PAST SET SECT   M6477  04202520
*                                       AND TIC                  M6477  04202620
         B     STORECP                 BR TO STORE CHAN PGM      M6477  04202720
NOTRPS   EQU   *                                                 M6477  04202820
         TM    DCBOPTCD,WRTCHK         WAS WRT CHK REQUESTED     M6477  04202920
         BZ    *+8                     NO, DON'T ALLOW FOR CCW   M6477  04203020
         LA    WKREG2,ONECCW(WKREG2)   UP PTR PAST TIC CCW       M6477  04203120
*                                                                       04207802
*   ENTERED FROM CLOSE TO WRITE OUT R0-UPDATE THE IOBSEEK               04209802
*   FIELD, IN CASE THE LAST RECORD WRITTEN OUT CROSSED TRACKS           04211802
*   LEAVING THE IOBSEEK FIELD POINTING TO THE FIRST OF THESE            04212202
*   TRACKS. MUST ALSO TURN OFF THE COMMAND CHAIN BIT IN THE CCW         04212602
*   THAT WRITES THE DATA FIELD OF R0                                    04212702
*                                                                       04212802
STORECP  EQU   *                                                        04212902
         MVC   IOBSEEK,DCBFDAD          UPDATE SEEK FIELD       ZA01362 04214602
         CLI   D0(WKREG2),SETSECT       IS RPS DEVICE USED      ZA01362 04216602
         BNE   CHANOFF                  NO,GO TURN OFF COMCHN   ZA01362 04217002
         NI    D28(WKREG2),X'FF'-CCHN   TURN OFF COMMAND CHAIN  ZA01362 04217402
         B     STORECP2                 CONTINUE                ZA01362 04217802
CHANOFF  EQU   *                        NOT RPS TURN CC OFF     ZA01362 04218202
         NI    D20(WKREG2),X'FF'-CCHN   TURN OFF COMMAND CHAIN  ZA01362 04219302
STORECP2 EQU   *                        CONTINUE                ZA01362 04221302
         ST    WKREG2,IOBSTART          CHAN PGM WILL START HERE S20201 04222902
         B     DOEXCP                   GO WRITE OUT REC ZERO    S20201 04224002
NOTCLOSE EQU   *                                                 S20201 04227102
         OI    CCW4+4(WKREG6),CCHN     SET COMMAND CHAIN TO WRITE R0    04231802
         L     WKREG2,IOBSTART          POINT TO 1ST CCW IN      S20201 04236502
*                                       CHANNEL PR               S20201 04241202
         CLI   D0(WKREG2),SETSECT       IS RPS FEATURED          S20201 04245902
         BE    NEXT01                   BRANCH AROUND            S20201 04250602
         TM    DCBOPTCD,WRTCHK         IS THERE A TIC AT CCW5 LOCATION  04255302
         BZ    CHECK                   NO                               04260020
NEXT01   EQU   *                                                 S20201 04270020
         LA    WKREG2,CCW6(0,WKREG6)                                    04280020
         ST    WKREG2,CCW5(0,WKREG6)                                    04300020
         MVI   CCW5(WKREG6),TICOP                                       04320020
CHECK    EQU   *                                                        04340020
         LTR   WKREG5,WKREG5           HAVE WE FINISHED WRITING THE     04360020
         LH    WKREG2,DCBWCPO          CCWS                             04380020
         BZ    SKIPNOP                 YES GO BACK TO OUTPUT THEM       04400020
         BCTR  WKREG2,0                NO, DECREMENT TRACK COUNT BY ONE 04420020
         STH   WKREG2,DCBWCPO                                           04440020
SETCNTS  EQU   *                                                        04460020
         STH   WKREG,DNRCF+6(0,WKREG1)  STORE DATA LENGTH IN COUNT      04480020
         MVC   DNRCF(5,WKREG1),DCBFDAD+3 MOVE CCHHR TO COUNT            04500020
*                                                                       04520020
         SR    WKREG5,WKREG            DECREMENT DATA BYTES             04540020
         SR    WKREG2,WKREG2                                            04560020
         IC    WKREG2,DNRCF+5(0,WKREG1) CALC. TOTAL BYTES TO BE         04580020
         AR    WKREG,WKREG2              WRITTEN AS A SEGMENT AND       04600020
         STH   WKREG,CCW4+6(0,WKREG6)   USE AS WRITE CCW COUNT          04620020
*                                                                       04640020
         L     WKREG2,IOBSTART          POINT TO FIRST CCW       S20201 04641020
         CLI   D0(WKREG2),SETSECT       ARE WE TOYING WITH RPS   S20201 04642020
         BNE   NONCARN                  NO, THEN SKIP NEXT RTN   S20201 04643020
         LA    WKREG2,CCW9(0,WKREG6)    ELSE,GET CORRECT WRT     S20201 04644020
*                                       ADDR                     S20201 04645020
         OI    D4(WKREG2),CCHN          TURN ON COMMAND CHAIN    M0169  04645521
         TM    DCBOPTCD,WRTCHK          WRT CHK SPECIFIED        S20201 04646020
         BZ    ABAG                     BRANCH                   S20201 04647020
         LA    WKREG2,RRWTCINC(0,WKREG2) ELSE, GET READ R0 ADDR  S20201 04648020
         OI    WTCKCOMO(WKREG2),CCHN    SET CC IN READ SECT      S20201 04649020
*                                       COMMAND                  S20201 04650020
ABAG     EQU   *                                                 S20201 04651020
         NI    LCOMFLGO(WKREG2),DISCONCC TURN OFF COMMAND CHN    S20201 04652020
*                                       AND                      S20201 04653020
         B     CHKBYTES                   BRANCH AROUND NON      S20201 04654020
*                                       CARN. RTN                S20201 04655020
NONCARN  EQU   *                                                 S20201 04656020
         LA    WKREG2,CCW7(0,WKREG6)   TURN OFF COMMAND CHAIN TO END    04660020
         TM    DCBOPTCD,WRTCHK          CHANNEL PROGRAM                 04680020
         BZ    *+8                      (EITHER CCW7 OR CCW9)           04700020
         LA    WKREG2,16(0,WKREG2)                                      04720020
         NI    4(WKREG2),X'BF'                                          04740020
CHKBYTES EQU   *                                                 S20201 04750020
         LTR   WKREG5,WKREG5           IS BYTES REQUIRED = ZERO         04760020
         BZ    CHK1MORE                 YES, SEE IF ANOTHER BLOCK FITS  04780020
*                                                                       04800020
         OI    4(WKREG2),CCHN          SET COMMAND CHAIN TO CONTINUE    04820020
         AR    WKREG4,WKREG            INCREMENT AREA ADDRESS           04840020
         LA    WKREG1,24(0,WKREG1)      AND COUNT FIELD INDEX           04860020
         LA    WKREG6,8(0,WKREG2)       AND CCW INDEX                   04880020
*                                                                       04900020
         BAL   RETREG,WZEROFF           GO INCR. TRK ADDR.       A30241 04920020
         MVC   R0CNT(4,WKREG1),DCBFDAD+3 FILL COUNT FIELD FOR SCH ID EQ 04940020
         MVI   DCBFDAD+7,1              INCREMENT TO FIRST RECORD       04960002
         B     NOTCARN                  RETURN TO CHECK NEXT     S20201 04970020
*                                       SEQUENCE                 S20201 04980020
*                                                                       05000020
*   SEE IF THERE ARE BYTES REMAINING IN THIS EXTENT FOR ANOTHER BLOCK   05020020
*                                                                       05040020
CHK1MORE EQU   *                                                        05060020
         LH    WKREG2,DCBWCPO          LOAD NO. OF TRACKS REMAINING     05080020
         TM    DCBCIND2,WZEROBIT       IF END OF PERIOD DON'T DECREMENT 05100020
         BO    NODECR                  TRACK COUNT                      05120020
         LTR   WKREG2,WKREG2           TEST ANY REMAINING               05140020
         BZ    NODECR                  IF NONE SEE IF A RECORD WILL FIT 05160020
         BCTR  WKREG2,0                DECREMENT NO. TRACKS BY ONE      05180020
NODECR   EQU   *                                                        05200020
         MH    WKREG2,TRKL(0,EPREG)    MULTIPLY BY TRACK LENGTH         05220020
         AH    WKREG2,DCBTRBAL          ADD BALANCE OF CURRENT TRACK    05240020
         LH    WKREG3,DCBEOBR+2                                         05260020
         BCTR  WKREG3,0                                                 05280020
         AH    WKREG3,DCBBLKSI         KEY LENGTH+DATA LENGTH+O'HEAD    05300020
         SR    EPREG,EPREG             PRE-SET RETURN CODE TO 0         05320020
         CR    WKREG2,WKREG3           BYTES  ENOUGH FOR ANOTHER BLOCK  05340020
         BNL   CHKWRTCK                 YES, DON'T WRITE R0             05360020
*                                                                       05380020
OUTPUTR0 EQU   *                                                        05400020
         B     SETR0CNT                OUTPUT R0 CCWS                   05420020
SKIPNOP  EQU   *                                                        05440020
         TM    DCBCIND2,WZEROBIT       IF R0 WRITTEN DON'T DECREMENT    05460020
         BO    R0SET                   TRACK COUNT.SET TRACK FILLED BIT 05480020
         OI    DCBCIND2,WZEROBIT       SET TRACK-FILLED INDICATION      05500020
         BCTR  WKREG2,0                DECREMENT TRACKS REMAINING BY 1  05520020
         STH   WKREG2,DCBWCPO                                           05540020
R0SET    EQU   *                                                        05560020
         LTR   WKREG2,WKREG2           ANY TRACKS LEFT TO BE ERASED     05580020
         BZ    *+8                      NO, LAST BLOCK FILLED LAST TRK. 05600020
         OI    DCBCIND1,ERASEBIT       TURN ON SW TO INDICATE    M5894  05610020
*                                       ERASE                    M5894  05620020
*                                                                       05640020
         IC    WKREG2,DEBNMEXT         SEE IF THIS IS LAST EXTENT       05660020
         BCTR  WKREG2,0                 CURRENTLY ALLOCATED BY          05680020
         EX    WKREG2,CLIEXTNT          COMPARING M TO NO. OF EXTENTS-1 05700020
         BL    CHKWRTCK                NOT LAST EXTENT                  05720020
         LA    EPREG,8                 SET RETURN CODE TO 8             05740020
*                                                                       05760020
CHKWRTCK EQU   *                                                        05780020
         SR    WKREG2,WKREG2            ZERO ONE CCW INDEX       S20201 05782020
*                                       REGISTER                 S20201 05784020
         L     WKREG5,IOBSTART          POINT TO 1ST COMMAND     S20201 05786020
         CLI   D0(WKREG5),SETSECT       IS THIS REC READY        S20201 05788020
         BNE   NORECR                   NO, THEN FORGET UPDATING S20201 05790020
         LA    WKREG2,TWOCCW(0,0)       INDEXES AND USE THE ZERO S20201 05792020
NORECR   EQU   *                                                 S20201 05794020
         AR    WKREG6,WKREG2            UPDATE CCW INDEX         S20201 05796020
         NI    CCW7+4(WKREG6),0        PRE-SET CHAN. PRGM. TO END       05800020
         SR    WKREG6,WKREG2            DOWNDATE CCW INDEX       S20201 05810020
         TM    DCBOPTCD,WRTCHK         IS WRITE CHECK SPECIFIED         05820020
         BZ    TSTRRTIC                 NO,TEST REC READY TICS   S20201 05828020
         OI    CCW9+CARN28(WKREG6),CCHN TURN ON CHAIN COMMAND    S20201 05836020
*                                       BIT IN                   S20201 05844020
*                                       RD SECT IF CARN                 05852020
*                                                                       05860020
         TM    CCW4+4(WKREG6),CCHN     IS R0 BEING WRITTEN TOO          05880020
         MVI   CCW4+4(WKREG6),CCHN      (NEED COMMAND CHAIN EITHER WAY) 05900020
         BZ    SETTICAD                 NO, GO SET A TIC TO VERIFY BLK. 05920020
         TM    CCW2+5(WKREG6),1         IS THIS THE LAST CCW      21476 05930020
*                                       SEQUE                     21476 05940020
         BZ    SHFTR0                   NO, GO MOVE R0 FIELDS           05960020
         AR    WKREG6,WKREG2            UPDATE CCW INDEX         S20201 05970020
         OI    CCW9+4(WKREG6),CCHN     SET COMMAND CHAIN TO VERIFY BLK. 05980020
         B     DOEXCP                   GO EXECUTE                      06000020
*                                                                       06020020
SHFTR0   EQU   *                       USE LAST SEQUENCE OF CCWS TO     06040020
         AR    WKREG6,WKREG2            UPDATE CCW INDEX         S20201 06050020
         MVC   R0CNT+24(16,WKREG1),R0CNT(WKREG1) OUTPUT R0 BY MOVING    06060020
         LA    WKREG,112(0,WKREG6)      FIELDS AND ALTERING TIC AT CCW5 06080020
         AR    WKREG6,WKREG2            UPDATE CCW INDEX         S20201 06085020
         OI    CCW9+D76(WKREG6),CCHN    SET COMM. CHN TO VERIFY  S20201 06090020
         OI    CCW9+CARN84(WKREG6),CCHN  TURN ON CHAIN COMMAND   S20201 06095020
*                                       BIT IN                   S20201 06100020
*                                         RD SECT IF RR OR IN SEEK      06105020
         SR    WKREG6,WKREG2            RESTORE CCW INDEX TO     S20201 06110020
*                                       ORIGINAL                 S20201 06115020
         SR    WKREG6,WKREG2              POINT                  S20201 06120020
         ST    WKREG,CCW5(0,WKREG6)     ALTER TIC AT CCW5 OR     S20201 06125020
*                                       CCW7                     S20201 06130020
*                                                                       06135020
         B     SETTICOP                                                 06140020
TSTRRTIC EQU   *                                                 S20201 06142020
         LTR   WKREG2,WKREG2            IS THERE RPS             S20201 06144020
         BZ    DOEXCP                   IF NOT, GO EXECUTE       S20201 06146020
         OI    CCW4+D4(WKREG6),CCHN     BE SURE WE CHAIN TO TIC  S20201 06148020
         TM    DCBCIND2,WZEROBIT        ARE WE WRITING A ZERO    S20201 06150020
*                                       REC                      S20201 06152020
         BO    DOEXCP                   IF SO, EVERYTHINGS SET   S20201 06154020
*                                       UP                       S20201 06156020
SETTICAD EQU   *                                                        06160020
         MVC   CCW5(4,WKREG6),CCW5+4(WKREG6) RESTORE TIC ADDR. OF CCW5  06180020
SETTICOP MVI   CCW5(WKREG6),TICOP      RESTORE TIC OP-CODE TO CCW5      06200020
*                                                                       06220020
*                                                                       06240020
DOEXCP   EQU   *                                                        06260020
         LR    WKREG2,EPREG            SAVE RETURN CODE                 06280020
         LA    PARAM1,8(0,IOBREG)      SET IOS IOB PARAMETER            06300020
         EXCP  (1)                                                      06320020
EXCPOUT  LR    EPREG,WKREG2             RESTORE RETURN CODE      M5894  06340020
*                                                                       06360020
*                                                                       06380020
         TM    DCBCIND2,CLOSEDCB        WAS ENTRY FROM CLOSE     YM3919 06390002
         BO    RETURN                   YES, RETURN              YM3919 06392002
         TM    IOBLINK,EOVRET           WAS ENTRY FROM EOV       YM6555 06400002
         BZ    RETURN                   NO, ENTERED BY WRITE MACRO      06420020
*                                                                       06440020
         NI    IOBLINK,X'FF'-EOVRET     CLEAR EOV ENTRY BIT      YM6555 06450002
         NI    IOBLINK,NOTEOV           CLEAR EOV UNSCHEDULED INDICATOR 06460002
         BR    EOVRETRN                 GO BACK TO EOV                  06480002
*                                                                       06500020
*                                                                       06520020
*                                                                       06540020
*  BYPASS EXCP FOR REQUESTS AFTER EOV                                   06560020
*                                                                       06580020
SETEOV   OI    DCBCIND1,VOLFUL         MARK DCB SO FUTURE REQ.S BYPASS  06600020
         BCTR  WKREG3,0                 RESTORE DCBFDAD           12987 06606020
         STC   WKREG3,DCBFDAD                                     12987 06612020
POSTEOV  TM    IOBLINK,EOVRET           WAS ENTRY FROM EOV       YM6555 06619002
         BNO   EOVON                    NO, GO SET EOV BIT       YM6555 06621002
RETEOV   EQU   *                        RETURN TO EOV            YM6555 06621402
         NI    IOBLINK,X'FF'-EOVRET     YES, TURN OFF BIT 1ST    YM6555 06623002
         BR    EOVRETRN                 AND RETURN TO EOV        YM6555 06625002
EOVON    OI    IOBLINK,EOVBIT       MARK IOB AS NOT EXCP'D       M5894  06633020
*                                                                       06640020
NORMAL   SR    15,15                   SET RETURN CODE TO ZERO          06660020
*                                                                       06680020
RETURN   EQU   *                        RET TO USER OR EOV       YM6555 06690002
         TM    IOBLINK,EOVRET           WAS ENTRY FROM EOV       YM6555 06692002
         BNO   USERRET                  NO, TO RESTORE USER REGS YM6555 06694002
         B     RETEOV                   BR TO RET TO EOV         YM6555 06694402
USERRET  RETURN (14,12),T,RC=(15)       RETURN TO THE USER              06700002
*                                                                       06720020
*   INCREMENT TRACK ADDRESS BY 1 AND CHECK VALIDITY                     06740020
*                                                                       06760020
WZEROFF  MVC   IOBCSW(4),MAXCC(EPREG)   MOVE NO. OF CYL          A30241 06780020
*                                        AND TRKS TO IOB                06800020
         MVC   IOBCSW+4(4),DCBFDAD+3   MOVE CURRENT CCHH FOR ALIGNMENT  06820020
         MVC   DCBTRBAL,TRKL(EPREG)    RESET TRACK BALANCE              06840020
         MVI   DCBFDAD+7,0              AND ZERO RECORD NO.             06860020
         SR    WKREG2,WKREG2                                            06880020
         IC    WKREG2,DCBFDAD          DEVELOP POINTER TO CURRENT       06900020
         SLL   WKREG2,4                 EXTENT IN THE DEB               06920020
         AR    WKREG2,DEBREG                                            06940020
         LA    IOBREG,0(0,IOBREG)      BE SURE HI-ORDER BYTE IS ZERO    06960020
         LA    WKREG3,3(0,IOBREG)       SET CCHH INDEX TO LAST H        06980020
         L     CCHH,IOBCSW+4           LOAD CURRENT CCHH TO AN ACCUM.   07000020
         TM    BYTEDEV(EPREG),BYTE      ARE ADDRESS BYTES CONTIGUOUS    07020020
         BZ    DOWNONE                  BRANCH IF CONTIG ADDRESS BYTES  07040020
ADDONE   AH    CCHH,ONE                ADD ONE TO THE LO-ORDER BYTE     07060020
         TM    BYTEDEV(EPREG),BYTE     ARE BYTES NON-CONTIGUOUS         07080020
         BC    1,USEBYTE                YES, TREAT EACH SEPARATELY      07100020
         STH   CCHH,IOBCSW+4-IOBDEF(0,WKREG3)  STORE NEW CC OR HH       07120020
         CLC   IOBCSW+4-IOBDEF(2,WKREG3),IOBCSW-IOBDEF(WKREG3)          07140020
*                                            CHECK FOR VALID VALUE      07160020
         BC    4,TSTEXT                ADDRESS VALID, CHECK EXTENT      07180020
         SRL   CCHH,16                 SHIFT TO CC VALUE                07200020
         MVC   IOBCSW-IOBDEF+4(2,WKREG3),ZEROS  ZERO BYTES PROCESSED    07220020
         BCTR  WKREG3,0                  AND DECREMENT THE INDEX        07240020
DOWNONE  BCTR  WKREG3,0                 DECREMENT POINTER               07260020
         CR    WKREG3,IOBREG           HAVE ALL BYTES BEEN PROCESSED    07280020
         BC    10,ADDONE                NO, LOOP TO ADD ONE TO NEXT BYT 07300020
*                                                                       07320020
NEXTEXT  IC    WKREG3,DCBFDAD          INCREMENT M AND SEE IF THIS WAS  07340020
         LA    WKREG3,1(0,WKREG3)       THE LAST EXTENT.                07360020
         STC   WKREG3,DCBFDAD                                           07380020
         CLC   DCBFDAD(1),DEBNMEXT                                      07400020
         BC    8,SETEOV                 YES, GO SET EOV BIT             07420020
         LA    WKREG2,16(0,WKREG2)     INCREMENT TO NEXT EXTENT         07440020
         MVC   DCBFDAD+1(6),DEBBINUM-DEB(WKREG2)  MOVE BBCCHH TO DCB    07460020
         LH    WKREG,DEBNMTRK-DEB(0,WKREG2) GET THE NUMBER OF TRACKS    07480020
*                                      IN THIS EXTENT AND MULTIPLY IT   07500020
         MH    WKREG,TRKL(0,EPREG)     BY TRACK LENGTH                  07520020
         CH    WKREG,DCBOFFSR           COMPARE TO LENGTH OF ONE A30241 07540020
         BNL   RESETTRK                 RECORD. IF IT FITS,GO ON A30241 07560020
ABEND    EQU   *                                                 A27071 07590020
         OI    DCBIFLGS,DCBIFEC         SET ERROR FLAGS ON       YM3919 07592002
*                                       TO PREVENT IOS FROM      YM3919 07594002
*                                       WRITING R0 DURING CLOSE  YM3919 07596002
*                                       IF AN ATTEMPT IS MADE    YM3919 07598002
         DMABCOND  207,SVC=YES,DCB=(DCBREG) BR PROB DET TO ABEND Y02072 07600002
*                                       002 IF BLK DOES NOT FIT  Y02072 07610002
*                                       IN CURRENT EXTENT        Y02072 07620002
*                                                                       07640020
ABENDSEC EQU   *                                                 Y02072 07650002
         OI    DCBIFLGS,DCBIFEC         SET ERROR FLAGS ON       YM3919 07650402
*                                       TO PREVENT IOS FROM      YM3919 07650802
*                                       WRITING R0 DURING CLOSE  YM3919 07651202
*                                       IF AN ATTEMPT IS MADE    YM3919 07651602
         DMABCOND  206,SVC=YES,DCB=(DCBREG) BR PROB DET TO ABEND Y02072 07652002
*                                       002 IF BLK DOES NOT FIT  Y02072 07654002
*                                       IN SECONDARY EXTENT      Y02072 07656002
*                                                                       07658002
RESETTRK EQU   *                                                        07660020
         MVC   DCBWCPO(2),DEBNMTRK-DEB(WKREG2) MOVE TRACKS IN EXTENT TO 07680020
         BR    RETREG                           DCB, RETURN             07700020
*                                                                       07720020
*                                                                       07740020
*                                                                       07760020
*                                                                       07780020
USEBYTE  EQU   *                                                        07800020
         STC   CCHH,IOBCSW-IOBDEF+4(0,WKREG3)  STORE NEW BYTE OF CCHH   07820020
         SRL   CCHH,8                   SHIFT TO THE NEXT ONE           07840020
         CLC   IOBCSW-IOBDEF+4(1,WKREG3),IOBCSW-IOBDEF(WKREG3)          07860020
*                                                 THIS BYTE VALID       07880020
         BC    4,TSTEXT                 BRANCH IF YES                   07900020
         MVI   IOBCSW-IOBDEF+4(WKREG3),0  ZERO THIS BYTE OF CCHH        07920020
         B     DOWNONE                  GO SEE IF ALL BYTES PROCESSED   07940020
*                                                                       07960020
TSTEXT   CLC   IOBCSW+4(4),DEBENDCC-DEB(WKREG2)  ADDRESS WITHIN EXTENT  07980020
         BC    2,NEXTEXT               NO, SEE IF THERE'S ANOTHER EXT   08000020
         MVC   DCBFDAD+3(4),IOBCSW+4   YES, MOVE NEW CCHH TO DCB        08020020
         BR    RETREG                  RETURN TO MAINLINE               08040020
*                                                                       08060020
*                                                                       08080020
*   SET UP THE CCWS TO ERASE A VARIABLE NUMBER OF TRACKS AT THE END OF  08100020
*   THE EXTENT WHICH COULD NOT BE USED.                                 08120020
*                                                                       08140020
*                                                                       08160020
ERSRTN   EQU   *                                                        08180020
*                                                                       08200020
         XI    DCBCIND1,ERASEBIT       CLEAR ERASE FLAG          M5894  08220020
         L     WKREG6,DCBEOBW          LOAD ADDRESS OF ERASE CCW'S      08240020
         MVC   IOBDNRCF(4),IOBSTART    SAVE WRITE CHAN. PROGRAM ADDRESS 08260020
         ST    WKREG6,IOBSTART         STORE NEW START ADDRESS          08280020
         L     WKREG2,IOBSTART          POINT TO FIRST CCW       S20201 08282020
         CLI   D0(WKREG2),SETSECT       ARE WE CLOWNING WITH     S20201 08284020
*                                       ROTATIONAL POSITION SENSING     08286020
         BNE   NORREDY                  IF NOT BRANCH            S20201 08288020
         LA    WKREG6,CARN24(0,WKREG6)  ELSE UPDATE FOR RPS      S20201 08290020
NORREDY  EQU   *                                                 S20201 08292020
         MVC   ERSDATA(4,WKREG6),DCBFDAD+3 MOVE STARTING CCHH ADDRESS   08300020
*                                                                       08320020
EXCPERS  EQU   *                                                        08340020
         LA    PARAM1,8(0,IOBREG)      SET IOS IOB PARAMETER            08360020
         EXCP  (1)                                                      08380020
*                                                                       08400020
         L     DECBREG,IOBECBPT        RELOAD DECB ADDRESS              08420020
         WAIT  ECB=(1)                 WAIT FOR ERASE TO COMPLETE       08440020
*                                                                       08460020
         L     DECBREG,IOBECBPT        RELOAD DECB ADDRESS              08480020
         SR    WKREG2,WKREG2            SET RETURN CODE IN REG   M5894  08490020
         CLI   DECSDECB,X'42'          ANY ERROR OTHER THAN END-OF-EXT. 08500020
         BNE   EXCPOUT                 YES, CK WHERE ENTERED     M5894  08520020
         NI    DECSDECB,0              CLEAR OUT THE ECB                08540020
*                                                                       08560020
         MVC   DCBFDAD+3(4),ERSDATA(WKREG6) MOVE LAST CCHH TO THE DCB   08580020
         MVC   IOBSTART(4),IOBDNRCF    RESTORE CHAN. PROGRAM ADDRESS    08600020
         LA    RETREG,MVCSRCH          SET RETURN ADDRESS               08620020
         L     EPREG,DCBDVTBL           RELOAD DEV CHAR TBL PTR OZ07617 08626000
         NI    DCBIFLGS,X'3F'           TURN OFF PERM ERR IND   OZ07617 08632000
         B     WZEROFF                  AND GO INCR. TRK ADDR    A30241 08640020
*                                                                       08660020
*                                                                       08680020
*                                                                       08700020
CLIEXTNT CLI   DCBFDAD,0   ---EXECUTED-- CHECK FOR M = LAST EXTENT      08720020
*                                                                       08740020
*                                                                       08760020
**********************************************************************  08780020
*                                                                       08800020
ZEROS    DC    H'0'                     CONSTANT OF ZERO                08820020
ONE      DC    H'1'      CONSTANT ONE                                   08840020
NOP      EQU   X'03'     NOP CHANNEL COMMAND OP-CODE                    08860020
TICOP    EQU   X'08'     TIC COMMAND OP-CODE                            08880020
SCHIDEQ  EQU   X'31'     SEARCH ID EQUAL OP-CODE                        08900020
WRTD     EQU   X'05'     WRITE DATA OP-CODE                             08920020
WRTSP    EQU   X'01'     WRITE COUNT-KEY-DATA SPECIAL                   08940020
WRTCKD   EQU   X'1D'     WRITE COUNT-KEY-DATA                           08960020
ERASEBIT EQU   X'04'       THERE ARE TRCKS TO BE ERASED          M5894  08980020
CCHN     EQU   X'40'     COMMAND CHAIN FLAG                             09000020
WRTCHK   EQU   X'80'     WRITE CHECK OPTION                             09020020
DUMMY    EQU   X'10'     WRITE DUMMY TYPE                               09040020
WZEROBIT EQU   X'40'     LAST I/O WAS WRITE R0                          09060020
EOVBIT   EQU   X'80'     THIS WRITE NOT SCHEDULED BECAUSE OF EOV        09080020
NOTEOV   EQU   X'7F'     ALL BITS EXCEPT USCHEDULED BECAUSE OF EOV      09100020
VOLFUL   EQU   X'20'     VOLUME FULL BIT                                09120020
*                                                                       09200020
*      DIRECT ACCESS DEVICE TABLE DEFINITION                            09220020
BYTE     EQU   2         BYTES OF  CCHH ARE NON-CONTIGUOUS              09240020
OVERK    EQU   8         OFFSET TO KEY OVERHEAD                         09260020
OVERI    EQU   6                   INTERMEDIATE RECORD OVERHEAD         09280020
OVERL    EQU   7                   LAST RECORD OVERHEAD                 09300020
TOLER    EQU   10                  TOLERANCE FACTOR                     09320020
TRKL     EQU   4                   BYTES ON TRACK                       09340020
MAXCC    EQU   0                   NO. OF CYLINDERS, TRACKS             09360020
BYTEDEV  EQU   9                   FLAG, BYTES ARE NON-CONTIGUOUS       09380020
*                                                                       09400020
CCW1     EQU   0         OFFSET TO THE CCWS OF A WRITE SEQUENCE         09420020
CCW2     EQU   8                                                        09440020
CCW3     EQU   16                                                       09460020
CCW4     EQU   24                                                       09480020
CCW5     EQU   32                                                       09500020
CCW6     EQU   40                                                       09520020
CCW7     EQU   48                                                       09540020
CCW8     EQU   56                                                       09560020
CCW9     EQU   64                                                       09580020
ERSDATA  EQU   72        8 BYTE DATA FIELD FOLLOWING ERASE CCWS         09600020
*                                                                       09620020
DNRCF    EQU   0         OFFSET TO NEW RECORD COUNT FIELD               09640020
R0CNT    EQU   8         OFFSET TO R0 COUNT FIELD                       09660020
R0DATA   EQU   16        OFFSET TO R0 DATA FIELD                        09680020
CLOSEDCB EQU   X'20'                    CLOSE INDICATOR          S20201 09680620
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD INDIC  S20201 09681220
*                                                                       09681820
*                                                                       09682420
*        THE FOLLOWING ARE USED BY ROTATIONAL POSITION SENSING          09683020
*                                                                       09683620
D0       EQU   0         ZERO BYTE DISPLACEMENT                  S20201 09684220
D1       EQU   1         ONE BYTE DISPLACEMENT                   S20201 09684820
Q1       EQU   1         ONE BYTE QUANTITY                       S20201 09685420
D4       EQU   4                        DISPLACEMENT OF 4        S20201 09686020
LCOMFLGO EQU   4         OFFSET TO THE CCW FLAG FLD IN LAST      S20201 09686620
*                                       COMMAND                  S20201 09687220
ONECCW   EQU   8         A ONE CCW DISPLACEMENT - EIGHT BYTES    S20201 09687820
D12      EQU   12        12 BYTE DISPLACEMENT                    S20201 09688420
WTCKCOMO EQU   12        OFFSET TO READ SECTOR FLAG BYTE         S20201 09689020
TWOCCW   EQU   16        A TWO CCW DISPLACEMENT - SIXTEEN BYTES  S20201 09689620
RRWTCINC EQU   16        RECORD READY WRITE CHECK INCREMENT      S20201 09690220
D20      EQU   20                       TWENTY BYTE DISPLACEMENT S20201 09690820
CARN24   EQU   24        UPDATE FOR RPS CCWS IN ERASE C.P.       S20201 09691420
D28      EQU   28                       28 BYTE DISPLACEMENT     S20201 09692020
CARN28   EQU   28        OFFSET TO FLAGS IN RD SECT IF WRT CHECK S20201 09692620
D76      EQU   76        76 BYTE DISPLACEMENT                    S20201 09693220
CARN84   EQU   84        OFFSET TO FLAGS IN RPS RD SECT COMMAND  S20201 09693820
*                                                                       09694420
SETSECT  EQU   X'23'     RPS     TEST BYTE- SET SECTOR COMMAND   S20201 09695020
DISCONCC EQU   X'BF'     FOR DISCONNECTING COMMAND CHAINING      S20201 09695620
EOVRET   EQU   X'10'                    BIT INDICATING CALLER    YM6555 09697602
*                                       OF THIS MODULE WAS EOV   YM6555 09699602
MODID    DC    C'IGG019DD'              MODULE ID                Y02072 09705602
FIX      DC    C'ZA01362 '              LATEST FIX IN MODULE    ZA01362 09706002
DATE     DC    C'09/20/74'              DATE OF LATEST FIX      ZA01362 09706402
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 09706802
         EJECT                                                          09756802
*************************  DCB DEFINITION  **************************** 09780020
         DCBD  DSORG=(PS),DEVD=(DA)                                     09800020
         EJECT                                                          09820020
*************************  IOB DEFINITION  **************************** 09840020
IOBDEF   DSECT      I/O BLOCK DEFINITION                                09860020
IOBLINK  DS    F         IOB LINK ADDRESS                               09880020
IOBIOBA  DS    F         IOB ADDRESS FOR EOV                            09900020
IOBFLAG1 DS    CL1       ERROR FLAG 1                                   09920020
IOBFLAG2 DS    CL1       ERROR FLAG 2                                   09940020
IOBSENSE DS    CL2       I/O SENSE BITS                                 09960020
IOBECBPT DS    F         ECB ADDRESS                                    09980020
IOBCSW   DS    D         CSW STORED BY IOS                              10000020
IOBSIOCC DS    0BL1      SIO CONDITION CODE                             10020020
IOBSTART DS    F         CHANNEL PROGRAM STARTING CCW                   10040020
IOBDCBPT DS    F         DCB ADDRESS                                    10060020
IOBRESTR DS    F         CHANNEL PROGRAM RESTART ADDRESS                10080020
IOBINCAM DS    CL2       BLOCK INCREMENT AMOUNT                         10100020
IOBERRCT DS    CL2       ERROR COUNTS                                   10120020
IOBSEEK  DS    D         SEEK ADDRESS                                   10140020
IOBDNRCF DS    D         NEW RECORD COUNT FIELD                         10160020
IOBR0CNT DS    D         COUNT FIELD OF R0                              10180020
IOBR0DAT DS    D         DATA FIELD OF R0                               10200020
IOBCCW1  DS    D         FIRST CCW OF CHANNEL PROGRAM                   10220020
IOBCCW2  DS    D                                                        10240020
IOBCCW3  DS    D                                                        10260020
IOBCCW4  DS    D                                                        10280020
IOBCCW5  DS    D                                                        10300020
IOBCCW6  DS    D                                                        10320020
IOBCCW7  DS    D                                                        10340020
IOBCCW8  DS    D                                                        10360020
IOBCCW9  DS    D                                                        10380020
IOBCCW10 DS    D                                                        10400020
IOBCCW11 DS    D                                                        10420020
IOBCCW12 DS    D                                                        10440020
IOBCCW13 DS    D                                                        10460020
IOBCCW14 DS    D         LAST CCW OF LONGEST CHANNEL PROGRAM            10480020
*                                                                       10500020
*************************  DECB DEFINITION  *************************** 10520020
*                                                                       10540020
DECBDEF  DSECT     DATA EVENT CONTROL BLOCK                             10560020
DECSDECB DS    F         STANDARD ECB                                   10580020
DECTYPE  DS    CL2       TYPE AND OPTIONS                               10600020
DECLNGTH DS    CL2       DATA LENGTH                                    10620020
DECDCBAD DS    F         DCB ADDRESS                                    10640020
DECAREA  DS    F         AREA ADDRESS                                   10660020
DECIOBPT DS    F         IOB ADDRESS                                    10680020
DECKYADR DS    F                                                        10700020
DECOFSET DS    CL2                                                      10720020
DECRESPN DS    CL1                                                      10740020
         EJECT                                                          10760020
*************************  DEB DEFINITION  **************************** 10780020
*                                                                       10800020
DEB      DSECT                                                          10820020
         DS    0F                                                       10840020
DEBNMSUB DS    0CL1                                                     10860020
DEBTCBAD DS    CL4                                                      10880020
DEBAMLNG DS    0CL1                                                     10900020
DEBDEBAD DS    CL4                                                      10920020
DEBOGLGS DS    0CL1                                                     10940020
DEBIRBAD DS    CL4                                                      10960020
DEBOPATB DS    0CL1                                                     10980020
DEBSYSPG DS    CL4                                                      11000020
DEBNMEXT DS    0CL1                                                     11020020
DEBUSRPG DS    CL4                                                      11040020
DEBPRIOR DS    0CL1                                                     11060020
DEBECBAD DS    CL4                                                      11080020
DEBPROTG DS    0CL1                                                     11100020
DEBDEBID DS    0CL1                                                     11120020
DEBDCBAD DS    CL4                                                      11140020
DEBEXSCL DS    0CL1                                                     11160020
DEBAPPAD DS    CL4                                                      11180020
DEBDVMOD DS    0CL1                                                     11200020
DEBUCBAD DS    CL4                                                      11220020
DEBBINUM DS    CL2                                                      11240020
DEBSTRCC DS    CL2                                                      11260020
DEBSTRHH DS    CL2                                                      11280020
DEBENDCC DS    CL2                                                      11300020
DEBENDHH DS    CL2                                                      11320020
DEBNMTRK DS    CL2                                                      11340020
DEBSUBID EQU   0         SUBROUTINE ID'S                                11360020
         END                                                            11380020
./  ADD  SSI=73550206,NAME=IGG019JA
 TITLE 'IGG019JA -- DYNAMIC BUFFERING MODULE, SIO APPENDAGE'            00100002
         IEZBITS                                                        00200001
IGG019JA CSECT                                                          00300001
*MODULE NAME = IGG019JA                                               * 00310002
*                                                                     * 00320002
*DESCRIPTIVE NAME = DYN BUF MODULE & SIO APPENDAGE,                   * 00330037
*                   VIRTUAL ADDRESS SPACE                             * 00340037
*                                                                     * 00342002
*COPYRIGHT = NONE                                                     * 00344002
*                                                                     * 00346002
*CHANGE ACTIVITY                                                      * 00348002
*              VS1-1 CHANGES/DELETIONS                                  00348802
*              VS2-1 CHANGES/DELETIONS                                  00349202
*              VS1-2 CHANGES/DELETIONS                                  00349602
*              VS2-2 CHANGES/DELETIONS                                  00349702
*006000,029000,032000,051000-055000,062000-159000,170000-213000,292000, 00349802
*321000,334000-343000,361000,557000,579000,582000-599000,619000,621000, 00349902
*625000,629000,631000,661000-663000,668000-738000,752000-753000,        00366602
*765000-768000,770000-787000,793000,810000,868000-870000,882000-892000, 00376602
*902000-904000,925000-932000,936000-969000                       Y02072 00378602
*              VS2-4 CHANGES/DELETIONS                                  00379037
*A2871000-288040,370020-377040,414020-415120,575040-575092,    @ZA08000 00379437
*A924020-924120,897740-898020                                  @ZA08000 00379837
*D2885000-298500,378000-394000,467000-537000,665000-897700     @ZA08000 00380237
*D377024,A024500,374152,C374228,374244                         @ZA24815 00380437
*                                                                       00380602
*STATUS CHANGE LEVEL - RELEASE VS2-2 LEVEL 0                            00382602
*                                                                       00383002
*********************************************************************** 00383302
         USING *,RAPDBASE                                               00400001
SIOEP    B     SIORTNE            START I/O APPENDAGE E.P.              00500001
         ORG   IGG019JA+8                                               00700001
FRBUFEP  B     FBUFRTNE           FREE DYNAMIC BUFFER SVC E.P.          00800001
*                                                                       00810002
*                                                                       00820002
*********************************************************************** 00830002
*  THE FOLLOWING TWO ENTRY POINTS ARE USED FOR PROCESSING OF THE      * 00840002
*  FREEDBUF ESTAE ROUTINE, IGCT005G.  THE FIRST ENTRY POINT (+12) IS  * 00842002
*  USED WHEN, IN THE ESTAE CLEANUP ROUTINE, IT IS DETERMINED THAT THE * 00844002
*  AUDIT TRAIL BIT INDICATING THAT THE NEXT IOB HAD BEEN TAKEN FROM   * 00846002
*  THE IOB QUEUE BUT THE CHANNEL PGM HAD NOT BEEN INITIALIZED YET     * 00848002
*  (WKAIOBQ BIT IS ON). IN THIS CASE ENTRY IS MADE TO INITIALIZE      * 00848402
*  THE CHANNEL PROGRAM AND ISSUE THE EXCP FOR THIS REQUEST.           * 00848802
*         THE SECOND ENTRY POINT (+16) IS USED WHEN THE NEXT IOB HAS  * 00849202
*  BEEN REMOVED FROM THE QUEUE, ITS CHANNEL PGM INITIALIZED, BUT THE  * 00849602
*  ABEND OCCURRED BEFORE THE EXCP WAS ISSUED (WKABUFAS BIT ON).IN THIS* 00849702
*  CASE ENTRY IS MADE TO ISSUE THE EXCP FOR THIS REQUEST.             * 00849802
*          INPUT FOR BOTH ENTRIES IS THE SAME:                        * 00849902
*                   REGISTER 2 = NEXT IOB ADDRESS                     * 00866602
*                   REGISTER 3 = BEGINNING ADDRESS OF THIS MODULE     * 00876602
*                   REGISTER 4 = DCB ADDRESS                          * 00878602
*                   REGISTER 5 = SVRB ADDRESS                         * 00880602
*                   REGISTER 6 = BUFFER ADDRESS                       * 00881002
*                   REGISTER 8 = TCB ADDRESS                          * 00882602
*                   REGISTER 15= BEGINNING ADDRESS OF THIS MODULE     * 00883002
*                   WKAREG14 IN SVRB WORKAREA IN INITIALIZED TO       * 00883102
*                                RETURN ADDRESS IN ESTAE              * 00883202
*  A THIRD ENTRY INTO THIS MODULE IS TAKEN BY ESTAE, IGCT005G, IF NO  * 00888802
*  AUDIT TRAIL BITS ARE SET AT ALL.  IN THIS CASE ENTRY IS THE SAME   * 00890802
*  AS FOR FREEDBUF (+8).  INPUT IS LIKEWISE THE SAME.                 * 00892802
*********************************************************************** 00893202
ESTENT1  B     ESTENTA                  INIT CH PGM, ISSUE EXCP  Y02072 00893602
*                                                                       00894002
ESTENT2  B     ESTENTB                  ISSUE EXCP               Y02072 00894102
*********************************************************************** 00894202
*                                                                     * 00894302
*********************************************************************** 00894402
*                  REGISTER EQUATES                                     00900001
*********************************************************************** 00950002
R0       EQU   0        INPUT REGISTER 0    SVC                         01000001
RWORK0   EQU   0        WORK REGISTER                                   01100001
R1       EQU   1        INPUT REGISTER 1                                01200001
RWORK1   EQU   1        WORK REGISTER                                   01300001
RLINK    EQU   1        INTERNAL LINKAGE REGISTER                Y02072 01350002
RRQE     EQU   1        ADDR OF RQE PASSED BY IOS                Y02072 01360002
RIOB     EQU   2        ADDRESS OF IOB                                  01400001
RWORK2   EQU   2        WORK REGISTER                          @ZA08000 01402037
RBASE3   EQU   3        BASE REGISTER       SVC                         01600001
RWORK3   EQU   3        WORK REG                               @ZA08000 01602037
RDCB     EQU   4        ADDRESS OF DCB                                  01700001
RWORK4   EQU   4        WORK REGISTER                                   01800001
RSVRB    EQU   5        ADDRESS OF SVRB ON ENTRY FROM FREEDBUF   Y02072 01950002
RBUFFR   EQU   6        BUFFER ADDRESS                                  02000001
RWORK6   EQU   6        WORK REGISTER                                   02100001
RSWA     EQU   6        PTR TO SEMENT WORK AREA (ASSGNBUF)     @ZA08000 02102037
RDECB    EQU   7        DECB ADDRESS                                    02200001
RWORK7   EQU   7        WORK REGISTER                                   02300001
RCCW     EQU   7        PTR TO CCW TO MODIFY (ASSGNBUF)        @ZA08000 02302037
RTCB     EQU   8        ADDRESS OF TCB IN FREE BUF RTN           Y02072 02350002
RNEWLST  EQU   8        ADDR OF NEW UNSCHEDULED LIST                    02400001
RRQES    EQU   8        REGISTER TO SAVE RQE POINTER           @ZA24815 02450037
RWORK9   EQU   9        WORK REGISTER                                   02500001
RWORK10  EQU   10       WORK REGISTER                                   02800001
RWORK11  EQU   11       WORK REGISTER                                   03000001
RWORK12  EQU   12       WORK REGISTER                                   03100001
RSAVE    EQU   13       IOS REGISTER SAVEAREA ADDR               Y02072 03300002
RWORK13  EQU   13       WORK REGISTER (RECOUP RTN)               Y02072 03350037
RRETURN  EQU   14       RETURN ADDRESS                                  03400001
RRETCODE EQU   15       RETURN CODE REGISTER                            03500001
RAPDBASE EQU   15       BASE REGISTER FOR APPENDAGE ROUTINES            03600001
RWORK15  EQU   15       WORK REGISTER                                   03700001
R15      EQU   15       SAVE/RESTORE REG                         Y02072 03750002
         SPACE 5                                                        03800001
SETSECT  EQU   X'23'         CCW OP-CODE                                03900001
KEYDATOP EQU   X'0E'         CCW OP-CODE  READ KEY & DATE               04000001
RDDATAOP EQU   X'06'         CCW OP-CODE  READ DATA                     04100001
NOP      EQU   X'03'         CCW OP-CODE                                04200001
SILI     EQU   BIT2          CCW FLAGS    SUPPRESS INCORRECT            04300001
*                                         LENGTH INDICATION             04400001
*                                                                       04500001
IC       EQU   B'0001'       MASK FOR ICM, INSERTS 1 BYTE INTO          04600001
*                            LOW ORDER BYTE OF REGISTER                 04700001
ADDR     EQU   B'0111'       MASK FOR ICM/STCM, INSERTS OR              04800001
*                            STORES A 24-BIT ADDRESS TO OR FROM         04900001
*                            THE LOW-ORDER 3 BYTES OF A REGISTER.       05000001
         EJECT                                                          06100001
SIORTNE  EQU   *                                                        21400001
*                                                                     * 21500001
* FUNCTION:                                                           * 21600001
*    THE START-I/O APPENDAGE ATTEMPTS TO ASSIGN A BUFFER TO A         * 21700001
*    READ REQUEST IF THE REQUEST SPECIFIES DYNAMIC BUFFERING AND      * 21800001
*    NO BUFFER WAS ASSIGNED BEFORE EXCP.  IF A BUFFER IS              * 21900001
*    AVAILABLE FOR ASSIGNMENT, IT IS REMOVED FROM THE BUFFER          * 22000001
*    POOL AND THE BUFFER CHAIN IS UPDATED.  THE BUFFER ADDRESS        * 22100001
*    IS PLACED IN THE REQUEST'S DECB AND IN THE READ CCWS OF THE      * 22200001
*    REQUEST'S CHANNEL PROGRAM.  THE ROUTINE THEN RETURNS TO IOS      * 22300001
*    TO INITIATE THE I/O.                                             * 22400001
*    IF NO BUFFER IS AVAILABLE THE REQUEST IS PLACED ON A QUEUE       * 22500001
*    OF REQUESTS WAITING FOR BUFFERS.  THE ROUTINE TAKES THE IOS      * 22600001
*    RETURN WHICH INDICATES THAT THE I/O REQUEST SHOULD NOT BE        * 22700001
*    INITIATED.                                                       * 22800001
*    IF NO BUFFER IS AVAILABLE AND THE ADDRESS OF THE IOB FOR         * 22900001
*    THIS REQUEST CANNOT BE PLACED ON THE CURRENT UNSCHEDULED LIST,   * 23000037
*    THE EXTEND-LIST FUNCTION GETS STORAGE FOR AN UNSCHEDULED LIST      23102037
*    WHICH IS TWICE AS LARGE AS THE PREVIOUS LIST.  IT INITIALIZES    * 23106037
*    THE NEW LIST (AND MOVES ALL ENTRIES FROM THE OLD LIST TO         * 23108037
*    THE NEW LIST) AND PLACES ITS ADDRESS IN DCBDYNB.                 * 23110037
*                                                                     * 23600001
* ENTRY POINT:                                                        * 23700001
*         SIOEP -- ENTERED ASYNCHRONOUSLY FROM IOS AT START-I/O       * 23800001
*         TIME.  THE ADDRESS OF IGG019JA IS PLACED IN THE             * 23900001
*         APPENDAGE VECTOR TABLE (AVT) DURING OPEN PROCESSING.        * 24000001
*         CALLING SEQUENCE -- L     15,4(AVTPTR)                      * 24100001
*                             BALR  14,15                             * 24200001
*                                                                     * 24300001
* INPUT                                                               * 24400001
*    **** REGISTER CONTENTS ****                                      * 24500001
*    REGISTER  1 -- REQUEST QUEUE ELEMENT (RQE) ADDRESS               * 24550002
*    REGISTER  2 -- INPUT/OUTPUT BLOCK (IOB) ADDRESS                  * 24600001
*    REGISTER  3 -- DATA EXTENT BLOCK (DEB) ADDRESS                   * 24700001
*    REGISTER  4 -- DATA CONTROL BLOCK (DCB) ADDRESS                  * 24800001
*    REGISTER  7 -- UNIT CONTROL BLOCK (UCB) ADDRESS                  * 24900001
*    REGISTER 13 -- IOS SAVEAREA ADDRESS                        Y02072* 24950002
*    REGISTER 14 -- RETURN ADDRESS                                    * 25000001
*    REGISTER 15 -- ADDRESS OF IGG019JA                               * 25100001
*                                                                     * 25200001
* OUTPUT                                                              * 25300001
*    **** REGISTER CONTENTS ****                                      * 25400001
*    ALL REGISTER CONTENTS ARE RESTORED BEFORE RETURN TO IOS.         * 25500002
*                                                                     * 26000001
*    **** DATA AREAS SET BY THIS ROUTINE ****                         * 26100001
*    USLBFRQB           UPDATED IF REQUEST IS PLACED ON QUEUE         * 26600001
*                       TO WAIT FOR BUFFER                            * 26700001
*    USLBFRQT           UPDATED IF THIS REQUEST IS THE ONLY ONE ON    * 26800001
*                       THE QUEUE WAITING FOR A BUFFER                * 26900001
*    BCBBFAVL           UPDATED IF A BUFFER IS ASSIGNED               * 27000001
*    DECAREA            DATA ADDR IN THE ASSIGNED BUFFER              * 27100001
*    DECKYADR           KEY ADDR IN THE ASSIGNED BUFFER FOR A READ    * 27200001
*                       BY BLOCK ID, & KEY ADDR SPECIFIED 'S'.        * 27300001
*    CCW3 ADDR          KEY ADDR,FOR NON-RPS CHANNEL PROGRAMS WHEN    * 27800001
*                       KEY IS IN DYNAMIC BUFFER (SEE DECKYADR).      * 27900001
*    CCW4 ADDR          KEY ADDR FOR RPS CHANNEL PROGRAMS, AS ABOVE   * 28000001
*    NEXT-TO-LAST CCW ADDR -- DATA ADDR FOR TRACK-OVERFLOW PROGRAMS   * 28100001
*    LAST CCW ADDR      DATA ADDR FOR NON-TRACK-OVERFLOW PROGRAMS     * 28200001
*                                                                     * 28300001
* EXITS                                                               * 28400001
*         0(R14)        RETURN TO IOS & START I/O                     * 28500001
*         4(R14)        RETURN TO IOS & DISREGARD I/O REQUEST         * 28600001
*                                                                     * 28700001
* ATTRIBUTES -- REENTRANT,PRIVILEGED,KEY=0,ENABLED,WITH THE LOCAL     * 28702037
*    LOCK HELD. MODESET IS ISSUED TO DO ALL PROCESSING IN USER KEY.   * 28704037
*                                                                     * 28706037
         EJECT                                                          28708037
**********************************************************************  28710037
*** DETERMINE IF A BRANCH ENTRY TO SMF IS REQUIRED BECAUSE EXCP HAS     28712037
*** BEEN ISSUED FROM THE ASI ROUTINE IN IGG019KA OR IGC0005C(RELEX)     28714037
*** OR THE ABNORMAL END APPENDAGE HAS RETURNED TO IOS TO RETRY          28715037
*** THE IO REQUEST                                                      28716037
***   INPUT-  REGISTER ONE CONTAINS NUMBER OF EXCP COUNTS.              28717037
***   OUTPUT- SMF EXCP COUNT INCREMENTED BY VALUE IN REG ONE.           28718037
*** SMF BRANCH ENTRY INTERFACE                                          28719037
*** REGISTER  0 - TCB PTR                                               28720037
*** REGISTER  1 - SMF EXCP COUNT                                        28721037
*** REGISTER  3 - DEB PTR                                               28722037
*** REGISTER  7 - UCB PTR                                               28723037
*** REGISTER 10 - WORK REG                                              28724037
*** REGISTER 11 - WORK REG                                              28725037
*** REGISTER 12 - WORK REG                                              28726037
*** REGISTER 13 - WORK REG                                              28727037
*** REGISTER 14 - RETURN ADDR                                           28728037
*** REGISTER 15 - SMF BASE                                              28740037
**********************************************************************  28742037
         STM   R0,R15,0(RSAVE)          SV REGS IN IOS SV AREA @ZA08000 28744037
         LR    RWORK2,RSAVE             SAVE AREA PTR          @ZA08000 28746037
         USING PSA,0                    LOW CORE MAP           @ZA08000 28748037
         L     RWORK13,PSATOLD          PTR TO CURRENT TCB     @ZA08000 28749037
*                                                                       28750037
*** IF THE ABE APPENDAGE RETURNS TO IOS TO RESCHEDULE I/O               28751037
*** THERE WILL BE NO TCB POINTER. THE I/O SUPERVISOR USES THE           28752037
*** SRB TO DISPATCH THE I/O REQUEST.                                    28753037
*                                                                       28754037
         LTR   RWORK13,RWORK13          IS THERE A POINTER     @ZA08000 28755037
         BZ    SMFCALL                  SCHEDULED UNDER SRB    @ZA08000 28756037
         USING TCB,RWORK13              TCB ADDRESSABILITY     @ZA08000 28757037
         L     RWORK13,TCBRBP           PTR TO RB              @ZA08000 28758037
         DROP  RWORK13                                         @ZA08000 28759037
         USING RBBASIC,RWORK13          RB ADDRESSABILITY      @ZA08000 28760037
*                                                                       28761037
***IF EXCP IS ISSUED OUT OF RELEX THE RB WILL BE AN SVRB WITH           28762037
***THE PREVIOUS RB AN IRB.                                              28763037
*                                                                       28764037
         TM    RBSTAB1,RBFTSVRB         IS THIS AN IRB OR SVRB @ZA08000 28765037
         BZ    NOTIRB                   NO,BR AROUND SMF CALL  @ZA08000 28766037
         BNO   SMFCALL                  MAKE SMF CALL FOR IRB  @ZA08000 28767037
         L     RWORK13,RBLINK           PTR TO PREVIOUS RB     @ZA08000 28768037
         TM    RBSTAB1,RBFTIRB          IS PREVIOUS RB AN IRB  @ZA08000 28769037
         DROP  RWORK13                                         @ZA08000 28770037
         BZ    NOTIRB                   NO,DON'T CALL SMF      @ZA08000 28771037
SMFCALL  EQU   *                        CALL SMF               @ZA08000 28772037
         USING RQE,RRQE                                                 28773037
         L     R0,RQETCB                PTR TO TCB             @ZA08000 28774037
         L     R1,MINUS1                NEGATIVE COUNT TO SMF  @ZA08000 28788037
         L     R15,CVTPTR               PTR TO CVT             @ZA08000 28790037
         L     R15,CVTSMFEX-CVTMAP(,R15)   PTR TO SMF RTN      @ZA08000 28792037
         BALR  RRETURN,R15              BR TO SMF              @ZA08000 28794037
         DROP  RRQE                                                     28796037
         DROP  R0                                              @ZA08000 28797037
NOTIRB   EQU   *                        NOT AN IRB             @ZA08000 28798037
         LM    R0,R15,0(RWORK2)         RESTORE REGS           @ZA08000 28800037
         USING IOBSTDRD,RIOB                                            28802037
         USING IHADCB,RDCB                                              28804037
         TM    IOBDTYP2,IOBRQUST  IS THIS A READ REQUEST?               29199702
         BCR   8,RRETURN          IF NOT, RETURN TO IOS                 29199802
         TM    IOBDTYPE,IOBDYNBF  DOES REQUEST SPECIFY DYNAMIC          29199902
*                                 BUFFERING?                            29233202
         BCR   8,RRETURN          IF NO, RETURN TO IOS                  29243202
         TM    IOBSTAT1,IOBBUFF   HAS A BUFFER BEEN ASSIGNED TO         29253202
*                                 THIS REQUEST?                         29263202
         BCR   1,RRETURN          IF SO, RETURN TO IOS                  29265202
*                                                                       29500001
*                       IF A BUFFER IS AVAILABLE, ASSIGN IT TO          29600001
*                       THIS REQUEST AND UPDATE THE BUFFER POOL.        29700001
*                                                                       29800001
         USING RQE,RRQE                 ESTABLISH RQE BASE       Y02072 29860002
*                                                                       29880002
         MODESET  KEYADDR=RQEPRT,WORKREG=10  CHANGE TO USER KEY  Y02072 29890002
*                                                                       29894002
         L     RWORK10,DCBBUFCB   GET BUFFER CONTROL BLOCK ADDR         29900001
         USING BCBDEFV,RWORK10          ESTABLISH BASE FOR BCB   Y02072 30000002
         SR    RWORK11,RWORK11                                          30100001
         ICM   RWORK11,IC,BCBBFAVL  GET BUFFER NUMBER FOR NEXT          30200001
*                                 AVAILABLE BUFFER                      30300001
         BZ    PTONBUFQ           IF NONE AVAILABLE, BRANCH TO          30400001
*                                 PUT REQUEST ON QUEUE                  30500001
         IC    RWORK9,BCBSUFFX-1(RWORK11)   GET NUMBER OF 2ND           30600001
*                                 AVAILABLE BUFFER.                     30700001
         STC   RWORK9,BCBBFAVL    MAKE IT THE NEXT AVAILABLE            30800001
*                                                                       30900001
*                                 COMPUTE ADDR OF THE BUFFER TO         31000001
*                                 BE ASSIGNED.                          31100001
*                                                                       31200001
         BCTR  RWORK11,0          BUFFER NUMBER - 1.                    31300037
         L     RWORK7,BCBBUFL     LENGTH OF EACH BUFFER        @ZA08000 31302037
         MR    RWORK6,RWORK11     BUFFER #-1 * BUFFER LENGTH   @ZA08000 31400037
*                                 = DISPLACEMENT INTO BUFFER POOL       31500037
         LR    RWORK11,RWORK7                                  @ZA08000 31502037
         A     RWORK11,BCBBUF1    + ADDR OF BUFFER #1 = BUFFER          31600001
*                                 ADDR.                                 31700001
         DROP  RWORK10,RRQE                                      Y02072 31800002
         BAL   RLINK,ASSGNBUF     ASSIGN BUFFER TO REQUEST              31900001
*                                                                       32000001
SIORET   EQU   *                        RETURN TO IOS            Y02072 32050002
*                                                                       32060002
         MODESET  KEYADDR=IOSKEY,WORKREG=10  CHANGE TO IOS KEY   Y02072 32070002
*                                                                       32080002
         LM    R0,R15,0(RSAVE)          LOAD IOS REGISTERS       Y02072 32090002
         BR    RRETURN                  RETURN TO IOS TO INITIATE       32092002
*                                       I/O REQUEST                     32300002
         SPACE 5                                                        32400001
PTONBUFQ EQU   *                                                        32500001
*                                                                       32600001
*                       NO BUFFER WAS AVAILABLE. PUT THIS IOB ON        32700001
*                       THE QUEUE WAITING FOR BUFFERS.                  32800001
*                                                                       32900001
*                                                                       33100001
         L     RWORK11,DCBDYNB    ADDR OF CURRENT LIST                  33200001
         USING USL,RWORK11                                              33300001
*                                                                       34400001
*                       PUT IOB ADDR ON THE UNSCHEDULED LIST            34500001
*                                                                       34600001
         L     RWORK10,USLBFRQB   ADDR OF LAST LIST SLOT USED           34700002
         LTR   RWORK10,RWORK10    ANY USED?                             34800001
         BZ    EMPTYQ             BRANCH IF NONE                        34900001
         USING USLSLOT,RWORK10                                          35000001
         TM    USLSLTFL,USLENDL   IS LAST ONE END OF LIST ?             35100001
         BZ    BUMP               BRANCH IF NOT                         35200001
         LA    RWORK10,USLSLOT1-4 LOOP TO POINT TO 1ST SLOT             35300001
BUMP     LA    RWORK10,USLNXT     POINT TO NEXT SLOT                    35400001
         TM    USLSLTFL,USLINUSE  IS THIS SLOT ALREADY IN USE?          35500001
         BO    EXTEND             BRANCH YES, LIST IS FULL              35600037
*                                                                       35700001
STIOBADR ST    RWORK10,USLBFRQB         THIS SLOT IS LAST USED          35800002
         STCM  RIOB,ADDR,USLIOBA+1      PLACE IOB ADDR IN SLOT          35900002
         OI    USLSLTFL,USLINUSE        MARK SLOT NOT AVAILABLE         36000002
         DROP  RWORK10                  DROP USL BASE            Y02072 36010002
*                                                                       36050002
         MODESET  KEYADDR=IOSKEY,WORKREG=10  CHANGE TO IOS KEY   Y02072 36060002
*                                                                       36070002
         LM    R0,R15,0(RSAVE)          LOAD IOS REGISTERS       Y02072 36080002
         B     4(RRETURN)               IOS RETURN - DON'T DO I/O       36200002
*                                                                       36300001
EMPTYQ   LA    RWORK10,USLSLOT1   USE FIRST SLOT ON LIST                36400001
*                                 TOP SLOT IS FIRST ON QUEUE            36500001
         STCM  RWORK10,ADDR,USLBFRQT+1                                  36600001
         B     STIOBADR                                                 36700001
         DROP  RWORK11                                                  36900001
*                                                                       37000001
         EJECT                                                          37000437
EXTEND   EQU   *                                               @ZA08000 37002037
*                       THE IOB ADDRESS CANNOT BE PLACED ON THE         37100001
*                       CURRENT UNSCHEDULED LIST BECAUSE THE            37100437
*                       LIST IS FULL.                                   37102037
*                       GET STORAGE FOR AN UNSCHEDULED LIST TWICE AS    37104037
*                       LARGE AS THE CURRENT ONE.                       37106037
*    DCBDYNB       FOR THE EXTEND FUNCTION, POINTS TO NEW LIST.       * 37202037
*              THE LIST IS INITIALIZED AS FOLLOWS:                    * 37204037
*    USLSIZE       LIST SIZE IN BYTES -- 2* OLD LIST SIZE             * 37206037
*    USLFLAGS      BIT USLCURNT SET IN NEW LIST, TURNED OFF IN        * 37208037
*                  OLD LIST.                                          * 37210037
*    USLBFRQT      THE IOB ADDRESSES ARE ARRANGED SUCH THAT THE       * 37212037
*                  ADDR OF THE 1ST IOB ON THE OLD LIST IS COPIED      * 37214037
*                  INTO THE TOP SLOT ON THE NEW LIST.  IF NO          * 37216037
*                  IOBS ARE ON THE LIST, SET TO ZERO.                 * 37218037
*    USLBFRQB      ADDR OF SLOT USED BY LAST IOB ON QUEUE (OR 0       * 37220037
*                  IF THERE ARE NONE.)                                * 37222037
*    USLCHAIN      ADDRESS OF PRIOR LIST COPY                         * 37224037
*                                                                       37406037
         L     RWORK10,DCBDYNB    GET ADDR OF CURRENT UNSCHED-   Y02072 37410037
         USING USL,RWORK10        ULED LIST.                     Y02072 37412037
         LH    RWORK11,USLSIZE    SIZE OF CURRENT LIST           Y02072 37414037
         SLL   RWORK11,1                *2= SIZE OF NEW LIST   @ZA08000 37414437
         LR    RRQES,RRQE         SAVE RQE POINTER             @ZA24815 37415237
*                                                                       37416037
         GETMAIN R,SP=250,LV=(RWORK11),BRANCH=YES   GET CORE   @ZA08000X37418037
                                                    FOR NEW USL         37420037
         LR    RWORK2,RSAVE             SAVE AREA PTR          @ZA08000 37422137
         LM    RRETURN,R15,56(RSAVE)    RESTORE BASE REG       @ZA08000 37422437
         USING RQE,RRQES                                       @ZA24815 37422837
         MODESET KEYADDR=RQEPRT,WORKREG=9      USER KEY        @ZA08000 37423637
         DROP  RRQES                                           @ZA24815 37424437
         LR    RNEWLST,R1               GET ADDR OF NEW LIST     Y02072 37426037
*                                                                       37428037
         LA    RWORK1,0(RNEWLST,RWORK11)                         Y02072 37430037
*                                                                       37432037
*                  INITIALIZE NEW LIST                                  37502037
*                                                                       37504037
         XC    0(USLSLOT1-USL,RNEWLST),0(RNEWLST)     CLEAR TO 0        37506037
         STH   RWORK11,USLSIZE-USL(RNEWLST)  SIZE OF NEW LIST    Y02072 37508037
         LR    RWORK9,RWORK10           GET ADDRESS OF OLD USL   Y02072 37510037
         AH    RWORK9,USLSIZE           ENDING ADDR OF OLD USL   Y02072 37512037
         LA    RWORK6,USLSLOT1-USL(RNEWLST)                             37514037
*                                 LESS FIRST SLOT ADDR, NEW LIST        37516037
         SR    RWORK1,RWORK6      = LENGTH OF ENTRIES, NEW LIST         37518037
*                                                                       37520037
*                                                                       37522037
*                  IF THE LIST HAS ENTRIES IN 2 NONCONTIGUOUS           37524037
*                  SEGMENTS, FIRST MOVE THE SEGMENT CORRESPONDING       37526037
*                  TO THE TOP OF THE QUEUE. THE SEGMENTS WILL BE        37528037
*                  MOVED WITH MVCL WHICH DEPENDS ON TWO REGISTER        37530037
*                  PAIRS:  R12-R13  AND  R6-R7                          37532037
*                                                                       37534037
         ICM   RWORK12,ADDR,USLBFRQT+1                           Y02072 37536037
*                                 ADDR OF TOP QUEUE ENTRY               37538037
         BZ    CLRLST                                                   37540037
         LR    RWORK13,RWORK9           SAVE FOR LEN CALCULATION Y02072 37542037
*                                       OLD USL ADDR ENDING      Y02072 37544037
         SH    RWORK9,H4                POINT TO LAST ENTRY, OLD LIST   37546037
         USING USLSLOT,RWORK9                                           37602037
         NI    USLSLTFL,X'FF'-USLENDL  TURN OFF END OF LIST FLAG        37604037
*                                      BEFORE MOVE                      37606037
         ST    RWORK6,USLBFRQT-USL(RNEWLST)                             37608037
*                                 TOP OF QUEUE FOR NEW LIST IS          37610037
*                                 FIRST SLOT.                           37612037
         LA    RWORK9,USLSLOT1    FIRST SLOT, OLD LIST.                 37614037
         TM    USLSLTFL,USLINUSE  IS THIS SLOT BEING USED?              37616037
         BZ    SECSEG             BRANCH NO, 1 MOVE WILL SUFFICE        37618037
         DROP  RWORK9                                                   37620037
         CR    RWORK12,RWORK9     IS TOP QUEUE ENTRY IN 1ST SLOT Y02072 37622037
         BE    SECSEG             BRANCH YES, AGAIN 1 MOVE OK           37624037
*                                                                       37626037
         SR    RWORK13,RWORK12    LENGTH OF 1ST SEGMENT          Y02072 37628037
         LR    RWORK7,RWORK13     RECEIVING FIELD IS SAME LENGTH Y02072 37630037
         SR    RWORK1,RWORK7      REDUCE LENGTH OF UNUSED SLOTS         37632037
         MVCL  RWORK6,RWORK12     MOVE 1ST SEGMENT TO NEW LIST   Y02072 37634037
         LA    RWORK12,USLSLOT1   2ND SEGMENT STARTS AT 1ST SLOT Y02072 37636037
*                                 OF OLD LIST.                          37638037
*                                                                       37640037
*                  MOVE SECOND OR ONLY LIST SEGMENT.                    37642037
*                                                                       37644037
SECSEG   L     RWORK13,USLBFRQB   LAST SLOT OF SEGMENT TO MOVE   Y02072 37646037
         USING USLSLOT,RWORK13    ESTABLISH BASE FOR UNSCHED LST Y02072 37648037
         LA    RWORK13,USLNXT     POINT AT END ADDR + 1          Y02072 37650037
         DROP  RWORK13                                           Y02072 37652037
         SR    RWORK13,RWORK12    LENGTH OF SECOND SEGMENT       Y02072 37654037
         LR    RWORK7,RWORK13     RECEIVING FIELD IS SAME LENGTH Y02072 37656037
         SR    RWORK1,RWORK7      REDUCE AMOUNT OF UNUSED SLOTS         37658037
         MVCL  RWORK6,RWORK12     MOVE 2ND SEGMENT TO NEW LIST   Y02072 37660037
         LR    RWORK9,RWORK6      END OF LAST USED SLOT                 37662037
         SH    RWORK9,H4          ADDR OF BOTTOM SLOT IN QUEUE          37664037
         ST    RWORK9,USLBFRQB-USL(RNEWLST)  INITIALIZE PTR TO          37666037
*                                 LAST SLOT OF QUEUE.                   37668037
*                                                                       37670037
*                  CLEAR THE UNUSED SLOTS ON THE NEW LIST               37672037
*                                                                       37674037
CLRLST   LR    RWORK7,RWORK1      LENGTH REMAINING (TO FIELD)           37676037
         SR    RWORK13,RWORK13    SEND NO CHARACTERS, PAD X'00'  Y02072 37678037
         MVCL  RWORK6,RWORK12     CLEAR REST OF LIST             Y02072 37680037
*                                                                       37682037
         SH    RWORK6,H4          ADDR LAST SLOT                        37684037
         USING USLSLOT,RWORK6                                           37686037
         OI    USLSLTFL,USLENDL   TURN ON END-OF-LIST FLAG              37688037
         DROP  RWORK6                                                   37690037
*                                                                       37692037
         NI    USLFLAGS,X'FF'-USLCURNT  TURN OFF 'CURRENT' FLAG         37694037
*                                       IN OLD LIST                     37696037
         OI    USLFLAGS-USL(RNEWLST),USLCURNT                           37698037
*                                 TURN ON 'CURRENT' FLAG IN NEW         37698437
*                                 SET POINTER TO OLD LIST IN NEW        37698837
         ST    RWORK10,USLCHAIN-USL(RNEWLST)                     Y02072 37699237
         ST    RNEWLST,DCBDYNB    SET POINTER TO NEW LIST IN DCB        37699637
         LR    RSAVE,RWORK2             RESTORE SAVE REG       @ZA08000 37702037
         B     PTONBUFQ                 PUT IOB ON USL IST     @ZA08000 37704037
*                                                                       39402037
*                                                                       39414037
         EJECT                                                          39416037
*                                                                       39500001
*                  THIS SUBROUTINE IS USED BY THE START-I/O             39600001
*                  APPENDAGE AND THE FREE DYNAMIC BUFFER SVC            39700001
*                  ROUTINE. IT IS ENTERED IN USER KEY.                  39800002
*                  IT ASSIGNS A BUFFER TO AN I/O REQUEST BY             39900001
*                  PLACING THE BUFFER ADDRESS INTO THE DECB             40000001
*                  AND THE CHANNEL PROGRAM.                             40100001
*                                                                       40200001
*              REGISTER INPUT:  RIOB    - ADDR OF IOB TO WHICH          40300001
*                                         BUFFER WILL BE ASSIGNED       40400002
*                               RDCB    - DCB ADDRESS                   40500001
*                               RWORK11 - BUFFER ADDRESS                40600001
*                               RLINK   - RETURN ADDRESS                40700001
*              REGISTER OUTPUT: RWORK9  - WORK REGISTER                 40800001
*                               RWORK10 - WORK REGISTER                 40900001
*                               RWORK11 - WORK REGISTER                 41000001
*                               RCCW    - WORK REGISTER                 41002037
*                               RSWA    - WORK REGISTER                 41004037
         USING IHADCB,RDCB                                              41100001
         USING IOBSTDRD,RIOB                                            41200001
ASSGNBUF L     RWORK9,IOBECBPT    GET DECB ADDRESS                      41300001
         USING DECB,RWORK9                                              41400001
         USING SWA,RWORK11        ESTABLISH BASE FOR SEG WRKAREA Y02072 41402037
         TM    DCBRECFM,DCBRECV+DCBRECSB IS THIS VS FORMAT     @ZA08000 41404037
         BNO   NORECVS1           NO,BRANCH AROUND VS CODE     @ZA08000 41408037
*                                 PLACE SWA ADDR IN IOB                 41412037
         LR    RWORK10,RIOB       PLACE IOB ADDRESS IN WORK REG         41414037
         LA    RSWA,IOBSTDRD-IOBSWAP   DISP TO IOBSWAP FIELD            41416037
         SR    RWORK10,RSWA       POINT TO IOB PREFIX                   41418037
         USING IOBSWAP,RWORK10                                          41420037
         ST    RWORK11,IOBSWAP    PLACE SWA ADDR IN IOB                 41422037
*                                 DATA & KEY (IF REQUESTED) WILL        41424037
*                                 BE READ INTO THE SEGMENT AREA         41426037
*                                 OF THE DYNAMIC BUFFER.  THE           41428037
*                                 USER WILL BE PASSED THE ADDRESS       41430037
*                                 OF LOCATIONS IN THE RECORD            41432037
*                                 AREA.                                 41434037
*                                                                       41436037
         LA    RSWA,SWASEGMT      GET ADDRESS OF SEGMENT AREA    Y02072 41438037
*                                                                       41440037
         L     RWORK10,DCBBUFCB   ADDRESS BUFFER CONTROL BLOCK          41442037
         USING BCBDEFV,RWORK10    ESTABLISH BASE FOR BCB         Y02072 41444037
         L     RWORK10,BCBRAOFS-1 GET DISPLACEMENT OF RECORD            41446037
         DROP  RWORK10            AREA FROM START OF BUFFER.            41448037
         LA    RWORK11,0(RWORK10,RWORK11)        ADDR OF RECORD AREA    41450037
*                                                                       41452037
         L     RCCW,IOBDCPND      POINT BEYOND LAST CCW                 41454037
         SH    RCCW,H16           POINT TO NEXT-TO-LAST CCW             41456037
*                                 FOR A READ BY BLOCK ID, KEY           41458037
*                                 CODED 'S', THE KEY IS READ            41460037
*                                 INTO THE DYNAMIC BUFFER.              41462037
         TM    IOBDTYP2,IOBTYPE   IS THIS READ BY BLOCK ID?             41464037
         BO    FILLCCWV           BRANCH IF NO                          41466037
         TM    IOBDTYP2,IOBSKEY   WAS KEY ADDRESS CODED 'S'?            41468037
         BZ    FILLCCWV           BRANCH IF NO                          41470037
         ST    RWORK11,DECKYADR   PLACE KEY ADDRESS IN DECB             41472037
         CLI   DCBKEYLE,0         IS KEY LENGTH ZERO             XM1559 41474037
         BE    FILLCCWV           BR IF YES                      XM1559 41476037
         ST    RWORK11,0(RCCW)    PLACE ADDR OF KEY IN RECORD   XA00093 41478037
*                                 AREA INTO NEXT-TO-LAST CCW.           41480037
         MVI   0(RCCW),KEYDATOP   RESTORE OP-CODE                       41482037
*                                 INCREMENT RECORD AREA & SEGMENT       41484037
*                                 AREA POINTERS BEYOND KEY.             41486037
         SR    RWORK10,RWORK10                                          41488037
         IC    RWORK10,DCBKEYLE   GET LENGTH OF KEY                     41490037
         AR    RWORK11,RWORK10    BUMP RECORD AREA POINTER              41492037
*                                                                       41494037
FILLCCWV ST    RWORK11,DECAREA    PLACE DATA ADDRESS IN DECB            41496037
         ST    RSWA,8(RCCW)       PLACE DATA ADDRESS IN LAST CCW        41498037
         MVI   8(RCCW),RDDATAOP   RESTORE OP-CODE.                      41502037
         OI    IOBDSTAT,IOBBUFF   SET BUFFER-ASSIGNED SWITCH            41504037
         BR    RLINK              RETURN TO CALLER                      41506037
         DROP  RWORK11                                                  41508037
         EJECT                                                          41510037
NORECVS1 EQU   *                  NOT VS FORMAT                @ZA08000 41512037
*                                 FOR A READ BY BLOCK ID, KEY           41514037
*                                 CODED 'S', THE KEY IS READ            41600001
*                                 INTO THE DYNAMIC BUFFER.              41700001
         TM    IOBDTYP2,IOBTYPE   IS THIS READ BY BLOCK ID?             41800001
         BO    FILLSCCW           BRANCH IF NO                          41900001
         TM    IOBDTYP2,IOBSKEY   WAS KEY ADDRESS CODED 'S'?            42000001
         BZ    FILLSCCW           BRANCH IF NO                          42100001
*                                 IN AN RPS PROGRAM CCW 3 READS         42200001
*                                 THE KEY; IN A NON-RPS PROGRAM,        42300001
*                                 CCW 4.                                42400001
         LA    RWORK10,IOBCHNPR+16     ADDR OF CCW 3                    42500001
         CLI   IOBCHNPR,SETSECT   TEST FOR RPS PROGRAM                  42600001
         BNE   NORPS              BRANCH IF NOT                         42700001
         LA    RWORK10,8(RWORK10) FOR RPS -- CCW 4                      42800001
*                                 PUT BUFFER ADDR OF KEY IN             42900001
*                                 CORRECT CCW & IN DECB                 43000001
NORPS    ST    RWORK11,0(RWORK10) PLACE ADDRESS IN READ KEY CCW         43100001
         MVI   0(RWORK10),KEYDATOP   RESTORE OP-CODE                    43200001
         ST    RWORK11,DECKYADR   PLACE KEY ADDRESS IN DECB             43300001
*                                 INCREMENT BUFFER POINTER              43400001
*                                 BEYOND KEY                            43500001
         SR    RWORK10,RWORK10                                          43600001
         IC    RWORK10,DCBKEYLE   GET KEY LENGTH                        43700001
         AR    RWORK11,RWORK10    BUMP BUFFER PTR BEYOND KEY            43800001
*                                 IN A NON-TRACK-OVERFLOW PGM           43900001
*                                 THE LAST CCW READS DATA; FOR          44000001
*                                 TRACK OVERFLOW, THE NEXT-TO-          44100001
*                                 LAST CCW                              44200001
FILLSCCW L     RWORK10,IOBDCPND   POINTS BEYOND LAST CCW                44300001
         SH    RWORK10,H8         ADDR OF LAST CCW                      44400001
         TM    DCBOPTCD,DCBOPTTO  TEST FOR TRACK OVERFLOW               44500001
         BZ    STADDR             BRANCH IF NO                          44600001
         SH    RWORK10,H8         ADDR OF NEXT-TO-LAST CCW              44700001
*                                                                       44800001
STADDR   ST    RWORK11,0(RWORK10) PUT DATA ADDR IN CCW                  44900001
         MVI   0(RWORK10),RDDATAOP     RESTORE READ DATA OP-CODE        45000001
         ST    RWORK11,DECAREA    PLACE DATA ADDRESS IN DECB            45100001
         OI    IOBDSTAT,IOBBUFF   SET BUFFER-ASSIGNED SWITCH            45200001
         BR    RLINK              RETURN TO CALLER                      45300001
         DROP  RWORK9                                                   45400001
         DROP  RIOB                                                     45500001
         DROP  RDCB                                                     45600001
         EJECT                                                          45700001
FBUFRTNE EQU   *                                                        45800001
*                                                                     * 45900001
* FUNCTION:                                                           * 46000001
*    THE FREE DYNAMIC BUFFER ROUTINE RELEASES A DYNAMIC BUFFER.       * 46100001
*    IF ANY IOBS ARE ON THE UNSCHEDULED QUEUE (WAITING FOR A          * 46200001
*    BUFFER) THE ROUTINE ASSIGNS THE BUFFER TO THE FIRST IOB ON       * 46300001
*    THE QUEUE, AND ISSUES AN EXCP FOR THAT IOB.  IF NO IOBS ARE      * 46400001
*    ON THE UNSCHEDULED QUEUE THE ROUTINE PLACES THE BUFFER ON        * 46500001
*    THE CHAIN OF AVAILABLE BUFFERS.                                  * 46600001
*                                                                     * 47200001
* ENTRY POINT:                                                        * 47300001
*         FRBUFEP -- ENTERED FROM MODULE IGC0005G WHEN SVC 57 IS      * 47400001
*         ISSUED FOR A DCB WHICH SPECIFIED DIRECT ORGANIZATION.       * 47500001
*         CALLING SEQUENCE -- L    15,DCBDEBAD                        * 47600001
*                             L    15,DEBAPPAD                        * 47700001
*                             L    15,4(15)                           * 47800001
*                             BAL  14,8(15)                           * 47900001
*                                                                     * 48000001
* INPUT                                                               * 48100001
*    **** REGISTER CONTENTS ****                                      * 48200001
*    REGISTER  0 -- DECB ADDRESS                                      * 48300001
*    REGISTER  1 -- DCB ADDRESS                                       * 48500001
*    REGISTER  5 -- SVRB ADDRESS                                      * 48550002
*    REGISTER  8 -- TCB ADDRESS PASSED BY FREEDBUF                    * 48560002
*    REGISTER 14 -- RETURN ADDRESS                                    * 48700001
*    REGISTER 15 -- ADDRESS OF IGG019JA                               * 48800001
*                                                                     * 48900001
* OUTPUT                                                              * 49000001
*    **** REGISTER CONTENTS ****                                      * 49100001
*    ALL REGISTERS EXCEPT REGISTER 14 CAN BE USED WITHOUT SAVING      * 49200001
*    OR RESTORING CONTENTS.                                           * 49300001
*    REGISTER 15 CONTAINS RETURN CODE.                                * 49400001
*                                                                     * 49500001
*    **** DATA FIELDS SET BY THIS ROUTINE ****                        * 49600001
*    USLBFRQT      IF AN IOB IS WAITING FOR A BUFFER, PTR TO 1ST      * 49700001
*                  IOB ON QUEUE IS UPDATED.                           * 49800001
*    USLBFRQB      IF, AFTER 1 IOB IS DEQUEUED, THE LIST IS EMPTY,    * 49900001
*                  USLBFRQB IS SET TO ZERO.                           * 50000001
*    THE BUFFER ADDRESS IS PLACED IN THE CHANNEL PROGRAM AND DECB     * 50100001
*    FIELDS (SEE SIORTNE DESCRIPTION FOR DETAILS).                    * 50200001
*    BCBBFAVL      IF THE BUFFER IS NOT ASSIGNED TO A REQUEST,        * 50300001
*                  ITS NUMBER IS PLACED IN BCBBFAVL.  THE             * 50400001
*                  CORRESPONDING BYTE OF THE BUFFER POOL SUFFIX       * 50500001
*                  WILL POINT TO THE SECOND AVAILABLE BUFFER.         * 50600001
*    SVRB          SEE BELOW                                            51950002
*                                                                     * 52000001
* EXTERNAL REFERENCES                                                 * 52100001
*        EXCP CALL TO IOS                                             * 52200001
*        MODESET   TO CHANGE BETWEEN SUPERVISOR AND USER KEYS         * 52400002
*        SETLOCK   TO RELEASE AND OBTAIN THE LOCAL LOCK                 52450002
*                                                                     * 53000001
* EXITS, NORMAL                                                       * 53100001
*    BRANCH RETURN TO IGC0005G ON REGISTER 14.  RETURN CODE (R15)     * 53200001
*    = 0.                                                             * 53300001
*                                                                     * 53400001
*                                                                     * 54200001
* TABLES / WORK AREAS                                                 * 54300001
*        IOB, DCB, DECB, BUFFER CONTROL BLOCK,                        * 54400037
*         & SVRB EXTENDED SAVEAREA                                    * 54500037
*                                                                     * 54600001
* ATTRIBUTES -- REENTRANT, READONLY, PRIVILEGED. ENTRY IS IN SUPER-   * 54700002
*        VISOR KEY WITHOUT THE LOCAL LOCK HELD. RETURN TO IGC0005G IS * 54710002
*        IN SUPERVISOR KEY. MOST PROCESSING IS IN USER KEY.           * 54720002
*                                                                     * 54800001
* NOTES -- THE ROUTINE MUST HAVE THE LOCAL LOCK TO UPDATE THE SERIALLY* 54900002
*        REUSABLE IOB AND BUFFER QUEUES. SETLOCK WILL BE ISSUED THEN. * 55000002
*                                                                     * 55500001
*****                                                             ***** 55550002
         EJECT                                                          55666702
         LR    RBASE3,RAPDBASE    ESTABLISH BASE REGISTER               55900001
         USING IGG019JA,RBASE3                                          56000001
         DROP  RAPDBASE                                                 56100001
         LR    RDCB,R1            TRANSFER DCB ADDRESS                  56200001
         USING IHADCB,RDCB                                              56300001
         USING RBSECT,RSVRB       ESTABLISH BASE FOR SVRB        Y02072 56350002
         ST    RRETURN,WKAREG14   SAVE RETURN REGISTER                  56352002
         USING TCB,RTCB           ESTABLISH BASE FOR TCB         Y02072 56370002
*                                 PASSED BY FREEDBUF IN R8       Y02072 56380002
*                                                                       56390002
         MODESET  KEYADDR=WKASVKEY,WORKREG=6  CHANGE TO USER KEY Y02072 56392002
*                                                                       56394002
         USING DECB,RDECB                                               56600001
*                                                                       56700001
*                       LOCATE THE BEGINNING ADDRESS OF THE             56800001
*                       BUFFER BEING FREED.                             56900001
*                                                                       57000001
         L     RBUFFR,DECAREA     ASSUME BUFFER ADDR = DATA ADDR        57100001
         TM    DECTYPE2,DECKEYS   WAS KEY IN BUFFER (CODED 'S')?        57200001
         BZ    FBU0500            BRANCH NO                             57300001
         L     RBUFFR,DECKYADR    BUFFER ADDR = KEY ADDR                57400001
FBU0500  EQU   *                                                        57500001
         TM    DCBRECFM,DCBRECV+DCBRECSB IS THIS VS FORMAT     @ZA08000 57500437
         BNO   NORECVS2                 NO,BR AROUND VS CODE   @ZA08000 57500837
         LA    RWORK12,BUFRECAR-BUFBFPTR                                57502037
         SR    RBUFFR,RWORK12     POINT TO ADDR OF BEGINNING OF         57504037
*                                 BUFFER                                57506037
         L     RBUFFR,0(RBUFFR)         GET BUFFER ADDRESS              57508037
         USING SWA,RBUFFR               ESTABLISH BASE FOR SWA   Y02072 57508437
         XC    SWABFINC,SWABFINC        RECORD AREA OFFSET PTR   Y02072 57508837
NORECVS2 EQU   *                        NOT VS RECORD FORMAT   @ZA08000 57509237
         L     RWORK10,DCBDYNB    ADDR OF UNSCHEDULED LIST       Y02072 57510002
         USING USL,RWORK10              USL ADDRESSABILITY       Y02072 57520002
         L     RWORK12,DCBBUFCB         GET BCB ADDRESS          Y02072 57530002
         USING  BCBDEFV,RWORK12         BCB ADDRESSABILITY       Y02072 57540002
*                                                                       57550002
*   PREPARE FOR QUEUE UPDATES. THIS REQUIRES THAT THE LOCAL LOCK BE     57560002
*   OBTAINED WHILE MANIPULATING THE QUEUE. IT IS RELEASED WHEN THE      57570002
*   QUEUE HAS BEEN UPDATED AND THE NEXT WAITING IOB HAS BEEN REMOVED,   57580002
*   OR THE BUFFER HAS BEEN PUT BACK ON THE AVAILABLE BUFFER QUEUE.      57590002
*   MODESET IS ISSUED BECAUSE SETLOCK REQUIRES SUPERVISOR KEY.          57590402
*   CERTAIN FIELDS WILL BE SAVED AT THIS POINT, SHOULD THE ESTAE        57590502
*   NEED THEM. SETLOCK USES REGISTERS 11-14 WITHOUT RESTORING THEM.     57590802
*                                                                       57592002
         IC    RWORK9,BCBBFAVL          GET NEXT AVAIL BUF NO    Y02072 57592402
*                                       FOR ESTAE- 1 BYTE        Y02072 57592802
         DROP  RWORK12                  DROP BCB BASE            Y02072 57592902
         L     RWORK0,USLBFRQT          GET USL CONTENTS FOR     Y02072 57593202
*                                       ESTAE - IN USER KEY      Y02072 57593602
*                                                                       57593702
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 57594002
*                                       TO GET THE LOCAL LOCK    Y02072 57594402
*                                                                       57594802
GETLOCK  SETLOCK  OBTAIN,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019JA(FREELOCKX57594902
               ,FREELCK1)'),MODE=UNCOND  GET THE LOCAL LOCK      Y02072 57595302
*                                                                       57595502
         ST    RBUFFR,WKABUFRG          SAVE BUF PTR FOR ESTAE   Y02072 57595602
         ST    RWORK0,WKASAVE           SAVE USL CONTENT IN SVRB Y02072 57605202
         STC   RWORK9,WKASAVE2          SAVE NEXT AVAIL BUF NO.  Y02072 57615202
*                                       FOR ESTAE IN CASE PATH   Y02072 57625202
*                                       TAKEN CHANGES THIS       Y02072 57627202
*                                                                       57665502
         MODESET  KEYADDR=WKASVKEY,WORKREG=11 RET TO USER KEY    Y02072 57693102
*                                                                       57700002
         ICM   RWORK9,ADDR,USLBFRQT+1   PTR TO 1ST IOB ON QUEUE         60000001
         BZ    FBUNOREQ           BRANCH IF NO IOBS TO MAKE             60100001
*                                 BUFFER AVAILABLE                      60200001
         USING USLSLOT,RWORK9                                           60300001
         L     RIOB,USLSLOT       GET IOB ADDRESS                       60400001
         USING IOBSTDRD,RIOB                                            60500001
*                                                                       60510002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 60550002
*                                       TO SAVE IOB ADDRESS      Y02072 60560002
         ST    RIOB,WKAIOBRG            SAVE IOB PTR FOR ESTAE   Y02072 60580002
*                                                                       60590002
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 60592002
*                                                                       60594002
         NI    USLSLTFL,X'FF'-USLINUSE  MAKE SLOT AVAILABLE             60600001
         TM    USLSLTFL,USLENDL   IS THIS LAST SLOT IN LIST?            60700001
         BZ    NXTSLT             BRANCH IF NO                          60800001
         LA    RWORK9,USLSLOT1-4 GET BACK TO TOP OF LIST                60900001
NXTSLT   LA    RWORK9,USLNXT      BUMP SLOT POINTER 1 ENTRY             61000001
         TM    USLSLTFL,USLINUSE  IS THERE ANOTHER IOB WAITING?         61100001
         BO    STOREPTR                 BRANCH IF YES                   61200002
         SR    RWORK9,RWORK9                                            61300001
         DROP  RWORK9                                                   61400001
         ST    RWORK9,USLBFRQB          MARK QUEUE EMPTY BY SETTING     61500002
*                                       TOP & BOTTOM PTRS TO ZERO.      61600002
STOREPTR STCM  RWORK9,ADDR,USLBFRQT+1   SLOT OF FIRST IOB (OR 0)        61700002
         DROP  RWORK10                                           Y02072 61750002
*                                                                       61850002
         MODESET  EXTKEY=ZERO           CHANGE TO ZERO KEY       Y02072X61860002
                                        TO SET BIT IN SVRB       Y02072X61870002
                                        AND RELEASE LOCAL LOCK   Y02072 61870402
         MVI   WKATRAIL,WKAIOBQ         SET BIT IN SVRB EXT SAVE Y02072 61870802
*                                       INDICATING IOB DEQUEUED  Y02072 61871202
*                                                                       61872002
FREELOCK SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019JA(GETLOCKX61874002
               )')                      FREE THE LOCAL LOCK      Y02072 61874402
*                                                                       61884402
ESTENTA  EQU   *                        ESTAE ENTRY IF WKAIOBQ=1 Y02072 61886002
*                                                                       61888002
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 61892002
*                                                                       61894002
         LR    RAPDBASE,RBASE3    LOAD BASE FOR COMMON SUBRTNE          61944002
         LR    RWORK11,RBUFFR     PUT BUFFER ADDR IN R11                62400001
         BAL   RLINK,ASSGNBUF     ASSIGN THE BUFFER TO THE              62700001
*                                 DEQUEUED IOB.                         62800001
*                                                                       62870002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072X62880002
                                        TO SET BIT IN SVRB       Y02072 62890002
         MVI   WKATRAIL,WKABUFAS        SET BIT IN SVRB EXTENDED Y02072 62892002
*                                       SAVEAREA INDICATING BUF  Y02072 62894002
*                                       ASSIGNED TO NEXT IOB     Y02072 62896002
ESTENTB  EQU   *                        ESTAE ENTRY IF WKABUFAS  Y02072 62896402
*                                       BIT IS ON                Y02072 62896802
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 62898002
*                                                                       62898402
         L     RWORK11,IOBECBPT         LOAD ADDR TO USER'S DECB Y02072 62898802
         ST    RWORK11,IOBDQPTR         SAVE DECB ADDR IN IOB    Y02072 62899202
         LA    RWORK11,IOBCSW+3         SET UP CSW ADDRESS TO    Y02072 62899602
         ST    RWORK11,IOBECBPT         USE AS DUMMY ECB FOR IOS Y02072 62899702
*                                       CEA OR EOE WILL RESTORE  Y02072 62899802
*                                       USER'S DECB ADDR IN IOB  Y02072 62899902
*                                                                       62933202
         EXCP  (RIOB)                   SCHEDULE I/O FOR NEXT IOB ON Q  62988602
*                                                                       62988702
         MODESET  EXTKEY=ZERO           RETURN TO ZERO KEY       Y02072 62988802
*                                                                       62992502
         MVI   WKATRAIL,WKAEXCP         SET BIT INDICATING EXCP  Y02072 62995302
*                                                                       62995702
         B     NORMEXIT                 NORMAL RET TO IGC0005G   Y02072 63200002
         SPACE 5                                                        63400001
*                                                                       63500001
*   NO IOBS ARE WAITING FOR BUFFERS.  RETURN BUFFER TO THE AVAILABLE    63550002
*   QUEUE.THIS ROUTINE IS ENTERED IN USER KEY WITH THE LOCAL LOCK HELD. 63600002
*   RETURN FROM THIS ROUTINE TO FREEDBUF IS IN SUPERVISOR KEY.          63650002
*                                                                       63800001
FBUNOREQ L     RWORK12,DCBBUFCB   ADDR OF BUFFER CONTROL BLOCK   Y02072 63900002
         USING BCBDEFV,RWORK12          ESTABLISH BCB BASE       Y02072 64000002
*                                                                       64100001
*                      COMPUTE BUFFER NUMBER FROM BUFFER ADDRESS        64200001
*                                                                       64300001
         LR    RWORK1,RBUFFR      BUFFER ADDRESS                        64400001
         S     RWORK1,BCBBUF1     MINUS ADDR OF 1ST BUFFER              64500001
*                                  = DISP INTO BUFFER POOL              64600001
         SR    RWORK0,RWORK0                                            64700001
         D     RWORK0,BCBBUFL     DIVIDED BY BUFFER LENGTH              64800001
*                                  = BUFFER NUMBER -1.                  64900001
         LA    RWORK1,1(RWORK1)   PLUS 1 = BUFFER NUMBER                65000001
*                                                                       65100001
*                      PLACE BUFFER # ON AVAILABLE CHAIN                65200001
*                                                                       65300001
         IC    RWORK9,BCBBFAVL    NEXT AVAIL BUFFER #                   65400001
         STC   RWORK9,BCBSUFFX-1(RWORK1)    POINT CHAIN ENTRY           65500001
*                                 FOR THIS BUFFER TO IT                 65600001
         STC   RWORK1,BCBBFAVL    MAKE THIS BUFFER NEXT AVAIL           65700001
*                                                                       65800001
*            RELEASE LOCAL LOCK AND SET AUDIT TRAIL BIT                 65850002
*                                                                       66000001
*                                                                       66050002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072X66100002
                                        TO SET BIT IN SVRB       Y02072X66150002
                                        AND RELEASE LOCK         Y02072 66152002
         MVI   WKATRAIL,WKABUFQ         SET BIT INDICATING BUF   Y02072 66154002
*                                       FREED AND PUT ON QUEUE   Y02072 66156002
*                                                                       66160002
FREELCK1 SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019JA(GETLOCKX66170002
               )')                      FREE THE LOCAL LOCK      Y02072 66172002
*                                                                       66222002
*                                                                       66600001
         EJECT                                                          73900001
*                                                                       86700001
*                                                                       87100001
*                       NORMAL EXIT                                     87200001
*                                                                       87300001
NORMEXIT L     RRETURN,WKAREG14   RESTORE RETURN REGISTER               87400001
         SR    RRETCODE,RRETCODE  RETURN CODE = 0.                      87500002
         BR    RRETURN            RETURN TO IGC0005G                    87600001
*                                                                       87700001
         SPACE 2                                                        87800002
*********************************************************************** 89750002
*                           CONSTANTS                                 * 89760002
*********************************************************************** 89770002
MINUS1   DC    F'-1'                    NEGATIVE COUNT FOR SMF @ZA08000 89774037
H8       DC    H'8'                                                     89800001
H16      DC    H'16'                                           @ZA08000 89802037
H4       DC    H'4'                                                     89900001
IOSKEY   DC    X'00'                    KEY OF IOS               Y02072 89950002
ZERO     DC    X'00'                    SVRB KEY                 Y02072 89960002
NAME     DC    CL8'IGG019JA'            MODULE NAME            @ZA08000 89962037
FIX      DC    C'OZ24815 '              LATEST APAR            @ZA24815 89963037
DATE     DC    CL8'&SYSDATE'            LAST FIX DATE          @ZA08000 89964037
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 89970002
         EJECT                                                          91000001
*********************************************************************** 91010002
*                         DSECTS                                      * 91020002
*********************************************************************** 91030002
         IHAPSA                                                  Y02072 91050002
         EJECT                                                          91080002
         IECDRQE                                                 Y02072 91090002
         EJECT                                                          91092002
         IKJTCB                                                         91094002
         EJECT                                                          91096002
         IEZIOB                                                         91100001
         ORG   IOBDQPTR                                                 91200001
IOBDQSW  DS    B        FLAGS                                           91300001
IOBDQCP  EQU   BIT0          CHANNEL PROGRAM MODIFIED                   91400001
*                                                                       91500001
         IHADCB DSORG=DA                                                91600001
*                                                                       91700001
         IHADECB                                                        91800001
         SPACE                                                          92200001
         IHAECB                                                         92300001
*                                                                       92400001
         EJECT                                                          92402037
         CVT   DSECT=YES                                       @ZA08000 92404037
         EJECT                                                          92408037
         IGGSWA                                                @ZA08000 92410037
BUFFERB  DSECT          FORMAT OF BUFFER BEYOND SEGMENT AREA            92410437
BUFBFPTR DS    A        ADDRESS OF BEGINNING OF BUFFER                  92410837
BUFRECAR EQU   *        RECORD AREA; BUFBFPTR IS ALIGNED SO THAT        92411237
*                       BUFRECAR FALLS AS SPECIFIED BY DCBBFALN.        92411637
         EJECT                                                          92412037
         IGGBCB  TYPE=DAM                                        Y02072 92450002
         EJECT                                                          92500002
         IKJRB                                                   Y02072 93400002
         IGGFRWKA                                                Y02072 93450002
         EJECT                                                          95350002
         IGGUSL                                                  Y02072 95360002
         END                                                            97100001
./  ADD  SSI=33240797,NAME=IGG019JB
 TITLE 'IGG019JB -- DYNAMIC BUFFERING MODULE, SIO  APPENDAGE'           00020002
IGG019JB CSECT                                                          00022002
*MODULE NAME = IGG019JB                                               * 00024002
*                                                                     * 00026002
*DESCRIPTIVE NAME = DYN BUF MODULE & SIO APPENDAGE FOR VS RECORD      * 00028002
*                   FORMAT AND VIRTUAL ADDRESS SPACE                  * 00028402
*                                                                     * 00028802
*COPYRIGHT = NONE                                                     * 00029202
*                                                                     * 00029602
*CHANGE ACTIVITY                                                      * 00029702
*                                                                     * 00029802
*        VS1-1 CHANGES/DELETIONS                                        00029902
*        VS2-1 CHANGES/DELETIONS                                        00034902
*        VS1-2 CHANGES/DELETIONS                                        00044902
*D094000                                                        XA00093 00057702
*        VS1-3 CHANGES/DELETIONS                                        00058102
*                                                                XM1559 00058502
*        VS2-2 CHANGES/DELETIONS                                        00059702
*001200,003000,005600,006200,006800,010400-011200,012600-032400,034200- 00061702
*042800,059600,064000,065800-066200,068800-070600,074200,081000,116800, 00063702
*122600-126600,130600-131200,131800,132600,133000,138800-139800,140400- 00065702
*154400,157200-157400,160800,161200-164200,165400,168800,180200-180600, 00065802
*183000-185200,187000-187400,191000-193600,195400-202600         Y02072 00069302
*                                                                     * 00071302
*STATUS CHANGE LEVEL 3                                                * 00071702
*                                                                     * 00072102
         IEZBITS                                                        00073002
*********************************************************************** 00076502
         USING *,RAPDBASE                                               00080001
SIOEP    B     SIORTNE            START I/O APPENDAGE E.P.              00100001
         ORG   IGG019JB+8                                               00140001
FRBUFEP  B     FBUFRTNE           FREE DYNAMIC BUFFER SVC E.P.          00160001
*********************************************************************** 00170002
*                                                                       00172002
*                                                                       00174002
*********************************************************************** 00176002
*  THE FOLLOWING TWO ENTRY POINTS ARE USED FOR PROCESSING OF THE      * 00178002
*  FREEDBUF ESTAE ROUTINE, IGCT005G.  THE FIRST ENTRY POINT (+12) IS  * 00178402
*  USED WHEN, IN THE ESTAE CLEANUP ROUTINE, IT IS DETERMINED THAT THE * 00178802
*  AUDIT TRAIL BIT INDICATING THAT THE NEXT IOB HAD BEEN TAKEN FROM   * 00179202
*  THE IOB QUEUE BUT THE CHANNEL PGM HAD NOT BEEN INITIALIZED YET     * 00179602
*  (WKAIOBQ BIT IS ON). IN THIS CASE ENTRY IS MADE TO INITIALIZE      * 00179702
*  THE CHANNEL PROGRAM AND ISSUE THE EXCP FOR THIS REQUEST.           * 00179802
*         THE SECOND ENTRY POINT (+16) IS USED WHEN THE NEXT IOB HAS  * 00179902
*  BEEN REMOVED FROM THE QUEUE, ITS CHANNEL PGM INITIALIZED, BUT THE  * 00186602
*  ABEND OCCURRED BEFORE THE EXCP WAS ISSUED (WKABUFAS BIT ON).IN THIS* 00188602
*  CASE ENTRY IS MADE TO ISSUE THE EXCP FOR THIS REQUEST.             * 00190602
*          INPUT FOR BOTH ENTRIES IS THE SAME:                        * 00192602
*                   REGISTER 2 = NEXT IOB ADDRESS                     * 00193002
*                   REGISTER 3 = BEGINNING ADDRESS OF THIS MODULE     * 00193102
*                   REGISTER 4 = DCB ADDRESS                          * 00193202
*                   REGISTER 5 = SVRB ADDRESS                         * 00199902
*                   REGISTER 6 = BUFFER ADDRESS                       * 00200302
*                   REGISTER 8 = TCB ADDRESS                          * 00201902
*                   REGISTER 15= BEGINNING ADDRESS OF THIS MODULE     * 00203902
*                   WKAREG14 IN SVRB WORKAREA IN INITIALIZED TO       * 00205902
*                                RETURN ADDRESS IN ESTAE              * 00206302
*  A THIRD ENTRY INTO THIS MODULE IS TAKEN BY ESTAE, IGCT005G, IF NO  * 00206402
*  AUDIT TRAIL BITS ARE SET AT ALL.  IN THIS CASE ENTRY IS THE SAME   * 00206502
*  AS FOR FREEDBUF (+8).  INPUT IS LIKEWISE THE SAME.                 * 00213202
*********************************************************************** 00215202
ESTENT1  B     ESTENTA                  INIT CH PGM, ISSUE EXCP  Y02072 00217202
*                                                                       00219202
ESTENT2  B     ESTENTB                  ISSUE EXCP               Y02072 00219602
*********************************************************************** 00219702
*                                                                     * 00219802
*                  REGISTER EQUATES                                     00219902
R0       EQU   0        INPUT REGISTER 0    SVC                         00226602
RWORK0   EQU   0        WORK REGISTER                                   00233302
R1       EQU   1        INPUT REGISTER 1                                00240001
RRQE     EQU   1        ADDRESS OF RQE                           Y02072 00250002
RLINK    EQU   1        INTERNAL LINKAGE REGISTER                Y02072 00252002
RWORK1   EQU   1        WORK REGISTER                                   00260001
RIOB     EQU   2        ADDRESS OF IOB                                  00280001
RBASE3   EQU   3        BASE REGISTER       SVC                         00320001
RDCB     EQU   4        ADDRESS OF DCB                                  00340001
RWORK4   EQU   4        WORK REGISTER                                   00360001
RSVRB    EQU   5        ADDRESS OF SVRB ON ENTRY FROM FREEDBUF   Y02072 00390002
RBUFFR   EQU   6        BUFFER ADDRESS                                  00400001
RSWA     EQU   6        PTR TO SEGMENT WORK AREA (ASSGNBUF)             00420001
RWORK6   EQU   6        WORK REGISTER                                   00440001
RDECB    EQU   7        DECB ADDRESS                                    00460001
RCCW     EQU   7        PTR TO CCW TO MODIFY (ASSGNBUF)                 00480001
RWORK7   EQU   7        WORK REGISTER                                   00500001
RTCB     EQU   8        TCB BASE REGISTER                        Y02072 00510002
RNEWLST  EQU   8        ADDR OF NEW UNSCHEDULED LIST                    00520001
RWORK9   EQU   9        WORK REGISTER                                   00540001
RWORK10  EQU   10       WORK REGISTER                                   00600001
RWORK11  EQU   11       WORK REGISTER                                   00640001
RWORK12  EQU   12       WORK REGISTER                                   00660001
RSAVE    EQU   13       ADDRESS OF IOS SAVEAREA                  Y02072 00710002
RWORK13  EQU   13       WORK REGISTER (EXTEND RTN)               Y02072 00712002
RRETURN  EQU   14       RETURN ADDRESS                                  00720001
RRETCODE EQU   15       RETURN CODE REGISTER                            00740001
RAPDBASE EQU   15       BASE REGISTER FOR APPENDAGE ROUTINES            00760001
RWORK15  EQU   15       WORK REGISTER                                   00780001
R15      EQU   15       SAVE/RESTORE REG                         Y02072 00790002
         SPACE 5                                                        00800001
KEYDATOP EQU   X'0E'         CCW OP-CODE  READ KEY & DATE               00820001
RDDATAOP EQU   X'06'         CCW OP-CODE  READ DATA                     00840001
NOP      EQU   X'03'         CCW OP-CODE                                00860001
SILI     EQU   BIT2          CCW FLAGS    SUPPRESS INCORRECT            00880001
*                                         LENGTH INDICATION             00900001
*                                                                       00920001
IC       EQU   B'0001'       MASK FOR ICM, INSERTS 1 BYTE INTO          00940001
*                            LOW ORDER BYTE OF REGISTER                 00960001
ADDR     EQU   B'0111'       MASK FOR ICM/STCM, INSERTS OR              00980001
*                            STORES A 24-BIT ADDRESS TO OR FROM         01000001
*                            THE LOW-ORDER 3 BYTES OF A REGISTER.       01020001
FIXERR   EQU   8             RETURN CODE IF GETMAIN FAILS FOR           01140001
*                            EXTEND FUNCTION                            01160002
*                                                                       01220001
         EJECT                                                          01240001
*                                                                       03480001
SIORTNE  EQU   *                                                        04300001
*                                                                     * 04320001
* FUNCTION:                                                           * 04340001
*    THE START-I/O APPENDAGE ATTEMPTS TO ASSIGN A BUFFER TO A         * 04360001
*    READ REQUEST IF THE REQUEST SPECIFIES DYNAMIC BUFFERING AND      * 04380001
*    NO BUFFER WAS ASSIGNED BEFORE EXCP.  IF A BUFFER IS              * 04400001
*    AVAILABLE FOR ASSIGNMENT, IT IS REMOVED FROM THE BUFFER          * 04420001
*    POOL AND THE BUFFER CHAIN IS UPDATED.  THE BUFFER ADDRESS        * 04440001
*    IS PLACED IN THE REQUEST'S DECB AND IN THE READ CCWS OF THE      * 04460001
*    REQUEST'S CHANNEL PROGRAM.  THE ADDRESS OF THE SEGMENT WORK      * 04480001
*    AREA (PART OF THE BUFFER) IS PLACED IN THE IOB.  THE ROUTINE     * 04500001
*    THEN RETURNS TO IOS TO INITIATE THE I/O.                         * 04520001
*    IF NO BUFFER IS AVAILABLE THE REQUEST IS PLACED ON A QUEUE       * 04540001
*    OF REQUESTS WAITING FOR BUFFERS.  THE ROUTINE TAKES THE IOS      * 04560001
*    RETURN WHICH INDICATES THAT THE I/O REQUEST SHOULD NOT BE        * 04580001
*    INITIATED.                                                       * 04600001
*    IF NO BUFFER IS AVAILABLE AND THE ADDRESS OF THE IOB FOR         * 04620001
*    THIS REQUEST CANNOT BE PLACED ON THE CURRENT UNSCHEDULED         * 04640001
*    LIST, THE CHANNEL PROGRAM IS MODIFIED TO PREVENT DATA            * 04660001
*    TRANSFER AND THE NORMAL RETURN TO IOS IS TAKEN.  THE             * 04680001
*    CHANNEL END APPENDAGE WILL SCHEDULE THE ASYNCHRONOUS             * 04700001
*    ROUTINE, WHICH WILL EXTEND THE UNSCHEDULED LIST IF NECES-        * 04720001
*    SARY, AND WILL RE-ISSUE THE EXCP.                                * 04740001
*                                                                     * 04760001
* ENTRY POINT:                                                        * 04780001
*         SIOEP -- ENTERED ASYNCHRONOUSLY FROM IOS AT START-I/O       * 04800001
*         TIME.  THE ADDRESS OF IGG019JB IS PLACED IN THE             * 04820001
*         APPENDAGE VECTOR TABLE (AVT) DURING OPEN PROCESSING.        * 04840001
*         CALLING SEQUENCE -- L     15,4(AVTPTR)                      * 04860001
*                             BALR  14,15                             * 04880001
*                                                                     * 04900001
* INPUT                                                               * 04920001
*    **** REGISTER CONTENTS ****                                      * 04940001
*    REGISTER  1 -- REQUEST QUEUE ELEMENT (RQE) ADDRESS               * 04950002
*    REGISTER  2 -- INPUT/OUTPUT BLOCK (IOB) ADDRESS                  * 04960001
*    REGISTER  3 -- DATA EXTENT BLOCK (DEB) ADDRESS                   * 04980001
*    REGISTER  4 -- DATA CONTROL BLOCK (DCB) ADDRESS                  * 05000001
*    REGISTER  7 -- UNIT CONTROL BLOCK (UCB) ADDRESS                  * 05020001
*    REGISTER 13 -- IOS REGISTER SAVEAREA                       Y02072* 05030002
*    REGISTER 14 -- RETURN ADDRESS                                    * 05040001
*    REGISTER 15 -- ADDRESS OF IGG019JB                               * 05060001
*                                                                     * 05080001
* OUTPUT                                                              * 05100001
*    **** REGISTER CONTENTS ****                                      * 05120001
*    ALL REGISTER CONTENTS ARE UNCHANGED                              * 05140002
*                                                                     * 05240001
*    **** DATA AREAS SET BY THIS ROUTINE ****                         * 05260001
*    IOBSWAP            IF A BUFFER IS ASSIGNED, SEGMENT WORK         * 05280001
*                       AREA ADDRESS                                  * 05300001
*    IOBDSTAT BIT IOBBUFF    SET IF A BUFFER IS ASSIGNED              * 05320001
*    IOBDQSW,IOBDQCP    SET IF NO BUFFER IS AVAILABLE & THERE IS      * 05340001
*                       NO ROOM ON THE CURRENT UNSCHEDULED LIST       * 05360001
*                       FOR THE IOB ADDRESS. -- CHANNEL PGM MODIFIED  * 05380001
*    USLBFRQB           UPDATED IF REQUEST IS PLACED ON QUEUE         * 05400001
*                       TO WAIT FOR BUFFER                            * 05420001
*    USLBFRQT           UPDATED IF THIS REQUEST IS THE ONLY ONE ON    * 05440001
*                       THE QUEUE WAITING FOR A BUFFER.               * 05460001
*    BCBBFAVL           UPDATED IF A BUFFER IS ASSIGNED               * 05480001
*    DECAREA            DATA ADDR IN THE ASSIGNED BUFFER              * 05500001
*    DECKYADR           KEY ADDR IN THE ASSIGNED BUFFER FOR A READ    * 05520001
*                       BY BLOCK ID, & KEY ADDR SPECIFIED 'S'.        * 05540001
*    DECARB1            SAVEAREA FOR OP-CODE OF CCW1 IF CHANNEL       * 05560001
*                       PROGRAM IS MODIFIED.                          * 05580001
*    DECARB2            SAVEAREA FOR FLAGS OF CCW1 IF CHANNEL         * 05600001
*                       PROGRAM IS MODIFIED.                          * 05620001
*    NEXT-TO-LAST CCW ADDR   KEY ADDR WHEN KEY IS IN DYNAMIC BUFFER   * 05640001
*                            (SEE DECKYADR).                          * 05660001
*    LAST CCW ADDR      DATA ADDR                                     * 05680001
*                                                                     * 05700001
* EXITS                                                               * 05720001
*         0(R14)        RETURN TO IOS & START I/O                     * 05740001
*         4(R14)        RETURN TO IOS & DISREGARD I/O REQUEST         * 05760001
*                                                                     * 05780001
* ATTRIBUTES -- REENTRANT,PRIVILEGED,KEY=0,ENABLED, WITH THE LOCAL    * 05800002
*    LOCK HELD. MODESET IS ISSUED TO PROCESS IN USER KEY.             * 05810002
*********************************************************************** 05820002
****                                                               **** 05900002
         USING IOBSTDRD,RIOB                                            05920001
         USING IHADCB,RDCB                                              05940001
         TM    IOBDTYP2,IOBRQUST  IS THIS A READ REQUEST?               05952002
         BCR   8,RRETURN          IF NOT, RETURN TO IOS                 05954002
         TM    IOBDTYPE,IOBDYNBF  DOES REQUEST SPECIFY DYNAMIC          05956002
*                                 BUFFERING?                            05958002
         BCR   8,RRETURN          IF NO, RETURN TO IOS                  05958402
         TM    IOBSTAT1,IOBBUFF   HAS A BUFFER BEEN ASSIGNED TO         05958802
*                                 THIS REQUEST?                         05959202
         BCR   1,RRETURN          IF SO, RETURN TO IOS                  05959602
*                                                                       06020001
*                       IF A BUFFER IS AVAILABLE, ASSIGN IT TO          06040001
*                       THIS REQUEST AND UPDATE THE BUFFER POOL.        06060001
*                                                                       06080001
         STM   R0,R15,0(RSAVE)          SAVE IOS REGISTERS       Y02072 06090002
         USING RQE,RRQE                 ESTABLISH RQE BASE       Y02072 06092002
*                                                                       06094002
         MODESET  KEYADDR=RQEPRT,WORKREG=10  CHANGE TO USER KEY  Y02072 06096002
*                                                                       06098002
         L     RWORK10,DCBBUFCB         GET BUFFER CONTROL BLOCK ADDR   06100002
         USING BCBDEFV,RWORK10          ESTABLISH BASE FOR BCB   Y02072 06120002
         SR    RWORK11,RWORK11                                          06140001
         ICM   RWORK11,IC,BCBBFAVL      GET BUFFER NUMBER FOR NEXT      06160002
*                                       AVAILABLE BUFFER                06180002
         BZ    PTONBUFQ           IF NONE AVAILABLE, BRANCH TO          06200001
*                                 PUT REQUEST ON QUEUE                  06220001
         IC    RWORK9,BCBSUFFX-1(RWORK11)   GET NUMBER OF 2ND           06240001
*                                 AVAILABLE BUFFER.                     06260001
         STC   RWORK9,BCBBFAVL    MAKE IT THE NEXT AVAILABLE            06280001
*                                                                       06300001
*                                 COMPUTE ADDR OF THE BUFFER TO         06320001
*                                 BE ASSIGNED.                          06340001
*                                                                       06360001
         BCTR  RWORK11,0          BUFFER NUMBER - 1.                    06380001
         L     RWORK7,BCBBUFL     LENGTH OF EACH BUFFER                 06420001
         MR    RWORK6,RWORK11     BUFFER # -1 * BUFFER LENGTH           06440001
*                                 = DISPLACEMENT INTO BUFFER POOL       06460001
         LR    RWORK11,RWORK7                                           06480001
         A     RWORK11,BCBBUF1    + ADDR OF BUFFER #1 = BUFFER          06500001
*                                 ADDR.                                 06520001
         DROP  RWORK10,RRQE                                      Y02072 06540002
         BAL   RLINK,ASSGNBUF     ASSIGN BUFFER TO REQUEST              06560001
*                                                                       06600001
SIORET   EQU   *                        RETURN TO IOS            Y02072 06610002
*                                                                       06612002
         MODESET  KEYADDR=IOSKEY,WORKREG=10  CHANGE TO IOS KEY   Y02072 06614002
*                                                                       06616002
         LM    R0,R15,0(RSAVE)          LOAD IOS REGISTERS       Y02072 06618002
         BR    RRETURN                  RETURN TO IOS TO INITIATE       06618402
*                                       I/O REQUEST                     06618802
         SPACE 5                                                        06680001
PTONBUFQ EQU   *                                                        06700001
*                                                                       06720001
*                       NO BUFFER WAS AVAILABLE. PUT THIS IOB ON        06740001
*                       THE QUEUE WAITING FOR BUFFERS.                  06760001
*                                                                       06780001
*                                                                       06820001
         L     RWORK11,DCBDYNB    ADDR OF CURRENT LIST                  06840001
         USING USL,RWORK11                                              06860001
*                                                                       07080001
*                       PUT IOB ADDR ON THE UNSCHEDULED LIST            07100001
*                                                                       07120001
         L     RWORK10,USLBFRQB   ADDR OF LAST LIST SLOT USED           07140002
         LTR   RWORK10,RWORK10    ANY USED?                             07160001
         BZ    EMPTYQ             BRANCH IF NONE                        07180001
         USING USLSLOT,RWORK10                                          07200001
         TM    USLSLTFL,USLENDL   IS LAST ONE END OF LIST ?             07220001
         BZ    BUMP               BRANCH IF NOT                         07240001
         LA    RWORK10,USLSLOT1-4 LOOP TO POINT TO 1ST SLOT             07260001
BUMP     LA    RWORK10,USLNXT     POINT TO NEXT SLOT                    07280001
         TM    USLSLTFL,USLINUSE  IS THIS SLOT ALREADY IN USE?          07300001
         BO    RECOUP             BRANCH YES, LIST IS FULL              07320001
*                                                                       07340001
STIOBADR ST    RWORK10,USLBFRQB   THIS SLOT IS LAST USED                07360001
         STCM  RIOB,ADDR,USLIOBA+1     PLACE IOB ADDR IN SLOT           07380001
         OI    USLSLTFL,USLINUSE  MARK SLOT NOT AVAILABLE               07400001
         DROP  RWORK10                                                  07402002
*                                                                       07410002
         MODESET  KEYADDR=IOSKEY,WORKREG=10  CHANGE TO IOS KEY   Y02072 07430002
*                                                                       07432002
         LM    R0,R15,0(RSAVE)          LOAD IOS REGISTERS       Y02072 07434002
         B     4(RRETURN)               IOS RETURN - DON'T DO I/O       07440002
*                                                                       07460001
EMPTYQ   LA    RWORK10,USLSLOT1   USE FIRST SLOT ON LIST                07480001
*                                 TOP SLOT IS FIRST ON QUEUE            07500001
         STCM  RWORK10,ADDR,USLBFRQT+1                                  07520001
         B     STIOBADR                                                 07540001
         DROP  RWORK11                                                  07580001
*                                                                       07600001
*                       THE IOB ADDRESS CANNOT BE PLACED ON THE         07620001
*                       CURRENT UNSCHEDULED LIST BECAUSE THE            07640002
*                       LIST IS FULL.                                   07680001
*                       MODIFY THE CHANNEL PROGRAM SO THAT NO           07700001
*                       DATA IS TRANSFERRED. THE CHANNEL                07720001
*                       PROGRAM WILL BE REPAIRED AND THE EXCP           07740001
*                       WILL BE REISSUED BY THE ASI ROUTINE.            07760001
*                                                                       07780001
RECOUP   L     RWORK10,IOBECBPT   GET DECB ADDRESS                      07800001
         USING DECB,RWORK10                                             07820001
         IC    RWORK9,IOBCHNPR    SAVE OP-CODE OF CCW1                  07840001
         STC   RWORK9,DECARB1                                           07860001
         MVI   IOBCHNPR,NOP       SET OP-CODE TO NOP                    07880001
         IC    RWORK9,IOBCHNPR+4  SAVE FLAGS OF CCW1                    07900001
         STC   RWORK9,DECARB2                                           07920001
         MVI   IOBCHNPR+4,SILI    SUPPRESS INCORRECT LENGTH FLAG        07940001
         OI    IOBDQSW,IOBDQCP    CHANNEL PGM HAS BEEN ALTERED          07960001
         B     SIORET             TAKE NORMAL IOS RETURN                07980001
*                       (MUST GET TO CEA TO SCHEDULE ASI)               08000001
         DROP  RWORK10                                                  08020001
         DROP  RIOB                                                     08040001
         DROP  RDCB                                                     08060001
*                                                                       08080001
         EJECT                                                          08120001
*                                                                       08140001
*                  THIS SUBROUTINE IS USED BY THE START-I/O             08160001
*                  APPENDAGE AND THE FREE DYNAMIC BUFFER SVC            08180001
*                  ROUTINE. IT IS ENTERED IN USER KEY.                  08200002
*                  IT ASSIGNS A BUFFER TO AN I/O REQUEST BY             08220001
*                  PLACING THE BUFFER ADDRESS INTO THE DECB             08240001
*                  AND THE CHANNEL PROGRAM.  IT ALSO PLACES THE         08260001
*                  SEGMENT WORK AREA ADDRESS IN THE IOB.                08280001
*                                                                       08300001
*              REGISTER INPUT:  RIOB    - ADDR OF IOB TO WHICH          08320001
*                                         BUFFER WILL BE ASSIGNED       08340002
*                               RDCB    - DCB ADDRESS                   08360001
*                               RWORK11 - BUFFER ADDRESS                08380001
*                               RLINK   - RETURN ADDRESS                08400001
*              REGISTER OUTPUT: RSWA    - WORK REGISTER                 08420001
*                               RWORK9  - WORK REGISTER                 08440001
*                               RCCW    - WORK REGISTER                 08460001
*                               RWORK10 - WORK REGISTER                 08480001
*                               RWORK11 - WORK REGISTER                 08500001
         USING SWA,RWORK11        ESTABLISH BASE FOR SEG WRKAREA Y02072 08520002
         USING IHADCB,RDCB                                              08540001
         USING IOBSTDRD,RIOB                                            08560001
ASSGNBUF L     RWORK9,IOBECBPT    GET DECB ADDRESS                      08580001
         USING DECB,RWORK9                                              08600001
*                                 PLACE SWA ADDR IN IOB                 08620001
         LR    RWORK10,RIOB       PLACE IOB ADDRESS IN WORK REG         08640001
         LA    RSWA,IOBSTDRD-IOBSWAP   DISP TO IOBSWAP FIELD            08660001
         SR    RWORK10,RSWA       POINT TO IOB PREFIX                   08680001
         USING IOBSWAP,RWORK10                                          08700001
         ST    RWORK11,IOBSWAP    PLACE SWA ADDR IN IOB                 08720001
*                                 DATA & KEY (IF REQUESTED) WILL        08740001
*                                 BE READ INTO THE SEGMENT AREA         08760001
*                                 OF THE DYNAMIC BUFFER.  THE           08780001
*                                 USER WILL BE PASSED THE ADDRESS       08800001
*                                 OF LOCATIONS IN THE RECORD            08820001
*                                 AREA.                                 08840001
*                                                                       08860001
         LA    RSWA,SWASEGMT      GET ADDRESS OF SEGMENT AREA    Y02072 08880002
*                                                                       08900001
         L     RWORK10,DCBBUFCB   ADDRESS BUFFER CONTROL BLOCK          08920001
         USING BCBDEFV,RWORK10    ESTABLISH BASE FOR BCB         Y02072 08940002
         L     RWORK10,BCBRAOFS-1 GET DISPLACEMENT OF RECORD            08960001
         DROP  RWORK10            AREA FROM START OF BUFFER.            08980001
         LA    RWORK11,0(RWORK10,RWORK11)        ADDR OF RECORD AREA    09000001
*                                                                       09020001
         L     RCCW,IOBDCPND      POINT BEYOND LAST CCW                 09040001
         SH    RCCW,H16           POINT TO NEXT-TO-LAST CCW             09060001
*                                 FOR A READ BY BLOCK ID, KEY           09080001
*                                 CODED 'S', THE KEY IS READ            09100001
*                                 INTO THE DYNAMIC BUFFER.              09120001
         TM    IOBDTYP2,IOBTYPE   IS THIS READ BY BLOCK ID?             09140001
         BO    FILLSCCW           BRANCH IF NO                          09160001
         TM    IOBDTYP2,IOBSKEY   WAS KEY ADDRESS CODED 'S'?            09180001
         BZ    FILLSCCW           BRANCH IF NO                          09200001
         ST    RWORK11,DECKYADR   PLACE KEY ADDRESS IN DECB             09220001
         CLI   DCBKEYLE,0         IS KEY LENGTH ZERO             XM1559 09230002
         BE    FILLSCCW           BR IF YES                      XM1559 09232002
         ST    RWORK11,0(RCCW)    PLACE ADDR OF KEY IN RECORD   XA00093 09240001
*                                 AREA INTO NEXT-TO-LAST CCW.           09260001
         MVI   0(RCCW),KEYDATOP   RESTORE OP-CODE                       09280001
*                                 INCREMENT RECORD AREA & SEGMENT       09300001
*                                 AREA POINTERS BEYOND KEY.             09320001
         SR    RWORK10,RWORK10                                          09340001
         IC    RWORK10,DCBKEYLE   GET LENGTH OF KEY                     09360001
         AR    RWORK11,RWORK10    BUMP RECORD AREA POINTER              09380001
*                                                                       09420001
FILLSCCW ST    RWORK11,DECAREA    PLACE DATA ADDRESS IN DECB            09440001
         ST    RSWA,8(RCCW)       PLACE DATA ADDRESS IN LAST CCW        09460001
         MVI   8(RCCW),RDDATAOP   RESTORE OP-CODE.                      09480001
         OI    IOBDSTAT,IOBBUFF   SET BUFFER-ASSIGNED SWITCH            09500001
         BR    RLINK              RETURN TO CALLER                      09520001
         DROP  RWORK11                                                  09540001
         DROP  RWORK9                                                   09560001
         DROP  RIOB                                                     09580001
         DROP  RDCB                                                     09600001
         EJECT                                                          09620001
FBUFRTNE EQU   *                                                        09640001
*                                                                     * 09660001
* FUNCTION:                                                           * 09680001
*    THE FREE DYNAMIC BUFFER ROUTINE RELEASES A DYNAMIC BUFFER.       * 09700001
*    IF ANY IOBS ARE ON THE UNSCHEDULED QUEUE (WAITING FOR A          * 09720001
*    BUFFER) THE ROUTINE ASSIGNS THE BUFFER TO THE FIRST IOB ON       * 09740001
*    THE QUEUE, AND ISSUES AN EXCP FOR THAT IOB.  IF NO IOBS ARE      * 09760001
*    ON THE UNSCHEDULED QUEUE THE ROUTINE PLACES THE BUFFER ON        * 09780001
*    THE CHAIN OF AVAILABLE BUFFERS.                                  * 09800001
*    THE EXTEND-LIST FUNCTION IS ALSO CALLED VIA THE FREE DYNAM-      * 09820001
*    IC BUFFER SVC.  IT GETS STORAGE FOR AN UNSCHEDULED LIST          * 09840001
*    WHICH IS TWICE AS LARGE AS THE PREVIOUS LIST.  IT INITIALIZES    * 09860001
*    THE NEW LIST (AND MOVES ALL ENTRIES FROM THE OLD LIST TO         * 09880001
*    THE NEW LIST) AND PLACES ITS ADDRESS IN DCBDYNB.                 * 09900001
*                                                                     * 09920001
* ENTRY POINT:                                                        * 09940001
*         FRBUFEP -- ENTERED FROM MODULE IGC0005G WHEN SVC 57 IS      * 09960001
*         ISSUED FOR A DCB WHICH SPECIFIED DIRECT ORGANIZATION.       * 09980001
*         CALLING SEQUENCE -- L    15,DCBDEBAD                        * 10000001
*                             L    15,DEBAPPAD                        * 10020001
*                             L    15,4(15)                           * 10040001
*                             BAL  14,8(15)                           * 10060001
*                                                                     * 10080001
* INPUT                                                               * 10100001
*    **** REGISTER CONTENTS ****                                      * 10120001
*    REGISTER  0 -- DECB ADDRESS                                      * 10140001
*                  R0 IS NEGATIVE FOR THE EXTEND-LIST FUNCTION.       * 10160001
*    REGISTER  1 -- DCB ADDRESS                                       * 10180001
*    REGISTER  5 -- ADDRESS OF SVRB                                   * 10190002
*    REGISTER  8 -- ADDRESS OF TCB PASSED BY FREEDBUF                 * 10192002
*    REGISTER 14 -- RETURN ADDRESS                                    * 10220001
*    REGISTER 15 -- ADDRESS OF IGG019JB                               * 10240001
*                                                                     * 10260001
* OUTPUT                                                              * 10280001
*    **** REGISTER CONTENTS ****                                      * 10300001
*    ALL REGISTERS EXCEPT REGISTER 14 CAN BE USED WITHOUT SAVING      * 10320001
*    OR RESTORING CONTENTS.                                           * 10340001
*    REGISTER 15 CONTAINS RETURN CODE.                                * 10360001
*                                                                     * 10380001
*    **** DATA FIELDS SET BY THIS ROUTINE ****                        * 10400001
*    USLBFRQT      IF AN IOB IS WAITING FOR A BUFFER, PTR TO 1ST      * 10420001
*                  IOB ON QUEUE IS UPDATED.                           * 10440001
*    USLBFRQB      IF, AFTER 1 IOB IS DEQUEUED, THE LIST IS EMPTY,    * 10460001
*                  USLBFRQB IS SET TO ZERO.                           * 10480001
*    IF THE FREED BUFFER IS ASSIGNED TO A WAITING REQUEST, THE        * 10500001
*    BUFFER ADDRESS IS PLACED IN THE CHANNEL PROGRAM AND DECB         * 10520001
*    FIELDS, AND IN THE IOB AS THE SEGMENT WORK AREA ADDRESS (SEE     * 10540001
*    SIORTNE DESCRIPTION FOR DETAILS).                                * 10560001
*    SWABFINC      SET TO ZERO                                        * 10580002
*    BCBBFAVL      IF THE BUFFER IS NOT ASSIGNED TO A REQUEST,        * 10600001
*                  ITS NUMBER IS PLACED IN BCBBFAVL.  THE             * 10620001
*                  CORRESPONDING BYTE OF THE BUFFER POOL SUFFIX       * 10640001
*                  WILL POINT TO THE SECOND AVAILABLE BUFFER.         * 10660001
*    DCBDYNB       FOR THE EXTEND FUNCTION, POINTS TO NEW LIST.       * 10680001
*            THE LIST IS INITIALIZED AS FOLLOWS:                      * 10700002
*    USLSIZE       LIST SIZE IN BYTES -- 2* OLD LIST SIZE             * 10720001
*    USLFLAGS      BIT USLCURNT SET IN NEW LIST, TURNED OFF IN        * 10740001
*                  OLD LIST.                                          * 10760001
*    USLBFRQT      THE IOB ADDRESSES ARE ARRANGED SUCH THAT THE       * 10780001
*                  ADDR OF THE 1ST IOB ON THE OLD LIST IS COPIED      * 10800001
*                  INTO THE TOP SLOT ON THE NEW LIST.  IF NO          * 10820001
*                  IOBS ARE ON THE LIST, SET TO ZERO.                 * 10840001
*    USLBFRQB      ADDR OF SLOT USED BY LAST IOB ON QUEUE (OR 0       * 10860001
*                  IF THERE ARE NONE.)                                * 10880001
*    USLCHAIN      ADDRESS OF PRIOR LIST COPY                         * 10900001
*    IOBDQSW, BIT IOBDQEXT   RESET ON COMPLETION OF EXTEND            * 10920001
*    SVRB          SEE BELOW                                            10930002
*                                                                     * 10940001
* EXTERNAL REFERENCES                                                 * 10960001
*        EXCP CALL TO IOS                                             * 10980001
*        GETMAIN FOR NEW UNSCHEDULED LIST (EXTEND FUNCTION)           * 11000001
*        MODESET   TO CHANGE BETWEEN SUPERVISOR AND USER KEYS         * 11020002
*        SETLOCK   TO RELEASE AND OBTAIN THE LOCAL LOCK               * 11030002
*                                                                     * 11140001
* EXITS, NORMAL                                                       * 11160001
*    BRANCH RETURN TO IGC0005G ON REGISTER 14.  RETURN CODE (R15)     * 11180001
*    = 0.                                                             * 11200001
*                                                                     * 11220001
* EXITS, ERROR                                                        * 11240001
*     BRANCH RETURN TO IGC0005G ON REGISTER 14.  RETURN CODE (R15)    * 11260001
*     = 8.  THE BUFFER HAS NOT BEEN FREED, OR THE UNSCHEDULED         * 11280001
*     LIST HAS NOT BEEN EXTENDED.  THIS CAN OCCUR AS A RESULT OF      * 11300001
*     GETMAIN FOR THE NEW UNSCHEDULED LIST CANNOT BE SATISFIED.       * 11340002
*                                                                     * 11380001
* TABLES / WORK AREAS                                                 * 11400001
*        IOB, DCB, DECB, BUFFER CONTROL BLOCK                         * 11420001
*        UNSCHEDULED LIST, & SVRB EXTENDED SAVEAREA                   * 11440001
*                                                                     * 11460001
* ATTRIBUTES -- REENTRANT, PRIVILEGED. ENTRY IS IN SUPERVISOR KEY     * 11480002
*        WITHOUT THE LOCAL LOCK HELD. RETURN TO IGC0005G IS IN        * 11490002
*        SUPERVISOR KEY. MOST PROCESSING IS IN USER KEY.              * 11500002
*                                                                     * 11512002
* NOTES -- THE ROUTINE MUST HAVE THE LOCAL LOCK TO UPDATE THE SERIALLY* 11520002
*        REUSABLE IOB AND BUFFER QUEUES. SETLOCK WILL BE ISSUED THEN. * 11540002
*                                                                     * 11640001
*****                                                             ***** 11650002
         EJECT                                                          11686602
         LR    RBASE3,RAPDBASE    ESTABLISH BASE REGISTER               11720001
         USING IGG019JB,RBASE3                                          11740001
         DROP  RAPDBASE                                                 11760001
         LR    RDCB,R1            TRANSFER DCB ADDRESS                  11780001
         USING IHADCB,RDCB                                              11800001
         USING RBSECT,RSVRB       ESTABLISH BASE FOR SVRB        Y02072 11810002
         ST    RRETURN,WKAREG14   SAVE RETURN REGISTER                  11810402
         USING TCB,RTCB           ESTABLISH BASE FOR TCB         Y02072 11814002
*                                 PASSED BY FREEDBUF IN R8       Y02072 11816002
*                                                                       11818002
         MODESET  KEYADDR=WKASVKEY,WORKREG=6  CHANGE TO USER KEY Y02072 11818402
*                                                                       11818802
         LTR   RDECB,R0           TEST FOR SPECIAL FUNCTION             11820002
         BNP   EXTEND             BRANCH YES                            11840001
         USING DECB,RDECB                                               11860001
*                                                                       11880001
*                       LOCATE THE BEGINNING ADDRESS OF THE             11900001
*                       BUFFER BEING FREED.                             11920001
*                                                                       11940001
         L     RBUFFR,DECAREA     ASSUME RECORD AREA ADDR = DATA        11960001
*                                 ADDR                                  11980001
         TM    DECTYPE2,DECKEYS   WAS KEY IN BUFFER (CODED 'S')?        12000001
         BZ    FBU0500            BRANCH NO                             12020001
         L     RBUFFR,DECKYADR    RECORD AREA ADDR = KEY ADDR           12040001
FBU0500  EQU   *                                                        12060001
         LA    RWORK12,BUFRECAR-BUFBFPTR                                12080001
         SR    RBUFFR,RWORK12     POINT TO ADDR OF BEGINNING OF         12100001
*                                 BUFFER                                12120001
         L     RBUFFR,0(RBUFFR)         GET BUFFER ADDRESS              12140002
         USING SWA,RBUFFR               ESTABLISH BASE FOR SWA   Y02072 12160002
         XC    SWABFINC,SWABFINC        RECORD AREA OFFSET PTR   Y02072 12180002
         L     RWORK10,DCBDYNB          ADDR OF UNSCHEDULED LIST Y02072 12190002
         USING USL,RWORK10              USL ADDRESSABILITY       Y02072 12192002
         L     RWORK12,DCBBUFCB         GET BCB ADDRESS          Y02072 12194002
         USING  BCBDEFV,RWORK12         BCB ADDRESSABILITY       Y02072 12196002
*                                                                       12200001
*   PREPARE FOR QUEUE UPDATES. THIS REQUIRES THAT THE LOCAL LOCK BE     12220002
*   OBTAINED WHILE MANIPULATING THE QUEUE. IT IS RELEASED WHEN THE      12240002
*   QUEUE HAS BEEN UPDATED AND THE NEXT WAITING IOB HAS BEEN REMOVED,   12250002
*   OR THE BUFFER HAS BEEN PUT BACK ON THE AVAILABLE BUFFER QUEUE.      12260002
*   MODESET IS ISSUED BECAUSE SETLOCK REQUIRES SUPERVISOR KEY.          12270002
*   SETLOCK USES REGISTERS 11-14 WITHOUT RESTORING THEM. CERTAIN        12280002
*   FIELDS WILL BE SAVED AT THIS POINT SHOULD THE ESTAE NEED THEM.      12282002
*                                                                       12290002
         IC    RWORK9,BCBBFAVL          GET NEXT AVAIL BUF NO    Y02072 12300002
*                                       FOR ESTAE- 1 BYTE        Y02072 12310002
         DROP  RWORK12                  DROP BCB BASE            Y02072 12320002
         L     RWORK0,USLBFRQT          GET USL CONTENTS FOR     Y02072 12330002
*                                       ESTAE - IN USER KEY      Y02072 12332002
*                                                                       12334002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 12336002
*                                       TO GET THE LOCAL LOCK    Y02072 12338002
*                                                                       12338402
GETLOCK  SETLOCK  OBTAIN,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019JB(FREELOCKX12338802
               ,FREELCK1)'),MODE=UNCOND  GET THE LOCAL LOCK      Y02072 12339202
*                                                                       12339602
         ST    RBUFFR,WKABUFRG          SAVE BUF PTR FOR ESTAE   Y02072 12339702
         ST    RWORK0,WKASAVE           SAVE USL CONTENT IN SVRB Y02072 12339802
         STC   RWORK9,WKASAVE2          SAVE NEXT AVAIL BUF NO.  Y02072 12339902
*                                       FOR ESTAE IN CASE PATH   Y02072 12343202
*                                       TAKEN CHANGES THIS       Y02072 12345202
*                                                                       12345602
         MODESET  KEYADDR=WKASVKEY,WORKREG=11 RET TO USER KEY    Y02072 12346002
*                                                                       12346402
         ICM   RWORK9,ADDR,USLBFRQT+1   PTR TO 1ST IOB ON QUEUE         12680001
         BZ    FBUNOREQ                 BRANCH IF NO IOBS TO MAKE       12700002
*                                       BUFFER AVAILABLE                12720002
         USING USLSLOT,RWORK9                                           12740001
         L     RIOB,USLSLOT             GET IOB ADDRESS                 12760002
         USING IOBSTDRD,RIOB                                            12780001
*                                                                       12790002
         MODESET  EXTKEY=ZERO           CHANGE TO ZERO KEY       Y02072X12792002
                                        TO SAVE IOB PTR          Y02072 12794002
         ST    RIOB,WKAIOBRG            SAVE IOB PTR FOR ESTAE   Y02072 12798002
*                                                                       12798402
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 12798802
*                                                                       12799202
         NI    USLSLTFL,X'FF'-USLINUSE  MAKE SLOT AVAILABLE             12800001
         TM    USLSLTFL,USLENDL   IS THIS LAST SLOT IN LIST?            12820001
         BZ    NXTSLT             BRANCH IF NO                          12840001
         LA    RWORK9,USLSLOT1-4 GET BACK TO TOP OF LIST                12860001
NXTSLT   LA    RWORK9,USLNXT      BUMP SLOT POINTER 1 ENTRY             12880001
         TM    USLSLTFL,USLINUSE  IS THERE ANOTHER IOB WAITING?         12900001
         BO    STOREPTR           BRANCH IF YES                         12920001
         DROP  RWORK9                                                   12930002
         SR    RWORK9,RWORK9                                            12940001
         ST    RWORK9,USLBFRQB          MARK QUEUE EMPTY BY SETTING     12980002
*                                       TOP & BOTTOM PTRS TO ZERO.      13000002
STOREPTR STCM  RWORK9,ADDR,USLBFRQT+1   SLOT OF FIRST IOB (OR 0)        13020002
         DROP  RWORK10                                           Y02072 13030002
*                                                                       13040001
         MODESET  EXTKEY=ZERO           CHANGE TO ZERO KEY       Y02072X13050002
                                        TO SET BIT IN SVRB       Y02072X13052002
                                        AND RELEASE LOCAL LOCK   Y02072 13052102
         MVI   WKATRAIL,WKAIOBQ         SET BIT IN SVRB EXT SAVE Y02072 13052602
*                                       AREA INDICATING IOB DEQ  Y02072 13052702
*                                                                       13053402
FREELOCK SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019JB(GETLOCKX13053702
               )')                      FREE THE LOCAL LOCK      Y02072 13053802
*                                                                       13055802
ESTENTA  EQU   *                        ESTAE ENTRY IF WKAIOBQ=1 Y02072 13056002
*                                                                       13056402
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 13058002
*                                                                       13058402
         LR    RAPDBASE,RBASE3          LOAD BASE FOR COMMON SUBRTNE    13140002
         LR    RWORK11,RBUFFR           PUT BUFFER ADDR IN R11          13160002
         BAL   RLINK,ASSGNBUF           ASSIGN THE BUFFER TO THE        13220002
*                                       DEQUEUED IOB.                   13240002
*                                                                       13254002
         MODESET  EXTKEY=ZERO           CHANGE TO ZERO KEY       Y02072X13256002
                                        TO SET BIT IN SVRB       Y02072 13258002
         MVI   WKATRAIL,WKABUFAS        SET BIT IN SVRB EXTENDED Y02072 13258402
*                                       SAVEAREA INDICATING BUF  Y02072 13258802
*                                       ASSIGNED TO NEXT IOB     Y02072 13259202
ESTENTB  EQU   *                        ESTAE ENTRY IF WKABUFAS  Y02072 13259302
*                                       BIT IS ON                Y02072 13259402
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 13259602
*                                                                       13259702
         L     RWORK11,IOBECBPT         LOAD ADDR TO USER'S DECB Y02072 13259802
         ST    RWORK11,IOBDQPTR         SAVE DECB ADDR IN IOB    Y02072 13259902
         LA    RWORK11,IOBCSW+3         SET UP CSW ADDRESS TO    Y02072 13266602
         ST    RWORK11,IOBECBPT         USE AS DUMMY ECB FOR IOS Y02072 13268602
*                                       CEA OR EOE WILL RESTORE  Y02072 13270602
*                                       USER'S DECB ADDR IN IOB  Y02072 13272602
*                                                                       13283902
         EXCP  (RIOB)                   SCHEDULE I/O FOR NEXT IOB ON Q  13299202
*                                                                       13299602
         MODESET  EXTKEY=ZERO           RETURN TO ZERO KEY       Y02072 13299702
*                                                                       13299802
         MVI   WKATRAIL,WKAEXCP         SET BIT INDICATING EXCP  Y02072 13308502
*                                                                       13310502
         B     NORMEXIT                 NORMAL RET TO IGC0005G   Y02072 13333402
         SPACE 5                                                        13360001
*                                                                       13380001
*     NO IOBS ARE WAITING FOR BUFFERS. RETURN BUFFER TO AVAILABLE       13400002
*     BUFFER QUEUE.  THIS ROUTINE IS ENTERED IN USER KEY WITH THE       13420002
*     LOCAL LOCK HELD. RETURN TO FREEDBUF FROM THIS ROUTINE IS IN       13430002
*     SUPERVISOR KEY.                                                   13432002
*                                                                       13440001
FBUNOREQ L     RWORK12,DCBBUFCB   ADDR OF BUFFER CONTROL BLOCK   Y02072 13460002
         USING BCBDEFV,RWORK12    ESTABLISH BASE FOR BCB         Y02072 13480002
*                                                                       13500001
*                 COMPUTE BUFFER NUMBER FROM BUFFER ADDRESS             13520002
*                                                                       13540001
         LR    RWORK1,RBUFFR      BUFFER ADDRESS                        13560001
         S     RWORK1,BCBBUF1     MINUS ADDR OF 1ST BUFFER              13580001
*                                  = DISP INTO BUFFER POOL              13600001
         SR    RWORK0,RWORK0                                            13620001
         L     RWORK11,BCBBUFL                                          13640001
         DR    RWORK0,RWORK11     DIVIDED BY BUFFER LENGTH              13660001
*                                  = BUFFER NUMBER -1.                  13680001
         LA    RWORK1,1(RWORK1)   PLUS 1 = BUFFER NUMBER                13700001
*                                                                       13720001
*                      PLACE BUFFER # ON AVAILABLE CHAIN                13740001
*                                                                       13760001
         IC    RWORK9,BCBBFAVL    NEXT AVAIL BUFFER #                   13780001
         STC   RWORK9,BCBSUFFX-1(RWORK1)    POINT CHAIN ENTRY           13800001
*                                 FOR THIS BUFFER TO IT                 13820001
         STC   RWORK1,BCBBFAVL    MAKE THIS BUFFER NEXT AVAIL           13840001
*                                                                       13860001
*             RELEASE LOCAL LOCK AND SET AUDIT TRAIL BIT                13880002
*                                                                       13950002
         MODESET  EXTKEY=ZERO           CHANGE TO ZERO KEY       Y02072X13960002
                                        TO SET BIT IN SVRB       Y02072X13970002
                                        AND RELEASE LOCK         Y02072 13970402
         MVI   WKATRAIL,WKABUFQ         SET BIT INDICATING BUF   Y02072 13970802
*                                       FREED AND PUT ON QUEUE   Y02072 13971202
*                                                                       13972002
FREELCK1 SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019JB(GETLOCKX13974002
               )')                      FREE THE LOCAL LOCK      Y02072 13974402
*                                                                       13984402
         B     NORMEXIT                 NORMAL RETURN TO IGC0005G       14000002
*                                                                       14020001
         EJECT                                                          15460001
EXTEND   EQU   *                                                        15480001
*                                                                       15500001
*                  THIS FUNCTION IS ONLY CALLED FROM THE                15520001
*                  ASYNCHRONOUS ROUTINE AND THUS IT WOULD BE            15540001
*                  IMPOSSIBLE FOR A SECOND EXTEND REQUEST TO BE         15560001
*                  ISSUED ON A GIVEN DCB BEFORE THE FIRST               15580001
*                  REQUEST COMPLETED. IT IS ENTERED IN USER KEY         15600002
*                  AND EXITS IN SUPERVISOR KEY.                         15610002
*                                                                       15620001
*                  GET STORAGE FOR AN UNSCHEDULED LIST TWICE AS         15640001
*                  LARGE AS THE CURRENT ONE.                            15660001
*                                                                       15680001
         LPR   RDECB,RDECB        GET DECB ADDR (UNCOMPLEMENTED)        15700001
         L     RWORK10,DCBDYNB    GET ADDR OF CURRENT UNSCHED-   Y02072 15760002
         USING USL,RWORK10        ULED LIST.                     Y02072 15780002
         LH    RWORK11,USLSIZE    SIZE OF CURRENT LIST           Y02072 15800002
         SLL   RWORK11,1          *2 = SIZE OF NEW LIST          Y02072 15820002
*                                                                       15822002
         GETMAIN RC,SP=0,LV=(RWORK11)   GET CORE FOR NEW USL     Y02072 15830002
*                                                                       15830402
         LTR   RRETCODE,RRETCODE        DO I HAVE THE CORE?             15832002
         BNZ   ERREXIT5                 BRANCH IF NO.                   15834002
         LR    RNEWLST,R1               GET ADDR OF NEW LIST     Y02072 15836002
*                                                                       15838002
         MODESET  EXTKEY=ZERO           CHANGE TO KEY ZERO TO    Y02072X15838402
                                        GET LOCK AND ST IN SVRB  Y02072 15838802
*                                                                       15839202
*                                                                       15878302
*     IT IS NECESSARY TO GET THE LOCAL LOCK TO MOVE THE OLD             15878402
*     USL LIST CONTENTS INTO THE NEW GOTTEN AREA. SETLOCK               15878502
*     USES REGISTERS 11-14 WITHOUT RESTORING THEM.                      15878602
*                                                                       15878702
         ST    RWORK11,WKAESTAE         SAVE R11 AROUND SETLOCK  Y02072 15878902
*                                                                       15879102
EXTLOCK  SETLOCK  OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=('BUFFERQ,IGG01X15879202
               9JB(EXTFREE)')           GET THE LOCAL LOCK       Y02072 15881202
*                                                                       15889602
         L     RWORK11,WKAESTAE         RESTORE R11              Y02072 15892202
*                                                                       15894802
         MODESET  KEYADDR=WKASVKEY,WORKREG=9   RET TO USER KEY   Y02072 15897402
*                                                                       15900002
*                                                                       16040001
         LA    RWORK1,0(RNEWLST,RWORK11)  END OF LIST            Y02072 16110002
*                                                                       16440001
*                  INITIALIZE NEW LIST                                  16460001
*                                                                       16480001
         XC    0(USLSLOT1-USL,RNEWLST),0(RNEWLST)     CLEAR TO 0        16500001
         STH   RWORK11,USLSIZE-USL(RNEWLST)  SIZE OF NEW LIST    Y02072 16520002
         LR    RWORK9,RWORK10           GET ADDR OF OLD USL LIST Y02072 16570002
         AH    RWORK9,USLSIZE           ADD LEN TO GET END ADDR  Y02072 16572002
         LA    RWORK6,USLSLOT1-USL(RNEWLST)                             16580001
*                                 LESS FIRST SLOT ADDR, NEW LIST        16600001
         SR    RWORK1,RWORK6      = LENGTH OF ENTRIES, NEW LIST         16620001
*                                                                       16640001
*                                                                       16720001
*                  IF THE LIST HAS ENTRIES IN 2 NONCONTIGUOUS           16740001
*                  SEGMENTS, FIRST MOVE THE SEGMENT CORRESPONDING       16760001
*                  TO THE TOP OF THE QUEUE. THE SEGMENTS WILL BE        16780002
*                  MOVED WITH MVCL WHICH DEPENDS ON TWO REGISTER        16790002
*                  PAIRS:  R12-R13  AND  R6-R7                          16792002
*                                                                       16800001
         ICM   RWORK12,ADDR,USLBFRQT+1  ADDR OF TOP QUEUE ENTRY  Y02072 16820002
         BZ    CLRLST                                                   16860001
         LR    RWORK13,RWORK9           SAVE FOR LEN CALCULATION Y02072 16900002
*                                       ENDING ADDR OF OLD USL   Y02072 16910002
         SH    RWORK9,H4                POINT TO LAST ENTRY, OLD LIST   16920002
         USING USLSLOT,RWORK9                                           16940001
         NI    USLSLTFL,X'FF'-USLENDL   TURN OFF END OF LIST FLAG       16960002
*                                       BEFORE MOVE                     16980002
         ST    RWORK6,USLBFRQT-USL(RNEWLST)                             17000001
*                                       TOP OF QUEUE FOR NEW LIST IS    17020002
*                                       FIRST SLOT.                     17040002
         LA    RWORK9,USLSLOT1    FIRST SLOT, OLD LIST.                 17060001
         TM    USLSLTFL,USLINUSE  IS THIS SLOT BEING USED?              17080001
         BZ    SECSEG             BRANCH NO, 1 MOVE WILL SUFFICE        17100001
         DROP  RWORK9                                                   17120001
         CR    RWORK12,RWORK9     IS TOP QUEUE ENTRY IN 1ST SLOT Y02072 17140002
         BE    SECSEG             BRANCH YES, AGAIN 1 MOVE OK           17160001
*                                                                       17180001
         SR    RWORK13,RWORK12    LENGTH OF 1ST SEGMENT          Y02072 17200002
         LR    RWORK7,RWORK13     RECEIVING FIELD IS SAME LGTH   Y02072 17220002
         SR    RWORK1,RWORK7      REDUCE LENGTH OF UNUSED SLOTS         17240001
         MVCL  RWORK6,RWORK12     MOVE 1ST SEGMENT TO NEW LIST   Y02072 17260002
         LA    RWORK12,USLSLOT1   2ND SEGMENT STARTS AT 1ST SLOT Y02072 17280002
*                                 OF OLD LIST.                          17300001
*                                                                       17320001
*                  MOVE SECOND OR ONLY LIST SEGMENT.                    17340001
*                                                                       17360001
SECSEG   L     RWORK13,USLBFRQB   LAST SLOT OF SEGMENT TO MOVE   Y02072 17380002
         USING USLSLOT,RWORK13                                   Y02072 17400002
         LA    RWORK13,USLNXT     POINT AT END ADDR + 1          Y02072 17420002
         DROP  RWORK13                                           Y02072 17440002
         SR    RWORK13,RWORK12    LENGTH OF SECOND SEGMENT       Y02072 17460002
         LR    RWORK7,RWORK13     RECEIVING FIELD IS SAME LGTH   Y02072 17480002
         SR    RWORK1,RWORK7      REDUCE AMOUNT OF UNUSED SLOTS         17500001
         MVCL  RWORK6,RWORK12     MOVE 2ND SEGMENT TO NEW LIST   Y02072 17520002
         LR    RWORK9,RWORK6      END OF LAST USED SLOT                 17540001
         SH    RWORK9,H4          ADDR OF BOTTOM SLOT IN QUEUE          17560001
         ST    RWORK9,USLBFRQB-USL(RNEWLST)  INITIALIZE PTR TO          17580001
*                                 LAST SLOT OF QUEUE.                   17600001
*                                                                       17620001
*                  CLEAR THE UNUSED SLOTS ON THE NEW LIST               17640001
*                                                                       17660001
CLRLST   LR    RWORK7,RWORK1      LENGTH REMAINING (TO FIELD)           17680001
         SR    RWORK13,RWORK13    SEND NO CHARACTERS, PAD X'00'  Y02072 17700002
         MVCL  RWORK6,RWORK12     CLEAR REST OF LIST             Y02072 17720002
*                                                                       17740001
         SH    RWORK6,H4          ADDR LAST SLOT                        17760001
         USING USLSLOT,RWORK6                                           17780001
         OI    USLSLTFL,USLENDL   TURN ON END-OF-LIST FLAG              17800001
         DROP  RWORK6                                                   17820001
*                                                                       17840001
         NI    USLFLAGS,X'FF'-USLCURNT  TURN OFF 'CURRENT' FLAG         17860001
*                                       IN OLD LIST                     17880001
         OI    USLFLAGS-USL(RNEWLST),USLCURNT                           17900001
*                                 TURN ON 'CURRENT' FLAG IN NEW         17920001
*                                 SET POINTER TO OLD LIST IN NEW        17940001
         ST    RWORK10,USLCHAIN-USL(RNEWLST)                     Y02072 17960002
         ST    RNEWLST,DCBDYNB    SET POINTER TO NEW LIST IN DCB        17980001
*                                                                       18050002
*     MODESET MUST BE ISSUED TO RETURN TO SUPERVISOR KEY BEFORE         18060002
*     RELEASING THE LOCAL LOCK. SETLOCK USES REGISTERS 11-14            18070002
*     WITHOUT RESTORING THEM.                                           18072002
*                                                                       18074002
         MODESET  EXTKEY=ZERO           RETURN TO ZERO KEY       Y02072 18078002
*                                                                       18078402
EXTFREE  SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019JB(EXTLOCKX18078802
               )')                      FREE THE LOCAL LOCK      Y02072 18078902
*                                                                       18079602
*                                                                       18080001
*                       NORMAL EXIT                                     18100001
*                                                                       18120001
NORMEXIT L     RRETURN,WKAREG14   RESTORE RETURN REGISTER               18140001
         SR    RRETCODE,RRETCODE  RETURN CODE = 0.                      18160002
         BR    RRETURN            RETURN TO IGC0005G                    18180001
*                                                                       18200001
         SPACE 2                                                        18220002
*                                                                       18240001
*                            ERROR EXITS.                               18260001
*                                                                       18280001
ERREXIT5 LA    RRETCODE,FIXERR    LOAD ERROR CODE                       18540001
         L     RRETURN,WKAREG14   RESTORE RETURN REGISTER               18560001
         BR    RRETURN            RETURN TO CALLER                      18580001
*                                                                       18600001
*********************************************************************** 18610002
*                           CONSTANTS                                 * 18612002
*********************************************************************** 18614002
H16      DC    H'16'                                                    18616002
H4       DC    H'4'                                                     18618002
IOSKEY   DC    X'00'                    KEY OF IOS               Y02072 18618402
ZERO     DC    X'00'                    SVRB KEY                 Y02072 18618502
MODID    DC    C'IGG019JB'              MODULE ID                Y02072 18668502
FIX      DC    C' XM1559 '              LATEST FIX               YM5349 18678502
DATE     DC    C'11/13/73'              DATE OF LATEST FIX       YM5349 18688502
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 18718502
         EJECT                                                          18860001
*********************************************************************** 18862002
*                             DSECTS                                  * 18864002
*********************************************************************** 18866002
         IHAPSA                                                  Y02072 18870002
         EJECT                                                          18872002
         IKJTCB                                                  Y02072 18874002
         EJECT                                                          18876002
         IECDRQE                                                 Y02072 18878002
         IEZIOB                                                         18880001
         ORG   IOBDQPTR                                                 18900001
IOBDQSW  DS    B        FLAGS                                           18920001
IOBDQCP  EQU   BIT0          CHANNEL PROGRAM MODIFIED                   18940001
*                                                                       18960001
         IHADCB DSORG=DA                                                18980001
*                                                                       19000001
         IHADECB                                                        19020001
         ORG   DECAREA                                                  19040001
DECARB1  DS    B                  SAVEAREA FOR CCW1 OP-CODE             19060001
DECARB2  DS    B                  SAVEAREA FOR CCW1 FLAGS               19080001
         EJECT                                                          19130002
         IGGBCB  TYPE=DAM                                        Y02072 19180002
         SPACE 5                                                        19230002
         IGGSWA                                                  Y02072 19280002
BUFFERB  DSECT          FORMAT OF BUFFER BEYOND SEGMENT AREA            19290002
BUFBFPTR DS    A        ADDRESS OF BEGINNING OF BUFFER                  19300002
BUFRECAR EQU   *        RECORD AREA; BUFBFPTR IS ALIGNED SO THAT        19310002
*                       BUFRECAR FALLS AS SPECIFIED BY DCBBFALN.        19320002
         SPACE 5                                                        19330002
         IGGUSL                                                  Y02072 19380002
         EJECT                                                          19490002
         IKJRB                                                   Y02072 19500002
         IGGFRWKA                                                Y02072 19550002
         END                                                            20300001
./  ADD  SSI=73500499,NAME=IGG019KA
         TITLE 'IGG019KA - BDAM FOUNDATION MODULE-NON VS FORMAT'        00010002
IGG019KA CSECT                                                          00020000
*MODULE NAME - IGG019KA                                               * 00022002
*                                                                     * 00022402
*DESCRIPTIVE NAME - BDAM FOUNDATION MODULE, NON VS FORMAT             * 00022802
*                                                                     * 00023202
*COPYRIGHT - NONE                                                     * 00023602
*                                                                     * 00023702
*CHANGE ACTIVITY                                                      * 00023802
*                                                                     * 00024002
*          OS 20 CHANGES/DELETIONS                                      00046402
*0286074860-074920                                               M5471  00046802
*0286                                                            A33688 00047202
*0286000270-000440,000690-000830,048200,053400,063920,064080,    20201  00047602
*0286083400-083800,084400,084600                                 20201  00047702
*0286134860-134920                                               M5461  00047802
*          OS 21 CHANGES/DELETIONS                                      00049802
*1132111200,117400,120400,120800-121800,122600,132200-132400     A35339 00051802
*1132112600-112800                                               A30797 00053802
*                                                               SA53267 00054202
*057800,059200-060200                                           SA54515 00056202
*          VS 1-1 CHANGES/DELETIONS                                     00064202
*          VS 2-1 CHANGES/DELETIONS                                     00074202
*          VS 1-3 CHANGES/DELETIONS                                     00084202
*                                                               XA02033 00084602
*                                                               XA03071 00085002
*          VS 2-2 CHANGES/DELETIONS                                     00086202
*                                                                Y02072 00088202
*                                                                YM1458 00088602
*                                                                YM3857 00089002
*                                                                YM3850 00089402
*                                                                YM2862 00090602
*                                                                YM5969 00095502
*                                                                YM6585 00097502
*                                                                YM5893 00099502
*                                                                YM8817 00099902
*A052820-052920,053020-053024,053500                            ZA01524 00105902
*D095800-096338                                                @ZA08000 00107937
*          CHANGES SUBSEQUENT TO VS2 - 037                            * 00108937
*C129200                                                       @ZA15675 00109937
*A031900,084650                     OZ28786 CHANGES FLAGGED AS @YA19662 00110937
*                                                                       00112002
*STATUS CHANGE LEVEL 008                                              * 00117602
*                                                                     * 00123202
*FUNCTION/OPERATION- THIS MODULE CONTAINS THREE ROUTINES WHOSE        * 00128802
*   FUNCTIONS ARE:                                                    * 00134402
*   ROUTINE 1. INITIAL ENTRY FOR ANY BDAM READ OR WRITE, CHECK THE    * 00140000
*    VALIDITY OF SPECIFIED TYPE AND OPTIONS, OBTAIN AN IOB, PROVIDE   * 00160000
*    LINKAGE FOR ADDRESS CONVERSION AND CHANNEL PROGRAM CONSTRUCTION, * 00180000
*    ISSUE THE 'EXCP' AND RETURN TO THE USER. IF WRITE ADD FOR A 2305,* 00200002
*    SVC 53 IS ISSUED INSTEAD OF EXCP. WHEN EXCLUSIVE CONTROL OF THE  * 00202002
*    TRACK OR DATA SET IS OBTAINED, IGC0005C WILL ISSUE THE EXCP.     * 00204002
*                                                                     * 00220000
*   ROUTINE 2. ASYNCHRONOUS INTERRUPT ROUTINE(ASI), LINK NEW IOBS     * 00230002
*    TO THE DCB IOB POOL, PROVIDE LINKAGE TO THE FEEDBACK, SELF-      * 00232002
*    FORMAT AND EXCLUSIVE CONTROL MODULES, MAKE THE IOB AVAILABLE     * 00234002
*    AND ISSUE THE 'POST' BEFORE RETURNING TO THE SUPERVISOR.         * 00236002
*                                                                     * 00320000
*   ROUTINE 3. ERROR ROUTINES, RELEASE THE IOB, SET THE PROPER        * 00340000
*    EXCEPTION CODES, ISSUE THE 'POST'.                               * 00360000
*                                                                     * 00380000
*ENTRY POINTS- 'IGG019KA' (ENTRYPT) IS THE ENTRY FOR A BDAM READ OR   * 00400000
*   WRITE MACRO INSTRUCTION. THE GENERATED CALLING SEQUENCE IS,       * 00420000
*   L    15,DCBREAD   (DCB+48)                                        * 00440000
*   BALR 14,15                                                        * 00460000
*                                                                     * 00480000
*   'IECDFDNA' IS THE ENTRY POINT TO THE ASI ROUTINE FROM SUPERVISOR  * 00500000
*   WHEN THE I/O HAS COMPLETED. THE CALLING SEQUENCE USED IS,         * 00520002
*   L    15,IRBRBEP   (IRB+12)                                        * 00540000
*   BALR 14,15                                                        * 00560000
*                                                                     * 00580000
*   'LATERR' IS AN ENTRY TO THE INVALID REQUEST ERROR ROUTINE FROM    * 00600000
*   THE ADDRESS CONVERSION OR PRE-FORMAT MODULES. CALLING SEQUENCE IS,* 00620000
*   L    REG,20(IGG019KA BASE)                                        * 00640000
*   BR   REG                                                          * 00660000
*                                                                     * 00680000
*INPUT- ROUTINE 1.- DECB ADDRESS IN REGISTER 1, SAVE AREA ADDRESS IN  * 00700000
*   REGISTER 13, RETURN ADDRESS IN REGISTER 14, ENTRY POINT IN        * 00720000
*   REGISTER 15.                                                      * 00740000
*                                                                     * 00760000
*   ROUTINE 2.(ASI)- IOS QUEUEING ELEMENT ADDRESS IN REGISTER 1,      * 00780000
*   RETURN ADDRESS IN REGISTER 14, ENTRY POINT IN REGISTER 15.        * 00800000
*                                                                     * 00820000
*   ROUTINE 3.(INVALID REQUEST)- REGISTERS 5,7,11,13 WILL CONTAIN THE * 00840000
*   DECB ADDRESS, IOB ADDRESS, IGG019KA ADDRESS, SAVE AREA ADDRESS,   * 00860000
*   RESPECTIVELY. REGISTER 12 WILL CONTAIN THE REASON CODE WHICH WILL * 00880000
*   APPEAR IN BYTE TWO OF THE DECB AFTER 'POST' IS EXECUTED.          * 00900000
*                                                                     * 00920000
*OUTPUT- ROUTINE 1.- AN IOB WILL BE OBTAINED, CHANNEL PROGRAM         * 00940000
*   CONSTRUCTED AND 'EXCP' EXCECUTED FOR A VALID READ OR WRITE.       * 00960000
*   IF 2305 WRITE ADD AND BLOCK IS NOT AVAILABLE, THE IOB WILL BE     * 00970002
*   PUT ON THE UNPOSTED QUEUE.                                        * 00972002
*                                                                     * 00980000
*   ROUTINE 2.(ASI)- FEEDBACK WILL BE RETURNED IF REQUESTED, AND A    * 01000000
*   COMPLETION CODE PLACED IN THE DECB BY THE 'POST' ROUTINE.         * 01020000
*                                                                     * 01040000
*   ROUTINE 3.(INVALID REQUEST)- A COMPLETION CODE AND REASON CODE    * 01060000
*   ARE PLACED IN THE DECB BY THE 'POST' ROUTINE.                     * 01080000
*                                                                     * 01100000
*EXTERNAL ROUTINES- 'IGG019KC'-CONVERT RELATIVE TRACK ADDRESS (TT OR  * 01120000
*   TTR) TO AN ACTUAL ADDRESS OR CONVERT ACTUAL TO TTR FOR FEEDBACK.  * 01140000
*                                                                     * 01160000
*   'IGG019KE'-CONVERT RELATIVE BLOCK ADDRESS TO AN ACTUAL ADDRESS.   * 01180000
*                                                                     * 01200000
*   'IGG019KF'-CONVERT RELATIVE BLOCK ADDRESS TO AN ACTUAL ADDRESS    * 01220000
*   FOR OVERFLOW RECORDS                                              * 01240000
*                                                                     * 01260000
*   'IGG019KK'-CONSTRUCT A CHANNEL PROGRAM TO SEARCH BY BLOCK ID.     * 01280000
*                                                                     * 01300000
*   'IGG019KI'-CONSTRUCT A CHANNEL PROGRAM TO SEARCH BY BLOCK KEY.    * 01320000
*                                                                     * 01340000
*   'IGG019KO'-CONSTRUCT A CHANNEL PROGRAM TO ADD A NEW BLOCK TO A    * 01360000
*   DATA SET OF FIXED FORMAT RECORDS, (PRE-FORMAT MODULE).            * 01380000
*                                                                     * 01400000
*   'IGG019KM'-CONSTRUCT A CHANNEL PROGRAM TO ADD A NEW BLOCK TO A    * 01420000
*   DATA SET OF VARIABLE OR UNDEFINED LENGTH RECORDS, (SELF-FORMAT    * 01440002
*   MODULE).                                                          * 01460000
*   ALSO ENTERED TO DETERMINE IF THE NEW BLOCK WILL FIT ON THE TRACK  * 01480000
*   AFTER THE CAPACITY RECORD IS READ INTO THE IOB.                   * 01500000
*   ALSO ENTERED AFTER THE WRITE-ADD REQUEST HAS COMPLETED, TO SCAN   * 01520000
*   THE UNSCHEDULED QUEUE FOR OTHER WRITE-ADD REQUESTS AND EXECUTE    * 01540000
*   THE FIRST REQUEST FOUND, IF ANY.                                  * 01560000
*                                                                     * 01580000
*   SVC 53  -PLACE A RECORD ON THE READ EXCLUSIVE LIST FOR A READ     * 01600002
*   OR WRITE ADD REQUEST, OR PUT THE IOB ON THE UNPOSTED QUEUE,       * 01610002
*   OR REMOVE A RECORD FROM THE READ EXCLUSIVE LIST FOR A WRITE       * 01620000
*   WHEN EXCLUSIVE CONTROL IS SPECIFIED, OR IF A WRITE ADD REQUEST.   * 01640002
*                                                                     * 01660000
*   'IGG019KG'-CONVERT AN ACTUAL ADDRESS TO A RELATIVE BLOCK NUMBER   * 01680000
*   IF FEEDBACK IS REQUESTED.                                         * 01700000
*                                                                     * 01720000
*   'IGG019KH'-CONVERT AN ACTUAL ADDRESS TO A RELATIVE BLOCK NUMBER   * 01740000
*   FOR OVERFLOW RECORDS, IF FEEDBACK IS REQUESTED.                   * 01760000
*                                                                     * 01780000
*EXITS-NORMAL- 'RSTOR' IS THE RETURN TO THE PROGRAM WHICH ISSUED THE  * 01800000
*   READ OR WRITE MACRO-INSTRUCTION. THE REQUEST HAS EITHER BEEN      * 01820000
*   EXECUTED VIA 'EXCP' OR HAS BEEN POSTED COMPLETE AS AN INVALID     * 01840000
*   REQUEST.                                                          * 01860000
*   'SUPEXIT' IS THE EXIT FROM THE ASI ROUTINE TO SUPERVISOR. THE DECB* 01880000
*   HAS BEEN POSTED AS COMPLETE WITH A CODE INDICATING SUCCESSFUL OR  * 01900000
*   ERROR COMPLETION.                                                 * 01920000
*                                                                     * 01940000
*TABLES/WORK AREAS- N/A                                               * 01960000
*                                                                     * 01980000
*ATTRIBUTES- THE INITIAL ENTRY ROUTINE AND INVALID REQUEST ERROR      * 02000000
*   ROUTINE ARE REENTRANT AND EXECUTED ENABLED, PROG PGM STATE.       * 02020002
*                                                                     * 02030002
*   THE ASI ROUTINE IS REENTRANT AND EXECUTED ENABLED, IN PROBLEM     * 02040002
*   PROGRAM STATE AND USER KEY.                                       * 02050002
*                                                                     * 02080000
*NOTE- THE BDAM MODUES BRANCH AND LINK TO EACH OTHER WITHOUT USE OF   * 02100000
*   A REGISTER SAVE AREA SO THE REGISTER USAGE MUST REMAIN CONSISTENT * 02120000
*   IN THE BDAM MODULES, IGG019KA, IGG019KC, IGG019KE, IGG019KF,      * 02140000
*   IGG019KG, IGG019KH, IGG019KI, IGG019KK, IGG019KM, IGG019KO,       * 02160000
*   IGG019KQ.                                                         * 02180002
         EJECT                                                          02330002
*********************************************************************** 02380002
*                    REGISTER USAGE                                   * 02420002
*********************************************************************** 02430002
*                                                                       02440000
PARAM2   EQU   0                                                        02460000
PARAM    EQU   1         PARAMETERS                                     02480000
WKREG1   EQU   2         WORK REGISTER                                  02500000
DEBREG   EQU   3         DEB ADDRESS                                    02520000
DCBREG   EQU   4         DCB ADDRESS                                    02540000
DECBREG  EQU   5         DECB ADDRESS                                   02560000
WKREG2   EQU   6         WORK REGISTER                                  02580000
IOBREG   EQU   7         IOB ADDRESS                                    02600000
SECTOR   EQU   8         POINTER TO SECTOR AREA OR LAST DW       20201  02610020
FDNBASE  EQU   11        BASE FOR THE FOUNDATION MODULE                 02620000
INTRET   EQU   12        RETURN FOR INTERNAL LINKAGES                   02640000
SAVE     EQU   13        POINTER TO USER SAVE AREA                      02660000
RETREG   EQU   14        RETURN REGISTER                                02680000
EPREG    EQU   15        ENTRY POINT                                    02700000
WKREG3   EQU   15        WORK REGISTER                           Y02072 02710002
*                                                                       02720000
         IEZBITS                                                        02730001
         EJECT                                                          02740000
         USING IGG019KA,EPREG                                           02750002
*                                                                       02760000
*                                                                       02780000
ENTRYPT  B     BEGIN                    BRANCH AROUND ADDR LOCATIONS    02800002
*                                                                       02820000
RRAD     DC    V(IGG019KE)             RELATIVE BLOCK MOD ADDR   Y02072 02840002
RTAD     DC    V(IGG019KC)             RELATIVE TRACK MOD ADDR   Y02072 02860002
VERAD    DC    V(IGG019KQ)             VERIFY MODULE ADDRESS     Y02072 02880002
ASIAD    DC    A(IECDFDNA)             ASYNCH INTERRUPT RTN      Y02072 02900002
ERRENTRY DC    A(LATERR)               INVALID REQUEST ERROR RTN Y02072 02920002
KEYMODAD DC    V(IGG019KI)             ADDRESS OF THE KEY MODULE Y02072 02940002
IDMODAD  DC    V(IGG019KK)             ADDRESS OF THE ID MODULE  Y02072 02960002
RROVAD   DC    V(IGG019KF)             REL BLOCK/TRK OFLO MOD AD Y02072 02970002
*                                                                       02980000
*                                                                       03000000
*                                                                       03020000
         DROP  EPREG                                                    03040000
BEGIN    SAVE  (14,12)                  SAVE USER REGISTERS IN HIS AREA 03080002
         LR    FDNBASE,EPREG            ESTABLISH BASE FOR THIS MODULE  03100002
         USING IGG019KA,FDNBASE                                         03110002
         LR    DECBREG,PARAM            SET BASE REGISTER FOR DECB      03120002
         USING DECB,DECBREG                                             03130002
         L     DCBREG,DECDCBAD          SET BASE REGISTER FOR DCB       03140002
         USING IHADCB,DCBREG                                            03150002
         L     DEBREG,DCBDEBAD          SET BASE REGISTER FOR DEB       03160002
         USING DEBBASIC,DEBREG                                   Y02072 03170002
*                                                                       03180000
         NI    DECTYPE,OLDOPTS          CLEAR OLD DCB OPTIONS  @YA19662 03190037
         IC    INTRET,DECTYPE           SAVE REQUESTED OPTIONS IN A REG 03200002
         OI    DECTYPE,VERIFY+EXSCH+ACTAD+RELRD+OFLOW                   03220000
         NC    DECTYPE(1),DCBOPTCD      COMBINE DCB OPTIONS WITH THE    03240002
         EX    INTRET,ORBACK            REQUEST OPTIONS.                03260000
         N     INTRET,OPSMSK            VALIDITY CHECK READX,DYN. BFR.  03280002
         BZ    OKOPTS                   OPTIONS (BR IF NONE PRESENT),BY 03300002
         EX    INTRET,VALCHK            EXECUTING A TM INSTRUCTION.     03320000
         BO    OKOPTS                   OK IF ALSO SPECIFIED IN DCB,    03340002
         IC    INTRET,INVOPT            ELSE FLAG THIS REQUEST AS       03360000
         B     ABORT                    INVALID AND GO POST COMPLETION. 03380002
*                                                                       03400000
ORBACK   OI    DECTYPE,0     EXECUTED-RETURN FEEDBACK OPTION BIT.       03420000
VALCHK   TM    DCBOPTCD,0    EXECUTED-CHECK READX,DYN. BFR. REQUEST.    03440000
*                                                                       03460000
OKOPTS   TM    DECTYPE+1,READ           IS THIS A READ REQUEST          03480002
         BO    LGNCHK                   YES, GO TEST LENGTH OPTION      03500002
         TM    DEBOPATB,DEBACCS         DID OPEN SPECIFY OUTPUT/UPDATE  03520002
*                                                                Y02072 03530002
         BC    5,FORMCHK                YES, WRITE REQUEST IS VALID     03540000
         IC    INTRET,INVWRT            FLAG THIS WRITE TO INPUT DATA   03560002
         B     ABORT                    SET, GO POST COMPLETION         03580002
*                                                                       03600000
*                                                                       03620000
FORMCHK  TM    DCBRECFM,DCBRECF         IS RECORD FORMAT VARIABLE       03640002
         BO    LGNCHK                   NO, GO TEST LENGTH OPTION       03660002
         L     WKREG2,DECAREA           USE FIRST TWO BYTES OF DATA AS  03680002
         MVC   DECLNGTH(2),0(WKREG2)    BLOCK LENGTH FOR THE WRITE      03700000
         B     SZRTN                    GO DETERMINE IOB SIZE           03720002
*                                                                       03740000
LGNCHK   TM    DECTYPE+1,LGNOP          DID USER CODE LENGTH AS 'S'     03760002
         BZ    SZRTN                    NO, USE DECB LENGTH             03780002
         MVC   DECLNGTH(2),DCBBLKSI     USE MAX BLOCK SIZE AS LENGTH    03800002
*                                                                       03820000
*********************************************************************** 03830002
*   THE FOLLOWING ROUTINE DETERMINES THE SIZE IOB AND CHANNEL PROGRAM   03840000
*        CORE AREA REQUIRED FOR THIS REQUEST                            03860000
*********************************************************************** 03870002
*                                                                       03880000
SZRTN    LA    WKREG1,BASESZ            SIZE=BASE + OPTIONS             03900002
         LA    PARAM,XSCHSZ             SET TO EXTENDED SEARCH CORE AMT 03920002
         SR    INTRET,INTRET            CLEAR FEEDBACK INCREMENT REG    03940000
         TM    DCBOPTCD,DCBOPTTO        ARE OVERFLOW RECORDS PRESENT    03960002
         BZ    NOTOVFLO                 NO , CONTINUE            Y02072 03980002
         LA    WKREG1,OFLINCR(0,WKREG1) ADD ON FOR NOP CCW AT END OF CP 04000000
NOTOVFLO EQU   *                        CONTINUE IOB SIZE CALC   Y02072 04010002
         TM    DECTYPE+1,READ           TEST TYPE FOR READ              04020002
         BO    TSTRDX                   YES, GO TEST FOR READ EXCLUSIVE 04040000
*                                                                       04060000
         TM    DECTYPE,VERIFY           TEST FOR VERIFY OPTION          04080000
         BZ    TSTWA                    BR IF NO VERIFY SPECIFIED       04100002
         LA    WKREG1,VERSZ(0,WKREG1)   INCREMENT FOR VERIFY CCW'S      04120002
TSTWA    TM    DECTYPE+1,ADD            TEST FOR WRITE ADD TYPE         04140000
         BZ    TSTRDX                   NO, GO TEST FOR WRITE RELEASE   04160002
         LA    WKREG1,ADDSZ+ENQPL(0,WKREG1)  INCREMENT FOR WRITE ADD    04180000
*                                       AND ENQUE PARAMETER LIST        04200002
         LA    PARAM,PFEXTSZ            PRE-SET EXTENDED SEARCH REG     04220002
         TM    DCBRECFM,DCBRECV         ARE RECORDS FIXED FORMAT        04240002
         BZ    TSTX                     BRANCH IF YES                   04260002
         LA    WKREG1,SFSZ(0,WKREG1)    INCREMENT FOR SELF FORMAT WRITE 04280002
         SR    PARAM,PARAM              NO CORE REQ'D FOR EXTENDED SRCH 04300002
         B     TSTX                     GO TEST FOR EXTENDED SEARCH     04320002
*                                                                       04340000
TSTRDX   TM    DECTYPE,READX            IS IT A READ EXCLUSIVE OR A     04360000
*                                       WRITE TO RELEASE                04380000
         BZ    TST4KEY                  BRANCH IF NO                    04400000
         LA    WKREG1,ENQPL(WKREG1)     ADD FOR ENQ PARAMETER LIST      04420000
*                                                                       04440000
TST4KEY  TM    DECTYPE+1,KEY            IS TYPE = KEY                   04460002
         BZ    CHKPOOL                  NO, SIZE IS IN WKREG1           04480002
         TM    DECTYPE,FEEDB+READX+OFLOW  ARE FEEDBACK CCWS NEEDED      04500000
         BZ    TSTX                     NO, LEAVE REGISTER ZERO         04520002
         LA    INTRET,FDBSZ             SET POSSIBLE FEEDBACK INCREMENT 04540002
*                                                                       04560000
TSTX     TM    DECTYPE,EXSCH            TEST FOR EXTENDED SEARCH OPTION 04580000
         BZ    CHKPOOL                  BR IF NOT SPECIFIED             04600002
         CLC   ZEROS(3),DCBLIMCT        IS LENGTH OF SEARCH SPECIFIED   04620002
         BNE   UPSZ88                   YES, REQUEST IS VALID           04640002
         IC    INTRET,INVLIMCT          FLAG INVALID REQUEST (LIMCT=0)  04660002
         B     ABORT                    GO POST COMPLETION              04680002
UPSZ88   AR    WKREG1,PARAM             INCREMENT FOR EXTENDED SEARCH   04700002
         AR    WKREG1,INTRET            INCREMENT FOR FEEDBACK          04720000
*                                                                       04740000
*        THIS CODE IS ADDED TO GET ONE MORE DOUBLE WORD FOR THE         04742020
*        SECTOR BYTES ASSOCIATED WITH RECORD READY.                     04744020
*                                                                       04746020
CHKPOOL  EQU   *                                                 20201  04748020
         LA    WKREG1,RRINCR(WKREG1)    INCR IOB SZ FOR REC REDY 20201  04750002
*                                                                       04752020
*    THE FOLLOWING ROUTINE OBTAINS AN IOB AREA FROM THE POOL OF AREAS   04760000
*     IF ONE OF ENOUGH SIZE IS AVAILABLE                                04780000
*                                                                       04800000
         USING IOBSTDRD,IOBREG          ESTABLISH IOB BASE       Y02072 04810002
         L     IOBREG,DCBIOBAD          LOAD FIRST LINK ADDRESS  20201  04820020
SHFT     LA    IOBREG,0(0,IOBREG)       BE SURE HI-ORDER BYTE IS ZERO   04840002
         LTR   IOBREG,IOBREG            TEST FOR ZERO LINK ADDRESS.     04860000
         BZ    GETCR                    IF ADDR=0, GO GET CORE FOR IOB  04880002
         CH    WKREG1,IOBDIOBS          IS THIS IOB AREA LARGE ENOUGH   04900000
         BH    TRYNEXT                  IF NOT GO SEE IF THERE ARE MORE 04920002
         TS    IOBDAVLI                 IS THIS IOB AVAILABLE           04940000
         BZ    CLRIOB                   YES, GO INITIALIZE AREA         04960002
*                                                                       04980000
TRYNEXT  L     IOBREG,IOBDPLAD          LOAD NEXT POOL LINK             05000002
         B     SHFT                     GO TEST FOR END OF CHAIN        05020002
*                                                                       05040000
*                                                                       05060000
CLRXC    XC    IOBDTYPE(1),IOBDTYPE  EXECUTED-- CLEAR LAST PART OF IOB  05080000
CLRXXC   XC    IOBDTYPE+Q255(Q1),IOBDTYPE+Q255  CLR IF IOB+CCWS  20201  05085020
*                                       GO BEYOND IOBDTYPE+255   20201  05090002
*                                                                       05100000
*                                                                       05120000
*                GETMAIN ROUTINE                                        05140002
*                                                                       05150002
GETCR    LR    PARAM2,WKREG1            MOVE BYTE COUNT TO PARAM REG    05160002
         GETMAIN R,LV=(0)                                               05180000
*                                                                       05200000
         LR    IOBREG,PARAM             LOAD CORE ADDRESS TO IOB BASE   05220002
         STH   WKREG1,IOBDIOBS          STORE THE AREA SIZE IN IOB      05240002
         SR    WKREG2,WKREG2            CLEAR THE POOL                  05260000
         ST    WKREG2,IOBDAVLI          ADDRESS AREA                    05280002
CLRIOB   EQU   *                        CLEAR THE IOB           ZA01524 05282002
         LR    WKREG2,WKREG1            SAVE LENGTH REQUIRED    ZA01524 05290002
         LH    WKREG1,IOBDIOBS          LOAD SIZE OF IOB        ZA01524 05292002
         XC    IOBFLAG2(41),IOBFLAG2    CLEAR IOB SIZE FIELD   @OZ04733 05300037
         LR    SECTOR,IOBREG            LOAD ADDR OF IOB         20201  05301020
         AR    SECTOR,WKREG2            ADD NUMBER OF BYTES     ZA01524 05302002
*                                       REQUIRED FOR THIS REQ   ZA01524 05302402
         S     SECTOR,EIGHT             POINT TO LAST DOUBLE     20201  05303020
*                                       WORD                     20201  05304020
         TM    DECTYPE+Q1,ADD           IS THIS WRITE ADD        20201  05305020
         BO    SUBRDX                   SUBTRACT OFF ENQ AREA    20201  05306020
         TM    DECTYPE,READX            IS THIS READ EXCLUSIVE   20201  05307020
         BZ    NOTREADX                 NO, ALL O.K.             20201  05308020
SUBRDX   EQU   *                                                 20201  05309020
         SH    SECTOR,RDXCORE           SUBTRACT OFF ENQ AREA    20201  05310020
NOTREADX EQU   *                                                 20201  05311020
         SH    WKREG1,K49               REDUCE SIZE TO REMAINING SIZE   05320002
         CH    WKREG1,IOBSZ255          IOB GO BEYOND            20201  05324020
*                                       IOBDTYPE+255?            20201  05328020
         BH    CLROVFF                  YES, GO TO CLEAR BEYOND  20201  05332020
         EX    WKREG1,CLRXC             ELSE CLEAR WHAT IS       20201  05336020
*                                       SPECIFIED                20201  05340020
         B     CORCLRD                  CORE ZEROED SO BRANCH    20201  05344020
CLROVFF  XC    IOBDTYPE(Q255),IOBDTYPE  CLR OUT 1ST 255 BYTES    20201  05348020
         SH    WKREG1,IOBSZ255          SUBT AMT ALREADY CLEAR  ZA01524 05350002
         EX    WKREG1,CLRXXC            CLEAR OUT THE REMAINDER  20201  05352020
*                                                                       05354002
CORCLRD  EQU   *                                                 20201  05356020
         ST    DCBREG,IOBDCBPT          STORE DCB ADDRESS IN IOB        05400002
         ST    DECBREG,IOBECBPT         STORE ECB ADDRESS IN IOB        05420002
         ST    IOBREG,DECIOBPT          STORE IOB ADDR IN DECB          05440002
         LA    WKREG1,IOBCHNPR          DEVELOP CHANNEL PROG STARTING   05460002
         ST    WKREG1,IOBSTART          ADDRESS AND STORE IT IN IOB     05480000
         MVC   IOBDTYPE(L'DECTYPE),DECTYPE  MOVE OPTION & TYPE CODE     05500001
         MVI   IOBFLAG1,CPFLAG          MARK AS UNRELATED,COMMAND CHAIN 05520002
*                                                                       05540000
*    THE FOLLOWING ROUTINE DETERMINES THE ADDRESSING METHOD BEING       05560000
*     USED AND CHECKS THE VALIDITY OF THE ADDRESS.                      05580000
*                                                                       05600000
ADDRDEC  L     PARAM,DECRECPT           LOAD POINTER TO USER'S ADDRESS  05620002
         LA    RETREG,CLRCP             LOAD COMMON RETURN POINT ADDR   05640002
         TM    IOBDTYP2,IOBRQUST+IOBADDTY  BYPASS NEXT RTN IF RD OR WA  05660002
         BC    5,D1NOFDBK               AND GO DETERMINE ADDRESS TYPE   05680000
         TM    IOBDTYP2,IOBTYPE         IF TYPE IS KEY, BYPASS CHECKING 05700002
         BO    TRYX                     FOR A WRITE TO R ZERO           05720002
         TM    IOBDTYPE,IOBACTAD        IS ADDRESS ACTUAL               05740002
         BZ    TRYRT                    NO, GO TEST FURTHER             05760002
TESTR0   EQU   *                        WRT R0 INVALID -TEST IT OX02033 05770002
         CLI   7(PARAM),0               IS THIS A WRITE TO R0           05800002
         BNE   ACTUAL                   NO, ACTUAL ADDRESS IS OK        05820002
SETIRBIT IC    INTRET,INVID             FLAG INVAL REQUEST(WRITE TO R0) 05840002
         B     LATERR                   GO POST COMPLETION, FREE IOB    05860002
*                                                                       05880000
TRYRT    EQU   *                                                        05900000
         TM    DCBOPTCD,DCBOPTF         FEEDBACK IN DCB OPTCD?  XA02033 05950002
         BO    TRYRT2                   YES, NOT ACTUAL ADDRESS XA02033 06000002
         TM    IOBDTYPE,IOBRDEXC+IOBFDBCK WRT REL/FDBK IN DECB  XA03071 06010002
         BM    TESTR0                   YES, ASSUME ACTUAL ADDR  YM8817 06020002
*                                       BECAUSE FEEDBACK ALWAYS XA02033 06030002
*                                       PROVIDED FOR READX REQ  XA02033 06032002
*                                       AND WRT REL MUST ASSUME XA02033 06034002
*                                       PREVIOUS READX REQUEST  XA02033 06036002
TRYRT2   EQU   *                        NOT ACTUAL ADDRESSING   XA02033 06038002
         TM    IOBDTYPE,IOBRELBL        IS ADDR RELATIVE BLOCK NUMBER   06040002
         BO    RELRCDX                  YES, GO TO RELATIVE BLOCK EXIT  06060002
         CLI   2(PARAM),0               IS R OF TTR A 0                 06080002
         BE    SETIRBIT                 YES,WRITE REQUEST IS INVALID    06100002
*                                                                       06120000
RELTRKX  L     EPREG,RTAD               EXIT TO CONVERT TTR TO AN       06140000
         B     RTRKOFFS(0,EPREG)        ACTUAL ADDRESS (19KC+4)  Y02072 06160002
*                                                                       06180000
TRYX     TM    IOBDTYPE,IOBRDEXC        IS THIS A WRITE WITH FEEDBACK   06200002
         BZ    D1NOFDBK                 NO, GO TEST ADDRESS TYPE        06220002
         TM    DCBOPTCD,DCBOPTF         WAS FEEDBACK RELATIVE FOR READ  06240002
         BZ    ACTUAL                   NO, GO MOVE ACTUAL ADDR TO IOB  06260002
D1NOFDBK TM    IOBDTYPE,IOBACTAD        IF ADDRESS IS ALREADY ACTUAL,   06280002
         BO    ACTUAL                   GO MOVE IT TO THE IOB           06300002
         TM    IOBDTYPE,IOBRELBL        IS ADDRESS RELATIVE BLOCK       06320002
         BZ    RELTRKX                  NO, GO TO RELATIVE TRACK EXIT   06340002
*                                                                       06360000
RELRCDX  TM    DCBRECFM,DCBRECTO        IT TRK OVERFLOW PRESENT   13883 06368002
         BO    TRKOV                    YES--GO TO REL BLK/TRK OV 13883 06376016
         L     EPREG,RRAD               NO--CONVERSION MOD EXIT   13883 06384016
         ST    SECTOR,IOBDCPND          ST SECT ADDR WHEN        20201  06385020
*                                       BRANCHING TO             20201  06386020
*                                       THIS MODULE ONLY                06387002
         BALR  RETREG,EPREG             BRANCH TO BLOCK CONVERT  20201  06388020
*                                       RTN                      20201  06389020
         L     SECTOR,IOBDCPND          RESTORE SECTOR ADDR      20201  06390020
         B     CLRCP                    GO CLEAR OUT CHANNEL PGM 20201  06391020
*                                       AREA                     20201  06392020
TRKOV    L     EPREG,RROVAD             TRK OVERFLOW EXIT         13883 06400016
         ST    SECTOR,IOBDCPND                                   20201  06404020
         BALR  RETREG,EPREG             GO TO REL BLK TRK OVFLO  20201  06408020
*                                       MODULE                          06412002
         L     SECTOR,IOBDCPND                                   20201  06416020
*                                                                       06420000
CLRCP    XC    IOBDNRCF(40),IOBDNRCF   CLEAR AREA USED TO STORE REGS    06440002
         B     TYPEDEC                 GO GENERATE CHANNEL PROGRAM      06460002
*                                                                       06480000
*********************************************************************** 06490002
*  THE FOLLOWING ROUTINE DETERMINES THE TYPE OF READ OR WRITE           06500000
*    AND PROVIDES LINKAGE TO THE PROPER MODULE                          06520000
*********************************************************************** 06530002
*                                                                       06540000
ACTUAL   MVC   IOBSEEK,0(PARAM)         MOVE USER ADDRESS TO            06560002
         MVC   IOBUPLIM(7),IOBSEEK      SEEK AND LIMIT FIELDS           06580002
TYPEDEC  LA    RETREG,READY             LOAD COMMON RETURN ADDRESS      06600000
*                                                                       06601020
*    RPS IS TESTED FOR HERE. IF RPS IS TO BE USED, X'FF' AND THE        06602002
*    ADDRESS OF THE LAST DOUBLE WORD ARE PASSED IN IOBDCPND. ELSE X'00' 06603002
*    AND THE ADDRESS OF THE LAST DOUBLE WORD ARE PASSED IN IOBDCPND     06605002
*                                                                       06606020
         ST    SECTOR,IOBDCPND          STORE LAST DOUBLE WORD   20201  06607020
         SR    EPREG,EPREG              ZERO OUT WORK REG        Y02072 06608002
         LA    WKREG3,DEBBASND          GET ADDR OF DEV SECT     Y02072 06608402
         USING DEBDASD,WKREG3           ESTABLISH BASE, DEV SECT Y02072 06608802
         L     WKREG3,DEBUCBAD          GET UCB FROM 1ST EXT     Y02072 06609402
         DROP  WKREG3                   DROP DEB DEV SECT BASE   Y02072 06609802
         USING UCBOB,WKREG3             ESTABLISH UCB BASE       Y02072 06610202
         TM    UCBTBYT2,RECREDY         DOES THIS UCB HAVE RPS   Y02072 06612502
         DROP  WKREG3                                            Y02072 06613002
         BNO   AROUND                   NO, BRANCH AROUND        20201  06614020
         MVI   IOBDCPND,FF              MOVE IN THE RPS ID       20201  06615002
AROUND   EQU   *                                                 20201  06616020
         LA    WKREG2,IOBCHNPR          INITIALIZE CCW INDEX            06620002
*                                                                       06640000
OVERMVC  TM    IOBDTYP2,IOBTYPE+IOBADDTY  IS TYPE KEY OR WRITE ADD      06660002
         BZ    IDEXIT                   NO, GO GENERATE ID CHAN PROGRAM 06680002
         MVI   IOBR,0                   MAKE R BYTE 0 TO SEARCH ON R0   06700002
*                                                                       06720000
         TM    IOBDTYP2,IOBADDTY        IS TYPE WRITE ADD               06740002
         BO    SOMEWA                   YES, GO TEST RECORD FORMAT      06760002
TEST4KEY CLI   DCBKEYLE,0               HAVE KEYS BEEN SPECIFIED        06780002
         BE    SETNOKEY                 NO, GO SET ERROR CODE           06800002
         L     WKREG1,DECKYADR          LOAD AND TEST FOR MISSING KEY   06820002
         LTR   WKREG1,WKREG1            ADDRESS FIELD IN DECB           06840000
         BNZ   PROCEED                  IF NOT MISSING GO TEST EXIT     06860002
SETNOKEY IC    INTRET,INVKEY            SET INVALID REQUEST CODE        06880002
         B     LATERR                   GO POST COMPLETION, FREE IOB    06900002
*                                                                       06920000
PROCEED  TM    IOBDTYP2,IOBTYPE         IS TYPE KEY                     06940002
         BZ    SELFOR                   NO, GO TO WRITE ADD EXIT        06960002
         L     EPREG,KEYMODAD           EXIT TO GENERATE KEY CHANNEL    06980002
         BR    EPREG                    PROGRAM                         07000002
IDEXIT   L     EPREG,IDMODAD            LOAD ID MODULE ADDRESS AND      07020002
         BR    EPREG                    GO TO GENERATE ID CHANNEL PROG. 07040002
*                                                                       07060000
SOMEWA   TM    DCBRECFM,DCBRECV         DATA SET FIXED LENGTH RECORDS   07080002
         BZ    TEST4KEY                 IF YES, GO TEST KEYS PRESENT    07100002
SELFOR   L     EPREG,DCBDFOR            LOAD ENTRY POINT OF THE         07120002
         BR    EPREG                    WRITE ADD MODULE AND BR. TO IT  07140002
*                                                                       07160000
*                                                                       07180000
READY    EQU   *                                                        07200000
         TM    DCBOPTCD,DCBOPTTO        TEST FOR TRACK OVERFLOW         07220002
         BZ    EXPCTEND                 NOT PRESENT, NO NOP CCW         07240002
         OI    4(WKREG2),CCHN           TURN ON COMMAND CHAIN BIT       07260002
         LA    WKREG2,8(0,WKREG2)       UPDATE TO NEXT CCW              07280002
         MVI   0(WKREG2),NOPCODE        PUT IN NOP OP CODE              07300002
         MVI   4(WKREG2),SILI           TURN ON SILI BIT IN NOP CCW     07320002
         MVI   7(WKREG2),ONE            SET A NON-ZERO COUNT IN NOP CCW 07340002
EXPCTEND EQU   *                                                        07360000
         LA    WKREG2,8(0,WKREG2)       UPDATE POINTER TO PROGRAM END   07380002
         ST    WKREG2,IOBDCPND          EXPECTED ENDING ADDRESS         07400002
         MVC   IOBDNRCF+1(1),IOBBB2     MOVE 'B' TO INLINE SEEK AREA    07420002
*                                                                       07440000
*********************************************************************** 07450002
*     THE FOLLOWING TESTS FOR 2305 FIXED WRITE ADD FUNCTION. IF IT IS * 07454002
*     SVC 53 MUST BE ISSUED TO ENQUEUE EITHER ON R0 OF THE TRACK      * 07456002
*     REQUESTED (NO EXTENDED SEARCH) OR ON R0 OF THE 1ST TRACK IN     * 07456402
*     THE DATA SET (EXTENDED SEARCH). IT IS NECESSARY TO HAVE EXCLU-  * 07456802
*     SIVE CONTROL TO PREVENT MULTIPLE WRITE ADD REQUESTS ON THE      * 07457202
*     SAME TRACK FROM FINDING AND UPDATING THE SAME DUMMY RECORD.     * 07457602
*     SVC 53 (IGC0005C) WILL EITHER ENQ ON THE PARTICULAR BLOCK AND   * 07458002
*     ISSUE THE EXCP, OR THE IOB WILL BE PUT ON THE IOB UNPOSTED      * 07458402
*     QUEUE. WHEN THE IOB DOES GAIN CONTROL OF THE BLOCK, IGC0005C    * 07468402
*     WILL ISSUE THE EXCP FOR THIS REQUEST.                           * 07470402
*********************************************************************** 07474402
CHK2305  EQU   *                        IS IT 2305 WRITE ADD     Y02072 07480002
         TM    IOBDTYP2,IOBADDTY        IS TYPE WRITE ADD        Y02072 07481902
         BNO   EXCP                     NO, GO ISSUE EXCP        Y02072 07483902
         TM    DCBRECFM,DCBRECV         IS RECORD FORMAT FIXED   Y02072 07484302
         BO    EXCP                     NO, GO ISSUE EXCP        Y02072 07484702
         LA    WKREG1,DEBBASND          GET DEV DEP SECT         Y02072 07485102
         USING DEBDASD,WKREG1           EST BASE FOR DEV SECT    Y02072 07485502
         L     WKREG1,DEBUCBAD          GET UCB FOR 1ST EXTENT   Y02072 07485902
         DROP  WKREG1                   DROP DEV DEP SECT BASE   Y02072 07487902
         USING UCBOB,WKREG1             UCB ADDRESSABILITY       Y02072 07492002
         CLI   UCBTBYT4,UCB23051        IS DEVICE 2305-1?        Y02072 07494002
         BE    ISSUESVC                 IF 2305,WA,FIXED,GO ENQ  Y02072 07496002
         CLI   UCBTBYT4,UCB23052        IS DEVICE 2305-2?        Y02072 07498002
         BNE   EXCP                     NO, GO ISSUE EXCP        Y02072 07500002
         DROP  DEBREG,WKREG1                                     Y02072 07513802
*                                                                       07513902
*      SVC 53 (EXCLUSIVE CONTROL) WILL BE ISSUED. IGC0005C EXPECTS      07515102
*      REG 1 TO CONTAIN THE IOB ADDRESS, COMPLEMENTED.                  07517102
*                                                                       07518302
ISSUESVC EQU   *                        GO TO XCLUSIVE CNTRL MOD Y02072 07518702
         LCR   PARAM,IOBREG             LOAD COMPLEMENT OF IOB   Y02072 07527202
*                                                                       07527602
         SVC   53                       GO TO ENQ RECORD         Y02072 07528002
*                                                                       07528102
         B     RSTOR                    RETURN TO THE USER       Y02072 07528402
*********************************************************************** 07528502
*                                                                       07533002
EXCP     LR    PARAM,IOBREG             LOAD IOB ADDR AS THE PARAMETER  07537502
         EXCP  (1)                                                      07542002
*                                                                       07546502
RSTOR    RETURN (14,12),T,RC=0                                          07551002
*                                                                       07555502
*                                                                       07560000
*********************************************************************** 07570002
*    THE FOLLOWING ROUTINE COMPLETES THE PROCESSING OF AN INVALID       07580000
*     REQUEST AND RETURNS TO THE USER.                                  07600000
*********************************************************************** 07610002
*                                                                       07620000
LATERR   TM    IOBDAVLI,AVLMSK          IF THE AVAILABILITY BIT IS SET  07640002
         BO    FRMPOOL                  THIS IOB IS LINKED TO THE POOL  07660002
         LH    PARAM2,IOBDIOBS          SET SIZE PARAMETER FOR FREEMAIN 07680002
         LR    PARAM,IOBREG             SET ADDRESS PARAMETER           07700002
         FREEMAIN R,LV=(0),A=(1)                                        07720000
         B     ABORT                                                    07740000
*                                                                       07760000
FRMPOOL  EQU   *                                                        07780000
         MVI   IOBDAVLI,0               AVAILABLE                       07800002
ABORT    AH    INTRET,INVREQ            SET INVALID REQUEST EXCEPT CODE 07820002
         SR    WKREG2,WKREG2            ZERO OUT THE IOB POINTER FIELD  07840002
         ST    WKREG2,DECIOBPT          OF THE DECB                     07860002
         LR    PARAM2,INTRET            POSITION THE POST CODE          07880002
         SLL   PARAM2,8                 (EXCEPTION CODES)               07900002
         LR    PARAM,DECBREG            LOAD ECB ADDRESS PARAMETER      07920002
         MVI   0(PARAM),0               AND CLEAR THE OLD POST CODE AND 07940000
         LA    PARAM,0(0,PARAM)         CLEAR HIGH ORDER BITS    A29259 07950019
         POST  (1),(0)                  POST.                           07960002
         B     RSTOR                    GO RESTORE REGISTERS AND RETURN 07980002
*                                                                       08000000
OPSMSK   DC    F'6'                     OPTIONS-READX,DYNAMIC BFR.      08020002
ZEROS    EQU   OPSMSK                   PLUS ZEROS FOR COMPARING.       08040000
*                                                                       08060000
INVID    DC    X'08'                    INVALID ZERO ID                 08080002
INVOPT   DC    X'02'                    INVALID OPTIONS                 08100002
INVWRT   DC    X'40'                    WRITE TO INPUT DATA SET         08120002
INVLIMCT DC    X'20'                    EXTENDED SEARCH, LIMIT IS ZERO  08140002
INVREQ   DC    H'4096'                  INVALID REQUEST BIT             08160002
*                                                                       08180000
K49      DC    H'49'                    CONSTANT 49                     08200002
INVKEY   DC    X'04'                    KEYS ARE MISSING                08220002
AVLMSK   EQU   X'80'          IOB AVAILABILITY FLAG                     08240000
FIXDMSK  EQU   X'40'          FORMAT 'F' DATA SET                       08260000
VFORM    EQU   X'80'          FORMAT 'V' DATA SET                       08280000
WRTMSK   EQU   15             DCB WAS OPENED FOR OUTPUT OR UPDATE       08300000
*                                                                       08320000
IOBSZ255 DC    H'255'                   COMPARATOR FOR IOB SIZE  20201  08330020
BASESZ   EQU   X'78'                    IOBBASE SIZE =120 BYTES  20201  08340020
ADDSZ    EQU   X'68'                    WRITE ADD =104 BYTES     YM2862 08350002
VERSZ    EQU   X'30'                    VERIFT SIZE INCREMENT =  20201  08360020
*                                       48                       20201  08370020
SFSZ     EQU   X'010'         SELF-FORMAT INCREMENT = 16 BYTES          08400000
XSCHSZ   EQU   X'028'         EXTENDED SEARCH (KEY) INCREMENT=   S19015 08410019
*                                       40 BYTE                  S19015 08420019
PFEXTSZ  EQU   X'60'                    PRE-FORMAT INCREMENT=96  20201  08440020
FDBSZ    EQU   X'038'                   FEEDBACK(K) INCR=56      20201  08443020
Q1       EQU   1                        ONE BYTE QUANTITY        20201  08446020
Q255     EQU   255                      255 BYTE QUANTITY        20201  08449020
RRINCR   EQU   8                                                 20201  08452020
FOUR     EQU   4                                                 20201  08455020
UCBADDR  EQU   32                                                20201  08458020
UCB23051 EQU   X'06'                    UCB TYPE BIT, 2305-1     Y02072 08460002
UCB23052 EQU   X'07'                    UCB TYPE BIT, 2305-2     Y02072 08462002
RECREDY  EQU   X'10'                                             20201  08464020
OLDOPTS  EQU   X'16'          READX + DYN BUFF + FEEDBACK      @YA19662 08465037
FF       EQU   X'FF'                                             20201  08467020
RDXCORE  DC    H'28'                    RD EXCLUSIVE ADDITIVE    20201  08470020
OFLINCR  EQU   8                       BYTES NECESSARY FOR OVERFLOW     08480000
*                                      RECORDS IN IOB(FOR EXTRA CCW)    08500000
*                                                                       08520000
RDADD    EQU   X'0A'          TEST FOR READ OR WRITE ADD                08540000
ADDKY    EQU   X'06'          TEST FOR KEY OR ADD                       08560000
RDXFDB   EQU   X'12'          TEST FOR READ EXCLUSIVE OR FEEDBACK       08580000
CPFLAG   EQU   X'42'          SET UNRELATED, COMMAND CHAIN BITS         08600000
SILI     EQU   X'20'         SUPPRESS INCORRECT LENGTH INDICATION       08620000
NOPCODE  EQU   X'03'     NO OP                                          08640000
ONE      EQU   X'01'                    COUNT OF ONE                    08660002
CCHN     EQU   X'40'                    COMMAND CHAIN BIT IN CCW        08680002
ENQPL    EQU   28                       ENQUE LIST LENGTH               08700000
CNVENTRY EQU   12                       ENTRY IN ADDR CONV RTN   A35339 08710021
*                                                                       08720000
         DROP  DECBREG,IOBREG,DCBREG,FDNBASE                     Y02072 08730002
         EJECT                                                          08740000
        TITLE 'IGG019KA-BDAM FOUNDATION MODULE, NO VS - ASI ROUTINE'    08750002
*                                                                       08760000
*                                                                       08780000
*  ASYNCHRONOUS INTERRUPT ROUTINE:                                      08800002
*        THIS ROUTINE IS ENTERED BY THE SUPERVISOR SO THAT BDAM MAY     08820002
*      COMPLETE THE PROCESSING OF A REQUEST.                            08840002
*      BDAM EXPECTS THE FOLLOWING REGISTER USAGE'                       08860002
*        1 RQE ADDRESS                                                  08880002
*       14 RETURN POINT                                                 08900002
*       15 ENTRY POINT OF THIS ROUTINE                                  08920002
*                                                                       08940000
         USING IECDFDNA,EPREG                                           08960000
*                                                                       09010002
R0       EQU   0                  PARAM REG ON RETURN FROM SVC53 Y02072 09062002
RIOB     EQU   2                  IOB ADDRESS                           09070001
RRQE     EQU   7                  RQE BASE REGISTER              Y02072 09080002
WORKR7   EQU   7                  WORK REGISTER                  Y02072 09090002
RETURN   EQU   9                  RETURN REGISTER FOR READX & ADD       09100001
READADD  EQU   10                 ENTRY POINT REG FOR READX & ADD       09120001
WORKR2   EQU   14                 WORK REGISTER IN ASI ROUTINE          09122002
RRETCODE EQU   15                 RETURN CODE REGISTER                  09126001
FREEDBUF EQU   57                 FREE DYNAMIC BUFFER SVC               09132001
*                                                                       09140000
IECDFDNA B     DASIA       ENTRY FROM SUPERVISOR                        09160002
         B     DASIB       ENTRY FROM SELF-FORMAT                       09180002
         B     DASIC       ENTRY TO CLEAN UP AND POST.                  09200002
         B     DASID       ENTRY TO POST (FROM SELF FORMAT MOD)  YM3850 09202002
*                          IF ERROR. SELF FORMAT ASSUMES THAT THE NEXT  09206002
*                          IOB ADDR IS SAVED IN REG 6 AND MUST BE MAIN- 09208002
*                          TAINED THROUGHOUT ASI PROCESSING ON THIS     09208402
*                          PATH. CONTROL IS RETURNED TO 19KM VIA        09208802
*                          THE ADDR PUT IN IOBDQPTR BY 19KM.            09209202
*                                                                       09210002
*                                                                       09220002
*                                                                       09230002
*                                                                       09240000
DASIA    EQU   *                                                        09260000
         LR    FDNBASE,EPREG            MOVE BASE TO TRANSPARENT REG.   09270002
         DROP  EPREG                                                    09272002
         USING IECDFDNA,FDNBASE         PICK UP NEW BASE                09274002
         LR    RRQE,PARAM               SAVE IOS RQE ADDRESS     Y02072 09280002
         USING RQE,RRQE                 RQE ADDRESSABILITY       Y02072 09290002
         L     PARAM,RQEIOB             GET IOB ADDRESS FROM RQE Y02072 09300002
         USING IOBSTDRD,PARAM           IOB ADDRESSABILITY       Y02072 09302002
         L     SAVE,IOBDCBPT            ESTABLISH DCB BASE       Y02072 09310002
         USING IHADCB,SAVE              DCB ADDRESSABILITY       Y02072 09312002
         LR    INTRET,RETREG            MOVE SUPERVISOR RETURN ADDRESS. 09320002
         L     DECBREG,IOBECBPT         GET DECB ADDRESS                09326002
         USING DECB,DECBREG                                             09332001
*                                                                       09334002
*********************************************************************** 09336002
*  THE FOLLOWING ROUTINE LINKS IOBS TO THE DCB POOL IF THEY WERE      * 09338002
*  OBTAINED BY GETMAIN. THEY ARE ADDED IN ORDER OF INCREASING SIZE.   * 09338402
*********************************************************************** 09338502
POOLIOB  EQU   *                        POOL THE IOB             Y02072 09338902
         L     WKREG3,IOBDPLAD          WAS IOB FROM POOL OR     Y02072 09339202
         LTR   WKREG3,WKREG3            OBTAINED BY GETMAIN      Y02072 09339602
         BNZ   INPOOL                   IF NOT 0,ALREADY IN POOL Y02072 09339702
*                                                                       09339802
POOL     EQU   *                        ADD NEW IOB TO IOB POOL  Y02072 09339902
         MVI   IOBDAVLI,UNAVALSW        MARK CURRENT IOB UNAVAIL Y02072 09341902
*                                       ABLE BEFORE ADD TO POOL  Y02072 09343902
         LA    PARAM,0(0,PARAM)         INSURE 0 HI-ORDER BYTE   A30797 09346602
         L     WKREG3,DCBIOBAD          PUT DCB POOL ADDRESS IN         09348602
         LA    WORKR2,NULL(WKREG3)      BOTH WORK REGS.                 09350602
LOOP     LA    WKREG3,NULL(WKREG3)      CLEAR HI BYTE.                  09352602
         LTR   WKREG3,WKREG3            ANY IOB'S BEYOND THIS.          09353002
         BZ    TSTEQ                    NO, GO TEST FOR FIRST IOB       09353102
*                                                                       09353202
*   PUT IOB ON POOL IN ORDER OF INCREASING SIZE. PUT NEW IOB IN QUEUE   09359902
*   AS THE FIRST IOB IN THAT SIZE GROUP.                                09361902
*                                                                       09363902
         CLC   IOBDIOBS,IOBDIOBS-IOBSTDRD(WKREG3)                       09365902
         BH    SEENEXT1                 NEW IOB IS LARGER               09366302
         IC    PARAM2,IOBDAVLI          SAVE AVAILABILITY BYTE   Y02072 09367402
         SLL   PARAM2,SHFT3BYT          WHILE STORING INTO       Y02072 09369402
         OR    WKREG3,PARAM2            IOB CHAINING FIELD       Y02072 09369802
         ST    WKREG3,IOBDPLAD          STORE NXT IOB ADDR IN    A30797 09370102
         LA    WKREG3,0(WKREG3)         CLR TOP BYTE TO COMPARE  Y02072 09372102
TSTEQ    CR    WKREG3,WORKR2            IF EQUAL, THIS IOB IS THE       09373202
         BE    FIRSTIOB                 FIRST ONE TO BE POOLED          09375202
*                                                                       09377202
*   RELINK THE POOL CHAIN WITHOUT DESTROYING THE AVAILABILITY FLAG.     09379202
*                                                                       09379602
         IC    PARAM2,IOBDAVLI-IOBSTDRD(WORKR2)                   21905 09379702
         SLL   PARAM2,SHFT3BYT                                          09379802
         OR    PARAM,PARAM2                                       21905 09380002
         ST    PARAM,IOBDPLAD-IOBSTDRD(WORKR2)                          09389902
         LA    PARAM,0(PARAM)           CLEAR TOP BYTE-NOT NEG   YM1458 09399902
         B     INPOOL                   CONTINUE IOB PROCESSING  Y02072 09403202
*                                                                       09405202
FIRSTIOB ST    PARAM,DCBIOBAD           INSERT THIS IOB AS TOP OF CHAIN 09405602
         B     INPOOL                   CONTINUE IOB PROCESSING  Y02072 09406402
SEENEXT1 LR    WORKR2,WKREG3            SAVE THE ADDRESS OF PRIOR LINK, 09406502
         L     WKREG3,IOBDPLAD-IOBSTDRD(WKREG3)  LOAD THE ADDRESS OF    09406602
*                                       THE NEXT IOB IN POOL            09409902
         B     LOOP                     GO TEST LINK ADDRESS = ZERO     09411902
*                                                                       09412302
*********************************************************************** 09412402
*                                                                       09413202
INPOOL   EQU   *                        TEST FOR ERRORS          Y02072 09413302
         TM    IOBSTAT1,IOBNEWVL        DID END OF EXTENT CAUSE ASI     09413402
         BZ    TSTERR                   NO, CONTINUE LOOKING FOR CAUSE. 09416702
         XI    IOBSTAT1,IOBNEWVL+IOBABNRM   CLEAR EXCP AND ABNORM BITS  09420002
         L     DECBREG,IOBECBPT         LOAD USER DECB ADDR      Y02072 09424002
         ST    DECBREG,IOBDQPTR         SAVE IT IN IOB TO BE     Y02072 09426002
*                                       RESTORED BY CEA OR EOE   Y02072 09428002
         LA    WKREG2,IOBCSW+3          GET CSW ADDRESS TO USE   Y02072 09432002
         ST    WKREG2,IOBECBPT          AS DUMMY ECB FOR IOS     Y02072 09434002
         EXCP  (1)                      RESTART THE CHANNEL PROGRAM     09440000
         BR    INTRET                   GO BACK TO SUPERVISOR.   Y02072 09480002
*                                                                       09500000
TSTERR   EQU   *                        IS THERE AN ERROR        Y02072 09570002
         DROP  RRQE                                              Y02072 09582802
         ST    INTRET,IOBDQPTR          SAVE SUPVERVISOR RETURN IN IOB. 09636902
         TM    IOBSTAT1,IOBABNRM        WAS THIS ABNORMAL COMPLETION    09640002
         BO    ASIERR                   BRANCH IF YES                   09660000
         TM    IOBDTYPE,IOBRDEXC        IS READX EXCLUSIVE SPECIFIED    09680002
         BO    ENQRCD                   YES CHECK IF RECORD ENQ'D       09700000
         TM    IOBDTYP2,IOBADDTY        IS WRITE ADD SPECIFIED          09720002
         BZ    ASI2NDEN                 NO TEST FOR CHANNEL PROGRAM END 09740000
         TM    DCBRECFM,DCBRECV         IS THIS FIXED LENGTH RECORDS    09760002
         BZ    ASI2NDEN                 YES, TEST FOR CHANNEL PROG. END 09780000
ENQRCD   EQU   *                                                        09800000
         TM    IOBDTYP2,IOBRQUST+IOBADDTY  IS THIS A READ OR WRITE ADD  09820002
         BZ    ASI2NDEN                 NO TEST FOR CHANNEL PROGRAM END 09840000
         TM    IOBSTAT1,IOBENQUE        HAS RECORD BEEN OBTAINED YET    09860002
         BO    ASI2NDEN                 YES-GO TEST FOR PROGRAM END     09880002
         TM    IOBDTYP2,IOBADDTY        IS THIS A WRITE ADD       13513 09883002
         BO    ENQUEUE                  YES--ENQUEUE IT           13513 09886015
         CLC   IOBDCPND+SKPHIBYT(CMP3BYTS),IOBCSW     CHANNEL           09889001
*                                               PROGRAM FINISHED?       09891002
         BNE   ASIERR2                  NO RECORD FOUND           24512 09892018
         B     ENQUEUE                  ELSE GO ENQ RECORD       Y02072 09894002
*                                                                       09894402
*                                                                       09894802
ASI2NDEN CLC   IOBDCPND+SKPHIBYT(CMP3BYTS),IOBCSW     WAS CHANNEL       09960001
*                                                 PROGRAM FINISHED?     09962001
         BE    DASIE                    BRANCH IF COMPLETE              09980000
         TM    IOBDTYP2,IOBADDTY         IS THIS A WRITE ADD            10000002
         BZ    ASIERR2                  BRANCH IF AN ERROR        24512 10020018
         TM    DCBRECFM,DCBRECV         FIXED LENGTH RECORDS            10040002
         BZ    ASIERR2                  IF SO, AN ERROR OCCURRED  24512 10060018
         L     READADD,DCBDFOR          GET BASE OF SELF FORMAT MODULE  10080002
         B     ASIWAENT(READADD)        AND BRANCH TO IT                10100002
*                                                                       10120000
DASIB    TM    IOBDTYPE,IOBRDEXC+IOBFDBCK  IF NOT READ EXCLUSIVE OR     10140002
         BZ    DASIC                    FEEDBACK OPTION, SKIP NEXT RTN. 10160002
*                                                                       10180000
*                                                                       10190002
*  THE FOLLOWING ROUTINE LOCATES OR DEVELOPS ACTUAL ADDRESS FOR USE AS  10200000
*     FEEDBACK AND/OR READ EXCLUSIVE ARGUMENT                           10220000
*                                                                       10230002
*                                                                       10240000
         TM    IOBSTAT1,IOBADDVU        IS THIS A SELF FORMAT ADD       10260002
         BO    TSTEXIT                  YES-SKIP MOVING FEEDBACK        10280000
         MVC   IOBSEEK+2(6),IOBDNRCF+1  ELSE MV ACTUAL TO COMMON FIELD  10300002
*                                                                       10320000
*  IF THIS WAS A WRITE TO RELEASE AN EXCLUSIVE RECORD, GO TO THE READ   10340000
*   EXCLUSIVE MODULE WITHOUT TESTING FOR FEEDBACK TO BE RETURNED.       10360000
*                                                                       10380000
TSTEXIT  TM    IOBDTYP2,IOBRQUST        IS THIS A READ OR WRITE         10400002
         BO    TSTFDB                   READ, GO TEST FOR FEEDBACK      10420002
         TM    IOBDTYPE,IOBRDEXC        WRITE AND EXCLUSIVE BITS SET,   10440002
         BO    RDXEXIT                  GO TO THE READX MODULE          10460002
TSTFDB   TM    DCBOPTCD,DCBOPTF         DCB DOES NOT SPECIFY            10480002
         BZ    ACTFDBK                  FEEDBACK                        10500002
         TM    IOBDTYPE,IOBACTAD        OR ADDRESSING IS ACTUAL         10520002
         BZ    TSTRR                    RETURN                          10540002
ACTFDBK  L     WKREG3,IOBECBPT          ACTUAL ADDRESS                  10560002
         L     WKREG3,DECRECPT-DECB(WKREG3)  AS                         10580002
         MVC   0(8,WKREG3),IOBSEEK      FEEDBACK.                       10600002
         B     DASIC                    GO TEST FOR DYNAMIC BUFFERING   10620000
DASIE    TM    IOBDTYPE,IOBRDEXC        IS THIS A READX                 10640002
         BO    DASIB                    BRANCH IF YES                   10660000
         TM    IOBDTYP2,IOBRQUST        IS THIS A READ                  10680002
         BO    DASIB                    BRANCH IF YES                   10700000
         TM    IOBDTYP2,IOBADDTY        IS THIS WRT ADD REQUEST  Y02072 10760002
         BZ    DASIB                    BRANCH IF NO                    10780000
         TM    DCBRECFM,DCBRECV         IS THIS V OR U FORMAT    Y02072 10782002
         BO    DEQUEUE                  YES,GO DEQ R0 FOR V,U    Y02072 10782402
         L     DEBREG,DCBDEBAD          GET DEB ADDRESS          Y02072 10782802
         USING DEBBASIC,DEBREG          DEB ADDRESSABILITY       Y02072 10783202
         LA    WKREG1,DEBBASND          GET ADDR OF DEV SECT     Y02072 10783302
         USING DEBDASD,WKREG1           EST BASE FOR DEVICE SECT Y02072 10783402
         L     WKREG1,DEBUCBAD          GET UCB ADDRESS,1ST EXT  Y02072 10783602
         DROP  WKREG1                   DROP DEV SECT BASE       Y02072 10784002
         USING UCBOB,WKREG1             UCB ADDRESSABILITY       Y02072 10784502
         CLI   UCBTBYT4,UCB23051        IS DEVICE 2305-1?        Y02072 10786502
         BE    DEQUEUE                  YES, MUST DEQ R0 THEN    Y02072 10786902
         CLI   UCBTBYT4,UCB23052        IS DEVICE 2305-2?        Y02072 10787302
         BE    DEQUEUE                  YES, MUST DEQ R0 THEN    Y02072 10788002
         B     DASIB                    NO, NO EXCLUSIVE CONTROL Y02072 10790002
         DROP  WKREG1,DEBREG            DROP UCB,DEB BASES       Y02072 10792002
*                                                                       10794302
         SPACE 2                                                        10794702
*********************************************************************** 10796002
*  THE FOLLOWING ARE THREE EXITS TO THE READ EXCLUSIVE MODULE, SVC 53 * 10798002
*  (IGC0005C). THE FIRST SVC CALL IS ISSUED TO ENQUEUE ON A RECORD    * 10798402
*  WHEN READ EXCLUSIVE OR WRITE ADD HAS BEEN REQUESTED.  THE SECOND   * 10798802
*  SVC CALL IS ISSUED TO DEQUEUE A BLOCK OBTAINED DURING WRITE ADD    * 10799202
*  PROCESSING.  THE THIRD SVC CALL IS ISSUED TO DEQUEUE A BLOCK READ  * 10799602
*  IN DURING READ EXCLUSIVE (I.E. WRITE RELEASE). IGC0005C EXPECTS    * 10799702
*  THAT REGISTER 1 WILL CONTAIN THE IOB ADDRESS,COMPLEMENTED.         * 10799902
*********************************************************************** 10808602
ENQUEUE  EQU   *                        ENQUEUE ON BLOCK         Y02072 10850002
         LCR   PARAM,PARAM              REG 1,IOB -COMPLEMENTED  Y02072 10851202
*                                                                       10851602
         SVC   53                       GO ENQUEUE CURRENT REC   Y02072 10851702
*                                                                       10851802
         SVC   EXIT                     RETURN TO SUPERVISOR            10851902
*                                                                       10853902
DEQUEUE  EQU   *                        DEQUEUE WRITE ADD REQ    Y02072 10856402
         LR    RIOB,PARAM               SAVE IOB REG IN R2       Y02072 10856602
         LCR   PARAM,PARAM              REG 1,IOB -COMPLEMENTED  Y02072 10856802
         DROP  PARAM                    DROP IOB BASE FOR SVC    Y02072 10857202
*                                                                       10858502
         SVC   53                       GO DEQUEUE CURRENT REC   Y02072 10858802
*                                                                       10859102
         LR    PARAM,RIOB               RESTORE IOB REG          Y02072 10859202
         USING IOBSTDRD,PARAM           REESTABLISH ADDRESSING   Y02072 10859302
         TM    DCBRECFM,DCBRECV         VAR,UNDEF RECORD FORMAT? Y02072 10861302
         BNO   CHKERR                   NO,GO CHECK IF ERR       YM6585 10863302
         LTR   R0,R0                    IS THERE NEXT IOB?       Y02072 10863402
         BZ    DASIB                    NO,GO CHECK DYN BUF      Y02072 10863502
         LR    PARAM,R0                 PUT NEXT IOB IN R1;19KM  Y02072 10863602
*                                       ALSO EXPECTS ITS BASE    Y02072 10865602
*                                       IN R10, THE DCB IN R13   Y02072 10865802
         L     READADD,DCBDFOR          ADDR OF 19KM,SELF FORMAT Y02072 10865902
         B     ASIWAENT(READADD)        BR TO FORMAT MOD         Y02072 10867902
CHKERR   EQU   *                        2305 ERROR CHECK         YM6585 10869902
         TM    IOBSTAT2,ALLMSK          WERE THERE ANY ERRORS    YM6585 10870302
         BNO   DASIB                    NO, GO GET FDBACK THEN   YM6585 10870702
         B     DASIC                    YES,JUST FREE BUF & POST YM6585 10874802
*                                                                       10879102
RDXEXIT  EQU   *                        DEQUEUE WRT REL REQ      Y02072 10883202
         LR    RIOB,PARAM               SAVE IOB REG IN R2       Y02072 10887302
         LCR   PARAM,PARAM              REG 1,IOB -COMPLEMENTED  Y02072 10891402
         DROP  PARAM                    DROP IOB BASE FOR SVC    Y02072 10895502
*                                                                       10899602
         SVC   53                       GO DEQUEUE CURRENT REC   Y02072 10899702
*                                                                       10899802
         LR    PARAM,RIOB               RESTORE IOB REG          Y02072 10899902
         USING IOBSTDRD,PARAM           REESTABLISH ADDRESSING   Y02072 10906602
         B     DASIC                    CHECK FOR DYNAMIC BUFFERING     10913302
*                                                                       10920000
*********************************************************************** 10930002
*                                                                       10932002
TSTRR    LA    INTRET,DASIC             SET UP TO TEST FOR DYN. BUFF.   10940000
*                                       ON RETURN FROM ADDR CONVERSION  10960000
         TM    IOBDTYPE,IOBRELBL        IS RELATIVE RECORD BEING        10980002
         BZ    RTEXIT                   USED,NO-GO TO RELATIVE TRACK    11000002
         L     EPREG,DCBDFBK            LOAD ENTRY POINT OF FEEDBACK    11020002
         BR    EPREG                    MODULE AND GO THERE             11040002
*                                                                       11060000
RTEXIT   L     EPREG,DCBREAD            LOCATE THE                      11080002
         L     EPREG,8(0,EPREG)         ADDR OF RELATIVE TRACK MODULE   11100002
         BR    EPREG                    AND GO THERE             Y02072 11130002
*                                                                       11140000
*                                                                       11160000
DASIC    TM    IOBDTYP2,IOBRQUST        IS THIS A READ REQUEST          11180002
         BO    MAKEAVL                  YES-MAKE IOB AVAILABLE   Y02072 11200002
         TM    IOBDTYPE,IOBDYNBF        NO-TEST FOR DYN. BUFFERING      11220002
         BZ    MAKEAVL                  NO-MAKE IOB AVAILABLE    Y02072 11240002
*                                                                       11260021
*                       FREE DYNAMIC BUFFER                             11264021
*                                                                       11268021
         LR    SAVE,PARAM               SAVE IOB POINTER         XM5413 11270001
         USING IOBSTDRD,SAVE                                            11272001
         L     PARAM2,IOBECBPT          ADDR OF DECB             A30797 11276002
         L     PARAM,IOBDCBPT           ADDR OF DCB              A30797 11280002
         FREEDBUF (0),D,(1)             ISSUE FREEDBUF SVC CALL  A30797 11284002
         LR    PARAM,SAVE               RESTORE IOB POINTER      A30797 11288002
         USING IOBSTDRD,PARAM                                           11290001
         L     SAVE,IOBDCBPT            RESTORE DCB POINTER      A30797 11292002
         USING IHADCB,SAVE                                              11294002
*                                                                       11296002
DASID    EQU   *                        ENTRY FOR POST ROUTINE   YM3850 11298002
*                                                                       11300000
*  THE FOLLOWING ROUTINE POSTS THE ECB COMPLETE AND ZEROS THE IOB       11322002
*  AVAILABILITY BYTE IN THE IOB.                                        11324002
*                                                                       11380000
MAKEAVL  SR    PARAM2,PARAM2            CLEAR FOR EXCEPTION CODES.      11460002
         IC    PARAM2,IOBSTAT2          INSERT EXCEP CODES FROM THE IOB 11480002
         SLL   PARAM2,16                POSITION THEM FOR POST.         11500002
         LR    RIOB,PARAM               SAVE IOB REG IN POST     Y02072 11550002
         DROP  PARAM                                             Y02072 11560002
         USING  IOBSTDRD,RIOB           NEW BASE FOR IOB         Y02072 11570002
         L     FDNBASE,IOBDQPTR         LOAD SAVED SUPER RETURN  YM5969 11580002
         L     PARAM,IOBECBPT           SET DECB PARAMETER              11600002
*                                                                       11620000
         POST  (1),(0)                  AND POST.                       11640000
*                                                                       11680000
         TM    DCBMACRF,DCBMRCK         IS CHECK MACRO SPECIFIED Y02072 11692002
         BOR   FDNBASE                  YES, RETURN DIRECTLY     Y02072 11694002
         MVI   IOBDAVLI,NULL            ELSE, MAKE IOB AVAILABLE Y02072 11696002
         BR    FDNBASE                  RETURN TO SUPERVISOR     Y02072 11698002
         DROP  RIOB                     DROP TEMPORARY IOB BASE  Y02072 11698402
         USING IOBSTDRD,PARAM           REESTABLISH OLD IOB BASE Y02072 11698802
*                                                                       11700000
*                                                                       12360000
*    THE FOLLOWING ROUTINE DETERMINES THE CAUSE OF ABNORMAL COMPLETION  12380000
*     BY ANALYZING THE SENSE BYTES AND CSW STORED IN THE IOB BY IOS.    12400002
*                                                                       12420000
*                                                                       12440000
ASIERR   TM    IOBSTAT2,ALLMSK          HAS ERROR ALREADY BEEN FLAGGED  12460002
         BC    4,ERREXIT                IF YES , EXIT                   12480002
         TM    IOBCSW+3,UCMSK           TEST FOR UNIT CHECK             12500002
         BZ    TSTEXC                   BR. IF NOT                      12520002
         TM    IOBSENS0,DCMSK           TEST FOR DATA CHECK             12540002
         BO    SETUDC                   BRANCH IF YES                   12560002
         TM    IOBSENS1,NRMSK           TEST NO RECORD FOUND            12580002
         BZ    SETUE                    IF NOT SET, MUST BE UNRELATED   12600002
ASIERR2  OI    IOBSTAT2,NOREC           SET NO RECORD FOUND EX. CODE    12620002
         TM    IOBDTYP2,IOBADDTY        IS TYPE WRITE ADD               12640002
         BZ    DASIC                    NO, RETURN TO POOLING ROUTINE   12660002
         XI    IOBSTAT2,FLIPMSK         MV NRF TO NO-SPACE-FND   YM5893 12662002
         TM    DCBRECFM,DCBRECV         IS RECFM V,U             YM6585 12670002
         BO    DASIC                    YES, GO RETURN           YM5893 12672002
         TM    IOBSTAT1,IOBENQUE        NO, IS THE ENQUE BIT ON  YM6585 12674002
*                                       COULD ONLY BE ON FOR     YM6585 12676002
*                                       FIXED FORMAT IF 2305     YM6585 12678002
         BNO   DASIC                    NO, GO FREE BUF & POST   YM6585 12678402
         B     DEQUEUE                  YES, GO DEQUEUE REQUEST  YM6585 12678802
*                                       SINCE ENQ'D ON WHOLE DS  YM6585 12678902
*                                                                       12720000
SETUDC   OI    IOBSTAT2,UNCOR           SET UNCORRECTABLE DATA CHECK    12740002
         B     ERREXIT                  GO TEST FOR EXIT                12760002
*                                                                       12780000
TSTEXC   EQU   *                                                        12800000
         TM    IOBCSW+4,INCLMSK         WAS THE RECORD WRONG LENGTH     12820002
         BO    SETINCL                  IF YES GO SET FLAG              12840002
SETUE    OI    IOBSTAT2,UNREL           SET UNRELATED ERROR FLAG        12860002
*                                                                       12880000
ERREXIT  TM    IOBSTAT1,IOBADDVU        IF THIS WAS A FORMAT WRITE,     12900002
         BO    DASID                    GO POST & RETURN       @ZA15675 12920037
         TM    IOBSTAT2,INCLMSK+ENDOD   IF INCORRECT LENGTH OR END OF   12940002
         BC    7,DASIB                  DATA SET, GO CHECK FEEDBACK     12960000
         B     DASIC                    ELSE BYPASS FEEDBACK TEST       12980002
*                                                                       13000000
SETINCL  OI    IOBSTAT2,LGNCK           SET INCORRECT LENGTH EXCEPTION  13020002
         B     ERREXIT                  CODE, GO DETERMINE EXIT         13040000
*                                                                       13060000
         EJECT                                                          13070002
*********************************************************************** 13072002
*                   CONSTANTS AND EQUATES                             * 13080002
*********************************************************************** 13082002
EIGHT    DC    F'8'                                                MC0J 13086000
ASIWAENT EQU   8                        OFFSET IN FORMAT MOD,ASI Y02072 13088002
EADCCW  EQU   X'06'                                               MC0J  13092002
EXIT     EQU   3                        SVC NUMBER TO RETURN TO SUPERV. 13100000
RTRKOFFS EQU   4                        OFFSET TO REL TRK ENTRY  Y02072 13190002
*                                       IN CONVERT ROUTINE       Y02072 13190402
SKPHIBYT EQU   X'01'                    TO START AT SCND BYTE OF WORD   13190802
*                                       FOR THREE BYTE COMPARES         13191202
CMP3BYTS EQU   X'03'                    USED FOR THREE-BYTE COMPARES    13191602
UNAVALSW EQU   X'FF'                    IOB UNAVAILABLE SWITCH          13192002
SCNDHALF EQU   X'04'                    SECOND HALF OF CCW              13192402
FLIPMSK  EQU   X'A0'                    NO RECORD FOUND TO NO SPACE     13320002
ALLMSK   EQU   X'FF'                    TEST FOR EXCEPTION CODES        13400002
INCLMSK  EQU   X'40'                    INCORRECT LENGTH                13420002
NRMSK    EQU   X'08'                    NO RECORD FOUND                 13440002
UCMSK    EQU   X'02'                    UNIT CHECK                      13460002
DCMSK    EQU   X'08'                    DATA CHECK                      13480002
*              EXCEPTION CODES                                          13560000
NOREC    EQU   X'80'                                                    13580000
LGNCK    EQU   X'40'                                                    13600000
NOSPA    EQU   X'20'                                                    13620000
INVAL    EQU   X'10'                                                    13640000
UNCOR    EQU   X'08'                                                    13660000
ENDOD    EQU   X'04'                                                    13680000
UNREL    EQU   X'02'                                                    13700000
*              OPTIONS AND TYPE                                         13720000
VERIFY   EQU   X'80'                                                    13740000
OFLOW    EQU   X'40'                                                    13760000
EXSCH    EQU   X'20'                                                    13780000
FEEDB    EQU   X'10'                                                    13800000
ACTAD    EQU   X'08'                                                    13820000
DYNBF    EQU   X'04'                                                    13840000
READX    EQU   X'02'                                                    13860000
RELRD    EQU   X'01'                                                    13880000
KEYOP    EQU   X'80'                                                    13900000
LGNOP    EQU   X'40'                                                    13920000
READ     EQU   X'08'                                                    13940000
KEY      EQU   X'04'                                                    13960000
ADD      EQU   X'02'                                                    13980000
SHFT3BYT EQU   24                       SHIFT TO TOP BYTE OF REG Y02072 13990002
NULL     EQU   0                        0 OFFSET                 Y02072 13992002
MODID    DC    C'IGG019KA'              MODULE ID                Y02072 13992102
FIX      DC    C' OZ28786'              LATEST FIX             @ZA08000 13992237
DATE     DC    C'&SYSDATE'              DATE OF LATEST FIX     @ZA08000 14000637
PATCH    DC    XL((*-IGG019KA)/20)'0'   5% PATCH AREA            Y02072 14018002
         EJECT                                                          14026402
*********************************************************************** 14034802
*                            DSECTS                                   * 14043202
*********************************************************************** 14051602
         DCBD  DSORG=DA                                                 14060000
         EJECT                                                          14080000
         IHADECB                                                        14100001
         EJECT                                                          14190002
         IECDRQE                                                 Y02072 14240002
         EJECT                                                          14320000
         IEFUCBOB  LIST=YES                                      Y02072 14330002
         EJECT                                                          14332002
         IEZIOB                                                         14340001
CCW1     DS    D                  CHANNEL COMMAND # 1                   14390001
CCW2     DS    D                  CHANNEL COMMAND # 2                   14392001
CCW3     DS    D                  CHANNEL COMMAND # 3                   14394001
         ORG   IOBDAYLI           ********************                  14400001
IOBDAVLI DS    B                  ******************                    14460001
         ORG   IOBDQPTR+4         *******************                   14520001
IOBUPLIM DS    XL8                ******************                    14580001
IOBDNRCF DS    CL8                ******************                    14640001
         ORG   IOBSTAT2                                                 14760001
OTHERERR EQU   BIT6               ERROR INDICATED IN NXT 2 BYTES        14820001
         IKJTCB                                                         15120001
         EJECT                                                          15260000
         IEZDEB                                                  Y02072 15270002
         END                                                            15900000
./  ADD  SSI=31840081,NAME=IGG019KC
 TITLE   'IGG019KC - BDAM RELATIVE TRACK CONVERSION MODULE'             00060002
IGG019KC CSECT                                                          00070002
*MODULE NAME - IGG019KC                                               * 00070402
*                                                                     * 00070802
*DESCRIPTIVE NAME - BDAM RELATIVE TRACK CONVERSION AND FEEDBACK MODULE* 00071202
*                                                                     * 00071602
*COPYRIGHT - NONE                                                     * 00071702
*                                                                     * 00071802
*CHANGE ACTIVITY                                                      * 00071902
*                                                                     * 00076402
*                                                                     * 00081002
*        OS REL 21 CHANGES/DELETIONS                                    00083002
*4093002800,016600                                               A35339 00083402
*        VS 1-1 CHANGES/DELETIONS                                       00085002
*        VS 2-1 CHANGES/DELETIONS                                       00085402
*        VS 1-2 CHANGES/DELETIONS                                       00089002
*        VS 2-2 CHANGES/DELETIONS                                       00091002
*016400-016640,037500                                            Y02072 00091402
*                                                                     * 00091802
*STATUS- CHANGE LEVEL 1                                               * 00092802
*                                                                     * 00094802
*FUNCTION/OPERATION- THIS MODULE IS LOADED IF THE DCB INDICATES THAT  * 00100000
*   ADDRESSING IS BY RELATIVE TRACK (TT OR TTR), AND IS COMPOSED OF   * 00120000
*   TWO ROUTINES. 1.CONVERT TTR TO AN ACTUAL (MBBCCHHR) ADDRESS PRIOR * 00140000
*   TO EXECUTING THE I/O REQUEST.                                     * 00160000
*   2.CONVERT AN ACTUAL ADDRESS TO A TTR VALUE FOR FEEDBACK AFTER THE * 00180000
*   REQUEST HAS COMPLETED SUCCESSFULLY.                               * 00200000
*                                                                     * 00220000
*ENTRY POINTS- THE ENTRY TO THE FIRST ROUTINE (TTR TO ACTUAL) IS      * 00240000
*   'IECDRTB' WITH THE CALLING SEQUENCE,  L     15,8(IGG019KA BASE)   * 00260000
*                                         BAL   14,4(15)              * 00280002
*   THE  ENTRY TO THE SECOND ROUTINE (ACTUAL TO TTR) IS 'IGG019KC'    * 00300000
*   (IECDRT) WITH THE CALLING SEQUENCE    L     15,8(IGG019KA BASE)   * 00320000
*                                         BALR  14,15                 * 00340000
*                                                                     * 00346002
*                                                                     * 00360000
*INPUT- FOR THE FIRST ROUTINE THE REGISTERS ARE SET AS FOLLOWS,       * 00380000
*   3 - DEB ADDRESS                                                   * 00400000
*   4 - DCB ADDRESS                                                   * 00420000
*   5 - DECB ADDRESS                                                  * 00440000
*   7 - IOB ADDRESS                                                   * 00460000
*   11- BASE ADDRESS FOR MODULE IGG019KA (FOUNDATION MODULE)          * 00480000
*                                                                     * 00500000
*   FOR THE SECOND ROUTINE THE FOLLOWING REGISTERS ARE INPUT,         * 00520000
*   1 - IOB ADDRESS                                                   * 00540000
*   13- DCB ADDRESS                                                   * 00560000
*                                                                     * 00580000
*OUTPUT- THE FIRST ROUTINE WILL PLACE MBBCCHHR INTO IOB SEEK ADDRESS. * 00600000
*   THE SECOND ROUTINE WILL PLACE TTR INTO THE USER'S BLKREF FIELD.   * 00620000
*                                                                     * 00640000
*EXTERNAL ROUTINES- 'IECPCNVT' IS USED TO CONVERT TTR TO ACTUAL.      * 00660000
*   'IECPRLTV' IS USED TO CONVERT ACTUAL TO A TTR VAUE.               * 00680000
*                                                                     * 00700000
*EXITS-NORMAL- 'D3EXIT1' IS THE NORMAL RETURN TO MODULE IGG019KA      * 00720000
*   AFTER AN ACTUAL ADDRESS HAS BEEN DEVELOPED AND STORED AT IOBSEEK. * 00740000
*   'D3EXIT2' IS THE RETURN TO THE ASYNCHRONOUS INTERRUPT ROUTINE IN  * 00760000
*   THE MODULE IGG019KA AFTER TTR FEEDBACK HAS BEEN DEVELOPED AND     * 00780000
*   STORED INTO THE USERS BLKREF FIELD.                               * 00800000
*                                                                     * 00820000
*EXIT-ERROR- 'D3EXIT3' IS AN EXIT TO THE INVALID REQUEST ERROR ROUTINE* 00840000
*   IN MODULE IGG019KA. A TT VALUE GREATER THAN THE NUMBER OF TRACKS  * 00860000
*   IN THE DATA SET HAS BEEN SPECIFIED TO THE TTR TO ACTUAL CONVERSION* 00880000
*   ROUTINE. REGISTER 12 IS USED TO PASS THE EXCEPTION CODE TO THE    * 00900000
*   ERROR ROUTINE.                                                    * 00920000
*                                                                     * 00940000
*TABLES/WORK AREAS- THE COMMUNICATION VECTOR TABLE IS USED TO LOCATE  * 00960000
*   THE ROUTINES, IECPCNVT AND IECPRLTV.                              * 00980000
*                                                                     * 01000000
*ATTRIBUTES- THE ROUTINE IS REENTRANT AND EXECUTED ENABLED WITH USER  * 01020002
*   PROTECTION KEY. IT IS REUSABLE.                                   * 01060002
*                                                                     * 01080000
*NOTES- REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT WITH THE * 01100000
*   MODULES, IGG019KA, IECPCNVT, IECPRLTV.                            * 01120000
*                                                                       01140000
*                                                                       01160000
         USING IGG019KC,EPREG                                           01180000
         USING IOBDEF,IOBREG                                            01200000
         USING DECBDEF,DECBREG                                          01220000
         USING IHADCB,DCBREG                                            01240000
*                                                                       01260000
*                                                                       01280000
*********************************************************************** 01290002
*  REGISTER USAGE                                                       01300000
*********************************************************************** 01310002
*                                                                       01320000
D3CONVR  EQU   0         RELATIVE TRACK PARAMETER                       01340000
PARAM    EQU   1         DEB ADDRESS PARAMETER, (ASI-PARAM=IOB ADDRESS) 01360000
ACTUAL   EQU   2         ACTUAL ADDRESS LOCATION PARAMETER              01380000
DEBREG   EQU   3         DEB ADDRESS                                    01400000
DCBREG   EQU   4         DCB ADDRESS                                    01420000
DECBREG  EQU   5         DECB ADDRESS                                   01440000
D3WKREG  EQU   6         WORK REGISTER                                  01460000
IOBREG   EQU   7         IOB ADDRESS                                    01480000
GPR9     EQU   9         CONVERSION ROUTINE WORK REGISTERS ARE 9-13     01500000
FDNBASE  EQU   11        BASE FOR THE FOUNDATION MODULE                 01520000
D3ASIRET EQU   12        RETURN TO ASI                                  01540000
SAVE     EQU   13        USER'S SAVE AREA , (ASI- SAVE=DCB ADDRESS)     01560000
RETREG   EQU   14        RETURN TO FOUNDATION                           01580000
EPREG    EQU   15        BASE FOR THIS MODULE                           01600000
         EJECT                                                          01620000
*                                                                       01640000
IECDRTA  BC    15,D3FDBK               GO TO THE FEEDBACK        A35339 01672021
*                                       ROUTINE                  A35339 01676021
*                                                                       01680000
IECDRTB  STM   GPR9,EPREG,IOBDNRCF     SAVE VOLATILE REGISTERS IN IOB   01700000
         LR    PARAM,DEBREG            SET DEB ADDR FOR CONVERSION RTN  01720000
         L     D3WKREG,DECRECPT        LOCATE USER'S ADDRESS AREA       01740000
         MVC   IOBDCPND(3),0(D3WKREG)  MOVE TTR TO ALIGN IT.            01760000
         TM    IOBDTYPE+1,KEYADD       IS TYPE ID                       01780000
         BC    8,*+8                    YES, LEAVE R AS STATED          01800000
         MVI   IOBDCPND+2,0             NO, MOVE A 0 TO R BYTE OF TTR   01820000
         L     D3CONVR,IOBDCPND        LOAD TTR0 TO CONVERSION REGISTER 01840000
         LA    ACTUAL,IOBSEEK          SET ACTUAL ADDRESS PARAMETER     01860000
D3LINK   EQU   *                                                        01880000
         L     EPREG,CVTPTR(0,0)       LOAD ADDRESS OF CONVERSION       01900000
         L     EPREG,CVTPCNVT-CVTDEF(0,EPREG) MODULE FROM COMM.         01920000
*                                             VECTOR TABLE              01940000
         BALR  RETREG,EPREG              AND GO THERE.                  01960000
*                                                                       01980000
         LTR   EPREG,EPREG             TEST FOR ANY ERROR RETURN CODE   02000000
         LM    GPR9,EPREG,IOBDNRCF      RESTORE REGISTERS               02020000
         BC    8,TSTPS2                IF NO ERROR, BRANCH              02040000
         IC    D3ASIRET,INVREF         INSERT CAUSE FLAG FOR INVALID    02060000
         L     RETREG,ERROFF(0,FDNBASE) REQUEST, LOCATE ERROR ROUTINE,  02080000
D3EXIT3  BCR   15,RETREG                AND BRANCH THERE                02100000
*                                                                       02120000
TSTPS2   TM    IOBDCPND+3,D3PASS1      TEST 2ND PASS, EXTENDED SEARCH   02140000
         BC    1,D3CLR                  BRANCH YES                      02160000
D3TSTXS  TM    IOBDTYPE,EXSCH          IF EXTENDED SEARCH OPTION,       02180000
         BC    1,D3LOOP                 GO CALCULATE LIMIT ADDRESS.     02200000
         MVC   IOBUPLIM(7),IOBSEEK     DUPLICATE SEEK AS SEARCH LIMIT   02220000
D3EXIT1  BCR   15,RETREG               RETURN TO THE FOUNDATION MODULE. 02240000
*                                                                       02260000
*   THE FOLLOWING ROUTINE  DEVELOPS THE LIMIT TTR FOR EXTENDED SEARCH   02280000
*     AND RETURNS TO THE CONVERSION ROUTINE TO DEVELOP IOBUPLIM (ACTL)  02300000
*                                                                       02320000
D3LOOP   CLC   DCBREL+1(2),DCBLIMCT+1  IS SEARCH FOR ENTIRE DATA SET    02340000
         BC    13,D3WRAP                YES, GO SET END EQUAL TO START  02360000
*                                                                       02380000
         L     D3CONVR,IOBDCPND        LOAD SEARCH STARTING CC          02400000
         SRL   D3CONVR,16               GET RID OF EXTRA BYTES          02420000
         MVC   IOBCSW+2(2),DCBLIMCT+1  ALIGN NUMBER OF TRACKS TO SEARCH 02440000
         A     D3CONVR,IOBCSW          ADD TO BEGINNING TRACK NUMBER    02460000
         MVC   IOBCSW+2(2),DCBREL+1    ALIGN DATA SET SIZE(IN TRACKS)   02480000
         C     D3CONVR,IOBCSW          ARE WE OUT OF THE DATA SET RANGE 02500000
         BC    4,D3SHFT                NO , CONTINUE                    02520000
         S     D3CONVR,IOBCSW          YES,SUBTRACT DATA SET SIZE FROM  02540000
*                                         UPPER LIMIT TO GET SEARCH END 02560000
D3SHFT   EQU   *                                                        02580000
         SLL   D3CONVR,16              SHIFT TT, R WILL BE 0            02600000
         OI    IOBDCPND+3,D3PASS1      SET EXT. SEARCH PASS 1 FLAG ON.  02620000
         LA    ACTUAL,IOBUPLIM         SET ACTUAL ADDRESS PARAMETER     02640000
         BC    15,D3LINK                GO LINK TO CONVERSION ROUTINE   02660000
*                                                                       02680000
D3WRAP   EQU   *                                                        02700000
         MVC   IOBUPLIM(7),IOBSEEK     SET LIMIT TO SEARCH ALL TRACKS   02720000
D3CLR    CLC   IOBSEEK(1),IOBUPLIM     ARE SEEK, LIMIT IN SAME EXTENT   02740000
         BC    7,D3DUMMY                 IF NOT, GO DUMMY R BYTE        02760000
         CLC   IOBSEEK+3(4),IOBUPLIM+3   DID SEARCH WRAP AROUND         02780000
         BC    4,D3EXIT1                             NO, GO EXIT        02800000
D3DUMMY  MVI   IOBUPLIM+7,X'FF'         SET R BYTE TO DUMMY VALUE       02820000
         B     D3EXIT1                  RETURN TO THE FOUNDATION MODULE 02840000
*                                                                       02860000
*  FEEDBACK ROUTINE                                                     02880000
*                                                                       02900000
*                                                                       02920000
D3FDBK   STM   GPR9,ACTUAL,IOBDNRCF-IOBDEF(PARAM) SAVE REGISTERS USED   02940000
         LA    ACTUAL,IOBSEEK-IOBDEF(0,PARAM) SET ACTUAL ADDR.PARAMETER 02960000
         L     PARAM,DCBDEBAD-IHADCB(0,SAVE) SET DEB ADDRESS PARAMETER  02980000
         L     EPREG,CVTPTR(0,0)       LOAD ADDRESS OF CONVERSION       03000000
         L     EPREG,CVTPRLTV-CVTDEF(0,EPREG) MODULE FROM COMM.         03020000
*                                             VECTOR TABLE              03040000
         BALR  RETREG,EPREG              AND GO THERE.                  03060000
*                                                                       03080000
         USING CNVRET,RETREG                                            03100000
CNVRET   EQU   *                                                        03120000
         SH    ACTUAL,IOBOFF           ESTABLISH IOB BASE ADDRESS       03140000
         ST    D3CONVR,IOBDCPND-IOBDEF(0,ACTUAL) SAVE THE RETURNED TTR  03160000
         LM    GPR9,ACTUAL,IOBDNRCF-IOBDEF(ACTUAL)  RESTORE THE         03180000
*                                                  REGISTERS USED       03200000
         L     EPREG,IOBECBPT-IOBDEF(0,PARAM) LOCATE USER'S ADDR. AREA  03220000
         L     EPREG,DECRECPT-DECBDEF(0,EPREG)    AND                   03240000
         MVC   0(3,EPREG),IOBDCPND-IOBDEF(PARAM) MOVE TTR TO HIS  AREA  03260000
D3EXIT2  BCR   15,D3ASIRET             GO BACK TO THE ASI ROUTINE.      03280000
*                                                                       03300000
*                                                                       03320000
         EJECT                                                          03322002
*********************************************************************** 03330002
*           CONSTANTS AND EQUATES                                     * 03340002
*********************************************************************** 03350002
IOBOFF   DC    AL2(IOBSEEK-IOBFLAG1)   OFFSET OF IOBSEEK                03360000
INVREF   DC    X'10'     TTR IS OUTSIDE OF DATA SET                     03380000
ERROFF   EQU   20        OFFSET TO ERROR ROUTINE ADCON.                 03400000
ENTRY1   EQU   X'20'     TEST FOR ENTRY FROM ASI                        03420000
D3PASS1  EQU   X'10'     MASK FOR FIRST PASS BIT                        03440000
KEYADD   EQU   X'06'     TEST FOR TYPE = KEY OR ADD                     03460000
*              OPTIONS AND TYPE                                         03480000
VERIFY   EQU   X'80'                                                    03500000
OFLOW    EQU   X'40'                                                    03520000
EXSCH    EQU   X'20'                                                    03540000
FEEDB    EQU   X'10'                                                    03560000
ACTAD    EQU   X'08'                                                    03580000
DYNBF    EQU   X'04'                                                    03600000
READX    EQU   X'02'                                                    03620000
RELRD    EQU   X'01'                                                    03640000
KEYOP    EQU   X'80'                                                    03660000
LGNOP    EQU   X'40'                                                    03680000
READ     EQU   X'08'                                                    03700000
KEY      EQU   X'04'                                                    03720000
ADD      EQU   X'02'                                                    03740000
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 03790002
         EJECT                                                          03820000
*********************************************************************** 03830002
*                           DSECTS                                    * 03832002
*********************************************************************** 03834002
CVTDEF   DSECT                                                          03840000
         CVT                                                            03860000
         EJECT                                                          03880000
         DCBD  DSORG=DA                                                 03900000
         EJECT                                                          03920000
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       03940000
         DS    0F                                                       03960000
DECBDEF  DSECT                                                          03980000
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        04000000
DECTYPE  DS    CL2            TYPE FIELD                                04020000
DECLNGTH DS    CL2            DATA LENGTH                               04040000
DECDCBAD DS    CL4            ADDRESS OF DCB                            04060000
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      04080000
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        04100000
DECKYADR DS    CL4            ADDRESS OF KEY                            04120000
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               04140000
         EJECT                                                          04160000
*                                                                       04180000
*      I/O BLOCK (IOB) DEFINITION                                       04200000
*                                                                       04220000
*              STANDARD IOB                                             04240000
         DS    0F                                                       04260000
IOBDEF   DSECT                                                          04280000
IOBFLAG1 DS    CL1            STATUS FLAG                               04300000
IOBFLAG2 DS    CL1            ERROR FLAG                                04320000
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       04340000
IOBECBPT DS    CL4            ECB POINTER                               04360000
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       04380000
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           04400000
         DS    CL1                                                      04420000
         DS    CL3                                                      04440000
IOBCSWST DS    CL2            STATUS BYTES                              04460000
IOBCSWCT DS    CL2            REMAINING COUNT                           04480000
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   04500000
IOBSIOCC DS    CL1            SIO CONDITION CODE                        04520000
         DS    CL3                                                      04540000
IOBDCBPT DS    0CL4           DCB POINTER                               04560000
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            04580000
         DS    CL3                                                      04600000
IOBRESTR DS    0CL4           RESTART POINTER                           04620000
         DS    CL1                                                      04640000
         DS    CL3                                                      04660000
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              04680000
IOBERRCT DS    CL2            ERROR COUNTER                             04700000
IOBSEEK  DS    CL8            SEEK ADDRESS                              04720000
*        BDAM EXTENDED IOB                                              04740000
*                                                                       04760000
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  04780000
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          04800000
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     04820000
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                04840000
         DS    CL3                                                      04860000
IOBDTYPE DS    CL2            TYPE FIELD                                04880000
IOBDSTAT DS    CL2            IOB STATUS                                04900000
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        04920000
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                04940000
         DS    CL2                                                      04960000
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               04980000
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        05000000
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                05020000
IOBCP    DS    CL8            FIRST CCW IN CHANNEL PROGRAM              05040000
         END                                                            05060000
./  ADD  SSI=32360070,NAME=IGG019KE
 TITLE   'IGG019KE - BDAM RELATIVE BLOCK CONVERSION MODULE'             00040002
IGG019KE CSECT                                                          00042002
*MODULE NAME - IGG019KE                                               * 00050002
*                                                                     * 00052002
*DESCRIPTIVE NAME - BDAM RELATIVE BLOCK CONVERSION, NON TRK OVERFLOW  * 00054002
*                                                                     * 00056002
*COPYRIGHT - NONE                                                     * 00058002
*                                                                     * 00058402
*CHANGE ACTIVITY                                                      * 00058802
*                                                                     * 00060000
*        OS REL 21 CHANGES/DELETIONS                                    00070002
*        VS 1-1 CHANGES/DELETIONS                                       00072002
*        VS 2-1 CHANGES/DELETIONS                                       00074002
*        VS 1-2 CHANGES/DELETIONS                                       00076002
*        VS 2-2 CHANGES/DELETIONS                                       00078002
*                                                                Y02072 00078402
*                                                                YM3029 00078802
*STATUS- CHANGE LEVEL 1                                               * 00080002
*                                                                     * 00090002
*FUNCTION/OPERATION- THIS MODULE IS ENTERED TO CONVERT THE USER'S     * 00100000
*   RELATIVE BLOCK ADDRESS TO AN ACTUAL TRACK ADDRESS OF THE FORM     * 00120000
*   MBBCCHHR. THIS IS ACCOMPLISHED BY OBTAINING THE RELATIVE BLOCK    * 00140000
*   NUMBER FROM THE BLKREF FIELD ASSOCIATED WITH THIS REQUEST AND     * 00160000
*   CONVERTING TO A TTR (RELATIVE TRACK AND ID) VALUE, USING THE      * 00180000
*   RELATIVE EXTENTS WHICH WERE ADDED TO THE DEB AT OPEN TIME. THE    * 00200000
*   TTR VALUE IS THEN PASSED TO THE RESIDENT ROUTINE WHICH CONVERTS   * 00220000
*   TTR TO AN ACTUAL ADDRESS.                                         * 00240000
*                                                                     * 00260000
*ENTRY POINT- 'IGG019KE' (RRSTART) IS THE ENTRY POINT TO THIS ROUTINE * 00280000
*   FROM THE BDAM FOUNDATION MODULE (IGG019KA) AND FROM THE READ      * 00312002
*   EXCLUSIVE SVC.  THE CALLING SEQUENCES ARE AS FOLLOWS:             * 00314002
*            L    15,4(FOUNDATION BASE)                               * 00320002
*            BALR 14,15 - IF 19KA                                     * 00340002
*         OR SYNCH (15) - IF SVC 53                                   * 00350002
*                                                                     * 00360000
*INPUT- THE REGISTERS HAVE BEEN LOADED AS FOLLOWS,                    * 00380000
*   3 - ADDRESS OF THE DEB                                            * 00400000
*   4 - ADDRESS OF THE DCB                                            * 00420000
*   5 - ADDRESS OF THE DECB FOR THIS REQUEST                          * 00440000
*   7 - ADDRESS OF THE IOB FOR THIS REQUEST                           * 00460000
*   11- BASE ADDRESS OF THE FOUNDATION MODULE                         * 00480000
*   THE RELATIVE BLOCK NUMBER IS OBTAINED BY LOADING THE ADDRESS OF   * 00500000
*   BLKREF FROM THE DECB (DECRECPT) AND MOVING THE CONTENTS OF BLKREF * 00520000
*   TO THE IOB FOR ALLIGNMENT.                                        * 00540000
*                                                                     * 00560000
*OUTPUT- THE ACTUAL ADDRESS WILL BE DEVELOPED AND STORED INTO THE IOB * 00580000
*   AT THE LOCATION 'IOBSEEK'. THE REGISTERS DESCRIBED AS INPUT WILL  * 00600000
*   BE UNCHANGED WHEN THIS MODULE RETURNS TO THE FOUNDATION MODULE.   * 00620000
*                                                                     * 00640000
*EXTERNAL ROUTINE- 'IECPCNVT' IS USED TO CONVERT TTR TO AN ACTUAL     * 00660000
*   ADDRESS AND STORE IT IN THE IOB.                                  * 00680000
*                                                                     * 00700000
*EXIT-NORMAL- 'EXITFDN' IS THE EXIT TO RETURN TO THE CALLING          * 00720002
*   MODULE AFTER CONVERSION HAS BEEN SUCCESSFULLY COMPLETED.          * 00740000
*                                                                     * 00760000
*    -ERROR- 'EXITERR' IS THE EXIT TO THE INVALID REQUEST ERROR       * 00780000
*   ROUTINE IN THE FOUNDATION MODULE. AN ERROR CODE IS PASSED IN      * 00800000
*   REGISTER 12 AND WILL BE PLACED IN THE ECB WHEN THE ERROR ROUTINE  * 00820000
*   ISSUES A POST. THE CAUSE OF THE INVALID REQUEST IS A RELATIVE     * 00840000
*   BLOCK NUMBER GREATER THAN THE TOTAL BLOCKS IN THE DATA SET.       * 00860000
*                                                                     * 00880000
*TABLES/WORK AREAS- THE COMMUNICATION VECTOR TABLE IS REFERENCED      * 00900000
*   TO LOCATE THE RESIDENT TTR TO ACTUAL CONVERSION ROUTINE.          * 00920000
*                                                                     * 00940000
*ATTRIBUTES- THIS MODULE IS REENTRANT AND EXECUTED ENABLED.           * 00960000
*   IT EXECUTES IN PROBLEM PROGRAM STATE, USER KEY.                   * 00970002
*                                                                     * 00980000
*NOTES- THE REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT      * 01000000
*   WITH THE MODULES IGG019KA, IECPCNVT.                              * 01020000
*                                                                       01040000
         USING IGG019KE,BASE                                            01100000
         USING IOBSTDRD,IOBREG                                          01120002
         USING DEBDEF,DEBREG                                            01140000
         USING IHADCB,DCBREG                                            01160000
         USING DECBDEF,DECBREG                                          01180000
*                                                                       01200000
*              REGISTER USAGE                                           01220000
*                                                                       01240000
WKREG0   EQU   0                       WORKING REGISTER                 01260000
SREG1    EQU   1                        PARAMETER REGISTER FOR BPAM     01280000
SREG2    EQU   2                        PARAMETER REGISTER FOR BPAM     01300000
DEBREG   EQU   3                       DEB ADDRESS                      01320000
DCBREG   EQU   4                       DCB ADDRESS                      01340000
DECBREG  EQU   5                       DECB ADDRESS                     01360000
WKREG1   EQU   6                       WORKING REGISTER                 01380000
IOBREG   EQU   7                        IOB ADDRESS                     01400000
WKREG2   EQU   8                       WORKING REGISTER                 01420000
SREG8    EQU   8                                                        01440000
WKREG3   EQU   9                       WORKING REGISTER                 01460000
WKREG4   EQU   10                      WORKING REGISTER                 01480000
FDNBASE  EQU   11                      BASE FOR FOUNDATION MODULE       01500000
INTREG   EQU   12                      INTERNAL RETURN FOR THIS MODULE  01520000
SREG12   EQU   12                      ERROR CONDITION REGISTER         01540000
RETREG   EQU   14                      RETURN TO FOUNDATION MODULE      01560000
SREG14   EQU   14                       PARAMETER REGISTER FOR BPAM     01580000
BASE     EQU   15                      BASE REGISTER FOR THIS MODULE    01600000
SREG15   EQU   15                       PARAMETER REGISTER FOR BPAM     01620000
*                                                                       01640000
*                                                                       01660000
RRSTART  L     WKREG3,DECRECPT          LOAD ADDR. OF RELATIVE RECORD   01680000
*                                        VALUE                          01700000
         MVC   IOBCSW(3),0(WKREG3)    MOVE VALUE TO IOB                 01720002
         L     WKREG3,IOBCSW-1          LOAD VALUE INTO REGISTER        01740002
         LA    SREG2,IOBSEEK            SET POINTER TO IOBSEEK FIELD    01760000
DEBPT    LR    WKREG1,DEBREG            LOAD ADDR. OF DEB               01780000
         LA    WKREG1,EXT1(0,WKREG1)    SET POINTER TO FIRST EXTENT     01800000
         LR    WKREG2,WKREG1            SET UP TO DETERMINE ADDRESS OF  01820000
         SR    WKREG4,WKREG4             FIRST RELATIVE RECORD EXTENT   01840000
         IC    WKREG4,DEBNMEXT          LOAD NUMBER OF EXTENTS          01860000
RREXT    LA    WKREG2,EXTSN(0,WKREG2)   ADD EXTENT SIZE TO RELATIVE     01880000
*                                        RECORD EXTENT POINTER          01900000
         BCT   WKREG4,RREXT             WAS THIS THE LAST EXTENT        01920000
*                                       NO-INCREMENT POINTER            01940000
*                                       YES-WKREG2 NOW POINTS TO FIRST  01960000
*                                        RELATIVE RECORD EXTENT         01980000
         IC    WKREG4,DEBNMEXT          LOAD NUMBER OF EXTENTS          02000000
         SR    WKREG0,WKREG0            CLEAR REGISTER                  02020000
RELTRK   EQU   *                                                        02040000
         MVC   IOBCSW(3),1(WKREG2)      MOVE NO. OF RECORDS IN THIS     02060002
*                                        EXTENT TO ALIGN VALUE          02080000
         S     WKREG3,IOBCSW-1          SUBTRACT VALUE FROM GIVEN       02100002
*                                        RELATIVE RECORD ADDRESS        02120000
         BC    4,OVER                   ADDRESS IN THIS EXTENT          02140000
         AH    WKREG0,TRK(0,WKREG1)     NO-ADD NO. OF TRACKS IN THIS    02160000
*                                        EXTENT TO RESULT REG.          02180000
         LA    WKREG1,EXTSN(0,WKREG1)   INCREMENT NORMAL EXTENT POINTER 02200000
         LA    WKREG2,EXTSR(0,WKREG2)   INCREMENT REL. REC. EXTENT PTR. 02220000
         BCT   WKREG4,RELTRK            WAS THIS THE LAST EXTENT        02240000
*                                       NO CONTINUE  CALCULATION        02260000
         SR    SREG12,SREG12            YES-ERROR,REL. REC. NOT IN DATA 02280000
         IC    SREG12,ERRCODE            SET                            02300000
         TM    IOBSTAT1,IOBSYNCH        MODULE ENTERED BY SYNCH? Y02072 02310002
*                                       ENTRY FROM EXCL CNTROL   Y02072 02310402
         BOR   RETREG                   RETURN ON R14            Y02072 02312002
         L     RETREG,20(0,FDNBASE)    LOAD ADDRESS OF ERROR RETURN     02320000
EXITERR  BR    RETREG                   AND GO TO ERROR ROUTINE         02340000
*                                                                       02360000
OVER     EQU   *                                                        02380000
         A     WKREG3,IOBCSW-1          ADD NO. OF RECORDS IN THIS      02400002
*                                        EXTENT BACK TO REL. REC. VALUE 02420000
         IC    WKREG4,0(0,WKREG2)       LOAD NO. OF RECORDS PER TRACK   02440000
         SR    WKREG2,WKREG2            CLEAR REG                       02460000
         DR    WKREG2,WKREG4            DIVIDE NO. OF RELATIVE RECORDS  02480000
*                                        WITHIN THE EXTENT BY THE NO.   02500000
*                                        OF RECORDS PER TRACK           02520000
*                                        QUOTIENT=TRACKS WITHIN EXTENT  02540000
*                                        REMAINDER=RECORD ID-1          02560000
         AR    WKREG0,WKREG3            ADD QUOTIENT TO TRACKS IN PRIOR 02580000
*                                        EXTENTS                        02600000
         LA    WKREG2,1(0,WKREG2)       ADD ONE TO REMAINDER            02620000
         SLL   WKREG0,8                 SHIFT TT REG ONE BYTE TO LEFT   02640000
         OR    WKREG0,WKREG2            PLACE REC. ID IN TT REG         02660000
CONVERT  SLL   WKREG0,8                 SHIFT TTR REG ONE BYTE TO LEFT  02680000
*                                        REG IS NOW IN FORMAT REQUIRED  02700000
*                                        BY BPAM                        02720000
*              SAVE REGISTERS                                           02740000
         STM   SREG8,SREG15,IOBDNCRF    SAVE REGISTERS 8-15             02760002
         LR    SREG1,DEBREG             SET POINTER TO DEB              02780000
         L     SREG15,CVTPTR(0,0)       LOAD ADDR. OF COMM.VECTOR TABLE 02800000
         L     SREG15,CVTPCNVT-CVTDEF(0,SREG15)  LOAD ADDRESS OF        02820000
*                                            CONVERSION ROUTINE         02840000
         BALR  SREG14,SREG15            GO TO CONVERT ROUTINE           02860000
*              RESTORE REGISTERS                                        02880000
RETURN   EQU   *                                                        02900000
         LM    SREG8,SREG15,IOBDNCRF    RESTORE REGISTERS 8-15          02920002
         TM    IOBSTAT1,IOBSYNCH        MODULE ENTERED BY SYNCH? Y02072 02930002
*                                       ENTRY FROM EXCL CNTROL   Y02072 02930402
         BZ    TSTEXSCH                 BRANCH NO                Y02072 02932002
         SR    SREG12,SREG12            ZERO RETURN CODE         Y02072 02934002
         BR    RETREG                   RETURN                   Y02072 02936002
TSTEXSCH TM    IOBDTYPE,IOBEXTSC        IS EXTENDED SEARCH OPTION USED  02940002
         BCR   8,RETREG                 NO-RETURN TO FOUNDATION MODULE  02960000
RREXTS1  TM    IOBSTAT1,IOBPASS2        FIRST PASS FOR THIS IOB         02980002
         BC    1,CLEANUP                NO                              03000000
         L     WKREG3,DECRECPT          YES-MOVE STARTING RELATIVE      03020000
         MVC   IOBCSW(3),0(WKREG3)       RECORD VALUE TO IOB            03040002
         LA    SREG2,IOBUPLIM           SET POINTER FOR CONVERT ROUTINE 03060000
         OI    IOBSTAT1,IOBPASS2        SET FIRST PASS INDICATOR        03080002
         L     WKREG3,DCBLIMCT-1       GET LIMCT INTO REG3              03100000
         LA    WKREG3,0(0,WKREG3)      CLEAR THE HI ORDER BYTE OF REG 3 03120000
*                FIX FOR APAR 7035                                      03140000
         LTR   WKREG3,WKREG3      IS LIMCT ZERO                         03160000
         BZ    AROUND        YES, BRANCH AROUND DECREMENT               03180000
         BCTR  WKREG3,0                                                 03200000
AROUND   EQU   *                                                        03220000
         AR    WKREG3,WKREG4           ADD ON RECORDS/TRACK             03240000
         L     WKREG4,DCBKEYLE         GET THE DATA SET SIZE            03260000
         LA    WKREG4,0(0,WKREG4)      CLEAR THE HI ORDER BYTE          03280000
         CR    WKREG3,WKREG4           COMPARE LIMCT +RECORDS/TRACK TO  03300000
*                                      DATA SET SIZE                    03320000
         BL    ADDSTART                SET. IF LOW BRANCH               03340000
         MVC   IOBUPLIM,IOBSEEK         YES-SET ENDING ADDRESS EQUAL TO 03360002
*                                        START ADDRESS                  03380000
CLEANUP  NI    IOBSTAT1,X'FF'-IOBPASS2  CLEAR FIRST PASS INDICATOR      03400002
         MVI   IOBUPLIM+7,X'00'         SET R IN UPLIM TO ZERO          03420000
         CLC   IOBUPLIM(1),IOBSEEK      IS EXTENDED SEARCH LIMIT IN     03440000
*                                        SAME EXTENT AS START ADDRESS   03460000
         BC    6,DUMMYID                NO                              03480000
         CLC   IOBSEEK+3(4),IOBUPLIM+3  DOES SEARCH WRAP AROUND         03500000
         BCR   4,RETREG                 NO-RETURN TO FOUNDATION MODULE  03520000
DUMMYID  MVI   IOBUPLIM+7,X'FE'         SET RECORD ID IN UPLIM TO 255   03540000
EXITFDN  EQU   *                                                        03560000
         BCR   15,RETREG                RETURN TO FOUNDATION MODULE     03580000
*                                                                       03600000
*                                                                       03620000
ADDSTART EQU   *                                                        03640000
         A     WKREG3,IOBCSW-1          ADD STARTING RELATIVE RECORD TO 03660002
*                                        EXTENDED SEARCH VALUE          03680000
         MVC   IOBCSW(3),DCBREL         ALIGN SIZE OF DATA SET          03700002
         CL    WKREG3,IOBCSW-1          COMPARE RESULT WITH SIZE OF     03720002
*                                        DATA SET                       03740000
         BL    DEBPT                    BRANCH IF SEARCH DOES NOT WRAP  03760000
*                                        AROUND TO START OF DATA SET    03780000
         S     WKREG3,IOBCSW-1          ADJUST ENDING ADDRESS SO THAT   03800002
*                                        IT FALLS WITHIN DATA SET       03820000
         B     DEBPT                    GO TO CONVERT ENDING ADDRESS    03840000
*                                                                       03860000
*                                                                       03880000
*                                                                       03900000
EXT1     EQU   32             OFFSET OF FIRST EXTENT FROM START OF DEB  03920000
EXTSN    EQU   16             SIZE OF NORMAL EXTENT FOR DIRECT ACCESS   03940000
TRK      EQU   14             NO. OF TRACKS OFFSET FROM START OF EXTENT 03960000
EXTSR    EQU   4              SIZE OF RELATIVE RECORD EXTENT            03980000
TONE     DC    H'256'                                                   04040000
ERRCODE  DC    FL1'16'                                                  04060000
*              EXCEPTION CODES                                          04080000
NOREC    EQU   X'80'                                                    04100000
LGNCK    EQU   X'40'                                                    04120000
NOSPA    EQU   X'20'                                                    04140000
INVAL    EQU   X'10'                                                    04160000
UNCOR    EQU   X'08'                                                    04180000
ENDOD    EQU   X'04'                                                    04200000
UNREL    EQU   X'02'                                                    04220000
*              OPTIONS AND TYPE                                         04240000
VERIFY   EQU   X'80'                                                    04260000
OFLOW    EQU   X'40'                                                    04280000
FEEDB    EQU   X'10'                                                    04320000
ACTAD    EQU   X'08'                                                    04340000
DYNBF    EQU   X'04'                                                    04360000
READX    EQU   X'02'                                                    04380000
RELRD    EQU   X'01'                                                    04400000
KEYOP    EQU   X'80'                                                    04420000
LGNOP    EQU   X'40'                                                    04440000
READ     EQU   X'08'                                                    04460000
KEY      EQU   X'04'                                                    04480000
ADD      EQU   X'02'                                                    04500000
MODID    DC    C'IGG019KE'              MODULE ID                Y02072 04510002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 04550002
         EJECT                                                          04560002
*********************************************************************** 04570002
*                         DSECTS                                        04572002
*********************************************************************** 04574002
CVTDEF   DSECT                                                          04580000
         CVT                                                            04600000
         EJECT                                                          04620000
*      DATA CONTROL BLOCK (DCB) DEFINITION                              04640000
*                                                                       04660000
         DCBD  DSORG=DA                                                 04680000
         EJECT                                                          04700000
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       04720000
         DS    0F                                                       04740000
DECBDEF  DSECT                                                          04760000
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        04780000
DECTYPE  DS    CL2            TYPE FIELD                                04800000
DECLNGTH DS    CL2            DATA LENGTH                               04820000
DECDCBAD DS    CL4            ADDRESS OF DCB                            04840000
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      04860000
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        04880000
DECKYADR DS    CL4            ADDRESS OF KEY                            04900000
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               04920000
         EJECT                                                          04940000
*                                                                       04960000
*      I/O BLOCK (IOB) DEFINITION                                       04980000
*                                                                       05000000
         IEZIOB                                                         05050002
         ORG   IOBRSV35                                                 05200002
IOBUPLIM DS    D                                                        05250002
         EJECT                                                          05840000
*                                                                       05860000
*      DATA EXTENT BLOCK (DEB) DEFINITION                               05880000
*                                                                       05900000
         DS    0F                                                       05920000
DEBDEF   DSECT                                                          05940000
*                                                                       05960000
         DS    0F                                                       05980000
DEBNMSUB DS    0CL1                    COUNT OF ROUTINES LOADED         06000000
DEBTCBAD DS    CL4                     TASK CONTROL BLOCK ADDRESS       06020000
DEBAMLNG DS    0CL1                    WORD CNT OF BDAM ADDED CORE      06040000
DEBDEBAD DS    CL4                     DEB CHAIN ADDRESS                06060000
DEBOFLGS DS    0CL1                    OPEN FLAGS                       06080000
DEBIRBAD DS    CL4                     IRB ADDRESS                      06100000
DEBOPATB DS    0CL1                    DATA SET ATTRIBUTES              06120000
DEBSYSPG DS    CL4                                                      06140000
DEBNMEXT DS    0CL1                    COUNT OF EXTENTS                 06160000
DEBUSRPG DS    CL4                                                      06180000
DEBPRIOR DS    0CL1                                                     06200000
DEBECBAD DS    CL4                                                      06220000
DEBPROTG DS    0CL1                                                     06240000
DEBDEBID DS    0CL1                                                     06260000
DEBDCBAD DS    CL4                     DCB ADDRESS                      06280000
DEBEXSCL DS    0CL1                    EXTENT SIZE SCALE                06300000
DEBAPPAD DS    CL4                     IOS APPENDAGE LIST ADDRESS       06320000
DEBDVMOD DS    0CL1                    FILE MASK CODE                   06340000
DEBUCBAD DS    CL4                     UCB ADDRESS                      06360000
DEBBINUM DS    CL2                     BIN NUMBER (BB)                  06380000
DEBSTRCC DS    CL2                     STARTING CYLINDER NUMBER         06400000
DEBSTRHH DS    CL2                     STARTING TRACK NUMBER            06420000
DEBENDCC DS    CL2                     ENDING CYLINDER NUMBER           06440000
DEBENDHH DS    CL2                     ENDING TRACK NUMBER              06460000
DEBNMTRK DS    CL2                     NO. OF TRACKS IN THIS EXTENT     06480000
DEBSUBID EQU   0         SUBROUTINE ID'S                                06500000
*                                                                       06520000
*                IO DEVICE TABLE                                        06540000
*                                                                       06560000
         DS    0F                                                       06580000
DTAB     DC    X'000814202C380000'                                      06600000
DEVSZ    DS    CL4                     DEVICE SIZE   CCHH               06620000
TRKLNGTH DS    CL2                     TRACK LENGTH                     06640000
OVERI    DS    CL1                     OVERHEAD  NOT LAST               06660000
OVERL    DS    CL1                     OVERHEAD  NLAST                  06680000
OVERK    DS    CL1                     OVERHEAD  NNON KEYED             06700000
FLAG     DS    CL1                     FLAG                             06720000
TOLER    DS    CL2                     TOLERANCE                        06740000
         END                                                            06760000
./  ADD  SSI=32360071,NAME=IGG019KF
   TITLE 'IGG019KF - BDAM RELATIVE BLOCK CONVERT WITH TRACK OVERFLOW'   00040002
IGG019KF CSECT                                                          00040402
*MODULE NAME - IGG019KF                                               * 00042002
*                                                                     * 00042402
*DESCRIPTIVE NAME - BDAM RELATIVE BLOCK CONVERSION, TRK OVERFLOW      * 00042802
*                                                                     * 00042902
*COPYRIGHT - NONE                                                     * 00047902
*                                                                     * 00049902
*CHANGE ACTIVITY                                                      * 00051902
*                                                                     * 00053002
*          OS REL 20 CHANGES/DELETIONS                                  00065002
*2970000600-000620,000660-000700                                  20201 00075021
*          OS REL 21 CHANGES/DELETIONS                                  00075102
*3565                                                            A49315 00075202
*3565037000                                                      A43932 00075302
*          VS 1-1 CHANGES/DELETIONS                                     00077802
*          VS 2-1 CHANGES/DELETIONS                                     00079802
*          VS 1-2 CHANGES/DELETIONS                                     00080202
*          VS 2-2 CHANGES/DELETIONS                                     00080302
*                                                                Y02072 00080402
*                                                                YM3029 00084302
*                                                                       00088302
*STATUS CHANGE LEVEL 005                                                00092202
*                                                                       00096102
*FUNCTION/OPERATION- THIS MODULE IS ENTERED TO CONVERT THE USER'S     * 00100000
*   RELATIVE BLOCK ADDRESS TO AN ACTUAL TRACK ADDRESS OF THE FORM     * 00120000
*   MBBCCHHR. THIS IS ACCOMPLISHED BY OBTAINING THE RELATIVE BLOCK    * 00140000
*   NUMBER FROM THE BLKREF FIELD ASSOCIATED WITH THIS REQUEST AND     * 00160000
*   CONVERTING TO A TTR(RELATIVE TRACK AND ID) VALUE. THIS CONVERSION * 00180000
*   IS ACCOMPLISHED BY USING RELATIVE EXTENTS, RECORDS/PERIOD, AND    * 00200000
*   TRACKS/PERIOD,ALL OF WHICH ARE PUT IN THE DEB AT OPEN TIME. THE   * 00220000
*   ROUTINE ALSO SIMULATES THE WRITING OF AN OVERFLOW DATA SET TO     * 00240000
*   GET THE EXACT POSITION OF THE BLOCK IN THE DATA SET.              * 00260000
*   THE TTR VALUE IS THEN PASSED TO THE RESIDENT ROUTINE WHICH        * 00280000
*   CONVERTS TTR TO AN ACTUAL ADDRESS.                                * 00300000
*                                                                     * 00320000
*ENTRY POINT- 'IGG019KF' IS THE ENTRY POINT TO THIS ROUTINE FROM THE  * 00340000
*   BDAM FOUNDATION MODULE(IGG019KA) AND FROM THE READ EXCLUSIVE SVC. * 00360002
*   THE CALLING SEQUENCE IS AS FOLLOWS:                               * 00370002
*            L    15,4(FOUNDATION BASE)                               * 00380002
*            BALR 14,15 - IF 19KA                                     * 00400002
*         OR SYNCH (15) - IF SVC 53                                   * 00410002
*   'BEGIN' IS THE ENTRY POINT FROM THE OVERFLOW FEEDBACK MODULE.     * 00420000
*   CALLING SEQUENCE IS                                               * 00440000
*            L    15,4(FOUNDATION BASE)                               * 00460002
*            B    4(0,15)                                             * 00480002
*                                                                     * 00500000
*INPUT- THE REGISTERS HAVE BEEN LOADED AS FOLLOWS,                    * 00520000
*   3 - ADDRESS OF THE DEB                                            * 00540000
*   4 - ADDRESS OF THE DCB                                            * 00560000
*   5 - ADDRESS OF THE DECB                                           * 00580000
*   7 - ADDRESS OF THE IOB FOR THIS REQUEST                           * 00600000
*   11- BASE ADDRESS OF THE FOUNDATION MODULE                         * 00620000
*   THE RELATIVE BLOCK NUMBER IS OBTAINED BY LOADING THE ADDRESS OF   * 00640000
*   BLKREF FROM THE DECB (DECRECPT) AND MOVING THE CONTENTS OF BLKREF * 00660000
*   TO THE IOB FOR ALIGNMENT                                          * 00680000
*                                                                     * 00700000
*OUTPUT- THE ACTUAL ADDRESS WILL BE DEVELOPED AND STORED INTO THE IOB * 00720000
*   AT THE LOCATION 'IOBSEEK'. THE REGISTERS DESCRIBED AS INPUT WILL  * 00740000
*   BE UNCHANGED WHEN THIS MODULE RETURNS TO THE FOUNDATION MODULE    * 00760000
*                                                                     * 00780000
*EXTERNAL ROUTINE- 'IECPCNVT IS USED TO CONVERT TTR TO AN ACTUAL      * 00800000
*   ADDRESS AND STORE IT IN THE IOB.                                  * 00820000
*                                                                     * 00840000
*EXIT-NORMAL- 'EXITFDN' IS THE EXIT TO RETURN TO THE FOUNDATION       * 00860000
*   MODULE AFTER CONVERSION HAS BEEN SUCCESSFULLY COMPLETED.          * 00880000
*   'RLBLFDBK' IS THE RETURN TO THE FEEDBACK ROUTINE.                 * 00900000
*                                                                     * 00920000
*    -ERROR- 'EXITERR' IS THE EXIT TO THE INVALID REQUEST ERROR       * 00940000
*   ROUTINE IN THE FOUNDATION MODULE. AN ERROR CODE IS PASSED IN      * 00960000
*   REGISTER 12 AND WILL BE PLACED IN THE ECB WHEN THE ERROR ROUTINE  * 00980000
*   ISSUES A POST. THE CAUSE OF THE INVALID REQUEST IS A RELATIVE     * 01000000
*   BLOCK NUMBER GREATER THAN THE TOTAL BLOCKS IN THE DATA SET.       * 01020000
*                                                                     * 01040000
*TABLES/WORK AREAS- THE COMMUNICATION VECTOR TABLE IS REFERENCED      * 01060000
*   TO LOCATE THE RESIDENT TTR TO ACTUAL CONVERSION ROUTINE.          * 01080000
*   THE DIRECT ACCESS DEVICE TABLE (DADT) IS REFERENCED TO GET THE    * 01100000
*   ATTRIBUTES OF THE DEVICE ON WHICH THE DATA SET RESIDES            * 01120000
*                                                                     * 01140000
*ATTRIBUTES- THIS MODULE IS REENTRANT  AND EXECUTED ENABLED           * 01160000
*   IT EXECUTES IN PROBLEM PROGRAM STATE, USER KEY.                   * 01170002
*                                                                     * 01180000
*NOTES- THE REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT      * 01200000
*   WITH THE MODULES IGG019KA AND IECPCNVT.                           * 01220000
*                                                                     * 01240000
*                                                                     * 01260000
         EJECT                                                          01280000
*                                                                       01300000
         USING IGG019KF,BASE                                            01320000
         USING IOBSTDRD,IOBREG                                   Y02072 01330002
         USING DEBDEF,DEBREG                                            01360000
         USING IHADCB,DCBREG                                            01380000
         USING DECBDEF,DECBREG                                          01400000
*                                                                       01420000
*              REGISTER USAGE                                           01440000
*                                                                       01460000
WKREG0   EQU   0                       WORKING REGISTER                 01480000
SREG1    EQU   1                        PARAMETER REGISTER FOR BPAM     01500000
REXREG2  EQU   1                                                        01520000
RRREG    EQU   2                       LENGTH OF A REGULAR RECORD       01540000
SREG2    EQU   2                        PARAMETER REGISTER FOR BPAM     01560000
DEBREG   EQU   3                       DEB ADDRESS                      01580000
CTOVREG  EQU   3                       CT+ITS OVERHEAD                  01600000
DCBREG   EQU   4                       DCB ADDRESS                      01620000
WORKREG  EQU   4                       TEMPORARY DEB BASE & UCB  A49315 01626021
*                                       PTR                      A49315 01632021
DECBREG  EQU   5                       DECB ADDRESS                     01640000
WKREG3   EQU   6                       WORKING REGISTER                 01660000
IOBREG   EQU   7                        IOB ADDRESS                     01680000
WKREG1   EQU   8                       WORKING REGISTER                 01700000
SREG8    EQU   8                                                        01720000
WKREG2   EQU   9                       WORKING REGISTER                 01740000
WKREG4   EQU   10                      WORKING REGISTER                 01760000
CTKYREG  EQU   10                      COUNT + KEY LENGTH               01780000
NRCDREG  EQU   11                      NUMBER OF RECORDS/PERIOD         01800000
FDNBASE  EQU   11                      BASE FOR FOUNDATION MODULE       01820000
INTREG   EQU   12                      INTERNAL RETURN FOR THIS MODULE  01840000
SREG12   EQU   12                      ERROR CONDITION REGISTER         01860000
TABREG   EQU   12                      POINTER TO TABLE ENTRY FOR TYPE  01880000
TRLREG   EQU   12                      LENGTH OF TRACK FOR OUR TYPE DEV 01900000
NTRKREG  EQU   13                      NUMBER OF TRACKS/PERIOD          01920000
LRREG    EQU   14                      LENGTH OF LAST RECORD            01940000
RETREG   EQU   14                      RETURN TO FOUNDATION MODULE      01960000
SREG14   EQU   14                       PARAMETER REGISTER FOR BPAM     01980000
BASE     EQU   15                      BASE REGISTER FOR THIS MODULE    02000000
SREG15   EQU   15                       PARAMETER REGISTER FOR BPAM     02020000
*                                                                       02040000
*                                                                       02060000
         EJECT                                                          02080000
         B     RRSTART                 BRANCH TO START OF THIS MODULE   02100000
         B     BEGIN                   BRANCH TO OVERFLOW ROUTINE       02120000
RRSTART  L     WKREG3,DECRECPT          LOAD ADDR. OF RELATIVE RECORD   02140000
*                                        VALUE                          02160000
         MVC   IOBCSW(3),0(WKREG3)      MOVE VALUE TO IOB        Y02072 02180002
         L     WKREG3,IOBCSW-1          LOAD VALUE INTO REGISTER Y02072 02200002
         LA    SREG2,IOBSEEK            SET POINTER TO IOBSEEK FIELD    02220000
DEBPT    LR    WKREG1,DEBREG            LOAD ADDR. OF DEB               02240000
         LA    WKREG1,EXT1(0,WKREG1)    SET POINTER TO FIRST EXTENT     02260000
         LR    WKREG2,WKREG1            SET UP TO DETERMINE ADDRESS OF  02280000
         SR    WKREG4,WKREG4             FIRST RELATIVE RECORD EXTENT   02300000
         IC    WKREG4,DEBNMEXT          LOAD NUMBER OF EXTENTS          02320000
RREXT    LA    WKREG2,EXTSN(0,WKREG2)   ADD EXTENT SIZE TO RELATIVE     02340000
*                                        RECORD EXTENT POINTER          02360000
         BCT   WKREG4,RREXT             WAS THIS THE LAST EXTENT        02380000
*                                       NO-INCREMENT POINTER            02400000
*                                       YES-WKREG2 NOW POINTS TO FIRST  02420000
*                                        RELATIVE RECORD EXTENT         02440000
         LR    WKREG4,WKREG2            SAVE POINTER TO PERIOD FIELD    02460000
         LA    WKREG2,8(0,WKREG2)       UPDATE POINTER TO EXTENTS       02480000
         SR    SREG1,SREG1                                              02500000
         IC    SREG1,DEBNMEXT          LOAD NUMBER OF EXTENTS           02520000
         SR    WKREG0,WKREG0            CLEAR REGISTER                  02540000
RELTRK   EQU   *                                                        02560000
         MVC   IOBCSW(3),1(WKREG2)      MOVE NO. OF RECORDS IN THIS     02580002
*                                        EXTENT TO ALIGN VALUE          02600000
         S     WKREG3,IOBCSW-1          SUBTRACT VALUE FROM GIVEN       02620002
*                                        RELATIVE RECORD ADDRESS        02640000
         BC    4,OVER                   ADDRESS IN THIS EXTENT          02660000
         AH    WKREG0,TRK(0,WKREG1)     NO-ADD NO. OF TRACKS IN THIS    02680000
*                                        EXTENT TO RESULT REG.          02700000
         LA    WKREG1,EXTSN(0,WKREG1)   INCREMENT NORMAL EXTENT POINTER 02720000
         LA    WKREG2,EXTSR(0,WKREG2)   INCREMENT REL. REC. EXTENT PTR. 02740000
         BCT   SREG1,RELTRK            WAS THIS LAST EXTENT             02760000
*                                       NO CONTINUE  CALCULATION        02780000
         SR    SREG12,SREG12            YES-ERROR,REL. REC. NOT IN DATA 02800000
         IC    SREG12,ERRCODE            SET                            02820000
         TM    IOBSTAT1,IOBSYNCH        MODULE ENTERED BY SYNCH? Y02072 02830002
*                                       (ENTRY FROM EXCL CNTROL) Y02072 02830402
         BOR   RETREG                   YES, RETURN ON R14       Y02072 02832002
         L     RETREG,20(0,FDNBASE)    LOAD ADDRESS OF ERROR RETURN     02840000
EXITERR  BR    RETREG                   AND GO TO ERROR ROUTINE         02860000
*                                                                       02880000
OVER     EQU   *                                                        02900000
         A     WKREG3,IOBCSW-1          ADD NO. OF RECORDS IN THIS      02920002
*                                        EXTENT BACK TO REL. REC. VALUE 02940000
SUBPRD   EQU   *                                                        02960000
         S     WKREG3,4(0,WKREG4)      SUBTRACT RECORDS/PERIOD          02980000
         BM    OVER1                   IF MINUS LEAVE THE LOOP          03000000
         A     WKREG0,0(0,WKREG4)      ADD ON TRACKS/PERIOD             03020000
         B     SUBPRD                  LOOP BACK                        03040000
OVER1    EQU   *                                                        03060000
         A     WKREG3,4(0,WKREG4)      ADD RECORDS PER PERIOD BACK ON   03080000
         B     BEGIN                   GO TO OVERFLOW ROUTINE           03100000
SETUPREG EQU   *                                                        03120000
         LA    WKREG2,1(0,WKREG2)       ADD ONE TO REMAINDER            03140000
         SLL   WKREG0,8                 SHIFT TT REG ONE BYTE TO LEFT   03160000
         OR    WKREG0,WKREG2            PLACE REC. ID IN TT REG         03180000
CONVERT  SLL   WKREG0,8                 SHIFT TTR REG ONE BYTE TO LEFT  03200000
*                                        REG IS NOW IN FORMAT REQUIRED  03220000
*                                        BY BPAM                        03240000
*              SAVE REGISTERS                                           03260000
         STM   SREG8,SREG15,IOBDNCRF    SAVE REGISTERS 8-15             03280002
         LR    SREG1,DEBREG             SET POINTER TO DEB              03300000
         L     SREG15,CVTPTR(0,0)       LOAD ADDR. OF COMM.VECTOR TABLE 03320000
         L     SREG15,CVTPCNVT-CVTDEF(0,SREG15)  LOAD ADDRESS OF        03340000
*                                            CONVERSION ROUTINE         03360000
         BALR  SREG14,SREG15            GO TO CONVERT ROUTINE           03380000
*              RESTORE REGISTERS                                        03400000
RETURN   EQU   *                                                        03420000
         LM    SREG8,SREG15,IOBDNCRF    RESTORE REGISTERS 8-15          03440002
         TM    IOBSTAT1,IOBSYNCH        MODULE ENTERED BY SYNCH? Y02072 03450002
*                                       ENTRY FROM EXCL CNTROL   Y02072 03450402
         BZ    TSTEXSCH                 BRANCH IF NOT            Y02072 03452002
         SR    SREG12,SREG12            ZERO RETURN CODE         Y02072 03454002
         BR    RETREG                   RETURN                   Y02072 03456002
TSTEXSCH TM    IOBDTYPE,IOBEXTSC        IS EXTENDED SEARCH OPTION USED  03460002
         BCR   8,RETREG                 NO-RETURN TO FOUNDATION MODULE  03480000
RREXTS1  TM    IOBSTAT1,IOBPASS2        FIRST PASS FOR THIS IOB         03500002
         BC    1,CLEANUP                NO                              03520000
         L     WKREG3,DECRECPT          YES-MOVE STARTING RELATIVE      03540000
         MVC   IOBCSW(3),0(WKREG3)       RECORD VALUE TO IOB            03560002
         LA    SREG2,IOBUPLIM           SET POINTER FOR CONVERT ROUTINE 03580000
         OI    IOBSTAT1,IOBPASS2        SET FIRST PASS INDICATOR        03600002
         L     WKREG3,0(0,WKREG4)      LOAD TRACKS/PERIOD               03620000
         L     WKREG2,4(0,WKREG4)      LOAD RECORDS/PERIOD              03640000
         SR    WKREG1,WKREG1                                            03660000
         DR    WKREG1,WKREG3           DIVIDE RECORDS/PER BY TRACKS/PER 03680000
         LA    WKREG4,1(0,WKREG2)       ADD ONE TO QUOTIENT IF 0 A43932 03700021
         L     WKREG3,DCBLIMCT-1       GET LIMCT                        03720000
         LA    WKREG3,0(0,WKREG3)      CLEAR HI ORDER BYTE              03740000
         AR    WKREG3,WKREG4           ADD RECORDS/TRACK(APPROXIMATE)   03760000
*                                      TO LIMCT                         03780000
         L     WKREG4,DCBKEYLE         GET DATA SET SIZE                03800000
         LA    WKREG4,0(0,WKREG4)      CLEAR HI ORDER BYTE              03820000
         CR    WKREG3,WKREG4           COMPARE LIMCT+ RECORDS/TRACK TO  03840000
         BL    ADDSTART                DATA SET SIZE. IF LOW BRANCH     03860000
         MVC   IOBUPLIM,IOBSEEK         YES-SET ENDING ADDRESS EQUAL TO 03880002
*                                        START ADDRESS                  03900000
CLEANUP  NI    IOBSTAT1,X'FF'-IOBPASS2  CLEAR FIRST PASS INDICATOR      03920002
         MVI   IOBUPLIM+7,X'00'         SET R IN UPLIM TO ZERO          03940000
         CLC   IOBUPLIM(1),IOBSEEK      IS EXTENDED SEARCH LIMIT IN     03960000
*                                        SAME EXTENT AS START ADDRESS   03980000
         BC    6,DUMMYID                NO                              04000000
         CLC   IOBSEEK+3(4),IOBUPLIM+3  DOES SEARCH WRAP AROUND         04020000
         BCR   4,RETREG                 NO-RETURN TO FOUNDATION MODULE  04040000
DUMMYID  MVI   IOBUPLIM+7,X'FE'         SET RECORD ID IN UPLIM TO 255   04060000
EXITFDN  EQU   *                                                        04080000
         BCR   15,RETREG                RETURN TO FOUNDATION MODULE     04100000
*                                                                       04120000
*                                                                       04140000
ADDSTART EQU   *                                                        04160000
         A     WKREG3,IOBCSW-1          ADD STARTING RELATIVE RECORD TO 04180002
*                                        EXTENDED SEARCH VALUE          04200000
         MVC   IOBCSW(3),DCBREL         ALIGN SIZE OF DATA SET          04220002
         CL    WKREG3,IOBCSW-1          COMPARE RESULT WITH SIZE OF     04240002
*                                        DATA SET                       04260000
         BL    DEBPT                    BRANCH IF SEARCH DOES NOT WRAP  04280000
*                                        AROUND TO START OF DATA SET    04300000
         S     WKREG3,IOBCSW-1          ADJUST ENDING ADDRESS SO THAT   04320002
*                                        IT FALLS WITHIN DATA SET       04340000
         B     DEBPT                    GO TO CONVERT ENDING ADDRESS    04360000
*                                                                       04380000
*                                                                       04400000
*                                                                       04420000
BEGIN    EQU   *                                                        04440000
         STM   SREG2,DEBREG,IOBCSW-1   SAVE REGISTERS NECESSARY         04460002
         STM   WKREG2,SREG14,IOBDNCRF   FOR THIS ROUTINE                04480002
NEWEXT   EQU   *                                                        04500000
         L     WKREG2,CVTPTR(0,0)      GET A POINTER TO THE DIRECT      04520000
         L     WKREG2,CVTZDTAB-CVTDEF(0,WKREG2) ACCESS DEVICE TABLE     04540000
         L     TABREG,DEBUCBAD         LOCATE DEVICE TYPE TO MATCH UCB  04560000
         SR    LRREG,LRREG             CLEAR OUT REGISTER               04580000
         IC    LRREG,UCBTYPCD(0,TABREG) IN THE TABLE BY USING TYPE CODE 04600000
         LA    TABREG,15               SET THE MASK                     04620000
         NR    LRREG,TABREG             CLEAR ALL BUT LOW ORDER 4 BITS  04640000
         IC    LRREG,0(LRREG,WKREG2)    IN FRONT OF THE TABLE           04660000
         LA    TABREG,0(LRREG,WKREG2)  TABREG POINTS TO TABLE ENTRY     04680000
*                                                                       04700000
         SR    RRREG,RRREG             CLEAR OUT WORK REGISTERS         04720000
         SR    WKREG1,WKREG1                                            04740000
         IC    RRREG,DCBKEYLE          IF THERE ARE NO KEYS, THE        04760000
         LTR   RRREG,RRREG              OVERHEAD FACTOR WILL BE REDUCED 04780000
         BC    7,*+8                    BY OVERHEAD FOR KEYS            04800000
         IC    WKREG1,OVERK(0,TABREG)                                   04820000
         IC    LRREG,OVERL(0,TABREG)                                    04840000
         TM    BYTEDEV(TABREG),TBOVHD   2 BYTE OVERHD USED       20201  04844020
         BNO   MZ0010                   NO, USE ONE BYTE OVHD    20201  04848020
         LH    LRREG,OVERI(TABREG)      GET 2 BYTE OVERHEAD      20201  04852020
MZ0010   EQU   *                                                 20201  04856020
         SR    LRREG,WKREG1            LRREG HAS OVERHEAD FACTOR        04860000
         LR    CTKYREG,LRREG           GET COUNT + KEY INTO             04880000
         AR    CTKYREG,RRREG             REGISTER CTKYREG               04900000
         AH    RRREG,DCBBLKSI          KL+DL IN RRREG                   04920000
         AR    LRREG,RRREG             LRREG HAS LAST RECORD LENGTH     04940000
         MH    RRREG,TOLER(0,TABREG)   CALCULATE 1.049(KL+DL)+OVERHEAD  04960000
         SRL   RRREG,9                                                  04980000
         SR    WKREG2,WKREG2           DEVELOP OVERHEAD FOR             05000000
         IC    WKREG2,OVERI(0,TABREG)   INTERMEDIATE RECORDS            05020000
         TM    BYTEDEV(TABREG),TBOVHD   2 BYTE OVERHD USED       20201  05024020
         BNO   MZ0020                   NO, USE ONE BYTE OVHD    20201  05028020
         LH    WKREG2,OVERI(TABREG)     GET 2 BYTE OVERHEAD      20201  05032020
MZ0020   EQU   *                                                 20201  05036020
         SR    WKREG2,WKREG1            (REDUCE IF NO KEYS PRESENT)     05040000
         AR    RRREG,WKREG2            RRREG HAS SIZE OF REGULAR REC'D  05060000
         SR    CTOVREG,CTOVREG                                          05080000
         IC    CTOVREG,OVERI(0,TABREG) GET OVERHEAD FOR REGULAR RECORDS 05100000
         TM    BYTEDEV(TABREG),TBOVHD   2 BYTE OVERHD USED       20201  05104020
         BNO   MZ0030                   NO, USE ONE BYTE OVHD    20201  05108020
         LH    CTOVREG,OVERI(TABREG)    GET 2 BYTE OVERHEAD      20201  05112020
MZ0030   EQU   *                                                 20201  05116020
         IC    WKREG1,OVERK(0,TABREG)  AND SUBTRCT OVERHEAD FOR KEYS TO 05120000
         SR    CTOVREG,WKREG1          GET COUNT AND ITS OVERHEAD.      05140000
         LH    WKREG1,TOLER(0,TABREG)                                   05160000
         STH   WKREG1,IOBUPLIM         SAVE THE OVERHEAD FACTOR         05180000
         LH    TRLREG,TRKL(0,TABREG)   GET TRACK LENGTH                 05200000
         SR    NTRKREG,NTRKREG         CLEAR OUT FOR TRACKS/PERIOD      05220000
         SR    NRCDREG,NRCDREG         CLEAR OUT FOR RECORDS/PERIOD     05240000
         CR    LRREG,TRLREG           COMPARE RECORD LENGTH TO THIS     05260000
         BH    BIGRECRD                IF HIGH IT'S MORE THAN ONE TRACK 05280000
         LR    WKREG2,TRLREG           GET TRACK LENGTH                 05300000
LOOP     SR    WKREG1,WKREG1           CLEAR OUT REGISTER FOR DIVISION  05320000
         DR    WKREG1,RRREG            DIVIDE LENGTH OF TRACK BY        05340000
*                                      REGULAR RECORD LENGTH WKREG2=    05360000
*                                      QUOTIENT,WKREG1= REMAINDER       05380000
         LA    NTRKREG,1(0,NTRKREG)    ADD ONE TO TRACK COUNT           05400000
         AR    NRCDREG,WKREG2          ADD QUOTIENT TO NO. OF RECORDS   05420000
         TM    IOBDTYP2,IOBRBFDB       FROM THE RELATIVE BLOCK FEEDBACK 05440002
         BZ    CONVERTP                ROUTINE. NO CONTINUE             05460000
         CR    WKREG0,NTRKREG          COMPARE TRACKS REMAINING T.      05480000
         BE    RLBLFDBK                TRACK COUNT.                     05500000
         B     COMMONCD                BRANCH AROUND CONVERT PORTION    05520000
CONVERTP EQU   *                                                        05540000
         CR    WKREG3,NRCDREG          COMPARE BLOCK COUNT AGAINST      05560000
         BC    12,RLBLCNVT             RECORD COUNT.IF LOW OR EQUAL BR. 05580000
COMMONCD EQU   *                                                        05600000
         LR    WKREG2,WKREG1                                            05620000
         SR    WKREG2,CTKYREG          SUBTRACT COUNT + KEY LENGTH      05640000
         LA    NRCDREG,1(0,NRCDREG)    ADD ONE TO RECORD COUNT          05660000
         LH    WKREG1,DCBBLKSI         GET THE SIZE OF A RECORD AND     05680000
         SR    WKREG1,WKREG2           SUBTRACT THE AMOUNT OF BYTES     05700000
         MH    WKREG1,IOBUPLIM         ALREADY WRITTEN ON LAST TRACK    05720000
         SRL   WKREG1,9                THEN MULTIPLY BY TOLERANCE       05740000
         LR    WKREG2,TRLREG           GET TRACK LENGTH AND SUBTRACT    05760000
         SR    WKREG2,CTOVREG          CT AND ITS OVERHEAD FROM IT AND  05780000
         SR    WKREG2,WKREG1           THEN SUBTRACT DATA+ALL OVERHEAD  05800000
         B     LOOP                    GO BACK FOR NEXT TRACK           05820000
BIGRECRD EQU   *                                                        05840000
         LA    NTRKREG,1(0,NTRKREG)    ADD ONE TO TRACK COUNT           05860000
         LR    WKREG1,LRREG            GET RECORD LENGTH AND            05880000
         SR    WKREG1,TRLREG           SUBTRACT LENGTH OF TRACK FROM IT 05900000
LOOP2    EQU   *                                                        05920000
         SR    WKREG2,WKREG2                                            05940000
LOOP3    EQU   *                                                        05960000
         TM    IOBDTYP2,IOBRBFDB       FROM THE RELATIVE BLOCK FEEDBACK 05980002
         BZ    CONVERTL                 ROUTINE. NO CONTINUE            06000000
         CR    WKREG0,NTRKREG          COMPARE TRACKS REMAINING T.      06020000
         BE    RLBLFDBK                TRACK COUNT.                     06040000
         B     LARGCOMM                BRANCH AROUND CONVERT PORTION    06060000
CONVERTL EQU   *                                                        06080000
         CR    WKREG3,NRCDREG          COMPARE BLOCK COUNT AGAINST      06100000
         BC    12,RLBLCNVT             RECORD COUNT.IF LOW OR EQUAL BR. 06120000
LARGCOMM EQU   *                                                        06140000
         LA    NTRKREG,1(0,NTRKREG)    ADD ONE TO TRACK COUNT           06160000
         SR    WKREG1,TRLREG           SUBTRACT LENGTH OF TRACK         06180000
         DROP  DCBREG                                            A49315 06182021
         L     WORKREG,IOBCSW+3        LOAD DEB PTR SAVED IN IOB A49315 06184002
         USING DEBDEF,WORKREG          ESTABLISH R4 AS DEB BASE  A49315 06186021
         L     WORKREG,DEBUCBAD        LOAD UCB ADDR FROM DEB    A49315 06188021
         DROP  WORKREG                                           A49315 06190021
         TM    UCBTYP+1(WORKREG),RPSDEV   IS THIS AN RPS DEVICE  A49315 06192021
         L     DCBREG,IOBDCBPT         RELOAD DCB BASE BEFORE BR A49315 06194021
         USING IHADCB,DCBREG           REESTABLISH REG AS DCB    A49315 06196021
*                                       BASE                     A49315 06198021
         BNO   NOTRPS                  IF NOT, BR AROUND         A49315 06200021
*                                       OVERHEAD LOGI            A49315 06202021
RPS      EQU   *                                                 A49315 06204021
         AR    WKREG1,CTOVREG          ADD ON OVERHEAD FOR RPS   A49315 06206021
         LTR   WKREG1,WKREG1           IS RECORD STILL LARGER    A49315 06208021
*                                       THAN TRK                 A49315 06210021
         BP    LOOP3                   YES, GO GET NEXT TRACK    A49315 06212021
         SR    WKREG1,CTOVREG          ELSE, SUBTRACT OVERHEAD   A49315 06214021
         B      LASTTRK                BRANCH AROUND NEXT INST   A49315 06216021
NOTRPS   EQU   *                                                 A49315 06218021
         LTR   WKREG1,WKREG1           TEST TO SEE IF THE RESULT IS     06220000
         BP    LOOP3                   POSITIVE YES LOOP BACK           06240000
LASTTRK  EQU   *                                                        06260000
         LA    NRCDREG,1(0,NRCDREG)    ADD ONE TO RECORD COUNT          06280000
         AR    WKREG1,TRLREG           ADD TRACK LENGTH BACK ON         06300000
         LR    WKREG2,TRLREG           GET TRACK LENGTH AND             06340000
         SR    WKREG2,CTOVREG          SUBTRACT COUNT FROM IT AND THEN  06360000
         MH    WKREG1,IOBUPLIM         MULTIPLY REMAINING DATA BYTES    06380000
         SRL   WKREG1,9                BY THE OVERHEAD FACTOR AND       06400000
         SR    WKREG2,WKREG1           SUBTRACT IT FROM THE RESULT AND  06420000
         LR    WKREG1,LRREG            GET LENGTH OF RECORD AND         06440000
         SR    WKREG1,WKREG2           SUBTRACT AMOUNT OF BYTES LEFT ON 06460000
         B     LOOP2                   THIS TRACK AND GO BACK TO START  06480000
RLBLCNVT EQU   *                                                        06500000
         SR    NRCDREG,WKREG2          REDUCE RCD CT BY AMT JUST ADDED  06520000
         SR    WKREG3,NRCDREG          REDUCE BLKREF BY RCD CT IN PRD   06540000
         LA    WKREG2,1(0,WKREG3)      INCREMENT BLOCK ID BY ONE        06560000
         BCT   NTRKREG,RLBLCONT        SUBTRACT ONE FROM TRACK COUNT    06580000
         BCTR  WKREG2,0                IF RESULT IS ZERO LOWER BLOCK 1  06600000
RLBLCONT EQU   *                                                        06620000
         AR    WKREG0,NTRKREG          INCREMENT TRACK COUNT BY NO. OF  06640000
         LM    WKREG4,SREG14,IOBDNCRF+4  RESTORE REGISTERS USED         06660002
         LM    SREG2,DEBREG,IOBCSW-1                                    06680002
         B     SETUPREG                GO TO SET UP WKREG0              06700000
RLBLFDBK EQU   *                                                        06720000
* ADD ONE TO RECORD COUNT FOR LAST RECORD(I.E. THE OVERFLOW RECORD)     06740000
* BUT THEN SUBTRACT ONE BECAUSE     THE R IN THE TTR WAS REALLY ONE     06760000
* TOO HIGH. IF WE ARE WORKING ON RECORDS/EXTENT THEN DON'T ADD          06780000
* ONE FOR OVERFLOW SINCE THIS IS LAST TRACK IN THIS EXTENT              06800000
         A     NRCDREG,IOBDNCRF+8      ADD RECORDS THIS EXTENT TO TOTAL 06820002
         LM    WKREG2,WKREG4,IOBDNCRF   RESTORE REGISTERS USED          06840002
         LM    SREG12,SREG14,IOBDNCRF+12                                06860002
         L     SREG2,IOBCSW-1          RESTORE SREG2                    06880002
         L     BASE,DCBDFBK            GET FEEDBACK ADDR AND BRANCH     06900000
         B     4(0,BASE)               TO RETURN POINT IN IT            06920000
EXT1     EQU   32             OFFSET OF FIRST EXTENT FROM START OF DEB  06940000
EXTSN    EQU   16             SIZE OF NORMAL EXTENT FOR DIRECT ACCESS   06960000
TRK      EQU   14             NO. OF TRACKS OFFSET FROM START OF EXTENT 06980000
EXTSR    EQU   4              SIZE OF RELATIVE RECORD EXTENT            07000000
ERRCODE  DC    FL1'16'                                                  07060000
*              EXCEPTION CODES                                          07080000
NOREC    EQU   X'80'                                                    07100000
LGNCK    EQU   X'40'                                                    07120000
NOSPA    EQU   X'20'                                                    07140000
INVAL    EQU   X'10'                                                    07160000
UNCOR    EQU   X'08'                                                    07180000
ENDOD    EQU   X'04'                                                    07200000
UNREL    EQU   X'02'                                                    07220000
*              OPTIONS AND TYPE                                         07240000
UCBTYP   EQU   X'10'                   OFFSET INTO UCB FOR       A49315 07241021
*                                       DEVTYP                   A49315 07242021
RPSDEV   EQU   X'10'                   THIS BIT ON AT X'11' IN   A49315 07243021
*                                       THE                      A49315 07244021
*                                      UCB INDICATES RPS DEVICE         07245021
BYTEDEV  EQU   9                        DEV TYPE OFFSET          20201  07246020
TBOVHD   EQU   X'08'                    DEV TYPE MASK            20201  07252020
TRKL     EQU   4                                                        07280000
OVERI    EQU   6                                                        07300000
OVERL    EQU   7                                                        07320000
OVERK    EQU   8                                                        07340000
TOLER    EQU   10                                                       07360000
UCBTYPCD EQU   19                                                       07400000
KEY      EQU   X'04'                                                    07420000
ADD      EQU   X'02'                                                    07440000
MODID    DC    C'IGG019KF'              MODULE ID                Y02072 07450002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 07490002
         EJECT                                                          07500002
*********************************************************************** 07510002
*                           DSECTS                                      07512002
*********************************************************************** 07514002
CVTDEF   DSECT                                                          07520000
         CVT                                                            07540000
         EJECT                                                          07560000
*      DATA CONTROL BLOCK (DCB) DEFINITION                              07580000
*                                                                       07600000
         DCBD  DSORG=DA                                                 07620000
         EJECT                                                          07640000
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       07660000
         DS    0F                                                       07680000
DECBDEF  DSECT                                                          07700000
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        07720000
DECTYPE  DS    CL2            TYPE FIELD                                07740000
DECLNGTH DS    CL2            DATA LENGTH                               07760000
DECDCBAD DS    CL4            ADDRESS OF DCB                            07780000
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      07800000
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        07820000
DECKYADR DS    CL4            ADDRESS OF KEY                            07840000
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               07860000
         EJECT                                                          07880000
*                                                                       07900000
*      I/O BLOCK (IOB) DEFINITION                                       07920000
*                                                                       07940000
         IEZIOB                                                  Y02072 07990002
         ORG   IOBRSV35                                                 08140002
IOBUPLIM DS    D                                                        08190002
         ORG   IOBDTYP2                                                 08240002
IOBRBFDB EQU   X'20'          INDICATES ENTRY FROM IGG019KH             08290002
         EJECT                                                          08780000
*                                                                       08800000
*      DATA EXTENT BLOCK (DEB) DEFINITION                               08820000
*                                                                       08840000
         DS    0F                                                       08860000
DEBDEF   DSECT                                                          08880000
*                                                                       08900000
         DS    0F                                                       08920000
DEBNMSUB DS    0CL1                    COUNT OF ROUTINES LOADED         08940000
DEBTCBAD DS    CL4                     TASK CONTROL BLOCK ADDRESS       08960000
DEBAMLNG DS    0CL1                    WORD CNT OF BDAM ADDED CORE      08980000
DEBDEBAD DS    CL4                     DEB CHAIN ADDRESS                09000000
DEBOFLGS DS    0CL1                    OPEN FLAGS                       09020000
DEBIRBAD DS    CL4                     IRB ADDRESS                      09040000
DEBOPATB DS    0CL1                    DATA SET ATTRIBUTES              09060000
DEBSYSPG DS    CL4                                                      09080000
DEBNMEXT DS    0CL1                    COUNT OF EXTENTS                 09100000
DEBUSRPG DS    CL4                                                      09120000
DEBPRIOR DS    0CL1                                                     09140000
DEBECBAD DS    CL4                                                      09160000
DEBPROTG DS    0CL1                                                     09180000
DEBDEBID DS    0CL1                                                     09200000
DEBDCBAD DS    CL4                     DCB ADDRESS                      09220000
DEBEXSCL DS    0CL1                    EXTENT SIZE SCALE                09240000
DEBAPPAD DS    CL4                     IOS APPENDAGE LIST ADDRESS       09260000
DEBDVMOD DS    0CL1                    FILE MASK CODE                   09280000
DEBUCBAD DS    CL4                     UCB ADDRESS                      09300000
DEBBINUM DS    CL2                     BIN NUMBER (BB)                  09320000
DEBSTRCC DS    CL2                     STARTING CYLINDER NUMBER         09340000
DEBSTRHH DS    CL2                     STARTING TRACK NUMBER            09360000
DEBENDCC DS    CL2                     ENDING CYLINDER NUMBER           09380000
DEBENDHH DS    CL2                     ENDING TRACK NUMBER              09400000
DEBNMTRK DS    CL2                     NO. OF TRACKS IN THIS EXTENT     09420000
DEBSUBID EQU   0         SUBROUTINE ID'S                                09440000
         END                                                            09460000
./  ADD  SSI=52870927,NAME=IGG019KG
 TITLE   'IGG019KG - FEEDBACK RELATIVE BLOCK NUMBER-NO OVERFLOW'        00040002
IGG019KG CSECT                                                          00042002
*MODULE NAME - IGG019KG                                               * 00050002
*                                                                     * 00052002
*DESCRIPTIVE NAME - BDAM FEEDBACK, RELATIVE BLK, NON TRK OVERFLOW     * 00054002
*                                                                     * 00056002
*COPYRIGHT - NONE                                                     * 00058002
*                                                                     * 00058402
*CHANGE ACTIVITY                                                      * 00058802
*                                                                     * 00059202
*        OS REL 21 CHANGES/DELETIONS                                    00059602
*        VS 1-1 CHANGES/DELETIONS                                       00059702
*        VS 2-1 CHANGES/DELETIONS                                       00059802
*        VS 1-2 CHANGES/DELETIONS                                       00059902
*        VS 2-2 CHANGES/DELETIONS                                       00066602
*                                                                Y02072 00068602
*                                                                YM3029 00070602
*        POST-VS2-3 CHANGES/DELETIONS                                 * 00073303
*C023800,C024000                                                ZA02228 00083303
*STATUS- CHANGE LEVEL 1                                               * 00100002
*                                                                     * 00110002
*FUNCTION/OPERATION- THIS MODULE IS ENTERED FROM THE ASI ROUTINE AND  * 00120002
*   EXCLUSIVE CNTROL SVC TO CONVERT THE ACTUAL ADDRESS OF THE BLOCK   * 00140002
*   JUST PROCESSED TO A RELATIVE BLOCK NUMBER. THIS IS DONE IF THE    * 00160000
*   USER HAS SPECIFIED FEEDBACK OPTION IN THE READ OR WRITE MACRO AND * 00180000
*   RELATIVE BLOCK AND FEEDBACK OPTIONS IN THE OPTCD PARAMETER OF THE * 00200000
*   DCB MACRO, OR IF EXCLUSIVE CONTROL WAS REQUESTED.                 * 00220002
*   THIS ROUTINE FIRST USES THE RESIDENT ROUTINE WHICH CONVERTS ACTUAL* 00240000
*   TO RELATIVE TRACK NUMBER TO OBTAIN A TTR VALUE. THIS VALUE IS     * 00260000
*   THEN CONVERTED TO A RELATIVE BLOCK NUMBER BY USE OF THE RELATIVE  * 00280000
*   EXTENTS ADDED TO THE DEB BY THE BDAM EXECUTOR 'IGG0193A'.         * 00300000
*                                                                     * 00320000
*ENTRY POINT- 'IGG019KG' (FDBSTAR) IS THE ENTRY POINT FROM SVC 53 AND * 00340002
*   ASYNCHRONOUS INTERRUPT ROUTINE BY THE CALLING SEQUENCE,           * 00360000
*            L     15,96(DCB)                                         * 00380002
*            BALR  12,15                                              * 00400002
*         OR SYNCH (15) - IF SVC 53                                   * 00410002
*                                                                     * 00420000
*INPUT- THE FOLLOWING REGISTERS ARE LOADED BY THE CALLING ROUTINE     * 00440002
*   1 - IOB ADDRESS                                                   * 00460000
*   13- DCB ADDRESS                                                   * 00480000
*   THE ACTUAL ADDRESS TO BE CONVERTED WILL BE FOUND IN THE IOB AT    * 00500000
*   IOBSEEK.                                                          * 00520000
*                                                                     * 00540000
*OUTPUT- THE CALCULATED RELATIVE BLOCK NUMBER WILL BE MOVED TO THE    * 00560000
*   USER'S BLKREF FIELD. BLKREF WILL BE LOCATED BY USING THE ECB      * 00580000
*   ADDRESS IN THE IOB TO LOCATE THE DECB AND THE ADDRESS OF BLKREF   * 00600000
*   WILL BE LOADED FROM THE DECB FIELD 'DECRECPT'.                    * 00620000
*                                                                     * 00640000
*EXTERNAL ROUTINES- 'IECPRLTV' IS USED TO CONVERT MBBCCHHR TO A TTR   * 00660000
*   VALUE.                                                            * 00680000
*                                                                     * 00700000
*EXIT NORMAL- 'EXTASI' IS THE EXIT TO RETURN TO THE ASYNCHRONOUS      * 00720000
*   INTERRUPT ROUTINE BY A     BR 12 (OR BR 14 IF SVC 53)             * 00740002
*                                                                     * 00760000
*TABLES/WORK AREAS- THE COMMUNICATIONS VECTOR TABLE IS REFERENCED TO  * 00780000
*   OBTAIN THE ADDRESS OF THE RESIDENT CONVERT ROUTINE (IECPRLTV).    * 00800000
*                                                                     * 00820000
*ATTRIBUTES- THIS MODULE IS REENTRANT AND EXECUTED ENABLED.           * 00840000
*   IT EXECUTES IN PROBLEM PROGRAM STATE, USER KEY.                   * 00850002
*                                                                     * 00860000
*NOTES- REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT WITH     * 00880000
*   THE MODULES IGG019KA, IECPRLTV.                                   * 00900000
*                                                                     * 00920000
         USING IGG019KG,BASE                                            00940000
         USING IOBSTDRD,IOBREG                                          00960002
         USING IHADCB,DCBREG                                            01000000
         USING DECBDEF,DECBREG                                          01020000
*                                                                       01040000
*              REGISTER USAGE                                           01060000
*                                                                       01080000
WKREG0   EQU   0                       WORKING REGISTER                 01100000
SREG1    EQU   1                        PARAMETER REGISTER FOR BPAM     01120000
IOBREG   EQU   1                        IOB ADDRESS                     01140000
SREG2    EQU   2                        PARAMETER REGISTER FOR BPAM     01160000
SREG9    EQU   9                        START OF SAVED REGISTERS        01180000
WKREG3   EQU   10                      WORKING REGISTER                 01200000
DECBREG  EQU   11                      DECB ADDRESS                     01220000
WKREG1   EQU   11                      WORKING REGISTER                 01240000
FDNBASE  EQU   11                       BASE FOR FOUNDATION MODULE      01260000
SREG12   EQU   12                      ERROR CONDITION REGISTER         01280000
INTREG   EQU   12                      INTERNAL RETURN FOR THIS MODULE  01300000
WKREG2   EQU   12                      WORKING REGISTER                 01320000
DCBREG   EQU   13                      DCB ADDRESS                      01340000
RETREG   EQU   14                      RETURN TO FOUNDATION MODULE      01360000
SREG14   EQU   14                       PARAMETER REGISTER FOR BPAM     01380000
WKREG4   EQU   14                      WORKING REGISTER                 01400000
SREG15   EQU   15                       PARAMETER REGISTER FOR BPAM     01420000
BASE     EQU   15                      BASE REGISTER FOR THIS MODULE    01440000
*                                                                       01460000
FDBSTAR  STM   SREG9,SREG2,IOBDNCRF     SAVE REGISTERS  9-2             01480002
         LA    SREG2,IOBSEEK            SET POINTER TO ACTUAL    Y02072 01500002
*                                       ADDRESS                  Y02072 01510002
         USING IOBSEEK,SREG2                                     Y02072 01512002
         L     SREG1,DCBDEBAD           SET DEB POINTER FOR CONVERT     01520000
         DROP  IOBREG                                            Y02072 01540002
         L     SREG15,CVTPTR(0,0)      LOAD ADDR.OF COMM. VECTOR TABLE  01580000
         L     SREG15,CVTPRLTV-CVTDEF(0,SREG15) LOAD ADDRESS OF         01600000
*                                                 CONVERSION ROUTINE    01620000
         BALR  SREG14,SREG15            GO TO ROUTINE                   01640000
*                                                                       01660000
*                                                                       01680000
*                   RETURN FROM CONVERT ROUTINE                         01700000
RETURN   EQU   *                                                        01720000
         LM    SREG9,SREG15,IOBDNCRF    RESTORE REGISTERS  9-15  Y02072 01740002
         L     IOBREG,IOBDNCRF+DSAVER1  RESTORE IOB POINTER      Y02072 01760002
         USING IOBSTDRD,IOBREG                                   Y02072 01770002
         DROP  SREG2                                             Y02072 01772002
RETPT    SR    WKREG1,WKREG1            CLEAR REGISTER                  01780000
         SRL   WKREG0,8                 SET REGISTER TO 0TTR            01800000
         BCTR  WKREG0,0                 SET R VALUE RELATIVE TO ZERO    01820000
         ST    WKREG1,IOBSTART          CLEAR IOB START POINTER         01840000
         STC   WKREG0,IOBSTART+3        PLACE R VALUE RETURNED BY       01860000
         IC    WKREG1,IOBSTART+3        CONVERT ROUTINE IN RESULT REG.  01880000
         L     SREG2,DCBDEBAD           LOAD DEB POINTER                01900000
         USING DEBDEF,SREG2                                             01910002
         SRL   WKREG0,8                 SET REGISTER TO 00TT            01920000
         LA    WKREG2,EXT1(0,SREG2)     SET POINTER TO FIRST EXTENT     01940000
         SR    WKREG4,WKREG4            CLEAR REGISTER                  01960000
         IC    WKREG4,DEBNMEXT          LOAD NUMBER OF EXTENTS          01980000
         LR    WKREG3,WKREG2            SET POINTER TO FIRST EXTENT     02000000
INCPT    LA    WKREG3,EXTSZ(0,WKREG3)   INCREMENT POINTER BY EXT. SIZE  02020000
         BCT   WKREG4,INCPT             IS THIS THE LAST EXTENT         02040000
*                                       NO-GO TO INCPT                  02060000
*                                       YES WKREG3 NOW POINTS TO FIRST  02080000
*                                        RELATIVE RECORD EXTENT         02100000
SUBTRK   SH    WKREG0,NMTRK(0,WKREG2)   SUBTRACT NO.OF TRACKS IN THIS   02120000
*                                        EXTENT FROM CONVERTED VALUE    02140000
         BC    4,ADDBACK                BRANCH IF RESULT IS MINUS       02160000
         MVC   IOBSTART+1(3),1(WKREG3)  ALIGN RECORDS PER EXTENT VALUE  02180000
         A     WKREG1,IOBSTART          ADD VALUE TO RESULT             02200000
         LA    WKREG2,EXTSZ(0,WKREG2)   INCREMENT NORMAL EXTENT POINTER 02220000
         LA    WKREG3,REXTSZ(0,WKREG3)  INCREMENT RELATIVE EXTENT PTR   02240000
         BC    15,SUBTRK                REPEAT CALCULATION              02260000
*                                                                       02280000
ADDBACK  AH    WKREG0,NMTRK(0,WKREG2)   ADD NO. OF TRACK IN THIS EXTENT 02300000
*                                        BACK TO TT REG.                02320000
         BC    8,NOMORE                 IF RESULT IS ZERO GO TO NOMORE  02340000
         MVC   IOBSTART+1(1),0(WKREG3)  ALIGN RECORDS PER TRACK VALUE   02360000
ADDRR    MH    WKREG0,IOBSTART          CALC REMAINING RECORDS  ZA02228 02380003
         AR    WKREG1,WKREG0            ADD TO RESULT           ZA02228 02400003
NOMORE   ST    WKREG1,IOBSTART          STORE RESULT                    02420000
         L     DECBREG,IOBECBPT         SET DECB POINTER                02440000
         L     WKREG2,DECRECPT          LOAD ADDRESS OF USER'S BLKREF   02460000
*                                        FIELD                          02480000
         MVC   0(3,WKREG2),IOBSTART+1   MOVE RELATIVE RECORD VALUE TO   02500000
*                                        USER'S AREA                    02520000
         LM    SREG9,SREG2,IOBDNCRF     RESTORE REGS 9 - 2       Y02072 02540002
         TM    IOBSTAT1,IOBSYNCH        TEST FOR SYNCH ENTRY     Y02072 02590002
*                                       (ENTRY FROM EXCL CNTROL) Y02072 02592002
         BOR   RETREG                   IF SO, RETURN ON R14     Y02072 02600002
EXITASI  EQU   *                                                        02620000
         BCR   15,INTREG                RETURN TO ASYNCHRONOUS          02640000
*                                        INTERRUPT ROUTINE              02660000
*********************************************************************** 02670002
*                    CONSTANTS AND EQUATES                              02670402
*********************************************************************** 02672002
EXT1     EQU   32                       FIRST EXTENT OFFSET FROM START  02680000
*                                        OF DEB                         02700000
EXTSZ    EQU   16                       DEB EXTENT SIZE                 02720000
REXTSZ   EQU   4                        RELATIVE RECORD EXTENT SIZE     02740000
NMTRK    EQU   14                       NUMBER OF TRACKS OFFSET IN EXT. 02760000
DSAVER1  EQU   (16+1-9)*4               DISPLACEMENT OF REG 1    Y02072 02780002
*                                       SAVE AREA FROM R9 SAVED  Y02072 02790002
*                                       IN IOBDNRCF              Y02072 02800002
*                                                                       02820000
*              EXCEPTION CODES                                          02840000
NOREC    EQU   X'80'                                                    02860000
LGNCK    EQU   X'40'                                                    02880000
NOSPA    EQU   X'20'                                                    02900000
INVAL    EQU   X'10'                                                    02920000
UNCOR    EQU   X'08'                                                    02940000
ENDOD    EQU   X'04'                                                    02960000
UNREL    EQU   X'02'                                                    02980000
*              OPTIONS AND TYPE                                         03000000
VERIFY   EQU   X'80'                                                    03020000
OFLOW    EQU   X'40'                                                    03040000
EXSCH    EQU   X'20'                                                    03060000
FEEDB    EQU   X'10'                                                    03080000
ACTAD    EQU   X'08'                                                    03100000
DYNBF    EQU   X'04'                                                    03120000
READX    EQU   X'02'                                                    03140000
RELRD    EQU   X'01'                                                    03160000
KEYOP    EQU   X'80'                                                    03180000
LGNOP    EQU   X'40'                                                    03200000
READ     EQU   X'08'                                                    03220000
KEY      EQU   X'04'                                                    03240000
ADD      EQU   X'02'                                                    03260000
MODID    DC    C'IGG019KG'              MODULE ID                Y02072 03270002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 03310002
         EJECT                                                          03312002
*********************************************************************** 03314002
*                         DSECTS                                        03316002
*********************************************************************** 03318002
CVTDEF   DSECT                                                          03320000
         CVT                                                            03340000
         EJECT                                                          03360000
*      DATA CONTROL BLOCK (DCB) DEFINITION                              03380000
*                                                                       03400000
         DCBD  DSORG=DA                                                 03420000
         EJECT                                                          03440000
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       03460000
         DS    0F                                                       03480000
DECBDEF  DS    0CL25                                                    03500000
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        03520000
DECTYPE  DS    CL2            TYPE FIELD                                03540000
DECLNGTH DS    CL2            DATA LENGTH                               03560000
DECDCBAD DS    CL4            ADDRESS OF DCB                            03580000
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      03600000
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        03620000
DECKYADR DS    CL4            ADDRESS OF KEY                            03640000
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               03660000
         EJECT                                                          03680000
*                                                                       03700000
*      I/O BLOCK (IOB) DEFINITION                                       03720000
*                                                                       03740000
         IEZIOB                                                         03790002
         EJECT                                                          04600000
*                                                                       04620000
*      DATA EXTENT BLOCK (DEB) DEFINITION                               04640000
*                                                                       04660000
         DS    0F                                                       04680000
DEBDEF   DSECT                                                          04700000
*                                                                       04720000
         DS    0F                                                       04740000
DEBNMSUB DS    0CL1                    COUNT OF ROUTINES LOADED         04760000
DEBTCBAD DS    CL4                     TASK CONTROL BLOCK ADDRESS       04780000
DEBAMLNG DS    0CL1                    WORD CNT OF BDAM ADDED CORE      04800000
DEBDEBAD DS    CL4                     DEB CHAIN ADDRESS                04820000
DEBOFLGS DS    0CL1                    OPEN FLAGS                       04840000
DEBIRBAD DS    CL4                     IRB ADDRESS                      04860000
DEBOPATB DS    0CL1                    DATA SET ATTRIBUTES              04880000
DEBSYSPG DS    CL4                                                      04900000
DEBNMEXT DS    0CL1                    COUNT OF EXTENTS                 04920000
DEBUSRPG DS    CL4                                                      04940000
DEBPRIOR DS    0CL1                                                     04960000
DEBECBAD DS    CL4                                                      04980000
DEBPROTG DS    0CL1                                                     05000000
DEBDEBID DS    0CL1                                                     05020000
DEBDCBAD DS    CL4                     DCB ADDRESS                      05040000
DEBEXSCL DS    0CL1                    EXTENT SIZE SCALE                05060000
DEBAPPAD DS    CL4                     IOS APPENDAGE LIST ADDRESS       05080000
DEBDVMOD DS    0CL1                    FILE MASK CODE                   05100000
DEBUCBAD DS    CL4                     UCB ADDRESS                      05120000
DEBBINUM DS    CL2                     BIN NUMBER (BB)                  05140000
DEBSTRCC DS    CL2                     STARTING CYLINDER NUMBER         05160000
DEBSTRHH DS    CL2                     STARTING TRACK NUMBER            05180000
DEBENDCC DS    CL2                     ENDING CYLINDER NUMBER           05200000
DEBENDHH DS    CL2                     ENDING TRACK NUMBER              05220000
DEBNMTRK DS    CL2                     NO. OF TRACKS IN THIS EXTENT     05240000
DEBSUBID EQU   0         SUBROUTINE ID'S                                05260000
*                                                                       05280000
*                IO DEVICE TABLE                                        05300000
*                                                                       05320000
         DS    0F                                                       05340000
DTAB     DC    X'000814202C380000'                                      05360000
DEVSZ    DS    CL4                     DEVICE SIZE   CCHH               05380000
TRKLNGTH DS    CL2                     TRACK LENGTH                     05400000
OVERI    DS    CL1                     OVERHEAD  NOT LAST               05420000
OVERL    DS    CL1                     OVERHEAD  NLAST                  05440000
OVERK    DS    CL1                     OVERHEAD  NNON KEYED             05460000
FLAG     DS    CL1                     FLAG                             05480000
TOLER    DS    CL2                     TOLERANCE                        05500000
         END                                                            05520000
./  ADD  SSI=32920869,NAME=IGG019KH
         TITLE 'IGG019KH - FEEDBACK RELATIVE BLOCK WITH TRACK OVERFLOW' 00010000
IGG019KH CSECT                                                          00020000
*MODULE NAME - IGG019KH                                               * 00022002
*                                                                     * 00024002
*DESCRIPTIVE NAME - BDAM FEEDBACK, RELATIVE BLOCK, TRK OVERFLOW       * 00026002
*                                                                     * 00026402
*COPYRIGHT - NONE                                                     * 00026802
*                                                                     * 00026902
*CHANGE ACTIVITY                                                      * 00032402
*                                                                     * 00034402
*        OS REL 21 CHANGES/DELETIONS                                    00084402
*        VS 1-1 CHANGES/DELETIONS                                       00086402
*        VS 2-1 CHANGES/DELETIONS                                       00088402
*        VS 1-2 CHANGES/DELETIONS                                       00090402
*        VS 2-2 CHANGES/DELETIONS                                       00092402
*                                                                Y02072 00092802
*031300                                                          YM3918 00099602
*                                                                YM4617 00101602
*                                                                     * 00106402
*STATUS CHANGE LEVEL 002                                              * 00113202
*                                                                     * 00120000
*FUNCTION/OPERATION- THIS MODULE IS ENTERED FROM THE ASYNCHRONOUS     * 00140000
*   INTERRUPT ROUTINE TO CONVERT THE ACTUAL ADDRESS OF THE BLOCK      * 00160000
*   JUST PROCESSED TO A RELATIVE BLOCK NUMBER. THIS IS DONE IF THE    * 00180000
*   USER HAS SPECIFIED THE FEEDBACK OPTION IN THE READ OR WRITE MACRO * 00200000
*   AND THE RELATIVE BLOCK AND FEEDBACK OPTIONS IN THE OPTCD PARAMETER* 00220000
*   OF THE DCB MACRO.                                                 * 00240002
*   THIS ROUTINE FIRST USES THE RESIDENT ROUTINE WHICH CONVERTS ACTUAL* 00260000
*   ADDRESSES TO RELATIVE TRACK ADDRESSES(TTR). THIS VALUE IS THEN    * 00280000
*   CONVERTED TO A RELATIVE BLOCK NUMBER BY BRANCHING TO IGG019KF,    * 00300002
*   THE REL BLK CONVERSION MOD, WHICH CALCULATES THE REL BLK ID FROM  * 00310002
*   DEB EXTENTS (THE TRACKS/PERIOD AND RECORDS/PERIOD VALUES ADDED    * 00320002
*   TO THE DEB BY THE BDAM OPEN EXECUTOR 'IGG0193A'.)                 * 00340002
*                                                                     * 00360000
*ENTRY POINTS- 'IGG019KH' IS THE ENTRY POINT FROM THE ASI AND SVC 53  * 00380002
*   ROUTINES BY THE CALLING SEQUENCE,                                 * 00400002
*            L    15,96(DCB)                                          * 00420002
*            BALR 12,15                                               * 00440002
*         OR SYNCH (15) - IF SVC 53                                   * 00450002
*   'NOMORE' IS THE RETURN POINT FROM THE RELATIVE BLOCK CONVERT      * 00460000
*   ROUTINE BY THE CALLING SEQUENCE,                                  * 00480000
*            L    15,96(DCB)                                          * 00500002
*            B    4(0,15)                                             * 00520002
*                                                                     * 00540000
*INPUT- THE FOLLOWING REGISTERS ARE LOADED BY CALLING ROUTINE,        * 00560002
*   1 - IOB ADDRESS                                                   * 00580000
*   13- DCB ADDRESS                                                   * 00600000
*   THE ACTUAL ADDRESS TO BE CONVERTED WILL BE FOUND IN THE IOB AT    * 00620000
*   IOBSEEK.                                                          * 00640000
*                                                                     * 00660000
*OUTPUT- THE CALCULATED RELATIVE BLOCK NUMBER WILL BE MOVED TO THE    * 00680000
*   USER'S BLKREF FIELD. BLKREF WILL BE LOCATED BY USING THE ECB      * 00700000
*   ADDRESS IN THE IOB TO LOCATE THE DECB AND THE ADDRESS OF BLKREF   * 00720000
*   WILL BE LOADED FROM THE DECB FIELD 'DECRECPT'.                    * 00740000
*                                                                     * 00760000
*EXTERNAL ROUTINES- 'IECPRLTV' IS USED TO CONVERT MBBCCHHR TO A TTR   * 00780000
*   VALUE.                                                            * 00800000
*   'IGG019KF' IS USED TO DETERMINE THE NUMBER OF BLOCKS THE GIVEN    * 00820000
*   TTR IS WITHIN A PERIOD.                                           * 00840000
*                                                                     * 00860000
*EXIT- NORMAL- 'EXTASI' IS THE EXIT TO RETURN TO THE ASI ROUTINE      * 00880002
*                 VIA,    B   8(R11)                                  * 00900002
*              RETURN TO THE READ EXCLUSIVE MODULE(IGC0005C) IS       * 00910002
*                 VIA,     EXIT                                       * 00912002
*                                                                     * 00920000
*TABLES/WORK AREAS- THE COMMUNICATIONS VECTOR TABLE IS REFERENCED TO  * 00940000
*   OBTAIN THE ADDRESS OF THE RESIDENT CONVERT ROUTINE (IECPRLTV)     * 00960000
*                                                                     * 00980000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.          * 01000000
*   IT EXECUTES IN PROBLEM PROGRAM STATE, USER KEY.                   * 01010002
*                                                                     * 01020000
*NOTES- REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT WITH THE * 01040000
*   MODULES IGG019KA,IGG019KF, AND IECPRLTV.                          * 01060000
*                                                                     * 01080000
         EJECT                                                          01100000
*                                                                     * 01120000
         USING IGG019KH,BASE                                            01140000
         USING IOBSTDRD,IOBREG                                          01160002
         USING IHADCB,DCBREG                                            01200000
         USING DECBDEF,DECBREG                                          01220000
*                                                                       01240000
*              REGISTER USAGE                                           01260000
*                                                                       01280000
WKREG0   EQU   0                       WORKING REGISTER                 01300000
SREG1    EQU   1                        PARAMETER REGISTER FOR BPAM     01320000
IOBREG   EQU   1                        IOB ADDRESS                     01340000
SREG2    EQU   2                        PARAMETER REGISTER FOR BPAM     01360000
WKREG2   EQU   3                       WORKING REGISTER                 01380000
DEBREG   EQU   3                       BASE REGISTER FOR DEB            01400000
DCB2REG   EQU  4                       BASE REGISTER FOR DCB FOR RR     01420000
IOB2REG  EQU   7                       IOB REG. FOR REL. BL. ROUTINE    01440000
SREG9    EQU   9                        START OF SAVED REGISTERS        01460000
WKREG3   EQU   10                      WORKING REGISTER                 01480000
DECBREG  EQU   11                      DECB ADDRESS                     01500000
WKREG1   EQU   11                      WORKING REGISTER                 01520000
FDNBASE  EQU   11                       BASE FOR FOUNDATION MODULE      01540000
SREG12   EQU   12                      ERROR CONDITION REGISTER         01560000
INTREG   EQU   12                      INTERNAL RETURN FOR THIS MODULE  01580000
DCBREG   EQU   13                      DCB ADDRESS                      01600000
RETREG   EQU   14                      RETURN TO FOUNDATION MODULE      01620000
SREG14   EQU   14                       PARAMETER REGISTER FOR BPAM     01640000
WKREG4   EQU   14                      WORKING REGISTER                 01660000
SREG15   EQU   15                       PARAMETER REGISTER FOR BPAM     01680000
BASE     EQU   15                      BASE REGISTER FOR THIS MODULE    01700000
*                                                                       01720000
         EJECT                                                          01740000
         B     FDBSTAR                 BRANCH TO FIRST INSTRUCTION      01760000
         B     NOMORE                  BRANCH TO RETURN POINT FROM RR   01780000
FDBSTAR  STM   SREG9,SREG1,IOBDNCRF     SAVE REGISTERS 9-1       YM3918 01800002
         LA    SREG2,IOBSEEK            SET PTR TO ACTUAL ADDR   Y02072 01860002
         USING IOBSEEK,SREG2                                     Y02072 01862002
         L     SREG1,DCBDEBAD           SET DEB POINTER FOR CONVERT     01870002
         DROP  IOBREG                                            Y02072 01880002
         L     SREG15,CVTPTR(0,0)      LOAD ADDR.OF COMM. VECTOR TABLE  01900000
         L     SREG15,CVTPRLTV-CVTDEF(0,SREG15) LOAD ADDRESS OF         01920000
*                                                 CONVERSION ROUTINE    01940000
         BALR  SREG14,SREG15            GO TO ROUTINE                   01960000
*                                                                       01980000
*                                                                       02000000
*                   RETURN FROM CONVERT ROUTINE                         02020000
RETURN   EQU   *                                                        02040000
         LM    SREG9,SREG15,IOBDNCRF    RESTORE REGISTERS  9-15  YM3918 02060002
         L     IOBREG,IOBDNCRF+DSAVER1  RESTORE IOB POINTER      YM3918 02080002
         USING IOBSTDRD,IOBREG                                   Y02072 02090002
         DROP  SREG2                                             Y02072 02092002
RETPT    SR    WKREG1,WKREG1            CLEAR REGISTER                  02100000
         SRL   WKREG0,8                 SET REGISTER TO 0TTR            02120000
         BCTR  WKREG0,0                 SET R VALUE RELATIVE TO ZERO    02140000
         ST    WKREG1,IOBSTART          CLEAR IOB START POINTER         02160000
         STC   WKREG0,IOBSTART+3        PLACE R VALUE RETURNED BY       02180000
         IC    WKREG1,IOBSTART+3        CONVERT ROUTINE IN RESULT REG.  02200000
         L     SREG2,DCBDEBAD           LOAD DEB POINTER                02220000
         USING DEBDEF,SREG2                                             02230002
         SRL   WKREG0,8                 SET REGISTER TO 00TT            02240000
         LA    WKREG2,EXT1(0,SREG2)     SET POINTER TO FIRST EXTENT     02260000
         SR    WKREG4,WKREG4            CLEAR REGISTER                  02280000
         IC    WKREG4,DEBNMEXT          LOAD NUMBER OF EXTENTS          02300000
         LR    WKREG3,WKREG2            SET POINTER TO FIRST EXTENT     02320000
INCPT    LA    WKREG3,EXTSZ(0,WKREG3)   INCREMENT POINTER BY EXT. SIZE  02340000
         BCT   WKREG4,INCPT             IS THIS THE LAST EXTENT         02360000
*                                       NO-GO TO INCPT                  02380000
*                                       YES WKREG3 NOW POINTS TO FIRST  02400000
*                                        RELATIVE RECORD EXTENT         02420000
         LR    WKREG4,WKREG3           YES SAVE POINTER TO PERIOD FIELD 02440000
         LA    WKREG3,8(0,WKREG3)      SET POINTER TO FIRST REL EXTENT  02460000
SUBTRK   SH    WKREG0,NMTRK(0,WKREG2)   SUBTRACT NO.OF TRACKS IN THIS   02480000
*                                        EXTENT FROM CONVERTED VALUE    02500000
         BC    4,ADDBACK                BRANCH IF RESULT IS MINUS       02520000
         MVC   IOBSTART+1(3),1(WKREG3)  ALIGN RECORDS PER EXTENT VALUE  02540000
         A     WKREG1,IOBSTART          ADD VALUE TO RESULT             02560000
         LA    WKREG2,EXTSZ(0,WKREG2)   INCREMENT NORMAL EXTENT POINTER 02580000
         LA    WKREG3,REXTSZ(0,WKREG3)  INCREMENT RELATIVE EXTENT PTR   02600000
         BC    15,SUBTRK                REPEAT CALCULATION              02620000
*                                                                       02640000
ADDBACK  AH    WKREG0,NMTRK(0,WKREG2)   ADD NO. OF TRACK IN THIS EXTENT 02660000
*                                        BACK TO TT REG.                02680000
         BC    8,NOMORE                 IF RESULT IS ZERO GO TO NOMORE  02700000
SUBPRD   S     WKREG0,0(0,WKREG4)      YES SUBTRACT  TRACKS/PERIOD      02720000
         BM    OVER                    MINUS RESULT?GO ADD BACK TRACKS  02740000
         A     WKREG1,4(0,WKREG4)      NO ADD ON RECORDS/PERIOD         02760000
         B     SUBPRD                  LOOP BACK                        02780000
OVER     A     WKREG0,0(0,WKREG4)      ADD BACK TRACKS SUBTRACTED       02800000
         BZ    NOMORE                  IF NOT GO AROUND OVERFLOW        02820000
         OI    IOBDTYP2,IOBRBFDB       INDICATE ENTRY FROM FEEDBACK     02840002
         L     DEBREG,DCBDEBAD         GET DEB ADDR INTO CORRECT REG    02860000
         LR    DCB2REG,DCBREG          GET DCB ADDR INTO CORRECT REG    02880000
         LR    IOB2REG,IOBREG          LOAD IOB ADDR FOR REL. BL MODULE 02900000
         L     BASE,DCBREAD            GET ADDRESS OF THE FOUNDATION    02920000
         L     BASE,32(0,BASE)          MODULE.  GET ADDR OF      13883 02940016
         B     4(0,BASE)               OF THE RELATIVE RECORD MOD. BR   02960000
NOMORE   ST    WKREG1,IOBSTART          STORE RESULT                    02980000
         L     DECBREG,IOBECBPT         SET DECB POINTER                03000000
         L     WKREG2,DECRECPT          LOAD ADDRESS OF USER'S BLKREF   03020000
*                                        FIELD                          03040000
         MVC   0(3,WKREG2),IOBSTART+1   MOVE RELATIVE RECORD VALUE TO   03060000
*                                        USER'S AREA                    03080000
         TM    IOBSTAT1,IOBSYNCH        TEST FOR SYNCH ENTRY     Y02072 03140002
*                                       (ENTRY FROM EXCL CNTROL) Y02072 03142002
         BNO   EXITASI                  IF NOT, BR TO ASI EXIT   YM3918 03144002
         SVC   EXIT                     ELSE,EXIT BACK TO SVC 53 YM3918 03146002
EXITASI  EQU   *                        RETURN TO ASI            YM3918 03160002
         L     FDNBASE,DCBREAD          GET ADDRESS OF 19KA      YM3918 03162002
         L     FDNBASE,ASIOFF(FDNBASE)  GET ADDRESS OF ASI       YM3918 03164002
         LR    BASE,FDNBASE             SET UP R15 WITH ASI BASE YM4617 03166002
         B     DASIC(FDNBASE)           RETURN TO ASI+8 ENTRY    YM3918 03170002
*********************************************************************** 03210002
*            CONSTANTS AND EQUATES                                      03212002
*********************************************************************** 03214002
EXT1     EQU   32                       FIRST EXTENT OFFSET FROM START  03220000
*                                        OF DEB                         03240000
EXTSZ    EQU   16                       DEB EXTENT SIZE                 03260000
REXTSZ   EQU   4                        RELATIVE RECORD EXTENT SIZE     03280000
NMTRK    EQU   14                       NUMBER OF TRACKS OFFSET IN EXT. 03300000
DSAVER1  EQU   (16+1-9)*4               DISP OF R1 SAVEAREA FROM Y02072 03350002
*                                       R9 SAVED IN IOBUPLIM     Y02072 03352002
ASIOFF   EQU   16                       OFFSET IN 19KA TO ASI    YM3918 03354002
EXIT     EQU   3                        EXIT SVC 3               YM3918 03356002
DASIC    EQU   8                        OFFSET IN ASI TO BRANCH  YM3918 03358002
*                                       TO CLEAN UP AND POST RTN YM3918 03358402
*                                                                       03360000
*              EXCEPTION CODES                                          03380000
NOREC    EQU   X'80'                                                    03400000
LGNCK    EQU   X'40'                                                    03420000
NOSPA    EQU   X'20'                                                    03440000
INVAL    EQU   X'10'                                                    03460000
UNCOR    EQU   X'08'                                                    03480000
ENDOD    EQU   X'04'                                                    03500000
UNREL    EQU   X'02'                                                    03520000
*              OPTIONS AND TYPE                                         03540000
VERIFY   EQU   X'80'                                                    03560000
OFLOW    EQU   X'40'                                                    03580000
EXSCH    EQU   X'20'                                                    03600000
FEEDB    EQU   X'10'                                                    03620000
ACTAD    EQU   X'08'                                                    03640000
DYNBF    EQU   X'04'                                                    03660000
READX    EQU   X'02'                                                    03680000
RELRD    EQU   X'01'                                                    03700000
KEYOP    EQU   X'80'                                                    03720000
LGNOP    EQU   X'40'                                                    03740000
READ     EQU   X'08'                                                    03760000
KEY      EQU   X'04'                                                    03780000
ADD      EQU   X'02'                                                    03800000
OVERFL   EQU   2                                                        03820000
MODID    DC    C'IGG019KH'              MODULE ID                Y02072 03822002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 03830002
         EJECT                                                          03870002
*********************************************************************** 03880002
*               DSECTS                                                  03890002
*********************************************************************** 03892002
CVTDEF   DSECT                                                          03900000
         CVT                                                            03920000
         EJECT                                                          03940000
*      DATA CONTROL BLOCK (DCB) DEFINITION                              03960000
*                                                                       03980000
         DCBD  DSORG=DA                                                 04000000
         EJECT                                                          04020000
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       04040000
         DS    0F                                                       04060000
DECBDEF  DS    0CL25                                                    04080000
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        04100000
DECTYPE  DS    CL2            TYPE FIELD                                04120000
DECLNGTH DS    CL2            DATA LENGTH                               04140000
DECDCBAD DS    CL4            ADDRESS OF DCB                            04160000
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      04180000
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        04200000
DECKYADR DS    CL4            ADDRESS OF KEY                            04220000
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               04240000
         EJECT                                                          04260000
*                                                                       04280000
*      I/O BLOCK (IOB) DEFINITION                                       04300000
*                                                                       04320000
         IEZIOB                                                         04370002
         ORG   IOBDTYP2                                          Y02072 04520002
IOBRBFDB EQU   X'20'          INDICATES IGG019KF SHOULD RETURN   Y02072 04570002
*                             TO FEEDBACK MODULE                 Y02072 04620002
         ORG   IOBRSV35                                                 04670002
IOBUPLIM DS    D                                                        04720002
         EJECT                                                          05180000
*                                                                       05200000
*      DATA EXTENT BLOCK (DEB) DEFINITION                               05220000
*                                                                       05240000
         DS    0F                                                       05260000
DEBDEF   DSECT                                                          05280000
*                                                                       05300000
         DS    0F                                                       05320000
DEBNMSUB DS    0CL1                    COUNT OF ROUTINES LOADED         05340000
DEBTCBAD DS    CL4                     TASK CONTROL BLOCK ADDRESS       05360000
DEBAMLNG DS    0CL1                    WORD CNT OF BDAM ADDED CORE      05380000
DEBDEBAD DS    CL4                     DEB CHAIN ADDRESS                05400000
DEBOFLGS DS    0CL1                    OPEN FLAGS                       05420000
DEBIRBAD DS    CL4                     IRB ADDRESS                      05440000
DEBOPATB DS    0CL1                    DATA SET ATTRIBUTES              05460000
DEBSYSPG DS    CL4                                                      05480000
DEBNMEXT DS    0CL1                    COUNT OF EXTENTS                 05500000
DEBUSRPG DS    CL4                                                      05520000
DEBPRIOR DS    0CL1                                                     05540000
DEBECBAD DS    CL4                                                      05560000
DEBPROTG DS    0CL1                                                     05580000
DEBDEBID DS    0CL1                                                     05600000
DEBDCBAD DS    CL4                     DCB ADDRESS                      05620000
DEBEXSCL DS    0CL1                    EXTENT SIZE SCALE                05640000
DEBAPPAD DS    CL4                     IOS APPENDAGE LIST ADDRESS       05660000
DEBDVMOD DS    0CL1                    FILE MASK CODE                   05680000
DEBUCBAD DS    CL4                     UCB ADDRESS                      05700000
DEBBINUM DS    CL2                     BIN NUMBER (BB)                  05720000
DEBSTRCC DS    CL2                     STARTING CYLINDER NUMBER         05740000
DEBSTRHH DS    CL2                     STARTING TRACK NUMBER            05760000
DEBENDCC DS    CL2                     ENDING CYLINDER NUMBER           05780000
DEBENDHH DS    CL2                     ENDING TRACK NUMBER              05800000
DEBNMTRK DS    CL2                     NO. OF TRACKS IN THIS EXTENT     05820000
DEBSUBID EQU   0         SUBROUTINE ID'S                                05840000
*                                                                       05860000
*                IO DEVICE TABLE                                        05880000
*                                                                       05900000
         DS    0F                                                       05920000
DTAB     DC    X'000814202C380000'                                      05940000
DEVSZ    DS    CL4                     DEVICE SIZE   CCHH               05960000
TRKLNGTH DS    CL2                     TRACK LENGTH                     05980000
OVERI    DS    CL1                     OVERHEAD  NOT LAST               06000000
OVERL    DS    CL1                     OVERHEAD  NLAST                  06020000
OVERK    DS    CL1                     OVERHEAD  NNON KEYED             06040000
FLAG     DS    CL1                     FLAG                             06060000
TOLER    DS    CL2                     TOLERANCE                        06080000
         END                                                            06100000
./  ADD  SSI=31840076,NAME=IGG019KI
IGG019KI CSECT                                                          00020020
*                                                                       00025020
*                                                                       00030020
*        RELEASE 21 DELETIONS/CHANGES                                   00045020
*        RELEASE 20 DELETIONS/CHANGES                                   00050020
*3000000400,013200,015200,019200                                 S20201 00055020
 TITLE   'IGG019KI - KEY MODULE'                                        00060020
*STATUS CHANGE LEVEL 003                                                00080020
*FUNCTION/OPERATION- THIS ROUTINE IS ENTERED FROM IGG019KA TO         * 00100020
*   CONSTRUCT A CHANNEL PROGRAM TO PERFORM A READ OR WRITE BY KEY,    * 00120020
*   (SEARCH ARGUMENT IS BLOCK KEY).                                   * 00140020
*   THE CCWS ARE CONSTRUCTED OF CONSTANTS DEFINED IN THIS MODULE AND  * 00160020
*   ADDRESSES RESOLVED AT THE TIME THIS ROUTINE IS EXECUTED.          * 00180020
*                                                                     * 00200020
*ENTRY POINT- 'IGG019KI' (BEGIN) IS ENTERED BY THE CALLING SEQUENCE,  * 00220020
*   L    15,DCBDKEY                                                   * 00240020
*   BALR 14,15                                                        * 00260020
*                                                                     * 00280020
*INPUT- THE REGISTERS ARE INPUT AS FOLLOWS,                           * 00300020
*   4 - DCB ADDRESS                                                   * 00320020
*   5 - DECB ADDRESS                                                  * 00340020
*   6 - ADDRESS OF CCW 1 (CHANNEL PROGRAM START)                      * 00360020
*   7 - IOB ADDRESS                                                   * 00380020
*   11- BASE ADDRESS OF FOUNDATION MODULE (IGG019KA)                  * 00400020
*                                                                     * 00420020
*OUTPUT- THE REQUIRED CCWS WILL BE CONSTRUCTED FOLLOWING THE IOB.     * 00440020
*   REGISTER 6 WILL CONTAIN THE ADDRESS OF THE LAST CCW.              * 00460020
*                                                                     * 00480020
*EXTERNAL ROUTINES- 'IGG019KQ' WILL BE ENTERED TO CONSTRUCT THE VERIFY* 00500020
*   CCWS IF THE REQUEST IS A READ AND THE WRITE VALIDITY CHECK OPTION * 00520020
*   HAS BEEN SPECIFIED. 'IGG019KW' WILL BE ENTERED TO CONSTRUCT THE   * 00540002
*   EXTENDED SEARCH PORTION OF THE CHANNEL PROGRAM IF SPECIFIED.      * 00542002
*                                                                     * 00560020
*EXITS-NORMAL- 'D4TOVER' IS THE EXIT TO IGG019KQ IF REQUIRED.         * 00580020
*   'NONCARN' IS THE EXIT TO IGG019KW IF REQUIRED.                    * 00590002
*   'D4EXIT' IS THE NORMAL RETURN TO THE MODULE IGG019KA.             * 00600020
*                                                                     * 00620020
*TABLES/WORK AREAS- N/A                                               * 00640020
*                                                                     * 00660020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED IN USER   * 00680002
*   KEY, PROBLEM PROGRAM STATE.                                       * 00682002
*                                                                     * 00700020
*NOTE- REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT WITH THE  * 00720020
*   MODULES, IGG019KA, IGG019KQ, AND IGG019KW.                        * 00740002
         EJECT                                                          00760020
         USING IGG019KI,D4EPREG                                         00780020
         USING IHADCB,DCBREG                                            00800020
         USING DECBDEF,DECBREG                                          00820020
         USING IOBDEF,IOBREG                                            00840020
*                                                                       00860020
*                                                                       00880020
*  REGISTER USAGE                                                       00900020
*                                                                       00920020
D4WKREG  EQU   0         WORK REGISTER                                  00940020
D4VERR   EQU   1         POINTER TO A SEARCH CCW FOR VERIFY             00960020
DEBREG   EQU   3         DEB ADDRESS                                    00980020
DCBREG   EQU   4         DCB ADDRESS                                    01000020
DECBREG  EQU   5         DECB ADDRESS                                   01020020
D4CCWIND EQU   6         CHANNEL COMMAND INDEX                          01040020
IOBREG   EQU   7         IOB ADDRESS                                    01060020
SECTOR   EQU   8         POINTER TO SECTOR1                      S20201 01070020
VERBASE  EQU   10        BASE FOR THE VERIFY MODULE                     01080020
FDNBASE  EQU   11        BASE FOR THE FOUNDATION MODULE                 01100020
D4       EQU   12        RETURN FOR INTERNAL BAL                        01120020
RETREG   EQU   14        RETURN TO FOUNDATION MODULE                    01140020
D4EPREG  EQU   15        BASE FOR THIS MODULE                           01160020
*                                                                       01180020
*                                                                       01200020
*                                                                       01220020
BEGIN    B     D4ENTRY            BRANCH TO THE BEGINNING OF THE CODE   01240020
D4EKAD   DC    V(IGG019KW)        ADDR OF KEY-EXTENDED SRCH MOD  Y02072 01260002
*                                                                       01280020
*                                                                       01300020
D4ENTRY  EQU   *                                                 S20201 01310020
         LA    D4WKREG,IOBDNRCF+D2      GET AND STORE ADDR OF    S20201 01320020
         ST    D4WKREG,0(D4CCWIND)       NEW RECORD COUNT FIELD IN CCW1 01340020
         MVI   0(D4CCWIND),D4RDCNT      MOVE READ COUNT OP CODE TO CCW1 01360020
         MVC   4(5,D4CCWIND),D4CON1     MOVE FLAGS,COUNT AND SEARCH OP. 01380020
         MVC   9(3,D4CCWIND),DECKYADR+1 MOVE KEY ADDRESS FROM DECB      01400020
         MVI   12(D4CCWIND),D4CCHN+SILI SET COMMAND CHAIN+SILI FLAGS    01420020
         MVC   15(1,D4CCWIND),DCBKEYLE MOVE KEY LENGTH AS COUNT         01440020
         LR    D4WKREG,D4CCWIND        MOVE TO A COMMON LOCATION        01460020
         TM    IOBDTYPE,EXSCH           AND USE AS TIC ADDRESS          01480020
         BC    8,*+8                     UNLESS THIS IS EXTENDED        01500020
         LA    D4WKREG,IOBCP+D96                   SEARCH        S20201 01520020
         ST    D4WKREG,16(D4CCWIND)    STORE TIC ADDRESS                01540020
         MVI   16(D4CCWIND),D4TIC       MOVE TIC OP CODE                01560020
         MVI   24(D4CCWIND),RDDOP      MOVE READ DATA OP-CODE           01580020
         MVC   25(3,D4CCWIND),DECAREA+1 MOVE AREA ADDRESS FROM DECB     01600020
         MVC   30(2,D4CCWIND),DECLNGTH  MOVE DECB LENGTH AS COUNT       01620020
         TM    IOBDTYPE,EXSCH          IF THIS IS EXTENDED SEARCH       01640020
         BC    1,D4EXSCH                GO TO THAT MODULE               01660020
         LA    D4CCWIND,24(D4CCWIND)   INCREMENT TO LAST CCW            01680020
         TM    IOBDTYPE+1,READ         TEST FOR READ OR WRITE           01700020
         BCR   1,RETREG                EXIT IF THIS WAS A READ REQUEST  01720020
         MVI   0(D4CCWIND),D4WRITE     CHANGE READ OP  TO WRITE DATA OP 01740020
         TM    IOBDTYPE,VERIFY          TEST FOR VERIFY OPTION          01760020
         BCR   8,RETREG                  IF NOT GO EXIT                 01780020
         LA    D4VERR,IOBCP+8           SET A POINTER TO THE SEARCH CCW 01800020
         TM    IOBDCPND,YESCARN         IS RPS FEATURED          S20201 01801020
         BNO   NOTCARN                  NO, THEN TEST FOR READ   S20201 01802020
*                                       OR WRIT                  S20201 01803020
         L     SECTOR,IOBDCPND          GET SECTOR ADDR IF RPS   S20201 01804020
         MVI   HALFCCW(D4CCWIND),CCHN   COMMAND CHAIN THE READ   S20201 01805020
*                                       SECTOR                   S20201 01806020
         LA    SECTOR,ONEBYTE(0,SECTOR) POINT TO SECTOR2         S20201 01807020
         ST    SECTOR,FULLCCW(0,D4CCWIND)  PUT PT IN RD SECT     S20201 01808020
*                                       ADDR AREA                S20201 01809020
         MVI   FULLCCW(D4CCWIND),RDSECT PUT IN RD SECT COMMAND   S20201 01810020
*                                       CODE                     S20201 01811020
         MVC   CARN12(HALFCCW,D4CCWIND),FLGCNT  PUT IN           S20201 01812020
*                                       FLAG/COUNT FIEL          S20201 01813020
         LA    D4CCWIND,FULLCCW(0,D4CCWIND) UPDATE PT TO NEXT    S20201 01814020
*                                       CCW                      S20201 01815020
NOTCARN  EQU   *                                                 S20201 01816020
         L     VERBASE,12(0,FDNBASE)   LOAD VERIFY'S ENTRY POINT/BASE   01820020
         BR    VERBASE                 GO CONSTRUCT VERIFY CCWS         01840020
*                                      VERIFY MODULE WILL RETURN TO     01860020
*                                      FOUNDATION ON REGISTER 14        01880020
*                                                                       01900020
D4EXSCH  EQU   *                                                 S20201 01905020
         TM    IOBDCPND,YESCARN         IS RPS AROUND            S20201 01910020
         BNO   NONCARN                  IF NOT, BRANCH           S20201 01915020
         MVI   IOBDCPND,SETSECT         PUT IN HEX 23 FOR KW     S20201 01920020
NONCARN  EQU   *                                                 S20201 01925020
         L     D4EPREG,D4EKAD           LOAD ADDR OF EXTENDED    S20201 01930020
*                                       SEARCH                   S20201 01935020
         BCR   15,D4EPREG            GO TO KEY-EXTENDED SEARCH MODULE   01940020
*                                                                       01960020
*                                                                       01980020
D4CON1   DC    X'6000000529'  FLAGS, COUNT, SEARCH-KEY-EQUAL OP-CODE    02000020
D4RDCNT  EQU   X'12'   OP CODE FOR READ COUNT                           02020020
D4CCHN   EQU   X'40'   COMMAND CHAIN FLAG                               02040020
SILI     EQU   X'20'                   SUPPRESS INCORRECT LENGTH        02060020
D4TIC    EQU   X'08'   TIC OP CODE                                      02080020
D4WRITE  EQU   X'05'   WRITE DATA OP CODE                               02100020
RDDOP    EQU   X'06'    READ DATA OP-CODE                               02120020
*                                                                       02140020
*                                                                       02141020
*      RPS CONSTANTS AND EQUATES                                        02142020
*                                                                       02143020
FLGCNT   DC    X'00000001'              FLAG/COUNT FIELD FOR RD  S20201 02144020
*                                       SECT                     S20201 02145020
*                                                                       02146020
ONEBYTE  EQU   1                        ONE BYTE  DISPLACEMENT   S20201 02147020
D2       EQU   2                        2 BYTE DISPLACEMENT      S20201 02148020
HALFCCW  EQU   4                        HALF CCW  DISPLACEMENT   S20201 02149020
FULLCCW  EQU   8                        FULL CCW DISPLACEMENT    S20201 02150020
CARN12   EQU   12                       1-1/2 CCW DISPLACEMENT   S20201 02151020
D96      EQU   96                       12 CCW DISPLACEMENT      S20201 02152020
*                                                                       02153020
RDSECT   EQU   X'22'                    READ SECTOR COMMAND CODE S20201 02154020
CCHN     EQU   X'40'                    COMMAND CHAINING FLAG    S20201 02155020
SETSECT  EQU   X'23'                    CODE FOR KW MODULE       S20201 02156020
YESCARN  EQU   X'FF'                   BYTE TO TEST FOR RPS      S20201 02157020
         DC    X'00'   FILLER - FILLER - FILLER                         02160020
HYGDN    DC    C'IGGR'                  THIS CONSTANT IS TO      S20201 02165020
*                                         POSITION SENSING              02170020
*                                          MODULE                       02175020
*              THE FOLLOWING CNOP MUST REMAIN ON A HALF-WORD BOUNDARY   02180020
         CNOP  0,8                 PAD MODULE TO DOUBLE WORD MULTIPLE   02200020
         EJECT                                                          02220020
*              EXCEPTION CODES                                          02240020
NOREC    EQU   X'80'                                                    02260020
LGNCK    EQU   X'40'                                                    02280020
NOSPA    EQU   X'20'                                                    02300020
INVAL    EQU   X'10'                                                    02320020
UNCOR    EQU   X'08'                                                    02340020
ENDOD    EQU   X'04'                                                    02360020
UNREL    EQU   X'02'                                                    02380020
*              OPTIONS AND TYPE                                         02400020
VERIFY   EQU   X'80'                                                    02420020
OFLOW    EQU   X'40'                                                    02440020
EXSCH    EQU   X'20'                                                    02460020
FEEDB    EQU   X'10'                                                    02480020
ACTAD    EQU   X'08'                                                    02500020
DYNBF    EQU   X'04'                                                    02520020
READX    EQU   X'02'                                                    02540020
RELRD    EQU   X'01'                                                    02560020
KEYOP    EQU   X'80'                                                    02580020
LGNOP    EQU   X'40'                                                    02600020
READ     EQU   X'08'                                                    02620020
KEY      EQU   X'04'                                                    02640020
ADD      EQU   X'02'                                                    02660020
*      DATA CONTROL BLOCK (DCB) DEFINITION                              02680020
*                                                                       02700020
         DCBD  DSORG=DA                                                 02720020
*                                                                       02740020
*                                                                       02760020
*                                                                       02780020
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       02800020
         DS    0F                                                       02820020
DECBDEF  DSECT                                                          02840020
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        02860020
DECTYPE  DS    CL2            TYPE FIELD                                02880020
DECLNGTH DS    CL2            DATA LENGTH                               02900020
DECDCBAD DS    CL4            ADDRESS OF DCB                            02920020
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      02940020
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        02960020
DECKYADR DS    CL4            ADDRESS OF KEY                            02980020
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               03000020
         EJECT                                                          03020020
*                                                                       03040020
*      I/O BLOCK (IOB) DEFINITION                                       03060020
*                                                                       03080020
*              STANDARD IOB                                             03100020
         DS    0F                                                       03120020
IOBDEF   DSECT                                                          03140020
IOBFLAG1 DS    CL1            STATUS FLAG                               03160020
IOBFLAG2 DS    CL1            ERROR FLAG                                03180020
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       03200020
IOBECBPT DS    CL4            ECB POINTER                               03220020
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       03240020
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           03260020
         DS    CL1                                                      03280020
         DS    CL3                                                      03300020
IOBCSWST DS    CL2            STATUS BYTES                              03320020
IOBCSWCT DS    CL2            REMAINING COUNT                           03340020
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   03360020
IOBSIOCC DS    CL1            SIO CONDITION CODE                        03380020
         DS    CL3                                                      03400020
IOBDCBPT DS    0CL4           DCB POINTER                               03420020
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            03440020
         DS    CL3                                                      03460020
IOBRESTR DS    0CL4           RESTART POINTER                           03480020
         DS    CL1                                                      03500020
         DS    CL3                                                      03520020
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              03540020
IOBERRCT DS    CL2            ERROR COUNTER                             03560020
IOBSEEK  DS    CL8            SEEK ADDRESS                              03580020
*        BDAM EXTENDED IOB                                              03600020
*                                                                       03620020
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  03640020
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          03660020
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     03680020
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                03700020
         DS    CL3                                                      03720020
IOBDTYPE DS    CL2            TYPE FIELD                                03740020
IOBDSTAT DS    CL2            IOB STATUS                                03760020
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        03780020
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                03800020
         DS    CL2                                                      03820020
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               03840020
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        03860020
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                03880020
IOBCP    DS    CL200                   CHANNEL PROGRAM AREA             03900020
         END                                                            03920020
./  ADD  SSI=61940509,NAME=IGG019KJ
        TITLE 'IGG019KJ - BDAM VRE FOUNDATION MODULE'                   00050002
IGG019KJ CSECT                                                          00100019
*MODULE NAME - IGG019KJ                                               * 00102002
*                                                                     * 00104002
*DESCRIPTIVE NAME - BDAM FOUNDATION MODULE, VARIABLE SPANNED RECORDS  * 00106002
*                                                                     * 00106402
*COPYRIGHT - NONE                                                     * 00106802
*                                                                     * 00107202
*CHANGE ACTIVITY                                                      * 00107602
*                                                                     * 00108002
*          OS REL 20 CHANGES/DELETIONS                                  00118002
*3572230600-230700                                               M5471  00128002
*3572                                                            A33688 00138002
*3572001100,002000-003400,172000,197000-197500,280000,371000,    20201  00138402
*3572516500,518100                                               20201  00138802
*          OS REL 21 CHANGES/DELETIONS                                  00140002
*1132                                                            A44088 00145021
*                                                               SA53267 00145521
*3572184530,196860-196940,272500,309500-310000,311000,325500-326000     00146021
*351000-353000,608000,667000-669000,708000,720500-721500,766700  21905  00147002
*3572269000,577000,577500,583500,584500,600000                   A35339 00148021
*3572588000-588500,609000-611500,613500                          A30797 00149021
*158500,162000-164500                                           SA54515 00159002
*          VS 1-1 CHANGES/DELETIONS                                     00199002
*          VS 2-1 CHANGES/DELETIONS                                     00249002
*                                                               XA00093 00259002
*          VS 1-3 CHANGES/DELETIONS                                     00299002
*                                                               XA02033 00301002
*                                                               XA03071 00303002
*          VS 2-2 CHANGES/DELETIONS                                     00309002
*                                                                Y02072 00319002
*                                                                YM1143 00329002
*                                                                YM1458 00339002
*                                                                YM5969 00341002
*461060-461080                                                   YM7542 00341402
*                                                                YM5853 00341802
*D147000                                                         YM7841 00341902
*A138100-138300,146600,147100-147300,147600-148100              ZA01524 00363500
*          VS 2-4 CHANGES/DELETIONS                                     00363903
*D314030-322124                                                @ZA08000 00364303
*                                                                       00365219
*STATUS CHANGE LEVEL 006                                                00376802
*                                                                       00388419
*FUNCTION/OPERATION - THIS IS THE BASIC MODULE OF BDAM FOR VRE.  THIS * 00400019
*   FOUNDATION MODULE CONSISTS OF THREE MAIN FUNCTIONAL ROUTINES -    * 00450019
*   ROUTINE 1. INITIAL ENTRY FOR ANY BDAM READ OR WRITE, CHECK THE    * 00500019
*    VALIDITY OF SPECIFIED TYPE AND OPTIONS, OBTAIN AN IOB, PROVIDE   * 00550019
*    LINKAGE FOR ADDRESS CONVERSION AND CHANNEL PROGRAM CONSTRUCTION, * 00600019
*    ISSUE THE 'EXCP' AND RETURN TO THE USER.                         * 00650019
*                                                                     * 00700019
*   ROUTINE 2. ASYNCHRONOUS INTERRUPT ROUTINE (ASI) WHICH IS ENTERED  * 00750002
*    FROM THE SUPERVISOR AT THE COMPLETION OF THE CHANNEL END MODULE. * 00800019
*    IT PERFORMS THE SEGMENTATION PROCESSING, CHANNEL PROGRAM         * 00850019
*    MODIFICATION AND CHANNEL PROGRAM RESTART, IT LINKS NEWLY GOTTEN  * 01000002
*    IOBS TO THE DCB, PROVIDES LINKAGE TO THE FEEDBACK, SELF-FORMAT   * 01010002
*    AND READ EXCLUSIVE MODULES, MAKES THE IOB AVAILABLE, ISSUES THE  * 01020002
*    'POST' AND RETURNS TO THE SUPERVISOR.                            * 01030002
*                                                                     * 01200019
*   ROUTINE 3. ERROR ROUTINES, RELEASE THE IOB, SET THE PROPER        * 01250019
*    EXCEPTION CODES, ISSUE THE 'POST'.                               * 01300019
*                                                                     * 01350019
*ENTRY POINTS- 'IGG019KJ' (ENTRYPT) IS THE ENTRY FOR A BDAM READ OR   * 01360002
*   WRITE MACRO INSTRUCTION. THE GENERATED CALLING SEQUENCE IS,       * 01370002
*            L    15,DCBREAD   (DCB+48)                               * 01400002
*            BALR 14,15                                               * 01450002
*                                                                     * 01500019
*   'IECDFDNA' IS THE ENTRY POINT TO THE ASI ROUTINE FROM SUPERVISOR  * 01550019
*   WHEN THE REQUEST HAS TERMINATED. THE CALLING SEQUENCE USED IS,    * 01600019
*            L    15,IRBRBEP   (IRB+12)                               * 01650002
*            BALR 14,15                                               * 01700002
*                                                                     * 01750019
*   'LATERR' IS AN ENTRY TO THE INVALID REQUEST ERROR ROUTINE FROM    * 01800019
*   THE ADDRESS CONVERSION OR PRE-FORMAT MODULES. CALLING SEQUENCE IS,* 01850019
*            L    REG,20(IGG019KA BASE)                               * 01900002
*            BR   REG                                                 * 01950002
*                                                                     * 02000019
*INPUT- ROUTINE 1.- DECB ADDRESS IN REGISTER 1, SAVE AREA ADDRESS IN  * 02050019
*   REGISTER 13, RETURN ADDRESS IN REGISTER 14, ENTRY POINT IN        * 02100019
*   REGISTER 15.                                                      * 02150019
*                                                                     * 02200019
*   ROUTINE 2.(ASI)- IOS QUEUEING ELEMENT ADDRESS IN REGISTER 1,      * 02250019
*   RETURN ADDRESS IN REGISTER 14, ENTRY POINT IN REGISTER 15.        * 02300019
*                                                                     * 02350019
*   ROUTINE 3.(INVALID REQUEST)- REGISTERS 5,7,11,13 WILL CONTAIN THE * 02400019
*   DECB ADDRESS, IOB ADDRESS, IGG019KJ ADDRESS, SAVE AREA ADDRESS,   * 02450019
*   RESPECTIVELY. REGISTER 12 WILL CONTAIN THE REASON CODE WHICH WILL * 02500019
*   APPEAR IN BYTE TWO OF THE DECB AFTER 'POST' IS EXECUTED.          * 02550019
*                                                                     * 02600019
*OUTPUT- ROUTINE 1.- AN IOB WILL BE OBTAINED, CHANNEL PROGRAM         * 02650019
*   CONSTRUCTED AND 'EXCP' EXCECUTED FOR A VALID READ OR WRITE.       * 02700019
*                                                                     * 02750019
*   ROUTINE 2.(ASI)- FEEDBACK WILL BE RETURNED IF REQUESTED, AND A    * 02800019
*   COMPLETION CODE PLACED IN THE DECB BY THE 'POST' ROUTINE.         * 02850019
*                                                                     * 02900019
*   ROUTINE 3.(INVALID REQUEST)- A COMPLETION CODE AND REASON CODE    * 02950019
*   ARE PLACED IN THE DECB BY THE 'POST' ROUTINE.                     * 03000019
*                                                                     * 03050019
*EXTERNAL ROUTINES- 'IGG019KC'-CONVERT RELATIVE TRACK ADDRESS (TT OR  * 03100019
*   TTR) TO AN ACTUAL ADDRESS OR CONVERT ACTUAL TO TTR FOR FEEDBACK.  * 03150019
*                                                                     * 03200019
*   'IGG019KR'-CONSTRUCT A CHANNEL PROGRAM TO SEARCH BY BLOCK ID OR   * 03250019
*             -CONSTRUCT A CHANNEL PROGRAM TO SEARCH BY BLOCK KEY.    * 03300019
*                                                                     * 03350019
*   'IGG019KN'-CONSTRUCT A CHANNEL PROGRAM TO ADD A NEW BLOCK TO A    * 03400019
*   DATA SET OF VARIABLE LENGTH SPANNED RECORDS, (SELF-FORMAT MODULE).* 03450019
*   ALSO ENTERED TO DETERMINE IF THE NEW BLOCK WILL FIT ON THE TRACK  * 03500019
*   AFTER THE CAPACITY RECORD IS READ INTO THE IOB.                   * 03550019
*   ALSO ENTERED AFTER THE WRITE-ADD REQUEST HAS COMPLETED, TO SCAN   * 03600019
*   THE UNSCHEDULED QUEUE FOR OTHER WRITE-ADD REQUESTS AND EXECUTE    * 03650019
*   THE FIRST REQUEST FOUND, IF ANY.                                  * 03700019
*                                                                     * 03750019
*   SVC 53 -   PLACE A RECORD ON THE READ EXCLUSIVE LIST FOR A READ   * 03800002
*   OR WRITE ADD REQUEST, OR REMOVE A RECORD FROM THE LIST FOR WRITE  * 03810002
*   WHEN EXCLUSIVE CONTROL IS SPECIFIED.                              * 03900019
*                                                                     * 03950019
*   'IGG019KG'-CONVERT AN ACTUAL ADDRESS TO A RELATIVE BLOCK NUMBER   * 04000019
*   IF FEEDBACK IS REQUESTED.                                         * 04050019
*                                                                     * 04100019
*EXITS-NORMAL- 'RSTOR' IS THE RETURN TO THE PROGRAM WHICH ISSUED THE  * 04150019
*   READ OR WRITE MACRO-INSTRUCTION. THE REQUEST HAS EITHER BEEN      * 04200019
*   EXECUTED VIA 'EXCP' OR HAS BEEN POSTED COMPLETE AS AN INVALID     * 04250019
*   REQUEST.                                                          * 04300019
*   'SUPEXIT' IS THE EXIT FROM THE ASI ROUTINE TO SUPERVISOR. THE DECB* 04350019
*   HAS BEEN POSTED AS COMPLETE WITH A CODE INDICATING SUCCESSFUL OR  * 04400019
*   ERROR COMPLETION.                                                 * 04450019
*   'EXCPEXIT' IS THE EXIT FROM THE ASI ROUTINE AFTER A CHANNEL       * 04500019
*   PROGRAM HAS BEEN RESTARTED.                                       * 04550019
*                                                                     * 04600019
*TABLES/WORK AREAS- N/A                                               * 04650019
*                                                                     * 04700019
*ATTRIBUTES- THE INITIAL ENTRY ROUTINE AND INVALID REQUEST ERROR      * 04750019
*   ROUTINE ARE REENTRANT AND EXECUTED ENABLED.                       * 04800019
*   THE ASI ROUTINE IS REUSEABLE AND EXECUTED ENABLED, PROBLEM PGM    * 04850002
*   STATE AND THE PROBLEM PROGRAM PROTECT KEY.                        * 04900002
*                                                                     * 04950019
*NOTE- THE BDAM MODUES BRANCH AND LINK TO EACH OTHER WITHOUT USE OF   * 05000019
*   A REGISTER SAVE AREA SO THE REGISTER USAGE MUST REMAIN CONSISTENT * 05050019
*   IN THE BDAM MODULES, IGG019KJ, IGG019KC, IGG019KQ, IGG019KR,      * 05100019
*   IGG019KG, IGG019KN.                                               * 05150019
*                                                                     * 05200019
*                                                                     * 05250002
*                                                                       05350019
*                                                                       05400019
         IEZBITS                                                        05670021
*                                                                       05700019
*  REGISTER USAGE                                                       05750019
*                                                                       05800019
PARAM2   EQU   0                                                        05850019
PARAM    EQU   1         PARAMETERS                                     05900019
WKREG1   EQU   2         WORK REGISTER                                  05950019
DEBREG   EQU   3         DEB ADDRESS                                    06000019
DCBREG   EQU   4         DCB ADDRESS                                    06050019
DECBREG  EQU   5         DECB ADDRESS                                   06100019
WKREG2   EQU   6         WORK REGISTER                                  06150019
IOBREG   EQU   7         IOB ADDRESS                                    06200019
FDNBASE  EQU   11        BASE FOR THE FOUNDATION MODULE                 06250019
INTRET   EQU   12        RETURN FOR INTERNAL LINKAGES                   06300019
SAVE     EQU   13        POINTER TO USER SAVE AREA                      06350019
RETREG   EQU   14        RETURN REGISTER                                06400019
EPREG    EQU   15        ENTRY POINT                                    06450019
*                                                                       06500019
         EJECT                                                          06550019
*                                                                       06600019
         USING IGG019KJ,EPREG                                           06610002
*                                                                       06650019
ENTRYPT  B     BEGIN                    BRANCH AROUND ADDRESS LOCATIONS 06700019
*                                                                       06750019
RRAD     DC    F'0'                     RELATIVE BLOCK MODULE ADDRESS   06800019
RTAD     DC    V(IGG019KC)              RELATIVE TRACK MOD ADDR  Y02072 06850002
VERAD    DC    V(IGG019KQ)              VERIFY MODULE ADDRESS    Y02072 06900002
ASIAD    DC    A(IECDFDNA)              ASYNCH INTERRUPT ROUTINE Y02072 06950002
ERRENTRY DC    A(LATERR)                INVALID REQUEST ERROR RT Y02072 07000002
KEYMODAD DC    V(IGG019KR)              ADDRESS OF THE KEY MOD   Y02072 07050002
IDMODAD  DC    V(IGG019KR)              ADDRESS OF THE ID MODULE Y02072 07100002
*                                                                       07150019
*                                                                       07200019
*                                                                       07250019
         DROP  EPREG                                                    07300019
         USING IGG019KJ,FDNBASE                                         07350019
BEGIN    SAVE  (14,12)                  SAVE USER REGISTERS IN HIS AREA 07400019
         LR    FDNBASE,EPREG            ESTABLISH A BASE FOR MODULE     07450019
         LR    DECBREG,PARAM            SET BASE REGISTERS FOR DECB     07500019
         USING DECBDEF,DECBREG                                   Y02072 07510002
         L     DCBREG,DECDCBAD          SET BASE REGISTER FOR DCB       07550002
         USING IHADCB,DCBREG                                     Y02072 07560002
         L     DEBREG,DCBDEBAD          SET BASE REGISTER FOR DEB       07600002
         USING DEBDEF,DEBREG                                            07620001
*                                                                       07650019
         IC    INTRET,DECTYPE           SAVE REQUESTED OPTIONS IN A REG 07700019
         OI    DECTYPE,VERIFY+EXSCH+ACTAD+RELRD+OFLOW                   07750019
         NC    DECTYPE(ONE),DCBOPTCD    COMBINE DCB OPTIONS WITH THE    07800019
         EX    INTRET,ORBACK            REQUEST OPTIONS.                07850019
         N     INTRET,OPSMSK            VALIDITY CHECK READX,DYN. BFR.  07900019
         BZ    OKOPTS                   OPTIONS (BR IF NONE PRESENT),BY 07950019
         EX    INTRET,VALCHK            EXECUTING A TM INSTRUCTION.     08000019
         BO    OKOPTS                   OK IF ALSO SPECIFIED IN DCB,    08050019
         IC    INTRET,INVOPT            ELSE FLAG THIS REQUEST AS       08100019
         B     ABORT                    INVALID AND GO POST COMPLETION. 08150019
*                                                                       08200019
ORBACK   OI    DECTYPE,NULL  EXECUTED-RETURN FEEDBACK OPTION BIT.       08250019
VALCHK   TM    DCBOPTCD,NULL EXECUTED-CHECK READX,DYN. BFR. REQUEST.    08300019
*                                                                       08350019
OKOPTS   TM    DECTYPE+ONE,READ         IS THIS A READ REQUEST          08400019
         BO    LGNCHK                   YES, GO TEST LENGTH OPTION      08450019
         TM    DEBOPATB,WRTMSK          DID OPEN SPECIFY OUTPUT/UPDATE  08500019
         BC    ONE+MIXED,FORMCHK        YES, WRITE REQUEST IS VALID     08550019
         IC    INTRET,INVWRT            FLAG THIS WRITE TO INPUT DATA   08600019
         B     ABORT                    SET, GO POST COMPLETION         08650019
*                                                                       08700019
*                                                                       08750019
FORMCHK  EQU   *                                                        08800019
         L     WKREG2,DECAREA            USE FIRST TWO BYTES OF DATA AS 08850019
         MVC   DECLNGTH(TWO),NULL(WKREG2) BLOCK LENGTH FOR THE WRITE    08900019
         B     SZRTN                     GO DETERMINE IOB SIZE          08950019
*                                                                       09000019
LGNCHK   EQU   *                                                        09050019
         TM    DECTYPE+ONE,LGNOP         DID USER CODE LENGTH AS 'S'    09100019
         BZ    SZRTN                     NO, USE DECB LENGTH            09150019
         MVC   DECLNGTH(TWO),DCBBLKSI    USE MAXIMUM BLOCK SIZE         09200019
*                                                                       09250019
SZRTN    EQU   *                                                        09300019
*********************************************************************** 09400019
*                                                                     * 09450019
*  THE FOLLOWING ROUTINE CALCULATES THE SIZE OF THE IOB WHICH IS      * 09500019
*  REQUIRED FOR THIS REQUEST.                                           09550019
*                                                                       09600019
*                                                                       09650019
         LA    WKREG1,BASESZ            IOB SIZE = BASE + OPTIONS       09700019
         TM    DECTYPE+ONE,KEY          IS TYPE = DK                    09750019
         BZ    TSTRD                    BR IF NO                        09800019
         TM    DECTYPE,EXSCH            TEST FOR EXTENDED SEARCH        09850019
         BZ    TSTRD                    BR IF NO                        09900019
         CLC   ZEROS(THREE),DCBLIMCT    IS LENGTH OF SEARCH SPECIFIED   09950019
         BC    ONE+MIXED,ESOK           YES, REQUEST IS VALID           10000019
         IC    INTRET,INVLIMCT          FLAG INVALID REQUEST (LIMCT=0)  10050019
         B     ABORT                    GO POST COMPLETION              10100019
*                                                                       10150019
ESOK     EQU   *                                                        10200019
         TM    DECTYPE+ONE,ADD          IS IT WRITE ADD                 10250019
         BO    ITISADD                  BR IF YES                       10300019
         LA    WKREG1,EXTNDSCH(WKREG1)  ADD EXTENDED SEARCH CHANNEL     10350019
*                                       PROGRAM SIZE                    10400019
         TM    DECTYPE,VERIFY           IS WRITE VALIDITY CHECK REQ'D   10450019
         BZ    READXTST                 BR IF NO                        10500019
         LA    WKREG1,WCUPDTES(WKREG1)  ELSE, ADD ON SIZE FOR WRITE     10550019
*                                       CHECK CCW'S.                    10600019
         B     READXTST                 GO TEST FOR EXCLUSIVE CONTROL   10650019
*                                                                       10700019
TSTRD    EQU   *                                                        10750019
         TM    DECTYPE+ONE,READ         IS THIS A READ REQUEST          10800019
         BZ    ADDTST                   BR IF NO                        10850019
         LA    WKREG1,RDDIORDK(WKREG1)  ADD READ CHANNEL PROGRAM SIZE   10900019
         TM    DECTYPE+ONE,NEXTADR      IS NEXT ADDRESS REQ'D           10950019
         BZ    READXTST                 BR IF NO                        11000019
         TM    DECTYPE+ONE,KEY          IS THIS A READ TYPE = DK        11050019
         BZ    RDTYPDI                  BR IF NO                        11100019
         LA    WKREG1,RNDK(WKREG1)      ADD FOR NEXT ADDRESS CCW'S      11150019
         B     READXTST                 GO TEST FOR READ EXCLUSIVE      11200019
*                                                                       11250019
RDTYPDI  EQU   *                                                        11300019
         LA    WKREG1,RNDI(WKREG1)      ADD FOR NEXT ADDRESS CCW'S      11350019
         B     READXTST                 GO TEST FOR READ EXCLUSIVE      11400019
*                                                                       11450019
ADDTST   EQU   *                                                        11500019
         TM    DECTYPE+ONE,ADD          IS IT WRITE ADD                 11550019
         BZ    NOTADD                   BR IF NO                        11600019
ITISADD  EQU   *                                                        11650019
         LA    WKREG1,WRTADD+EXCNTRL(WKREG1) ADD ON THE WRITE ADD       11700019
*                                       CHANNEL PROGRAM SIZE AND THE    11750019
*                                       EXCLUSIVE CONTROL LIST.         11800019
         TM    DECTYPE,VERIFY           IS WRITE VALIDITY CHECK REQ'D   11850019
         BZ    GOTIOBSZ                 BR IF NO                        11900019
         LA    WKREG1,WCADD(WKREG1)     ADD ON SIZE OF WRITE CHECK CCWS 11950019
         B     GOTIOBSZ                 GO GET AN IOB                   12000019
*                                                                       12050019
NOTADD   EQU   *                                                        12100019
         LA    WKREG1,WRDIORDK(WKREG1)  ADD WRITE CHANNEL PROGRAM SIZE  12150019
         TM    DECTYPE,VERIFY           IS WRITE VALIDITY CHECK REQ'D   12200019
         BZ    READXTST                 BR IF NO                        12250019
         TM    DECTYPE+ONE,KEY          IS THIS A WRITE TYPE = DK       12300019
         BZ    WRTDI                    BR IF NO                        12350019
         LA    WKREG1,WCUPDTDK(WKREG1)  ADD SIZE OF WRITE CHECK CCW'S   12400019
         B     READXTST                 GO TEST FOR EXCLUSIVE CONTROL   12450019
*                                                                       12500019
WRTDI    EQU   *                                                        12550019
         LA    WKREG1,WCUPDTDI(WKREG1)  ADD SIZE OF WRITE CHECK CCW'S   12600019
READXTST EQU   *                                                        12650019
         TM    DECTYPE,READX            IS THIS A READ EXCLUSIVE OR A   12700019
*                                       WRITE TO RELEASE                12750019
         BZ    GOTIOBSZ                 BR IF NEITHER                   12800019
         LA    WKREG1,EXCNTRL(WKREG1)   ADD FOR ENQ PARAMETER LIST      12850019
         SPACE 5                                                        12900019
GOTIOBSZ EQU   *                                                        12950019
         AH    WKREG1,H8                ADD A DOUBLE WORD FOR    20201  12960020
*                                       SECTOR VALUES JUST IN CASE      12970020
*                                       RPS IS USED                     12980020
*********************************************************************** 12990002
*    THE FOLLOWING ROUTINE OBTAINS AN IOB AREA FROM THE POOL OF AREAS   13000019
*     IF ONE OF ENOUGH SIZE IS AVAILABLE                                13050019
*********************************************************************** 13060002
*                                                                       13100019
         USING IOBSTDRD,IOBREG          EST BASE FOR IOB         Y02072 13110002
         L     IOBREG,DCBIOBAD          LOAD FIRST LINK ADDRESS         13150003
SHFT     LA    IOBREG,NULL(IOBREG)      BE SURE HI-ORDER BYTE IS ZERO   13200019
         LTR   IOBREG,IOBREG            TEST FOR ZERO LINK ADDRESS.     13250019
         BZ    GETCR                    IF ADDR=0, GO GET CORE FOR IOB  13300019
         CH    WKREG1,IOBDIOBS          IS THIS IOB AREA LARGE ENOUGH   13350019
         BH    TRYNEXT                  IF NOT GO SEE IF THERE ARE MORE 13400019
         TS    IOBDAYLI                 IS THIS IOB AVAILABLE    Y02072 13450002
         BZ    CLRIOB                   YES, GO INITIALIZE AREA         13500019
*                                                                       13550019
TRYNEXT  L     IOBREG,IOBDPLAD          LOAD NEXT POOL LINK             13600019
         B     SHFT                     GO TEST FOR END OF CHAIN        13650019
*                                                                       13700019
*                                                                       13750019
******************** EXECUTE INSTRUCTIONS**********************         13760000
CLRXC    XC    IOBDTYPE(ONE),IOBDTYPE   EXECUTED-- CLEAR LAST OF IOB    13800019
CLRXXC   XC    IOBDTYPE+Q255(1),IOBDTYPE+Q255 CLR IF IOB+CCWS   ZA01524 13810000
*                                       EXTENDS BEYOND IOBDTYPE ZA01524 13820000
*                                       +255 BYTES              ZA01524 13830000
*                                                                       13850019
*                                                                       13900019
*  GETMAIN ROUTINE                                                      13950019
*                                                                       13960002
GETCR    LR    PARAM2,WKREG1            MOVE BYTE COUNT TO PARAM REG    14000019
         AH    PARAM2,PREFSZ            ADD FOR PREFIX                  14050019
         GETMAIN R,LV=(0)                                               14100019
*                                                                       14150019
         LR    IOBREG,PARAM             LOAD CORE ADDRESS TO IOB BASE   14200019
         AH    IOBREG,PREFSZ            INCREMENT TO FORM IOB PREFIX    14250019
         STH   WKREG1,IOBDIOBS          STORE THE AREA SIZE IN IOB      14300019
         SR    WKREG2,WKREG2            CLEAR THE POOL                  14350019
         ST    WKREG2,IOBDAYLI          ADDRESS AREA             Y02072 14400002
CLRIOB   XC    IOBFLAG1(FT),IOBFLAG1    CLEAR TO IOB SIZE FIELD         14450019
         LR    WKREG2,IOBREG                                            14550019
         SH    WKREG2,PREFSZ            POINT TO START OF IOB PREFIX    14600019
         XC    NULL(L'PREFSZ,WKREG2),NULL(WKREG2) CLEAR PREFIX   Y02072 14650002
         LH    WKREG1,IOBDIOBS          GET SIZE OF IOB         ZA01524 14660000
         SH    WKREG1,K49               REDUCE SIZE TO REMAINING SIZE   14700000
         CH    WKREG1,H255              IOB GREATER THAN 255+   ZA01524 14710000
*                                       49(ALREADY CLEARED)     ZA01524 14720000
         BH    CLROVFF                  YES, GO CLEAR BEYOND    ZA01524 14730000
         EX    WKREG1,CLRXC             CLEAR THE REST OF THE AREA      14750019
         B     CORCLRD                  BR AROUND NEXT INST     ZA01524 14760000
*                                                                       14800019
CLROVFF  EQU   *                        CLEAR IOB GREATER 255   ZA01524 14810000
         XC    IOBDTYPE(Q255),IOBDTYPE  CLEAR 1ST 255 BYTES     ZA01524 14820000
         SH    WKREG1,H255              SUBT AMOUNT CLEARED     ZA01524 14830000
         EX    WKREG1,CLRXXC            CLEAR OUT THE REMAINDER ZA01524 14840000
*                                                                       14850019
CORCLRD  EQU   *                        INITIALIZE IOB          ZA01524 14860000
         ST    DCBREG,IOBDCBPT          STORE DCB ADDRESS IN IOB        14900019
         ST    DECBREG,IOBECBPT         STORE ECB ADDRESS IN IOB        14950019
         ST    IOBREG,DECIOBPT          STORE IOB ADDR IN DECB          15000019
         LA    WKREG1,IOBCHNPR          DEVELOP CHANNEL PROGRAM START   15050002
         ST    WKREG1,IOBSTART          ADDRESS AND STORE IT IN IOB     15100019
         MVC   IOBDTYPE(L'DECTYPE),DECTYPE  MOVE OPT,TYPE CODES  YM1143 15150002
         MVI   IOBFLAG1,CPFLAG          MARK AS UNRELATED,COMMAND CHAIN 15200019
*                                                                       15250019
*    THE FOLLOWING ROUTINE DETERMINES THE ADDRESSING METHOD BEING       15300019
*     USED AND CHECKS THE VALIDITY OF THE ADDRESS.                      15350019
*                                                                       15400019
         L     PARAM,DECRECPT           LOAD POINTER TO USER'S ADDRESS  15450003
         LA    RETREG,CLRCP             LOAD COMMON RETURN POINT ADDR   15500019
         TM    IOBDTYP2,IOBRQUST+IOBADDTY  BYPASS NEXT RTN IF READ/ADD  15550002
         BC    ONE+MIXED,D1NOFDBK       AND GO DETERMINE ADDRESS TYPE   15600019
         TM    IOBDTYP2,IOBTYPE         IF TYPE IS KEY, BYPASS CHECKING 15650002
         BO    TRYX                     FOR A WRITE TO R ZERO           15700019
         TM    IOBDTYPE,IOBACTAD        IS ADDRESS ACTUAL               15750002
         BZ    TRYRT                    NO, GO TEST FURTHER             15800019
TESTR0   EQU   *                        WRT R0 INVALID -TEST IT OX02033 15850002
         CLI   IDDISP(PARAM),IDOFZERO   IS THIS A WRITE TO R0           15900019
         BNE   ACTUAL                   NO, ACTUAL ADDRESS IS OK        15950019
SETIRBIT IC    INTRET,INVID             FLAG INVAL REQ. (WRITE TO R0)   16000019
         B     LATERR                   GO POST COMPLETION, FREE IOB    16050019
*                                                                       16100019
TRYRT    EQU   *                                                        16150019
         TM    DCBOPTCD,DCBOPTF         FEEDBACK IN DCB OPTCD?  XA02033 16200002
         BO    TRYRT2                   YES, NOT ACTUAL ADDRESS XA02033 16250002
         TM    IOBDTYPE,IOBRDEXC+IOBFDBCK  WRT REL/FDBK IN DECB XA03071 16300002
         BO    TESTR0                   YES, ASSUME ACTUAL ADDR XA02033 16350002
*                                       BECAUSE FEEDBACK ALWAYS XA02033 16400002
*                                       PROVIDED FOR READX REQ  XA02033 16450002
*                                       AND WRT REL MUST ASSUME XA02033 16460002
*                                       PREVIOUS READX REQUEST  XA02033 16470002
TRYRT2   EQU   *                        NOT ACTUAL ADDRESSING   XA02033 16480002
         CLI   ROFTTR(PARAM),IDOFZERO   IS R OF TTR A 0                 16500019
         BE    SETIRBIT                 YES,WRITE REQUEST IS INVALID    16550019
*                                                                       16600019
RELTRKX  L     EPREG,RTAD               EXIT TO CONVERT TTR TO AN       16650019
         B     CNVENTRY(EPREG)          ACTUAL ADDRESS                  16700019
*                                                                       16750019
TRYX     TM    IOBDTYPE,IOBRDEXC        IS THIS A WRITE WITH FEEDBACK   16800002
         BZ    D1NOFDBK                 NO, GO TEST ADDRESS TYPE        16850019
         TM    DCBOPTCD,DCBOPTF         WAS FEEDBACK RELATIVE FOR READ  16900002
         BZ    ACTUAL                   NO, GO MOVE ACTUAL ADDR TO IOB  16950019
D1NOFDBK TM    IOBDTYPE,IOBACTAD        IF ADDRESS IS ALREADY ACTUAL,   17000002
         BO    ACTUAL                   GO MOVE IT TO THE IOB,          17050002
         B     RELTRKX                  GO TO RELATIVE TRACK EXIT       17100019
*                                                                       17150019
CLRCP    EQU   *                                                 20201  17170020
         XC    IOBDNCRF(FZ+CCWLN),IOBDNCRF  CLEAR AREA TO STORE  20201  17190002
*                                       REG'S PLUS REC REDY DW          17210020
         B     GETSWA                   OBTAIN SEGMENT WORK AREA        17250019
*                                                                       17300019
*  THE FOLLOWING ROUTINE DETERMINES THE TYPE OF READ OR WRITE           17350019
*    AND PROVIDES LINKAGE TO THE PROPER MODULE                          17400019
*                                                                       17450019
ACTUAL   MVC   IOBSEEK,NULL(PARAM)      MOVE USER ADDRESS TO            17500019
         MVC   IOBUPLIM(SEVN),IOBSEEK   SEEK AND LIMIT FIELDS           17550019
*                                                                       17600019
*   THIS SECTION OF CODE WILL LOCATE A SEGMENT WORK AREA AND            17650019
*   ASSIGN IT TO THE IOB FOR THIS REQUEST IF DYNAMIC BUFFERING          17700019
*   IS NOT USED.  IF DYNAMIC BUFFERING IS USED, A BUFFER WILL BE        17750019
*   OBTAINED AT SIO TIME.                                               17800019
*                                                                       17850019
GETSWA   EQU   *                                                        17900019
         LR    WKREG1,IOBREG                                            17950019
         SH    WKREG1,IOBASWA           POINT TO SWA ADDR FIELD         18000019
         TM    IOBDTYPE,IOBDYNBF        TEST FOR DYNAMIC BUFFERING      18050002
         BZ    PRELOOP                  GET A SWA IF NOT                18100019
         TM    DECTYPE+ONE,READ         IS THIS A READ REQUEST          18150019
         BO    TYPEDEC                  IF YES, NO SWA REQUIRED         18200019
         L     WKREG2,DECAREA           GET RECORD AREA ADDRESS         18250019
         SH    WKREG2,FOUR              GET SWA ADDRESS                 18300019
         TM    IOBDTYP2,IOBSKEY         WAS KEY ADDR 'S'?       XA00093 18310002
         BZ    MOVESWAD                 BR IF NOT               XA00093 18320002
         SR    RETREG,RETREG            CLEAR REG               XA00093 18330002
         IC    RETREG,DCBKEYLE          BACK UP BY LENGTH OF    XA00093 18340002
         SR    WKREG2,RETREG            KEY WHICH PRECEDES      XA00093 18342002
MOVESWAD EQU   *                        RECORD                  XA00093 18344002
         MVC   NULL(EQU4,WKREG1),NULL(WKREG2)  MOVE SWA ADDR TO IOB     18350019
         B     TYPEDEC                  GO GENERATE THE CHANNEL PROGRAM 18400019
PRELOOP  EQU   *                                                        18450019
         TM    DCBOPTCD,DCBOPTDB        SEE IF DYNAMIC BUFFERING IN DCB 18451002
         BZ    GETSWA2                  BRANCH IF NO                    18452019
         L     PARAM,DEBUCBAD           LOAD UCB ADDRESS                18453002
         L     WKREG2,CVTPTR(NULL,NULL) LOAD CVT ADDRESS                18454019
         L     WKREG2,DTABOFF(NULL,WKREG2) LOAD DEVICE TABLE ADDRESS    18455002
         IC    PARAM,TYPCD(PARAM)       LOAD DEVICE CODE                18457019
         N     PARAM,LASTFOUR           CLEAR ALL BUT LOW ORDER 4 BITS  18458019
         IC    PARAM,NULL(PARAM,WKREG2) FIND ENTRY TRK LENGTH OFFSET    18459019
         LA    WKREG2,EQU4(PARAM,WKREG2) POINT TO ENTRY TRK LENGTH      18460019
         LH    WKREG2,NULL(WKREG2)      LOAD TRK LNGTH                  18461019
         CH    WKREG2,DCBBLKSI          COMPARE MAX LOG REC LNGTH AND   18462019
*                                       TRK SIZE                        18463019
         BL    ADDCNTL                  TRK SIZE LOW, BRANCH            18464019
         LH    WKREG2,DCBBLKSI          USE MAX LOGICAL REC LNGTH       18465019
ADDCNTL  EQU   *                                                        18466019
         LA    PARAM2,CNTLBYTE(WKREG2)  ADD CNTL BYTES                  18467019
         GETMAIN R,LV=(0)               GET CORE                        18468019
         LA    WKREG2,TEN(WKREG2)       ADD CNTL FIELD TO SWA SIZE      18469019
         STH   WKREG2,SIX(PARAM)        PUT BUFFER SIZE IN BUFCB        18470019
         XC    RAINC(EQU4,PARAM),RAINC(PARAM)                           18471019
*                                       PUT ZERO IN BUFFER POINTER      18472019
         LA    WKREG2,ONE                                               18473019
         STH   WKREG2,EQU4(PARAM)       PUT NO OF BUFFERS IN BUFCB      18474019
         LA    WKREG2,RAINC(PARAM)      GET ADDRESS OF SWA              18475019
         ST    WKREG2,NULL(PARAM)       PUT ADD IN BUFCB                18476019
         B     GOTSWA                   GO LINK SWA TO IOB              18477019
*                                                                       18500019
*   LOCATE A SEGMENT WORK AREA                                          18550019
*                                                                       18600019
GETSWA2  EQU   *                                                        18620019
         L     WKREG2,DCBDYNB           GET ADDRESS OF BCB              18650019
SWALOOP  L     WKREG2,NULL(WKREG2)      GET A SWA ADDRESS               18700019
         LA    WKREG2,NULL(WKREG2)      CLEAR HI ORDER BYTE             18750019
         LTR   WKREG2,WKREG2            SEE IF NO MORE SWA'S            18800019
         BZ    NOSWA                    BRANCH IN NO SWA AVAIL.         18850019
         TS    NULL(WKREG2)             DETERMINE IF SWA IS AVAIL.      18900019
         BZ    GOTSWA                   BRANCH IF SWA CAN BE USED       18950019
         B     SWALOOP                  ELSE TRY FOR ANOTHER ONE        19000019
*                                                                       19050019
GOTSWA   EQU   *                                                        19100019
         ST    WKREG2,NULL(WKREG1)      STORE SWA ADDRESS               19150019
         MVC   RADSP(RALEN,WKREG2),DECAREA  PUT RECORD AREA PTR IN SWA  19200019
         MVI   RADSP(WKREG2),NULL       SET TRACK COUNT TO ZERO         19250019
         XC    RAINC(RAINCLN,WKREG2),RAINC(WKREG2)  ZERO B.I. FIELD     19300019
         B     TYPEDEC                  GO CONSTRUCT CCW'S              19350019
*                                                                       19400019
NOSWA    IC    INTRET,NOSWACD           SET NO SWA ERROR CODE           19450019
         B     LATERR                   GO POST COMPLETION              19500019
*                                                                       19550019
*                                                                     * 19600019
TYPEDEC  LA    RETREG,EXPCTEND          LOAD COMMON RETURN ADDR  Y02072 19650002
*                                                                       19654020
* CHECK FOR RPS AND IF USED BUILD FIRST SECTOR ADDRESS AND              19658020
* PUT IN FIRST CCW ALSO SET SECTOR CMND WHICH WILL BE USED TO           19662020
*      INDICATE RPS CHANNEL PROGRAMS ARE TO BE BUILT                    19666020
*                                                                       19670020
         SR    WKREG1,WKREG1            CLEAR REG FOR IT         20201  19674020
         IC    WKREG1,IOBM              GET EXTENT NO.           20201  19678002
         SLL   WKREG1,FOURB             MULTIPLY BY 16           20201  19682020
         L     WKREG2,DEBUCBAD(WKREG1)  GET UCB ADDRESS FOR      20201  19686002
*                                       PRESENT EXTENT           20201  19692102
         TM    OPTOFF(WKREG2),RCDRY     IS RCD READY TO BE USED  20201  19698020
         BNO   NOTRRA                   BRANCH IF NO             20201  19702020
         LH    WKREG2,IOBDIOBS          GET IOB SIZE             20201  19706020
         AR    WKREG2,IOBREG            ADD IOB ADDR             20201  19710020
         LH    WKREG1,H8                DOUBLE WORD OF RCD READY 20201  19714020
         TM    DECTYPE,READX            READ EXCLUSIVE USED      20201  19718020
         BO    ADDIT                    BRANCH IF YES            20201  19722020
         TM    DECTYPE+ONE,ADD          WRITE ADD                20201  19726020
         BZ    NOTREX                   BRANCH IF NO             20201  19730020
*                                                                       19734020
ADDIT    EQU   *                                                 20201  19738020
         LA    WKREG1,EXCNTRL(WKREG1)   ADD ENQ SIZE             20201  19742020
NOTREX   EQU   *                                                 20201  19746020
         SR    WKREG2,WKREG1            OBTAIN SECTOR ADDRESS    20201  19750020
*                                                                       19754020
         ST    WKREG2,IOBDCPND          PUT TEMPORARILY IN IOB   20201  19758020
         MVI   IOBDCPND,SETSC           PUT CMND IN FOR          20201  19762020
*                                       INDICATOR                20201  19766020
         SH    IOBREG,PREFSZ            GET IOB PREFIX           20201  19770020
         OI    NULL(IOBREG),RCDRYM      TURN ON RCD READY MASK   20201  19774020
         AH    IOBREG,PREFSZ            RESTORE IOB REG          20201  19778020
NOTRRA   EQU   *                                                 20201  19782020
         LA    WKREG2,IOBCHNPR          INIT CCW PTR.            20201  19786002
*                                                                       19790020
         TM    IOBDTYP2,IOBADDTY+IOBTYPE  IS TYPE KEY OR WRITE ADD      19800003
         BZ    IDEXIT                   NO, GO GENERATE ID CHAN PROGRAM 19850019
         MVI   IOBR,IDOFZERO            MAKE R BYTE ZERO TO SEARCH ON 0 19900002
*                                                                       19950019
         TM    IOBDTYP2,IOBADDTY        IS TYPE WRITE ADD               20000002
         BO    SOMEWA                   YES, GO TEST RECORD FORMAT      20050019
         CLI   DCBKEYLE,NULL            HAVE KEYS BEEN SPECIFIED        20100003
         BE    SETNOKEY                 NO, GO SET ERROR CODE           20150019
         L     WKREG1,DECKYADR          LOAD AND TEST FOR MISSING KEY   20200019
         LTR   WKREG1,WKREG1            ADDRESS FIELD IN DECB           20250019
         BC    NONZERO,PROCEED          IF NOT MISSING GO TEST EXIT     20300019
SETNOKEY IC    INTRET,INVKEY            SET INVALID REQUEST CODE        20350019
         B     LATERR                   GO POST COMPLETION, FREE IOB    20400019
*                                                                       20450019
PROCEED  EQU   *                                                        20500019
         L     EPREG,KEYMODAD           EXIT TO GENERATE KEY CHANNEL    20550019
         BR    EPREG                    PROGRAM                         20600019
IDEXIT   L     EPREG,IDMODAD            LOAD ID MODULE ADDRESS AND      20650019
         BR    EPREG                    GO TO GENERATE ID CHANNEL PROG. 20700019
*                                                                       20750019
SOMEWA   EQU   *                                                        20800019
         L     EPREG,DCBDFOR            LOAD ENTRY POINT OF THE         20850003
         BR    EPREG                    WRITE ADD MODULE AND BR. TO IT  20900002
*                                                                       20950019
*                                                                       21000019
EXPCTEND EQU   *                                                        21100019
         LA    WKREG2,CCWLN(WKREG2)      UPDATE POINTER TO PROGRAM END  21150002
         ST    WKREG2,IOBDCPND           EXPECTED ENDING ADDRESS        21200019
         MVC   IOBDNCRF+ONE(ONE),IOBBB2  MOVE B TO INLINE SEEK          21250002
*                                                                       21300019
         LR    PARAM,IOBREG              LOAD IOB ADDR AS THE PARAMETER 21350003
         EXCP  (1)                                                      23050019
*                                                                       23100019
RSTOR    RETURN (14,12),T,RC=0                                          23150019
*                                                                       23200019
*                                                                       23250019
*    THE FOLLOWING ROUTINE COMPLETES THE PROCESSING OF AN INVALID       23300019
*     REQUEST AND RETURNS TO THE USER.                                  23350019
*                                                                       23400019
LATERR   EQU   *                                                        23450019
         LR    WKREG1,IOBREG                                            23500019
         SH    WKREG1,IOBASWA           POINT TO SWA ADDR FIELD         23550019
         L     WKREG1,NULL(WKREG1)                                      23600019
         LTR   WKREG1,WKREG1                                            23650019
         BZ    NOSWATF                  BR IF NO SWA                    23700019
         MVI   NULL(WKREG1),NULL        ZERO THE SWA IN USE BYTE        23750019
NOSWATF  EQU   *                                                        23800019
         TM    IOBDAYLI,AVLMSK          IF THE AVAILABILITY BIT IS SET  23850002
         BO    FRMPOOL                  THIS IOB IS LINKED TO THE POOL  23900019
         LH    PARAM2,IOBDIOBS          SET SIZE PARAMETER FOR FREEMAIN 23950019
         AH    PARAM2,PREFSZ            ADD FOR PREFIX                  24000019
         LR    PARAM,IOBREG             SET ADDRESS PARAMETER           24050019
         SH    PARAM,PREFSZ             POINT TO START OF PREFIX        24100019
         FREEMAIN R,LV=(0),A=(1)                                        24150019
         B     ABORT                    GO POST                         24200019
*                                                                       24250019
FRMPOOL  EQU   *                                                        24300019
         MVI   IOBDAYLI,AVLABLE         AVAILABLE                       24350002
ABORT    AH    INTRET,INVREQ            SET INVALID REQ. EXCEPT. CODE   24400019
         SR    WKREG2,WKREG2            ZERO OUT THE IOB POINTER FIELD  24450019
         ST    WKREG2,DECIOBPT          OF THE DECB                     24500002
         LR    PARAM2,INTRET            POSITION THE POST CODE          24550019
         SLL   PARAM2,EIGHT             (EXCEPTION CODES)               24600002
         LR    PARAM,DECBREG            LOAD ECB ADDRESS PARAMETER      24650019
         LA    PARAM,0(0,PARAM)         CLEAR TOP BYTE IN REG    A44088 24670002
         MVI   NULL(PARAM),NULL         AND CLEAR THE OLD POST CODE AND 24700019
         POST  (1),(0)                  POST.                           24750019
         B     RSTOR                    GO RESTORE REGISTERS AND RETURN 24800019
*                                                                       24850019
OPSMSK   DC    F'6'                     OPTIONS-READX,DYNAMIC BFR.      24900019
INVREQ   DC    H'4096'                  INVALID REQUEST BIT             25200019
K49      DC    H'49'                    CONSTANT 49                     25250019
PREFSZ   DC    H'8'                     SIZE OF IOB PREFIX              25300019
IOBASWA  DC    H'4'                     DISPLACEMENT TO SWA ADDRESS     25350019
*                                                                       25400019
*   THE FOLLOWING EQUATES SHOW THE INCREMENT WHICH MUST BE ADDED TO     25450019
*   THE BASE SIZE OF THE IOB FOR A PARTICULAR OPTION.                   25500019
*                                                                       25550019
RNDI     EQU   32                       NEXT ADDRESS TYPE DI            25600019
RNDK     EQU   40                       NEXT ADDRESS TYPE DK            25650019
WCADD    EQU   48                       WRITE VERIFY WITH WRITE ADD     25750019
WCUPDTDI EQU   40                       WRITE VERIFY TYPE DI UPDATE     25800019
WCUPDTDK EQU   24                       WRITE VERIFY TYPE DK UPDATE     25850019
WCUPDTES EQU   32                       WRITE VERIFY WITH EXTENDED SRCH 25900019
EXTNDSCH EQU   128                      EXTENDED SEARCH                 25950019
WRTADD   EQU   104                      WRITE ADD                       26000019
EXCNTRL  EQU   28                       EXCLUSIVE CONTROL               26050019
RDDIORDK EQU   32                       READ (NO EXTENDED SEARCH)       26100019
WRDIORDK EQU   40                       WRITE (NO EXTENDED SEARCH)      26150019
         SPACE 3                                                        26200019
INVID    DC    X'08'                   INVALID ZERO ID                  26250019
INVOPT   DC    X'02'                   INVALID OPTIONS                  26300019
INVWRT   DC    X'40'                   WRITE TO INPUT DATA SET          26350019
INVLIMCT DC    X'20'                   EXTENDED SEARCH, LIMIT IS ZERO   26400019
NOSWACD  DC    X'00'                    NO SWA INDICATION         21905 26420021
*                                                                       26450019
INVKEY   DC    X'04'                    KEYS ARE MISSING                26500019
AVLMSK   EQU   X'80'                    IOB AVAILABILITY FLAG           26550019
ZEROS    EQU   OPSMSK                   PLUS ZEROS FOR COMPARING.       26600019
MIXED    EQU   4                                                        26650019
ONE      EQU   1                                                        26700019
IDDISP   EQU   7                        DISPLACEMENT OF BLOCK ID        26750019
IDOFZERO EQU   0                        ZERO BLOCK ID                   26800019
ROFTTR   EQU   2                        DISPLACEMENT OF R IN TTR        26850019
CNVENTRY EQU   4                        ENTRY IN ADDR CNVRT RTN  Y02072 26900002
NONZERO  EQU   7                                                        26950019
TWO      EQU   2                                                        27000019
AVLABLE  EQU   0                        IOB AVAILABLE SETTING           27050019
WRTMSK   EQU   15                       DCB WAS OPENED FOR              27100019
*                                        OUTPUT OF UPDATE               27150019
CCWLN    EQU   8                        LENGTH OF A CCW                 27450019
RALEN    EQU   4                        LENGTH OF RECORD AREA POINTER   27500019
RADSP    EQU   4                        DISPLACEMENT OF R.A. PTR IN SWA 27550019
RAINC    EQU   8                        DISPLACEMENT OF B.I. IN SWA     27600019
RAINCLN  EQU   2                        LENGTH OF B.I. FIELD IN SWA     27650019
NULL     EQU   0                        ZERO CONST. FOR REGISTER INSTR. 27700019
RCDRYM   EQU   X'40'                    RCD READY MASK/BIT       20201  27960020
OPTOFF   EQU   17                       OFFSET IN UCB TO OPTION  20201  27970020
*                                       CDE                      20201  27980020
RCDRY    EQU   X'10'                    RCD READY BIT IN OPTION  20201  27990020
*                                       FLD                      20201  28000020
SETSC    EQU   X'23'                    SET SECTOR CCW COMMAND   20201  28010020
RDSC     EQU   X'22'                    READ SECTOR CCW COMMAND  20201  28020020
CPFLAG   EQU   X'42'                    SET UNRELATED, COMMAND CHAIN    28200019
NOPCODE  EQU   X'03'                    NO OP                           28300019
FT       EQU   42                                                       28450019
FZ       EQU   40                                                       28500019
SEVN     EQU   7                                                        28550019
         DROP DECBREG                                             21905 28580021
         DROP DEBREG                                              21905 28610021
         DROP IOBREG,FDNBASE,DCBREG                              Y02072 28620002
         TITLE 'IGG019KJ - BDAM VRE FOUNDATION MODULE  - ASI ROUTINE'   28650019
*                                                                       28700019
*                                                                       28750019
*  ASYNCHRONOUS INTERRUPT ROUTINE                                       28800019
*   THIS ROUTINE IS ENTERED BY THE SUPERVISOR SO THAT BDAM MAY          28850002
*   COMPLETE THE PROCESSING OF A REQUEST.                               28900019
*   BDAM EXPECTS THE FOLLOWING REGISTER USAGE'                          28950019
*            1 RQE ADDRESS                                              29000002
*           14 RETURN POINT                                             29050002
*           15 ENTRY POINT OF THIS ROUTINE                              29100002
*                                                                       29150019
         USING IECDFDNA,EPREG                                           29200019
*                                                                       29250002
*                                                                       29300002
SWAPTR   EQU   2                                                        29500019
RIOB     EQU   2                        IOB ADDRESS                     29520002
DATALN   EQU   3                        DATA LENGTH REGISTER            29550019
MVCLNGTH EQU   3                        RECORD LENGTH                   29600002
TOTLN    EQU   4                        TOTAL LENGTH REGISTER           29650019
RAPTR    EQU   5                        RECORD AREA POINTER             29700019
POSINRA  EQU   6                        POINTER TO NEXT DATA BYTE IN    29750019
*                                       THE RECORD AREA                 29800019
FROMADR  EQU   6                        POINTER TO RECORD TO BE MOVED   29850002
RRQE     EQU   7                        RQE BASE REG             Y02072 29900002
CPSTART  EQU   8                        CHANNEL PROGRAM STARTING ADDR.  29950019
TOADR    EQU   9                        POINTER TO RECORD DESTINATION   30050019
DECBPTR  EQU   10                       DECB POINTER                    30100019
READADD  EQU   10                       ENTRY POINT REG FOR READX & ADD 30150019
RETFMOVE EQU   14                       RETURN ADDRESS                  30200019
WORKR2   EQU   14                       WORK REGISTER IN ASI ROUTINE    30202002
WORKR1   EQU   15                       WORK REGISTER IN ASI ROUTINE    30204002
*                                                                       30250019
IECDFDNA B     DASIA                    ENTRY FROM SUPERVISOR           30300019
         B     DASIB                    ENTRY FROM SELF-FORMAT          30350019
*                                       TO POST IOB                     30370002
*                   NOTE:  THIS ENTRY ASSUMES THAT THERE MAY BE AN IOB  30380002
*                          ADDR SAVED IN REG 6 WHICH MUST BE MAIN-      30390002
*                          TAINED THROUGHOUT ASI PROCESSING ON THIS     30392002
*                          PATH. CONTROL IS THEN RETURNED TO 19KN VIA   30394002
*                          THE ADDR PUT IN IOBDQPTR BY 19KN.            30396002
         B     DASIC                    ENTRY TO CLEAN UP AND RETURN    30400002
*                                                                       30500019
DASIA    EQU   *                                                        30550019
         LR    FDNBASE,EPREG            BASE TO TRANSPARENT REG  Y02072 30560002
         DROP  EPREG                    DROP ENTRY BASE REG      Y02072 30570002
         USING IECDFDNA,FDNBASE         ESTABLISH NEW BASE       Y02072 30580002
         LR    RRQE,PARAM               SAVE IOS RQE ADDRESS     Y02072 30600002
         USING RQE,RRQE                 ESTABLISH RQE BASE       Y02072 30610002
         L     PARAM,RQEIOB             GET IOB ADDRESS FROM RQE Y02072 30650002
         USING IOBSTDRD,PARAM           ESTABLISH IOB BASE       Y02072 30660002
         L     SAVE,IOBDCBPT            GET DCB ADDR FROM IOB    Y02072 30670002
         USING IHADCB,SAVE              ESTABLISH DCB BASE       Y02072 30680002
         LR    INTRET,RETREG            MOVE SUPERVISOR RETURN ADDRESS  30700002
         L     DECBPTR,IOBECBPT         GET DECB ADDRESS          21905 30710021
         USING DECBDEF,DECBPTR                                    21905 30720021
*                                                                       30730002
*********************************************************************** 30732002
*  THE FOLLOWING ROUTINE LINKS IOBS TO THE DCB POOL IF THEY WERE      * 30740002
*  OBTAINED BY GETMAIN. THEY ARE ADDED IN ORDER OF INCREASING SIZE.   * 30742002
*********************************************************************** 30744002
*                        POOL THE IOB                            Y02072 30746003
         L     WORKR1,IOBDPLAD          WAS IOB FROM POOL OR     Y02072 30748002
         LTR   WORKR1,WORKR1            OBTAINED BY GETMAIN      Y02072 30748402
         BNZ   INPOOL                   IF NOT 0,ALREADY IN POOL Y02072 30748802
*                                                                       30749602
*                        ADD NEW IOB TO IOB POOL                 Y02072 30749703
         MVI   IOBDAYLI,UNAVALSW        MARK CURRENT IOB UNAVAIL Y02072 30749802
*                                       ABLE BEFORE ADD TO POOL  Y02072 30754002
         LA    PARAM,0(0,PARAM)         INSURE 0 HI-ORDER BYTE   A30797 30758202
         L     WORKR1,DCBIOBAD          PUT DCB POOL ADDRESS IN         30762402
         LA    WORKR2,NULL(WORKR1)      BOTH WORK REGS.                 30766602
LOOP     LA    WORKR1,NULL(WORKR1)      CLEAR HI BYTE.                  30776602
         LTR   WORKR1,WORKR1            ANY IOB'S BEYOND THIS.          30778602
         BZ    TSTEQ                    NO, GO TEST FOR FIRST IOB       30780602
*                                                                       30782602
*   PUT IOB ON POOL IN ORDER OF INCREASING SIZE. PUT NEW IOB IN QUEUE   30783002
*   AS THE FIRST IOB IN THAT SIZE GROUP.                                30783102
*                                                                       30783202
         CLC   IOBDIOBS,IOBDIOBS-IOBSTDRD(WORKR1)                       30783302
         BH    SEENEXT1                 NEW IOB IS LARGER               30788802
         IC    PARAM2,IOBDAYLI          SAVE AVAILABILITY BYTE   Y02072 30789202
         SLL   PARAM2,SHFT3BYT          WHILE STORING INTO       Y02072 30789602
         OR    WORKR1,PARAM2            IOB CHAINING FIELD       Y02072 30790002
         ST    WORKR1,IOBDPLAD          STORE NXT IOB ADDR IN    A30797 30790802
         LA    WORKR1,0(WORKR1)         CLR TOP BYTE TO COMPARE  Y02072 30792802
TSTEQ    CR    WORKR1,WORKR2            IF EQUAL, THIS IOB IS THE       30793602
         BE    FIRSTIOB                 FIRST ONE TO BE POOLED          30794002
*                                                                       30794102
*   RELINK THE POOL CHAIN WITHOUT DESTROYING THE AVAILABILITY FLAG.     30794202
*                                                                       30794302
         IC    PARAM2,IOBDAYLI-IOBSTDRD(WORKR2)                   21905 30808202
         SLL   PARAM2,SHFT3BYT                                          30818202
         OR    PARAM,PARAM2                                       21905 30820202
         ST    PARAM,IOBDPLAD-IOBSTDRD(WORKR2)                          30820602
         LA    PARAM,0(PARAM)           CLEAR TOP BYTE-NOT NEG   YM1458 30820702
         B     INPOOL                   CONTINUE IOB PROCESSING  Y02072 30821002
*                                                                       30821402
FIRSTIOB ST    PARAM,DCBIOBAD           INSERT THIS IOB AS TOP OF CHAIN 30821802
         B     INPOOL                   CONTINUE IOB PROCESSING  Y02072 30822002
SEENEXT1 LR    WORKR2,WORKR1            SAVE THE ADDRESS OF PRIOR LINK, 30822202
         L     WORKR1,IOBDPLAD-IOBSTDRD(WORKR1)  LOAD THE ADDRESS OF    30826702
*                                       THE NEXT IOB IN POOL            30828702
         B     LOOP                     GO TEST LINK ADDRESS = ZERO     30830702
*                                                                       30830802
*                                                                       30831002
*                                                                       30831102
INPOOL   EQU   *                        TEST FOR ERRORS          Y02072 30831202
         TM    IOBSTAT1,IOBNEWVL        DID END OF EXTENT CAUSE ASI     30831502
         BZ    TSTERR                   NO, CONTINUE LOOKING FOR CAUSE. 30836102
         XI    IOBSTAT1,IOBNEWVL+IOBABNRM YES,CLEAR EXCP AND ABN BITS   30850002
         L     DECBPTR,IOBECBPT         GET USER ECB ADDRESS     Y02072 30950002
         ST    DECBPTR,IOBDQPTR         SAVE IT IN IOB, TO BE    Y02072 31000002
*                                       RESTORED BY CEA OR EOE   Y02072 31010002
         LA    WKREG2,IOBCSW+3          GET CSW ADDRESS TO USE   Y02072 31020002
         ST    WKREG2,IOBECBPT          AS DUMMY ECB FOR IOS     Y02072 31030002
         EXCP  (1)                      RESTART THE CHANNEL PROGRAM     31050019
         BR    INTRET                   GO BACK TO SUPERVISOR.          31150019
*                                                                       31200019
TSTERR   EQU   *                        TEST FOR ERROR           Y02072 31210002
         DROP  RRQE                                              Y02072 31407002
         ST    INTRET,IOBDQPTR          SAVE SUPVERVISOR RETURN IN IOB. 32270801
         LR    INTRET,PARAM             PUT IOB ADDR INTO READX REG     32300019
         LR    SWAPTR,PARAM             *                               32350019
         SH    SWAPTR,FOUR               * SET UP SWA POINTER           32400019
         L     SWAPTR,NULL(SWAPTR)       *                              32450019
         USING SWA,SWAPTR               *                               32500019
         L     CPSTART,IOBSTART         SET UP CHANNEL PROGRAM ADDRESS  32650019
         TM    IOBSTAT1,IOBABNRM        WAS THIS ABNORMAL COMPLETION    32700002
         BO    ASIERR                   BRANCH IF YES                   32750019
*                                                                       32800019
GOODCMPL EQU   *                                                        32850019
         L     RAPTR,SWARAPT            SET UP RECORD AREA POINTER      32900019
         LR    POSINRA,RAPTR                                            32950019
         TM    IOBDTYPE,IOBDYNBF        IS DYN BUF BEING USED   XA00093 32960002
         BNO   NOTDYNBF                 NO, BR AROUND           XA00093 32970021
         TM    IOBDTYP2,IOBTYPE         IS THIS READ BY BLK ID  XA00093 32980002
         BO    NOTDYNBF                 NO, BR AROUND           XA00093 32990021
         TM    IOBDTYP2,IOBSKEY         WAS KEY ADDR CODED 'S'  XA00093 32992002
         BZ    NOTDYNBF                 NO, BR AROUND           XA00093 32994021
         SR    POSINRA,POSINRA          CLEAR REG TO GET KEY    XA00093 32996021
         IC    POSINRA,DCBKEYLE         LENGTH IN DCB.KEY WAS   XA00093 32998002
         AR    POSINRA,RAPTR            READ INTO RECORD AREA   XA00093 32998402
         LR    RAPTR,POSINRA            SO NEED OFFSET TO       XA00093 32998802
*                                       MOVE DATA.              XA00093 32999202
NOTDYNBF EQU   *                                                XA00093 32999621
         AH    POSINRA,SWABFINC         POINT TO NEXT DATA BYTE         33000019
         SR    DATALN,DATALN                                            33050019
         SR    TOTLN,TOTLN                                              33100019
         L     WORKR1,IOBCSW-1          GET LAST CCW ADDRESS            33150002
         SH    WORKR1,H8                BACK UP ONE CCW                 33200019
         TM    DECTYPE+ONE,READ         IS THIS A READ REQUEST          33250019
         BZ    WRITEREQ                 BR IF NO                        33300019
         CLI   NULL(WORKR1),NOPCODE     IS IT A NOP CCW                 33350019
         BE    NATST                    BR IF YES                       33400019
         TM    IOBDTYPE,IOBRDEXC        IS THIS A READ EXCLUSIVE CNTRL. 33450002
         BZ    ASIREAD                  BR IF NO                        33500019
         TM    IOBSTAT1,IOBENQUE        HAS RECORD BEEN ENQ'D YET       33550002
         BZ    ENQUEUE                  GO ENQ IF NOT                   33600019
ASIREAD  EQU   *                                                        33650019
         TM    DECTYPE+ONE,KEY          IF TYPE IS DK,                  33700019
         BO    ASIREAD2                 BR AROUND READ R0 TEST          33750019
         CLI   IOBR,NULL                SEE IF THIS WAS A READ ON R0    33800002
         BNE   ASIREAD2                 BR IF NOT                       33850019
         LH    DATALN,DECLNGTH                                          33900019
         EX    DATALN,MOVER0            MOVE R0 TO THE RECORD AREA      33950019
         B     ISITNA                   SEE IF NEXT ADDRESS IS REQ'D    34000019
*                                                                       34050019
MOVER0   MVC   NULL(NULL,RAPTR),SWABDW  * EXECUTED *   MOVE R0          34100019
*                                                                       34150019
ASIREAD2 EQU   *                                                        34200019
         LH    DATALN,SWABDW            GET SEGMENT LENGTH              34250019
         SH    DATALN,H8                SUBTRACT 8 FROM DATA LENGTH     34300019
         LH    TOTLN,SWABFINC                                           34350019
         AR    TOTLN,DATALN             ADD LL-8 TO TOTAL               34400019
*                                                                       34450019
         TM    SEGFLGS,FIRSTSEG         IS THIS A FIRST SEGMENT         34500019
         BO    VERMID                   BR IF NO                        34550019
         CR    RAPTR,POSINRA            IF ANOTHER SEG HAS BEEN READ    34600019
         BNE   BADFLGS                  GO SET ERROR FLAG BECAUSE THE   34650019
*                                       SEG CONTROL FLAGS ARE BAD.      34700019
         MVC   NULL(SEGDATA-SWABDW,RAPTR),SWABDW  MOVE DESCRIPTORS      34750019
         LA    POSINRA,SEGDATA-SWABDW(POSINRA)    UPDATE DATA POINTER   34800019
         LA    TOTLN,SEGDATA-SWABDW(TOTLN)        UPDATE DATA COUNT     34850019
NOTFIRST LR    TOADR,POSINRA            *  SET UP FOR                   34900019
         LA    FROMADR,SEGDATA          *     DATA MOVE                 34950019
         CH    TOTLN,DECLNGTH           WAS TOO MUCH DATA READ          35000019
         BNH   NOTTM                    BR IF NO                        35050019
         LR    DATALN,TOTLN             TOTAL INDICATED IN BDW    21905 35100021
         SH    TOTLN,DECLNGTH           EXCESS OVER MAX REC LNGTH 21905 35130021
         SR    DATALN,TOTLN             ONLY MOVE TO MAX RECLNGTH 21905 35160021
         BAL   RETFMOVE,MOVE            MOVE THE SEGMENT DATA TO        35200019
*                                           THE RECORD AREA             35250019
         B     BADFLGS                  GO TO SET ERROR FLAG      21905 35300021
VERMID   EQU   *                                                        35350019
         CR    RAPTR,POSINRA            SINCE THIS IS NOT A FIRST SEG,  35400019
         BNE   NOTFIRST                 MAKE SURE A SEG HAS ALREADY     35450019
*                                       BEEN READ.  IF NOT, SET ERROR.  35500019
BADFLGS  EQU   *                                                        35550019
         OI    IOBSTAT1,IOBABNRM        SET ABNORMAL COMPLETION         35600002
         B     SETLGNCK                 GO SET WRONG LENGTH RECORD      35650019
NOTTM    BAL   RETFMOVE,MOVE            MOVE THE SEGMENT DATA TO        35700019
*                                        THE RECORD AREA                35750019
         STH   TOTLN,SWABFINC           STORE BUFFER INCREMENT          35760019
         MVC   NULL(TWO,RAPTR),SWABFINC UPDATE LL IN RECORD AREA        35800019
         CH    TOTLN,DECLNGTH           BR IF THE REQUIRED NUMBER OF    35850019
         BE    LASTRD                   BYTES HAVE BEEN READ            35900019
         TM    SEGFLGS,LASTSEG          WAS THIS THE LAST SEGMENT       35950019
         BZ    LASTRD                   BR IF LAST                      36000019
         TM    SEGFLGS,FIRSTSEG         IS THIS A FIRST SEGMENT         36100019
         BO    MIDREAD                  BR IF NO                        36150019
         TM    DECTYPE+ONE,KEY          IS TYPE = DK                    36200003
         BO    FRSTDK                   BR IF YES                       36250019
         CLI   DCBKEYLE,NULL            IS KEY LENGTH ZERO IN DCB       36300019
         BE    MIDREAD                  BR IF YES, CHNL PROG IS OK      36350019
         L     WORK3,DECKYADR                                           36400019
         LTR   WORK3,WORK3              IS KEY ADDRESS SPECIFIED        36450019
         BZ    MIDREAD                  BR IF NO, CHNL PROG IS OK       36500019
         L     WORKR1,IOBDCPND          GET CHNL PROG ENDING ADDR.      36550019
         SH    WORKR1,SIXTEEN           BACK UP TWO CCW'S               36600019
         MVC   NULL(CCWLN,WORKR1),CCWLN(WORKR1)  MOVE LAST CCW UP ONE   36650019
*                                       POSITION TO BYPASS KEY READ     36700019
         LA    WORKR1,CCWLN(WORKR1)     ESTABLISH NEW CHANNEL PROGRAM   36750019
         ST    WORKR1,IOBDCPND               ENDING ADDRESS             36800019
         B     MIDREAD                  SET UP FOR NEXT READ            36850019
FRSTDK   EQU   *                                                        36900019
         TM    DECTYPE,EXSCH            TEST FOR EXTENDED SEARCH        36950019
         BO    FRSTES                   BR IF YES                       37000019
         USING READDK1,CPSTART          SET UP CHANNEL PROGRAM DSECT    37050019
*                                                                       37055020
         LR    WORKR1,PARAM             GET IOB PTR              20201  37060020
         SH    WORKR1,H8                BACK UP TO PREFIX        20201  37065020
         TM    NULL(WORKR1),RCDRYM      RCD READY USED           20201  37070020
         BNO   NOTRRA1                  BRANCH IF NO             20201  37075020
         LA    WORKR1,RDK1NOP2          GET 2ND NOP ADDR         20201  37080020
         TM    DECTYPE+ONE,NEXTADR      NEXT ADDR REQUESTED      20201  37085020
         BZ    NOADDX                   BRANCH IF NO             20201  37090020
         LA    WORKR1,RDK1NOP3+BIT8     GET SECTOR ADDR          20201  37095020
NOADDX   EQU   *                                                 20201  37100020
         ST    WORKR1,RDK1NOP1          PUT IN SECTOR ADDR       20201  37105020
         MVI   RDK1NOP1,SETSC           SET SECTOR CMND          20201  37110020
         B     FEATA1                   GO AROUND NEXT           20201  37115020
NOTRRA1  EQU   *                                                 20201  37120020
         MVI   RDK1NOP1,NOPCODE         MAKE CCW1 A NOP          20201  37125020
FEATA1   EQU   *                                                 20201  37130020
         LA    WORKR1,IOBCC             *                               37150002
         ST    WORKR1,RDK1SIE1           *   CONSTRUCT SEARCH-ID-EQUAL  37200019
         MVI   RDK1SIE1,SIEOP           *    CCW                        37250019
         MVI   RDK1SIE1+BYTE7,FIVE      *    SET COUNT TO FIVE          37260019
*                                                                       37300019
         LA    WORKR1,RDK1SIE1          *                               37350019
         ST    WORKR1,RDK1TIC1           *   CONSTRUCT A TIC CCW        37400019
         MVI   RDK1TIC1,TICOP           *                               37450019
         B     MIDREAD                  SET UP FOR NEXT READ            37500019
FRSTES   EQU   *                                                        37550019
         MVC   IOBDNCRF+SEVN(ONE),IOBSEEK   SAVE EXTENT NUMBER          37560002
         MVC   SAVEID+TWO(TWO),IOBDSTAT SAVE THE IOB STATUS             37600019
         USING READES1,CPSTART          SET UP CHANNEL PROGRAM DSECT    37650019
         MVC   RE1RD,RERD-RENOP1(CPSTART) MOVE READ DATA CCW TO CCW4    37700019
         LA    WORKR1,RE1NOP2           SET NEW EXPECTED CHANNEL END    37750019
         ST    WORKR1,IOBDCPND               IN IOB                     37800019
         MVC   IOBCC(CCHHLN),DNRCFP2    MOVE NEW CCHH TO IOBSEEK+3      37850002
MIDREAD  EQU   *                                                        37900019
         BAL   WORK3,ADD1RTN            INCREMENT TRACK NBR BY ONE      37950019
         MVI   IOBR,R1                  SET R OF MBBCCHHR TO 1          38000002
         TM    IOBDTYP2,IOBADDTY+IOBTYPE  IS THIS TYPE DI               38050002
         BC    ONE+MIXED,AFTDITST       BR IF NOT                       38100019
         MVC   IOBUPLIM+THREE(EQU4),IOBCC                               38150002
         B     EXCPAGN                  GO EXCP                         38200019
AFTDITST EQU   *                                                        38250019
         TM    IOBDTYP2,IOBADDTY        IS THIS A WRITE ADD             38300002
         BZ    EXCPAGN                  BR IF NO                        38350019
         MVC   IOBDNCRF(FIVE),IOBCC     MOVE CCHHR TO COUNT FIELD       38400002
         MVC   IOBCHNPR+(WASIE1-WRITEADD)+THREE(EQU4),IOBCC             38450002
*                                       MOVE CCHH TO OLD CCW2           38500019
*   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   38550002
EXCPAGN  EQU   *                        READ OR WRT NEXT SEGMENT        38600002
         L     DECBPTR,IOBECBPT         GET USER ECB ADDRESS     Y02072 38610002
         ST    DECBPTR,IOBDQPTR         SAVE IT IN IOB, TO BE    Y02072 38620002
*                                       RESTORED BY CEA OR EOE   Y02072 38630002
         LA    WKREG2,IOBCSW+3          GET CSW ADDRESS TO USE   Y02072 38640002
         ST    WKREG2,IOBECBPT          AS DUMMY ECB FOR IOS     Y02072 38642002
         EXCP  (1)                      RESTART THE CHANNEL PROGRAM     38644002
         SVC   EXIT                     EXIT                            39600019
*                                                                       39650019
*   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   39660002
LASTRD   EQU   *                                                        39700019
         SH    TOTLN,FOUR                                               39750019
         STH   TOTLN,SWABFINC           PUT DATA LENGTH IN SEGMENT      39800019
         MVC   SDW(TWO,RAPTR),SWABFINC  DESCRIPTOR WORD                 39850002
ISITNA   TM    DECTYPE+ONE,NEXTADR      IS NEXT ADDRESS REQUESTED       39900019
         BZ    DASIB                    BR IF NO                        39950019
         MVC   SAVEID+TWO(TWO),IOBDSTAT SAVE THE IOB STATUS             40000019
         NC    IOBDSTAT,CLRSTAT         CLEAR OUT CURRENT STATUS        40050019
         TM    DECTYPE+ONE,KEY          IS TYPE = DK                    40100019
         BO    NADK                     BR IF YES                       40150019
         MVC   SAVEID(ONE),IOBR         SAVE ID OF CURRENT RECORD       40200002
         MVC   SWABDW(FIVE),DNRCFP2     SAVE CCHHR FROM CAPACITY RCD.   40250019
         USING READDI0N,CPSTART                                         40300019
         MVC   RDINASI1,RDINASI2        MOVE CCW5 TO CCW2               40350019
         LA    WORKR1,SWABDW            *                               40400019
         ST    WORKR1,RDINARD            * PUT SWA ADDR IN CCW4         40450019
         MVI   RDINARD,READCCW          *                               40500019
         MVI   RDINASI2,NOPCODE         MAKE CCW5 A NOP                 40550019
         MVI   RDINASI2+FLAGS,SWL       SET NOP FLAGS                   40600019
         B     GETNA                    CALCULATE NEXT ADDRESS          40650019
NADK     EQU   *                                                        40700019
         MVI   IOBR,NULL                SET R=0 IN IOBSEEK              40750002
         TM    SEGFLGS,FIRSTSEG         WAS THIS A ONE SEGMENT RECORD   40800019
         BO    MIDNADK                  BR IF NO                        40850019
         MVC   IOBCC(EQU4),DNRCFP2      MOVE CCHH TO IOBSEEK+3          40900002
         MVC   SAVEID(ONE),IOBDNCRF+SIX SAVE ID OF CURRENT RECORD       40950002
         TM    DECTYPE,EXSCH            TEST FOR EXTENDED SEARCH        41000019
         BZ    NADKNES                  BR IF NOT                       41050019
         USING READES1,CPSTART          SET UP CHANNEL PROGRAM DSECT    41100019
         MVC   RE1RD(CCPADR),RERD-RENOP1(CPSTART) MOVE READ DATA TO CCW 41150019
MIDNAES  EQU   *                                                        41200019
         MVI   RE1RD+FLAGS,COMCHAN+SWL  SET FLAGS                       41250019
         MVC   RE1NOP2,RENOP2-RENOP1(CPSTART) MAKE CCW5 A NOP           41300019
         B     EXCPAGN                  EXCP FOR NEXT ADDRESS           41350019
MIDNADK  EQU   *                                                        41400019
         MVI   SAVEID,ONE               SAVE ID OF LAST SEGMENT         41450019
         TM    DECTYPE,EXSCH                                            41500019
         BZ    NADKNES                  BR IF NOT EXTENDED SEARCH       41550019
         MVC   RE1RD+SIX(TWO),RE1SIDE+SIX  SET READ LENGTH TO FIVE      41600019
         B     MIDNAES                  GO FINISH THE CCW'S             41650019
NADKNES  EQU   *                                                        41700019
         USING READDK1,CPSTART          SET UP CHANNEL PROGRAM DSECT    41750019
         LA    WORKR1,RDK1NOP2                                          41800019
         ST    WORKR1,IOBSTART          SET NEW CHNL PROG START ADDR    41850019
         B     EXCPAGN                  EXCP FOR NEXT ADDRESS           41900019
NATST    EQU   *                                                        41950019
         TM    DECTYPE+ONE,NEXTADR      IS NEXT ADDRESS REQUESTED       42000019
         BZ    ASIERR2                  BR IF NO                        42050019
         SH    WORKR1,H8                                                42100019
         CLI   NULL(WORKR1),TICOP       WAS THE PRECEDING CCW A TIC     42150019
         BE    ASIERR2                  BR IF YES                       42200019
GETNA    EQU   *                                                        42250019
*                                                                       42300019
*  AT THI POINT, THE SWA CONTAINS THE CCHHR OF THE LAST BLOCK ON THE    42350019
*  TRACK IN THE FIRST 5 BYTES AND THE ID OF THE LAST BLOCK READ IN THE  42400019
*  6TH BYTE.                                                            42450019
*                                                                       42500019
         MVC   IOBDSTAT,SAVEID+TWO      RESTORE IOB STATUS              42550019
         CLC   SAVEID(ONE),SWABDW+CCHHLN WAS THIS THE LAST BLOCK ON     42600019
*                                        THE TRACK                      42650019
         BNE   NEXTTID                  BR IF NOT                       42700019
         BAL   WORK3,ADD1RTN            INCREMENT TRACK NBR BY ONE      42750019
         L     DECBPTR,IOBECBPT         RESTORE DECB POINTER            42800019
         TM    DECTYPE+ONE,TYPERU       IS TYPE = RU                    42850019
         BM    NOTRU                    BR IF NO                        42900019
ACTTST   EQU   *                                                        42950019
         TM    IOBDTYPE,IOBACTAD        IS ACTUAL ADDRESSING USED       43000002
         BO    ACTNA                    BR IF YES                       43050019
*                                                                       43100019
*  THE FOLLOWING ROUTINE WILL CONVERT THE MBBCCHHR ADDRESS IN IOBSEEK   43150019
*  TO A RELATIVE TTR BY USING THE RESIDENT CONVERSION ROUTINE IECPRLTV. 43200019
*                                                                       43250019
         STM   WREG9,ACTADR,IOBCHNPR    SAVE REGISTERS USED             43300002
         LA    ACTADR,IOBSEEK           SET ACTUAL ADR. PARAMETER       43350019
         L     PARAM,DCBDEBAD           SET DEB ADDRESS                 43400019
         L     IECPRLTV,CVTPTR          GET ADDR OF CONVERSION ROUTINE  43450019
         L     IECPRLTV,APRLTV(IECPRLTV)     FROM THE CVT.              43500019
         BALR  RETREG,IECPRLTV          GO TO CONVERSION ROUTINE        43550019
*                                                                       43600019
         ST    CONVID,IOBDCPND-IOBSEEK(ACTADR) SAVE THE RETURNED TTR0   43650019
         LM    WREG9,ACTADR,IOBCHNPR-IOBSEEK(ACTADR) RESTORE THE REGS   43700002
         L     WORKR1,DECNA                                             43750019
         MVC   NULL(TTRLN,WORKR1),IOBDCPND MOVE TTR TO USER AREA        43800019
         B     DASIB                    NEXT ADDRESS FEEDBACK COMPLETED 43850019
*                                                                       43900019
NEXTTID  EQU   *                                                        43950019
         IC    WORKR1,SAVEID            *                               44000019
         LA    WORKR1,ONE(WORKR1)        * ADD 1 TO R IN IOBSEEK        44050019
         STC   WORKR1,IOBR              *                               44100002
         B     ACTTST                   GO SUPPLY NEXT ADDRESS          44150019
NOTRU    EQU   *                                                        44200019
         MVI   SAVEID,NULL              SET CURRENT ID TO ZERO          44250019
         NC    IOBDSTAT,CLRSTAT         CLEAR IOB STATUS                44300019
         B     EXCPAGN                  GO READ NEXT CAPACITY RECORD    44350019
ACTNA    EQU   *                                                        44400019
         L     WORKR1,DECNA                                             44450019
         MVC   NULL(ACTLN,WORKR1),IOBSEEK MOVE MBBCCHHR TO USER AREA    44500019
         B     DASIB                    NEXT ADDRESS FEEDBACK COMPLETED 44550019
*                                                                       44600019
*                                                                       44650019
WRTDONE  EQU   *                                                        44700019
         TM    IOBDTYP2,ADD             WAS THIS A WRITE ADD     Y02072 44750002
         BZ    DASIB                    BR IF NO                        44800019
         L     READADD,DCBDFOR          GET ADDRESS OF ADD MODULE AND   44850019
         B     ADDDONE(READADD)         BRANCH TO IT                    44900019
*                                                                       44950019
USETRKCP EQU   *                                                        45000019
         LH    DATALN,TRKLN(DTABREG)    SET SEGMENT LNGTH TO TRACK SIZE 45050019
RPSDEV1  EQU   *                                                 20201  45070020
         MVI   SEGFLGS,MIDSEG           SET FLAGS TO MIDDLE SEGMENT     45100019
         B     AFTRFLG                  GO FINISH WRITE SETUP           45150019
WRITEREQ EQU   *                                                        45200019
         CLI   NULL(WORKR1),READCCW     WAS LAST CCW A READ DATA        45250019
         BNE   SUBSQWRT                 BR IF NO                        45300019
         CLC   CNTOFF(CNTLN,WORKR1),H7  WAS DATA LENGTH = 7             45350019
         BNE   FRSTWRT                  BR IF NO                        45400019
         TM    IOBSTAT1,IOBENQUE        IS RECORD ENQ'ED YET            45450002
         BZ    ENQUEUE                  GO ENQUEUE IF NO                45500019
KNP8EXIT L     READADD,DCBDFOR          GET BASE OF SELF-FORMAT MODULE  45550019
         B     ADDSRCH(READADD)         AND BRANCH TO IT                45600019
SUBSQWRT EQU   *                                                        45650019
         SH    WORKR1,H8                BACK UP ONE CCW                 45700019
         CLI   NULL(WORKR1),READCCW                                     45750019
         BE    FRSTWDK                  BR IF ENTRY FROM FIRST WRITE DK 45800019
         LH    DATALN,DECLNGTH          GET TOTAL DATA LENGTH FROM DECB 45850019
         SH    DATALN,SWABFINC          SUBTRACT LENGTH WRITTEN SO FAR  45900019
         BZ    WRTDONE                  BR IF ALL OF RECORD IS DONE     45950019
         AH    DATALN,H8                                                46000019
         BAL   RETREG,GETDVTB           GET A POINTER TO DEVICE TABLE   46050019
*                                       ENTRY                           46100019
         LR    RETREG,PARAM             GET IOB ADDR             20201  46102020
         SH    RETREG,H8                POINT TO PREFIX          20201  46104020
         SR    TOADR,TOADR              ZERO OUT A COUPLE OF     20201  46110020
*                                       REGS                     20201  46112020
         SR    RETREG,RETREG                                     20201  46114020
         IC    RETREG,OVERI(DTABREG)    GET OVERHD               20201  46116020
         TM    BYTEDEV(DTABREG),TBOVHD  IS TWO BYTE OVHD USED    20201  46118020
         BNO   MZ0001                   IF NOT, OVHD IS O.K.     20201  46120020
         LH    RETREG,OVERI(DTABREG)    ELSE GET TWO BYTES       20201  46122020
MZ0001   EQU   *                                                 20201  46124020
         IC    TOADR,OVERK(DTABREG)     GET KEY OVERHEAD         20201  46126020
         SR    RETREG,TOADR             REC OVHD - KEY OVHD      20201  46128020
         LH    TOADR,TRKLN(DTABREG)     GET TRK CAPACITY         20201  46130020
         SR    TOADR,RETREG             TRK CAP - REC OVHD + KEY 20201  46132020
*                                       OVHD                     20201  46134020
         CR    DATALN,TOADR             WILL DATA FIT ON TRK     20201  46136020
         BNH   WALOON                   YES  THEN GO TO IT       20201  46138020
         LR    DATALN,TOADR             USE TRK LEN AS SEG LEN   20201  46140020
         B     RPSDEV1                  DO YOUR THING            20201  46142020
*                                                                       46144002
         CH    DATALN,TRKLN(DTABREG)    COMPARE DATA LENGTH WITH        46150019
*                                       TRACK CAPACITY                  46200019
         BH    USETRKCP                 BR IF DATA LENGTH IS GREATER    46250019
*                                                                       46300019
*   THIS ROUTINE WILL CALCULATE THE REMAINING TRACK BALANCE AFTER       46350019
*   WRITING THE LAST SEGMENT.  THIS TRACK BALANCE WILL BE PLACED IN     46400019
*   THE UPDATED CAPACITY RECORD.                                        46450019
*                                                                       46500019
W2       EQU   9                        WORK REGISTER                   46550019
W3       EQU   14                       WORK REGISTER                   46600019
W4       EQU   15                       WORK REGISTER                   46650019
*                                                                       46660020
*                                                                       46670020
WALOON   EQU   *                                                 20201  46680020
         SR    W3,W3                    *  ZERO WORK REGISTERS          46700019
         SR    W4,W4                    *                               46750019
         LR    W2,DATALN                GET DATA LENGTH                 46800019
         IC    W4,OVERK(DTABREG)        GET VALUE TO BE SUBTRACTED FROM 46850019
*                                       OVERHEAD FOR NON-KEYED RECORDS  46900019
         IC    W3,OVERI(DTABREG)        GET OVERHEAD FOR NOT LAST RCD.  46950019
         TM    BYTEDEV(DTABREG),TBOVHD  DEV WITH 2 BYTE OVHD     20201  46960020
         BNO   MZ0002                   NO, OVHD O.K.            20201  46970020
         LH    W3,OVERI(DTABREG)           GET 2 BYTES           20201  46980020
MZ0002   EQU   *                                                 20201  46990020
         MH    W2,TOLER(DTABREG)        MULTIPLY DATA LENGTH BY         47000019
         SRA   W2,NINE                  DIVIDE RESULT BY 512            47050019
         SR    W3,W4                    SUBTRACT NO-KEY OVERHEAD FROM   47100019
*                                       TOTAL OVERHEAD                  47150019
         AR    W2,W3                    ADD OVERHEAD TO DATA LENGTH     47200019
         N     W2,ZEROH                 ZERO 2 HI ORDER BYTES           47250019
         LH    W3,TRKLN(DTABREG)        GET TRACK CAPACITY              47300019
         SR    W3,W2                    GET NEW TRACK BALANCE           47350019
         BM    ZEROTB                   SET TRK BAL TO 0 IF NEGATIVE    47400019
         STH   W3,IOBDBYTR              ELSE, STORE NEW TRK BALANCE     47450019
SETLAST  EQU   *                                                        47500019
         MVI   SEGFLGS,LASTSEGF         SET FLAGS FOR LAST SEGMENT      47550019
AFTRFLG  EQU   *                                                        47600019
         TM    DECTYPE+ONE,ADD+KEY      IS TYPE =DA OR DK               47650019
         BZ    DIWRT                    BR IF NEITHER (TYPE = DI)       47700019
         TM    DECTYPE+ONE,ADD                                          47750019
         BO    WRTADD2                  BR IF ADD                       47800019
         TM    DECTYPE,EXSCH            TEST FOR EXTENDED SEARCH        47850019
         BO    ESWCHNG                  BR IF YES                       47900019
         USING WRITEDK1,CPSTART                                         47950019
         CLI   WDK1NOP1,SETSC           RCD READY USED           20201  47957020
         BNE   NOTRRA9                  BRANCH IF NO             20201  47964020
         L     WORKR1,WDK1NOP1          GET SECTOR ADDR          20201  47971020
         MVI   NULL(WORKR1),NULL        SECTOR=0                 20201  47978020
NOTRRA9  EQU   *                                                 20201  47985020
*                                                                       47992020
         STH   DATALN,WDK1WD+CNTOFF     STORE DATA LENGTH IN WRITE CCW  48000019
FINWRT   EQU   *                                                        48050019
         BAL   RETFMOVE,PREMOVE         MOVE DATA AND FILL IN BDW,SDW   48100019
         AH    TOTLN,SWABFINC           UPDATE THE BUFFER               48150019
         STH   TOTLN,SWABFINC            INCREMENT FIELD                48200019
         B     MIDREAD                  GO UP TRACK ADDRESS             48250019
ZEROTB   EQU   *                                                        48300019
         XC    IOBDBYTR,IOBDBYTR        SET TRK BALANCE TO ZERO         48350019
         B     SETLAST                  GO SET SEGMENT FLAGS            48400019
ESWCHNG  EQU   *                                                        48450019
         USING WRITEES1,CPSTART                                         48500019
         STH   DATALN,WEWD+CNTOFF       STORE DATA LENGTH IN WRITE CCW  48550019
         B     FINWRT                   GO MOVE DATA TO SWA             48600019
DIWRT    EQU   *                                                        48650019
         USING WRITEDI1,CPSTART         SET UP CHANNEL PROGRAM DSECT    48700019
         SH    PARAM,H8                 IOB PREFIX               20201  48705020
         TM    NULL(PARAM),RCDRYM       RCD READY USED           20201  48710020
         BNO   NOTRRB1                  BRANCH IF NO             20201  48715020
         LA    WORKR1,WDI1NOP1+BYTE6    GET ZERO BYTE ADDR       20201  48720020
         ST    WORKR1,WDI1NOP1          PUT IN CCW               20201  48725020
         MVI   WDI1NOP1,SETSC           INSERT CMND              20201  48730020
NOTRRB1  EQU   *                                                 20201  48735020
         AH    PARAM,H8                 RESTORE IOB REG          20201  48740020
         CLI   WDI1WD,WDOP              IS CCW4 A WRITE DATA CCW        48750019
         BNE   WDIKEYS                  BR IF NO                        48800019
         STH   DATALN,WDI1WD+CNTOFF     PUT SEG LNGTH IN CCW            48850019
         B     FINWRT                   CONTINUE WRITE PROCESSING       48900019
WDIKEYS  EQU   *                                                        48950019
         LA    WORKR1,WDI1WDK           *                               49000019
         ST    WORKR1,WDI1WKD            * MAKE CCW4 TIC TO CCW5        49050019
         MVI   WDI1WKD,TICOP            *                               49100019
         STH   DATALN,WDI1WDK+CNTOFF    PUT SEG LNGTH IN CCW            49150019
         B     FINWRT                   CONTINUE WRITE PROCESSING       49200019
WRTADD2  EQU   *                                                        49250019
         USING WRITADD1,CPSTART         SET UP ADD DSECT                49300019
         CLI   WA1SIE2,TICOP            IS CCW6 STILL A TIC             49350019
         BE    CHNGWA                   BR IF YES                       49400019
FINWA    EQU   *                                                        49450019
         STH   DATALN,WA1WD+CNTOFF      PUT SEG LNGTH IN CCW            49500019
         STH   DATALN,CNTDL             PUT SEG LNGTH IN COUNT FIELD    49550019
         B     FINWRT                   FINISH WRITE PROCESSING         49600019
CHNGWA   EQU   *                                                        49650019
         MVC   WA1WC,WAWCKD1-WANOP2(CPSTART) MOVE WRITE COUNT CCW       49700019
         TM    WAKWK-WANOP2+FLAGS(CPSTART),DATACHAN  WERE KEYS WRITTEN  49750019
         BO    WAKEYS                   BR IF YES                       49800019
         LA    WORKR1,WANKWD-WANOP2(CPSTART) POINT TO WRITE DATA CCW    49850019
MVCWD    EQU   *                                                        49900019
         MVC   WA1WD,NULL(WORKR1)       MOVE IN WRITE DATA CCW          49950019
         MVI   WA1WD+FLAGS,COMCHAN      SET COMMAND CHAINING FLAG       50000019
         MVC   WA1SIE2(WA1WCR-WA1SIE2),WA1SIE  MOVE IN SEARCH ID EQUAL  50050019
*                                       AND TIC CCW'S                   50100019
         LA    PARAM2,WA1SIE2           *                               50150019
         ST    PARAM2,WA1TIC2            *  INSERT TIC ADDRESS          50200019
         MVI   WA1TIC2,TICOP            *                               50250019
         LA    PARAM2,IOBCC                                             50300002
         ST    PARAM2,WA1WCR            PUT ADDR OF IOBSEEK+3 IN THE    50350019
*                                       CCW WHICH UPDATES R0            50400019
         MVI   WA1WCR,WDOP              INSERT WRITE DATA OP CODE       50450019
         MVC   WA1WCR+FLAGS(EQU4),WCRF  INSERT FLAGS AND DATA LENGTH    50500019
         TM    DECTYPE,VERIFY           WRITE CHECK REQUESTED           50550019
         BO    WAWC                     BR IF YES                       50600019
ZEROKL   MVI   CNTKL,NULL               SET KEY LNGTH TO 0 IN COUNT FLD 50650019
         B     FINWA                    GO FINISH ADD PREPERATION       50700019
WAKEYS   EQU   *                                                        50750019
         LA    WORKR1,WAKWD-WANOP2(CPSTART)  POINT TO WRITE DATA CCW    50800019
         B     MVCWD                    GO MOVE IN WRITE DATA CCW       50850019
WAWC     EQU   *                                                        50900019
         MVC   WA1NOP2,WA1NOP1          MOVE IN NOP OR SET SECTOR=0     50950019
         MVC   WA1RR0,WANKRR0-WANKWD(WORKR1) MOVE IN READ R0 CCW        51000019
         OI    WA1RR0+FLAGS,COMCHAN     SET COMMAND CHAINING FLAG       51050019
         MVC   WA1RD,WANKRKD-WANKWD(WORKR1) MOVE IN READ-KEY-DATA CCW   51100019
         NI    WA1RD+FLAGS,COMCOFF      TURN OFF COMMAND CHAINING       51150019
         B     ZEROKL                   GO ZERO KEY LENGTH              51200019
FRSTWRT  EQU   *                                                        51250019
         TM    DECTYPE+ONE,KEY          IS TYPE = DK                    51300019
         BZ    FRSTWDI                  BR IF NO (TYPE = DI)            51350019
FRSTWDK  EQU   *                                                        51400019
         MVC   IOBCC(FIVE),DNRCFP2      MOVE CCHHR TO IOBSEEK+3         51450002
         TM    DECTYPE,EXSCH            TEST FOR EXTENDED SEARCH        51500019
         BO    FRSTWES                  BR IF YES                       51550019
         USING WRITEDK1,CPSTART         SET UP DSECT                    51600019
         CLI   WDK1NOP2,RDSC            RCD READY IMPLEMENTED    20201  51609020
         BNE   NOTRRB9                  BRANCH NO                20201  51618020
         MVC   WDK1NOP1,WDK1NOP2        MOVE RD SECTOR TO CCW1   20201  51627020
         MVI   WDK1NOP1,SETSC           CHANGE CMND              20201  51636020
         MVI   WDK1NOP1+BYTE4,COMCHAN   CMND CHAIN CCW           20201  51645020
         MVI   WDK1NOP2,SETSC           CHANGE RD SECTOR TO SET  20201  51654020
         B     FEATB9                   SKIP NEXT INST           20201  51663020
NOTRRB9  EQU   *                                                 20201  51672020
         MVI   WDK1NOP1,NOPCODE         CCW1 A NOP               20201  51681020
FEATB9   EQU   *                                                 20201  51690020
         LA    WORKR1,IOBCC             *                               51700002
         ST    WORKR1,WDK1SIE            * MAKE CCW2 A SEARCH-ID-EQUAL  51750019
         MVI   WDK1SIE,SIEOP            *                               51800019
         MVI   WDK1SIE+BYTE7,FIVE       SET LENGTH TO 5          20201  51820020
         LA    WORKR1,WDK1SIE           *                               51850019
         ST    WORKR1,WDK1TIC1           * MAKE CCW3 TIC TO CCW2        51900019
         MVI   WDK1TIC1,TICOP           *                               51950019
         LA    WORKR1,WDK1WD            POINT TO WRITE DATA CCW         52000019
         MVI   WDK1WD+FLAGS,NULL        TURN OFF COMMAND CHAINING       52010019
         B     MAKEAWD                  GO CONSTRUCT WRITE DATA CCW     52050019
FRSTWDI  EQU   *                                                        52100019
         USING WRITEDI1,CPSTART         SET UP DSECT                    52150019
         LA    WORKR1,WDI1WD            POINT TO WRITE DATA CCW         52200019
         CLI   WDI1WDK,WDOP             ARE KEYS BEING WRITTEN          52250019
         BNE   MAKEAWD                  BR IF NO                        52300019
         MVC   WDI1WKD(CCPADR),DECKYADR PUT KEY ADDR IN CCW             52350019
         MVI   WDI1WKD,WKDOP            MOVE IN WRITE-KEY-DATA OP CODE  52400019
         MVI   WDI1WKD+FLAGS,DATACHAN   SET DATA CHAINING FLAG          52450019
         MVC   WDI1WKD+CNTOFF+ONE(ONE),DCBKEYLE MOVE IN KEY LENGTH      52500019
         LA    WORKR1,WDI1WDK           POINT TO WRITE DATA CCW         52550019
         B     MAKEAWDL                 PUT LENGTH IN THE CCW           52600019
FRSTWES  EQU   *                                                        52650019
         MVC   IOBDNCRF+SEVN(ONE),IOBSEEK  SAVE THE EXTENT NUMBER       52660002
         USING WRITEES1,CPSTART         SET UP DSECT                    52700019
         OI    WE1NOP1+BYTE3,BYTE1      CHANGE ADDR IN CASE SET  20201  52710020
*                                       SECTOR                          52720020
         LA    WORKR1,WEWD              *                               52750019
         ST    WORKR1,WE1TIC2            * MAKE CCW4 A TIC TO CCW16     52800019
         MVI   WE1TIC2,TICOP            *                               52850019
MAKEAWD  EQU   *                                                        52900019
         LA    WREG9,SWABDW                                             52950019
         ST    WREG9,NULL(WORKR1)       PUT SWA ADDR IN WRITE CCW       53000019
         MVI   NULL(WORKR1),WDOP        PUT IN WRITE-DATA OP CODE       53050019
MAKEAWDL LH    DATALN,DECLNGTH          GET DATA LENGTH FROM USER       53100019
         CH    DATALN,SWABDW            IS THE LENGTH GREATER THAN THE  53150019
*                                       SIZE OF THE FIRST SEGMENT       53200019
         BH    USESEGLN                 BR IF YES                       53250019
         MVI   SEGFLGS,NULL             SET FLAGS TO 00                 53300019
ENDFW    EQU   *                                                        53350019
         STH   DATALN,CNTOFF(WORKR1)    PUT DATA LENGTH IN THE CCW      53400019
         STH   DATALN,SWABFINC          PUT LENGTH IN BUF INCR FIELD    53450019
         LA    FROMADR,EIGHT(RAPTR)     POINT TO DATA TO BE MOVED       53500019
         BAL   RETFMOVE,PREMOVE         MOVE DATA AND FILL IN BDW,SDW   53550019
         TM    DECTYPE,VERIFY                                           53600019
         BZ    EXCPAGN                  BR IF NOT WRITE CHECK           53650019
         MVI   FLAGS(WORKR1),COMCHAN    SET COMMAND CHAINING FOR VERIFY 53700019
         TM    DECTYPE+ONE,KEY          IS TYPE =DK                     53750019
         BZ    EXCPAGN                  BR IF NO                        53800019
         OI    CCWLN+FLAGS(WORKR1),COMCHAN SET COMMAND CHAINING IN THE  53850019
*                                          NEXT CCW                     53900019
         B     EXCPAGN                  WRITE THE SEGMENT               53950019
USESEGLN EQU   *                                                        54000019
         LH    DATALN,SWABDW            USE SEG LENGTH AS DATA LENGTH   54050019
         MVI   SEGFLGS,ONE              INDICATE FIRST SEGMENT          54100019
         B     ENDFW                    INSERT DATA LENGTH IN CCW       54150019
*                                                                       54200019
*                                                                       54250019
*  THIS ROUTINE WILL MOVE A RECORD WHOSE LENGTH MAY EXCEED 256 BYTES    54300019
*                                                                       54350019
*                                                                       54400019
AMOVE    MVC   NULL(NULL,TOADR),NULL(FROMADR) MOVE LESS THAN 256 BYTES  54450019
*                                                                       54500019
MOVE256  MVC   NULL(FFF,TOADR),NULL(FROMADR)  MOVE 256 BYTES            54550019
         LA    TOADR,FFF(TOADR)                                         54600019
         LA    FROMADR,FFF(FROMADR)                                     54650019
*                                                                       54700019
MOVE     SH    MVCLNGTH,H256            IF SIZE IS GREATER OR EQUAL TO  54750019
         BH    MOVE256                   256, GO MOVE 256 BYTES         54800019
         AH    MVCLNGTH,H255            ELSE,                           54850019
         EX    MVCLNGTH,AMOVE            MOVE REMAINING NBR OF BYTES    54900019
         BR    RETFMOVE                 RETURN TO CALLING SEQUENCE      54950019
*                                                                       55000019
*                                                                       55050019
PREMOVE  EQU   *                                                        55100019
         STH   DATALN,SWABDW            PUT LENGTH IN BLK. DESCP. WORD  55150019
         SH    DATALN,FOUR                                              55200019
         STH   DATALN,SEGLL             PUT LENGTH IN SEG. DESCP. WORD  55250019
         SH    DATALN,FOUR                                              55300019
         LR    TOTLN,DATALN             SAVE ACTUAL DATA LENGTH         55350019
         LA    TOADR,SEGDATA                                            55400019
         B     MOVE                     MOVE THE DATA TO THE SWA        55450019
*                                                                       55500019
DASIB    TM    IOBDTYPE,IOBRDEXC+IOBFDBCK   IF NOT READ EXCLUSIVE OR    55550002
         BZ    DASIC                    FEEDBACK OPTION, SKIP NEXT RTN. 55600019
         TM    IOBDTYP2,IOBTYPE+IOBADDTY  IS TYPE = DI                  55650002
         BC    ONE+MIXED,FDBKNDI        BRANCH IF NO                    55670019
         TM    IOBDTYP2,IOBRQUST        IS THIS A READ                  55690002
         BO    DASIC                    BRANCH IF YES                   55710019
FDBKNDI  EQU   *                                                        55730019
*                                                                       55750019
*  THE FOLLOWING ROUTINE LOCATES OR DEVELOPS ACTUAL ADDRESS FOR USE AS  55800019
*     FEEDBACK AND/OR READ EXCLUSIVE ARGUMENT                           55850019
*                                                                       55900019
         TM    IOBSTAT1,IOBADDVU        IS THIS A SELF FORMAT ADD       55950002
         BO    TSTEXIT                  YES-SKIP MOVING FEEDBACK        56000019
         MVC   IOBBB2(SIX),IOBDNCRF+ONE  MOVE ACTUAL                    56050002
         MVC   IOBM,IOBDNCRF+SEVN       RESTORE EXTENT NUMBER           56060002
*                                                                       56100019
*  IF THIS WAS A WRITE TO RELEASE AN EXCLUSIVE RECORD, GO TO THE READ   56150019
*   EXCLUSIVE MODULE WITHOUT TESTING FOR FEEDBACK TO BE RETURNED.       56200019
*                                                                       56250019
TSTEXIT  TM    IOBDTYP2,IOBRQUST        IS THIS A READ OR WRITE         56300002
         BO    TSTFDB                   READ, GO TEST FOR FEEDBACK      56350019
         TM    IOBDTYPE,IOBRDEXC        IF WRITE AND EXCLUSIVE BITS SET 56400002
         BO    RDXEXIT                  GO TO THE READX MODULE          56450019
TSTFDB   TM    DCBOPTCD,DCBOPTF         IF DCB DOES NOT SPECIFY         56500002
         BZ    ACTFDBK                  FEEDBACK                        56550002
         TM    IOBDTYPE,IOBACTAD        OR ADDRESSING IS ACTUAL         56600002
         BZ    TSTRR                    RETURN                          56650002
ACTFDBK  L     WORKR1,IOBECBPT          ACTUAL ADDRESS                  56700002
         L     WORKR1,DECRECPT-DECBDEF(WORKR1)    AS                    56750019
         MVC   NULL(EIGHT,WORKR1),IOBSEEK             FEEDBACK.         56800019
         B     DASIC                    GO TEST FOR DYNAMIC BUFFERING   56850019
         SPACE 2                                                        56852002
*********************************************************************** 56860002
*  THE FOLLOWING ROUTINE SETS UP FOR AND ISSUES SVC 53, THE EXCLUSIVE * 56870002
*  CONTROL MODULE.  THE FIRST EXIT IS TO GET EXCLUSIVE CONTROL OF     * 56880002
*  THE BLOCK JUST READ IN (FOR EITHER A READ EXCLUSIVE OR WRITE ADD   * 56882002
*  REQUEST.) THE SECOND EXIT IS TO RELEASE EXCLUSIVE CONTROL OF THE   * 56884002
*  BLOCK JUST WRITTEN OUT (WRITE RELEASE). IGC0005C EXPECTS THE IOB   * 56886002
*  TO BE IN REG 1 UPON ENTRY. THIS REGISTER WILL BE COMPLEMENTED.     * 56894002
*********************************************************************** 56896402
ENQUEUE  EQU   *                                                        56900019
         LCR   PARAM,PARAM               REG 1, IOB-COMPLEMENTED Y02072 56930002
*                                                                       56940002
         SVC   53                        GO ENQUEUE CURRENT REC  Y02072 56942002
*                                                                       56944002
         SVC   EXIT                      RETURN TO SUPERVISOR           57050002
RDXEXIT  EQU   *                         RELEASE CONTROL OF BLK  Y02072 57102002
         LR    IOBREG,PARAM              SAVE IOB REG ACROSS SVC Y02072 57102402
         LCR   PARAM,PARAM               REG 1, IOB-COMPLEMENTED Y02072 57104002
         DROP  PARAM                     DROP IOB BASE REG       Y02072 57114002
*                                                                       57140002
         SVC   53                        GO DEQUEUE CURRENT REC  Y02072 57142002
*                                                                       57144002
         LR    PARAM,IOBREG              RESTORE IOB REG         Y02072 57194002
         USING IOBSTDRD,PARAM            REESTABLISH ADDRESSING  Y02072 57196002
         B    DASIC                      NO, GO CHK DYN BUF      Y02072 57198402
*********************************************************************** 57210002
*                                                                       57260002
TSTRR    LA    INTRET,DASIC             SET UP TO TEST FOR DYN. BUFF.   57300019
*                                       ON RETURN FROM ADDR CONVERSION  57350019
*                                                                       57600019
         L     EPREG,DCBREAD            LOCATE THE                      57650003
         USING IGG019KJ,EPREG                                    A35339 57700021
         L     EPREG,RTAD               LOAD ADDR OF REL TRK MOD A35339 57710021
         DROP  EPREG                                             A35339 57720021
         BR    EPREG                    AND GO THERE (19KC+0)    Y02072 57750002
*                                                                       57800019
*                                                                       57850019
DASIC    EQU   *                                                        57900019
         TM    IOBDTYPE,IOBDYNBF        TEST FOR DYNAMIC BUFFERING      57950002
         BO    ASIDB                    BR IF YES                       58000019
         TM    DCBOPTCD,DCBOPTDB        SEE IF DYNAMIC BUFFERING IN DCB 58010002
         BZ    FREESWA                  BRANCH IF NO                    58020019
*                                                                       58050019
*   THE SEGMENT WORK AREA WILL NOW BE RETURNED TO THE POOL              58100019
*                                                                       58150019
         LR    IOBREG,PARAM             SAVE IOB ADDRESS                58154019
         SH    PARAM,FOUR               GET ADDRESS OF IOB-4            58158019
         L     PARAM,NULL(PARAM)        GET SWA ADDRESS IN IOB          58162019
         SH    PARAM,H8                 GET BCB ADDRESS                 58166019
         LH    PARAM2,SIX(PARAM)        GET BUFFER SIZE                 58170019
         AH    PARAM2,H8                ADD BUFFER CONTROL BLOCK SIZE   58174019
         FREEMAIN R,LV=(0),A=(1)        FREE BUFFER                     58178019
         LR    PARAM,IOBREG             RESTORE IOB REGISTER            58182019
         B     ASIDB                    CONTINUE                        58186019
FREESWA  EQU   *                                                        58190019
         LR    WORKR1,PARAM                                             58200019
         SH    WORKR1,FOUR              GET SWA ADDRESS                 58250019
         L     WORKR1,NULL(WORKR1)                                      58300019
         MVI   NULL(WORKR1),NULL        MAKE SWA AVAILABLE              58400019
*                                                                       58500019
ASIDB    EQU   *                                                        58550019
         TM    IOBDTYP2,IOBRQUST        IS THIS A READ REQUEST          58600002
         BO    MAKEAVL                  YES- MAKE IOB AVAILABLE  Y02072 58650002
         TM    IOBDTYPE,IOBDYNBF        NO-TEST FOR DYN. BUFFERING      58700002
         BZ    MAKEAVL                  NO- MAKE IOB AVAILABLE   Y02072 58750002
*                                                                       58800021
*                       FREE DYNAMIC BUFFER                             58810021
*                                                                       58820021
         LR    SAVE,PARAM               SAVE IOB POINTER         A30797 58830021
         L     PARAM2,IOBECBPT          ADDR OF DECB             A30797 58840021
         L     PARAM,IOBDCBPT           ADDR OF DCB              A30797 58850021
         FREEDBUF (0),D,(1)             FREE THE BUFFER          A30797 58860021
         LR    PARAM,SAVE               RESTORE IOB POINTER      A30797 58870021
         L     SAVE,IOBDCBPT            RESTORE DCB POINTER      A30797 58880021
         USING IHADCB,SAVE                                       A30797 58890021
*                                                                       58900019
*   THE FOLLOWING ROUTINE ZEROES THE AVAILABILITY BYTE IN THE IOB       58950002
*   AND POSTS THE ECB COMPLETE.                                         59000002
*                                                                       59100019
MAKEAVL  SR    PARAM2,PARAM2            CLEAR FOR EXCEPTION CODES.      59300019
         IC    PARAM2,IOBSTAT2          INSERT EXCEP. CODES FROM IOB    59350002
         SLL   PARAM2,HIPOS             POSITION THEM FOR POST.         59400019
         LR    RIOB,PARAM               SAVE IOB REG IN POST     Y02072 59450002
         DROP  PARAM,SWAPTR             DROP PREVIOUS BASES      Y02072 59500002
         USING  IOBSTDRD,RIOB           NEW BASE FOR IOB         Y02072 59550002
         L     FDNBASE,IOBDQPTR         LOAD SAVED SUPER RETURN  YM5969 59600002
         L     PARAM,IOBECBPT           SET DECB PARAMETER              59650019
*                                                                       59700019
         POST  (1),(0)                  POST.                           59750002
         TM    DCBMACRF,DCBMRCK         IS CHECK MACRO SPECIFIED Y02072 59820002
         BOR   FDNBASE                  YES, RETURN DIRECTLY     Y02072 59830002
         MVI   IOBDAYLI,NULL            ELSE, MAKE IOB AVAILABLE Y02072 59840002
         BR    FDNBASE                  RETURN TO SUPERVISOR     Y02072 59842002
         DROP  RIOB                     DROP TEMPORARY IOB BASE  Y02072 59844002
         USING IOBSTDRD,PARAM           REESTABLISH OLD IOB BASE Y02072 59846002
         USING SWA,SWAPTR               REESTABLISH SWA BASE     Y02072 59848002
*                                                                       59850019
*                                                                       59900019
*                                                                       61600019
*    THE FOLLOWING ROUTINE DETERMINES THE CAUSE OF ABNORMAL COMPLETION  61650019
*     BY ANALYZING THE SENSE BYTES AND CSW STORED IN THE IOB BY IOS.    61700002
*                                                                       61750019
*                                                                       61800019
ASIERR   TM    IOBSTAT2,ALLMSK          HAS ERROR ALREADY BEEN FLAGGED  61850002
         BM    ERREXIT                  IF YES , EXIT                   61900019
         TM    IOBCSW+3,UCMSK           TEST FOR UNIT CHECK             61950002
         BZ    TSTEXC                   BR. IF NOT                      62000019
         TM    IOBSENS0,DCMSK           TEST FOR DATA CHECK      YM5853 62050002
         BO    SETUDC                   BRANCH IF YES                   62100019
         TM    IOBSENS1,NRMSK           TEST NO RECORD FOUND     YM5853 62150002
         BZ    SETUE                    IF NOT SET, MUST BE UNRELATED   62200019
ASIERR2  OI    IOBSTAT2,NOREC           SET NO RECORD FOUND EX. CODE    62250002
         TM    IOBDTYP2,IOBADDTY        IS TYPE WRITE ADD               62300002
         BZ    DASIC                    NO, RETURN TO POOLING ROUTINE   62350019
         XI    IOBSTAT2,FLIPMSK         CHG NO-RCD-FOUND TO NO-SPACE    62400002
         B     KNP8EXIT                 GO TO SELF FORMAT MODULE        62450019
*                                                                       62500019
SETUDC   OI    IOBSTAT2,UNCOR           SET UNCORRECTABLE DATA CHECK    62550002
         B     ERREXIT                  GO TEST FOR EXIT                62600019
*                                                                       62650019
TSTEXC   EQU   *                                                        62700019
         TM    IOBCSW+4,INCLMSK         WAS THE RECORD WRONG LENGTH     62750002
         BO    SETINCL                  IF YES GO SET FLAG              62800019
SETUE    OI    IOBSTAT2,UNREL           SET UNRELATED ERROR FLAG        62850002
*                                                                       62900019
ERREXIT  TM    IOBDTYP2,IOBADDTY        IF THIS WAS A FORMAT WRITE,     62950002
         BO    KNP8EXIT                 GO SCAN UNSCHEDULED QUEUE       63000019
         TM    IOBSTAT2,INCLMSK+ENDOD   IF INCORRECT LENGTH OR EOD      63050002
         BZ    DASIC                    BYPASS FEEDBACK TEST            63100019
         B     ISITNA                   ELSE TEST FOR NEXT ADDRESS      63150019
*                                                                       63200019
SETINCL  EQU   *                                                        63250019
         TM    IOBDTYP2,IOBRQUST        WAS THIS A READ REQUEST         63300002
         BZ    SETLGNCK                 BR IF NOT                       63350019
         LH    WORKR1,DECLNGTH          GET SPECIFIED LENGTH            63400019
         SH    WORKR1,IOBCSW+5          SUBTRACT RESIDUAL COUNT         63450002
         CH    WORKR1,SWABDW            REMAINDER SHOULD EQUAL THE      63500019
*                                       LENGTH OF THE RECORD JUST READ  63550019
         BNE   SETLGNCK                 SET ERROR IF NOT                63600019
         NI    IOBFLAG1,CLRLNER1        CLEAR LENGTH ERROR              63650019
         NI    IOBCSW+4,CLRLNER2        CLEAR LENGTH ERROR              63700002
         NI    IOBDSTAT,CLRABN          TURN OFF ABNORMAL COMPLETION    63750019
         B     GOODCMPL                 CONTINUE PROCESSING             63800019
SETLGNCK EQU   *                                                        63850019
         OI    IOBSTAT2,LGNCK           SET INCORRECT LENGTH EXCEPTION  63900002
         B     ERREXIT                  CODE, GO DETERMINE EXIT         63950019
*                                                                       64000019
*                                                                       64050019
ADD1RTN  EQU   *                                                        64100019
*                                                                       64150019
*********************************************************************** 64200019
*                                                                       64250019
*              ADD1RTN ROUTINE IN IGG019KJ                              64300019
*                                                                       64350019
*********************************************************************** 64400019
*                                                                       64450019
*                                                                       64500019
*        REGISTER USAGE                                                 64550019
*                                                                       64600019
*                                                                       64650019
WORK3    EQU   3                        REG TO RETURN TO CALLING RTN    64700019
CVTREG   EQU   4                        CVT POINTER                     64750019
DTABREG  EQU   CVTREG                   DEVICE TABLE POINTER            64800019
IOBADR   EQU   PARAM                    IOB POINTER                     64850019
DEBREG2  EQU   7                        DEB POINTER                     64900019
WKREGA   EQU   9                        GENERAL PURPOSE REGISTER        64950019
WKREGB   EQU   10                       GENERAL PURPOSE REGISTER        65000019
WKREG3   EQU   8                        GENERAL PURPOSE REGISTER        65050019
RQEREG   EQU   15                       POINTER OF 12*                  65100019
UCBREG   EQU   RQEREG                   UCB POINTER                     65150019
TWLVSTAR EQU   7                                                        65200019
*                                                                       65250019
*                                                                       65300019
         USING DEBDEF,DEBREG2           DEB BASE REG                    65350019
         LA    RETREG,GOTDVTB                                           65400019
*                                                                       65450019
*                                                                       65500019
*        CALCULATE THE DEVICE TYPE ENTRY IN THE DEVICE TABLE            65550019
*                                                                       65600019
*                                                                       65650019
GETDVTB  LR    RQEREG,TWLVSTAR          GET 12* POINTER                 65700019
         USING RQE,RQEREG               ESTABLISH RQE BASE       Y02072 65710002
         L     UCBREG,RQEUCB            LOAD 3 BYTE UCB ADDR     Y02072 65720002
         DROP  RQEREG                                            Y02072 65730002
         L     CVTREG,CVTPTR(NULL,NULL)      LOAD CVT ADDRESS           65800019
         L     DTABREG,DTABOFF(NULL,CVTREG)  LOAD DEVICE TABLE ADDRESS  65850019
*                                            FROM CVT                   65900019
         IC    WKREGA,TYPCD(UCBREG)     LOAD DEVICE CODE FROM UCB       65950019
         N     WKREGA,LASTFOUR          CLEAR ALL BUT LOW ORDER 4 BITS  66000019
         IC    WKREGA,NULL(WKREGA,DTABREG)   GET DEVICE ENTRY OFFSET    66050019
         LA    DTABREG,NULL(WKREGA,DTABREG)  POINTER TO DESIRED ENTRY   66100019
*                                            TO THE DEVICE TABLE        66150019
*                                                                       66200019
*                                                                       66250019
         BR    RETREG                   RETURN IF JUST DEV TAB WANTED   66300019
GOTDVTB  EQU   *                                                        66350019
         MVC   IOBCSW-1(BYTE4),NULL(DTABREG)  MOVE TOTAL NO. OF CCHH TO 66400002
*                                            IOBCSW FIELD TEMPORARILY   66450019
         MVC   IOBCSW+3(BYTE4),IOBCC     NEXT MOVE IN THE CURRENT CCHH  66500002
         MVI   IOBR,NULL                 ZERO OUT R IN IOBSEEK FIELD    66600002
         L     DEBREG2,DCBDEBAD          GET DEB ADDRESS                66650002
         LA    IOBADR,NULL(NULL,IOBADR) CLEAR HI-ORDER BYTE TO ZERO     66950019
         LA    WKREGB,BYTE3(NULL,IOBADR)     POINT TO LAST H IN CCHH    67000019
         L     WKREG3,IOBCSW+3          LOAD CURRENT CCHH ADDRESS       67050002
         TM    BYTEDEV(DTABREG),CONTIG  ARE ADDRESS BYTES NON-CONTIG.   67100019
         BZ    DOWNONE                  BRANCH IF THEY ARE CONTIGUOUS   67150019
*                                                                       67200019
*                                                                       67250019
ADDONE   EQU   *                                                        67300019
*                                                                       67350019
*                                                                       67400019
         AH    WKREG3,ONEH              INCREMENT CURRENT CCHH BY ONE   67450019
         TM    BYTEDEV(DTABREG),CONTIG  IF THIS DEVICE HAS NON-CONTIG-  67500019
*                                       UOUS BYTES                      67550019
         BO    USEBYTE                  BRANCH IF IT HAS                67600019
         STH   WKREG3,IOBCSW-1-IOBSTDRD+BYTE4(NULL,WKREGB) ST NEW CC OR 67650002
*                                                      HH VALUE         67700019
         CLC   IOBCSW-1-IOBSTDRD+4(2,WKREGB),IOBCSW-1-IOBSTDRD(WKREGB)  67750002
*                                       IS VALUE OF NEW CC OR HH VALID  67800019
         BL    TESTEXT                  IF IT IS, GO TEST EXTENT LIMIT  67850019
         SRL   WKREG3,BIT16             SHIFT TO NEW CC VALUE           67900019
         MVC   IOBCSW-1-IOBSTDRD+BYTE4(BYTE2,WKREGB),ZERO  ZERO 2 BYTES 67950002
         BCTR  WKREGB,NULL              DECREMENT INDEX TO NEXT VALUE   68000019
*                                                                       68050019
*                                                                       68100019
DOWNONE  EQU   *                                                        68150019
*                                                                       68200019
*                                                                       68250019
         BCTR  WKREGB,NULL              DECREMENT INDEX TO NEXT VALUE   68300019
         CR    WKREGB,IOBADR            IF ALL OF CCHH BEEN INCREMENTED 68350019
         BNL   ADDONE                   IF NO, REPEAT LOOP              68400019
*                                                                       68450019
*                                                                       68500019
CALEXT   EQU   *                                                        68550019
*                                                                       68600019
*                                                                       68650019
*        CALCULATE THE NEXT EXTENT                                      68700019
*                                                                       68750019
*                                                                       68800019
         SR    WKREGA,WKREGA                                            68850019
         IC    WKREGA,IOBM              LOAD CURRENT EXTENT NUMBER      68900002
         LA    WKREGA,BYTE1(NULL,WKREGA)    ADJUST EXTENT NUMBER        68950019
         SR    WKREGB,WKREGB            CLEAR REGISTER                  69000019
         IC    WKREGB,DEBNMEXT          FETCH NO. OF TOTAL EXTENTS      69050019
         CR    WKREGA,WKREGB            CHECK IF IT IS THE LAST EXTENT  69100019
         BNE   NEXTEXT                  BRANCH IF NOT                   69150019
         SR    WKREGA,WKREGA            OTHERWISE, USE THE 1ST EXTENT   69200019
*                                                                       69250019
NEXTEXT  EQU   *                                                        69300019
*                                                                       69350019
*                                                                       69400019
         STC   WKREGA,IOBM              STORE NEW EXTENT NO. IN IOBSEEK 69450002
         SLL   WKREGA,FOURB             MULT EXTENT NO. BY 16 FOR       69500019
*                                       INDEXING                        69550019
         LA    WKREGB,DEBDVMOD(WKREGA)  FETCH ADDRESS OF EXTENT IN DEB  69600019
         MVC   IOBBB1(BYTE6),BYTE4(WKREGB) MOVE BBCCHH IN THE           69650002
*                                                 IOBSEEK FIELD         69700019
         BR    WORK3                    RETURN TO CALLING ROUTINE       69750019
*                                                                       69800019
*                                                                       69850019
USEBYTE  EQU   *                                                        69900019
*                                                                       69950019
*                                                                       70000019
         STC   WKREG3,IOBCSW-1-IOBSTDRD+BYTE4(WKREGB) STORE NEW BYTE    70050002
         SRL   WKREG3,BIT8              SHIFT TO NEXT VALUE             70100019
         CLC   IOBCSW-1-IOBSTDRD+4(1,WKREGB),IOBCSW-1-IOBSTDRD(WKREGB)  70150002
*                                       CHECK VALIDITY OF NEW BYTE      70200019
         BL    TESTEXT                  BRANCH IF NEW BYTE IS VALID     70250019
         MVI   IOBCSW-1-IOBSTDRD+BYTE4(WKREGB),NULL  OTHERWISE ZERO OUT 70300002
*                                                 THIS NEW BYTE         70350019
         B     DOWNONE                  GO CHECK IF ALL BYTES PROCESSED 70400019
*                                                                       70450019
*                                                                       70500019
TESTEXT  EQU   *                                                        70550019
*                                                                       70600019
         SR    WKREGA,WKREGA            CLEAR REG                 21905 70607021
         IC    WKREGA,IOBM              GET CURRENT EXTENT NO     21905 70614002
         SLL   WKREGA,FOURB             MULTIPLY BY 16 FOR INDEX  21905 70621021
         LA    WKREGA,DEBDVMOD(WKREGA)  LOAD ADDR OF CUR EXT      21905 70628021
*                                       IN DEB                          70635021
         USING DEBDVMOD,WKREGA                                    21905 70642021
*                                                                       70650019
         MVC   IOBCC(BYTE4),IOBCSW+3    MOVE NEW CCHH BACK TO           70700002
*                                                 IOBSEEK FIELD         70750019
         CLC   IOBCC(BYTE4),DEBENDCC    CHECK IF THE NEW CCHH IS        70800002
*                                       THE NEW CCHH IS OUTSIDE OF THE  70850019
*                                       CURRENT EXTENT                  70900019
         BH    CALEXT                   IF YES, GO TO CALCULATE THE     70950019
*                                       NEXT EXTENT                     71000019
         BR    WORK3                    OTHERWISE, RETURN TO CALLING    71050019
*                                       ROUTINE                         71100019
*                                                                       71150019
*                                                                       71200019
*********************************************************************** 71250019
*                 CONSTANTS AND EQUATES                                 71300002
*********************************************************************** 71310002
*                                                                       71350019
         DS    0F                                                       71400019
LASTFOUR DC    X'0000000F'              USED TO CLEAR ALL BUT LAST 4    71450019
*                                       BITS                            71500019
ZEROH    DS    0F                       * USED TO ZERO THE HI ORDER     71550019
         DC    X'0000FFFF'              * HALF WORD OF A REGISTER       71600019
ONEH     DC    H'1'                     GENERAL PURPOSE CONSTANT        71650019
H7       DC    H'7'                     GENERAL PURPOSE CONSTANT        71700019
H8       DC    H'8'                     CCW LENGTH                      71750019
SIXTEEN  DC    H'16'                    GENERAL PURPOSE CONSTANT        71800019
FOUR     DC    H'4'                     GENERAL PURPOSE CONSTANT        71850019
H255     DC    H'255'                   *                               71900019
H256     DC    H'256'                    * CONSTANTS USED BY MOVE RTN   71950019
FFF      EQU   256                      *                               72000019
Q255     EQU   255                      MAX TO CLEAR IOB        ZA01524 72010000
ZERO     DC    H'0'                     GENERAL PURPOSE CONSTANT  21905 72050021
WCRF     DC    X'20000007'              FLAGS AND DATA LENGTH USED TO   72200019
*                                       UPDATE R0                       72250019
UNAVALSW EQU   X'FF'              IOB UNAVAILABLE SWITCH                72292001
SHFT3BYT EQU   X'18'              USED FOR SLL 24 BITS(3 BYTES)         72294001
CLRSTAT  DC    X'0400'                  USED TO CLEAR IOBDSTAT EXCEPT   72300019
*                                       FOR DYNAMIC BUFFERING BIT       72350019
*                                                                       72400019
*   DEVICE TABLE OFFSETS                                                72450019
*                                                                       72500019
TRKLN    EQU   4                        TRACK LENGTH                    72550019
OVERI    EQU   6                        OVERHEAD NOT LAST RECORD        72600019
OVERK    EQU   8                        OVERHEAD KEYED RECORD           72650019
TOLER    EQU   10                       TOLERANCE FACTOR                72700019
DTABOFF  EQU   64                       DEVICE TABLE OFFSET IN CVT      72750019
*                                                                       72800019
NINE     EQU   9                        USED TO DIVIDE BY 512 (SHIFT)   72850019
EQU4     EQU   4                                                        72900019
SIX      EQU   6                                                        72950019
HIPOS    EQU   16                                                       73000019
TYPCD    EQU   19                       DEVICE TYPE OFFSET IN UCB       73050019
BYTE1    EQU   1                        ONE BYTE                        73100019
BYTE2    EQU   2                        TWO BYTES                       73150019
BYTE3    EQU   3                        THREE BYTES                     73200019
BYTE4    EQU   4                        FOUR BYTES                      73250019
FOURB    EQU   4                        USED AS MULTIPLIED BY 16        73300019
BYTEDEV  EQU   9                        FLAG BYTE OFFSET IN THE DEVICE  73350019
*                                       TABLE                           73400019
BYTE6    EQU   6                        SIX BYTES                       73450019
BYTE7    EQU   7                        SEVEN BYTES                     73500019
BIT8     EQU   8                        EIGHT BITS                      73550019
BIT16    EQU   16                       SIXTEEN BITS                    73600019
CONTIG   EQU   2                        FLAGS INDICATING BYTES OF CCHH  73700019
*                                       ARE NON-CONTIGUOUS              73750019
FIRSTSEG EQU   2                        FIRST SEGMENT IF BIT IS ZERO    73800019
LASTSEG  EQU   1                        LAST SEGMENT IF BIT IS ZERO     73850019
SIEOP    EQU   X'31'                    SEARCH-ID-EQUAL COMM. CODE      73900019
TICOP    EQU   8                        TIC  COMMAND CODE               73950019
CCHHLN   EQU   4                                                        74000019
R1       EQU   1                        BLOCK ID = 1                    74050019
SDW      EQU   4                        OFFSET OF SEG DESCRIPTOR WORD   74100019
NEXTADR  EQU   X'10'                    NEXT ADDRESS MASK               74150019
TYPERU   EQU   X'30'                    MASK FOR TYPE = RU TEST         74200019
TBOVHD   EQU   X'08'                    MASK FOR 2 BYTE OVHD     20201  74210020
*                                       DEVS                     20201  74220020
FIVE     EQU   5                        LENGTH OF CCHHR                 74250019
CCPADR   EQU   4                        LENGTH OF COMM. CODE AND ADDR.  74300019
WREG9    EQU   9                                                        74350019
ACTADR   EQU   2                                                        74400019
IECPRLTV EQU   15                       BALR REG TO GO TO IECPRLTV      74450019
CVTPTR   EQU   16                       CVT ADDRESS                     74500019
APRLTV   EQU   32                       DISPLACEMENT OF IECPRLTV ADDR.  74550019
*                                       IN THE CVT                      74600002
CONVID   EQU   0                        TTR0 AFTER CONVERSION           74650019
TTRLN    EQU   3                                                        74700019
ACTLN    EQU   8                        LENGTH OF MBBCCHHR              74750019
CNTOFF   EQU   6                        OFFSET OF COUNT FIELD IN CCW    74800019
ADDSRCH  EQU   8                        OFFSET OF SEARCH RTN IN ADD MOD 74850019
LASTSEGF EQU   2                        LAST SEGMENT FLAG               74900019
ADDDONE  EQU   12                                                       74950019
CNTLN    EQU   2                                                        75000019
WDOP     EQU   5                        WRITE DATA CHANNEL COMMAND CODE 75050019
MIDSEG   EQU   3                        MIDDLE SEGMENT IF BITS ARE ONES 75100019
THREE    EQU   3                                                        75150019
TEN      EQU   10                       CONTROL FIELD LENGTH IN SWA     75160019
CNTLBYTE EQU   18                       CONTROL FIELD AND BCB LNGTH     75170019
DATACHAN EQU   X'80'                    DATA CHAINING IF A ONE          75200019
FLAGS    EQU   4                        OFFSET OF FLAG FIELD IN CCW     75250019
COMCHAN  EQU   X'40'                    COMMAND CHAINING IF A ONE       75300019
COMCOFF  EQU   X'BF'                    MASK TO TURN OFF COMCHAN        75350019
SWL      EQU   X'20'                    SUPPRESS WRONG LENGTH IF A 1    75400019
WKDOP    EQU   X'0D'                    WRITE-KEY-DATA COMMAND CODE     75450019
EIGHT    EQU   8                                                        75500019
READCCW  EQU   X'06'                                                    75550019
EXIT     EQU   3                        SVC NUMBER TO RETURN TO SUPERV. 75600019
CLRLNER1 EQU   X'FB'                    CLEAR LENGTH ERROR IN IOBFLAG1  75950019
CLRLNER2 EQU   X'BF'                    CLEAR LENGTH ERROR IN IOBCSW    76000019
CLRABN   EQU   X'7F'                    TURN OFF ABNORMAL COMPLETION    76050019
FLIPMSK  EQU   X'A0'                    CHANGE NO RECORD FOUND TO       76200019
*                                             NO SPACE FOUND            76210019
ALLMSK   EQU   X'FF'                    TEST FOR EXCEPTION CODES        76400019
INCLMSK  EQU   X'40'                    INCORRECT LENGTH                76450019
NRMSK    EQU   X'08'                    NO RECORD FOUND                 76500019
UCMSK    EQU   X'02'                    UNIT CHECK                      76550019
DCMSK    EQU   X'08'                    DATA CHECK                      76600019
*              EXCEPTION CODES                                          76800019
NOREC    EQU   X'80'                                                    76850019
LGNCK    EQU   X'40'                                                    76900019
UNCOR    EQU   X'08'                                                    77050019
ENDOD    EQU   X'04'                                                    77100019
UNREL    EQU   X'02'                                                    77150019
*              OPTIONS AND TYPE                                         77200019
VERIFY   EQU   X'80'                                                    77250019
OFLOW    EQU   X'40'                                                    77300019
EXSCH    EQU   X'20'                                                    77350019
ACTAD    EQU   X'08'                                                    77450019
READX    EQU   X'02'                                                    77550019
RELRD    EQU   X'01'                                                    77600019
LGNOP    EQU   X'40'                                                    77700019
READ     EQU   X'08'                                                    77750019
KEY      EQU   X'04'                                                    77800019
ADD      EQU   X'02'                                                    77850019
MODID    DC    C'IGG019KJ'              MODULE ID                Y02072 77852002
FIX      DC    C'@ZA08000'              LATEST FIX IN MODULE   @ZA08000 77854003
DATE     DC    C'&SYSDATE'              DATE OF LATEST FIX     @ZA08000 77856003
PATCH    DC    XL((*-IGG019KJ)/20)'0'   5% PATCH AREA            Y02072 77860002
         EJECT                                                          77870002
*********************************************************************** 77880002
*                       DSECTS                                          77890002
*********************************************************************** 77892002
         DCBD  DSORG=DA                                                 78050019
         EJECT                                                          78060002
         IEFUCBOB  LIST=YES                                             78062002
         EJECT                                                          78064002
         IECDRQE                                                 Y02072 78070002
         EJECT                                                          78100019
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       78150019
         DS    0F                                                       78200019
DECBDEF  DSECT                                                          78250019
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        78300019
DECTYPE  DS    CL2            TYPE FIELD                                78350019
DECLNGTH DS    CL2            DATA LENGTH                               78400019
DECDCBAD DS    CL4            ADDRESS OF DCB                            78450019
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      78500019
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        78550019
DECKYADR DS    CL4            ADDRESS OF KEY                            78600019
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               78650019
DECNA    DS    CL4            ADDRESS OF NEXT ADDRESS FEEDBACK AREA     78700019
         EJECT                                                          78750019
*                                                                       78800019
*      I/O BLOCK (IOB) DEFINITION                                       78850019
*                                                                       78900019
         IEZIOB                                                  Y02072 78950002
*                                                                       79000002
*        IOB EQUATES                                                    79050002
*                                                                       79100002
IOBUPLIM EQU   IOBRSV35                 UPPER LIMIT COUNT        Y02072 79150002
DNRCFP2  EQU   IOBDNCRF+2                                               81050002
CNTKL    EQU   IOBDNCRF+5     OFFSET OF KEY LENGTH IN COUNT             81100002
CNTDL    EQU   IOBDNCRF+6     OFFSET OF DATA LENGTH IN COUNT            81150002
IOBDIOBX EQU   42             OFFSET FOR IOBDIOS                        81250019
IOBDPLAX EQU   44             OFFSET FOR IOBDPLAD                       81300019
BASESZ   EQU   IOBCHNPR-IOBSTDRD   IOB BASE SIZE WITHOUT PREFIX         81350002
         ORG   IOBSTAT2                                          Y02072 81360002
OTHERERR EQU   BIT6                                                     81365001
         EJECT                                                          81382002
         IKJTCB                                                         81390001
         EJECT                                                          81400019
*                                                                       81450019
*      DATA EXTENT BLOCK (DEB) DEFINITION                               81500019
*                                                                       81550019
DEBDEF   DSECT                                                          81600019
         DS    0F                                                       81650019
DEBNMSUB DS    0CL1      NO. OF SUBR. LOADED BY OPEN                    81700019
DEBTCBAD DS    CL4       ADDRESS OF THE TCB FOR THIS DEB                81750019
DEBAMLNG DS    0CL1      NO. OF BYTES IN THE ACCESS MTHD. DPDT. SECTION 81800019
DEBDEBAB DS    CL4       ADDRESS OF THE PREVIOUS DEB IN THE SAME TASK   81850019
DEBOFLGS DS    0CL1      DATA SET STATUS FLAGS                          81900019
DEBIRBAD DS    CL4       IRB ADDRESS                                    81950019
DEBOPATB DS    0CL1      TYPE OF FILES                                  82000019
DEBSYSPG DS    CL4       ADDRESS OF FIRST IOB IN THE SYSTEM PURGE CHAIN 82050019
DEBNMEXT DS    0CL1      NUMBER OF EXTENTS SPECIFIED IN THE DSCB        82100019
DEBUSRPG DS    CL4       ADDRESS OF FIRST IOB IN THE USER PURGE CHAIN   82150019
DEBPRIOR DS    0CL1      ALWAYS ZERO                                    82200019
DEBECBAD DS    CL4       ECB ADDRESS FOR SVC PURGE REQUEST              82250019
DEBPROTG DS    0CL1      RESERVED FOR FUTURE USE (FIRST 4 BITS)         82300019
DEBDEBID DS    0CL1      HEX 'F' TO IDENTIFY THIS BLOCK AS A DEB        82350019
DEBDCBAD DS    CL4       ADDRESS OF THE DCB ASSOCIATED WITH THIS DEB    82400019
DEBEXSCL DS    0CL1      EXTENT SCALE                                   82450019
DEBAPPAD DS    CL4       ADDRESS OF I/O APPENDAGE VECTOR TABLE          82500019
DEBDVMOD DS    0CL1      DEVICE MODIFIER FILE MASK                      82550019
DEBUCBAD DS    CL4       ADDR OF UCB ASSOCIATED WITH THIS DATA EXTENT   82600019
DEBBINUM DS    CL2       RESERVED FOR FUTURE USE-ALWAYS ZERO            82650019
DEBSTRCC DS    CL2       STARTING CYLINDER NUMBER FOR EXTENT            82700019
DEBSTRHH DS    CL2       STARTING HEAD NUMBER FOR EXTENT                82750019
DEBENDCC DS    CL2       ENDING CYLINDER NUMBER FOR EXTENT              82800019
DEBENDHH DS    CL2       ENDING HEAD NUMBER FOR EXTENT                  82850019
DEBNMTRK DS    CL2       NUMBER OF TRACKS ALLOCATED TO A GIVEN EXTENT   82900019
DEBSUBID EQU   0         SUBROUTINE ID'S                                82950019
         EJECT                                                          83000019
*   THE FOLLOWING DSECT SHOWS THE FORMAT OF THE SEGMENT WORK AREA       83050019
*                                                                       83100019
SWA      DSECT                          SEGMENT WORK AREA DSECT         83150019
SWANXTPT DS    F                        POINTER TO NEXT SWA             83200019
SWARAPT  DS    F                        POINTER TO THE RECORD AREA      83250019
SWABFINC DS    CL2                      BUFFER INCREMENT FIELD          83300019
SWABDW   DS    CL4                      BLOCK DESCRIPTOR WORD           83350019
SAVEID   EQU   SWABDW+5                 SAVE AREA FOR ID OF LAST SEGMNT 83400019
SWASDW   DS    0CL4                     SEGMENT DESCRIPTOR WORD         83450019
SEGLL    DS    H                        SEGMENT LENGTH (LL)             83500019
SEGFLGS  DS    C                        SEGMENTATION FLAGS              83550019
SEGUNUSD DS    C                        CURRENTLY UNUSED                83600019
SEGDATA  DS    C                        DATA PORTION OF RECORD          83650019
         EJECT                                                          83700019
*********************************************************************** 83750019
*                                                                     * 83800019
*                                                                     * 83850019
*                       CHANNEL PROGRAM DSECTS                        * 83900019
*                                                                     * 83950019
*                                                                     * 84000019
*********************************************************************** 84050019
         SPACE 10                                                       84100019
*                                                                       84150019
*   ORIGINAL CHANNEL PROGRAM TO WRITE (ADD) A NEW VRE RECORD            84200019
*                                                                       84250019
WRITEADD DSECT                                                          84300019
WANOP1   DS    D                  CCW1  NOP                             84350019
WASIE1   DS    D                  CCW2  SEARCH ID EQUAL (R0)            84400019
WATIC1   DS    D                  CCW3  TIC TO CCW2                     84450019
WARD     DS    D                  CCW4  READ DATA (R0)                  84500019
WANOP2   DS    D                  CCW5  NOP                             84550019
WASIE2   DS    D                  CCW6  SEARCH ID EQUAL (R0)            84600019
WATIC2   DS    D                  CCW7  TIC TO CCW6                     84650019
WAWDR0   DS    D                  CCW8  UPDATE CAPACITY RECORD          84700019
WASIE3   DS    D                  CCW9  SEARCH ID EQUAL                 84750019
WATIC3   DS    D                  CCW10 TIC TO CCW9                     84800019
WAWCKD1  DS    D                  CCW11 WRITE COUNT                     84850019
* THE NEXT CCW'S MAY BE PRESENT ONLY IF KEYS ARE TO BE WRITTEN.         84900019
WAKWK    DS    D                  CCW12 WRITE KEY                       84950019
WAKWD    DS    D                  CCW13 WRITE DATA                      85000019
WAKNOP1  DS    D               ** CCW14 NOP                             85050019
WAKNOP2  DS    D               ** CCW15 NOP                             85100019
WAKSIE   DS    D               ** CCW16 SEARCH ID EQUAL                 85150019
WAKTIC   DS    D               ** CCW17 TIC TO CCW16                    85200019
WAKRKD   DS    D               ** CCW18 READ-KEY-DATA TO DO WRITE CHECK 85250019
WAKRR0   DS    D               ** CCW19 WRITE CHECK R0                  85300019
* IF KEYS ARE NOT TO BE WRITTEN, THE FOLLOWING CCW'S ARE USED           85350019
WANK     EQU   WAKWK-WRITEADD                                           85400019
         ORG   WRITEADD+WANK      ORG BACK TO CCW12                     85450019
WANKWD   DS    D                  CCW12 WRITE DATA                      85500019
WANKNOP1 DS    D               ** CCW13 NOP                             85550019
WANKNOP2 DS    D               ** CCW14 NOP                             85600019
WANKSIE  DS    D               ** CCW15 SEARCH ID EQUAL                 85650019
WANKTIC  DS    D               ** CCW16 TIC TO CCW15                    85700019
WANKRKD  DS    D               ** CCW17 READ-KEY-DATA TO DO WRITE CHECK 85750019
WANKRR0  DS    D               ** CCW18 WRITE CHECK R0                  85800019
*                                                                       85850019
*                              ** THESE CCW'S ARE INCLUDED ONLY IF      85900019
*                                 WRITE CHECK IS REQUESTED.             85950019
         SPACE 3                                                        86000019
*                                                                       86050019
*   CHANNEL PROGRAM FOR WRITE ADD AFTER WRITING THE FIRST SEGMENT       86100019
*                                                                       86150019
WRITADD1 DSECT                                                          86200019
WA1NOP1  DS    D                  CCW1  NOP                             86250019
WA1SIE   DS    D                  CCW2  SEARCH ID EQUAL (R0)            86300019
WA1TIC   DS    D                  CCW3  TIC TO CCW2                     86350019
WA1WC    DS    D                  CCW4  WRITE COUNT                     86400019
WA1WD    DS    D                  CCW5  WRITE DATA                      86450019
WA1SIE2  DS    D                  CCW6  SEARCH ID EQUAL (R0)            86500019
WA1TIC2  DS    D                  CCW7  TIC TO CCW6                     86550019
WA1WCR   DS    D                  CCW8  UPDATE CAPACITY RECORD          86600019
WA1NOP2  DS    D               ** CCW9  NOP                             86650019
WA1RR0   DS    D               ** CCW10 READ R0 FOR WRITE CHECK         86700019
WA1RD    DS    D               ** CCW11 READ DATA FOR WRITE CHECK       86750019
*                                                                       86800019
*                              ** THESE CCW'S ARE INCLUDED WHEN WRITE   86850019
*                                 CHECK IS REQUESTED.                   86900019
         SPACE 6                                                        86950019
*                                                                       87000019
*   ORIGINAL CHANNEL PROGRAM TO READ BY BLOCK KEY USING EXTENDED SEARCH 87050019
*                                                                       87100019
READES0  DSECT                                                          87150019
RENOP1   DS    D                  CCW1  NOP                             87200019
RESIE    DS    D                  CCW2  SEARCH ID EQUAL (R0)            87250019
RETIC1   DS    D                  CCW3  TIC TO CCW2                     87300019
REMTSIE  DS    D                  CCW4  MULTI-TRACK SEARCH ID EQUAL     87350019
RETIC2   DS    D                  CCW5  TIC TO CCW7                     87400019
RENOP2   DS    D                  CCW6  NOP                             87450019
RESKE1   DS    D                  CCW7  SEARCH KEY EQUAL                87500019
RETIC3   DS    D                  CCW8  TIC TO CCW4                     87550019
RENOP3   DS    D                  CCW9  NOP                             87600019
RENOP4   DS    D                  CCW10 NOP                             87650019
RERHA    DS    D                  CCW11 READ HOME ADDRESS               87700019
RENOP5   DS    D                  CCW12 NOP                             87750019
RERDCNT  DS    D                  CCW13 READ COUNT                      87800019
RESKE2   DS    D                  CCW14 SEARCH KEY EQUAL                87850019
RETIC4   DS    D                  CCW15 TIC TO CCW13                    87900019
RERD     DS    D                  CCW16 READ DATA                       87950019
         SPACE 3                                                        88000019
*                                                                       88050019
*  CHANNEL PROGRAM TO READ BY BLOCK KEY USING EXTENDED SEARCH AFTER     88100019
*  READING THE FIRST SEGMENT.                                           88150019
*                                                                       88200019
READES1  DSECT                                                          88250019
RE1NOP1  DS    D                  CCW1  NOP                             88300019
RE1SIDE  DS    D                  CCW2  SEARCH ID EQUAL                 88350019
RE1TIC   DS    D                  CCW3  TIC TO CCW2                     88400019
RE1RD    DS    D                  CCW4  READ DATA                       88450019
RE1NOP2  DS    D                  CCW5  NOP. THIS CCW IS PRESENT ONLY   88500019
*                                       WHEN THE NEXT ADDRESS IS BEING  88550019
*                                       DETERMINED.                     88600019
         SPACE 6                                                        88650019
*                                                                       88700019
*   ORIGINAL CHANNEL PROGRAM TO WRITE BY BLOCK KEY USING EXTENDED       88750019
*   SEARCH.                                                             88800019
*                                                                       88850019
WRITEES0 DSECT                                                          88900019
WENOP1   DS    D                  CCW1  NOP                             88950019
WESIE1   DS    D                  CCW2  SEARCH ID EQUAL (R0)            89000019
WETIC1   DS    D                  CCW3  TIC TO CCW2                     89050019
WEMTSIE  DS    D                  CCW4  MULTI-TRACK SEARCH ID EQUAL     89100019
WETIC2   DS    D                  CCW5  TIC TO CCW7                     89150019
WENOP2   DS    D                  CCW6  NOP                             89200019
WESKE1   DS    D                  CCW7  SEARCH KEY EQUAL                89250019
WETIC3   DS    D                  CCW8  TIC TO CCW4                     89300019
WENOP3   DS    D                  CCW9  NOP                             89350019
WENOP3A  DS    D                  CCW10 NOP                             89400019
WERHA    DS    D                  CCW11 READ HOME ADDRESS               89450019
WENOP3B  DS    D                  CCW12 NOP                             89500019
WERC     DS    D                  CCW13 READ COUNT                      89550019
WESKE2   DS    D                  CCW14 SEARCH KEY EQUAL                89600019
WETIC4   DS    D                  CCW15 TIC TO CCW13                    89650019
WERD1    DS    D                  CCW16 READ DATA TO GET SEGMENT LENGTH 89700019
WENOP4   DS    D               ** CCW17 NOP                             89750019
WESIE2   DS    D               ** CCW18 SEARCH ID EQUAL                 89800019
WETIC5   DS    D               ** CCW19 TIC TO CCW18                    89850019
WERD2    DS    D               ** CCW20 READ DATA TO DO WRITE CHECK     89900019
*                                                                       89950019
*                              ** INDICATES THAT THE CCW'S ARE PRESENT  90000019
*                                 ONLY IF WRITE CHECK IS REQUESTED.     90050019
*                                                                       90100019
         SPACE 3                                                        90150019
*                                                                       90200019
*  CHANNEL PROGRAM AFTER DETERMINING THE LENGTH OF THE FIRST SEGMENT.   90250019
*                                                                       90300019
WRITEES1 DSECT                                                          90350019
WE1NOP1  DS    D                  CCW1  NOP                             90400019
WE1SIE1  DS    D                  CCW2  SEARCH ID EQUAL                 90450019
WE1TIC1  DS    D                  CCW3  TIC TO CCW2                     90500019
WE1TIC2  DS    D                  CCW4  TIC TO CCW16                    90550019
WENTUSED DS    11D                CCW5-CCW15 ARE BYPASSED BY THE TIC IN 90600019
*                                       CCW4.                           90650019
WEWD     DS    D                  CCW16 WRITE DATA                      90700019
WE1WC    DS    D                  CCW17-CCW20 SAME AS BEFORE            90750019
         SPACE 6                                                        90800019
*                                                                       90850019
*   ORIGINAL CHANNEL PROGRAM FOR READ TYPE = DI  WHEN THE NEXT ADDRESS  90900019
*   IS REQUESTED.                                                       90950019
*                                                                       91000019
READDI0N DSECT                                                          91050019
RDINANOP DS    D                  CCW1  NOP                             91100019
RDINASI1 DS    D                  CCW2  SEARCH ID EQUAL (R0)            91150019
RDINAT1  DS    D                  CCW3  TIC TO CCW2                     91200019
RDINARD  DS    D                  CCW4  READ DATA (R0)                  91250019
RDINASI2 DS    D                  CCW5  SEARCH ID EQUAL                 91300019
RDINAT2  DS    D                  CCW6  TIC TO CCW5                     91350019
* THE NEXT CCW IS INCLUDED ONLY IF KEYS ARE TO BE READ                  91400019
RDINARK  DS    D                  CCW7  READ KEY                        91450019
RDINADK  DS    D                  CCW8  READ DATA                       91500019
RDINANK  EQU   RDINARK-READDI0N                                         91550019
         ORG   READDI0N+RDINANK         POSITION FOR NO KEYS            91600019
* THE FOLLOWING CCW IS PRESENT IF KEYS ARE NOT TO BE READ               91650019
RDINAD   DS    D                  CCW7  READ DATA                       91700019
         SPACE 3                                                        91750019
*                                                                       91800019
*   CHANNEL PROGRAM FOR READ TYPE = DI  WHEN THE NEXT ADDRESS IS        91850019
*   REQUESTED AND AFTER READING THE FIRST SEGMENT.                      91900019
*                                                                       91950019
READDI1N DSECT                                                          92000019
RDINAN1  DS    D                  CCW1  NOP                             92050019
RDINASI5 DS    5D                 CCW2-CCW6 ARE THE SAME AS BEFORE      92100019
RDINARD1 DS    D                  CCW7  READ DATA                       92150019
         SPACE 6                                                        92200019
*                                                                       92250019
*   ORIGINAL CHANNEL PROGRAM FOR READ TYPE = DI AND THE NEXT ADDRESS    92300019
*   IS NOT REQUESTED.                                                   92350019
*                                                                       92400019
READDI0  DSECT                                                          92450019
RDISIE   DS    D                  CCW1  SEARCH ID EQUAL                 92500019
RDITIC   DS    D                  CCW2  TIC TO CCW1                     92550019
* THE FOLLOWING CCW IS INCLUDED ONLY IF KEYS ARE TO BE READ             92600019
RDIRK    DS    D                  CCW3  READ KEY                        92650019
RDIRD    DS    D                  CCW4  READ DATA                       92700019
RDINK    EQU   RDIRK-READDI0                                            92750019
         ORG   READDI0+RDINK            POSITION FOR NO KEYS            92800019
RDIRDNK  DS    D                  CCW3  READ DATA                       92850019
         SPACE 3                                                        92900019
*                                                                       92950019
*  CHANNEL PROGRAM FOR READ TYPE = DI AFTER READING THE FIRST SEGMENT   93000019
*  (NEXT ADDRESS IS NOT REQUESTED).                                     93050019
*                                                                       93100019
READDI1  DSECT                                                          93150019
RDISIE1  DS    D                  CCW1  SEARCH ID EQUAL                 93200019
RDITIC1  DS    D                  CCW2  TIC TO CCW1                     93250019
RDIRD1   DS    D                  CCW3  READ DATA                       93300019
         SPACE 6                                                        93350019
*                                                                       93400019
*   ORIGINAL CHANNEL PROGRAM FOR WRITE TYPE = DI                        93450019
*                                                                       93500019
WRITEDI0 DSECT                                                          93550019
WDINOP1  DS    D                  CCW1  NOP                             93600019
WDISIE   DS    D                  CCW2  SEARCH ID EQUAL                 93650019
WDITICL  DS    D                  CCW3  TIC TO CCW2                     93700019
WDIRDD   DS    D                  CCW4  READ DATA TO GET SEG LENGTH     93750019
* THE FOLLOWING 6 CCW'S MAY BE PRESENT ONLY IF KEYS ARE TO BE WRITTEN   93800019
WDIWDK   DS    D                  CCW5  WRITE DATA                      93850019
WDINOP2K DS    D               ** CCW6  NOP                             93900019
WDINOP3K DS    D               ** CCW7  NOP                             93950019
WDISIE2K DS    D               ** CCW8  SEARCH ID EQUAL                 94000019
WDITIC2K DS    D               ** CCW9  TIC TO CCW8                     94050019
WDIRKDK  DS    D               ** CCW10 READ KEY DATA TO DO WRITE CHECK 94100019
WDINK    EQU   WDIWDK-WRITEDI0                                          94150019
* THE FOLLOWING 5 CCW'S MAY BE PRESENT IF KEYS ARE NOT TO BE WRITTEN    94200019
         ORG   WRITEDI0+WDINK           ORG BACK TO WRITE DATA CCW      94250019
WDINOP2  DS    D               ** CCW5  NOP                             94300019
WDINOP3  DS    D               ** CCW6  NOP                             94350019
WDISIE2  DS    D               ** CCW7  SEARCH ID EQUAL                 94400019
WDITIC2  DS    D               ** CCW8  TIC TO CCW7                     94450019
WDIRKD   DS    D               ** CCW9  READ KEY DATA TO DO WRITE CHECK 94500019
*                                                                       94550019
*                              ** INDICATES THAT THESE CCW'S ARE        94600019
*                                 PRESENT ONLY FOR WRITE CHECK OPTION   94650019
*                                                                       94700019
         SPACE 3                                                        94750019
*                                                                       94800019
*   CHANNEL PROGRAM FOR WRITE TYPE = DI AFTER DETERMINING THE           94850019
*   LENGTH OF THE FIRST SEGMENT                                         94900019
*                                                                       94950019
WRITEDI1 DSECT                                                          95000019
WDI1NOP1 DS    D                  CCW1  NOP                             95050019
WDI1SIE  DS    D                  CCW2  SEARCH ID EQUAL                 95100019
WDI1TIC1 DS    D                  CCW3  TIC TO CCW2                     95150019
* THE FOLLOWING 7 CCW'S MAY BE PRESENT IF KEYS ARE TO BE WRITTEN        95200019
WDI1WKD  DS    D                  CCW4  WRITE KEY                       95250019
WDI1WDK  DS    D                  CCW5  WRITE DATA                      95300019
WDI1WCK  DS    5D                 CCW6-CCW10 ARE THE SAME AS BEFORE FOR 95350019
*                                       WRITE CHECK.                    95400019
WDINK1   EQU   WDI1WKD-WRITEDI1                                         95450019
* THE FOLLOWING 6 CCW'S MAY BE PRESENT IF KEYS ARE NOT TO BE WRITTEN    95500019
         ORG   WRITEDI1+WDINK1    ORG BACK TO CCW4                      95550019
WDI1WD   DS    D                  CCW4  WRITE DATA                      95600019
WDI1WC   DS    5D                 CCW5-CCW9 ARE THE SAME AS BEFORE FOR  95650019
*                                       WRITE CHECK                     95700019
         SPACE 6                                                        95750019
*                                                                       95800019
*   ORIGINAL CHANNEL PROGRAM FOR READ TYPE = DK                         95850019
*                                                                       95900019
READDK0  DSECT                                                          95950019
RDKRDCNT DS    D                  CCW1  READ COUNT INTO IOBDNRCF+2      96000019
RDKSKE   DS    D                  CCW2  SEARCH KEY EQUAL                96050019
RDKTIC1  DS    D                  CCW3  TIC TO CCW1                     96100019
RDKRDD   DS    D                  CCW4  READ DATA                       96150019
RDKNOP1  DS    D               ** CCW5  NOP                             96200019
RDKSIE   DS    D               ** CCW6  SEARCH ID EQUAL (R0)            96250019
RDKTIC2  DS    D               ** CCW7  TIC TO CCW6                     96300019
RDKRDD2  DS    D               ** CCW8  READ DATA (R0)                  96350019
RDKNOP2  DS    D               ** CCW9  NOP                             96400019
*                                                                       96450019
*                              ** THESE CCW'S ARE INCLUDED ONLY IF THE  96500019
*                                 NEXT ADDRESS IS REQUESTED.            96550019
         SPACE 3                                                        96650019
*                                                                       96700019
*   CHANNEL PROGRAM FOR READ TYPE = DK AFTER BEING MODIFIED             96750019
*                                                                       96800019
READDK1  DSECT                                                          96850019
RDK1NOP1 DS    D                  CCW1  NOP                             96900019
RDK1SIE1 DS    D                  CCW2  SEARCH ID EQUAL (ID=1)          96950019
RDK1TIC1 DS    D                  CCW3  TIC TO CCW2                     97000019
RDK1RDD1 DS    D                  CCW4  READ DATA                       97050019
RDK1NOP2 DS    D               ** CCW5  NOP                             97100019
RDK1SIE2 DS    D               ** CCW6  SEARCH ID EQUAL (R0)            97150019
RDK1TIC2 DS    D               ** CCW7  TIC TO CCW6                     97200019
RDK1RDD2 DS    D               ** CCW8  READ DATA (R0)                  97250019
RDK1NOP3 DS    D               ** CCW9  NOP                             97300019
*                                                                       97350019
*                              ** THESE CCW'S ARE INCLUDED ONLY IF THE  97400019
*                                 NEXT ADDRESS IS REQUESTED.            97450019
*                                                                       97500019
         SPACE 6                                                        97550019
*                                                                       97600019
*   ORIGINAL CHANNEL PROGRAM FOR WRITE TYPE = DK                        97650019
*                                                                       97700019
WRITEDK0 DSECT                                                          97750019
WDKRDCNT DS    D                  CCW1  READ COUNT INTO IOBDNRCF+2      97800019
WDKSKE   DS    D                  CCW2  SEARCH KEY EQUAL                97850019
WDKTIC1  DS    D                  CCW3  TIC TO CCW1                     97900019
WDKRDD   DS    D                  CCW4  READ DATA TO GET SEG LENGTH     97950019
WDKNOP1  DS    D                  CCW5  NOP                             98000019
WDKWCSIE DS    D               ** CCW6  SEARCH ID EQUAL (WRITE CHECK)   98050019
WDKWCTIC DS    D               ** CCW7  TIC TO CCW6     (WRITE CHECK)   98100019
WDKWCRDD DS    D               ** CCW8  READ DATA TO DO WRITE CHECK     98150019
*                                                                       98200019
*                              ** INDICATES THAT THESE CCW'S ARE        98250019
*                                 PRESENT ONLY FOR WRITE CHECK OPTION.  98300019
*                                                                       98350019
         SPACE 3                                                        98400019
*                                                                       98450019
*   CHANNEL PROGRAM FOR  WRITE TYPE = DK  AFTER BEING MODIFIED          98500019
*                                                                       98550019
WRITEDK1 DSECT                                                          98600019
WDK1NOP1 DS    D                  CCW1  NOP                             98650019
WDK1SIE  DS    D                  CCW2  SEARCH ID EQUAL                 98700019
WDK1TIC1 DS    D                  CCW3  TIC TO CCW2                     98750019
WDK1WD   DS    D                  CCW4  WRITE DATA                      98800019
WDK1NOP2 DS    D               ** CCW5  NOP                             98850019
WDK1WCSI DS    D               ** CCW6  SEARCH ID EQUAL (WRITE CHECK)   98900019
WDK1WCT  DS    D               ** CCW7  TIC TO CCW6     (WRITE CHECK)   98950019
WDK1WCRD DS    D               ** CCW8  READ DATA TO DO WRITE CHECK     99000019
*                                                                       99050019
*                              ** INDICATES THAT THESE CCW'S ARE        99100019
*                                 PRESENT ONLY FOR WRITE CHECK OPTION.  99150019
*                                                                       99200019
         END                                                            99250019
./  ADD  SSI=33240519,NAME=IGG019KK
 TITLE   'IGG019KK - CONSTRUCTS CHANNEL PROGRAMS BY ID'                 00022002
IGG019KK CSECT                                                          00024002
*MODULE NAME - IGG019KK                                               * 00024402
*                                                                     * 00024802
*DESCRIPTIVE NAME - BUILDS BDAM CHANNEL PROGRAMS THAT SEARCH ON ID    * 00024902
*                                                                     * 00026602
*COPYRIGHT - NONE                                                     * 00028602
*                                                                     * 00029002
*CHANGE ACTIVITY                                                      * 00029402
*                                                                     * 00030002
*        OS 20 CHANGES/DELETIONS                                        00050002
*                                                                S20201 00055020
*        OS 21 CHANGES/DELETIONS                                        00057002
*                                                               SA52385 00067002
*        VS1-1 CHANGES/DELETIONS                                        00069002
*        VS2-1 CHANGES/DELETIONS                                        00071002
*        VS1-2 CHANGES/DELETIONS                                        00073002
*                                                                XM1024 00073402
*        VS1-3 CHANGES/DELETIONS                                        00073802
* THE FIX FOR XA03120 IS FLAGGED SA66738                        XA03120 00074202
*        VS2-2 CHANGES/DELETIONS                                        00075002
*                                                                Y02072 00075402
*                                                                       00077002
*                                                                     * 00080020
*STATUS CHANGE LEVEL 002                                                00100020
*FUNCTION/OPERATION- THIS ROUTINE CONSTRUCTS A CHANNEL PROGRAM TO     * 00120020
*   PERFORM A READ OR WRITE BY ID (USES BLOCK ID AS THE SEARCH        * 00140020
*   ARGUMENT).                                                        * 00160020
*   THE CCWS ARE CONSTRUCTED OF CONSTANTS DEFINED IN THIS MODULE AND  * 00180020
*   ADDRESSES RESOLVED AT THE TIME THIS CODE IS EXECUTED.             * 00200020
*                                                                     * 00220020
*ENTRY POINT- ENTRY IS TO 'IGG019KK' (BEGIN) FROM MODULE IGG019KA BY  * 00240020
*   THE CALLING SEQUENCE,   L    15,DCBDID                            * 00260020
*                           BALR 14,15                                * 00280020
*                                                                     * 00300020
*INPUT- THE REGISTERS ARE INPUT AS FOLLOWS,                           * 00320020
*   4 - DCB ADDRESS                                                   * 00340020
*   5 - DECB ADDRESS                                                  * 00360020
*   6 - THE ADDRESS OF CCW 1 (CHANNEL PROGRAM START)                  * 00380020
*   7 - IOB ADDRESS                                                   * 00400020
*   11- BASE ADDRESS OF MODULE IGG019KA (FOUNDATION MODULE)           * 00420020
*                                                                     * 00440020
*OUTPUT- THE REQUIRED CCWS WILL BE CONSTRUCTED FOLLOWING THE IOB.     * 00460020
*   REGISTER 6 WILL CONTAIN THE ADDRESS OF THE LAST CCW.              * 00480020
*                                                                     * 00500020
*EXTERNAL ROUTINE- 'IGG019KQ' IS ENTERED TO CONSTRUCT THE VERIFY CCWS * 00520020
*   IF THE REQUEST IS A WRITE AND THE WRITE VALIDITY CHECK OPTION HAS * 00540020
*   BEEN SPECIFIED.                                                   * 00560020
*                                                                     * 00580020
*EXITS-NORMAL- 'D6TOVER' IS THE EXIT TO IGG019KQ IF NECESSARY. THE    * 00600020
*   REGISTERS WILL BE LOADED AS REQUIRED BY IGG019KQ.                 * 00620020
*   'D6EXIT' IS THE RETURN TO THE FOUNDATION MODULE, IGG019KA.        * 00640020
*                                                                     * 00660020
*TABLES/WORK AREAS- N/A                                               * 00680020
*                                                                     * 00700020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.          * 00720020
*                                                                     * 00740020
*NOTE- REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT WITH THE  * 00760020
*   MODULES, IGG019KA, IGG019KQ.                                      * 00780020
         EJECT                                                          00800020
         USING IGG019KK,D6EPREG                                         00820020
         USING IHADCB,DCBREG                                            00840020
         USING DECB,DECBREG                                      Y02072 00860002
         USING IOBDEF,IOBREG                                            00880020
*                                                                       00900020
*                                                                       00920020
*                                                                       00940020
*  REGISTER USAGE                                                       00960020
*                                                                       00980020
D6WKREG  EQU   0         WORK REGISTER                                  01000020
D6VERR   EQU   1         POINTER TO A SEARCH CCW FOR VERIFY             01020020
SECTOR   EQU   2                        PNTR TO RPS SECTOR AREA  20201  01022020
C1       EQU   1                        GENERAL CONST 1          20201  01024020
ONEBYTE  EQU   8                        8 BITS = ONE BYTE        20201  01026020
IEC0SCR1 EQU   232                      SECTOR CONVERT RTN       20201  01028020
*                                       OFFSET                   20201  01030020
CVTPTR   EQU   16                       ADDRESS OF CVT           20201  01032020
PAR0     EQU   0                        PARAMETER REG            20201  01034020
PAR2     EQU   2                        PARAMETER REG            20201  01036020
UTIL     EQU   8                        UTILITY/ WORK REG        20201  01038020
DEBREG   EQU   3         DEB ADDRESS                                    01040020
DCBREG   EQU   4         DCB ADDRESS                                    01060020
DECBREG  EQU   5         DECB ADDRESS                                   01080020
CCWIND   EQU   6         CHANNEL COMMAND INDEX                          01100020
IOBREG   EQU   7         IOB ADDRESS                                    01120020
VERBASE  EQU   10        BASE FOR VERIFY MODULE                         01140020
FDNBASE  EQU   11        BASE FOR THE FOUNDATION MODULE                 01160020
D6       EQU   12        RETURN FROM INTERNAL BAL                       01180020
RETREG   EQU   14        RETURN TO FOUNDATION MODULE                    01200020
D6EPREG  EQU   15        BASE OF THIS MODULE                            01220020
*                                                                       01240020
*                                                                       01260020
         TM    IOBDCPND,YESCARN         IS RPS FEATURED          20201  01260402
         BNO   BEGIN                    NO, THEN BEGIN STANDARD  20201  01260820
*                                       CCWS                     20201  01261220
         L     SECTOR,IOBDCPND          GET SECTOR ADDR IF RPS   20201  01261602
         LA    SECTOR,ONE(SECTOR)       POINT TO SECTOR1         20201  01262020
         TM    DCBRECFM,DCBRECV         IS F FORMAT REQUESTED    20201  01262402
         BO    BEGIN                    NO, THEN BEGIN STANDARD  20201  01262820
*                                       CCWS                     20201  01263220
*                                                                       01263620
         TM    DCBRECFM,DCBRECTO        IF OVERFLOW OPTION       Y02072 01264002
*                                       SPECIFIED                20201  01264420
         BNO   NOTOVFLO                 BR IF NOT TRK OVERFLO   SA52385 01264502
         MVI   0(SECTOR),NOPSS          MV FF TO SECTOR AS NOP  SA52385 01264602
         B     GOCARN                   FORGET SECTOR CONVERT   SA52385 01264702
NOTOVFLO EQU   *                                                SA52385 01265602
         LH    PAR0,DCBBLKSI            GET RECORD LENGTH       SA66738 01268002
         SLL   PAR0,ONEBYTE             MAKE ROOM FOR KEY LENGTH 20201  01272102
         IC    PAR0,DCBKEYLE            GET KEY LENGTH           20201  01273002
         SLL   PAR0,ONEBYTE             MAKE ROOM FOR RECORD     20201  01273902
*                                       NUMBER                   20201  01274802
         IC    PAR0,IOBSEEK+D7          GET RECORD NUMBER        20201  01275702
*                                                                       01276602
         SR    D6VERR,D6VERR           ZERO OUT A REGISTER       20201  01277502
         IC    D6VERR,IOBSEEK          GET THE EXTENT NUMBER     20201  01278402
         SLL   D6VERR,FOUR             MULTIPLY BY 16            20201  01279302
         L     D6VERR,UCBADDR(D6VERR,DEBREG)  GET THE UCB ADDR   20201  01280202
         IC    D6VERR,UCBDEVT(D6VERR)  GET DEVICE TYPE           20201  01281102
         SLL   D6VERR,D24              PUT IT IN HI ORDER BYTE   20201  01282002
         OR    PAR2,D6VERR              PUT DEVICE TYPE IN PAR2  20201  01282902
*                                                                       01283802
         L     D6VERR,CVTPTR            GET CVT                  20201  01284702
         L     D6EPREG,IEC0SCR1(D6VERR) GET SECTOR CONVERT RTN   20201  01285602
         LR    UTIL,RETREG              SAVE FOUNDATION RETURN   20201  01286502
*                                       REG                      20201  01287402
         LR    D6VERR,FDNBASE           SAVE FOUNDATION BASE     20201  01288302
         BALR  RETREG,D6EPREG           OBTAIN SECTOR VALUE      20201  01289202
         LR    FDNBASE,D6VERR           RESTORE FOUNDATION BASE  20201  01290102
         LR    RETREG,UTIL              RESTORE RETURN REG       20201  01291002
         L     D6EPREG,D28(FDNBASE)     RELOAD BASE REG          20201  01291902
GOCARN   EQU   *                                                 20201  01292802
         ST    SECTOR,D0(D6WKREG,CCWIND) PUT IN ADDR AND SET     20201  01293702
         MVI   D0(CCWIND),SETSECT        SECT COMMAND            20201  01294602
         MVC   HALFCCW(HALFCCW,CCWIND),FLGCNT  PUT IN FLAG/COUNT 20201  01295502
*                                       FIELD                    20201  01296402
         LA    CCWIND,ONECCW(0,CCWIND)  UPDATE PT TO NEXT CCW    20201  01297302
*                                                                       01298202
BEGIN    LR    D6VERR,CCWIND           SAVE THE ADDRESS OF SEARCH CCW.  01299102
         MVC   IOBDNRCF+2(5),IOBSEEK+3 POSITION FEEDBACK TO COMMON LOC. 01300020
         LA    D6WKREG,IOBSEEK+3        DEVELOP SEARCH ARGUMENT ADDRESS 01320020
         ST    D6WKREG,0(CCWIND)           AND STORE IN CCW1 .          01340020
         ST    CCWIND,8(CCWIND)          STORE TIC ADDRESS              01360020
         MVI   0(CCWIND),D6SCHID         MOVE OP CODE TO CCW1           01380020
         MVC   4(5,CCWIND),D6CON1        MOVE FLAGS,COUNT,TIC OP CODE   01400020
         LA    CCWIND,16(CCWIND)         INCREMENT INDEX TO THIRD CCW   01420020
         MVC   0(2,CCWIND),D6CON2        MOVE 2 READ OP CODES TO CCW3   01440020
         TM    IOBDTYPE+1,READ         IF THIS IS A WRITE ,             01460020
         BC    1,D6TSTK                    REPLACE THE READ             01480020
         MVC   0(2,CCWIND),D6CON3           OP CODES WITH WRITE OP CODE 01500020
D6TSTK   CLI   DCBKEYLE,0              TEST FOR KEYED RECORDS           01520020
         BC    8,D6NOKEY                  IF NOT, OVERLAY THE READ OR   01540020
         L     D6WKREG,DECKYADR            WRITE KEY-DATA OP CODE       01560020
         LTR   D6WKREG,D6WKREG              WITH                        01580020
         BC    7,D6KEY                       THE                        01600020
         TM    IOBDTYPE+1,KEYOP               READ OR WRITE DATA        01620020
         BC    1,D6KEY                         OP CODE                  01640020
D6NOKEY  MVC   0(1,CCWIND),1(CCWIND)            STORED AT CCW3+1        01660020
         BC    15,D6DATA                         AND OMIT KEY-DATA CCW  01680020
D6KEY    MVC   7(1,CCWIND),DCBKEYLE    MOVE KEY LENGTH AS COUNT         01700020
         MVC   8(1,CCWIND),1(CCWIND)    MOVE STORED OP-CODE TO CCW4     01720020
         MVI   4(CCWIND),D6DCCHN         SET DATA, COMMAND CHAIN FLAGS  01740020
         MVC   1(3,CCWIND),DECKYADR+1    MOVE KEY ADDR. FROM DECB       01760020
         LA    CCWIND,8(CCWIND)          INCREMENT INDEX TO CCW4        01780020
D6DATA   MVC   1(3,CCWIND),DECAREA+1     MOVE AREA ADDR. FROM DECB      01800020
         MVC   6(2,CCWIND),DECLNGTH    MOVE DATA LENGTH AS COUNT.       01820020
         TM    IOBDTYPE+1,READ         IF THIS IS A READ, THE CHANNEL   01840020
         BCR   1,RETREG                   PROGRAM IS COMPLETE           01860020
         TM    IOBDTYPE,VERIFY         IS THE VERIFY OPTION SPECIFIED   01880020
         BCR   8,RETREG                IF NOT CHANNEL PROG. IS COMPLETE 01900020
*                                                                       01901020
         TM    IOBDCPND,YESCARN        IS RPS FEATURED           20201  01902020
         BNO   SKIPCARN                NO, THEN SKIP RPS COMMAND 20201  01903020
         TM    DCBRECFM,DCBRECV        IS RECFM FIXED            Y02072 01904002
         BZ    SKIPCARN                YES, THEN TOO SKIP RPS    20201  01905020
         MVI   HALFCCW(CCWIND),CCHN     PUT IN COMMAND CHAINING  20201  01906020
         LA    CCWIND,ONECCW(0,CCWIND)  POINT TO READ SECTOR CCW 20201  01907020
         ST    SECTOR,D0(CCWIND)        PUT IN ADDR AND COMMAND  20201  01908020
         MVI   D0(CCWIND),RDSECT              CODE               20201  01909020
         MVC   HALFCCW(HALFCCW,CCWIND),NFLGCNT FILL IN           20201  01910020
*                                       FLAG/COUNT               20201  01911020
SKIPCARN EQU   *                                                 20201  01912020
         L     VERBASE,12(0,FDNBASE)    SET UP TO GO TO THE             01920020
         BR    VERBASE                 VERIFY MODULE TO CONSTRUCT CCWS  01940020
*                                      VERIFY MODULE WILL RETURN TO     01960020
*                                      FOUNDATION ON REGISTER 14        01980020
*                                                                       02000020
*********************************************************************** 02010002
*                     CONSTANTS AND EQUATES                             02012002
*********************************************************************** 02014002
D6SCHID  EQU   X'31'     SEARCH-ID-EQUAL OP-CODE                        02020020
D6DCCHN  EQU   X'C0'     DATA AND COMMAND CHAIN FLAGS                   02040020
D6CON1   DC    X'4000000508'  FLAGS COUNT TIC OP-CODE                   02060020
D6CON2   DC    X'0E'     READ KEY-DATA                                  02080020
         DC    X'06'     READ DATA                                      02100020
D6CON3   DC    X'0D'     WRITE KEY-DATA                                 02120020
         DC    X'05'     WRITE DATA                                     02140020
*                                                                       02160020
*     BDAM OPTIONS AND TYPES                                            02180020
VERIFY   EQU   X'80'                                                    02200020
OFLOW    EQU   X'40'                                                    02220020
EXSCH    EQU   X'20'                                                    02240020
FEEDB    EQU   X'10'                                                    02260020
ACTAD    EQU   X'08'                                                    02280020
DYNBF    EQU   X'04'                                                    02300020
READX    EQU   X'02'                                                    02320020
RELRD    EQU   X'01'                                                    02340020
KEYOP    EQU   X'80'                                                    02360020
LGNOP    EQU   X'40'                                                    02380020
READ     EQU   X'08'                                                    02400020
KEY      EQU   X'04'                                                    02420020
ADD      EQU   X'02'                                                    02440020
*                                                                       02440620
*    RPS CONSTANTS AND EQUATES                                          02441220
*                                                                       02441820
FLGCNT   DC    X'40000001'              FLAG/COUNT FIELD         20201  02442420
NFLGCNT  DC    X'00000001'              FLAG/COUNT - NO CHAIN    20201  02443020
*                                       COMMAND                  20201  02443620
*                                                                       02444220
D0       EQU   0                        ZERO DISPLACEMENT        20201  02444820
ONE      EQU   1                        FOR INCREMENTING ONE     20201  02445420
*                                       BYTE                     20201  02446020
HALFCCW  EQU   4                        FOR INCREMENTING HALF    20201  02446620
*                                       CCW                      20201  02447220
D7       EQU   7                        7 BYTE DISPLACEMENT      20201  02447820
ONECCW   EQU   8                        FOR INCREMENTING ONE CCW 20201  02448420
D24      EQU   24                       24 BIT DISPLACEMENT      20201  02449020
D28      EQU   28                       28 BYTE DISPLACEMENT     20201  02449620
UCBDEVT  EQU   19                       OFFSET TO DEVICE TABL IN 20201  02450220
*                                         UCB                           02450820
UCBADDR  EQU   32                      OFFSET TO UCB ADDR IN DEB 20201  02451420
FOUR     EQU   4                       MULTY FACTOR OF 16        20201  02452020
COMPSECT EQU   36                       OFFSET TO COMPUTE SECTOR 20201  02452620
*                                       ADDR                     20201  02453220
*                                                                       02453820
YESCARN  EQU   X'FF'                   BYTE TO TEST FOR RPS      20201  02454420
RDSECT   EQU   X'22'                    READ SECTOR COMMAND CODE 20201  02455020
SETSECT  EQU   X'23'                    SET SECTOR COMMAND CODE  20201  02455620
CCHN     EQU   X'40'                    COMMAND CHAINING BYTE    20201  02456220
NOPSS    EQU   X'FF'                    SECTOR VALUE WHICH IS   SA52385 02466202
*                                       INTERPRETED BY HARDWARE AS NOP  02476202
MODID    DC    C'IGG019KK'              MODULE ID                Y02072 02478202
FIX      DC    C' YM5349 '              LATEST FIX IN MODULE     YM5349 02480202
DATE     DC    C'11/15/73'              DATE OF LATEST FIX       YM5349 02482202
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 02486202
         EJECT                                                          02520020
*********************************************************************** 02530002
*                            DSECTS                                     02532002
*********************************************************************** 02534002
         IHADECB                                                 Y02072 02536002
         EJECT                                                          02538002
*      DATA CONTROL BLOCK (DCB) DEFINITION                              02540020
*                                                                       02560020
         DCBD  DSORG=DA                                                 02580020
         EJECT                                                          02880020
*                                                                       02900020
*      I/O BLOCK (IOB) DEFINITION                                       02920020
*                                                                       02940020
*              STANDARD IOB                                             02960020
         DS    0F                                                       02980020
IOBDEF   DSECT                                                          03000020
IOBFLAG1 DS    CL1            STATUS FLAG                               03020020
IOBFLAG2 DS    CL1            ERROR FLAG                                03040020
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       03060020
IOBECBPT DS    CL4            ECB POINTER                               03080020
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       03100020
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           03120020
         DS    CL1                                                      03140020
         DS    CL3                                                      03160020
IOBCSWST DS    CL2            STATUS BYTES                              03180020
IOBCSWCT DS    CL2            REMAINING COUNT                           03200020
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   03220020
IOBSIOCC DS    CL1            SIO CONDITION CODE                        03240020
         DS    CL3                                                      03260020
IOBDCBPT DS    0CL4           DCB POINTER                               03280020
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            03300020
         DS    CL3                                                      03320020
IOBRESTR DS    0CL4           RESTART POINTER                           03340020
         DS    CL1                                                      03360020
         DS    CL3                                                      03380020
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              03400020
IOBERRCT DS    CL2            ERROR COUNTER                             03420020
IOBSEEK  DS    CL8            SEEK ADDRESS                              03440020
*        BDAM EXTENDED IOB                                              03460020
*                                                                       03480020
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  03500020
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          03520020
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     03540020
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                03560020
         DS    CL3                                                      03580020
IOBDTYPE DS    CL2            TYPE FIELD                                03600020
IOBDSTAT DS    CL2            IOB STATUS                                03620020
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        03640020
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                03660020
         DS    CL2                                                      03680020
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               03700020
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        03720020
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                03740020
IOBCP    DS    CL200                   CHANNEL PROGRAM AREA             03760020
         END                                                            03780020
./  ADD  SSI=31330184,NAME=IGG019KL
 TITLE 'IGG019KL -- DYNAMIC BUFFERING MODULE && START-I/O APPENDAGE'    00200021
IGG019KL CSECT                                                          00600021
*MODULE NAME - IGG019KL                                               * 00650002
*                                                                     * 00700002
*DESCRIPTIVE NAME - DYN BUF MODULE & SIO APPENDAGE -VS RECORD FORMAT  * 00750002
*                   AND REAL ADDRESS SPACE                            * 00800002
*                                                                     * 00850002
*COPYRIGHT - NONE                                                     * 00860002
*                                                                     * 00870002
*CHANGE ACTIVITY                                                      * 00880002
*                                                                       00890002
*        OS 21 CHANGES/DELETIONS                                        00892002
*3574                                                            M1780  00892402
*        VS 1-1 CHANGES/DELETIONS                                       00894002
*D468000                                                        XA00093 00894402
*        VS 2-1 CHANGES/DELETIONS                                       00898002
*        VS 1-2 CHANGES/DELETIONS                                       00923202
*        VS 2-2 CHANGES/DELETIONS                                       00935802
*212000,220000-222000,230500-231500,294000,302000,348000,618667-621000, 00948402
*642400-645000,645200-646799,647499-649000,684400-687500,697000-701800, 00998402
*830000-850000,860500-866500                                     Y02072 01048402
*                                                                     * 01098402
*STATUS CHANGE LEVEL 004                                              * 01100002
*                                                                     * 01150002
*********************************************************************** 01160002
*THIS MODULE WAS TOTALLY REPLACED IN R-21 AS A RESULT OF A30797.  IT    01200001
*INCORPORATES IGG019KS WHICH NO LONGER EXISTS AS OF R-21.  TWO SEPARATE 01250001
*FUNCTIONS EXIST IN THE MODULE: SIO APPENDAGE FUNCTION AND FREEDBUF     01300001
*FUNCTION.  TWO SEPARATE FUNCTIONAL DESCRIPTIONS EXIST, ONE UNDER       01350001
*SIORTNE AND THE OTHER UNDER FBUFRTNE.  ALL EQUATES ARE IN 1ST ROUTINE. 01400001
*********************************************************************** 01410002
*                                                                       01450001
         USING *,RAPDBASE                                               04000021
SIOEP    B     SIORTNE            START I/O APPENDAGE E.P.              04200021
         ORG   IGG019KL+8                                               04400021
FRBUFEP  B     FBUFRTNE           FREE DYNAMIC BUFFER SVC E.P.          04600021
*                                                                       04800021
*                                                                       04900002
*********************************************************************** 04950002
*  THE FOLLOWING TWO ENTRY POINTS ARE USED FOR PROCESSING OF THE      * 04960002
*  FREEDBUF ESTAE ROUTINE, IGCT005G.  THE FIRST ENTRY POINT (+12) IS  * 04970002
*  USED WHEN, IN THE ESTAE CLEANUP ROUTINE, IT IS DETERMINED THAT THE * 04980002
*  AUDIT TRAIL BIT INDICATING THAT THE NEXT IOB HAD BEEN TAKEN FROM   * 04990002
*  THE IOB QUEUE BUT THE CHANNEL PGM HAD NOT BEEN INITIALIZED YET     * 04992002
*  (WKAIOBQ BIT IS ON). IN THIS CASE ENTRY IS MADE TO INITIALIZE      * 04994002
*  THE CHANNEL PROGRAM AND ISSUE THE EXCP FOR THIS REQUEST.           * 04996002
*         THE SECOND ENTRY POINT (+16) IS USED WHEN THE NEXT IOB HAS  * 04998002
*  BEEN REMOVED FROM THE QUEUE, ITS CHANNEL PGM INITIALIZED, BUT THE  * 04998402
*  ABEND OCCURRED BEFORE THE EXCP WAS ISSUED (WKABUFAS BIT ON).IN THIS* 04998802
*  CASE ENTRY IS MADE TO ISSUE THE EXCP FOR THIS REQUEST.             * 04999202
*          INPUT FOR BOTH ENTRIES IS THE SAME:                        * 04999602
*                   REGISTER 2 = NEXT IOB ADDRESS                     * 04999702
*                   REGISTER 3 = BEGINNING ADDRESS OF THIS MODULE     * 04999802
*                   REGISTER 4 = DCB ADDRESS                          * 04999902
*                   REGISTER 5 = SVRB ADDRESS                         * 05049902
*                   REGISTER 6 = BUFFER ADDRESS                       * 05051902
*                   REGISTER 8 = TCB ADDRESS                          * 05059902
*                   REGISTER 15= BEGINNING ADDRESS OF THIS MODULE     * 05069902
*                   WKAREG14 IN SVRB WORKAREA IN INITIALIZED TO       * 05079902
*                                RETURN ADDRESS IN ESTAE              * 05089902
*  A THIRD ENTRY INTO THIS MODULE IS TAKEN BY ESTAE, IGCT005G, IF NO  * 05091902
*  AUDIT TRAIL BITS ARE SET AT ALL.  IN THIS CASE ENTRY IS THE SAME   * 05093902
*  AS FOR FREEDBUF (+8).  INPUT IS LIKEWISE THE SAME.                 * 05095902
*********************************************************************** 05097902
ESTENT1  B     ESTENTA                  INIT CH PGM, ISSUE EXCP  Y02072 05098302
*                                                                       05098702
ESTENT2  B     ESTENTB                  ISSUE EXCP               Y02072 05099102
*********************************************************************** 05099502
*                                                                     * 05099602
* FUNCTION:                                                           * 05099902
*    THE START-I/O APPENDAGE ATTEMPTS TO ASSIGN A BUFFER TO A         * 05200021
*    READ REQUEST IF THE REQUEST SPECIFIES DYNAMIC BUFFERING AND      * 05400021
*    NO BUFFER WAS ASSIGNED BEFORE EXCP.  IF A BUFFER IS              * 05600021
*    AVAILABLE FOR ASSIGNMENT, IT IS REMOVED FROM THE BUFFER          * 05800021
*    POOL AND THE BUFFER CHAIN IS UPDATED.  THE BUFFER ADDRESS        * 06000021
*    IS PLACED IN THE REQUEST'S DECB AND IN THE READ CCWS OF THE      * 06200021
*    REQUEST'S CHANNEL PROGRAM.  THE ADDRESS OF THE SEGMENT WORK      * 06400021
*    AREA (PART OF THE BUFFER) IS PLACED IN THE IOB.  THE ROUTINE     * 06600021
*    THEN RETURNS TO IOS TO INITIATE THE I/O.                         * 06800021
*    IF NO BUFFER IS AVAILABLE THE REQUEST IS PLACED ON A QUEUE       * 07000021
*    OF REQUESTS WAITING FOR BUFFERS.  THE ROUTINE TAKES THE IOS      * 07200021
*    RETURN WHICH INDICATES THAT THE I/O REQUEST SHOULD NOT BE        * 07400021
*    INITIATED.                                                       * 07600021
*                                                                     * 07800021
* ENTRY POINT:                                                        * 08000021
*         SIOEP -- ENTERED ASYNCHRONOUSLY FROM IOS AT START-I/O       * 08200021
*         TIME.  THE ADDRESS OF IGG019KL IS PLACED IN THE             * 08400021
*         APPENDAGE VECTOR TABLE (AVT) DURING OPEN PROCESSING.        * 08600021
*         CALLING SEQUENCE -- L     15,4(AVTPTR)                      * 08800021
*                             BALR  14,15                             * 09000021
*                                                                     * 09200021
* INPUT                                                               * 09400021
*    **** REGISTER CONTENTS ****                                      * 09600021
*    REGISTER  1 -- REQUEST QUEUE ELEMENT (RQE) ADDRESS               * 09650002
*    REGISTER  2 -- INPUT/OUTPUT BLOCK (IOB) ADDRESS                  * 09800021
*    REGISTER  3 -- DATA EXTENT BLOCK (DEB) ADDRESS                   * 10000021
*    REGISTER  4 -- DATA CONTROL BLOCK (DCB) ADDRESS                  * 10200021
*    REGISTER  7 -- UNIT CONTROL BLOCK (UCB) ADDRESS                  * 10400021
*    REGISTER 13 -- IOS REGISTER SAVEAREA                             * 10450002
*    REGISTER 14 -- RETURN ADDRESS                                    * 10600021
*    REGISTER 15 -- ADDRESS OF IGG019KL                               * 10800021
*                                                                     * 11000021
* OUTPUT                                                              * 11200021
*    **** REGISTER CONTENTS ****                                      * 11400021
*    ALL REGISTER CONTENTS ARE RESTORED BEFORE RETURN TO IOS.         * 11600002
*                                                                     * 12600021
*    **** DATA AREAS SET BY THIS ROUTINE ****                         * 12800021
*    IOBSWAP            IF A BUFFER IS ASSIGNED, SEGMENT WORK         * 13000021
*                       AREA ADDRESS                                  * 13200021
*    IOBDSTAT BIT IOBBUFF    SET IF A BUFFER IS ASSIGNED              * 13400021
*    IOBDQPTR FIELD OF IOB POINTED TO BY BCBFRQB,  OR                 * 13600021
*    BCBFRQT            UPDATED TO POINT TO THIS IOB IF REQUEST       * 13800021
*                       MUST WAIT FOR A BUFFER                        * 14000021
*    BCBFRQB            UPDATED TO POINT TO THIS IOB IF REQUEST       * 14200021
*                       MUST WAIT FOR A BUFFER                        * 14400021
*    BCBNABFR           UPDATED IF A BUFFER IS ASSIGNED.              * 14600021
*    DECAREA            DATA ADDR IN THE ASSIGNED BUFFER              * 14800021
*    DECKYADR           KEY ADDR IN THE ASSIGNED BUFFER FOR A READ    * 15000021
*                       BY BLOCK ID, & KEY ADDR SPECIFIED 'S'.        * 15200021
*    NEXT-TO-LAST CCW ADDR   KEY ADDR WHEN KEY IS IN DYNAMIC BUFFER   * 15400021
*                            (SEE DECKYADR).                          * 15600021
*    LAST CCW ADDR      DATA ADDR                                     * 15800021
*                                                                     * 16000021
* EXITS                                                               * 16200021
*         0(R14)        RETURN TO IOS & START I/O                     * 16400021
*         4(R14)        RETURN TO IOS & DISREGARD I/O REQUEST         * 16600021
*                                                                     * 16800021
* ATTRIBUTES -- REENTRANT,PRIVILEGED,KEY=0,ENABLED,WITH THE LOCAL     * 17000002
*    LOCK HELD. MODESET IS ISSUED TO DO ALL PROCESSING IN USER KEY.   * 17010002
*                                                                     * 17200021
* NOTES --                                                            * 17400002
*                                                                     * 18000021
         IEZBITS                                                        18200021
*                  REGISTER EQUATES                                     18400021
R0       EQU   0        INPUT REGISTER 0    SVC                         18600021
RWORK0   EQU   0        WORK REGISTER (FBUFRTNE)                 Y02072 18650002
R1       EQU   1        INPUT REGISTER 1                                18800021
RRQE     EQU   1        RQE ADDRESS PASSED BY IOS                Y02072 18850002
RLINK    EQU   1        INTERNAL LINKAGE REGISTER                Y02072 18900002
RIOB     EQU   2        ADDRESS OF IOB                                  19000021
RBASE3   EQU   3        BASE REGISTER       SVC                         19200021
RDCB     EQU   4        ADDRESS OF DCB                                  19400021
RSVRB    EQU   5        IOS BASE(SIO) OR SVRBPTR(SVC 57          Y02072 19450002
RBUFFR   EQU   6        BUFFER ADDRESS                                  19800002
RSWA     EQU   6        PTR TO SEGMENT WORK AREA (ASSGNBUF)             20000021
RWORK6   EQU   6        WORK REGISTER                                   20200021
RDECB    EQU   7        DECB ADDRESS (FBUFRTNE)                         20400002
RCCW     EQU   7        PTR TO CCW TO MODIFY (ASSGNBUF)                 20600021
RBUFCB   EQU   7        BASE REG FOR BUFFER CNTRL BLK(FBUFRTNE)  Y02072 20850002
RWORK8   EQU   8        WORK REGISTER  (SIORTNE)                 Y02072 20900002
RTCB     EQU   8        BASE REG FOR TCB (FBUFRTNE)              Y02072 20950002
RWORK9   EQU   9        WORK REGISTER                                   21000021
RWORK10  EQU   10       WORK REGISTER                                   21400021
RWORK11  EQU   11       WORK REGISTER                                   21600021
RWORK12  EQU   12       WORK REGISTER                                   21800021
RSAVE    EQU   13       IOS SAVEAREA REGISTER                    Y02072 21850002
RRETURN  EQU   14       RETURN ADDRESS                                  22400021
R15      EQU   15                       SAVE/RESTORE REG         Y02072 22650002
RAPDBASE EQU   15       BASE REGISTER FOR APPENDAGE ROUTINES            22800021
         SPACE 5                                                        23000021
KEYDATOP EQU   X'0E'         CCW OP-CODE  READ KEY & DATE               23800021
RDDATAOP EQU   X'06'         CCW OP-CODE  READ DATA                     24000021
*                                                                       24050002
*                    TEST TO DETERMINE IF REQUEST IS VALID              24100002
*                                                                       24150002
SIORTNE  EQU   *                                                        24200021
         USING IOBSTDRD,RIOB                                            24600021
         USING IHADCB,RDCB                                              24800021
         TM    IOBDTYP2,IOBRQUST  IS THIS A READ REQUEST?               25000021
         BCR   8,RRETURN          IF NOT, RETURN TO IOS                 25200021
         TM    IOBDTYPE,IOBDYNBF  DOES REQUEST SPECIFY DYNAMIC          25400021
*                                 BUFFERING?                            25600021
         BCR   8,RRETURN          IF NO, RETURN TO IOS                  25800021
         TM    IOBSTAT1,IOBBUFF   HAS A BUFFER BEEN ASSIGNED TO         26000021
*                                 THIS REQUEST?                         26200021
         BCR   1,RRETURN          IF SO, RETURN TO IOS                  26400021
*                                                                       26600021
*                       IF A BUFFER IS AVAILABLE, ASSIGN IT TO          26800021
*                       THIS REQUEST AND UPDATE THE BUFFER POOL.        27000021
*                                                                       27200021
         USING RQE,RRQE                 ESTABLISH RQE BASE       Y02072 27250002
         STM   R0,R15,0(RSAVE)          SV REGS IN IOS SAVEAREA  Y02072 27300002
*                                                                       27350002
         MODESET  KEYADDR=RQEPRT,WORKREG=10  CHANGE TO USER KEY  Y02072 27360002
*                                                                       27370002
         L     RWORK10,DCBBUFCB   GET BUFFER CONTROL BLOCK ADDR         27400021
         USING BCBDEFR,RWORK10    ESTABLISH BASE FOR BCB         Y02072 27600002
         L     RWORK11,BCBNABFR   GET ADDRESS OF NEXT AVAILABLE         27800021
*                                 BUFFER                                28000021
         LTR   RWORK11,RWORK11    IS ONE AVAILABLE?                     28200021
         BZ    PTONBUFQ           IF NOT BRANCH TO QUEUE REQUEST        28400021
         USING SWA,RWORK11        ESTABLISH BASE FOR SEG WKAREA  Y02072 28600002
         L     RWORK8,SWANXTPT    GET ADDR OF 2ND BUFFER (OR 0). Y02072 28800002
         DROP  RWORK11                                                  29000021
         ST    RWORK8,BCBNABFR    MAKE IT NEXT AVAILABLE         Y02072 29200002
         DROP  RRQE               DROP RQE BASE REG              Y02072 29250002
         BAL   RLINK,ASSGNBUF     ASSIGN BUFFER TO REQUEST              29600021
*                                                                       30000021
SIORET   EQU   *                        RETURN TO IOS            Y02072 30050002
*                                                                       30100002
         MODESET  KEYADDR=IOSKEY,WORKREG=1   CHANGE TO IOS KEY   Y02072 30150002
*                                                                       30200002
         LM    R0,R15,0(RSAVE)    LOAD IOS REGISTERS             Y02072 30250002
         BR    RRETURN            RETURN TO IOS TO INITIATE             30400021
*                                 I/O REQUEST                           30600021
         SPACE 5                                                        30800021
PTONBUFQ EQU   *                                                        31000021
*                                                                       31200021
*                       NO BUFFER WAS AVAILABLE. PUT THIS IOB ON        31400021
*                       THE QUEUE WAITING FOR BUFFERS.                  31600021
*                                                                       31800021
         L     RWORK8,BCBFRQT     ADDR OF 1ST IOB ON QUEUE.      Y02072 32000002
         LTR   RWORK8,RWORK8      IS THE QUEUE EMPTY?            Y02072 32200002
         BNZ   ONEONQ             BRANCH IF NOT                         32400021
         ST    RIOB,BCBFRQT       IF SO, STORE IOB ADDR AS FIRST        32600021
         B     BOTTOMST                                                 32800021
ONEONQ   L     RWORK8,BCBFRQB     GET ADDR OF LAST IOB ON QUEUE  Y02072 33000002
         ST    RIOB,IOBDQPTR-IOBSTDRD(RWORK8)   POINT CHAIN TO   Y02072 33200002
*                                                THIS IOB               33400021
BOTTOMST ST    RIOB,BCBFRQB       THIS IOB IS LAST ON QUEUE             33600021
         DROP  RWORK10            DROP BCB BASE                  Y02072 33610002
*                                                                       33650002
         MODESET  KEYADDR=IOSKEY,WORKREG=10  CHANGE TO IOS KEY   Y02072 33700002
*                                                                       33750002
         LM    R0,R15,0(RSAVE)    LOAD IOS REGISTERS             Y02072 33800002
         B     4(RRETURN)         IOS RETURN - DON'T DO I/O             34000021
         DROP  RIOB                                                     34200021
         DROP  RDCB                                                     34400021
*                                                                       34600021
         EJECT                                                          35000021
*                                                                       35200021
*                  THIS SUBROUTINE IS USED BY THE START-I/O             35400021
*                  APPENDAGE AND THE FREE DYNAMIC BUFFER SVC            35600021
*                  ROUTINE. IT ASSUMES ENTRY IN USER KEY.               35800002
*                  IT ASSIGNS A BUFFER TO AN I/O REQUEST BY             36000021
*                  PLACING THE BUFFER ADDRESS INTO THE DECB             36200021
*                  AND THE CHANNEL PROGRAM.  IT ALSO PLACES THE         36400021
*                  SEGMENT WORK AREA ADDRESS IN THE IOB.                36600021
*                                                                       36800021
*              REGISTER INPUT:  RIOB    - ADDR OF IOB TO WHICH          37000021
*                                         BUFFER WILL BE ASSIGNED       37200002
*                               RDCB    - DCB ADDRESS                   37400021
*                               RWORK11 - BUFFER ADDRESS                37600021
*                               RLINK   - RETURN ADDRESS                37800021
*              REGISTER OUTPUT: RSWA    - WORK REGISTER                 38000021
*                               RCCW    - WORK REGISTER                 38400021
*                               RWORK9  - WORK REGISTER                 38600002
*                               RWORK10 - WORK REGISTER                 38800021
*                               RWORK11 - WORK REGISTER                 39000021
         USING SWA,RWORK11        ESTABLISH BASE FOR SWA         Y02072 39200002
         USING IHADCB,RDCB                                              39400021
         USING IOBSTDRD,RIOB                                            39600021
ASSGNBUF L     RWORK9,IOBECBPT    GET DECB ADDRESS                      39800021
         USING DECB,RWORK9                                              40000021
         LR    RWORK10,RIOB       PLACE IOB ADDRESS IN WORK REG         40400021
         LA    RSWA,IOBSTDRD-IOBSWAP   DISP TO IOBSWAP FIELD            40600021
         SR    RWORK10,RSWA       POINT TO IOB PREFIX                   40800021
         USING IOBSWAP,RWORK10                                          41000021
         ST    RWORK11,IOBSWAP    PLACE SWA ADDR IN IOB                 41200021
*                                 DATA & KEY (IF REQUESTED) WILL        41400021
*                                 BE READ INTO THE SEGMENT AREA         41600021
*                                 OF THE DYNAMIC BUFFER.  THE           41800021
*                                 USER WILL BE PASSED THE ADDRESS       42000021
*                                 OF LOCATIONS IN THE RECORD            42200021
*                                 AREA.                                 42400021
*                                                                       42600021
         LA    RSWA,SWASEGMT      GET ADDRESS OF SEGMENT AREA    Y02072 42800002
         L     RWORK11,SWARAPT    GET ADDRESS OF RECORD AREA     Y02072 43000002
         L     RCCW,IOBDCPND      POINT BEYOND LAST CCW                 43200021
         SH    RCCW,H16           POINT TO NEXT-TO-LAST CCW             43400021
*                                 FOR A READ BY BLOCK ID, KEY           43600021
*                                 CODED 'S', THE KEY IS READ            43800021
*                                 INTO THE DYNAMIC BUFFER.              44000021
         TM    IOBDTYP2,IOBTYPE   IS THIS READ BY BLOCK ID?             44200021
         BO    FILLSCCW           BRANCH IF NO                          44400021
         CLI   DCBKEYLE,0         IS THERE A KEY                 Y02072 44450002
         BE    FILLSCCW           BRANCH IF NO                   Y02072 44500002
         TM    IOBDTYP2,IOBSKEY   WAS KEY ADDRESS CODED 'S'?            44600021
         BZ    FILLSCCW           BRANCH IF NO                          44800021
         ST    RWORK11,DECKYADR   PLACE KEY ADDRESS IN DECB             45000021
         ST    RWORK11,0(RCCW)    PLACE ADDR OF KEY IN RECORD   XA00093 45200021
*                                 AREA INTO NEXT-TO-LAST CCW.           45400021
         MVI   0(RCCW),KEYDATOP   RESTORE OP-CODE                       45600021
*                                 INCREMENT RECORD AREA & SEGMENT       45800021
*                                 AREA POINTERS BEYOND KEY.             46000021
         SR    RWORK10,RWORK10                                          46200021
         IC    RWORK10,DCBKEYLE   GET LENGTH OF KEY                     46400021
         AR    RWORK11,RWORK10    BUMP RECORD AREA POINTER              46600021
*                                                                       47000021
FILLSCCW ST    RWORK11,DECAREA    PLACE DATA ADDRESS IN DECB            47200021
         ST    RSWA,8(RCCW)       PLACE DATA ADDRESS IN LAST CCW        47400021
         MVI   8(RCCW),RDDATAOP   RESTORE OP-CODE.                      47600021
         OI    IOBDSTAT,IOBBUFF   SET BUFFER-ASSIGNED SWITCH            47800021
         BR    RLINK              RETURN TO CALLER                      48000021
         DROP  RWORK11                                                  48200021
         DROP  RWORK9                                                   48400021
         DROP  RIOB                                                     48600021
         DROP  RDCB                                                     48800021
         EJECT                                                          49000021
FBUFRTNE EQU   *                                                        49200021
*                                                                     * 49400021
* FUNCTION:                                                           * 49600021
*    THE FREE DYNAMIC BUFFER ROUTINE RELEASES A DYNAMIC BUFFER.       * 49800021
*    IF ANY IOBS ARE ON THE UNSCHEDULED QUEUE (WAITING FOR A          * 50000021
*    BUFFER) THE ROUTINE ASSIGNS THE BUFFER TO THE FIRST IOB ON       * 50200021
*    THE QUEUE, AND ISSUES AN EXCP FOR THAT IOB.  IF NO IOBS ARE      * 50400021
*    ON THE UNSCHEDULED QUEUE THE ROUTINE PLACES THE BUFFER ON        * 50600021
*    THE CHAIN OF AVAILABLE BUFFERS.                                  * 50800021
*                                                                     * 51000021
* ENTRY POINT:                                                        * 51200021
*         FRBUFEP -- ENTERED FROM MODULE IGC0005G WHEN SVC 57 IS      * 51400021
*         ISSUED FOR A DCB WHICH SPECIFIED DIRECT ORGANIZATION.       * 51600021
*         CALLING SEQUENCE -- L    15,DCBDEBAD                        * 51800021
*                             L    15,DEBAPPAD                        * 52000021
*                             L    15,4(15)                           * 52200021
*                             BAL  14,8(15)                           * 52400021
*                                                                     * 52600021
* INPUT                                                               * 52800021
*    **** REGISTER CONTENTS ****                                      * 53000021
*    REGISTER  0 -- DECB ADDRESS                                      * 53200021
*    REGISTER  1 -- DCB ADDRESS                                       * 53400021
*    REGISTER  5 -- ADDRESS OF SVRB                                   * 53450002
*    REGISTER  8 -- ADDRESS OF TCB PASSED BY FREEDBUF          Y02072 * 53500002
*    REGISTER 14 -- RETURN ADDRESS                                    * 53800021
*    REGISTER 15 -- ADDRESS OF IGG019KL                               * 54000002
*                                                                     * 54200021
* OUTPUT                                                              * 54400021
*    **** REGISTER CONTENTS ****                                      * 54600021
*    ALL REGISTERS EXCEPT REGISTER 14 CAN BE USED WITHOUT SAVING      * 54800021
*    OR RESTORING CONTENTS.                                           * 55000021
*                                                                     * 55400021
*    **** DATA FIELDS SET BY THIS ROUTINE ****                        * 55600021
*    BCBFRQT       IF AN IOB IS WAITING FOR A BUFFER, PTR TO 1ST      * 55800021
*                  IOB ON QUEUE IS UPDATED.                           * 56000021
*    IOBDQPTR      FIELD IN DEQUEUED IOB IS CLEARED                   * 56200021
*    IF THE FREED BUFFER IS ASSIGNED TO A WAITING REQUEST, THE        * 56400021
*    BUFFER ADDRESS IS PLACED IN THE CHANNEL PROGRAM AND DECB         * 56600021
*    FIELDS, AND IN THE IOB AS THE SEGMENT WORK AREA ADDRESS (SEE     * 56800021
*    SIORTNE DESCRIPTION FOR DETAILS).                                * 57000021
*    BCBNABFR      IF THE BUFFER IS NOT ASSIGNED TO A REQUEST,        * 57200021
*                  ITS ADDRESS IS PLACED IN BCBNABFR                  * 57400021
*    SWANXTPT      FIELD OF THE RELEASED BUFFER IS SET TO THE         * 57600002
*                  ADDR OF THE 2ND AVAILABLE BUFFER.                  * 57800021
*    SWABFINC      SET TO ZERO                                        * 58000002
*    SVRB          SEE BELOW                                          * 58050002
*                                                                     * 58200021
* EXTERNAL REFERENCES                                                 * 58400021
*        EXCP CALL TO IOS                                             * 58600021
*        MODESET TO CHANGE BETWEEN SUPERVISOR AND USER KEYS             58650002
*        SETLOCK TO RELEASE AND OBTAIN THE LOCAL LOCK                   58700002
*                                                                       58800021
* EXITS, NORMAL                                                       * 59000021
*    BRANCH RETURN TO IGC0005G ON REGISTER 14.                        * 59200002
*                                                                     * 59600021
* TABLES / WORK AREAS                                                 * 59800021
*        IOB, DCB, DECB, BUFFER CONTROL BLOCK, SVRB                   * 60000002
*                                                                     * 60200021
* ATTRIBUTES -- REENTRANT, READONLY, PRIVILEGED. ENTRY IS SUPERVISOR  * 60400002
*    KEY WITHOUT THE LOCAL LOCK HELD. RETURN TO IGC0005G IS IN        * 60450002
*    SUPERVISOR KEY. MOST PROCESSING IS IN USER KEY.                  * 60452002
*                                                                     * 60500002
* NOTES -- THE ROUTINE MUST HAVE THE LOCAL LOCK TO UPDATE THE SERIALLY* 60550002
* REUSUABLE IOB AND BUFFER QUEUES. SETLOCK WILL BE ISSUED AT THIS TIME* 60560002
*                                                                     * 60600021
*****                                                             ***** 60650002
         EJECT                                                          61400021
         LR    RBASE3,RAPDBASE    ESTABLISH BASE REGISTER               61600021
         USING IGG019KL,RBASE3                                          61800021
         DROP  RAPDBASE                                                 61802001
         LR    RDCB,R1            TRANSFER DCB ADDRESS                  61804001
         USING IHADCB,RDCB                                              61806001
         LR    RDECB,R0           TRANSFER DECB ADDRESS                 61808001
         USING DECB,RDECB                                               61808401
         USING RBSECT,RSVRB             ESTABLISH BASE FOR SVRB  Y02072 61808502
*                                                                       61808902
         ST    RRETURN,WKAREG14         SAVE RETURN ADDR IN SVRB Y02072 61810402
         USING TCB,RTCB                 ESTABLISH BASE FOR TCB   Y02072 61814202
*                                       PASSED BY FREEDBUF IN R8 Y02072 61814602
*                                                                       61815002
         MODESET  KEYADDR=WKASVKEY,WORKREG=6 CHANGE TO USER KEY  Y02072X61815402
                                        TO ACCESS USER CNTRL BLK Y02072 61815802
*                                                                       61816102
*                       LOCATE THE BEGINNING ADDRESS OF THE             61818002
*                       BUFFER BEING FREED.                             61819902
*                                                                       61821802
         L     RBUFFR,DECAREA     ASSUME RECORD AREA ADDR = DATA        61823702
*                                 ADDR                                  61825602
         TM    DECTYPE2,DECKEYS   WAS KEY IN BUFFER (CODED 'S')?        61827502
         BZ    FBU0500            BRANCH NO                             61829402
         L     RBUFFR,DECKYADR    RECORD AREA ADDR = KEY ADDR           61831302
         DROP  RDECB                                             Y02072 61831702
FBU0500  EQU   *                                                        61833201
         LA    RWORK12,BUFRECAR-BUFBFPTR                                61835201
         SR    RBUFFR,RWORK12     POINT TO ADDR OF BEGINNING OF         61837202
*                                       BUFFER                          61839202
         L     RBUFFR,0(RBUFFR)         GET BUFFER ADDRESS              61839602
         USING SWA,RBUFFR               ESTABLISH BASE FOR SWACB Y02072 61839702
         XC    SWABFINC,SWABFINC        CLEAR RECORD AREA OFFSET Y02072 61846602
         L     RBUFCB,DCBBUFCB          BUFFER CONTROL BLCK ADDR Y02072 61849902
         USING BCBDEFR,RBUFCB           ESTABLISH BASE FOR BCB   Y02072 61853202
*                                                                       61903202
*   PREPARE FOR QUEUE UPDATES. THIS REQUIRES THAT THE LOCAL LOCK BE     61953202
*   OBTAINED WHILE MANIPULATING THE QUEUE. IT IS RELEASED WHEN THE      62003202
*   QUEUE HAS BEEN UPDATED AND THE NEXT WAITING IOB HAS BEEN REMOVED,   62053202
*   OR THE BUFFER HAS BEEN PUT BACK ON THE AVAILABLE BUFFER QUEUE.      62103202
*   MODESET IS ISSUED BECAUSE SETLOCK REQUIRES SUPERVISOR KEY.          62105202
*   SETLOCK USES REGISTERS 11-14 WITHOUT RESTORING THEM. CERTAIN        62107202
*   FIELDS WILL BE SAVED AT THIS POINT SHOULD THE ESTAE NEED THEM.      62109202
*                                                                       62113202
         L     RIOB,BCBFRQT             LOAD IOB IN USER KEY     Y02072 62115202
         L     RWORK0,BCBNABFR          LOAD BUF FLD IN USER KEY Y02072 62117202
*                                                                       62119202
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 62123202
*                                       TO GET THE LOCAL LOCK    Y02072 62125202
*                                                                       62127202
GETLOCK  SETLOCK  OBTAIN,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019KL(FREELOCKX62128002
               ,FREELCK1)'),MODE=UNCOND  GET THE LOCAL LOCK      Y02072 62128102
*                                                                       62128802
         ST    RBUFFR,WKABUFRG          SAVE BUF PTR FOR ESTAE   Y02072 62129202
         ST    RIOB,WKASAVE             SAVE BCB CONTENTS FOR    Y02072 62131202
*                                       ESTAE COMPARE TO DETECT  Y02072 62131602
*                                       IF CONTENTS CHANGE       Y02072 62132002
         ST    RWORK0,WKASAVE2          SAVE BCB CONTENTS        Y02072 62132402
*                                       FOR ESTAE IN CASE THE    Y02072 62132802
*                                       PATH TAKEN CHANGES THIS  Y02072 62132902
         ST    RIOB,WKAIOBRG            SAVE IOB REG FOR ESTAE   Y02072 62133102
*                                                                       62147202
         MODESET  KEYADDR=WKASVKEY,WORKREG=11 GO TO USER KEY     Y02072 62149202
*                                                                       62149602
         LTR   RIOB,RIOB                ARE THERE ANY IOBS?             62200002
         BZ    MAKEAVAL                 IF NOT, GO MAKE THIS BUFFER     62250002
*                                       AVAILABLE                       62300002
*                                                                       62350001
*                  UPDATE QUEUE BY REMOVING FIRST IOB                   62400002
*                                                                       62450001
         USING IOBSTDRD,RIOB                                            62500001
CHAIN    L     RWORK9,IOBDQPTR          GET ADDRESS OF NEXT IOB AND     62550002
         ST    RWORK9,BCBFRQT           MAKE IT THE NEXT IOB ON QUEUE   62600002
         XC    IOBDQPTR,IOBDQPTR        CLEAR QUEUING FIELD             62650002
*                                                                       62652002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072X62660002
                                        TO SET BIT IN SVRB       Y02072X62670002
                                        AND RELEASE LOCAL LOCK   Y02072 62670402
         MVI   WKATRAIL,WKAIOBQ         SET BIT IN SVRB EXT SAVE Y02072 62670802
*                                       INDICATING IOB DEQUEUED  Y02072 62671202
*                                                                       62672002
FREELOCK SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019KL(GETLOCKX62674002
               )')                      FREE THE LOCAL LOCK      Y02072 62674402
*                                                                       62676002
ESTENTA  EQU   *                        ESTAE ENTRY IF WKAIOBQ=1 Y02072 62686002
*                                                                       62690802
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  GO TO USER KEY    Y02072 62692002
*                                                                       62694002
         LR    RWORK11,RBUFFR     PUT BUFFER ADDR IN R11                64502002
         LR    RAPDBASE,RBASE3    RESTORE BASE REG FOR SUBRTN    XM6073 64502421
         BAL   RLINK,ASSGNBUF     ASSIGN THE BUFFER TO THE              64504001
*                                       DEQUEUED IOB                    64504402
*                                                                       64505702
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 64505802
*                                       TO SET BIT IN SVRB       Y02072 64505902
         MVI   WKATRAIL,WKABUFAS        SET BIT IN SVRB EXTENDED Y02072 64506902
*                                       SAVEAREA INDICATING BUF  Y02072 64508902
*                                       ASSIGNED TO NEXT IOB     Y02072 64509002
ESTENTB  EQU   *                        ESTAE ENTRY IF WKABUFAS  Y02072 64509202
*                                       BIT ON                   Y02072 64509602
         MODESET  KEYADDR=WKASVKEY,WORKREG=11   GO TO USER KEY   Y02072 64509802
*                                                                       64510002
         L     RWORK11,IOBECBPT         LOAD ADDR TO USER'S DECB Y02072 64511802
         ST    RWORK11,IOBDQPTR         SAVE DECB ADDR IN IOB    Y02072 64514902
         LA    RWORK11,IOBCSW+3         SET UP CSW ADDRESS TO    Y02072 64515302
         ST    RWORK11,IOBECBPT         USE AS DUMMY ECB FOR IOS Y02072 64515702
*                                       CEA OR EOE WILL RESTORE  Y02072 64516102
*                                       USER'S DECB ADDR IN IOB  Y02072 64516202
*                                                                       64518402
         EXCP  (RIOB)                   SCHEDULE I/O FOR NEXT IOB ON Q  64519802
*                                                                       64521802
         MODESET  EXTKEY=ZERO           RETURN TO SUPER KEY      Y02072 64522202
*                                                                       64522402
         MVI   WKATRAIL,WKAEXCP         SET BIT INDICATING EXCP  Y02072 64523202
*                                                                       64523602
         B     NORMEXIT                 RETURN TO IGC0005G       Y02072 64524002
         SPACE 5                                                        64524202
*                                                                       65050001
*   NO IOBS ARE WAITING FOR BUFFERS. RETURN BUFFER TO THE AVAILABLE     65060002
*   QUEUE.THIS ROUTINE IS ENTERED IN USER KEY WITH THE LOCAL LOCK HELD. 65070002
*   IT RETURNS TO IGC0005G IN SUPERVISOR KEY.                           65120002
*                                                                       65200001
MAKEAVAL EQU   *                                                        65250001
         L     RWORK9,BCBNABFR          GET ADDR OF AVAILABLE BUFFER    65300002
         USING SWA,RBUFFR               ESTABLISH BASE FOR SWACB Y02072 65350002
         ST    RWORK9,SWANXTPT          POINT THIS SWA TO IT     Y02072 65400002
         ST    RBUFFR,BCBNABFR          MAKE THIS ONE NEXT AVAILABLE    65450002
         DROP  RBUFFR                   (LIFO QUEUE)                    65500002
*                                                                       65502002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 65510002
*                                       TO SET BIT IN SVRB       Y02072 65520002
         MVI   WKATRAIL,WKABUFQ         SET BIT INDICATING BUF   Y02072 65520402
*                                       FREED AND PUT ON QUEUE   Y02072 65520802
*                                                                       65522002
FREELCK1 SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019KL(GETLOCKX65536002
               )')                      FREE THE LOCAL LOCK      Y02072 65538002
************                                                            65542002
*                                                                       65544002
NORMEXIT EQU   *                        RETURN TO FREEDBUF       Y02072 65554002
         L     RRETURN,WKAREG14         RESTORE R14 TO RET ADDR  Y02072 65594002
         BR    RRETURN                  RETURN TO IGC0005G.             68800002
*****                                                             ***** 68810002
*                        CONSTANTS                                    * 68850002
*****                                                             ***** 68860002
H16      DC    H'16'                                                    68900001
IOSKEY   DC    X'00'                    IOS KEY                  Y02072 68950002
ZERO     DC    X'00'                    SVRB KEY                 Y02072 69000002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 69050002
         EJECT                                                          81400021
*********************************************************************** 81410002
*                              DSECTS                                 * 81420002
*********************************************************************** 81422002
         IHAPSA                                                  Y02072 81430002
         EJECT                                                          81440002
         IECDRQE                                                 Y02072 81450002
         EJECT                                                          81460002
         IKJTCB                                                  Y02072 81470002
         EJECT                                                          81500002
         IEZIOB                                                         81600021
         EJECT                                                          81800002
         DCBD  DSORG=DA                                                 82000001
         EJECT                                                          82200002
         IHADECB                                                        82400021
         EJECT                                                          83850002
         IGGBCB  TYPE=DAM                                               83900002
BUFFERB  DSECT          FORMAT OF BUFFER BEYOND SEGMENT AREA            85200021
BUFBFPTR DS    A        ADDRESS OF BEGINNING OF BUFFER                  85400021
BUFRECAR EQU   *        RECORD AREA; BUFBFPTR IS ALIGNED SO THAT        85600021
*                       BUFRECAR FALLS AS SPECIFIED BY DCBBFALN.        85800021
*                                                                       86000021
         SPACE 5                                                        86010002
         IGGSWA                                                  Y02072 86050002
         EJECT                                                          86550001
         IKJRB                                                   Y02072 86600002
         IGGFRWKA                                                Y02072 86610002
         END                                                            88400021
./  ADD  SSI=31840078,NAME=IGG019KM
 TITLE   'IGG019KM - SELF FORMAT MODULE, VAR AND UNDEF'                 00040002
IGG019KM CSECT                                                          00040402
*MODULE NAME - IGG019KM                                               * 00040802
*                                                                     * 00041202
*DESCRIPTIVE NAME - BDAM WRITE ADD, VARIABLE AND UNDEFINED RECORDS    * 00041602
*                                                                     * 00041702
*COPYRIGHT - NONE                                                     * 00041802
*                                                                     * 00041902
*CHANGE ACTIVITY                                                      * 00043902
*                                                                     * 00045902
*        OS 20 CHANGES/DELETIONS                                        00065002
*1776000450-000520,000700-000850,026600,027800,028600,055600     20201  00067020
*        OS 21 CHANGES/DELETIONS                                        00069002
*                                                               SA53787 00071002
*        VS1-1 CHANGES/DELETIONS                                        00073002
*        VS2-1 CHANGES/DELETIONS                                        00075002
*        VS1-2 CHANGES/DELETIONS                                        00075402
*        VS2-2 CHANGES/DELETIONS                                        00075802
*                                                                Y02072 00075902
*                                                                       00076202
*STATUS CHANGE LEVEL 008                                                00077002
*                                                                       00087002
*FUNCTION/OPERATION- THIS MODULE CONTAINS THREE ROUTINES WHOSE        * 00100020
*   FUNCTIONS ARE,                                                    * 00120020
*   1.CREATE THE CHANNEL PROGRAM REQUIRED TO ADD A NEW BLOCK TO A     * 00140020
*    DATA SET OF V OR U FORMAT RECORDS. THE REQUEST WHICH PERFORMS    * 00160020
*    THIS IS A WRITE MACRO WITH A TYPE DA.                            * 00180020
*    THE CHANNEL PROGRAM WILL CONSIST OF TWO PARTS, THE FIRST THREE   * 00200020
*    CCWS WILL READ THE CAPACITY RECORD FROM A TRACK, THE SECOND      * 00220020
*    SEQUENCE OF CCWS WILL WRITE THE NEW RECORD AND UPDATE THE        * 00240020
*    CAPACITY RECORD.                                                 * 00260020
*                                                                     * 00280020
*   2.CALCULATE THE NUMBER OF BYTES THE NEW BLOCK WILL REQUIRE ON THE * 00300020
*    TRACK AND COMPARE THAT VALUE TO THE NUMBER OF UNUSED BYTES       * 00320020
*    REMAINING ON THE TRACK ACCORDING TO THE CAPACITY RECORD. IF THE  * 00340020
*    BLOCK WILL FIT, THE COUNT FIELD FOR THE NEW BLOCK AND AN UPDATED * 00360020
*    CAPACITY RECORD ARE FORMED AND THE SECOND PART OF THE CHANNEL    * 00380020
*    PROGRAM IS SCHEDULED VIA THE EXCP MACRO. IF THE BLOCK WILL NOT   * 00400020
*    FIT, INDICATORS ARE SET IN THE IOB WHICH WILL CAUSE THE DECB TO  * 00420020
*    BE POSTED WITH A NO-SPACE-FOUND EXCEPTION CODE.                  * 00440020
*                                                                     * 00460020
*   3.SEARCH THE UNSCHEDULED QUEUE OF IOBS WHEN THE CURRENT WRITE ADD * 00480020
*    HAS COMPLETED, FOR ANOTHER WRITE ADD REQUEST. THE FIRST SUCH     * 00500020
*    UNSCHEDULED REQUEST FOUND (IF ANY) WILL BE UNQUEUED AND          * 00520020
*    SCHEDULED VIA EXCP.                                              * 00540020
*                                                                     * 00560020
*ENTRY POINTS- THERE ARE TWO ENTRY POINTS AS FOLLOWS,                 * 00580002
*   1.   'IECDSF1' IS ENTERED FROM THE FOUNDATION MODULE (IGG019KA)   * 00600020
*     TO PERFORM FUNCTION 1.  CALLING SEQUENCE IS, L    15,DCBDFOR    * 00620020
*                                                  BALR 14,15         * 00640020
*   2.   'IECDSF2' IS ENTERED FROM ASYNCHRONOUS INTERRUPT (IGG019KA)  * 00660020
*     TO PERFORM FUNCTION 2. AND ALSO FUNCTION 3. IF THE BLOCK WILL   * 00680020
*     NOT FIT ON THE TRACK. CALLING SEQUENCE IS, L   15,DCBDFOR       * 00700020
*                                                B   8(15)            * 00720002
*                                                                     * 00800020
*INPUT-                                                               * 00820020
*   TO FUNCTION 1.                                                    * 00840020
*    REGISTER 4  DCB ADDRESS                                          * 00860020
*    REGISTER 5  DECB ADDRESS                                         * 00880020
*    REGISTER 6  ADDRESS OF THE LOCATION FOR CCW 1.                   * 00900020
*    REGISTER 7  IOB ADDRESS                                          * 00920020
*    REGISTER 11 BASE ADDRESS OF MODULE IGG019KA                      * 00940020
*    REGISTER 14 RETURN ADDRESS                                       * 00960020
*    REGISTER 15 BASE OF THIS MODULE                                  * 00980020
*                                                                     * 01000020
*   TO FUNCTION 2 AND 3.                                              * 01020002
*    REGISTER 1  IOB ADDRESS                                          * 01040020
*    REGISTER 7  RQE (IOS QUEUEING ELEMENT) ADDRESS                   * 01060002
*    REGISTER 10 BASE ADDRESS FOR THIS MODULE                         * 01070002
*    REGISTER 13 DCB ADDRESS                                          * 01080020
*                                                                     * 01120020
*OUTPUT- FUNCTION 1 WILL CONSTRUCT THE REQUIRED CCWS AND LEAVE        * 01240020
*   REGISTER 6 POSITIONED AT THE LAST CCW.                            * 01260020
*   FUNCTION 2 WILL FORM THE NEW BLOCK'S COUNT FIELD AND UPDATED      * 01280020
*   CAPACITY RECORD IF THE RECORD FITS OR WILL SET BITS IN THE IOB    * 01300020
*   (IOBDSTAT) IF THERE IS NO SPACE FOR THE BLOCK.                    * 01320020
*   FUNCTION 3 WILL SCHEDULE ANOTHER WRITE ADD IF ONE HAS BEEN        * 01340020
*   QUEUED AWAITING THE CURRENT WRITE'S COMPLETION.                   * 01360020
*                                                                     * 01380020
*EXTERNAL ROUTINES-                                                   * 01400020
*        'IGG019KQ' IS USED TO CONSTRUCT ADDITIONAL CCWS TO VERIFY    * 01420020
*   THE NEW BLOCK IF THE WRITE VALIDITY CHECK OPTION WAS SPECIFIED IN * 01440020
*   THE OPTCD PARAMETER OF THE DCB MACRO. 'IGG019KY' IS USED TO       * 01460002
*   CONSTRUCT EXTENDED SEARCH CCWS IF THAT OPTION IS SPECIFIED.       * 01470002
*   SVC 53 IS ISSUED TO GET EXCLUSIVE CONTROL OF CURRENT TRACK        * 01490002
*   ON WHICH BLOCK WILL BE WRITTEN OUT.                               * 01492002
*                                                                     * 01494002
*EXITS-NORMAL- 'EXITFDN' IS THE RETURN TO MODULE IGG019KA AFTER THE   * 01500020
*   CHANNEL PROGRAM HAS BEEN CONSTRUCTED.                             * 01520020
*        'EXITSUPV' IS AN SVC EXIT TO RETURN TO SUPERVISOR WHEN THE   * 01540020
*   BLOCK FITS ON THE TRACK AND THE IOB HAS BEEN RESCHEDULED WITH IOS.* 01560020
*        'EXITASI' IS THE RETURN TO ASYNCHRONOUS INTERRUPT AFTER THE  * 01580020
*   UNSCHEDULED QUEUE HAS BEEN SCANNED FOR ANOTHER WRITE ADD.         * 01600020
*EXITS-ERROR-  'EXITERR' IS A RETURN TO ASYNCHRONOUS INTERRUPT ALSO   * 01620020
*   BUT WILL BYPASS FEEDBACK TESTS BECAUSE THIS WRITE ADD COMPLETED   * 01640020
*   ABNORMALLY.                                                       * 01660020
*                                                                     * 01680020
*TABLES/WORK AREA- THE COMMUNICATION VECTOR TABLE IS REFERENCED TO    * 01700020
*   REACH THE DIRECT ACCESS DEVICE TABLE WHICH SUPPLIES THE DEVICE    * 01720020
*   CHARACTERISTICS NECESSARY TO CALCULATE THE BYTES REQUIRED FOR     * 01740020
*   THIS BLOCK ON THIS DEVICE.                                        * 01760020
*                                                                     * 01780020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTES IN PROBLEM        * 01800002
*   PROGRAM STATE, USER KEY.                                          * 01810002
*                                                                     * 01860020
*NOTES- THE REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT      * 01880020
*   WITH MODULES  IGG019KA, IGG019KQ.                                 * 01900020
*                                                                       01920020
*                                                                       01940020
*                                                                       01960020
         USING IGG019KM,SF1BASE                                         01980020
         USING IOBSTDRD,IOBREG                                   Y02072 02000002
         USING IHADCB,DCBREG                                            02020020
         USING DECBDEF,DECBREG                                          02040020
*                                                                       02060020
*              REGISTER USAGE                                           02080020
*                                                                       02100020
R0       EQU   0                        WORK REGISTER ZERO       20201  02110020
R1       EQU   1                        PARM REG CONTAINING IOB  Y02072 02112002
*                                       (COMPLEMENTED) FOR SVC53 Y02072 02114002
WKREG2   EQU   1                        WORKING REGISTER                02120002
REG2     EQU   2                        SRCH/ID PTR HOLD REGISTER       02130020
*                                       VERIFY MODULE                   02140020
DEBREG   EQU   3                        DEB ADDRESS                     02160002
DCBREG   EQU   4                        DCB ADDRESS                     02180002
DECBREG  EQU   5                        DECB ADDRESS                    02200002
CCWIND   EQU   6                        CHANNEL COMMAND INDEX           02220002
WKREG0   EQU   6                        WORKING REGISTER                02260002
IOBREG   EQU   7                        IOB ADDRESS                     02270002
UCBREG   EQU   7                        ADDRESS OF DEVICE TABLE ENTRY   02280002
RQEREG   EQU   7                        RQE BASE REGISTER        Y02072 02290002
UTIL     EQU   8                        UTILITY REGISTER                02300020
SECTOR   EQU   8                        POINTER TO SECTOR VALUES 20201  02310020
WKREG3   EQU   9                        WORK REGISTER                   02320002
SFBASE   EQU   10                       BASE REGISTER FOR PART TWO      02340002
FDNBASE  EQU   11                       BASE FOR FOUNDATION MODULE      02360002
WKREG1   EQU   11                       WORKING REGISTER                02380020
INTREG   EQU   12                       INTERNAL RETURN FOR THIS MODULE 02400002
PARAM    EQU   12                       IOB REGISTER                    02420002
DCBREG2  EQU   13                       DCB REGISTER FOR PART TWO       02440002
WKREG4   EQU   14                       WORKING REGISTER                02460020
RETREG   EQU   14                       RETURN TO FOUNDATION MODULE     02480002
SF1BASE  EQU   15                       BASE REGISTER FOR PART ONE      02500002
*                                                                       02520020
*                                                                       02540020
         BC    15,IECDSF1              ENTRY FROM FOUNDATION MODULE     02560020
VCONKY   DC    V(IGG019KY)             EXTENDED SEARCH ADDR SLOT Y02072 02580002
         BC    15,IECDSF2-IGG019KM(0,SFBASE)                            02600020
IECDSF1  EQU   *                                                        02620020
         SR    REG2,REG2                ZERO OUT AN INDEX        20201  02621020
*                                       REGISTER                 20201  02622020
         TM    IOBDCPND,YESCARN         IS RPS FEATURED          20201  02623020
         BNO   NOTCARN1                 NO, BEGIN REGULAR CHAN   20201  02624020
*                                       PROG.                    20201  02625020
         LA    REG2,FULLCCW             INCREMENT INDEX FOR RPS  20201  02626020
         L     SECTOR,IOBDCPND          GET SECTOR ADDR IF RPS   20201  02627020
         LA    SECTOR,TWOBYTE(R0,SECTOR) PT TO SECT=0 LOCATION   20201  02628020
         ST    SECTOR,D0(R0,CCWIND)     ST IT IN SET SECT CCW    20201  02629020
         MVI   D0(CCWIND),SETSECT       PUT IN SET SECT COMMAND  20201  02630020
         MVC   HALFCCW(HALFCCW,CCWIND),FLGCNT  PUT IN FLAG/COUNT 20201  02631020
*                                       FIELD                    20201  02632020
         LA    CCWIND,FULLCCW(R0,CCWIND) PT TO NEXT CCW - CCW2   20201  02633020
NOTCARN1 EQU   *                                                 20201  02634020
         ST    CCWIND,8(0,CCWIND)       SET TIC ADDR. IN CCW2           02640020
         ST    CCWIND,D48(REG2,CCWIND)  SET PRIOR RECORD SEARCH  20201  02660020
*                                        ARGUMENT ADDR. IN CCW7         02680020
         LA    WKREG2,IOBDNCRF          LOAD ADDRESS OF THE NEW  Y02072 02700002
*                                       RECORD COUNT FIELD IN THE IOB   02720002
         ST    WKREG2,16(0,CCWIND)      SET CAPACITY RECORD INPUT ADDR. 02740002
*                                        IN CCW3                        02760020
         ST    WKREG2,D64(REG2,CCWIND)  SET NEW REC CNT FIELD    20201  02780020
*                                        ADDRESS IN CCW9                02800020
         LA    WKREG2,IOBCC             LOAD ADDRESS OF CAP REC  Y02072 02820002
         ST    WKREG2,D40(REG2,CCWIND)  SET CAPACITY REC OUTPUT  20201  02850020
*                                       ADDR IN CCW6                    02860002
         ST    WKREG2,0(0,CCWIND)       SET CAPACITY RECORD SEARCH      02900020
*                                       ARGUMENT ADDR. IN CCW1          02920002
         MVI   0(CCWIND),SCHID          SET SEARCH ID OP-CODE IN CCW1   02940020
         LR    REG2,CCWIND              LOAD PARAM REG TO C.P.START     02950020
         LR    WKREG2,CCWIND            LOAD PARAM REG TO START OF C.P. 02960002
         MVC   4(5,CCWIND),SCHCON       SET SEARCH ID FLAG AND COUNT IN 02980020
*                                       CCW1 AND TIC OP-CODE IN CCW2    03000002
         MVI   16(CCWIND),READD         SET READ DATA OP-CODE IN CCW3   03020020
         MVI   20(CCWIND),SILI          SET SILI FLAG IN CCW3           03040020
         MVI   23(CCWIND),SEVEN         SET COUNT OF SEVEN IN CCW3      03060020
         LA    CCWIND,24(0,CCWIND)      SET POINTER TO CCW4             03080020
         TM    IOBDCPND,YESCARN         RPS FEATURED             20201  03081020
         BNO   NOTCARN2                 NO, THEN GO SEE ABOUT    20201  03082020
*                                       TIC                      20201  03083020
         ST    SECTOR,D0(R0,CCWIND)     PUT SECT=0 ADDR IN CCW   20201  03084020
         MVI   D0(CCWIND),SETSECT       PUT IN SET SECT COMMAND  20201  03085020
         MVC   HALFCCW(HALFCCW,CCWIND),FLGCNT  PUT IN FLAG/COUNT 20201  03086020
*                                       FIELD                    20201  03087020
         LA    CCWIND,FULLCCW(R0,CCWIND) PT TO NEXT CCW          20201  03088020
NOTCARN2 EQU   *                                                 20201  03089020
*                                                                       03090020
*          IF RPS IS FEATURED, THEN ALL CCWS REFERRED TO IN THE REMARK  03091020
*           FIELD MUST BE INCREASED BY TWO                              03092020
*                                                                       03093020
         ST    CCWIND,8(0,CCWIND)       SET TIC ADDR. IN CCW5           03100020
         MVC   4(5,CCWIND),SCHCON       SET SEARCH ID FLAG AND COUNT IN 03120020
*                                       CCW4 AND TIC OP-CODE IN CCW5    03140002
         LA    WKREG2,IOBUPLIM                                          03160020
         ST    WKREG2,0(0,CCWIND)       SET CAPACITY RECORD SEARCH      03180020
*                                       ARGUMENT ADDR. IN CCW4          03200002
         MVI   0(CCWIND),SCHID          SET SEARCH ID OP-CODE IN CCW4   03220020
         MVI   16(CCWIND),WRTD          SET WRITE DATA OP-CODE IN CCW6  03240020
         MVI   24(CCWIND),SCHID         SET SEARCH ID OP-CODE IN CCW7   03260020
*                                                                       03280020
         MVI   20(CCWIND),CCSI          SET CC AND SILI FLAGS IN CCW6   03300020
         MVI   23(CCWIND),SEVEN         SET COUNT OF SEVEN IN CCW6      03320020
*                                                                       03340020
         LA    CCWIND,24(0,CCWIND)      SET POINTER TO CCW7             03360020
         ST    CCWIND,8(0,CCWIND)       SET TIC ADDR. IN CCW8           03380020
         MVC   4(5,CCWIND),SCHCON       SET SEARCH ID FLAG AND COUNT IN 03400020
*                                       CCW7 AND TIC OP-CODE IN CCW8    03420002
         MVI   16(CCWIND),WRTCKD        SET WRITE OP-CODE IN CCW9       03440002
         MVI   23(CCWIND),EIGHT         SET COUNT OF EIGHT IN CCW9      03460020
         LA    CCWIND,16(0,CCWIND)      SET POINTER TO CCW9             03480020
         CLI   DCBKEYLE,ZERO            IS KEY LENGTH IN DCB ZERO       03500020
         BC    8,NOKEY                  YES  BYPASS WRITE KEY           03520002
         MVC   9(3,CCWIND),DECKYADR+1   NO-MOVE KEY ADDR. FROM DECB     03540002
*                                       TO CCW10                        03560002
         MVI   4(CCWIND),DCCC           SET DC,CC FLAGS IN CCW9         03580020
         MVC   15(1,CCWIND),DCBKEYLE    SET COUNT IN CCW10 TO KEY LNGTH 03600020
         LA    CCWIND,8(0,CCWIND)                                       03620020
NOKEY    EQU   *                                                        03640020
         CLC   DECLNGTH(2),14(CCWIND)   IS DATA LENGTH ZERO             03660020
         BCR   8,RETREG                 YES-END OF FILE MARK IS BEING   03680020
*                                       WRITTEN    CHANNEL PROGRAM      03700002
*                                       COMPLETED,RETURN TO FOUNDATION  03720002
*                                       MODULE                          03740002
         MVI   4(CCWIND),DCCC           SET DC,CC FLAGS IN PRIOR CCW    03760020
         MVC   9(3,CCWIND),DECAREA+1    MOVE AREA ADDR FROM DECB TO CCW 03780020
         MVC   14(2,CCWIND),DECLNGTH    MOVE DATA LENGTH FROM DECB TO   03800020
*                                       CCW                             03820002
         LA    CCWIND,8(0,CCWIND)       SET POINTER TO END OF CHANNEL   03840020
*                                       PROGRAM                         03860002
         TM    IOBDTYPE,IOBVERFY        IS VERIFY OPT SPECIFIED  Y02072 03880002
         BZR   RETREG                   NO-RET TO FOUNDATION MOD Y02072 03900002
*                                       FOR VERIFY                      03920002
         TM    IOBDCPND,YESCARN         IS RPS DINGING AROUND    20201  03920620
         BNO   NOTCARN3                 NO,SEE ABOUT             20201  03921220
*                                       WRITE-VERIFY             20201  03921820
         OI    HALFCCW(CCWIND),CCHN     ELSE,SET COMMAND         20201  03922420
*                                       CHAINING                 20201  03923020
         BCTR  SECTOR,R0                PT TO SECTOR2            20201  03923620
         ST    SECTOR,FULLCCW(R0,CCWIND) ST PTR IN NEXT CCW -14  20201  03924220
         MVI   FULLCCW(CCWIND),RDSECT   PUT IN READ SECTOR OP    20201  03924820
*                                       CODE                     20201  03925420
         MVC   CARN12(HALFCCW,CCWIND),FLGCNT  FILL FLAG/COUNT    20201  03926020
*                                       FIELD                    20201  03926620
         LA    CCWIND,FULLCCW(R0,CCWIND) SKIP OVER CCW JUST PUT  20201  03927220
*                                         IN                            03927820
NOTCARN3 EQU   *                                                 20201  03928420
         LR    WKREG2,REG2              LOAD PARAM REG TO C.P. START    03930020
         L     SFBASE,12(0,FDNBASE)     LOAD ADDRESS OF VERIFY MODULE   03940002
         BR    SFBASE                   GO CONSTRUCT VERIFY CCWS        03960020
*                                       VERIFY MODULE WILL RETURN TO    03980002
*                                       FOUNDATION ON REGISTER 14       04000002
*                                                                       04020020
*        THIS PORTION OF THE SELF-FORMAT MODULE CALCULATES THE NUMBER   04040020
*        OF BYTES REQUIRED FOR THE NEW RECORD                           04060020
*                                                                       04080020
         DROP  IOBREG,DCBREG,DECBREG    CHANGE IOB AND DCB REGISTERS TO 04100020
         DROP  SF1BASE                                                  04120020
         USING IGG019KM,SFBASE                                          04140020
         USING IOBSTDRD,PARAM           THOSE USED BY ASI RTN    Y02072 04160002
         USING IHADCB,DCBREG2                                           04180002
         USING DECBDEF,UTIL                                             04200020
IECDSF2  EQU   *                                                        04220020
         LR    PARAM,WKREG2             LOAD IOB POINTER                04240020
         SR    WKREG2,WKREG2            CLEAR WORK REGISTER             04260020
         CLC   IOBCC(CCHHLG),IOBDNCRF   IS CAPACITY RECORD VALID Y02072 04266002
         BNE   NOFIT                    NO--SKIP THIS TRACK       16681 04272020
         MVC   IOBCC(CCHHRUU),IOBDNCRF  MOVE CAPACITY REC PRIOR  Y02072 04280002
*                                       TO SETTING UP NEW CHANNEL PROG  04300002
*                                       FIELDS                          04320002
*                                                                       04340020
*        OBTAIN DEVICE CODE FROM UCB                                    04360020
*                                                                       04380020
         USING RQE,RQEREG               ESTABLISH RQE BASE       Y02072 04390002
         L     UCBREG,RQEUCB            LOAD UCB OUT OF RQE      Y02072 04392002
         DROP  RQEREG                                            Y02072 04394002
*                                                                       04420020
         L     WKREG1,CVTPTR(0,0)       LOAD THE ADDRESS OF THE         04440002
*                                       COMMUNICATION VECTOR TABLE CVT  04460002
         L     WKREG1,CVTZDTAB-CVTDEF(0,WKREG1)   LOAD ADDRESS OF       04480020
*                                       DEVICE TABLE FROM CVT           04500020
         IC    WKREG2,TYPCD(UCBREG)     LOAD DEVICE CODE FROM UCB       04520020
         N     WKREG2,LASTFOUR          CLEAR ALL BUT LOW ORDER 4 BITS  04540020
         IC    WKREG2,0(WKREG2,WKREG1)  FIND ENTRY OFFSET               04560020
         LA    UCBREG,0(WKREG2,WKREG1)  SET POINTER TO DESIRED ENTRY    04580002
MAKECALC EQU   *                                                        04600020
         L     UTIL,IOBECBPT            SET DECB POINTER                04620020
*                                                                       04640020
         IC    WKREG2,DCBKEYLE          PICK UP KEY LENGTH FROM THE DCB 04660002
         STC   WKREG2,IOBDNCRF+CCHHRLG  PUT KEY LG AND DATA LG   Y02072 04680002
         MVC   IOBDNCRF+CCHHRKLG(L'DECLNGTH),DECLNGTH IN NEW REC Y02072 04700002
*                                       COUNT FIELD              Y02072 04710002
         TM    IOBSTAT1,IOBPASS2        IS THIS THE FIRST TIME   Y02072 04720002
*                                       THRU ROUTINE FOR THIS REQUEST   04740002
         BC    1,NOCALC                 NO, BYPASS CALCULATION          04760002
*                                                                       04780020
*        CALCULATE BYTES REQUIRED FOR NEW RECORD                        04800020
*                                                                       04820020
CALC     SR    WKREG4,WKREG4                                            04840020
         LTR   WKREG2,WKREG2            IS KEY LENGTH ZERO              04860020
         BC    2,KEYED                  NO                              04880020
         IC    WKREG4,OVERK(0,UCBREG)   LOAD VALUE TO BE SUBTRACTED     04900002
*                                       FROM OVERHEAD FOR NON-KEYED     04920002
*                                       RECORDS                         04940002
KEYED    EQU   *                                                        04960020
         AH    WKREG2,DECLNGTH          ADD DATA LENGTH TO KEY LENGTH   04980020
         SR    WKREG3,WKREG3                                            05000020
         IC    WKREG3,OVERL(0,UCBREG)   LOAD OVERHEAD FOR LAST RECORD   05020002
         TM    FLAG(UCBREG),TBOVHD      TWO BYTE OVERHEAD USED   20201  05024020
         BNO   MZ0010                   BRANCH NO                20201  05028020
         LH    WKREG3,OVERI(UCBREG)     GET TWO BYTE OVERHEAD    20201  05032020
MZ0010   EQU   *                                                 20201  05036020
         SR    WKREG3,WKREG4            SUBTRACT NO KEY OVERHEAD        05040020
         AR    WKREG2,WKREG3            ADD OVERHEAD FOR LAST RECORD TO 05060020
*                                       RECORD LENGTH                   05080020
         STH   WKREG2,IOBDBYTN+2        STORE BYTES REQUIRED FOR LAST   05100020
*                                        RECORD INTO IOB                05120020
         SR    WKREG2,WKREG3            RESTORE REG2 TO KEY+DATA LENGTH 05140020
         IC    WKREG3,OVERI(0,UCBREG)   LOAD OVERHEAD FOR NOT LAST REC. 05160002
         TM    FLAG(UCBREG),TBOVHD      TWO BYTE OVERHEAD USED   20201  05164020
         BNO   MZ0020                   BRANCH NO                20201  05168020
         LH    WKREG3,OVERI(UCBREG)     GET TWO BYTE OVERHEAD    20201  05172020
MZ0020   EQU   *                                                 20201  05176020
         MH    WKREG2,TOLER(0,UCBREG)   MULTIPLY KEY+DATA LENGTH BY     05180002
*                                       TOLERANCE FACTOR                05200002
         SRA   WKREG2,9                 DIVIDE RESULT BY 512            05220020
NOTOL    SR    WKREG3,WKREG4            SUBTRACT NO KEY OVERHEAD FROM   05240020
*                                       KEYED OVERHEAD                  05260002
         AR    WKREG2,WKREG3            ADD OVERHEAD BYTES TO RECORD    05280020
*                                       LENGTH                          05300002
         STH   WKREG2,IOBDBYTN          STORE RESULT IN IOB             05320020
         OI    IOBSTAT1,IOBPASS2        SET FIRST TIME INDICATOR Y02072 05340002
*                                       IN IOB                          05360002
*                                                                       05380020
*        DETERMINE IF RECORD WILL FIT ON THIS TRACK                     05400020
*                                                                       05420020
NOCALC   EQU   *                                                        05440020
         LH    WKREG4,IOBDBYTR          LOAD REMAINING BYTE COUNT READ  05460020
*                                       IN FROM CAPACITY RECORD         05480002
         CH    WKREG4,IOBDBYTN+2        WILL RECORD FIT AS LAST RECORD  05500020
*                                       ON THE TRACK                    05520002
         BC    4,NOFIT                  NO                              05540020
RECFIT   EQU   *                                                 20201  05542020
         CLI   IOBCHNPR,SETSECT         IS IT RPS                Y02072 05544002
*                                       INSTRUCTION              20201  05546020
         BNE   NOTCARN4                 IF NOT, DONT INCREMENT   20201  05548020
         MVC   IOBCHNPR+FULLCCW(CCHHRLG),IOBCC MOVE HI ID FROM   Y02072 05550002
*                                       CAPACITY RECORD TO CCW2 IF RPS  05552002
         B     NEXT01                   BRANCH                   20201  05556020
NOTCARN4 EQU   *                                                 20201  05558020
         MVC   IOBCHNPR(CCHHRLG),IOBCC  MOVE HI ID FROM CAPACITY Y02072 05560002
*                                       RECORD TO CCW1 IF NOT RPS       05571602
NEXT01   EQU   *                                                 20201  05574402
         SR    WKREG3,WKREG3            CLEAR REGISTER           20201  05577202
*                                       TO CCW1                         05580020
         IC    WKREG3,IOBR              LOAD R OF HI ID          Y02072 05600002
         LA    WKREG3,1(0,WKREG3)       ADD ONE TO R VALUE              05620020
         STC   WKREG3,IOBDNCRF+CCHHLG   STORE NEW RECORD ID      Y02072 05640002
         MVC   IOBUPLIM(CCHHLG),IOBCC   SET CAP REC SEARCH CCHH  Y02072 05660002
         NI    IOBUPLIM+CCHHLG,ZERO     SET CAPACITY REC SRCH R  Y02072 05680002
         STC   WKREG3,IOBR              SET HI ID IN CAP REC     Y02072 05700002
         SH    WKREG4,IOBDBYTN          SUBTRACT NOT LAST RECORD SIZE   05720020
*                                       FROM BYTES REMAINING ON TRACK   05740002
         LTR   WKREG4,WKREG4            DID BYTE COUNT GO         25010 05742020
*                                       NEGATIVE                  25010 05744020
         BP    STORE                    NO, BR TO STORE BYTE      25010 05746020
*                                       COUNT                     25010 05748020
         SR    WKREG4,WKREG4            YES, ZERO BYTE COUNT SO   25010 05750020
*                                       A NEGATIVE COUNT WILL NOT BE    05752020
*                                       WRITTEN IN THE R0 ON DISK.      05754020
STORE    EQU   *                                                  25010 05756020
         STH   WKREG4,IOBDBYTR          STORE RESULT INTO NEW CAPACITY  05760020
*                                       RECORD                          05780002
         OI    IOBSTAT1,IOBADDVU        INDICATE THAT RECORD FIT Y02072 05800002
         LA    WKREG2,IOBCHNPR+WRTCCW   LOAD ADDR. OF WRITE CP   Y02072 05820002
         CLI   IOBCHNPR,SETSECT         IS IT RPS CHAN PGM       Y02072 05824002
         BNE   NOTCARN5                 IF NOT, DONT INCREMENT   20201  05828020
         LA    WKREG2,FULLCCW(R0,WKREG2)  C. P. POINTER TO CCW5  20201  05832020
*                                                                       05834002
*                                                                       05834402
NOTCARN5 EQU   *                                                 20201  05836020
         ST    WKREG2,IOBSTART          SET IN CHAN. PROG. START ADDR.  05840020
         L     WKREG1,IOBECBPT          SAVE USER ECB ADDR      SA53787 05860002
         LA    WKREG2,IOBCSW+3          GET ADDR OF AREA TO USE  Y02072 05866002
         ST    WKREG2,IOBECBPT          AS ECB FOR THIS EXCP    SA53787 05872002
         ST    WKREG1,IOBDQPTR          SAVE USER ECB PTR IN IOB Y02072 05874002
*                                       IT WILL BE RESTORED TO   Y02072 05876002
*                                       IOBECBPT BY THE CEA OR   Y02072 05878002
*                                       EOE APPENDAGE            Y02072 05878402
         EXCP  (12)                                                     05880002
*                                                                       05900020
         SVC   EXIT                                                     05940020
NOFIT    EQU   *                                                        05960020
*                                                                       05970002
*   ISSUE AN SVC 53 SO THAT IGC0005C CAN DEQ THIS TRACK FROM THE READX  05972002
*   LIST AND THE SYSTEM QUEUE.  IGC0005C EXPECTS THE IOB TO BE IN REG 1 05974002
*   COMPLEMENTED, TO DISTINGUISH THIS FROM A RELEX REQUEST. UPON RETURN 05976002
*   REG 0 WILL CONTAIN THE NEXT IOB WAITING FOR CONTROL OF THIS TRACK,  05978002
*   IF THERE IS ONE.                                                    05978102
*                                                                       05978402
         LCR   R1,PARAM                 PUT IOB COMPLEMENT IN R1 Y02072 06009202
*                                                                       06010802
         SVC   53                       GO TO IGC0005C           Y02072 06018802
*                                                                       06019202
         LR    WKREG0,R0                SAVE CONTENTS OF R0      Y02072 06029202
*                                                                       06031202
* NOTE: REGISTER 6 NOW CONTAINS THE ADDRESS OF THE FIRST IOB WAITING    06039202
*   ON THE UNPOSTED QUEUE ASSOCIATED WITH TRACK JUST RELEASED. IT WILL  06039602
*   CONTAIN ZEROES IF NO IOB WAS WAITING.  THIS REGISTER MUST BE SAVED  06039702
*   FOR ALL SUBSEQUENT PROCESSING IN THIS MODULE AND THOSE MODULES      06039802
*   IT MAY GIVE CONTROL TO, (EG. 19KY, 19KA(ASI+12 PATH),IGC0005C)      06039902
*   FOR THE DURATION OF THIS REQUEST.                                   06046602
*                                                                       06048602
         TM    IOBSTAT1,IOBADDVU        DID RECORD FIT           Y02072 06053302
         BZ    XSCHLNK                  NO TEST FOR EXTENDED SEARCH     06060020
NEXTIOB  EQU   *                        SEE IF IOB WAITING       Y02072 06070002
         LTR   WKREG0,WKREG0            WAS AN IOB FOUND WAITING Y02072 06080002
*                                       FOR THE TRACK JUST FREED Y02072 06100002
         BZ    GOBACK                   NO, RETURN TO FOUNDATION MODULE 06120020
         SR    WKREG2,WKREG2            CLEAR REGISTER            14231 06140020
         LR    PARAM,WKREG0             GET IOB INTO RIGHT REG    14231 06160020
         MVC   IOBCC(CCHHRUU),IOBDNCRF  SAVE SEEK AND BYTE COUNT Y02072 06180002
         B     MAKECALC                 YES, SEE IF THIS RECORD FITS    06200002
*                                                                       06220020
XSCHLNK  TM    IOBDTYPE,IOBEXTSC        IS EXTENDED SEARCH OPT   Y02072 06240002
         BZ    SETABNOR                 NO, ERROR CONDITION      Y02072 06260002
         L     SF1BASE,VCONKY           YES-LOAD BASE ADDR FOR   Y02072 06280002
*                                       EXTENDED SEARCH MODULE          06300002
         BALR  RETREG,SF1BASE           GO TO EXTENDED SEARCH MODULE    06320020
         B     KMENQ                    IF EXCP IS TO BE ISSUED GO FOR  06340002
*                                       EXCLUSIVE CONTROL OF THIS REC   06360002
*                                       RETURN FROM EXTENDED SEARCH AT  06380002
*                                       THIS INSTRUCTION INDICATES      06400002
*                                       ANOTHER TRACK WAS FOUND ELSE    06420020
*                                       RETURN IS TO NEXT INSTRUCTION   06440020
*                                                                       06460020
*   THE FOLLOWING SETS THE ABNORMAL COMPLETION BITS AND BRANCHES BACK   06470002
*   TO THE ASI+12. THE ASI WILL CLEAN UP, POST THE CUR IOB COMPLETE,    06472002
*   MAKE IT AVAILABLE IF REQUIRED, AND RETURN TO THIS MODULE,BRANCHING  06474002
*   ON THE ADDRESS THIS MODULE HAS SET UP AND STORED IN THE IOBDQPTR.   06476002
*   THE ASI, THROUGHOUT ITS CLEANUP MUST MAINTAIN THE CONTENTS OF       06478002
*   REGISTER 6, WHICH CONTAIN THE IOB ADDRESS OF THE NEXT IOB TO        06478102
*   RECEIVE CONTROL OF THE TRACK.  UPON RETURN FROM THE ASI, THIS MOD   06478202
*   WILL INITIATE PROCESSING FOR THE NEXT IOB.                          06478302
*                                                                       06478402
SETABNOR OI    IOBSTAT1,IOBABNRM        SET ABNORMAL COMPLETION  Y02072 06480002
         MVI   IOBSTAT2,NOSPA           SET NO SPACE FOUND       Y02072 06500002
*                                       EXCEPTION CODE                  06520002
         LA    WKREG3,NEXTIOB           GET RETURN ADDRESS FROM ASI     06540002
         ST    WKREG3,IOBDQPTR          STORE IN ASI RETURN FIELD       06560002
         L     FDNBASE,DCBREAD          GET ADDRESS OF FOUNDATION       06580002
         L     FDNBASE,ASIOFF(0,FDNBASE)  GET ADDR OF ASI ROUTINE       06600002
         LR    WKREG2,PARAM             PUT IOB ADDR INTO REG ASI WANTS 06620002
         LR    SF1BASE,FDNBASE          GET ASI ADDRESS INTO TWO REGS   06640002
         B     POOLOFF(0,FDNBASE)       BRANCH TO POST THE REQUEST      06660020
KMENQ    NI    IOBSTAT1,X'FF'-IOBENQUE  TURN OFF INDICATION THAT Y02072 06680002
*                                       RECORD WAS ENQUEUED             06682002
*                                                                       06690002
*   ISSUE AN SVC 53 SO THAT IGC0005C CAN ADD THIS NEW TRK TO THE READX  06692002
*   LIST AND THE SYSTEM QUEUE, OR PUT THIS IOB ON THE UNPOSTED QUEUE    06694002
*   WAITING FOR THE TRACK. IGC0005C EXPECTS THE IOB, TO BE IN REG 1,    06696002
*   (COMPLEMENTED TO DISTINGUISH THIS FROM RELEX REQUEST).              06698002
*                                                                       06698402
         LCR   R1,PARAM                 PUT IOB COMPLEMENT IN R1 Y02072 06698802
*                                                                       06699802
         SVC   53                       GO TO IGC0005C           Y02072 06699902
*                                                                       06706602
         B     NEXTIOB                  GO TO HANDLE NEXT IOB WAITING   06760002
*                                       FOR CONTROL OF TRACK RELEASED   06770002
*                                       BEFORE THIS NEW TRACK WAS REQ.  06772002
GOBACK   EQU   *                                                        06780020
         SVC   EXIT                     RETURN TO SUPERVISOR            06800002
         EJECT                                                          06802002
*********************************************************************** 06810002
*              CONSTANTS AND EQUATES                                  * 06820002
*********************************************************************** 06840020
NOREAD   EQU   X'F7'                                                    06900020
RCDFIT   EQU   X'02'                                                    06920020
ENQD     EQU   X'08'                                                    06940020
NOTENQD  EQU   X'F7'                                                    06960020
EXCP     EQU   0                        EXCP SVC NO.                    06980020
EXIT     EQU   3                        EXIT SVC NO.                    07000020
DEVSZ    EQU   0                        DEVICE SIZE CCHH                07020002
TRKLNGTH EQU   4                        TRACK LENGTH                    07040002
OVERI    EQU   6                        OVERHEAD NOT LAST RECORD        07060002
OVERL    EQU   7                        OVERHEAD LAST RECORD            07080002
OVERK    EQU   8                        OVERHEAD KEYED RECORD           07100002
FLAG     EQU   9                        FLAG                            07120002
TOLER    EQU   10                       TOLERANCE                       07140002
*        CCW FLAGS AND COUNT                                            07160020
         DS    0F                                                       07180020
LASTFOUR DC    X'0000000F'                                              07200020
SCHCON   DC    X'4000000508'            COMMAND CHAIN WITH COUNT OF 5   07220020
*                                       PLUS TIC OP-CODE                07240002
ASIOFF   EQU   16                       ASI ADDR SLOT IN FOUNDATION     07260002
FDBOFF   EQU   4                        FEEDBACK BRANCH IN ASI          07280002
POOLOFF  EQU   12                       IOB POOL BRANCH IN ASI          07300002
FIRST    EQU   X'10'                                                    07320020
CFORFLG  EQU   X'08'                    CAUSED FORMAT FLAG              07340020
CLRFFLAG EQU   X'FE'                                                    07360020
*        CHANNEL PROGRAM OP-CODES                                       07380020
SCHID    EQU   X'31'                    SEARCH ID EQUAL                 07400020
TIC      EQU   X'08'                    TRANSFER IN CHANNEL             07420020
READD    EQU   X'06'                    READ DATA                       07440020
WRTD     EQU   X'05'                    WRITE DATA                      07460020
WRTCKD   EQU   X'1D'                    WRITE COUNT KEY DATA            07480020
*        CCW FLAGS                                                      07500020
DCSKFLG  EQU   X'F0'                    CD CC SILI SKIP FLAG BITS       07520020
DCCC     EQU   X'C0'                    DATA + COMMAND CHAIN            07540002
SKIP     EQU   X'10'                    SKIP DATA TRANSFER              07560020
CC       EQU   X'40'                    COMMAND CHAIN                   07580020
SILI     EQU   X'20'                    SUPPRESS INCORRECT LENGTH       07600020
CCSI     EQU   X'60'                    COMMAND CHAIN  SUPPRESS LENGTH  07620020
ONE      EQU   X'1'                                                     07640020
FIVE     EQU   X'5'                                                     07660020
SEVEN    EQU   X'7'                                                     07680020
EIGHT    EQU   X'8'                                                     07700020
ZERO     EQU   X'0'                                                     07720020
TYPCD    EQU   19                       DA TYPE CODE OFFSET IN UCB      07740020
ABNORM   EQU   X'80'                    ABNORMAL COMPLETION INDICATOR   07760020
FOR1     EQU   X'02'                    TEST FOR FORMAT 1               07780020
*              EXCEPTION CODES                                          07800020
NOREC    EQU   X'80'                                                    07820020
LGNCK    EQU   X'40'                                                    07840020
NOSPA    EQU   X'20'                                                    07860020
INVAL    EQU   X'10'                                                    07880020
UNCOR    EQU   X'08'                                                    07900020
ENDOD    EQU   X'04'                                                    07920020
UNREL    EQU   X'02'                                                    07940020
*              OPTIONS AND TYPE                                         07960020
VERIFY   EQU   X'80'                                                    07980020
OFLOW    EQU   X'40'                                                    08000020
EXSCH    EQU   X'20'                                                    08020020
FEEDB    EQU   X'10'                                                    08040020
ACTAD    EQU   X'08'                                                    08060020
DYNBF    EQU   X'04'                                                    08080020
READX    EQU   X'02'                                                    08100020
RELRD    EQU   X'01'                                                    08120020
KEYOP    EQU   X'80'                                                    08140020
LGNOP    EQU   X'40'                                                    08160020
READ     EQU   X'08'                                                    08180020
KEY      EQU   X'04'                                                    08200020
ADD      EQU   X'02'                                                    08220020
*                                                                       08220620
*  CODES AND CONSTANTS USED BY RPS                                      08221220
*                                                                       08221820
FLGCNT   DC    X'40000001'              FLAG-COUNT FIELD FOR     20201  08222420
*                                       CARNIVAL                 20201  08223020
*                                                                       08223620
D0       EQU   0                        ZERO DISPLACEMENT        20201  08224220
TWOBYTE  EQU   2                        2-BYTE DISPLACEMENT OR   20201  08224820
*                                       LENGTH                   20201  08225420
D3       EQU   3                        3 BYTE DISPLACEMENT      20201  08226020
HALFCCW  EQU   4                        4-BYTE DISPLACEMENT OR   20201  08226620
*                                       LENGTH                   20201  08227220
CCHHLG   EQU   4                        LENGTH OF CCHH           Y02072 08227602
CCHHRLG  EQU   5                        LENGTH OF CCHHR          Y02072 08227702
CCHHRKLG EQU   6                        LENGTH OF CCHHR+KEY LG   Y02072 08228002
CCHHRUU  EQU   7                        LENGTH OF CCHHR+UNUSED   Y02072 08228402
*                                       OR AVAILABLE BYTES ON TRKY02072 08228802
FULLCCW  EQU   8                        8-BYTE DISPLACEMENT OR   20201  08229602
*                                       LENGTH                   20201  08229902
D8       EQU   8                        8 BYTE DISPLACEMENT      20201  08230202
D10      EQU   10                       10 BYTE DISPLACEMENT     20201  08230502
CARN12   EQU   12                       1-1/2 CCW DISPLACEMENT   20201  08230802
TWOCCW   EQU   16                       2 CCW DISPLACEMENT       20201  08231102
CARN20   EQU   20                       2-1/2 CCW DISPLACEMENT   20201  08231420
WRTCCW   EQU   24                       3 CCW DISPLACEMENT       Y02072 08231802
*                                       FOR WRITE CCW            Y02072 08232002
D40      EQU   40                       5 CCW DISPLACEMENT       20201  08242202
D48      EQU   48                       6 CCW DISPLACEMENT       20201  08247002
CARN64   EQU   64                       8-CCW LENGTH             20201  08251802
D64      EQU   64                       8 CCW DISPLACEMENT       20201  08256602
*                                                                       08261402
RDSECT   EQU   X'22'                    READ SECTOR COMMAND CODE 20201  08266202
SETSECT  EQU   X'23'                    SET SECTOR COMMAND CODE  20201  08271002
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD INDIC  20201  08275802
CCHN     EQU   X'40'                    COMMAND CHAINING BYTE    20201  08280602
YESCARN  EQU   X'FF'                    RPS TEST BYTE            20201  08285402
*                                                                       08290202
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 08295002
         EJECT                                                          08297002
*********************************************************************** 08299002
*                      DSECTS                                         * 08299402
*********************************************************************** 08299802
*                                                                       08320002
         DCBD  DSORG=DA                                                 08340020
         EJECT                                                          08360020
CVTDEF   DSECT                                                          08380020
         CVT                                                            08400020
         EJECT                                                          08410002
         IECDRQE                                                 Y02072 08412002
         EJECT                                                          08420020
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       08440020
         DS    0F                                                       08460020
DECBDEF  DSECT                                                          08480020
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        08500020
DECTYPE  DS    CL2            TYPE FIELD                                08520020
DECLNGTH DS    CL2            DATA LENGTH                               08540020
DECDCBAD DS    CL4            ADDRESS OF DCB                            08560020
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      08580020
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        08600020
DECKYADR DS    CL4            ADDRESS OF KEY                            08620020
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               08640020
         EJECT                                                          08660020
         IEZIOB                                                  Y02072 08670002
         ORG   IOBRSV35                                          Y02072 08672002
IOBUPLIM DS    XL8                      IOB UPPER LIMIT ADDRESS  Y02072 08674002
         END                                                            09560020
./  ADD  SSI=62680294,NAME=IGG019KN
 TITLE   'IGG019KN - BDAM VARIABLE SPANNED SELF FORMAT MODULE'          00100002
IGG019KN CSECT                                                          00200020
*MODULE NAME - IGG019KN                                               * 00210002
*                                                                     * 00220002
*DESCRIPTIVE NAME - BDAM WRITE ADD FOR VARIABLE SPANNED RECORDS       * 00222002
*                                                                     * 00224002
*COPYRIGHT - NONE                                                     * 00226002
*                                                                     * 00228002
*CHANGE ACTIVITY                                                      * 00228402
*                                                                     * 00228802
*          OS REL 20 CHANGES/DELETIONS                                  00400002
*3574002100,005000-008400,162000,199000-202000,312000-313000     20201  00450020
*0000                                                            M5461  00650020
*          OS REL 21 CHANGES/DELETIONS                                  00700002
*          VS 1-1 CHANGES/DELETIONS                                     00750002
*          VS 2-1 CHANGES/DELETIONS                                     00800002
*                                                                YM3709 00802002
*          VS 1-2 CHANGES/DELETIONS                                     00810002
*                                                               XA00014 00812002
*          VS 2-2 CHANGES/DELETIONS                                     00820002
*557000,616500                                                   Y02072 00830002
*                                                                       00850020
*          CHANGES SUBSEQUENT TO VS2-030                                00860000
*D480000,A477000,A764800-765600                                @ZA12909 00870000
*STATUS CHANGE LEVEL 004                                                00880002
*                                                                       00910020
*FUNCTION/OPERATION- THIS MODULE CONTAINS THREE ROUTINES WHOSE        * 01000020
*   FUNCTIONS ARE,                                                    * 01100020
*   1.CREATE THE CHANNEL PROGRAM REQUIRED TO ADD A NEW BLOCK TO A     * 01200020
*    VRE DATA SET.                                                    * 01300020
*    THE CHANNEL PROGRAM WILL CONSIST OF TWO PARTS, THE FIRST THREE   * 01400020
*    CCWS WILL READ THE CAPACITY RECORD FROM A TRACK, THE SECOND      * 01500020
*    SEQUENCE OF CCWS WILL WRITE THE NEW RECORD AND UPDATE THE        * 01600020
*    CAPACITY RECORD.                                                 * 01700020
*                                                                     * 01800020
*   2.CALCULATE THE NUMBER OF BYTES THE NEW BLOCK WILL REQUIRE ON THE * 01900020
*    TRACK AND COMPARE THAT VALUE TO THE NUMBER OF UNUSED BYTES       * 02000020
*    REMAINING ON THE TRACK ACCORDING TO THE CAPACITY RECORD. IF THE  * 02100020
*    BLOCK WILL FIT, THE COUNT FIELD FOR THE NEW BLOCK AND AN UPDATED * 02200020
*    CAPACITY RECORD ARE FORMED AND THE SECOND PART OF THE CHANNEL    * 02300020
*    PROGRAM IS SCHEDULED VIA THE EXCP MACRO. IF THE BLOCK WILL NOT   * 02400020
*    FIT,THE CAPACITY RECORD OF THE NEXT TRACK IS ENQ'ED AND READ     * 02500020
*    (VIA MODULE IGG019LG) AND THE COMBINED SPACE EXAMINED.  THIS     * 02600020
*    PROCESS CONTINUES UNTIL EITHER ENOUGH SPACE IS OBTAINED, IN WHICH* 02700020
*    CASE THE FIRST SEGMENT IS WRITTEN, OR A NON-EMPTY TRACK OR A     * 02800020
*    VOLUME SWITCH IS ENCOUNTERED.  FOR THESE CASES, THE SEARCH LIMIT * 02900020
*    IS CHECKED AND IF REACHED, THE REQUEST IS TERMINATED WITH A NO-  * 03000020
*    SPACE-FOUND INDICATION.  IF THE SEARCH LIMIT WAS NOT REACHED, THE* 03100020
*    TRACKS PREVIOUSLY ENQ'ED ARE DEQ'ED AND THE SEARCH STARTS OVER.  * 03200020
*                                                                     * 03300020
*   3.SEARCH THE UNSCHEDULED QUEUE OF IOBS WHEN THE CURRENT WRITE ADD * 03400020
*    HAS COMPLETED, FOR ANOTHER WRITE ADD REQUEST. THE FIRST SUCH     * 03500020
*    UNSCHEDULED REQUEST FOUND (IF ANY) WILL BE UNQUEUED AND          * 03600020
*    SCHEDULED VIA EXCP.                                              * 03700020
*                                                                     * 03800020
*ENTRY POINTS- THERE ARE THREE ENTRY POINTS AS FOLLOWS,               * 03900020
*   1.   'IECDSF1' IS ENTERED FROM THE FOUNDATION MODULE (IGG019KA)   * 04000020
*     TO PERFORM FUNCTION 1.  CALLING SEQUENCE IS, L    15,DCBDFOR    * 04100020
*                                                  BALR 14,15         * 04200020
*   2.   'IECDSF2' IS ENTERED FROM ASYNCHRONOUS INTERRUPT (IGG019KA)  * 04300020
*     TO PERFORM FUNCTION 2. AND ALSO FUNCTION 3. IF THE BLOCK WILL   * 04400020
*     NOT FIT ON THE TRACK. CALLING SEQUENCE IS, L   15,DCBDFOR       * 04500020
*                                                BC  15,8(15)         * 04600020
*   3.   'IECDSF3' IS ENTERED FROM ASYNCHRONOUS INTERRUPT TO PERFORM  * 04700020
*     FUNCTION 3. CALLING SEQUENCE IS,    L     15,DCBDFOR            * 04800020
*                                         BC    15,12(15)             * 04900020
*                                                                     * 05000020
*INPUT-                                                               * 05100020
*   TO FUNCTION 1.                                                    * 05200020
*    REGISTER 4  DCB ADDRESS                                          * 05300020
*    REGISTER 5  DECB ADDRESS                                         * 05400020
*    REGISTER 6  ADDRESS OF THE LOCATION FOR CCW 1.                   * 05500020
*    REGISTER 7  IOB ADDRESS                                          * 05600020
*    REGISTER 11 BASE ADDRESS OF MODULE IGG019KA                      * 05700020
*    REGISTER 14 RETURN ADDRESS                                       * 05800020
*    REGISTER 15 BASE OF THIS MODULE                                  * 05900020
*                                                                     * 06000020
*   TO FUNCTION 2.                                                    * 06100020
*    REGISTER 1  IOB ADDRESS                                          * 06200020
*    REGISTER 7  RQE (IOS QUEUEING ELEMENT) ADDRESS                   * 06300002
*    REGISTER 13 DCB ADDRESS                                          * 06400020
*    REGISTER 15 BASE ADDRESS FOR THIS MODULE                         * 06500020
*                                                                     * 06600020
*   TO FUNCTION 3.                                                    * 06700020
*    REGISTER 1  IOB ADDRESS                                          * 06800020
*    REGISTER 13 DCB ADDRESS                                          * 06900020
*    REGISTER 15 BASE ADDRESS FOR THIS MODULE                         * 07000020
*                                                                     * 07100020
*OUTPUT- FUNCTION 1 WILL CONSTRUCT THE REQUIRED CCWS AND LEAVE        * 07200020
*   REGISTER 6 POSITIONED AT THE LAST CCW.                            * 07300020
*   FUNCTION 2 WILL FORM THE NEW BLOCK'S COUNT FIELD AND UPDATED      * 07400020
*   CAPACITY RECORD IF THE RECORD FITS OR WILL SET BITS IN THE IOB    * 07500020
*   (IOBDSTAT) IF THERE IS NO SPACE FOR THE BLOCK.                    * 07600020
*   FUNCTION 3 WILL SCHEDULE ANOTHER WRITE ADD IF ONE HAS BEEN        * 07700020
*   QUEUED AWAITING THE CURRENT WRITE'S COMPLETION.                   * 07800020
*                                                                     * 07900020
*EXTERNAL ROUTINES-                                                   * 08000020
*        'IGG019KQ' IS USED TO CONSTRUCT ADDITIONAL CCWS TO VERIFY    * 08100020
*   THE NEW BLOCK IF THE WRITE VALIDITY CHECK OPTION WAS SPECIFIED IN * 08200020
*   THE OPTCD PARAMETER OF THE DCB MACRO. 'IGG019KY' IS USED TO       * 08300002
*   CONSTRUCT THE EXTENDED SEARCH CHANNEL PROGRAM IF SPECIFIED.       * 08310002
*   SVC 53 IS ISSUED TO ENQUEUE AND DEQUEUE ON THE CURRENT TRACK.     * 08360002
*                                                                     * 08400020
*EXITS-NORMAL- 'EXITFDN' IS THE RETURN TO MODULE IGG019KA AFTER THE   * 08500020
*   CHANNEL PROGRAM HAS BEEN CONSTRUCTED.                             * 08600020
*        'EXITSUPV' IS AN SVC EXIT TO RETURN TO SUPERVISOR WHEN THE   * 08700020
*   BLOCK FITS ON THE TRACK AND THE IOB HAS BEEN RESCHEDULED WITH IOS.* 08800020
*EXITS-ERROR - 'EXITERR' IS A RETURN TO THE SUPERVISOR AFTER THE      * 08900020
*   TRACKS HAVE BEEN RELEASED AND THE ERROR CONDITION POSTED.         * 09000020
*                                                                     * 09100020
*TABLES/WORK AREA- THE COMMUNICATION VECTOR TABLE IS REFERENCED TO    * 09200020
*   REACH THE DIRECT ACCESS DEVICE TABLE WHICH SUPPLIES THE DEVICE    * 09300020
*   CHARACTERISTICS NECESSARY TO CALCULATE THE BYTES REQUIRED FOR     * 09400020
*   THIS BLOCK ON THIS DEVICE.                                        * 09500020
*                                                                     * 09600020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT, ENABLED AND RUNS IN USER KEY  * 09700002
*   IT RUNS IN PROBLEM PROGRAM STATE.                                   09750002
*                                                                     * 10000020
*NOTES- THE REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT      * 10100020
*   WITH MODULES  IGG019KJ, IGG019KQ, AND IGG019KY                    * 10200002
*                                                                       10300020
*                                                                       10400020
*                                                                       10500020
*                                                                       10600020
*              REGISTER USAGE                                           10700020
*                                                                       10800020
R0       EQU   0                        PARAMETER REG FOR SVC 53 Y02072 10850002
R1       EQU   1                        PARAMETER REG FOR SVC 53 Y02072 10860002
SCHREG   EQU   1                        PARAMETER REG                   10900020
DEQRTN   EQU   1                        LINK TO DEQ RTN REGISTER        11000020
SWAREG   EQU   2                        SWA ADDRESS                     11100020
SWAPTR   EQU   2                        POINTER TO SWA                  11200020
DEBREG   EQU   3                        DEB ADDRESS                     11300020
W1       EQU   3                        WORK REGISTER                   11400020
DCBREG   EQU   4                        DCB ADDRESS                     11500020
W2       EQU   4                        WORK REGISTER                   11600020
DECBREG  EQU   5                        DECB ADDRESS                    11700020
W3       EQU   5                        WORK REGISTER                   11800020
CCWIND   EQU   6                        ADDRESS OF FIRST CCW            11900020
W4       EQU   6                        WORK REGISTER                   12000020
IOBREG   EQU   7                        IOB ADDRESS                     12100020
UCBREG   EQU   7                        ADDRESS OF DEVICE TABLE ENTRY   12200020
RQEREG   EQU   7                        ADDR OF RQE FOR FUNCT 2  Y02072 12250002
UTIL     EQU   8                        UTILITY REGISTER                12300020
WKREG1   EQU   9                        GENERAL PURPOSE WORK REGISTER   12400020
LGRTN    EQU   9                        LINK TO IGG019LG REGISTER       12500020
SFBASE   EQU   10                       BASE REG FOR IGG019KQ           12600020
FDNBASE  EQU   11                       BASE REG FOR FOUNDATION MOD     12700020
PARAM    EQU   12                       IOB REGISTER                    12800020
DCBREG2  EQU   13                       DCB REGISTER FOR PART TWO       12900020
RETREG   EQU   14                       RETURN ADDRESS TO IGG019KJ      13000020
INTRET   EQU   12                                                       13100020
EPREG    EQU   15                                                       13200020
SF1BASE  EQU   15                       BASE REG FOR PART ONE OF THIS   13300020
*                                       MODULE                          13400020
*                                                                       13500020
*                                                                       13600020
*********************************************************************** 13700020
         USING IGG019KN,SF1BASE                                         13800020
         USING IOBSTDRD,IOBREG                                   Y02072 13900002
         USING IHADCB,DCBREG                                            14000020
         USING DECBDEF,DECBREG                                          14100002
*********************************************************************** 14200020
         B     IECDSF1                  ENTRY FROM FOUNDATION MODULE    14300020
VCONKY   DC    V(IGG019KY)              EXTENDED SEARCH ADDRESS  Y02072 14400002
         B     IECDSF2-IGG019KN(SFBASE) ENTRY TO ADD LOGIC              14500020
         B     ENTRYP12-IGG019KN(SFBASE)  ENTRY TO END OF ADD ROUTINE   14600020
*                                                                       14700020
IECDSF1  EQU   *                                                        14800020
*                                                                       14900020
*                                                                     * 15700020
         LR    SWAREG,IOBREG            FETCH IOB ADDRESS               15800020
         SH    SWAREG,H4                PREPARE TO GO TO IOB-4          15900020
         L     SWAREG,NULL(SWAREG)      FETCH SWA ADDRESS THERE         16000020
         LA    SWAREG,SEGAREOF(SWAREG)  GET ADDRESS OF SEGMENT AREA     16100020
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  16130020
         BNE   NOTRRA                   BRANCH IF NO             20201  16160020
         BAL   UTIL,SECTRTN             GO BUILD SET SECTOR      20201  16190020
         B     FEATA                    GO AROUND NOP            20201  16220020
NOTRRA   EQU   *                                                 20201  16250020
         MVC   NULL(BYTE8,CCWIND),NOPCCW    CONSTRUCT A NOP CCW         16300020
*                                                                       16330020
FEATA    EQU   *                                                 20201  16360020
         ST    CCWIND,EIGHTCCW(CCWIND)  SET LAST RECORD SEARCH ARGUMENT 16400020
*                                       ADDRESS IN CCW 9                16500020
         LA    WKREG1,IOBCC             CAPACITY RECORD ADDRESS  Y02072 16600002
         ST    WKREG1,ONECCW(CCWIND)    PUT CAPACITY RECORD SEARCH      16700020
*                                       ARGUMENT ADDRESS IN CCW 2       16800020
         ST    WKREG1,SEVENCCW(CCWIND)  PUT CAPACITY RECORD OUTPUT      16900020
*                                       ADDRESS IN CCW 8                17000020
         LA    WKREG1,IOBDNCRF          FETCH ADDRESS OF NEW REC Y02072 17100002
*                                       COUNT FIELD IN IOB              17200020
         ST    WKREG1,THREECCW(CCWIND)  PUT CAPACITY RECORD INPUT ADDR. 17300020
*                                       IN CCW 4                        17400020
         ST    WKREG1,TENCCW(CCWIND)    PUT NEW RECORD COUNT FIELD      17500020
*                                       ADDRESS IN CCW 11               17600020
         LA    WKREG1,ONECCW(CCWIND)    TIC ADDRESS FOR SEARCH ID EQ    17700020
         ST    WKREG1,TWOCCW(CCWIND)    PUT TIC ADDRESS IN CCW 3        17800020
         MVI   ONECCW(CCWIND),SRCHIDEQ  SET SEARCH ID EQ OP CODE IN     17900020
*                                       CCW 2                           18000020
         MVC   BYTE12(BYTE5,CCWIND),SCHCON  MOVE FLAGS AND COUNT IN     18100020
*                                           CCW 2 AND TIC OP CODE IN    18200020
*                                           CCW 3                       18300020
         LA    SCHREG,ONECCW(CCWIND)    SAVE ADDRESS OF CCW 2 FOR       18400020
*                                       BUILDING VERIFY CCW'S           18500020
         LA    CCWIND,THREECCW(CCWIND)  SET POINTER TO CCW 4            18600020
         MVI   NULL(CCWIND),READDATA    MOVE READ DATA OP CODE IN CCW 4 18700020
         MVC   BYTE4(BYTE4,CCWIND),SILCNT7  MOVE SUPPRESS INCORRECT     18800020
*                                           LENGTH FLAGS AND COUNT=7    18900020
*                                           IN CCW 4                    19000020
*                                                                     * 19100020
*                                                                       19190020
         LA    CCWIND,ONECCW(CCWIND)    INCR CCW PTR             20201  19280020
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  19370020
         BNE   NOTRRC                   BRANCH IF NO             20201  19460020
         BAL   UTIL,SECTRTN             GO BUILD SET SECTOR      20201  19550020
         B     FEATC                    GO AROUND NOP            20201  19640020
NOTRRC   EQU   *                                                 20201  19730020
         MVC   NULL(BYTE8,CCWIND),NOPCCW  INSERT NOP CMND        20201  19820020
FEATC    EQU   *                                                 20201  19910020
         LA    CCWIND,ONECCW(CCWIND)    INCR CCW PTR             20201  20000020
*                                                                       20090020
         LA    WKREG1,THREE(SCHREG)     PTR TO CCHHR             20201  20180020
         ST    WKREG1,NULL(CCWIND)      PUT TIC TO SEARCH ID EQ CCW     20300020
*                                       ADDRESS IN CCW 6                20400020
         ST    CCWIND,ONECCW(CCWIND)    PUT TIC TO CCW 6 ADDR. IN CCW 7 20500020
         MVI   NULL(CCWIND),SRCHIDEQ    SET SEARCH ID EQ OP CODE IN     20600020
*                                       CCW 6                           20700020
         MVC   BYTE4(BYTE5,CCWIND),SCHCON   MOVE FLAGS AND COUNT IN     20800020
*                                           CCW 6 AND TIC OP CODE IN    20900020
*                                           CCW 7                       21000020
         MVI   TWOCCW(CCWIND),WRITDATA  MOVE WRITE DATA OP CODE IN CCW8 21100020
         MVC   BYTE20(BYTE4,CCWIND),CCSIL7  COMMAND CHAIN AND SUPPRESS  21200020
*                                           INCORRECT LENGTH FLAGS AND  21300020
*                                           COUNT OF 7 IN CCW 8         21400020
         LA    CCWIND,THREECCW(CCWIND)  SET POINTER TO CCW 9            21500020
         MVI   NULL(CCWIND),SRCHIDEQ    SET SEARCH ID EQ OP CODE IN     21600020
*                                       CCW 9                           21700020
         ST    CCWIND,ONECCW(CCWIND)    PUT TIC TO CCW 9 ADDR IN CCW 10 21800020
         MVC   BYTE4(BYTE5,CCWIND),SCHCON   MOVE FLAGS AND COUNT IN     21900020
*                                           CCW 9 AND TIC OP CODE IN    22000020
*                                           CCW 10                      22100020
         MVI   TWOCCW(CCWIND),WRITCKD   MOVE IN WRITE COUNT KEY DATA    22200020
*                                       OP CODE IN CCW 11               22300020
         MVI   BYTE23(CCWIND),EIGHT     SET COUNT OF 8 IN CCW 11        22400020
         LA    CCWIND,TWOCCW(CCWIND)    SET POINTER TO CCW 11           22500020
         CLI   DCBKEYLE,ZERO            CHECK IF KEY LENGTH IS ZERO     22600020
         BE    NOKEY                    BRANCH IF YES                   22700020
         MVC   BYTE9(BYTE3,CCWIND),DECKYADR+BYTE1   ELSE, MOVE KEY ADDR 22800020
*                                                   IN CCW 12           22900020
         MVI   BYTE4(CCWIND),DACHGAP    SET DATA CHAIN BETWEEN GAPS OF  23000020
*                                       RECORD FLAGS IN CCW 11          23100020
         MVC   BYTE15(BYTE1,CCWIND),DCBKEYLE   PUT KEY LENGTH AS COUNT  23200020
*                                              IN CCW 12                23300020
         LA    CCWIND,ONECCW(CCWIND)    SET POINTER TO CCW 12           23400020
*                                                                       23500020
NOKEY    EQU   *                                                        23600020
*                                                                       23700020
         CLC   DECLNGTH(BYTE2),ZEROS    IS DATA LENGTH ZERO             23800020
         BCR   CC8,RETREG               IF YES, CHANNEL PROGRAM ENDS    23900020
*                                       AND RETURN CONTROL TO IGG019KJ  24000020
         MVI   BYTE4(CCWIND),DACHGAP    SET DATA CHAIN BETWEEN GAPS OF  24100020
*                                       A RECORD FLAGS IN CURRENT CCW   24200020
         ST    SWAREG,ONECCW(CCWIND)    PUT SEGMENT ADDRESS IN NEXT CCW 24300020
         MVC   BYTE14(BYTE2,CCWIND),DECLNGTH   MOVE IN DATA LENGTH AS   24400020
*                                              COUNT                    24500020
         LA    CCWIND,ONECCW(CCWIND)    SET POINTER TO LAST CCW         24600020
         TM    IOBDTYPE,IOBVERFY        CHECK IF WRITE CHECK OPT Y02072 24700002
*                                       HAS BEEN SPECIFIED              24800020
         BCR   CC8,RETREG               IF NOT, RETURN CONTROL TO THE   24900020
*                                       FOUNDATION MODULE IGG019KJ      25000020
         L     SFBASE,VERMODOF(NULL,FDNBASE)  ELSE, GET ADDRESS OF THE  25100020
*                                       VERIFY MODULE IGG019KQ          25200002
         BR    SFBASE                   GO TO IGG019KQ TO CONSTRUCT     25300020
*                                       VERIFY CCW'S                    25400020
*                                                                     * 25500020
*                                                                     * 25600020
*              BDAM OPTIONS AND TYPE                                  * 25700020
*                                                                     * 25800020
*                                                                     * 25900020
NOPCCW   DC    X'0300000060000001'      NOP CCW                         26000020
SCHCON   DC    X'4000000508'            COMMAND CHAIN FLAGS WITH COUNT  26100020
*                                       OF 5  AND TIC OP CODE           26200020
SILCNT7  DC    X'20000007'              SUPPRESS INCORRECT LENGTH FLAGS 26300020
*                                       AND COUNT OF 7                  26400020
CCSIL7   DC    X'60000007'              COMMAND CHAIN AND SUPPRESS IN-  26500020
*                                       CORRECT LENGTH FLAGS AND COUNT  26600020
*                                       OF 7                            26700020
*                                                                       26800020
SRCHIDEQ EQU   X'31'                    SEARCH ID EQ OP CODE            26900020
READDATA EQU   X'06'                    READ DATA OP CODE               27000020
WRITDATA EQU   X'05'                    WRITE DATA OP CODE              27100020
WRITCKD  EQU   X'1D'                    WRITE COUNT KEY DATA OP CODE    27200020
DACHGAP  EQU   X'C0'                    DATA CHAIN BETWEEN GAPS OF A    27300020
*                                       RECORD FLAGS                    27400020
*                                                                       27600020
*                                                                       27700020
*              CONSTANTS                                                27800020
*                                                                       27900020
*                                                                       28000020
ZEROS    DC    X'0000'                  GENERAL PURPOSE CONSTANT        28050020
ZERO     EQU   X'0'                     GENERAL PURPOSE CONSTANT        28100020
EIGHT    EQU   X'8'                     GENERAL PURPOSE CONSTANT        28200020
NULL     EQU   0                        NO DISPLACEMENT                 28300020
ONECCW   EQU   8                        LENGTH OF ONE CCW               28400020
TWOCCW   EQU   16                       LENGTH OF TWO CCW'S             28500020
THREECCW EQU   24                       LENGTH OF THREE CCW'S           28600020
FOURCCW  EQU   32                       LENGTH OF FOUR CCW'S            28700020
SEVENCCW EQU   56                       LENGTH OF SEVEN CCW'S           28800020
EIGHTCCW EQU   64                       LENGTH OF EIGHT CCW'S           28900020
TENCCW   EQU   80                       LENGTH OF TEN CCW'S             29000020
*                                                                       29100020
*                                                                       29200020
BYTE1    EQU   1                        ONE BYTE                        29300020
BYTE2    EQU   2                        TWO BYTES                       29400020
BYTE3    EQU   3                        THREE BYTES                     29500020
BYTE4    EQU   4                        FOUR BYTES                      29600020
BYTE5    EQU   5                        FIVE BYTES                      29700020
BYTE6    EQU   6                        SIX BYTES                       29800020
BYTE7    EQU   7                        SEVEN BYTES                     29900020
BYTE8    EQU   8                        EIGHT BYTES                     30000020
BYTE9    EQU   9                        NINE BYTES                      30100020
BYTE10   EQU   10                       TEN BYTES                       30200020
BYTE12   EQU   12                       TWELVE BYTES                    30300020
BYTE14   EQU   14                       FOURTEEN BYTES                  30400020
BYTE15   EQU   15                       FIFTEEN BYTES                   30500020
BYTE20   EQU   20                       TWENTY BYTES                    30600020
BYTE23   EQU   23                       TWENTY-THREE BYTES              30700020
CC8      EQU   8                        CONDITION CODE SETTING OF 8     30710020
VERMODOF EQU   12                       OFFSET TO ADDRESS OF IGG019KQ   30800020
*                                       IN THE FOUNDATION MODULE        30900020
SEGAREOF EQU   10                       OFFSET TO ADDRESS OF SEGMENT    31000020
*                                       AREA IN SWA                     31100020
*                                                                       31120020
* SET SECTOR BUILD ROUTINE                                              31140020
*                                                                       31160020
         DS    0H                       ROUND TO HW              20201  31180020
SECTRTN  EQU   *                                                 20201  31200020
         L     WKREG1,IOBDCPND          GET SECTOR ADDR          20201  31220020
         ST    WKREG1,NULL(CCWIND)      PUT IN CCW WITH OP CODE  20201  31240020
*                                       I                        20201  31260020
         OI    BYTE4(CCWIND),CC         CMND CHAIN CCW           20201  31280020
         MVI   BYTE7(CCWIND),BYTE1      SET BYTE CNT TO ONE      20201  31300020
         BR    UTIL                     RETURN                   20201  31320020
*                                                                       31340020
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      20201  31360020
CHPOFF   EQU   80                       OFFSET IN IOB TO CHP     20201  31380020
         EJECT                                                          31400020
*********************************************************************** 31500020
*                                                                       31600020
*                                                                       31700020
*********************************************************************** 31800020
*                                                                       31900020
*                                                                       32000020
*   THIS PORTION OF THE SELF-FORMAT MODULE PERFORMS THE SEARCH FOR      32100020
*   SUFFICIENT SPACE TO ADD THE RECORD TO THE DATA SET.                 32200020
*                                                                       32300020
         DROP  IOBREG,DCBREG,DECBREG    CHANGE REGISTER USAGE TO THOSE  32400020
         DROP  SF1BASE                  USED BY THE ASYNCHRONOUS        32500020
         USING IGG019KN,SFBASE          INTERRUPT ROUTINE               32600020
         USING IOBSTDRD,PARAM                                    Y02072 32700002
         USING IHADCB,DCBREG2                                           32800020
         USING DECBDEF,UTIL                                             32900020
         USING SWA,SWAPTR                                               33000020
*                                                                       33100020
IECDSF2  L     UTIL,IOBECBPT            SET DECB POINTER                33200020
         TM    IOBSTAT1,IOBABNRM        WAS THIS AN ABN COMPLET  Y02072 33300002
         BZ    COMPLOK                  BR IF NOT                       33400020
         L     W1,IOBSTART                                              33800020
         USING WRITEADD,W1                                              33900020
         CLI   WARD,READDATA            DID ABNORMAL END OCCUR DURING   34000020
*                                       THE READ OF A CAPACITY RECORD   34100020
         BNE   MVINFRST                 BR IF NO                        34200020
         IC    W1,TRKCNT                *                               34240020
         LA    W1,ONE(W1)                *  ADD 1 TO TRACK COUNT        34280020
         STC   W1,TRKCNT                *                               34320020
         CLI   TRKCNT,ONE               IF THE TRACK COUNT IS ONE, WE   34360020
         BNE   ACB4                     MUST PLACE THE FIRST TRACK      34400020
         MVC   SAVEMBB(EIGHT),IOBSEEK   ADDRESS IN THE SWA FOR DEQ RTN  34500020
         B     ACB4                     GO DEQ TRACKS USED, POST THE    34600020
*                                       REQUEST, AND EXIT.              34700020
*                                                                       34800020
COMPLOK  EQU   *                                                        34900020
         CLC   IOBDBYTR,LASTFOUR        IS SPACE TOTAL SO FAR = 0       35000020
         BNE   NOTFIRST                 BR IF NO                        35100020
*                                                                       35106020
*   OBTAIN POINTER TO THE DEVICE TABLE ENTRY                            35112020
*                                                                       35118020
         USING RQE,RQEREG               ESTABLISH RQE BASE       Y02072 35126002
         L     UCBREG,RQEUCB            LOAD 4 BYTE UCB ADDR     Y02072 35128002
         DROP  RQEREG                                            Y02072 35128402
         LA    W3,DONEDVT                                               35130020
GETDVENT EQU   *                                                        35136020
         L     W1,CVTPTR                LOAD ADDRESS OF THE CVT         35142020
         L     W1,CVTZDTAB-CVTDEF(W1)   GET ADDRESS OF THE DEVICE TABLE 35148020
         IC    W2,TYPCD(UCBREG)         LOAD DEVICE CODE FROM UCB       35154020
         N     W2,LASTFOUR              CLEAR ALL BUT LOW ORDER 4 BITS  35160020
         IC    W2,NULL(W2,W1)           FIND ENTRY OFFSET               35166020
         LA    UCBREG,NULL(W2,W1)       SET POINTER TO DESIRED ENTRY    35172020
         BR    W3                       RETURN TO CALLING ROUTINE       35178020
DONEDVT  EQU   *                                                        35184020
*                                                                       35190020
OTHRFRST EQU   *                                                        35200020
         MVC   SAVEMBB,IOBSEEK          SAVE MBB FROM IOBSEEK           35300020
         MVC   IOBCC(SEVEN),IOBDNCRF    MOVE IN THE CAPACITY RECORD     35400002
*                                       (THIS ALSO INITIALIZES          35500020
*                                       IOBDBYTR WITH THE TRACK BAL.)   35600002
         MVC   SVCCHHR,IOBDNCRF         ALSO SAVE IT IN THE SWA         35700002
         MVI   TRKCNT,ONE               SET TRACK COUNT TO ONE          35800020
         SR    W2,W2                                                    35900020
         SR    W4,W4                                                    36000020
*                                                                       37100020
         TM    IOBSTAT1,IOBPASS2        IS THIS THE FIRST TIME   Y02072 37200002
*                                       IN THIS ROUT FOR THIS REQUEST   37300002
         BO    NOCALC                   NO,BYPASS CALCULATION           37400020
*                                                                       37500020
*   THE DISK SPACE REQUIRED FOR THE RECORD WILL NOW BE CALCULATED.      37600020
*                                                                       37700020
         IC    W2,DCBKEYLE              GET KEY LENGTH FROM DCB         37800020
         LTR   W2,W2                    IS KEY LENGTH ZERO              37900020
         BP    KEYED                    BR IF NOT ZERO                  38000020
         IC    W4,OVERK(UCBREG)         GET VALUE TO BE SUBTRACTED FROM 38100020
*                                       OVERHEAD FOR NON-KEYED RECORDS  38200020
KEYED    EQU   *                                                        38300020
         AH    W2,DECLNGTH              ADD DATA LENGTH TO KEY LENGTH   38400020
         SR    W3,W3                                                    38500020
         IC    W3,OVERL(UCBREG)         GET OVERHEAD FOR LAST RECORD    38600020
         TM    BYTEDEV(UCBREG),TBOVHD    IS THIS A 2305 DEVICE   20201  38620020
         BNO   MZ0001                   NO, THEN OVERHD O.K.     20201  38640020
         LH    W3,OVERI(UCBREG)         ELSE GET TWO BYTE OVHD   20201  38660020
MZ0001   EQU   *                                                 20201  38680020
         SR    W3,W4                    SUBTRACT NON-KEYED OVERHEAD     38700020
         AR    W2,W3                    ADD LAST RECORD OVERHEAD TO     38800020
*                                       RECORD LENGTH                   38900020
         STH   W2,IOBDBYTN+TWO          STORE BYTES REQUIRED FOR LAST   39000020
*                                       RECORD                          39100020
         SR    W2,W3                    RESTORE W2 TO KEY+DATA LENGTH   39200020
         IC    W3,OVERI(UCBREG)         GET OVERHEAD FOR NOT LAST RCD.  39300020
         TM    BYTEDEV(UCBREG),TBOVHD    IS THIS A 2305 DEVICE   20201  39320020
         BNO   MZ0002                   IF NOT, OVHD IS O.K.     20201  39340020
         LH    W3,OVERI(UCBREG)         ELSE GET TWO BYTE OVHD   20201  39360020
MZ0002   EQU   *                                                 20201  39380020
         MH    W2,TOLER(UCBREG)         MULTIPLY KEY+DATA LENGTH BY     39400020
*                                       THE TOLERANCE FACTOR            39500020
         SRA   W2,NINE                  DIVIDE RESULT BY 512            39600020
         SR    W3,W4                    SUBTRACT NO-KEY OVERHEAD        39700020
         AR    W2,W3                    ADD OVERHEAD TO RECORD LENGTH   39800020
         STH   W2,IOBDBYTN              STORE RESULT IN IOB             39900020
         OI    IOBSTAT1,IOBPASS2        SET FIRST TIME THROUGH   Y02072 40000002
*                                                                       40100020
NOCALC   EQU   *                                                        40200020
         LH    W4,IOBDBYTR              GET THE TRACK BALANCE           40300020
         LTR   W4,W4                    SEE IF NEGATIVE TRK BALANCE     40310020
         BM    TRKFULL                  BR IF NEGATIVE                  40320020
         CH    W4,IOBDBYTN+TWO          WILL RECORD FIT AS LAST RECORD  40400020
*                                       ON THE TRACK                    40500020
         BL    NOFIT                    BR IF NO                        40600020
         MVI   SEGFLGS,NULL             SET SEGMENT FLAGS TO 0 TO       40700020
*                                       INDICATE A ONE SEGMENT RECORD   40800020
         MVC   SAVELL,DECLNGTH          SET SEGMENT SIZE TO RECORD SIZE 40900020
         SH    W4,IOBDBYTN              SUBTRACT NOT-LAST-RECORD SIZE   41000020
*                                       FROM TRACK BALANCE AND          41100020
         STH   W4,IOBDBYTR              STORE NEW TRACK BALANCE IN THE  41200020
*                                       CAPACITY RECORD TO BE WRITTEN   41300020
FINSETUP EQU   *                                                        41400020
         MVC   IOBDNCRF+SIX(TWO),SAVELL MOVE SEGMENT SIZE TO NEW Y02072 41500002
*                                       CAPACITY RECORD                 41600020
         L     W1,IOBSTART              GET CHANNEL PROGRAM START ADDR. 41700020
         USING WRITEADD,W1              SET UP CHANNEL PROGRAM DSECT    41800020
         CLI   DCBKEYLE,NULL            ARE KEYS BEING WRITTEN          41900020
         BE    NOKEYCP                  BR IF NO                        42000020
         MVC   WAKWD+CNTOFF(TWO),SAVELL MOVE DATA LENGTH TO WRITE CCW   42200020
AFTERLL  EQU   *                                                        42300020
         MVC   WANOP1(FIVE),SVCCHHR     PUT CCHHR OF CURRENT LAST BLOCK 42400020
*                                       IN CCW1                         42500020
         MVC   IOBDNCRF(FOUR),SVCCHHR   PUT CCHH OF NEW RECORD   Y02072 42600002
*                                       IN THE NEW COUNT FIELD          42700002
         MVC   IOBDNCRF+FIVE(ONE),DCBKEYLE PUT KEY LENGTH IN THE COUNT  42800002
*                                       FIELD                           42900020
         MVC   IOBSEEK(THREE),SAVEMBB   MOVE MBB TO IOBSEEK             43000020
         MVC   WASIE1,SAVEMBB           PUT THE MBBCCHH OF THE CAPACITY 43100020
*                                       RECORD IN CCW2                  43200020
         MVI   WASIE1+SEVEN,NULL        SET R OF THE CAPACITY RECORD    43300020
*                                       ADDRESS TO ZERO                 43400020
         IC    W3,SVCCHHR+FOUR          *                               43500020
         LA    W3,ONE(W3)               * PUT ID OF NEW RECORD IN THE   43600002
         STC   W3,IOBDNCRF+FOUR         *  NEW COUNT FIELD       Y02072 43700002
         MVC   IOBCC(FIVE),IOBDNCRF     PUT CCHHR OF NEW LST BLK Y02072 43800002
*                                       IN NEW CAPACITY RECORD          43900002
         MVC   SWABDW(TWO),SAVELL       PUT DATA LENGTH IN THE BLOCK    44000020
*                                       RESCRIPTOR WORD                 44100020
         MVI   SEGUNUSD,NULL            ZERO BYTE AFTER FLAGS           44200020
         LA    W1,WANOP2                SET NEW CHANNEL PROGRAM START   44300020
         ST    W1,IOBSTART              POINTER                         44400020
         OI    IOBSTAT1,IOBADDVU        INDICATE THAT REC FIT    Y02072 44500002
         XC    SWABDW+TWO(TWO),SWABDW+TWO ZERO THE LAST TWO BYTES OF    44600020
*                                       THE BLOCK DESCRIPTOR WORD       44700020
         MVC   SWARAPT+ONE(THREE),DECAREA+ONE  MOVE THE RECORD AREA     44800020
*                                       POINTER TO THE SWA              44900020
         LH    W1,SWABDW                *                               45000020
         SH    W1,H4                     * SET SEGMENT DESCRIPTOR TO    45100020
         STH   W1,SEGLL                 *  FOUR LESS THAN THE BDW       45200020
         SH    W1,H4                    SUBTRACT 4 AND THIS IS THE      45300020
*                                       NUMBER OF BYTES TO MOVE TO THE  45400020
*                                       SEGMENT AREA.                   45500020
         LA    W2,SEGDATA               *                               45600020
         L     W3,SWARAPT                * SET UP TO AND FROM ADDRESSES 45700020
         LA    W3,EIGHT(W3)             *  FOR THE MOVE                 45800020
MOVE     SH    W1,H256                  IF SIZE IS GREATER OR EQUAL TO  45900020
         BH    MOVE256                  256, GO MOVE 256 BYTES          46000020
         AH    W1,H255                  ELSE,                           46100020
         EX    W1,AMOVE                 MOVE REMAINING NBR OF BYTES     46200002
*                                                                       46300020
*   MOVE COMPLETED                                                      46400020
*                                                                       46500020
         MVC   SWABFINC,SWABDW          PUT DATA LENGTH IN THE BUFFER   46600020
*                                       INCREMENT FIELD                 46700020
*                                                                       46750002
*  ISSUE EXCP TO EITHER WRITE OUT A SEGMENT OR READ IN A NEW REC ZERO   46760002
*                                                                       46770002
EXCP     EQU   *                                                        46800020
         LR    DEQRTN,PARAM             SET UP IOB POINTER              46810020
         L     W2,IOBECBPT              SAVE ECB ADDRESS         Y02072 46860002
         LA    W1,IOBCSW+3              RIGHT HALF OF CSW IS     YM3709 46910002
         ST    W1,IOBECBPT              DUMMY ECB FOR THIS EXCP  YM3709 46960002
         ST    W2,IOBDQPTR              SAVE ECB POINTER IN IOB  Y02072 46970002
*                                       THE ECB WILL BE RESTORED Y02072 46980002
*                                       TO THE IOBECBPT BY THE   Y02072 46990002
*                                       CEA OR EOE APPENDAGE     Y02072 46992002
         EXCP  (1)                                                      47000020
*                                                                       47050002
*                                                                       47100002
*                                                                       47150002
TSTIFDON LR    W1,PARAM                 GET IOB ADDRESS                 47200020
         DROP  PARAM                    DROP MAIN IOB REG BASE   Y02072 47250002
         SH    W1,H8                    POINT TO IOB PREFIX             47300020
         USING IOBBDAM,W1               SET UP IOB PREF BASE     Y02072 47350002
         TM    IOBDEQIN,IOBDEQ          DID THIS IOB GET CONTROL Y02072 47400002
*                                       FROM ONE WHICH WAS BEING DEQ'ED 47500002
         BZ    EXIT                     EXIT IF NOT                     47600020
         NI    IOBDEQIN,X'FF'-IOBDEQ    TURN OFF DEQ IN PROC   @ZA12909 47700000
         L     PARAM,IOBDQADA           ELSE, ESTABLISH THE IOB  Y02072 47800000
*                                       BEING DEQ'ED AS THE CURRENT     47900000
         DROP  W1                       DROP NEXT IOB BASE       Y02072 48050002
         USING IOBSTDRD,PARAM           REEST CURRENT IOB BASE   Y02072 48100002
         B     CONTDEQ                  RESUME PROCESSING IN THE DEQ    48600020
*                                       ROUTINE                         48700020
NOFIT    EQU   *                                                        48800020
         SR    W3,W3                                                    48900020
         LH    W3,IOBDBYTN+TWO          GET SIZE REQUIRED AS LAST RCD.  49000020
         SR    W3,W4                    SUBTRACT TRACK BALANCE          49100020
         LA    W3,EIGHT(W3)             ALLOW FOR DESCRIPTORS           49200020
*   W3 NOW CONTAINS THE NUMBER OF BYTES WHICH CANNOT FIT ON THE TRACK   49300020
*                                                                       49400020
         LH    W4,DECLNGTH              GET ACTUAL DATA LENGTH          49500020
         SR    W4,W3                    THE RESULT IN W4 IS THE NUMBER  49600020
*                                       OF DATA BYTES WHICH COULD BE    49700020
*                                       WRITTEN                         49800020
         BP    WRTSOME                  BRANCH IF RESULT IS GREATER     49900020
*                                       THAN ZERO, THERE'S MORE TO WRT  50000002
*                                                                       50100020
*   IF THIS POINT IS REACHED, THE TRACK DOES NOT CONTAIN ENOUGH ROOM    50200020
*   TO WRITE A RECORD WHOSE DATA PORTION IS NONE BYTES, SO THE TRACK    50300020
*   WILL BE RELEASED AND THE SEARCH STARTED AGAIN ON THE NEXT TRACK.    50400020
*                                                                       50500020
TRKFULL  EQU   *                                                        50510020
         BAL   DEQRTN,ACA1              GO DEQ THIS TRACK               50600020
         XC    IOBDBYTR,IOBDBYTR        ZERO THE BYTE TOTAL             50700020
         MVI   TRKCNT,NULL              SET TRACK COUNT TO ZERO         50800020
         TM    IOBDTYPE,IOBEXTSC        IS EXTENDED SEARCH REQ   Y02072 50900002
         BO    AAE5                     BR IF YES                       51000020
SETNOSPA MVI   IOBSTAT2,NOSPA           SET NO SPACE EXCEPTION   Y02072 51100002
         B     AAF2                     TERMINATE THE REQUEST           51200020
WRTSOME  EQU   *                                                        51300020
         LA    W4,EIGHT(W4)             ADD 8 FOR DESCRIPTORS           51400020
         STH   W4,IOBDBYTR              STORE THE DATA LENGTH IN THE    51500020
         STH   W4,SAVELL+ONE            BYTE TOTAL AND FIRST SEG SIZE   51600020
         MVC   SAVELL,SAVELL+ONE                                        51700020
AAE5     EQU   *                                                        51800020
         L     SF1BASE,VCONKY           GO TO EXTENDED SRCH MOD  Y02072 51900002
         BALR  RETREG,SF1BASE           GET NEXT TRACK ADDRESS          52000020
         B     OKRTN                    IF THE RETURN IS TO THIS INSTR, 52100020
*                                       IF WAS A NORMAL RETURN.         52200020
         OI    IOBSTAT2,NOSPA           ELSE, A RETURN TO THIS   Y02072 52300002
*                                       INDICATOR SEARCH LIMIT REACHED. 52400020
*                                       SO SET NO SPACE INDICATOR FOR   52500020
*                                       LATER TESTING                   52600020
OKRTN    EQU   *                                                        52700020
         LR    W1,PARAM                 *                               52720020
         SH    W1,H4                     * RESTORE SWA POINTER          52740020
         L     SWAPTR,NULL(W1)          *                               52760020
         CLI   TRKCNT,NULL              IF TRACK COUNT IS ZERO, DON'T   52800020
         BE    TRKOK                    WORRY WHERE THE NEW TRACK IS    52900020
         L     W1,DCBDEBAD              GET DEB ADDRESS                 53000020
         LA    W1,DEBBASE(W1)           POINT TO DEVICE SECTION         53100020
         CLI   IOBM,NULL                IS THIS TRACK IN THE 1ST Y02072 53200002
*                                       EXTENT                          53300020
         BNE   VOLTST                   BR IF NOT                       53400020
         CLC   IOBCC(FOUR),SIX(W1)      IF THE NEW TRACK IS 1ST  Y02072 53500002
         BE    REINIT                   TRACK IN THE FIRST EXTENT, WE   53600020
*                                       HAVE JUST WRAPPED AROUND AND    53700020
*                                       MUST START THE SEARCH AGAIN     53800020
VOLTST   EQU   *                                                        53900020
         SR    W2,W2                                                    54000020
         SR    W3,W3                                                    54100020
         IC    W2,IOBM                  GET EXT NBR OF NEW TRK   Y02072 54200002
         SLL   W2,FOUR                  MULTIPLY BY 16 (EXTENT SIZE)    54300002
         AR    W2,W1                    ADD ON POINTER TO FIRST EXTENT  54400020
         IC    W3,SAVEMBB               GET EXTENT NBR OF FIRST TRACK   54500020
         SLL   W3,FOUR                  MULTIPLY BY 16                  54600020
         AR    W3,W1                    ADD ON DEB BASE SIZE            54700020
         CLC   ONE(THREE,W2),ONE(W3)    COMPARE THE UCB ADDRESSES       54800020
         BNE   REINIT                   IF NOT THE SAME, THE NEW TRACK  54900020
*                                       IS ON A DIFFERENT VOLUME AND    55000020
*                                       THE SEARCH MUST START OVER ON   55100020
*                                       THE NEW VOLUME                  55200020
TRKOK    EQU   *                                                        55300020
         NI    IOBSTAT1,X'FF'-IOBENQUE  TURN OFF INDICATION THAT Y02072 55400002
*                                       TRACK WAS ENQUEUED              55450002
*                                                                       55460002
*   ISSUE AN SVC 53 SO THAT IGC0005C CAN ADD THIS TRACK TO THE READX    55470002
*   LIST AND THE SYSTEM QUEUE OR PUT THIS IOB ON THE UNPOSTED QUEUE     55472002
*   WAITING FOR CONTROL OF THIS TRACK IF ANOTHER REQUEST HAS CONTROL    55474002
*   OF IT.  IGC0005C EXPECTS THE IOB TO BE IN REG 1, COMPLEMENTED TO    55476002
*   DISTINGUISH THIS FROM A RELEX REQUEST.                              55478002
*                                                                       55494002
         LCR   R1,PARAM                 PUT IOB COMPLEMENT IN R1 Y02072 55498902
*                                                                       55499202
         SVC   53                       GO TO IGC0005C           Y02072 55499602
*                                                                       55499702
         B     TSTIFDON                 GO TEST IF DONE                 55800020
REINIT   EQU   *                                                        55900020
         TM    IOBSTAT2,NOSPA           IS NOT SPACE INDICATED   Y02072 56000002
         BO    AAF2                     BR IF YES                       56100020
         MVC   IOBDNCRF,IOBSEEK         SAVE IOBSEEK             Y02072 56200002
         BAL   DEQRTN,ACA1              GO DEQ ALL TRACKS BUT LAST      56300020
         MVC   IOBSEEK,IOBDNCRF         RESTORE                  Y02072 56400002
         XC    IOBDBYTR,IOBDBYTR        ZERO OUT BYTE TOTAL             56500020
         B     TRKOK                    GO ENQ CURRENT TRACK            56600020
NOTFIRST EQU   *                                                        56700020
         CLI   IOBDNCRF+FOUR,NULL       SEE IF TRK IS EMPTY (IF  Y02072 56800002
*                                       IT IS, THE LAST BLOCK POINTER   56900020
*                                       IN THE CAPACITY RECORD IS ZERO) 57000020
         BNE   NOTEMPTY                 BR IF NOT EMPTY                 57100020
         IC    W1,TRKCNT                *                               57200020
         LA    W1,ONE(W1)                * ADD ONE TO TRACK COUNT       57300020
         STC   W1,TRKCNT                *                               57400020
         MVC   IOBDNCRF(TWO),IOBDNCRF+FIVE MOVE TRK BAL TO HALF  Y02072 57500002
*                                       WORD BOUNDARY                   57600002
         LH    W1,IOBDNCRF              GET TRACK BALANCE        Y02072 57700002
         SH    W1,H8                    SUBTRACT 8 FOR DESCRIPTORS      57800020
         AH    W1,IOBDBYTR              ADD TO BYTE TOTAL               57900020
         STH   W1,IOBDBYTR                                              58000020
         USING RQE,RQEREG               ESTABLISH RQE BASE       Y02072 58054002
         L     UCBREG,RQEUCB            LOAD 4 BYTE UCB ADDR     Y02072 58056002
         DROP  RQEREG                                            Y02072 58058002
         BAL   W3,GETDVENT              GET DEVICE TABLE ENTRY          58060020
         CLC   IOBDBYTR,DECLNGTH        DO WE HAVE ENOUGH SPACE YET     58130020
         BL    AAE5                     BR IF NO                        58200020
         MVI   SEGFLGS,ONE              SET SEGMENT FLAGS TO 01 TO      58300020
*                                       INDICATE FIRST SEGMENT OF A     58400020
*                                       MULTI-SEGMENT RECORD            58500020
         XC    IOBDBYTR,IOBDBYTR        SET TRACK BALANCE FOR FIRST     58600020
*                                       SEGMENT TO ZERO                 58700020
         B     FINSETUP                 GO FINISH SEGMENT SET UP        58800020
*                                                                       58900020
NOTEMPTY EQU   *                                                        59000020
         TM    IOBSTAT2,NOSPA          NO SPACE INDICATION       Y02072 59100002
         BZ    RETRY                    BR IF NO                        59200020
         IC    W1,TRKCNT                *                               59300020
         LA    W1,ONE(W1)                * ADD ONE TO TRACK COUNT       59400020
         STC   W1,TRKCNT                *                               59500020
AAF2     EQU   *                                                        59600020
         OI    IOBSTAT1,IOBABNRM        SET ABNORMAL COMPLETION  Y02072 59700002
         B     ACB4                     GO DEQ TRACKS USED              59800020
*                                                                       59900020
RETRY    EQU   *                                                        60000020
         MVC   SAVELL(THREE),IOBSEEK    SAVE MBB FROM IOBSEEK           60100020
         BAL   DEQRTN,ACA1              GO FREE ALL TRACKS BUT LAST     60200020
         MVC   IOBSEEK(THREE),SAVELL    RESTORE MBB IN IOBSEEK          60300020
         B     OTHRFRST                 GO START SEARCH ALL OVER        60400020
ACA1     EQU   *                                                        60500020
*                                                                       60600020
*   THE FOLLOWING ROUTINE WILL DEQ THE NUMBER OF TRACKS INDICATED IN    60700020
*   TRKCNT STARTING WITH THE TRACK WHOSE ADDRESS IS IN SAVEMBB          60800020
*                                                                       60900020
         CLI   TRKCNT,NULL              IF TRACK COUNT IS ZERO, RETURN  61000020
         BCR   EIGHT,DEQRTN             BECAUSE NO TRACKS TO DEQ        61100020
         ST    DEQRTN,SVDEQRTN          SAVE RETURN ADDRESS             61150020
         MVC   IOBSEEK,SAVEMBB          MOVE IN FIRST TRACK ADDRESS     61200020
         NI    IOBSTAT1,X'FF'-IOBADDVU  TURN OFF RECORD FIT BIT  Y02072 61300002
         OI    IOBSTAT1,IOBENQUE        TURN ON RECORD ENQD BIT  Y02072 61400002
*                                                                       61550002
*   ISSUE AN SVC 53 SO THAT IGC0005C CAN REMOVE TRACK FROM THE READX    61560002
*   LIST AND THE SYSTEM QUEUE, OR GIVE THE TRK TO THE NEXT IOB ON       61562002
*   THE UNPOSTED QUEUE. (THE ADDRESS OF THE NEXT IOB WILL BE RETURNED   61564002
*   TO THIS MODULE IN REGISTER 0). IGC0005C EXPECTS THE IOB TO BE IN    61566002
*   REGISTER 1, COMPLEMENTED TO DISTINGUISH THIS FROM A RELEX REQUEST.  61566402
*                                                                       61592002
GOTOLG   EQU   *                        GO DEQ TRACK             Y02072 61592402
         LCR   R1,PARAM                 PUT IOB COMPLEMENT IN R1 Y02072 61594002
*                                                                       61598802
         SVC   53                       GO TO IGC0005C           Y02072 61599202
*                                                                       61599602
*                                                                       61649602
         LTR   W4,R0                    LOAD NEXT IOB PTR IN REG Y02072 61660002
*                                       DOES ANOTHER IOB WANT THE TRACK 61700002
         BZ    CONTDEQ                  BR IF NO                        61800020
         LR    W1,W4                    GET NEW IOB ADDRESS             62000020
         SH    W1,H8                    GET TO THE IOBPREFIX            62100020
         DROP  PARAM                    DROP CUR IOB BASE        Y02072 62110002
         USING IOBBDAM,W1               EST BASE FOR IOB PREF    Y02072 62120002
         IC    DEQRTN,IOBDEQIN          SAVE TOP BYTE            XM6357 62150002
         ST    PARAM,IOBDQADA           STORE OLD(CURRENT) IOB   Y02072 62200002
*                                       IN NEW(NEXT,WAITING) IOB Y02072 62210002
         STC   DEQRTN,IOBDEQIN          RESTORE TOP BYTE         XM6357 62250002
         OI    IOBDEQIN,IOBDEQ          INDICATE DEQ INTERRUPTED Y02072 62300002
         LR    PARAM,W4                 ESTABLISH NEW IOB AS CURRENT    62400020
         DROP  W1                       DROP NEXT IOB BASE       Y02072 62450002
         USING IOBSTDRD,PARAM           REEST CURRENT IOB BASE   Y02072 62460002
         B     EXCP                     GO READ THE CAPACITY RECORD     62500020
CONTDEQ  EQU   *                                                        62600020
*                                                                       62606020
*   RESTORE REGISTERS BEFORE EXIT FROM DEQ ROUTINE                      62612020
*                                                                       62618020
         LR    SWAPTR,PARAM             *                               62624020
         SH    SWAPTR,H8                RESTORE PREFIX POINTER   Y02072 62630002
         DROP  PARAM                    DROP IOB BASE            Y02072 62632002
         DROP  SWAPTR                   DROP SWA BASE            Y02072 62632402
         USING IOBBDAM,SWAPTR           EST IOB PREFIX PTR       Y02072 62634002
         L     SWAPTR,IOBSWAP           GET SEGMENT WRKAREA ADDR Y02072 62636002
         DROP  SWAPTR                   DROP IOB PREF PTR        Y02072 62638002
         USING SWA,SWAPTR               REEST SWA BASE PTR       Y02072 62638402
         USING IOBSTDRD,PARAM           REEST IOB BASE           Y02072 62640002
         L     UTIL,IOBECBPT            RESTORE DECB POINTER            62642020
         L     UCBREG,DCBDEBAD          *                               62648020
         SR    W2,W2                     *                              62654020
         IC    W2,IOBM                   * GET UCB ADDRESS              62660002
         SLL   W2,FOUR                   *                              62666020
         L     UCBREG,DEBBASE(W2,UCBREG) *                              62672020
         BAL   W3,GETDVENT              GET POINTER TO DEVICE TABLE     62678020
         L     DEQRTN,SVDEQRTN          RESTORE RETURN ADDR FROM DEQ    62684020
*                                                                       62690020
         IC    W1,TRKCNT                *                               62700020
         BCTR  W1,NULL                   * SUBTRACT ONE FROM TRACK CNT  62800020
         STC   W1,TRKCNT                *                               62900020
         CLI   TRKCNT,NULL              IF TRACK COUNT IS ZERO.         63000020
         BCR   EIGHT,DEQRTN             RETURN TO CALLING SEQUENCE      63100020
         L     SF1BASE,FOUR(SFBASE)     GO TO EXTENDED SEARCH MODULE TO 63200020
         BALR  RETREG,SF1BASE           GET NEXT TRACK ADDRESS          63300020
         B     GOTOLG                   FOR EITHER RETURN, GO TO THE    63400020
*                                       EXCLUSIVE CONTROL MODULE TO DEQ 63500002
*                                       THE NEXT TRACK                  63600020
ENTRYP12 EQU   *                        3RD ENTRY POINT - FROM ASI      63700002
MVINFRST EQU   *                                                        63780020
         MVC   SAVEMBB(EIGHT),IOBCHNPR+EIGHT  MOVE IN MBB AND R0 Y02072 63860002
*                                       OF FIRST TRACK                  63940002
         MVC   SVCCHHR(FOUR),IOBCHNPR   MOVE IN CCHH OF 1ST TRK  Y02072 64020002
ACB4     EQU   *                                                        64100020
         BAL   DEQRTN,ACA1              GO DEQ ALL TRACKS USED          64200020
         MVC   IOBSEEK,SAVEMBB          RESTORE IOBSEEK TO FIRST TRACK  64300020
*                                       ADDRESS IN CASE FEEDBACK IS     64400020
*                                       REQUESTED                       64500020
         IC    W1,IOBCHNPR+FOUR                                  Y02072 64510002
         LA    W1,ONE(W1)                                               64520020
         STC   W1,IOBR                                           Y02072 64530002
         LR    W1,PARAM                                                 64600020
         SH    W1,H8                    POINT W1 TO IOB PREFIX          64700020
         OI    IOBSTAT1,IOBADDVU        INDICATE RECORD FITS     Y02072 64710002
         DROP  PARAM                    DROP IOB BASE REG        Y02072 64760002
*                                                                       64762002
PREVIOB  EQU   *                        TEST IF THIS IOB         Y02072 64764002
*                                       INTERRUPTED PREVIOUS IOB Y02072 64766002
*                                       IN PROCESS OF RELEAS-    Y02072 64768002
*                                       ING TRACKS               Y02072 64768402
         USING IOBBDAM,W1               EST BASE FOR IOB PREFIX  Y02072 64770002
         TM    IOBDEQIN,IOBDEQ          DID IOB GET CONTROL FROM Y02072 64800002
*                                       ONE WHICH WAS BEING DEQ'ED.     64900020
         BZ    POSTNDQ                  POST IF NOT                     65000020
         L     W4,IOBDQADA              SAVE THE IOB'S ADDRESS   Y02072 65200002
*                                                                       65260002
* NOTE: REGISTER 6 NOW CONTAINS THE ADDRESS OF THE PREVIOUS IOB WHICH   65270002
*   WAS IN THE PROCESS OF RELEASING ALL TRACKS FOR WHICH IT NEEDED      65272002
*   EXCLUSIVE CONTROL TO HONOR ITS REQUEST.  IT WAS INTERRUPTED BY      65274002
*   AN IOB WAITING FOR ONE OF THE TRACKS IT WAS ATTEMPTING TO RELEASE.  65276002
*   THIS REGISTER MUST BE SAVED FOR ALL SUBSEQUENT PROCESSING IN        65278002
*   IGG019KJ, THE ASI+4 ENTRY AND PATH. THE ASI WILL POST THE CURRENT   65278402
*   IOB AND RETURN TO THIS MODULE (AT THE LABEL SET UP BELOW) TO CON-   65278802
*   TINUE RELEASING TRACKS FOR THE PREVIOUS OR ORIGINAL IOB.            65279202
*                                                                       65298002
         NI    IOBDEQIN,X'FF'-IOBDEQ    TURN OFF DEQ LOOP BIT    Y02072 65300002
         DROP  W1                       DROP IOB PREFIX BASE     Y02072 65350002
         USING IOBSTDRD,PARAM           REEST CUR IOB BASE       Y02072 65360002
         LA    W1,AFTPOSTQ                                              65400020
         ST    W1,IOBDQPTR              SET RETURN ADDRESS FROM POST    65500020
GOTOPOST L     FDNBASE,DCBREAD                                          65600020
         L     FDNBASE,ASIOFF(FDNBASE)  SET UP DESIRED ENTRY TO ASI     65700020
         LR    EPREG,FDNBASE            PUT ADDR IN 2 REGS              65730020
         LR    DEQRTN,PARAM             PUT IOB ADDR IN ASI REGISTER    65760020
         B     FOUR(FDNBASE)            AND BRANCH TO IT                65800020
*                                                                       65900020
AFTPOSTQ EQU   *                                                        66000020
         LR    PARAM,W4                 ESTABLISH IOB WHICH WAS BEING   66100020
*                                       DEQ'ED                          66200020
         B     CONTDEQ                  GET INTO DEQ LOOP AGAIN         66400020
POSTNDQ  EQU   *                                                        66600020
         LA    W1,EXIT                                                  66700020
         ST    W1,IOBDQPTR              SET RETURN ADDRESS FROM POST    66800020
         B     GOTOPOST                 GO POST                         66900020
NOKEYCP  EQU   *                                                        67000020
         USING WRITEADD,W1              REESTAB CHAN PGM BASE    Y02072 67050002
         MVC   WANKWD+CNTOFF(TWO),SAVELL MOVE DATA LENGTH TO WRITE CCW  67100020
         DROP  W1                       DROP CHAN PGM BASE       Y02072 67150002
         B     AFTERLL                  GO FINISH THE SET UP            67200020
*                                                                       67300020
MOVE256  MVC   NULL(FFF,W2),NULL(W3)    MOVE 256 BYTES                  67400020
         LA    W2,FFF(W2)               *                               67500020
         LA    W3,FFF(W3)                * UPDATE MOVE AREA POINTERS    67600020
         B     MOVE                     *  AND GO SEE IF MORE TO MOVE   67700020
*                                                                       67800020
AMOVE    MVC   NULL(NULL,W2),NULL(W3)   - EXECUTED - MOVE LESS THAN 256 67900020
*                                                                       68000020
EXIT     EQU   *                                                        68100020
         SVC   EXITSVC                  EXIT                            68200020
*                                                                       68300020
*                                                                       68400020
*********************************************************************** 68450002
*                CONSTANTS AND EQUATES                                  68460002
*********************************************************************** 68500020
         DS    0F                                                       68550002
H8       DC    H'8'                     IOB PREFIX SIZE                 68600020
H4       DC    H'4'                     DESCRIPTOR LENGTHS              68700020
H256     DC    H'256'                   *                               68800020
H255     DC    H'255'                    * CONSTANTS USED BY MOVE RTN   68900020
FFF      EQU   256                      *                               69000020
DEBBASE  EQU   32                       SIZE OF DEB BASE PORTION        69100020
RCDNOFIT EQU   X'FD'                    MASK TO TURN OFF RCDFIT BIT     69200020
DEQIP    EQU   X'80'                    DEQ IN PROCESS INDICATOR        69300020
DEQIPOFF EQU   X'7F'                    MASK TO TURN DEQIP OFF          69400020
NOINTRPT DC    X'00'                    DISALLOW ALL INTERRUPTS         69500020
INTRPTOK DC    X'FF'                    ALLOW ALL INTERRUPTS            69600020
NOREAD   EQU   X'F7'                                                    69700020
TBOVHD   EQU   X'08'                    2305 MASK                20201  70030020
BYTEDEV  EQU   9                                                 20201  70060020
EXITSVC  EQU   3                        EXIT SVC NO.                    70100020
DEVSZ    EQU   0                        DEVICE SIZE CCHH                70200020
TRKLNGTH EQU   4                        TRACK LENGTH                    70300020
OVERI    EQU   6                        OVERHEAD NOT LAST RECORD        70400020
OVERL    EQU   7                        OVERHEAD LAST RECORD            70500020
OVERK    EQU   8                        OVERHEAD KEYED RECORD           70600020
FLAG     EQU   9                        FLAG                            70700020
TOLER    EQU   10                       TOLERANCE                       70800020
*        CCW FLAGS AND COUNT                                            70900020
         DS    0F                                                       71000020
LASTFOUR DC    X'0000000F'              CLEARS ALL BUT LOW ORDER 4 BITS 71100020
ASIOFF   EQU   16                       ASI ADDR SLOT IN FOUNDATION     71200020
FDBOFF   EQU   4                        FEEDBACK BRANCH IN ASI          71300020
POOLOFF  EQU   12                       IOB POOL BRANCH IN ASI          71400020
CFORFLG  EQU   X'08'                    CAUSED FORMAT FLAG              71600020
CLRFFLAG EQU   X'FE'                                                    71700020
*        CHANNEL PROGRAM OP-CODES                                       71800020
SCHID    EQU   X'31'                    SEARCH ID EQUAL                 71900020
TIC      EQU   X'08'                    TRANSFER IN CHANNEL             72000020
READD    EQU   X'06'                    READ DATA                       72100020
WRTD     EQU   X'05'                    WRITE DATA                      72200020
WRTCKD   EQU   X'1D'                    WRITE COUNT KEY DATA            72300020
*        CCW FLAGS                                                      72400020
DCSKFLG  EQU   X'F0'                    CD CC SILI SKIP FLAG BITS       72500020
DCCC     EQU   X'C0'                    DATA + COMMAND CHAIN            72600020
SKIP     EQU   X'10'                    SKIP DATA TRANSFER              72700020
CC       EQU   X'40'                    COMMAND CHAIN                   72800020
SILI     EQU   X'20'                    SUPPRESS INCORRECT LENGTH       72900020
CCSI     EQU   X'60'                    COMMAND CHAIN  SUPPRESS LENGTH  73000020
CNTOFF   EQU   6                        OFFSET TO THE COUNT FIELD IN A  73100020
*                                       CCW                             73200020
ONE      EQU   X'1'                                                     73300020
TWO      EQU   2                                                        73400020
THREE    EQU   3                                                        73500020
FOUR     EQU   4                                                        73600020
FIVE     EQU   X'5'                                                     73700020
SIX      EQU   6                                                        73800020
SEVEN    EQU   X'7'                                                     73900020
NINE     EQU   9                                                        74000020
TYPCD    EQU   19                       DA TYPE CODE OFFSET IN UCB      74100020
ABNORM   EQU   X'80'                    ABNORMAL COMPLETION INDICATOR   74200020
FOR1     EQU   X'02'                    TEST FOR FORMAT 1               74300020
*              EXCEPTION CODES                                          74400020
NOREC    EQU   X'80'                                                    74500020
LGNCK    EQU   X'40'                                                    74600020
NOSPA    EQU   X'20'                                                    74700020
INVAL    EQU   X'10'                                                    74800020
UNCOR    EQU   X'08'                                                    74900020
ENDOD    EQU   X'04'                                                    75000020
UNREL    EQU   X'02'                                                    75100020
*              OPTIONS AND TYPE                                         75200020
OFLOW    EQU   X'40'                                                    75300020
EXSCH    EQU   X'20'                                                    75400020
FEEDB    EQU   X'10'                                                    75500020
ACTAD    EQU   X'08'                                                    75600020
DYNBF    EQU   X'04'                                                    75700020
READX    EQU   X'02'                                                    75800020
RELRD    EQU   X'01'                                                    75900020
KEYOP    EQU   X'80'                                                    76000020
LGNOP    EQU   X'40'                                                    76100020
READ     EQU   X'08'                                                    76200020
KEY      EQU   X'04'                                                    76300020
ADD      EQU   X'02'                                                    76400020
MODID    DC    C'IGGR19KN'              MODULE NAME            @ZA12909 76480000
DATE     DC    CL8'&SYSDATE'            DATE COMPILED          @ZA12909 76560000
FIX      DC    C'OZ12909'               LATEST APAR NR         @ZA12909 76640000
PATCH    DC    XL((*-IGG019KN)/20)'0'   5% PATCH AREA            Y02072 76750002
         EJECT                                                          76760002
*********************************************************************** 76800020
*                      DSECTS                                           76900002
*********************************************************************** 76950002
         DCBD  DSORG=DA                                                 77500020
         EJECT                                                          77600020
CVTDEF   DSECT                                                          77700020
         CVT                                                            77800020
         EJECT                                                          77900020
         IECDRQE                                                 Y02072 77950002
         EJECT                                                          77960002
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       78000020
         DS    0F                                                       78100020
DECBDEF  DSECT                                                          78200020
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        78300020
DECTYPE  DS    CL2            TYPE FIELD                                78400020
DECLNGTH DS    CL2            DATA LENGTH                               78500020
DECDCBAD DS    CL4            ADDRESS OF DCB                            78600020
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      78700020
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        78800020
DECKYADR DS    CL4            ADDRESS OF KEY                            78900020
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               79000020
DECNA    DS    CL4            ADDRESS OF NEXT ADDRESS FEEDBACK AREA     79100020
         EJECT                                                          79200020
         IEZIOB                                                  Y02072 79250002
         EJECT                                                          83800020
*   THE FOLLOWING DSECT SHOWS THE FORMAT OF THE SEGMENT WORK AREA       83900020
*                                                                       84000020
SWA      DSECT                          SEGMENT WORK AREA DSECT         84100020
SWANXTPT DS    F                        POINTER TO NEXT SWA             84200020
SWARAPT  DS    F                        POINTER TO THE RECORD AREA      84300020
SWABFINC DS    CL2                      BUFFER INCREMENT FIELD          84400020
SWABDW   DS    CL4                      BLOCK DESCRIPTOR WORD           84500020
SAVEID   EQU   SWABDW+5                 SAVE AREA FOR ID OF LAST SEGMNT 84600020
SWASDW   DS    0CL4                     SEGMENT DESCRIPTOR WORD         84700020
SEGLL    DS    H                        SEGMENT LENGTH (LL)             84800020
SEGFLGS  DS    C                        SEGMENTATION FLAGS              84900020
SVDEQRTN EQU   SWA+16                   SAVE DEQ RTN RETURN ADDR        84950020
SEGUNUSD DS    C                        CURRENTLY UNUSED                85000020
SEGDATA  DS    C                        DATA PORTION OF RECORD          85100020
*                                                                       85200020
*                                                                       85300020
*   WHEN THE SEGMENT WORK AREA IS USED FOR A TEMPORARY WORK SPACE, IT   85400020
*   HAS THE FOLLOWING USAGE -                                           85500020
         ORG   SWA                      START AT SWA                    85600020
SWAWNXTB DS    F                        POINTER TO NEXT SWA (UNCHANGED) 85700020
TRKCNT   DS    C                        TRACK COUNT (NBR OF TRACKS      85800020
*                                            USED FOR THE RECORD)       85900020
SAVEMBB  DS    CL3                      SAVE MBB FROM IOBSEEK           86000020
SVCCHHR  DS    CL5                      CCHHR OF LAST RECORD ON THE     86100020
*                                            FIRST TRACK EXAMINED       86200020
SAVELL   DS    CL2                      LENGTH OF THE FIRST SEGMENT TO  86300020
*                                            BE FORMED, OR A 3 BYTE     86400020
         DS    C                             SAVE AREA FOR MBB WHEN A   86500020
*                                            SEARCH IS TO BE RESTARTED  86600020
         EJECT                                                          86700020
*********************************************************************** 86800020
*                                                                     * 86900020
*                                                                     * 87000020
*                       CHANNEL PROGRAM DSECTS                        * 87100020
*                                                                     * 87200020
*                                                                     * 87300020
*********************************************************************** 87400020
         SPACE 10                                                       87500020
*                                                                       87600020
*   ORIGINAL CHANNEL PROGRAM TO WRITE (ADD) A NEW VRE RECORD            87700020
*                                                                       87800020
WRITEADD DSECT                                                          87900020
WANOP1   DS    D                  CCW1  NOP                             88000020
WASIE1   DS    D                  CCW2  SEARCH ID EQUAL (R0)            88100020
WATIC1   DS    D                  CCW3  TIC TO CCW2                     88200020
WARD     DS    D                  CCW4  READ DATA (R0)                  88300020
WANOP2   DS    D                  CCW5  NOP                             88400020
WASIE2   DS    D                  CCW6  SEARCH ID EQUAL (R0)            88500020
WATIC2   DS    D                  CCW7  TIC TO CCW6                     88600020
WAWDR0   DS    D                  CCW8  UPDATE CAPACITY RECORD          88700020
WASIE3   DS    D                  CCW9  SEARCH ID EQUAL                 88800020
WATIC3   DS    D                  CCW10 TIC TO CCW9                     88900020
WAWCKD1  DS    D                  CCW11 WRITE COUNT                     89000020
* THE NEXT CCW'S MAY BE PRESENT ONLY IF KEYS ARE TO BE WRITTEN.         89100020
WAKWK    DS    D                  CCW12 WRITE KEY                       89200020
WAKWD    DS    D                  CCW13 WRITE DATA                      89300020
WAKNOP1  DS    D               ** CCW14 NOP                             89400020
WAKNOP2  DS    D               ** CCW15 NOP                             89500020
WAKSIE   DS    D               ** CCW16 SEARCH ID EQUAL                 89600020
WAKTIC   DS    D               ** CCW17 TIC TO CCW16                    89700020
WAKRKD   DS    D               ** CCW18 READ-KEY-DATA TO DO WRITE CHECK 89800020
WAKRR0   DS    D               ** CCW19 WRITE CHECK R0                  89900020
* IF KEYS ARE NOT TO BE WRITTEN, THE FOLLOWING CCW'S ARE USED           90000020
WANK     EQU   WAKWK-WRITEADD                                           90100020
         ORG   WRITEADD+WANK      ORG BACK TO CCW12                     90200020
WANKWD   DS    D                  CCW12 WRITE DATA                      90300020
WANKNOP1 DS    D               ** CCW13 NOP                             90400020
WANKNOP2 DS    D               ** CCW14 NOP                             90500020
WANKSIE  DS    D               ** CCW15 SEARCH ID EQUAL                 90600020
WANKTIC  DS    D               ** CCW16 TIC TO CCW15                    90700020
WANKRKD  DS    D               ** CCW17 READ-KEY-DATA TO DO WRITE CHECK 90800020
WANKRR0  DS    D               ** CCW18 WRITE CHECK R0                  90900020
*                                                                       91000020
*                              ** THESE CCW'S ARE INCLUDED ONLY IF      91100020
*                                 WRITE CHECK IS REQUESTED.             91200020
         SPACE 3                                                        91300020
*                                                                       91400020
*   CHANNEL PROGRAM FOR WRITE ADD AFTER WRITING THE FIRST SEGMENT       91500020
*                                                                       91600020
WRITADD1 DSECT                                                          91700020
WA1NOP1  DS    D                  CCW1  NOP                             91800020
WA1SIE   DS    D                  CCW2  SEARCH ID EQUAL (R0)            91900020
WA1TIC   DS    D                  CCW3  TIC TO CCW2                     92000020
WA1WC    DS    D                  CCW4  WRITE COUNT                     92070020
WA1WD    DS    D                  CCW5  WRITE DATA                      92140020
WA1SIE2  DS    D                  CCW6  SEARCH ID EQUAL (R0)            92210020
WA1TIC2  DS    D                  CCW7  TIC TO CCW6                     92280020
WA1WCR   DS    D                  CCW8  UPDATE CAPACITY RECORD          92350020
WA1NOP2  DS    D               ** CCW9  NOP                             92420020
WA1RR0   DS    D               ** CCW10 READ R0 FOR WRITE CHECK         92490020
WA1RD    DS    D               ** CCW11 READ DATA FOR WRITE CHECK       92560020
*                                                                       92700020
*                              ** THESE CCW'S ARE INCLUDED WHEN WRITE   92800020
*                                 CHECK IS REQUESTED.                   92900020
         END                                                            93000020
./  ADD  SSI=33460784,NAME=IGG019KO
 TITLE   'IGG019KO - PRE-FORMAT WRITE ADD, FIXED RECORDS'               00020402
IGG019KO CSECT                                                          00020802
*MODULE NAME - IGG019KO                                               * 00020902
*                                                                     * 00024602
*DESCRIPTIVE NAME - BDAM WRITE ADD(PRE-FORMAT) FOR FIXED RECORDS      * 00026602
*                                                                     * 00028602
*COPYRIGHT - NONE                                                     * 00030602
*                                                                     * 00031002
*CHANGE ACTIVITY                                                      * 00031402
*                                                                     * 00032002
*          OS 20 CHANGES/DELETIONS                                      00035002
*1777000230-000260,000380-000500,013800                          20201  00036020
*          OS 21 CHANGES/DELETIONS                                      00046002
*          VS1-1 CHANGES/DELETIONS                                      00066002
*          VS2-1 CHANGES/DELETIONS                                      00076002
*                                                                YM3694 00076402
*          VS1-2 CHANGES/DELETIONS                                      00078002
*          VS2-2 CHANGES/DELETIONS                                      00078402
*                                                                Y02072 00078802
*                                                                YM3857 00079202
*                                                                YM2862 00079602
*                                                                YM5705 00079702
*                                                                YM5762 00079802
*                                                                       00080020
*STATUS CHANGE LEVEL 007                                                00100002
*                                                                       00110002
*FUNCTION/OPERATION- THIS ROUTINE IS ENTERED TO CONSTRUCT THE CHANNEL * 00120020
*   PROGRAM TO ADD A NEW BLOCK TO A DATA SET OF FIXED FORMAT RECORDS. * 00140020
*   THE CCWS ARE CONSTRUCTED OF CONSTANTS DEFINED IN THIS MODULE AND  * 00160020
*   ADDRESSES RESOLVED AT THE TIME THIS CODE IS EXECUTED.             * 00180020
*                                                                     * 00200020
*ENTRY POINT- 'IGG019KO' (BEGIN) IS ENTERED FROM MODULE IGG019KA BY   * 00220020
*   THE CALLING SEQUENCE,   L    15,DCBDFOR                           * 00240020
*                           BALR 14,15                                * 00260020
*                                                                     * 00280020
*INPUT- THE REGISTERS ARE USED AS INPUT AS FOLLOWS,                   * 00300020
*   4 - DCB ADDRESS                                                   * 00320020
*   5 - DECB ADDRESS                                                  * 00340020
*   6 - ADDRESS OF CCW 1 (IOB+80)                                     * 00360020
*   7 - IOB ADDRESS                                                   * 00380020
*   11- BASE ADDRESS OF MODULE IGG019KA (FOUNDATION MODULE)           * 00400020
*                                                                     * 00420020
*OUTPUT- THE REQUIRED CCWS WILL BE CONSTRUCTED FOLLOWING THE IOB.     * 00440002
*   REGISTER 6 WILL CONTAIN THE ADDRESS OF THE LAST CCW.              * 00460020
*                                                                     * 00480020
*EXTERNAL ROUTINES- 'IGG019KQ' IS ENTERED TO ADD THE VERIFY CCWS IF   * 00500020
*   THAT OPTION IS SPECIFIED. 'IGG019LA' IS ENTERED TO ADD EXTENDED   * 00520002
*   SEARCH CCWS IF THAT OPTION IS SPECIFIED.                          * 00530002
*                                                                     * 00540020
*EXIT-NORMAL- 'D9EXIT' IS THE NORMAL RETURN TO THE FOUNDATION MODULE  * 00560020
*   WHEN ALL CCWS ARE COMPLETE.                                       * 00580020
*   'D9TOVER' IS THE EXIT TO MODULE IGG019KQ                          * 00600020
*EXIT-ERROR- 'D9ERR' IS AN EXIT TO THE INVALID REQUEST ERROR ROUTINE  * 00620020
*   IN MODULE IGG019KA WHEN IT HAS BEEN DETERMINED THAT THE USER IS   * 00640020
*   ATTEMPTING TO ADD A RECORD WHOSE KEY IS THE SAME AS A DUMMY KEY.  * 00660020
* REGISTER 12 WILL CONTAIN AN INVALID REQUEST ERROR CODE.             * 00680020
*                                                                     * 00700020
*TABLES/WORK AREAS- NOA                                               * 00720020
*                                                                     * 00740020
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.          * 00760020
*                                                                     * 00780020
*NOTE- THE REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT WITH  * 00800020
*   THE MODULES, IGG019KA, IGG019KQ, IGG019LA.                        * 00820002
*                                                                       00840020
         USING IGG019KO,D9EPREG                                         00860020
         USING IHADCB,DCBREG                                            00880020
         USING DECBDEF,DECBREG                                          00900020
         USING IOBSTDRD,IOBREG                                   Y02072 00920002
*                                                                       00940020
*                                                                       00960020
*   REGISTER USAGE                                                      00980020
*                                                                       01000020
D9WKREG  EQU   0                       WORK REGISTER                    01020020
D9VERR   EQU   1                       ADDR. OF SEARCH CCW FOR VERIFY   01040020
WORKREGA EQU   2                       WORKREG FOR BUILDING CP   YM3857 01050002
DEBREG   EQU   3                       DEB ADDRESS                      01060020
DCBREG   EQU   4                       DCB ADDRESS                      01080020
DECBREG  EQU   5                       DECB ADDRESS                     01100020
D9CCWIND EQU   6                       CHANNEL PROGRAM INDEX            01120020
IOBREG   EQU   7                       IOB ADDRESS                      01140020
SECTOR   EQU   8                       PT TO 1ST SECTOR ADDRESS   20201 01150002
IOBWKREG EQU   9                       BASE FOR IOB WORKAREA     YM3857 01152002
VERBASE  EQU   10                      ENTRY POINT-BASE, VERIFY MODULE  01160020
FDNBASE  EQU   11                      BASE, FOUNDATION MODULE          01180020
D9WKRET  EQU   12                      RETURN FOR INTERNAL LINKAGE      01200020
SAVE     EQU   13                      USER'S SAVE AREA ADDRESS         01220020
D9RETREG EQU   14                      RETURN TO FOUNDATION MODULE      01240020
D9EPREG  EQU   15                      BASE OF THIS MODULE              01260020
*                                                                       01280020
*                                                                       01300020
*                                                                       01310002
*                                                                       01312002
BEGIN    B     D9ENTRY                  GO TO BEGINNING OF THE CODE     01320002
EPAD     DC    V(IGG019LA)              ADDRESS OF EXT. SEARCH MODULE   01340002
*                                       IGG019LA, WHICH IS LINKEDITED   01360002
*                                       WITH THIS ONE            Y02072 01362002
D9ENTRY  EQU   *                                                  20201 01370002
         L     D9VERR,DECKYADR          TEST TO BE SURE THE       20201 01380002
*                                       USER'S                    20201 01390002
         TM    0(D9VERR),X'FF'          KEY DOES NOT HAVE BITS LIKE THE 01400020
         BC    12,D9OKKEY               DUMMY KEY, BRANCH IF OK.        01420020
         IC    D9WKRET,D9INVKY          ELSE INSERT EXCEPTION CODE,     01440020
         L     D9RETREG,D9ERRET(0,FDNBASE) LOCATE ERROR ROUTINE         01460020
D9ERR    BCR   15,D9RETREG              AND GO POST AS INVALID REQUEST  01480020
*                                                                       01500020
D9OKKEY  TM    IOBDTYPE,IOBEXTSC        TEST FOR EXTENDED SEARCH Y02072 01520002
         BO    D9XSCH                   AND GO TO THAT LINKAGE   Y02072 01540002
         LA    D9WKREG,IOBDNCRF+2       DEVELOP AND STORE ADDRESS       01560002
         ST    D9WKREG,0(D9CCWIND)      FOR READING FEEDBACK            01580002
         MVI   0(D9CCWIND),D9RDCNT      MOVE READ COUNT OP CODE         01600020
         MVI   4(D9CCWIND),D9CSFLG      SET COMMAND CHAIN, SILI FLAGS   01620002
         MVI   7(D9CCWIND),D9FIVE       MOVE COUNT OF FIVE              01640002
         ST    D9CCWIND,16(D9CCWIND)    INSERT TIC ADDRESS              01660020
         LA    D9CCWIND,8(D9CCWIND)     INCREMENT INDEX                 01680020
D9BOTH   EQU   *                        SET UP WORKAREA BASE     YM3857 01690002
         LA    IOBWKREG,0(IOBREG)       GET IOB BASE,CLR TOP     YM3857 01692002
         AH    IOBWKREG,IOBDIOBS        ADD IOB SIZE TO BASE     YM3857 01696002
         SH    IOBWKREG,WRKSIZE         SUBT WORKAREA SIZE       YM3857 01698002
         USING WRKIOB,IOBWKREG          BASE FOR IOB WORKAREA    YM3857 01698402
         LA    SECTOR,NCCWC(D9CCWIND)   DEVELOP ADDR OF          YM3694 01700002
         MVI   0(SECTOR),DUMKEY         DUMMY KEY                YM3694 01710002
         ST    SECTOR,0(D9CCWIND)       FOR SEARCH ARGUMENT      YM3694 01720002
         MVI   0(D9CCWIND),D9SCHKEY     MOVE SEARCH KEY EQUAL OP CODE   01740020
         MVC   4(5,D9CCWIND),D9CON3     MOVE FLAGS, COUNT, TIC OP CODE  01760020
         LA    D9WKREG,IOBDNCRF+6       DEVELOP AND STORE ADDR   Y02072 01780002
         ST    D9WKREG,16(D9CCWIND)     FOR READING DUMMY RECORD ID     01800002
         MVI   16(D9CCWIND),D9RDDATA    MOVE READ DATA OP CODE          01820020
         MVI   20(D9CCWIND),D9CSFLG     COMMAND CHAIN, SILI FLAGS 24512 01840020
         MVI   23(D9CCWIND),D9ONE       SET COUNT TO ONE                01860020
         LA    D9CCWIND,TWOCCW(D9CCWIND) POINT TO READ DATA      YM3857 01862002
         ST    D9CCWIND,WRKRDAD         SAVE RD DATA CCW ADDR    YM3857 01864002
         LA    D9CCWIND,FULLCCW(D9CCWIND) INCREMENT TO OPT SEEK  YM3857 01870002
         TM    IOBDCPND,YESCARN         IS RPS FEATURED           20201 01880602
         BO    NEEDRS                   YES. NEED READ SECTOR    YM3857 01881202
         MVC   WRKCCAD,WRKRDAD          NO RPS-INST WHERE COMMND YM3857 01881602
*                                       CHAIN COULD BE CHANGED   YM3857 01882002
*                                       IS SAME AS READ DATA     YM3857 01882102
         B     NOTCARN1                 CONTINUE BUILDING CH PGM YM3857 01882202
NEEDRS   EQU   *                        CONTINUE CHAN PGM        YM3857 01882302
         L     SECTOR,IOBDCPND          GET SECTOR ADDR IF RPS   20201  01882420
         LA    SECTOR,ONEBYTE(0,SECTOR) YES, POINT TO SET SECTOR 20201  01883020
*                                       AREA                     20201  01883620
         ST    SECTOR,D0(D9CCWIND)      PUT POINTER IN CCW       20201  01884220
         MVI   D0(D9CCWIND),RDSECT      PUT IN RD SECT COMMAND   20201  01884820
         MVC   HALFCCW(HALFCCW,D9CCWIND),FLAGCNT   PUT IN        20201  01885420
*                                       FLAG/COUNT               20201  01886020
         ST    D9CCWIND,WRKCCAD         SAVE COM CHAIN - NO RPS  YM3857 01886402
         LA    D9CCWIND,FULLCCW(0,D9CCWIND)  UPDATE PT TO NEXT   20201  01886620
*                                       CCW                      20201  01887220
NOTCARN1 EQU   *                                                 20201  01887820
         TM    IOBDTYPE,IOBOVFLO        TEST FOR TRK OVERFLOW    Y02072 01890002
         BZ    D9NOTOF                  BRANCH TO OMIT SEEK       24512 01900020
         LA    D9WKREG,IOBDNCRF         IF NOT USING OPTION.      24512 01910002
         ST    D9WKREG,0(0,D9CCWIND)    OTHERWISE, SEEK NEEDED.   24512 01920020
         MVI   0(D9CCWIND),D9SEEKOP                               24512 01930020
         MVI   4(D9CCWIND),D9CFLG                                 24512 01940020
         MVI   7(D9CCWIND),D9SIX                                  24512 01950020
         ST    D9CCWIND,WRKSKCYL        SAVE SEEK CYL ADDR       YM3857 01952002
         LA    D9CCWIND,FULLCCW(D9CCWIND) UP CHAN PGM PTR        Y02072 01960002
D9NOTOF  EQU   *                                                  24512 01970020
         ST    D9CCWIND,WRKSTRT3        SAVE ADDR OF CHAN PGM    YM3857 01972402
*                                       START IF KEY WRITTEN     YM3857 01972802
         TM    IOBDCPND,YESCARN         DO WE GOT RPS            20201  01974020
         BNO   NOTCARN2                 NO, SO SEE ABOUT SCH ID  20201  01976020
         ST    SECTOR,D0(D0,D9CCWIND)   PUT IN CCW ADDR FIELD    20201  01978020
         MVI   D0(D9CCWIND),SETSECT     INSERT SET SECT COMMAND  20201  01980020
         MVC   HALFCCW(HALFCCW,D9CCWIND),FLAGCNT  IMPLACE FLAG & 20201  01982020
*                                       COUNT                    20201  01984020
         LA    D9CCWIND,FULLCCW(0,D9CCWIND)  UPDATE PT TO NEXT   20201  01986020
*                                       CCW                      20201  01988020
NOTCARN2 EQU   *                                                 20201  01990020
         LA    D9WKREG,IOBDNCRF+2       CONSTRUCT SCH ID EQUAL CCW MC0J 02000002
         ST    D9WKREG,0(D9CCWIND)      USING IOBSEEK AND ID READ FROM  02080002
         MVI   0(D9CCWIND),D9SCHID      THE DUMMY RECORD                02100002
         ST    D9CCWIND,8(D9CCWIND)     SET TIC ADDRESS TO SEARCH CCW   02120020
         MVC   4(5,D9CCWIND),D9CON9     MOVE FLAGS, COUNT, TIC OP CODE  02140002
         LA    D9VERR,TWOCCW(D9CCWIND)  GET ADDR OF WRT KEY/DATA YM3857 02150002
         ST    D9VERR,WRKWKD            ST ADDR OF WRT KEY/DATA  YM3857 02152002
         MVI   16(D9CCWIND),D9WRTKD     MOVE WRITE KEY-DATA OP CODE     02160020
         MVC   17(3,D9CCWIND),DECKYADR+1 MOVE KEY ADDRESS               02180020
         MVI   20(D9CCWIND),D9DCFLG     DATA, COMMAND CHAIN FLAGS       02200002
         MVC   23(1,D9CCWIND),DCBKEYLE  KEY LENGTH                      02220020
         MVI   24(D9CCWIND),D9WRTD      MOVE WRITE DATA OP CODE         02240020
         MVC   25(3,D9CCWIND),DECAREA+1 AREA ADDRESS                    02260002
         MVC   30(2,D9CCWIND),DECLNGTH  MOVE DECB LENGTH AS COUNT       02280002
*                                                                       02282002
*     BUILD SECOND PART OF CHANNEL PGM, WHICH WILL BE                   02290002
*     EXECUTED ONLY IF THE ABNORMAL END APPENDAGE SHOULD                02292002
*     HAPPEN TO GET CONTROL BEFORE THE FIRST PART OF THE CHANNEL        02294002
*     PROGRAM IS COMPLETELY EXECUTED. SEE THE ABNORMAL END              02296002
*     APPENDAGE FOR DESCRIPTION OF LOGIC.                               02298002
*                                                                       02298402
         L     WORKREGA,IOBDCPND        LOAD CH PGM END ADDR     YM3857 02298802
         LA    WORKREGA,0(WORKREGA)     CLEAR TOP BYTE           YM3857 02298902
         SH    WORKREGA,NEWCP           SUBT SIZE OF NEW CH PGM  YM3857 02299202
         TM    IOBDCPND,YESCARN         IS RPS ON DEVICE         YM3857 02299602
         BNO   RPSNO                    IF NOT BRANCH            YM3857 02299702
         ST    SECTOR,0(WORKREGA)       STORE SECTOR ADDR IN CCW YM3857 02299802
         ST    WORKREGA,WRKSTRT2        STORE CP START AFTER     YM3857 02299902
*                                       DUMMY RECORD FOUND       YM3857 02303902
         MVI   0(WORKREGA),SETSECT      MOVE SET SECTOR OPCODE   YM5705 02308002
         MVC   HALFCCW(HALFCCW,WORKREGA),FLAGCNT  MV IN CC/CNT   YM3857 02312002
         LA    WORKREGA,FULLCCW(WORKREGA) PT REG TO NEXT CCW     YM3857 02314002
         B     CONTINUE                 CONTINUE BUILDING CP     YM3857 02314402
*                                                                       02316002
RPSNO    EQU   *                        BUILD SID/TIC CCWS       YM3857 02320002
         LA    WORKREGA,FULLCCW(WORKREGA) PT REG TO NEXT CCW     YM3857 02322002
         ST    WORKREGA,WRKSTRT2        ST CP START-NO RPS-AFTER YM3857 02324002
*                                       DUMMY RECORD FOUND       YM3857 02324402
CONTINUE EQU   *                        CONTINUE BUILDING CP     YM3857 02326002
         ST    D9WKREG,0(WORKREGA)      ADDR OF IOBDNRCF+2       YM3857 02330002
         MVI   0(WORKREGA),D9SCHID      USED IN SID CCW          YM3857 02330402
         ST    WORKREGA,FULLCCW(WORKREGA) SAVE THIS ADDR IN TIC  YM3857 02330802
         MVC   HALFCCW(CCTICLG,WORKREGA),D9CON9   MV IN CC/TIC   YM3857 02331202
         LA    D9VERR,NCCWC(WORKREGA)   GET ADDR OF FF TO BE     YM3857 02331302
*                                       STORED AT TIC + 6        YM3857 02331702
         MVI   0(D9VERR),DUMKEY         STORE DUMMY KEY HERE     YM3857 02332202
         LA    WORKREGA,TWOCCW(WORKREGA) UP PTR 16 BYTES TO SKE  YM3857 02333602
         ST    D9VERR,0(WORKREGA)       ST ADDR OF DUM KEY - SKE YM3857 02337602
         MVI   0(WORKREGA),D9SCHKEY     MV IN X'29'=SKE OPCODE   YM3857 02339602
         MVC   HALFCCW(CCCTLG,WORKREGA),D9CON3  MV IN CC/CT CCW  YM3857 02340002
         LA    WORKREGA,FULLCCW(WORKREGA)  UP PTR TO NEXT CCW    YM3857 02340402
         MVI   0(WORKREGA),D9NOP        MV IN X'03' OPCODE-NOP   YM3857 02340802
         MVC   HALFCCW(CCCTLG,WORKREGA),D9CON4  MV IN CC/SILI/CT YM3857 02340902
         LA    WORKREGA,FULLCCW(WORKREGA) UP CCW PTR TO NEXT CCW YM3857 02341002
         MVC   0(FULLCCW,WORKREGA),RDHADDR READ HA AS DUMMY READ YM5762 02343002
*                                       BETWEEN SIDS ON SAME REC YM2862 02345002
*                                       RESETS INDEX MARKER      YM2862 02345102
         LA    WORKREGA,FULLCCW(WORKREGA) UP CCW PTR TO NEXT CCW YM2862 02345202
         L     D9VERR,WRKSTRT3          GET START IF KEY WRITTEN YM3857 02349602
         ST    D9VERR,0(WORKREGA)       STORE IN TIC CCW         YM3857 02353802
         MVI   0(WORKREGA),D9TIC        MV IN TIC OPCODE         YM3857 02358002
         DROP  IOBWKREG                 DROP WORKAREA BASE       YM3857 02362202
*                                                                       02366402
*   CONTINUE BUILDING MAIN PART OF CHANNEL PROGRAM IF VERIFY SPECIFIED  02370602
*                                                                       02374802
         LR    D9VERR,D9CCWIND          SAVE SEARCH ADDR. FOR VERIFY    02379002
         LA    D9CCWIND,24(D9CCWIND)    INCREMENT TO LAST CCW           02383202
         TM    IOBDTYPE,IOBVERFY        TEST FOR WRITE VERIFY    Y02072 02387402
         BZR   D9RETREG                 NO , CHANNEL PROGRAM IS DONE    02391602
         L     VERBASE,12(0,FDNBASE)    LOAD VERIFY ENTRY POINT/BASE    02395802
         BR    VERBASE                  GO CONSTRUCT VERIFY CCWS        02400002
*                                       VERIFY MODULE WILL RETURN TO    02420002
*                                       FOUNDATION ON REGISTER 14       02440002
D9XSCH   LA    D9WKRET,D9BOTH           SET RETURN ADDRESS              02480002
         L     D9EPREG,EPAD             LOAD ADDR. OF EXTENDED MODULE   02500002
         BR    D9EPREG                  GO CONSTRUCT EXT. SEARCH CCW'S  02520002
*                                                                       02540020
         EJECT                                                          02560020
*                                                                       02580020
D9RDCNT  EQU   X'12'  READ-COUNT OP CODE                                02600020
D9CSFLG  EQU   X'60'  COMMAND CHAIN, SUPPRESS INCORRECT LENGTH FLAGS    02620020
D9FIVE   EQU   X'05'  COUNT OF 5 FOR READ-COUNT                         02640020
D9CFLG   EQU   X'40'  COMMAND CHAIN                                     02660020
D9RDDATA EQU   X'06'  READ-DATA OP CODE                                 02680020
D9ONE    EQU   X'01'  COUNT OF ONE                                      02700020
D9SEEKOP EQU   X'0B'  SEEK CCHH OP-CODE                                 02720020
D9SIX    EQU   X'06'  COUNT FOR SEEK                                    02740020
D9SCHID  EQU   X'31'  SEARCH-ID-EQUAL OP CODE                           02760020
D9WRTKD  EQU   X'0D'  WRITE-KEY-DATA OP CODE                            02780020
D9DCFLG  EQU   X'C0'  DATA, COMMAND CHAIN FLAGS                         02800020
D9WRTD   EQU   X'05'  WRITE-DATA OP CODE                                02820020
D9SCHKEY EQU   X'29'  SEARCH-KEY-EQUAL                                  02840020
D9NOP    EQU   X'03'                    NOP OP CODE              YM3857 02850002
D9TIC    EQU   X'08'                    TIC OP CODE              YM3857 02852002
DUMKEY   EQU   X'FF'                    DUMMY KEY -AVAILABL RECS YM3857 02852402
D9ERRET  EQU   20                       OFFSET TO ERROR ROUTINE ADCON   02854002
NCCWC    EQU   14                       COUNT FIELD OF NEXT CCW  YM3694 02856002
D9CON3   DC    X'6000000108'  FLAGS, COUNT, TIC OP-CODE                 02860020
D9CON4   DC    X'20000001'              SILI/COUNT               YM3857 02870002
D9CON9   DC    X'4000000508'            FLAG,COUNT,TIC OP-CODE          02880002
RDHADDR  DC    XL8'1A00000070000001'    RD HA WITH SILI,SKIP,CC  YM5762 02890002
D9INVKY  DC    X'01'                    KEY MATCHES DUMMY KEY-ERROR     02920002
WRKSIZE  DC    H'28'                    SIZE OF WORKAREA         YM3857 02930002
NEWCP    DC    H'56'                    SIZE OF 2ND PART OF CP   YM5705 02940002
CCWLENG  DC    H'8'                     LENGTH OF CCW            YM3857 02940402
*                                                                       02940920
*                                                                       02941820
*          CONSTANTS AND EQUATES USED BY RPS                            02942720
*                                                                       02943620
*                                                                       02944520
FLAGCNT  DC    X'40000001'              STANDARD FLAG/COUNT      20201  02945420
*                                       FIELD                    20201  02946320
*                                                                       02947220
RDSECT   EQU   X'22'                    READ SECTOR COMMAND CODE 20201  02948120
SETSECT  EQU   X'23'                    SET SECTOR COMMAND CODE  20201  02949020
YESCARN  EQU   X'FF'                   BYTE TO TEST FOR RPS      20201  02949920
*                                                                       02950820
D0       EQU   0                        ZERO DISPLACEMENT        20201  02951720
ONEBYTE  EQU   1                        ONE BYTE DISPLACEMENT    20201  02952620
ADDR     EQU   3                        SIZE OF 3BYTE ADDR       YM3857 02953002
HALFCCW  EQU   4                        HALF CCW DISPLACEMENT    20201  02953520
CCCTLG   EQU   4                        LG OF CC/CT              YM3857 02953602
CCTICLG  EQU   5                        LG OF CC/CT/TIC          YM3857 02953902
FULLCCW  EQU   8                        FULL CCW DISPLACEMENT    20201  02954420
TWOCCW   EQU   16                       LG OF 2 CCWS             YM3857 02954802
*                                                                       02955320
*                                                                       02956220
*              EXCEPTION CODES                                          03020020
NOREC    EQU   X'80'                                                    03040020
LGNCK    EQU   X'40'                                                    03060020
NOSPA    EQU   X'20'                                                    03080020
INVAL    EQU   X'10'                                                    03100020
UNCOR    EQU   X'08'                                                    03120020
ENDOD    EQU   X'04'                                                    03140020
UNREL    EQU   X'02'                                                    03160020
MODID    DC    CL8'IGG019KO'            MODULE ID                Y02072 03442002
FIX      DC    C' YM5762 '              LATEST FIX IN MODULE     YM5762 03444002
DATE     DC    C'12/04/73'              DATE OF LATEST FIX       YM5762 03446002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 03450002
         EJECT                                                          03452002
*********************************************************************** 03454002
*                      DSECTS                                           03456002
*********************************************************************** 03458002
*                                                                       03458402
*********************************************************************** 03458802
*  THE FOLLOWING FORMATS THE WORKAREA LOCATED AT THE END OF IOB CORE.   03459202
*  (IN V,U,VS FORMATS FOR EARLIER RELEASES THIS CORE WAS THE ENQ LIST.) 03459502
*  THIS WORKAREA CONTAINS ADDRESSES OF PARTICULAR CCWS IN THE CHANNEL   03459602
*  PROGRAM, WHICH WILL BE INTERROGATED BY THE ABNORMAL END APPENDAGE    03459702
*  OR THE CHANNEL END APPENDAGE (BOTH IN IGG019KU) SHOULD THE CHANNEL   03459802
*  PROGRAM STOP BEFORE NORMAL COMPLETION.                               03459902
*********************************************************************** 03466602
WRKIOB   DSECT                          IOB WORKAREA DSECT       YM3857 03468602
WRKRDAD  DS    F                        ADDR OF CCW THAT READS   YM3857 03470602
*                                       IN 1 DATA BYTE = ID      YM3857 03472602
WRKCCAD  DS    F                        ADDR CCW THAT WILL NOT   YM3857 03473002
*                                       NOT BE COMMAND CHAINED   YM3857 03473102
*                                       TO NEXT IF ERROR OCCURS  YM3857 03473202
*                                       BEFORE IT.               YM3857 03479902
WRKSKCYL DS    F                        ADDR OF FIRST SEEK CYL   YM3857 03481902
*                                       WILL BE 0 IF NOT OVFLO   YM3857 03483902
WRKWKD   DS    F                        ADDR OF CCW THAT WRT KD  YM3857 03485902
WRKSTRT2 DS    F                        ADDR OF BEG CP ONCE      YM3857 03495902
*                                       DUMMY RECORD IS FOUND    YM3857 03497902
WRKSTRT3 DS    F                        ADDR OF BEG CP IF ANY    YM3857 03498302
*                                       PART OF KEY IS WRITTEN-  YM3857 03498702
*                                       ALSO, ADDR THAT 2ND PART YM3857 03499102
*                                       OF CP TICS BACK TO IN    YM3857 03499502
*                                       1ST PART OF CP           YM3857 03499602
*********************************************************************** 03499702
*      DATA CONTROL BLOCK (DCB) DEFINITION                              03499902
*                                                                       03506602
         DCBD  DSORG=DA                                                 03513302
*                                                                       03520020
*                                                                       03540020
*                                                                       03560020
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       03580020
         DS    0F                                                       03600020
DECBDEF  DSECT                                                          03620020
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        03640020
DECTYPE  DS    CL2            TYPE FIELD                                03660020
DECLNGTH DS    CL2            DATA LENGTH                               03680020
DECDCBAD DS    CL4            ADDRESS OF DCB                            03700020
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      03720020
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        03740020
DECKYADR DS    CL4            ADDRESS OF KEY                            03760020
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               03780020
         EJECT                                                          03800020
         IEZIOB                                                  Y02072 03810002
         END                                                            04700020
./  ADD  SSI=31840109,NAME=IGG019KQ
         TITLE 'IGG019KQ - WRITE VERIFY MODULE'                         00010019
IGG019KQ CSECT                                                          00020000
*                                                                       00023020
*                                                                       00026020
*        RELEASE 23 DELETIONS/CHANGES                                   00029020
*        RELEASE 22 DELETIONS/CHANGES                                   00032020
*        RELEASE 21 DELETIONS/CHANGES                                   00035020
*          RELEASE 18 DELETIONS                                         00040019
*          RELEASE 19 DELETIONS                                         00044019
*3000011800-012000,014200-014400                                 S19015 00046019
*          RELEASE 20 DELETIONS                                         00048019
*2971000240-000360,000520-000560,011870-012080,014000,018400     20201  00050020
*                                                                       00060019
*STATUS CHANGE LEVEL 004                                                00064020
*                                                                       00068019
*FUNCTION/OPERATION- THIS MODULE IS LOADED IF THE DCB SPECIFIED THE   * 00100000
*   WRITE VALIDITY CHECK OPTION, AND WILL CONSTRUCT THE ADDITIONAL    * 00120000
*   CCW'S NEEDED TO VERIFY THE DATA WRITTEN BY THE PREVIOUS CCW'S.    * 00140000
*   THE CCWS ARE CONSTRUCTED OF CONSTANTS DEFINED IN THIS MODULE AND  * 00160000
*   A SEARCH CCW AND TIC CODE MOVED FROM THE WRITE SEQUENCE OF CCWS.  * 00180000
*                                                                     * 00200000
*ENTRY POINT- 'IGG019KQ' (BEGIN) IS ENTERED FROM THE MODULE WHICH     * 00220000
*   CONSTRUCTED THE WRITE CHANNEL PROGRAM. CALLING SEQUENCE IS,       * 00240000
*   L    10,12(FOUNDATION MODULE BASE)                                * 00260000
*   BALR 12,10                                                        * 00280000
*                                                                     * 00300000
*INPUT- THE FOLLOWING REGISTERS ARE USED AS INPUT,                    * 00320000
*   1 - ADDRESS OF A SEARCH CCW TO BE MOVED TO THIS READ SEQUENCE     * 00340000
*   4 - DCB ADDRESS                                                   * 00360000
*   5 - DECB ADDRESS                                                  * 00380000
*   6 - ADDRESS OF THE LAST WRITE CCW                                 * 00400000
*   7 - IOB ADDRESS                                                   * 00420000
*                                                                     * 00440000
*OUTPUT- THE REQUIRED CCWS ARE ATTACHED TO THE WRITE CCWS IN THE      * 00460000
*   IOB. REGISTER 6 WILL BE POSITIONED AT THE LAST VERIFY CCW.        * 00480000
*                                                                     * 00500000
*EXTERNAL ROUTINES- N/A                                               * 00520000
*                                                                     * 00540000
*EXITS-NORMAL- 'EXIT1', 'EXIT2', 'EXIT3' ARE ALL NORMAL RETURNS TO THE* 00560000
*   CALLING ROUTINE.                                                  * 00580000
*                                                                     * 00600000
*TABLES/WORK AREAS- N/A                                               * 00620000
*                                                                     * 00640000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.          * 00660000
*                                                                     * 00680000
*NOTES- THIS MODULE IS USED BY THE BDAM MODUES, IGG019KK, IGG019KI,   * 00700000
*   IGG019KM, IGG019KO AND THE REGISTER USAGE MUST REMAIN CONSISTENT  * 00720000
*   WITH THOSE MODULES.                                               * 00740000
         EJECT                                                          00760000
*                                                                       00780000
         USING IGG019KQ,VERBASE                                         00800000
         USING IOBDEF,IOBREG                                            00820000
         USING IHADCB,DCBREG                                            00840000
         USING DECBDEF,DECBREG                                          00860000
*                                                                       00880000
*  REGISTER USAGE                                                       00900000
*                                                                       00920000
SCHREG   EQU   1                       SEARCH CCW PARAMETER             00940000
VWKREG   EQU   2                       WORK REGISTER                    00960000
DEBREG   EQU   3                       DEB ADDRESS                      00980000
DCBREG   EQU   4                       DCB ADDRESS                      01000000
DECBREG  EQU   5                       DECB ADDRESS                     01020000
CCWIND   EQU   6                       CHANNEL PROGRAM INDEX            01040000
IOBREG   EQU   7                       IOB ADDRESS                      01060000
VERBASE  EQU   10                      ENTRY POINT-BASE, THIS MODULE    01080000
VRETREG  EQU   14                      RETURN TO FOUNDATION MODULE      01100000
VEPREG   EQU   15                      BASE OF CALLING MODULE           01120000
*                                                                       01140000
*                                                                       01160000
BEGIN    EQU   *                                                 S19015 01163019
         TM    DCBBFTEK,RBFTKMSK        IS THIS VRE              S19015 01166019
         BZ    NOTVS                    NO,GO TURN ON  CMD       S19015 01169019
*                                       CHAINING                 S19015 01172019
         TM    DECTYPE+ONE,ADD          IS THIS TYPE DI-NOT ADD  S19015 01175019
         BZ    ESTST                    YES,GO TEST FOR EXTENDED S19015 01178019
*                                       SE                       S19015 01181019
         OI    FOUR(CCWIND),CCHN        TURN ON CMD CHAIN BIT    S19015 01184019
NOPS     EQU   *                                                 20201  01184920
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  01185820
         BNE   NOTRRA                   BRANCH IF NO             20201  01186720
         L     VWKREG,IOBDCPND          GET SECTOR ADDR          20201  01187620
         LA    VWKREG,B1(VWKREG)        INCR BY ONE              20201  01188520
         ST    VWKREG,D8(CCWIND)        PUT IN CCW               20201  01189420
         MVI   D8(CCWIND),RDSC          PUT IN RD SECTOR CMND    20201  01190320
         MVC   D12(B4,CCWIND),SFLAG     CMND CHAIN AND BYTE      20201  01191220
*                                       CNT=1                    20201  01192120
         B     FEATA                    GO AROUND NOP            20201  01193020
NOTRRA   EQU   *                                                 20201  01193920
         MVC   D8(D8,CCWIND),NOP        INSERT NOP CMND          20201  01194820
FEATA    EQU   *                                                 20201  01195720
         LA    CCWIND,D8(CCWIND)        INCR CCW PTR             20201  01196620
NOP2     EQU   *                                                 20201  01197520
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  01198420
         BNE   NOTRRD                   BRANCH IF NO             20201  01199320
         L     VWKREG,IOBDCPND          GET SECTOR ADDR          20201  01200220
         LA    VWKREG,B1(VWKREG)        INCR BY ONE              20201  01201120
         ST    VWKREG,D8(CCWIND)        PUT IN CHP               20201  01202020
         MVI   D8(CCWIND),SETSC         PUT IN CHP CMND          20201  01202920
         MVC   D12(B4,CCWIND),SFLAG     CMND CHAIN AND BYTE      20201  01203820
*                                       CNT=1                    20201  01204720
         B     FEATD                    BRANCH AROUND NOP        20201  01205620
NOTRRD   EQU   *                                                 20201  01206520
         MVC   D8(D8,CCWIND),NOP        INSERT NOP CMND          20201  01207420
FEATD    EQU   *                                                 20201  01208320
         LA    CCWIND,D8(CCWIND)        INCR CCW PTR             20201  01209220
NOTVS    EQU   *                                                 S19015 01211019
         OI    FOUR(CCWIND),CCHN        TURN ON COMMAND CHAINING S19015 01214019
DKNOES   EQU   *                                                 S19015 01217019
         LA    CCWIND,8(CCWIND)        INCREMENT TO NEXT CCW            01220000
         TM    IOBDTYPE,OFLOW          TEST FOR TRACK OVERFLOW OPTION   01240000
         BC    8,OMITSEEK               IF NO, OMIT SEEK HH CCW         01260000
         LA    VWKREG,IOBDNRCF          DEVELOP SEEK ADDRESS            01280000
         ST    VWKREG,0(CCWIND)         AND STORE IN CCW                01300000
         MVI   0(CCWIND),SEEKOP        MOVE SEEK HH OP-CODE             01320000
         MVI   4(CCWIND),CCHN          SET COMMAND CHAIN FLAG           01340000
         MVI   7(CCWIND),SIX           SET COUNT TO SIX                 01360000
         LA    CCWIND,8(CCWIND)        INCREMENT INDEX BY ONE CCW       01380000
OMITSEEK EQU   *                                                 20201  01382020
         TM    IOBDCPND,YESCARN         IS RPS FEATURED WITHOUT  20201  01384020
*                                            VRE                        01386020
         BNO   SCHKEYEQ                 NO, THEN GO SEARCH FOR   20201  01388020
*                                       KEY EQ.                  20201  01390020
         L     SECTOR,IOBDCPND          GET SECTOR ADDR IF RPS   20201  01392020
         LA    SECTOR,ONEBYTE(0,SECTOR) POINT TO SECTOR1         20201  01394020
         ST    SECTOR,ZERO(0,CCWIND)    FILL IN ADDR FIELD       20201  01396020
         MVI   ZERO(CCWIND),SETSECT      FILL IN SET SECTOR      20201  01398020
*                                          COMMAND CODE                 01400020
         MVI   HALFCCW(CCWIND),CARNCHAN COMMAND CHAIN TO NEXT    20201  01402020
*                                       CCW                      20201  01404020
         MVI   CARN7(CCWIND),CARNCNT    PUT IN RPS COUNT OF ONE  20201  01406020
         LA    CCWIND,FULLCCW(0,CCWIND) UPDAT PT TO NEXT CCW     20201  01408020
SCHKEYEQ EQU   *                                                 20201  01410020
         ST    CCWIND,FULLCCW(0,CCWIND)  STORE AS TIC ADDRESS    20201  01412020
         MVC   ZERO(K8,CCWIND),ZERO(SCHREG)  MOVE SEARCH CCW IN  S19015 01420019
         MVI   K8(CCWIND),TICOP         INSERT TIC OP CODE       S19015 01440019
         MVI   16(CCWIND),RDKDOP       SET OP-CODE TO READ KEY-DATA     01460000
         TM    DCBBFTEK,RBFTKMSK        BUFFER TECHNIQUE EQUAL R S19015 01465019
         BO    SETCNT                   YES,GO LEAVE READ KEY    S19015 01470019
*                                       DATA                     S19015 01475019
         TM    IOBDTYPE+1,KEY          TEST FOR WRITE BY KEY            01480000
         BC    8,SETCNT                 BRANCH ON NO                    01500000
         MVI   16(CCWIND),RDDOP        CHANGE OP-CODE TO READ DATA      01520000
*                                                                       01540000
SETCNT   MVI   22(CCWIND),1            SET LENGTH TO 256 BYTES          01560000
         MVI   20(CCWIND),SKIPSILI     SET FLAGS IN THE READ CCW        01580000
         LA    CCWIND,16(CCWIND)       INCREMENT TO LAST CCW            01600000
         TM    IOBDTYPE+1,ADD          TEST FOR WRITE ADD               01620000
EXIT1    BCR   8,VRETREG                IF NO, EXIT                     01640000
         TM    DCBRECFM,FIXED          IS RECORD FORMAT 'F'             01660000
EXIT2    BCR   8,VRETREG                YES, CCWS ARE COMPLETE          01680000
         OI    4(CCWIND),CCHN          SET COMMAND CHAIN FLAG           01700000
*                                                                       01701020
         TM    IOBDCPND,YESCARN         RECORD READY I PRESUME   20201  01702020
         BNO   NOTCARN                  NO, THEN SEE ABOUT READ  20201  01703020
*                                       R0                       20201  01704020
         L     SECTOR,IOBDCPND          GET POINTER TO SECTORS   20201  01705020
         LA    SECTOR,TWOBYTE(0,SECTOR)  POINT TO SECTOR=0 AND   20201  01706020
*                                       POINT                    20201  01707020
         LA    CCWIND,FULLCCW(0,CCWIND)    TO NEXT CCW AND       20201  01708020
*                                       CREATE                   20201  01709020
         ST    SECTOR,ZERO(0,CCWIND)         THE SET SECT CCW    20201  01710020
         MVI   ZERO(CCWIND),SETSECT          WITH COMMAND        20201  01711020
*                                            CHAINING AND A             01712020
         MVI   HALFCCW(CCWIND),CARNCHAN    COUNT OF ONE.         20201  01713020
         MVI   CARN7(CCWIND),CARNCNT                             20201  01714020
NOTCARN  EQU   *                                                 20201  01715020
         MVC   8(8,CCWIND),RDR0CCW     MOVE CONSTANT CCW TO VERIFY      01720000
*                                       NEW CAPACITY RECORD             01740000
         LA    CCWIND,8(CCWIND)        INCREMENT TO LAST CCW            01760000
EXIT3    BR    VRETREG                 RETURN TO FOUNDATION MODULE      01780000
*                                                                       01800000
ESTST    EQU   *                                                 S19015 01802019
         TM    DECTYPE+ONE,KEY          IS THIS TYPE DK          S19015 01804019
         BZ    NOPS                     NO,GO INSERT TWO NOPS    S19015 01806019
         TM    DECTYPE,EXTSCH           IS THIS EXTENDED SEARCH  S19015 01808019
         BO    NOP2                     YES,GO INSERT ONE NOP    S19015 01810019
         NI    FOUR(CCWIND),NOCCHN      TURN OFF CMD CHAINING    S19015 01812019
         B     DKNOES                   GO CONTINUE CP BUILD     S19015 01814019
*                                                                       01820000
B1       EQU   1                        BYTE CNT OF ONE          20201  01823020
B4       EQU   4                        BYTE CNT OF FOUR         20201  01826020
D8       EQU   8                        DISPLACEMENT OF EIGHT    20201  01829020
D12      EQU   12                       DISPLACEMENT OF TWELVE   20201  01832020
*                                                                       01835020
SECTOR   EQU   2                        ALSO PTR TO SECTOR AREA  20201  01838020
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      20201  01841020
RDSC     EQU   X'22'                    READ SECTOR  CW CMND     20201  01844020
*                                                                       01847020
SFLAG    DC    X'40000001'              SECTOR CMND FLAGS AND    20201  01850020
*                                       BYTE                     20201  01853020
*                                       COUNTS                          01856020
RDR0CCW  DC    X'16'                    READ R0 CCW TO VERIFY THE       01860000
         DC    X'000001'                 CAPACITY RECORD                01880000
         DC    X'10'                     JUST                           01900000
         DC    X'0000'                                                  01920000
         DC    X'10'                     WRITTEN                        01940000
CCHN     EQU   X'40'                   COMMAND CHAIN FLAG               01960000
SEEKOP   EQU   X'0B'                   SEEK CCHH OP-CODE                01980000
SIX      EQU   X'06'                   COUNT OF SIX                     02000000
RDKDOP   EQU   X'0E'                   READ KEY-DATA OP-CODE            02020000
SKIPSILI EQU   X'30'                   SKIP, SUPPRESS INCORRECT LENGTH  02040000
FIXED    EQU   X'40'                   RECORD FORMAT FIXED              02060000
RDDOP    EQU   X'06'                   READ DATA OP-CODE                02080000
*              OPTIONS AND TYPE                                         02100000
OFLOW    EQU   X'40'                                                    02120000
KEY      EQU   X'04'                                                    02140000
ADD      EQU   X'02'                                                    02160000
RBFTKMSK EQU   X'20'                    DCBBFTEK=R TEST BYTE     S19015 02161019
TICOP    EQU   X'08'                    TIC OP CODE              S19015 02162019
EXTSCH   EQU   X'20'                    EXTERNAL SEARCH CODE     S19015 02163019
NOCCHN   EQU   X'BF'                    MASK TO TURN OFF CMD     S19015 02164019
*                                       CHAIN                    S19015 02165019
ZERO     EQU   0                        DISPLACEMENT VALUE       S19015 02166019
ONE      EQU   1                        DISPLACEMENT VALUE       S19015 02167019
FOUR     EQU   4                        DISPLACEMENT VALUE       S19015 02168019
K8       EQU   8                        DISPLACEMENT VALUE       S19015 02169019
NOP      DC    X'0300000060000001'      NOP FOR CARNIVAL SUPPORT S19015 02170019
*                                                                       02170520
*        RPS VALUES AND MASKS                                           02171020
*                                                                       02171520
ONEBYTE  EQU   1                        ONE BYTE DISPLACEMENT    20201  02172020
TWOBYTE  EQU   2                        TWO BYTE DISPLACEMENT    20201  02172520
HALFCCW  EQU   4                        INCREMENT FOR 4 BYTES    20201  02173020
CARN7    EQU   7                        SEVEN BYTE DISPLACEMENT  20201  02173520
FULLCCW  EQU   8                        INCREMENT FOR 8 BYTES    20201  02174020
*                                                                       02174520
CARNCNT  EQU   X'01'                    RPS INSTR - COUNT        20201  02175020
SETSECT  EQU   X'23'                    SET SECTOR COMMAND CODE  20201  02175520
CARNCHAN EQU   X'40'                    COMMAND CHAINING BYTE    20201  02176020
YESCARN  EQU   X'FF'                   BYTE TO TEST FOR REC      20201  02176520
*                                       READY                    20201  02177020
         DC    C'IGGR'                  ROTATIONAL POSITION      20201  02177520
*                                       SENS-                    20201  02178020
*                                         ING MODULE                    02178520
*              THE FOLLOWING CNOP MUST REMAIN ON A HALF-WORD BOUNDARY   02180000
         CNOP  0,8                 PAD MODULE TO DOUBLE WORD MULTIPLE   02200000
         EJECT                                                          02220000
*      DATA CONTROL BLOCK (DCB) DEFINITION                              02240000
*                                                                       02260000
         DCBD  DSORG=DA                                                 02280000
*                                                                       02300000
*                                                                       02320000
*      DATA EVENT CONTROL BLOCK (DECB) DEFINITION                       02340000
         DS    0F                                                       02360000
DECBDEF  DSECT                                                          02380000
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK (ECB)        02400000
DECTYPE  DS    CL2            TYPE FIELD                                02420000
DECLNGTH DS    CL2            DATA LENGTH                               02440000
DECDCBAD DS    CL4            ADDRESS OF DCB                            02460000
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      02480000
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        02500000
DECKYADR DS    CL4            ADDRESS OF KEY                            02520000
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               02540000
         EJECT                                                          02560000
*                                                                       02580000
*      I/O BLOCK (IOB) DEFINITION                                       02600000
*                                                                       02620000
*              STANDARD IOB                                             02640000
         DS    0F                                                       02660000
IOBDEF   DSECT                                                          02680000
IOBFLAG1 DS    CL1            STATUS FLAG                               02700000
IOBFLAG2 DS    CL1            ERROR FLAG                                02720000
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       02740000
IOBECBPT DS    CL4            ECB POINTER                               02760000
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       02780000
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           02800000
         DS    CL1                                                      02820000
         DS    CL3                                                      02840000
IOBCSWST DS    CL2            STATUS BYTES                              02860000
IOBCSWCT DS    CL2            REMAINING COUNT                           02880000
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   02900000
IOBSIOCC DS    CL1            SIO CONDITION CODE                        02920000
         DS    CL3                                                      02940000
IOBDCBPT DS    0CL4           DCB POINTER                               02960000
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            02980000
         DS    CL3                                                      03000000
IOBRESTR DS    0CL4           RESTART POINTER                           03020000
         DS    CL1                                                      03040000
         DS    CL3                                                      03060000
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              03080000
IOBERRCT DS    CL2            ERROR COUNTER                             03100000
IOBSEEK  DS    CL8            SEEK ADDRESS                              03120000
*        BDAM EXTENDED IOB                                              03140000
*                                                                       03160000
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  03180000
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          03200000
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     03220000
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                03240000
         DS    CL3                                                      03260000
IOBDTYPE DS    CL2            TYPE FIELD                                03280000
IOBDSTAT DS    CL2            IOB STATUS                                03300000
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        03320000
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                03340000
         DS    CL2                                                      03360000
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               03380000
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        03400000
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                03420000
IOBCP    DS    CL8            FIRST CCW IN CHANNEL PROGRAM              03440000
         END                                                            03460000
./  ADD  SSI=31840110,NAME=IGG019KR
  TITLE  'IGG019KR-VRE READ/WRITE CHANNEL PROGRAM GENERATOR'            00200019
         COPY  LCGASMSW                                                 00250001
*                                                                       00300020
*                                                                       00400020
*        RELEASE 21 DELETIONS/CHANGES                                   00700020
*                                                               SA53251 00900021
*          RELEASE 20 DELETIONS                                         01200019
*D374200                                                         XM6363 01250001
*3574004000-006000,014000-025200,268000-270000                   20201  01300020
*                                                                       02600019
*STATUS CHANGE LEVEL 003                                                02800021
*                                                                       03000019
*FUNCTION/OPERATION- THIS MODULE CONSTRUCTS A CHANNEL PROGRAM TO PER-   03200019
*   FORM A READ OR WRITE BY BLOCK ID OR BY BLOCK KEY FOR VRE.           03400019
*   THE CCW'S CONSTRUCTED OF CONSTANTS DEFINED IN THIS MODULE AND       03600019
*   ADDRESSES RESOLVED AT THE TIME THIS CODE IS EXECUTED.               03800019
*                                                                       04000019
*ENTRY POINT- ENTRY IS TO IGG019KR (BEGIN) FROM FOUNDATION MODULE       04200019
*   IGG019KJ BY THE CALLING SEQUENCE           L     EPREG,KEYMODAD     04300019
*                                              BR    EPREG              04400019
*                                 OR           L     EPREG,IDMODAD      04500019
*                                              BR    EPREG              04600019
*                                                                       04800019
*INPUT- THE REGISTERS ARE INPUT AS FOLLOWS,                             05000019
*   4- DCB ADDRESS                                                      05200019
*   5- DECB ADDRESS                                                     05400019
*   6- THE ADDRESS OF CCW 1 (CHANNEL PROGRAM START)                     05600019
*   7- IOB ADDRESS                                                      05800019
*  11- BASE ADDRESS OF MODULE IGG019KJ (FOUNDATION MODULE)              06000019
*                                                                       06200019
*OUTPUT- THE REQUIRED CCW'S WILL BE CONSTRUCTED FOLLOWING THE IOB.      06400019
*   REGISTER 6 WILL CONTAIN THE ADDRESS OF THE LAST CCW.                06600019
*                                                                       06800019
*EXTERNAL ROUTINE- CONTROL IS PASSED TO 'IGG019KW' IF EXTENDED SEARCH   07000019
*   IS SPECIFIED. IF THE REQUEST IS A WRITE AND THE WRITE VALIDITY      07200019
*   CHECK OPTION HAS BEEN SPECIFIED, 'IGG019KQ' IS ENTERED TO CONSTRUCT 07400019
*   THE VERIFY CCW'S.                                                   07600019
*                                                                       07800019
*EXITS- TO IGG019KJ BY       BR   RETREG  OR BY   BCR   8,RETREG        08000019
*       TO IGG019KQ BY       L    VERBASE,VERMODOF(NULL,FDNREG)         08200019
*                            BR   VERBASE                               08400019
*       TO IGG019KW BY       L    EPREG,DKEXSRAD                        08600019
*                            BR   EPREG                                 08800019
*                                                                       09000019
*TABLES/WORK AREAS- REFER TO THE DSECTS, BDAM OPTIONS AND TYPES AND     09200019
*   CONSTANTS AREA AT THE END OF THIS MODULE.                           09400019
*                                                                       09600019
*ATTRIBUTES- THIS MODULE IS REENTERANT AND EXECUTED ENABLED.            09800019
*                                                                       10000019
*NOTE- REGISTER USAGE IN THIS MODULE MUST REMAIN CONSISTENT WITH THE    10200019
*   MODULES IGG019KJ, IGG019KQ AND IGG019KW.                            10400019
*                                                                       10600019
*                                                                       10800019
IGG019KR CSECT                                                          11200019
*                                                                       11400019
*                                                                       11600019
*   REGISTER USAGE                                                      11800019
*                                                                       12000019
*                                                                       12200019
SCHREG   EQU   1                        REG FOR PARAMETER               12300019
SWAREG   EQU   2                        SEGMENT WORK AREA POINTER       12400019
DCBREG   EQU   4                        DCB ADDRESS                     12800019
DECBREG  EQU   5                        DECB ADDRESS                    13000019
CCWIND   EQU   6                        ADDRESS OF FIRST CCW            13200019
IOBREG   EQU   7                        IOB ADDRESS                     13400019
WKREG1   EQU   8                        GENERAL PURPOSE WORK REGISTER   13600019
WKREG2   EQU   9                        GENERAL PURPOSE WORK REGISTER   13800019
VERBASE  EQU   10                       BASE REG FOR IGG019KQ           14000019
LINKREG  EQU   10                 INTERNAL SUBROUTINE LINKAGE           14100001
FDNREG   EQU   11                       BASE FOR THE FOUNDATION MODULE  14200019
CCWPTR   EQU   12                       POINTER TO NEXT CCW INSTRUCTION 14400019
RETREG   EQU   14                       RETURN TO FOUNDATION MODULE     14600019
EPREG    EQU   15                       BASE REGISTER FOR THIS MODULE   14800019
*                                                                       15000019
*                                                                       15200019
         USING IHADCB,DCBREG            REG 4 IS THE BASE FOR THE DCB   15400019
         USING DECBDEF,DECBREG          REG 5 IS THE BASE FOR THE DECB  15600019
         USING IOBDEF,IOBREG            REG 7 IS THE BASE FOR THE IOB   15800019
         USING IGG019KR,EPREG           REG 15 IS THE BASE FOR THIS MOD 16000019
*                                                                       16200019
*                                                                       16400019
BEGIN    EQU   *                                                        16600019
         B     ENTRY                    BRANCH TO BEGINNING OF CODE     16800019
DKEXSRAD DC    V(IGG019KW)              ADDRESS OF KEY-EXTENDED-SEARCH  17000002
*                                       MODULE--IGG019KW         Y02072 17200002
*                                                                       17400019
ENTRY    EQU   *                                                        17600019
*                                                                       17800019
*                                                                       18000019
         LR    SWAREG,IOBREG            FETCH IOB ADDRESS               18200019
         SH    SWAREG,FOUR              PREPARE TO GO TO IOB-4          18400019
         L     SWAREG,NULL(SWAREG)      FETCH SWA ADDRESS               18600019
         LA    SWAREG,SEGAREOF(SWAREG)  ADDRESS OF SEGMENT AREA         18800019
         LR    CCWPTR,CCWIND            POINTER TO CCW1                 19000019
*                                                                       19200019
*                                                                       19400019
*                                                                       19600019
         MVC   IOBDNRCF+BYTE2(BYTE5),IOBSEEK+BYTE3    SAVE FEEDBACK ADR 19700019
         MVC   IOBDNRCF+BYTE7(BYTE1),IOBSEEK  SAVE EXTENT NUMBER        19710019
         TM    DECTYPE+BYTE1,NEXADIND   CHECK IF NEXT ADDRESS HAS BEEN  19800019
*                                       REQUESTED                       20000019
         BNO   CHEKTYPE                 BRANCH IF NO NEXT ADDR          20200019
         TM    DECTYPE+BYTE1,DITYPE     OTHERWISE CHECK IF TYPE=DI      20400019
         BO    CHEXSRCH                 BRANCH IF TYPE=DK               20600019
         LA    WKREG2,IOBUPLIM+BYTE3    FETCH SEARCH ADDRESS POINTER    20800019
         MVC   IOBUPLIM,IOBSEEK         INSERT TRK ADDR OF 1ST SEGMENT  20810019
         MVI   IOBUPLIM+BYTE7,NULL      POINT TO CAPACITY RECORD        20820019
         ST    WKREG2,ONECCW(CCWIND)    PUT IT IN CCW 2                 21000019
         LA    WKREG2,IOBDNRCF+BYTE2    OTHERWISE FETCH CAPACITY RCD AD 21200019
         LA    CCWIND,FORTHCCW(CCWIND)  GO TO CCW 4                     21400019
         ST    WKREG2,NULL(CCWIND)      PUT CAPACITY RECORD ADDR THERE  21600019
         LA    CCWIND,ONECCW(CCWIND)    SET CHANNEL COMMAND INDEX TO    21800019
*                                       CCW 5                           22000019
         B     CNSTRUCT                 BRANCH TO BUILD CCW 1 TO CCW 4  22200019
*                                                                       22400019
*                                                                       22600019
CHEXSRCH EQU   *                                                        22800019
*                                                                       23000019
*                                                                       23200019
         TM    IOBDTYPE,EXSRCH          CHECK IF EXTENDED SEARCH OPTION 23400019
*                                       HAS BEEN REQUESTED              23600019
         BO    CHEKTYPE                 BRANCH IF YES                   23800019
         LA    CCWPTR,NINTHCCW(CCWPTR)  OTHERWISE POINT TO CCW 9        24000019
         MVI   NULL(CCWPTR),NOP         MOVE IN NOP OP CODE             24200019
         MVC   BYTE4(BYTE4,CCWPTR),FCNT1     MOVE IN FLAGS AND COUNT    24400019
         LA    WKREG1,ONECCW            ONE CCW INSTRUCTION             24600019
         SR    CCWPTR,WKREG1            GO TO CCW 8                     24800019
         ST    SWAREG,NULL(CCWPTR)      MOVE IN SEGMENT ADDRESS         25000019
         LA    WKREG1,TWOCCW            LENGTH OF TWO CCW'S             25200019
         SR    CCWPTR,WKREG1            GO TO CCW 6                     25400019
         LA    WKREG1,IOBSEEK+BYTE3     FETCH SEARCH ADDRESS POINTER    25600019
         ST    WKREG1,NULL(CCWPTR)      PUT IT IN CCW 6                 25800019
         LA    CCWPTR,FIFTHCCW(CCWIND)  GO TO CCW 5                     26000019
*                                                                       26200019
*                                                                       26400019
CNSTRUCT EQU   *                                                        26600019
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  26700020
         BNE   NOTRRA                   BRANCH IF NO             20201  26800020
         L     WKREG1,IOBDCPND          GET SECTOR ADDR          20201  26900020
         ST    WKREG1,NULL(CCWPTR)      PUT IN CCW               20201  27000020
         MVI   NULL(CCWPTR),SETSC       PUT IN SET SECTOR CMND   20201  27100020
         MVI   BYTE4(CCWPTR),CC         CMND CHAIN CCW           20201  27200020
         MVI   BYTE7(CCWPTR),BYTE1      SET BYTE COUNT TO ONE    20201  27300020
         B     FEATA                    GO AROUND NEXT           20201  27400020
NOTRRA   EQU   *                                                 20201  27500020
*                                                                       28500019
*                                                                       28600019
         MVI   NULL(CCWPTR),NOP         BUILD NO OP CCW                 28800019
         MVC   BYTE4(BYTE4,CCWPTR),NOPFCNT1   MOVE IN FLAGS AND COUNT   29000019
*                                             FOR NOP CCW               29200019
FEATA    EQU   *                                                 20201  29300020
         LA    CCWPTR,ONECCW(CCWPTR)    GO TO NEXT CCW                  29400019
         MVI   NULL(CCWPTR),SRCHIDEQ    MOVE IN SEARCH ID EQ OP-CODE    29600019
         MVI   BYTE4(CCWPTR),COMCHAIN   SET COMMAND CHAIN FLAG          29800019
         LA    WKREG1,NULL(CCWPTR)      FETCH SEARCH ID EQ CCW ADDRESS  30000019
         ST    WKREG1,ONECCW(CCWPTR)    STORE IT IN TIC CCW             30200019
         MVC   BYTE6(BYTE3,CCWPTR),COUNTTIC  MOVE IN COUNT=5 AND TIC    30400019
*                                            OP CODE FOR NEXT CCW       30600019
         LA    CCWPTR,TWOCCW(CCWPTR)    GO TO THE NEXT CCW              30800019
         MVI   NULL(CCWPTR),READDATA    MOVE IN READ-DATA OP-CODE       31000019
         MVC   BYTE4(BYTE4,CCWPTR),FCNT5   MOVE IN FLAGS AND COUNT=5    31200019
*                                                                       31400019
*                                                                       31600019
CHEKTYPE EQU   *                                                        31800019
*                                                                       32000019
*                                                                       32200019
         TM    DECTYPE+BYTE1,DITYPE     CHECK IF TYPE=DI                32400019
         BO    TYPEDK                   BRANCH IF TYPE=DK               32600019
         TM    DECTYPE+BYTE1,READ       CHECK IF READ HAS BEEN REQUEST- 32800019
*                                       ED                              33000019
         BO    READDI                   BRANCH IF YES                   33200019
         MVI   NULL(CCWIND),NOP         OTHERWISE BUILD NO OP CCW FOR   33400019
*                                       WRITE TYPE D1                   33600019
         MVC   BYTE4(BYTE4,CCWIND),NOPFCNT1   MOVE IN FLAGS AND COUNT   33800019
*                                             FOR NOP CCW               34000019
         LA    CCWIND,ONECCW(CCWIND)    INCREMENT TO NEXT CCW           34200019
         LR    SCHREG,CCWIND            SAVE SEARCH ID EQ CCW POINTER   34300019
*                                                                       34400019
*                                                                       34600019
READDI   EQU   *                                                        34800019
*                                                                       35000019
*                                                                       35200019
         LA    WKREG1,IOBSEEK+BYTE3     FETCH CCHHR ADDRESS             35400019
         ST    WKREG1,NULL(CCWIND)      PUT IT IN SEARCH ID EQ CCW      35600019
         MVI   NULL(CCWIND),SRCHIDEQ    MOVE IN SEARCH ID EQ OP-CODE    35800019
         LA    WKREG1,NULL(CCWIND)      FETCH SEARCH ID EQ CCW ADDRESS  36000019
         ST    WKREG1,ONECCW(CCWIND)    PUT SEARCH ID EQ CCW ADR IN TIC 36200019
         MVC   BYTE4(BYTE5,CCWIND),FLCNTIC  MOVE FLAGS,COUNT,TIC OPCODE 36400019
         LA    CCWIND,TWOCCW(CCWIND)    INCREMENT TO NEXT CCW           36600019
         TM    DECTYPE+BYTE1,READ       CHECK IF IT IS READ TYPE DI     36800019
         BNO   BUIWRDI                  BRANCH IF IT IS WRITE TYPE DI   37000019
         TM    DECTYPE,FEEDB            CHECK IF FEEDBACK IS REQUESTED  37003019
         BZ    AFTFEEDB                 BRANCH IF NOT REQUESTED         37006019
         TM    DCBOPTCD,FEEDB           CHECK IF RELATIVE FEEDBACK IS   37010019
*                                       REQUESTED                       37020019
         BO    AFTFEEDB                 BRANCH IF YES                   37030019
         L     WKREG1,DECRECPT          ELSE GET FEEDBACK ADDRESS       37040019
         MVC   NULL(BYTE8,WKREG1),IOBSEEK   SUPPLY ABSOLUTE FEEDBACK    37050019
*                                                                       37060019
*                                                                       37070019
AFTFEEDB EQU   *                                                        37080019
*                                                                       37090019
*                                                                       37100019
         CLI   DCBKEYLE,NULL            OTHERWISE CHECK FOR KEYED RCD   37200019
         BE    BUIRDATA                 BRANCH IF NOT KEYED RECORD      37400019
         TM    DECTYPE+BYTE1,SKEY      IS KEY TO BE READ INTO    XM6363 37420001
*                                      DYNAMIC BUFFER?                  37440021
         BNO   CHKEYAD                 NO, CHK IF ADDR IN DECB  SA53251 37460021
         B     READKEY                 YES, BUILD CHAN PGM FOR  SA53251 37480021
*                                      READING KEY AND DATA             37500021
CHKEYAD  EQU   *                                                SA53251 37520021
         L     WKREG1,DECKYADR          ELSE FETCH KEY ADDRESS          37600019
         LTR   WKREG1,WKREG1            CHECK IF DECKYADR=0             37800019
         BE    BUIRDATA                 BRANCH IF NO KEY ADDRESS        38000019
READKEY  EQU   *                                                SA53251 38100021
         MVI   NULL(CCWIND),READKYDA    MOVE IN READ KEY DATA OP-CODE   38200019
         MVC   BYTE1(BYTE3,CCWIND),DECKYADR+BYTE1  MOVE IN KEY ADDRESS  38400019
         MVI   BYTE4(CCWIND),DACHGAP    MOVE IN FLAGS FOR COMMAND CHAIN 38600019
*                                       BETWEEN GAPS OF A RECORD        38800019
         MVC   BYTE7(BYTE1,CCWIND),DCBKEYLE  MOVE KEY LENGTH AS COUNT   39000019
         LA    CCWIND,ONECCW(CCWIND)    INCREMENT TO NEXT CCW           39200019
*                                                                       39400019
*                                                                       39600019
BUIRDATA EQU   *                                                        39800019
*                                                                       40000019
*                                                                       40200019
         ST    SWAREG,NULL(CCWIND)      MOVE IN SEGMENT ADDRESS         40400019
         MVI   NULL(CCWIND),READDATA    MOVE IN READ-DATA OP CODE       40600019
         XC    BYTE4(BYTE2,CCWIND),BYTE4(CCWIND)      ZERO FLAG BYTES   40700019
         CLI   IOBSEEK+BYTE7,NULL       IS THIS A READ OF R0            40710019
         BNE   SETRDILN                 BR IF NO                        40720019
         TM    DECTYPE+BYTE1,NAS        IS IT NEXT ADDR AND 'S' FOR     40730019
*                                       BLOCK LENGTH                    40740019
         BNO   SETRDILN                 BR IF NO                        40750019
         MVC   DECLNGTH,CSCNT8+BYTE2    SET LENGTH TO 8                 40760019
SETRDILN EQU   *                                                        40770019
         AIF   ('&LIB' EQ 'LIB1').LIB1AA                                40773001
         BAL   LINKREG,CALCLNTH   DETERMINE WHETHER CCW COUNT IS        40776001
*                                 DECLNGTH OR SWA LENGTH.               40779001
         USING CCW,CCWIND                                               40782001
         STH   WKREG2,CCWCOUNT    SET LENGTH IN CCW                     40785001
         DROP  CCWIND                                                   40788001
         AGO   .LIB1AB                                                  40791001
.LIB1AA  ANOP                                                           40794001
         MVC   BYTE6(BYTE2,CCWIND),DECLNGTH  MOVE DATA LENGTH AS COUNT  40800019
.LIB1AB  ANOP                                                           40900001
         BR    RETREG                   RETURN CONTROL TO IGG019KJ      41000019
*                                                                       41200019
*                                                                       41400019
BUIWRDI  EQU   *                                                        41600019
*                                                                       41800019
*                                                                       42000019
         ST    SWAREG,NULL(CCWIND)      MOVE IN SEGMENT ADDRESS         42200019
         MVI   NULL(CCWIND),READDATA    MOVE IN READ-DATA OP CODE       42400019
         MVC   BYTE4(BYTE4,CCWIND),FCNT8     MOVE IN FLAGS AND COUNT    42600019
         CLI   DCBKEYLE,NULL            CHECK IF DCBKEYLE=0             42800019
         BE    VERIWRI                  BRANCH IF YES                   43000019
         L     WKREG1,DECKYADR          FETCH KEY ADDRESS               43200019
         LTR   WKREG1,WKREG1            CHECK IF DECKYADR=0             43400019
         BE    VERIWRI                  BRANCH IF YES                   43600019
         LA    CCWIND,ONECCW(CCWIND)    INCREMENT TO NEXT CCW           43800019
         ST    SWAREG,NULL(CCWIND)      MOVE IN SEGMENT ADDRESS         44000019
         MVI   NULL(CCWIND),WRITDATA    MOVE IN WRITE-DATA OP CODE      44200019
         MVC   BYTE6(BYTE2,CCWIND),DECLNGTH  MOVE DATA LENGTH AS COUNT  44400019
         B     VERIWRI                  GO TO CHECK WRITE-VALIDITY-     44600019
*                                       CHECK OPTION                    44800019
*                                                                       45000019
*                                                                       45200019
TYPEDK   EQU   *                                                        45400019
*                                                                       45600019
*                                                                       45800019
         ST    CCWIND,TWOCCW(CCWIND)    PUT CCW 1 ADDRESS IN TIC CCW    46000019
         LA    WKREG2,IOBDNRCF+BYTE2    ADDRESS OF CCHHR FOR FEEDBACK   46200019
         ST    WKREG2,NULL(CCWIND)      PUT IT IN READ-COUNT CCW        46400019
         MVI   NULL(CCWIND),READCNT     MOVE IN READ-COUNT OP CODE      46600019
         MVC   BYTE4(BYTE4,CCWIND),FCNT5     MOVE IN FLAGS AND COUNT    46800019
         MVC   ONECCW(BYTE4,CCWIND),DECKYADR PUT KEY ADDR IN NEXT CCW   47000019
         MVI   ONECCW(CCWIND),SRCHKYEQ  MOVE IN SEARCH KEY EQ OP CODE   47200019
         MVI   BYTE12(CCWIND),COMSUPLN  MOVE IN FLAGS                   47400019
         MVC   BYTE15(BYTE1,CCWIND),DCBKEYLE MOVE IN KEY LENGTH         47600019
         MVI   TWOCCW(CCWIND),TIC       MOVE IN TIC OP CODE             47800019
         ST    SWAREG,FORTHCCW(CCWIND)  MOVE IN SEGMENT ADDRESS         48000019
         MVI   FORTHCCW(CCWIND),READDATA    MOVE IN READ-DATA OP CODE   48200019
         TM    DECTYPE+BYTE1,READ       CHECK IF READ HAS BEEN REQUEST- 48400019
*                                       ED                              48600019
         BO    READDK                   BRANCH IF YES                   48800019
         MVC   BYTE28(BYTE4,CCWIND),CSCNT8  ELSE MOVE IN FLAGS, COUNT   49000019
*                                                                       49100020
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  49200020
         BNE   NOTRRC                   BRANCH IF NO             20201  49300020
         L     WKREG1,IOBDCPND          GET BASIC SECTOR ADDR    20201  49400020
         LA    WKREG1,BYTE1(WKREG1)     INCR BY ONE              20201  49500020
         ST    WKREG1,BYTE32(CCWIND)    PUT IN CCW               20201  49600020
         MVI   BYTE32(CCWIND),RDSC      RD SECTOR CCW CMND       20201  49700020
         MVI   BYTE39(CCWIND),BYTE1     SET BYTE CNT TO ONE      20201  49800020
         B     FEATC                    GO AROUND NEXT           20201  49900020
NOTRRC   EQU   *                                                 20201  50000020
*                                                                       50100020
         MVI   BYTE32(CCWIND),NOP       CONSTRUCT NOP CCW               51200019
         MVC   BYTE36(BYTE4,CCWIND),FCNT1         MOVE IN FLAGS AND     51400019
*                                                 COUNT FOR NOP CCW     51600019
FEATC    EQU   *                                                 20201  51700020
         TM    IOBDTYPE,EXSRCH          CHECK IF EXTENDED SEARCH OPTION 51800019
*                                       HAS BEEN REQUESTED              52000019
         BO    DKEXSRCH                 BRANCH IF YES                   52200019
         LA    CCWIND,FIFTHCCW(CCWIND)  UPDATE CHANNEL COMMAND INDEX    52400019
*                                       TO THE LAST CCW                 52600019
*                                                                       52800019
*                                                                       53000019
VERIWRI  EQU   *                                                        53200019
*                                                                       53400019
*                                                                       53600019
         TM    IOBDTYPE,VERIFY          CHECK IF WRITE-VALIDITY-        53800019
*                                       CHECK HAS BEEN REQUESTED        54000019
         BCR   EIGHT,RETREG             IF NOT, CHANNEL PROGRAM ENDS    54200019
*                                       AND RETURN CONTROL TO IGG019KJ  54400019
         TM    DECTYPE+BYTE1,DITYPE     CHECK IF TYPE=DI                54406019
         BNO   TOVERMOD                 BRANCH IF TYPE=DI               54412019
         LA    WKREG1,IOBSEEK+BYTE3     FETCH SEARCH ADDRESS POINTER    54420019
         ST    WKREG1,ONECCW(CCWIND)    PUT IT IN NEXT CCW              54440019
         MVI   ONECCW(CCWIND),SRCHIDEQ  MOVE IN SEARCH ID EQ OP CODE    54460019
         MVC   BYTE12(BYTE4,CCWIND),CCCNT5  MOVE IN COMMAND CHAIN FLAGS 54480019
*                                           AND COUNT OF 5              54500019
         LA    SCHREG,ONECCW(CCWIND)    SAVE POINTER TO THIS CCW        54520019
*                                                                       54540019
TOVERMOD EQU   *                                                        54560019
*                                                                       54580019
*                                                                       54600019
         L     VERBASE,VERMODOF(NULL,FDNREG)  GET ADDRESS OF IGG019KQ   56600019
         BR    VERBASE                  GO TO IGG019KQ                  56800019
*                                                                       57000019
*                                                                       57200019
DKEXSRCH EQU   *                                                        57400019
*                                                                       57600019
*                                                                       57800019
         L     EPREG,DKEXSRAD           LOAD ADDRESS OF IGG019KW        58000019
         BR    EPREG                    GO TO KEY-EXTENDED-SEARCH MOD   58200019
*                                                                       58400019
*                                                                       58600019
READDK   EQU   *                                                        58800019
*                                                                       59000019
*                                                                       59200019
         AIF   ('&LIB' EQ 'LIB1').LIB1BA                                59220001
         BAL   LINKREG,CALCLNTH   DETERMINE WHETHER CCW COUNT IS        59240001
*                                 DECLNGTH OR SWA LENGTH.               59260001
         USING CCW,CCWIND                                               59280001
         STH   WKREG2,CCWCOUNT+FORTHCCW     SET LENGTH IN CCW.          59300001
         DROP  CCWIND                                                   59320001
         AGO   .LIB1BB                                                  59340001
.LIB1BA  ANOP                                                           59360001
         MVC   BYTE30(BYTE2,CCWIND),DECLNGTH MOVE DATA LENGTH AS COUNT  59400019
*                                            IN CCW4                    59600019
.LIB1BB  ANOP                                                           59700001
         TM    IOBDTYPE,EXSRCH          CHECK IF EXTENDED SEARCH HAS    59800019
*                                       BEEN REQUESTED                  60000019
         BO    DKEXSRCH                 BRANCH IF YES                   60200019
         TM    DECTYPE+BYTE1,NEXADIND   ELSE CHECK IF NEXT ADDRESS HAS  60400019
*                                       BEEN REQUESTED                  60600019
         BNO   UPDACCW                  BRANCH IF NO NEXT ADDRESS       60800019
         LA    CCWIND,NINTHCCW(CCWIND)  ELSE SET CHANNEL COMMAND INDEX  61000019
*                                       TO THE LAST CCW                 61200019
*                                                                       61400019
*                                                                       61600019
FINIS    EQU   *                                                        61800019
*                                                                       62000019
*                                                                       62200019
         BR    RETREG                   RETURN TO IGG019KJ              62400019
*                                                                       62600019
*                                                                       62800019
UPDACCW  EQU   *                                                        63000019
*                                                                       63200019
*                                                                       63400019
         LA    CCWIND,FORTHCCW(CCWIND)  SET CHANNEL COMMAND INDEX       63600019
*                                       TO THE LAST CCW                 63800019
         B     FINIS                    GO TO IGG019KJ                  64000019
*                                                                       64200019
         AIF   ('&LIB' EQ 'LIB1').LIB1CA                                64205001
*                                                                       64210001
*                  SUBROUTINE CALCLNTH DETERMINES THE COUNT-FIELD       64215001
*                  OF A READ-DATA CCW.  THIS IS THE SMALLER OF          64220001
*                  DECLNGTH AND TRACK LENGTH.                           64225001
*                                                                       64230001
*                  INPUT REG:  LINKREG -- RETURN ADDRESS                64235001
*                  OUTPUT REG:  WKREG2 -- COUNT                         64240001
*                               WKREG1 -- USED AS WORK REGISTER         64245001
*                                                                       64250001
CALCLNTH L     WKREG2,DCBDEBAD    GET DEB ADDR FROM DCB                 64255001
         USING DEBBASIC,WKREG2                                          64260001
         LA    WKREG2,DEBBASND    BUMP TO DIRECT ACCESS SECTION         64265001
         USING DEBDASD,WKREG2     DASD SECTION LOACTED HERE             64270001
         L     WKREG2,DEBUCBAD    GET UCB ADDRESS FROM DEB              64275001
         USING UCB,WKREG2                                               64280001
*                                                                       64285001
         LA    WKREG1,X'0F'       4 LOW-ORDER BITS OF WORD              64290001
         N     WKREG1,UCBTYP      PUT DEVICE CODE IN REG                64295001
*                                                                       64300001
         L     WKREG2,CVTPTR      GET CVT ADDRESS                       64305001
         USING CVT,WKREG2                                               64310001
         L     WKREG2,CVTZDTAB    GET DEVICE CHAR TABLE ADDR            64315001
         DROP  WKREG2                                                   64320001
         IC    WKREG1,0(WKREG1,WKREG2) DEVICE CODE SERVES AS            64325001
*                                 INDEX TO TABLE ENTRY DISP             64330001
         LH    WKREG2,TRKLNGTH(WKREG1,WKREG2)    TRACK LENGTH           64335001
*                                                                       64340001
         CH    WKREG2,DECLNGTH    IS TRACK SIZE GT RECORD LENGTH?       64345001
         BCR   12,LINKREG         RETURN IF NO; COUNT IS TRK SIZE       64350001
         LH    WKREG2,DECLNGTH    ELSE COUNT IS RECORD LENGTH           64355001
         BR    LINKREG            RETURN TO CALLER                      64360001
*                                                                       64365001
.LIB1CA  ANOP                                                           64370001
*                                                                       64400019
**********                                                   ********** 64600019
*                                                                       64800019
*              BDAM OPTIONS AND TYPES                                   65000019
*                                                                       65200019
**********                                                   ********** 65400019
*                                                                       65600019
*                                                                       65800019
VERIFY   EQU   X'80'                    MASK FOR WRITE-VALIDITY-CHECK   66000019
*                                       OPTION                          66200019
EXSRCH   EQU   X'20'                    MASK FOR EXTENDED SEARCH OPTION 66400019
DITYPE   EQU   X'04'                    MASK FOR BLOCK ID TYPE          66600019
READ     EQU   X'08'                    MASK FOR READ REQUEST           66800019
NEXADIND EQU   X'10'                    MASK FOR NEXT ADDRESS OPTION    67000019
NAS      EQU   X'50'                    MASK FOR NEXT ADDR AND          67010019
*                                       'S' CODED FOR BLOCK LENGTH      67020019
COMSUPLN EQU   X'60'                    COMMAND CHAIN AND SUPPRESS IN-  67200019
*                                       CORRECT LENGTH                  67400019
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      20201  67460020
RDSC     EQU   X'22'                    RD SECTOR CCW CMND       20201  67520020
DACHGAP  EQU   X'C0'                    DATA CHAIN BETWEEN GAPS OF RCD  67600019
SRCHKYEQ EQU   X'29'                    SEARCH KEY EQ OP CODE           67800019
COMCHAIN EQU   X'40'                    DATA AND COMMAND CHAIN FLAGS    68000019
SRCHIDEQ EQU   X'31'                    SEARCH ID EQ OP CODE            68200019
READKYDA EQU   X'0E'                    READ KEY DATA OP CODE           68400019
READDATA EQU   X'06'                    READ DATA OP CODE               68600019
READCNT  EQU   X'12'                    READ COUNT OP CODE              68800019
WRITDATA EQU   X'05'                    WRITE DATA OP CODE              69000019
NOP      EQU   X'03'                    NOP OP CODE                     69200019
TIC      EQU   X'08'                    TRANSFER IN CHANNEL OP CODE     69400019
FEEDB    EQU   X'10'                    MASK FOR RELATIVE FEEDBACK      69500019
LO4BITS  EQU   X'0F'              USED TO LOAD REG WITH LO 4 BITS ON    69510001
TRKLNGTH EQU   4             DISP OF TRACK LENGTH FIELD IN DEVICE       69530001
*                            CHARACTERISTICS TABLE ENTRY                69560001
FLCNTIC  DC    X'4000000508'            COMMAND CHAIN FLAG, COUNT AND   69600019
*                                       OP CODE                         69800019
COUNTTIC DC    X'000508'                COUNT AND TIC OP CODE           70000019
FCNT5    DC    X'60000005'              COMMAND CHAIN AND SUPPRESS IN-  70200019
*                                       CORRECT LENGTH FLAGS AND COUNT  70400019
FCNT1    DC    X'20000001'              SUPPRESS INCORRECT LENGTH FLAGS 70600019
*                                       AND COUNT                       70800019
FCNT8    DC    X'20000008'              SUPPRESS INCORRECT LENGTH FLAGS 71000019
*                                       AND COUNT                       71200019
NOPFCNT1 DC    X'60000001'              COMMAND CHAIN AND SUPPRESS      71400019
*                                       INCORRECT LENGTH FLAGS AND      71600019
*                                       COUNT                           71800019
CSCNT8   DC    X'60000008'              COMMAND CHAIN AND SUPPRESS IN-  72000019
*                                       CORRECT LENGTH FLAGS AND        72200019
*                                       COUNT=8                         72400019
CCCNT5   DC    X'40000005'              COMMAND CHAIN FLAGS AND COUNT=5 72500019
*                                                                       72600019
*                                                                       72800019
*                                                                       73000019
**********                                                   ********** 73200019
*                                                                       73400019
*              CONSTANTS USED FOR DISPLACEMENT                          73600019
*                                                                       73800019
**********                                                   ********** 74000019
*                                                                       74200019
FOUR     DC    H'4'                     CONSTANT USED TO GO TO IOB-4    74400019
NULL     EQU   0                        NO DISPLACEMENT                 74600019
BYTE1    EQU   1                        ONE BYTE                        74800019
BYTE2    EQU   2                        TWO BYTES                       75000019
BYTE3    EQU   3                        THREE BYTES                     75200019
BYTE4    EQU   4                        FOUR BYTES                      75400019
BYTE5    EQU   5                        FIVE BYTES                      75600019
BYTE6    EQU   6                        SIX BYTES                       75800019
BYTE7    EQU   7                        SEVEN BYTES                     76000019
BYTE8    EQU   8                        EIGHT BYTES                     76100019
EIGHT    EQU   8                        ZERO CONDITION FOR TM           76130019
BYTE12   EQU   12                       TWELVE BYTES                    76200019
BYTE15   EQU   15                       FIFTEEN BYTES                   76600019
BYTE28   EQU   28                       TWENTY-EIGHT BYTES              76800019
BYTE30   EQU   30                       THIRTY BYTES                    77000019
BYTE32   EQU   32                       THIRTY-TWO BYTES                77200019
BYTE36   EQU   36                       THIRTY-SIX BYTES                77400019
BYTE39   EQU   39                       THIRTY-NINE BYTES        20201  77500020
ONECCW   EQU   8                        8 BYTES FOR LENGTH OF ONE CCW   77600019
TWOCCW   EQU   16                       LENGTH OF TWO CCW'S             77800019
FORTHCCW EQU   24                       LENGTH OF THREE CCW'S           78000019
FIFTHCCW EQU   32                       LENGTH OF FOUR CCW'S            78200019
NINTHCCW EQU   64                       LENGTH OF EIGHT CCW'S           78400019
CHPOFF   EQU   80                       OFFSET IN IOB TO CHP     20201  78450020
CC       EQU   X'40'                    CMND CHAIN FLAG          20201  78500020
SKEY     EQU   X'80'                   'S' CODED FOR KEY LENGTH SA53251 78550021
SEGAREOF EQU   10                       OFFSET TO ADDRESS OF SEGMENT    78600019
*                                       AREA IN SWA                     78800019
VERMODOF EQU   12                       OFFSET TO ADDRESS OF IGG019KQ   79000019
*                                       IN IGG019KJ                     79200019
         CNOP  0,8                      PAD MODULE TO DOUBLE WORD       79210019
*                                                                       79400019
*                                                                       79600019
*                                                                       79800019
*                                                                       80000019
*                                                                       80200019
*                                                                       80400019
*                                                                       80600019
*              DATA CONTROL BLOCK (DCB) DEFINITION                      80800019
*                                                                       81000019
*                                                                       81200019
*                                                                       81400019
         DCBD  DSORG=DA                                                 81600019
*                                                                       81800019
*                                                                       82000019
*                                                                       82200019
*                                                                       82400019
*                                                                       82600019
*                                                                       82800019
*              DATA EVENT CONTROL BLOCK (DECB) DEFINITION               83000019
*                                                                       83200019
*                                                                       83400019
*                                                                       83600019
         DS    0F                                                       83800019
DECBDEF  DSECT                                                          84000019
DECSDECB DS    CL4                      STANDARD ECB                    84200019
DECTYPE  DS    CL2                      TYPE OF I/O REQUEST AND OPTIONS 84400019
DECLNGTH DS    CL2                      DATA LENGTH                     84600019
DECDCBAD DS    CL4                      ADDRESS OF DCB                  84800019
DECAREA  DS    CL4                      ADDRESS OF DATA AREA            85000019
DECIOPT  DS    CL4                      ADDRESS OF THE IOB              85200019
DECKYADR DS    CL4                      ADDRESS OF KEY                  85400019
DECRECPT DS    CL4                      ADDRESS OF RECORD REFERENCE     85600019
*                                                                       85800019
*                                                                       86000019
*                                                                       86200019
*        I/O BLOCK (IOB) DEFINITION                                     86400019
*                                                                       86600019
*                                                                       86800019
*                                                                       87000019
*              STANDARD IOB                                             87200019
*                                                                       87400019
*                                                                       87600019
*                                                                       87800019
         DS    0F                                                       88000019
IOBDEF   DSECT                                                          88200019
IOBFLAG1 DS    CL1                      STATUS FLAG                     88400019
IOBFLAG2 DS    CL1                      ERROR FLAG                      88600019
IOBSENSE DS    CL2                      SENSE BYTES 0 AND 1             88800019
IOBECBPT DS    CL4                      ECB POINTER                     89000019
IOBCSW   DS    0CL8                     CHANNEL STATUS WORD             89200019
IOBCSWCA DS    0CL4                     COMMAND ADDRESS                 89400019
         DS    CL1                      IOS ERROR ROUTINE FLAG BYTE     89600019
         DS    CL3                      COMMAND ADDRESS                 89800019
IOBCSWST DS    CL2                      STATUS BYTES                    90000019
IOBCSWCT DS    CL2                      REMAINING COUNT                 90200019
IOBSTART DS    0CL4                     CHANNEL PROGRAM POINTER         90400019
IOBSIOCC DS    CL1                      SIO CONDITION CODE              90600019
         DS    CL3                      ADDRESS OF CHANNEL PROGRAM      90800019
IOBDCBPT DS    0CL4                     DCB POINTER                     91000019
IOBWGHT  DS    CL1                      CHANNEL WEIGHT                  91200019
         DS    CL3                      ADDRESS OF DCB                  91400019
IOBRESTR DS    0CL4                     RESTART POINTER                 91600019
         DS    CL1                      BYTE FOR I/O ERROR CORRECTION   91800019
         DS    CL3                      RESTART POINTER                 92000019
IOBINCAM DS    CL2                      BLOCK COUNT INCREMENT AMOUNT    92200019
IOBERRCT DS    CL2                      ERROR COUNTER                   92400019
IOBSEEK  DS    CL8                      SEEK ADDRESS                    92600019
*                                                                       92800019
*              BDAM EXTENDED IOB                                        93000019
*                                                                       93200019
IOBDBYTR DS    CL2                      BYTES REMAINING ON TRACK        93400019
IOBDIOBS DS    CL2                      SIZE OF THIS IOB                93600019
IOBDPLAD DS    0CL4                     IOB POOL LINK ADDRESS           93800019
IOBDAVLI DS    CL1                      IOB AVAILABILITY INDICATOR      94000019
         DS    CL3                      VARIOUS INDICATORS              94200019
IOBDTYPE DS    CL2                      TYPE FIELD                      94400019
IOBDSTAT DS    CL2                      IOB STATUS                      94600019
IOBDCPND DS    CL4                      CHANNEL PROGRAM NORMAL END ADDR 94800019
IOBDBYTN DS    CL2                      BYTES NEEDED BY NEW RECORD      95000019
         DS    CL2                      RESERVED                        95200019
IOBDQPTR DS    CL4                      LINK FIELD FOR QUEUED IOB'S     95400019
IOBUPLIM DS    CL8                      LIMIT MBBCCHHR FOR EXT SEARCH   95600019
IOBDNRCF DS    CL8                      COUNT FIELD FOR NEW RECORD      95800019
IOBCP    DS    CL200                    CHANNEL PROGRAM AREA            96000019
*                                                                       96200019
         SPACE 3                                                        96210001
CCW      DSECT               CHANNEL COMMAND WORD FORMAT                96220001
CCWOPCOD DS    C             OP-CODE                                    96230001
CCWADDR  DS    AL3           ADDRESS FOR DATA TRANSFER                  96240001
CCWFLAGS DS    BL1           FLAGS                                      96250001
         DS    X             UNUSED                                     96260001
CCWCOUNT DS    H             BYTES TO BE TRANSFERRED                    96270001
CVT      DSECT                                                          96280021
         CVT                                                            96285021
UCB      DSECT                                                          96290001
         IEFUCBOB                                                       96300001
         IEZDEB                                                         96310001
         END                                                            96400019
./  ADD  SSI=53230076,NAME=IGG019KU
   TITLE 'IGG019KU - BDAM CHANNEL END/ABNORMAL END APPENDAGES'          00022002
IGG019KU CSECT                                                          00024002
*MODULE NAME = IGG019KU                                               * 00030002
*                                                                     * 00032002
*DESCRIPTIVE NAME = BDAM CHANNEL END/ABNORMAL END APPENDAGES          * 00034002
*                                                                     * 00036002
*COPYRIGHT = NONE                                                     * 00036402
*                                                                     * 00036802
*CHANGE ACTIVITY                                                      * 00037202
*                                                                     * 00037602
*          RELEASE 20 CHANGES/DELETIONS                                 00044002
*1775024020,024080-024120                                        A33185 00047020
*          RELEASE 21 CHANGES/DELETIONS                                 00050002
*2683020450-020500                                              SA53130 00050200
*2683020500                                                      M0133  00050521
*2683029000,029800                                               M0055  00051021
*2683024118                                                      A40946 00053021
*                                                               SA53271 00053521
*2683020000                                                      21905  00054021
*                                                               SA53862 00064000
*                                                               SA62422 00066002
*        VS1-1 CHANGES/DELETIONS                                        00074002
*        VS2-1 CHANGES/DELETIONS                                        00084002
*        VS1-2 CHANGES/DELETIONS                                        00086002
*        VS2-2 CHANGES/DELETIONS                                        00088002
*012600,013800,014120,019800,029000-039800                       Y02072 00090002
*                                                                YM3857 00090402
*                                                                YM4606 00090802
*                                                                YM2862 00091202
*                                                                YM5762 00094002
*                                                                YM5947 00094402
*        VS2-3 CHANGES/DELETIONS                                        00094803
*020040-020060,021664-021666,021669,021672,021675,021681,      @OZ04942 00094903
*022383,022419,023075,024683,024690,026412,026930-027784,      @OZ04942 00095003
*027796-027804,027810,027831-027851,028000-028046,             @OZ04942 00095103
*040420-040520                                                 @OZ04942 00095203
*020024,022378,022413,023068,023076-023129,024682,024700        OZ04733 00096003
*023130-023132,026890-026898                                    OZ02226 00097003
*STATUS CHANGE LEVEL 6/12/75                                            00098003
*                                                                       00104018
*FUNCTION/OPERATION- THIS MODULE CONTAINS THE BDAM CHANNEL END AND    * 00120000
*   ABNORMAL (EXCEPTIONAL) END IOS APPENDAGES. THE MODULE IS ALWAYS   * 00140000
*   LOADED WHEN BDAM IS USED AND ALLOWS BDAM TO DETERMINE THE ACTION  * 00160000
*   TO BE TAKEN ON UNIT EXCEPTION, INCORRECT LENGTH, FIRST OCCURRENCE * 00180000
*   OF AN ERROR, PERMANENT ERROR, OR NORMAL CHANNEL END.              * 00200000
*                                                                     * 00220000
*ENTRY POINTS- 'IGG019KU' (BEGIN) IS ENTERED BY IOS WITH A CALLING    * 00240000
*   SEQUENCE,  L    15,12(APPENDAGE LIST)                             * 00260000
*              BALR 14,15                                             * 00280000
*   THE CAUSE OF ENTRY AND ACTION TAKEN IS AS FOLLOWS,                * 00300000
*   1.NORMAL CHANNEL END- SCHEDULE ASYNCHRONOUS INTERRUPT (ASI)       * 00320000
*            IF ADDITIONAL PROCESSING IS REQUIRED                     * 00321003
*            OR POST USERS DECB COMPLETE                              * 00322003
*            OR IN CERTAIN CASES, CHANGE IOBSTART AND RESTART         * 00330002
*   2.UNIT EXCEPTION- SET END-OF-DATA-SET EXCEPTION CODE, SCHEDULE ASI* 00340000
*   3.INCORRECT LENGTH- IF READING FORMAT V, RESET THE ERROR FLAGS IF * 00360000
*     LENGTH IS CORRECT, SCHEDULE ASI. IF LENGTH IS INCORRECT, RETURN * 00380000
*     TO IOS. IF READING FORMAT U, RESET THE ERROR FLAGS, SCHEDULE ASI* 00400000
*     IF READING FORMAT F OR WRITING ANY FORMAT, RETURN TO IOS.       * 00420000
*                                                                     * 00440000
*   'IECDCEB' IS ENTERED BY IOS WITH A CALLING SEQUENCE,              * 00460000
*   L    15,16(APPENDAGE LIST)                                        * 00480000
*   BALR 14,15                                                        * 00500000
*   THE CAUSE OF ENTRY AND ACTION TAKEN IS AS FOLLOWS,                * 00520000
*   1.FIRST OCCURRENCE OF AN ERROR- RETURN TO IOS (ERROR RETRY)       * 00540000
*        UNLESS FIXED WRITE ADD. IN THIS CASE TURN OFF ERROR            00550002
*        FLAGS AND RESTART, ENSURING ENTRY AGAIN IF NEW ERROR           00552002
*        OCCURS OR SAME ERROR REOCCURS. IF SAME ERROR REOCCURS          00554002
*        8 TIMES, SET PERMANENT ERROR FLAGS AND SCHEDULE ASI.           00556002
*   2.PERMANENT ERROR- SET ABNORMAL COMPLETION CODE, SCHEDULE ASI     * 00560000
*                                                                     * 00580000
*INPUT- THE FOLLOWING REGISTERS ARE USED AS POSITIONED BY IOS,        * 00600000
*   1- ADDRESS OF THE RQE                                             * 00610002
*   2- ADDRESS OF THE IOB ASSOCIATED WITH THIS I/O REQUEST            * 00620000
*   4- DCB ADDRESS                                                    * 00640000
*  13- IOS SAVEAREA ADDRESS                                           * 00650002
*  14- RETURN (NORMAL) TO IOS                                         * 00660002
*  15- ENTRY POINT IN THIS MODULE                                     * 00680002
*                                                                     * 00700000
*OUTPUT- THIS ROUTINE MAY SET EXCEPTION CODES IN THE IOB FOR THE      * 00720000
*   ASYNCHRONOUS INTERRUPT ROUTINE.                                   * 00740000
*                                                                     * 00760000
*EXTERNAL ROUTINES- 'IEA0EF00' IS ENTERED TO SCHEDULE ASI.            * 00780000
*                                                                     * 00800000
*EXITS- 'CEEXIT1','CEEXIT2', 'CEEXIT3' ARE ALL NORMAL RETURNS TO IOS  * 00820000
*   FROM THE CHANNEL END APPENDAGE. THE INCORRECT LENGTH INDICATION   * 00840000
*   REMAINS ON.                                                       * 00860000
*        'XCEEXIT1' IS A RETURN TO IOS FROM ABNORMAL END APPENDAGE.   * 00880000
*   AN ERROR HAS OCCURRED BUT THE OPERATION WILL BE RETRIED.          * 00900000
*        'XCEEXIT2' IS THE EXIT TO IEA0EF00 TO SCHEDULE ASI.          * 00920000
*   IEA0EF00 WILL RETURN TO IOS WITH IGNORE OFFSET.                   * 00940000
*                                                                     * 00960000
*TABLES/WORK AREAS- THE COMMUNICATION VECTOR TABLE IS A RESIDENT      * 00980000
*   VECTOR LIST USED TO LOCATE THE ROUTINE, IEA0EF00.                 * 01000000
*                                                                     * 01020000
*ATTRIBUTES- THESE ROUTINES ARE EXECUTED ENABLED AND PRIVILEGED AND   * 01040002
*   ARE REENTRANT. THEY ARE ENTERED IN KEY 0 WITH THE LOCAL LOCK HELD.* 01060002
*   A MODESET WILL BE ISSUED TO DO ALL PROCESSING IN USER KEY.        * 01070002
*                                                                     * 01080000
*NOTE- THIS ROUTINE RELIES ON THE REGISTER USAGE OF IOS.              * 01100000
*      REGISTER 13, ON ENTRY, POINTS TO THE IOS SAVEAREA WHERE          01120002
*      ALL IOS REGISTERS WILL BE SAVED.                                 01140002
*                                                                       01160000
*                                                                       01180000
         USING IGG019KU,BASE                                            01200000
         USING IOBSTDRD,IOBREG                                   Y02072 01220002
         USING RQE,RQEREG                                        Y02072 01230002
         USING IHADCB,DCBREG                                            01240000
         USING UCB,UCBREG                                               01270021
*                                                                       01280000
*  REGISTER USAGE                                                       01300000
*                                                                       01320000
R0       EQU   0                        PARAMETER REGISTER       Y02072 01330002
RQEREG   EQU   1                        BASE REG FOR RQE         Y02072 01332002
IOBREG   EQU   2                        IOB ADDRESS (FROM IOS)          01340002
WORK5    EQU   2                        PASSES IOSKEY TO MODESET Y02072 01350002
DCBREG   EQU   4                        DCB ADDRESS (FROM IOS)          01360002
WORK2    EQU   5                        WORK REGISTER            Y02072 01362002
WRAPREG  EQU   6                        USED FOR DECREMENTING  @OZ04942 01367003
UCBREG   EQU   7                        PTR TO UCB FROM IOS     SA53271 01370002
LINKREG  EQU   9                        INTERNAL LINKAGE REG     Y02072 01372002
SWAREG   EQU   10                                                M0055  01390021
WORK4    EQU   10                       WORK REGISTER           SA53271 01395002
LNGREG   EQU   11                       WORK REGISTER                   01400002
WORK3    EQU   11                       WORK REGISTER           SA53271 01403002
WORK1    EQU   12                       WORK REGISTER             24512 01406018
SAVEREG  EQU   13                       IOS SAVEAREA REGISTER    Y02072 01414002
RETREG   EQU   14                       RETURN TO IOS                   01420002
BASE     EQU   15                       BASE - ENTRY POINT              01440002
R15      EQU   15                       SAVE/RESTORE REG         Y02072 01450002
*                                                                       01460000
*                                                                       01480000
*                                                                       01500000
*                                                                       01520000
BEGIN    B     IECDCEA                  BRANCH AROUND XCE ADCON         01540002
XCEAD    DC    A(IECDCEB-BEGIN)         ADDRESS OF XCE ROUTINE          01560000
*                                                                       01580000
IECDCEA  EQU   *                        CHK IF THIS NORMAL END   Y02072 01590002
         STM   R0,R15,0(SAVEREG)        SAVE REGISTERS FROM IOS  Y02072 01600002
         L     WRAPREG,WRAPBASE         SET UP FOR DECREMENTS  @OZ04942 01601003
         USING WRAPDECR,WRAPREG                                @OZ04942 01601203
         BZ    NORMEND                  BR IF THIS IS NORMAL END Y02072 01602002
         BAL   LINKREG,ECBCHK           BR TO CK FOR ECB PTR     Y02072 01610002
         TM    IOBSTBYT,CSWUNEXP        TEST FOR END OF DATA SET Y02072 01695003
         BO    SETEODS                  BR YES TO SET DECB CODE BIT     01700003
*                                                                       01705002
*    ANALYZE INCORRECT LENGTH ERROR                                     01710002
*                                                                       01715002
         TM    IOBDTYP2,IOBRQUST        WAS THIS A READ REQUEST  Y02072 01720002
CEEXIT1  BZ    CEEXIT3                  NO, LET ERROR CODE STAND Y02072 01740002
*                                                                       01760000
         TM    DCBRECFM,DCBRECL         IS RECORD FORMAT 'U'            01780003
         BM    TSTV                     NO, GO TEST FURTHER.            01800003
*                                                                       01820000
RESET    NI    IOBFLAG1,X'FF'-IOBIOERR  CLEAR ANY LENGTH ERROR FOR A    01840003
         NI    IOBSTBYT+1,X'FF'-CSWINCOR  READ TO FORMAT 'U' DATA SET.  01860003
         B     SCHASI                   SCHEDULE ASYNCHRONOUS INTERRUPT 01880002
*                                                                       01900000
TSTV     TM    DCBRECFM,DCBRECV         IF FORMAT IS 'F'                01920003
CEEXIT2  BZ    CEEXIT3                  LET THE ERROR CODE STAND        01940002
*                                                                       01960000
         L     WORK1,IOBCSW-1           GET ADDRESS OF READ DATA Y02072 02000002
*                                       CCW                      21905  02002021
         LA    WORK1,WRAP-CCWLEN(WORK1)  GET ADDR OF ERROR CCW @OZ04733 02002403
         USING CCW,WORK1                                         21905  02008021
         LH    LNGREG,CCWBYTE           GET LENGTH IN CCW        21905  02010003
         L     WORK1,CCWADDRA           LOAD BUFFER ADDR        SA53862 02011003
         DROP  WORK1                                             21905  02012021
         SH    LNGREG,IOBCSW+5          MINUS REMAINING BYTE CT  Y02072 02020002
         SR    WORK4,WORK4              CLEAR REGISTER          SA62422 02030002
         IC    WORK4,0(WORK1)           GET 1ST BYTE OF BDW     SA62422 02032002
         SLL   WORK4,8                  MOVE IT LEFT ONE BYTE   SA62422 02034002
         IC    WORK4,1(WORK1)           GET 2ND BYTE OF BDW     SA62422 02036002
         CR    LNGREG,WORK4             ARE BYTES READ SAME AS  SA62422 02038002
         BE    RESET                    LENGTH. IF EQUAL, NO ERROR.     02100002
         B     CEEXIT3                  BR TO LET ERROR STAND    Y02072 02110002
*********************************************************************** 02160021
*                  END OF DATA CONDITION                                02160321
**********************************************************************  02160621
SETEODS  EQU   *                                                        02160921
         TM    IOBDTYPE,IOBEXTSC       IS THIS EXTENDED SRCH     Y02072 02161202
         BNO   SETEODS1                NO, GO SET EOD EXCEPT    SA53271 02161521
         TM    IOBDTYP2,IOBADDTY       IS THIS WRITE ADD REQ    SA53271 02161802
         BNO   SETEODS1                NO, GO SET EOD EXCEPT    SA53271 02162121
         MVI   IOBR,X'00'              BEGIN WITH R0 NEXT TRK    Y02072 02163002
         SR    WORK1,WORK1             CLEAR REGISTER           SA53271 02163321
         IC    WORK1,IOBHH1            PICK UP 1ST BYTE OF HH    Y02072 02163602
         SLL   WORK1,8                 MV IT TO 2ND BYTE IN REG SA53271 02163921
         IC    WORK1,IOBHH2            PICK UP 2ND BYTE OF HH    Y02072 02164202
         LA    WORK1,1(0,WORK1)        BUMP TO NEXT TRACK       SA53271 02164521
*     *     *     *     *     *     *     *     *     *     *     *   * 02164821
*                    IS NEXT TRACK VALID ON THAT DEVICE                 02165121
*     *     *     *     *     *     *     *     *     *     *     *   * 02165421
         L     WORK2,CVTPTR(0,0)       PICK UP CVT PTR          SA53271 02165721
         USING CVT,WORK2                                        SA53271 02166021
         L     WORK2,CVTZDTAB          LOAD ADDR TO DEVICE TAB  SA53271 02166221
         USING DVCTI,WORK2                                     @OZ04942 02166403
         LA    WORK3,DVCTYPMK           SET UP TYPE MASK       @OZ04942 02166703
         N     WORK3,UCBTYP             GET UNIT TYPE          @OZ04942 02167003
         IC    WORK3,DVCTIOFF(WORK3)    GET OFFSET FROM INDEX  @OZ04942 02167303
         AR    WORK3,WORK2              POINT TO CORRECT ENTRY @OZ04942 02167603
         USING DVCT,WORK3                                      @OZ04942 02167903
         CH    WORK1,DVCTRK             ARE THERE THIS MANY    @OZ04942 02168203
*                                      TRACKS ON THE CYLINDER           02168721
         BNL   NEWCYL                  IF NOT, GO TO NEXT CYL   SA53271 02169021
         STC   WORK1,IOBHH2            ELSE STORE NEW TRK VALUE  Y02072 02169302
         SRL   WORK1,8                 IN SEARCH ADDR AND RET   SA53271 02169621
         STC   WORK1,IOBHH1            TO IOS TO RESTART THE     Y02072 02169902
         B     RESTARTA                CHANNEL PROGRAM           Y02072 02170202
         DROP  WORK2,WORK3                                     @OZ04942 02170303
*     *     *     *     *     *     *     *     *     *     *     *   * 02170521
*                    BUMP TO NEXT CYLINDER                              02170821
*     *     *     *     *     *     *     *     *     *     *     *   * 02171121
NEWCYL   SR    WORK1,WORK1             CLEAR REG                SA53271 02171402
         IC    WORK1,IOBCC1            PICK UP 1ST BYTE OF CC    Y02072 02171702
         SLL   WORK1,8                 MV IT TO 2ND BYTE OF REG SA53271 02172021
         IC    WORK1,IOBCC2            PICK UP 2ND BYTE OF CC    Y02072 02172302
         LA    WORK1,1(0,WORK1)        BUMP CYLINDER BY ONE     SA53271 02172621
         STC   WORK1,IOBCC2            RETURN CYLINDER VALUE     Y02072 02172902
         SRL   WORK1,8                 TO IOBSEEK BUMPED BY 1.  SA53271 02173221
         STC   WORK1,IOBCC2            IF CYL VALUE NOT VALID    Y02072 02173502
*                                      EOE CONDITION RESULTS, WHICH     02173821
*                                      IS NECESSARY TO WRAP AROUND DS   02174121
         XC    IOBHH1(L'IOBHH),IOBHH1  START WITH TRK0           Y02072 02174202
         B     RESTARTA                 BR TO RESTART CHAN PGM   YM3857 02176202
*********************************************************************** 02187202
SETEODS1 EQU   *                                                SA53271 02190402
         OI    IOBSTAT2,DECCCEOD        SET EOD EXCEPT CODE      Y02072 02193603
         B     SETABN                   MARK IOB AS ABNORMAL COMP.      02196802
*                                                                       02200000
*********************************************************************** 02210002
*                                                                       02210402
*                                                                       02210802
*                                                                       02211202
*  THE FOLLOWING LOGIC APPLIES TO FIXED FORMAT WRITE ADD REQUESTS       02211602
*  WHICH ENCOUNTERED AN ERROR DURING THE SEARCH FOR A DUMMY RECORD      02211702
*  BUT BEFORE THE DATA BYTE(RECORD NO.) FROM A DUMMY RECORD WAS         02211802
*  READ INTO CORE. AN ERROR IN THIS PART OF THE CHANNEL PROGRAM         02211902
*  CAUSED THE ABNORMAL END APPENDAGE TO BE ENTERED. BECAUSE THE         02216602
*  ERP-IN-CONTROL BIT IS THEN TURNED ON, PREVENTING SUBSEQUENT          02220402
*  ENTRY INTO THE ABNORMAL END APPENDAGE (AND HENCE ANY ADJUST-         02220802
*  MENT TO THE CH PGM OR IOBSTART BEFORE RESTART, SHOULD THE ERROR      02221202
*  FOLLOW THE WRT KEY/DATA), THE CHANNEL PGM IS BROKEN UP SO THAT       02221602
*  THE CHAN PGM ENDS ONCE THE DUMMY RECORD IS IDENTIFIED. AT CHAN       02221702
*  END TIME (I.E. AT THIS POINT), THE IOBSTART IS ALTERED TO POINT      02225902
*  TO A SECOND PORTION OF THE CHANNEL PROGRAM WHICH VERIFIES THAT       02227902
*  THE IDENTIFIED DUMMY RECORD IS STILL A DUMMY BEFORE EXECUTING        02229902
*  WRT KEY AND DATA. THIS CHANGE IS REQUIRED AS OF VS2-2 BECAUSE        02230302
*  OF A CHANGE IN IOS WHEREBY DEVICE LOCKOUT NO LONGER EXISTS           02230402
*  WHEN THE ERPS ARE IN CONTROL. AS A RESULT, IT IS POSSIBLE THAT       02230502
*  ANOTHER CHANNEL PROGRAM WAS STARTED, FINDING AND UPDATING            02230702
*  THE SAME DUMMY RECORD WHILE THIS CHANNEL PROGRAM WAS RECOVER-        02231102
*  ING FROM AN ERROR.                                                   02232302
*                                                                       02234302
*                                                                       02234402
NORMEND  EQU   *                        CHK IF WA FIXED- NORMAL  YM3857 02234602
         BAL   LINKREG,ECBCHK           BR TO CK FOR ECB PTR     Y02072 02235102
         TM    IOBDTYP2,IOBADDTY        IS REQ FOR WRITE ADD     YM3857 02235302
         BNO   CONTINUE                 NO, CONTINUE TESTS       YM3857 02235502
         TM    DCBRECFM,DCBRECV         IS RECFM FIXED           YM3857 02235702
         BO    SCHASI                   NO, SCHEDULE ASI       @OZ04942 02235903
         LA    WORK2,WRAP-WRKLEN(IOBREG) IOB - WORKLEN         @OZ04733 02237803
         AH    WORK2,IOBDIOBS           + IOBLENG -> WRKAREA   @OZ04942 02238203
         USING WRKIOB,WORK2             SET UP WORKAREA BASE     YM3857 02240103
         L     WORK1,IOBCSW-1           GET ADDR OF CP STOP      YM3857 02240703
         LA    WORK1,WRAP-CCWLEN(WORK1)  BACK UP TO LAST CCW   @OZ04733 02241303
         USING CCW,WORK1                                       @OZ04942 02242303
         C     WORK1,WRKCCAD            WAS THIS CHAN PGM        YM3857 02242602
*                                       BROKEN UP BY ABN END     YM3857 02242702
*                                       (DID IT STOP ON RD/RS?)  YM3857 02242802
         BNE   CHECKNOP                 NO, CONTINUE CHECKING    YM3857 02242902
         OI    CCWFLGS,CCWCC            RE-COMMAND CHAIN IN CASE YM2862 02243003
*                                       CP WAS DISCONNECTED      YM2862 02245502
         MVC   IOBSTART,WRKSTRT2        SET UP IOBSTART TO PART  YM3857 02250002
*                                       OF CH PGM THAT WILL      YM3857 02252502
*                                       REVERIFY THAT KEY =FF    YM3857 02255002
         MVC   IOBCCHHR,IOBDNCRF+2      UPDATE SEEK TO SRCH      YM4606 02257503
*                                       BEGINNING WITH DUMMY REC YM4606 02260002
         MVI   IOBR,0                   BEGIN WITH R0            YM2862 02262002
         TM    DCBOPTCD,DCBOPTTO        IS THIS TRK OVERFLO      YM5762 02262402
         BNO   RESTARTA                 NO, GO REEXCP            YM5762 02264902
         L     WORK1,IOBSTART           YES, GET 1ST CCW ADDR    YM5762 02266902
         CLI   CCWCOMCD,SETSECT         IS THIS RPS CP           YM5762 02267303
         BNE   RESTARTA                 NO, GO REEXCP            YM5762 02267402
         L     WORK1,CCWADDRA           YES, GET SECTOR ADDR     YM5762 02269303
         MVI   0(WORK1),RPSNOP          CHANGE SECTOR TO NOP,FF  YM5762 02271302
         B     RESTARTA                 BR TO RESTART CHAN PGM   YM3857 02273702
*                                                                       02275602
CHECKNOP EQU   *                        WAS DUMMY STILL THERE    YM3857 02277502
         CLI   CCWCOMCD,NOP             DID C.P. END ON NOP?     YM3857 02279403
         BNE   SCHASI                   NO, THIS IS NOT SPECIAL@OZ04942 02281303
         CLI   CCWCOMCD+L'CCW,RDHA      YES,WAS IT IN 2ND PART   YM5762 02283203
*                                       OF CP THAT VERIFYS KEY   YM3857 02285102
         BNE   SCHASI                   NO, CONTINUE PROCESSING@OZ04942 02287003
         MVC   IOBCCHHR,IOBDNCRF+2      UPDATE SEEK TO SRCH      YM4606 02287503
*                                       BEGINNING WITH DUMMY REC YM4606 02290002
         MVI   IOBR,0                   BEGIN WITH R0            YM2862 02292502
         LA    WORK1,IOBCHNPR           GET BEG OF CP ADDR       YM3857 02295002
         ST    WORK1,IOBSTART           SET UP IOBSTART TO BEG   YM3857 02297502
         B     RESTARTA                 BR TO RESTART CHAN PGM   YM3857 02300002
         DROP  WORK1                                           @OZ04942 02301003
*                                                                       02302502
CONTINUE EQU   *                        CONTINUE TESTING         YM3857 02305002
*********************************************************************** 02305203
*        DETERMINE WHETHER ASYNCHRONOUS ROUTINE IS NEEDED               02305403
*********************************************************************** 02305603
*        NOTE: THIS CODE IS NEVER ENTERED FOR WRITE ADD                 02305703
         TM    DCBRECFM,DCBRECV+DCBRECSB  IF RECFM=VS          @OZ04942 02305803
         BO    SCHASI                     THEN USE ASI         @OZ04942 02306203
         CLI   IOBDAYLI,0               IF IOB NOT YET IN POOL @OZ04942 02306403
         BE    SCHASI                   THEN USE ASI           @OZ04942 02306603
         TM    IOBDTYPE,IOBDYNBF                               @OZ04733 02306803
*                                       IF DYNAMIC BUFFERING OR         02306903
*                                       READ EXCLUSIVE OR FEEDBACK      02307003
         BNZ   SCHASI                   THEN USE ASI           @OZ04942 02307103
         TM    IOBDTYPE,IOBRDEXC        IF NO EXCL CONTROL     @OZ04733 02307603
         BZ    CONT2                    THEN SKIP NEXT TESTS   @OZ04733 02309603
         TM    IOBDTYP2,IOBRQUST        IF WRITE RELEASE       @OZ04733 02311603
         BZ    SCHASI                   THEN USE ASI           @OZ04733 02312003
         TM    IOBSTAT2,IOBENQUE        IF CONTROL NOT GOTTEN  @OZ04733 02312403
         BZ    SCHASI                   THEN USE ASI           @OZ04733 02312803
CONT2    EQU   *                        CONTINUE PROC          @OZ04733 02312903
         CLC   IOBDCPND+SKPHIBYT(CMP3BYTS),IOBCSW     WAS       OZ02226 02313003
*                                       CHAN PROGRAM FINISHED?  OZ02226 02313103
         BNE   SCHASI                   NO - USE ASI            OZ02226 02313203
         L     WORK3,IOBECBPT           GET DECB/ECB           @OZ04942 02313303
         USING DECB,WORK3               ADDRESSIBILITY         @OZ04942 02313503
*********************************************************************** 02314003
*        PROVIDE FEEDBACK AS REQUIRED                                   02314503
*********************************************************************** 02315003
         TM    IOBDTYPE,IOBFDBCK        IF NO FEEDBACK         @OZ04942 02315503
         BZ    POST1                    THEN BYPASS THIS PART  @OZ04942 02316003
         TM    DCBOPTCD,DCBOPTF         IF ACTUAL FEEDBACK     @OZ04942 02316503
         BZ    FDBK1                    THEN GO MOVE IT        @OZ04942 02317003
         TM    IOBDTYPE,IOBACTAD        IF NOT ACTUAL ADDRESS  @OZ04942 02317503
         BNO   SCHASI                   THEN USE ASI TO CONVERT@OZ04942 02318003
FDBK1    L     WORK1,DECRECPT           FIND FDBK AREA         @OZ04942 02318503
         USING FDBKAREA,WORK1                                  @OZ04942 02319003
         MVC   FDBKMBB,IOBSEEK          MOVE IN MBB            @OZ04942 02319503
         MVC   FDBKCHR,IOBDNCRF+2       MOVE IN CCHHR          @OZ04942 02320003
         DROP  WORK1                                           @OZ04942 02320503
         EJECT                                                          02321003
*********************************************************************** 02321503
*        RELEASE IOB AND POST ECB                                       02322003
*        FOLLOWING IS THE REGISTER USAGE ON POST BRANCH ENTRY:          02322503
*        R0-R9         SAVED                                            02323003
*        R10 (WORK4)   POST CODE                                        02323503
*        R11 (WORK3)   ECB POINTER                                      02324003
*        R12-R13       UNUSED                                           02324503
*        R14 (RETREG)  RETURN ADDRESS                                   02325003
*        R15 (BASE)    ENTRY POINT                                      02325503
*********************************************************************** 02326003
*        ECB POINTER IS ALREADY IN WORK3                                02326503
POST1    SR    WORK4,WORK4              SET UP COMPLETION      @OZ04942 02327003
         ICM   WORK4,B'0100',IOBSTAT2   CODE FOR POST          @OZ04942 02327503
         TM    DCBMACRF,DCBMRCK         IF USING CHECK         @OZ04942 02328003
         BO    POST2                    KEEP IOB TILL THEN     @OZ04942 02328503
         MVI   IOBDAYLI,0               ELSE MAKE AVAILABL NOW @OZ04942 02329003
         DROP  IOBREG                   CANNOT USE IOB         @OZ04942 02329503
*                                       ONCE IT IS MADE AVAILABLE       02330003
POST2    EQU   *                                               @OZ04942 02330503
         USING CVT,WORK2                                       @OZ04942 02331003
         L     WORK2,CVTPTR             GO THRU CVT TO         @OZ04942 02331503
         L     BASE,CVT0PT01            GET POST ROUTINE PTR   @OZ04942 02332003
         DROP  BASE                                            @OZ04942 02332503
         MODESET EXTKEY=SUPR            GO INTO SUPERVISOR KEY @OZ04942 02333003
         BALR  RETREG,BASE              POST THE ECB           @OZ04942 02333503
         LM    R0,R15,0(SAVEREG)        RESTORE EXCP REGS      @OZ04942 02334003
         B     NOPOST(RETREG)           RETURN,BYPASSING POST  @OZ04942 02334503
         DROP  WORK2,WORK3                                     @OZ04942 02335003
         EJECT                                                          02335503
         USING IGG019KU,BASE                                   @OZ04942 02336003
         USING IOBSTDRD,IOBREG                                 @OZ04942 02336503
*********************************************************************** 02337003
*                                                                       02337503
*  THE FOLLOWING ROUTINE IS THE ABNORMAL END APPENDAGE, ENTERED BY IOS  02338003
*   ON UNIT CHECK ERROR AND PERMANENT ERROR OF ANY TYPE.                02338503
*                                                                       02339003
*********************************************************************** 02339503
*                                                                       02340000
         USING IECDCEB,BASE                                             02360000
*                                                                       02380000
IECDCEB  STM   R0,R15,0(SAVEREG)        SAVE IOS REGISTERS       Y02072 02390002
         L     WRAPREG,WRAPBASE         SET UP FOR DECREMENTS  @OZ04942 02391003
         BAL   LINKREG,ECBCHK           BR TO CK FOR ECB PTR     Y02072 02392002
*                                                                       02394002
         CLI   IOBECBCC,ECBNORM         IS THERE A PERM ERROR  @OZ04942 02400003
         BNE   SETABN                   YES, GO TO ASYNCH RTN. @OZ04942 02401003
         TM    IOBDTYP2,IOBADDTY        WRITE ADD TYPE FIXED     Y02072 02404002
         BZ    CEEXIT3                  BRANCH IF NOT WRITE ADD  Y02072 02405002
         TM    DCBRECFM,DCBRECV         VARIABLE OR UNDEFINED     24512 02406003
         BO    CEEXIT3                  YES, BRANCH              Y02072 02407002
*                                                                       02417002
*                                                                       02427002
*  THE FOLLOWING LOGIC APPLIES TO FIXED FORMAT WRITE ADD REQUESTS.      02437002
*  BECAUSE THE ERP-IN-CONTROL BIT WOULD NORMALLY BE TURNED ON WHEN      02439002
*  CONTROL RETURNS TO EXCP/ERPS, THUS PREVENTING REENTRY INTO THIS      02441002
*  ABNORMAL END APPENDAGE SHOULD A SECOND ERROR (EG. FILE PROTECT,      02441402
*  ON A SEEK CYL WHICH IS NORMAL, OR DATA OVERRUN ON WRT KEY/DATA,      02441802
*  WHICH IS NOT) OCCUR BEFORE THE CHANNEL PROGRAM CONCLUDES SUC-        02441902
*  CESSFULLY. A PROBLEM EXISTS BECAUSE OF THE INABILITY TO REGAIN       02445202
*  CONTROL: IF THIS APPENDAGE IS ENTERED NORMALLY TO CROSS TRACKS       02447202
*  OR CYLINDERS DURING CHAN PGM EXECUTION AND ENCOUNTERS AN ERROR       02447602
*  LATER WHILE ATTEMPTING TO WRITE DATA, THE ERPS, WHICH WOULD          02448002
*  STILL BE IN CONTROL, WOULD AUTOMATICALLY RESTART THE CHANNEL         02448402
*  PROGRAM FROM THE BEGINNING. BECAUSE THE KEY WAS WRITTEN BEFORE       02448502
*  THE ERROR, THE SAME RECORD IS NO LONGER IDENTIFIED AS THE DUMMY.     02448602
*  A NEW DUMMY RECORD IS FOUND AND THE SAME KEY AND DATA ARE            02451102
*  WRITTEN, RESULTING IN DUPLICATE KEYS. THE SOLUTION TO THIS PROBLEM   02453102
*  IS TO ENSURE THAT THE ABNORMAL END APPENDAGE WILL CONTINUE TO GET    02453502
*  CONTROL ON THE OCCURRENCE OF EACH ERROR. THIS IS DONE AS FOLLOWS:    02453902
*                                                                       02454002
*  A) IF THE ERROR OCCURS BEFORE THE DUMMY RECORD IS IDENTIFIED (IE.    02454302
*  THE DATA BYTE RECORD NO. IS READ IN) TURN OFF THE COMMAND CHAIN      02454702
*  ON THE CCW THAT READS IN THE DATA BYTE (OR ON RD SECTOR FOR RPS),    02454802
*  STOPPING THE CHANNEL PROGRAM BEFORE ANYTHING IS WRITTEN. UPDATE      02454902
*  IOBSEEK FROM THE IOBDNCRF FIELD SO AS NOT TO REPEAT THE SEARCH       02455302
*  ON TRACKS ALREADY SEARCHED AT THIS POINT. AT CHANNEL END TIME        02455702
*  THE CHANNEL END APPENDAGE CAN THEN RESTART THE CHANNEL PGM AT A      02456302
*  POINT THAT VERIFIES THAT THE IDENTIFIED DUMMY RECORD IS STILL        02458302
*  A DUMMY BEFORE WRITING KEY AND DATA, (WHICH ALSO SOLVES AN           02458702
*  INTEGRITY PROBLEM EXISTING AS OF VS2-2 -SEE CEA FOR DETAILS).        02459102
*                                                                       02459402
*  B) IF THE ERROR OCCURS AFTER THE DUMMY RECORD HAS BEEN IDENTIFED     02459802
*  BUT BEFORE THE KEY OR DATA HAVE BEEN WRITTEN THE ERROR FLAGS ARE     02459902
*  TURNED OFF, THE IOBSTART IS CHANGED TO VERIFY THAT THE DUMMY         02460502
*  RECORD IS STILL A DUMMY BEFORE WRITING KEY AND DATA AND THE          02460902
*  CHANNEL PROGRAM IS RESTARTED. A COUNTER IS KEPT IN THE WORKAREA      02461302
*  TO PREVENT AN ENDLESS LOOP. IF THIS PART OF THE CHANNEL PROGRAM      02461702
*  EXPERIENCES GREATER THAN 10 ERRORS, PERMANENT ERROR FLAGS ARE        02462102
*  SET AND THE ASI IS SCHEDULED.                                        02462202
*                                                                       02462302
*  C) IF THE ERROR OCCURS AFTER OR DURING THE WRT KEY/DATA, THE         02462402
*  IOBSTART IS CHANGED TO EXECUTE ONLY THAT PORTION OF THE CHANNEL      02462902
*  PGM WHICH SEARCHES FOR THE RECORD BEING WRITTEN AND REEXECUTES       02463302
*  THE WRT KEY/DATA (AND THE WRITE VERIFY CCWS IF SPECIFIED). IN        02463702
*  THIS CASE THE ERROR FLAGS ARE NOT CHANGED AS IT IS NOT NECESSARY     02463802
*  THAT THE ABNORMAL END APPENDAGE GET CONTROL AGAIN.                   02463902
*                                                                       02464802
*  NOTE: THERE IS A WORKAREA FOLLOWING THE IOB WHICH HAS BEEN INIT-     02465202
*        IALIZED BY THE PRE-FORMAT MODULE, IGG019KO. IT CONTAINS        02465602
*        THE VIRTUAL CHANNEL PGM ADDRESSES OF THE READ DATA, WRT        02466002
*        KEY, VERIFY DUMMY CHAN PGM ENTRY, WRT KEY/DATA CHAN PGM        02466402
*        ENTRY, ETC.                                                    02466502
*                                                                       02467002
*                                                                       02467402
         L     WORK1,IOBCSW-1           GET CCW ADDR WHERE       YM3857 02467803
         LA    WORK1,WRAP-CCWLEN(WORK1)  INTERRUPT OCCURRED    @OZ04733 02468203
         USING CCW,WORK1                                       @OZ04942 02469903
         LA    WORK2,WRAP-WRKLEN(IOBREG)  IOB - WRKLEN         @OZ04733 02470003
         AH    WORK2,IOBDIOBS           + IOBLEN -> WRKAREA      YM3857 02470203
         USING WRKIOB,WORK2             SET UP WORKAREA BASE     YM3857 02470603
         SR    WORK4,WORK4              CLEAR WORK REG           YM3857 02470803
         LA    WORK3,ERPCOUNT           LOAD 10 AS RETRY MAX     YM3857 02471003
         C     WORK1,WRKRDAD            DID ERROR OCCUR ON OR    YM3857 02471203
*                                       BEFORE RD DATE OF DUMMY  YM3857 02471403
*                                       RECORD ID                YM3857 02471603
         BH    CHKMORE                  NO, KEEP LOOKING         YM3857 02471803
         TM    IOBSENS1,IOBS1B7         IS OVERFLO INCOMPLETE    YM5947 02472002
         BO    RETURN2                  YES, READ IN 1 BYTE FROM YM5947 02474002
*                                       OVERFLO REC-GO TO VERIFY YM5947 02476002
*                                                                       02478802
*    INTERRUPT WHILE LOOKING FOR DUMMY RECORD                           02480202
*                                                                       02481602
         L     WORK1,WRKCCAD            LOAD ADDR OF RD/RS       YM3857 02483002
         TM    CCWFLGS,CCWCC            WAS COM CHAIN TURNED OFF YM3857 02484403
         BNO   CEEXIT3                  YES,RETURN FOR ERP RETRY YM3857 02485802
         NI    CCWFLGS,X'FF'-CCWCC      TURN OFF CMD CHAIN       YM3857 02487203
         NI    IOBFLAG1,X'FF'-IOBIOERR  TURN OFF ERROR FLAG      YM3857 02488602
         MVC   IOBCCHHR,IOBDNCRF+2      UPDATE SEEK TO SRCH      YM4606 02490003
*                                       BEGINNING WITH DUMMY REC YM4606 02491402
         MVI   IOBR,0                   BEGIN WITH R0 FIRST      YM2862 02492802
         B     RESTARTA                 BR TO RESTART CH PGM AT  YM3857 02494202
*                                       TOP. ERPS WONT RETRY NOW YM3857 02495602
*                                       CEA WILL ADJUST IOBSTART YM3857 02497002
*                                       TO CONTINUE IF NO ERROR. YM3857 02498402
*                                                                       02499802
CHKMORE  EQU   *                        WHERE DID ERROR OCCUR    YM3857 02501202
         C     WORK1,WRKSTRT2           DID ERROR OCCUR IN PART  YM3857 02502602
*                                       OF CP THAT VERIFY KEY=FF YM3857 02504002
         BL    NOTNEW                   NO,DID NOT STOP IN VERFY YM3857 02505402
*                                                                       02506802
*    INTERRUPT WHILE VERIFYING DUMMY RECORD IS STILL DUMMY              02508202
*                                                                       02509602
         IC    WORK4,WRKCT1             GET ABNE ENTRIES HERE    YM3857 02511002
         LA    WORK4,1(WORK4)           ADD 1 TO COUNTER         YM3857 02512402
         STC   WORK4,WRKCT1             STORE BACK IN WORKAREA   YM3857 02513802
         CR    WORK4,WORK3              IS THIS ENTERED 10 TIMES YM3857 02515202
         BL    RETURN                   NO, CONTINUE RETRYING    YM3857 02516602
*                                                                       02518002
         MVI   IOBECBCC,ECBPERR         COULD NOT RECOVER, SET   YM3857 02519403
*                                       X'41' IN IOB             YM3857 02520802
         B     SETABN                   GO SCHEDULE THE ASI      YM3857 02522202
*                                                                       02523602
RETURN   EQU   *                        LOOPING IN VERIFY SECTN  YM3857 02525002
         NI    IOBFLAG1,X'FF'-IOBIOERR  TURN OFF ERROR FLAG      YM3857 02526402
         B     RESTARTA                 GO RETRY CHAN PGM        YM3857 02527802
*                                                                       02529202
NOTNEW   EQU   *                        WHERE WAS INTERRUPT      YM3857 02530602
         C     WORK1,WRKWKD             DID WRT KEY/DATA         YM3857 02532002
*                                       GET EXECUTED             YM3857 02533402
         BL    RESETIT                  NO, MUST BE SEEK CYL     YM3857 02534802
*                                                                       02536202
*    INTERRUPT WHILE OR AFTER WRITING KEY AND DATA                      02537602
*                                                                       02539002
         MVC   IOBSTART,WRKSTRT3        CHANGE START OF CP ONCE  YM3857 02540402
*                                       PART OF KEY WRITTEN      YM3857 02541802
         MVC   IOBCCHHR,IOBDNCRF+2      UPDATE SEEK TO SRCH      YM4606 02543203
*                                       BEGINNING WITH DUMMY REC YM4606 02544602
*                                       (NECESSARY FOR IOS SEEK) YM4606 02546002
         MVI   IOBR,0                   BEGIN WITH R0            YM2862 02547402
         B     CEEXIT3                  RETURN TO IOS FOR ERP    YM3857 02548802
*                                                                       02550202
*   INTERRUPT AFTER FOUND DUMMY AND BEFORE WRT KEY/DATA(EG. SEEK CYL)   02551602
*                                                                       02553002
RESETIT  EQU   *                        CHANGE START TO VER KEY  YM3857 02554402
         IC    WORK4,WRKCT2             GET LOOP CTR TO DATE     YM3857 02555802
         LA    WORK4,1(WORK4)           ADD THIS ENTRY TO CTR    YM3857 02557202
         STC   WORK4,WRKCT2             ST NEW COUNT             YM3857 02558602
         CR    WORK4,WORK3              IS THIS THE 10TH ENTRY   YM3857 02560002
         BL    RETURN2                  NO, RETURN TO RETRY      YM3857 02561402
*                                                                       02562802
         MVI   IOBECBCC,ECBPERR         SET X'41' IN IOB         YM3857 02564203
*                                       FOR PERMANENT ERROR      YM3857 02565602
         B     SETABN                   GO SCHEDULE THE ASI      YM3857 02567002
*                                                                       02568402
RETURN2  EQU   *                        RESTART CP AGAIN         YM3857 02569802
         MVC   IOBSTART,WRKSTRT2        START CP BY VERIFYING    YM3857 02571202
*                                       THAT DUMMY RECORD IS     YM3857 02572602
*                                       STILL A DUMMY            YM3857 02574002
         MVC   IOBCCHHR,IOBDNCRF+2      UPDATE SEEK TO SRCH      YM4606 02575403
*                                       BEGINNING WITH DUMMY REC YM4606 02576802
         MVI   IOBR,0                   BEGIN WITH R0            YM2862 02578202
         NI    IOBFLAG1,X'FF'-IOBIOERR  TURN OFF ERROR FLAG      YM3857 02579602
         TM    DCBOPTCD,DCBOPTTO        IS THIS TRK OVERFLO      YM5762 02581002
         BNO   RESTARTA                 NO, GO REEXCP            YM5762 02582402
         L     WORK1,IOBSTART           YES, GET 1ST CCW ADDR    YM5762 02583802
         CLI   CCWCOMCD,SETSECT         IS THIS RPS CP           YM5762 02585203
         BNE   RESTARTA                 NO, GO REEXCP            YM5762 02586602
         L     WORK1,CCWADDRA           YES, GET SECTOR ADDR     YM5762 02588003
         DROP  WORK1                                           @OZ04942 02589003
         MVI   0(WORK1),RPSNOP          CHANGE SECTOR TO NOP,FF  YM5762 02589402
         B     RESTARTA                 BR TO RESTART CHAN PGM   YM3857 02590802
*                                       TO VERIFY DUMMY RECORD   YM3857 02592202
*                                                                       02593602
*********************************************************************** 02595002
*    THE FOLLOWING ARE EXITS FROM THIS MODULE, EITHER APPENDAGE,      * 02596402
*    TO RETURN TO IOS IN IOS KEY OR TO SCHEDULE THE ASI.              * 02597802
*  NOTE: BECAUSE THESE EXIT ROUTINES ARE USED BY BOTH THE CHANNEL END * 02599202
*  AND ABNORMAL END APPENDAGES, THE BASE REGISTER MUST BE REESTAB-    * 02600602
*  LISHED SHOULD CODE BE ADDED TO THIS SECTION THAT REQUIRES A BASE.  * 02602002
*********************************************************************** 02603402
SETABN   OI    IOBSTAT1,IOBABNRM        MARK IOB AS ABNORMAL COMPLETION 02604803
*                                                                       02606202
*            SCHEDULE THE ASI ROUTINE                                   02607602
*                                                                       02609002
SCHASI   EQU   *                        SCHEDULE THE ASI ROUTINE Y02072 02610402
         LA    WORK5,IOSKEY             LOAD IOS KEY(=0) IN R2   Y02072 02611802
*                                                                       02613202
         MODESET  KEYADDR=(2)           RETURN TO IOS KEY        Y02072 02614602
*                                                                       02616002
         LM    R0,R15,0(SAVEREG)        RESTORE IOS REGS         Y02072 02617402
         LA    RETREG,NOFREE(RETREG)    SET NOPOST,NOFREE EXIT @OZ04942 02618803
*                                       TO EXCP FROM EXIT EFFECTOR      02619003
         L     BASE,CVTPTR              AND CALL EXIT EFFECTOR,         02620203
         USING CVT,BASE                                        @OZ04942 02621203
         L     BASE,CVT0EF00            LOCATING IT THRU CVT AND        02621603
         BR    BASE                     PASSING IT RQE TO USE    Y02072 02623003
*                                                                       02624402
*            RETURN TO IOS FROM CE OR ABE                               02625802
*                                                                       02627202
         USING IGG019KU,BASE                                   @OZ04942 02628203
CEEXIT3  EQU   *                        RETURN TO IOS            Y02072 02628602
         LA    WORK5,IOSKEY             LOAD IOS KEY(=0) IN R2   Y02072 02630002
*                                                                       02631402
         MODESET  KEYADDR=(2)           RETURN TO IOS KEY        Y02072 02632802
*                                                                       02634202
         LM    R0,R15,0(SAVEREG)        RESTORE IOS REGISTERS    Y02072 02635602
         BR    RETREG                   LET ERROR CODE STAND     Y02072 02637002
*                                                                       02638402
RESTARTA EQU   *                        RETURN TO IOS TO RESTART YM3857 02639802
         MVI   IOBSENS0,0               CLEAR SENSE BYTES      @OZ04942 02641203
         MVI   IOBSENS1,0                                      @OZ04942 02642203
         LA    WORK5,IOSKEY             LOAD IOS KEY(=0) IN R2   Y02072 02642602
         MODESET  KEYADDR=(2)           RETURN TO IOS KEY        Y02072 02644002
*                                                                       02645402
         LM    R0,R15,0(SAVEREG)        RESTORE IOS REGISTERS    Y02072 02646802
         B     RESTART(RETREG)          RET TO IOS TO RESTART   SA53271 02648202
         EJECT                                                          02649602
*********************************************************************** 02651002
*  THE FOLLOWING SUBROUTINE IS ALWAYS EXECUTED UPON ENTRY TO 19KU.    * 02652402
*  FOR CROSSING VOLUMES, DYN BUF OR EXCLUSIVE CONTROL (IF THIS IOB    * 02653802
*  HAD TO WAIT FOR A BLOCK OR BUFFER), MORE THAN ONE EXCP IS ISSUED   * 02655202
*  AGAINST THE SAME IOB.  WHEN MULTIPLE EXCPS ARE REQUIRED THE USERS  * 02656602
*  DECB ADDR IS SAVED IN THE IOBDQPTR FIELD IN THE IOB BEFORE OTHER   * 02658002
*  THAN THE 1ST EXCP WAS ISSUED AGAINST THIS IOB(IN THE DYN BUF RTN,  * 02659402
*  IGC0005C, OR FDN MOD.)  THIS IS NECESSARY TO PREVENT PROCESSING OF * 02660802
*  SUBSEQENT EXCPS FROM OVERLAYING ANY CHANGE IN THE STATUS OF THE ECB* 02662202
*********************************************************************** 02663602
ECBCHK   EQU   *                        CHECK DECB ADDR          Y02072 02665002
*                                                                       02666402
         MODESET  KEYADDR=RQEPRT,WORKREG=5   CHANGE TO USER KEY  Y02072 02667802
*                                                                       02669202
         L     WORK2,IOBECBPT           GET ADDR IN IOB FOR DECB Y02072 02670602
         LA    WORK2,0(WORK2)           CLEAR OUT TOP BYTE       Y02072 02672002
         LA    WORK3,IOBCSW+3           GET ADDR OF IOBCSW WORD  Y02072 02673402
         CR    WORK2,WORK3              DOES IOBECBPT PT TO CSW  Y02072 02674802
         BNER  LINKREG                  IF NOT, DECB PTR OK      Y02072 02676202
         L     WORK2,IOBDQPTR           ELSE,GET REAL DECB PTR   Y02072 02677602
         STCM  WORK2,ADDR,IOBECBPB      STORE IT IN LOW 3 BYTES  Y02072 02679002
         XC    IOBDQPTR,IOBDQPTR        CLEAR IOB FIELD          Y02072 02680402
         BR    LINKREG                  RETURN TO MAIN ROUTINE   Y02072 02681802
         EJECT                                                          02682803
*********************************************************************** 02683202
*                CONSTANTS AND EQUATES                                * 02684602
*********************************************************************** 02686002
*                                                                       02687402
*                                                                       02688802
SKPHIBYT EQU   X'01'                    TO START AT SECOND BYTE OZ02226 02689003
*                                       OF WORD FOR THREE BYTE  OZ02226 02689203
*                                       COMPARES                OZ02226 02689403
CMP3BYTS EQU   X'03'                    USED FOR THREE BYTE     OZ02226 02689603
*                                       COMPARES                OZ02226 02689803
ADDR     EQU   B'0111'                  MASK FOR STCM TO ST LOW  Y02072 02690202
*                                       ORDER 3 BYTES OF REG     Y02072 02691602
*              RETURN OFFSETS TO EXCP                                   02778603
NOPOST   EQU   4                        DO NOT POST ECB        @OZ04942 02778703
RESTART  EQU   8                        REEXCP THE REQUEST      SA53271 02778803
NOFREE   EQU   12                       DON'T FREE RQE OR POST @OZ04942 02779203
*                                                                       02779403
ERPCOUNT EQU   10                       NO OF TIMES ERP RETRIES  YM3857 02781102
IOSKEY   EQU   0                        IOS KEY IS ZERO          Y02072 02790802
*                                                                       02791003
*              CCW OP CODES                                             02791203
NOP      EQU   X'03'                    NOP COMMAND CODE         YM3857 02791803
RDHA     EQU   X'1A'                    READ HOME ADDR           YM5762 02792003
SETSECT  EQU   X'23'                    SET SECTOR OP CODE       YM5762 02792802
*                                                                       02793803
RPSNOP   EQU   X'FF'                    NOPS SET SECTOR COMMAND  YM5762 02794802
*                                                                       02795402
WRAPBASE DC    A(4095*4096)             4K LESS THAN 16MEG     @OZ04942 02796403
*              NOTE: SEE WRAPDECR DSECT FOR USE OF ABOVE CONSTANT       02797403
MODID    DC    CL8'IGG019KU'            MODULE ID                Y02072 02809202
FIX      DC    C'@OZ04942 '             LAST PTM ENTERED         YM5947 02811203
DATE     DC    C'&SYSDATE'              DATE OF LAST PTM         YM5947 02813203
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 02819202
         EJECT                                                          02820000
*********************************************************************** 02830002
*                         DSECTS                                      * 02830203
*********************************************************************** 02830403
WRAPDECR DSECT ,                        USED FOR DECREMENTING  @OZ04942 02831003
*        THE BASE FOR THIS DSECT MUST BE A REG HAVING 4095*4096         02831203
*        USED WITH WRAP (BELOW) THIS WILL GIVE UNCHANGED ADDRESS        02831403
*        EXAMPLE:  LA   RX,WRAP-N(RX)                          @OZ04942 02832003
*              CLEARS HIGH BYTE OF RX AND SUBTRACTS N          @OZ04942 02833003
         DS    XL4096                                          @OZ04942 02834003
WRAP     DS    0X                       EXACTLY 16 MEGS        @OZ04942 02835003
*                                                                       02838003
*                                                                       02839003
FDBKAREA DSECT ,                        USERS FEEDBACK AREA    @OZ04942 02850203
FDBKMBB  DS    CL3                      MBB PART OF SEEK       @OZ04942 02850403
FDBKCHR  DS    CL5                      CCHHR PART OF SEEK     @OZ04942 02850603
*                                                                       02850803
*********************************************************************** 02852002
*  THE FOLLOWING FORMATS THE WORKAREA LOCATED AT THE END OF IOB CORE.   02854002
*  (IN EARLIER RELEASES,FOR V,U,VS FORMAT,THIS AREA WAS AN ENQ LIST.)   02856002
*  THIS WORKAREA CONTAINS ADDRESSES OF PARTICULAR CCWS IN THE CHANNEL   02858002
*  PROGRAM BUILT BY PREFORMAT MODULE, IGG019KO, FIXED WRITE ADD. IT     02858402
*  IS INTERROGATED BY THE CHANNEL OR ABNORMAL END APPENDAGE TO DETER-   02858802
*  MINE IF AN ERROR OCCURRED AND AT WHAT POINT, AND TO TAKE THE         02859202
*  APPROPRIATE ACTION.                                                  02859602
*********************************************************************** 02859702
WRKIOB   DSECT ,                        IOB WORKAREA             YM3857 02859803
WRKRDAD  DS    F                        ADDR OF CCW THAT READS   YM3857 02865503
*                                       IN 1 DATA BYTE - ID      YM3857 02868003
WRKCCAD  DS    F                        ADDR CCW THAT WILL NOT   YM3857 02870503
*                                       BE COMMAND CHAINED TO    YM3857 02873003
*                                       NEXT IF ERROR OCCURS     YM3857 02875503
*                                       BEFORE IT.               YM3857 02878003
WRKSKCYL DS    F                        ADDR OF FIRST SEEK CYL   YM3857 02880503
*                                       WILL BE 0 IF NOT OVFLO   YM3857 02883003
WRKWKD   DS    F                        ADDR OF CCW THAT WRT KD  YM3857 02885502
WRKSTRT2 DS    F                        ADDR OF BEG CP ONCE      YM3857 02895502
*                                       DUMMY RECORD IS FOUND    YM3857 02897502
WRKSTRT3 DS    F                        ADD OF BEG CP IF ANY     YM3857 02899502
*                                       PART OF KEY IS WRITTEN-  YM3857 02901502
*                                       ALSO,ADDR THAT 2ND PART  YM3857 02903502
*                                       OF CP TICS BACK TO IN    YM3857 02903902
*                                       1ST PART OF CHAN PGM     YM3857 02904302
WRKCT1   DS    BL1                      RETRY CTR - VERIFY DUMMY YM3857 02906302
WRKCT2   DS    BL1                      RETRY CTR AFTER DUMMY    YM3857 02910302
*                                       FOUND AND BEFORE KEY IS  YM3857 02910402
*                                       WRITTEN                  YM3857 02912402
         DS    BL2                      RESERVED                 YM3857 02914402
WRKEND   EQU   *                        END OF WRKIOB          @OZ04733 02924403
WRKLEN   EQU   WRKEND-WRKIOB            LENGTH OF WRKIOB       @OZ04733 02924803
         EJECT                                                          02926303
IHACCW   DSECT ,                                               @OZ04942 02927303
         IHACCW DSECT=NO                                       @OZ04942 02931303
CCWEND   EQU   *                        END OF CCW             @OZ04733 02933103
CCWLEN   EQU   CCWEND-IHACCW            LENGTH OF CCW          @OZ04733 02935103
         EJECT                                                          02935903
IHACSW   DSECT ,                                               @OZ04942 02937703
         IHACSW DSECT=NO                                       @OZ04942 02939503
         EJECT                                                          02941303
         CVT  DSECT=YES                                                 02943103
         EJECT                                                          02944903
         DCBD  DSORG=DA                                                 02946703
         EJECT                                                          02948503
         IHADECB ,                                             @OZ04942 02950303
         EJECT                                                          02952103
         IHADVCT ,                                             @OZ04942 02953903
         EJECT                                                          02955703
         IHAECB ,                                              @OZ04942 02957503
         EJECT                                                          02959303
         IEZIOB                                                  Y02072 02961102
         ORG   IOBCC                                           @OZ04942 02962103
IOBCCHHR DS    CL5                      DEF CCHHR WITHIN SEEK  @OZ04942 02963103
         EJECT                                                          02980002
         IECDRQE                                                 Y02072 02985003
         EJECT                                                          02986003
UCB      DSECT                                                          04040503
SRT      EQU   UCB                                                      04041021
         IEFUCBOB                                                       04041521
         END                                                            04060000
./  ADD  SSI=31840111,NAME=IGG019KW
         TITLE 'IGG019KW - KEY - EXTENDED SEARCH MODULE'                00010019
IGG019KW CSECT                                                          00020000
*MODULE NAME - IGG019KW                                               * 00022002
*                                                                     * 00022402
*DESCRIPTIVE NAME - BUILDS EXTENDED SEARCH CHANNEL PROGRAM FOR        * 00022802
*                   BDAM SEARCH ON KEYS                               * 00023202
*                                                                     * 00023602
*COPYRIGHT - NONE                                                     * 00023702
*                                                                     * 00023802
*CHANGE ACTIVITY                                                      * 00023902
*                                                                       00028020
*          RELEASE 19 CHANGES/DELETIONS                                 00038002
*2762001000-001200,002200,002800,003200,003600,005600-006200,    S19015 00051019
*2762013200-013600,015400-017600,018200-018800,019400-021000,    S19015 00052019
*2762025600                                                      S19015 00053019
*          RELEASE 20 CHANGES/DELETIONS                                 00055002
*2971000250-000400,000600-000700,015970,016530                   20201  00055102
*          RELEASE 21 CHANGES/DELETIONS                                 00055402
*                                                               SA53177 00065402
*          VS1-1 CHANGES/DELETIONS                                      00067002
*          VS2-1 CHANGES/DELETIONS                                      00069002
*          VS1-2 CHANGES/DELETIONS                                      00071002
*          VS2-2 CHANGES/DELETIONS                                      00073002
*                                                                       00075002
*STATUS CHANGE LEVEL 006                                                00080002
*                                                                     * 00085019
*FUNCTION/OPERATION- THIS MODULE IS ENTERED FROM IGG019KI OR IGG019KR * 00095002
*   TO COMPLETE THE CONSTRUCTION OF A CHANNEL PROGRAM WHICH SEARCHES  * 00105002
*   MULTIPLE TRACKS FOR AN EQUAL TO THE KEY FIELD SPECIFIED IN A      * 00140000
*   READ OR WRITE TYPE 'DK'.                                          * 00160000
*                                                                     * 00180000
*ENTRY POINT- 'IGG019KW' (BEGIN) IS ENTERED BY THE CALLING SEQUENCE,  * 00200000
*   L     15,4(IGG019KI BASE) OR IGG019KR                               00220019
*   BALR  14,15                                                       * 00240000
*                                                                     * 00260000
*INPUT- THE FOLLOWING REGISTERS ARE PASSED,                           * 00280002
*   5 - DECB ADDRESS                                                  * 00300000
*   6 - ADDRESS OF CCW1                                               * 00320002
*   7 - IOB ADDRESS                                                   * 00340000
*   11- BASE ADDRESS OF IGG019KA OR IGG019KJ (BASE ROUTINE)           * 00360002
*                                                                     * 00380000
*OUTPUT- THE CCWS WILL BE CONSTRUCTED AND APPENDED TO THE IOB, AND    * 00400000
*   REGISTER 6 WILL CONTAIN THE ADDRESS OF THE LAST CCW.              * 00420000
*                                                                     * 00440000
*EXTERNAL ROUTINE- 'IGG019KQ' (WRITE-VERIFY) WILL BE ENTERED TO       * 00460000
*   CONSTRUCT THE CCWS REQUIRED TO VERIFY THE NEW DATA IF THIS IS A   * 00480000
*   WRITE REQUEST AND THE WRITE VALIDITY CHECK OPTION IS SPECIFIED IN * 00500000
*   THE DCB.                                                          * 00520000
*                                                                     * 00540000
*EXIT-NORMAL- 'EXIT1' IS A RETURN TO IGG019KA OR IGG019KJ WHEN THE    * 00560002
*   CCWS FOR A READ TYPE DK ARE COMPLETE.                             * 00580002
*   'EXIT2' IS A RETURN TO IGG019KA OR IGG019KJ WHEN THE CCWS FOR A   * 00600002
*   WRITE TYPE DK, NO VERIFY, ARE COMPLETE.                           * 00620002
*   'EXIT3' IS THE EXIT TO IGG019KQ TO CONSTRUCT THE VERIFY CCWS.     * 00640000
*                                                                     * 00660000
*TABLES/WORK AREAS- N/A                                               * 00680000
*                                                                     * 00700000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.          * 00720000
*                                                                     * 00740000
*                                                                     * 00760000
*                                                                       00780000
*   REGISTER USAGE                                                      00800000
*                                                                       00820000
         USING IGG019KW,EPREG                                           00840000
         USING IHADCB,DCBREG                                            00860000
         USING IOBDEF,IOBREG                                            00880000
         USING DECBDEF,DECBREG                                          00900000
         USING EXTSRCH,CCWIND                                    S19015 00910019
*                                                                       00920000
WKREG    EQU   0         WORK REGISTER/VERIFY PARAMETER                 00940000
PARAM    EQU   1         VERIFY PARAMETER                               00960000
WKREG1   EQU   2         WORK REGISTER                                  00980000
DDEBREG  EQU   3         DEB ADDRESS                                    01000000
DCBREG   EQU   4         DCB ADDRESS                                    01020000
DECBREG  EQU   5         DECB ADDRESS                                   01040000
CCWIND   EQU   6         CCW INDEX                                      01060000
IOBREG   EQU   7         IOB ADDRESS                                    01080000
VERBASE  EQU   10        VERIFY BASE/ENTRY POINT                        01100000
FDNBASE  EQU   11        FOUNDATION MODULE BASE                         01120000
INTRET   EQU   12        RETURN FOR LINKAGE TO VERIFY                   01140000
SAVE     EQU   13        USER'S SAVE AREA ADDRESS                       01160000
RETREG   EQU   14        RETURN TO FOUNDATION MODULE                    01180000
EPREG    EQU   15        ENTRY POINT/BASE OF THIS MODULE                01200000
*                                                                       01220000
*                                                                       01240000
*                                                                       01260000
*                                                                       01280000
BEGIN    EQU   *                                                        01300000
         LA    PARAM,ESSKE1            ADDR OF SEARCH KEY EQUAL  S19015 01310019
         MVC   ESNOP3(CCWLNG),ESMTSIE  MOVE READ DATA CCW TO     S19015 01320019
*                                       CCW9                     S19015 01330019
         LA    WKREG1,ESNOP3           POINT TO CCW9-NOP OR READ S19015 01340019
*                                       SE                       S19015 01350019
         TM    IOBDTYPE,READX+FEEDB    ARE FEEDBACK CCWS NEEDED         01380000
         BC    7,FDBK                  YES, GO MOVE THEM                01400000
         TM    DCBBFTEK,RBFTKMSK       DOES BUFFER TECHNIQUE     S19015 01404019
*                                       EQUAL                    S19015 01408019
         BO    FDBK                    YES,GO SET UP FEEDBACK    S19015 01412019
*                                       CCWS                     S19015 01416019
*                                                                       01420000
         TM    IOBDTYPE,OFLOW+VERIFY   IS A SEEK ADDRESS NEEDED         01440000
         BC    14,NOFDBK                NO, OMIT FEEDBACK CCWS          01460000
         TM    IOBDTYPE+1,READ         SEEK ADDR IS NOT NEEDED FOR A    01480000
         BC    1,NOFDBK                 READ REQUEST.                   01500000
*                                                                       01520000
FDBK     EQU   *                                                 S19015 01527019
         MVC   ESRC(FOURCCWS),ESNOP1   MOVE ORIG 4 CCWS TO       S19015 01534019
*                                       CCW13-16                 S19015 01541019
         LA    PARAM,ESRC              ADDR OF READ COUNT CCW    S19015 01548019
*                                       FOR                      S19015 01555019
         ST    PARAM,ESTIC4            TIC CCW15                 S19015 01562019
         MVI   ESTIC4,TICOP            INSERT TIC OP CODE IN     S19015 01569019
*                                       CCW15                    S19015 01576019
         LA    PARAM,ESSKE2            ADDR OF CCW14-SRCH KEY    S19015 01583019
*                                       EQUAL                    S19015 01590019
         MVI   ESRHA,RDHMADDR          INSERT READ HA INTO CCW11 S19015 01604019
         MVI   ESRHA+BYTE4,CCHN+SILI+SKIP  TURN OFF INDEX POINT  S19015 01611019
         MVI   ESRHA+BYTE7,ONE             LATCH                 S19015 01618019
         MVC   ESNOP3(CCWLNG),NOP      NOP OR READ SECTOR-CCW9   S19015 01625019
         MVC   ESNOP3A(CCWLNG),NOP     NOP OR SET SECTOR         S19015 01632019
*                                       (0)-CCW10                S19015 01639019
         MVC   ESNOP3B(CCWLNG),NOP     NOP OR SET SECTOR-CCW12   S19015 01646019
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  01646720
         BNE   NOTRRA                   BRANCH IF NO             20201  01647420
         L     WKREG1,IOBDCPND          GET SECTOR ADDR          20201  01648120
         ST    WKREG1,ESNOP3A           PUT IN CCW WITH SET      20201  01648820
*                                       SECTOR                   20201  01649520
*                                       CMND                            01650220
         LA    WKREG1,ONE(WKREG1)       INCR ADDR BY ONE         20201  01650920
         ST    WKREG1,ESNOP3B           PUT IN CCW WITH CMND     20201  01651620
         ST    WKREG1,ESNOP3            PUT IN CCW               20201  01652320
         MVI   ESNOP3,RDSC              PUT IN RD SECTOR CMND    20201  01653020
*                                                                       01653720
         MVI   ESNOP3B,SETSC            RESTORE COMMAND          20201  01654420
         MVI   ESNOP3+BYTE4,CCHN        COMMAND CHAIN RD SECTOR  20201  01655120
         MVI   ESNOP3A+BYTE4,CCHN       COMMAND CHAIN SET        20201  01655820
*                                       SECTOR=0                 20201  01656520
         MVI   ESNOP3B+BYTE4,CCHN       COMMAND CHAIN SET SECTOR 20201  01657220
NOTRRA   EQU   *                                                 20201  01657920
         LA    WKREG1,ESRD1             PT TO CCW 16             20201  01658620
*                                                                       01659320
NOFDBK   EQU   *                                                 S19015 01660019
         MVC   ESNOP1(CCWLNG),NOP      INSERT NOP IN CCW1        S19015 01667019
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  01668020
         BNE   NOTRRD                   BRANCH NO                20201  01669020
         MVC   ESNOP1(BYTE4),IOBDCPND   MOVE ADDR AND CMND TO    20201  01670020
*                                       CCW                      20201  01671020
         MVI   ESNOP1+BYTE4,CCHN        COMMAND CHAIN CCW        20201  01672020
NOTRRD   EQU   *                                                 20201  01673020
         LA    WKREG,ESSIE1            ADDR OF CCW2-SRCH ID      S19015 01674019
*                                       EQUAL                    S19015 01681019
         ST    WKREG,ESTIC1            TIC ADDR FOR CCW3         S19015 01688019
         MVI   ESTIC1,TICOP            INSERT TIC OP CODE IN     S19015 01695019
*                                       CCW3                     S19015 01702019
         MVC   ESSKE1(CCWLNG),ESSIE1   MOVE ORIG SEARCH KEY = TO S19015 01709019
*                                       CC                       S19015 01716019
         OI    ESSKE1,SILI             TURN ON SILI BIT          S19015 01723019
         LA    WKREG,ESMTSIE           ADDR OF CCW4-MULTI-TRK    S19015 01730019
*                                       SRCH                     S19015 01737019
         ST    WKREG,ESTIC3            EQUAL FOR TIC CCW8        S19015 01744019
         MVI   ESTIC3,TICOP            INSERT TIC OP CODE IN     S19015 01751019
*                                       CCW8                     S19015 01758019
*                                                                       01780000
         LA    WKREG,IOBSEEK+3         CONSTRUCT SEARCH-ID-EQUAL (R0)   01800000
         ST    WKREG,ESSIE1            AND INSERT INTO CCW2      S19015 01810019
         MVI   ESSIE1,SCHIDEQ          MOVE IN SEARCH ID EQUAL   S19015 01820019
*                                       OP                       S19015 01830019
         MVC   ESSIE1+BYTE4(BYTE4),FLGCTTIC  INSERT FLAG         S19015 01840019
*                                       BYTES-CCW2               S19015 01850019
*                                                                       01900000
         LA    WKREG,IOBUPLIM+3         CONSTRUCT SEARCH-ID-EQUAL CCW   01920002
         ST    WKREG,ESMTSIE            INSERT SEARCH LIMIT INTO S19015 01930002
*                                       CCW                      S19015 01940019
         MVI   ESMTSIE,MSCHIDEQ         MULTI-TRK SRCH ID EQUAL  S19015 01950002
         TM    DCBOPTCD,DCBOPTA         ACTUAL ADDR SPECIFIED?  SA53177 01962002
         BNO   NOTACT                   NO, USE EXTENDED SRCH   SA53177 01964002
         MVI   ESMTSIE,SCHIDEQ          IF ACTUAL DONT DO MULTI SA53177 01966002
*                                       TRK SRCH SINCE EXTENDED SA53177 01968002
*                                       SRCH NOT VALID WITH ACT SA53177 01968402
NOTACT   EQU   *                                                SA53177 01968802
         LA    WKREG,ESSKE1            ADDR OF CCW7-SEARCH KEY   S19015 01970019
*                                       EQUA                     S19015 01980019
         ST    WKREG,ESTIC2            USED FOR CCW5-TIC AADRESS S19015 01990019
         MVC   ESMTSIE+BYTE4(BYTE5),FLGCTTIC INSERT FLAG BYTES   S19015 02000019
*                                       IN C                     S19015 02010019
*                                      AND TIC OP CODE FOR CCW5         02020019
         MVC   ESNOP2(CCWLNG),NOP      NOP FOR CCW6              S19015 02030019
         MVI   ESNOP2+BYTE4,SILI       TURN OFF COMMAND CHAINING S19015 02040019
*                                                                       02120000
*                                                                       02140000
         LR    CCWIND,WKREG1           SET CCWIND TO LAST CCW           02160000
         NI    BYTE4(CCWIND),NOCCHN    TURN OFF CMD CHAIN IN     S19015 02166019
*                                       LAST C                   S19015 02172019
         TM    IOBDTYPE+1,READ         IF THIS IS A READ REQUEST        02180000
EXIT1    BCR   1,RETREG                 RETURN TO THE FOUNDATION        02200000
*                                                                       02220000
         TM    DCBBFTEK,RBFTKMSK       DOES BUFFER TECHNIQUE     S19015 02225019
*                                       EQUAL                    S19015 02230019
         BO    IOBTEST                 YES, GO CHECK IOB TYPE    S19015 02235019
         MVI   0(CCWIND),WRTDATA                                        02240000
IOBTEST  EQU   *                                                 S19015 02250019
         TM    IOBDTYPE,VERIFY         IF NO VERIFY OPTION              02260000
EXIT2    BCR   8,RETREG                 RETURN TO THE FOUNDATION MODULE 02280000
*                                                                       02300000
         TM    DCBBFTEK,RBFTKMSK       DOES BUFFER TECHNIQUE     S19015 02302019
*                                       EQUAL                    S19015 02304019
         BZ    NOVRE                   NO,LEAVE PARAM POINT TO   S19015 02306019
*                                       SK=                      S19015 02308019
         LA    PARAM,IOBCP+CCWLNG      POINT TO SRCH ID EQUAL    S19015 02310019
*                                       CCW                      S19015 02312019
         CLI   IOBDCPND,SETSC           RCD READY USED           20201  02312220
         BNE   NOTRRJ                   BRANCH IF NO             20201  02312420
         MVI   IOBDCPND,MASK            RESET RCD READY          20201  02312620
*                                       INDICATOR                20201  02312820
*                                       TO NON VRE                      02313020
NOTRRJ   EQU   *                                                 20201  02313220
NOVRE    EQU   *                                                 S19015 02314019
         L     VERBASE,12(0,FDNBASE)   LOAD ENTRY POINT/BASE OF VERIFY  02320000
EXIT3    BR    VERBASE                                                  02340000
*                                                                       02360000
*                                                                       02380000
*                                                                       02400000
FLGCTTIC DC    X'4000000508'  COMMAND CHAIN,COUNT FIVE,TIC OP-CODE      02420000
         DC    X'00'                   PAD TO HALF WORD BOUNDARY        02440000
*              THE FOLLOWING CNOP MUST REMAIN ON A HALF-WORD BOUNDARY   02460000
         CNOP  0,8                     PAD TO DOUBLE WORD SIZE FOR TTR  02480000
SCHIDEQ  EQU   X'31'          SEARCH-ID-EQUAL OP-CODE                   02500000
TICOP    EQU   X'08'          TIC OP-CODE                               02520000
MSCHIDEQ EQU   X'B1'          MULTIPLE TRACK,SEARCH-ID-EQUAL            02540000
NOP      DC    X'0300000060000001'     NOP CCW                   S19015 02543019
RBFTKMSK EQU   X'20'                   DCBBFTEK=R--VS            S19015 02546019
CCWLNG   EQU   8                       LENGTH OF A CCW-8 BYTES   S19015 02549019
FOURCCWS EQU   32                      LENGTH OF 4 CCWS-32 BYTES S19015 02552019
BYTE4    EQU   4                       LENGTH FOR MOVE           S19015 02555019
*                                       INSTRUCTION              S19015 02558019
BYTE5    EQU   5                       LENGTH FOR MOVE           S19015 02561019
*                                       INSTRUCTION              S19015 02564019
BYTE7    EQU   7                       USED FOR DISPLACEMENT     S19015 02567019
ONE      EQU   1                       LATCH BYTE                S19015 02570019
RDDATA   EQU   X'06'          READ DATA OP-CODE                         02580000
CHNSILI  EQU   X'60'          COMMAND CHAIN,SUPPRESS INCORRECT LENGTH   02600000
FIVE     EQU   X'05'          COUNT OF FIVE                             02620000
WRTDATA  EQU   X'05'          WRITE DATA OP-CODE                        02640000
CCHN     EQU   X'40'          COMMAND CHAIN FLAG                        02660000
NOCCHN   EQU   X'BF'                   MASK TO TURN OFF CMD      S19015 02666019
*                                       CHAININ                  S19015 02672019
SILI     EQU   X'20'          SUPPRESS INCORRECT LENGTH INDICATION      02680000
SKIP     EQU   X'10'          SKIP FLAG                                 02700000
RDHMADDR EQU   X'1A'          READ HOME ADDRESS OP CODE                 02720000
         EJECT                                                          02740000
*              OPTIONS AND TYPE                                         02760000
VERIFY   EQU   X'80'                                                    02780000
OFLOW    EQU   X'40'                                                    02800000
EXSCH    EQU   X'20'                                                    02820000
FEEDB    EQU   X'10'                                                    02840000
ACTAD    EQU   X'08'                                                    02860000
DYNBF    EQU   X'04'                                                    02880000
READX    EQU   X'02'                                                    02900000
RELRD    EQU   X'01'                                                    02920000
KEYOP    EQU   X'80'                                                    02940000
LGNOP    EQU   X'40'                                                    02960000
READ     EQU   X'08'                                                    02980000
KEY      EQU   X'04'                                                    03000000
ADD      EQU   X'02'                                                    03020000
*                                                                       03040000
RDSC     EQU   X'22'                    RD SECTOR CCW CMND       20201  03042020
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      20201  03044020
MASK     EQU   X'FF'                    NON VRE RECORD READY     20201  03046020
*                                       INDIC                    20201  03048020
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 03048402
         EJECT                                                          03048802
*                                                                       03050020
*                                                                       03052020
*                                                                       03060000
         DCBD  DSORG=DA                                                 03080000
         EJECT                                                          03090002
*                                                                       03100000
*                                                                       03120000
*      DATA EVENT CONTROL BLOCK %DECB< DEFINITION                       03140000
         DS    0F                                                       03160000
DECBDEF  DSECT                                                          03180000
DECSDECB DS    CL4            STANDARD EVENT CONTROL BLOCK %ECB<        03200000
DECTYPE  DS    CL2            TYPE FIELD                                03220000
DECLNGTH DS    CL2            DATA LENGTH                               03240000
DECDCBAD DS    CL4            ADDRESS OF DCB                            03260000
DECAREA  DS    CL4            ADDRESS OF DATA AREA                      03280000
DECIOBPT DS    CL4            ADDRESS OF THE IOB                        03300000
DECKYADR DS    CL4            ADDRESS OF KEY                            03320000
DECRECPT DS    CL4            ADDRESS OF RECORD REFERENCE               03340000
*                                                                       03360000
*                                                                       03380000
*                                                                       03400000
*                                                                       03420000
*      I/O BLOCK (IOB) DEFINITION                                       03440000
*                                                                       03460000
*              STANDARD IOB                                             03480000
         DS    0D                                                       03500000
IOBDEF   DSECT                                                          03520000
IOBFLAG1 DS    CL1            STATUS FLAG                               03540000
IOBFLAG2 DS    CL1            ERROR FLAG                                03560000
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       03580000
IOBECBPT DS    CL4            ECB POINTER                               03600000
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       03620000
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           03640000
         DS    CL1                                                      03660000
         DS    CL3                                                      03680000
IOBCSWST DS    CL2            STATUS BYTES                              03700000
IOBCSWCT DS    CL2            REMAINING COUNT                           03720000
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   03740000
IOBSIOCC DS    CL1            SIO CONDITION CODE                        03760000
         DS    CL3                                                      03780000
IOBDCBPT DS    0CL4           DCB POINTER                               03800000
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            03820000
         DS    CL3                                                      03840000
IOBRESTR DS    0CL4           RESTART POINTER                           03860000
         DS    CL1                                                      03880000
         DS    CL3                                                      03900000
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              03920000
IOBERRCT DS    CL2            ERROR COUNTER                             03940000
IOBSEEK  DS    CL8            SEEK ADDRESS                              03960000
*        BDAM EXTENDED IOB                                              03980000
*                                                                       04000000
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  04020000
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          04040000
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     04060000
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                04080000
         DS    CL3                                                      04100000
IOBDTYPE DS    CL2            TYPE FIELD                                04120000
IOBDSTAT DS    CL2            IOB STATUS                                04140000
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        04160000
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                04180000
         DS    CL2                                                      04200000
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               04220000
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        04240000
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                04260000
IOBCP    DS    CL256                   FIRST CCW IN CHANNEL PROGRAM     04280000
EXTSRCH  DSECT                                                   S19015 04280619
*                                       ,                        S19015 04281219
ESNOP1   DS    D                  CCW1  NOP OR SET SECTOR (0)    S19015 04281819
ESSIE1   DS    D                  CCW2  SEARCH ID EQUAL (R0)     S19015 04282419
ESTIC1   DS    D                  CCW3  TIC TO CCW2              S19015 04283019
ESMTSIE  DS    D                  CCW4  MULTI-TRACK SEARCH ID    S19015 04283619
*                                       EQUAL                    S19015 04284219
ESTIC2   DS    D                  CCW5  TIC TO CCW7              S19015 04284819
ESNOP2   DS    D                  CCW6  NOP                      S19015 04285419
ESSKE1   DS    D                  CCW7  SEARCH KEY EQUAL         S19015 04286019
ESTIC3   DS    D                  CCW8  TIC TO CCW4              S19015 04286619
ESNOP3   DS    D                  CCW9  NOP OR READ SECTOR       S19015 04287219
ESNOP3A  DS    D                  CCW10 NOP OR SET SECTOR (0)    S19015 04287819
ESRHA    DS    D                  CCW11 READ HOME ADDRESS        S19015 04288419
ESNOP3B  DS    D                  CCW12 NOP OR SET SECTOR        S19015 04289019
ESRC     DS    D                  CCW13 READ COUNT               S19015 04289619
ESSKE2   DS    D                  CCW14 SEARCH KEY EQUAL         S19015 04290219
ESTIC4   DS    D                  CCW15 TIC TO CCW13             S19015 04290819
ESRD1    DS    D                  CCW16 READ DATA TO GET SEGMENT S19015 04291419
*                                       LE                       S19015 04292019
ESNOP4   DS    D               ** CCW17 NOP OR SET SECTOR        S19015 04292619
ESSIE2   DS    D               ** CCW18 SEARCH ID EQUAL          S19015 04293219
ESTIC5   DS    D               ** CCW19 TIC TO CCW18             S19015 04293819
ESRD2    DS    D               ** CCW20 READ DATA TO DO WRITE    S19015 04294419
*                                       CHECK                    S19015 04295019
*                                                                       04295619
*                              ** INDICATES THAT THE CCW'S ARE PRES     04296219
*                                 ONLY IF WRITE CHECK IS REQUESTED.     04296819
*                                                                       04297419
         SPACE 3                                                 S19015 04298019
         END                                                            04300000
./  ADD  SSI=32360076,NAME=IGG019KY
 TITLE   'IGG019KY - EXTENDED SEARCH FOR WRITE ADD MODULE,SELF FORMAT'  00060002
IGG019KY CSECT                                                        * 00070002
*                                                                     * 00080000
*MODULE NAME - IGG019KY                                               * 00090002
*                                                                     * 00092002
*DESCRIPTIVE NAME - BDAM CHAN PGM MOD FOR EXTENDED SEARCH, WRITE ADD  * 00094002
*                                                                     * 00096002
*COPYRIGHT - NONE                                                     * 00098002
*                                                                     * 00098402
*CHANGE ACTIVITY                                                      * 00098802
*                                                                       00099202
*        VS2 RELEASE 2                                                  00099602
*                                                                Y02072 00104702
*                                                                YM3029 00109802
*                                                                       00111802
*                                                                       00113802
*FUNCTION/OPERATION- THIS ROUTINE IS ENTERED FROM 19KM/19KN WHEN A NEW* 00114902
*   BLOCK IS TO BE ADDED BUT WILL NOT FIT ON THE CURRENT TRACK. THIS  * 00120000
*   ROUTINE INCREMENTS THE DEVICE ADDRESS TO THE NEXT TRACK, AND CHECK* 00140000
*   FOR A VALID ADDRESS, ADDRESS WITHIN THE EXTENT AND WITHIN THE     * 00160000
*   SEARCH LIMITS.                                                    * 00180000
*                                                                     * 00200000
*ENTRY POINT- 'IGG019KY' (BEGIN) IS ENTERED FROM 19KM/19KN BY THE     * 00220002
*   CALLING SEQUENCE,   L    15,DCBDFOR                               * 00240000
*                       L    15,4(15)                                 * 00260000
*                       BALR 12,15                                    * 00280000
*                                                                     * 00300000
*INPUT- THE FOLLOWING REGISTERS ARE LOADED BY IGG019KM/IGG019KN       * 00320002
*   1 - IOB ADDRESS                                                   * 00340000
*   11- ADDRESS OF THE CORRECT ENTRY IN THE DIRECT ACCESS DEVICE TABLE* 00360000
*                                                                     * 00380000
*OUTPUT- THE NEW TRACK ADDRESS WILL BE PLACED IN IOBSEEK FIELD AND    * 00400000
*   AN 'EXCP' GIVEN TO RESTART THE CHANNEL PROGRAM. IF NO TRACK       * 00420000
*   ADDRESS CAN BE ASSIGNED, THIS ROUTINE RETURNS TO 19KM/19KN TO SET * 00440002
*   THE ABNORMAL COMPLETION INDICATION.                               * 00460000
*                                                                     * 00480000
*EXTERNAL ROUTINE- 'IGG019LC' (END-OF-EXTENT APPENDAGE) IS ENTERED IF * 00500000
*   THE NEW TRACK ADDRESS IS NOT WITHIN THE CURRENT EXTENT.           * 00520000
*                                                                     * 00540000
*EXIT-NORMAL- 'EXIT3' IS THE POINT AT WHICH AN 'EXCP' IS GIVEN AND    * 00560000
*   A RETURN TO SUPERVISOR EFFECTED BY USE OF THE 'EXIT' SVC.         * 00580000
*                                                                     * 00600000
*EXIT-ERROR- 'EXIT2' IS THE RETURN TO 19KM/19KN WHEN THE SEARCH LIMIT * 00620002
*   HAS BEEN REACHED. 19KM/19KN WILL SET INDICATIONS OF ABNORMAL      * 00640002
*   COMPLETION, NO-SPACE-FOUND.                                       * 00660000
*                                                                     * 00680000
*TABLES/WORK AREAS- THE DIRECT ACCESS DEVICE TABLE (DADT) IS USED TO  * 00700000
*   DETERMINE THE PHYSICAL CHARACTERISTICS OF THE CURRENT DEVICE.     * 00720000
*                                                                     * 00740000
*ATTRIBUTES- THIS ROUTINE IS REUSABLE, EXECUTED ENABLED WITH THE      * 00760002
*   PROTECT KEY OF THE PROBLEM PROGRAM.                               * 00780000
*                                                                     * 00800000
*                                                                     * 00820000
*                                                                       00840000
         EJECT                                                          00860000
*                                                                       00880000
*  REGISTER USAGE                                                       00900000
*                                                                       00920000
         USING IGG019KY,EPREG                                           00940000
         USING IOBDEF,IOBREG                                            00960000
         USING DEBDEF,DEBREG                                            00980000
*                                                                       01000000
WKREG    EQU   1                        WORK REGISTER                   01020000
WKREG1   EQU   7                        DADT ENTRY FOR THIS DEVICE      01040000
DEBREG   EQU   8                        DEB ADDRESS                     01060000
WKREG2   EQU   9                        WORK REGISTER/CCHH INDEX        01080000
WKREG3   EQU   11                       WORK REGISTER                   01100000
IOBREG   EQU   12                       IOB ADDRESS                     01120000
INTRET   EQU   14                      INTERNAL LINKAGE REGISTER        01140000
EPREG    EQU   15        ENTRY POINT/BASE                               01160000
*                                                                       01180000
EXIT     EQU   3         SVC CODE FOR 'EXIT'                            01200000
*                                                                       01220000
*                                                                       01240000
BEGIN    MVC   IOBCSW(4),MAXCC(WKREG1)  MOVE TOTAL CCHH VALUES TO IOB   01260000
         MVC   IOBCSW+4(4),IOBSEEK+3    MOVE CCHH FOR ALIGNMENT         01280000
         MVI   IOBSEEK+7,0             ZERO OUT R OF IOBSEEK            01300000
         L     DEBREG,IOBDCBPT          SET POINTER TO                  01320000
         L     DEBREG,DCBDEBAD(0,DEBREG) THE DEB AND TO THE             01340000
         SR    WKREG3,WKREG3             CURRENT                        01360000
         IC    WKREG3,IOBSEEK            EXTENT                         01380000
         SLL   WKREG3,4                  IN THE DEB                     01400000
         AR    WKREG3,DEBREG                                            01420000
*                                                                       01440000
         LA    IOBREG,0(0,IOBREG)      CLEAR THE HI-ORDER BYTE TO ZERO  01460000
         LA    WKREG2,3(0,IOBREG)       SET CCHH INDEX TO LAST H        01480000
         L     WKREG,IOBCSW+4           LOAD SEEK ADDRESS CCHH TO AN    01500000
         TM    BYTEDEV(WKREG1),BYTE     ARE ADDRESS BYTES CONTIGUOUS    01520000
         BZ    DOWNONE                  BRANCH IF CONTIG ADDRESS BYTES  01540000
*                                                          ACCUMULATOR  01560000
ADDONE   AH    WKREG,ONE                ADD ONE TO SOME BYTE OF CCHH    01580000
         TM    BYTEDEV(WKREG1),BYTE     IF THIS DEVICE HAS NON-         01600000
         BC    1,USEBYTE                 CONTIGUOUS BYTES, BRANCH       01620000
         STH   WKREG,IOBCSW-IOBDEF+4(0,WKREG2) STORE NEW CC OR HH VALUE 01640000
         CLC   IOBCSW-IOBDEF+4(2,WKREG2),IOBCSW-IOBDEF(WKREG2)          01660000
*                                      IS THE NEW CC OR HH VALID VALUE  01680000
         BC    4,TSTEXT                  IF OK, GO TEST EXTENT LIMIT    01700000
         SRL   WKREG,16                 SHIFT TO NEXT VALUES            01720000
         MVC   IOBCSW-IOBDEF+4(2,WKREG2),ZERO  ZERO THESE TWO BYTES     01740000
         BCTR  WKREG2,0                 DECREMENT INDEX TO              01760000
DOWNONE  BCTR  WKREG2,0                  THE NEXT VALUE                 01780000
         CR    WKREG2,IOBREG            HAS ALL OF CCHH BEEN INCREMENTD 01800000
         BC    10,ADDONE                 NO, REPEAT LOOP                01820000
*                                                                       01840000
EXIT1    L     EPREG,DEBAPPAD           LOCATE END-OF-EXTENT MODULE     01860000
         L     EPREG,EOE(0,EPREG)        FROM THE APPENDAGE LIST        01880000
         BC    15,4(0,EPREG)            AND GO THERE                    01900000
*                                                                       01920000
USEBYTE  EQU   *                                                        01940000
         STC   WKREG,IOBCSW-IOBDEF+4(0,WKREG2)  STORE NEW BYTE OF CCHH  01960000
         SRL   WKREG,8                  SHIFT TO THE NEXT VALUE         01980000
         CLC   IOBCSW-IOBDEF+4(1,WKREG2),IOBCSW-IOBDEF(WKREG2)          02000000
*                                      CHECK VALIDITY OF NEW BYTE       02020000
         BC    4,TSTEXT                 IF OK, GO TEST EXTENT LIMIT     02040000
         MVI   IOBCSW-IOBDEF+4(WKREG2),0  ZERO THIS BYTE OF CCHH        02060000
         BC    15,DOWNONE               GO SEE IF ALL BYTES PROCESSED   02080000
*                                                                       02100000
TSTEXT   MVC   IOBSEEK+3(4),IOBCSW+4    MOVE NEW CCHH BACK TO SEEK ADDR 02120000
         CLC   IOBSEEK+3(4),DEBENDCC-DEBDEF(WKREG3)  IF THE NEW CCHH    02140000
*                                       IS OUTSIDE OF THE CURRENT       02160000
         BC    2,EXIT1                  EXTENT, GO TO THE END-OF-EXTENT 02180000
*                                       MODULE.                         02200000
         CLC   IOBSEEK,IOBUPLIM         HAS SEARCH LIMIT BEEN REACHED   02220000
EXIT2    BC    8,4(0,INTRET)           YES, RETURN TO SET NO-SPACE-     02240000
*                                        FOUND BIT                      02260000
EXIT3    EQU   *                                                        02280000
         BR    INTRET                                                   02300000
*                                                                       02320000
*                                                                       02340000
*                                                                       02360000
ONE      DC    H'1'      ONE                                            02380000
ZERO     DC    H'0'      ZEROS                                          02400000
MAXCC    EQU   0         TOTAL CYLINDERS AND TRACKS(CCHH) IN DADT       02460000
BYTEDEV  EQU   9         OFFSET IN DADT TO THE FLAG BYTE                02480000
BYTE     EQU   2         DADT FLAG- BYTES OF CCHH ARE NON-CONTIGUOUS    02500000
*                                                                       02520000
EOE      EQU   0         OFFSET TO EOE ADDRESS IN APPENDAGE LIST        02540000
*                                                                       02560000
DCBDEBAD EQU   44        OFFSET TO DEB ADDRESS IN THE DCB               02580000
DCBDFOR  EQU   92        OFFSET TO SELF-FORMAT MODULE ADDRESS IN DCB    02600000
MODID    DC    C'IGG019KY'              MODULE ID                Y02072 02610002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 02612002
         EJECT                                                          02620000
*      I/O BLOCK (IOB) DEFINITION                                       02640000
*                                                                       02660000
*              STANDARD IOB                                             02680000
         DS    0F                                                       02700000
IOBDEF   DSECT                                                          02720000
IOBFLAG1 DS    CL1            STATUS FLAG                               02740000
IOBFLAG2 DS    CL1            ERROR FLAG                                02760000
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       02780000
IOBECBPT DS    CL4            ECB POINTER                               02800000
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       02820000
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           02840000
         DS    CL1                                                      02860000
         DS    CL3                                                      02880000
IOBCSWST DS    CL2            STATUS BYTES                              02900000
IOBCSWCT DS    CL2            REMAINING COUNT                           02920000
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   02940000
IOBSIOCC DS    CL1            SIO CONDITION CODE                        02960000
         DS    CL3                                                      02980000
IOBDCBPT DS    0CL4           DCB POINTER                               03000000
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            03020000
         DS    CL3                                                      03040000
IOBRESTR DS    0CL4           RESTART POINTER                           03060000
         DS    CL1                                                      03080000
         DS    CL3                                                      03100000
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              03120000
IOBERRCT DS    CL2            ERROR COUNTER                             03140000
IOBSEEK  DS    CL8            SEEK ADDRESS                              03160000
*        BDAM EXTENDED IOB                                              03180000
*                                                                       03200000
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  03220000
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          03240000
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     03260000
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                03280000
         DS    CL3                                                      03300000
IOBDTYPE DS    CL2            TYPE FIELD                                03320000
IOBDSTAT DS    CL2            IOB STATUS                                03340000
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        03360000
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                03380000
         DS    CL2                                                      03400000
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               03420000
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        03440000
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                03460000
IOBCP    DS    CL8            FIRST CCW IN CHANNEL PROGRAM              03480000
         EJECT                                                          03500000
*                                                                       03520000
*      DATA EXTENT BLOCK (DEB) DEFINITION                               03540000
*                                                                       03560000
DEBDEF   DSECT                                                          03580000
         DS    0F                                                       03600000
DEBNMSUB DS    0CL1      NO. OF SUBR. LOADED BY OPEN                    03620000
DEBTCBAD DS    CL4       ADDRESS OF THE TCB FOR THIS DEB                03640000
DEBAMLNG DS    0CL1      NO. OF BYTES IN THE ACCESS MTHD. DPDT. SECTION 03660000
DEBDEBAB DS    CL4       ADDRESS OF THE PREVIOUS DEB IN THE SAME TASK   03680000
DEBOFLGS DS    0CL1      DATA SET STATUS FLAGS                          03700000
DEBIRBAD DS    CL4       IRB ADDRESS                                    03720000
DEBOPATB DS    0CL1      TYPE OF FILES                                  03740000
DEBSYSPG DS    CL4       ADDRESS OF FIRST IOB IN THE SYSTEM PURGE CHAIN 03760000
DEBNMEXT DS    0CL1      NUMBER OF EXTENTS SPECIFIED IN THE DSCB        03780000
DEBUSRPG DS    CL4       ADDRESS OF FIRST IOB IN THE USER PURGE CHAIN   03800000
DEBPRIOR DS    0CL1      ALWAYS ZERO                                    03820000
DEBECBAD DS    CL4       ECB ADDRESS FOR SVC PURGE REQUEST              03840000
DEBPROTG DS    0CL1      RESERVED FOR FUTURE USE (FIRST 4 BITS)         03860000
DEBDEBID DS    0CL1      HEX 'F' TO IDENTIFY THIS BLOCK AS A DEB        03880000
DEBDCBAD DS    CL4       ADDRESS OF THE DCB ASSOCIATED WITH THIS DEB    03900000
DEBEXSCL DS    0CL1      EXTENT SCALE                                   03920000
DEBAPPAD DS    CL4       ADDRESS OF I/O APPENDAGE VECTOR TABLE          03940000
DEBDVMOD DS    0CL1      DEVICE MODIFIER FILE MASK                      03960000
DEBUCBAD DS    CL4       ADDR OF UCB ASSOCIATED WITH THIS DATA EXTENT   03980000
DEBBINUM DS    CL2       RESERVED FOR FUTURE USE-ALWAYS ZERO            04000000
DEBSTRCC DS    CL2       STARTING CYLINDER NUMBER FOR EXTENT            04020000
DEBSTRHH DS    CL2       STARTING HEAD NUMBER FOR EXTENT                04040000
DEBENDCC DS    CL2       ENDING CYLINDER NUMBER FOR EXTENT              04060000
DEBENDHH DS    CL2       ENDING HEAD NUMBER FOR EXTENT                  04080000
DEBNMTRK DS    CL2       NUMBER OF TRACKS ALLOCATED TO A GIVEN EXTENT   04100000
DEBSUBID EQU   0         SUBROUTINE ID'S                                04120000
         END                                                            04140000
./  ADD  SSI=32360080,NAME=IGG019LA
 TITLE   'IGG019LA - BUILDS CHAN PGM FOR EXTENDED SEARCH, PRE-FORMAT'   00022002
IGG019LA CSECT                                                        * 00022402
*                                                                     * 00024002
*MODULE NAME - IGG019LA                                               * 00026002
*                                                                     * 00026402
*DESCRIPTIVE NAME - BDAM CHAN PGM MOD FOR EXTENDED SEARCH, WRITE ADD  * 00026802
*                                                                     * 00027202
*COPYRIGHT - NONE                                                     * 00027602
*                                                                     * 00027702
*CHANGE ACTIVITY                                                      * 00027802
*                                                                       00027902
*        RELEASE 20 DELETIONS/CHANGES                                   00044020
*000400                                                          S20201 00048020
*        RELEASE 21 DELETIONS/CHANGES                                   00054002
*                                                                YM3694 00056002
*        VS2 RELEASE 2                                                  00062002
*                                                                YM3029 00064002
*                                                                Y02072 00066002
*                                                                       00072002
*STATUS CHANGE LEVEL 002     13SEP72                                    00080001
*FUNCTION/OPERATION- THIS MODULE IS ENTERED TO CONSTRUCT THE CCWS     * 00100000
*   REQUIRED FOR A WRITE, TYPE DA, IF THE DCB INDICATES THE           * 00120000
*   EXTENDED SEARCH OPTION. THE CCWS UNIQUE TO EXTENDED SEARCH ARE    * 00140000
*   CONSTRUCTED BY THIS ROUTINE THEN A RETURN TO IGG019KO IS EXECUTED * 00160000
*   TO CONSTRUCT THE CCWS COMMON TO ANY WRITE TYPE DA (FORMAT F).     * 00180000
*                                                                     * 00200000
*ENTRY POINT- 'IGG019LA' IS ENTERED FROM MODULE IGG019KO BY THE       * 00220000
*   CALLING SEQUENCE,    L    15,4(IGG019KO BASE)                     * 00240000
*                        BALR 12,15                                   * 00260000
*                                                                     * 00280000
*INPUT- THE REGISTERS PASSED AS INPUT BY IGG019KO ARE,                * 00300000
*   4 - DCB ADDRESS                                                   * 00320000
*   5 - DECB ADDRESS                                                  * 00340000
*   6 - ADDRESS OF CCW1                                               * 00360000
*   7 - IOB ADDRESS                                                   * 00380000
*                                                                     * 00400000
*OUTPUT- THE CCWS 1 THRU 11 AND THE ADDRESS PORTION OF CCW 13 ARE     * 00420000
*   CONSTRUCTED FOLLOWING THE IOB. REGISTER 6 WILL BE POSITIONED TO   * 00440000
*   THE LOCATION OF CCW 12.                                           * 00460000
*                                                                     * 00480000
*EXTERNAL ROUTINES- N/A                                               * 00500000
*                                                                     * 00520000
*EXIT-NORMAL- 'EXIT' IS THE RETURN TO IGG019KO BY EXECUTING A BRANCH  * 00540000
*   ON REGISTER 12.                                                   * 00560000
*                                                                     * 00580000
*TABLES/WORK AREAS- N/A                                               * 00600000
*                                                                     * 00620000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.          * 00640000
*                                                                     * 00660000
*                                                                     * 00680000
         EJECT                                                          00700000
*                                                                       00720000
*                                                                       00740000
*  REGISTER USAGE                                                       00760000
*                                                                       00780000
*                                                                       00800000
         USING IGG019LA,EPREG                                           00820000
         USING IOBDEF,IOBREG                                            00840000
         USING IHADCB,DCBREG                                            00860000
*                                                                       00880000
*                                                                       00900000
WKREG    EQU   0         WORK REGISTER                                  00920000
PARAM    EQU   1         PARAMETER REGISTER                             00940000
WKREG2   EQU   2         WORK REGISTER                                  00960000
DEBREG   EQU   3         DEB ADDRESS                                    00980000
DCBREG   EQU   4         DCB ADDRESS                                    01000000
DECBREG  EQU   5         DECB ADDRESS                                   01020000
CCWIND   EQU   6         CCW INDEX                                      01040000
IOBREG   EQU   7         IOB ADDRESS                                    01060000
SECTOR   EQU   8         POINTER TO SECTOR STORE AREAS           S20201 01070020
INTRET   EQU   12        INTERNAL LINKAGE RETURN                        01080000
SAVE     EQU   13        USER'S SAVE AREA ADDRESS                       01100000
RETREG   EQU   14        RETURN TO FOUNDATION MODULE                    01120000
EPREG    EQU   15        ENTRY POINT/BASE                               01140000
*                                                                       01160000
NCCWC    EQU   X'36'                    COUNT FIELD OF TIC       YM3694 01170001
*                                                                       01180000
*                                                                       01200000
BEGIN    EQU   *                                                        01220000
         TM    IOBDCPND,YESCARN         IS RPS FEATURED          S20201 01221020
         BNO   NOTCARN                  NO, BUILD SCH-ID-EQ CCW  S20201 01222020
         L     SECTOR,IOBDCPND          GET SECTOR ADDR IF RPS   S20201 01223020
         LA    SECTOR,TWOBYTE(0,SECTOR) POINT TO SECTOR=0 BYTE   S20201 01224020
         ST    SECTOR,D0(CCWIND)        PUT PTR IN SET SECT CCW  S20201 01225020
         MVI   D0(CCWIND),SETSECT       PUT IN SET SECT COMMAND  S20201 01226020
         MVC   HALFCCW(HALFCCW,CCWIND),FLGCNT  FILL IN           S20201 01227020
*                                       FLAG/COUNT               S20201 01228020
         LA    CCWIND,FULLCCW(0,CCWIND) PT TO NEXT CCW           S20201 01229020
         BCTR  SECTOR,WKREG             RESTORE PTR TO SECTOR    S20201 01230020
         BCTR  SECTOR,WKREG              ADDR STORAGE AREAS      S20201 01231020
NOTCARN  EQU   *                                                 S20201 01232020
*                                                                       01233020
         LA    WKREG,IOBSEEK+3         CONSTRUCT SEARCH-ID-EQUAL CCW 1  01240000
         ST    WKREG,0(0,CCWIND)        (POSITION TO START OF TRACK)    01260000
         MVI   0(CCWIND),SCHIDOP                                        01280000
         ST    CCWIND,8(0,CCWIND)      INSERT TIC ADDRESS               01300000
         MVC   4(5,CCWIND),FLGCTTIC      (TIC TO CCW 1)                 01320000
*                                                                       01340000
         LA    WKREG,IOBDNRCF+2        CONSTRUCT READ-DATA CCW 3        01360000
         ST    WKREG,16(0,CCWIND)       (READ HIGHEST CCHHR ON TRACK    01380000
         MVI   16(CCWIND),RDDATAOP       FROM CAPACITY RECORD INTO IOB) 01400000
         MVI   20(CCWIND),CSFLG                                         01420000
         MVI   23(CCWIND),FIVE                                          01440000
*                                                                       01460000
         ST    WKREG,24(0,CCWIND)      CONSTRUCT SEARCH-ID-EQUAL CCW 4  01480000
         MVI   24(CCWIND),SCHIDOP       (TEST-CURRENT CCHHR LAST ON     01500000
         LA    WKREG,88(0,CCWIND)        THE TRACK)                     01520000
         ST    WKREG,32(0,CCWIND)      CONSTRUCT TIC CCW 5              01540000
         MVC   28(5,CCWIND),FLGCTTIC     (TIC TO CCW 12)                01560000
*                                                                       01580000
         LA    WKREG2,NCCWC(CCWIND)     CONSTRUCT SEARCH-KEY-    YM3694 01600001
*                                         EQUAL CCW 6. TIC HAS   YM3694 01610001
         MVI   0(WKREG2),X'FF'            KEY OF DUMMY RECORD    YM3694 01612001
         ST    WKREG2,40(0,CCWIND)      (TEST FOR DUMMY RECORD)  YM3694 01620001
         MVI   40(CCWIND),SCHKEYOP                                      01640000
         MVI   44(CCWIND),CSFLG                                         01660000
         MVI   47(CCWIND),1                                             01680000
*                                                                       01700000
         LA    WKREG,64(0,CCWIND)      CONSTRUCT TIC CCW 7              01720000
         ST    WKREG,48(0,CCWIND)       (TIC TO CCW 9)                  01740000
         MVI   48(CCWIND),TICOP                                         01760000
*                                                                       01780000
         LA    WKREG,104(0,CCWIND)     CONSTRUCT TIC CCW 8              01800000
         ST    WKREG,56(0,CCWIND)       (TIC TO CCW 14)                 01820000
         MVI   56(CCWIND),TICOP                                         01840000
*                                                                       01860000
         LA    WKREG,IOBUPLIM+3        CONSTRUCT SEARCH-ID-EQUAL (MT)   01880000
         ST    WKREG,64(0,CCWIND)       AS CCW9                         01900000
         MVI   64(CCWIND),MSCHIDOP      (CHECK END OF SEARCH LIMIT)     01920000
         LA    WKREG,16(0,CCWIND)      CONSTRUCT TIC CCW 10             01940000
         ST    WKREG,72(0,CCWIND)       (TIC TO CCW3)                   01960000
         MVC   68(5,CCWIND),FLGCTTIC                                    01980000
*                                                                       02000000
         MVI   80(CCWIND),NOP          CONSTRUCT NOP CCW 11             02020000
         MVI   84(CCWIND),SILI          (SEARCH LIMIT REACHED)          02040000
         MVI   87(CCWIND),1                                             02060000
*                                                                       02080000
         LA    WKREG,24(0,CCWIND)      STORE TIC ADDRESS IN CCW 13      02100000
         ST    WKREG,96(0,CCWIND)       (TIC TO CCW4)                   02120000
*                                                                       02140000
*                                                                       02160000
         LA    CCWIND,88(0,CCWIND)     INCREMENT TO THE LAST CCW        02180000
         L     EPREG,DCBDFOR           RELOAD PRE-FORMAT MODULE BASE    02200000
EXIT     BR    INTRET                  RETURN TO CONSTRUCT COMMON CCWS  02220000
*                                                                       02240000
*                                                                       02260000
DUMKEY   DC    X'FF'          DUMMY KEY (UNUSED RECORD) SEARCH ARGUMENT 02280000
FLGCTTIC DC    X'4000000508'  COMMAND CHAIN, COUNT OF FIVE, TIC OP-CODE 02300000
*                                                                       02301020
* CARNIVAL OPTION CONSTANTS                                             02302020
*                                                                       02303020
FLGCNT   DC    X'40000001'              FLAG/COUNT FIELD FOR RPS S20201 02304020
*                                                                       02305020
D0       EQU   0                        ZERO DISPLACEMENT        S20201 02306020
TWOBYTE  EQU   2                        TWO BYTE DISPLACEMENT    S20201 02307020
HALFCCW  EQU   4                        FOUR BYTE DISPLACEMENT   S20201 02308020
FULLCCW  EQU   8                        EIGHT BYTE DISPLACEMENT  S20201 02309020
*                                                                       02310020
SETSECT  EQU   X'23'                    SET SECTOR COMMAND CODE  S20201 02311020
YESCARN  EQU   X'FF'                   BYTE TO TEST FOR          S20201 02312020
*                                       ROTATIONAL               S20201 02313020
*                                      POSITION SENSING OTHER-          02314020
*                                      -WISE KNOWN AS RPS OR            02315020
*                                      RECORD READY                     02316020
*                                                                       02317020
*                                                                       02360000
TICOP    EQU   X'08'          TIC  OP-CODE                              02380000
SILI     EQU   X'20'          SUPPRESS INCORRECT LENGTH INDICATION      02400000
SCHIDOP  EQU   X'31'          SEARCH-ID-EQUAL OP-CODE                   02420000
MSCHIDOP EQU   X'B1'          MULTIPLE TRACK,SEARCH-ID-EQUAL OP-CODE    02440000
NOP      EQU   X'03'                                                    02460000
RDDATAOP EQU   X'06'          READ DATA OP-CODE                         02480000
CSFLG    EQU   X'60'          COMMAND CHAIN, SUPPRESS INCORRECT LENGTH  02500000
FIVE     EQU   X'05'          COUNT OF FIVE                             02520000
SCHKEYOP EQU   X'29'          SEARCH-KEY-EQUAL OP-CODE                  02540000
MODID    DC    C'IGG019LA'              MODULE ID                Y02072 02550002
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 02552002
         EJECT                                                          02560000
         DCBD  DSORG=DA                                                 02580000
*      I/O BLOCK (IOB) DEFINITION                                       02600000
*                                                                       02620000
*              STANDARD IOB                                             02640000
         DS    0F                                                       02660000
IOBDEF   DSECT                                                          02680000
IOBFLAG1 DS    CL1            STATUS FLAG                               02700000
IOBFLAG2 DS    CL1            ERROR FLAG                                02720000
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       02740000
IOBECBPT DS    CL4            ECB POINTER                               02760000
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       02780000
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           02800000
         DS    CL1                                                      02820000
         DS    CL3                                                      02840000
IOBCSWST DS    CL2            STATUS BYTES                              02860000
IOBCSWCT DS    CL2            REMAINING COUNT                           02880000
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   02900000
IOBSIOCC DS    CL1            SIO CONDITION CODE                        02920000
         DS    CL3                                                      02940000
IOBDCBPT DS    0CL4           DCB POINTER                               02960000
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            02980000
         DS    CL3                                                      03000000
IOBRESTR DS    0CL4           RESTART POINTER                           03020000
         DS    CL1                                                      03040000
         DS    CL3                                                      03060000
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              03080000
IOBERRCT DS    CL2            ERROR COUNTER                             03100000
IOBSEEK  DS    CL8            SEEK ADDRESS                              03120000
*        BDAM EXTENDED IOB                                              03140000
*                                                                       03160000
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  03180000
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          03200000
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     03220000
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                03240000
         DS    CL3                                                      03260000
IOBDTYPE DS    CL2            TYPE FIELD                                03280000
IOBDSTAT DS    CL2            IOB STATUS                                03300000
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        03320000
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                03340000
         DS    CL2                                                      03360000
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               03380000
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        03400000
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                03420000
IOBCP    DS    CL8            FIRST CCW IN CHANNEL PROGRAM              03440000
         END                                                            03460000
./  ADD  SSI=32050025,NAME=IGG019LC
         TITLE 'IGG019LC - BDAM END OF EXTENT APPENDAGE'                00020000
IGG019LC CSECT                                                          00040000
*MODULE NAME = IGG019LC                                               * 00042002
*                                                                     * 00044002
*DESCRIPTIVE NAME = BDAM END OF EXTENT APPENDAGE                      * 00046002
*                                                                     * 00048002
*COPYRIGHT = NONE                                                     * 00048402
*                                                                     * 00048802
*CHANGE ACTIVITY                                                      * 00049202
*                                                                     * 00049602
*        OS REL 21 CHANGES/DELETIONS                                    00049702
*7030024000-024200                                               M0174  00050021
*        VS1-1 CHANGES/DELETIONS                                        00052002
*        VS2-1 CHANGES/DELETIONS                                        00054002
*        VS1-2 CHANGES/DELETIONS                                        00056002
*                                                               XA00088 00056402
*        VS2-2 CHANGES/DELETIONS                                        00058002
*035200-043400                                                   Y02072 00058402
*                                                                YM1397 00058502
*                                                                       00058802
*STATUS LEVEL - VS2-2 LEVEL 0                                         * 00059202
*                                                                     * 00060000
*                                                                     * 00080000
*FUNCTION/OPERATION- THIS MODULE CONTAINS THE BDAM END OF EXTENT IOS  * 00100000
*   APPENDAGE.THIS MODULE IS REQUIRED IF THE DCB SPECIFIES THAT THE   * 00120000
*   EXTENDED SEARCH OPTION IS DESIRED. THIS MODULE IS ENTERED BY IOS  * 00140000
*   WHEN IOS DETERMINES THAT A CHANNEL PROGRAM,IN THE COURSE OF A     * 00160000
*   SEARCH,IS ABOUT TO LEAVE THE CURRENT EXTENT.THIS MODULE IS ALSO   * 00180000
*   USED BY IGG019KY WHEN THE ADDRESS OF THE NEXT TRACK TO BE EXAMINED* 00200000
*   BY THE SELF-FORMAT ROUTINE IS NOT WITHIN THE CURRENT EXTENT.      * 00220000
*   THIS ROUTINE OBTAINS THE STARTING ADDRESS IN THE NEXT EXTENT ,AND * 00240000
*   CHECKS THIS ADDRESS TO DETERMINE IF IT IS WITHIN THE SEARCH       * 00260000
*   LIMITS.                                                           * 00280000
*                                                                     * 00300000
*ENTRY POINT- 'EEAENTRY' IS THE NORMAL ENTRY POINT FROM IOS WITH A    * 00320000
*   CALLING SEQUENCE,   L     15,0(APPENDAGE LIST)                    * 00340000
*                       BALR  14,15                                   * 00360000
*                                                                     * 00380000
*   'SFMENTRY' IS THE ENTRY POINT FROM THE SELF FORMAT MODULE WITH A  * 00400000
*   CALLING SEQUENCE,   L     15,0(APPENDAGE LIST)                    * 00420000
*                       L     12,RETURN ADDR                          * 00440000
*                       BC    15,4(15)                                * 00460000
*                                                                     * 00480000
*INPUT- TO 'EEAENTRY' THE FOLLOWING REGISTERS ARE USED AS POSITIONED  * 00500000
*   BY IOS,                                                           * 00520000
*   1- ADDRESS OF IOS QUEUING ELEMENT FOR THIS I/O REQUEST            * 00540000
*   2- ADDRESS OF THE IOB ASSOCIATED WITH THIS I/O REQUEST            * 00560000
*   3- ADDRESS OF THE DEB ASSOCIATED WITH THIS DATA SET               * 00580000
*   6- ADDRESS OF THAT FIELD IN IOSB CONTAINING UCBSEEK INFO    Y02072* 00590002
*   7- ADDRESS OF THE UCB ASSOCIATED WITH THE CURRENT EXTENT          * 00600000
*  13- ADDRESS OF IOS REGISTER SAVEAREA                         Y02072* 00610002
*  14- RETURN (NORMAL) TO IOS                                         * 00620002
*  15- ENTRY POINT IN THIS MODULE                                     * 00640002
*                                                                     * 00660000
*   TO 'SFMENTRY' THE FOLLOWING REGISTERS ARE USED AS POSITIONED BY   * 00680000
*   'IGG019KY'                                                        * 00700000
*   1- ADDRESS OF THE IOB ASSOCIATED WITH THIS I/O REQUEST            * 00720000
*  12- RETURN TO SELF-FORMAT MODULE                                   * 00740002
*  14- ADDRESS  OF THE DEB ASSOCIATED WITH THIS DATA SET              * 00760002
*  15- ADDRESS OF THIS MODULE                                         * 00780002
*                                                                     * 00800000
*OUTPUT- IF THE LIMIT OF THE SEARCH HAS NOT BEEN REACHED THIS MODULE  * 00820000
*   CAUSES THE SEARCH TO BE RESTARTED AT THE START OF THE NEXT EXTENT.* 00840000
*   IF THE LIMIT HAS BEEN REACHED THE PROPER ERROR FLAG IS SET.       * 00860000
*                                                                     * 00880000
*EXTERNAL ROUTINES- N/A                                               * 00900000
*                                                                     * 00920000
*EXIT-NORMAL-'EXITA' IS THE POINT AT WHICH AN 'EXCP' IS GIVEN AND A   * 00940000
*   RETURN TO SUPERVISOR EFFECTED BY USE OF THE 'EXIT' SVC .          * 00960000
*   'CLRENTR1' IS A RETURN TO THE IOS IGNORE OFFSET WHICH CAUSES THE  * 00980000
*   ABNORMAL END APPENDAGE TO BE ENTRED.                              * 01000000
*   'EXITB' IS A RETURN TO THE IOS EXCP RETURN OFFSET                 * 01020000
*                                                                     * 01040000
*EXIT-ERROR- 'EXITC' IS A RETURN TO THE IOS IGNORE OFFSET WHICH CAUSES* 01060000
*   THE ABNORMAL END APPENDAGE TO BE ENTERED-THIS EXIT IS TAKEN IF THE* 01080000
*   SEARCH LIMIT IS REACHED AND THE REQUEST WAS NOT FOR A WRITE-ADD   * 01100000
*   'EXITD' IS A RETURN TO THE IOS IGNORE OFFSET-THIS EXIT IS TAKEN IF* 01120000
*   THE SEARCH LIMIT IS REACHED ON A WRITE ADD PRE-FORMAT REQUEST     * 01140000
*   'EXITE' IS A RETURN TO THE SELF FORMAT MODULE-THIS EXIT IS TAKEN  * 01160000
*   IF THE SEARCH LIMIT IS REACHED AND ENTRY WAS AT 'SFMENTRY'        * 01180000
*                                                                     * 01200000
*TABLES/WORK AREAS- N/A                                               * 01220000
*                                                                     * 01240000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT, ENABLED AND PRIVILEGED (WHEN  * 01260002
*   FUNCTIONING AS AN APPENDAGE).AS AN APPENDAGE IT IS ENTERED IN KEY0* 01270002
*   WITH THE LOCAL LOCK HELD.  IN THIS CASE A MODESET IS ISSUED       * 01272002
*   TO DO ALL PROCESSING IN USER KEY.  WHEN BRANCHED TO BY THE        * 01274002
*   SELF-FORMAT MODULE PROCESSING IS IN PROBLEM PROG STATE,USER KEY.  * 01276002
*                                                                     * 01300000
*NOTE- THIS ROUTINE RELIES ON THE REGISTER USAGE OF IOS.              * 01320000
*                                                                     * 01340000
*                                                                     * 01360000
*                                                                     * 01380000
*   REGISTER USAGE                                                    * 01400000
*                                                                     * 01420000
         USING IGG019LC,BASER                                           01440000
         USING IOBSTDRD,IOBRR                                    Y02072 01460002
         USING DEBDEF,DEBR                                              01480000
*                                                                     * 01500000
*                                                                     * 01520000
*   REGISTER EQUATES                                                  * 01540000
*                                                                     * 01560000
R0       EQU   0                        PARAMETER REGISTER       Y02072 01570002
RQER     EQU   1                        RQE ADDRESS              Y02072 01580002
IOBRR    EQU   2                        IOB ADDRESS              Y02072 01600002
DEBR     EQU   3                        DEB ADDRESS                     01620002
R5       EQU   5                        WORKREG FOR MODESET      Y02072 01622002
IOSEEKR  EQU   6                        IOSB UCBSEEK ADDR        Y02072 01630002
UCBR     EQU   7                        UCB ADDRESS                     01640002
INTDEBR  EQU   8                        SELF FORMAT DEB REGISTER        01660002
WRKR4    EQU   9                        WORKING REGISTER                01680002
WRKR1    EQU   10                       WORKING REGISTER                01700002
WRKR2    EQU   11                       WORKING REGISTER                01720002
WRKR3    EQU   12                       WORKING REGISTER                01770002
INTIOBR  EQU   12                       WORKING REGISTER                01820002
INTDCBR  EQU   13                       SELF FORMAT DCB REGISTER        01822002
SAVER    EQU   13                       ADDR OF IOS SAVEAREA     Y02072 01824002
RETNR    EQU   14                       RETURN TO IOS                   01826002
BASER    EQU   15                       BASE REGISTER FOR THIS MODULE   01828002
R15      EQU   15                       SAVE/RESTORE REG         Y02072 01828402
*                                                                     * 01840000
*                                                                     * 01860000
*                                                                     * 01880000
EEAENTRY EQU   *                        END OF EXTENT APPENDAGE ENTRY   01900002
         USING RQE,RQER                 ESTABLISH BASE FOR RQE   Y02072 01910002
         B     ECBCHK                   BRANCH TO MAIN FLOW      Y02072 01920002
SFMENTRY EQU   *                        SELF-FORMAT MODULE ENTRY POINT  01940002
         LR    DEBR,INTDEBR             SET UP DEB REGISTER             01960002
         LR    IOBRR,INTIOBR            SET UP IOB REGISTER      Y02072 01980002
         B     TSTEXTNO                 BR AROUND ECB PTR CHK    Y02072 01990002
*********************************************************************** 01992002
*  THE FOLLOWING CODE IS ALWAYS EXECUTED UPON ENTRY TO THE APPENDAGE. * 01994002
*  IF DYNAMIC BUFFERING OR EXCLUSIVE CNTRL WERE REQUESTED,ITS POSSIBLE* 01996002
*  THAT THIS IOB HAD TO WAIT FOR A BUFFER OR BLK.  IF SO, USER'S DECB * 01998002
*  ADDRESS HAS BEEN SAVED IN THE IOBDQPTR FIELD IN THE IOB BEFORE     * 01998402
*  THE SECOND EXCP WAS ISSUED AGAINST THIS IOB IN THE DYN BUF RTN OR  * 01998802
*  IGC0005C.  THIS WAS NECESSARY TO PREVENT THE PROCESSING OF THE     * 01999202
*  SECOND EXCP FROM OVERLAYING ANY CHANGE IN THE STATUS OF THE ECB.   * 01999602
*********************************************************************** 01999702
ECBCHK   EQU   *                        CHECK DECB ADDR          Y02072 01999802
         STM   R0,R15,0(SAVER)          SAVE IOS REGISTERS       Y02072 01999902
         SR    INTDEBR,INTDEBR          ZERO FOR EOE ENTRY       Y02072 02002102
*                                                                       02006802
         MODESET  KEYADDR=RQEPRT,WORKREG=5   CHANGE TO USER KEY  Y02072 02009002
*                                                                       02011202
         L     WRKR2,IOBECBPT           GET ADDR IN IOB FOR DECB Y02072 02013402
         LA    WRKR2,0(WRKR2)           CLEAR OUT TOP BYTE       Y02072 02015602
         LA    WRKR3,IOBCSW+3           GET ADDR OF IOBCSW WORD  Y02072 02017802
         CR    WRKR2,WRKR3              DOES IOBECBPT PT TO CSW  Y02072 02020002
         BNE   TSTEXTNO                 IF NOT, DECB PTR OK      Y02072 02021902
         L     WRKR2,IOBDQPTR           ELSE,GET REAL DECB PTR   Y02072 02023902
         STCM  WRKR2,ADDR,IOBECBPB      STORE IT IN LOW 3 BYTES  Y02072 02025902
         XC    IOBDQPTR,IOBDQPTR        CLEAR IOB FIELD          Y02072 02026302
*********************************************************************** 02026402
TSTEXTNO EQU   *                                                        02026602
         SR    WRKR3,WRKR3             CLEAR REGISTER AND               02033302
         IC    WRKR3,IOBSEEK           LOAD CURRENT EXTENT NUMBER       02040000
         LA    WRKR1,1(0,WRKR3)        ADJUST EXTENT NUMBER             02060000
         SR    WRKR2,WRKR2             CLEAR REGISTER                   02080000
         IC    WRKR2,DEBNMEXT          AND PICK UP NO. OF EXTENTS       02100000
         CR    WRKR1,WRKR2             IS THIS THE LAST EXTENT          02120000
         BNE   NEXTEXTT                NO-WORK WITH NEXT EXTENT         02140000
         SR    WRKR1,WRKR1             YES-USE FIRST EXTENT             02160000
NEXTEXTT EQU   *                                                        02180000
         STC   WRKR1,IOBSEEK           STORE NEW EXTENT NO IN IOBSEEK   02200000
         STC   WRKR1,IOBDNCRF+DISPR    AND IN FEEDBACK FIELD    XA00088 02210002
         SLL   WRKR1,4                 MULT EXTENT NO. BY 16            02220000
         LA    WRKR2,DEBDVMOD(WRKR1)   LOAD ADDRESS OF EXTENT           02240000
         USING DEBDVMOD,WRKR2                                    M0174  02250021
         MVC   IOBSEEK+1(6),4(WRKR2)   MOVE REST OF IOBSEEK FIELD       02260000
TSTUPLIM EQU   *                                                        02280000
         CLC   IOBUPLIM(1),IOBSEEK     IS LIMIT IN THIS EXTENT          02300000
         BE    MOVEZERO                YES-TAKE BRANCH                  02320000
TSTENTRY EQU   *                       NO-WAS ENTRY MADE FROM IOS       02340000
         CR    DEBR,INTDEBR            END OF EXTENT APPENDAGE          02360000
         BE    EXITA                   NO- TAKE BRANCH                  02380000
         L     WRKR3,DEBUCBAD          GET UCB ADDR FOR THIS EXT  M0174 02390002
         LA    WRKR3,0(WRKR3)          CLEAR HI-ORDER BYTE        M0174 02400002
         CR    UCBR,WRKR3              IS DEVICE SAME AS BEFORE?  M0174 02410002
         DROP  WRKR2                                              M0174 02420002
         BNE   NEWEXCP                  NO-TAKE BRANCH                  02440002
EXITB    EQU   *                        REISSUE THE EXCP                02480002
*                                                                       02490002
         MODESET  KEYADDR=IOSKEY,WORKREG=5  RETURN TO IOSKEY     Y02072 02492002
*                                                                       02494002
         MVC   0(L'IOBSEEK,IOSEEKR),IOBSEEK  MOVE NEW SEEK ADDR  YM1397 02494402
*                                       INTO IOSB PASSED BY IOS  Y02072 02494802
         LM    R0,R15,0(SAVER)          RESTORE IOS REGISTERS    Y02072 02496002
         B     EXCPRETN(RETNR)          RETURN TO EXCP OFFSET           02500002
NEWEXCP  EQU   *                                                        02520000
         OI    IOBDSTAT,EXCPBIT         SET EXCP BIT IN DSTAT           02540002
CLRENTR1 EQU   *                                                        02560000
*                                                                       02570002
         MODESET  KEYADDR=IOSKEY,WORKREG=5  RETURN TO IOSKEY     Y02072 02572002
*                                                                       02574002
         LM    R0,R15,0(SAVER)          RESTORE IOS REGISTERS    Y02072 02576002
         BR    RETNR                   RETURN-THEN ENTER ABNL. END APP. 02580000
MOVEZERO EQU   *                                                        02600000
         MVI   IOBUPLIM+7,ZERO         ZERO R BYTE OF IOBUPLIM          02620000
         CLC   IOBUPLIM(8),IOBSEEK     DOES IOBSEEK EQUAL IOBUPLIM      02640000
         BNE   TSTENTRY                NO-TAKE BRANCH                   02660000
*                                      YES-CONTINUE                     02680000
         TM    IOBDTYP2,IOBADDTY       IS THIS A WRITE ADD       Y02072 02700002
         BO    NOSPACE                 YES-TAKE BRANCH                  02720000
EXITC    EQU   *                       ERROR, NO REC FOUND       Y02072 02730002
         OI    IOBSTAT2,NOREC          NO-SET NO RECORD FOUND    Y02072 02740002
         B     CLRENTR1                IN EXCEPTION CODE AND RET Y02072 02780002
NOSPACE  OI    IOBSTAT2,NOSPA          SET NO SPACE FOUND BIT IN Y02072 02800002
*                                      EXCEPTION CODE                   02820000
         CR    DEBR,INTDEBR            WAS ENTRY MADE FROM IOS END OF   02840000
*                                      EXTENT APPENDAGE                 02860000
EXITD    EQU   *                                                        02880000
         BNE   CLRENTR1                YES-RETURN                Y02072 02900002
         L     WRKR1,DCBDFOR(0,INTDCBR) NO-RESET THE BASE OF THE        02920000
*                                       SELF FORMAT MODULE              02940000
         LR    INTIOBR,IOBRR           RESTORE THE IOB TO REG    Y02072 02960002
EXITE    EQU   *                                                        02980000
         B     4(0,RETNR)              AND RETURN TO IT                 03000000
EXITA    EQU   *                       SAVE THE CONTENTS OF             03020000
         L     WRKR1,DCBDFOR(0,INTDCBR) RESTORE SELF FORMAT BASE        03040000
         LR    INTIOBR,IOBRR           RESTORE IOB ADDR TO REG   Y02072 03060002
         BR    RETNR                   ROUTINE AND RETURN TO IT         03080000
*                                                                       03140000
*                                                                       03150002
*                    CONSTANTS  AND  EQUATES                            03152002
*                                                                       03160002
*                                                                       03180000
ENTRY1   EQU   X'20'                   ENTRY 1 BIT MASK FOR DSTAT       03200000
EXTSN    EQU   16                      SIZE OF NORMAL EXTENT FOR D. A.  03220000
UCBSEEK  EQU   48                      SEEK ADDRESS OFFSET IN UCB       03240000
TYPCD    EQU   19                      DEVICE TYPE OFFSET IN UCB        03260000
EXCPRETN EQU   8                       OFFSET FOR EXCP RETURN           03280000
EXCPBIT  EQU   X'40'                   EXCP BIT MASK FOR DSTAT          03300000
ZERO     EQU   0                                                        03320000
ADDBIT   EQU   X'02'                                                    03340000
NOREC    EQU   X'80'                   NO RECORD FOUND EXCEPTION CODE   03360000
DISPR    EQU   7                       OFFSET WHERE EXTENT      XA00088 03370002
*                                      IS SAVED FOR FEEDBACK    XA00088 03372002
NOSPA    EQU   X'20'                   NO SPACE  FOUND EXCEPTION CODE   03380000
DCBDFOR  EQU   92                      OFFSET OF SELF-FORMAT MODULE     03400000
DCBDEBAD EQU   44                      OFFSET OF DEB ADDRESS IN DCB     03420000
DEVMASK  EQU   X'0F'                   MASK FOR ISOLATING DEVICE TYPE   03440000
FIRST    EQU   X'10'                   FIRST PASS BIT MASK FOR DSTAT    03460000
EXIT     EQU   3                       EXIT SVC                         03480000
ADDR     EQU   B'0111'                 MASK FOR STCM TO ST LOW   Y02072 03482002
*                                      ORDER 3 BYTES OF REGISTER Y02072 03484002
*                                                                       03486002
IOSKEY   DC    X'00'                   IOS KEY                   Y02072 03490002
PATCH    DC    XL50'0'                 PATCH AREA                Y02072 03492002
         EJECT                                                          03500000
*********************************************************************** 03510002
*                           DSECTS                                    * 03520002
*********************************************************************** 03530002
         IEZIOB                                                  Y02072 03550002
*                                                                       03560002
*                                                                       03570002
         ORG   IOBRSV35                                          Y02072 03580002
IOBUPLIM DS    CL8                      MBBCCHHR OF UPPER LIMIT  Y02072 03590002
*                                       COUNT DURING EXT SEARCH  Y02072 03592002
         EJECT                                                          03600002
         IECDRQE                                                 Y02072 03650002
         EJECT                                                          04360000
*                                                                       04380000
*      DATA EXTENT BLOCK (DEB) DEFINITION                               04400000
*                                                                       04420000
DEBDEF   DSECT                                                          04440000
DEBNMSUB DS    0CL1      NO. OF SUBR. LOADED BY OPEN                    04460000
DEBTCBAD DS    CL4       ADDRESS OF THE TCB FOR THIS DEB                04480000
DEBAMLNG DS    0CL1      NO. OF BYTES IN THE ACCESS MTHD. DPDT. SECTION 04500000
DEBDEBAB DS    CL4       ADDRESS OF THE PREVIOUS DEB IN THE SAME TASK   04520000
DEBOFLGS DS    0CL1      DATA SET STATUS FLAGS                          04540000
DEBIRBAD DS    CL4       IRB ADDRESS                                    04560000
DEBOPATB DS    0CL1      TYPE OF FILES                                  04580000
DEBSYSPG DS    CL4       ADDRESS OF FIRST IOB IN THE SYSTEM PURGE CHAIN 04600000
DEBNMEXT DS    0CL1      NUMBER OF EXTENTS SPECIFIED IN THE DSCB        04620000
DEBUSRPG DS    CL4       ADDRESS OF FIRST IOB IN THE USER PURGE CHAIN   04640000
DEBPRIOR DS    0CL1      ALWAYS ZERO                                    04660000
DEBECBAD DS    CL4       ECB ADDRESS FOR SVC PURGE REQUEST              04680000
DEBPROTG DS    0CL1      RESERVED FOR FUTURE USE (FIRST 4 BITS)         04700000
DEBDEBID DS    0CL1      HEX 'F' TO IDENTIFY THIS BLOCK AS A DEB        04720000
DEBDCBAD DS    CL4       ADDRESS OF THE DCB ASSOCIATED WITH THIS DEB    04740000
DEBEXSCL DS    0CL1      EXTENT SCALE                                   04760000
DEBAPPAD DS    CL4       ADDRESS OF I/O APPENDAGE VECTOR TABLE          04780000
DEBDVMOD DS    0CL1      DEVICE MODIFIER FILE MASK                      04800000
DEBUCBAD DS    CL4       ADDR OF UCB ASSOCIATED WITH THIS DATA EXTENT   04820000
DEBBINUM DS    CL2       RESERVED FOR FUTURE USE-ALWAYS ZERO            04840000
DEBSTRCC DS    CL2       STARTING CYLINDER NUMBER FOR EXTENT            04860000
DEBSTRHH DS    CL2       STARTING HEAD NUMBER FOR EXTENT                04880000
DEBENDCC DS    CL2       ENDING CYLINDER NUMBER FOR EXTENT              04900000
DEBENDHH DS    CL2       ENDING HEAD NUMBER FOR EXTENT                  04920000
DEBNMTRK DS    CL2       NUMBER OF TRACKS ALLOCATED TO A GIVEN EXTENT   04940000
DEBSUBID EQU   0         SUBROUTINE ID'S                                04960000
         END                                                            04980000
./  ADD  SSI=62010236,NAME=IGG019LE
 TITLE 'IGG019LE -- DYNAMIC BUFFERING MODULE && START-I/O APPENDAGE'    00200021
IGG019LE CSECT                                                          00600021
*MODULE NAME - IGG019LE                                               * 00650002
*                                                                     * 00700002
*DESCRIPTIVE NAME - DYN BUF MODULE & SIO APPENDAGE,REAL ADDRESS SPACE * 00750003
*                                                                     * 00850002
*COPYRIGHT - NONE                                                     * 00860002
*                                                                     * 00870002
*CHANGE ACTIVITY                                                      * 00880002
*                                                                     * 00890002
*           OS REL 21 CHANGES/DELETIONS                                 00900002
*                                                                A44114 00950001
*0153                                                            M1780  01050001
*           VS1-1 CHANGES/DELETIONS                                     01060002
*           VS2-1 CHANGES/DELETIONS                                     01070002
*           VS1-2 CHANGES/DELETIONS                                     01080002
*           VS2-2 CHANGES/DELETIONS                                     01090002
*015500,198000,206000-208000,218500-219500,286000,322000,610500-612500, 01092002
*634500-636500,642500-656500,694500-706000,732500-738000,745000-745980, 01094002
*756500-757500,768000-776000,784500-790000                       Y02072 01096002
*                                                               VS05316 01096402
*                                                                     * 01098002
*           VS2-3.6 CHANGES/DELETIONS                                 * 01098403
*A229520-230420,272100-272300,372120-372924,606024-606180      @ZA08000 01098803
*A793340-793440,744520,745520                                  @ZA08000 01099203
*STATUS CHANGE LEVEL 006                                              * 01100002
*                                                                     * 01150002
*********************************************************************** 01160002
*THIS MODULE WAS TOTALLY REPLACED IN R-21 AS A RESULT OF A30797.  IT    01200001
*INCORPORATES IGG019KS WHICH NO LONGER EXISTS AS OF R-21.  TWO SEPARATE 01250001
*FUNCTIONS EXIST IN THE MODULE: SIO APPENDAGE FUNCTION AND FREEDBUF     01300001
*FUNCTION.  TWO SEPARATE FUNCTIONAL DESCRIPTIONS EXIST, ONE UNDER       01350001
*SIORTNE AND THE OTHER UNDER FBUFRTNE.  ALL EQUATES ARE IN 1ST ROUTINE. 01400001
*                                                                       01450001
*                                                                       01500001
*********************************************************************** 01550002
         USING *,RAPDBASE                                               04200021
SIOEP    B     SIORTNE            START I/O APPENDAGE E.P.              04400021
         ORG   IGG019LE+8         SET F.D.BUFF. ENTRY POINT             04650001
FRBUFEP  B     FBUFRTNE           FREE DYNAMIC BUFFER SVC E.P.          04800021
*                                                                       04850002
*********************************************************************** 04900002
*  THE FOLLOWING TWO ENTRY POINTS ARE USED FOR PROCESSING OF THE      * 04950002
*  FREEDBUF ESTAE ROUTINE, IGCT005G.  THE FIRST ENTRY POINT (+12) IS  * 04960002
*  USED WHEN, IN THE ESTAE CLEANUP ROUTINE, IT IS DETERMINED THAT THE * 04970002
*  AUDIT TRAIL BIT INDICATING THAT THE NEXT IOB HAD BEEN TAKEN FROM   * 04980002
*  THE IOB QUEUE BUT THE CHANNEL PGM HAD NOT BEEN INITIALIZED YET     * 04990002
*  (WKAIOBQ BIT IS ON). IN THIS CASE ENTRY IS MADE TO INITIALIZE      * 04992002
*  THE CHANNEL PROGRAM AND ISSUE THE EXCP FOR THIS REQUEST.           * 04994002
*         THE SECOND ENTRY POINT (+16) IS USED WHEN THE NEXT IOB HAS  * 04996002
*  BEEN REMOVED FROM THE QUEUE, ITS CHANNEL PGM INITIALIZED, BUT THE  * 04998002
*  ABEND OCCURRED BEFORE THE EXCP WAS ISSUED (WKABUFAS BIT ON).IN THIS* 04998402
*  CASE ENTRY IS MADE TO ISSUE THE EXCP FOR THIS REQUEST.             * 04998802
*          INPUT FOR BOTH ENTRIES IS THE SAME:                        * 04999202
*                   REGISTER 2 = NEXT IOB ADDRESS                     * 04999602
*                   REGISTER 3 = BEGINNING ADDRESS OF THIS MODULE     * 04999702
*                   REGISTER 4 = DCB ADDRESS                          * 04999802
*                   REGISTER 5 = SVRB ADDRESS                         * 04999902
*                   REGISTER 6 = BUFFER ADDRESS                       * 05009902
*                   REGISTER 8 = TCB ADDRESS                          * 05049902
*                   REGISTER 15= BEGINNING ADDRESS OF THIS MODULE     * 05059902
*                   WKAREG14 IN SVRB WORKAREA IN INITIALIZED TO       * 05069902
*                                RETURN ADDRESS IN ESTAE              * 05079902
*  A THIRD ENTRY INTO THIS MODULE IS TAKEN BY ESTAE, IGCT005G, IF NO  * 05089902
*  AUDIT TRAIL BITS ARE SET AT ALL.  IN THIS CASE ENTRY IS THE SAME   * 05091902
*  AS FOR FREEDBUF (+8).  INPUT IS LIKEWISE THE SAME.                 * 05093902
*********************************************************************** 05095902
ESTENT1  B     ESTENTA                  INIT CH PGM, ISSUE EXCP  Y02072 05097902
*                                                                       05098302
ESTENT2  B     ESTENTB                  ISSUE EXCP               Y02072 05098702
*********************************************************************** 05099102
*                                                                     * 05099902
* FUNCTION:                                                           * 05400021
*    THE START-I/O APPENDAGE ATTEMPTS TO ASSIGN A BUFFER TO A         * 05600021
*    READ REQUEST IF THE REQUEST SPECIFIES DYNAMIC BUFFERING AND      * 05800021
*    NO BUFFER WAS ASSIGNED BEFORE EXCP.  IF A BUFFER IS              * 06000021
*    AVAILABLE FOR ASSIGNMENT, IT IS REMOVED FROM THE BUFFER          * 06200021
*    POOL AND THE BUFFER CHAIN IS UPDATED.  THE BUFFER ADDRESS        * 06400021
*    IS PLACED IN THE REQUEST'S DECB AND IN THE READ CCWS OF THE      * 06600021
*    REQUEST'S CHANNEL PROGRAM.  THE ROUTINE THEN RETURNS TO IOS      * 06800021
*    TO INITIATE THE I/O.                                             * 07000021
*    IF NO BUFFER IS AVAILABLE THE REQUEST IS PLACED ON A QUEUE       * 07200021
*    OF REQUESTS WAITING FOR BUFFERS.  THE ROUTINE TAKES THE IOS      * 07400021
*    RETURN WHICH INDICATES THAT THE I/O REQUEST SHOULD NOT BE        * 07600021
*    INITIATED.                                                       * 07800021
*                                                                     * 08000021
* ENTRY POINT:                                                        * 08200021
*         SIOEP -- ENTERED ASYNCHRONOUSLY FROM IOS AT START-I/O       * 08400021
*         TIME.  THE ADDRESS OF IGG019LE IS PLACED IN THE             * 08600021
*         APPENDAGE VECTOR TABLE (AVT) DURING OPEN PROCESSING.        * 08800021
*         CALLING SEQUENCE -- L     15,4(AVTPTR)                      * 09000021
*                             BALR  14,15                             * 09200021
*                                                                     * 09400021
* INPUT                                                               * 09600021
*    **** REGISTER CONTENTS ****                                      * 09800021
*    REGISTER  1 -- REQUEST ELEMENT QUEUE (RQE) ADDRESS               * 09850002
*    REGISTER  2 -- INPUT/OUTPUT BLOCK (IOB) ADDRESS                  * 10000021
*    REGISTER  3 -- DATA EXTENT BLOCK (DEB) ADDRESS                   * 10200021
*    REGISTER  4 -- DATA CONTROL BLOCK (DCB) ADDRESS                  * 10400021
*    REGISTER  7 -- UNIT CONTROL BLOCK (UCB) ADDRESS                  * 10600021
*    REGISTER 13 -- IOS SAVEAREA ADDRESS                        Y02072* 10650002
*    REGISTER 14 -- RETURN ADDRESS                                    * 10800021
*    REGISTER 15 -- ADDRESS OF IGG019LE                               * 11000021
*                                                                     * 11200021
* OUTPUT                                                              * 11400021
*    **** REGISTER CONTENTS ****                                      * 11600021
*    ALL REGISTER CONTENTS ARE RESTORED BEFORE RETURN TO IOS.         * 11800002
*                                                                     * 12800021
*    **** DATA AREAS SET BY THIS ROUTINE ****                         * 13000021
*    IOBDSTAT BIT IOBBUFF    SET IF A BUFFER IS ASSIGNED              * 13200021
*    IOBDQPTR FIELD OF IOB POINTED TO BY BCBFRQB,  OR                 * 13400021
*    BCBFRQT            UPDATED TO POINT TO THIS IOB IF REQUEST       * 13600021
*                       MUST WAIT FOR A BUFFER                        * 13800021
*    BCBFRQB            UPDATED TO POINT TO THIS IOB IF REQUEST       * 14000021
*                       MUST WAIT FOR A BUFFER                        * 14200021
*    BCBNABFR           UPDATED IF A BUFFER IS ASSIGNED.              * 14400021
*    DECAREA            DATA ADDR IN THE ASSIGNED BUFFER              * 14600021
*    DECKYADR           KEY ADDR IN THE ASSIGNED BUFFER FOR A READ    * 14800021
*                       BY BLOCK ID, & KEY ADDR SPECIFIED 'S'.        * 15000021
*    CCW3 ADDR          KEY ADDR,FOR NON-RPS CHANNEL PROGRAMS WHEN    * 15200021
*                       KEY IS IN DYNAMIC BUFFER (SEE DECKYADR).      * 15400021
*    CCW4 ADDR          KEY ADDR FOR RPS CHANNEL PROGRAMS, AS ABOVE   * 15600021
*    NEXT-TO-LAST CCW ADDR -- DATA ADDR FOR TRACK-OVERFLOW PROGRAMS   * 15800021
*    LAST CCW ADDR      DATA ADDR FOR NON-TRACK-OVERFLOW PROGRAMS     * 16000021
*                                                                     * 16200021
* EXITS                                                               * 16400021
*         0(R14)        RETURN TO IOS & START I/O                     * 16600021
*         4(R14)        RETURN TO IOS & DISREGARD I/O REQUEST         * 16800021
*                                                                     * 17000021
* ATTRIBUTES -- REENTRANT,PRIVILEGED,KEY=0,ENABLED, WITH THE LOCAL    * 17200002
*    LOCK HELD. A MODESET WILL BE ISSUED TO PROCESS IN USER KEY.      * 17250002
*                                                                     * 17400021
         EJECT                                                          17450002
         IEZBITS                                                        17600021
*                  REGISTER EQUATES                                     17800021
R0       EQU   0        INPUT REGISTER 0    SVC                         18000021
RWORK0   EQU   0        WORKREG TO SAVE DATA                     YM5316 18050002
R1       EQU   1        INPUT REGISTER 1                                18200021
RRQE     EQU   1        ADDRESS OF RQE                           Y02072 18250002
RLINK    EQU   1        INTERNAL LINKAGE REGISTER                Y02072 18300002
RIOB     EQU   2        ADDRESS OF IOB                                  18400021
RWORK2   EQU   2        WORK REGISTER                          @ZA08000 18402003
RBASE3   EQU   3        BASE REGISTER       SVC                         18600021
RWORK3   EQU   3        WORK REGISTER                          @ZA08000 18602003
RDCB     EQU   4        ADDRESS OF DCB                                  18800021
RSVRB    EQU   5        ADDRESS OF SVRB ON ENTRY FROM FREEDBUF   Y02072 18850002
RBUFFR   EQU   6        BUFFER ADDRESS                                  19200021
RSWA     EQU   6        PTR TO SAGMENT WORK AREA(ASSGNBUF)     @ZA08000 19202003
RDECB    EQU   7        DECB ADDRESS                                    19400021
RCCW     EQU   7        PTR TO CCW TO MODIFY(ASSGNBUF)         @ZA08000 19402003
RBUFCB   EQU   7        BCB BASE REGISTER                        Y02072 19450002
RWORK7   EQU   7        WORK REGISTER                          @ZA08000 19452003
RWORK13  EQU   8        WORK REGISTER (SIORTNE)                  Y02072 19500002
RTCB     EQU   8        BASE REGISTER FOR TCB FOR FREE BUF RTN   Y02072 19550002
RWORK9   EQU   9        WORK REGISTER                                   19600021
RWORK10  EQU   10       WORK REGISTER                                   20000021
RWORK11  EQU   11       WORK REGISTER                                   20200021
RWORK12  EQU   12       WORK REGISTER                                   20400021
RSAVE    EQU   13       IOS SAVEAREA ADDRESS                     Y02072 20450002
RRETURN  EQU   14       RETURN ADDRESS                                  21000021
RAPDBASE EQU   15       BASE REGISTER FOR APPENDAGE ROUTINES            21400021
R15      EQU   15       SAVE/RESTORE REG                         Y02072 21450002
         SPACE 5                                                        21600021
SETSECT  EQU   X'23'         CCW OP-CODE                                21800021
KEYDATOP EQU   X'0E'         CCW OP-CODE  READ KEY & DATE               22600021
RDDATAOP EQU   X'06'         CCW OP-CODE  READ DATA                     22800021
*                                                                       22850002
*        TEST TO DETERMINE IF REQUEST IS VALID                          22900002
*                                                                       22910002
SIORTNE  EQU   *                                                        22950001
**********************************************************************  22952003
*** DETERMINE IF A BRANCH ENTRY TO SMF IS REQUIRED BECAUSE EXCP HAS     22954003
*** BEEN ISSUED FROM THE ASI ROUTINE IN IGG019KA OR RELEX(IGC0005C)     22956003
*** OR THE ABNORMAL END APPENDAGE HAS RETURNED TO IOS TO RETRY          22956603
*** THE I/O REQUEST.                                                    22957203
***   INPUT-  REGISTER ONE CONTAINES NUMBER OF EXCP COUNTS.             22958003
***   OUTPUT- SMF EXCP COUNT INCREMENTED BY VALUE IN REG ONE.           22960003
*** SMF BRANCH ENTRY INTERFACE                                          22962003
*** REGISTER  0 - TCB PTR                                               22964003
*** REGISTER  1 - SMF EXCP COUNT                                        22966003
*** REGISTER  3 - DEB PTR                                               22968003
*** REGISTER  7 - UCB PTR                                               22970003
*** REGISTER 10 - WORK REG                                              22972003
*** REGISTER 11 - WORK REG                                              22974003
*** REGISTER 12 - WORK REG                                              22976003
*** REGISTER 13 - WORK REG                                              22978003
*** REGISTER 14 - RETURN ADDR                                           22980003
*** REGISTER 15 - SMF BASE                                              22982003
**********************************************************************  22984003
         STM   R0,R15,0(RSAVE)          SV REGS IN IOS SV AREA @ZA08000 22986003
         LR    RWORK2,RSAVE             SAVE AREA PTR          @ZA08000 22988003
         USING PSA,0                    LOW CORE MAP           @ZA08000 22990003
         L     RWORK13,PSATOLD          PTR TO TCB             @ZA08000 22991003
*                                                                       22992003
*** IF THE ABE APPENDAGE RETURNS TO IOS TO RESHEDULE I/O                22993003
*** THERE WILL BE NO TCB POINTER. THE I/O SUPERVISOR USES THE           22994003
*** SRB TO DISPATCH THE I/O REQUEST.                                    22995003
*                                                                       22996003
         LTR   RWORK13,RWORK13          IS THERE A TCB POINTER @ZA08000 22997003
         BZ    SMFCALL                  SCHEDULED UNDER SRB    @ZA08000 22998003
         USING TCB,RWORK13                                     @ZA08000 22999003
         L     RWORK13,TCBRBP           PTR TO RB              @ZA08000 23000003
         DROP  RWORK13                                         @ZA08000 23001003
         USING RBBASIC,RWORK13                                 @ZA08000 23002003
*                                                                       23003003
*** IF EXCP IS ISSUED OUT OF RELEX THE RB WILL BE AN SVRB WITH          23003503
*** THE PREVIOUS RB AN IRB.                                             23004003
*                                                                       23004503
         TM    RBSTAB1,RBFTSVRB         IS THIS AN IRB OR SVRB @ZA08000 23005003
         BZ    NOTIRB                   NO,BR AROUND SMF CALL  @ZA08000 23006003
         BNO   SMFCALL                  MAKE SMF CALL FOR IRB  @ZA08000 23007003
         L     RWORK13,RBLINK           PTR TO PREVIOUS RB     @ZA08000 23008003
         TM    RBSTAB1,RBFTIRB          IS PRVIOUS RB AN IRB   @ZA08000 23009003
         DROP  RWORK13                                         @ZA08000 23010003
         BZ    NOTIRB                   NO,DON'T CALL SMF      @ZA08000 23011003
SMFCALL  EQU   *                        CALL SMF               @ZA08000 23012003
         USING RQE,RRQE                                        @ZA08000 23013003
         L     R0,RQETCB                PTR TO TCB             @ZA08000 23014003
         L     R1,MINUS1                NEGATIVE COUNT TO SMF  @ZA08000 23030003
         L     R15,CVTPTR               PTR TO CVT             @ZA08000 23032003
         L     R15,CVTSMFEX-CVTMAP(,R15)   PTR TO SMF RTN      @ZA08000 23034003
         BALR  RRETURN,R15              BR TO SMF              @ZA08000 23036003
         DROP  RRQE                                            @ZA08000 23038003
         DROP  R0                                                       23039003
NOTIRB   EQU   *                        NOT AN IRB             @ZA08000 23040003
         LM    R0,R15,0(RWORK2)         RESTORE REGS           @ZA08000 23042003
         USING IOBSTDRD,RIOB                                            23400021
         USING IHADCB,RDCB                                              23600021
         TM    IOBDTYP2,IOBRQUST  IS THIS A READ REQUEST?               23800021
         BCR   8,RRETURN          IF NOT, RETURN TO IOS                 24000021
         TM    IOBDTYPE,IOBDYNBF  DOES REQUEST SPECIFY DYNAMIC          24200021
*                                 BUFFERING?                            24400021
         BCR   8,RRETURN          IF NO, RETURN TO IOS                  24600021
         TM    IOBSTAT1,IOBBUFF   HAS A BUFFER BEEN ASSIGNED TO         24800021
*                                 THIS REQUEST?                         25000021
         BCR   1,RRETURN          IF SO, RETURN TO IOS                  25200021
*                                                                       25400021
*                       IF A BUFFER IS AVAILABLE, ASSIGN IT TO          25600021
*                       THIS REQUEST AND UPDATE THE BUFFER POOL.        25800021
*                                                                       26000021
         USING  RQE,RRQE                ESTABLISH RQE BASE       Y02072 26050002
         STM   R0,R15,0(RSAVE)          SV REGS IN IOS SAVEAREA  Y02072 26100002
*                                                                       26110002
         MODESET  KEYADDR=RQEPRT,WORKREG=10  CHANGE TO USER KEY  Y02072 26150002
*                                                                       26160002
         L     RWORK10,DCBBUFCB   GET BUFFER CONTROL BLOCK ADDR         26200021
         USING BCBDEFR,RWORK10    ESTABLISH BASE FOR BCB         Y02072 26400002
         L     RWORK11,BCBNABFR   GET ADDRESS OF NEXT AVAILABLE         26600021
*                                 BUFFER                                26800021
         LTR   RWORK11,RWORK11    IS ONE AVAILABLE?                     27000021
         BZ    PTONBUFQ           IF NOT BRANCH TO QUEUE REQUEST        27200021
         TM    DCBRECFM,DCBRECV+DCBRECSB IS RECFM VS           @ZA08000 27210003
         BNO   NORECVS3                 NOT VS FORMAT          @ZA08000 27212003
         USING SWA,RWORK11        ESTABLISH BASE FOR SEG WKAREA  Y02072 27214003
         L     RWORK13,SWANXTPT   GET ADDR OF 2ND BUFFER (OR 0). Y02072 27216003
         DROP  RWORK11                                                  27218003
         ST    RWORK13,BCBNABFR   MAKE IT NEXT AVAILABLE         Y02072 27220003
         BAL   RLINK,ASSGNBUF           ASSIGN BUFFER TO REQUEST        27224003
         B     SIORET                   RET TO IOS             @ZA08000 27228003
NORECVS3 EQU   *                        NOT VS FORMAT          @ZA08000 27230003
         USING BUFFR,RWORK11                                            27400021
         L     RWORK13,BUFNXT     GET ADDR OF 2ND BUFFER (OR 0).        27600021
         DROP  RWORK11                                                  27800021
         ST    RWORK13,BCBNABFR   MAKE IT NEXT AVAILABLE                28000021
         DROP  RRQE                     DROP RQE BASE REG        Y02072 28050002
         BAL   RLINK,ASSGNBUF           ASSIGN BUFFER TO REQUEST        28200002
*                                                                       28400021
SIORET   EQU   *                        RETURN TO IOS            Y02072 28450002
*                                                                       28500002
         MODESET  KEYADDR=IOSKEY,WORKREG=10  CHANGE TO IOS KEY   Y02072 28550002
*                                                                       28560002
         LM    R0,R15,0(RSAVE)          LOAD IOS REGISTERS       Y02072 28570002
         BR    RRETURN                  RETURN TO IOS TO INITIATE       28800002
*                                       I/O REQUEST                     29000002
         SPACE 5                                                        29200021
PTONBUFQ EQU   *                                                        29400021
*                                                                       29600021
*                       NO BUFFER WAS AVAILABLE. PUT THIS IOB ON        29800021
*                       THE QUEUE WAITING FOR BUFFERS.                  30000021
*                                                                       30200021
         L     RWORK13,BCBFRQT    ADDR OF 1ST IOB ON QUEUE.             30400021
         LTR   RWORK13,RWORK13    IS THE QUEUE EMPTY?                   30600021
         BNZ   ONEONQ             BRANCH IF NOT                         30800021
         ST    RIOB,BCBFRQT       IF SO, STORE IOB ADDR AS FIRST        31000021
         B     BOTTOMST                                                 31200021
ONEONQ   L     RWORK13,BCBFRQB    GET ADDR OF LAST IOB ON QUEUE         31400021
         ST    RIOB,IOBDQPTR-IOBSTDRD(RWORK13)   POINT CHAIN TO         31600021
*                                                THIS IOB               31800021
BOTTOMST ST    RIOB,BCBFRQB       THIS IOB IS LAST ON QUEUE             32000021
         DROP  RWORK10                                           Y02072 32010002
*                                                                       32050002
         MODESET  KEYADDR=IOSKEY,WORKREG=10  CHANGE TO IOS KEY   Y02072 32100002
*                                                                       32150002
         LM    R0,R15,0(RSAVE)    LOAD IOS REGISTERS             Y02072 32160002
         B     4(RRETURN)         IOS RETURN - DON'T DO I/O             32400021
         DROP  RIOB                                                     32600021
         DROP  RDCB                                                     32800021
         EJECT                                                          32850002
*                                                                       33200021
*                  THIS SUBROUTINE IS USED BY THE START-I/O             33400021
*                  APPENDAGE AND THE FREE DYNAMIC BUFFER SVC            33600021
*                  ROUTINE. IT ASSUMES ENTRY IN USER KEY.               33800002
*                  IT ASSIGNS A BUFFER TO AN I/O REQUEST BY             34000021
*                  PLACING THE BUFFER ADDRESS INTO THE DECB             34200021
*                  AND THE CHANNEL PROGRAM.                             34400021
*                                                                       34600021
*              REGISTER INPUT:  RIOB    - ADDR OF IOB TO WHICH          34800021
*                                    BUFFER WILL BE ASSIGNED            35000021
*                               RDCB    - DCB ADDRESS                   35200021
*                               RWORK11 - BUFFER ADDRESS                35400021
*                               RLINK   - RETURN ADDRESS                35600021
*              REGISTER OUTPUT: RWORK9  - WORK REGISTER                 35800021
*                               RWORK10 - WORK REGISTER                 36000021
*                               RWORK11 - WORK REGISTER                 36200021
         USING IHADCB,RDCB                                              36400021
         USING IOBSTDRD,RIOB                                            36600021
ASSGNBUF L     RWORK9,IOBECBPT    GET DECB ADDRESS                      36800021
         USING DECB,RWORK9                                              37000021
         TM    DCBRECFM,DCBRECV+DCBRECSB                                37002003
         BNO   NORECVS1                 NO,BR AROUND VS CODE   XXXXXXX  37004003
         USING SWA,RWORK11        ESTABLISH BASE FOR SWA         Y02072 37202003
         LR    RWORK10,RIOB       PLACE IOB ADDRESS IN WORK REG         37212003
         LA    RSWA,IOBSTDRD-IOBSWAP   DISP TO IOBSWAP FIELD            37214003
         SR    RWORK10,RSWA       POINT TO IOB PREFIX                   37216003
         USING IOBSWAP,RWORK10                                          37218003
         ST    RWORK11,IOBSWAP    PLACE SWA ADDR IN IOB                 37220003
*                                 DATA & KEY (IF REQUESTED) WILL        37222003
*                                 BE READ INTO THE SEGMENT AREA         37224003
*                                 OF THE DYNAMIC BUFFER.  THE           37226003
*                                 USER WILL BE PASSED THE ADDRESS       37228003
*                                 OF LOCATIONS IN THE RECORD            37230003
*                                 AREA.                                 37232003
*                                                                       37234003
         LA    RSWA,SWASEGMT      GET ADDRESS OF SEGMENT AREA    Y02072 37236003
         L     RWORK11,SWARAPT    GET ADDRESS OF RECORD AREA     Y02072 37238003
         L     RCCW,IOBDCPND      POINT BEYOND LAST CCW                 37240003
         SH    RCCW,H16           POINT TO NEXT-TO-LAST CCW             37242003
*                                 FOR A READ BY BLOCK ID, KEY           37244003
*                                 CODED 'S', THE KEY IS READ            37246003
*                                 INTO THE DYNAMIC BUFFER.              37248003
         TM    IOBDTYP2,IOBTYPE   IS THIS READ BY BLOCK ID?             37250003
         BO    FILLCCWV           BRANCH IF NO                          37252003
         CLI   DCBKEYLE,0         IS THERE A KEY                 Y02072 37254003
         BE    FILLCCWV           BRANCH IF NO                   Y02072 37256003
         TM    IOBDTYP2,IOBSKEY   WAS KEY ADDRESS CODED 'S'?            37258003
         BZ    FILLCCWV           BRANCH IF NO                          37260003
         ST    RWORK11,DECKYADR   PLACE KEY ADDRESS IN DECB             37262003
         ST    RWORK11,0(RCCW)    PLACE ADDR OF KEY IN RECORD   XA00093 37264003
*                                 AREA INTO NEXT-TO-LAST CCW.           37266003
         MVI   0(RCCW),KEYDATOP   RESTORE OP-CODE                       37268003
*                                 INCREMENT RECORD AREA & SEGMENT       37270003
*                                 AREA POINTERS BEYOND KEY.             37272003
         SR    RWORK10,RWORK10                                          37274003
         IC    RWORK10,DCBKEYLE   GET LENGTH OF KEY                     37276003
         AR    RWORK11,RWORK10    BUMP RECORD AREA POINTER              37278003
*                                                                       37280003
FILLCCWV ST    RWORK11,DECAREA    PLACE DATA ADDRESS IN DECB            37282003
         ST    RSWA,8(RCCW)       PLACE DATA ADDRESS IN LAST CCW        37284003
         MVI   8(RCCW),RDDATAOP   RESTORE OP-CODE.                      37286003
         OI    IOBDSTAT,IOBBUFF   SET BUFFER-ASSIGNED SWITCH            37288003
         BR    RLINK              RETURN TO CALLER                      37290003
         DROP  RWORK11                                                  37292003
NORECVS1 EQU   *                        NOT VS FORMAT          @ZA08000 37292403
*                                 FOR A READ BY BLOCK ID, KEY           37294003
*                                 CODED 'S', THE KEY IS READ            37400021
*                                 INTO THE DYNAMIC BUFFER.              37600021
         TM    IOBDTYP2,IOBTYPE   IS THIS READ BY BLOCK ID?             37800021
         BO    FILLSCCW           BRANCH IF NO                          38000021
         TM    IOBDTYP2,IOBSKEY   WAS KEY ADDRESS CODED 'S'?            38200021
         BZ    FILLSCCW           BRANCH IF NO                          38400021
*                                 IN AN RPS PROGRAM CCW 3 READS         38600021
*                                 THE KEY; IN A NON-RPS PROGRAM,        38800021
*                                 CCW 4.                                39000021
         LA    RWORK10,IOBCHNPR+16     ADDR OF CCW 3                    39200021
         CLI   IOBCHNPR,SETSECT   TEST FOR RPS PROGRAM                  39400021
         BNE   NORPS              BRANCH IF NOT                         39600021
         LA    RWORK10,8(RWORK10) FOR RPS -- CCW 4                      39800021
*                                 PUT BUFFER ADDR OF KEY IN             40000021
*                                 CORRECT CCW & IN DECB                 40200021
NORPS    ST    RWORK11,0(RWORK10) PLACE ADDRESS IN READ KEY CCW         40400021
         MVI   0(RWORK10),KEYDATOP   RESTORE OP-CODE                    40600021
         ST    RWORK11,DECKYADR   PLACE KEY ADDRESS IN DECB             40800021
*                                 INCREMENT BUFFER POINTER              41000021
*                                 BEYOND KEY                            41200021
         SR    RWORK10,RWORK10                                          41400021
         IC    RWORK10,DCBKEYLE   GET KEY LENGTH                        41600021
         AR    RWORK11,RWORK10    BUMP BUFFER PTR BEYOND KEY            41800021
*                                 IN A NON-TRACK-OVERFLOW PGM           42000021
*                                 THE LAST CCW READS DATA; FOR          42200021
*                                 TRACK OVERFLOW, THE NEXT-TO-          42400021
*                                 LAST CCW                              42600021
FILLSCCW L     RWORK10,IOBDCPND   POINTS BEYOND LAST CCW                42800021
         SH    RWORK10,H8         ADDR OF LAST CCW                      43000021
         TM    DCBOPTCD,X'40'     TEST FOR TRACK OVERFLOW               43200001
         BZ    STADDR             BRANCH IF NO                          43400021
         SH    RWORK10,H8         ADDR OF NEXT-TO-LAST CCW              43600021
*                                                                       43800021
STADDR   ST    RWORK11,0(RWORK10) PUT DATA ADDR IN CCW                  44000021
         MVI   0(RWORK10),RDDATAOP     RESTORE READ DATA OP-CODE        44200021
         ST    RWORK11,DECAREA    PLACE DATA ADDRESS IN DECB            44400021
         OI    IOBDSTAT,IOBBUFF   SET BUFFER-ASSIGNED SWITCH            44600021
         BR    RLINK              RETURN TO CALLER                      44800021
         DROP  RWORK9                                                   45000021
         DROP  RIOB                                                     45200021
         DROP  RDCB                                                     45400021
         EJECT                                                          45600021
FBUFRTNE EQU   *                                                        45800021
*                                                                     * 46000021
* FUNCTION:                                                           * 46200021
*    THE FREE DYNAMIC BUFFER ROUTINE RELEASES A DYNAMIC BUFFER.       * 46400021
*    IF ANY IOBS ARE ON THE UNSCHEDULED QUEUE (WAITING FOR A          * 46600021
*    BUFFER) THE ROUTINE ASSIGNS THE BUFFER TO THE FIRST IOB ON       * 46800021
*    THE QUEUE, AND ISSUES AN EXCP FOR THAT IOB.  IF NO IOBS ARE      * 47000021
*    ON THE UNSCHEDULED QUEUE THE ROUTINE PLACES THE BUFFER ON        * 47200021
*    THE CHAIN OF AVAILABLE BUFFERS.                                  * 47400021
*                                                                     * 47600021
* ENTRY POINT:                                                        * 47800021
*         FRBUFEP -- ENTERED FROM MODULE IGC0005G WHEN SVC 57 IS      * 48000021
*         ISSUED FOR A DCB WHICH SPECIFIED DIRECT ORGANIZATION.       * 48200021
*         CALLING SEQUENCE -- L    15,DCBDEBAD                        * 48400021
*                             L    15,DEBAPPAD                        * 48600021
*                             L    15,4(15)                           * 48800021
*                             BAL  14,8(15)                           * 49000021
*                                                                     * 49200021
* INPUT                                                               * 49400021
*    **** REGISTER CONTENTS ****                                      * 49600021
*    REGISTER  0 -- DECB ADDRESS                                      * 49800021
*    REGISTER  1 -- DCB ADDRESS                                       * 50000021
*    REGISTER  5 -- SVRB ADDRESS                                      * 50100002
*    REGISTER  8 -- TCB ADDRESS PASSED BY FREEDBUF                    * 50150002
*    REGISTER 14 -- RETURN ADDRESS                                    * 50400021
*    REGISTER 15 -- ADDRESS OF IGG019LE                               * 50600021
*                                                                     * 50800021
* OUTPUT                                                              * 51000021
*    **** REGISTER CONTENTS ****                                      * 51200021
*    ALL REGISTERS EXCEPT REGISTER 14 CAN BE USED WITHOUT SAVING      * 51400021
*    OR RESTORING CONTENTS.                                           * 51600021
*                                                                     * 52000021
*    **** DATA FIELDS SET BY THIS ROUTINE ****                        * 52200021
*    BCBFRQT       IF AN IOB IS WAITING FOR A BUFFER, PTR TO 1ST      * 52400021
*                  IOB ON QUEUE IS UPDATED.                           * 52600021
*    IOBDQPTR      FIELD IN DEQUEUED IOB IS CLEARED                   * 52800021
*    THE BUFFER ADDRESS IS PLACED IN THE CHANNEL PROGRAM AND DECB     * 53000021
*    FIELDS (SEE SIORTNE DESCRIPTION FOR DETAILS).                    * 53200021
*    BCBNABFR      IF THE BUFFER IS NOT ASSIGNED TO A REQUEST,        * 53400021
*                  ITS ADDRESS IS PLACED IN BCBNABFR                  * 53600021
*    BUFNXT        FIELD OF THE RELEASED BUFFER IS SET TO THE         * 53800021
*                  ADDR OF THE 2ND AVAILABLE BUFFER.                  * 54000021
*    SVRB          SEE BELOW                                            54050002
*                                                                     * 54200021
* EXTERNAL REFERENCES                                                 * 54400021
*        EXCP CALL TO IOS                                             * 54600021
*        MODESET TO CHANGE BETWEEN SUPERVISOR AND USER KEYS             54650002
*        SETLOCK TO RELEASE AND OBTAIN THE LOCAL LOCK                   54700002
*                                                                       54800021
* EXITS, NORMAL                                                       * 55000021
*    BRANCH RETURN TO IGC0005G ON REGISTER 14.  RETURN CODE (R15)     * 55200021
*    = 0.                                                             * 55400021
*                                                                     * 55600021
* TABLES / WORK AREAS                                                 * 55800021
*        IOB, DCB, DECB, BUFFER CONTROL BLOCK,SVRB                    * 56000002
*                                                                     * 56200021
* ATTRIBUTES -- REENTRANT, PRIVILEGED.  ENTRY IS IN SUPERVISOR        * 56400002
*    KEY WITHOUT THE LOCAL LOCK HELD. RETURN TO IGC0005G IS IN        * 56410002
*    SUPERVISOR KEY. MOST PROCESSING IS IN USER KEY.                  * 56450002
*                                                                     * 56500002
* NOTES -- THE ROUTINE MUST HAVE THE LOCAL LOCK TO UPDATE THE SERIALLY* 56550002
* REUSABLE IOB AND BUFFER QUEUES. SETLOCK IS ISSUED FOR THIS.         * 56600002
*                                                                     * 57200021
*****                                                             ***** 57250002
         EJECT                                                          57566602
         LR    RBASE3,RAPDBASE    ESTABLISH BASE REGISTER               57600021
         USING IGG019LE,RBASE3                                          57800021
         DROP  RAPDBASE                                                 58000021
         LR    RDCB,R1            TRANSFER DCB ADDRESS                  58200021
         USING IHADCB,RDCB                                              58400021
         LR    RDECB,R0           TRANSFER DECB ADDRESS                 58600021
         USING DECB,RDECB                                               58800021
         USING RBSECT,RSVRB             ESTABLISH BASE FOR SVRB  Y02072 58850002
         ST    RRETURN,WKAREG14         SAVE RETURN ADDR IN SVRB Y02072 58860002
         USING TCB,RTCB                 ESTABLISH BASE FOR TCB   Y02072 58950002
*                                       PASSED BY FREEDBUF       Y02072 58960002
*                                                                       58970002
         MODESET  KEYADDR=WKASVKEY,WORKREG=6 CHANGE TO USER KEY  Y02072X58980002
                                        TO ACCESS USER CNTRL BLK Y02072 58990002
*                                                                       59000021
*                       LOCATE THE BEGINNING ADDRESS OF THE             59200021
*                       BUFFER BEING FREED.                             59400021
*                                                                       59600021
         L     RBUFFR,DECAREA     ASSUME BUFFER ADDR = DATA ADDR        59800021
         TM    DECTYPE2,DECKEYS   WAS KEY IN BUFFER (CODED 'S')?        60000021
         BZ    FBU0500            BRANCH NO                             60200021
         L     RBUFFR,DECKYADR    BUFFER ADDR = KEY ADDR                60400021
         DROP  RDECB                                             Y02072 60450002
FBU0500  EQU   *                                                        60600021
         TM    DCBRECFM,DCBRECV+DCBRECSB                                60602003
         BNO   NORECVS2                 NO,BR AROUND VS CODE   XXXXXXX  60604003
         LA    RWORK12,BUFRECAR-BUFBFPTR                                60606003
         SR    RBUFFR,RWORK12     POINT TO ADDR OF BEGINNING OF         60608003
*                                       BUFFER                          60610003
         L     RBUFFR,0(RBUFFR)         GET BUFFER ADDRESS              60612003
         USING SWA,RBUFFR               ESTABLISH BASE FOR SWACB Y02072 60614003
         XC    SWABFINC,SWABFINC        CLEAR RECORD AREA OFFSET Y02072 60616003
NORECVS2 EQU   *                        NOT VS FORMAT          @ZA08000 60618003
         L     RBUFCB,DCBBUFCB    BUFFER CONTROL BLOCK ADDR      Y02072 60800002
         USING BCBDEFR,RBUFCB     ESTABLISH BCB BASE             Y02072 61000002
*                                                                       61050002
*   PREPARE FOR QUEUE UPDATES. THIS REQUIRES THAT THE LOCAL LOCK BE     61100002
*   OBTAINED WHILE MANIPULATING THE QUEUE. IT IS RELEASED WHEN THE      61150002
*   QUEUE HAS BEEN UPDATED AND THE NEXT WAITING IOB HAS BEEN REMOVED,   61200002
*   OR THE BUFFER HAS BEEN PUT BACK ON THE AVAILABLE BUFFER QUEUE.      61250002
*   MODESET IS ISSUED BECAUSE SETLOCK REQUIRES SUPERVISOR KEY.          61260002
*   SETLOCK USES REGISTERS 11-14 WITHOUT RESTORING THEM. CERTAIN        61270002
*   FIELDS WILL BE SAVED AT THIS POINT SHOULD THE ESTAE NEED THEM.      61280002
*                                                                       61300002
         L     RIOB,BCBFRQT             ADDR OF FIRST IOB QUEUED        61310002
         L     RWORK0,BCBNABFR          LOAD BUF FLD IN USER KEY YM5316 61320002
*                                                                       61330002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 61350002
*                                                                       61360002
GETLOCK  SETLOCK  OBTAIN,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019LE(FREELOCKX61360802
               ,FREELCK1)'),MODE=UNCOND  GET THE LOCAL LOCK      Y02072 61360902
*                                                                       61361302
         ST    RBUFFR,WKABUFRG          SAVE BUF PTR FOR ESTAE   Y02072 61362002
         ST    RIOB,WKASAVE             SAVE BCB CONTENTS FOR    Y02072 61362402
*                                       ESTAE COMPARE TO DETECT  Y02072 61362802
*                                       IF CONTENTS CHANGE       Y02072 61363202
         ST    RWORK0,WKASAVE2          SAVE BCB CONTENTS        YM5316 61363602
*                                       FOR ESTAE IN CASE THE    Y02072 61363702
*                                       PATH TAKEN CHANGES THIS  Y02072 61363802
         ST    RIOB,WKAIOBRG            SAVE IOB PTR FOR ESTAE   Y02072 61366002
*                                                                       61390002
         MODESET  KEYADDR=WKASVKEY,WORKREG=11 RET TO USER KEY    Y02072 61392002
*                                                                       61394002
         LTR   RIOB,RIOB          ARE THERE ANY IOBS?                   61600021
*                                                                       61610002
         BZ    MAKEAVAL           IF NOT, GO MAKE THIS BUFFER           61800021
*                                 AVAILABLE                             62000021
*                                                                       62200021
*                       UPDATE QUEUE BY REMOVING FIRST IOB              62400021
*                                                                       62600021
         USING IOBSTDRD,RIOB                                            62800021
CHAIN    L     RWORK9,IOBDQPTR    GET ADDRESS OF NEXT IOB AND           63000021
         ST    RWORK9,BCBFRQT     MAKE IT THE NEXT IOB ON QUEUE         63200021
         XC    IOBDQPTR,IOBDQPTR        CLEAR QUEUING FIELD             63250002
*                                                                       63410002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 63420002
*                                       TO SET BIT IN SVRB       Y02072 63422002
*                                       AND RELEASE LOCK         Y02072 63424002
         MVI   WKATRAIL,WKAIOBQ         SET BIT IN SVRB EXT SAVE Y02072 63426002
*                                       INDICATING IOB DEQUEUED  Y02072 63428002
*                                                                       63432002
FREELOCK SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019LE(GETLOCKX63442002
               )')                      FREE THE LOCAL LOCK      Y02072 63442402
*                                                                       63492402
ESTENTA  EQU   *                        ESTAE ENTRY IF WKAIOBQ=1 Y02072 63494002
*                                                                       63570002
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 63600002
*                                                                       63650002
         LR    RWORK11,RBUFFR     PUT BUFFER ADDR IN R11                63800021
         LR    RAPDBASE,RBASE3    RESTORE BASE FOR SUBRTN        XM6073 63850021
         BAL   RLINK,ASSGNBUF     ASSIGN THE BUFFER TO THE DEQ'D IOB    64000002
*                                                                       64200002
*                                                                       64206002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 64210002
*                                       TO SET BIT IN SVRB       Y02072 64220002
         MVI   WKATRAIL,WKABUFAS        SET BIT IN SVRB EXTENDED Y02072 64250002
*                                       SAVEAREA INDICATING BUF  Y02072 64300002
*                                       ASSIGNED TO NEXT IOB     Y02072 64310002
ESTENTB  EQU   *                        ESTAE ENTRY IF WKABUFAS  Y02072 64312002
*                                       BIT ON                   Y02072 64314002
         MODESET  KEYADDR=WKASVKEY,WORKREG=11  RET TO USER KEY   Y02072 64320002
*                                                                       64330002
         L     RWORK11,IOBECBPT         LOAD ADDR TO USER'S DECB Y02072 64350002
         ST    RWORK11,IOBDQPTR         SAVE DECB ADDR IN IOB    Y02072 64400002
         LA    RWORK11,IOBCSW+3         SET UP CSW ADDRESS TO    Y02072 64450002
         ST    RWORK11,IOBECBPT         USE AS DUMMY ECB FOR IOS Y02072 64500002
*                                       CEA OR EOE WILL RESTORE  Y02072 64550002
*                                       USER'S DECB ADDR IN IOB  Y02072 64600002
*                                                                       64800002
         EXCP  (RIOB)                   SCHEDULE I/O FOR NEXT IOB ON Q  69400021
*                                                                       69410002
         MODESET  EXTKEY=ZERO           RETURN TO SUPER KEY      Y02072 69420002
*                                                                       69450002
         MVI   WKATRAIL,WKAEXCP         SET BIT INDICATING EXCP  Y02072 69600002
*                                                                       69650002
         B     NORMEXIT                 RETURN TO IGC0005G       Y02072 70800002
         SPACE 5                                                        71200021
*                                                                       71400021
*   NO IOBS ARE WAITING FOR BUFFERS. RETURN BUFFER TO THE AVAILABLE     71450002
*   QUEUE.THIS ROUTINE IS ENTERED IN USER KEY WITH THE LOCAL LOCK HELD. 71500002
*   IT RETURNS TO IGC0005G IN SUPERVISOR KEY.                           71550002
*                                                                       71650002
MAKEAVAL EQU   *                                                        72200021
         L     RWORK9,BCBNABFR    GET ADDR OF AVAILABLE BUFFER          72400021
         USING BUFFR,RBUFFR                                             72600021
         ST    RWORK9,BUFNXT      POINT THIS BUFFER TO IT               72800021
         ST    RBUFFR,BCBNABFR    MAKE THIS ONE NEXT AVAILABLE          73000002
         DROP  RBUFFR              (LIFO QUEUE)                         73200021
*                                                                       73210002
         MODESET  EXTKEY=ZERO           CHANGE TO SUPER KEY      Y02072 73220002
*                                       TO SET BIT IN SVRB       Y02072 73230002
*                                       AND RELEASE LOCAL LOCK   Y02072 73230102
         MVI   WKATRAIL,WKABUFQ         SET BIT INDICATING BUF   Y02072 73230402
*                                       FREED AND PUT ON QUEUE   Y02072 73230802
*                                                                       73240002
FREELCK1 SETLOCK  RELEASE,TYPE=LOCAL,RELATED=('BUFFERQ,IGG019LE(GETLOCKX73242002
               )')                      FREE THE LOCAL LOCK      Y02072 73242402
***********************                                                 73350002
*                                                                       73400002
NORMEXIT EQU   *                        RETURN TO FREEDBUF       Y02072 73410002
         L     RRETURN,WKAREG14         RESTORE R14 TO RET ADDR  Y02072 73450002
         BR    RRETURN                  RETURN TO IGC0005G.             74000002
*****                                                             ***** 74200002
*                      CONSTANTS                                        74250002
*****                                                             ***** 74300002
H8       DC    H'8'                     HALFWORD  VALUE = 8             74450002
H16      DC    H'16'                    HALFWORD  VALUE = 16   @ZA08000 74452003
IOSKEY   DC    X'00'                    IOS KEY                  Y02072 74500002
ZERO     DC    X'00'                    SVRB KEY                 Y02072 74550002
MINUS1   DC    F'-1'                    NEGATIVE 1 FOR SMF CALL@ZA08000 74552003
MODID    DC    C'IGG019LE'              MODULE ID                Y02072 74560002
FIX      DC    C'@ZA08000'              LATEST FIX APPLIED     @ZA08000 74570003
DATE     DC    C'&SYSDATE'              DATE OF LATEST FIX     @ZA08000 74580003
PATCH    DC    XL50'0'                  PATCH AREA               Y02072 74600002
         EJECT                                                          75400021
*********************************************************************** 75410002
*                         DSECTS                                      * 75420002
*********************************************************************** 75430002
         CVT   DSECT=YES                                       @ZA08000 75432003
         EJECT                                                          75434003
         IHAPSA                                                  Y02072 75450002
         EJECT                                                          75460002
         IECDRQE                                                 Y02072 75470002
         EJECT                                                          75500002
         IKJRB                                                   Y02072 78950002
         IGGFRWKA                                                Y02072 78960002
         EJECT                                                          79000002
         IEZIOB                                                         79050002
         EJECT                                                          79060002
         DCBD  DSORG=DA                                                 79100002
         EJECT                                                          79150002
         IHADECB                                                        79200002
         EJECT                                                          79250002
         IGGBCB  TYPE=DAM                                        Y02072 79300002
BUFFR    DSECT                          FORMAT OF A BUFFER              79310002
BUFNXT   DS    A                        ADDR OF NEXT BUFFER             79320002
*                                       ON AVAILABLE CHAIN              79330002
BUFFERB  DSECT          FORMAT OF BUFFER BEYOND SEGMENT AREA            79332003
BUFBFPTR DS    A        ADDRESS OF BEGINNING OF BUFFER                  79334003
BUFRECAR EQU   *        RECORD AREA; BUFBFPTR IS ALIGNED SO THAT        79336003
*                       BUFRECAR FALLS AS SPECIFIED BY DCBBFALN.        79338003
*                                                                       79340003
         EJECT                                                          79342003
         IGGSWA                                                  Y02072 79344003
         EJECT                                                          79346003
         EJECT                                                          79350002
         IKJTCB                                                         79400002
         END                                                            80600021
./  ADD  SSI=52791023,NAME=IGG019LI
      TITLE 'IGG019LI -  BDAM CHECK MODULE '                            00020402
IGG019LI CSECT                                                        * 00020802
*                                                                     * 00022002
*MODULE NAME - IGG019LI                                               * 00032002
*                                                                     * 00034002
*DESCRIPTIVE NAME - BDAM CHECK MODULE                                 * 00036002
*                                                                     * 00038002
*COPYRIGHT = NONE                                                     * 00040002
*                                                                     * 00040402
*CHANGE ACTIVITY                                                      * 00040802
*                                                                       00041202
*        RELEASE 21 CHANGES/DELETIONS                                   00042002
*3043014050-014150                                               21905  00043021
*3043014200                                                      M0055  00044021
*        RELEASE VS2-2 CHANGES/DELETIONS                                00054002
*014050-014150                                                   Y02072 00064002
*                                                                YM3029 00074002
*        RELEASE VS2-3 CHANGES/UPDATES                                  00076003
*C016400,C017200                                                ZA02222 00078003
*                                                                     * 00080000
* STATUS CHANGE LEVEL 003                                               00090002
*                                                                     * 00100019
*FUNCTIONS/OPERATION - THIS MODULE IS ENTERED BY THE CHECK MACRO      * 00120000
*    ISSUED BY THE PROBLEM PROGRAM.THIS ROUTINE WAITS(IF NECESSARY)   * 00140000
*    FOR THE COMPLETION OF THE INPUT/OUTPUT OPERATION ASSOCIATED WITH * 00160000
*    THE DATA EVENT CONTROL BLOCK(DECB) PASSED TO THIS ROUTINE BY     * 00180000
*    THE PROBLEM PROGRAM. IF THE I/O OPERATION HAS COMPLETED WITHOUT  * 00200000
*    ANY OF THE EXCEPTION BITS IN THE DECB BEING SET, THIS ROUTINE    * 00220000
*    THEN FREES THE IOB ASSOCIATED WITH THE I/O EVENT TO THE POOL OF  * 00240000
*    IOBS. IF ONE OF THE EXCEPTION BITS HAS BEEN SET THIS ROUTINE WILL* 00260000
*    (1) ABEND IF NO SYNAD ROUTINE HAS BEEN SUPPLIED BY THE USER      * 00280000
*    (2) GO TO THE USER'S SYNAD ROUTINE IF ONE IS SUPPLIED AND WHEN   * 00300000
*    CONTROL IS RETURNED TO THIS ROUTINE BY THE USER THE PROCESSING   * 00320000
*    CONTINUES AS IF NONE OF THE EXCEPTION BITS HAD BEEN SET          * 00340000
*                                                                     * 00360000
*ENTRY POINT -'IGG019LI'IS THE ENTRY POINT FROM THE CHECK MACRO       * 00380000
*    EXPANSION VIA THE CALLING SEQUENCE-          L    15,DCBCHECK    * 00400000
*                                                 BALR 14,15          * 00420000
*                                                                     * 00440000
*INPUT- INPUT TO THE CHECK ROUTINE IS THE ADDRESS OF THE DECB ASSIGNED* 00460000
*    TO THE READ OR WRITE BEING CHECKED. THIS ADDRESS WILL BE LOADED  * 00480000
*    INTO REGISTER 1 PRIOR TO ENTERING THIS ROUTINE.                  * 00500000
*                                                                     * 00520000
*OUTPUT- THE IOB(IF ONE HAS BEEN ASSIGNED) FOR THIS REQUEST IS FREED  * 00540000
*    TO THE POOL OF IOBS.                                             * 00560000
*    IF THE USER'S SYNAD EXIT IS TAKEN,REGISTER 0 WILL CONTAIN THE    * 00580000
*    DECB ADDRESS AND REGISTER 1 WILL CONTAIN THE DCB ADDRESS PLUS    * 00600000
*    SOME INFORMATIONAL BITS.                                         * 00620000
*                                                                     * 00640000
*EXTERNAL ROUTINES- NONE                                              * 00660000
*                                                                     * 00680000
*EXITS - 'RETURN' IS THE EXIT TO RETURN TO THE PROBLEM PROGRAM ON     * 00700000
*    NORMAL COMPLETION.                                               * 00720000
*    'SETSYNAD' IS THE EXIT TO THE USER'S SYNCHRONOUS ERROR ROUTINE.  * 00740000
*                                                                     * 00760000
*TABLES/WORK AREAS- NONE                                              * 00780000
*                                                                     * 00800000
*ATTRIBUTES - THIS ROUTINE IS REENTRANT AND EXECUTED ENABLED.         * 00820000
*                                                                     * 00840000
         EJECT                                                          00860000
*                                                                       00880000
*        REGISTER USAGE                                                 00900000
*                                                                       00920000
*                                                                       00940000
PARAM1   EQU   0                       PARAMETER REGISTER FOR SYNAD     00960000
DCBR     EQU   1                       ADDRESS OF DCB FOR SYNAD+CODES   00980000
DECBR    EQU   2                       DECB ADDRESS                     01000000
CODER    EQU   3                       CODE REGISTER                    01020000
CODER1   EQU   4                       CODE REGISTER                    01040000
IOBR     EQU   4                       IOB ADDRESS                      01060000
BASE     EQU   5                       BASE OF THIS MODULE              01080000
RETREG   EQU   14                      RETURN REGISTER                  01100000
EPREG    EQU   15                      ENTRY POINT REGISTER             01120000
*                                                                       01140000
*                                                                       01160000
*                                                                       01180000
         USING IOBDEF,IOBR                                              01200000
         USING IGG019LI,BASE                                            01220000
         USING DECB,DECBR                                        Y02072 01240002
         USING IHADCB,DCBR                                              01260000
*                                                                       01280000
*                                                                       01300000
         SAVE  (14,5)                  SAVE REGISTERS 14-5              01320000
         LR    BASE,EPREG                                               01340000
         LR    DECBR,DCBR                                               01360000
         TM    DECSDECB,COMPLETE       HAS THIS ECB BEEN POSTED COMPLET 01380000
         BZ    WAIT                    NO WAIT ON THIS ECB              01400000
CHECKERR TM    DECSDECB+1,ALLONES      ANY ERRORS IN ECB         M0055  01425002
         BZ    MKIOBAVL                NO.MAKE IOB AVAILABLE            01440000
         LA    CODER,WRITE             PUT WRITE BIT ON                 01460000
         TM    DECTYPE+1,READ          IS THIS A READ                   01480000
         BZ    WRITEADD                NO GO ON                         01500000
         LA    CODER,READ1             YES CHANGE WRITE TO READ         01520000
         L     IOBR,DECIOBPT           GET IOB ADDRESS                  01540000
         LTR   IOBR,IOBR               WAS AN IOB ASSIGNRD              01560000
         BZ    INVREQ                  NO, SKIP TESTING IF BLOCK IS IN  01580000
         CLC   IOBDCPND+1(3),IOBCSW+1  IS CHANNEL PROGRAM COMPLETE      01600000
         BNE   INVREQ                  NO GO ON                         01620000
         LA    CODER1,BIT3             YES INDICATE BLOCK IS    ZA02222 01640003
         OR    CODER,CODER1            IN CORE.                         01660003
WRITEADD TM    DECTYPE+1,ADD           IS THIS A WRITE ADD              01680003
         BO    INVREQ                  YES GO ON                        01700003
         LA    CODER1,BIT3             NO INDICATE THIS IS AN   ZA02222 01720003
         OR    CODER,CODER1            UPDATE RATHER THAN A NEW RECORD  01740000
INVREQ   TM    DECSDECB+1,INVALID      IS THIS AN INVALID REQUEST       01760000
         BZ    UNRELATD                NO GO ON                         01780000
         LA    CODER1,BADREQ           YES INDICATE THAT THIS IS AN     01800000
         OR    CODER,CODER1            INVALID REQUEST                  01820000
UNRELATD TM    DECSDECB+1,NOTRELTD     IS THIS AN UNREACHABLE BLOCK     01840000
         BZ    NOSPACE                 NO GO ON                         01860000
         LA    CODER1,UNREACH          YES INDICATE THIS BLOCK COULD    01880000
         OR    CODER,CODER1            NOT BE REACHED                   01900000
NOSPACE  TM    DECSDECB+1,NOSPACEB     WAS NO SPACE AVAILABLE           01920000
         BZ    SYNAD                   NO GO ON                         01940000
         LA    CODER1,NOSPACEF         YES INDICATE NO SPACE FOUND      01960000
         OR    CODER,CODER1                                             01980000
SYNAD    EQU   *                                                        02000000
         L     DCBR,DECDCBAD           PUT DCB ADDR INTO REG 1          02020000
         TM    DCBSYNAD+3,X'01'        IS THERE A SYNAD ROUTINE         02040000
         BZ    SETSYNAD                YES GO SET UP TO LINK TO IT      02060000
         LH    PARAM1,ABNOSYND                                   I19116 02080019
         SVC   55                                                I19116 02100019
SETSYNAD LR    PARAM1,DECBR            PUT DECB ADDR INTO REG 0         02120000
         SLL   CODER,24                PUT ERROR SUMMARY BITS INTO      02140000
         OR    DCBR,CODER              HI-ORDER BYTE OF REG 1           02160000
         L     EPREG,DCBSYNAD          GET SYNAD ADDRESS                02180000
         STM   2,5,44(13)              SAVE OUR REGISTERS               02200000
         LM    2,5,28(13)              RESTORE USER'S REGISTERS         02220000
         BALR  RETREG,EPREG            LINK TO IT                       02240000
         STM   2,5,28(13)              SAVE USER'S REGISTERS            02260000
         LM    2,5,44(13)              RESTORE OUR REGISTERS            02280000
MKIOBAVL L     IOBR,DECIOBPT           GET  THE IOB ADDR.               02300000
         LTR   IOBR,IOBR               WAS AN IOB ASSIGNED              02320000
         BZ    RETURN                  NO, RETURN TO USER               02340000
FROMPOOL MVI   IOBDAVLI,0              ZERO AVAILABILITY BYTE           02360000
RETURN   EQU   *                                                        02380000
         RETURN (14,5),T                                                02400000
WAIT     WAIT  ECB=(1)                 WAIT FOR EVENT TO COMPLETE       02420000
         B     CHECKERR                GO BACK TO CHECK ERRORS          02440000
*                                                                       02460000
AVLMSK   EQU   X'80'                   IOB AVAILABILITY BYTE            02480000
ALLONES  EQU   X'FF'                   MASK TO TEST FOR ANY ERRORS      02500000
WRITE    EQU   X'40'                   WRITE BIT IN CODE                02520000
READ     EQU   X'08'                   READ BIT IN DECTYPE FIELD        02540000
ADD      EQU   X'02'                   WRITE ADD BIT IN DECTYPE FIELD   02580000
INVALID  EQU   X'10'                   INVALID REQUEST IN DECB          02600000
BADREQ   EQU   X'08'                   INVALID REQUEST IN CODE          02620000
NOTRELTD EQU   X'02'                   UNRELATED ERROR IN DECB          02640000
UNREACH  EQU   X'02'                   UNRELATED ERROR IN CODE          02660000
NOSPACEB EQU   X'20'                   NO SPACE FOUND BIT IN DECB       02680000
NOSPACEF EQU   X'01'                   NO SPACE FOUND BIT IN CODE       02700000
ABNOSYND DC    XL2'1000'               ABEND CODE IF NO SYNAD IS GIVEN  02720000
COMPLETE EQU   X'40'                   COMPLETE BIT IN ECB              02740000
READ1    EQU   X'80'                   READ BIT IN CODE                 02760000
MODID    DC    C'IGG019LI'              MODULE ID                Y02072 02770002
PATCH    DC    XL50'0'                  PATCH AREA OF 50 BYTES   Y02072 02810002
         EJECT                                                          02890002
*********************************************************************** 02892002
*              DSECTS                                                 * 02894002
*********************************************************************** 02896002
         DCBD  DSORG=DA                                                 02900000
         EJECT                                                          02920000
         IHADECB                                                 Y02072 02970002
         EJECT                                                          03160000
*                                                                       03180000
*      I/O BLOCK (IOB) DEFINITION                                       03200000
*                                                                       03220000
*              STANDARD IOB                                             03240000
         DS    0F                                                       03260000
IOBDEF   DSECT                                                          03280000
IOBFLAG1 DS    CL1            STATUS FLAG                               03300000
IOBFLAG2 DS    CL1            ERROR FLAG                                03320000
IOBSENSE DS    CL2            SENSE BYTES 0 AND 1                       03340000
IOBECBPT DS    CL4            ECB POINTER                               03360000
IOBCSW   DS    0CL8           CHANNEL STATUS WORD                       03380000
IOBCSWCA DS    0CL4           COMMAND ADDRESS                           03400000
         DS    CL1                                                      03420000
         DS    CL3                                                      03440000
IOBCSWST DS    CL2            STATUS BYTES                              03460000
IOBCSWCT DS    CL2            REMAINING COUNT                           03480000
IOBSTART DS    0CL4           CHANNEL PROGRAM POINTER                   03500000
IOBSIOCC DS    CL1            SIO CONDITION CODE                        03520000
         DS    CL3                                                      03540000
IOBDCBPT DS    0CL4           DCB POINTER                               03560000
IOBWGHT  DS    CL1            CHANNEL WEIGHT                            03580000
         DS    CL3                                                      03600000
IOBRESTR DS    0CL4           RESTART POINTER                           03620000
         DS    CL1                                                      03640000
         DS    CL3                                                      03660000
IOBINCAM DS    CL2            BLOCK COUNT INCREMENT AMOUNT              03680000
IOBERRCT DS    CL2            ERROR COUNTER                             03700000
IOBSEEK  DS    CL8            SEEK ADDRESS                              03720000
*        BDAM EXTENDED IOB                                              03740000
*                                                                       03760000
IOBDBYTR DS    CL2            BYTES REMAINING ON TRACK                  03780000
IOBDIOBS DS    CL2            SIZE OF THIS IOB                          03800000
IOBDPLAD DS    0CL4           IOB POOL LINK ADDRESS                     03820000
IOBDAVLI DS    CL1            IOB AVAILABILITY INDICATOR                03840000
         DS    CL3                                                      03860000
IOBDTYPE DS    CL2            TYPE FIELD                                03880000
IOBDSTAT DS    CL2            IOB STATUS                                03900000
IOBDCPND DS    CL4            CHANNEL PROGRAM NORMAL END ADDRESS        03920000
IOBDBYTN DS    CL2            BYTES NEEDED BY NEW RECORD                03940000
         DS    CL2                                                      03960000
IOBDQPTR DS    CL4            LINK FIELD FOR QUEUED IOB'S               03980000
IOBUPLIM DS    CL8            LIMIT MBBCCHHR FOR EXTENDED SEARCH        04000000
IOBDNRCF DS    CL8            COUNT FIELD FOR NEW RECORD                04020000
IOBCP    DS    CL8            FIRST CCW IN CHANNEL PROGRAM              04040000
IOBDIOBX EQU   42                      OFFSET FOR IOBDIOS               04060000
IOBDPLAX EQU   44                      OFFSET FOR IOBDPLAD              04080000
         END                                                            04100000
./  ADD  SSI=62430527,NAME=IGG0191L
  TITLE 'IGG0191L--STAGE TWO OPEN EXECUTOR FOR CREATE BDAM'      S19015 00010019
IGG0191L CSECT                                                          00020000
*                                                                     * 00030002
*MODULE NAME - IGG0191L                                               * 00040002
*                                                                     * 00050002
*DESCRIPTIVE NAME - STAGE TWO OPEN EXECUTOR FOR BDAM CREATE           * 00050402
*                                                                     * 00050802
*COPYRIGHT - NONE                                                     * 00051202
*                                                                     * 00051602
*CHANGE ACTIVITY                                                      * 00051702
*                                                                     * 00051802
*          RELEASE 19 CHANGES/DELETIONS                                 00052002
*1020005000-005600,026200,044400,044600-060400,066400,081600-    S19015 00054019
*1020084200,087600,088800,091000                                 S19015 00056019
*                                                                M3933  00058019
*          RELEASE 20 CHANGES/DELETIONS                                 00060002
*1180011400,017200,036600,080800                                 S20201 00064020
*          RELEASE 21 CHANGES/DELETIONS                                 00068002
*0072034600-034750                                               A42456 00072021
*                                                               SA53272 00074021
*017400-017520                                                  SA55520 00074402
*                                                               SA55544 00074802
*                                                               SA60763 00075202
*          RELEASE VS1-1 CHANGES/DELETIONS                              00076002
*          RELEASE VS2-1 CHANGES/DELETIONS                              00078002
*          RELEASE VS1-2 CHANGES/DELETIONS                              00080002
*          RELEASE VS2-2 CHANGES/DELETIONS                              00082002
*067200,067600-068960,073400-073600,077400,079000-079400,        Y02072 00086002
*080220-080260,080340                                            Y02072 00088002
*                                                                YM1140 00090002
*                                                                YM2886 00092002
*          RELEASE VS2-3 CHANGES/DELETIONS                              00092403
*                                                              @Z30TSMI 00092803
*          CHANGES SUBSEQUENT TO VS2-3                                  00093237
*C025320,089982                                                 ZA10231 00093637
*                                                                       00094002
*STATUS CHANGE LEVEL 010                                                00107003
*                                                                       00115019
*    THIS EXECUTOR IS SPLIT INTO IGG0199L AT RELEASE 19.THE NEW         00116002
*    EXECUTOR WILL BE XCTLED FROM THIS TO FINISH CCW CONSTRUCTION       00117019
*FUNCTIONS- THIS ROUTINE IS GIVEN CONTROL AFTER THE DEB HAS BEEN        00120000
*    CONSTRUCTED AND HAS THE FOLLOWING FUNCTIONS,                       00140000
*    1. OBTAIN CORE FOR IOB-CHANNEL PROGRAMS AND INITIALIZE THOSE AREAS 00160000
*       (AN AUDIT TRAIL BIT IS SET TO INDICATE CORE WAS OBTAINED FOR    00170002
*       THE IOBS. THIS BIT WILL BE INTERROGATED BY THE FORCE CLOSE      00172002
*       EXECUTOR, SHOULD AN ABEND OCCUR DURING OPEN PROCESSING.)        00174002
*    2. LOAD THE CHECK ROUTINE AND A WRITE ROUTINE.                     00180000
*                                                                       00200000
*ENTRY POINT- ENTRY IS TO THE FIRST BYTE OF CODE BY A XCTL ISSUED BY    00220000
*    THE PREVIOUS EXECUTOR.                                             00240000
*                                                                       00260000
*INPUT- REGISTERS 5,6,7,8 HAVE BEEN POSITIONED AS FOLLOWS,              00280000
*    5 = BEGINNING OF THE OPEN PARAMETER LIST                           00300000
*    6 = BEGINNING OF THE WHERE-TO-GO TABLE  (WTG)                      00320000
*    7 = CURRENT ENTRY IN THE PARAMETER LIST                            00340000
*    8 = CURRENT ENTRY IN THE WTG TABLE                                 00360000
*                                                                       00380000
*OUTPUT- THE SPECIFIED NUMBER OF IOB-CHANNEL PROGRAMS WILL BE LINKED TO 00400000
*    THE DCB, A CHECK AND A WRITE ROUTINE WILL HAVE BEEN LOADED AND     00420000
*    THEIR ADDRESSES INSERTED IN THE DCB AND THEIR ID'S INSERTED IN THE 00440000
*    DEB. THE REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT          00460000
*    NON-ZERO ENTRY IN THE PARAMETER LIST AND WTG TABLE.                00480000
*                                                                       00580000
*EXTERNAL ROUTINES-                                                     00600000
*                                                                       00620000
*EXIT- AT THE INSTRUCTION LABELED 'XCTLRTN', THE PARAMETERS FOR XCTL    00640000
*    ARE SET UP AND XCTL ISSUED FOR THE NEXT NON-ZERO ENTRY IN THE      00660000
*    WTG TABLE.                                                         00680000
*EXIT ABNORMAL-IF THE RECORD FORMAT IS NOT SPECIFIED (RECFM=0) OR       00680402
*    IF THE MACRF FIELD SPECIFIES EITHER INPUT MACRO(READ OR GET)       00680802
*    AN ERROR CONDITION EXISTS. CONTROL IS TRANSFERRED TO THE PROBLEM   00681202
*    DETERMINATION MODULE, IGG0196M, WHICH WILL ISSUE ABEND 013.        00681602
*                                                                       00682019
*    IF RECFM=F AND TRACK-OVERFLOW,IS SPECIFIED,EXECUTOR IGG0191M       00684019
*    WILL COMPLETE THE CONSTRUCTION OF IOBS AND CHANNEL PROGRAMS        00686019
*                                                                       00688019
*    OTHER THAN THE ABOVE,EXECUTOR IGG0199L WILL CONSTRUCT CHANNEL      00690019
*    PROGRAMS                                                           00692019
*                                                                       00700000
*TABLES/WORK AREA- 1. COMMUNICATION VECTOR TABLE (CVT) IS USED TO       00720000
*    LOCATE THE DIRECT ACCESS DEVICE TABLE, AND THE SVC DCB ADDRESS.    00740000
*    2.DIRECT ACCESS DEVICE TABLE (DADT) IS USED TO OBTAIN THE TRACK    00760000
*      LENGTH FOR THE DEVICE.                                           00780000
*    3.WHERE-TO-GO TABLE IS CONSTRUCTED BY THE INITIAL OPEN ROUTINE     00800000
*      AND CONSISTS OF,  2 BYTE ID OF THE FIRST EXECUTOR FOR THIS DCB   00820000
*                        3 BYTE TTR OF THAT EXECUTOR                    00840000
*                        3 BYTE ADDRESS OF A WORK AREA FOR THIS DCB     00860000
*    4.CORRESPONDING TO EACH ENTRY IN THE WTG TABLE IS AN ENTRY IN A    00880000
*      PARAMETER LIST,   1 BYTE ATTRIBUTE (INPUT, OUTPUT, UPDATE)       00900000
*                        3 BYTE DCB ADDRESS                             00920000
*                                                                       00940000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT, EXECUTED ENABLED, PRIVILEGED.   00960002
*    IT WILL EXECUTE IN DATA MANAGEMENT KEY FOR ALL BUT IOB CHAINING    00970002
*    WHICH WILL EXECUTE IN USER KEY.                                    00972002
*                                                                       00974002
*MACROS - MODESET,GETMAIN,LOAD,XCTL                                     00976002
         EJECT                                                          00980000
*                                                                       01000000
*                                                                       01020000
*   REGISTER USAGE                                                      01040000
*                                                                       01060000
         USING STEPONE,RBASE                                            01080000
         USING DEBBASIC,RDEB                                            01100002
         USING IHADCB,RDCB                                              01120000
         USING FORCORE,RCORE                                     Y01021 01140000
         USING WTG,RWTG                                                 01150003
         USING WTGENTRY,RWTGC                                           01152003
*                                                                       01160000
RE       EQU   0         WORK/PARAMETER REGISTER                        01180000
RF       EQU   1         WORK/PARAMETER REGISTER                        01200000
RDCB     EQU   2         DCB ADDRESS                                    01220000
RBASE    EQU   3         BASE FOR THIS MODULE                           01240000
RCORE    EQU   4         DCB WORK AREA ADDRESS                          01260000
RPAR     EQU   5         POINTER TO THE PARAMETER LIST                  01280000
RWTG     EQU   6         POINTER TO THE WHERE-TO-GO TABLE               01300000
RPARC    EQU   7         CURRENT ENTRY IN PARAMETER LIST                01320000
RWTGC    EQU   8         CURRENT ENTRY IN WHERE-TO-GO TABLE             01340000
RTIOT    EQU   9         TIOT ADDRESS                                   01360000
RWORK    EQU   9         WORK REGISTER                           Y02072 01370002
RUCB     EQU   10        UCB ADDRESS                                    01380000
RDEB     EQU   11        DEB ADDRESS                                    01400000
RB       EQU   12        WORK REGISTER                                  01420000
RC       EQU   13        WORK REGISTER                                  01440000
RD       EQU   14        WORK REGISTER                                  01460000
RJ       EQU   15        WORK/PARAMETER REGISTER                        01480000
*                                                                       01500000
*                                                                       01520000
*                                                                       01540000
         BALR  RBASE,0                 ESTABLISH BASE FOR THIS MODULE   01560000
STEPONE  L     RDCB,0(0,RPARC)         LOAD DCB ADDRESS                 01580000
         L     RCORE,4(0,RWTGC)        LOAD ADDRESS OF DCB WORK AREA    01600000
         L     RDEB,DCBDEBAD           LOAD DEB ADDRESS FROM DCB        01620000
*                                                                       01640000
*   INITIALIZE THE DCB FIELDS REQUIRED FOR THE LOADING OF THE DATA SET  01660000
*                                                                       01680000
         TM    DCBRECFM,X'C0'           WAS RECORD FORMAT OMITTED       01700002
         BNZ   NOTOMIT                  NO, CHECK V OR F         S20201 01720020
         LA    RE,105                   INTERNAL RET CODE IN R0 SA55520 01730002
         B     CALLPD                   BR TO PROB DETERMINATON SA55520 01740002
NOTOMIT  EQU   *                                                 S20201 01755020
         CLI   DCBMACR1,0               READ OR GET SPECIFIED   SA60763 01757002
         BE    NOTREAD                  BR IF NOT, OK           SA60763 01759002
         LA    RE,229                   INTERNAL RET CODE IN R0 SA60763 01759402
         B     CALLPD                   BR TO PROB DETERMINATON SA60763 01759802
NOTREAD  EQU   *                                                        01770002
         IC    RB,DCBDEVT               GET DEVICE TYPE FROM THE DCB    01780002
         LA    RD,15                    USE THE LO-ORDER 4 BITS AS AN   01800002
         NR    RB,RD                    OFFSET TO A ONE BYTE OFFSET IN  01820000
         L     RC,CVTPTR(0,0)           THE DEVICE TABLE                01840000
         USING CVT,RC                                                   01860003
         L     RC,CVTZDTAB              GET DADT ADDRESS FROM CVT       01880002
         DROP  RC                                                       01900000
         IC    RD,0(RB,RC)              PICK UP OFFSET ENTRY IN DADT    01920002
         AR    RC,RD                    COMBINE OFFSET BYTE,TABLE ADDR. 01940002
         USING DVCT,RC                  EST DEV CHAR TAB BASE    Y02072 01950002
         MVC   DCBTRBAL,DVCTRKLN        INITIALIZE TRACK BALANCE Y02072 01960002
         DROP  RC                       DROP DEV CHAR TAB BASE   Y02072 01970002
         ST    RC,DCBDVTBL              AND DEVICE TABLE ADDRESS        01980000
         XC    DCBCIND1(2),DCBCIND1     CLEAR INDICATOR BYTES           02060002
*                                                                       02080000
*   CALCULATE THE SIZE OF EACH IOB REQUIRED AND MULTIPLY BY THE NO. OF  02100000
*    IOBS. GET CORE AND CLEAR THAT CORE TO ZERO.                        02120000
*                                                                       02140000
         LA    RC,SZFNOWC               SET IOB SIZE TO FORMAT F,NO WC  02160002
         LA    RD,SZWCF                 PRE-SET WRITE CHECK INCREMENT   02180002
         TM    JFCBMASK+D6,NONCARN      IS THIS A REC REDY       S20201 02182020
*                                       DEVICE                   S20201 02184020
         BO    NOTCARN1                 NO,SKIP TWO INSTRUCTIONS S20201 02186020
         LA    RC,CARN24(RE,RC)         YES, INCREMENT C.P. AND  S20201 02188020
         LA    RD,CARN16(RE,RD)         WRTCHK PGM SIZE          S20201 02190020
NOTCARN1 EQU   *                                                 S20201 02192020
         TM    DCBRECFM,VORU            IS RECORD FORMAT FIXED          02220002
         BNO   NOTV                     YES,USE PRESET VALUES           02230002
         LA    RD,SZWCV                 SET WC INCR FOR V,U RECORDS     02240002
         LA    RC,SZVORU(0,RC)          INCREMENT FOR V,U RECORDS       02250002
         TM    JFCBMASK+D6,NONCARN      ARE WE TOYING WITH RPS   S20201 02251020
         BO    NOTV                     NO,SKIP NEXT TWO         S20201 02252020
*                                       INSTRUCTIONS             S20201 02253020
         LA    RD,CARN8(RE,RD)          YES, ALLOW FOR WRTCHK    S20201 02254020
*                                       V/U CCW'S AND FOR V/U           02255020
         LA    RC,CARN8(RE,RC)          CCWS                     S20201 02256020
NOTV     TM    DCBRECFM,OFLOWOPT        IS TRACK OVERFLOW TO BE USED    02260002
         BC    8,TSTWCOPT               NO, GO TEST WRITE CHECK OPTION  02300000
         LA    RC,OFLOWSZ               SET BASIC IOB SIZE              02320002
         LA    RD,OFLWCSZ               AND WRITE CHECK INCREMENT       02340000
         TM    JFCBMASK+D6,NONCARN      DOES DEVICE HAVE RPS     S20201 02342020
         BO    NOTCARN2                 NO,SKIP FOLLOWING        S20201 02344020
*                                       INSTRUCTIONS             S20201 02346020
         LA    RC,OVFLCARN(RE,RC)       YES, ALLOW SPACE TO BLD  S20201 02348020
*                                       AN OVERFLOW CHAN PGM            02350002
         LA    RD,OVFCARWC(RE,RD)       WITH WRT CHK             S20201 02352020
NOTCARN2 EQU   *                                                 S20201 02354020
         LA    RF,2                     INITIALIZE SEGMENT COUNT        02360002
         L     RB,DCBDVTBL              LOAD DEVICE CHAR TAB    SA55544 02370002
         USING DVCT,RB                  ESTABLISH DEVTAB BASE   SA55544 02380002
         SR    RE,RE                    CLEAR R0                SA55544 02382002
         IC    RE,DVCOVLB               GET LAST BLK OVERHEAD   SA55544 02390002
         TM    DVCFLAGS,DVC2BOV         IS IT 2 BYTE OVERHEAD   SA55544 02400002
         BNO   NOT2BYTE                 BRANCH IF NOT 2 BYTES   SA55544 02410002
         LH    RE,DVCOVHD               ELSE LOAD BOTH BYTES    SA55544 02412002
         DROP  RB                       DROP DEV CHAR TAB BASE  SA55544 02412402
NOT2BYTE EQU   *                                                SA55544 02414002
         LH    RB,DCBTRBAL              LOAD TRACK BALANCE      SA55544 02416002
         SR    RB,RE                    SUBTR OVERHEAD OF LAST  SA55544 02418002
*                                       REC FROM TRK BALANCE    SA55544 02418802
         LH    RE,DCBBLKSI              SET REGISTER RE TO DATA SA55544 02420002
         BCTR  RE,0                     LENGTH MINUS ONE        SA55544 02440002
EACHSEG  SR    RE,RB                    (DATA LENGTH-1)-TRK LG  SA55544 02460002
         BC    12,OFLSZSET              ALL OVERFLOW SEGMENTS COUNTED   02480002
         LA    RC,OFLINCSZ(0,RC)        INCREMENT BOTH IOB SIZE         02500002
         LA    RD,OFLWCINC(0,RD)        REGISTERS                       02520000
         TM    JFCBMASK+D6,NONCARN      IS RPS FEATURED          S20201 02524020
         BO    NOTCARN3                 NO, SKIP RPS INSTRUCTION S20201 02528020
         LA    RC,OFCARSEG(RC)          YES, ALLOW FOR OVERFLOW ZA10231 02532037
NOTCARN3 EQU   *                                                 S20201 02536020
         LA    RF,1(0,RF)               INCREMENT SEGMENT COUNT         02540002
         B     EACHSEG                  LOOP                            02560002
*                                                                       02580000
OFLSZSET STC   RF,DCBEOBR+1             STORE SEGMENT COUNT IN DCB      02600002
*                                                                       02640000
TSTWCOPT TM    DCBOPTCD,WRTCHK          IS WRITE CHECK SPECIFIED        02720002
         BC    8,TSTNCP                 NO, GO DETERMINE NO. OF IOBS    02740000
         AR    RC,RD                    YES, ADD FOR WRITE CHECK CCWS   02760000
*                                                                       02800000
TSTNCP   SR    RB,RB                    INSERT NUMBER OF CHANNEL PGMS   02820002
         IC    RB,DCBNCP                                                02840000
         LTR   RB,RB                                                    02860000
         BC    7,*+8                                                    02880000
         LA    RB,1                     IF NOT SPECIFIED, ASSUME ONE    02900000
         STC   RB,DCBNCP                STORE DEFAULT IN DCB     S19015 02910019
         LR    RUCB,RB                  SAVE NO. OF CHANNEL PROGRAMS    02920002
         LR    RTIOT,RC                 SAVE IOB LENGTH                 02940002
         SRL   RTIOT,3                  DIVIDE FOR DOUBLE WORD COUNT    02960002
         STC   RTIOT,DCBIOBL            ST IOB LENGTH IN DOUBLE WORDS   02980002
         SLL   RTIOT,3                  RESTORE FULL IOB LENGTH         03000002
         MR    RB,RB                    MULTIPLY LENGTH X NUMBER        03020002
*                                                                       03040000
         TM    DCBRECFM,OFLOWOPT        IS TRACK OVERFLOW USED          03060002
         BC    8,GETIOBS                NO, GO TO GET CORE              03080000
         SR    RE,RE                    CLEAR REGISTER                  03100002
         L     RF,DCBDVTBL              GET ADDR OF THE DADT            03120002
         USING DVCT,RF                  EST DEV CHAR TAB BASE    Y02072 03130002
         SR    RB,RB                    CLEAR REGISTER                  03140002
         SR    RJ,RJ                    CLEAR REGISTER                  03160002
         IC    RJ,DVCOVLB               OVERHEAD FOR LAST RECORD Y02072 03180002
         TM    DVCFLAGS,DVC2BOV         TWO BYTE OVERHEAD USED   Y02072 03184002
         BNO   MZ0010                   BRANCH NO                S20201 03188020
         LH    RJ,DVCOVHD               GET TWO BYTE OVERHEAD    Y02072 03192002
MZ0010   EQU   *                                                 S20201 03196020
         IC    RE,DCBKEYLE              GET KEY LENGTH IF THERE IS ONE  03200002
         LTR   RE,RE                    TEST TO SEE IF THERE ARE KEYS   03220002
         BC    7,*+8                    YES GO ON, IF NOT               03240002
         IC    RB,DVCOVNK               GET OVERHEAD FOR KEYS    Y02072 03260002
         DROP  RF                       DROP DEV CHAR TAB BASE   Y02072 03270002
         SR    RJ,RB                    SUBTRACT KEY O'HEAD IF NO KEYS  03280002
         AR    RE,RJ                    ADD ON OVERHEAD                 03300002
         AH    RE,DCBBLKSI              DEVELOP KEY LENGTH PLUS DATA LG 03320002
         STH   RE,DCBOFFSR              STORE TOTAL LAST RECORD SIZE    03340002
         CH    RE,DCBTRBAL              COMPARE RECORD SIZE TO TRACK    03360002
         BNH   ADDERASE                 LENGTH. IF SMALLER BRANCH       03380000
         OI    DCBEOBW+3,X'FF'          MARK ERASE CCWS INCLUDED        03420002
ADDERASE EQU   *                                                        03440000
         LA    RC,ERSINC(0,RC)          ADD CORE FOR ERASE CCW  SA53272 03446002
         TM    JFCBMASK+D6,NONCARN      IS DEVICE RPS           SA53272 03452002
         BO    GETIOBS                  NO, GO GET CORE         SA53272 03458002
         LA    RC,CARN24(RE,RC)         YES, ADD MORE CORE FOR  SA53272 03464002
*                                       ERASE CCWS                      03470002
*                                                                       03480000
GETIOBS  EQU   *                        OBTAIN CORE FOR ALL IOBS AND    03500002
*                                       CHANNEL PROGRAMS                03520002
*                                                                       03530002
         MODESET  KEYADDR=DXUKEY,WORKREG=12  CHANGE TO USER KEY  Y02072 03532002
*                                                                       03534002
         LA    RE,SUBPOOL0              SET SUBPOOL NO. TO 0     Y02072 03540002
         SLL   RE,24                                                    03560000
         LR    RB,RC                    SAVE SIZE OF CORE        S20201 03562020
*                                       ACQUIRED                 S20201 03564002
         TM    JFCBMASK+D6,NONCARN      IS THIS RPS              S20201 03566020
         BO    GETSPACE                 NO, GO ISSUE A GETMAIN   S20201 03568020
         LA    RC,SECTAREA(0,RC)        ELSE INCREMENT FOR       S20201 03570020
*                                       SECTOR CORE              S20201 03572020
GETSPACE EQU   *                                                 S20201 03574020
         OR    RE,RC                    MOVE PARAMETER TO REGISTER 0    03580002
         GETMAIN R,LV=(0)                                               03600000
*                                                                       03620000
         MODESET  EXTKEY=DATAMGT        RETURN TO DATAMGT KEY    Y02072 03630002
*                                                                       03632002
         ST    RF,DCBIOBA               STORE FIRST IOB ADDRESS AND     03640002
         OI    DXATEXC1,FCAOIOB         SET AUDIT TRAIL BIT      Y02072 03642002
*                                       FOR FORCE CLOSE CLEANUP  Y02072 03644002
*                                       INDICATING IOBS GOTTEN   Y02072 03646002
         AR    RB,RF                    LOCATE SECTOR STORAGE    S20201 03650020
*                                       ADDR                     S20201 03660020
         LR    RE,RB                    SAVE SECTOR ADDRESS      S20201 03670020
         LR    RJ,RF                    SAVE ADDRESS OF IOB CORE        03700002
         IC    RD,CON255                SET BYTE COUNT FOR CLEAR INSTR. 03720002
         LR    RB,RC                    INITIALIZE RB TO TOTAL SIZE     03740002
*                                                                       03742002
         MODESET   KEYADDR=DXUKEY,WORKREG=13  CHANGE TO USER KEY TO    X03750002
                                        CHAIN THE IOBS           Y02072 03752002
LOOP     SH    RB,CON256                SUBTRACT LENGTH OF ONE CLEAR    03760002
         BC    12,LASTEX                IF ZERO OR MINUS GO FINISH CLR. 03780000
         EX    RD,CLRINST               EXECUTE A 256 BYTE CLEAR INSTR. 03800002
         LA    RF,256(0,RF)             INCREMENT THE AREA ADDRESS      03820002
         B     LOOP                     AND REPEAT                      03840000
*                                                                       03860000
CLRINST  XC    0(1,RF),0(RF)            EXECUTED-SET 256 BYTES TO ZERO  03880002
*                                                                       03900000
LASTEX   AR    RB,RD                    RESTORE RB TO LENGTH MINUS ONE  03920002
         EX    RB,CLRINST               AND CLEAR REMAINING LENGTH      03940000
*                                                                       03960000
*   LINK THE IOBS TOGETHER AND LINK THE FIRST ONE TO THE DCB.           03980000
*                                                                       04000000
         USING IOBBSAMN,RF              ESTABLISH IOB BASE              04020002
         LR    RF,RJ                    INITIALIZE TWO REGS TO IOB1     04040002
         ST    RE,IOBSTART              STORE SECTOR ADDRESS            04045002
*                                       TEMPORARILY                     04050002
         B     LINKIOB1                 GO TEST FOR LAST IOB FOUND      04060000
NEXTLINK AR    RJ,RTIOT                 INCREMENT BY IOB SIZE           04080002
         ST    RJ,IOBNIOBA              STORE AS FORWARD POINTER        04100002
         LR    RF,RJ                    INCREMENT IOB BASE TO NEXT IOB  04120002
LINKIOB1 OI    IOBFLAG2,IOBRRT3         MAKE EXCP RELATED REQ.   Y02072 04150002
*                                       PROCESSING TYPE 3        Y02072 04152002
         BCT   RUCB,NEXTLINK            TEST-ANY MORE IOBS BEYOND THIS  04154002
         L     RJ,DCBIOBA               NO, LOAD AND STORE ADDRESS OF   04160000
         ST    RJ,IOBNIOBA              IOB1 IN LAST IOB                04180002
         DROP  RF                                                       04180402
*                                                                       04182002
         MODESET  EXTKEY=DATAMGT        RETURN TO DATA MGT KEY   Y02072 04190002
*                                                                       04200002
         TM    DCBEOBW+3,X'FF'          ARE OVERFLOW ERASE CCWS NEEDED  04220002
         BC    12,NOERASE               NO, GO INITIALIZE IOBS          04240000
         AR    RF,RTIOT                 DEVELOP AND STORE THE ADDRESS   04260002
         ST    RF,DCBEOBW               OF THE ERASE CCWS               04280000
GETID2   MVC   WTGIDTTR,IDNEXT          ID OF NXT EXECUTOR FOR @Z30TSMI 04300003
         B     LDRTN                    THIS DCB, GO LOAD MODULES       04320000
*                                                                       04340000
*                                                                       04360000
NOERASE  EQU   *                                                        04380000
         TM    DCBRECFM,OFLOWOPT        IS OVERFLOW OPTION SELECTED     04400002
         BC    1,GETID2                 YES, GO MOVE NEXT ID-TTR        04420000
         MVC   WTGIDTTR,ID9L            MOVE ID OF IGG0199L    @Z30TSMI 04440003
*                                                                       06060000
*   LOAD THE CHECK ROUTINE AND THE PROPER WRITE ROUTINE.                06080000
*                                                                       06100000
LDRTN    EQU   *                                                        06120000
         IC    RUCB,DEBNMEXT            SET A REGISTER TO THE DEB       06140002
         SLL   RUCB,4                   SUBROUTINE ID FIELD             06160002
         LA    RUCB,DEBBASND-DEBBASIC(RUCB,RDEB)  POINT BEYOND   Y02072 06180002
*                                       DEVICE DEPENDENT SECTION Y02072 06190002
*                                       TO MODULE ID SECTION     Y02072 06192002
         SR    RF,RF                                                    06200000
         IC    RF,DEBAMLNG                                              06220000
         AR    RUCB,RF                                                  06240000
         LA    RC,IDCHK                 LOAD ADDR OF CHECK       S19015 06246019
*                                       ROUTINE ID               S19015 06252019
*                                                                       06260000
         TM    DCBRECFM,VORU            DETERMINE WHICH WRITE MODULE TO 06280002
         BC    1,LDWRTVU                LOAD                            06300000
         LA    RB,IDWRTF                POSITION POINTER TO WRITE F ID  06320002
         TM    DCBRECFM,OFLOWOPT        TRACK OVERFLOW TO BE USED       06340002
         BC    8,LDWRT                  NO, LOAD IGG019DA               06360000
         LA    RB,IDWRTOF               YES, LOAD IGG019DD              06380000
LDWRT    BAL   RTIOT,MODLOAD            GO TO THE LOAD ROUTINE          06400000
         IC    RF,DCBWRITE              SAVE TOP BYTE IN FIELD          06420002
         ST    RE,DCBWRITE              STORE WRITE ROUTINE ADDRESS     06440002
         STC   RF,DCBWRITE              IN THE DCB                      06460000
         LA    RB,IDCHK                 SET POINTER TO CHECK ROUTINE ID 06500002
         LR    RB,RC                    SET POINTER TO CHECK     S19015 06506019
*                                       ROUTINE I                S19015 06512019
         BAL   RTIOT,MODLOAD            GO LOAD CHECK                   06520000
         IC    RJ,DCBOPTCD              STORE THE ADDRESS IN THE DCB    06540002
         ST    RE,DCBCHECK              SAVING THE TOP BYTE             06560002
         STC   RJ,DCBOPTCD                                              06580000
         B     SCAN                     GO SCAN FOR ANOTHER DCB PARAM.  06600000
*                                       WHICH IS UNFINISHED             06620002
*                                                                       06621019
LDWRTVU  EQU   *                                                 S19015 06622019
*                                                                       06623019
*   THE FOLLOWING ROUTINE WILL CHECK FOR RECFM=VS AND BFTEK=R.          06624019
*    YES - LOAD 'CREAT BDAM WITH SOFTWARE TRACK-OVERFLOW' ROUTINES      06625019
*    NO  - LOAD NORMAL CREAT BDAM FORMAT V/U ROUTINE                    06626019
*                                                                       06627019
         TM    DCBBFTEK,SOFTTRK         TEST IF BFTEK=R IS       S19015 06628019
*                                       SPECIFIED                S19015 06629019
         BNO   LOADUV                   NO,GOTO LOAD NORMAL      S19015 06630019
*                                       ROUTINE                  S19015 06631019
*                                                                       06632019
*   WHEN RECFM=VS AND BFTEK=R,THE FOLLOWINGS ARE TO BE LOADED.          06633019
*        IGG019BR - WRITE ROUTINE                                       06634019
*        IGG019BS - CHECK ROUTINE                                       06635019
*        IGG019BT - C.E.A.                                              06636019
*                                                                       06637019
         LA    RB,IDBT                  LOAD ADDR OF C.E.A.      S19015 06638019
         BAL   RWORK,MODLOAD            GOTO LOAD ROUTINE        Y02072 06639002
         L     RWORK,DEBAPPAD           LOAD ADDR OF APP VECTOR  Y02072 06640002
*                                       TABLE                    S19015 06641019
         USING  DEBAVT,RWORK            ESTABLISH BASE FOR AVT   Y02072 06641402
         ST    RE,DEBCEA                STORE RTN ADDR IN AVT    Y02072 06642002
         ST    RE,DEBXCEA               STORE RTN ADDR IN AVT    Y02072 06644002
         DROP  RWORK                                             Y02072 06646002
         LA    RC,IDBS                   LOAD ADDR OF IGG019BS   S19015 06647701
         LA    RB,IDBR                   LOAD ADDR OF WRITE(VS)  S19015 06648002
         B     LDWRT                     GOTO LOAD WRITE ROUTINE S19015 06649002
*                                                                       06650019
*   NORMAL WRITE (CREATE BDAM) ROUTINE                                  06651019
*                                                                       06652019
LOADUV   EQU   *                                                 S19015 06653002
         LA    RB,IDWRTVU                LOAD ADDR OF NORMAL     S19015 06655002
*                                        WRITE RTN               S19015 06656002
         B     LDWRT                     GO BACK TO BRANCH TO LOAD      06660002
*                                                                       06680000
MODLOAD  EQU   *                        ROUTINE LOADS SPECIFIED MODULES 06700002
         MVC   6(2,RWTG),0(RB)          LOAD MODULE BY ID        Y02072 06740002
         LR    RE,RWTG                  SET PARAMETER REGISTER          06920002
         L     RF,CVTPTR(0,0)           GET THE LPALIB DCB ADDRESS      06940002
         USING CVT,RF                                                   06960003
         L     RF,CVTLINK               FROM THE CVT             YM1140 06980002
         DROP  RF                                                       07000000
*                                                                       07020000
         LOAD  EPLOC=(0),DCB=(1)        LOAD MODULE              Y02072 07040002
*                                                                       07060000
         MVC   0(2,RUCB),0(RB)          PUT SUBROUTINE ID IN THE DEB    07080002
         LA    RUCB,2(0,RUCB)           AND INCREMENT INDEX             07100000
         IC    RJ,DEBNMSUB              INCREMENT THE NUMBER OF         07120002
         LA    RJ,1(0,RJ)               SUBROUTINES FIELD IN THE DEB    07140000
         STC   RJ,DEBNMSUB                                              07160000
         BR    RTIOT                    RETURN TO THE BAL+4             07180002
*                                                                       07190002
*  GO TO PROBLEM DETERMINATION(IGG0196M) FOR WTP MESSAGE AND RET CODE   07200002
*                                                                       07210002
CALLPD   EQU   *                                                SA55520 07230002
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES     SA55520 07232002
         B     XCTLRTN                  BRANCH TO XCTL          SA55520 07234002
*                                                                       07240000
*   SCAN THE DCB PARAMETER LIST FOR ANOTHER REQUEST FOR THIS EXECUTOR   07260000
*    IF NONE ARE FOUND TRANSER CONTROL TO THE FIRST EXECUTOR FOUND.     07280000
*                                                                       07300000
SCAN    EQU   *                                                         07320000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT WHERE-TO-GO INDEX AND 07400002
         LA    RPARC,PAROFF(0,RPARC)    PARAMETER LIST INDEX            07420000
         CLC   0(2,RWTGC),AMIDCNST      IS THIS EXECUTOR NAMED AGAIN    07440002
         BCR   8,RBASE                  YES, RETURN TO STARTING POINT   07460000
         CLC   0(2,RWTGC),OPIDCNST      THIS END OF WHERE-TO-GO TABLE   07480002
         BC    7,SCAN                   NO, CONTINUE SCAN        Y02072 07500002
*                                                                       07520000
         LR    RPARC,RPAR               RESET PARAMETER LIST INDEX AND  07540002
         LA    RWTGC,32(0,RWTG)         WHERE-TO-GO INDEX TO ENTRY ONE  07560000
SCAN4ANY CLI   0(RWTGC),0               IS THIS DCB COMPLETED           07580002
         BC    7,XCTLRTN                NO, XCTL TO NAMED EXECUTOR      07600000
         LA    RWTGC,WGOFF(0,RWTGC)     YES, INCREMENT BOTH INDEX REG.S 07620000
         LA    RPARC,PAROFF(0,RPARC)                                    07640000
         BC    15,SCAN4ANY              AND CONTINUE SCAN               07660002
*                                                                       07680000
XCTLRTN  EQU   *                                                        07700000
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*07720003
               MODID=WTGENTRY           GO TO NEXT EXEC        @Z30TSMI 07770003
*                                                                       07800000
*********************************************************************** 07810002
*             CONSTANTS AND EQUATES                                     07820002
*********************************************************************** 07830002
*                                                                       07840000
WGOFF    EQU   8                       OFFSET OF ENTRIES IN WTG TABLE   07980000
PAROFF   EQU   4                       OFFSET OF ENTRIES IN PARAM. LIST 08000000
IDLENGTH EQU   2                        LEN OF ID PUT IN W-T-G   Y02072 08010002
TWO      EQU   2                        CONSTANT '2'             S19015 08028019
FIVE     EQU   5                        CONSTANT '5'             S19015 08030019
*                                                                       08032019
SUBPOOL0 EQU   0                        SUBPOOL 0 FOR USER KEY   Y02072 08032402
*                                                                       08036019
***************                                                         08040000
*                                                                       08060000
D6       EQU   6                        OFFSET TO JFCB REC REDY  S20201 08061020
*                                       BIT                      S20201 08062020
CARN8    EQU   8                        SIZE INCREMENT FOR       S20201 08063020
*                                       WRTCHK V/U               S20201 08064020
CARN16   EQU   16                       INCREMENT FOR REGULAR    S20201 08065020
*                                       WRTCHK                   S20201 08066020
CARN24   EQU   24                       CHAN PROG SIZE INCREMENT S20201 08067020
CARN32   EQU   32                       SIZE INCREMENT FOR V/U   S20201 08068020
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD INDIC  S20201 08069020
NONCARN  EQU   X'20'                    REC REDY TEST BIT        S20201 08070020
OVFLCARN EQU   48                       BASIC SIZE FOR OVFLO &   S20201 08071020
*                                       RPS                      S20201 08072020
OVFCARWC EQU   8                        OVFLO WRTCHK INCREMENT   S20201 08073020
OFCARSEG EQU   16                       OVFLO SEGMENT INCREMENT  S20201 08074020
OFCARWC  EQU   8                        OVFLO WRTCHK SEGMENT     S20201 08075020
*                                       INCREMENT                S20201 08076020
SECTAREA EQU   8                        SECTOR STORAGE AREA SIZE S20201 08077020
CARN80   EQU   80                       IOB OFFSET TO STORE      S20201 08078020
*                                       SECTOR STORAGE ADDRESS   S20201 08079002
*                                                                       08100000
*                                                                       08170019
NULL     EQU   0                        CONSTANT '0'             S19015 08200019
SPANNING EQU   X'08'                    RECFM=S SPECIFIED        S19015 08230019
SOFTTRK  EQU   X'20'                    BFTEK=R SPECIFIED        S19015 08260019
*                                       VECTOR                   S19015 08380019
*                                                                       08440000
TRKL     EQU   4              OFFSET TO TRACK LENGTH IN DADT            08460000
OFFLGTH  EQU   25             OFFSET IN WTG TABLE TO MODULE LGTH        08470001
SZFNOWC  EQU   128            SIZE OF IOB-RECORD FORM F, NO WRT.CHECK   08480000
SZVORU   EQU   32             SIZE INCREMENT FOR FORMAT V OR U          08500002
SZWCF    EQU   48             SIZE INCREMENT FOR WRITE CHECK - FORMAT F 08520002
SZWCV    EQU   24             SIZE INCREMENT FOR WR CHECK - FORMAT V,U  08540002
OFLOWSZ  EQU   208            SIZE(BASE) FOR OVERFLOW OPTION IOB        08560002
OFLWCSZ  EQU   64        SIZE OF WRITE CHECK FOR OVERFLOW (2 SEGMENTS)  08580000
OFLINCSZ EQU   80        SIZE INCREMENT FOR EACH ADDITIONAL SEGMENT     08600000
OFLWCINC EQU   16        SIZE INCREMENT FOR WRITE CHECK (PER SEGMENT)   08620000
ERSINC   EQU   80        SIZE INCREMENT FOR ERASE CCWS                  08640000
*                                                                       08660000
OFLOWOPT EQU   X'20'          TRACK OVERFLOW OPTION                     08680000
WRTCHK   EQU   X'80'          WRITE CHECK OPTION                        08700000
VORU     EQU   X'40'          RECORD FORM IS VARIABLE OR UNKNOWN-UNSPEC 08720000
FIRST    EQU   1              FIRST IOB IN CORE OBTAINED BY GETMAIN     08740000
*                                                                       08780000
*                                                                       08860000
IDWRTF   DC    C'DA'                    MODULE ID OF WR-FORMAT F Y02072 08900002
IDWRTVU  DC    C'DB'                    MODULE ID OF FORMAT V,U  Y02072 08920002
IDCHK    DC    C'DC'                    MODULE ID OF CHECK RTN   Y02072 08940002
IDWRTOF  DC    C'DD'                    MODULE ID OF WRT OVFLO   Y02072 08960002
IDNEXT   DC    C'1M',VL3(IGG0191M)      TRK  OVERFLOW          @Z30TSMI 08980003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETERMINATION MOD @Z30TSMI 08980403
*                                                                       08982019
*   FOLLOWINGS ARE FOR RECFM=VS AND BFTEK=R                             08984019
*                                                                       08986019
ID9L     DC    C'9L',VL3(IGG0199L)      ID/TTR OF NEXT EXEC    @Z30TSMI 08988003
IDBR     DC    C'BR'                    ID/TTR OF WRITE RTN      Y02072 08990002
IDBS     DC    C'BS'                    ID/TTR OF CHECK RTN      Y02072 08992002
IDBT     DC    C'BT'                    ID/TTR OF C.E.A.         Y02072 08994002
CON256   DC    H'256'                   CONSTANT                        08994402
CON255   DC    X'FF'                    CONSTANT 255                    08994802
OPIDCNST DC    C'0S'                    LAST WTG ENTRY (OPEN)           08994902
MODID    DC    CL6'IGG019'              MODULE ID                Y02072 08995202
AMIDCNST DC    C'1L'                    THIS EXECUTOR'S ID              08996002
FIX      DC    C'OZ10231'               LATEST FIX FLAG         ZA10231 08998037
DATE     DC    CL8'&SYSDATE'            DATE OF LATEST FIX      ZA10231 08998237
PATCH    DC    XL((*-IGG0191L)/20)'0'   5% PATCH AREA            Y02072 08998402
*                                                                       09000000
         EJECT                                                          09120000
*********************************************************************** 09130002
*                         DSECTS                                        09132002
*********************************************************************** 09134002
*                                                                       09160000
UCBTYPCD EQU   19             OFFSET TO TYPE CODE IN THE UCB            09180000
*                                                                       09200000
*                                                                       09220000
CVT      DSECT                                                          09240003
         CVT                                                            09260000
*                                                                       09280000
*                                                                       09300000
         DCBD  DSORG=(PS),DEVD=(DA)                                     09320000
         EJECT                                                          09322002
         IHADVCT   DSECT=YES                                     Y02072 09324002
         EJECT                                                          09328002
         IKJTCB                                                         09330001
         IEZIOB                                                  Y02072 09380002
         EJECT                                                          09430002
         IEZDEB                                                  Y02072 09480002
         EJECT                                                          10590000
         IECDSECS  (MAIN,(IOB,NO)),WTG,PREFX,EXPAND=YES        @Z30TSMI 10592003
FORCORE  DSECT                          WORKAREA DSECT CONTINUED Y02072 10602002
*****   THE FOLLOWING ARE AUDIT TRAIL BITS SET FOR FORCE CLOSE    ***** 10612002
         IHAFCAUD  ORG=YES                                       Y02072 10612802
         END                                                            10620000
./  ADD  SSI=43080954,NAME=IGG0191M
 TITLE   'IGG0191M - OPEN EXECUTOR, BSAM LOAD MODE, TRK OVERFLOW'       00020402
IGG0191M CSECT                                                          00030402
*                                                                     * 00032002
*MODULE NAME - IGG0191M                                               * 00034002
*                                                                     * 00036002
*DESCRIPTIVE NAME - BDAM CREATE OPEN EXECUTOR FOR TRACK OVERFLOW      * 00036402
*                                                                     * 00036802
*COPYRIGHT - NONE                                                     * 00036902
*                                                                     * 00038202
*CHANGE ACTIVITY                                                      * 00040202
*                                                                     * 00040602
*          RELEASE 19 DELETIONS/CHANGES                                 00040702
*1351000221-000400,023830-023950                                 A25961 00040802
*          RELEASE 20 DELETIONS/CHANGES                                 00040902
*0982014800,015600,016000-016200,017400,022400-022600,026800-    S20201 00042202
*0982027000,028000-028200,029800-030400,032200-032400,035200,    S20201 00043502
*0982035800,036200-036400,036800-037600,038400-039000,039800-    S20201 00044802
*0982040000,040600-040800,041200,041800-042000,044400-046200,    S20201 00046102
*0982047600,049200,062200                                        S20201 00047402
*          RELEASE VS2-2 DELETIONS/CHANGES                              00057402
*037020,058800,060900                                            Y02072 00067402
*                                                                YM3029 00077402
*                                                                YM2886 00079402
*016000-016200,017200-017400                                     YM7300 00079802
*          RELEASE VS2-3 DELETIONS/CHANGES                              00079903
*                                                              @Z30TSMI 00080003
*STATUS CHANGE LEVEL 005                                                00100002
*                                                                       00110002
*FUNCTIONS- THIS ROUTINE IS GIVEN CONTROL FOLLOWING IGG0191L TO,        00120000
*    1. INITIALIZE IOBS AND CONSTRUCT ATTACHED CHANNEL PROGRAMS,        00140000
*    2. CONSTRUCT A COMMON SEQUENCE OF CCWS TO ERASE TRACKS WHICH MUST  00160000
*       BE SKIPPED OVER AT THE END OF AN EXTENT                         00180002
*    3. COPY DCB BACK INTO USER CORE - (AN AUDIT TRAIL BIT WILL BE      00190002
*       SET IN THE OPEN WORKAREA TO INDICATE THAT THE DCB WAS           00192002
*       COPIED BACK. THIS BIT WILL BE INTERROGATED BY THE FORCE         00194002
*       CLOSE EXECUTOR, SHOULD AN ABEND OCCUR DURING OPEN PRO-          00196002
*       CESSING. IF THIS BIT IS ON THE FORCE CLOSE EXECUTOR WILL        00198002
*       GIVE CONTROL TO NORMAL CLOSE EXECUTORS.)                        00198402
*                                                                       00200000
*ENTRY POINT- ENTRY IS TO THE FIRST BYTE OF CODE BY A XCTL ISSUED BY    00220000
*    THE PREVIOUS EXECUTOR.                                             00240000
*                                                                       00260000
*INPUT- REGISTERS 5,6,7,8 HAVE BEEN POSITIONED AS FOLLOWS,              00280000
*    5 = BEGINNING OF THE OPEN PARAMETER LIST                           00300000
*    6 = BEGINNING OF THE WHERE-TO-GO TABLE  (WTG)                      00320000
*    7 = CURRENT ENTRY IN THE PARAMETER LIST                            00340000
*    8 = CURRENT ENTRY IN THE WTG TABLE                                 00360000
*                                                                       00380000
*OUTPUT- THE SPECIFIED NUMBER OF IOB-CHANNEL PROGRAMS WILL BE LINKED TO 00400000
*    THE DCB (DCBIOBA), A SEQUENCE OF ERASE CCWS WILL BE LINKED TO THE  00420000
*    DCB (DCBEOBW) IF IT IS NEEDED (KEY LENGTH + DATA LENGTH EXCEEDS    00440000
*    TRACK LENGTH).                                                     00460000
*                                                                       00480000
*EXTERNAL ROUTINES-                                                     00500000
*                                                                       00520000
*EXIT- AT THE INSTRUCTION LABELED 'XCTLRTN', THE PARAMETERS FOR XCTL    00540000
*    ARE SET UP AND XCTL ISSUED FOR THE NEXT NON-ZERO ENTRY IN THE      00560000
*    WTG TABLE. FROM THIS EXECUTOR CONTROL WILL BE TRANSFERRED TO       00580002
*    IGG0190S, THE LAST LOAD OF COMMON OPEN.                            00590002
*                                                                       00600000
*TABLES/WORK AREAS-                                                     00620000
*    1. WHERE-TO-GO TABLE IS CONSTRUCTED BY AN INITIAL OPEN ROUTINE     00640000
*       AND CONSISTS OF, 2 BYTE ID OF THE FIRST EXECUTOR FOR THIS DCB   00660002
*                        3 BYTE TTR OF THAT EXECUTOR                    00680000
*                        3 BYTE ADDRESS OF A WORK AREA FOR THIS DCB     00700000
*    2. CORRESPONDING TO EACH ENTRY IN THE WTG TABLE IS AN ENTRY IN A   00720000
*       PARAMETER LIST,  1 BYTE ATTRIBUTE (INPUT, OUTPUT, UPDATE)       00740002
*                        3 BYTE DCB ADDRESS                             00760000
*                                                                       00780000
*ATTRIBUTES- THIS ROUTINE IS REENTRANT, EXECUTED ENABLED, PRIVILEGED.   00800002
*    IT EXECUTES IN DATA MANAGEMENT KEY FOR ALL BUT IOB INITIALIZING    00810002
*    WHICH IS EXECUTED IN USER KEY.                                     00810402
         EJECT                                                          00820000
*                                                                       00840000
*                                                                       00860000
*   REGISTER USAGE                                                      00880000
*                                                                       00900000
         USING STEPONE,RBASE                                            00920000
         USING DEBBASIC,RDEB                                            00940002
         USING IHADCB,RDCB                                              00960000
         USING FORCORE,RCORE                                     Y01021 00970000
         USING WTG,RWTG                                                 00972003
         USING WTGENTRY,RWTGC                                           00974003
*                                                                       00980000
*                                                                       01000000
RE       EQU   0         WORK/PARAMETER REGISTER                        01020000
R0       EQU   0         SAVE REG FOR IECRES                     Y02072 01030002
RF       EQU   1         WORK/PARAMETER REGISTER                        01040000
RDCB     EQU   2         DCB ADDRESS                                    01060000
RBASE    EQU   3         BASE FOR THIS MODULE                           01080000
RCORE    EQU   4         DCB WORK AREA ADDRESS                          01100000
RPAR     EQU   5         POINTER TO THE PARAMETER LIST                  01120000
RWTG     EQU   6         POINTER TO THE WHERE-TO-GO TABLE               01140000
RPARC    EQU   7         CURRENT ENTRY IN PARAMETER LIST                01160000
RWTGC    EQU   8         CURRENT ENTRY IN WHERE-TO-GO TABLE             01180000
RTIOT    EQU   9         TIOT ADDRESS                                   01200000
RUCB     EQU   10        UCB ADDRESS                                    01220000
RDEB     EQU   11        DEB ADDRESS                                    01240000
RB       EQU   12        WORK REGISTER                                  01260000
RC       EQU   13        WORK REGISTER                                  01280000
RD       EQU   14        WORK REGISTER                                  01300000
RJ       EQU   15        WORK/PARAMETER REGISTER                        01320000
R15      EQU   15        SAVE REG FOR IECRES                     Y02072 01330002
*                                                                       01340000
*                                                                       01360000
*                                                                       01380000
         BALR  RBASE,0                 ESTABLISH BASE FOR THIS MODULE   01400000
STEPONE  L     RDCB,0(0,RPARC)         LOAD DCB ADDRESS                 01420000
         L     RCORE,4(0,RWTGC)         LOAD ADDRESS OF DCB WORK AREA   01440002
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS FROM DCB       01460002
         LH    RJ,DCBOFFSR              LOAD TOTAL LAST RECORD   S20201 01470020
*                                       SIZE                     S20201 01480020
         SR    RF,RF                                                    01500000
COUNTSEG EQU   *                                                        01520000
         LA    RF,1(0,RF)               ADD ONE TO SEGMENT COUNT        01540002
         SH    RJ,DCBTRBAL              SUBTRACT TRACK LENGTH    S20201 01550020
*                                       FROM                     S20201 01560020
         BP    COUNTSEG                 RECORD REMAINDER. FITS BRANCH   01580002
         LA    RB,DEBBASND              LOAD ADDR TO DEV DEP     Y02072 01630002
*                                       SECTION OF THE DEB       Y02072 01640002
         USING DEBDASD,RB               ESTABLISH BASE FOR DEV   Y02072 01650002
*                                       DEPENDENT DEB SECTION    Y02072 01652002
COMPARE  EQU   *                                                        01660000
         CH    RF,DEBNMTRK              WILL ONE RECORD FIT IN   Y02072 01680002
         BH    ABENDNRC                 EXTENT. NO, ABEND               01700002
         DROP  RB                                                Y02072 01750002
*                                                                       01760000
*                                                                       01780000
*   INITIALIZE THE IOBS AND ATTACH A CHANNEL PROGRAM TO EACH.           01800000
*                                                                       01820000
         MODESET   KEYADDR=DXUKEY,WORKREG=1  CHANGE TO USER KEY  Y02072 01830002
*                                                                       01832002
         USING IOBBSAMN,RF              ESTABLISH IOB BASE              01840002
         L     RF,DCBIOBA               LOAD START OF IOB AREA AS IOB 1 01860002
         OI    IOBNFLG1,IOBFIRST        MARK IOB AS FIRST               01880002
         L     RE,IOBSTART              GET SECTOR ADDRESS              01890002
*                                                                       01900000
FILLIOB  MVC   IOBDNRCF+5(1),DCBKEYLE  PUT KEY LENGTH IN FIRST COUNT    01920000
         L     RB,DXUDCBAD              GET USERS DCB ADDR       Y02072 01970002
         LA    RB,0(RB)                 ZERO TOP BYTE            Y02072 01972002
         ST    RB,IOBDCBPT              STORE DCB ADDR IN IOB    Y02072 01974002
         SR    RB,RB                    CLEAR SEGMENT COUNTER           01980002
         LA    RC,IOBDNRCF              POSITION CCW INDEX OVER COUNTS  02000002
         LR    RD,RC                    SAVE POINTER TO CURRENT COUNTS  02020002
         OI    IOBNFLG1,IOBWRITE        MARK IOB AS A WRITE IOB         02040002
*                                                                       02060000
BYPASSID LA    RC,24(0,RC)                                              02080000
         LA    RB,1(0,RB)              ADD 1 TO SEGMENT COUNTER         02100000
         EX    RB,CLICHK               ARE ALL COUNT FIELDS BYPASSED    02120000
         BC    7,BYPASSID               NO, LOOP                        02140000
*                                                                       02160000
*      RC CONTAINS CCW 1 ADDRESS                                        02180002
*                                                                       02190002
         ST    RC,IOBSTART              START OF CHANNEL PROGRAM Y02072 02200002
         LA    RB,1                     SET SEGMENT COUNTER             02220002
         TM    JFCBMASK+D6,NONCARN      IS IT RECORD READY       S20201 02227020
         BO    NOTCARN1                 NO, THEN FORGET RPS      S20201 02234020
         BAL   RJ,CARNCCW               BRANCH TO INSERT RPS CCW S20201 02241020
         AH    RE,CONST1                POINT TO SECTOR=0        Y02072 02243002
NOTCARN1 EQU   *                                                 S20201 02255020
         LA    RJ,IOBCC                 CONSTRUCT INITIAL SRCH   Y02072 02262002
         ST    RJ,D0(RE,RC)             CCW ADDRESS AND          S20201 02269002
         MVI   0(RC),SCHIDEQ            OP-CODE                         02280000
*                                                                       02300000
BLDSEGMT EQU   *                                                        02320000
         ST    RC,8(0,RC)               STORE TIC ADDRESS               02340002
         MVC   4(5,RC),CCHN5TIC         AND MOVE SEARCH FLAGS,COUNT,TIC 02360000
*                                       OP-CODE.                        02380000
         EX    RB,CLICHK                IDENTIFY LAST SEQUENCE          02400002
         BNE   *+8                      OF CCWS                         02420000
         OI    13(RC),1                                                 02440018
         ST    RD,16(0,RC)              CONSTRUCT A WRITE               02460002
         MVI   16(RC),WRTCKD            COUNT-KEY-DATA CCW              02480000
         MVI   20(RC),DCHN                                              02500000
         MVI   23(RC),8                 MV COUNT FIELD INTO CCW         02520002
*                                                                       02540000
         LA    RC,32(0,RC)              INCREMENT CCW INDEX TO SRCH.CCW 02560002
         TM    JFCBMASK+D6,NONCARN      IS  RPS FEATURED         S20201 02562020
         BO    TSTWTCHK                 IF NOT, GO CHECK FOR WRT S20201 02564020
*                                       CHK                      S20201 02566020
         LA    RC,CARN8(RE,RC)          SKIP OVER TIC            S20201 02568020
         BAL   RJ,CARNCCW               NOW GO TO INSERT SET     S20201 02570020
*                                       SECTOR                   S20201 02572020
         B     NOTIC                    BRANCH AND CONTINUE C.P. S20201 02574020
TSTWTCHK EQU   *                                                 S20201 02576020
         TM    DCBOPTCD,WRTCHK          IF WRITE CHECK IS SPECIFIED     02580002
         BC    8,NOTIC                                                  02600000
         LA    RC,8(0,RC)               LEAVE ROOM FOR A TIC CCW        02620000
*                                                                       02640000
NOTIC    EQU   *                                                        02660000
         LA    RJ,CARN8(RE,RD)          DEVELOPE AND ST R0 CNT   S20201 02680020
         ST    RJ,D0(RE,RC)             ADDR IN SCH CCW          S20201 02700002
         MVI   0(RC),SCHIDEQ            MOVE SEARCH OP-CODE             02720002
         ST    RC,8(0,RC)               STORE SEARCH CCW ADDRESS AS TIC 02740002
         MVC   4(5,RC),CCHN5TIC         ADDRESS, MOVE FLAGS, COUNT, TIC 02760000
*                                       OP-CODE.                        02780000
         LA    RJ,CARN16(RE,RD)         CONSTRUCT CCW TO WRT R0  S20201 02800020
         ST    RJ,CARN16(RE,RC)         DATA FIELD               S20201 02820002
         MVI   16(RC),WRTD                                              02840000
         MVI   23(RC),8                                                 02860000
*                                                                       02880000
*                                                                       02900000
         TM    DCBOPTCD,WRTCHK          IF WRITE CHECK IS SPECIFIED     02920002
         BC    8,NORDR0                                                 02940000
         MVI   20(RC),CCHN              COMMAND CHAIN WRITE R0 CCW      02960002
         LA    RC,CARN24(RE,RC)         INCREMENT TO NEXT CCW    S20201 02962020
         TM    JFCBMASK+D6,NONCARN      DOES DEVICE FEATURE RPS  S20201 02964020
         BO    NOTCARN4                 NO, DONT PUT IN SET      S20201 02966020
*                                       SECTOR CCW               S20201 02968020
         BAL   RJ,CARNCCW               BRANCH & PUT IN SET      S20201 02970020
*                                       SECTOR CCW               S20201 02972020
*                                                                       02974020
NOTCARN4 EQU   *                                                 S20201 02976020
         MVI   D0(RC),RDR0              BLD A READ R0 CCW TO     S20201 02986020
         MVI   HALFCCW(RC),SILI+SKIP    VERIFY CAPACITY RECORD   S20201 02996002
         MVI   D7(RC),CNT16             INSERT CNT FIELD         S20201 03006020
         LA    RC,ONECCW(RE,RC)         JUMP OVER RD R0 CCW      S20201 03016020
         B     NORDRO1                  RC HAS ALREADY BEEN      S20201 03026020
*                                       UPDATED                  S20201 03036020
*                                                                       03060000
NORDR0   EQU   *                                                        03080000
         LA    RC,24(0,RC)              INCREMENT CCW INDEX TO NEXT CCW 03100002
NORDRO1  EQU   *                                                 S20201 03106020
*                                                                       03112020
         EX    RB,CLICHK                TEST- ALL SEGMENTS BUILT        03120000
         BC    8,TSTWCOPT               YES, GO TEST FOR WRITE CHECK    03140000
*                                                                       03160000
         LA    RB,1(0,RB)               INCREMENT SEGMENT COUNTER       03180002
         LA    RD,24(0,RD)              INCREMENT TO NEXT SET OF COUNTS 03200002
         LA    RJ,CARN8(RE,RD)          CONSTRUCT SCH ADDR AND   S20201 03220020
         ST    RJ,D0(RE,RC)             OP CODE OF INITIAL SCH   S20201 03240002
         MVI   0(RC),MTSCHID                                            03260000
         B     BLDSEGMT                 LOOP TO BUILD WRITE CCWS FOR    03280002
*                                       NEXT SEGMENT OF THE BLOCK.      03300000
*  THIS SMALL ROUTINE BUILDS AND INSERTS SET SECTOR COMMAND WORDS       03301020
CARNCCW  EQU   *                                                 S20201 03302020
         ST    RE,D0(RE,RC)             PUT SECT2 ADDR IN CCW    Y02072 03303002
*                                       RD & SET SECT USE SAME   Y02072 03303402
*                                       BYTE, 2ND BYTE IS 0      Y02072 03303802
         MVI   D0(RC),SETSECT           ALONG WITH THE SET       S20201 03304002
*                                       SECTOR COMMAND CODE             03305002
         MVI   HALFCCW(RC),CCHN         PUT IN CHAIN COMMAND     S20201 03306020
         MVI   D7(RC),RPSCNT            AND COUNT                S20201 03307020
         LA    RC,ONECCW(RE,RC)         INCREMENT CHAN PGM PTR   S20201 03308020
         BR    RJ                       RETURN TO CALLING        S20201 03309020
*                                       ROUTINE                  S20201 03310020
*                                                                       03311020
CLICHK   CLI   DCBEOBR+1,0  -EXECUTED--TEST ALL SEGMENTS CONSTRUCTED    03320000
*                                                                       03340000
*                                                                       03360000
ABENDNRC EQU   *                        GO TO PROB DETERMINATION Y02072 03380002
*                                       TO ABEND BECAUSE BLKSIZE Y02072 03390002
*                                       IS GREATER THAN 1ST EXT  Y02072 03400002
         DMABCOND   208,PDLOAD,REGSAVE=YES,RES=NO    CALL        Y02072X03430002
                                        PROBLEM DETERMINATION TO ABEND  03432002
         B     XCTLRTN                  GO TO XCTL TO 196M       Y02072 03442002
*                                                                       03460000
TSTWCOPT EQU   *                                                        03480000
*                                                                       03500000
         LA    RB,CARN8                 ASSUME WRT CHK AND PRIME S20201 03503020
*                                       REG                      S20201 03506020
         TM    JFCBMASK+D6,NONCARN      ANY RPS DEVICES AROUND   S20201 03509020
         BO    NOTCARN2                 NO, FORGET READ SECTOR   S20201 03512020
*                                       COMMAND                  S20201 03515020
         BCTR  RE,RE                    ELSE PT TO SECTOR1 BYTE  Y02072 03518002
         ST    RE,D0(RE,RC)             PUT IT IN ADDR FIELD OF  S20201 03521020
*                                       CCW                      S20201 03524020
         MVI   D0(RC),RDSECT            PUT IN RD SECT OP CODE   S20201 03527020
         MVI   D7(RC),RPSCNT            PUT IN COUNT             S20201 03530020
         LA    RC,ONECCW(RE,RC)         UPDATE PTR TO NEXT CCW   S20201 03533020
NOTCARN2 EQU   *                                                 S20201 03536020
         LA    RD,IOBDNRCF              AND COUNT FIELD INDEX           03540000
         TM    DCBOPTCD,WRTCHK          ARE WRITE CHECK CCWS NEEDED     03560002
         BZ    CKSEQCNT                 BRANCH IF YES            S20201 03570020
         SR    RB,RB                    ZERO OUT REG IF WRITE    S20201 03580020
*                                       CHECK                    S20201 03590020
*                                                                       03600000
         LA    RJ,IOBBB                 CONSTRUCT A SEEK CCW TO  Y02072 03620002
         ST    RJ,D0(RE,RC)             RETURN TO 1ST TRK        S20201 03640002
         MVI   0(RC),SEEKHH                                             03660000
         MVI   HALFCCW(RC),CCHN         SET COMMAND CHAIN BIT    S20201 03666020
         MVI   D7(RC),SIXCOUNT          SET COUNT TO SIX         S20201 03672020
         TM    JFCBMASK+D6,NONCARN      RPS I PRESUME            S20201 03678020
         BO    NOTCARN8                 SKIP FOLLOWING INSTR IF  S20201 03684020
*                                       NOT                      S20201 03690020
         LA    RC,ONECCW(RE,RC)         PT TO OPEN SPACE AND     S20201 03696020
         BAL   RJ,CARNCCW               BRANCH TO FILL IT WITH   S20201 03708020
*                                       SETSECT                  S20201 03714020
         SH    RC,EIGHT                 DECREMENT TO RESTORE     S20201 03720020
*                                       POINTER                  S20201 03726020
NOTCARN8 EQU   *                                                 S20201 03732020
*                                                                       03738020
         LR    RJ,RD                                             S20201 03744020
         ST    RJ,CARN8(RE,RC)                                   S20201 03750020
         MVI   CARN8(RC),SCHIDEQ        PUT SCHID EQ OP CODE TO  S20201 03756020
         LA    RJ,CARN8(RE,RC)          LOCATE THE NEW REC, AND  S20201 03762002
         ST    RJ,CARN16(RE,RC)         A TIC TO THE SCH CCW     S20201 03768002
         MVC   12(5,RC),CCHN5TIC                                        03780000
         MVI   24(RC),RDKD              CONSTRUCT A READ KEY-DATA CCW   03800002
         MVI   28(RC),SILI+SKIP         WITH SILI AND SKIP FLAGS SET    03820000
         SR    RJ,RJ                                             S20201 03830020
         IC    RJ,DCBKEYLE                                       S20201 03840020
         AH    RJ,DCBBLKSI              SET COUNT TO KEY LENGTH  S20201 03850020
*                                       PLUS                     S20201 03860020
         STH   RJ,D30(RE,RC)            DATA LENGTH              S20201 03870002
CKSEQCNT EQU   *                                                 S20201 03880020
         SR    RF,RF                    RESET SEGMENT COUNTER    S20201 03890020
*                                                                       03920000
*                                                                       03940000
UPBY24   LA    RD,24(0,RD)              SET INDEX TO FIRST SEQUENCE OF  03960002
         LA    RF,D1(RE,RF)             WRITE CCWS               S20201 03980002
         EX    RF,CLICHK                EXECUTE INSTR            S20201 04000020
         BC    7,UPBY24                                                 04020000
*                                                                       04040000
         LA    RJ,CARN8(RE,RC)          LOAD ADDR OF VERIFY CCW2 S20201 04042020
         TM    JFCBMASK+D6,NONCARN      TO RPS, OR NOT TO RPS    S20201 04044020
         BO    FILLTIC                  NO, FORGET NEXT TWO      S20201 04046020
*                                       INSTRS                   S20201 04048020
         SH    RC,SIXTEEN               POINT BACK TO 1ST WRTCHK S20201 04050020
*                                       CCW                      S20201 04052020
         AR    RC,RB                    POINT TO START OF WRT    S20201 04054020
*                                       CHK                      S20201 04056020
         LR    RJ,RC                    PUT IT INTO A POINTER    S20201 04058020
*                                       REGISTER                 S20201 04060020
         LA    RD,ONECCW(RE,RD)         YES, INCLUDE RPS CCW     S20201 04062020
         AR    RB,RB                    DOUBLE INCR FOR LATER    S20201 04064020
*                                       USE                      S20201 04066020
         B     FILLTICS                 BRANCH OUT OF CARNIVAL   S20201 04068020
*                                       RTN                      S20201 04070020
FILLTIC  EQU   *                                                 S20201 04072020
         LTR   RB,RB                    IS WRT CHK SPECIFIED     S20201 04074020
         BNZ   TSTFINI                  BRANCH IF NOT            S20201 04076020
*                                                                       04078020
FILLTICS ST    RJ,CARN32(RE,RD)         STORE AS TIC ADDR        S20201 04080020
         MVI   32(RD),TICOP             SET TIC OP-CODE                 04100002
         ST    RJ,CARN36(RE,RD)         ALSO ST ADDR IN IGNORED  S20201 04120020
         MVI   36(RD),CCHN+SILI         BYTES,SET FLAGS FOR NOP         04140000
         LA    RD,72(0,RD)              INCREMENT TO NEXT SEQUENCE      04160002
         TM    JFCBMASK+D6,NONCARN      IS THIS RPS I SEE BEFORE S20201 04165020
*                                       ME                       S20201 04170020
         BO    NOTCARN6                 NO, SKIP OVER PT UPDATE  S20201 04175020
*                                       RTN                      S20201 04180020
         LA    RD,CARN16(RE,RD)         PT TO RD SECT CCW        S20201 04185020
         SR    RD,RB                    COMMAND IF REC READY     S20201 04190002
NOTCARN6 EQU   *                                                 S20201 04195020
         LR    RJ,RC                    LOAD ADDRESS OF VERIFY   S20201 04200020
*                                       CCW 1                    S20201 04205020
         BCT   RF,FILLTICS              TEST-ALL TICS COMPLETED  S20201 04210020
*                                       BRANCH ON NO.                   04220000
*                                                                       04240000
*                                                                       04260000
TSTFINI  EQU   *                                                        04280000
         L     RF,DCBIOBA               RESTORE IOB BASE         S20201 04290020
         L     RF,IOBNIOBA              LOAD NEXT IOB ADDRESS    Y02072 04300002
*                                                                       04300402
         MODESET  EXTKEY=DATAMGT        RETURN TO DATAMGT KEY    Y02072X04302002
                                        TO STORE INTO DCB COPY   Y02072 04302402
*                                                                       04304002
         ST    RF,DCBIOBA               STORE NEXT IOB ADDR IF   S20201 04305020
*                                       THERE                    S20201 04310020
*                                       IS ONE OR PT BACK TO 1ST ONE    04315002
*                                                                       04317002
         MODESET  KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY  Y02072 04319002
*                                                                       04319402
         TM    IOBNFLG1,IOBFIRST        IS THIS ADDR OF IOB 1    Y02072 04320002
         BC    8,FILLIOB                NO, GO BUILD CCWS FOR THIS IOB  04340000
*                                                                       04360000
         SR    RJ,RJ                    ZERO OUT AN UPDATE       S20201 04366020
*                                       REGISTER                 S20201 04372020
         TM    DCBEOBW+3,X'01'          ARE ERASE CCWS REQUIRED         04380002
         BC    1,COMPDCB                NO, GO FILL DCB FIELDS          04400000
         L     RC,DCBEOBW               LOAD ADDRESS OF ERASE CCW AREA  04420002
         TM    JFCBMASK+D6,NONCARN      IS IT A BIRD, A PLANE,   S20201 04426020
*                                       RPS                      S20201 04432020
         BO    NOCARERS                 NO, FORGET THIS ROUTINE  S20201 04438020
         AH    RE,CONST1                POINT TO LAST SECTOR(=0) Y02072 04444002
         LR    RF,RC                    SAVE POINTER TO ERASE    S20201 04456020
*                                       CCW STAR                 S20201 04462020
         BAL   RJ,CARNCCW               BRANCH TO INSERT SET     S20201 04468020
*                                       SECTOR                   S20201 04474020
         LA    RJ,CARN8                 PRIME RPS UPDATER        S20201 04480020
         MVC   CARN24(ONECCW,RC),D0(RF) PUT TWO SET SECT OP      S20201 04486020
         MVC   CARN64(ONECCW,RC),D0(RF) CODES IN CCWS 5 AND 10   S20201 04492002
         LR    RE,RJ                    SAVE AN EIGHT BYTE DISP  S20201 04498020
*                                       FOR RR                   S20201 04504020
         B     NEXT01                   BRANCH                   S20201 04510020
NOCARERS EQU   *                                                 S20201 04516020
         SR    RE,RE                    HAVE A 0 DISP IF NON RPS S20201 04522020
NEXT01   EQU   *                                                 S20201 04528020
         LA    RB,CARN24(RJ,RC)         CCW4 OR 6 ADDR FOR TIC   S20201 04534020
         ST    RB,CARN32(RJ,RC)          ADDR IN CCW5 OR 7       S20201 04540020
         LA    RB,CARN48(RJ,RC)         CCW7 OR 9 ADDR FOR       S20201 04546020
         ST    RB,CARN48(RJ,RC)         ADDR IN ERASE CCW        S20201 04552002
         AR    RJ,RJ                    UPDATE INDEX IF RPS      S20201 04558020
         LA    RB,CARN72(RJ,RC)         LOAD ADDR OF R0 FIELD    S20201 04564020
         ST    RB,D0(RE,RC)             ST AS SCH ADDR IN CCW1   S20201 04570020
*                                       OR 2                     S20201 04576020
         ST    RC,CARN8(RE,RC)          TIC ADDR IN CCW2 OR 3    S20201 04582020
         ST    RB,CARN16(RE,RC)         DATA ADDR IN CCW3 OR 4   S20201 04588020
         BCTR  RB,RE                    ADDR OF R0 FIELD - 1     S20201 04594020
         ST    RB,CARN56(RJ,RC)         FOR RD-HOME-ADDR CCW8    S20201 04600020
*                                       OR CCW11                        04606002
*                                                                       04612020
*                                                                       04640000
         MVI   0(RC),SCHIDEQ            OP-CODE OF CCW 1                04660002
         MVC   4(5,RC),CCHN5TIC         FLAGS, COUNT OF CCW 1,TIC CCW 2 04680002
         MVI   16(RC),WRTD              WRITE DATA OP-CODE FOR CCW 3    04700002
         MVI   20(RC),SILI+CCHN         FLAGS FOR CCW3                  04720000
         MVI   23(RC),7                 COUNT FOR CCW3                  04740000
         LR    RJ,RC                    SAVE PT TO SCH-ID CCW    S20201 04748020
         AR    RC,RE                    INCREMENT PT OVER SET    S20201 04756020
*                                       SECT                     S20201 04764020
         MVC   CARN24(BYTEDEV,RC),D0(RJ)  MOVE SCH CCW AND TIC   S20201 04772020
         MVI   40(RC),READD             READ DATA OP-CODE TO CCW 6      04780002
         MVI   44(RC),CCHN+SILI+SKIP    FLAGS TO CCW6                   04800000
         MVI   47(RC),8                 COUNT OF 8 TO CCW 6             04820000
         MVI   48(RC),ERSOP             BUILD ERASE CCW 7 TO CLEAR      04840002
         MVI   52(RC),ERSFLG+CCHN       THE TRACK                       04860000
         MVI   55(RC),ERSCNT                                            04880000
         AR    RC,RE                    SKIP OVER CCW10 IF RPS   S20201 04890020
         MVI   56(RC),MTRDHA            MULTI-TRACK READ HOME ADDRESS   04900002
         MVC   D60(D5,RC),CCHN5TIC      FLAGS AND TIC CCW        S20201 04910020
         MVC   D65(D3,RC),DCBEOBW+D1    PUT IN CCW1 ADDR         S20201 04920020
*                                                                       04940000
*                                                                       04960000
*                                                                       04980000
COMPDCB  EQU   *                                                        05000000
*                                                                       05010002
         MODESET  EXTKEY=DATAMGT        RETURN TO DATAMGT KEY    Y02072 05012002
*                                                                       05014002
         DROP  RDEB                     DROP DEB BASE            Y02072 05018402
         USING DEBDASD-(DEBBASND-DEBBASIC),RDEB  ESTABLISH BASE  Y02072 05019202
*                                       DEVICE DEPENDENT SECTION Y02072 05019602
         LH    RE,DEBNMTRK              PUT NO. OF TRACKS IN EXTENT 1   05020002
         STH   RE,DCBWCPO               INTO DCB FOR WRITE ROUTINE      05040000
*                                                                       05060000
         DROP  RDEB                                              Y02072 05070002
         SR    RJ,RJ                    CLEAR WORK REGISTERS            05080002
         SR    RF,RF                                                    05100000
         SR    RE,RE                                                    05120000
         L     RC,DCBDVTBL             LOAD DEVICE TABLE ENTRY ADDRESS  05140000
         IC    RE,OVERK(0,RC)          DEVELOP THE BYTES REQUIRED FOR   05160000
         IC    RJ,DCBKEYLE              A MINIMUM SIZE SEGMENT.         05180000
         LTR   RJ,RJ                                                    05200000
         BZ    NOKEYS                   (KEY LENGTH + 1 + O'HEAD FOR A  05220000
         SR    RE,RE                     LAST RECORD)                   05240000
NOKEYS   EQU   *                                                        05260000
         IC    RF,OVERL(0,RC)                                           05280000
         TM    BYTEDEV(RC),TBOVHD       TWO BYTE OVERHEAD USED   S20201 05284020
         BNO   MZ0010                   BRANCH NO                S20201 05288020
         LH    RF,OVERI(RC)             GET TWO BYTE OVERHEAD    S20201 05292020
MZ0010   EQU   *                                                 S20201 05296020
         SR    RF,RE                                                    05300000
         LA    RE,1(RJ,RF)                                              05320000
         STH   RE,DCBEOBR+2             STORE INTO UNUSED AREA OF DCB   05340002
*                                                                       05360000
*                                                                       05380000
*********************************************************************** 05400000
*                                                                       05420000
*   SCAN THE DCB PARAMETER LIST FOR ANOTHER REQUEST FOR THIS EXECUTOR   05440000
*    IF NONE ARE FOUND TRANSER CONTROL TO THE FIRST EXECUTOR FOUND.     05460000
*                                                                       05480000
*********************************************************************** 05490002
SCAN     EQU   *                        BRANCH TO NEXT EXEC             05500002
         USING  DEBBASIC,RDEB           ESTAB DEB BASE           Y02072 05500102
         MVC   DEBDCBB,DXUDCBAD+1       REPLACE DCB COPY ADDR    Y02072 05500402
*                                       WITH USER DCB IN DEB     Y02072 05500802
         DROP  RDEB                                              Y02072 05501202
*                                                                       05502002
*  ISSUE A MACRO WHICH CALLS AN EXTERNAL ROUTINE TO COPY THE            05504002
*  PROTECTED DCB INTO THE USER'S DCB CORE.                              05506002
*                                                                       05508002
*                                                                       05515502
         IECRES  INIT,DCBCOPY=FRWKAR,STM=(R0,R15,WTGPREFX)       Y02072 05519002
*                                                                       05522502
         OI    DXATEXC1,FCAOCOPY        SET AUDIT TRAIL BIT      Y02072 05524502
*                                       FOR FORCE CLOSE CLEANUP  Y02072 05526502
*                                       INDICATING DCB COPIED    Y02072 05528502
         MVI   0(RWTGC),0               MARK THIS DCB FINISHED          05533002
*                                                                       05536502
SCAN4EQ  LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT WHERE-TO-GO INDEX AND 05540002
         LA    RPARC,PAROFF(0,RPARC)    PARAMETER LIST INDEX            05560000
         CLC   0(2,RWTGC),AMIDCNST      IS THIS EXECUTOR NAMED AGAIN    05580002
         BCR   8,RBASE                  YES, RETURN TO STARTING POINT   05600000
         CLC   0(2,RWTGC),OPIDCNST      IS THIS END OF WHERE-TO-GO TAB  05620002
         BC    7,SCAN4EQ                NO, CONTINUE SCAN               05640000
*                                                                       05660000
         LR    RPARC,RPAR               RESET PARAMETER LIST INDEX AND  05680002
         LA    RWTGC,32(0,RWTG)         WHERE-TO-GO INDEX TO ENTRY ONE  05700000
SCAN4ANY CLI   0(RWTGC),0               IS THIS DCB COMPLETED           05720002
         BC    7,XCTLRTN                NO, XCTL TO NAMED EXECUTOR      05740000
         LA    RWTGC,WGOFF(0,RWTGC)     YES, INCREMENT BOTH INDEX REGS  05760002
         LA    RPARC,PAROFF(0,RPARC)                                    05780000
         BC    15,SCAN4ANY              AND CONTINUE SCAN               05800002
*                                                                       05820000
XCTLRTN  EQU   *                                                        05840000
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*05860003
               MODID=WTGENTRY           GO TO NEXT LOAD        @Z30TSMI 05910003
         EJECT                                                          05970002
*                                                                       06100000
***************                                                         06120000
*                                                                       06140000
*                                                                       06140320
*      RPS CONSTANTS AND EQUATES                                        06140620
*                                                                       06140920
CONST1   DC    H'1'                     ONE BYTE DIFFERENCE BET  Y02072 06141202
*                                       SECTOR 1(RD AND SET) AND Y02072 06141302
*                                       SECTOR 2 (=0 FOR REC 0)  Y02072 06142502
EIGHT    DC    H'8'                     DECREASES PT TO CHAN     S20201 06143602
*                                       PROG BY 8                S20201 06144302
SIXTEEN  DC    H'16'                    DECREASES PT TO C.P. BY  S20201 06145002
*                                       16                       S20201 06145702
*                                                                       06146402
*                                                                       06147102
D0       EQU   0                        ZERO DISPLACEMENT        S20201 06147802
D1       EQU   1                        ONE BYTE DISPLACEMENT    S20201 06148502
D3       EQU   3                        THREE BYTE DISPLACEMENT  S20201 06149202
HALFCCW  EQU   4                        USED FOR HALF CCW        S20201 06149902
*                                       DISPLACEMENT             S20201 06150602
D5       EQU   5                        FIVE BYTE DISPLACEMENT   S20201 06151302
D6       EQU   6                        OFFSET IN JFCB FOR       S20201 06152002
*                                       CARNIVAL                 S20201 06152702
D7       EQU   7                        SEVEN BYTE DISPLACEMENT  S20201 06153402
ONECCW   EQU   8                        USED FOR FULL CCW        S20201 06154102
*                                       DISPLACEMENT             S20201 06154802
CARN8    EQU   8                        ONE CCW DISPLACEMENT     S20201 06155502
D14      EQU   14                       FOURTEEN BYTES           S20201 06156202
TWOCCW   EQU   16                       2 CCW DISPLACEMENT OR    S20201 06156902
*                                       LENTH                    S20201 06157602
CARN16   EQU   16                       USED FOR 2 CCW           S20201 06158302
*                                       DISPLACEMENT             S20201 06159002
CNT16    EQU   16                       COUNT OF SIXTEEN         S20201 06159702
CARN24   EQU   24                       USED FOR 3 CCW           S20201 06160402
*                                       DISPLACEMENT             S20201 06161102
CARN28   EQU   28                       USED FOR 3-1/2 CCW DISP  S20201 06161802
D30      EQU   30                       30 BYTE DISPLACEMENT     S20201 06162502
CARN32   EQU   32                       USED FOR FOUR CCW        S20201 06163202
*                                       DISPLACEMENT             S20201 06163902
CARN36   EQU   36                       USED FOR 4-1/2 CCW DISP  S20201 06164602
CARN48   EQU   48                       6 CCW DISPLACEMENT       S20201 06165302
CARN56   EQU   56                       USED FOR 7 CCW           S20201 06166002
*                                       DISPLACEMENT             S20201 06166702
D60      EQU   60                       60 BYTE DISPLACEMENT     S20201 06167402
CARN64   EQU   64                       USED FOR 8 CCW           S20201 06168102
*                                       DISPLACEMENT             S20201 06168802
D65      EQU   65                       65 BYTE DISPLACEMENT     S20201 06169502
CARN72   EQU   72                       USED FOR 9 CCW           S20201 06170202
*                                       DISPLACEMENT             S20201 06170902
CARN80   EQU   80                       USED FOR 10 CCW          S20201 06171602
*                                       DISPLACEMENT             S20201 06172302
*                                                                       06173002
*                                                                       06173702
NONCARN  EQU   X'20'                    TO TEST FOR RPS          S20201 06174402
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD INDIC  S20201 06175102
SETSECT  EQU   X'23'                    SET SECTOR COMMAND CODE  S20201 06175802
RDSECT   EQU   X'22'                    READ SECTOR COMMAND CODE S20201 06176502
*                                                                       06177202
*   OTHER CONSTANTS AND EQUATES                                         06177902
*                                                                       06178602
*                                                                       06179302
*                                                                       06180000
CCHN5TIC DC    X'4000000508'  COMMAND CHAIN, COUNT OF 5, TIC OP CODE    06200000
*                                                                       06240000
ERSOP    EQU   X'11'          ERASE OP-CODE                             06260000
ERSFLG   EQU   X'20'          SUPPRESS INCORRECT LENGTH                 06280000
ERSCNT   EQU   X'08'          COUNT OF 8                                06300000
*                                                                       06320000
SCHIDEQ  EQU   X'31'          SEARCH ID EQUAL OPERATION CODE            06340000
MTSCHID  EQU   X'B1'          MULTIPLE TRACK SEARCH ID EQUAL            06360000
MTRDHA   EQU   X'9A'          MULTIPLE TRACK READ HOME ADDRESS          06380000
SEEKHH   EQU   X'0B'          SEEK CCHH OP-CODE                         06400000
WRTCKD   EQU   X'1D'          WRITE COUNT, KEY, DATA OPERATION CODE     06420000
DCHN     EQU   X'80'          DATA CHAIN FLAG                           06440000
RDKD     EQU   X'0E'          READ KEY, DATA OPERATION CODE             06460000
CCHN     EQU   X'40'          COMMAND CHAIN FLAG                        06480000
WRTD     EQU   X'05'          WRITE DATA OPERATION CODE                 06500000
READD    EQU   X'06'          READ DATA OPERATION CODE                  06520000
RDR0     EQU   X'16'          READ RECORD ZERO OP-CODE                  06540000
TICOP    EQU   X'08'                    TIC OP-CODE                     06560002
SKIP     EQU   X'10'                    SKIP DATA TRANSFER              06580000
SILI     EQU   X'20'                    SUPPRESS INCORRECT LENGTH       06600002
RPSCNT   EQU   1                        1 BYTE COUNT             S20201 06606020
SIXCOUNT EQU   6                        COUNT OF SIX             S20201 06612020
*                                                                       06620000
WRTCHK   EQU   X'80'                   WRITE CHECK OPTION               06700002
VORU     EQU   X'40'                   RECORD FORM IS VARIABLE OR UNDEF 06720002
*                                                                       06780000
*              DIRECT ACCESS DEVICE TABLE (DADT) DEFINITION             06800000
*                                                                       06820000
MAXCC    EQU   0         TOTAL TRACKS, CYLINDERS                        06840000
TRKL     EQU   4         TRACK LENGTH                                   06860000
OVERI    EQU   6         OVERHEAD FOR INTERMEDIATE KEYED RECORD         06880000
OVERL    EQU   7         OVERHEAD FOR LAST (KEYED) RECORD ON TRACK      06900000
OVERK    EQU   8         OVERHEAD TO BE SUBTRACTED FOR NON-KEYED RECORD 06920000
BYTEDEV  EQU   9         FLAG BYTES                                     06940000
TOLER    EQU   10        TOLERANCE FACTOR                               06960000
*                                                                       06980000
WGOFF    EQU   8                        OFFSET OF ENTRIES IN WTG TABLE  06982002
PAROFF   EQU   4                        OFFSET OF ENTRIES IN PARAM LIST 06984002
OPIDCNST DC    C'0S'                    LAST WTG ENTRY (OPEN)           06984402
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DET MODULE ID     @Z30TSMI 06984803
MODID    DC    C'IGG019'                MODULE ID -2             Y02072 06986002
AMIDCNST DC    C'1M'                    THIS EXECUTOR'S ID              06990002
FIX      DC    C'@Z30TSMI'              LATEST FIX FLAG        @Z30TSMI 07040003
DATE     DC    C'10/18/74'              DATE OF LATEST FIX     @Z30TSMI 07050003
PATCH    DC    XL((*-IGG0191M)/20)'0'   5% PATCH AREA            Y02072 07070002
         EJECT                                                          07100000
*************** CONTROL BLOCK DEFINITIONS****************************** 07120002
*                                                                       07140000
UCBTYPCD EQU   19             OFFSET TO TYPE CODE IN THE UCB            07160000
*                                                                       07180000
*                                                                       07200000
         DCBD  DSORG=(PS),DEVD=(DA)                                     07260000
         EJECT                                                          07270002
         CVT   DSECT=YES                                         Y02072 07280002
         EJECT                                                          07290002
         IEZDEB                                                  Y02072 07292002
         EJECT                                                          08530000
         IECDSECS  (MAIN,(IOB,NO)),PREFX,WTG,EXPAND=YES          Y02072 08550002
FORCORE  DSECT                          WORKAREA DSECT CONTINUED Y02072 08550102
*****   THE FOLLOWING ARE AUDIT TRAIL BITS SET FOR FORCE CLOSE    ***** 08550202
         IHAFCAUD  ORG=YES                                       Y02072 08600202
*****                                                                   08610302
         EJECT                                                          08650302
         IEZIOB                                                  Y02072 08700302
*********************************************************************** 08750302
*  THE FOLLOWING DSECT FORMATS THE BDAM CREATE EXTENSION TO THE IOB   * 08800302
*********************************************************************** 08850302
         ORG   IOBSEEK+8                                                08900302
IOBDNRCF DS    D                        NEW RECORD COUNT FIELD   Y02072 08950302
IOBR0CNT DS    D                        COUNT FIELD OF R0        Y02072 09000302
IOBR0DAT DS    D                        DATA FIELD OF R0         Y02072 09050302
IOBDCCW1 DS    D                        1ST CCW                  Y02072 09100302
         END                                                            09150302
./  ADD  SSI=72410415,NAME=IGG0193A
193A     TITLE 'IGG0193A -  BDAM OPEN EXECUTOR'                         00010037
IGG0193A CSECT                                                          00189802
*********************************************************************** 00199802
*                                                                     * 00201802
*  MODULE NAME = IGG0193A                                             * 00203802
*                                                                     * 00204202
*  DESCRIPTIVE NAME = BDAM OPEN EXECUTOR                              * 00204602
*                                                                     * 00205902
*  COPYRIGHT = NONE                                                   * 00206302
*                                                                     * 00206702
*  STATUS = 001                                                       * 00207102
*                                                                     * 00207502
*                                                                     * 00208202
*  FUNCTION/OPERATION:                                                * 00210902
*   THIS ROUTINE, CONSISTING OF 7 FUNCTIONS, IS THE ONLY OPEN EXECUTOR* 00211302
*   DURING OPEN PROCESSING OF A DCB WITH DSORG=DA. IT INCORPORATES    * 00211602
*   THE FUNCTIONS ASSOCIATED IN EARLIER RELEASES WITH BDAM EXECUTORS, * 00212302
*   IGG0193C,IGG0193E,IGG0193G AND IGG0193F. THESE 4 EXECUTORS NO     * 00213002
*   LONGER EXIST AS OF VS 2,RELEASE 2.                                * 00213702
*                                                                     * 00214402
*   FUNCTION I:                                                       * 00215102
*   THIS ROUTINE(A) DETERMINES THE PROTECTED CORE REQUIRED FOR AN IOS * 00215802
*   APPENDAGE LIST AND THE DEB AND GETS THE REQUIRED CORE.THE 2ND HALF* 00216502
*   OF THIS ROUTINE(B) CONSTRUCTS THE DEB AND ATTACHES AS MANY EXTENTS* 00217202
*   AS ARE PRESENT IN THE DSCB(S).  IF THE BDAM DATA SET RESIDES ON   * 00217903
*   MSS VIRTUAL DASD, THE DEB IS USED TO BUILD AN EXTENT LIST FOR     * 00218003
*   ACQUIRING SPACE ON DASD FOR THAT DATA SET.                        * 00218103
*   IF THIS IS A VIO DATA SET AND THE DCBOPTCD FIELD SPECIFIES        * 00218637
*   EXTENDED SEARCH, THE DEB EXTENT WILL BE TRUNCATED TO THE TRUE     * 00218737
*   SIZE OF THE DATA SET AS DETERMINED BY THE LAST RECORD WRITTEN     * 00218837
*   DURING BDAM CREATE. THIS IS TO PREVENT SEARCHING OF UNUSED        * 00218937
*   TRACKS.                                                           * 00219037
*                                                                     * 00219137
*   FUNCTION II:                                                      * 00219302
*   THIS ROUTINE LOADS ALL REQUIRED BDAM MODULES AS SPECIFIED IN THE  * 00220002
*   DCB FIELDS- MACRF, RECFM, OPTCD, BUFTEK- AND STORES THEIR         * 00223002
*   MODULE ID AND A COUNT OF MODULES LOADED INTO THE DEB. MODULE      * 00223402
*   ADDRESSES ARE STORED IN THE DEBAVT OR DCB AS REQUIRED.            * 00223802
*                                                                     * 00224202
*   FUNCTION III:                                                     * 00224302
*   THIS ROUTINE INITIALIZES CERTAIN FIELDS IN THE DCB.  AN IRB IS    * 00224402
*   CONSTRUCTED AND ITS ADDRESS PLACED IN THE DEB.  IF EXCLUSIVE      * 00224502
*   CONTROL IS REQUESTED OR REQUIRED, THIS ROUTINE GETS CORE FOR      * 00224602
*   THE READ EXCLUSIVE LIST AND INITIALIZES IT.                       * 00224702
*                                                                     * 00224802
*   FUNCTION IV:                                                      * 00238402
*   IF RELATIVE BLOCK ADDRESSING IS SPECIFIED, THE RELATIVE EXTENTS   * 00238502
*   WILL BE APPENDED TO THE DEB WHICH HAS ALREADY BEEN CONSTRUCTED    * 00238602
*   IN FUNCTION I. THE FORMAT OF THESE RELATIVE EXTENTS IS,           * 00238702
*          BLOCKS PER TRACK - ONE BYTE                                * 00243802
*          BLOCKS PER EXTENT- THREE BYTES                             * 00244102
*   IF TRACK OVERFLOW IS ALSO SPECIFIED TWO ADDITIONAL FIELDS ARE     * 00244402
*   INSERTED BETWEEN THE RELATIVE AND ACTUAL EXTENTS. THESE ARE       * 00244702
*          TRACKS PER PERIOD                                          * 00245002
*          BLOCKS PER PERIOD                                          * 00245302
*                                                                     * 00245602
*   FUNCTION V:                                                       * 00245902
*   IF DYNAMIC BUFFERING IS SPECIFIED THIS ROUTINE WILL CALCULATE     * 00246202
*   AND OBTAIN (BY A GETMAIN) THE NUMBER OF BYTES REQUIRED FOR THE    * 00246502
*   BUFFERS AND FOR A BUFFER CONTROL BLOCK.  IT WILL DIVIDE THE       * 00246802
*   ACQUIRED AREA INTO A BUFFER CONTROL BLOCK AND THE SPECIFED        * 00247102
*   NUMBER OF BUFFERS. THIS FUNCTION IS APPLICABLE TO NON-VS FORMATS. * 00247402
*                                                                     * 00247702
*   FUNCTION VI:                                                      * 00248002
*   IF DYNAMIC BUFFERING IS SPECIFIED WITH VARIABLE SPANNED FORMAT    * 00248302
*   THIS ROUTINE WILL CALCULATE AND OBTAIN (BY A GETMAIN) THE NUMBER  * 00248602
*   OF BYTES REQUIRED FOR THE BUFFERS AND THE BUFFER CONTROL BLOCK.   * 00248902
*   IT WILL DIVIDE THE ACQUIRED AREA INTO A BUFFER CONTROL BLOCK      * 00249202
*   AND THE SPECIFIED NUMBER OF BUFFERS.                              * 00249502
*   IF DYNAMIC BUFFERING IS NOT SPECIFIED THIS ROUTINE WILL CALCULATE * 00249802
*   AND OBTAIN (BY A GETMAIN) THE NUMBER OF BYTES REQUIRED FOR A      * 00250102
*   SEGMENT WORKAREA POOL. IT WILL DIVIDE THE AREA INTO A BUFFER      * 00250402
*   CONTROL BLOCK AND THE SPECIFIED NUMBER OF SEGMENT WORKAREAS.      * 00250702
*                                                                     * 00251002
*   FUNCTION VII:                                                     * 00251302
*   THIS ROUTINE PREPARES FOR EXIT FROM THIS MODULE.  IT UPDATES THE  * 00251602
*   USER DCB BY MOVING THE DCB COPY FROM THE OPEN WORKAREA TO THE     * 00251902
*   USER'S DCB CORE. IT SEARCHES FOR THE NEXT MODULE IN THE PARM      * 00252202
*   LIST PREPARING TO RELOOP THROUGH THE MODULE SHOULD IT BE REQUIRED.* 00252502
*   IF NOT, AN XCTL IS ISSUED TO RETURN TO COMMON OPEN.               * 00252802
*                                                                     * 00253102
*                                                                     * 00253402
*  NOTES:                                                             * 00253702
*   EACH FUNCTION IS INDEPENDENT OF ALL PREVIOUS FUNCTIONS HAVING AS  * 00254002
*   THE ONLY INTERFACE THE ASSUMPTION THAT THE DCB ADDRESS IS IN      * 00254302
*   REGISTER 10,THE OPEN WORKAREA ADDRESS IS IN REGISTER 4, THE DEB   * 00254602
*   AVT ADDRESS IS IN REGISTER 9, AND THAT ENTRY TO EACH FUNCTION     * 00254902
*   IS IN DATA MANAGEMENT KEY.  FUNCTION VII ALSO ASSUMES THAT        * 00255202
*   FUNCTION I STORED COMMON OPEN'S REGISTERS IN THE OPEN WORKAREA    * 00255502
*   AT OFFSET DWASAVE.                                                * 00255802
*                                                                     * 00256102
*   THE DEB IS CONSTRUCTED, INCLUDING EXTENTS AND RELATIVE EXTENTS    * 00256402
*   IN DATA MANAGEMENT KEY, AS IS ALL INITIALIZATION TO THE DCB COPY. * 00256702
*   A MODESET IS ISSUED TO HANDLE ALL PROCESSING OF BUFFERS AND       * 00257002
*   SEGMENT WORKAREAS IN USER KEY.                                    * 00257302
*                                                                     * 00257402
*   AUDIT TRAIL BITS ARE SET AFTER EACH GETMAIN IS ISSUED TO GET CORE * 00257502
*   FOR WHICH IT IS THE RESPONSIBILITY OF THE BDAM CLOSE EXECUTOR,    * 00263102
*   IGG0203A, TO FREE.  THESE BITS ARE INTERROGATED BY THE FORCE      * 00265102
*   CLOSE EXECUTOR IF AN ABEND OCCURS DURING OPEN PROCESSING, BUT     * 00267102
*   AFTER THE DCB HAS BEEN COPIED BACK TO USER CORE. BITS ARE SET     * 00269102
*   TO INDICATE THAT A READ EXCLUSIVE LIST, A BUFFER CONTROL BLOCK    * 00271102
*   AND BUFFERS, AN USL LIST OR A SEGMENT WORKAREA WERE OBTAINED.     * 00271202
*   THE BITS ARE SET IN THE OPEN WORKAREA AT DXATEXC1.                * 00271302
*                                                                     * 00271502
*     DEPENDENCIES = NONE                                             * 00276802
*                                                                     * 00282402
*     DATA AREAS = NONE                                               * 00288002
*                                                                     * 00293602
*     RESTRICTIONS = IF AN EXTENT IS ALLOCATED AS A USER LABEL EXTENT * 00299202
*        (EXTENT TYPE CODE=X'40') IT WILL NOT BE REFLECTED IN THE DEB * 00304802
*        EXTENTS. THE USER LABEL EXTENT IS NOT INCLUDED IN F1 EXTENT  * 00310402
*        COUNT.                                                       * 00316002
*                                                                     * 00321602
*     REGISTER CONVENTIONS = SEE REGISTER EQUATES BELOW               * 00327202
*                                                                     * 00332802
*     PATCH LABEL = NONE                                              * 00338402
*                                                                     * 00344002
*  MODULE TYPE = OPEN EXECUTOR                                        * 00349602
*                                                                     * 00355202
*     PROCESSOR = ASSEMBLER XF                                        * 00360802
*                                                                     * 00366402
*     MODULE SIZE = 3800 DECIMAL BYTES                                * 00372002
*                                                                     * 00377602
*     ATTRIBUTES = REENTRANT,ENABLED,PRIVILEGED, ENTERED IN DATA      * 00383202
*       MANAGEMENT KEY. MODESET IS ISSUED TO DO BUFFER PROCESSING IN  * 00388802
*       USER KEY.                                                     * 00394402
*                                                                     * 00400002
*                                                                     * 00405602
*  ENTRY POINT = 'FUNCT1'                                             * 00411202
*                                                                     * 00416802
*     PURPOSE = SEE FUNCTION                                          * 00422402
*                                                                     * 00428002
*     LINKAGE = THIS MODULE RECEIVES CONTROL EITHER FROM COMMON OPEN  * 00433602
*       OR ANOTHER EXECUTOR WHEN ITS ID APPEARS AS THE NEXT NON-ZERO  * 00439202
*       ENTRY IN THE WTG TABLE.                                       * 00444802
*                                                                     * 00450402
*     INPUT - INPUTS TO THIS ROUTINE ARE                              * 00456002
*        REGISTER 5 - BEGINNING OF THE DCB PARAMETER LIST             * 00461602
*        REGISTER 6 - BEGINNING OF THE WHERE-TO-GO TABLE (WTG)        * 00467202
*        REGISTER 7 - BEGINNING OF THE CURRENT ENTRY IN THE DCB       * 00472802
*                     PARAMETER LIST                                  * 00478402
*        REGISTER 8 - ADDRESS OF THE CURRENT ENTRY IN THE WTG         * 00484002
*                                                                     * 00489602
*        OPEN WORKAREA - CONTAINS FORMAT1 DSCB, DCB COPY, PARM LIST,  * 00495202
*          USER DCB ADDRESS AND KEY, DEB EXTENSION ADDRESS, SAVEAREA, * 00500802
*          WTG TABLE, AND AT LOCATION DXCCW7, THE CCHHR OF THE FORMAT * 00506402
*          ONE DSCB. ALL THESE FIELDS ARE REFERENCED BY THIS MODULE,  * 00512002
*          THEIR PARTICULAR LABELS AS FOLLOWS:                        * 00517602
*                      DWASAVE  - SAVE OPEN'S REGISTERS               * 00523202
*                      DSCNOEXT - 1ST DSCB NO. OF EXTENTS             * 00528802
*                      DSCEXTYP - SPLIT CYL FLAG                      * 00534402
*                      DWATTCTR - TT COUNTER                          * 00540002
*                      DWASAVE2 - REG SAVE FOR CNVRT RTN              * 00545602
*                      DXDAADDR - ADDR FIELD PASSED TO CNVRT RTN      * 00551202
*                      DXATEXC1 - AUDIT TRAIL BYTE FOR FORCE CLOSE    * 00553202
*                      DXDEBXAD - DEB EXTENTSION PTR                  * 00556802
*                      DWAFLAGS - FLAG BYTE USED BY 193A              * 00562402
*                      DWATRKLN - TRK LENGTH SAVEAREA                 * 00568002
*                      DWADVTOL - OVERHEAD SAVED HERE                 * 00573602
*                      DWARCOVH - OVERHEAD+-KEY OVERHEAD              * 00579202
*                      DWARCTKY - OVERHEAD+ KEY LENGTH                * 00584802
*                      DWARLREC - REC LEN+ OVERHEAD, LAST REC         * 00590402
*                      DWARNREC - REC LEN+ OVERHEAD, MIDDLE REC       * 00596002
*                      DWATTRKS - TOTAL NUMBER OF TRACKS              * 00601602
*                      DWAOFLOW - SAVEAREA FOR REMAINING BYTES        * 00607202
*                      DXUKEY   - USER KEY                            * 00612802
*                      DXUDCBAD - USER DCB ADDRESS                    * 00618402
*                      DXUDCBPL - LENGTH OF NULL PREFIX               * 00624002
*                      DXUDCBML - NUMBER OF BYTES COPIED              * 00629602
*                      DXCCW12  - PASSED TO XCTL                      * 00635202
*                      DXCALLID - PROBLEM DETERMINATION PARMLIST      * 00640802
*                      DXREG9   - SAVEAREA FOR REGS DURING PROB DET   * 00646402
*                                                                     * 00652002
*        SYSTEM CONTROL BLOCKS REFERENCED BY IGG0193A:                * 00657602
*                                       CVT                           * 00663202
*                                       UCB                           * 00668802
*                                       TCB                           * 00674402
*                                       TIOT                          * 00680002
*                                       DVCT                          * 00685602
*                                                                     * 00691202
*                                                                     * 00696802
*     OUTPUT = THIS ROUTINE XCTLS TO COMMON OPEN. REGISTERS 5 AND 6   * 00702402
*        ARE LEFT UNCHANGED. REGISTERS 7 AND 8 ARE POSITIONED TO      * 00708002
*        THE NEXT UNCOMPLETED ENTRY IN THE PARM LIST AND WTG TABLE.   * 00713602
*                                                                     * 00719202
*           CONTROL BLOCKS/DATA AREAS BUILT OR INITIALIZED:           * 00724802
*                          DEB INCLUDING RELATIVE EXTENTS             * 00730402
*                          IRB                                        * 00736002
*                          BCB INCLUDING BUFFERS                      * 00741602
*                          SWA INCLUDING BUFFERS                      * 00747202
*                          READ EXCLUSIVE LIST                        * 00752802
*                          DCB                                        * 00758402
*                                                                     * 00764002
*           ALL REQUIRED MODULES WILL HAVE BEEN LOADED.               * 00769602
*                                                                     * 00775202
*                                                                     * 00780802
*     EXIT-NORMAL = XCTL BACK TO COMMON OPEN IF SCAN OF THE WTG TABLE * 00786402
*        DOES NOT FIND A NON-ZERO ENTRY. OTHERWISE AN XCTL IS MADE    * 00792002
*        TO THE FIRST NON-ZERO ENTRY IN THE TABLE.                    * 00797602
*                                                                     * 00803202
*     EXIT-ABNORMAL = THERE ARE 4 OCCASIONS TO ENTER THE ERREXIT RTN, * 00808803
*        WHICH ISSUES A DMABCOND MACRO TO GO TO PROBLEM DETERMINA-    * 00814402
*        TION BEFORE ABENDING.  THE ENTRY IS MADE IF BUFL=0 FOR       * 00820002
*        A DYNAMIC BUFFERING REQUEST, IF THE MACRF FIELD WAS NOT      * 00825602
*        SPECIFIED, IF THERE ARE NO EXTENTS, OR IF THE ICBACREL       * 00831203
*        MACRO RETURNS AN ERROR CODE.                                 * 00831703
*                                                                     * 00836802
*  EXTERNAL REFERENCES = NONE                                         * 00842402
*                                                                     * 00848002
*     ROUTINES:  SYSTEM CONVERT ROUTINE                               * 00853602
*                GETMAIN(SVC 10) IS CALLED TO GET DEB,RDXLIST,BUFFERS * 00859202
*                DEBCHK(SVC 117) IS CALLED FOR DEB VALIDITY CHECK     * 00864802
*                XCTL(SVC 7) IS CALLED TO PASS CONTROL                * 00870402
*                LOAD(SVC 8) IS CALLED TO LOAD BDAM MODULES           * 00876003
*                ICBACREL(SVC 126) ACQUIRE MSS DASD SPACE             * 00889303
*                                                                     * 00893903
*                                                                     * 00898503
*  TABLES/WORK AREAS- 1.DCB PARAMETER LIST IS THE ADDRESS OF EACH DCB * 00903103
*   SPECIFIED IN THE OPEN MACRO INSTRUCTION. THE HI-ORDER BYTE        * 00907703
*   CONTAINS A CODE INDICATING THE MODE (INPUT, OUTPUT, UPDATE).      * 00912303
*   2.WHERE-TO-GO TABLE CONTAINS THE ID AND TTR OF THE ROUTINE WHICH  * 00916903
*   IS TO PROCESS THE CORRESPONDING DCB AND THE ADDRESS OF A WORK AREA* 00921503
*   ASSIGNED TO THAT DCB.                                             * 00926103
*   3.WORK AREA IS A TEMPORARY AREA USED BY THIS ROUTINE              * 00930703
*   AS A REGISTER SAVE AREA AND WORKAREA AS DESCRIBED ABOVE.          * 00935303
*   4.COMMUNICATION VECTOR TABLE IS A RESIDENT VECTOR LIST USED TO    * 00939903
*   LOCATE THE CONVERT ROUTINE, AND THE TASK CONTROL BLOCK.           * 00944503
*                                                                     * 00949103
*                                                                     * 00954402
*  MACROS = GETMAIN, DEBCHK, MODESET, XCTL, LOAD, ICBACREL, IECRES    * 00960003
*                                                                     * 00965602
*                                                                     * 00971202
*                                                                     * 00976802
*  CHANGE ACTIVITY = AS FOLLOWS:                                      * 00982402
*                                                                     * 00988002
*                    OS 21 DELETIONS/CHANGES                          * 00993602
*                                                               A44855  00999202
*                                                               M1795   01004802
*                                                               SM4356  01010402
*                                                               SA49438 01016002
*                                                               M0024   01021602
*                                                               S21042  01027202
*                                                               A35339  01032802
*                                                               A30797  01038402
*                                                               SA53239 01044002
*                                                               SA60608 01046002
*                    VS1-1 DELETIONS/CHANGES                            01049602
*                                                               XM6189  01055202
*                    VS1-2 DELETIONS/CHANGES                            01060802
*                    VS1-3 DELETIONS/CHANGES                            01066402
*                    VS2-1 DELETIONS/CHANGES                            01072002
*                                                                YM3693 01077602
*                    VS2-2 DELETIONS/CHANGES                            01083202
*                                                                YM7957 01083602
*                                                                YM1383 01085202
*                                                                YM1394 01087202
*                                                                YM1140 01088002
*                                                                YM1421 01088402
*                                                                YM1489 01088502
*                                                                YM3057 01091703
*                                                                YM2368 01096303
*                                                                YM2886 01100902
*                                                                YM5761 01110902
*                                                                YM7386 01112902
*                    VS2-3 DELETIONS/CHANGES                            01113003
*                                                              @Y30LSBS 01115037
*                                                              @ZA04216 01117037
*D107602-109563                                                 ZA02523 01117402
*A013101,108095-110429                                          ZA02523 01119402
*A063057,063058                                                 ZA09152 01128437
*                    UPDATES SUBSEQUENT TO VS2-3                        01130437
*                                                                       01132437
*D106334-106346,106348-116350                                  @ZA08000 01133437
*                    UPDATES SUBSEQUENT TO VS2-3.7                      01134437
*A033660,C051000,D051200-051300                                @ZA17540 01135437
*********************************************************************** 01137802
         EJECT                                                          01150002
*********************************************************************** 01200002
****                                                               **** 01240002
****     REGISTER USAGE                                            **** 01260002
****                                                               **** 01280002
*********************************************************************** 01290002
         SPACE                                                          01292002
R0       EQU   0                        PARAMETER REGISTER              01310002
RWRK0    EQU   0                        WORK REG (IV)           ZA02523 01310102
REVEN    EQU   0                        EVEN REG OF EVEN/ODD PAIR       01310402
RCTR     EQU   0                        COUNTER REGISTER (I)   @Y30LSBS 01320403
R1       EQU   1                        PARAMETER REGISTER              01330002
RODD     EQU   1                        ODD REG OF EVEN/ODD PAIR        01330402
RETURN   EQU   2                        RETURN REG FOR INTERNAL SUBRTNS 01332402
R2       EQU   2                        PARM REG TO CONVERT RTN  Y02072 01352002
RBASE    EQU   3                        BASE OF THIS ROUTINE            01360002
RCORE    EQU   4                        WORK AREA ADDRESS               01380002
RPAR     EQU   5                        PARAMETER LIST ADDRESS          01400002
RTCB     EQU   5                        TCB BASE REG                    01400402
RXTENT   EQU   5                        ADDR OF CURRENT DSCB EXT(I)     01400802
RDEBAM   EQU   5                        BASE FOR DEB EXTENT(IV)         01401202
RAOFFS   EQU   5                        RECORD AREA OFFSET((VI)         01401602
RWTG     EQU   6                        FRONT OF WHERE-TO-GO TABLE      01420002
RMSSUCB  EQU   6                        MSS UCB BASE REG (I)   @Y30LSBS 01430003
RDVCT    EQU   6                        DEVICE CHAR TABLE(IV,V,VI)      01432002
RDEBAMX  EQU   6                        DEB REL EXT BASE(IV)            01434002
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 01440002
RBUFR    EQU   7                        BUFFER ADDRESS(VI)              01450002
RDEBEXT  EQU   7                        DEB EXT BASE(II,IV)             01452002
RBCB     EQU   7                        BUFFER CONTROL BLK BASE(V)      01454002
RWTGC    EQU   8                        CURRENT ENTRY IN WTG            01460002
RLEN     EQU   8                        BCB LENGTH(VI)                  01470002
RDSCB    EQU   8                        DSCB BASE(I)                    01480002
RDSSSZ   EQU   8                        DATA SET SIZE(IV)               01482002
R9       EQU   9                        PARAMETER REGISTER              01490002
RDEBA    EQU   9                        DEBAVT BASE REG(I,II,III)       01500002
RDCB     EQU   10                       DCB BASE REG                    01502002
RDEBSZ   EQU   11                       DEB SIZE REQUIRED(I)            01512002
RXTNMAX  EQU   11                       MAXIMUM NO. OF EXTENTS(I)       01522002
RPARPTR  EQU   11                       PARAMETER POINTER(I)   @Y30LSBS 01524003
RNRCD    EQU   11                       RECS/PERIOD OR RECS/EXT(IV)     01532002
RBUFLN   EQU   11                       BUFFER LENGTH(V,VI)             01534002
RXTNTOT  EQU   12                       TOTAL NO. OF EXTENTS(I)         01544002
RNTRK    EQU   12                       TRKS/PERIOD OR RECS/PERIOD(IV)  01546002
RBUFNO   EQU   12                       BUFFER NUMBER(V,VI)             01586002
RXTNCUR  EQU   13                       CURRENT EXTENT BASE(I,IV)       01586402
RSWA     EQU   13                       PTR TO SEGMENT WORK AREA(VI)    01588002
RPOOLSZ  EQU   13                       SIZE OF BUFFER POOL(V,VI)       01598002
R14      EQU   14                       RETURN ADDRESS REGISTER         01610002
RWRKX    EQU   14                       WORK REGISTER                   01620002
REXTN    EQU   14                       NUMBER OF DEB EXT(I)   @Y30LSBS 01622003
REXTB    EQU   15                       ACQUIRE EXT BASE (I)   @Y30LSBS 01622403
R15      EQU   15                       ENTRY ADDR AND RETURN CODE REG  01624002
RWRKY    EQU   15                       WORK REGISTER                   01634002
*                                       IECRES MACRO IS FIXED           01634302
         SPACE 3                                                        01634402
*********************************************************************** 01636002
****                                                               **** 01638002
****     MASKS, DISPLACEMENTS, AND OTHER EQUATES                   **** 01638402
****                                                               **** 01638802
*********************************************************************** 01640002
         SPACE                                                          01650002
DEBSEEKF EQU   X'08'                    USED TO INHIBIT ALL SEEKS       01652002
OUTPUT   EQU   X'0F'                    DCB BEING OPENED FOR OUT Y02072 01654102
DEBIDFYR EQU   X'0F'                    IDENTIFIER FOR A DEB            01662102
DEBWSEEK EQU   X'10'                    USED TO PERMIT WRITES AND SEEKS 01663302
DSCULABL EQU   X'40'                    USER LABEL EXTENT               01664502
DEBSEEKN EQU   X'50'                    USED TO PERMIT SEEKS            01665702
DSCSPLIT EQU   X'80'                    SPLIT CYLINDER EXTENT           01666902
DSCYLBDY EQU   X'81'                    EXTENT ON CYLINDER BOUNDARIES   01668102
UCB23051 EQU   X'06'                    UCB TYPE BIT FOR 2305-1  Y02072 01670502
UCB23052 EQU   X'07'                    UCB TYPE BIT FOR 2305-2  YO2072 01671702
FORMAT2  EQU   X'02'                    ID FOR FORMAT 2 DSCB     Y02072 01672902
FRMT1KEY EQU   44                       KEY FOR FORMAT 1 -       Y02072 01674102
*                                       NEEDED TO ADJUST FOR     Y02072 01675302
OPPATRUB EQU   0                        OFFSET TO ATTRIBUTE BYTE        01677702
DUMYXTNT EQU   1                        USED TO IND A DUMMY DEB EXTENT  01678902
IDINCR   EQU   2                        CORE REQUIRED FOR MODULE ID'S   01680102
TIMES4   EQU   2                        USED TO MULT REG CONTENTS BY 4  01681302
F1XTENTS EQU   3                        NUMBER OF EXTENTS IN A F1 DSCB  01682502
F3XTNTS1 EQU   4                        NUMBER OF EXTENTS IN FIRST      01683702
*                                       EXTENT SECTION OF A F3 DSCB     01684902
TIMES16  EQU   4                        USED TO MULT REG CONTENTS BY 16 01686102
OPMEXSCL EQU   4                        DEB EXTENT SIZE SCALE           01688502
CCHHRLNG EQU   5                        LENGTH OF CCHHR FIELD           01689702
OFLOINCR EQU   8                        EXTRA SIZE FOR OVERFLOW RECORDS 01692102
F3XTNTS2 EQU   9                        NUMBER OF EXTENTS IN SECOND     01693302
*                                       EXTENT SECTION OF A F3 DSCB     01694502
USERPOOL EQU   0                        REQUEST SPACE IN SP0     Y02072 01695702
POOL230  EQU   230                      REQUEST SPACE IN SP230   Y02072 01696902
NEXTVOL  EQU   6                        JFCB OFFSET FOR VOL NO  SA53239 01698102
PD51     EQU   51                       INTERNAL RET CODE IF DYN Y02072 01698202
*                                       BUF AND BUFL=0           Y02072 01698302
PD111    EQU   111                      INTERNAL RET CODE IF   @Y30LSBS 01698403
*                                       MSS ACQUIRE FAILS      @Y30LSBS 01699803
PD211    EQU   211                      INTERNAL RET CODE IF     Y02072 01701803
*                                       MACRF NOT A,K OR I       Y02072 01703203
PD212    EQU   212                      INTERNAL RET CODE IF NO  Y02072 01704603
*                                       PRIMARY EXTENT           Y02072 01706003
BLANK    EQU   X'40'                    BLANK TO TEST JFCBVOL   SA53239 01707403
NOSUBRTN EQU   0                        NO SUBROUTINES LOADED BY OPEN   01714403
RELTRKAD EQU   8                        OFFSET TO RELATIVE TRACK        01715803
*                                       CONVERSION MODULE ADDRESS       01717203
ASYNCAD  EQU   16                       OFFSET TO ASYNCHRONOUS          01718603
*                                       INTERRUPT ROUTINE ADDRESS       01720003
DYNOFFST EQU   2                        BYTES TO NEXT DYN BUF ID Y02072 01724203
VERIFYAD EQU   12                       OFFSET TO VERIFY MODULE ADDRESS 01725603
ADDR     EQU   B'0111'                  MASK FOR STORING 24-BIT ADDRESS 01727003
BFRNUM1  EQU   1                        FIRST BUFFER IN AVAILABLE       01728403
*                                       BUFFER QUEUE                    01729803
BFRNUM2  EQU   2                        BEGINNING OF BUFFER CHAIN TO BE 01731203
*                                       INITIALIZED                     01732603
BFRDFALT EQU   2                        DEFAULT VALUE WHEN NO. OF BFRS  01734003
*                                       IS NOT SPECIFIED FOR DYN BFRING 01735403
CCHHLG   EQU   4                        LENGTH OF CCHH           YM5761 01736803
FOURBYTS EQU   4                        USED TO ADD 4 BYTES TO AN ADDR  01738203
FWDBNDRY EQU   4                        USED TO ALIGN TO A FW BOUNDARY  01739603
RNDFCTOR EQU   7                        FACTOR USED FOR ROUNDING        01741003
NOTDOUBL EQU   7                        USED TO TEST FOR DOUBLE WD QUAN 01742403
DOUBLEWD EQU   8                        LENGTH OF A DOUBLE WORD         01743803
MULTOF4  EQU   3                        USED TO ROUND NUMBER OF BFRS TO 01748003
*                                       A MULTIPLE OF 4                 01749403
FWRNDFTR EQU   3                        USED IN ROUNDING TO A FULLWORD  01750803
*                                       BOUNDARY                        01752203
         EJECT                                                          01771803
*********************************************************************** 01782202
*  FUNCTION I: THIS FUNCTION DETERMINES THE AMOUNT OF CORE REQUIRED   * 01792202
*  FOR THE DEB, GETS THE CORE AND BUILDS THE DEB EXTENTS, TAKING      * 01802202
*  THE EXTENT INFORMATION FROM THE DSCBS READ INTO THE OPEN WORKAREA  * 01812202
*  BY COMMON OPEN. THIS ROUTINE PROCESSES IN DATA MANAGEMENT KEY      * 01822202
*  EXCEPT FOR CHAINING THE DEB OFF THE TCB IN SUPERVISOR KEY.         * 01823002
*  INPUT TO THIS FUNCTION IS AS FOLLOWS:                              * 01823402
*              REGISTER INPUT AS DESCRIBED IN THE PROLOGUE            * 01823802
*              OPEN WORKAREA AS DESCRIBED IN THE PROLOGUE             * 01831502
*              DATA MANAGEMENT KEY                                    * 01839202
*  OUTPUT FROM THIS FUNCTION IS AS FOLLOWS:                           * 01841202
*              REGISTER 4 = OPEN WORKAREA ADDRESS                     * 01841602
*              REGISTER 9 = DEB AVT ADDRESS                           * 01842002
*              REGISTER 10 = DCB ADDRESS                              * 01843202
*              DCBDEBAD CONTAINS DEB ADDRESS                          * 01845602
*              COMMON OPEN'S REGISTERS 0-9 STORED AT DWASAVE          * 01846002
*              DEB CONSTRUCTED AND PRIMARY EXTENTS INITIALIZED        * 01846402
*********************************************************************** 01846902
         SPACE                                                          01854602
FUNCT1   EQU   *                        BEGINNING OF MODULE             01862302
         USING PSA,0                    ESTABLISH PSA DSECT      Y02072 01864302
         USING WTGENTRY,RWTGC           ESTABLISH WTG ENTRY BASE REG    01870002
         USING PARML,RPARC              ESTABLISH PARMLIST BASE         01872002
         BALR  RBASE,0                  ESTABLISH BASE FOR THIS ROUTINE 01880002
         USING *,RBASE                  BASE REG LOCATION FOR ASSEMBLY  01890002
         L     RDCB,PARDCBAD            LOAD DCB BASE ADDRESS           01900002
         DROP  RPARC                                                    01902002
         USING IHADCB,RDCB              ESTABLISH DCB BASE REG          01910002
         L     RCORE,WTGCORE-1          SET WORK AREA POINTER           01920002
         USING FORCORE,RCORE            ESTABLISH WORK AREA BASE REG    01930002
         DROP  RWTGC                                                    01932002
         STM   R0,R9,DWASAVE            SAVE OPEN REGS IN WKAREA        01934002
         TM    DCBRECFM,DCBRECL         IF RECORD FORMAT HAS NOT BEEN   01960002
         BNZ   RECFMOK                  SPECIFIED AS F, V, OR U         01980002
         OI    DCBRECFM,DCBRECU         ASSUME U                        02000002
*                                                                       02020000
RECFMOK  EQU   *                                                        02030002
         NI    DCBOPTCD,X'FF'-(DCBOPTDB+DCBOPTRE+DCBOPTTO) TURN OFF     02032002
*                                       BUF AND READ EXCLUSIVE, TRK     02034002
*                                       OVERFLO IF MERGED FROM DSCB     02036002
         TM    DCBMACF1,DCBMRRDK+DCBMRRDI  READ TYPE ID AND/OR KEY      02040002
         BNZ   FUNCT1A                  YES, DCB IS OK                  02060002
         TM    DCBMACF2,DCBMRWRK+DCBMRIDW+DCBMRAWR  IS WRITE TYPE KEY,  02080002
*                                       ID, OR ADD                      02090002
         BNZ   FUNCT1A                  YES, DCB IS OK                  02100002
         LA    R0,PD211                 LOAD INTERNAL RET CODE   Y02072 02102002
*                                       INDICATING MACRF DID NOT Y02072 02102402
*                                       SPECIFY A, K OR I        Y02072 02102802
         B     ERREXIT                  BR TO ERROR EXIT         Y02072 02104002
         SPACE 2                                                        02110002
****                                                                    02160002
****CALCULATE DEB CORE NEEDED FOR MODULE IDS DETERMINING THE AVT CORE   02192002
****REQUIREMENTS AND CORE NEEDED FOR PRIMARY AND RELATIVE EXTENTS. THE  02202002
****TOTAL CORE REQUIRED IS ACCUMULATED IN RWRK2.                        02202402
****                                                                    02204002
FUNCT1A  EQU   *                        CALCULATE CORE REQUIRED         02216102
         LA    RWRKX,IDINCR             SET CONSTANT TO 2 BYTES  A35339 02217402
         LA    RDEBSZ,2*IDINCR          CORE FOR FDN.,CE-XCE IDS Y02072 02220002
         AR    RDEBSZ,RWRKX             ADD TWO BYTES FOR SIO/ @ZA08000 02270037
*                                       DYNBUF -ALWAYS LOADED  @ZA08000 02320037
         TM    DCBMACF2,DCBMRAWR        IS ONE OF THE FORMAT MODULES    02460037
*                                       NEEDED                          02462002
         BZ    TACT                     NO, GO TEST ADDRESSING    M6121 02470002
         AR    RDEBSZ,RWRKX             YES, ADD FOR MODULE ID    M6121 02490002
TACT     EQU   *                        TEST FOR FEEDBACK               02540002
         TM    DCBOPTCD,DCBOPTF         IS FEEDBACK SPECIFIED           02580002
         BNO   TDYN                     IF NOT, DON'T ADD 2 BYTES       02600002
         AR    RDEBSZ,RWRKX             ALLOW FOR ONE ID                02640037
TDYN     TM    DCBMACF1,DCBMRDBF        IS DYNAMIC BUFFER MODULE NEEDED 02660002
         BZ    TCHK                     BRANCH IF NOT                   02680002
         OI    DCBOPTCD,DCBOPTDB        MOVE OPTION BIT TO OPTCD        02700002
TCHK     TM    DCBMACF1,DCBMRCK         IS THE CHECK OPTION BEING USED  02800002
         BZ    TEOEXT                   NO, TRY NEXT OPTION      YM1489 02820002
         AR    RDEBSZ,RWRKX             YES, ADD TWO BYTES              02840002
TEOEXT   EQU   *                        TEST EXT SRCH FOR EOE    YM1489 02890002
         TM    DCBOPTCD,DCBOPTE         WAS EXT SRCH SPECIFIED   YM1489 02940002
         BNO   SETSZ                    NO, TRY NEXT OPTION      YM1489 02990002
         AR    RDEBSZ,RWRKX             YES,ADD 2 BYTES FOR EOE  YM1489 03040002
SETSZ    LA    RDEBSZ,DEBBASND-DEBAVT(RDEBSZ) ALLOW FOR APPENDAGE LIST  03120002
*                                       AND DEB BASE                    03140002
         SPACE 2                                                        03150002
****                                                                    03160002
****    DETERMINE SIZE OF DEB CORE REQUIRED FOR EXTENTS                 03180002
****                                                                    03200002
         SR    RWRKX,RWRKX              CLEAR WORK REG           Y02072 03210002
         SR    RXTNTOT,RXTNTOT          CLEAR WORK REG           Y02072 03220002
         IC    RXTNTOT,DSCNOEXT         FIRST DSCB NUMBER OF EXTENTS    03240002
         CLI   JFCBVOLS+NEXTVOL,BLANK   IS DATA SET MULTIVOL    SA53239 03250002
         BNE   MULTIVOL                 YES,OPEN INITIALIZED    SA53239 03252002
*                                       EXTENT FIELD            SA53239 03254002
         MVI   DCBDRDX,0                NO,ZERO OUT DCB EXTENT  SA53239 03256002
MULTIVOL EQU   *                                                SA53239 03258002
         IC    RWRKX,DCBDRDX            PLUS TOTAL NO. OF EXTENTS FROM  03260002
         AR    RXTNTOT,RWRKX            OTHER DSCB'S GIVE TOTAL NO. OF  03280002
*                                       EXTENTS FOR THE DATA SET        03300002
         TM    DCBRECFM,DCBRECTO        ARE OVERFLOW RECORDS PRESENT    03320002
         BZ    NOOVFLOW                 NO,CONTINUE              A28200 03340002
         OI    DCBOPTCD,DCBOPTTO        OR IN OVERFLOW BIT IN OPTCD     03360002
NOOVFLOW LTR   RXTNTOT,RXTNTOT          TEST FOR ZERO EXTENTS    Y02072 03364002
         BNZ   NOTZERO                  EXTENTS OK               Y02072 03366002
ABORT    EQU   *                                               @ZA17540 03366237
         LA    R0,PD212                 LOAD INTERNAL RET CODE   Y02072 03366402
*                                       INDICATING THERE WAS NO  Y02072 03366802
*                                       PRIMARY EXTENT           Y02072 03367202
         B     ERREXIT                  ABEND IF ZERO EXTENTS    Y02072 03368002
*                                                                       03380000
NOTZERO  EQU   *                        CONTINUE                 Y02072 03390002
         LR    RWRKY,RXTNTOT            GET TOTAL NO. OF EXTENTS Y02072 03420002
         SLL   RWRKY,TIMES16            MULTIPLY NO. OF EXTENTS         03440002
         AR    RDEBSZ,RWRKY             BY 16, ADD TO CORE SIZE         03460002
         TM    DCBOPTCD,DCBOPTRB        IF NOT RELATIVE RECORD          03480002
         BZ    OBDAM020                 ADDRESSING, GO TO NEXT ROUTINE  03500002
         SRL   RWRKY,TIMES4             DIVIDE NO. OF EXTENTS BY 4      03520002
         AR    RDEBSZ,RWRKY             TO ALLOW FOR RELATIVE EXTENTS   03540002
         TM    DCBRECFM,DCBRECTO        ARE OVERFLOW RECORDS PRESENT    03560002
         BZ    OBDAM020                 NO GO ON                        03580002
         LA    RDEBSZ,OFLOINCR(RDEBSZ)  YES ADD ON OVERFLOW SIZE        03600002
         SPACE 2                                                        03610002
****                                                                    03620002
****     REGISTER RDEBSZ NOW CONTAINS THE NUMBER OF BYTES OF PROTECTED  03640002
****     CORE REQUIRED FOR                                              03650002
****       1. APPENDAGE VECTOR LIST                                     03660002
****       2. DEB (BASE + VARIABLE NO. OF EXTENTS, SUBROUTINE IDS       03690002
****              PLUS THE RELATIVE EXTENTS.)                           03700002
****                                                                    03730002
OBDAM020 EQU   *                                                        03740000
         LA    RDEBSZ,RNDFCTOR(RDEBSZ)  ROUND TO NEXT HIGHEST DOUBLE    03760002
         SRL   RDEBSZ,3                 WORD FOR GETMAIN                03780002
         LR    RWRKX,RDEBSZ             SAVE DOUBLE WORD COUNT          03800002
         SLL   RDEBSZ,3                 REG NOW CONTAINS BYTES NEEDED   03820002
         LR    R1,RDEBSZ                PUT LEN IN R1 FOR SUBRTN Y02072 03822002
         BAL   RETURN,ENTSP230          GO GET CORE FOR DEB      Y02072 03830002
*                                                                       03840000
*                        CONSTRUCT THE DEB                       Y02072 03954037
         LA    RDEBA,0(,R1)             INITIALIZE POINTER REGISTER     03960002
         USING DEB,RDEBA                ESTABLISH DEB BASE REG          04010002
         XC    DEBAVT(DEBBASND-DEBAVT),DEBAVT  CLEAR ALL OF DEB         04200002
*                                       TO EXTENTS SECTION              04202002
         SPACE 2                                                        04212002
****                                                                    04220002
****     CONSTRUCT THE DEB BASE                                         04240002
****                                                                    04260002
         STC   RWRKX,DEBLNGTH           STORE DOUBLE WORD COUNT         04280002
         MVC   DEBDSCBA+2(CCHHRLNG),DWADSCB SAVE DSCB CCHHR ADDR Y02072 04300002
         STC   RXTNTOT,DEBNMEXT         STORE NO. OF EXTENTS            04320002
         ST    RDEBA,DEBAPPAD           APPENDAGE LIST ADDRESS          04340002
         L     RTCB,PSATOLD             GET CURRENT TCB ADDR     Y02072 04390002
         USING TCB,RTCB                 ESTABLISH TCB BASE REG          04410002
         ST    RTCB,DEBTCBAD            TCB ADDRESS                     04420002
         ST    RDCB,DEBDCBAD            DCB ADDRESS                     04440002
         MVC   DEBPROTG,TCBPKF          STORAGE PROTECTION KEY OF TCB   04460002
         OI    DEBDEBID,DEBIDFYR        DEB ID                          04480002
         MVC   DEBPRIOR,TCBDSP          PRIORITY INDICATOR              04500002
         MVC   DEBOPATB,OPPATRUB(RPARC) OPEN ATTRIBUTES                 04520002
         NI    DEBOPATB,X'FF'-DEBABEND                                  04540002
         MVI   DEBEXSCL,OPMEXSCL        EXTENT SIZE SCALE               04560002
*                                                                       04570002
         MODESET  EXTKEY=SUPR           CHANGE TO SUPERVISOR KEY Y02072 04610002
*                                       TO CHAIN THE DEB OFF TCB Y02072 04620002
*                                                                       04630002
         LA    RWRKY,DEBBASIC           GET ADDR OF MAIN DEB     Y02072 04640002
         L     RWRKX,TCBDEB             GET ADDR OF 1ST DEB      Y02072 04660002
CHAIN    ST    RWRKX,DEBDEBAD           CHAIN DEB TO 1ST DEB     Y02072 04662002
         CS    RWRKX,RWRKY,TCBDEB       PUT DEB PTR IN TCB       Y02072 04664002
         BNE   CHAIN                    BR WITH RWRKX CONTAINING Y02072 04666002
*                                       NEW VALUE IN TCBDEB      Y02072 04668002
         DROP  RTCB                     DROP TCB BASE REG               04668102
*                                                                       04668202
         MODESET  EXTKEY=DATAMGT        RETURN TO DATAMGT KEY    Y02072 04668402
*                                                                       04668802
         STCM  RWRKY,ADDR,DCBDEBA       STORE DEB ADDRESS IN DCB Y02072 04677602
*                                                                       04694802
         DEBCHK (RDCB),TYPE=ADD,AM=BDAM  ADD DEB TO DEB TABLE    Y01021 04703202
*                                                                       04711602
         LR    RXTENT,RCORE             SET DSCB INDEX SO ROUTINE CAN   04720002
*                                       UTILIZE A LOOP                  04740002
         LA    RWRKX,FRMT1KEY           LOAD KEY LG =44 INTO REG Y02072 04750002
         SR    RXTENT,RWRKX             SUBTRACT KEY LENGTH FROM Y02072 04760002
*                                       FORMAT1 DSCB ADDRESS     Y02072 04770002
         MVI   DEBOFLGS,DEBDISP                                         04780002
         NC    DEBOFLGS,JFCBIND2        OPEN OLD OR NEW                 04800002
         CLI   DSCEXTYP,DSCSPLIT        CHECK FOR SPLIT CYLINDER        04820002
         BNE   OBDAM060                 NO, BRANCH                      04840002
         OI    DEBOFLGS,DEBSPLIT        SET INDICATOR IN DEB            04860002
         SPACE 2                                                        04870002
****                                                                    04880002
**** THE FOLLOWING ROUTINE ENCOMPASSES 3 LOOPS CONTROLLED BY THE NUMBER 04892002
**** OF EXTENTS IN THE DATA SET, ON THE VOLUME AND IN THE DSCB.  THE    04894002
**** CONTROLLING REGISTERS ARE AS FOLLOWS:                              04896002
****           RXTNTOT - NO. OF EXTENTS IN DATA SET                     04896402
****           RXTNCUR - NO. OF EXTENTS IN THIS DSCB                    04896802
****           RXTNMAX - MAXIMUM NO. OF EXTENTS FOR THIS FORMAT         04897202
****           DWAFM3SW(IN WORKAREA) - FORMAT 3 SWITCH                  04897602
**** WHEN RXTNTOT IS 0, THE OUTSIDE LOOP IS COMPLETE.  AT DWATTCTR IN   04898802
**** THE OPEN WORKAREA, THE TOTAL NUMBER OF TRACKS IN THE DATA SET ARE  04898902
**** BEING SUMMED UP.                                                   04899002
****                                                                    04909602
OBDAM060 EQU   *                                                        04940000
         LA    RDEBEXT,DEBBASND         SET EXT INDEX TO EXT 1   Y02072 04942002
         USING DEBDASD,RDEBEXT          EST DEB DASD BASE        Y02072 04950002
         LR    RDSCB,RXTENT             SAVE CURRENT DSCB ADDRESS       04960002
         SR    RWRKY,RWRKY              ZERO M COUNTER                  04980002
         STC   RWRKY,DXDAADDR           SAVE M NO. FOR CONVRT RTN       05020402
         STH   RWRKY,DWATTCTR           SET TOTAL TT CTR TO ZERO Y02072 05020802
         SPACE                                                          05022002
         L     RWRKX,DXUCBADR           GET UCB ADDR OF 1ST DSCB Y02072 05024002
         ST    RWRKX,DEBUCBAD           ST UCB ADDR IN DEB EXT   Y02072 05026002
         B     OBDAM185                 BR AROUND UCB PICK UP    Y02072 05028002
*                                       FOR SUBSEQUENT DSCBS     Y02072 05028402
         DROP  RCORE                    DROP OPEN WORKAREA BASE  Y02072 05028502
         SPACE                                                          05028802
****                                                                    05030002
****           ENTRY FOR THE NEXT DSCB                                  05032002
****                                                                    05034002
OBDAM180 EQU   *                        PROCESS FORMAT 1 DSCB    Y02072 05036002
         USING DXDSCB-FRMT1KEY,RXTENT   ESTABLISH DSCB BASE REG  Y02072 05038002
         L     RWRKX,DSCBUCB            GET UCB PTR FOR CUR DSCB Y02072 05040002
         ST    RWRKX,DEBUCBAD           STORE UCB ADDRESS IN DEB EXT    05040102
OBDAM185 SR    RXTNCUR,RXTNCUR          CLEAR REGISTER FOR CUR EXT NO.  05040402
         STH   RXTNCUR,DEBBINUM         ZERO BB FOR NOW                 05040802
         IC    RXTNCUR,DSCNOEXT         GET NO. EXTENTS FOR THIS Y02072 05060002
*                                       VOLUME ONLY              Y02072 05070002
         LTR   RXTNCUR,RXTNCUR          CHECK FOR ZERO                  05080002
         BZ    ABORT                    ZERO EXTENTS - ABEND   @ZA17540 05100037
OBDAM190 LA    RXTENT,DSCEXTYP          PT TO 1ST EXTENT OF DSCB Y02072 05140002
         DROP  RXTENT                   DROP DSCB BASE REG              05150002
         MVI   DEBDVMOD,DEBSEEKN        INHIBIT WRITE PERMIT ALL SEEKS  05430002
         MVC   DEBDSCBA(L'DEBBINUM),DEBBINUM  MOVE BB TO PREFIX         05500002
         TM    DEBOPATB,OUTPUT          CHECK FOR OUTPUT         YM1290 05540002
         BZ    OBDAM210                 BRANCH IF NO                    05560002
         MVI   DEBDVMOD,DEBWSEEK        PERMIT ALL WRITES AND SEEKS     05580002
         USING FORCORE,RCORE            WORKAREA BASE SET UP     Y02072 05590002
OBDAM210 MVI   DWAFM3SW,0               SET FORMAT 3 SWITCH OFF  Y02072 05600002
         DROP  RCORE                                             Y02072 05610002
         USING DSCEXTYP,RXTENT          EST BASE FOR DSCB EXT    Y02072 05612002
         LA    RXTNMAX,F1XTENTS         MAXIMUM 3 EXTENTS FOR FORMAT 1  05620002
         CLI   DSCEXTYP,DSCULABL        TEST, BR IF 1ST EXTNT NOT  UL17 05624002
         BNE   OBDAM220                 A USER LABEL TRACK         UL17 05628002
         BCTR  RXTNMAX,0                DECREMENT NO OF EXTENTS    UL17 05632002
         LA    RXTENT,L'DSCEXT1(,RXTENT)  POINT TO NEXT DSCB       UL17 05636002
*                                       EXTENT                     UL17 05638002
OBDAM220 MVC   DEBSTRCC(DAADRLNG),DSCLOWLM  SET UP ONE EXTENT FROM      05640002
*                                       STARTING CCHH TO ENDING CCHH    05650002
         NI    DEBDVMOD,DEBSEEKN        PERMIT HEAD SEEKS               05660002
         CLI   DSCEXTYP,DSCYLBDY        CHECK FOR CYLINDER BOUNDARY     05680002
         BE    OBDAM224                 YES  BRANCH                     05700002
         OI    DEBDVMOD,DEBSEEKF        INHIBIT ALL SEEKS               05720002
         DROP  RXTENT                   DROP DSCB EXTENT BASE REG       05730002
         SPACE 2                                                        05730402
*********************************************************************** 05732002
*  THE FOLLOWING ROUTINE SETS UP FOR AND BALRS TO THE SYSTEM CONVERT  * 05734002
*  ROUTINE TO GET THE NUMBER OF TRACKS IN EACH EXTENT. THE CONVERT    * 05736002
*  ROUTINE EXPECTS THE DEB TO BE IN REG 1 AND THE POINTER TO THE      * 05736402
*  ADDRESS TO BE CONVERTED IN REG 2.THE CONVERT ROUTINE USES REGISTERS* 05736802
*  9-13 AS WELL AS 0,1,2,AND 15. THE TTR IS RETURNED IN REG 0.        * 05737202
*********************************************************************** 05738002
OBDAM224 EQU   *                                                        05740000
         USING FORCORE,RCORE            EST OPEN WORK AREA BASE REG     05750002
         SPACE 1                                                        05750402
         STM   R9,R15,DWASAVEA          SAVE REGS USED BY CNVRT  Y02072 05906502
         MVC   DXDAADDR+1(L'DEBBINUM),DEBBINUM  SET UP BIN NUMBER       05911002
         MVC   DXDAADDR+3(CCHHLNG),DEBENDCC  PUT END CCHH INTO EXTENT   05915502
         L     R1,DCBDEBAD              SET A POINTER TO THE DEB        05920002
         LA    R2,DXDAADDR              POINT TO CONSTANT FOR CONVERT   05940002
*                                       ROUTINE                         05960002
         L     R15,CVTPTR               GET ADDRESS OF CVT              05980002
         USING CVT,R15                  ESTABLISH CVT BASE REG          05990002
         L     R15,CVTPRLTV             CONVERT RTNE                    06000002
         DROP  R15                      DROP CVT BASE REG               06010002
         BALR  R14,R15                                                  06020002
*                                                                       06040000
         LM    R9,R15,DWASAVEA          RESTORE ALL REGS         Y02072 06050002
         SRL   R0,16                    USE TT ONLY                     06080002
         LR    RWRKX,R0                 PUT TT IN WORK REG              06090002
         LA    RWRKX,1(RWRKX)           ADD ONE TO TT(REL TO 0)         06100002
         LR    RWRKY,RWRKX              SAVE NO. OF TOTAL TRACKS        06120002
         SH    RWRKX,DWATTCTR           SUBTRACT TT OF LAST EXT  Y02072 06122002
         STH   RWRKX,DEBNMTRK           STORE NO. OF TRACKS IN THIS     06160002
*                                       EXTENT                          06180002
         STH   RWRKY,DWATTCTR           UPDATE TT TO CURR EXTENT Y02072 06190002
         SR    RWRKX,RWRKX              CLEAR WORK REG           Y02072 06240002
         IC    RWRKX,DXDAADDR           GET CURRENT EXT NUMBER   Y02072 06250002
         LA    RWRKX,1(,RWRKX)          ADD ONE TO M FOR NEXT EXT.      06260002
         STC   RWRKX,DXDAADDR           SET UP M FOR NEXT EXTENT Y02072 06270002
         SPACE 2                                                        06270402
****                                                                    06272002
****      CHECK FOR VIO & EXTENDED SEARCH. IF BOTH, ADJUST DEB          06274037
****      EXTENT SIZE SO THAT IT DOES NOT EXCEED THE REAL SIZE          06276002
****      OF THE DATA SET. THE LAST TRACK WILL BE THAT ON WHICH         06278002
****      THE EOF MARK WAS WRITTEN (AS INDICATED IN THE DSCB) OR        06278402
****      THE END OF THAT CYLINDER IF ALLOCATION IS IN CYLINDERS.       06278802
****      THIS IS NECESSARY BECAUSE IT IS IMPOSSIBLE TO RELEASE         06279202
****      EXTRA SPACE DURING THE CREATION OF A VIO DATA SET. AS         06279602
****      A RESULT, EXTENDED SEARCH OPERATIONS DURING PROCESSING        06279702
****      CAN CAUSE THE UNNECESSARY SEARCH OF UNUSED SPACE.             06279802
****                                                                    06279902
         L     RWRKX,DEBUCBAD           GET UCB ADDR FROM DEB    YM5761 06293202
         USING UCB,RWRKX                ESTABLISH UCB BASE       YM5761 06303202
         TM    UCBJBNR,UCBVRDEV         IS THIS VIO DATA SET     YM5761 06305202
         BNO   OBDAM250                 NO CONTINUE BUILDING DEB YM5761 06305602
         TM    DCBOPTCD,DCBOPTE         EXTENDED SEARCH OPTION? ZA09152 06305737
         BNO   OBDAM250                 NO - CONT BUILDING DEB  ZA09152 06305837
*                                                                       06306002
*    SET UP TO CONVERT LAST BLOCK ADDR - TTR TO CCHHR                   06306402
*    THE CONVERT ROUTINE EXPECTS THE DEB TO BE IN REG 1, THE            06306502
*    TTR0 TO BE IN R0, AND THE ADDR OF THE AREA IN WHICH TO             06306602
*    PUT THE ACTUAL ADDRESS IN R2. IT USES REGS 9-13 ALSO.              06311002
*                                                                       06313002
         STM   R9,R15,DWASAVEA          SAVE REGS USED BY CNVRT  YM5761 06315002
         SR    R1,R1                    CLEAR PARM REG           YM5761 06315402
         IC    R1,DSCLSTAR              GET TT OF THE LAST       YM5761 06315502
         SLL   R1,8                     TRACK WRITTEN ON         YM5761 06319102
         IC    R1,DSCLSTAR+1            DURING CREATION OF THE   YM5761 06321102
         LA    R1,1(R1)                 ADD 1 TO TT              YM5894 06321202
         STH   R1,DWATTCTR              SAVE NO. TRKS IN WKA     YM5894 06321302
         STH   R1,DEBNMTRK              PUT NO. TRKS IN DEB EXT  YM5894 06323602
         BCTR  R1,0                     SUBT 1 AGAIN FOR TTR     YM5894 06328102
         SLL   R1,16                    DATA SET -PASS TTR0      YM5761 06330402
         LR    R0,R1                    PASS TTR0 IN R0          YM5894 06332402
         LA    R2,DCBXARG               PASS LOCATION FOR CNVRT  YM5761 06332702
*                                       RTN TO PUT ACTUAL ADDR   YM5761 06335002
*                                       THIS DCB FIELD IS UNUSED YM5761 06337302
         L     R1,DCBDEBAD              PUT DEB ADDR IN R1       YM5761 06339602
         L     R15,CVTPTR               GET ADDR OF CVT          YM5761 06341902
         USING CVT,R15                  ESTABLISH CVT BASE       YM5761 06344202
         L     R15,CVTPCNVT             GET ADDR OF CNVT RTN     YM5761 06346502
*                                       TO CNVT TTR TO ACTUAL    YM5761 06348802
         DROP  R15                      DROP CVT BASE            YM5761 06351102
         BALR  R14,R15                  BRANCH TO CNVRT RTN      YM5761 06353402
         LM    R9,R15,DWASAVEA          RESTORE REGS             YM5761 06355702
         MVC   DEBENDCC(CCHHLG),DCBXARG+3 MV CCHH INTO DEB       YM5761 06358002
         XC    DCBXARG(L'DCBXARG+L'DCBDRDX),DCBXARG  CLEAR DCB   YM5761 06360302
*                                       AREA USED FOR ADDR RET   YM5761 06362602
         TM    DEBDVMOD,DEBSEEKF        IS ALLOCATION IN CYL     YM5761 06364902
         BO    OBDAM250                 NO, TRK ALLOCATION OK    YM5761 06367202
****                                                                    06369502
****        ROUND UP EXTENT TO CYL IF ALLOCATED IN CYLINDERS            06371802
****                                                                    06374102
         L     RWRKY,CVTPTR             GET ADDRESS OF THE CVT   YM5761 06376402
         USING CVT,RWRKY                ESTABLISH CVT BASE REG   YM5761 06378702
         L     RDVCT,CVTZDTAB           GET ADDR OF DEV TABLE    YM5761 06381002
         DROP  RWRKY                    DROP CVT BASE            YM5761 06383302
         USING DVCTI,RDVCT              EST BASE FOR DEV CHAR    YM5761 06385602
*                                       TABLE INDEX              YM5761 06387902
         LA    RWRKY,DVCTYPMK           GET MASK FOR UNIT TYPE   YM5761 06390202
         N     RWRKY,UCBTYP             GET UNIT TYPE            YM5761 06392502
         IC    RWRKY,DVCTIOFF(RWRKY)    GET OFFSET IN TABLE      YM5761 06394802
         DROP  RDVCT,RWRKX              DROP UCB AND DVCT REG    YM5761 06397102
         LA    RDVCT,0(RWRKY,RDVCT)     GET DEVICE ENTRY ADDR    YM5761 06399402
         USING DVCT,RDVCT               EST BASE FOR TABLE       YM5761 06401702
         LH    RWRKX,DVCTRK             GET NO. TRKS/CYLINDER    YM5761 06404002
         DROP  RDVCT                    DROP DEV TAB BASE        YM5761 06406302
         BCTR  RWRKX,0                  DECREMENT MAX TRKS BY 1  YM5761 06408602
         LH    RWRKY,DEBENDHH           GET END TRK BEFORE ROUND YM5894 06410602
         STH   RWRKX,DEBENDHH           END OF EXT=END OF CYL    YM5761 06410902
         SR    RWRKX,RWRKY              HOW MANY TRKS ADDED      YM5894 06412902
         AH    RWRKX,DWATTCTR           ADD THIS TO TOTAL TRKS   YM5894 06413002
         STH   RWRKX,DWATTCTR           SAVE NO. TRKS IN WKA     YM5894 06413102
         STH   RWRKX,DEBNMTRK           SAVE NO. TRKS IN DEB EXT YM5894 06415802
****                                                                    06418702
         SPACE 2                                                        06421402
OBDAM250 EQU   *                        TEST FOR MORE EXTENTS    YM5761 06424102
         BCT   RXTNTOT,OBDAM260         ANY MORE EXTENTS (TOTAL)        06426802
         B     OBDAMOUT                 NO, ALL EXTENTS ARE BUILT       06429502
         DROP  RCORE                                             Y02072 06432202
*********************************************************************** 06434902
         SPACE 2                                                        06437602
OBDAM260 EQU   *                        CONTINUE BUILDING EXTENTS       06440302
         BCT   RXTNCUR,OBDAM280         TEST MORE EXTENTS IN THIS DSCB  06443002
****                                                                    06445702
****           PREPARE TO GET NEXT DSCB                                 06448402
****                                                                    06451102
OBDAM270 EQU   *                        PROCESS NEW DSCB         Y02072 06453802
         USING DXDSCB-FRMT1KEY,RDSCB    ESTABLISH DSCB BASE REG  Y02072 06456502
         L     RXTENT,DSCCORE           GET NEXT DSCB ADDRESS    Y02072 06459202
         LA    RWRKX,FRMT1KEY           LOAD 44 BYTE KEY OFFSET  Y02072 06461902
         SR    RXTENT,RWRKX             SUBTR KEY NOT IN CORE    Y02072 06464602
         LR    RDSCB,RXTENT             NEXT SET OF EXTENTS             06467302
         CLI   DSCBFMID,FORMAT2         IS THIS FORMAT 2 DSCB    Y02072 06470002
         BNE   OBDAM275                 IF NOT, PROCEED          Y02072 06472002
         B     OBDAM270                 ELSE, GO GET NEXT DSCB   Y02072 06474002
OBDAM275 EQU   *                        PROCESS THIS DSCB        Y02072 06476002
         LA    RDEBEXT,DEBDASDL(RDEBEXT)   NEXT DEB EXTENT       Y02072 06500002
         B     OBDAM180                 RET TO PROCESS NEXT DSCB Y02072 06520002
         SPACE 2                                                        06530002
****                                                                    06540002
****     MORE EXTENTS FOR CURRENT DATA SET CONTROL BLOCK                06560002
****                                                                    06580002
OBDAM280 LA    RXTENT,L'DSCEXT1(,RXTENT)  UPDATE DSCB POINTER           06600002
         BCT   RXTNMAX,OBDAM300         BRANCH IF MORE EXTENTS FOR      06620002
*                                       CURRENT FORMAT                  06640002
****                                                                    06650002
****           END OF EXTENTS IN CURRENT FORMAT                         06652002
****                                                                    06654002
         LA    RXTENT,1(,RXTENT)        NO, INCREMENT DSCB POINTER      06660002
         USING FORCORE,RCORE            SET UP WORKAREA BASE     Y02072 06662002
         CLI   DWAFM3SW,0               IS THIS FORMAT 3         Y02072 06670002
         DROP  RCORE                                             Y02072 06680002
         BNE   OBDAM320                 BRANCH IF YES            Y02072 06700002
OBDAM290 EQU   *                        PROCESS THIS DSCB        Y02072 06710002
         L     RXTENT,FOURBYTS(RXTENT)  GET ADDRESS OF FORMAT 3  YM1290 06720402
         USING DXDSCB3K,RXTENT          ESTABLISH F3 DSCB BASE REG      06722002
         LR    RDSCB,RXTENT             SAVE CURRENT DSCB ADDRESS       06760002
         CLI   DSCBFMID,FORMAT2         IS THIS FORMAT 2 DSCB    Y02072 06770002
         BNE   OBDAM295                 IF NOT, PROCEED          Y02072 06772002
         LA    RXTENT,DSCCORE           GET NEXT DSCB ADDRESS    Y02072 06772402
         B     OBDAM290                 ELSE, GO GET NEXT DSCB   Y02072 06774002
         SPACE                                                          06774102
****                                                                    06774402
****            FORMAT 3 DSCB PROCESSING                                06774802
****                                                                    06775202
OBDAM295 EQU   *                        PROCESS THIS DSCB        Y02072 06776002
         DROP  RDSCB                    DROP DSCB BASE REG       Y02072 06778002
         LA    RXTENT,DSCBEXSK          GO TO FIRST EXTENT FIELD        06780002
         DROP  RXTENT                   DROP F3 DSCB BASE REG           06790002
         LA    RXTNMAX,F3XTNTS1         SET LIMIT TO 4 EXTENTS IN KEY   06800002
         USING FORCORE,RCORE            SET UP WORKAREA BASE     Y02072 06802002
         STC   RXTNMAX,DWAFM3SW         TURN ON FORMAT 3 SWITCH  Y02072 06810002
         SPACE                                                          06812002
****                                                                    06820002
****           MORE EXTENTS IN CURRENT FORMAT TO BUILD                  06840002
****                                                                    06850002
OBDAM300 MVC   DEBDASD+DEBDASDL(FLDUCBBB),DEBDASD  COPY UCB AND BB      06860002
*                                       FIELDS FOR THE NEXT EXTENT      06870002
         LA    RDEBEXT,DEBDASDL(RDEBEXT)  POINT TO THE NEXT DEB EXTENT  06880002
         B     OBDAM220                                                 06900002
         DROP  RDEBEXT                  DROP DEB EXTENT SECTION BASE    06910002
*                                                                       06920000
*                                                                       06940000
OBDAM320 LA    RXTNMAX,F3XTNTS2         RESET EXTENT COUNT TO 9         06960002
         MVI   DWAFM3SW,0               TURN OFF FORMAT 3 SWITCH Y02072 06970002
         B     OBDAM300                                                 07000002
         SPACE 2                                                        07020002
****                                                                    07060002
****     STORE TOTAL TRACKS IN THE DATA SET IN THE DCB                  07080002
****                                                                    07100002
OBDAMOUT EQU   *                        DEB BUILT, INITIALIZE DCB FLDS  07100402
         LH    RWRKX,DWATTCTR           LOAD TOTAL TRKS IN D.S.  Y02072 07140002
         IC    RWRKY,DCBKEYLE           STORE TOTAL SIZE OF DATA SET    07180002
         ST    RWRKX,DCBKEYLE           (IN TRACKS) IN THE DCB,         07200002
         STC   RWRKY,DCBKEYLE           SAVING KEY LENGTH               07220003
*                                                              @Y30LSBS 07221003
****           THIS ROUTINE TAKES THE EXTENTS FROM THE DEB JUST@Y30LSBS 07222003
****     BUILT AND TESTS THE UCB OF EACH EXTENT TO SEE IF IT   @Y30LSBS 07223003
****     RESIDES ON MSS VIRTUAL DASD.  IF SO, IT WILL USE THE  @Y30LSBS 07224003
****     EXTENT INFORMATION IN THAT EXTENT AS WELL AS ALL      @Y30LSBS 07225003
****     FOLLOWING EXTENTS ON THE SAME UCB, AND BUILD A PARA-  @Y30LSBS 07226003
****     METER LIST FOR ACQUIRING DASD SPACE FOR STAGING IN    @Y30LSBS 07227003
****     THE DATA.                                             @Y30LSBS 07228003
*                                                              @Y30LSBS 07229003
*                                                              @Y30LSBS 07230003
         L     RWTG,DWASAVE6            LOAD SAVED WTG TAB     @Y30LSBS 07230103
         USING WTG,RWTG                 WTG TABLE BASE         @Y30LSBS 07230203
OBDAMGET IECRES GET,PREFIX=YES,SP=230,LV=ACQPLN,ID=MSS2,       @Y30LSBS.07230303
               STM=(R2,R15,WTGPREFX)    GET THE ACQUIRE LIST   @Y30LSBS 07231403
         DROP  RWTG                     DROP BASE              @Y30LSBS 07234303
         USING ACQLST,R1                ACQLST ADDRESSABILITY  @Y30LSBS 07235003
         SR    REXTN,REXTN              ZERO OUT A REGISTER    @Y30LSBS 07238503
         IC    REXTN,DEBNMEXT           GET NUMBER OF EXTENTS  @Y30LSBS 07239603
         LA    RDEBEXT,DEBBASND         POINT TO 1ST DEB EXTENT@Y30LSBS 07240703
         USING DEBDASD,RDEBEXT                                 @Y30LSBS 07241403
*                                                              @Y30LSBS 07242903
****     BEGINNING OF OUTER LOOP TO HANDLE EACH UCB.           @Y30LSBS 07244003
****     INITIALIZE PARAMETER LIST HEADERS.                    @Y30LSBS 07245103
*                                                              @Y30LSBS 07246203
OBDAM350 EQU   *                                               @Y30LSBS 07247303
         SR    RCTR,RCTR                ZERO COUNTER REGISTER  @Y30LSBS 07248403
         XC    ACQLST(ACQPLN),ACQLST    ZERO OUT THE PARM LIST @Y30LSBS 07249503
         LA    REXTB,AREXT              POINT TO LIST ENTRY    @Y30LSBS 07250603
         USING AREXTSEC,REXTB           ACQUIRE EXT BASE       @Y30LSBS 07251403
         L     RMSSUCB,DEBUCBAD         GET COMPARATOR UCB     @Y30LSBS 07251703
         USING UCB,RMSSUCB              MSS UCB BASE REG       @Y30LSBS 07252803
*                                                              @Y30LSBS 07253903
****     START OF THE INNER LOOP TO HANDLE EACH DEB EXTENT FOR @Y30LSBS 07255003
****     EACH SAME UCB.  COPY LOW AND HIGH CCS FROM DEB TO     @Y30LSBS 07256103
****     PARAMETER LIST UNTIL NEW UCB IS ENCOUNTERED OR NUMBER @Y30LSBS 07257203
****     OF DEB EXTENTS ARE EXHAUSTED.                         @Y30LSBS 07258303
*                                                              @Y30LSBS 07259403
OBDAM360 EQU   *                                               @Y30LSBS 07260503
         CLM   RMSSUCB,ADDR,DEBUCBAD+1  IS IT THE SAME UCB     @Y30LSBS 07261603
         BNE   OBDAM380                 NO, CHECK IF ACQUIRABLE@Y30LSBS 07263803
         TM    UCBTBYT2,UCBRVDEV        IS EXT ON MSS  DASD    @Y30LSBS 07264903
         BZ    OBDAM370                 NO, CHECK NEXT EXTENT  @Y30LSBS 07266003
         CLC   FOXES,DEBSTRCC           VALID EXTENT           @Y30LSBS 07267103
         BE    OBDAM370                 NO, DONT PROCESS       @Y30LSBS 07268203
         MVC   LOCC,DEBSTRCC            MOVE IN LOW CC         @Y30LSBS 07269303
         MVC   HICC,DEBENDCC            MOVE IN THE HIGH CC    @Y30LSBS 07270403
         LA    REXTB,AREXTLN(REXTB)     INCREMENT LIST POINTER @Y30LSBS 07271503
         AH    RCTR,ONEMOR              INCREMENT NUMB ENTRIES @Y30LSBS 07272603
OBDAM370 EQU   *                                               @Y30LSBS 07273703
         LA    RDEBEXT,DEBDASDL(RDEBEXT) POINT TO NEXT EXTENT  @Y30LSBS 07274803
         BCT   REXTN,OBDAM360           GO BACK TO CHECK IT OUT@Y30LSBS 07275903
OBDAM380 EQU   *                                               @Y30LSBS 07277003
         LTR   RCTR,RCTR                ANY SPACE TO ACQUIRE   @Y30LSBS 07278103
         BZ    OBDAM450                 NO, CHECK FOR MORE EXTS@Y30LSBS 07279203
*                                                              @Y30LSBS 07280303
****     THIS ROUTINE USES THE PARAMETER LIST JUST BUILT TO    @Y30LSBS 07281403
****     ACQUIRE DASD SPACE VIA THE ICBACREL MACRO ON MSS      @Y30LSBS 07282503
****     DASD.  NOTE THAT ANY ERRORS WILL CAUSE AN ABEND ERR.  @Y30LSBS 07283603
*                                                              @Y30LSBS 07284703
         STC   RCTR,ARNMEXTS            STORE NUMB EXTS TO GET @Y30LSBS 07286903
         MVC   ARVOL,UCBVOLI            AND FOR WHAT VOLUME    @Y30LSBS 07288003
         DROP  RMSSUCB                                         @Y30LSBS 07289103
         MVI   ACQLST+PLUS3,ACQPLN      SET LIST LENGTH        @Y30LSBS 07289503
*                                                              @Y30LSBS 07290203
        ICBACREL TYPE=ACQ,MF=(E,ACQLST) ACQUIRE THE SPACE      @Y30LSBS 07291303
*                                                              @Y30LSBS 07292403
         LTR   R15,R15                  ANY ERRORS             @Y30LSBS 07293503
         BZ    OBDAM450                 NO, MORE EXTENTS?      @Y30LSBS 07294603
***       ACQUIRE FAILED - ABEND                               @Y30LSBS 07295737
         LR    RPARPTR,R1               PASS PARM LIST PTR     @Y30LSBS 07297903
         LA    R0,PD111                 SET FAILURE CODE       @Y30LSBS 07299037
         B     ERREXIT                  ABEND                  @Y30LSBS 07300137
OBDAM450 EQU   *                                               @Y30LSBS 07301203
         LTR   REXTN,REXTN              MORE EXTENTS TO PROCESS@Y30LSBS 07302303
         BNZ   OBDAM350                 YES, START OUTER LOOP  @Y30LSBS 07303403
         L     RWTG,DWASAVE6            NO, RESTORE WTG TABL AD@ZM30030 07305403
         USING WTG,RWTG                                        @ZM30030 07305503
OBDAMFRE IECRES FREE,PREFIX=YES,A=(R1),STM=(R2,R14,WTGPREFX)   @Y30LSBS 07305603
         DROP  RWTG,RDEBEXT,R1,REXTB    DROP ALL BASES USED    @Y30LSBS 07306403
*                                                              @Y30LSBS 07306703
****     THIS ENDS  MSS PROCESSING.                            @Y30LSBS 07307803
*                                                              @Y30LSBS 07308903
         EJECT                                                          07310002
*********************************************************************** 07320002
*  FUNCTION II: THE FOLLOWING FUNCTION LOADS ALL THE ROUTINES REQUIRED* 07330002
*  FOR BDAM AND STORES THEIR IDS IN THE DEB AND THEIR ADDRESSES IN THE* 07340002
*  DCB AND DEBAVT. IT BALRS TO A SUBROUTINE FOR THE LOAD, RETURNING   * 07350002
*  VIA REG 2.  THIS ROUTINE PROCESSES TOTALLY IN DATA MANAGEMENT KEY. * 07352002
*  INPUT TO THIS FUNCTION IS AS FOLLOWS:                              * 07352402
*              REGISTER 4 = OPEN WORKAREA ADDRESS                     * 07353202
*              REGISTER 9 = DEB AVT ADDRESS                           * 07354002
*              REGISTER 10 = DCB ADDRESS                              * 07356002
*              COMMON OPEN'S REGISTERS STORED AT DWASAVE              * 07357602
*              ENTRY IN DATA MANAGEMENT KEY                           * 07358402
*              DEB WITH PRIMARY EXTENTS INITIALIZED                   * 07359202
*  OUTPUT FROM THIS FUNCTION IS AS FOLLOWS:                           * 07360002
*              SAME AS INPUT                                          * 07365902
*              ALL MODULES REQUIRED FOR PROCESSING HAVE BEEN LOADED   * 07378602
*********************************************************************** 07380002
         SPACE                                                          07404002
FUNCT2   EQU   *                        BEGINNING OF FUNCTION II        07410002
         L     RWTG,DWASAVE6            LOAD SAVED WTG TAB ADDR  Y02072 07460002
         USING WTG,RWTG                 ADDRESSABILITY FOR WTG   Y02072 07510002
         SPACE 2                                                        10121902
****                                                                    10129902
****  INITIALIZE AND POSITION TO DEBAVT AND ACCESS METHOD ID SECTION    10131902
****                                                                    10133902
         MVI   DEBNMSUB,NOSUBRTN        INITIALIZE NO. OF SUBROUTINES   10160602
         TM    DCBOPTCD,DCBOPTRB        IS ADDRESSING BY RELATIVE BLOCK 10164702
         BZ    FIXAPP                   NO, SKIP NEXT STEP              10168802
         MVC   DEBAMLNG,DEBNMEXT        SET BDAM LENGTH TO WORD COUNT   10172902
         TM    DCBOPTCD,DCBOPTTO        IS OVERFLOW BEING USED          10177002
         BZ    FIXAPP                   NO- BRANCH                      10181102
         SR    RWRKX,RWRKX              CLEAR WORK REGISTER      Y02072 10183102
         IC    RWRKX,DEBAMLNG           GET SIZE OF ACCESS METHOD SECT  10185202
         LA    RWRKX,IDINCR(,RWRKX)     INCREMENT WORD COUNT BY TWO     10189302
         STC   RWRKX,DEBAMLNG           STORE BACK INTO DEB             10193402
*                                       RELATIVE EXTENTS                10197502
FIXAPP   EQU   *                        GET APPENDAGE ADDRESSES         10201602
         L     RWRKX,CVTPTR             GET CVT ADDRESS                 10219802
         USING CVT,RWRKX                ESTABLISH CVT BASE REG          10229802
         L     RWRKX,CVTXAPG            LOCATE IOS APPENDAGE LIST       10239802
         DROP  RWRKX                    DROP CVT BASE REG               10241802
         MVC   DEBAVT(DEBAVTLN),0(RWRKX)  MOVE TO OUR APPENDAGE LIST    10243802
         LA    RDEBEXT,DEBBASND         ESTABLISH A POINTER TO THE      10247802
         SR    RWRKX,RWRKX              SUBROUTINE ID AREA OF THE DEB   10248202
         IC    RWRKX,DEBNMEXT           BY OFFSETTING FOR               10248602
         SLL   RWRKX,TIMES16            NUMBER OF EXTENTS X 16          10249002
         AR    RDEBEXT,RWRKX            ADDRESS OF END OF EXTENTS       10249402
         SR    RWRKX,RWRKX              CLEAR REGISTER                  10249502
         IC    RWRKX,DEBAMLNG           ACCESS METHOD LENGTH (WORD      10249602
         SLL   RWRKX,TIMES4             COUNT FOR RELATIVE EXTENTS)     10249702
         AR    RDEBEXT,RWRKX            TIMES 4                         10299702
         SPACE 2                                                        10301702
****                                                                    10303702
****    LOAD THE FOUNDATION MODULE REQUIRED. THE ID OF THE MODULE       10319702
****    TO BE LOADED IS PASSED IN RWRKX(R14). THE ADDRESS OF MODULE     10321702
****    ON RETURN IS IN R0. RETURN LINKAGE IS VIA RETURN(R2).           10323702
****                                                                    10329702
         TM    DCBBFTEK,DCBBFTKR        TEST FOR BUFTEK=R        S19015 10339702
         BZ    LOADS                    BR TO LOAD KA IF NOT R   S19015 10341702
         TM    DCBRECFM,DCBRECV+DCBRECSB  IS RECFM=VS            S19015 10343702
         BO    VBOK                     YES,BRANCH               S19015 10345702
ROFF     NI    DCBBFTEK,X'FF'-DCBBFTKR  TURN OFF BUFTEK=R BIT    S19015 10347702
         B     LOADS                    LOAD NON VRE MODULES     S19015 10348102
VBOK     TM    DCBRECFM,DCBRECBR        TEST FOR RECFM=VBS       S19015 10348502
         BO    ROFF                     BRANCH IF YES            S19015 10348902
         LA    RWRKX,IDVREKJ            INITIALIZE POINTER TO KJ Y02072 10349302
         BAL   RETURN,MODLOAD           GO LOAD FOUNDATION MOD   Y02072 10349402
         B     RTPT                     GO TO NEXT ROUTINE       Y02072 10349502
LOADS    LA    RWRKX,IDNOVSKA           INITIALIZE POINTER TO KA Y02072 10349602
         BAL   RETURN,MODLOAD           LOAD FOUNDATION MODULE   Y02072 10379702
RTPT     SR    RWRKY,RWRKY              CLEAR WORK REGISTER      Y02072 10389702
         IC    RWRKY,DCBOFLGS           SAVE OPEN FLAGS                 10429702
         ST    R0,DCBREAD               STORE FOUNDATION MODULE ADDR    10439702
         STC   RWRKY,DCBOFLGS           RESTORE OPEN FLAGS              10439802
         SPACE 2                                                        10483202
****                                                                    10493202
****     THE NEXT ROUTINE CHECKS FOR FEEDBACK OPTION AND WRITE ADD      10495202
****     FUNCTION. BOTH MODULE'S ADDRESSES WILL BE PUT IN THE DCB.      10497202
****                                                                    10499202
*                        TEST FOR FEEDBACK OPTION                       10499637
         TM    DCBOPTCD,DCBOPTF         TEST NEED FOR THE RELATIVE      10499802
         BZ    WRITEADD                 BLOCK FEEDBACK MODULE    Y02072 10499902
         LA    RWRKX,IDFEEDKG           LOAD FIXED FORMAT ID     Y02072 10509902
         TM    DCBOPTCD,DCBOPTTO        IS IT TRK OVERFLOW       Y02072 10511902
         BNO   RELFEED                  NO, ID FOR 19KG OK       Y02072 10512302
         LA    RWRKX,IDFEEDKH           GET OVERFLO FORMAT       Y02072 10512702
RELFEED  EQU   *                        GO LOAD REL BLK FORMAT   Y02072 10513102
         BAL   RETURN,MODLOAD           LOAD IT IF REQUIRED AND  Y02072 10513202
         ST    R0,DCBDFBK               STORE THE ADDRESS IN THE DCB    10523202
WRITEADD EQU   *                        TEST IF WRITE ADD REQ    Y02072 10533202
         TM    DCBMACF2,DCBMRAWR        WRITE ADD MODULE REQUIRED       10535202
         BZ    TSTCHK                   BRANCH NO                       10537202
         TM    DCBBFTEK,DCBBFTKR        TEST FOR BUFTEK=R        S19015 10539202
         BZ    LDFMTMOD                 BR IF BUFTEK IS NOT R    S19015 10539602
         LA    RWRKX,IDWAKN             INITIALIZE POINTER TO KN Y02072 10539702
         BAL   RETURN,MODLOAD           LOAD MODULE KN           Y02072 10539802
         ST    R0,DCBDFOR               STORE THE ADDRESS IN DCB S19015 10539902
         B     TSTCHK                   GO PROCESS NEXT RTN      Y02072 10543202
LDFMTMOD TM    DCBRECFM,DCBRECV         IS DATA SET              S19015 10545202
*                                       PRE-FORMATTED            S19015 10547202
         BZ    PREFM                    YES, GO LOAD FIXED INDEX        10549202
         LA    RWRKX,IDWAKM             INITIALIZE POINTER TO KM Y02072 10549602
LDADD    BAL   RETURN,MODLOAD           LOAD FORMAT MODULE AND   Y02072 10549702
         ST    R0,DCBDFOR               STORE THE ADDRESS IN THE DCB    10549802
         B     TSTCHK                   BR TO PROCESS NEXT RTN   Y02072 10549902
PREFM    LA    RWRKX,IDWAKO             INITIALIZE POINTER TO KO Y02072 10550602
         B     LDADD                    ENTRIES AND GO LOAD MODULE.     10551002
         SPACE                                                          10601002
****                                                                    10627602
****     THIS ROUTINE TESTS FOR ADDITIONAL OPTIONS AND LOADS THE        10628002
****     REQUIRED OPTION MODULES INCLUDING CHECK AND THE APPENDAGES     10628102
****                                                                    10628202
TSTCHK   EQU   *                        LOAD CHECK MOD           Y02072 10628302
         TM    DCBMACF1,DCBMRCK         IS CHECK MACRO BEING USED       10628502
         BZ    TDYNBUF                  NO,GO TEST DYN BUFFERING Y02072 10628902
         LA    RWRKX,IDCHKLI            POINT TO CHECK ID, 19LI  Y02072 10629102
         BAL   RETURN,MODLOAD           LOAD THE CHECK ROUTINE   Y02072 10632002
         SR    RWRKY,RWRKY              CLEAR WORK REGISTER      Y02072 10632102
         IC    RWRKY,DCBOPTCD           SAVE THE OPTCD BITS             10632202
         ST    R0,DCBCHECK              STORE THE CHECK ROUTINE ADDRESS 10632402
         STC   RWRKY,DCBOPTCD           RESTORE THE OPTCD BITS          10632602
TDYNBUF  EQU   *                        TEST FOR DYN BUFFERING @ZA08000 10632837
*IS NO LONGER REQUIRED BECAUSE ONE OF THE APP. WILL            @ZA08000 10634637
* ALWAYS BE LOADED                                             @ZA08000 10634737
         LA    RWRKX,IDSIOLE            LOAD SIO APPENDAGE 19LE  Y02072 10635002
         L     RTCB,DEBTCBAD            GET TCB ADDRESS                 10635402
         USING TCB,RTCB                 ESTABLISH TCB BASE REG          10635602
         TM    TCBFLGS6,TCBRV           IS ADDRSPCE REAL         XM6189 10635802
         BO    REALOK                   BRANCH IF ADDRSPCE REAL         10636002
         LA    RWRKX,DYNOFFST(RWRKX)    INCREMENT TO VIRTUAL            10636202
         DROP  RTCB                     DROP TCB BASE REGISTER          10636402
REALOK   EQU   *                                                        10636602
         BAL   RETURN,MODLOAD           LOAD THE APPENDAGE       Y02072 10636802
         ST    R0,DEBSIOA               DYN BUF MOD = SIO APD           10637002
*                        TEST FOR EXTENDED SEARCH                Y02072 10637137
         TM    DCBOPTCD,DCBOPTE         REQUIRED IF EXTEND SRCH  YM1383 10637402
         BZ    LDCEXCE                  HAS BEEN SPECIFIED              10637602
         LA    RWRKX,IDEOELC            END OF EXTENT APPENDAGE  Y02072 10637702
         BAL   RETURN,MODLOAD           LOAD THE APPENDAGE       Y02072 10637802
         ST    R0,DEBEOEA               STORE ADDR IN AVT               10638002
LDCEXCE  LA    RWRKX,IDCEKU             LOAD CHANNEL END AND     Y02072 10638202
         BAL   RETURN,MODLOAD           EXCEPTIONAL CHAN. END    Y02072 10638402
         ST    R0,DEBCEA                STORE ADDR IN AVT               10638602
         LR    RWRKX,R0                 OFFSET TO EXCEPTIONAL CHANNEL   10638802
         L     RWRKY,FOURBYTS(RWRKX)    ABE OFFSET IS 4 BYTES INTO 19KU 10639002
         AR    RWRKY,RWRKX              ADD TO BEGIN OF 19KU            10639202
         ST    RWRKY,DEBXCEA            ABNORMAL END APPENDAGE ADDR     10639402
         DROP  RWTG                     DROP WTG TABLE BASE      Y02072 10639502
         EJECT                                                          10639802
*********************************************************************** 10640002
*  FUNCTION III: THE FOLLOWING FUNCTION INITIALIZES THE REMAINING     * 10640302
*  DCB FIELDS, CALLS FOR THE CONSTRUCTION OF THE IRB AND CONSTRUCTS   * 10640702
*  A READ EXCLUSIVE LIST IF REQUIRED. ALL PROCESSING IS IN DATA       * 10641102
*  MANAGEMENT KEY.                                                    * 10641202
*  INPUT TO THIS FUNCTION IS AS FOLLOWS:                              * 10645202
*              REGISTER 4 = OPEN WORKAREA ADDRESS                     * 10645302
*              REGISTER 9 = DEB AVT ADDRESS                           * 10645502
*              REGISTER 10= DCB ADDRESS                               * 10648002
*              OPEN WORKAREA CONTAINS ADDRESS OF DEB EXTENSION        * 10648402
*              ENTRY IN DATA MANAGEMENT KEY                           * 10648602
*  OUTPUT FROM THIS FUNCTION IS AS FOLLOWS:                           * 10648802
*              SAME AS INPUT                                          * 10649002
*              IRB HAS BEEN CONSTRUCTED AND INITIALIZED               * 10649202
*              READ EXCLUSIVE LIST HAS BEEN OBTAINED AND INITIALIZED  * 10649402
*              DCB FIELDS HAVE BEEN INITIALIZED                       * 10649602
*********************************************************************** 10650002
         SPACE                                                          10650202
FUNCT3   EQU   *                        BEGINNING OF FUNCTION 3  Y02072 10650402
         SPACE 2                                                        10650602
****                                                                    10651202
****   INITIALIZE THE DCB FIELDS WHICH ARE USED BY BDAM.                10651302
****                                                                    10651402
         XC    DCBIOBAD,DCBIOBAD        CLEAR IOB POOL POINTER AND      10651602
         XC    DCBIOBSQ(DCBIOBQS),DCBIOBSQ  IOB QUEUE POINTERS          10651802
         SPACE 2                                                        10652002
****                                                                    10652202
**** THE FOLLOWING ROUTINE DETERMINES IF A READ EXCLUSIVE LIST IS       10652302
**** REQUIRED AND IF SO BALRS TO THE SUBROUTINE TO GET IT FROM SP230.   10652402
**** THE POINTER TO THE READX LIST IS STORED IN THE DEB EXTENSION AT    10652602
**** LABEL DEBXXARG.  THE DEB EXTENSION IS GOTTEN AND INITIALIZED BY    10652802
**** COMMON OPEN.  ITS ADDRESS IS STORED BY COMMON OPEN IN THE OPEN     10653002
**** WORKAREA AT LABEL DXDEBXAD.                                        10653202
****                                                                    10653402
         TM    DCBMACF1,DCBMRRDX        DID USER SPECIFY READ    A35339 10653902
*                                       EXCLUSIVE                A35339 10654002
         BO    ORRDX                    BRANCH IF YES            A35339 10654202
         TM    DCBMACF2,DCBMRAWR        DID USER SPECIFY WR ADD  A35339 10654702
         BZ    SETUPIRB                 NO,BR TO NEXT ROUTINE    Y02072 10654802
         TM    DCBRECFM,DCBRECV         IF FORMAT FIXED          Y02072 10654902
         BO    ORRDX                    NO,XLUSIVE CNTRL REQ     Y02072 10655302
         LA    RWRKY,DEBBASND           GO TO DASD SECTION       Y02072 10655602
         USING DEBDASD,RWRKY            BASE FOR DASD SECTION    Y02072 10656002
         L     RWRKY,DEBUCBAD           GET UCB FROM 1ST EXT     Y02072 10656202
         DROP  RWRKY                                             Y02072 10656302
         USING UCBOB,RWRKY              BASE FOR UCB             Y02072 10656402
         CLI   UCBTBYT4,UCB23051        IS DEVICE 2305-1         Y02072 10657002
         BE    ORRDX                    YES, XCLUSIVE CNTROL REQ Y02072 10667002
         CLI   UCBTBYT4,UCB23052        IS DEVICE 2305-2         Y02072 10669002
         BNE   SETUPIRB                 NO, NO XLUSIVE CNTRL     Y02072 10671002
         DROP  RWRKY                                             Y02072 10673002
****                                                                    10673402
****                GET CORE FOR EXCLUSIVE CONTROL LIST                 10673802
****                                                                    10674202
ORRDX    OI    DCBOPTCD,DCBOPTRE        SET EXCLUSIVE OPTION     A35339 10674602
         LA    R1,RDXLSTLG              LOAD LENGTH IN REG 1-    Y02072 10675202
*                                       SUBRTN EXPECTS LEN IN REG 1     10675602
         BAL   RETURN,ENTSP230          GO GET CORE              Y02072 10675802
         USING RDXLIST,R1               ESTABLISH READX LIST BASE       10680902
         XC    RDXLIST(RDXLSTLG),RDXLIST  CLEAR CORE FOR XLIST   A35339 10681602
         L     RWRKX,DXDEBXAD           GET DEBEXT PTR IN WKAREA Y02072 10682302
         USING DEBXTN,RWRKX             EST BASE FOR DEB EXT     Y02072 10683002
         ST    R1,DEBXXARG              ST RDXLST PTR IN DEBEXT  Y02072 10683702
         OI    DXATEXC1,FCAORDX         SET AUDIT TRAIL BIT      Y02072 10684102
*                                       FOR FORCE CLOSE CLEANUP  Y02072 10684202
*                                       INDICATING READX LIST    Y02072 10684302
         DROP  R1,RWRKX                 DROP READX AND DEBEXT BASES     10684402
         SPACE 2                                                        10685102
****                                                                    10685802
****     INITIALIZE THE IRB                                             10686502
****                                                                    10687202
SETUPIRB EQU   *                                                        10687902
         L     RWRKX,DCBREAD             LOCATE ASI ADDRESS             10688602
         L     R0,ASYNCAD(,RWRKX)        LOAD ASI ADDR INTO PARAMETER   10689302
*                                        REGISTER                       10690002
         CLI   DXUKEY,USERPOOL          CALLER IN KEY ZERO?      YM7957 10690402
         BE    ZEROCIRB                 YES, CIRB SUP STATE/KEY  YM7957 10690502
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE)                          10690702
         B     DONECIRB                 CIRB HAS BEEN DONE       YM7957 10691102
ZEROCIRB EQU   *                                                 YM7957 10691202
         CIRB  EP=(0),KEY=SUPR,MODE=SUPR,STAB=(RE)               YM7957 10691902
DONECIRB EQU   *                                                 YM7957 10708402
         O     R1,DEBIRBAD              SAVE HI ORDER BYTE BY OR'ING IT 10709102
         ST    R1,DEBIRBAD              INTO REG ,THEN STORE IRB ADDR   10709802
****                                                                    10710502
****            DETERMINE WHERE TO GO FROM HERE                         10711202
****                                                                    10711902
         TM    DCBBFTEK,DCBBFTKR        TEST FOR BUFTEK=R               10712602
         BZ    NOVRE                    IF NOT R BRANCH                 10713302
         TM    DCBMACF2,DCBMRSWA        DID USER SUPPLY SWA             10714002
         BO    FUNCT7                   YES, DCB COMPLETED       Y02072 10714702
         B     FUNCT6                   BRANCH TO GET SWAS       Y02072 10715402
NOVRE    EQU   *                                                        10716102
         TM    DCBOPTCD,DCBOPTRB        RELATIVE BLOCK SPECIFIED Y02072 10716802
         BO    FUNCT4                   BR TO REL BLK RTN        Y02072 10717502
         TM    DCBOPTCD,DCBOPTDB        DYN BUFFERING SPECIFIED  Y02072 10718202
         BO    FUNCT5                   YES, GO TO DYN BUF RTN   Y02072 10718902
         B     FUNCT7                   NO, GO TO EXIT MODULE    Y02072 10719602
         EJECT                                                          10720302
*********************************************************************** 10721002
*  FUNCTION IV:  THE FOLLOWING FUNCTION IS EXECUTED FOR RECFM=F OR FT * 10721702
*  ONLY WHEN OPTCD=R (RELATIVE BLOCK ADDRESSING). IN THIS CASE, REL-  * 10722402
*  ATIVE EXTENTS, ONE PER PRIMARY EXTENT, ARE APPENDED TO THE DEB.    * 10723102
*  EACH RELATIVE EXTENT CONTAINS THE FOLLOWING:                       * 10723802
*    OVERFLOW:  NUMBER OF TRACKS PER PERIOD- 4 BYTES(OCCURS ONCE/DEB) * 10724502
*               NUMBER OF BLOCKS PER PERIOD- 4 BYTES(OCCURS ONCE/DEB) * 10725202
*               NUMBER OF BLOCKS PER EXTENT- 4 BYTES(OCCURS ONCE/EXT) * 10725902
*    NOT OVFLO: NUMBER OF BLOCKS PER TRACK- 1 BYTE(OCCURS ONCE/EXT)   * 10726602
*               NUMBER OF BLOCKS PER EXTENT- 3 BYTES(OCCURS ONCE/EXT) * 10727302
*  THESE RELATIVE EXTENTS ARE USED TO CALCULATE THE POSITION OF A     * 10728002
*  RELATIVE BLOCK WITHIN THE DATA SET. ALL PROCESSING IS IN DATA      * 10728702
*  MANAGEMENT KEY.                                                    * 10729402
*  INPUT TO THIS FUNCTION IS AS FOLLOWS:                              * 10730102
*              REGISTER 4 = OPEN WORKAREA ADDRESS                     * 10730802
*              REGISTER 9 = DEB AVT ADDRESS                           * 10731502
*              REGISTER 10= DCB ADDRESS                               * 10732202
*              ENTRY IN DATA MANAGEMENT KEY                           * 10732902
*              DEB WITH PRIMARY EXTENTS INITIALIZED                   * 10733602
*  OUTPUT FROM THIS FUNCTION IS AS FOLLOWS:                           * 10734302
*              SAME AS INPUT                                          * 10735002
*              RELATIVE EXTENTS IN DEB HAVE BEEN INITIALIZED          * 10735702
*********************************************************************** 10736402
         SPACE                                                          10737102
FUNCT4   EQU   *                        BEGINNING OF FUNCTION IV        10737802
         MVI   DWAFLAGS,0               INIT TO FIRST PASS       A49438 10738502
         SR    RDSSSZ,RDSSSZ            SET DATA SET SIZE TO ZERO       10739202
         SR    RXTNCUR,RXTNCUR          CLEAR NUMBER OF EXTENTS REG     10739902
         IC    RXTNCUR,DEBNMEXT         GET NUMBER OF EXTENTS           10740602
         LA    RDEBAM,DEBBASND          POINT TO DEB DASD        Y02072 10741302
EXTLOOP  LA    RDEBAM,DEBDASDL(,RDEBAM) ADD ON EXTENT SIZE AS MANY      10742002
         BCT   RXTNCUR,EXTLOOP          TIMES AS THERE ARE EXTENTS      10742702
         USING DEBACSMD,RDEBAM          ESTABLISH DAM ACCESS METHOD     10743402
*                                       SECTION BASE REG                10744102
         IC    RXTNCUR,DEBNMEXT         GET NUMBER OF EXTENTS           10744802
         L     RWRKY,CVTPTR             GET ADDRESS OF THE CVT          10746202
         USING CVT,RWRKY                ESTABLISH CVT BASE REG          10746902
         L     RDVCT,CVTZDTAB           GET ADDR OF DEV CHAR TABL INDEX 10747602
         DROP  RWRKY                    DROP CVT BASE REG               10748302
         USING DVCTI,RDVCT              ESTABLISH DEVICE CHAR TABLE     10749002
*                                       INDEX BASE REG                  10749702
         LR    RDEBEXT,RDEBA            DEBAVT ADDR IN EXT REG   Y02072 10750402
         USING DEBDASD-(DEBBASND-DEBAVT),RDEBEXT  ESTABLISH DEB DASD    10751102
*                                       BASE (RDEBA PTS TO AVT)  Y02072 10751802
         L     RWRKX,DEBUCBAD           LOCATE DEVICE TYPE TO MATCH UCB 10752502
         USING UCBOB,RWRKX              ESTABLISH UCB BASE REG          10753202
         LA    RWRKY,DVCTYPMK           GET MASK FOR UNIT TYPE          10753902
         N     RWRKY,UCBTYP             GET UNIT TYPE                   10754602
         IC    RWRKY,DVCTIOFF(RWRKY)    GET OFFSET TO DEV CHAR TAB      10755302
         DROP  RDVCT,RWRKX              DROP UCB AND DVCT BASES         10756002
         LA    RDVCT,0(RWRKY,RDVCT)     GET DEVICE ENTRY IN TABLE       10756702
*                                                                       10757402
         USING DVCT,RDVCT               EST DEVICE CHAR TABLE BASE REG  10758102
         SR    RWRKX,RWRKX              CLEAR REGISTER                  10758802
         SR    RWRKY,RWRKY              CLEAR REGISTER                  10759502
         LH    RWRK0,DVCTOL             GET TOLERANCE           ZA02523 10809502
         STH   RWRK0,DWADVTOL           SAVE TOLER IN WKAREA    ZA02523 10859502
         SR    RWRK0,RWRK0              CLEAR WORK REG          ZA02523 10961502
*                                                                       10963502
*                                                                       10965502
*    TWO VALUES NEED BE CALCULATED, APPLICABLE TO BOTH TRACK            10965902
*    OVERFLOW AND NON-OVERFLOW - BLKSIZE AND KEY LENGTH + OVERHEAD      10966302
*    (MINUS KEY OVERHEAD IF NO KEYS) FOR:  A) THE LAST RECORD ON        10968202
*    THE TRACK (DWARLREC) AND, B) THE FIRST OR INTERMEDIATE RECORD      10970202
*    ON THE TRACK (DWARNREC), WHICH INCLUDES TOLERANCE.                 10970602
*                                                                       10971002
*                                                                       10971402
*     CALCULATE SIZE OF THE LAST RECORD ON THE TRACK                    10971502
*                                                                       10971602
         IC    RWRKY,DVCOVLB            GET OVERHD,LAST BLK     ZA02523 10971702
         TM    DVCFLAGS,DVC2BOV         TWO BYTE OVERHEAD       ZA02523 10971802
         BNO   NOT2BYTA                 NO, NOT 2305            ZA02523 10972002
         LH    RWRKY,DVCOVHD            YES, GET 2 BYTES        ZA02523 10972102
NOT2BYTA EQU   *                        TEST FOR KEYS           ZA02523 10972202
         IC    RWRKX,DCBKEYLE           GET KEY LENGTH          ZA02523 10972302
         LTR   RWRKX,RWRKX              ARE THERE KEYS          ZA02523 10972402
         BNZ   KEYS                     YES, DONT SUBTR OVERHD  ZA02523 10972502
         IC    RWRK0,DVCOVNK            NO, GET OVERHD TO SUBTR ZA02523 10972602
KEYS     EQU   *                        SUBT KEY OVERHEAD       ZA02523 10972702
         AH    RWRKX,DCBBLKSI           ADD BLKSIZE TO KEY LEN  ZA02523 10972802
         SR    RWRKY,RWRK0              SUBT KEY OVERHD FROM    ZA02523 10972902
*                                       OVERHEAD FOR LAST BLK   ZA02523 10973002
         AR    RWRKX,RWRKY              ADD BLKSIZE+KEYLEN+     ZA02523 10973102
*                                       OVERHEAD FOR LAST BLK   ZA02523 10973202
*                                       MINUS KEY OVRHD IF NONE ZA02523 10973302
         ST    RWRKX,DWARLREC           SAVE # BYTES FOR LAST   ZA02523 10973402
*                                       ENTIRE RECORD ON TRK    ZA02523 10974002
*                                                                       10974402
*   CALCULATE SIZE OF FIRST OR INTERMEDIATE RECORD ON TRACK             10974802
*                                                                       10975202
         SR    RWRKX,RWRKY              SUBT OVERHD LEAVING     ZA02523 10975302
*                                       BLKSIZE AND KEYS        ZA02523 10975802
         MH    RWRKX,DWADVTOL           CALCULATE TOLERANCE     ZA02523 10976202
*                                       (1.049/1.0 X KL+DL)     ZA02523 10976602
         SRL   RWRKX,9                  DIVIDE BY 512           ZA02523 10977002
         IC    RWRKY,DVCOVNLB           OVERHD FOR NOT-LAST BLK ZA02523 10977102
         TM    DVCFLAGS,DVC2BOV         2 BYTE OVERHEAD         ZA02523 10977202
         BNO   NOT2BYTB                 NO, BRANCH AROUND       ZA02523 10977502
         LH    RWRKY,DVCOVHD            GET 2 BYTE OVERHD       ZA02523 10977902
NOT2BYTB EQU   *                        CALCULATE OVERHEAD      ZA02523 10978302
         SR    RWRKY,RWRK0              SUBTRACT KEY OVERHD     ZA02523 10978402
         AR    RWRKX,RWRKY              ADD 1ST/MID REC OVHD    ZA02523 10978502
*                                       TO BLKSIZE+KEY          ZA02523 10978602
         ST    RWRKX,DWARNREC           SAVE TOTAL REC BYTES-   ZA02523 10978702
*                                       INCLUDES OVERHD FOR NOT ZA02523 10978802
*                                       LAST REC+DL+KL+TOLER    ZA02523 10978902
         LH    RWRKY,DVCTRKLN           GET TRK LG FROM TABLE   ZA02523 10979002
         ST    RWRKY,DWATRKLN           SAVE TRK LG IN WKAREA   ZA02523 10979402
         TM    DCBRECFM,DCBRECTO        OVERFLOW RECORDS PRESENT        10979502
         BNZ   OVERFLOW                 YES, BRANCH THERE       ZA02523 10979602
*                                                                       10979702
*                                                                       10979802
*     APPEND THE RELATIVE EXTENTS TO THE DEB FOR RELATIVE TRACK         10980202
*     ADDRESSING WITHOUT TRACK OVERFLOW.                                10980602
*                                                                       10981002
*                                                                       10981102
RECTRK   EQU   *                        CALC PERIODS-NO OVFLO   ZA02523 10981202
         SR    RWRKY,RWRKY              CLEAR FOR RECORDS/TRACK ZA02523 10981402
         SR    RNRCD,RNRCD              CLEAR FOR RECORDS/EXT   ZA02523 10981802
         L     RWRKX,DWATRKLN           GET TRACK LENGTH        ZA02523 10981902
COMPLNG  C     RWRKX,DWARLREC           COMPARE TO LAST REC REQ ZA02523 10982002
         BL    RECEXT                   BRANCH IF TRACK IS FULL ZA02523 10982102
         S     RWRKX,DWARNREC           DECRMENT BY MID-REC LEN ZA02523 10982202
         LA    RWRKY,1(RWRKY)           ADD ONE TO RECS/TRK     ZA02523 10982302
         B     COMPLNG                  LOOP                            10982402
RECEXT   EQU   *                                                        10982502
         LR    RWRK0,RWRKY              SAVE RECS/TRK IN WKREG0 ZA02523 10982802
         MH    RWRKY,DEBNMTRK           RECS/TRK * TRKS/EXTENT  ZA02523 10983202
         STCM  RWRKY,ADDR,DEBDBPE       STORE RECORDS/EXTENT    ZA02523 10983302
         STC   RWRK0,DEBDBPT            STORE RECORDS PER TRACK ZA02523 10983602
         AR    RDSSSZ,RWRKY             ADD TO DATA SET SIZE    ZA02523 10983702
         LA    RDEBAM,L'DEBDBLK(RDEBAM) INCREMENT BOTH                  10983802
         LA    RDEBEXT,DEBDASDL(RDEBEXT) EXTENT POINTERS                10983902
         BCT   RXTNCUR,RECTRK           TEST FOR LAST EXTENT IN DEB     10984202
         B     STDCBREL                 GO STORE TOTAL BLKS     ZA02523 10984302
*                                                                       10984402
*                                                                       10984502
*                                                                       10984602
*        FOR OVERFLOW RECORDS THREE ADDITIONAL VALUES MUST BE           10984902
*        CALCULATED BEFORE BUILDING THE RELATIVE EXTENTS:               10985302
*             A) OVERHEAD FOR A FULL TRACK SEGMENT OTHER THAN THE       10985402
*                THE FIRST SEGMENT OF THE BLOCK - WILL ALWAYS           10985502
*                BE LAST RECORD ON TRACK AND WILL HAVE NO KEYS          10985602
*                (DWARCOVH)                                             10985702
*             B) OVERHEAD FOR 1ST SEGMENT OF A RECORD -                 10985802
*                ALWAYS LAST RECORD ON THE TRACK AND WILL               10985902
*                HAVE A KEY, IF SPECIFIED (DWARCTKY)                    10986002
*             C) OVERHEAD FOR LAST SEGMENT OF A BLOCK THAT IS           10986102
*                NOT THE LAST RECORD ON THE TRACK - NO KEY,             10986202
*                BUT REQUIRES CALCULATION FOR TOLERANCE (DWAOFLOW)      10986302
*                                                                       10986702
*                                                                       10987102
*                                                                       10987502
*    CALCULATE OVERHEAD FOR FULL TRACK SEGMENT OTHER THAN THE           10987902
*    FIRST SEGMENT (LAST RECORD ON TRACK - NO KEY OVERHEAD)             10988002
*                                                                       10988102
OVERFLOW EQU   *                        CALCULATE OVERFLOW DEB  ZA02523 10988202
         SR    RWRKX,RWRKX              CLEAR WORK REG          ZA02523 10988302
         SR    RWRKY,RWRKY              CLEAR WORK REG          ZA02523 10988402
         IC    RWRKX,DVCOVLB            GET OVERHD,LAST BLK     ZA02523 10988502
         TM    DVCFLAGS,DVC2BOV         2 BYTE OVERHEAD-2305    ZA02523 10988602
         BNO   NOT2BYTC                 NO, BRANCH AROUND       ZA02523 10989202
         LH    RWRKX,DVCOVHD            GET 2 BYTE OVERHEAD     ZA02523 10989302
NOT2BYTC EQU   *                        CALCULATE OVERHEAD      ZA02523 10989402
         IC    RWRKY,DVCOVNK            GET OVERHEAD FOR KEYS   ZA02523 10989502
         SR    RWRKX,RWRKY              SUBT KEY OVERHD FROM    ZA02523 10989902
*                                       TOTAL LAST-REC OVERHD   ZA02523 10990002
         ST    RWRKX,DWARCOVH           OVERHD IF FULL TRACK    ZA02523 10990102
*                                       SEG OTHER THAN 1ST      ZA02523 10990202
*                                                                       10990302
*    CALCULATE OVERHEAD FOR FIRST SEGMENT OF BLOCK - KEEP               10990702
*    KEY OVERHEAD IF KEYS. IT IS ALWAYS LAST RECORD ON TRACK            10990802
*                                                                       10990902
         CLI   DCBKEYLE,0               ARE THERE KEYS          ZA02523 10991002
         BE    NOKEYS                   NO,SAME OVERHEAD AS     ZA02523 10991102
*                                       FULL TRACK SEGMENT      ZA02523 10991502
         AR    RWRKX,RWRKY              ADD BACK KEY OVERHEAD   ZA02523 10991602
NOKEYS   EQU   *                        SAVE 1ST SEG OVERHEAD   ZA02523 10991702
         ST    RWRKX,DWARCTKY           OVERHEAD FOR 1ST SEG    ZA02523 10991802
*                                       OF OVERFLOW RECORD      ZA02523 10991902
*                                                                       10992302
*    CALCULATE OVERHEAD FOR LAST SEGMENT OF A BLOCK IF IT               10992402
*    IS NOT THE LAST RECORD ON THE TRACK. THERE IS NO KEY,              10992502
*    BUT DOES NEED TOLERANCE CALCULATED.                                10992602
*                                                                       10994002
         SR    RWRKX,RWRKX              CLEAR WORK REG          ZA02523 10996002
         SR    RWRKY,RWRKY              CLEAR WORK REG          ZA02523 10996402
         IC    RWRKX,DVCOVNLB           OVERHEAD FOR NOT-LAST   ZA02523 10996502
         TM    DVCFLAGS,DVC2BOV         2 BYTE OVERHEAD-2305    ZA02523 10996602
         BNO   NOT2BYTD                 NO, BRANCH AROUND       ZA02523 10997002
         LH    RWRKX,DVCOVHD            GET 2 BYTE OVERHEAD     ZA02523 10997402
NOT2BYTD EQU   *                        CALCULATE OVERHEAD      ZA02523 10997502
         IC    RWRKY,DVCOVNK            GET KEY OVERHEAD        ZA02523 10997602
         SR    RWRKX,RWRKY              SUBT KEY OVERHD FROM    ZA02523 10997702
*                                       OVHEAD OF NOT-LAST REC  ZA02523 10997802
         ST    RWRKX,DWAOFLOW           OVERHEAD FOR LAST SEG   ZA02523 10997902
*                                       OF BLK IF NOT LAST REC  ZA02523 10998002
*                                                                       10998402
*                                                                       10998802
*      THE FOLLOWING CALCULATES THE RELATIVE EXTENTS FOR OVERFLOW       10999202
*                                                                       10999302
         MVI   DWATTRKS,DWAFAIL1        INITIAL COMPARE FAILURE ZA02523 10999402
*                                                                       10999802
NEXTEXT  EQU   *                        CALCULATE THIS EXTENT   ZA02523 11000202
         SR    RNRCD,RNRCD              CLEAR RECS/PERIOD REG   ZA02523 11000602
         SR    RNTRK,RNTRK              CLEAR TRKS/PERIOD REG   ZA02523 11000702
         L     RWRKX,DWARLREC           GET LAST REC LG+OVERHD  ZA02523 11000802
         CLC   DWARLREC,DWATRKLN        DOES REC FIT ON 1 TRK   ZA02523 11001102
         BH    BIGRECRD                 NO, BR TO BIGREC RTN    ZA02523 11001502
*                                                                       11001902
*                                                                       11002302
*      THE FOLLOWING CALCULATES PERIOD SIZE WHEN BLKSIZE+KEYLENGTH+     11002502
*      OVERHEAD IS LESS THAN A FULL TRACK                               11002602
*                                                                       11002702
*                                                                       11002802
         L     RODD,DWATRKLN            GET TRACK LENGTH        ZA02523 11002902
*                                                                       11003002
*     ON ENTRY TO THIS ROUTINE RODD CONTAINS THE NUMBER OF              11003102
*     BYTES ON THE TRACK STILL TO BE DIVIDED INTO RECORDS               11003202
*                                                                       11003402
LOOP     EQU   *                        CALCULATE PERIOD        ZA02523 11003802
         SR    REVEN,REVEN              CLEAR REG FOR DIVISION  ZA02523 11004202
         D     REVEN,DWARNREC           DIVIDE TO GET NO. RECS/ ZA02523 11004302
*                                       TRK(RODD) AND NO.BYTES  ZA02523 11004402
*                                       REMAINING ON TRK FOR    ZA02523 11004502
*                                       1ST SEGMENT OF NEXT REC ZA02523 11004602
         LA    RNTRK,1(RNTRK)           ADD 1 TO TRK COUNT      ZA02523 11004702
         AR    RNRCD,RODD               ADD QUOT TO REC TOTAL   ZA02523 11004802
         S     REVEN,DWARCTKY           SUBT OVERHD REQUIRED    ZA02523 11005002
*                                       FOR 1ST SEG OF OVFLO    ZA02523 11005402
         BNP   FINI                     IF NO ROOM FOR OVERHD   ZA02523 11005802
*                                       +1 BYTE,END OF PERIOD   ZA02523 11006202
         A     REVEN,DWARCTKY           ADJUST BACK PREVIOUS    ZA02523 11006402
*                                       1ST-REC OVERHD.         ZA02523 11006802
         TM    DWAFLAGS,DWAPASS2        TEST FOR 2ND PASS       ZA02523 11007202
         BZ    FSTPASS1                 IF NOT, PROCEED         ZA02523 11007602
         C     RNTRK,DWATTRKS           COMPARE TRKS TO TOTAL   ZA02523 11007702
         BE    FINI2                    YES, END OF EXT&PERIOD  ZA02523 11007802
*                                                                       11007902
*      CALCULATE SIZE OF FIRST(OVERFLOW) SEGMENT OF NEW RECORD          11008302
*                                                                       11008402
FSTPASS1 EQU   *                        NOT END OF EXTENT       ZA02523 11008502
         LA    RNRCD,1(RNRCD)           ADD 1 TO RECORD COUNT   ZA02523 11008702
*                                       FOR CURRENT RECORD      ZA02523 11009102
         L     RWRKY,DWARLREC           SUBT LAST RECORD SIZE   ZA02523 11009202
         SR    RWRKY,REVEN              FROM NUMBER OF BYTES    ZA02523 11009302
*                                       LEFT ON TRACK. RESULT   ZA02523 11009402
*                                       IS NO. DATA BYTES TO BE ZA02523 11009502
*                                       WRITTEN ON NEXT TRACK   ZA02523 11009702
         BNP   FINI                     IF WHOLE LAST REC FITS  ZA02523 11010102
*                                       ON CURRENT TRK,HOWEVER  ZA02523 11010502
*                                       END OF PERIOD           ZA02523 11010902
*                                                                       11011002
*      RWRKY CONTAINS NUMBER OVERFLOW DATA BYTES TO BE WRITTEN          11011102
*      ON NEXT TRACK.                                                   11011202
*                                                                       11011302
         MH    RWRKY,DWADVTOL           ADD TOLERANCE TO TOTAL  ZA02523 11011402
         SRL   RWRKY,9                  DIVIDE BY 512           ZA02523 11011502
         A     RWRKY,DWAOFLOW           ADD OVERHD FOR LAST SEG ZA02523 11011602
*                                       OF BLK THAT IS NOT LAST ZA02523 11011802
*                                       RECORD ON THE TRACK     ZA02523 11012202
         L     RODD,DWATRKLN            GET TRK LENGTH          ZA02523 11012602
         SR    RODD,RWRKY               SUBT # BYTES ALREADY    ZA02523 11012702
*                                       USED FOR OVERFLOW SEG   ZA02523 11012802
         S     RODD,DWARCTKY            SUBT OVERHEAD REQUIRED  ZA02523 11012902
*                                       FOR ANOTHER RECORD ON   ZA02523 11013002
*                                       THIS TRACK              ZA02523 11013202
         BNP   LASTTRK2                 IF NOT ENOUGH BYTES,    ZA02523 11013602
*                                       END OF PERIOD           ZA02523 11014002
         A     RODD,DWARCTKY            ELSE, ADD BACK ON THE   ZA02523 11014102
*                                       OVERHEAD BYTES          ZA02523 11014202
         B     LOOP                     RETURN TO CALCULATE     ZA02523 11014302
*                                       REMAINING RECORDS ON    ZA02523 11014402
*                                       THIS TRACK              ZA02523 11014502
*                                                                       11014602
LASTTRK2 EQU   *                        END OF PERIOD           ZA02523 11014702
         LA    RNTRK,1(RNTRK)           INCLUDE CURRENT TRK     ZA02523 11014802
         B     FINI                     GO STORE PERIOD VALUES  ZA02523 11014902
*                                                                       11015302
*                                                                       11015502
*     THE FOLLOWING CALCULATES PERIODS WHEN DL + KL  + OVERHEAD         11017502
*     IS GREATER THAN TRACK CAPACITY.                                   11017602
*                                                                       11017702
*                                                                       11018102
BIGRECRD EQU   *                        CALCULATE LARGE RECS    ZA02523 11018202
         LA    RNTRK,1(RNTRK)           ADD 1 TO TRACK COUNT    ZA02523 11018302
         L     RWRKY,DWARLREC           GET REC LEN IF LAST REC ZA02523 11018402
*                                       ON TRACK                ZA02523 11018802
         S     RWRKY,DWATRKLN           SUBTR LENGTH OF TRK     ZA02523 11018902
*                                       FROM LENGTH OF 1 RECORD ZA02523 11019002
*                                                                       11019102
*      RWRKY CONTAINS NUMBER OF DATA BYTES THAT DID NOT FIT             11019502
*      ON THAT TRACK                                                    11019902
*                                                                       11020302
LOOP2    EQU   *                        CALCULATE BYTE NEXT TRK ZA02523 11020702
         TM    DWAFLAGS,DWAPASS2        TEST FOR 2ND PASS       ZA02523 11020802
*                                       NOTE: 2ND PASS CALCULATES       11020902
*                                       RECORDS/EXTENT. 1ST PASS        11021002
*                                       CALCULATES RECORDS/PERIOD       11021102
         BZ    FSTPASS2                 IF NOT, GO ON           ZA02523 11021502
         C     RNTRK,DWATTRKS           COMPARE TRKS TO TOTAL   ZA02523 11021902
         BE    FINI2                    IF EQUAL,END OF EXTENT  ZA02523 11022302
*                                                                       11022702
FSTPASS2 EQU   *                        CONTINUE CALCULATIONS   ZA02523 11022802
         LA    RNTRK,1(RNTRK)           ADD 1 TO TRACK COUNT    ZA02523 11023202
         A     RWRKY,DWARCOVH           ADD OVERHD FOR LAST     ZA02523 11023602
*                                       RECORD ON TRACK         ZA02523 11024002
         S     RWRKY,DWATRKLN           SUBTR TRACK LENGTH      ZA02523 11024402
         BP    LOOP2                    IF POS. LOOP TO FIGURE  ZA02523 11024502
*                                       SEGMENT ON NEXT TRACK   ZA02523 11024602
*                                                                       11025002
*                        REC ENDS ON THIS TRACK                 ZA02523 11025437
         LA    RNRCD,1(RNRCD)           ADD 1 TO REC COUNT      ZA02523 11025802
*                                       AND BEGIN CALCULATING NEXT REC  11026202
         LTR   RWRKY,RWRKY              STILL MORE BYTES TO WRT ZA02523 11026302
         BZ    FINI                     NO, END OF PERIOD       ZA02523 11027102
         A     RWRKY,DWATRKLN           ADD BACK TRK LENGTH     ZA02523 11029102
*                                       SO DATA BYTES NOT NEG   ZA02523 11031102
         S     RWRKY,DWARCOVH           REMOVE OVERHD SO TOLER  ZA02523 11033102
*                                       CAN BE CALCULATED               11035102
*                                                                       11035202
*   ADD ON OVERHEAD FOR RECORD AS IF IT WERE NOT LAST ON TRACK - WILL   11035402
*   THE FIRST SEGMENT OF THE NEXT RECORD FIT, I.E. ARE THERE ENOUGH     11035802
*   BYTES LEFT ON THE TRACK AFTER THIS RECORD(+ TOLERANCE AND OVER-     11036102
*   HEAD) TO HOLD THE OVERHEAD FOR THE LAST RECORD ON TRACK + KEY       11036502
*   OVERHEAD IF ANY + 1 DATA BYTE MINUMUM?                              11036602
*                                                                       11036702
         MH    RWRKY,DWADVTOL           CALCULATE TOLERANCE     ZA02523 11036802
         SRL   RWRKY,9                  FOR RECORD THATS NOT    ZA02523 11037002
         A     RWRKY,DWAOFLOW           LAST - ADD BACK OVERHD  ZA02523 11037402
         L     RWRKX,DWATRKLN           GET TRACK LENGTH        ZA02523 11037802
         SR    RWRKX,RWRKY              SUBT TO GET # BYTES     ZA02523 11038102
*                                       LEFT ON TRACK           ZA02523 11038502
         S     RWRKX,DWARCTKY           SUBT MINIMUM OVERHD     ZA02523 11038602
*                                       (LAST REC ON TRK) REQUIRED      11038802
*                                       FOR NEXT SEGMENT (IF NOT        11039202
*                                       ENOUGH ROOM FOR LAST REC        11039302
*                                       OVERHEAD FOR NEXT REC, THIS     11039402
*                                       IS STILL END OF PERIOD          11039702
         BNP   FINI                     IF NONE, END OF PERIOD  ZA02523 11040102
         A     RWRKX,DWARCTKY           IF ROOM, CONTINUE WITH  ZA02523 11040202
*                                       ORIGINAL NUMBER OF      ZA02523 11040302
*                                       UNUSED BYTES ON TRACK   ZA02523 11040402
         L     RWRKY,DWARLREC           PUT FULL SIZE OF LAST   ZA02523 11040502
*                                       REC ON TRACK IN REG     ZA02523 11040602
         SR    RWRKY,RWRKX              SUBT SIZE OF TRK LEFT   ZA02523 11040702
*                                       RESULT IS NUMBER OF DATA BYTES  11040802
*                                       THAT MUST BE WRITTEN ON NEXT    11041202
*                                       TRACK(S)                        11041302
         B     LOOP2                    AND RETURN              ZA02523 11041702
*                                                                       11042102
*                                                                       11042202
*      STORE CALCULATED VALUES FOR TRKS/PERIOD AND TRKS/EXTENT          11042302
*      IN THE DEB RELATIVE EXTENT                                       11042502
*                                                                       11042902
FINI     EQU   *                                                        11043002
         ST    RNRCD,DEBDBPP            SAVE RECORD COUNT               11043202
         ST    RNTRK,DEBDTPP            SAVE TRACK COUNT                11043402
         LA    RDEBAMX,DEBDBPEF         INCREMENT EXTENT ADDR BY SIZE   11043602
         USING DEBDBPEF,RDEBAMX         ESTABLISH DEB DAM SECTION       11043802
*                                       EXTENTS BASE REG                11044002
EACHEXT  EQU   *                                                        11044202
         SR    REVEN,REVEN              CLEAR THE EVEN REGISTER  Y02072 11044402
         SR    RNRCD,RNRCD              CLEAR OUT RECORD COUNT          11044602
         LH    RODD,DEBNMTRK            DIVIDE NUMBER OF TRACKS  Y02072 11044802
         D     REVEN,DEBDTPP            BY THE PERIOD VALUE      Y02072 11045002
         LTR   REVEN,REVEN              TEST REVEN- IF  ZERO AN  Y02072 11045202
         BZ    FINI2                    EVEN AMOUNT OF PERIODS FIT      11045402
         ST    REVEN,DWATTRKS           STORE TRACKS IN WORKAREA Y02072 11045702
         OI    DWAFLAGS,DWAPASS2        INDICATE SECOND PASS            11046502
         B     NEXTEXT                  GO FOR SECOND PASS              11047302
FINI2    EQU   *                                                        11048102
         NI    DWAFLAGS,X'FF'-DWAPASS2  TURN OFF SECOND PASS SWITCH     11048902
         SR    REVEN,REVEN              DIVIDE NUMBER OF TRACKS  Y02072 11049702
         LH    RODD,DEBNMTRK            BY THE PERIOD VALUE      Y02072 11050502
         D     REVEN,DEBDTPP            DIVIDE BY TRACKS/PERIOD  Y02072 11051302
         M     REVEN,DEBDBPP            MULTIPLY NO. PERIODS BY  Y02072 11052102
         AR    RODD,RNRCD               RECORDS/PERIOD AND ADD   Y02072 11052902
*                                       EXTRA RECORDS                   11053702
         AR    RDSSSZ,RODD              ADD EXTENT SZ TO DS SZ   Y02072 11054502
         ST    RODD,DEBDBPEF            ST RECS/EXTENT IN EXTENT Y02072 11055302
         LA    RDEBAMX,L'DEBDBPEF(RDEBAMX)  UPDATE TO NEXT EXTENT       11056102
         LA    RDEBEXT,DEBDASDL(RDEBEXT) INCR DEB ADDR BY EXTENT SIZE   11056902
         BCT   RXTNCUR,EACHEXT          LOOP FOR EACH EXTENT            11057702
         DROP  RDEBAM,RDEBEXT,RDEBAMX   DROP DEB DAM/EXT SECTION REGS   11058502
         SPACE 2                                                        11059302
****                                                                    11060102
****     STORE TOTAL BLOCKS IN THE DATA SET, INTO THE DCB               11060902
****                                                                    11061702
STDCBREL EQU   *                                                        11062502
         IC    RWRKX,DCBRELB            STORE TOTAL SIZE OF THE         11063302
         ST    RDSSSZ,DCBRELB           DATA SET IN THE DCB SAVING      11064102
         STC   RWRKX,DCBRELB            THE KEY LENGTH                  11064902
         EJECT                                                          11065702
*********************************************************************** 11066502
*  FUNCTION V:  THE FOLLOWING FUNCTION GETS BUFFERS FOR ALL RECORD    * 11067302
*  FORMATS OTHER THAN VARIABLE SPANNED IF DYNAMIC BUFFERING WAS       * 11068102
*  SPECIFIED IN THE OPTCD FIELD (=S). BUFFERS ARE OBTAINED AND        * 11068902
*  INITIALIZED IN USER KEY.                                           * 11069702
*  INPUT TO THIS FUNCTION IS AS FOLLOWS:                              * 11070502
*              REGISTER 4 = OPEN WORKAREA ADDRESS                     * 11071302
*              REGISTER 9 = DEB AVT ADDRESS                           * 11072102
*              REGISTER 10= DCB ADDRESS                               * 11072902
*              ENTRY IN DATA MANAGEMENT KEY                           * 11073702
*  OUTPUT FROM THIS FUNCTION IS AS FOLLOWS:                           * 11074502
*              SAME AS INPUT                                          * 11075302
*              BUFFER CONTROL BLOCK AND BUFFERS OBTAINED AND          * 11076102
*                   INITIALIZED                                       * 11076902
*              EXIT IS IN EITHER DATA MANAGEMENT KEY OR USER KEY,     * 11077702
*                   DEPENDING ON THE PATH TAKEN                       * 11078502
*********************************************************************** 11079302
         SPACE                                                          11080102
FUNCT5   EQU   *                        BEGINNING OF FUNCTION 5  Y02072 11080902
         TM    DCBOPTCD,DCBOPTDB        WAS DYNAMIC BUFFERING REQUESTED 11081702
         BZ    FUNCT7                   NO RESTORE REG AND RET   Y02072 11082502
         SPACE 2                                                        11083302
****                                                                    11084102
****     DETERMINE CORE REQUIRED FOR BUFFERS AND BUFFER CONTROL         11084902
****     BLOCK AND INITIALIZE BUFFERS FOR DYNAMIC BUFFERING OPTION      11085702
****                                                                    11086502
         SR    RBUFNO,RBUFNO            CLEAR NUMBER OF BUFFERS REG     11087302
         IC    RBUFNO,DCBBUFNO          CALCULATE THE NUMBER OF         11088102
         LTR   RBUFNO,RBUFNO            BUFFERS NEEDED,                 11088902
         BP    NOBUFNO                  IF THE USER OMITTED THIS        11089702
         LA    RBUFNO,BFRDFALT          PARAMETER ASSUME TWO BUFFERS.   11090502
         SPACE                                                          11091302
NOBUFNO  EQU   *                                                        11092102
         LR    RODD,RBUFNO              PUT BUF NUM IN ODD REG   Y02072 11092902
         LH    RBUFLN,DCBBUFL           LOAD SPECIFIED LENGTH           11093702
         LTR   RBUFLN,RBUFLN            TEST FOR ZERO BUFFER LENGTH     11094502
         BNZ   BUFOK                    IF NOT 0, CONTINUE       Y02072 11095302
         LA    R0,PD51                  GET INTERNAL RET CODE    Y02072 11096102
*                                       INDICATING BUFL=0 WHEN   Y02072 11096902
*                                       DYN BUFFERING SPECIFIED  Y02072 11097702
         B     ERREXIT                  GO TO PROB DETERMINATION Y02072 11098502
*                                                                       11099302
BUFOK    EQU   *                        BUFFER LENGTH SPECIFIED  Y02072 11100102
         TM    DCBBUFL+1,NOTDOUBL       AND CHECK THAT IT IS A          11100902
         BZ    OKALN                    DOUBLE WORD MULTIPLE.           11101702
         SRL   RBUFLN,3                 IF NOT                          11102502
         SLL   RBUFLN,3                 CLEAR THE 1-7 VALUE             11103302
         LA    RBUFLN,DOUBLEWD(RBUFLN)  AND ADD EIGHT.                  11104102
OKALN    MR    REVEN,RBUFLN             MULTIPLY LENGTH X NO. OF BFRS   11104902
         L     RTCB,DEBTCBAD            GET TCB ADDRESS                 11105702
         USING TCB,RTCB                 ESTABLISH TCB BASE REG          11106502
         TM    TCBFLGS6,TCBRV           TEST IF ADDRSPCE IS REAL        11107302
         BO    NOBCBSFX                 BRANCH IF SO, NO BCB SUFFIX     11108102
         SPACE 2                                                        11108902
****                                                                    11109702
****     CORE NEEDED= UNSCHEDULED LIST LENGTH + BUFFER CONTROL BLOCK    11110502
****     LENGTH + BUFFER SUFFIX OF 1 BYTE PER BUFFER + 7 FOR ROUNDING   11111302
****                                                                    11112102
         LA    RPOOLSZ,USLSZFST+BCBLNTHV+RNDFCTOR(RBUFNO,RODD)          11112902
         TM    DCBBFALN,DCBBFAF1        IF BUFFER ALIGNMENT IS FULL-WD  11113702
         BZ    ROUND1                   (NOT DOUBLE WD),                11114502
         LA    RPOOLSZ,FWDBNDRY(RPOOLSZ) THEN ADD 4 BYTES               11115302
ROUND1   SRL   RPOOLSZ,3                ROUNDED TO A MULTIPLE OF 8      11116102
         SLL   RPOOLSZ,3                RESET                           11116902
         LR    R1,RPOOLSZ               PUT LENGTH IN PARM REG   Y02072 11117702
****                                                                    11118502
****         GETMAIN ROUTINE MODESETS TO USER KEY BEFORE RETURNING      11119302
****                                                                    11120102
         BAL   RETURN,ENTUSER           GO TO GET CORE FOR BCB   Y02072 11120902
*                                       RETURN IS IN USER KEY    Y02072 11121702
         B     GOTCORE                  BRANCH AROUND NEXT INSTR Y02072 11122502
*                                                                       11123302
NOBCBSFX EQU   *                        ADDRESS SPACE IS REAL           11124102
         LA    RPOOLSZ,BCBLENTH+FOURBYTS(RODD)  ADD LENGTH OF BCB AND   11124902
*                                       BUFFERS -DBLWD BDY; THEN ADD    11125702
*                                       4 MORE IN CASE WANT FULLWD      11126502
         LR    R1,RPOOLSZ               PUT LENGTH IN PARM REG   Y02072 11127302
****                                                                    11128102
****         GETMAIN ROUTINE MODESETS TO USER KEY BEFORE RETURNING      11128902
****                                                                    11129702
         BAL   RETURN,ENTUSER           GO TO GET CORE FOR BCB   Y02072 11130502
*                                       RETURN IS IN USER KEY    Y02072 11131302
*                                                                       11132102
GOTCORE  EQU   *                        RETURN FROM GETMAIN      Y02072 11132902
         LR    RBCB,R1                  PUT GOTTEN CORE IN BASE  Y02072 11133702
         TM    TCBFLGS6,TCBRV           IS ADDRESS SPACE = REAL         11134502
         BO    SAVSIZ                   BRANCH IF YES                   11135302
         DROP  RTCB                     DROP TCB BASE REG               11136102
         SPACE 2                                                        11136902
****                                                                    11137702
****     INITIALIZE THE UNSCHEDULED LIST (ADDRESS SPACE = VIRTUAL)      11138502
****                                                                    11139302
         USING USL,RBCB                 ESTABLISH USL BASE REG          11140102
         XC    USL(USLSZFST),USL        CLEAR THE LIST                  11140902
         MVI   USLSIZE+1,USLSZFST       INITIALIZE SIZE FIELD           11141702
         OI    USLFLAGS,USLCURNT        TURN ON 'CURRENT' BIT           11142502
         LA    RWRKX,USL+USLSZFST-L'USLSLOT1  ADDRESS LAST USL SLOT     11143302
         USING USLSLOT,RWRKX            EST USL IOB ADDR SECT BASE REG  11144102
         OI    USLSLTFL,USLENDL         TURN ON END-OF-LIST INDICATOR   11144902
         DROP  RWRKX                    DROP USL IOB ADDR SECT BASE REG 11145702
*                                                                       11146502
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 11147302
*                                                                       11148102
         ST    RBCB,DCBDYNB             STORE POINTER TO USL            11148902
         OI    DXATEXC1,FCAOUSL         SET AUDIT TRAIL BIT      Y02072 11149702
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11150502
*                                       INDICATING USL GOTTEN    Y02072 11151302
*                                                                       11152102
         MODESET  KEYADDR=DXUKEY,WORKREG=14 CHANGE TO USER KEY   Y02072 11153002
*                                                                       11153902
         SPACE 2                                                        11154802
****                                                                    11155702
****     INITIALIZE BUFFER CONTROL BLOCK (ADDRESS SPACE = VIRTUAL)      11156602
****                                                                    11157502
         LA    RBCB,USLSZFST(RBCB)      POINT TO BUFFER CONTROL BLOCK   11158402
         DROP  RBCB                     DROP USL BASE REG               11159302
         USING BCBDEFV,RBCB             EST BFR CONTROL BLK BASE REG    11160202
         ST    RPOOLSZ,BCBTBRS1         TOTAL SIZE GETMAIN AREA         11161102
         ST    RBUFLN,BCBBUFL           LENGTH OF EACH BUFFER           11162002
         SPACE 2                                                        11162902
****                                                                    11163802
****     CALCULATE ADDR OF 1ST BUFFER                                   11164702
****                                                                    11165602
         LA    RWRKY,BCBSUFFX(RBUFNO)   ADDR END OF BUFFER SUFFIX       11166502
         SR    RWRKX,RWRKX              CLEAR REGISTER                  11167402
         TM    DCBBFALN,DCBBFAF1        IF FULL WORD ALIGNMENT FOR      11168302
         BZ    ROUND2                   BUFFERS, ADD 4 BEFORE ROUND     11169202
         LA    RWRKX,FWDBNDRY           SET UP FOR FW ALIGNMENT         11170102
ROUND2   LA    RWRKY,RNDFCTOR(RWRKX,RWRKY)  BUMP ADDRESS TO NEXT        11171002
         SRL   RWRKY,3                  DOUBLE WORD BOUNDARY            11171902
         SLL   RWRKY,3                  RESET                           11172802
         SR    RWRKY,RWRKX              IF FULL WORD ALIGNMENT,         11173702
*                                       SUBTRACT 4.                     11174602
         ST    RWRKY,BCBBUF1            ADDRESS OF FIRST BUFFER         11175502
         SPACE 2                                                        11176402
****                                                                    11177302
****     INITIALIZE AVAILABLE BUFFER CHAIN.                             11178202
****                                                                    11179102
         MVI   BCBBFAVL,BFRNUM1         SET FIRST AVAILABLE BFR = NO. 1 11180002
         LA    RPOOLSZ,1(RBUFNO)        NO. OF BUFFERS+1=COMPARAND(R13) 11180902
         LA    RBUFNO,BFRNUM1           SET INCR OF 1- BXLE LOOP CONTRL 11181802
         LA    RWRKX,BFRNUM2            INITIALIZE NEXT BFR IN CHAIN TO 11182702
*                                       BFR NUMBER 2                    11183602
STORENXT STC   RWRKX,BCBTBRS1+2(RWRKX)  CHAIN TO NEXT AVAILABLE BFR     11184502
         BXLE  RWRKX,RBUFNO,STORENXT    LOOP ONCE FOR EACH BUFFER       11185402
         LA    RBUFNO,BCBTBRS1+1(RWRKX) POINT TO LAST BFR IN CHAIN      11186302
         MVI   0(RBUFNO),0              IND NO MORE BUFFERS IN CHAIN    11187202
*                                                                       11188102
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 11189002
*                                                                       11189902
         STCM  RBCB,ADDR,DCBBUFCA       STORE PTR TO BCB                11190802
         OI    DXATEXC1,FCAOBUF         SET AUDIT TRAIL BIT      Y02072 11191202
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11191602
*                                       INDICATING BCB GOTTEN    Y02072 11191802
         B     FUNCT7                   GO RESTORE REGS AND RET  Y02072 11192402
         DROP  RBCB                     DROP BFR CONTROL BLK BASE REG   11192602
         SPACE 2                                                        11193502
****                                                                    11194402
****     DIVIDE AREA INTO A BUFFER CONTROL BLOCK (BCB) AND THE          11195302
****     SPECIFIED NO. OF BUFFERS. LINK ALL TO NEXT AVAILABLE FIELD     11196202
****     IN THE BUFFER CONTROL BLOCK. (ADDRESS SPACE = REAL)            11197102
****     ENTRY INTO THIS ROUTINE IS IN USER KEY.                        11198002
****                                                                    11198902
SAVSIZ   EQU   *                                                        11199802
*                                                                       11200702
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 11201602
*                                                                       11202502
         USING BCBDEFR,RBCB             EST BFR CONTROL BLK BASE REG    11203402
         IC    RWRKX,DCBBUFNO           STORE THE RETURNED CORE  Y02072 11204302
         ST    RBCB,DCBBUFCB            ADDR AS BCB ADDR                11205202
         STC   RWRKX,DCBBUFNO           REPLACE TOP BYTE         Y02072 11206102
         OI    DXATEXC1,FCAOBUF         SET AUDIT TRAIL BIT      Y02072 11206502
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11206902
*                                       INDICATING BCB GOTTEN    Y02072 11207002
*                                                                       11207402
         MODESET  KEYADDR=DXUKEY,WORKREG=14 CHANGE TO USER KEY   Y02072 11207902
*                                                                       11208802
         LR    RWRKX,RPOOLSZ            SAVE SIZE OF AREA               11209702
         ST    RPOOLSZ,BCBTBRS          STORE SIZE IN THE BCB           11210602
         XC    BCBIOBS,BCBIOBS          CLEAR IOB POINTERS              11211502
         LA    RWRKY,BCBLENTH(RBCB)     DEVELOP THE ADDRESS OF BUFFER   11212402
         TM    DCBBFALN,DCBBFAF1        (ALIGN TO A WORD BOUNDARY THATS 11213302
         BZ    NOTFULWD                 NOT A DOUBLE WORD BOUNDARY IF   11214202
         LA    RWRKY,FWDBNDRY(,RWRKY)   SO SPECIFIED)                   11215102
         SPACE                                                          11216002
NOTFULWD EQU   *                                                        11216902
         ST    RWRKY,BCBNABFR           AND STORE AS NEXT AVAILABLE BFR 11217802
         DROP  RBCB                     DROP BCB BASE REG               11218702
         SH    RWRKX,CONH20             SUBTRACT FROM SIZE- BCB, SM4366 11219602
         SR    RWRKX,RBUFLN             FIRST BUFFER,ALIGNMENT FACTOR   11220502
         LR    RBCB,RWRKY               POINT OT NEXT BUFFER LOCATION   11221402
BFRLOOP  AR    RBCB,RBUFLN              (BUFFER 1 + BUFFER LENGTH)      11222302
         SR    RWRKX,RBUFLN             REDUCE TOTAL SIZE BY BUFL       11223202
         BM    FNDLAST                  IF MINUS ALL BUFFERS ARE LINKED 11224102
         ST    RBCB,0(,RWRKY)           LINK BFR. 2 TO BFR. 1 ETC.      11225002
         LR    RWRKY,RBCB               INCREMENT THE TWO BFR. POINTERS 11225902
         B     BFRLOOP                  AND LOOP                        11226802
FNDLAST  SR    RBCB,RBCB                ZERO THE                        11227702
         ST    RBCB,0(,RWRKY)           END BUFFER LINK ADDRESS         11228602
         B     FUNCT7                   RETURN TO COMMON OPEN    Y02072 11229502
         EJECT                                                          11230402
*********************************************************************** 11231302
*  FUNCTION VI:  THE FOLLOWING FUNCTION PROCESSES VARIABLE SPANNED    * 11232202
*  RECORDS ONLY. IT OBTAINS AND INITIALIZES THE SEGMENT WORKAREAS AND * 11233102
*  GETS A BUFFER AREA IF DYNAMIC BUFFERING IS SPECIFIED. BUFFERS      * 11234002
*  ARE OBTAINED AND INITIALIZED IN USER KEY.                          * 11234902
*  INPUT TO THIS FUNCTION IS AS FOLLOWS:                              * 11235802
*              REGISTER 4 = OPEN WORKAREA ADDRESS                     * 11236702
*              REGISTER 9 = DEB AVT ADDRESS                           * 11237602
*              REGISTER 10= DCB ADDRESS                               * 11238502
*              ENTRY IN DATA MANAGEMENT KEY                           * 11239402
*  OUTPUT FROM THIS FUNCTION IS AS FOLLOWS:                           * 11240302
*              SAME AS INPUT                                          * 11241202
*              BUFFER CONTROL BLOCK OR SWA CONTROL BLOCK, BUFFERS     * 11242102
*                       AND SEGMENT WORKAREAS ARE OBTAINED AND        * 11243002
*                       INITIALIZED.                                  * 11243902
*********************************************************************** 11244802
         SPACE                                                          11245702
FUNCT6   EQU   *                        BEGINNING OF FUNCTION 6         11246602
         LR    RDEBEXT,RDEBA            GET DEB ADDR FOR DASD SECTION   11247502
         USING DEBDASD-(DEBBASND-DEBAVT),RDEBEXT  ESTABLISH DEB DASD    11248402
*                                       SECTION BASE REG                11249302
         SPACE 2                                                        11250202
****                                                                    11251102
****     CONSTRUCT BUFFERS FOR VRE OPTION                               11252002
****                                                                    11252902
         SR    RBUFNO,RBUFNO            DEVELOP IN REGISTER RBUFNO      11253802
         IC    RBUFNO,DCBBUFNO          THE NUMBER OF BUFFERS           11254702
         LTR   RBUFNO,RBUFNO            NEEDED, IF USER OMITTED         11255602
         BP    FINDLNTH                 THIS PARAMETER ASSUME 2         11256502
         LA    RBUFNO,BFRDFALT          BUFFERS                         11257402
FINDLNTH L     RWRKX,DEBUCBAD           LOAD UCB ADDRESS                11258302
         DROP  RDEBEXT                                           Y02072 11259202
         USING UCB,RWRKX                ESTABLISH UCB BASE REG          11260102
         L     RDVCT,CVTPTR             LOAD CVT ADDRESS                11261002
         USING CVT,RDVCT                ESTABLISH CVT BASE REG   A44855 11261902
         L     RDVCT,CVTZDTAB           LOAD DEVICE TABLE ADDR   A44855 11262802
         DROP  RDVCT                    DROP CVT BASE REG        A44855 11263702
         USING DVCTI,RDVCT              ESTABLISH DEVICE CHAR TABLE     11264602
*                                       INDEX BASE REG                  11265502
         LA    RWRKY,DVCTYPMK           MASK FOR UNIT TYPE NUMBER       11266402
         N     RWRKY,UCBTYP             PICK UP UNIT TYPE NUMBER        11267302
         IC    RWRKY,DVCTIOFF(RWRKY)    FIND ENTRY OFFSET               11268202
         LA    RDVCT,0(RWRKY,RDVCT)     POINT TO ENTRY TRACK LNGTH      11269102
         DROP  RWRKX,RDVCT              DROP UCB AND DEV CHAR TABLE     11270002
*                                       INDEX BASE REGISTERS            11270902
         USING DVCT,RDVCT               EST DEVICE CHAR TABLE BASE REG  11271802
         TM    DCBOPTCD,DCBOPTDB        DYNAMIC BUFFERING REQUIRED      11272702
         BZ    GETSWA                   NO, BRANCH                      11273602
         SPACE 2                                                        11274502
****                                                                    11275402
****     CONSTRUCT BUFFERS FOR DYNAMIC BUFFERING OPTION WITH VRE        11276302
****                                                                    11277202
****           FIRST DETERMINE SIZE OF SEGMENT WORK AREA                11278102
****                                                                    11278202
         SR    RAOFFS,RAOFFS            CLEAR WORK REGISTER             11278402
         IC    RAOFFS,DCBKEYLE          LOAD KEY LENGTH                 11278502
         AH    RAOFFS,DCBBLKSI          ADD BLKSIZE                     11278902
         CH    RAOFFS,DVCTRKLN          COMPARE MAXIMUM LOGICAL RECORD  11279302
*                                       LENGTH + KEY LENGTH AND TRACK   11279702
*                                       SIZE                            11280102
         BNH   ADD                      RECORD LENGTH IS LOW            11280502
         LH    RAOFFS,DVCTRKLN          USE TRACK LENGTH                11280902
         DROP  RDVCT                    DROP DEVICE CHAR TABLE BASE REG 11281002
****                                                                    11281302
****           ADD IN LENGTHS OF SWA HEADER AND RECORD AREA PREFIX,     11281502
****           THEN PAD TO WORD BOUNDARY                                11281602
****                                                                    11281702
ADD      LA    RAOFFS,SWACSLNG+L'BUFBFPTR+MULTOF4(RAOFFS)        Y02072 11282002
         N     RAOFFS,RNDFULL           ROUND TO WORD BOUNDARY   Y02072 11282402
****                                                                    11283702
****           RAOFFS NOW CONTAINS RECORD AREA OFFSET FROM SWA HEADER.  11283902
****           FULLWORD OR DOUBLE WORD ALIGNMENT FOR RECORD AREA WILL   11284102
****           BE CONTROLLED BY PADDING THE BCB IF NECESSARY.           11284502
****                                                                    11284902
****           CALCULATE THE LENGTH OF THE RECORD AREA, THEN OF THE     11285402
****           ENTIRE BUFFER, PADDING TO A DOUBLE WORD BOUNDARY         11285502
****                                                                    11286002
         SR    RBUFLN,RBUFLN            CLEAR BUFFER LENGTH REG         11286102
         IC    RBUFLN,DCBKEYLE          RECORD AREA=KEY LENGTH   A44855 11286202
         AH    RBUFLN,DCBBLKSI          PLUS BLOCKSIZE           A44855 11286302
         LA    RBUFLN,RNDFCTOR(RAOFFS,RBUFLN)  ROUND ENTIRE BUFFER      11286402
         N     RBUFLN,RNDDBL            LENGTH TO A MULTIPLE OF 8       11286502
****                                                                    11286602
****           CALCULATE LENGTH OF BUFFER CONTROL BLOCK                 11286702
****                                                                    11286802
         LA    RLEN,BCBLENTH            ASSUME NO BUFFER SUFFIX  Y02072 11287002
         L     RWRKY,DEBTCBAD           GET TCB ADDRESS          YM1421 11287302
         USING TCB,RWRKY                ESTABLISH TCB BASE REG   YM1421 11287402
         TM    TCBFLGS6,TCBRV           IS ADDRESS SPACE REAL           11287702
         BO    BCBPAD                   BRANCH IF YES                   11288102
         AR    RLEN,RBUFNO              ADD ONE BYTE PER BUFFER  Y02072 11288502
****                                                                    11289402
****           PAD BCB AS NECESSARY FOR PROPER RECORD AREA ALIGNMENT    11289502
****                                                                    11289602
BCBPAD   EQU   *                        PAD BCB FOR ALIGNMENT           11290302
         AR    RLEN,RAOFFS              ADD OFFSET TO RECORD AREA       11315402
         SR    RWRKX,RWRKX              ASSUME FULLWORD,NOT      A44855 11316102
*                                       DOUBLEWORD ALIGNMENT OF RECORD  11316802
         TM    DCBBFALN,DCBBFAF1        TEST SPECIFIED ALIGNMENT A44855 11317502
         BZ    DOUBWORD                 BRANCH IF DOUBLEWORD     A44855 11318202
         LA    RWRKX,FWDBNDRY           SET INCR TO A FULLWORK BOUNDARY 11318902
DOUBWORD LA    RLEN,RNDFCTOR(RWRKX,RLEN)  ADD FOR BUF ALIGNMENT  Y02072 11319602
         N     RLEN,RNDDBL              ROUND TO DOUBLE WORD     Y02072 11321002
*                                       BOUNDARY                 Y02072 11321702
         SR    RLEN,RWRKX               THEN TO A FULLWORD IF    Y02072 11322402
*                                       SPECIFIED                Y02072 11323102
         SR    RLEN,RAOFFS              TAKE OFF OFFSET TO REC   Y02072 11323802
****                                                                    11324502
****           CALCULATE BUFFER POOL SIZE AS RBUFNO * RBUFLN + BCBSIZE. 11325202
****           PAD TO DOUBLE WORD BOUNDARY FOR GETMAIN.                 11325902
****                                                                    11326602
         SR    REVEN,REVEN              CLEAR REGISTER                  11327302
         LR    RODD,RBUFLN              GET BUFFER SIZE                 11328002
         MR    REVEN,RBUFNO             CALCULATE BUFFER POOL SIZE      11328702
         LA    RPOOLSZ,RNDFCTOR(RLEN,RODD) ADD BCB LENGTH        Y02072 11329402
         N     RPOOLSZ,RNDDBL           ROUND TO MULTIPLE OF 8          11330102
         TM    TCBFLGS6,TCBRV           TEST FOR REAL ADDRESS SPACE     11330802
         BO    GETREAL                  BRANCH IF SO                    11331502
         LA    RPOOLSZ,USLSZFST(RPOOLSZ)  ADD SIZE OF FIRST USL  Y02072 11332202
         DROP  RWRKY                                             YM1421 11333602
****                                                                    11334302
****         GETMAIN ROUTINE MODESETS TO USER KEY BEFORE RETURNING      11335002
****                                                                    11335702
         LR    R1,RPOOLSZ               PUT LENGTH IN PARM REG   Y02072 11337102
         BAL   RETURN,ENTUSER           GET MAIN STORAGE         Y02072 11337802
*                                       RETURN IS IN USER KEY    Y02072 11338502
         LR    RWRKX,R1                 GET ADDR TO GOTTEN CORE  Y02072 11338902
         SPACE 2                                                        11339902
****                                                                    11340602
****     INITIALIZE THE UNSCHEDULED LIST.                               11341302
****                                                                    11342002
         USING USL,RWRKX                ESTABLISH UNSCHED LIST BASE REG 11342702
         XC    USL(USLSZFST),USL        CLEAR THE LIST                  11343402
         MVI   USLSIZE+1,USLSZFST       INITIALIZE SIZE FIELD           11344102
         OI    USLFLAGS,USLCURNT        TURN ON 'CURRENT' BIT           11344802
         LA    RWRKY,USL+USLSZFST-L'USLSLOT1 ADDR LAST USL SLOT  Y02072 11345502
         USING USLSLOT,RWRKY            EST USL IOB ADDR BASE    Y02072 11346202
         OI    USLSLTFL,USLENDL         TURN ON END-OF-LIST INDICATOR   11346902
         DROP  RWRKY                    DROP USL IOB ADDR BASE   Y02072 11347602
*                                                                       11348302
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 11349002
*                                                                       11349702
         ST    RWRKX,DCBDYNB            STORE POINTER TO USL            11350402
         OI    DXATEXC1,FCAOUSL         SET AUDIT TRAIL BIT      Y02072 11350802
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11350902
*                                       INDICATING USL GOTTEN    Y02072 11351002
*                                                                       11351102
         MODESET  KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY  Y02072 11351802
*                                                                       11352502
         SPACE 2                                                        11353202
****                                                                    11353902
****     INITIALIZE BUFFER CONTROL BLOCK (ADDRESS SPACE = VIRTUAL)      11354602
****                                                                    11355302
         LA    RWRKX,USLSZFST(RWRKX)    POINT TO BUFFER CONTROL BLOCK   11356002
         DROP  RWRKX                    DROP UNSCHED LIST BASE REG      11356702
         USING BCBDEFV,RWRKX            EST VIRTUAL BCB BASE REG        11357402
         ST    RPOOLSZ,BCBTBRS1         TOTAL SIZE OF GETMAIN AREA      11358102
         ST    RBUFLN,BCBBUFL           LENGTH OF EACH BUFFER           11358802
         STCM  RAOFFS,ADDR,BCBRAOFS     RECORD AREA OFFSET IN BUFFER    11359502
         LA    RBUFR,BCBDEFV(RLEN)      GET ADDRESS OF FIRST BUFFER     11360202
         ST    RBUFR,BCBBUF1            STORE IT IN BCB                 11360902
*                                                                       11361602
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 11362302
*                                                                       11363002
         STCM  RWRKX,ADDR,DCBBUFCB+1    STORE ADDRESS OF BCB            11363702
         OI    DXATEXC1,FCAOBUF         SET AUDIT TRAIL BIT      Y02072 11364102
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11364202
*                                       INDICATING BCB GOTTEN    Y02072 11364302
         SPACE 2                                                        11364402
****                                                                    11365102
****     INITIALIZE AVAILABLE BUFFER CHAIN                              11365802
****                                                                    11366502
*                                                                       11367202
         MODESET  KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY  Y02072 11367902
*                                                                       11368602
         MVI   BCBBFAVL,BFRNUM1         SET FIRST AVAILABLE BFR = NO. 1 11369302
         LA    RODD,1(,RBUFNO)          NO. OF BUFFERS + 1 = COMPARAND  11370002
         LA    REVEN,BFRNUM1            SET INCR OF 1-BXLE LOOP CONTROL 11370702
         LA    RWRKY,BFRNUM2            INITIALIZE NEXT BFR TO   Y02072 11371402
*                                       BFR NUMBER 2                    11372102
STORNEXT STC   RWRKY,BCBTBRS1+2(RWRKY)  CHAIN TO NEXT AVAIL BFR  Y02072 11372802
         BXLE  RWRKY,REVEN,STORNEXT     LOOP ONCE FOR EACH BUFFR Y02072 11373502
         LA    RWRKY,BCBTBRS1+1(RWRKY)  POINT TO LAST CHAIN      Y02072 11374202
*                                       ELEMENT INITIALIZED.            11374902
         MVI   0(RWRKY),0               NO MORE BUFFERS IN CHAIN Y02072 11375602
         B     INITBUFS                 GO TO INITIALIZE BUFFERS        11376302
         DROP  RWRKX                    DROP BFR CONTROL BLK BASE REG   11377002
         SPACE 3                                                        11377702
GETREAL  EQU   *                        ENTERED IN KEY 5                11378402
****                                                                    11379102
****         GETMAIN ROUTINE MODESETS TO USER KEY BEFORE RETURNING      11379802
****                                                                    11380502
         LR    R1,RPOOLSZ               LOAD LG IN PARM REG      Y02072 11381202
         BAL   RETURN,ENTUSER           GET MAIN STORAGE         Y02072 11382602
*                                       RETURN IS IN USER KEY    Y02072 11383302
         LR    RWRKX,R1                 GET ADDR OF GOTTEN CORE  Y02072 11383702
         SPACE 2                                                        11384702
****                                                                    11385402
****     INITIALIZE THE BUFFER CONTROL BLOCK (ADDRESS SPACE = REAL)     11386102
****                                                                    11386802
*                                                                       11387502
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 11388202
*                                                                       11388902
         USING BCBDEFR,RWRKX            EST BUFFER CONTROL BLK BASE REG 11389602
         IC    RWRKY,DCBBUFNO           SAVE BUFFER NUMBER              11390302
         ST    RWRKX,DCBBUFCB           STORE POINTER TO BUFCB          11391002
         STC   RWRKY,DCBBUFNO           RESTORE BUFNO IN DCB            11391702
         OI    DXATEXC1,FCAOBUF         SET AUDIT TRAIL BIT      Y02072 11392102
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11392202
*                                       INDICATING BCB GOTTEN    Y02072 11392302
*                                                                       11392402
         MODESET  KEYADDR=DXUKEY,WORKREG=15 CHANGE TO USER KEY   Y02072 11393102
*                                                                       11393802
         XC    BCBIOBS,BCBIOBS          CLEAR FIRST 2 WORDS OF BUFFER   11394502
*                                       CONTROL BLOCK                   11395202
         ST    RPOOLSZ,BCBTBRS          INITIALIZE BUFFR POOL SZ Y02072 11395902
         LA    RBUFR,BCBLENTH(RWRKX)    POINT TO FIRST BUFFER           11396602
         ST    RBUFR,BCBNABFR           INITIALIZE POINTER TO BUFS      11397302
         DROP  RWRKX                    DROP BFR CONTROL BLK BASE REG   11398002
INITBUFS EQU   *                                                 A44855 11398702
         S     RAOFFS,FOUR              OFFSET TO SWA POINTER    A44855 11399402
         LR    RSWA,RBUFR               INCREMENT BUFFER POINTER        11400102
         AR    RBUFR,RBUFLN             POINT TO NEXT BUFFER            11400802
         LA    RWRKY,1                  SET BUFFER COUNT TO 1           11401502
         SPACE 2                                                        11402202
****                                                                    11402902
****     INITIALIZE BUFFER CHAIN AND RECORD AREA POINTER IN BUFFERS     11403602
****                                                                    11404302
         USING SWA,RSWA                 EST SEG WORK AREA BASE   A44855 11405002
CHAINIT  CR    RWRKY,RBUFNO             ARE ALL BUFFERS CHAINED         11405702
         BE    LASTBUF                  YES, BRANCH                     11406402
         LA    RWRKY,1(,RWRKY)          INCREMENT BUFFER COUNT          11407102
         ST    RBUFR,SWANXTPT           SET POINTER TO NEXT BUFFER      11407802
         LA    RWRKX,SWA+L'BUFBFPTR(RAOFFS)  CALCULATE REC AREA PTR     11408502
         ST    RWRKX,SWARAPT            SET POINTER TO REC AREA         11409202
         LA    RWRKX,SWA(RAOFFS)        GET ADDR OF SWA ADDR FIELD      11409902
         USING BUFFERB,RWRKX            EST BUFFER PREFIX BASE REG      11410602
         ST    RSWA,BUFBFPTR            STORE ADDR OF SWA               11411302
         XC    SWABFINC,SWABFINC        CLEAR WORKING OFFSET     A44855 11412002
*                                       FIELD                    A44855 11412702
         LR    RSWA,RBUFR               UPDATE BUFFER POINTER    Y02072 11413402
         AR    RBUFR,RBUFLN             UPDATE NEXT BUFFER POINTER      11414102
         B     CHAINIT                  CONTINUE CHAINING BUFFERS       11414802
LASTBUF  XC    SWANXTPT,SWANXTPT        CLEAR LAST BUFFER POINTER       11415502
         XC    SWABFINC,SWABFINC        CLEAR OFFSET IN REC FLD  YM3693 11415902
         LA    RWRKX,SWA+L'BUFBFPTR(RAOFFS)  CALCULATE REC AREA PTR     11416202
         ST    RWRKX,SWARAPT            SET POINTER TO REC AREA         11416902
         LA    RWRKX,SWA(RAOFFS)        GET ADDR OF SWA ADDR FIELD      11417602
         ST    RSWA,BUFBFPTR            STORE ADDR OF SWA               11418302
         B     FUNCT7                   CONTINUE PROCESSING      Y02072 11419002
         DROP  RWRKX,RSWA               DROP BUFFER PREFIX AND SEGMENT  11419702
*                                       WORK AREA BASE REGISTERS        11420402
         SPACE 2                                                        11421102
****                                                                    11421802
****     CONSTRUCT THE BUFFER CONTROL BLOCK AND SEGMENT WORK AREAS FOR  11422502
****     VRE OPTION WITHOUT DYNAMIC BUFFERING.                          11423202
****                                                                    11423902
GETSWA   EQU   *                                                        11424602
         USING DVCT,RDVCT               EST DEVICE CHAR TABLE BASE REG  11425302
         CLC   DCBBLKSI,DVCTRKLN        COMPARE MAXIMUM LOGICAL         11426002
*                                       RECORD LENGTH + TRACK SIZE      11426702
         BNH   LOWBLKSI                 BRANCH IF MAXIMUM LOGICAL       11427402
*                                       RECORD LENGTH IS LOW            11428102
         LH    RLEN,DVCTRKLN            USE TRACK LENGTH                11428802
         B     ADDCNTL                  BRANCH TO ADD CONTROL BYTE      11429502
         DROP  RDVCT                    DROP DEVICE CHAR TABLE BASE REG 11430202
LOWBLKSI LH    RLEN,DCBBLKSI            USE MAX LOGICAL REC LENGTH      11430902
ADDCNTL  LA    RLEN,SWACSLNG(RLEN)      ADD CONTROL BYTES               11431602
         SPACE 2                                                        11432302
****                                                                    11433002
****     ROUND TO FULLWORD ALIGNMENT FOR THE BUFFER CONTROL BLOCK AND   11433702
****     SEGMENT WORK AREAS.                                            11434402
****                                                                    11435102
         LA    RLEN,FWRNDFTR(RLEN)      ADD FULLWORK ROUNDING FACTOR    11435802
         N     RLEN,RNDFULL             ROUND TO A FULLWORD             11436502
         SPACE 2                                                        11437202
****                                                                    11437902
****     CALCULATE TOTAL BUFFER CONTROL BLOCK AND SEGMENT WORK AREA     11438602
****     LENGTH AND GET MAIN STORAGE.                                   11439302
****                                                                    11440002
         SR    REVEN,REVEN              CLEAR EVEN REGISTER             11440702
         LR    RODD,RLEN                PUT BUFFER LENGTH IN ODD REG    11441402
         MR    REVEN,RBUFNO             CALCULATE TOTAL SWA SIZE        11442102
         LA    RPOOLSZ,BCBLNTHS(RODD)   ADD BUFCB SIZE                  11442802
****                                                                    11443502
****         GETMAIN ROUTINE MODESETS TO USER KEY BEFORE RETURNING      11444202
****                                                                    11444902
         LR    R1,RPOOLSZ               GET LG IN PARM REG       Y02072 11445602
         BAL   RETURN,ENTUSER           GET MAIN STORAGE         Y02072 11447002
*                                       RETURN IS IN USER KEY    Y02072 11447702
*                                                                       11449102
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 11449802
*                                                                       11450502
         LR    RWRKX,R1                 GET ADDR OF GOTTEN CORE  Y02072 11450902
         ST    RWRKX,DCBDYNB            PUT BUFCB POINTER IN DCB        11451202
         OI    DXATEXC1,FCAOSWA         SET AUDIT TRAIL BIT      Y02072 11451602
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11451702
*                                       INDICATING SWA GOTTEN    Y02072 11451802
         SPACE 2                                                        11456102
****                                                                    11457002
****     INITIALIZE THE BUFFER CONTROL BLOCK                            11457902
****                                                                    11458802
*                                                                       11459702
         MODESET  KEYADDR=DXUKEY,WORKREG=15 CHANGE TO USER KEY   Y02072 11460602
*                                                                       11461502
         USING BCBDEFS,RWRKX            EST BUFFER CONTROL BLK BASE REG 11462402
         LA    RSWA,BCBLNTHS(RWRKX)     POINT TO FIRST BUFFER    YM1300 11463302
         ST    RSWA,BCBNXBUF            PUT POINTER TO BUFR 1 IN BCB    11464202
         STH   RBUFNO,BCBBFNUM          PUT SWA BUFNO IN BCB            11465102
         STH   RLEN,BCBBFLG             PUT SWA BUF LNGTH IN BCB        11466002
         DROP  RWRKX                    DROP BFR CONTROL BLK BASE REG   11466902
         SPACE 2                                                        11467802
****                                                                    11468702
****     INITIALIZE SEGMENT WORK AREA POOL CHAIN                        11469602
****                                                                    11470502
         USING SWA,RSWA                 EST SEGMENT WORK AREA BASE REG  11471402
         LA    RWRKY,1                  INITIALIZE COUNT REGISTER       11472302
         LR    RBUFR,RLEN               INITIALIZE TO LENGTH OF SWA     11473202
         AR    RBUFR,RSWA               INITIALIZE NEXT BUF PTR         11474102
CHAINSWA CR    RWRKY,RBUFNO             ARE ALL BUFFERS CHAINED         11475002
         BE    LASTSWA                  BRANCH IF YES                   11475902
         ST    RBUFR,SWANXTPT           CHAIN BUFFER POINTER            11476802
         XC    SWARCDPT,SWARCDPT        CLEAR BUFFER CONTROL FIELD      11477702
         LA    RWRKY,1(,RWRKY)          INCREMENT COUNT REGISTER        11478602
         LR    RSWA,RBUFR               UPDATE BUFFER POINTER           11479502
         AR    RBUFR,RLEN               POINT TO NEXT BUFFER            11480402
         B     CHAINSWA                 BRANCH                          11481302
LASTSWA  XC    SWA(SWACSLNG),SWA        ZERO LAST BUFFER POINTER AREA   11482202
         DROP  RSWA                     DROP SEGMENT WORK AREA BASE REG 11483102
         EJECT                                                          11484002
*********************************************************************** 11484902
*  FUNCTION VII:  THE FOLLOWING FUNCTION PREPARES FOR EXIT FROM THIS  * 11485802
*  MODULE.  THIS REQUIRES THAT THE DCB COPY BE MOVED INTO THE USER    * 11486702
*  DCB AND THAT THE WTG TAB BE CHECKED TO DETERMINE THE NEXT MODULE   * 11487602
*  TO RECEIVE CONTROL.                                                * 11488502
*  INPUT TO THIS FUNCTION IS AS FOLLOWS:                              * 11489402
*              REGISTER 4 = OPEN WORKAREA ADDRESS                     * 11490302
*              REGISTER 10= DCB ADDRESS                               * 11491202
*              OPEN REGISTERS 0-9 STORED AT DWASAVE                   * 11492102
*              OPEN WORKAREA CONTAINING PARM LIST AND WTG TABLE       * 11493002
*              EITHER DATA MANAGEMENT KEY OR USER KEY                 * 11493902
*  OUTPUT FROM THIS FUNCTION AND MODULE IS AS FOLLOWS:                * 11494802
*              SEE 'OUTPUT' IN THE PROLOGUE                           * 11495702
*              DATA MANAGEMENT KEY                                    * 11496602
*********************************************************************** 11497502
         SPACE                                                          11498402
FUNCT7   EQU   *                        BEGINNING OF FUNCTION 7         11499302
*                                                                       11500202
         MODESET  EXTKEY=DATAMGT        RETURN TO DATAMGT KEY    Y02072 11500902
*                                                                       11501602
         MVC   DEBDCBB,DXUDCBAD+1       MV USER DCB ADDR TO DEB  Y02072 11502002
         LM    R0,R9,DWASAVE            RESTORE OPEN'S REGISTERS        11502102
         USING PARML,RPARC              EST OPEN PARM LIST BASE REG     11502202
         USING WTGENTRY,RWTGC           ESTABLISH WTG ENTRY BASE REG    11502302
         MVI   WTGENTRY,0               INDICATE THIS DCB FINISHED      11502402
****                                                                    11503002
****  THE FOLLOWING MACRO CALLS A ROUTINE TO COPY THE DCB IN THE        11503102
****  OPEN WORKAREA INTO THE USER'S DCB.  THE COPY HAS BEEN UPDATED     11503202
****  BY THE OPEN EXECUTOR.  THIS WILL BE THE FIRST REFERENCE IN THIS   11503302
****  EXECUTOR TO THE USER'S DCB.                                       11503402
****                                                                    11503502
         USING WTG,RWTG                                                 11505102
*                                                                       11505502
         IECRES  INIT,DCBCOPY=FRWKAR,STM=(R0,R14,WTGPREFX)       Y02072 11505602
*                                                                       11505702
         OI    DXATEXC1,FCAOCOPY        SET AUDIT TRAIL BIT      Y02072 11506802
*                                       FOR FORCE CLOSE CLEANUP  Y02072 11508802
*                                       INDICATING DCB COPY DONE Y02072 11510802
         SPACE 2                                                        11511802
****                                                                    11512902
**** ROUTINE TO SCAN DCB LIST FOR OTHER DCBS REQUIRING THIS EXECUTOR.   11514002
**** IF NONE ARE FOUND, CONTROL IS TRANSFERRED TO THE NEXT EXECUTOR OF  11515102
**** THE FIRST DCB WHICH IS NOT COMPLETED.                              11516202
****                                                                    11517302
SCAN4EQ  EQU   *                                                        11518402
         LA    RWTGC,L'WTGENTRY(,RWTGC) INCREMENT WHERE TO GO INDEX     11519502
         LA    RPARC,L'PARDCBAD(,RPARC) AND DCB PARAMETER LIST INDEX    11520602
         CLC   WTGIDNX,AMIDCNST         DOES TABLE NAME THE EXEC Y02072 11521702
         BER   RBASE                    YES,BRANCH TO ENTRY POINT       11522802
         CLC   WTGIDNX,OPIDCNST         NO, IS THIS END OF TABLE Y02072 11523902
         BNE   SCAN4EQ                  NO, LOOP TO INCREMENT STEPS     11525002
*                                                                       11526102
         LR    RPARC,RPAR               RESTORE BOTH INDEX REGISTERS TO 11527202
         DROP  RWTGC                                             Y02072 11528302
         LA    RWTGC,WTGENTRY           THEIR INITIAL VALUES     Y02072 11529402
         USING WTGENTRY,RWTGC           SET UP BASE FOR WTG      Y02072 11530502
SCAN4ANY CLI   WTGIDTTR,0               IS THIS DCB COMPLETED    Y02072 11531602
         BNE   XCTLRTN                  IF NOT, GO TO NAMED EXECUTOR    11532702
         LA    RWTGC,L'WTGENTRY(,RWTGC) INCREMENT BOTH INDEX REGISTERS  11533802
         LA    RPARC,L'PARDCBAD(,RPARC) TO THE NEXT ENTRIES             11534902
         B     SCAN4ANY                 LOOP TO CHECK COMPLETION        11536002
*                                                                       11537102
XCTLRTN  EQU   *                                                        11538202
         MVC   WTGMODID,WTGENTRY        MV EXEC ID TO PARAM LIST Y02072 11539302
         XC    DXXCTL,DXXCTL            CLEAR PARM LIST FIELD    YM2886 11539702
         LA    R15,DXXCTL               PASS PARM LIST IN R15    YM2886 11540402
         XCTL  EPLOC=(RWTG),SF=(E,(15))                          Y02072 11541502
         DROP  RWTG,RPARC,RWTGC                                         11542602
         EJECT                                                          11543702
*********************************************************************** 11544802
*   ERROR EXIT- ENTERED IF MACRF NOT SPECIFIED, BUFL=0 WITH DYNAMIC   * 11545902
*   BUFFERING, THERE ARE NO PRIMARY EXTENTS OR IF THE ICBACREL @Y30LSBS 11547003
*   MACRO RETURNS AN ERROR CODE.  CONTROL IS PASSED TO         @Y30LSBS 11547103
*   PROBLEM DETERMINATION MODULES WHICH WILL ISSUE A WTP MESSAGE      * 11548102
*   IDENTIFYING THE DATA SET IN ERROR.  AN ACCOMPANYING RETURN CODE   * 11549202
*   WILL IDENTIFY THE CAUSE OF THE ERROR.                             * 11550302
*********************************************************************** 11551402
ERREXIT  EQU   *                        GO TO PROBLEM DETERMINATION     11552502
         LM    R1,R9,DWASAVE1           RESTORE OPEN'S REGISTERS YM3057 11553602
         LR    R2,RDCB                  LOAD REG2 WITH DCB PTR  ZA01362 11553702
*                                       R0 HAS INTERNAL ABEND CD YM3057 11554002
         USING WTG,RWTG                 SET UP BASE FOR WTG      YM7386 11554402
         MVC   WTGMODID,AMIDCNST        MOVE IN 3A ID TO WTG     YM7386 11554502
         DROP  RWTG                     DROP BASE                YM7386 11554602
         DMABCOND  (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES     Y02072 11554702
         B     XCTLRTN                  GO TO RTN TO XCTL ONLY   S21042 11555802
*********************************************************************** 11556902
*********************************************************************** 11558002
*  THE FOLLOWING SUBROUTINE GETS CORE FROM THE SP230 OR FROM SUBPOOL  * 11559102
*  ZERO, DEPENDING ON THE ENTRY POINT. THE LENGTH IS IN R1 UPON ENTRY.* 11560202
*********************************************************************** 11561302
ENTSP230 LA    R0,POOL230               COMBINE THE GETMAIN PARAMETERS  11562402
         B     GETCORE                  BR AROUND INST FOR SP0   Y02072 11563502
ENTUSER  EQU   *                        ENTRY TO GET CORE IN SP0 Y02072 11564602
*                                                                       11565702
         MODESET  KEYADDR=DXUKEY,WORKREG=14 CHANGE TO USER KEY   Y02072 11566802
*                                                                       11567902
         LA    R0,USERPOOL              GET CORE FROM SP0        Y02072 11569002
GETCORE  EQU   *                        GET CORE                 Y02072 11570102
         SLL   R0,24                    (SUBPOOL NUMBER                 11571202
         OR    R0,R1                    AND SIZE).                      11572302
         GETMAIN R,LV=(0)                                               11573402
*                                                                       11574502
         BR    RETURN                   RETURN TO MAIN ROUTINE   Y02072 11575602
*********************************************************************** 11576702
*********************************************************************** 11577802
*  THIS SUBROUTINE LOADS ALL BDAM MODULES AS REQUIRED.  THE ID OF THE * 11578902
*  MODULE TO BE LOADED IS PASSED FROM THE MAIN ROUTINE IN RWRKX(R14). * 11580002
*  AFTER THE MODULE HAS BEEN LOADED RDEBEXT(R7) IS POSITIONED TO THE  * 11581102
*  NEXT ID LOCATION IN THE DEB. THE ADDRESS OF THE LOADED MODULE IS   * 11582202
*  RETURNED TO THE MAIN ROUTINE IN REG 0. RETURN IS VIA RETURN(R2).   * 11583302
*********************************************************************** 11584402
MODLOAD  EQU   *                                                        11585502
         USING WTG,RWTG                 ESTAB BASE FOR WTG TAB   Y02072 11586602
         MVC   WTGMODID,0(RWRKX)        MOVE ID AS LAST 2 BYTES OF NAME 11587702
         LR    R0,RWTG                  SET POINTER TO MODULE NAME      11588802
         L     R1,CVTPTR                GET CVT ADDRESS                 11589902
         USING CVT,R1                   ESTABLISH CVT BASE REG          11591002
         L     R1,CVTLINK               GET POINTER TO LPALIB    YM1140 11592102
         DROP  R1,RWTG                  DROP CVT AND WTG BASE REGS      11593202
         LOAD  EPLOC=(0),DCB=(1)        LOAD BDAM MODULE         Y02072 11594302
         USING DEBSUBNM,RDEBEXT         ESTABLISH DEB SUBROUTINE NAME   11596502
*                                       SECTION BASE REG                11597602
         MVC   DEBSUBID,0(RWRKX)        MOVE ROUTINE ID TO THE   S19015 11598702
*                                       DEB                      S19015 11599802
         LA    RDEBEXT,IDINCR(RDEBEXT)  INCREMENT DEB ID INDEX          11600902
         DROP  RDEBEXT                  DROP DEB SUBRTN SECTION BASE    11602002
         SR    RWRKY,RWRKY              CLEAR WORK REGISTER      Y02072 11603102
         IC    RWRKY,DEBNMSUB           DEB COUNT OF                    11604202
         LA    RWRKY,1(,RWRKY)          SUBROUTINES                     11605302
         STC   RWRKY,DEBNMSUB           STORE BACK IN DEB               11606402
         BR    RETURN                   RETURN TO DECISIONS             11607502
         DROP  RDEBA,RDCB,RCORE         DROP BASE REGS                  11608602
*********************************************************************** 11609702
         EJECT                                                          11610802
*********************************************************************** 11611902
****                                                               **** 11613002
****     CONSTANTS                                                 **** 11614102
****                                                               **** 11615202
*********************************************************************** 11616302
         SPACE                                                          11617402
         DS    0F                                                       11618502
MODIDTBL DS    0D                       TABLE OF MODULE IDS             11619602
IDNOVSKA DC    C'KA'                    FOUNDATION MODULE FOR NON VS    11620702
IDVREKJ  DC    C'KJ'                    FOUNDATION MODULE FOR VS        11621802
IDFEEDKH DC    C'KH'                    FEEDBACK-REL BLK WITH OVERFLO   11622902
IDFEEDKG DC    C'KG'                    FEEDBACK-REL BLOCK ,NO OVERFLO  11624002
IDWAKN   DC    C'KN'                    SELF FORMAT FOR VAR SPANNED     11625102
IDWAKM   DC    C'KM'                    SELF FORMAT FOR VAR AND UNDEF   11626202
IDWAKO   DC    C'KO'                    PRE FORMAT FOR FIXED            11627302
IDCHKLI  DC    C'LI'                    CHECK MODULE                    11628402
IDSIOLE  DC    C'LE'                    SIO ADRESPACE=REAL,NO VS        11629502
         DC    C'JA'                    VIRTUAL DYNAMIC BUFFERING SIO   11630602
IDEOELC  DC    C'LC'                    END OF EXTENT APPENDAGE         11631702
IDCEKU   DC    C'KU'                    CHANNNEL END APPENDAGE          11632802
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETER MODULE      @ZA04216 11636137
OPIDCNST DC    C'0S'                    LAST WTG TABLE ENTRY            11638302
FOUR     DC    F'4'                     CONSTANT TO ROUND TO F WORD     11639402
RNDDBL   DC    X'FFFFFFF8'              ROUND BUFFER LENGTH TO D        11640502
RNDFULL  DC    X'FFFFFFFC'              ROUND BUFFER LENGTH TO F        11641602
FOXES    DC    F'-1'                    INVALID EXTENT         @Y30LSBS 11642703
ONEMOR   DC    H'1'                     CONSTANT OF ONE        @Y30LSBS 11642903
CONH20   DC    H'20'                    CONSTANT OF 20           SM4366 11643003
MODID    DC    CL6'IGG019'              THIS MODULE ID           Y02072 11643102
AMIDCNST DC    C'3A'                    THIS EXECUTOR'S ID       Y02072 11643502
FIX      DC    C'@ZA17540'              LATEST FIX PUT IN      @ZA08000 11643637
DATE     DC    C'&SYSDATE'              DATE OF LATEST FIX     @ZA08000 11643737
PATCH    DC    XL((*-FUNCT1)/20)'0'     5% PATCH AREA            Y02072 11643802
         SPACE 2                                                        11644902
         EJECT                                                          11646002
*********************************************************************** 11649402
****                                                               **** 11652802
****     CONTROL BLOCK DEFINITIONS                                 **** 11656202
****                                                               **** 11659602
*********************************************************************** 11663002
         SPACE                                                          11666402
         IGGBCB TYPE=DAM                                                11669802
*********************************************************************** 11673202
*              BUFFER FORMAT FOR VRE DYNAMIC BUFFERING                  11676602
*********************************************************************** 11680002
BUFFERB  DSECT                          REST OF BUFFER (BUFRECAR A44855 11683402
*                                       IS ALIGNED AS SPECIFIED IN      11686802
*                                       DCBBFALN)                       11690202
BUFBFPTR DS    A                        ADDR OF SEGMENT WORKAREA A44855 11693602
BUFRECAR EQU   *                        RECORD AREA (LENGTH =    A44855 11697002
*                                       BLKSIZE+ KEYLENGTH)      A44855 11700402
*********************************************************************** 11703802
         EJECT                                                          11703902
         IECDSECS  (MAIN,(IOB,NO)),PREFX,WTG,EXPAND=YES          Y02072 11704202
*                                                              @Y30LSBS 11707703
*                                                              @Y30LSBS 11714703
*                                                                       11715703
*             WHERE-TO-GO TABLE ADDITIONAL LABELS                       11719203
*                                                                       11722703
         ORG   WTGIDTTR                                                 11726203
WTGIDNX  DS    CL2                      ID OF NEXT MODULE        Y02072 11729703
*****                                                                   11733203
*****                                                                   11736703
FORCORE  DSECT                          WORKAREA DSECT CONTINUED Y02072 11740203
*****    THE FOLLOWING ARE AUDIT TRAIL BITS SET FOR FORCE CLOSE   ***** 11743703
         IHAFCAUD ORG=YES                                        Y02072 11747203
*****                                                                   11750703
         ORG   DSCBEND                                           Y02072 11754203
DSCBUCB  DS    A                        ADDR OF UCB FOR FM1 DSCB Y02072 11757703
*********************************************************************** 11761203
****     THIS DSECT MAPS THE WORK AREA WITHIN THE OPEN WORK AREA   **** 11764703
****     WHICH IS USED BY THIS MODULE.                             **** 11768203
*********************************************************************** 11771703
         ORG   DXCCW                                                    11775203
DWAWORK  DS    0CL96                    WORKAREA FOR OPEN EXEC   Y02072 11778703
DWASAVE  DS    0CL40                    SAVE AREA FOR OPEN REGS  Y02072 11782203
*                                       REGS 0-9                 Y02072 11785703
DWASAVE0 DS    F                        REG 0                    Y02072 11789203
DWASAVE1 DS    F                        REG 1                    Y02072 11792703
DWASAVE2 DS    F                        REG 2                    Y02072 11796203
DWASAVE3 DS    F                        REG 3                    Y02072 11799703
DWASAVE4 DS    F                        REG 4                    Y02072 11803203
DWASAVE5 DS    F                        REG 5                    Y02072 11806703
DWASAVE6 DS    F                        REG 6                    Y02072 11810203
DWASAVE7 DS    F                        REG 7                    Y02072 11813703
DWASAVE8 DS    F                        REG 8                    Y02072 11817203
DWASAVE9 DS    F                        REG 9                    Y02072 11820703
DWATTCTR DS    H                        SUMMATION OF TRKS IN DS  Y02072 11824203
DWAFM3SW DS    XL1                      FORMAT 3 SWITCH          Y02072 11827703
         DS    XL1                                                      11831203
         DS    F                                                        11834703
DWADSCB  DS    2F                       5 BYTE DSCB CCHHR -OPEN  Y02072 11838203
DWASAVEA DS    7F                       SAVEAREA FOR REGS 9-15 ON BR TO 11841703
*                                       SYSTEM CONVRT RTN-FUNCT2 Y02072 11845203
         ORG   DWATTCTR                 FIELDS NOT NEEDED AFTER FUNCT2  11848703
DWARCTKY DS    F                        SAVES LAST REC OVERHEAD  Y02072 11852203
*                                       + KEY LENGTH (IV)        Y02072 11855703
DWARCOVH DS    F                        SAVES MID SEG OVERHEAD   Y02072 11859203
*                                       WITH NO KEY OVERHEAD(IV) Y02072 11862703
DWARLREC DS    F                        BLKSIZE+KEYLG+OVERHEAD   Y02072 11866203
*                                       FOR LAST REC (IV)        Y02072 11869703
DWARNREC DS    F                        BLKSIZE+KEYLG+OVERHEAD   Y02072 11873203
*                                       FOR NOT LAST REC (IV)    Y02072 11876703
DWATRKLN DS    F                        DEVICE TRACK LG IN BYTES Y02072 11880203
DWAOFLOW DS    F                        SIZE OF OVERFLOW RECORD ON LAST 11883703
*                                       TRACK (IV)               Y02072 11887203
DWAFLAGS DS    B                        FLAG BYTE (IV)           Y02072 11890703
DWAPASS2 EQU   X'80'                    USED TO CHECK FOR SECOND PASS   11894203
*                                       THROUGH LOOP (IV)        Y02072 11897703
         DS    XL1                      UNUSED                          11901203
DWADVTOL DS    H                        DEVICE TOLERANCE FACTOR  Y02072 11904703
DWATTRKS DS    F                        TOTAL NO TRCKS IN EXTENT Y02072 11908203
DWAFAIL1 EQU   X'FF'                    USED TO CAUSE FIRST COMPARE ON  11911703
*                                       THE ABOVE FIELD TO FAIL  Y02072 11915203
DWAWKLG  EQU   *-DWAWORK                WORKAREA USED            Y02072 11918703
         EJECT                                                          11922203
         CVT   DSECT=YES                                                11925702
         EJECT                                                          11975702
         DCBD  DSORG=DA                                                 12025702
         EJECT                                                          12075702
         IEZDEB                                                         12125702
*********************************************************************** 12275702
*        DSECT DEPENDENT EQUATES                                        12325702
*********************************************************************** 12375702
DEBDASDL EQU   (DEBNMTRK+L'DEBNMTRK)-DEBDASD  LENGTH OF DEB DASD SECT   12425702
DAADRLNG EQU   L'DEBSTRCC+L'DEBSTRHH+L'DEBENDCC+L'DEBENDHH  LENGTH OF   12475702
*                                       STARTING AND ENDING CCHH FIELDS 12525702
CCHHLNG  EQU   L'DEBENDCC+L'DEBENDHH    LENGTH OF ENDING CCHH FIELDS    12575702
FLDUCBBB EQU   L'DEBUCBAD+L'DEBBINUM    LENGTH OF DEB UCB AND BB FIELDS 12625702
DEBAVTLN EQU   (DEBXCEAD+L'DEBXCEAD)-DEBAVT  LENGTH OF DEB AVT SECTION  12675702
MODFLDS  EQU   L'WTGATTRB+L'WTGMODSZ+L'WTGTXTLN  LENGTH OF ATTRIBUTE,   12725702
*                                       STORAGE REQUIRED, AND LENGTH    12775702
*                                       FIELDS OF XCTL MODULE           12825702
DCBIOBQS EQU   L'DCBIOBSQ+L'DCBSQND+L'DCBIOBUQ+L'DCBUQND  USED TO CLEAR 12875702
****                                                               **** 12925702
         EJECT                                                          12975702
         IHADVCT                                                 Y02072 13025702
         EJECT                                                          13075702
         IGGPARML                                                Y02072 13125702
         IGGSWA                                                  Y02072 13175702
         EJECT                                                          13225702
         IKJTCB                                                         13275702
         EJECT                                                          13285702
         IHAPSA                                                  Y02072 13295702
         EJECT                                                          13325702
UCB      DSECT                                                          13375702
         IEFUCBOB  LIST=YES                                      Y02072 13425702
         EJECT                                                          13475702
         IGGUSL                                                  Y02072 13525702
         SPACE 2                                                        13575702
         IGGRDX                                                  Y02072 13625702
         EJECT                                                          13626103
*                                                                       13626203
***************************************************************@Y30LSBS 13626303
*                                                              @Y30LSBS 13626403
*        THE FOLLOWING DSECT FORMATS THE ICBACREL MACRO FOR    @Y30LSBS 13626503
*        ACQUIRE LIST USED IN STAGING MSS DATA SETS ONTO REAL  @Y30LSBS 13639003
*        DASD.                                                 @Y30LSBS 13649003
*                                                              @Y30LSBS 13651003
***************************************************************@Y30LSBS 13651403
ACQLST   DSECT                                                 @Y30LSBS 13651637
ACQPLN   EQU   96                       PARAMETER LIST LENGTH  @Y30LSBS 13664103
PLUS3    EQU   3                        DISPLACEMENT OF THREE  @Y30LSBS 13676603
         ICBACREL TYPE=ACQ,MF=L         LIST FORM OF ACQUIRE   @Y30LSBS 13726603
*                                                              @Y30LSBS 13736603
***************************************************************@Y30LSBS 13746603
*                                                              @Y30LSBS 13756603
*        THE FOLLOWING DSECT FORMATS ONE ENTRY IN THE AREXT    @Y30LSBS 13766603
*        LIST.  THE AREXT LIST IS AT OFFSET 28(1C) IN THE      @Y30LSBS 13769003
*        ACQLST DSECT ABOVE.                                   @Y30LSBS 13769403
*                                                              @Y30LSBS 13770603
***************************************************************@Y30LSBS 13772603
AREXTSEC DSECT                                                 @Y30LSBS 13776603
AREXTLN  EQU   4                        LENGTH OF ACQUIRE EXT  @Y30LSBS 13786603
LOCC     DS    CL2                      LOW CC OF ACQUIRE EXT  @Y30LSBS 13806603
HICC     DS    CL2                      HIGH CC OF ACQUIRE EXT @Y30LSBS 13816603
         END                                                            13825702
./  ADD  SSI=43080955,NAME=IGG0199L
         TITLE 'CREATE BDAM(SPANNED RECORD) - IGG0199L'                 00100019
IGG0199L CSECT                                                          00200019
*                                                                     * 00300002
*MODULE NAME - IGG0199L                                               * 00302002
*                                                                     * 00304002
*DESCRIPTIVE NAME - BDAM CREATE OPEN EXECUTOR FOR SPANNED RECORDS     * 00306002
*                                                                     * 00306402
*COPYRIGHT - NONE                                                     * 00306802
*                                                                     * 00306902
*CHANGE ACTIVITY                                                      * 00309502
*                                                                     * 00315002
*          RELEASE 20 CHANGES/DELETIONS                                 00317602
*0150472000                                                      A37858 00320202
*0150                                                            M1157  00322802
*0150199000,240000-243000                                        S20201 00325402
*          RELEASE 21 CHANGES/DELETIONS                                 00328002
*          RELEASE VS2-2 CHANGES/DELETIONS                              00378002
*192800,265600-265800,415700-419900,421300                       Y02072 00380002
*          RELEASE VS2-3 CHANGES/DELETIONS                              00382003
*                                                              @Z30TSMI 00382403
*                                                                       00384019
*STATUS CHANGE LEVEL 004                                                00434002
*                                                                       00500019
*   THIS MODULE IS ADDED AT RELEASE 19 BY SPLIT OF IGG0191L             00600019
*                                                                       00700019
*FUNCTION - THIS ROUTINE IS GIVEN CONTROL AFTER THE DEB AND IOB HAVE    00800019
*           BEEN CONSTRUCTED.                                           00900019
*           1. IT CONSTRUCT CHANNEL PROGRAMS                            01000019
*           2. FOR RECFM=VS AND BFTEK=R,IT OBTAINS SEGMENT WORK AREA    01100019
*              IF NECESSARY AND CREATES RB FOR ASYNCHRONOUS EXIT RTN.   01200002
*              (AN AUDIT TRAIL BIT IS SET TO INDICATE CORE WAS          01350002
*              OBTAINED FOR A SWA. THIS BIT WILL BE INTERROGATED        01360002
*              BY THE FORCE CLOSE EXECUTOR, SHOULD AN ABEND OCCUR       01370002
*              DURING OPEN PROCESSING.  ANOTHER BIT WILL BE SET         01380002
*              AFTER THE DCB HAS BEEN COPIED BACK INTO USER CORE.       01390002
*              IF THIS BIT IS ON THE FORCE CLOSE EXECUTOR WILL GIVE     01392002
*              CONTROL TO THE NORMAL CLOSE EXECUTORS.)                  01394002
*                                                                       01400019
*ENTRY POINT - ENTERED FROM IGG0191L WHEN MACRF=WL AND NO TRACK OVER-   01500019
*              FLOW IS SPECIFIED.                                       01600019
*                                                                       01700019
*INPUT - REGISTERS 5,6,7,8 HAVE BEEN POSITIONED AS FOLLOWS,             01800019
*           5 - BEGINNING OF THE OPEN PARM LIST                         01900019
*           6 - BEGINNING OF THE WTG                                    02000002
*           7 - CURRENT ENTRY IN THE PARM LIST                          02100019
*           8 - CURRENT ENTRY IN THE WTG TABLE                          02200019
*                                                                       02300019
*OUTPUT - THE CHANNEL PROGRAMS WILL BE CONSTRUCTED.                     02400019
*         FOR THE DCB WITH RECFM=VS AND BFTEK=R,RB FOR ASYNCHRONOUS     02500019
*         EXIT ROUTINE IS CREATED.                                      02600019
*                                                                       02700019
*EXTERNAL ROUTINES - NONE                                               02800019
*                                                                       02900019
*EXIT - TO THE LAST LOAD OF COMMON OPEN, IGG0190S.                      03000002
*                                                                       03100019
*TABLES/WORK AREA - 1. OPEN WORK AREA (SEE EXPANSION OF IECDSECT MACRO  03200019
*                      EXPANSION)                                       03300019
*                   2. DIRECT ACCESS DEVICE TABLE                       03400019
*                                                                       03500019
*ATTRIBUTES - THIS ROUTINE RESIDES IN LPALIB. IT IS REENTRANT,          03600002
*             ENABLED, AND RUNS IN SUPERVISOR MODE. IT RUNS IN          03700002
*             DATA MANAGEMENT KEY DURING ALL EXECUTION BUT THE          03800002
*             FURTHER INITIALIZATION OF IOBS AND CHANNEL PROGRAMS AND   03810002
*             GETMAIN AND INITIALIZATION OF SWAS, WHERE A MODESET IS    03850002
*             ISSUED TO PROCESS IN USER KEY.                            03860002
*                                                                       03900019
*NOTES -                                                                04000019
*                                                                       04100019
*                                                                       04200019
*********************************************************************** 04300019
         EJECT                                                          04400019
*********************************************************************** 04500019
*                                                                       04600019
*   REGISTER CONVENTION                                                 04700019
*                                                                       04800019
*********************************************************************** 04900019
*                                                                       05000019
RE       EQU   0                   WORK/PARAMETER REGISTER              05100019
R0       EQU   0                   SAVE REG FOR IECRES           Y02072 05150002
RF       EQU   1                   WORK/PARAMETER REGISTER              05200019
RDCB     EQU   2                   DCB ADDRESS                          05300019
RBASE    EQU   3                   BASE FOR THIS MODULE                 05400019
RCORE    EQU   4                   WORK AREA ADDRESS                    05500019
RPAR     EQU   5                   POINTER TO THE PARAMETER LIST        05600019
RWTG     EQU   6                   POINTER TO W-T-G TABLE               05700019
RPARC    EQU   7                   CURRENT ENTRY IN PARAMETER LIST      05800019
RWTGC    EQU   8                   CURRENT ENTRY IN W-T-G TABLE         05900019
RTIOT    EQU   9                   TIOT ADDRESS                         06000019
RIOB     EQU   9                   IOB REGISTER                         06100019
RUCB     EQU   10                  UCB ADDRESS                          06200019
RDEB     EQU   11                  DEB ADDRESS                          06300019
RB       EQU   12                  WORK REGISTER                        06400019
RC       EQU   13                  WORK REGISTER                        06500019
RD       EQU   14                  WORK REGISTER                        06600019
R14      EQU   14                  SAVE REG FOR IECRES           Y02072 06650002
RJ       EQU   15                  WORK/PARAMETER REGISTER              06700019
*                                                                       06800019
*                                                                       06900019
*********************************************************************** 07000019
*                                                                       07100019
*   EQUATES                                                             07200019
*                                                                       07300019
*********************************************************************** 07400019
*                                                                       07500019
NULL     EQU   0                   CONSTANT '0'                         07600019
ONE      EQU   1                   CONSTANT '1'                         07700019
FIRST    EQU   1                   CONSTANT '1'                         07800019
TWO      EQU   2                   CONSTANT '2'                         07900019
THREE    EQU   3                   CONSTANT '3'                         08000019
FOUR     EQU   4                   CONSTANT '4'                         08100019
FIVE     EQU   5                   CONSTANT '5'                         08200019
SIX      EQU   6                   CONSTANT '6'                         08300019
SEVEN    EQU   7                   CONSTANT '7'                         08400019
EIGHT    EQU   8                   CONSTANT '8'                         08500019
NINE     EQU   9                   CONSTANT '9'                         08600019
TEN      EQU   10                  CONSTANT '10'                        08700019
MSK14    EQU   14                  CONSTANT '14'                        08800019
MSK16    EQU   16                  CONSTANT '16'                        08900019
MSK20    EQU   20                  CONSTANT '20'                        09000019
MSK22    EQU   22                  CONSTANT '22'                        09200019
MSK23    EQU   23                  CONSTANT '23'                        09300019
MSK24    EQU   24                  CONSTANT '24'                        09400019
MSK32    EQU   32                  CONSTANT '32'                        09600019
WRITOFFS EQU   96                  OFFSET TO WRITE CCW                  09800002
*                                                                       09900019
WGOFF    EQU   8                   OFFSET OF ENTRIES IN WTG TABLE       09950002
PAROFF   EQU   4                   OFFSET OF ENTRIES IN PARM LIST       09960002
ASYNCAD  EQU   8                   OFFSET IN 19BR TO ADDR        Y02072 09970002
*                                  OF ASI ROUTINE                Y02072 09980002
ERSOP    EQU   X'11'               ERASE OP-CODE                        10000019
ERSFLG   EQU   X'20'               SUPPRESS INCORRECT LENGTH            10100019
ERSCNT   EQU   X'08'               COUNT OF 8                           10200019
*                                                                       10300019
YES      EQU   8                   CONDITION CODE FOR  'BCR 8,X'        10400019
*                                                                       10500019
*                                                                       10600019
SCHIDEQ  EQU   X'31'               CCW=SRCH ID EQ                       10700019
WRTCKD   EQU   X'1D'               CCW=WRITE C/K/D                      10800019
DCHN     EQU   X'80'               DATA CHAIN FLAG                      10900019
RDKD     EQU   X'0E'               CCW=READ K/D                         11000019
CCHN     EQU   X'40'               COMMAND CHAIN FLAG                   11100019
WRTD     EQU   X'05'               CCW=WRITE DATA                       11200019
READD    EQU   X'06'               CCW=READ DATA                        11300019
SILI     EQU   X'20'               SILI FLAG                            11400019
SKIP     EQU   X'10'               SKIP FLAG                            11500019
*                                                                       11600019
WRTBIT   EQU   X'40'               WRITE TYPE OPERATION                 11700019
*                                                                       11800019
VORU     EQU   X'40'               DCBRECFM=V/U                         11900019
FORU     EQU   X'80'               RECFM=F/U                            12000019
SPANNING EQU   X'08'               RECFM=S                              12100019
SOFTTRK  EQU   X'20'               BFTEK=R                              12200019
WRTCHK   EQU   X'80'               DCBOPTCD=WRITE CHECK                 12300019
SAMEREC  EQU   X'01'               COBOL HAS PROVIDED WITH S-W-A        12400019
HIARCHY  EQU   X'80'               DCBBFTEK=HIARCHY                     12500019
MSKCB    EQU   12                  LENGTH OF SWA C.B.                   12600019
*                                                                       12700019
*                                                                       12800019
*********************************************************************** 12900019
*                                                                       13000019
*   REGISTER INITIALIZATION                                             13100019
*                                                                       13200019
*********************************************************************** 13300019
*                                                                       13400019
         USING GOGOGO,RBASE        ESTABLISH BASE REGISTER              13500019
         USING DEBBASIC,RDEB       ESTABLISH DEB REGISTER        Y02072 13600002
         USING IHADCB,RDCB         ESTABLISH DCB REGISTER               13700019
         USING IOBBSAMN,RIOB       ESTABLISH IOB BASE            Y02072 13800002
         USING FORCORE,RCORE                                     Y01021 13850000
         USING WTG,RWTG                                                 13860003
         USING WTGENTRY,RWTGC                                           13870003
*                                                                       13900019
         BALR  RBASE,RE            ESTABLISH BASE REGISTER              14000019
*                                                                       14100019
GOGOGO   EQU   *                                                        14200019
*                                                                       14300019
         L     RDCB,NULL(RPARC)    LOAD DCB ADDRESS                     14400019
         L     RCORE,FOUR(RWTGC)   LOAD WORK AREA ADDRESS               14500019
         L     RDEB,DCBDEBAD       LOAD DEB ADDRESS                     14600019
*                                                                       14700019
         L     RIOB,DCBIOBA        LOAD IOB ADDRESS                     14800019
*                                                                       14800102
         MODESET   KEYADDR=DXUKEY,WORKREG=13 CHANGE TO USER KEY  Y02072 14800402
*                                                                       14800802
         L     RC,IOBSTART         GET SECTOR ADDRESS            Y02072 14802002
*                                                                       14900019
*********************************************************************** 15000019
*                                                                       15100019
*   THE FOLLOWING ROUTINE WILL CONSTRUCT CHANNEL PROGRAMS               15200019
*                                                                       15300019
*********************************************************************** 15400019
*                                                                       15500019
         OI    IOBNFLG1,IOBFIRST       MARK FIRST IOB FOR CLOSE  Y02072 15600002
*                                                                       15700019
FILLIOB  EQU   *                                                        15800019
         SR    RD,RD                   CLEAR WORK REG            M1157  15850020
*                                                                       15900019
         IC    RD,DCBKEYLE         INSERT KEY LENGTH AND                16000019
         STC   RD,IOBDNRCF+FIVE    STORE IT IN NEW REORD COUNT FIELD    16100019
         LH    RJ,DCBBLKSI         LOAD BLOCK SIZE AND                  16200019
         STH   RJ,IOBDNRCF+SIX     NEW RECORD COUNT FIELD               16300019
         OI    IOBNFLG1,IOBWRITE   MARK IOB AS A WRITE TYPE      Y02072 16400002
         AR    RJ,RD               ADD KL+BLKSIZE AND                   16600019
         STH   RJ,IOBCCW4+SIX      STORE IT INTO COUNT OF WRITE         16700019
         LA    RJ,EIGHT            SET FOR LENGTH 8 FOR R0 AND          16800019
         ST    RJ,IOBR0CNT+FOUR    STORE IT IN R0 COUNT                 16900019
*                                                                       17000019
         L     RJ,DXUDCBAD              GET USERS DCB PTR IN WKA Y02072 17250002
         LA    RJ,0(RJ)                 ZERO TOP BYTE            Y02072 17260002
         ST    RJ,IOBDCBPT              STORE ADDRESS IN IOB     Y02072 17270002
*                                                                       17300019
         LA    RJ,IOBCC            LOAD  ADDRESS OF CCHHR AND           17400002
         ST    RJ,IOBCCW1          STORE IT AS SRCH ID ARGUMENT         17500019
         MVI   IOBCCW1,SCHIDEQ     SET C.C.=SRCH ID EQ                  17600019
         LA    RJ,IOBCCW1          LOAD ADDRESS OF CCW1 AND             17700019
         ST    RJ,IOBCCW2          STORE IT IN TIC CCW                  17800019
*                                                                       17900019
         ST    RJ,IOBSTART         START OF CHANNEL PROGRAM             18000002
*                                                                       18100019
         MVC   IOBCCW1+FOUR(FIVE),CCHN5TIC   SET CHN,CNT=5 AND TIC C.C. 18200019
*                                                                       18300019
         SR    RJ,RJ               CLEAR REG                            18320019
         IC    RJ,DCBKEYLE         INSERT KEYLENGTH                     18330019
         AH    RJ,DCBBLKSI         ADD BLOCKSIZE                        18340019
         STH   RJ,IOBCCW2+SIX      SAVE KEYLENGTH +                     18350019
*                                  BLKSIZE IN TIC                       18360019
         LA    RJ,IOBDNRCF         LOAD ADDR OF NEW COUNT FIELD AND     18400019
         ST    RJ,IOBCCW3          STORE IT IN WRITE CCW                18500019
         MVI   IOBCCW3,WRTCKD      SET C.C.=WRITE C/K/D                 18600019
         MVI   IOBCCW4,WRTCKD      SET C.C.=WRITE C/K/D                 18700019
         MVI   IOBCCW3+FOUR,DCHN   SET DATA CHAIN FLAG                  18800019
         MVI   IOBCCW3+SEVEN,EIGHT SET COUNT=8                          18900019
*                                                                       18950002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 18960002
*                                                                       18970002
         MVI   DCBOFFSW,WRITOFFS        OFFSET TO WRITE CCW             19000019
*                                                                       19100019
         LA    RB,IOBCCW5               SET UP INDEX FOR REMAINING CCWS 19200002
         MVI   DCBOFFSR,NCCWAOFF        ST NON REC REDY, NO      S20201 19202020
*                                       WRTCHK                   S20201 19204020
*                                       OFFSET POINTER TO CCW10         19206020
         MVI   DCBWCPO,NCCW5OFF         PUT NON REC REDY OFFSET  S20201 19208020
*                                       PT TO                    S20201 19210020
*                                           CCW5 INTO DCBWCPO OF DCB    19212020
         TM    JFCBMASK+D6,NONCARN      DO THE STARS INDICATE    S20201 19214020
*                                       RPS                      S20201 19216020
         BNO   RPS                      YES, GO SET UP PTRS      Y02072 19218002
*                                                                       19218402
         TM    DCBOPTCD,WRTCHK          IS WRT CHK REQUESTED     Y02072 19218802
         BO    WTCKCCW2                 BUILD WRT CHK CP         Y02072 19219202
*                                                                       19219602
         MODESET  KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY  Y02072 19220002
*                                                                       19220102
         B     BLDWRTR0                 GO CONSTRUCT R0          Y02072 19220802
*                                                                       19220902
RPS      EQU   *                        SET UP RPS POINTERS      Y02072 19221202
         MVI   DCBOFFSW,CCCW5OFF        PUT REC REDY OFFSET PT   S20201 19222020
*                                       TO CCW5                  S20201 19224020
*                                       INTO DCBOFFSW AREA OF DCB       19226002
         MVI   DCBWCPO,CCCW7OFF         PUT OFFSET PT TO CCW7    S20201 19228020
*                                       INTO                     S20201 19230020
*                                       DCBWCPO IF REC REDY DEVICE      19232020
         MVI   DCBOFFSR,CCCWEOFF        ST NO WRTCHK WITH RPS    S20201 19234020
*                                         OFFSET POINTER TO CCW14       19236020
*                                          POINTER IN DCBOFFSR          19238020
*                                                                       19238402
         MODESET   KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY Y02072 19238802
*                                                                       19239602
         MVI   IOBCCW4+HALFCCW,CCHN     MOVE IN CHAIN COMMAND    S20201 19240020
         MVC   IOBCCW5(CARSHIFT),IOBCCW1 SHIFT FOUR CCWS DOWN 32 S20201 19244020
*                                         BYTES AND THEN BRING THEM     19246020
         MVC   IOBCCW2(CARSHIFT),IOBCCW5  BACK TO CCW2. THIS     S20201 19248020
*                                       AVOIDS                   S20201 19250020
*                                         PROPAGATION.                  19252020
         XC    IOBCCW6(CARN24),IOBCCW6  ZERO OUT TEMP MOVE       S20201 19254020
*                                       LOCATION                 S20201 19256020
         ST    RC,IOBCCW1               PUT SECTOR PT IN VACANT  S20201 19258020
*                                       DW                       S20201 19260020
         LA    RJ,IOBCCW2               GET CORRECT ADDR IF      S20201 19262020
*                                       CARNIVAL                 S20201 19264020
         ST    RJ,IOBCCW3                 AND ST IT IN THE TIC   S20201 19266020
         MVI   IOBCCW3,TICCODE          PUT IN THE TIC OP CODE   S20201 19268020
         MVI   IOBCCW1,SETSECT          PUT IN SET SECTOR        S20201 19270020
*                                       COMMAND CODE             S20201 19272020
         MVC   IOBCCW1+HALFCCW(HALFCCW),CCHNCARN  MOVE STD LAST  S20201 19274020
*                                       HALF                     S20201 19276020
*                                            OF REC REDY   CCW IN CCW   19278020
         ST    RC,CARN8(RE,RB)          PUT POINTER IN RD SECT   S20201 19282020
*                                       SET SECT & READ SECT USE Y02072 19282402
*                                       SAME ADDRESS             Y02072 19282802
         MVI   CARN8(RB),RDSECT         PUT IN READ SECTOR       S20201 19284020
*                                       COMMAND                  S20201 19286020
         LA    RB,CARN8(RE,RB)          PT TO RD SECT CCW        S20201 19288020
         MVI   CNTOFF(RB),ONE           SET COUNT TO ONE         S20201 19290020
         LA    RB,CARN8(RE,RB)          SET CCW PTR TO CCW7 IF   S20201 19292020
*                                              RPS FEATURE IS PRESENT   19294020
WTCKTEST EQU   *                                                 S20201 19296020
*                                                                       19300019
         TM    DCBOPTCD,WRTCHK     TEST IF DCBOPTCD=WRITE CHECK         19400019
         BNO   BLDWRTR0            NO,SKIP TO CONSTRUCT WRITE R0        19500019
*                                                                       19600019
*   YES - CONSTRUCT WRITE CHECK CCWS                                    19700019
*                                                                       19800019
         TM    JFCBMASK+D6,NONCARN      CHECK IF RPS             S20201 19806020
         BO    WTCKCCW1                 NO, THEN CONSTRUCT       S20201 19812020
*                                       WRTCHK CCWS              S20201 19818020
         OI    IOBCCW6+FOUR,CCHN        SET CHAIN TO WRT CHK     S20201 19824020
*                                                                       19826002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 19828002
*                                                                       19828402
         MVI   DCBOFFSR,CCCWXOFF        PUT 18TH CCW OFFSET PT   S20201 19830020
*                                       INTO                     S20201 19836020
*                                         DCBOFFSR IF RPS               19842020
         MVI   DCBWCPO,CCCWBOFF         STORE OFFSET TO          S20201 19848020
*                                       SCH-ID-EQ                S20201 19854020
*                                       IF WRT CHK AND RPS              19860020
*                                                                       19862002
         MODESET  KEYADDR=DXUKEY,WORKREG=15   CHANGE TO USER KEY Y02072 19864002
*                                                                       19864402
         ST    RC,NULL(RE,RB)           PUT IN SECT2 ADDR        S20201 19866020
         MVI   NULL(RB),SETSECT         PUT IN SET SECTOR        S20201 19872020
*                                       COMMAND                  S20201 19878020
         MVC   HALFCCW(HALFCCW,RB),CCHNCARN  PUT IN FLAG/COUNT   S20201 19884020
*                                       FIELD                    S20201 19890020
         LA    RB,CARN8(RE,RB)          PT TO CCW8               S20201 19896020
         B     WRTCCCWS                 BR AROUND NON RPS        S20201 19902020
*                                         CODING                        19908020
WTCKCCW1 EQU   *                                                 S20201 19914020
*                                                                       19916002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 19918002
*                                                                       19918402
WTCKCCW2 EQU   *                        BUILD WRT CHK CHN PGM    Y02072 19918802
         MVI   DCBOFFSR,NCCWDOFF        PUT 13TH CCW OFFSET PT   S20201 19920020
*                                       INTO                     S20201 19926020
*                                       DCBOFFSR OF DCB IF NON-CARNIVAL 19932020
         MVI   DCBWCPO,CCCW8OFF         STORE OFFSET TO          S20201 19938020
*                                       SCH-ID-EQ IF             S20201 19944020
*                                       NO WRT CHK AND RPS              19950020
*                                                                       19952002
         MODESET  KEYADDR=DXUKEY,WORKREG=15   CHANGE TO USER KEY Y02072 19954002
*                                                                       19954402
         OI    IOBCCW4+FOUR,CCHN        SET COMMAND CHAIN TO WRT S20201 19956020
*                                       CHK                      S20201 19962020
*                                       NON RPS                         19968020
WRTCCCWS EQU   *                                                 S20201 19974020
         LA    RJ,IOBDNRCF              LOAD ADDR OF NEW COUNT   S20201 19980020
*                                       FIELD                    S20201 19986020
         ST    RJ,NULL(RB)         STORE IOBDNRCF AS SRCH ARGUMENT      20000019
         MVI   NULL(RB),SCHIDEQ    SET C.C.=SRCH ID EQ                  20100019
         ST    RB,EIGHT(RB)        STORE CCW5 AS TIC ADDR               20200019
*                                                                       20300019
         MVC   FOUR(FIVE,RB),CCHN5TIC   MOVE CHN,CNT AND TIC OP         20400019
         MVI   MSK16(RB),RDKD      SET C.C.=READ K/D                    20500019
         MVI   MSK20(RB),SILI+SKIP SET SILI AND SKIP FLAGS              20600019
         MVI   MSK22(RB),FIRST     SET COUNT=1                          20700019
         LA    RB,MSK24(RB)        INCREMENT INDEX TO NEXT CCW          20800019
*                                                                       20900019
BLDWRTR0 EQU   *                                                        21000019
*                                                                       21100019
*   THIS ROUTINE CONSTRUCT WRITE-R0 CCWS                                21200019
*                                                                       21300019
         TM    JFCBMASK+D6,NONCARN      IS IT RPS (REC READY)    S20201 21308020
         BO    WRTR0                    NO, THEN GO TO WRITE OUT S20201 21316020
*                                       R0                       S20201 21324020
         LA    RC,ONE(RE,RC)            PT TO 2ND SECT BYTE      Y02072 21332002
*                                       2ND BYTE IS 0 -WRTCHK    Y02072 21334002
         ST    RC,NULL(RE,RB)           PUT IN SETSECT COMMAND   S20201 21340020
         MVI   NULL(RB),SETSECT         PUT IN SET SECTOR        S20201 21348020
*                                       COMMAND                  S20201 21356020
         MVC   HALFCCW(HALFCCW,RB),CCHNCARN  PUT IN FLAG/COUNT   S20201 21364020
*                                       FIELD                    S20201 21372020
         LA    RB,CARN8(RE,RB)          PT TO CCW12 IF RPS       S20201 21380020
WRTR0    EQU   *                                                 S20201 21388020
         LA    RJ,IOBR0CNT         AD ADDR OF R0 CNT AND                21400019
         ST    RJ,NULL(RB)         STORE IT AS SRCH ARGUMENT            21500019
         MVI   NULL(RB),SCHIDEQ    SET C.C.=SRCH ID EQ                  21600019
         ST    RB,EIGHT(RB)        STORE SRCH CCW AS TIC ADDR           21700019
         MVC   FOUR(FIVE,RB),CCHN5TIC  MOVE CHN,CNT AND TIC C.C.        21800019
*                                                                       21900019
         LA    RJ,IOBR0DAT         LOAD ADDR OF R0 DATA AND             22000019
         ST    RJ,MSK16(RB)        STORE IT AS WRITE R0 DATA            22100019
         MVI   MSK16(RB),WRTD      SET C.C.=WRITE DATA                  22200019
         MVI   MSK23(RB),EIGHT     SET COUNT=8                          22300019
*                                                                       22400019
         TM    DCBOPTCD,WRTCHK     TEST IF DCBOPTCD=WRITE CHECK         22500019
         BO    BLDCHKR0            YES,GOTO CONSTRUCT WRITE CHECK       22600019
*                                                                       22700019
*   NO - THEN TEST RECFM=F OR RECFM=V/U                                 22800019
*        F - SKIP WRITE CHECK R0                                        22900019
*        V/U - CONSTRUCT WRITE CHECK R0                                 23000019
*                                                                       23100019
         TM    DCBRECFM,VORU       TEST IF RECFM=V/U                    23200019
         BNO   TSTLOOP             NO, GOTO NEXT IOB CHECK              23300019
*                                                                       23400019
BLDCHKR0 EQU   *                                                        23500019
*                                                                       23600019
*   THIS ROUTINE CONSTRUCTS CHANNEL PROGRAM FOR WRITE CHECK R0          23700019
*                                                                       23800019
         MVI   MSK20(RB),CCHN      SET CCHN FOR WRITE R0                23900019
         LR    RJ,RB                    SAVE POINTER TO SCH CCW  S20201 23920020
         TM    JFCBMASK+D6,NONCARN      IS IT THE CREEPING RPS   S20201 23940020
         BO    WRTCHKR0                 NO, THEN GO TO WRTCH R0  S20201 23960020
*                                       RTN                      S20201 23980020
         ST    RC,CARN24(RE,RB)         ST SECT1 ADDR IN RPS     Y02072 24000002
*                                       RD & SET SECT USE 1 BYTE Y02072 24020002
         MVI   CARN24(RB),SETSECT       PUT IN COMMAND CODE      S20201 24040020
         MVC   CARN28(HALFCCW,RB),CCHNCARN  PUT IN FLAG/COUNT    S20201 24060020
*                                       WORD                     S20201 24080020
         LA    RB,CARN8(RE,RB)          UPDATE CCW PTR           S20201 24100020
WRTCHKR0 EQU   *                                                 S20201 24120020
         LA    RE,MSK24(RB)             LOAD ADDR OF SCH CCW AND S20201 24140020
         ST    RE,MSK32(RB)             STORE IT AS TIC ADDRESS  S20201 24160020
         MVC   MSK24(NINE,RB),NULL(RJ)  MOVE SCH R0 CCW AND TIC  S20201 24180020
*                                       C.C.                     S20201 24200020
         LR    RB,RE                    INCREMENT INDEX BY THREE S20201 24220020
*                                       CCWS                     S20201 24240020
         MVI   MSK16(RB),READD     GET C.C.=READ DATA                   24400019
         MVI   MSK20(RB),SILI+SKIP SET SILI AND SKIP FLAGS              24500019
         MVI   MSK23(RB),FIRST     SET LENGTH=1                         24600019
         LA    RB,MSK24(RB)        INCREMENT INDEX TO LAST CCW          24700019
*                                                                       24800019
         TM    DCBRECFM,VORU       IF RECM=V/U                          24900019
         BNO   TSTLOOP             NO,GOTO TEST NEXT IOB                25000019
*                                                                       25100019
*   THIS ROUTINE CONSTRUCTS ERASE CHANNEL PROGRAM                       25200019
*                                                                       25300019
         ST    RB,NULL(RB)         STORE DUMMY ADDRESS IN ERASE CCW     25400019
         MVI   NULL(RB),ERSOP      SET C.C.=ERASE                       25500019
         MVI   FOUR(RB),ERSFLG     SET SILI FLAG                        25600019
         MVI   SEVEN(RB),ERSCNT    SET COUNT OF '8'                     25700019
*                                                                       25800019
TSTLOOP  EQU   *                                                        25900019
*                                                                       26000019
*   IF THERE IS ANY IOB LEFT, REPEAT,ELSE CHECK IF RECFM=V AND BFTEK=R  26100019
*      YES - GOTO VS ROUTINE                                            26200019
*      NO  - XCTL TO THE LAST LOAD OF OPEN                              26300019
*                                                                       26400019
         L     RIOB,IOBNIOBA            LOAD NEXT IOB ADDRESS    Y02072 26500002
         BCTR  RC,NULL                  PT BACK TO ORIGINAL      S20201 26520020
*                                       SECTOR (RD AND SET)      Y02072 26540002
         TM    IOBNFLG1,IOBFIRST        IS NEXT IOB THE FIRST    Y02072 26600002
         BNO   FILLIOB             NO,REPEAT TO CONSTRUCT ANOTHER CCWS  26700019
*                                                                       27400019
         TM    DCBBFTEK,SOFTTRK         TEST IF BFTEK=R                 27500002
         BO    VSPAN                    YES, BR TO SET UP SWA    Y02072 27550002
*                                                                       27560002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 27600002
*                                                                       27650002
         B     SCAN                     NO, GO TO XCTL RTN       Y02072 27660002
*                                                                       27700019
*********************************************************************** 27800019
*                                                                       27900019
*   WHEN BFTEK=R IS SPECIFIED,                                          28000019
*       1. OBTAIN SEGMENT WORK AREA                                     28100019
*       2. CREATE IRB FOR ASYNCHRONOUS EXIT ROUTINE                     28200019
*                                                                       28300019
*********************************************************************** 28400019
*                                                                       28500019
*   1. CONSTRUCTION OF SEGMENT WORK AREA POOL.                          28600019
*                                                                       28700019
*      THE SEGMENT WORK AREA IS CONSTRUCTED IF BIT 7 OF DCBMACRF IS NOT 28800019
*      SPECIFIED. THE ADDRESS OF SEGMENT WORK AREA CONTROL BLOCK WILL   28900019
*      BE PLACED IN DCBEOBW.THE FORMATS OF THE SEGMENT WORK AREA        29000019
*      CONTROL BLOCK AND A SEGMENT WORK AREA ARE SHOWN AS DSECTS.       29100019
*      THE NO. OF SEGMENT WORK AREA IS DETERMINED BY DCBNCP AND ITS     29200019
*      LENGTH IS DETERMINED BY SMALLER OF THE TRACK SIZE OR BLKSIZE     29300019
*      THIS ROUTINE IS ENTERED IN USER KEY.                             29350002
*                                                                       29400019
*********************************************************************** 29500019
*                                                                       29600019
VSPAN    EQU   *                        SET UP SEG WORK AREAS    Y02072 29650002
         TM    DCBMACRF+ONE,SAMEREC  TEST IF SEG WORK AREA BEEN GIVEN   29700019
         BO    CHAINSWA            YES,SKIP S.W.A. CONSTRUCTION         29800019
*                                                                       29900019
*   NO - OBTAIN NCP                                                     30000019
*                                                                       30100019
         SR    RJ,RJ               RESET REGISTER                       30200019
         IC    RJ,DCBNCP           INSERT NCP FROM DCB                  30300019
*                                                                       30400019
         L     RD,DCBDVTBL         LOAD DEVICE CHARACTERISTIC TABLE     30500019
         USING DVCT,RD             ESTABLISH BASE FOR DEVICE TAB Y02072 30600002
*                                                                       30700019
         LH    RD,DVCTRKLN         LOAD TRACK LENGTH                    30800002
         DROP  RD                  DROP DASD BASE                       30900019
*                                                                       31000019
         SR    RE,RE               RESET REGISTER                       31100019
         IC    RE,DCBKEYLE         INSERT KEYLENGTH                     31200019
         AH    RE,DCBBLKSI         LENGTH=KEYLEN+BLKSIZE                31300019
*                                                                       31400019
         CR    RD,RE               TEST IF TRACK SIZE EXCEEDS BLKSIZE   31500019
         BNH   CALCORE             NO,GOTO CALCULATE SEG WORK AREA SIZE 31600019
*                                                                       31700019
         LR    RD,RE               LOAD BLKSIZE                         31800019
*                                                                       31900019
CALCORE  EQU   *                                                        32000019
*                                                                       32100019
*   CALCULATE SEGMENT WORK AREA SIZE                                    32200019
*      NCP * SMALLER OF (BLKSIZE OR TRACK SIZE + 10) + 8                32300019
*                                                                       32400019
         AH    RD,CONST10          ADD '10' FOR CONTROL INFORMATION     32500019
*                                                                       32600019
         LA    RD,THREE(RD)        ADJUST TO FULL WORD                  32700019
         SRL   RD,TWO              THEN ROUND IT TO FULL WORD           32800019
         SLL   RD,TWO              BACK TO FULL WORD MULTIPLE           32900019
*                                                                       33000019
         STH   RD,IOBFLAG3         STORE LENGTH INTO IOB FOR     Y02072 33100002
         MH    RJ,IOBFLAG3         TEMPORARY MULTIPLY            Y02072 33200002
         LA    RJ,MSKCB(RJ)        ADD LENGTH OF CONTROL BLOCK          33300019
*                                                                       33700019
         GETMAIN R,LV=(15),SP=0         GET CORE FROM SP0        Y02072 33800002
*                                                                       33900019
*                                                                       34700019
*   INITIALIZE SEG. WORK AREA                                           34800019
*                                                                       34900019
         USING SWACB,RF            ESTABLISH BASE FOR SWA CONTROL BLOCK 35000019
*                                                                       35100019
         XC    SWACBPTR(MSKCB),SWACBPTR  CLEAR SWA CONTROL BLOCK        35200019
         MVC   SWACBNO+ONE(ONE),DCBNCP  MOVE NO. OF SWA                 35300019
         MVC   SWACBLNG,IOBFLAG3        MOVE LENGTH OF SWA       Y02072 35400002
*                                                                       35450002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATAMGT KEY    Y02072 35460002
*                                                                       35470002
         ST    RF,DCBEOBW               STORE ADDR OF SWA IN DCBEOBW    35500002
         OI    DXATEXC1,FCAOSWA         SET AUDIT TRAIL BIT      Y02072 35550002
*                                       FOR FORCE CLOSE CLEANUP  Y02072 35560002
*                                       INDICATING SWA GOTTEN    Y02072 35570002
*                                                                       35600019
*                                                                       35650002
         MODESET  KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY  Y02072 35660002
*                                                                       35670002
         LA    RD,MSKCB(RF)             OBTAIN 1ST SWA ADDR             35700002
         ST    RD,SWACBPTR              SET 1ST SWA ADDR PTR            35800002
*                                                                       35900019
         LH    RJ,SWACBNO          INSERT NO. OF SWA                    36000019
         LH    RF,SWACBLNG         LOAD SEG WORK AREA LENGTH            36100019
         B     LASTSWA             GOTO CHECK SEGMENT WORK AREA         36200019
*                                                                       36300019
         USING SWA,RD              ESTABLISH BASE FOR S.W.A.     Y02072 36400002
*                                                                       36500019
REPEAT   EQU   *                                                        36600019
*                                                                       36700019
*   LINK ALL SEGMENT WORK AREA                                          36800019
*                                                                       36900019
         LA    RE,NULL(RF,RD)      LOAD NEXT SWA ADDR                   37000019
         ST    RE,SWANXTPT         STORE NEXT SWA ADDR IN SWA    Y02072 37100002
         XC    SWARCDPT,SWARCDPT   CLEAR THE CONTROL FIELD       Y02072 37200002
         LR    RD,RE               POINT TO NEXT SWA                    37300019
*                                                                       37400019
*                                                                       37500019
LASTSWA  EQU   *                                                        37600019
*                                                                       37700019
         BCT   RJ,REPEAT           GOTO LINK NEXT SEG. WORK AREA        37800019
*                                                                       37900019
         XC    SWA(SWACSLNG),SWA     RESET POINTER TO '0'        Y02072 38000002
*                                                                       38100019
CHAINSWA EQU   *                                                        38200019
*                                                                       38300019
*   TIE S.W.A. TO I/O AREA OF IOBS                                      38400019
*                                                                       38500019
         L     RD,DCBEOBW          LOAD S.W.A.CB ADDR                   38600019
         XC    EIGHT(FOUR,RD),EIGHT(RD) CLEAR TT FIELDS                 38650019
         L     RD,NULL(RD)         LOAD FIRST SWA ADDR                  38700019
*                                                                       38800019
LOOPSWA  EQU   *                                                        38900019
*                                                                       39000019
         LA    RC,SWASEGMT         GET ADDR OF DATA PART OF SWA  Y02072 39100002
         TM    JFCBMASK+D6,NONCARN      IS IT THE RPS MONSTER    S20201 39110020
         BO    NOCARN1                  IF NOT BRANCH OUT        S20201 39120020
         ST    RC,IOBCCW5               SET DATA ADDR TO SWA FOR S20201 39130020
*                                       CARN                     S20201 39140020
         MVI   IOBCCW5,WRTCKD           IMPLACE THE OF CODE      S20201 39150020
         B     NEXTIOB                  LOOK FOR NEXT IOB        S20201 39160020
NOCARN1  EQU   *                                                 S20201 39170020
         ST    RC,IOBCCW4          SET DATA ADDR TO S.W.A.              39200019
         MVI   IOBCCW4,WRTCKD      SET C.C.=WRITE-C/K/D                 39300019
NEXTIOB EQU *                                                    S20201 39350020
*                                                                       39400019
         L     RIOB,IOBNIOBA       LINK TO THE NEXT IOB          Y02072 39500002
         L     RD,SWANXTPT         LOAD NEXT S.W.A. ADDR         Y02072 39600002
*                                                                       39700019
         TM    IOBNFLG1,IOBFIRST   TEST IF THIS IS THE FIRST IOB Y02072 39800002
         BO    CRIRB               YES,END LOOP AND GOTO CRIRB ROUTINE  39900019
*                                                                       40000019
         B     LOOPSWA             GOTO TIE NEXT SWA AND CCW            40100019
*                                                                       40200019
*********************************************************************** 40300019
*                                                                       40400019
CRIRB    EQU   *                                                        40500019
*                                                                       40600019
*********************************************************************** 40700019
*                                                                       40800019
*   CREATE IRB FOR ASYNCHRONOUS EXIT ROUTINE                            40900019
*        THE ROUTINE IS A PART OF WRITE AND IT'S ADDRESS IS             41000019
*        STORED IN THE +8 OF WRITE ROUTINE                              41100019
*                                                                       41200019
*********************************************************************** 41300019
*                                                                       41400019
CIRB     EQU   *                                                 M4893  42060019
         L     RJ,DCBWRITE              LOAD ADDR OF VS WR(19BR) Y02072 42110002
         L     RE,ASYNCAD(RJ)           LOAD ADDR OF ASI IN 19BR Y02072 42160002
*                                                                       42170002
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE)                   Y02072 42200002
*                                                                       42300019
*                                                                       42350002
         MODESET  EXTKEY=DATAMGT       CHANGE TO DATAMGT KEY     Y02072 42360002
*                                                                       42370002
         IC    RJ,DEBOFLGS         SAVE DEBOFLGS                        42400019
         ST    RF,DEBIRBAD         STORE IRB ADDR IN DEB                42500019
         STC   RJ,DEBIRBAD         RESTORE DEBOFLGS INTO                42600019
*                                                                       43200019
*********************************************************************** 43300019
*                                                                       43400019
*   THIS ROUTINE DETERMINES DCB PARM LIST AND WHERE-TO-GO NEXT.         43500019
*   THE NEXT ROUTINE FOR THIS DCB IS ALWAYS THE COMMON OPEN             43600002
*   MODULE, IGG0190S                                                    43650002
*                                                                       43700019
*********************************************************************** 43800019
SCAN     EQU   *                                                        43850002
         MVC   DEBDCBB,DXUDCBAD+1       REPLACE DCB COPY ADDR    Y02072 43860002
*                                       WITH USER DCB IN DEB     Y02072 43870002
*                                                                       43900019
*  ISSUE A MACRO WHICH CALLS AN EXTERNAL ROUTINE TO COPY THE            43950002
*  PROTECTED DCB INTO THE USER'S DCB CORE.                              43960002
*                                                                       43970002
*                                                                       43974002
*                                                                       43978002
         IECRES  INIT,DCBCOPY=FRWKAR,STM=(R0,R14,WTGPREFX)       Y02072 43980002
*                                                                       43990002
         OI    DXATEXC1,FCAOCOPY        SET AUDIT TRAIL BIT      Y02072 43994002
*                                       FOR FORCE CLOSE CLEANUP  Y02072 43996002
*                                       INDICATING DCB COPIED    Y02072 43998002
         MVI   NULL(RWTGC),NULL         SET THIS DCB COMPLETE    Y02072 44000002
*                                                                       44100019
SCAN4EQ  EQU   *                                                        44500019
*                                                                       44600019
         LA    RWTGC,WGOFF(RWTGC)  INCREMENT W-T-G INDEX AND            44700019
         LA    RPARC,PAROFF(RPARC) PARAMETER LIST INDEX                 44800019
         CLC   NULL(TWO,RWTGC),AMIDCNST IS THIS EXECUTOR NEEDED AGAIN   44900019
         BCR   YES,RBASE           YES,RETURN TO STARTING POINT         45000019
         CLC   NULL(TWO,RWTGC),OPIDCNST IS THIS END OF W-T-G TABLE      45100019
         BNE   SCAN4EQ             NO,CONTINUE SCAN                     45200019
*                                                                       45300019
*   YES - DETERMINE ANY MORE DCB                                        45400019
*                                                                       45500019
         LR    RPARC,RPAR          RESET PARM LIST INDEX AND            45600019
         LA    RWTGC,MSK32(RWTG)   W-T-G INDEX TO ENTRY ONE             45700019
*                                                                       45800019
SCAN4ANY EQU   *                                                        45900019
*                                                                       46000019
         CLI   NULL(RWTGC),NULL    IS THIS DCB COMPLETE                 46100019
         BNE   XCTLRTN             NO,XCTL TO NAMED EXECUTOR            46200019
*                                                                       46300019
         LA    RWTGC,WGOFF(RWTGC)  YES,INCREMENT CURRENT ENTRY REG.     46400019
         LA    RPARC,PAROFF(RPARC) INCREMENT CURRENT PARM LIST REG.     46500019
         B     SCAN4ANY            REPEAT SCAN                          46600019
*                                                                       46700019
XCTLRTN  EQU   *                                                        46800019
*                                                                       46900019
*   XCTL TO NEXT EXECUTOR                                               47000019
*                                                                       47100019
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*47160003
               MODID=WTGENTRY           GO TO NEXT MODULE      @Z30TSMI 47210003
*                                                                       47700019
*                                                                       47800019
*                                                                       47802020
* ROTATIONAL POSITION SENSING EQUATES                                   47804002
*                                                                       47806020
*                                                                       47810020
HALFCCW  EQU   4                        SIZE OF A HALF CCW       S20201 47812020
D6       EQU   6                        OFFSET IN JFCB FOR RPS   S20201 47814020
CNTOFF   EQU   7                        OFFSET TO COUNT IN CCW   S20201 47816020
CARN8    EQU   8                        FOR UPDATING CCW         S20201 47818020
*                                       POINTERS                 S20201 47820020
CARN24   EQU   24                       TO POINT ACROSS THREE    S20201 47822020
*                                       CCWS                     S20201 47824020
CARN28   EQU   28                       TO POINT ACROSS 3.5 CCWS S20201 47826020
CARN80   EQU   80                       IOB OFFSET WITH SECTOR   S20201 47828020
*                                       ADDR                     S20201 47830020
NCCW5OFF EQU   104                      NON REC REDY OFFSET PT   S20201 47832020
*                                       TO CCW5                  S20201 47834020
CCCW5OFF EQU   104                      REC REDY                 S20201 47836020
CCCW7OFF EQU   120                      REC REDY OFFSET PT TO    S20201 47838020
*                                       CCW7                     S20201 47840020
CCCW8OFF EQU   128                      OFFSET TO CCW8           S20201 47842020
NCCWAOFF EQU   144                      OFFSET TO CCW10          S20201 47844020
CCCWBOFF EQU   152                      OFFSET TO CCW11          S20201 47846020
NCCWDOFF EQU   168                      NON REC REDY OFFSET PT   S20201 47848020
*                                       TO CCW1                  S20201 47850020
CCCWEOFF EQU   176                      REC REDY OFFSET TO CCW14 S20201 47852020
CCCWXOFF EQU   208                      REC REDY OFFSET PT TO    S20201 47854020
*                                       CCW18                    S20201 47856020
*                                                                       47858020
*                                                                       47860020
TICCODE  EQU   X'08'                    TIC OP CODE              S20201 47862020
NONCARN  EQU   X'20'                    NON REC REDY CHECK       S20201 47864020
SETSECT  EQU   X'23'                    SET SECTOR COMMAND CODE  S20201 47866020
RDSECT   EQU   X'22'                    READ SECTOR COMMAND CODE S20201 47868020
*                                                                       47870020
CARSHIFT EQU   32                       FIRST FOUR CCWS -NO      S20201 47872020
*                                       CARNIVAL                 S20201 47874020
*                                                                       47876020
*                                                                       47878020
*                                                                       47880020
*                                                                       47882020
*         CONSTANTS                                                     47884002
*                                                                       47886020
*********************************************************************** 47900019
*                                                                       48000019
CCHNCARN DC    X'40000001'              FLAG/COUNT FIELD         S20201 48050002
CCHN5TIC DC    X'4000000508'       COMMAND CHAIN,CNT=5,TIC COM.CODE     48100019
*                                                                       48200019
CONST8   DC    H'8'                CONSTANT = '8'                       48300019
CONST10  DC    H'10'               CONSTANT = '10'                      48400019
*                                                                       48500019
MODID    DC    CL6'IGG019'              MODULE ID                Y02072 48550002
AMIDCNST DC    C'9L'                    THIS EXECUTOR'S ID              48600002
OPIDCNST DC    C'0S'                    LAST LOAD OF OPEN'S ID          48700002
IDNEXT   DC    C'0S'                    NEXT LOAD OF OPEN-ID     Y02072 48750002
PATCH    DC    XL((*-IGG0199L)/20)'0'   5% PATCH AREA            Y02072 48800002
         EJECT                                                          50400019
*                                                                       50500019
*************** CONTROL BLOCK DEFINITIONS                               50600019
*                                                                       50700019
*********************************************************************** 50800019
         CVT    DSECT=YES                                        Y02072 51100002
*                                                                       51200019
         SPACE 2                                                        51300019
*********************************************************************** 51400019
*                                                                       51500019
         DCBD  DSORG=(PS),DEVD=(DA)                                     51600019
*                                                                       51700019
*********************************************************************** 51900019
         EJECT                                                          51950002
         IECDSECS (MAIN,(IOB,NO)),PREFX,WTG,EXPAND=YES           Y02072 52050402
FORCORE  DSECT                     WORKAREA DSECT CONTINUED      Y02072 52050502
*****    THE FOLLOWING ARE AUDIT TRAIL BITS SET FOR FORCE CLOSE   ***** 52052902
         IHAFCAUD  ORG=YES                                       Y02072 52053302
         EJECT                                                          52060402
         IEZIOB                                                  Y02072 52062802
*********************************************************************** 52065202
*   THE FOLLOWING DSECT FORMATS THE BDAM CREATE EXTENSION TO THE IOB  * 52067602
*********************************************************************** 52070002
         ORG   IOBSEEK+8                                         Y02072 52100002
IOBDNRCF DS    D         NEW RECORD COUNT FIELD                         53600019
IOBR0CNT DS    D         COUNT FIELD OF R0                              53700019
IOBR0DAT DS    D         DATA FIELD OF R0                               53800019
IOBCCW1  DS    D         FIRST CCW OF CHANNEL PROGRAM                   53900019
IOBCCW2  DS    D         2ND CCW OF CHANNEL PROGRAM                     54000019
IOBCCW3  DS    D         3RD CCW OF CHANNEL PROGRAM                     54100019
IOBCCW4  DS    D         4TH CCW OF CHANNEL PROGRAM                     54200019
IOBCCW5  DS    D         5TH CCW OF CHANNEL PROGRAM                     54300019
IOBCCW6  DS    D         6TH CCW OF CHANNEL PROGRAM                     54400019
IOBCCW7  DS    D         7TH CCW OF CHANNEL PROGRAM                     54500019
IOBCCW8  DS    D         8TH CCW OF CHANNEL PROGRAM                     54600019
IOBCCW9  DS    D         9TH CCW OF CHANNEL PROGRAM                     54700019
IOBCCW10 DS    D         10TH CCW OF CHANNEL PROGRAM                    54800019
IOBCCW11 DS    D         11TH CCW OF CHANNEL PROGRAM                    54900019
IOBCCW12 DS    D         12TH CCW OF CHANNEL PROGRAM                    55000019
IOBCCW13 DS    D         13TH CCW OF CHANNEL PROGRAM                    55100019
IOBCCW14 DS    D         LAST CCW OF LONGEST CHANNEL PROGRAM            55200019
*                                                                       55300019
*********************************************************************** 55500019
         EJECT                                                          55550002
         IEZDEB                                                  Y02072 55650002
         EJECT                                                          55700002
         IGGSWA                                                  Y02072 60150002
         IHADVCT                                                 Y02072 60200002
         END                                                            64900019
./  ADD  SSI=81710035,NAME=IGG0203A
         TITLE 'IGG0203A - BDAM CLOSE EXECUTOR'                         00020000
IGG0203A CSECT                                                          00040000
*********************************************************************** 00050002
*                                                                     * 00060002
*  MODULE NAME = IGG0203A                                             * 00070002
*                                                                     * 00072002
*  DESCRIPTIVE NAME = BDAM CLOSE EXECUTOR                             * 00074002
*                                                                     * 00074402
*  COPYRIGHT = NONE                                                   * 00074802
*                                                                     * 00075202
*  STATUS RELEASE VS2-2 LEVEL 0                                       * 00075602
*                                                                     * 00075702
*                                                                     * 00075802
*  FUNCTION/OPERATION = THIS MODULE RECEIVES CONTROL DURING THE CLOSE * 00075902
*   OF A BDAM DATA SET AND WILL PURGE ALL I/O REQUESTS WHICH WERE IN  * 00100002
*   PROCESS AT THE TIME CLOSE WAS EXECUTED, FREE ANY IOBS THAT WERE   * 00110002
*   OBTAINED DURING PROCESSING, AND FREE BUFFERS IF THE DYNAMIC       * 00120002
*   BUFFER OPTION WAS USED. IT WILL FREE THE SEGMENT WORK AREA POOL IF* 00120402
*   VARIABLE SPANNED WAS SPECIFIED WITHOUT DYNAMIC BUFFERING. IT WILL * 00120502
*   DEQ ALL ENTRIES IN THE READX LIST AND FREE THE SEGMENTS.          * 00120602
*   AS EACH OPERATION IS COMPLETED AUDIT TRAIL BITS ARE SET TO INDI-  * 00120702
*   CATE THAT EITHER THE OPERATION COMPLETED SUCCESSFULLY OR THAT IT  * 00121402
*   WAS NOT NECESSARY. THESE BITS SERVE ONLY TO INFORM THE USER OF THE* 00123402
*   STATUS OF HIS DATA SET AND THE DISPOSITION OF RESOURCES USED BY IT* 00125402
*   BEFORE RETURNING TO COMMON CLOSE, A BRANCH IS MADE TO THE O/C/E   * 00125502
*   RESIDENT ROUTINE TO COPY THE DCB FROM THE CLOSE WORKAREA INTO     * 00125602
*   THE USER'S DCB CORE.                                              * 00125702
*                                                                     * 00125802
*  NOTES = THE MODULE IS ENTERED IN DATA MANAGEMENT KEY. ALL DEQS,    * 00126502
*   PURGE PROCESSING AND XCTL ARE IN DATA MANAGEMENT KEY.  IOBS       * 00127202
*   AND BUFFERS ARE FREED IN USER KEY.                                * 00127902
*                                                                     * 00128602
*   THIS MODULE WILL BE ENTERED BY THE FORCE CLOSE EXECUTOR DURING    * 00129002
*   ABEND PROCESSING, SHOULD THE ABEND OCCUR DURING OPEN, AFTER THE   * 00129102
*   DCB HAS BEEN COPIED BACK. PROCESSING IS THE SAME UNDER BOTH       * 00129202
*   NORMAL AND ABEND CONDITIONS.                                      * 00129502
*                                                                     * 00129902
*     DEPENDENCIES = NONE                                             * 00130102
*                                                                     * 00130402
*     DATA AREAS = NONE                                               * 00130702
*                                                                     * 00131402
*     RESTRICTIONS = NONE                                             * 00132102
*                                                                     * 00132802
*     REGISTER CONVENTIONS = SEE REGISTER EQUATES BELOW               * 00133502
*                                                                     * 00134202
*     PATCH LABEL = NONE                                              * 00134902
*                                                                     * 00135602
*                                                                     * 00136302
*  MODULE TYPE = CLOSE EXECUTOR                                       * 00137002
*                                                                     * 00137702
*     PROCESSOR = ASSEMBLER XF                                        * 00138402
*                                                                     * 00139102
*     MODULE SIZE = 920 DECIMAL BYTES                                 * 00139802
*                                                                     * 00140502
*     ATTRIBUTES = REENTRANT,ENABLED,PRIVILEGED, ENTERED IN DATA      * 00141202
*       MANAGEMENT KEY. MODESET IS ISSUED TO DO SOME PROCESSING IN    * 00141902
*       USER KEY.                                                     * 00142602
*                                                                     * 00143302
*                                                                     * 00144002
*  ENTRY POINT = 'START'                                              * 00144702
*                                                                     * 00145402
*     PURPOSE = SEE FUNCTION                                          * 00146102
*                                                                     * 00146802
*     LINKAGE = THIS MODULE RECEIVES CONTROL EITHER FROM COMMON CLOSE * 00147502
*       OR ANOTHER EXECUTOR WHEN ITS ID APPEARS AS THE NEXT NON-ZERO  * 00148202
*       ENTRY IN THE WTG TABLE. IT MAY ALSO RECEIVE CONTROL FROM      * 00148902
*       THE FORCE CLOSE EXECUTOR IF AN ABEND OCCURRED DURING OPEN.    * 00149302
*                                                                     * 00151302
*     INPUT - INPUTS TO THIS ROUTINE ARE                              * 00153302
*        REGISTER 5 - BEGINNING OF THE DCB PARAMETER LIST             * 00155302
*        REGISTER 6 - BEGINNING OF THE WHERE-TO-GO TABLE (WTG)        * 00157302
*        REGISTER 7 - BEGINNING OF THE CURRENT ENTRY IN THE DCB       * 00157402
*                     PARAMETER LIST                                  * 00170402
*        REGISTER 8 - ADDRESS OF THE CURRENT ENTRY IN THE WTG         * 00180402
*                                                                     * 00182402
*        OPEN WORKAREA - CONTAINS DCB COPY, PARM LIST, WORKAREA,      * 00182802
*          USER DCB ADDRESS AND KEY, FORCE CLOSE EXEC ADDRESS,        * 00183202
*          WTG TABLE AND AUDIT CONTROL BYTES.                         * 00183602
*                                                                     * 00183702
*                                                                     * 00183802
*     OUTPUT = THIS ROUTINE XCTLS TO COMMON CLOSE. REGISTERS 5 AND 6  * 00184002
*        ARE LEFT UNCHANGED. REGISTERS 7 AND 8 ARE POSITIONED TO      * 00197002
*        THE NEXT UNCOMPLETED ENTRY IN THE PARM LIST AND WTG TABLE.   * 00210002
*                                                                     * 00223002
*           CONTROL BLOCKS/DATA AREAS FREED:                          * 00236002
*                          USL/BCB INCLUDING BUFFERS                  * 00249002
*                          SWA INCLUDING BUFFERS                      * 00262002
*                          READ EXCLUSIVE LIST                        * 00275002
*                          ALL IOBS IN IOB POOL AND UNPOSTED QUEUE    * 00288002
*                                                                     * 00301002
*           ALL ENTRIES IN THE READX LIST WILL HAVE BEEN DEQUEUED;    * 00314002
*           DCB WILL HAVE BEEN RETURNED TO PREOPEN STATE              * 00327002
*                                                                     * 00340002
*     EXIT-NORMAL = XCTL BACK TO COMMON CLOSE IF SCAN OF THE WTG TABLE* 00353002
*        DOES NOT FIND A NON-ZERO ENTRY. OTHERWISE AN XCTL IS MADE    * 00366002
*        TO THE FIRST NON-ZERO ENTRY IN THE TABLE.                    * 00379002
*                                                                     * 00392002
*     EXIT-ABNORMAL = NONE                                            * 00405002
*                                                                     * 00418002
*                                                                     * 00431002
*  EXTERNAL REFERENCES = NONE                                         * 00444002
*                                                                     * 00457002
*     ROUTINES:  PURGE(SVC 16) TO PURGE OUTSTANDING I/0               * 00470002
*                FREEMAIN(SVC 10) IS CALLED TO FREE IOBS, READX LIST, * 00483002
*                          SWAS AND BUFFERS                           * 00496002
*                DEQ(SVC 48) IS CALLED TO DEQ ALL BLOCKS ON READX LIST* 00509002
*                XCTL(SVC 7) IS CALLED TO PASS CONTROL                * 00522002
*                IECRES - O/C/EOV RESIDENT RTN FOR DCB COPYBACK       * 00532002
*                                                                     * 00535002
*                                                                     * 00548002
*  TABLES/WORK AREAS- 1.DCB PARAMETER LIST IS THE ADDRESS OF EACH DCB * 00561002
*   SPECIFIED IN THE CLOSE MACRO INSTRUCTION. THE HI-ORDER BYTE       * 00574002
*   CONTAINS A CODE INDICATING THE MODE .                             * 00587002
*   2.WHERE-TO-GO TABLE CONTAINS THE ID AND TTR OF THE ROUTINE WHICH  * 00600002
*   IS TO PROCESS THE CORRESPONDING DCB AND THE ADDRESS OF A WORK AREA* 00613002
*   ASSIGNED TO THAT DCB.                                             * 00626002
*   3.WORK AREA IS A TEMPORARY AREA IN SP230 USED BY THIS ROUTINE     * 00639002
*   AS A WORKAREA FOR THE PURGE PARAMETER LIST. THE COPY OF THE DCB   * 00652002
*   IN THIS WORKAREA IS REFERENCED THROUGHOUT. INFORMATION CONCERNING * 00665002
*   USER KEY AND DCB LENGTHS ARE ALSO KEPT IN THE WORKAREA.           * 00678002
*                                                                     * 00691002
*                                                                     * 00704002
*  MACROS = FREEMAIN, MODESET, XCTL, DEQ, PURGE, WAIT, IECRES         * 00717002
*                                                                     * 00730002
*                                                                     * 00743002
*                                                                     * 00756002
*  CHANGE ACTIVITY = AS FOLLOWS:                                      * 00769002
*                                                                     * 00782002
*                    OS 21 DELETIONS/CHANGES                          * 00795002
*2964053800-054550                                               A40558 00808002
*2964037300,043600-043800                                        M0045  00821002
*2964036400-037200                                               A35821 00834002
*2964009800,036600,041600,085400-091000,091200                   A35339 00847002
*                    VS1-1 DELETIONS/CHANGES                          * 00860002
*                    VS1-2 DELETIONS/CHANGES                          * 00873002
*                    VS1-3 DELETIONS/CHANGES                          * 00886002
*                    VS2-1 DELETIONS/CHANGES                          * 00899002
*                    VS2-2 DELETIONS/CHANGES                          * 00912002
*000300-000350,017100,017300-017360,020735-020737,023120-026900,024600, 00925002
*032800,033552,036420,036520-036580,038200,039400-039900,044000,051300, 00938002
*053000,056000-062120,064800-065200,067644-067648,074900         Y02072 00951002
*                                                                YM1103 00961002
*                                                                YM1190 00963002
*                                                                YM3242 00963402
*                    UPDATES SUBSEQUENT TO VS2-3                      * 00963637
*C043807                                                        ZA09624 00963837
*C049361                                                        ZA09656 00963937
*C033383,033390,A073510                                        @ZA12264 00964037
*D055200-055220,A055054-055184,055240,063404-063406            @ZA11614 00967037
*                    UPDATES SINCE VS2-3.7                            * 00967737
*A027904-027924,A027944                                        @ZA21099 00968437
*C055120-055124,C055128-055130,C055134,C055153,A055132,        @ZA28352 00969237
*A055141-055148,A063405                                        @ZA28352 00969537
*********************************************************************** 00970137
         EJECT                                                          00977002
*********************************************************************** 00990002
*                         REGISTER USAGE                              * 01020002
*********************************************************************** 01030002
RPARM0   EQU   0         PARM PASSED TO FREEMAIN WITH LENGTH            01090002
R0       EQU   0         PARM REG TO SAVE ALL REGS               YM1190 01100002
RBUF     EQU   1         BASE REGISTER FOR BUFFER CNTRL BLK             01120002
RPARM1   EQU   1         PARM PASSED TO FREEMAIN, PURGE AND WAIT        01132002
RDEQWORK EQU   1         WORK REG FOR DEQ PROCESSING                    01134002
RDCB     EQU   2         USER'S DCB ADDRESS                             01140000
RBASE    EQU   3         BASE REGISTER                                  01160000
RCORE    EQU   4         WORK AREA ADDRESS                              01180000
RPAR     EQU   5         PARAMETER LIST ADDRESS                         01200000
RCVT     EQU   5         CVT ADDRESS                           @ZA28352 01206037
RES      EQU   5         ADDRESS OF O/C/EOV RES RTN            @ZA28352 01212037
RWTG     EQU   6         BEGINNING OF WTG                               01220000
RDXWORK  EQU   6         BASE REG FOR RDXENTRY AND RDX WORK REG         01230002
RPARC    EQU   7         CURRENT ENTRY IN PARAMETER LIST                01240000
RWORKK   EQU   7         WORK REG-SAVES RDXLIST ADDR BET RTNS    Y02072 01242002
RWTGC    EQU   8         CURRENT ENTRY IN WTG                           01244002
RWORKC   EQU   9         WORK REGISTER                                  01250002
RDXLST1  EQU   9         POINTER TO NEXT READX LIST                     01252002
RUSL     EQU   10        PTR TO UNSCHEDULED LIST                        01270002
RDXLST   EQU   10        BASE FOR READX LIST                            01280002
RIOB     EQU   11        BASE FOR IOB DSECT                             01290002
RDEB     EQU   11        BASE FOR DEB DSECT                             01292002
RWORKA   EQU   11        WORK REGISTER, ALSO WORKREG FOR MODESET Y02072 01302002
RWORKB   EQU   11        WORK REGISTER                         @ZA11614 01304037
RDEQ     EQU   11        BASE REGISTER FOR DEQ PARM LIST                01304637
RWORKD   EQU   12        WORK REGISTER                         @ZA11614 01305237
RWORKE   EQU   12        WORK REG -EVEN REG IN ARITH OPERATIONS         01306002
RNUMENT  EQU   12        CTR FOR NUMBER OF READX ENTRIES                01308002
RIOB2    EQU   13        NEXT IOB POINTER                               01310002
RWORKO   EQU   13        WORK REG -ODD REG IN ARITH OPERATIONS          01310402
RUSLSLOT EQU   13        BASE REGISTER FOR USLSLOT                      01312002
RWORKF   EQU   14        WORK REGISTER                                  01320002
RETURN   EQU   14        RETURN REGISTER FROM SUBROUTINES               01330002
RWORKJ   EQU   15        WORK REGISTER                                  01340002
RTCB     EQU   15        BASE REG FOR TCB                               01350002
R15      EQU   15        PARM REG FOR XCTL AND SAVE                     01400002
*********************************************************************** 01590002
         EJECT                                                          01600002
*********************************************************************** 01610002
*                   INITIALIZATION OF REGISTERS                       * 01612002
*********************************************************************** 01614002
START    EQU   *                        PRIMARY ENTRY POINT             01640002
         BALR  RBASE,0                  SET BASE REGISTER               01642002
         USING *,RBASE                  ESTABLISH BASE FOR THIS MOD     01644002
         USING WTG,RWTG                 ESTABLISH BASE FOR WHERE-TO-GO  01650002
         USING WTGENTRY,RWTGC           ESTABLISH BASE FOR CURRENT ENT  01652002
         USING PARML,RPARC              ESTABLISH BASE FOR PARM LIST    01654002
         L     RDCB,PARDCBAD            LOAD DCB ADDRESS                01660002
         USING IHADCB,RDCB              ESTABLISH BASE FOR DCB          01670002
         DROP  RPARC                                                    01672002
         L     RCORE,WTGDCBWA           LOAD WORK AREA ADDRESS          01680002
         USING FORCORE,RCORE            ESTABLISH BASE FOR CLOSE WKAREA 01690002
         DROP  RWTG                                                     01692002
         SPACE 2                                                        01694002
*********************************************************************** 01700002
*  THE FOLLOWING ROUTINE BUILDS THE PURGE LIST IN THE CLOSE WORKAREA  * 01702002
*  AND PURGES ALL OUTSTANDING I/O REQUESTS ASSOCIATED WITH THE DEB.   * 01704002
*********************************************************************** 01706002
         LA    RPARM1,DXCCW6            LOAD ADDR OF PURGE LIST  Y02072 01716002
         USING PPL,RPARM1               EST BASE FOR PARM LIST   Y02072 01718002
         L     RDEB,DCBDEBAD            LOAD ADDRESS OF DEB             01720002
         USING DEBBASIC,RDEB            ESTABLISH BASE FOR DEB          01738002
         ST    RDEB,PPLDSID             STORE INTO PURGE LIST    Y02072 01740002
         MVI   PPLOPT1,PPLDS+PPLHIO     SET PURGE CODE           Y02072 01760002
         LA    RWORKJ,DEBUSRPG          LOAD ADDR OF PURGE CHAIN FIELD  01780002
         ST    RWORKJ,PPLPIRL           AND STORE INTO PURGE BLK Y02072 01800002
         SR    RWORKJ,RWORKJ            STORE ZEROS IN THE ECB PORTION  01820002
         ST    RWORKJ,PPLCC             OF THE PURGE BLOCK       Y02072 01840002
         DROP  RPARM1                   PURGE DESTROYS R1        Y02072 01850002
*                                                                       01880000
         PURGE (1)                      PURGE ANY OUTSTANDING I/O       01900002
*                                                                       01920000
         LA    RPARM1,DXCCW6            LOAD ADDR OF PURGE LIST  Y02072 01930002
         USING PPL,RPARM1               EST BASE FOR PARM LIST   Y02072 01932002
         LA    RPARM1,PPLCC             LOAD WAIT PARAMETER ADDR Y02072 01940002
         DROP  RPARM1                                            Y02072 01950002
         WAIT  ECB=(1)                  WAIT FOR PURGE TO COMPLETE      01960002
         OI    DXATEXC2+1,FCACPURG      SET AUDIT TRAIL INDICA-  Y02072 01962002
*                                       TING PURGED I/O          Y02072 01964002
         DROP  RDEB                                                     01970002
         SPACE 2                                                        01972002
*********************************************************************** 01980002
*  THE FOLLOWING ROUTINE BUILDS A DEQ LIST, USING THE AVT AS A WORK   * 01990002
*  AREA, AND DEQUEUES EACH ENTRY IN THE READX LIST SEGMENTS,IF THE DCB* 02000002
*  SPECIFIED EXCLUSIVE CONTROL.THE READX LIST PTR IS DEBXXARG IN THE  * 02018002
*  DEB EXTENSION. THE NEXT SEGMENT POINTER IS IN FIELD RDXNEXT IN THE * 02018402
*  READX LIST. THIS ROUTINE EXECUTES IN DATA MANAGEMENT KEY.          * 02018802
*********************************************************************** 02019702
DEQRDX   TM    DCBOPTCD,DCBOPTRE        IS THERE AN EXCLUSIVE CONTROL   02019802
         BZ    IOBPOOL                  LIST? BRANCH IF NO.      Y02072 02019902
         L     RDEB,DCBDEBAD            ADDRESS OF DEB                  02029902
         USING DEBBASIC,RDEB            ESTABLISH BASE FOR DEB          02039902
         L     RDEQ,DEBAPPAD            ADDR OF APPENDAGE VECTOR LIST   02043202
*                                       WHICH WILL BE USED FOR DEQ PARM 02045202
         DROP  RDEB                                              A35821 02045602
*                                                                       02046002
*   GET ADDRESS OF READ EXCLUSIVE LIST, FOUND IN DEB EXTENSION          02046402
*                                                                       02046502
         USING DEBAVT,RDEQ              ESTABLISH BASE FOR AVT   Y02072 02046602
         L     RDXLST1,DEBXTNP          GET ADDR OF DEB EXT      Y02072 02054902
         DROP  RDEQ                                              Y02072 02056902
         USING DEBXTN,RDXLST1           ESTABLISH BASE FOR EXT   Y02072 02058902
         L     RDXLST1,DEBXXARG         GET ADDR OF READX LIST   Y02072 02060902
         DROP  RDXLST1                                           Y02072 02062902
         USING DEQAREA,RDEQ             ESTABLISH BASE FOR DEQ PARM LST 02072602
         STM   RWTG,RPARC,DEQREGSV      SAVE REGS IN DEQ WORKAREA       02073002
         LR    RWORKK,RDXLST1           SAVE PTR TO RDXLIST FOR  Y02072 02073102
*                                       NEXT ROUTINE (FREEQIOB)  Y02072 02073202
         MVC   DEQFLAG,LISTDEQ          MOVE DEQ LIST TO DEBAVT  Y02072 02073402
*                                                                       02073802
*        POSITION TO NEXT ENTRY IN READ EXCLUSIVE LIST                  02073902
*                                                                       02074002
FIXPTR   LA    RDXLST,0(RDXLST1)        CLEAR HI-ORDER BYTE      Y02072 02075502
         LTR   RDXLST,RDXLST            LOAD AND TST SEGMENT PTR Y02072 02077502
         USING RDXLIST,RDXLST           ESTABLISH BASE FOR RDXLIST      02077902
         BZ    IOBPOOL                  BRANCH IF NO SEGMENTS    Y02072 02078302
         L     RDXLST1,RDXNEXT          GET NEXT SEGMENT POINTER        02078402
         LA    RNUMENT,RDXMAXCT         NUMBER OF READX LIST SLOTS      02079302
         LA    RDXWORK,RDXENT           STEP POINTER TO FIRST SLOT      02083302
         USING RDXENTRY,RDXWORK         ESTABLISH BASE FOR RDXENTRY     02085302
DLOOP    EQU   *                        DEQ EACH ENTRY IN READX LIST    02087302
         CLC   RDXNQARG,ZEROS           IS THIS SLOT EMPTY       Y02072 02087702
         BE    STPIDX                   BRANCH IF YES                   02087802
*                                                                       02101902
*        DEQ THE CURRENT ENTRY IN THE READ EXCLUSIVE LIST               02102402
*                                                                       02102802
DEQENTRY EQU   *                        DEQ CURRENT READX ENTRY  Y02072 02103202
*                                                                       02115102
         DEQ   (SYSNM,(RDXWORK)),MF=(E,(RDEQ)) DEQ READX ENTRY   Y02072 02115502
*                                                                       02115702
         XC    RDXNQARG,RDXNQARG        CLEAR OUT THIS SLOT      Y02072 02115802
*                                                                       02115902
STPIDX   EQU   *                        POSITION TO NEXT ENTRY   Y02072 02119602
         LA    RDXWORK,RDXENTLN(RDXWORK) UP POINTER TO NEXT SLOT Y02072 02119702
         BCT   RNUMENT,DLOOP            BRANCH IF MORE SLOTS            02119802
         B     FIXPTR                   BR BACK TO PROCESS NEXT SEGMENT 02129602
*                                                                       02130002
         DROP  RDXLST,RDEQ,RDXWORK                                      02132002
         SPACE 2                                                        02132402
*********************************************************************** 02133702
*  THE FOLLOWING ROUTINE FREES IOBS ON THE AVAILABLE POOL.   STARTING * 02134102
*  WITH THE IOB POINTED TO BY DCBIOBAD, THE IOB CHAIN IS SEARCHED FOR * 02134802
*  ALL IOBS FLAGGED AS AVAILABLE. EACH IOB IS CHAINED TO THE NEXT     * 02136802
*  THROUGH THE IOBDPLAD FIELD. IT IS ENTERED IN DATA MANAGEMENT KEY.  * 02137402
*  EXIT FROM THIS ROUTINE IS IN USER KEY.                             * 02139802
*********************************************************************** 02140202
IOBPOOL  EQU   *                        FREE IOBS IN IOB POOL    Y02072 02140302
         OI    DXATEXC2+1,FCACDEQ       SET AUDIT TRAIL INDICA-  Y02072 02140402
*                                       TING ALL ENTRIES ON      Y02072 02151702
*                                       READX LIST ARE DEQUEUED  Y02072 02161702
         L     RIOB2,DCBIOBAD           LOAD IOB POOL POINTER FROM DCB  02168902
*                                                                       02180202
         MODESET  KEYADDR=DXUKEY,WORKREG=11  CHANGE TO USER KEY  Y02072 02191502
*                                                                       02202802
ZEROCHK  LA    RIOB,0(RIOB2)            CLEAR HI-ORDER BYTE - MAKE NEXT 02214102
*                                       IOB THE CURRENT IOB             02225402
         USING IOBSTDRD,RIOB            ESTABLISH BASE FOR IOB DSECT    02236702
         LTR   RIOB,RIOB                IS IOB POOL POINTER ZERO        02248002
         BZ    FREEQIOB                 YES, GO CHECK READX LIST Y02072 02259302
         L     RIOB2,IOBDPLAD           LOAD ADDRESS OF NEXT IOB        02270602
         CLI   IOBDAYLI,AVAIL           IS CURRENT IOB AVAILABLE        02281902
         BE    CHKNEXT                  NO, GO CHECK NEXT IOB           02293202
         BAL   RETURN,FREEIOB           YES, GO FREE CURRENT IOB        02304502
         DROP  RIOB                                                     02315802
CHKNEXT  EQU   *                        GO TO CHECK NEXT IOB     Y02072 02327102
         B     ZEROCHK                  GO TO CHECK NEXT IOB            02338402
         SPACE 2                                                        02349702
*********************************************************************** 02361002
*  IOBS WAITING ON THE UNPOSTED QUEUES ASSOCIATED WITH EACH ENTRY IN  * 02372302
*  THE READ EXCLUSIVE LIST ARE FREED. WHEN ALL IOBS HAVE BEEN FREED   * 02383602
*  FOR THAT SEGMENT, THAT SEGMENT IS FREED AND THE NEXT, IF THERE IS  * 02394902
*  ONE, IS PROCESSED. THE READX LIST PTR IS AT DEBXXARG IN THE DEB    * 02406202
*  EXTENSION. THE NEXT SEGMENT POINTER IS IN FIELD RDXNEXT IN THE     * 02417502
*  READX LIST. THIS ROUTINE IS ENTERED IN USER KEY. IOBS ARE FREED    * 02428802
*  AND EXIT FROM THIS ROUTINE IS IN USER KEY.                         * 02440102
*********************************************************************** 02451402
FREEQIOB EQU   *                        FREE IOBS ON UNPOSTED Q  Y02072 02462702
*                                                                       02472702
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 02473102
*                                                                       02473502
         OI    DXATEXC2+1,FCACIOBP      SET AUDIT TRAIL INDICA-  Y02072 02473902
*                                       TING ALL AVAILABLE IOBS  Y02072 02477702
*                                       IN IOB POOL ARE FREED    Y02072 02479702
*                                                                       02480102
         MODESET  KEYADDR=DXUKEY,WORKREG=9  RETURN TO USER KEY   Y02072 02480502
*                                                                       02480902
         TM    DCBOPTCD,DCBOPTRE        IS EXCL CONTROL OPTION   Y02072 02481502
         BZ    BUFCHK                   NO, GO CHECK BUFFERS     Y02072 02485302
         LR    RDXLST1,RWORKK           RDXLST PTR SAVED BY DEQ  Y02072 02496602
*                                                                       02507902
*        POSITION TO NEXT ENTRY IN READ EXCLUSIVE LIST                  02519202
*                                                                       02530502
LISTPTR  LA    RDXLST,0(RDXLST1)        CLEAR HI-ORDER BYTE             02541802
         LTR   RDXLST,RDXLST            LOAD AND TEST SEGMENT POINTER   02553102
         USING RDXLIST,RDXLST           ESTABLISH BASE FOR RDXLIST      02564402
         BZ    RESTREGS                 BRANCH IF NO SEGMENTS    Y02072 02575702
         L     RDXLST1,RDXNEXT          GET NEXT SEGMENT POINTER        02587002
         LA    RNUMENT,RDXMAXCT         NUMBER OF READX LIST SLOTS      02598302
         LA    RDXWORK,RDXENT           STEP POINTER TO FIRST SLOT      02609602
         USING RDXENTRY,RDXWORK         ESTABLISH BASE FOR RDXENTRY     02620902
*                                                                       02632202
*  THE FOLLOWING ROUTINE FREES IOBS ON THE UNPOSTED QUEUE. THESE IOBS * 02643502
*  ARE WAITING FOR EXCLUSIVE CONTROL OF THE CURRENT ENTRY IN THE      * 02654802
*  READ EXCLUSIVE LIST.                                               * 02666102
*                                                                       02677402
*                                                                       02688702
UNPCHK   L     RIOB2,RDXIOBUQ           GET 1ST IOB WAITING      Y02072 02700002
*                                       FOR THIS ENTRY IN LIST   Y02072 02711302
TZERO4   LA    RIOB,0(RIOB2)            MAKE NEXT IOB CURRENT IOB       02722602
         LTR   RIOB,RIOB                ANY IOBS ON QUEUE               02733902
         BZ    GOTONEXT                 NO, GO TO NEXT ENTRY     Y02072 02745202
         USING IOBSTDRD,RIOB            ESTABLISH IOB BASE       Y02072 02756502
         L     RIOB2,IOBDQPTR           LOAD NEXT IOB ADDRESS           02767802
         DROP  RIOB                                              Y02072 02779102
         MODESET  EXTKEY=DATAMGT        CHG TO DATA MGT KEY    @ZA21099 02790437
         ST    RNUMENT,RDXRSV01         SAVE REGISTER          @ZA21099 02791437
         MODESET  KEYADDR=DXUKEY,WORKREG=11  BACK TO USER KEY  @ZA21099 02792437
         BAL   RETURN,FREEIOB           GO TO FREE THIS IOB             02793437
         L     RNUMENT,RDXRSV01         RESTORE REGISTER       @ZA21099 02794437
         B     TZERO4                   GO TEST FOR END OF QUEUE        02801702
*                                                                       02813002
*     WHEN 9 SLOTS HAVE BEEN INVESTIGATED, FREE THIS SEGMENT            02824302
*                                                                       02835602
GOTONEXT EQU   *                        POSITION TO NEXT ENTRY   Y02072 02846902
         LA    RDXWORK,RDXENTLN(RDXWORK) UP POINTER TO NEXT SLOT Y02072 02858202
         BCT   RNUMENT,UNPCHK           BRANCH IF MORE SLOTS     Y02072 02869502
*                                                                       02880802
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 02892102
*                                                                       02903402
         LA    RPARM0,SP230             PICK UP SUBPOOL NUMBER   Y02072 02914702
         SLL   RPARM0,24                MV SP NUMBER TO TOP BYTE        02926002
         LA    RWORKF,RDXLSTLG          PICK UP LIST SIZE               02937302
         OR    RPARM0,RWORKF            MERGE SIZE WITH SUBPOOL         02948602
         FREEMAIN R,LV=(0),A=(RDXLST)   FREE THE READ EXCLUSIVE LIST    02959902
*                                                                       02971202
         MODESET  KEYADDR=DXUKEY,WORKREG=11   CHANGE TO USER KEY Y02072 02982502
*                                                                       02993802
         B     LISTPTR                  BR BACK TO PROCESS NEXT SEGMENT 03005102
*                                                                       03016402
RESTREGS EQU   *                        RESTORE REGISTERS IN AVT Y02072 03027702
         L     RDEB,DCBDEBAD            GET ADDRESS OF DEB       Y02072 03039002
         USING DEBBASIC,RDEB            ESTABLISH BASE FOR DEB   Y02072 03050302
         L     RDEQ,DEBAPPAD            GET ADDR OF AVT          Y02072 03061602
         DROP  RDEB                                              Y02072 03072902
         USING DEQAREA,RDEQ             ESTAB BASE,DEQ WORKAREA  Y02072 03084202
         LM    RWTG,RPARC,DEQREGSV      RESTORE REGISTERS         M0045 03095502
         DROP  RDEQ                                                     03106802
         DROP  RDXLST                                                   03118102
         DROP  RDXWORK                                                  03129402
         SPACE 2                                                        03140702
*********************************************************************** 03152002
*  THE FOLLOWING ROUTINES FREE IOBS ON THE BUFFER QUEUE AND BUFFERS.  * 03180002
*  THE LOCATION OF THE IOBS WAITING FOR A BUFFER IS DETERMINED BY     * 03190002
*  WHETHER ADDRSPACE IS VIRTUAL OR REAL.  A TEST OF THE TCB IS MADE.  * 03192002
*  ENTRY AND EXIT IS IN USER KEY.                                     * 03192402
*********************************************************************** 03194002
BUFCHK   EQU   *                        CHK FOR DYNAMIC BUFFER   Y02072 03204002
*                                                                       03214002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 03216002
*                                                                       03218002
         OI    DXATEXC2+1,FCACIOBX      SET AUDIT TRAIL INDICA-  Y02072 03218402
*                                       TING ALL IOBS ON UNPOST  Y02072 03218802
*                                       QUEUE ARE FREED AND THE  Y02072 03219202
*                                       READX LIST IS FREED,IF   Y02072 03219602
*                                       EXCLUSIVE CONTROL        Y02072 03219702
*                                                                       03219802
         MODESET  KEYADDR=DXUKEY,WORKREG=11  RETURN TO USER KEY  Y02072 03219902
*                                                                       03226602
         TM    DCBOPTCD,DCBOPTDB        WAS THE DYNAMIC BUFFER OPTION   03233302
*                                       SPECIFIED                       03240002
         BZ    VRETST                   NO GO TEST FOR VAR SPANNED      03260002
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02072 03284402
         USING DEBBASIC,RDEB            ESTABLISH BASE FOR DEB          03287802
         L     RTCB,DEBTCBAD            GET TCB ADDRESS                 03288702
         USING TCB,RTCB                 ESTABLISH BASE FOR TCB          03289602
         TM    TCBFLGS6,TCBRV           DETERMINE TYPE OF ADDRSPCE      03290502
         BO    BCBQ                     BRANCH IF REAL, NO USL          03291402
         DROP  RTCB                                                     03292302
         DROP  RDEB                                                     03292402
*********************************************************************** 03292702
*  FOR TASKS IN VIRTUAL ADDRESS SPACES, THE ADDRESSES OF IOBS WAITING * 03293102
*  FOR BUFFERS ARE PLACED ON THE UNSCHEDULED LIST (USL).  THESE IOBS  * 03294302
*  AND THE USL COPIES (CHAINED TOGETHER), INCLUDING THE BUFFER CONTROL* 03296302
*  BLOCK ADJACENT TO THE FIRST USL, WILL ALL BE FREED.                * 03296402
*********************************************************************** 03296502
         L     RUSL,DCBDYNB             GET ADDR OF CURRENT USL         03302402
         USING USL,RUSL                 ESTABLISH BASE FOR USL          03303602
         SR    RUSLSLOT,RUSLSLOT        CLEAR REGISTER                  03304802
         ICM   RUSLSLOT,ADDR,USLIOB1    GET TOP SLOT ON QUEUE.          03306002
         BZ    FREEUSL                  BRANCH IF NO IOBS ON QUEUE      03307202
         USING USLSLOT,RUSLSLOT         ESTABLISH BASE FOR USLSLOT      03308402
GETIOB   L     RIOB,USLIOBA             GET IOB ADDRESS                 03310802
         LA    RIOB,0(RIOB)             CLEAR HI-ORDER BYTE             03312002
         BAL   RETURN,FREEIOB           FREE IOB'S CORE                 03316802
         C     RUSLSLOT,USLBFRQB        WAS THAT THE LAST IOB ON LIST?  03319202
         BE    FREEUSL                  BRANCH IF YES TO FREE THIS USL  03320402
         TM    USLSLTFL,USLENDL         IS THIS THE BOTTOM OF THE LIST  03321602
         BZ    BUMPLIST                 BRANCH IF NO TO GO TO NEXT IOB  03322802
         LA    RUSLSLOT,USLSLOT1-L'USLSLOT1   GO BACK TO TOP OF LIST    03324002
BUMPLIST LA    RUSLSLOT,USLNXT          BUMP TO NEXT SLOT ON LIST       03325202
         B     GETIOB                                                   03326402
         DROP  RUSLSLOT                                                 03327602
*                                                                     * 03330002
*  FREE ALL BUT THE ORIGINAL COPY OF THE USL. THAT ONE IS CONTIGUOUS  * 03331202
*  WITH THE BUFFER CONTROL BLOCK AND WILL BE FREED WITH IT.           * 03333202
*                                                                     * 03333602
FREEUSL  EQU   *                        FREE THE USL                    03334002
         L     RWORKC,USLCHAIN          SAVE ADDR TO PRIOR USL          03334402
         LR    RPARM1,RUSL              LOAD USL ADDR IN R1 TO   YM1103 03335102
*                                       FREEMAIN                 YM1103 03335502
         LTR   RWORKC,RWORKC            IS THIS THE ORIGINAL COPY       03336902
         BNZ   NEXTUSL                  NO, BRANCH TO FREE THIS LIST    03337602
         L     RPARM0,USLSZFST+BCBTBFRS(RPARM1) GET LGTH OF    @ZA12264 03338337
*                                       USL+BCB+BFR FOR F'MAIN @ZA12264 03339037
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 03339702
*                                                                       03340402
         OI    DXATEXC2+1,FCACIOBU      SET AUDIT TRAIL INDICA-  Y02072 03341102
*                                       TING ALL IOBS ON USL ARE Y02072 03341802
*                                       FREED, INCLUDING USL     Y02072 03342502
*                                                                       03343202
         MODESET  KEYADDR=DXUKEY,WORKREG=14  RETURN TO USER KEY  Y02072 03343902
*                                                                       03344602
         B     FREEBCB                  BRANCH TO FREE BUFFER CTL BLOCK 03345302
NEXTUSL  EQU   *                        FREE THE USL                    03346002
         LH    RPARM0,USLSIZE           LOAD SIZE OF THIS USL COPY      03346702
         BAL   RETURN,FREEAREA          FREE THE USL CORE               03347702
         LR    RUSL,RWORKC              MAKE NEXT USL (SAVED ACROSS     03349402
*                                       FREEMAIN) THE CURRENT USL       03351102
         B     FREEUSL                  GO CHECK NEXT USL               03352802
         DROP  RUSL                                                     03354502
*********************************************************************** 03356202
*  FOR TASKS IN REAL ADDRESS SPACES, THE ADDRESSES OF IOBS WAITING FOR* 03357902
*  BUFFERS ARE CHAINED FROM THE BCBFRQT FIELD IN THE BUFFER CONTROL   * 03359602
*  BLOCK.  THIS ROUTINES FREES EACH IOB ON THIS QUEUE.                * 03361302
*********************************************************************** 03363002
BCBQ     L     RBUF,DCBBUFCB            LOAD BUFFER CONTROL BLOCK ADDR  03364702
         USING BCBDEFR,RBUF             ESTABLISH BASE FOR BCB          03366402
         L     RIOB2,BCBFRQT            LOAD ADDR OF 1ST IOB WAITING    03368102
*                                       FOR A BUFFER                    03369802
         DROP  RBUF                                                     03371502
TZERO5   LA    RIOB,0(RIOB2)            CLEAR HI-ORDER BYTE, MAKE NEXT  03373202
*                                       IOB CURRENT IOB                 03374902
         USING IOBSTDRD,RIOB            ESTABLISH BASE FOR IOB          03376602
         LTR   RIOB,RIOB                ANY IOBS ON QUEUE               03378302
         BZ    BUFREL                   NO, GO FREE BUFFERS             03380002
         L     RIOB2,IOBDQPTR           SAVE NEXT IOB ADDRESS           03400002
         BAL   RETURN,FREEIOB           YES, GO FREE THIS IOB           03440002
         DROP  RIOB                                                     03442002
         B     TZERO5                   AND GO TEST FOR END OF QUEUE    03450002
*********************************************************************** 03460002
*  THE FOLLOWING ROUTINE FREES THE BUFFER CONTROL BLOCK AND CONTIG-   * 03470002
*  UOUS BUFFERS FOR REAL AND VIRTUAL ADDRESS SPACE.                   * 03472002
*********************************************************************** 03474002
BUFREL   L     RBUF,DCBBUFCB            LOAD ADDR OF BUFFER AREA        03480002
         USING BCBDEFR,RBUF             ESTABLISH BASE FOR BCB          03480402
         L     RPARM0,BCBTBRS           GET SIZE OF BUFFER AREA + BCB   03482002
         DROP  RBUF                                                     03485102
FREEBCB  EQU   *                        FREE BCB AND BUFFER AREA        03486002
         BAL   RETURN,FREEAREA          GO TO FREE BUFFER AREA          03488702
*                                                                       03526002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 03536002
*                                                                       03546002
         OI    DXATEXC2+1,FCACIOBB      SET AUDIT TRAIL INDICA-  Y02072 03556002
*                                       TING ALL IOBS ON BUFFER  Y02072 03558002
*                                       QUEUE ARE FREED, INCLU-  Y02072 03560002
*                                       DING BUFFERS AND BCB     Y02072 03562002
*                                                                       03564002
         MODESET  KEYADDR=DXUKEY,WORKREG=14  RETURN TO USER KEY  Y02072 03564402
*                                                                       03564802
         B     CLEANUP                  BRANCH TO CLEANUP DCB    Y02072 03565402
         SPACE 2                                                        03602702
*********************************************************************** 03640002
*  THE FOLLOWING ROUTINE FREES THE SEGMENT WORK AREA IF VARIABLE      * 03677302
*  SPANNED RECORDS WERE USED. THE SWA POOL IS POINTED TO BY THE       * 03714602
*  DCBDYNB FIELD IN THE DCB.                                          * 03751902
*********************************************************************** 03789202
VRETST   TM    DCBBFTEK,DCBBFTKR        TEST FOR VRE (BUFTEK=R)  S19015 03826502
         BZ    CLEANUP                  NO, BRANCH               Y02072 03863802
         TM    DCBMACF2,DCBMRSWA        DID USER SUPPLY SWA      YM3242 03901102
         BO    CLEANUP                  YES, DO NOT FREE IT      Y02072 03938402
         L     RBUF,DCBDYNB             ADDRESS OF SWA POOL CNTRL BLK   03975702
         USING BCBDEFS,RBUF             ESTABLISH BASE FOR SWA          04013002
         LH    RWORKA,BCBBFNUM          NUMBER OF BUFFERS        S19015 04050302
         LH    RWORKO,BCBBFLG           BUFFER LENGTH            S19015 04087602
         DROP  RBUF                                                     04124902
         MR    RWORKE,RWORKA            CALCULATE SWA POOL LG    S19015 04162202
         LA    RPARM0,BCBLNTHS(RWORKO)  ADD BCB LENGTH,MV TO R0  Y02072 04199502
         BAL   RETURN,FREEAREA          GO FREE SWA POOL FROM SP0       04348702
*                                                                       04358702
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 04368702
*                                                                       04378702
         OI    DXATEXC2,FCACSWA         SET AUDIT TRAIL INDICA- ZA09624 04380737
*                                       TING ALL SEGMENT WORK-   Y02072 04382702
*                                       AREAS ARE FREED.         Y02072 04384702
         SPACE 2                                                        04386002
*********************************************************************** 04390002
*  THE FOLLOWING ROUTINE RESTORES & INVALIDATES DCB FIELDS SET BY BDAM* 04392002
*  OPEN.IT IS ENTERED IN USER KEY AND PROCESSES IN DATA MANAGEMENT KEY* 04394002
*********************************************************************** 04396002
CLEANUP  EQU   *                        CLEAN UP DCB FIELDS             04400002
*                                                                       04410002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 04412002
*                                                                       04414002
         TM    DCBOPTCD,DCBOPTDB        WAS DYN BUFFERING SPECIFIED     04420002
         BZ    NODYNBUF                 NO,GO INVALIDATE DCB ADDRESSES  04440002
         MVI   DCBBUFCB+3,INVALID       YES MAKE BUFFER CONTROL         04450002
*                                       BLOCK POINTER INVALID           04480002
NODYNBUF EQU   *                        CLEAR REST OF FIELDS            04490002
         NI    DCBOPTCD,X'FF'-DCBOPTTO-DCBOPTDB-DCBOPTRE  CLEAR         04500002
*                                       OVERFLO,DYN BUFFERING,AND       04510002
*                                       READ EXCLUSIVE BITS IN THE      04520002
*                                       OPTION FIELD OF THE DCB WHICH   04540002
*                                       MAY HAVE BEEN SET BY BDAM OPEN  04560002
         MVI   DCBCHECK+3,INVALID       INVALIDATE THE CHECK RTN ADDR   04580002
         MVI   DCBDRDX,X'00'            CLEAR NUMBER OF EXTENTS         04610002
         LA    RWORKC,NMSUBVRE          CTR=3 ADDRESSES TO INVALIDATE   04620002
         TM    DCBBFTEK,DCBBFTKR        TEST FOR VS              S19015 04623002
         BZ    INVALIDT                 NO,BRANCH                S19015 04626019
         TM    DCBMACR2,DCBMRSWA        DID USER SUPPLY SWA      S19015 04629002
         BZ    INVALIDT                 NO,BRANCH                S19015 04632019
         LA    RWORKC,NMSUB             INVALIDATE 2 ADDRESSES   S19015 04635002
         DROP  RDCB                                                     04637002
INVALIDT EQU   *                        INVALIDATE SUBRTN ADDRESSES     04640002
         MVI   DCBDFOR-IHADCB+3(RDCB),INVALID  INVALIDATE SUBRTN Y02072 04660002
         LA    RDCB,4(0,RDCB)           INDEX TO NEXT SUBRTN ADDRESS    04680002
         BCT   RWORKC,INVALIDT          TEST IF ALL INVALIDATED,NO GO   04700002
*                                       BACK. YES GO ON.                04720002
         SPACE 4                                                        04730002
*********************************************************************** 04770002
*  ROUTINE TO SCAN DCB LIST FOR OTHER DCBS REQUIRING THIS EXECUTOR.   * 04820002
*  IF NONE ARE FOUND, CONTROL IS TRANSFERRED TO THE NEXT EXECUTOR OF  * 04840002
*  FIRST DCB WHICH IS NOT COMPLETED. THIS ROUTINE IS ENTERED AND      * 04860002
*  PROCESSES IN DATA MANAGEMENT KEY.                                  * 04862002
*********************************************************************** 04870002
JCONOVER EQU   *                        RELOOP CODE                     04890002
         USING WTG,RWTG                 REESTABLISH BASE FOR WTG TABLE  04890402
         MVI   WTGENTRY,X'00'           CLEAR FIRST BYTE IN CURRENT     04892402
*                                       ENTRY OF WHERE-TO-GO TABLE      04894002
*                                                                       04904002
*                                                                       04904402
*   ISSUE IECRES MACRO WHICH CALLS THE O/C/E RESIDENT ROUTINE TO        04904802
*   COPY THE PROTECTED DCB FROM THE CLOSE WORKAREA INTO THE USER'S      04905202
*   DCB CORE.                                                           04905602
*                                                                       04905702
         IECRES  INIT,DCBCOPY=FRWKAR,STM=(R0,R15,WTGPREFX)       YM1190 04905802
*                                                                       04905902
*                                                                       04907902
*                                                                       04910102
* THE FOLLOWING TESTS THE FORCE CLOSE BIT TO DETERMINE IF ENTRY INTO    04914002
* THIS MODULE WAS MADE BY THE FORCE CLOSE EXECUTOR FOR TASK RECOVERY.   04916002
* IF SO, CONTROL IS RETURNED TO FORCE CLOSE WITH A RETURN CODE OF 0     04918002
* PUT IN REG 15 TO INDICATE THAT THIS CLOSE EXECUTOR EXECUTED SUCCESS-  04918402
* FULLY. (IF THIS EXECUTOR ABENDED DURING PROCESSING, A SECOND LEVEL    04920102
* ESTAE WOULD INTERCEPT THE ABEND PROCESSING, SET THE RETURN CODE TO 8, 04922102
* AND RETURN TO THE FORCE CLOSE RECOVERY ROUTINE, ASSOCIATED WITH       04924102
* COMMON CLOSE.)                                                        04926102
*                                                                       04928102
FORCLOS  EQU   *                        ENTRY FROM FORCE CLOSE   Y02072 04930102
         TM    DXATEXC2,FCACFORC        IS THIS FORCE CLOSE?     Y02072 04932102
         BNO   SCAN4EQ                  NO, CONTINUE AS USUAL    Y02072 04934102
         L     RETURN,24(RPAR)          YES,GET FRC CLS RET ADDR Z09656 04936137
         SR    R15,R15                  SET RC=0, SUCCESSFUL     Y02072 04938102
         BR    RETURN                   RETURN TO FORCE CLOSE    Y02072 04940102
*                                                                       04942102
*                                                                       04944102
SCAN4EQ  LA    RWTGC,L'WTGENTRY(RWTGC)  INCREMENT WHERE-TO-GO INDEX     04949402
         LA    RPARC,L'PARDCBAD(RPARC)  INCREMENT DCB PARAMETER INDEX   04954702
         CLC   WTGIDNX,AMIDCNST         IS THIS EXECUTOR NAMED AGAIN    04960002
         BER   RBASE                    YES-RETURN TO START OF ROUTINE  04980002
         CLC   WTGIDNX,CLLDB            IS THIS THE END OF THE TABLE    05020002
         BL    SCAN4EQ                  NO, GO GET NEXT ENTRY           05040002
         CLC   WTGIDNX,CLLDG            IS THIS THE END OF THE TABLE    05060002
         BH    SCAN4EQ                  NO, BRANCH TO GET NEXT ENTRY    05080002
         LR    RPARC,RPAR               RESTORE  BOTH INDEX REGISTERS   05100002
         DROP  RWTGC                                                    05110002
         LA    RWTGC,WTGENTRY           THEIR INITIAL VALUES            05120002
         USING WTGENTRY,RWTGC                                           05132002
SCAN4ANY CLI   WTGIDTTR,0               IS THIS DCB COMPLETED?          05140002
         BNE   XCTLRTN                  IF NOT, GO TO NAMED EXECUTOR.   05160002
         LA    RWTGC,L'WTGENTRY(RWTGC)  INCREMENT BOTH INDEX REGISTERS  05180002
         LA    RPARC,L'PARDCBAD(RPARC)  TO THE NEXT ENTRIES.            05200002
         B     SCAN4ANY                 LOOP TO CHECK COMPLETION        05220002
*                                                                     * 05230002
*   THE FOLLOWING XCTLS TO THE NEXT EXECUTOR FOUND IN THE WTG TABLE   * 05240002
*                                                                     * 05250002
XCTLRTN  EQU   *                        XCTL TO THE NEXT MODULE         05260002
         MVC   WTGMODID,WTGENTRY        MOVE EXECUTOR ID                05280002
         LA    R15,DXCCW12              SET UP FOR XCTL                 05310002
         XCTL  EPLOC=(RWTG),SF=(E,(15)) GO TO NEXT MOD           Y02072 05340002
         DROP  RWTG                                                     05350002
         SPACE 5                                                        05360002
*********************************************************************** 05362002
*  THE FOLLOWING SUBROUTINE DETERMINES THE SIZE OF EACH IOB PASSED TO * 05364002
*  IT (IN REGISTER RIOB) TO BE FREED, AND FREES IT FROM SUBPOOL 0.    * 05366002
*  THIS SUBROUTINE IS ENTERED, PROCESSES, AND EXITS IN USER KEY.      * 05366402
*********************************************************************** 05368002
         USING IOBSTDRD,RIOB            ESTABLISH BASE FOR IOB          05368402
         USING IHADCB,RDCB              ESTABLISH BASE FOR DCB          05368802
FREEIOB  SR    RPARM0,RPARM0            CLEAR REG                A40558 05370002
         AH    RPARM0,IOBDIOBS          ADD IOB LENGTH INTO REG  A40558 05380002
         BNPR  RETURN                   DON'T FREEMAIN IF 0 OR   A40558 05390002
*                                       MINUS                    A40558 05400021
         LR    RPARM1,RIOB              LOAD ADDRESS OF THIS IOB        05460002
         LA    RPARM1,0(RPARM1)         CLEAR HIGH ORDER BYTE IN        05480002
*                                       ADDRESS REGISTER                05500002
         DROP  RIOB                                                     05504037
*********************************************************************** 05504637
*  IF THE USER IS IN SUPERVISOR STATE, SUBPOOL 000 WILL BE     @ZA11614 05505437
*  SPECIFIED FOR THE FREEMAIN. IF THE USER IS IN PROBLEM       @ZA11614 05506237
*  STATE, SUBPOOL 250 WILL BE SPECIFIED TO FORCE SP 000.       @ZA11614 05507037
*********************************************************************** 05507837
         L     RDEB,DCBDEBAD            GET DEB ADDR FROM DCB  @ZA11614 05508837
         USING DEBBASIC,RDEB            ESTABLISH BASE FOR DEB @ZA11614 05509437
         L     RTCB,DEBTCBAD            GET TCB ADDR FROM DEB  @ZA11614 05510037
         USING TCB,RTCB                 ESTABLISH BASE FOR TCB @ZA11614 05510637
         DROP  RDEB                                            @ZA11614 05511237
         LA    RTCB,0(RTCB)             CLEAR HI BYTE          @ZA11614 05511637
         L     RWORKB,CVTPTR(,0)        CVT ADDRESS            @ZA28352 05512037
         L     RWORKB,0(,RWORKB)        TCBWORDS ADDRESS       @ZA28352 05512237
         L     RWORKB,4(RWORKB)         CURRENT TCB ADDRESS    @ZA28352 05512437
         LA    RWORKB,0(RWORKB)         CLEAR HI BYTE          @ZA11614 05512637
         CR    RTCB,RWORKB              IS THIS THE TCB FOR    @ZA28352 05512837
*                                       TASK WHICH OPENED DCB? @ZA28352 05513037
         L     RWORKD,0(RWORKB)         CURRENT RB ADDRESS     @ZA28352 05513237
         BE    TESTATE                  YES-GO CHECK STATE     @ZA28352 05513437
**************************************************************          05514037
*  CLOSE WAS NOT ISSUED UNDER THE SAME TCB AS OPEN.          * @ZA28352 05514137
*  GO TO PROBLEM DETERMINATION MODULE TO ABEND 014-04.       * @ZA28352 05514237
**************************************************************          05514337
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY @ZA28352 05514437
         L     RCVT,CVTPTR(,0)          LOAD ADDR OF CVT       @ZA28352 05514537
         L     RES,CVTDMSR-CVT(,RCVT)    LOAD ADDR OF IFG019RA @ZA28352 05514737
         DMABCOND 1,PDLOAD,RETURN=NONE                         @ZA28352 05514837
TESTATE  TM    17(RWORKD),X'01'         IS RBOPSW PROB STATE?  @ZA28352 05515337
         BNO   OKZERO                   BRANCH IF SUPVR STATE  @ZA11614 05515537
         DROP  RTCB                                            @ZA11614 05515737
         TM    DXUKEY,X'F0'             IF USER KEY IS ZERO    @ZA11614 05516237
         BZ    SET250                   USE SP 250             @ZA11614 05516737
         MODESET  EXTKEY=ZERO           CHANGE TO ZERO KEY     @ZA11614 05517237
SET250   ICM   RPARM0,8,DC250           SUBPOOL IN HI BYTE     @ZA11614 05517737
OKZERO   TM    DCBBFTEK,DCBBFTKR        TEST FOR BFTEK=R       @ZA11614 05518437
         BZ    FREEAREA                 NO, BRANCH               S19015 05519437
         AH    RPARM0,PREFXIOB          ADD 8 TO SIZE OF IOB     S19015 05520437
         SH    RPARM1,PREFXIOB          SUBTRACT 8 FROM IOB ADDR S19015 05521437
FREEAREA FREEMAIN  R,LV=(0),A=(1)       FREE THE IOB OR BUFFER FROM SP0 05523037
         MODESET  KEYADDR=DXUKEY,WORKREG=11                    @ZA11614 05524037
         BR    RETURN                   RETURN TO MAIN ROUTINE          05560002
*********************************************************************** 05610002
          EJECT                                                         06190002
*********************************************************************** 06200002
*                             CONSTANTS                               * 06210002
*********************************************************************** 06212002
AMIDCNST DC    C'3A'                    BDAM IDENTIFIER                 06220002
PREFXIOB DC    H'8'                     SIZE OF IOB PREFIX       S19015 06230019
CLLDB    DC    C'0B'                    CLOSE LOAD B                    06240002
CLLDG    DC    C'0G'                    CLOSE LOAD G                    06260002
         DS    0F                                                       06280000
SYSNM    DC    C'SYSZ'                  MAJOR QUEUE NAME         Y02072 06300002
         DC    C'GGLG'                                                  06320000
ZEROS    DC    X'0000000000000000'      CLEAR COMPARE CONSTANT          06340000
         DS    0F                                              @ZA11614 06340437
PDLOAD   DC    C'6M',VL3(IGG0206M)      PROB DETER MODULE      @ZA28352 06340537
DC250    DC    X'FA000000'              SUBPOOL 250 CONSTANT   @ZA11614 06340837
LISTDEQ  DEQ   (,,L'RDXNQARG,SYSTEM),RET=HAVE,MF=L   DEQ LIST    Y02072 06340937
         ORG   LISTDEQ+4                ONLY NEED 1ST 4 BYTES    Y02072 06341037
MODID    DC    C'IGG0203A'              MODULE ID                Y02072 06341237
FIX      DC    C'OZ28352 '              FIX NUMBER             @ZA11614 06341437
DATE     DC    CL8'&SYSDATE'            DATE OF LATEST FIX      ZA09656 06341637
PATCH    DC    XL((*-START)/20)'0'      5% PATCH AREA            Y02072 06342002
*********************************************************************** 06350002
*                             EQUATES                                 * 06352002
*********************************************************************** 06354002
AVAIL    EQU   X'FF'                    AVAILABILITY FLAG IN IOB        06600000
INVALID  EQU   X'01'                    MOVE THIS INTO ADDR FIELD TO    06664002
*                                       INVALIDATE AN ADDR IN THE DCB   06714002
SP230    EQU   230                      SUBPOOL OF READX LIST    Y02072 06764102
ADDR     EQU   B'0111'                  MASK FOR INSERTING 24-BIT ADDR  06764202
NMSUBVRE EQU   3                        NUMBER OF ADDRESSES      Y02072 07320002
*                                       INVALIDATED IN DCB IF VS Y02072 07340002
NMSUB    EQU   2                        NUMBER OF ADDR IF NOT VS Y02072 07350002
BCBTBFRS EQU   12                       OFFSET TO BCBTBRS1     @ZA12264 07351037
RESXCTL  EQU   4                        OFFSET FOR XCTL        @ZA28352 07351537
*********************************************************************** 07352002
         EJECT                                                          07480000
*********************************************************************** 07482002
*                          DSECTS                                     * 07484002
*********************************************************************** 07486002
         IGGPARML                                                Y02072 07489902
         IGGBCB                                                  Y02072 07492002
         EJECT                                                          07492402
         IGGSWA                                                  Y02072 07494002
         IGGRDX                                                  Y02072 07496002
         IGGUSL                                                  Y02072 07506002
         EJECT                                                          07520002
         DCBD  DSORG=(DA)                                               07540000
         EJECT                                                          07560000
         IEZIOB                                                         07570002
         EJECT                                                          07572002
         IEZDEB                                                         08540021
*********************************************************************** 08540402
*  THE FOLLOWING DSECT FORMATS THE DEQ PARAMETER LIST, WHICH IS BUILT * 08540802
*  IN THE FIRST 12 BYTES OF THE AVT.                                  * 08541202
*********************************************************************** 08541602
DEB      DSECT                                                          08543202
         ORG   DEBAVT                                                   08546802
DEQAREA  DS    0CL28               WORKAREA-DEQ PARMLST AND REG SAVE    08547202
DEQPARM  DS    0CL12               PARAMETER LIST FOR DEQ               08548402
DEQFLAG  DS    XL4                 FLAGS INDICATING DEQ OPTIONS  Y02072 08550002
DEQMAJOR DS    A                   ADDRESS OF MAJOR QNAME               08569902
DEQMINOR DS    A                   ADDR OF MINOR QNAME                  08571902
DEQREGSV DS    2F                  REGS 6 AND 7 ARE SAVED HERE          08573902
         EJECT                                                          08582002
         IECDSECS  (MAIN,(IOB,NO)),RRPL,PREFX,WTG,EXPAND=YES     YM1190 08584002
WTGTABLE DSECT                                                   YM1190 08584402
         ORG   WTG+8                                             Y02072 08586002
WRKRETRN DS    A                   ADDR OF FORCE CLOSE EXEC      Y02072 08588002
         ORG   WTGIDTTR                                                 08590002
WTGIDNX  DS    CL2                 ID OF THE NEXT MODULE                08592002
WTGTTRNX DS    CL3                 TTR OF THE NEXT MODULE               08592402
         ORG   WTGIDTTR+4                                               08592802
WTGDCBWA DS    A                   ADDR OF WORKAREA FOR THE DCB         08593202
FORCORE  DSECT                     WORKAREA DSECT CONTINUED      Y02072 08594002
         IHAFCAUD  ORG=YES                                       Y02072 08596002
         EJECT                                                          08640002
         IECDPPL                                                 Y02072 08690002
         EJECT                                                          08740002
         IKJTCB                                                         09140901
         EJECT                                                          09150902
         CVT   DSECT=YES                                         YM1190 09152902
         END                                                            09160000
