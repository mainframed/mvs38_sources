./  ADD  SSI=62390318,NAME=IGC0002A
         TITLE 'IGC0002A - FIRST LOAD OF BPAM STOW ROUTINE'             00090021
IGC0002A CSECT                                                          00180021
         SPACE                                                          00270021
*********************************************************************** 00360021
*                                                                     * 00450021
* MODULE NAME = IGC0002A                                              * 00452002
*                                                                     * 00454002
* DESCRIPTIVE NAME = FIRST LOAD OF BPAM STOW ROUTINE                  * 00456002
*                                                                     * 00458002
* STATUS = RELEASE VS2-4, LEVEL 000                                   * 00990037
*                                                                     * 01172002
*                                                                     * 01350021
* FUNCTION = THE STOW FUNCTION MAINTAINS THE DIRECTORY PORTION OF A   * 01440002
*            PARTITIONED DATA SET.  THE ENTRIES WITHIN A DIRECTORY    * 01530002
*            ARE KEPT IN ASCENDING ORDER OF THEIR BINARY VALUE.  STOW * 01620002
*            WILL PERFORM ONE OF THE FOLLOWING FOUR FUNCTIONS         * 01710002
*            DEPENDING UPON THE USER'S REQUEST:                       * 01800002
*            1. ADD - ADD A NEW ENTRY TO A DIRECTORY.                 * 02070002
*                                                                     * 02160021
*            2. REPLACE - EITHER REPLACE AN EXISTING ENTRY WITH A NEW * 02250002
*               ENTRY OR ADD THE NEW ENTRY IF THE EXISTING ENTRY CAN  * 02340002
*               NOT BE FOUND.                                         * 02430002
*                                                                     * 02520021
*            3. DELETE - DELETE AN ENTRY FROM A DIRECTORY.            * 02610002
*                                                                     * 02700021
*            4. CHANGE - CHANGE THE NAME OF A DIRECTORY ENTRY.        * 02790002
*                                                                     * 02970021
*            IF THE REQUEST IS FOR EITHER AN ADD OR REPLACE FUNCTION  * 03060002
*            AND THE DIRECTORY HAS BEEN SUCCESSFULLY UPDATED, AN END  * 03150002
*            OF DATA MARK WILL BE WRITTEN AT THE END OF THE MEMBER.   * 03240002
*                                                                     * 03420021
*            IGC0002A IS RESPONSIBLE FOR PERFORMING VARIOUS DIAGNOS-  * 03600002
*            TICS FOR THE STOW FUNCTION AS FOLLOWS:                   * 03690002
*            1. DATA CONTROL BLOCK CHECK                              * 03960002
*               A. CHECK THE DCB FOR TO DETERMINE IF IT IS OPEN.      * 04050002
*               B. CHECK TO SEE IF THE DCB IS OPEN FOR INPUT.         * 04140002
*               C. IF AN INVALID CONDITION IS DETECTED FROM THE ABOVE * 04230002
*                  CHECKS, IGC0002A WILL SET A  RETURN CODE IN REG 15 * 04320002
*                  AND RETURN TO THE CALLER VIA A BR 14.              * 04410002
*                                                                     * 04590021
*            2. REQUEST TYPE                                          * 04770002
*               THE REQUEST TYPE IS DETERMINED BY A UNIQUE            * 04860002
*               COMBINATION OF THE SIGNS IN REGISTERS 0 AND 1.        * 04950002
*                                                                     * 05130021
*            3. WORKAREA FOR THE FOLLOWING                            * 05220002
*               A. THE INPUT/OUTPUT BUFFERS FOR MANIPULATING THE      * 05310002
*                  THE DIRECTORY ENTRIES.                             * 05400002
*               B. THE ECB, IOB, AND CHANNEL PROGRAMS FOR READING AND * 05490002
*                  WRITING THE DIRECTORY BLOCKS.                      * 05670002
*               C. THE FUNCTION CODE INDICATING THE REQUEST TYPE.     * 05850002
*               D. THE RETURN CODE IF APPLICABLE.                     * 05940002
*               E. SAVE THE ADDRESS OF THE CALLER'S PARAMETERS.       * 06120002
*               F. SAVE THE RELATIVE TRACK ADDRESS, (TTR), FROM THE   * 06210002
*                  DCB IF THE ALIAS BIT IS NOT ON IN THE CALLER'S     * 06300002
*                  PARAMETER LIST AND THE FUNCTION REQUEST IS EITHER  * 06390002
*                  ADD OR REPLACE.                                    * 06480002
*               G. IF A CHANGE FUNCTION, SAVE THE RELATIVE ADDRESS,   * 06660002
*                  (TTR), FROM THE OLD ENTRY.                         * 06750002
*               H. SET A SWITCH REFLECTING THE LAST OPERATION         * 06840002
*                  PERFORMED WITH THE DCB BEFORE STOW WAS ISSUED.     * 06930002
*               I. FOR CHANGE, INDICATE IN WORK AREA WHICH OPERATION  * 07110002
*                  WILL BE PERFORMED FIRST - ADD OR DELETE.           * 07200002
*                                                                     * 07380021
*            4. EVENT CONTROL BLOCK, INPUT OUTPUT BLOCK               * 07470002
*               A. IGC0002A DYNAMICALLY CONSTRUCTS THE ECB, IOB, AND  * 07560002
*                  THE CHANNEL PROGRAMS THAT WILL BE USED BY IT.      * 07650002
*               B. IGC0002A EXECUTES A CHANNEL PROGRAM TO READ IN THE * 07830002
*                  DIRECTORY BLOCK AGAINST WHICH SOME ACTION WILL BE  * 07920002
*                  PERFORMED AND THE FOLLOWING BLOCK IF AVAILIBLE.    * 08010002
*               C. IF AN I/O ERROR OCCURS, RETURN AND REASON CODES    * 08190002
*                  WILL BE SET AND CONTROL RETURNED TO THE CALLER     * 08280002
*                  WITHOUT FURTHER PROCESSING.                        * 08370002
*                                                                     * 08550021
*            5. DIRECTORY BLOCK DIAGNOSTICS                           * 08730002
*               A. DETERMINE IF THE REQUEST IS VALID AND IF NOT SET   * 08820002
*                  THE APPROPIATE RETURN CODE AND RETURN TO THE       * 08910002
*                  CALLER VIA A BR 14.                                * 09000002
*                                                                     * 09000402
*                                                                     * 09002002
* NOTES = DIRECTORY LAYOUT                                            * 09004002
*                                                                     * 09006002
*         |-------| |-------| |---|-------------|------|----------|   * 09008002
*         | COUNT | |  KEY  | | N | FIRST ENTRY | ETC. | FFFFFFFF |   * 09010002
*         |-------| |-------| |---|-------------|------|----------|   * 09012002
*                                                                     * 09012402
*         COUNT - AN EIGHT BYTE FIELD CONTAINING THE ADDRESS OF THIS  * 09014002
*                 DIRECTORY BLOCK IN THE FORM OF CCHHRKDD.            * 09016002
*         KEY   - AN EIGHT BYTE FIELD CONTAINING THE NAME OF THE LAST * 09018002
*                 ENTRY IN THIS DIRECTORY BLOCK.  IF THIS IS THE LAST * 09020002
*                 BLOCK IN THE DIRECTORY THE KEY WILL CONTAIN         * 09022002
*                 X'FFFFFFFF'.                                        * 09024002
*         N     - A TWO BYTE FIELD INDICATING THE TOTAL NUMBER OF     * 09026002
*                 BYTES USED IN THIS DIRECTORY BLOCK INCLUDING ITSELF.* 09028002
*                 IF THIS IS THE LAST BLOCK, THE TOTAL WILL ALSO IN-  * 09030002
*                 CLUDE THE 4 X'0'S FOLLOWING THE X'FFFFFFFF' FIELD.  * 09032002
*         F'S   - AN EIGHT BYTE FIELD SHOWING THE END OF THE ENTRIES  * 09034002
*                 FOR A DIRECTORY.                                    * 09036002
*                                                                     * 09038002
*    DEPENDENCIES = NONE                                              * 09040002
*                                                                     * 09042002
*    RESTRICTIONS = NONE                                              * 09044002
*                                                                     * 09046002
*    REGISTER CONVENTIONS = SEE REGISTER EQUATES BELOW                * 09048002
*                                                                     * 09050002
*    PATCH LABEL = PATCH                                              * 09052002
*                                                                     * 09052402
*                                                                     * 09054002
* MODULE TYPE = SVC ROTUINE                                           * 09056002
*                                                                     * 09058002
*    ATTRIBUTES = REENTRANT, ENABLED, PRIVILEGED, ENTERED IN          * 09060002
*                 SUPERVISOR KEY AND ISSUES A MODESET TO RUN IN THE   * 09062002
*                 CALLER'S KEY.                                       * 09064002
*                                                                     * 09066002
*                                                                     * 09180021
* ENTRY POINT = IGC0002A                                              * 09270002
*                                                                     * 09272002
*    PURPOSE = SEE FUNCTION                                           * 09274002
*                                                                     * 09276002
*    LINKAGE = THIS ROUTINE RECEIVES CONTROL FROM THE SECOND LEVEL    * 09278002
*              SVC INTERRUPT HANDLER FOLLOWING THE ISSUANCE OF THE    * 09280002
*              STOW MACRO WHICH RESULTS IN SVC 21.                    * 09282002
*                                                                     * 09540021
*    INPUT = REGISTER 0  - ADDRESS OF THE CALLERS DATA AREA           * 09630002
*            REGISTER 1  - ADDRESS OF THE CALLER'S DCB                * 09632002
*            REGISTER 3  - CVT ADDRESS                                * 09634002
*            REGISTER 4  - TCB ADDRESS                                * 09636002
*            REGISTER 5  - SVRB ADDRESS                               * 09638002
*            REGISTER 14 - RETURN ADDRESS                             * 09640002
*                                                                     * 09642002
*            IN ADDITION TO THE ADDRESS OF THE DATA IN REGISTER 0 AND * 10530002
*            THE ADDRESS OF THE DCB IN REGISTER 1, THE STOW MACRO     * 10620002
*            ALSO SETS THE SIGNS OF THE TWO REGISTERS AS FOLLOWS:     * 10710002
*               FUNCTION       REGISTER ZERO       REGISTER ONE       * 10890002
*                ADD              POSITIVE           POSITIVE         * 10980002
*                REPLACE          POSITIVE           NEGATIVE         * 11070002
*                DELETE           NEGATIVE           POSITIVE         * 11160002
*                CHANGE           NEGATIVE           NEGATIVE         * 11250002
*                                                                     * 11252002
*            FOLLOWING ARE THE FORMATS OF THE DATA AREA SUPPLIED BY   * 11430002
*            THE CALLER IN REGISTER 0:                                * 11520002
*                                                                     * 11522002
*               ADD OR REPLACE                                        * 11610002
*               |------------|------|-------------------------|       * 11790002
*               |    NAME    | TTRC |   VARIABLE USER DATA    |       * 11970002
*               |------------|------|-------------------------|       * 12150002
*                                                                     * 12240002
*               CHANGE                                                * 12330002
*               |------------|------------|                           * 12510002
*               |  OLD NAME  |  NEW NAME  |                           * 12690002
*               |------------|------------|                           * 12870002
*                                                                     * 12960021
*               DELETE                                                * 13050002
*               |------------|                                        * 13230002
*               |    NAME    |                                        * 13410002
*               |------------|                                        * 13590002
*                                                                     * 13770021
*               NAME- EIGHT BYTE NAME OF ENTRY BEING ACTED UPON.      * 13950002
*               TT -  RELATIVE TRACK FROM THE BEGINNING OF THE DATA   * 14130002
*                     SET.                                            * 14220002
*               R  -  RELATIVE BLOCK NUMBER ON A TRACK.               * 14310002
*               C  -  INDICATES IF THE NAME IS AN ALIAS, THE NUMBER   * 14400002
*                     OF TTRN'S IN THE USER DATA AND THE LENGTH OF    * 14490002
*                     THE USER DATA. THE FORMAT IS AS FOLLOWS:        * 14580002
*                        BIT0   -   IF ON NAME IS AN ALIAS.           * 14760002
*                        BITS 1-2 - NUMBER OF TTRNS IN USER DATA.     * 14850002
*                                   FIELD.  MAXIMUM NUMBER IS THREE.  * 14940002
*                        BITS 3-7 - BY THEIR BINARY VALUE, INDICATE   * 15030002
*                                   NUMBER OF HALF WORDS OF USER DATA.* 15120002
*                                                                     * 15390021
*    OUTPUT = IF RETURNING TO THE CALLER -                            * 15480002
*                REGISTER 0  - CONTAINS THE REASON CODE               * 15482002
*                REGISTER 15 - CONTAINS THE RETURN CODE               * 15484002
*                                                                     * 15484402
*             IF TRANSFERING CONTROL TO THE SECOND LOAD OF STOW -     * 15486002
*                REGISTER 10 - CONTAINS ADDR OF THE STOW WORK AREA    * 15488002
*                REGISTER 11 - ADDRESS OF THE CALLER'S DCB            * 15488402
*                                                                     * 15490002
*    EXIT-NORMAL = BRANCH TO THE SECOND LOAD - IGG0210A.              * 15492003
*                                                                     * 15494002
*    EXIT-ERROR = RETURN TO THE CALLER VIA A BR 14 WITH REASON CODE   * 15496002
*                 REGISTER 0 AND RETURN CODE REGISTER 15 CONTAINING   * 15498002
*                 THE FOLLOWING:                                      * 15500002
*                 REG 0   REG 15              CONDITION               * 15502002
*                   0       4 -  ADD FUNCTION - ENTRY ALREADY EXIST.  * 15502402
*                                CHANGE FUNCTION - DIRECTORY ALREADY  * 15502802
*                                CONTAINS THE SPECIFIED NEW NAME.     * 15503202
*                   0       8 -  REPLACE AND DELETE FUNCTIONS - THE   * 15503702
*                                SPECIFIED NAME COULD NOT BE FOUND.   * 15504402
*                                CHANGE FUNCTION - THE SPECIFIED      * 15505002
*                                OLD NAME COULD NOT BE FOUND.         * 15505102
*                   1       16 - ALL FUNCTIONS - A PERMANENT I/O      * 15505702
*                                ERROR OCCURED READING THE DIRECTORY. * 15506202
*                   0       20 - ALL FUNCTIONS - THE USER'S DCB IS    * 15506602
*                                NOT OPEN.                            * 15507102
*                   0       24 - ALL FUNCTIONS - NO CORE AVAILIBLE.   * 15507202
*                                                                     * 15507602
*                                                                     * 15507702
* ENTRY POINT = EXITRTN                                               * 15507802
*                                                                     * 15507902
*    PURPOSE = ENTERED FROM THE RTM WHEN THERE IS AN ATTEMPT TO       * 15508002
*              ABNORMALLY TERMINATE THE RB LEVEL ON WHICH THIS SVC IS * 15510002
*              ACTIVE.  THIS ROUTINE WILL FIND THE ADDRESS OF THE TRR * 15512002
*              BY ISSUING A LOAD. IT WILL ALSO FILL IN SDWACSCT       * 15514002
*              AND SDWAREXN.                                          * 15516002
*                                                                     * 15518002
*    LINKAGE = ENTERED FROM THE RTM VIA A SYNCH IN KEY ZERO, ENABLED  * 15520002
*                                                                     * 15522002
*    INPUT = REGISTER 0  - CODE (12 IF NO RTCA IS PASSED)             * 15524002
*            REGISTER 1  - ADDRESS OF THE RTCA                        * 15526002
*            REGISTER 13 - ADDRESS OF AN 18 FULLWORD SAVE AREA        * 15528002
*            REGISTER 14 - RETURN ADDRESS TO THE RTM                  * 15530002
*            REGISTER 15 - ADDRESS OF THE ESTAE EXIT BOOTSTRAP RTN    * 15532002
*                                                                     * 15534002
*    OUTPUT = SAME AS INPUT EXCEPTING REGISTER 15 WHICH WILL CONTAIN  * 15536002
*             THE ADDRESS OF THE ESTAE ROUTINE IGCT0021.              * 15538002
*                                                                     * 15540002
*    EXIT-NORMAL = BR 15 TO IGCT0021                                  * 15542002
*                                                                     * 15544002
*    EXIT-ERROR = BR 14 TO THE RTM IF NO RTCA WAS PASSED.             * 15546002
*                                                                     * 15840021
*                                                                     * 15842002
* EXTERNAL REFERENCES = SEE BELOW                                     * 15930002
*                                                                     * 15932002
*    ROUTINES = ESTAE(SVC 60) - ESTABLISHES A TASK RECOVERY ROUTINE.  * 15934002
*                                                                     * 15934402
*               MODESET - USED TO CHANGE THE STORAGE PROTECT KEY.     * 15934802
*                                                                     * 15935202
*               GETMAIN(SVC 120) - GETS CORE FOR A STOW WORK AREA.    * 15936002
*                                                                     * 15938002
*               EXCP(SVC 0) AND WAIT(SVC 1) - ARE USED TO PERFORM I/O * 16920002
*               OPERATIONS.                                           * 16922002
*                                                                     * 16924002
*               FREEMAIN(SVC 10) - USED TO FREE THE STOW WORK AREA.   * 17010002
*                                                                     * 17280402
*               IGGSTAE - TRANSFERS CONTROL TO THE STOW ESTAE ROUTINE.* 17282002
*                                                                     * 17550021
*    DATA AREAS = NONE                                                * 17552002
*                                                                     * 17554002
*    CONTROL BLOCKS = DCB,DEB,ECB,IOB,SVRB,SDWA,TCB                   * 17556002
*                                                                     * 17558002
*                                                                     * 17560002
* TABLES = A WORK AREA IS GOTTEN FROM SUBPOOL 229 IN WHICH TO BUILD   * 17562002
*          AN IOB, ECB, BUFFERS, AND CHANNEL PROGRAMS FOR STOW.       * 17564002
*                                                                     * 17564402
*                                                                     * 17566002
* MACROS = ACTION MACROS - ESTAE,MODESET,GETMAIN,EXCP,WAIT,FREEMAIN,  * 17568002
*             IGGSTAE                                                 * 17570003
*                                                                     * 17570402
*          MAPPING MACROS - DCBD,IEZDEB,IHAPDS,IHARB,IHASDWA,IHASTOW, * 17572002
*             IKJTCB,IGGSTW                                           * 17574002
*                                                                     * 20250021
*                                                                     * 20252002
* CHANGE ACTIVITY = AS FOLLOWS:                                       * 20340002
*                                                                     * 20342002
*        RELEASE 21 DELETIONS                                         * 24572002
*    THIS MODULE WAS REWRITTEN FOR RELEASE 21.  THE FOLLOWING APARS   * 24572402
*    WERE CORRECTED.  28169, 33374, 35322, 42484, AND 43923.          * 24572802
*0281                                                            A50697 24574002
*0281                                                            S01964 24576002
*        VS1 RELEASE 01 DELETIONS                                     * 24578002
*                                                                XM5415 24580002
*        VS1 RELEASE 03 DELETIONS                                     * 24580202
*                                                               XA02068 24580402
*        VS2 RELEASE 01 DELETIONS                                     * 24582002
*D617400                                                         YM0943 24584002
*        VS2 RELEASE 02 DELETIONS                                     * 24586002
*D001400,005000,007400,279900,285300,298400-298900,305100-306000,Y02072 24588002
*D324500-325400,351100-351500,365400-366300,370800-377100,       Y02072 24590002
*D388800-390600,394200,400500-409500,452700-453600,485100-486000,Y02072 24592002
*D495000,615600-616500,665100-670500,708300-709200,713700-729000,Y02072 24594002
*D730800-893700,899100-908100                                    Y02072 24596002
*        VS2 RELEASE 03 DELETIONS                                     * 24646003
* SEE CODE FLAGGED YA06505 AND SA66881 FOR VS2-3 APAR ZA01548   ZA01548 24653037
*A628200-628400,628800                                         @ZA12202 24655037
*C713340-713342                                                @ZA12202 24657037
*                                                              @Z30TSMI 24660003
*********************************************************************** 24750021
         EJECT                                                          24840021
*********************************************************************** 24930021
****                                                               **** 25020021
****     EQUATES                                                   **** 25110021
****                                                               **** 25200021
*********************************************************************** 25290021
         SPACE                                                          25380021
****     THE FOLLOWING REGISTER EQUATES WILL BE USED DURING CONSTRUC-   25470021
****     TION OF THE IOB, ECB, AND CHANNEL PROGRAMS USED BY STOW.       25560021
         SPACE                                                          25650021
R0       EQU   0                        WORK REGISTER                   25740021
R1       EQU   1                        WORK REGISTER                   25830021
R2       EQU   2                        WORK REGISTER                   25920021
R3       EQU   3                        WORK REGISTER                   26010021
R4       EQU   4                        WORK REGISTER                   26100021
R5       EQU   5                        WORK REGISTER                   26190021
R6       EQU   6                        WORK REGISTER                   26280021
R7       EQU   7                        WORK REGISTER                   26370021
R8       EQU   8                        WORK REGISTER                   26460021
R9       EQU   9                        WORK REGISTER                   26550021
R10      EQU   10                       WORK REGISTER                   26640021
R11      EQU   11                       WORK REGISTER                   26730021
R12      EQU   12                       WORK REGISTER                   26820021
R13      EQU   13                       WORK REGISTER                   26910021
R14      EQU   14                       WORK REGISTER                   27000021
R15      EQU   15                       WORK REGISTER                   27090021
         SPACE 2                                                        27180021
****     THE FOLLOWING REGISTER EQUATES WILL BE USED IN THE             27270021
****     PROGRAM FLOW                                                   27360021
         SPACE                                                          27450021
PARMRG0  EQU   R0                       POINTS TO USER DATA UPON ENTRY  27540021
DCBRG1   EQU   R1                       POINTS TO DCB UPON ENTRY        27630021
DIRSCNRG EQU   R2                       POINTS TO LOCATION IN DIRECTORY 27720021
*                                       FOR ACTION TAKING PLACE         27810021
PARMRG2  EQU   DIRSCNRG                 USED TO SAVE ADDR OF USER DATA  27900021
TTRCRG   EQU   R3                       MANIPULATES THE AMOUNT OF       28080002
*                                       USER DATA FOR AN ENTRY          28170021
RTCB     EQU   R4                       TCB ADDRESS              Y02072 28220002
ENTADDRG EQU   RTCB                     CONTAINS ADDR OF ENTRY   Y02072 28260002
*                                       SUPPLIED BY THE USER     Y02072 28350002
BUFADRG  EQU   R5                       ADDRESSABILITY TO BUFFERS       28440021
RWRK1    EQU   R6                       WORK REGISTER                   28580002
RWRK2    EQU   R7                       WORK REGISTER                   28590002
FUNRG    EQU   R8                       CONTAINS FUNCTION CODE          28620021
SAVECDRG EQU   R9                       SAVES THE RETURN CODE           28710021
RDEB     EQU   SAVECDRG                 ADDRESS OF USER'S DEB    Y02072 28760002
WRKARG   EQU   R10                      ADDRESS OF THE WORK AREA        28800021
DCBRG11  EQU   R11                      ADDRESS OF THE USER'S DCB       28890021
BASERG   EQU   R12                      BASE REGISTER                   28980021
RSVRB    EQU   R13                      SVRB ADDRESS             Y02072 29070002
LINKRG   EQU   R14                      LINKAGE REGISTER WITHIN MODULE  29160021
RTNRG    EQU   R15                      CONTAINS RETURN CODE            29250021
         SPACE 2                                                        29340002
****     DISPLACEMENT AND MASK EQUATES                                  29430021
         SPACE                                                          29520021
THREE    EQU   3                        DISPLACE BY THREE               29790021
UNITEXCP EQU   X'01'                    TEST FOR UNIT EXCEPTION         30420021
         SPACE                                                          30960021
****     ERROR CONDITION EQUATES                                        31050021
         SPACE                                                          31140021
DIRECTRY EQU   1                        IND I/O ERROR ENCOUNTER- Y02072 31190002
*                                       ED IN DIRECTORY          Y02072 31210002
NMEXIST  EQU   X'04'                    NAME ALREADY EXISTS             31230021
NONAME   EQU   X'08'                    NAME DOESN'T EXIST              31320021
IOERRCD  EQU   X'10'                    I/O ERROR                       31410021
DCBERR1  EQU   X'14'                    DCB NOT OPEN                    31500021
NOCORE   EQU   X'18'                    NO CORE AVAILABLE               31590021
         EJECT                                                          31770021
*********************************************************************** 31860021
****                                                               **** 31950021
****     ESTABLISH BASE REGISTERS                                  **** 32040002
****                                                               **** 32130021
*********************************************************************** 32220021
         BALR  BASERG,0                 ESTABLISH BASE ADDR             32310002
         USING *,BASERG                 ESTABLISH BASE ADDR             32400021
         USING TCB,RTCB                 ESTABLISH TCB BASE REG   Y02072 32450002
         LR    RSVRB,R5                 GET SVRB ADDRESS         Y02072 32460002
         USING RBSECT,RSVRB             ESTABLISH SVRB BASE REG  Y02072 32500002
         ST    R14,XSAREG14             SAVE RETURN REGISTER     Y02072 32550002
         SR    RWRK1,RWRK1              CLEAR REGISTER           Y02072 32552002
         ST    RWRK1,XSASTWWA           IND GETMAIN NOT YET DONE Y02072 32554002
         MVC   XSAESTAE(ESTAELEN),ESTALIST  MOVE ESTAE LIST TO   Y02072 32556002
*                                       SVRB EXTENDED SAVE AREA  Y02072 32558002
         SPACE 2                                                        32560002
****                                                                    32570002
****     ISSUE THE ESTAE MACRO TO ESTABLISH A TASK RECOVERY ROUTINE.    32572002
****                                                                    32574002
         ESTAE XCTL=YES,PARAM=(RSVRB),MF=(E,XSAESTAE)            Y02072 32576002
         SPACE 2                                                        32587302
****                                                                    32589302
****     MODSET TO THE CALLER'S KEY.                                    32591302
****                                                                    32593302
         MODESET EXTKEY=RBT234,WORKREG=1                         Y02072 32594902
         SPACE                                                          32604902
         L     PARMRG0,RBGRS0           RESTORE PARMETER REG     Y02072 32609902
         L     DCBRG1,RBGRS1            RESTORE DCB REGISTER     Y02072 32619902
         SPACE 2                                                        32640002
*********************************************************************** 32670021
****                                                               **** 32760021
****     THIS SECTION DETERMINES THE FUNCTION OF STOW REQUESTED    **** 32850021
****                                                               **** 32940021
*********************************************************************** 33030021
         LA    FUNRG,STWADD             SET FUNCTION TO ADD             33120021
         LTR   PARMRG0,PARMRG0          TEST FOR DELETE OR CHANGE       33210021
         BP    TEST1                    BRANCH IF ADD OR REPLACE        33300021
         SLL   FUNRG,1                  SET CODE FOR REPLACE            33390002
         SPACE                                                          33480021
TEST1    EQU   *                                                        33570021
         LTR   DCBRG1,DCBRG1            TEST FOR ADD/REPLACE            33660021
         BP    TEST02                   BRANCH IF ADD / REPLACE         33750021
         SLL   FUNRG,1                  SET FUNCTION TO DELETE          33840002
         SPACE                                                          33930021
TEST02   EQU   *                                                        34020021
         LTR   PARMRG0,PARMRG0          TEST FOR CHANGE FUNCTION        34110021
         BP    DCBTEST                  IF NOT BRANCH                   34200021
         SLL   FUNRG,1                  SET FUNCTION TO CHANGE          34290002
         SPACE 2                                                        34380021
*********************************************************************** 34470021
****                                                               **** 34560021
****     THIS SECTION TESTS THE DATA CONTROL BLOCK FOR OPEN        **** 34650021
****                                                               **** 34740021
*********************************************************************** 34830021
DCBTEST  EQU   *                                                        34920021
         LPR   PARMRG2,PARMRG0          MAKE PARAMETER ADDR POSITIVE    35010021
         LPR   DCBRG11,DCBRG1           MAKE DCB ADDR POSITIVE          35100021
         USING IHADCB,DCBRG11           ESTABLISH DCB ADDRESSABILITY    35190021
         TM    DCBOFLGS,DCBOFOPN        DATA CONTROL BLOCK OPEN         35280002
         BO    GETWORK                  GO GET THE WORK AREA            35370021
         SPACE                                                          35420002
INVALDCB EQU   *                                                 Y02072 35460002
         LA    RTNRG,DCBERR1            SET THE RETURN CODE             35550021
         SPACE                                                          35640021
RTRNUSR1 EQU   *                                                 Y02072 35730002
         SR    R0,R0                    CLEAR REASON CODE REG    Y02072 35780002
         SPACE 2                                                        35790002
****                                                                    35792002
****     MODESET TO KEY 0 AND RETURN TO THE CALLER.                     35794002
****                                                                    35796002
RTRNUSR2 EQU   *                                                 Y02072 35800002
         L     R14,XSAREG14             RESTORE RETURN ADDRESS   Y02072 35810002
         MODESET EXTKEY=SUPR            MODESET TO KEY 0         Y02072 35812002
         BR    R14                      RETURN TO THE CALLER     Y02072 35820002
         SPACE 2                                                        35910021
*********************************************************************** 36000021
****                                                               **** 36090021
****     THIS SECTION GETS THE WORK AREA FOR STOW                  **** 36180021
****                                                               **** 36270021
*********************************************************************** 36360021
GETWORK  EQU   *                                                        36450021
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 36720002
         USING DEBBASIC,RDEB            ESTABLISH DEB BASE REGISTER     36810002
         TM    DEBOPATB,DEBACCS         DCB OPEN FOR INPUT              36900002
         BZ    INVALDCB                 BRANCH IF YES            Y02072 36990002
         GETMAIN  RC,LV=CORESIZE,SP=229  GET THE WORK AREA       Y02072 37800002
         SPACE                                                          37850002
         LTR   RTNRG,RTNRG              GETMAIN SUCCESSFUL              37890021
         LA    RTNRG,NOCORE             SET RETURN CODE                 37980021
         BNZ   RTRNUSR1                 RETURN TO USER IF NOT    Y02072 38070002
         LR    WRKARG,R1                GET THE ADDRESS OF CORE  Y02072 38080002
         USING STWAREA,WRKARG           EST WORK AREA BASE REG   Y02072 38090002
         SPACE 2                                                        38120002
****                                                                    38130002
****     MODESET TO KEY 0 IN ORDER TO SAVE THE WORK AREA ADDRESS IN     38140002
****     THE EXTENDED SAVE AREA OF THE SVRB.                            38150002
****                                                                    38152002
         MODESET EXTKEY=SUPR                                     Y02072 38154002
         ST    WRKARG,XSASTWWA          SAVE WORK AREA ADDR      Y02072 38156002
         SPACE 2                                                        38158002
****                                                                    38158402
****     RETURN TO THE CALLER'S KEY.                                    38158802
****                                                                    38159202
         MODESET EXTKEY=RBT234,WORKREG=1                         Y02072 38159602
         DROP  RTCB                     DROP TCB BASE REGISTER   Y02072 38159702
         SPACE 2                                                        38160021
*********************************************************************** 38250021
****                                                               **** 38340021
****     THIS SECTION CLEARS THE WORK AREA AND SAVES THE           **** 38430002
****     CONDITION AND FUNCTION CODES.                             **** 38520002
****                                                               **** 38700021
*********************************************************************** 38790021
         XC    STWAREA(STWFLGLN),STWAREA  CLEAR THE CONDITION AND       39150021
*                                       FUNCTION BYTES                  39240021
         STC   FUNRG,STWFLAG1           SAVE FUNCTION CODE              39330021
         TM    DCBOFLGS,DCBOFLWR        LAST OPERATION A WRITE          39510002
         BNO   CHANGECK                 NO, CHECK FOR CHANGE     Y02072 39600002
         OI    STWFLAG1,STWDCBWR        INDICATE LAST OPERATION         39690021
*                                       WAS A WRITE                     39780021
         SPACE                                                          39870021
CHANGECK EQU   *                                                 Y02072 39960002
         LA    ENTADDRG,STWOLDNM        POINT TO LOCATION FOR           41040021
*                                       ENTRY TO BE MOVED               41130021
         TM    STWFLAG1,STWCHNG         CHANGE FUNCTION                 41220021
         BNO   DATEST                   GO MOVE THE PARAMETER           41310021
         SPACE 2                                                        41400021
*********************************************************************** 41490021
****                                                               **** 41580021
****     WITH A CHANGE REQUEST THIS SECTION DETERMINES WHICH       **** 41670021
****     ENTRY IS THE LOWEST IN ALPHANUMERIC SEQUENCE SO           **** 41760021
****     THE FIRST SEARCH IS ON THAT ENTRY                         **** 41850021
****                                                               **** 41940021
*********************************************************************** 42030021
         USING STOW,PARMRG2             ESTABLISH ADDRESSABILITY        42120002
         LR    PARMRG0,PARMRG2          SAVE THE PARM. ADDR.    A50697  42170021
         CLC   STONAME,STOCHANG         COMPARE OLD ENTRY NAME TO NEW   42210002
*                                       ENTRY NAME                      42300021
         BH    OLDHIGH                  BRANCH IF OLD NAME IS HIGHER    42390021
         OI    STWFLAG1,STWCHNG+STWDEL  INDICATE DELETE FUNCTION        42480021
*                                       TO BE PERFORMED FIRST           42570021
         ST    PARMRG2,STWPARM          SAVE ADDRESS OF OLD NAME        42660021
         LA    PARMRG2,STOCHANG         POINT TO NEW NAME               42750002
         ST    PARMRG2,STWHIGH          SAVE ADDRESS OF NEW NAME        42840021
         B     POINTOLD                 GO SAVE BOTH NAMES              42930021
         SPACE                                                          43020021
OLDHIGH  EQU   *                                                        43110021
         OI    STWFLAG1,STWCHNG+STWADD  INDICATE ADD FUNCTION TO        43200021
*                                       BE PERFORMED FIRST              43290021
         ST    PARMRG2,STWHIGH          SAVE ADDRESS OF OLD NAME        43380021
         LA    PARMRG2,STOCHANG         POINT TO NEW NAME               43470002
         ST    PARMRG2,STWPARM          SAVE NEW NAME ADDRESS           43560021
         SPACE                                                          43650021
POINTOLD EQU   *                                                        43740021
         LPR   PARMRG2,PARMRG0          POINT TO PARAMETER              43830021
*                                       ENTRY TO BE ACTED UPON          43920021
         MVC   STWOLDNM(L'STWOLDNM+L'STWNEWNM),STONAME  SAVE THE        44010002
*                                       USER' PARAMETER FOR CHANGE      44100021
         B     BUILDIO                  GO BUILD THE I/O                44190021
         SPACE 2                                                        44280021
*********************************************************************** 44370021
****                                                               **** 44460021
****     THIS SECTION MOVES THE USER'S PARAMETER TO THE WORK AREA  **** 44550021
****                                                               **** 44640021
*********************************************************************** 44730021
DATEST   EQU   *                                                        44820021
         LA    TTRCRG,L'STONAME         LENGTH TO BE MOVED              44910002
         ST    PARMRG2,STWPARM          SAVE THE ENTRY ADDRESS          45000021
         TM    STWFLAG1,STWDEL          DELETE FUNCTION                 45090021
         BO    MOVEUSER                 YES GO MOVE ITS ENTRY           45180021
         IC    TTRCRG,STOCTTRN          GET THE AMOUNT OF USER DATA     45450002
         SLL   TTRCRG,27                CLEAR ALIAS BIT                 45540002
         SRL   TTRCRG,26                RESTORE, MULTIPLY BY TWO        45630002
         LA    TTRCRG,STOLNGMV(TTRCRG)  ADD NAME AND TTR LENGTH         45720002
         LA    ENTADDRG,STWNEWNM        POINT TO AREA FOR ENTRY         45810021
*                                       TO BE MOVED                     45900021
         SPACE                                                          45990021
MOVEUSER EQU   *                                                        46080021
         BCTR  TTRCRG,0                 PREPARE FOR EXECUTE             46170002
         EX    TTRCRG,MOVEPARM          MOVE THE USER'S ENTRY           46260021
         TM    STWFLAG1,STWCHNG+STWDEL  CHANGE OR DELETE FUNCTION       46350021
         BM    BUILDIO                  IF YES, BRANCH                  46440021
         TM    STWCTTRN,STWALIAS        ALIAS BIT ON                    46530021
         BO    BUILDIO                  IF YES, BRANCH                  46620021
         MVC   STWTTR,DCBRELAD          SAVE THE RELATIVE ADDR.         46710021
         MVC   STWCTTRN,STOCTTRN        GET THE USER'S LENGTH           46800002
         SPACE 2                                                        46890021
*********************************************************************** 46980021
****                                                               **** 47070021
****     THIS SECTION BUILDS THE ECB IOB AND CHANNEL PROGRAMS      **** 47160021
****     THAT WILL BE USED BY STOW.                                **** 47250021
****                                                               **** 47340021
*********************************************************************** 47430021
         SPACE 2                                                        47520021
****                                                                    47610021
****     THIS PART BUILDS THE ECB AND THE IOB                           47700021
****                                                                    47790021
BUILDIO  EQU   *                                                        47880021
         DROP  PARMRG2                  DROP ADDRESSABILITY             47970021
         SR    R15,R15                  CLEAR FOR ECB                   48060021
         SR    R0,R0                    CLEAR FOR IOB SENSE             48150021
         LA    R1,ECB                   POINT TO THE ECB                48240021
         SR    R2,R2                    CLEAR FOR IOB CHANNEL           48330021
         LA    R4,STWINCP               POINT TO THE CHANNEL PROG       48420021
         LR    R5,DCBRG11               GET THE DCB ADDRESS      Y02072 48690002
         SR    R6,R6                    CLEAR FOR RESTART ADDR          48780021
         SR    R7,R7                    CLEAR FOR BLOCK COUNT           48870021
         LM    R8,R9,DEBBASND+(DEBBINUM-DEBDASD)  GET DATA SET          48960021
*                                       STARTING BBCCHH FROM THE DEB    49050021
         DROP  RDEB                     DROP DEB BASE REGISTER   Y02072 49100002
         SRDL  R8,16                    SET EXTENT NUMBER TO ZERO       49140002
         SLDL  R8,8                     SET RECORD NUMBER TO ZERO       49230002
         STM   R15,R9,ECB               STORE REGISTERS TO CREATE       49320021
*                                       THE ECB AND IOB                 49410021
         OI    IOBFLAG1,IOBUNREL+IOBSPSVC  SET UNRELATED AND NO  Y02072 49590002
*                                       APPENDAGE PROCESS. FLAGS Y02072 49640002
         SPACE 2                                                        49680021
****                                                                    49770021
****     THIS PART BUILDS THE CHANNEL PROGRAMS                          49860021
****                                                                    49950021
         LM    R14,R9,CHNLPRG1          LOAD SKELETON CHANNEL PROGRAM   50040021
         AR    R14,R10                  ESTABLISH ADDRESSING            50130021
*                                       FOR SEARCH ID                   50220021
         AR    R0,R10                   ESTABLISH TRANSFER ADDR         50310021
         AR    R2,R10                   ADDRESSING FOR READ COUNT       50400021
         A     R4,STWPARM               POINT TO USER ENTRY             50490021
         AR    R6,R10                   ESTABLISH ADDRESSING            50580021
         AR    R8,R10                   ESTABLISH ADDRESSING            50670021
         STM   R14,R9,STWINCP           STORE REGISTERS TO CREATE       50760021
*                                       PARTIAL CHANNEL PROGRAM         50850021
         LM    R14,R15,RDCTKDA          LOAD REST OF SKELETON           50940021
*                                       CHANNEL PROGRAM                 51030021
         AR    R14,R10                  ESTABLISH ADDRESSING            51120021
         STM   R14,R15,STWRCKD1         COMPLETE CHANNEL PROGRAM        51210021
         SPACE                                                          51300021
CSWTEST  EQU   *                                                        51390021
         BAL   LINKRG,EXCPSTW           GO EXECUTE CHANNEL PROG         51480021
         SPACE 2                                                        51570021
*********************************************************************** 51660021
****                                                               **** 51750021
****     THIS SECTION SEARCHES FOR ENTRY IN THE DIRECTORY          **** 51840021
****     THAT IS EQUAL OR HIGHER THAN THE REQUESTER'S PARAMETER    **** 51930021
****                                                               **** 52020021
*********************************************************************** 52110021
         LA    BUFADRG,STWBUF1          POINT TO THE FIRST BUFFER       52200021
         USING BUFFER,BUFADRG           ESTABLISH ADDRESSABILITY        52290021
         LA    DIRSCNRG,BUFENTRY        POINT TO FIRST ENTRY            52380021
         L     ENTADDRG,STWPARM         GET ADDRESS OF ENTRY IN         52470021
*                                       USER'S AREA                     52560021
         TM    STWFLAG1,STWFLOW         FIRST TIME THROUGH              52650021
         BNO   DIRSCAN                  YES, GO SEARCH DIRECTORY        52740021
         L     ENTADDRG,STWHIGH         NO, POINT TO SECOND ENTRY       52830021
         SPACE                                                          52920021
DIRSCAN  EQU   *                                                        53010021
         CLC   0(L'STONAME,DIRSCNRG),0(ENTADDRG)  COMPARE ENTRY         53100002
*                                       NAME USER SUPPLIED TO ONE       53190021
*                                       IN THE DIRECTORY                53280021
         BNL   TSTRQST                  ENTRY IN DIRECTORY EQUAL        53370021
*                                       OR HIGH, BRANCH                 53460021
         USING PDS2,DIRSCNRG            ESTABLISH ADDRESSABILITY        53550002
         IC    TTRCRG,PDS2INDC          GET C OF TTRC FOR THIS ENTRY    53640002
         SLL   TTRCRG,27                CLEAR TTR AND ALIAS BITS        53730002
         SRL   TTRCRG,26                RESTORE AND MULTIPLY BY TWO     53820002
         LA    DIRSCNRG,PDS2USRD(TTRCRG)  POINT TO NEXT ENTRY IN THE    53910002
*                                       DIRECTORY                       54000002
         B     DIRSCAN                  GO LOOK AT NEXT ENTRY           54090021
         SPACE 2                                                        54180021
*********************************************************************** 54270021
****                                                               **** 54360021
****     THIS SECTION TESTS THE VALIDITY OF THE USER'S REQUEST     **** 54450021
****                                                               **** 54540021
*********************************************************************** 54630021
TSTRQST  EQU   *                                                        54720021
         BE    EQLENT                   IF COMPARE OF ENTRIES WAS       54810021
*                                       EQUAL, BRANCH                   54900021
         TM    STWFLAG1,STWFLOW         FIRST TIME THROUGH              54990021
         BNO   DELETFUN                 YES, BRANCH                     55080021
         TM    STWFLAG1,STWCHNG+STWADD  CHANGE-ADD TO BE PERFORMED      55170021
         BO    EREXIT1                  YES, GO RETURN TO USER          55260021
         B     SAVEOFF                  GO SAVE THE OFFSET              55350021
         SPACE                                                          55440021
DELETFUN EQU   *                                                        55530021
         TM    STWFLAG1,STWDEL          DELETE FUNCTION                 55620021
         BO    EREXIT1                  YES, RETURN TO USER             55710021
         TM    STWFLAG1,STWREPL         REPLACE FUNCTION                55800021
         BNO   SAVEOFF                  NO, BRANCH                      55890021
         MVI   STWRTN,NONAME            INDICATE ENTRY COULD NOT        55980021
*                                       BE FOUND IN THE DIRECTORY       56070021
         XI    STWFLAG1,STWREPL+STWADD  CHANGE FUNCTION TO ADD          56160021
         B     SAVEOFF                  GO SAVE OFFSET                  56250021
         SPACE                                                          56340021
EQLENT   EQU   *                                                        56430021
         TM    STWFLAG1,STWFLOW         FIRST TIME THROUGH              56520021
         BNO   ADDTEST                  YES, BRANCH                     56610021
         TM    STWFLAG1,STWCHNG+STWDEL  CHANGE-DELETE REQUESTED         56700021
         BO    ER4EXIT                  YES, RETURN TO USER             56790021
         B     MAYBEREP                 GO SAVE USER DATA               56880021
         SPACE                                                          56970021
ADDTEST  EQU   *                                                        57060021
         TM    STWFLAG1,STWADD          ADD FUNCTION                    57150021
         BNO   CHNGTEST                 NO, BRANCH                      57240021
         SPACE                                                          57330021
ER4EXIT  EQU   *                                                        57420021
         LA    SAVECDRG,NMEXIST         SET RETURN CODE                 57510021
         B     EREXIT2                  RETURN TO USER                  57600021
         SPACE                                                          57690021
CHNGTEST EQU   *                                                        57780021
         TM    STWFLAG1,STWREPL+STWCHNG CHANGE OR REPLACE               57870021
         BZ    SAVEOFF                  NO, GO SAVE OFFSET              57960021
         SPACE 2                                                        58050021
*********************************************************************** 58140021
****                                                               **** 58230021
****     THIS SECTION SAVES THE TTR AND USER DATA FROM THE         **** 58320021
****     ENTRY IN THE DIRECTORY BLOCK                              **** 58410021
****                                                               **** 58500021
*********************************************************************** 58590021
MAYBEREP EQU   *                                                        58680021
         USING PDS2,DIRSCNRG            ESTABLISH ENTRY ADDR            58770002
         TM    STWFLAG1,STWREPL         REPLACE FUNCTION                58860021
         BNO   SAVENTRY                 NO, SAVE ENTRY FOR CHANGE       58950021
         TM    STWFLAG1,STWDCBWR        LAST OPERATION A WRITE          59040021
         BO    SAVEOFF                  YES, GO SAVE OFFSET             59130021
         TM    STWCTTRN,STWALIAS        IS ENTRY AN ALAIS       XA02068 59132002
         BO    SAVEOFF                  YES, USE TTR SUPPLIED   XA02068 59134002
*                                       BY THE USER             XA02068 59136002
         MVC   STWTTR,PDS2TTRP          SAVE TTR FROM OLD ENTRY         59220002
         B     SAVEOFF                  GO SAVE OFFSET                  59310021
         SPACE                                                          59400021
SAVENTRY EQU   *                                                        59490021
         IC    TTRCRG,PDS2INDC          GET C OF THE TTRC FOR           59580002
*                                       THIS ENTRY                      59670021
         SLL   TTRCRG,27                CLEAR TTR AND ALIAS BITS        59760002
         SRL   TTRCRG,26                RESTORE AND MULTIPLY BY TWO     59850002
         LA    TTRCRG,(PDS2USRD-PDS2TTRP)-1(TTRCRG)  SET LENGTH TO MOVE 59940002
*                                       THE TTRC AND USER DATA          60030002
         LA    ENTADDRG,STWTTR          POINT IN WORK AREA TO           60120021
*                                       RELATIVE ADDR. FOR ENTRY        60210021
         EX    TTRCRG,MVTTRDAT          SAVE THE ENTRY'S TTRC           60300021
*                                       AND USER DATA                   60390021
         B     SAVEOFF                  GO SAVE THE OFFSET              60480021
         SPACE 2                                                        60570021
*********************************************************************** 60660021
****                                                               **** 60750021
****     THIS SECTION IS ENTERED WHEN AN ERROR IS DETECTED         **** 60840021
****     AND CONTROL IS TO BE PASSED TO THE USER                   **** 60930021
****                                                               **** 61020021
*********************************************************************** 61110021
EREXIT1  EQU   *                                                        61200021
         LA    SAVECDRG,NONAME          SET RETURN CODE                 61290021
         SPACE                                                          61380021
EREXIT2  EQU   *                                                        61470021
         SR    RWRK1,RWRK1              CLEAR FOR REASON CODE    Y02072 61520002
         SPACE                                                          61530002
EREXIT3  EQU   *                                                 Y02072 61540002
         FREEMAIN  R,LV=CORESIZE,A=(WRKARG),SP=229  FREE CORE    Y02072 61830002
         SPACE                                                          61832002
         LR    R0,RWRK1                 GET THE REASON CODE      Y02072 61840002
         LR    RTNRG,SAVECDRG           GET THE RETURN CODE      YM0943 61880001
         B     RTRNUSR2                 RETURN TO THE CALLER     Y02072 61920002
         SPACE 2                                                        62010021
*********************************************************************** 62100021
****                                                               **** 62190021
****     THIS SECTION ISSUES THE EXCP AND TESTS FOR                **** 62280021
****     A SUCCESSFUL COMPLETION                                   **** 62370021
****                                                               **** 62460021
*********************************************************************** 62550021
EXCPSTW  EQU   *                                                        62640021
         EXCP  IOBSTDRD                 EXECUTE THE CHANNEL PROG        62730021
         TM    ECBCC,ECBPOST            HAS ECB BEEN POSTED    @ZA12202 62820037
         BO    BYWAIT                   BYPASS WAIT SVC        @ZA12202 62840037
         WAIT  ECB=ECBCC                WAIT FOR PROGRAM                62860037
BYWAIT   EQU   *                                               @ZA12202 62880037
         TM    ECBCC,ECBNORM            SUCCESSFUL COMPLETION           62910021
         BCR   1,LINKRG                 YES, RETURN TO MAIN LINE        63000021
         NI    DCBIFLGS,X'FF'-DCBIFEC   TURN OFF ERROR FLAGS     Y02072 63050002
         TM    IOBCSW+3,UNITEXCP        UNIT EXCEPTION                  63090002
         BCR   1,LINKRG                 YES, RETURN TO MAIN LINE        63180021
         LA    RWRK1,DIRECTRY           READ ERROR REASON CODE   Y02072 63230002
         LA    SAVECDRG,IOERRCD         SET IO ERROR CODE               63270021
         B     EREXIT3                  RETURN TO USER           Y02072 63360002
         SPACE 2                                                        63450021
*********************************************************************** 63540021
****                                                               **** 63630021
****     THIS SECTION WILL ESTABLISH THE NEW KEY TO SEARCH         **** 63720021
****     ON FOR THE CHANGE FUNCTION                                **** 63810021
****                                                               **** 63900021
*********************************************************************** 63990021
SETFRST  EQU   *                                                        64080021
         OI    STWFLAG1,STWFLOW         INDICATE SECOND TIME THROUGH    64170021
         L     ENTADDRG,STWHIGH         POINT TO THE HIGH NAME          64260021
*                                       IN USER'S AREA                  64350021
         MVC   STWKYAD1,STWHIGH+1       SET NEW SEARCH KEY              64440021
         B     CSWTEST                  GO ISSUE EXCP                   64530021
         SPACE 2                                                        64620021
*********************************************************************** 64710021
****                                                               **** 64800021
****     THIS SECTION OF CODE SAVES THE OFFSET OF THE ENTRY INTO   **** 64890021
****     THE INPUT BUFFER.                                         **** 64980021
****                                                               **** 65070021
*********************************************************************** 65160021
SAVEOFF  EQU   *                                                        65250021
         SR    DIRSCNRG,BUFADRG         DETERMINE OFFSET                65340021
         TM    STWFLAG1,STWFLOW         FIRST TIME THROUGH              65430021
         BO    NEXTLOAD                 NO, GO TO DETERMINE NEXT LOAD   65520021
         STH   DIRSCNRG,STWOFFLW        SAVE THE FIRST ENTRY OFFSET     65610021
         TM    STWFLAG1,STWCHNG         CHANGE FUNCTION                 65700021
         BO    SETFRST                  YES, RETURN TO MAINLINE         65790021
         DROP  RSVRB                    DROP SVRB BASE REGISTER  Y02072 65840002
         SPACE 2                                                        65880021
*********************************************************************** 65970021
****                                                               **** 66060021
****     THIS SECTION BRANCHES TO THE SECOND LOAD.                 **** 66150003
****                                                               **** 66240021
*********************************************************************** 66330021
NEXTLOAD EQU   *                                                        66420021
         L     R15,V210A                ADDRESS OF NEXT LOAD   @Z30TSMI 67140003
         BR    R15                      BRANCH TO NEXT LOAD    @Z30TSMI 67150003
         SPACE 2                                                        67190002
****                                                                    67200002
****     ESTABLISH THE ESTAE EXIT BOOTSTRAP ROUTINE.                    67210002
****                                                                    67220002
EXITRTN  IGGSTAE STOWTRR                EST AN EXIT ROUTINE      Y02072 67222002
         EJECT                                                          67230021
*********************************************************************** 67320021
****                                                               **** 67410021
****     SKELETON CHANNEL PROGRAMS                                 **** 67500021
****                                                               **** 67590021
*********************************************************************** 67680021
CHNLPRG1 DS    0F                       THIS CHANNEL PROGRAM IS USED TO 67770021
*                                       READ TWO DIRECTORY BLOCKS       67860021
RDSRCHID DC    X'31'                    SEARCH ID EQUAL                 67950021
         DC    AL3(IOBCC-STWAREA)       ADDRESS OF SEARCH ARGUMENT      68040021
         DC    X'4000'                  COMMAND CHAINING                68130021
         DC    X'0005'                  NO. OF BYTES                    68220021
RDSRCTIC DC    X'08'                    TRANSFER CONTROL                68310021
         DC    AL3(STWSRCH1-STWAREA)    ADDR OF SEARCH ID               68400021
         DC    XL4'00'                  NOT USED, BUT REQUIRED          68490021
RDCOUNT  DC    X'92'                    READ COUNT                      68580021
         DC    AL3(STWBUF1-STWAREA)     ADDR. FOR COUNT                 68670021
         DC    X'4000'                  COMMAND CHAINING                68760021
         DC    X'0008'                  NO. OF BYTES TRANSFERED         68850021
RDSRCHKY DC    X'E9'                    SEARCH KEY EQUAL- HIGH          68940021
         DC    AL3(0)                   ADDR OF USER PARAMETER          69030021
         DC    X'4000'                  COMMAND CHAINING                69120021
         DC    X'0008'                  NO. BYTES TO SEARCH ON          69210021
RDSRCHTC DC    X'08'                    TRANSFER CONTROL                69300021
         DC    AL3(STWRDCT1-STWAREA)    ADDR. OF READ COUNT             69390021
         DC    XL4'00'                  NOT USED BUT REQUIRED           69480021
RDRDDATA DC    X'86'                    READ DATA                       69570021
         DC    AL3(STWBUF1+L'BUFCNT+L'BUFKEY-STWAREA)  ADDR. FOR DATA   69660021
         DC    X'4000'                  COMMAND CHAINING                69750021
         DC    X'0100'                  NO. OF BYTES TRANSFERED         69840021
RDCTKDA  DC    X'9E'                    READ COUNT KEY DATA             69930021
         DC    AL3(STWBUF2-STWAREA)     ADDR. FOR COUNT KEY DATA        70020021
         DC    X'0000'                  NO FLAGS                        70110021
         DC    X'0110'                  NO. OF BYTES TRANSFERED         70200021
         SPACE 2                                                        70290021
*********************************************************************** 70380021
****                                                               **** 70470021
****     DEFINED CONSTANTS                                         **** 70560021
****                                                               **** 70650021
*********************************************************************** 70740021
MOVEPARM MVC   0(0,ENTADDRG),0(PARMRG2) MOVE USER PARAMETER TO          71010021
*                                       WORK AREA                       71100021
MVTTRDAT MVC   0(0,ENTADDRG),L'PDS2NAME(DIRSCNRG) MOVE USER DATA FROM   71190002
*                                       DIRECTORY TO WORK AREA          71280021
V210A    DC    V(IGG0210A)              ADDRESS OF NEXT LOAD   @Z30TSMI 71290003
STOWTRR  DC    CL8'IGCT0021'            STOW ESTAE ROUTINE NAME  Y02072 71330002
ESTALIST ESTAE EXITRTN,RECORD=YES,MF=L  LIST FORM OF ESTAE MACRO Y02072 71332002
ESTAELEN EQU   *-ESTALIST               LENGTH OF ESTAE LIST     Y02072 71334002
         DC    C'@ZA12202'              MODULE ID              @ZA12202 71334637
         DC    CL8'&SYSDATE'            LATEST DATE            @ZA12202 71335237
PATCH    DC    0XL50'0',C'IGC0002A',42X'0'  50 BYTE PATCH AREA   Y02072 71336002
         EJECT                                                          72990021
*********************************************************************** 73040002
****                                                               **** 73050002
****     CONTROL BLOCK DEFINITIONS                                 **** 73090002
****                                                               **** 73140002
*********************************************************************** 73190002
         SPACE                                                          73240002
         CVT   DSECT=YES                                                73290002
         EJECT                                                          73340002
         DCBD  DSORG=PO,DEVD=DA                                         89460021
         EJECT                                                          89550021
         IEZDEB                                                         89690002
         EJECT                                                          89692002
         IHAPDS PDSBLDL=NO                                              89694002
         EJECT                                                          89730021
         IHARB                                                   Y02072 89820002
         EJECT                                                          90770002
         IHASDWA                                                 Y02072 90820002
         EJECT                                                          90822002
         IHASTOW                                                        90824002
         EJECT                                                          90870002
         IKJTCB                                                  Y02072 90880002
         EJECT                                                          90890002
         IGGSTW                                                  Y02072 90892002
         END                                                            90900021
./  ADD  SSI=80950536,NAME=IGC018
IGC018   CSECT                                                          00020002
         TITLE 'IGC018 - FIND/BLDL AND TTR CONVERT ROUTINES'            00021002
*********************************************************************** 00621002
*                                                                     * 00622002
* MODULE NAME = IGC018                                                * 00623002
*                                                                     * 00624002
* DESCRIPTIVE NAME = BLDL/FIND                                        * 00625002
*                                                                     * 00626002
* COPYRIGHT = NONE                                                    * 00627002
*                                                                     * 00628002
* STATUS = RELEASE VS 2/2 - LEVEL 001                                 * 00629002
*                                                                     * 00630002
* FUNCTION- THIS RESIDENT MODULE SEARCHES A DIRECTORY OF A PO         * 00720002
*           DATA SET FOR A NAME OR LIST OF NAMES, AND RETURNS         * 00740002
*           INFORMATION STORED IN THE DIRECTORY ASSOCIATED WITH EACH  * 00760002
*           NAME. THE FORMAT OF THE DIRECTORY AND OF THE RETURNED     * 00780002
*           INFORMATION IS DESCRIBED BY THE MAPPING MACRO IHAPDS.     * 00800002
*                                                                     * 00820002
*           IT WILL ALSO SEARCH A CONCATENATED SERIES OF DIRECTORIES  * 00840002
*           UNDER ANY OF THE FOLLOWING CONDITIONS:                    * 00860002
*           1. THE USER HAS SUPPLIED A DCB OPENED FOR CONCATENATED    * 00880002
*              BPAM INPUT.                                            * 00900002
*           2. THE USER HAS NOT SUPPLIED A DCB.  IN THIS CASE         * 00920002
*              EITHER JOBLIB OR STEPLIB, (THEMSELVES PERHAPS          * 00940002
*              CONCATENATED) FOLLOWED BY LINKLIB WILL BE SEARCHED.    * 00960002
*           3. THE USER HAS SUPPLIED A DCB FOR SVCLIB, AND AN SVC     * 00980002
*              RESIDENT BLDL TABLE IS AVAILABLE; OR BLDL IS SEARCHING * 01000002
*              LINKLIB AND A LINKLIB RESIDENT BLDL TABLE IS AVAILABLE.* 01020002
*              IN THESE CASE THE RESIDENT TABLE WILL BE 'CONCATENATED'* 01040002
*              AHEAD OF THE DIRECTORY TO BE SEARCHED.                 * 01060002
*                                                                     * 01080002
*           THIS MODULE ALSO CONTAINS ENTRY POINTS TO ROUTINES WHICH  * 01100002
*           CONVERT AN ABSOLUTE DIRECT ACCESS ADDRESS, MBBCCHHR, TO   * 01120002
*           AND FROM ITS RELATIVE EQUIVALENT, TTR.                    * 01140002
*                                                                     * 01160002
* NOTES = NONE                                                        * 01161002
*                                                                     * 01162002
*    DEPENDENCIES = NONE                                              * 01163002
*                                                                     * 01164002
*    RESTRICTIONS = NONE                                              * 01165002
*                                                                     * 01166002
*    REGISTER CONVENTIONS = SEE REGISTER EQUATES                      * 01167002
*                                                                     * 01168002
* PATCH LABEL = NONE                                                 *  01169002
*                                                                     * 01170002
* MODULE TYPE = SVC ROUTINE                                           * 01171002
*                                                                     * 01172002
*    PROCESSOR = ASSEMBLER XF                                         * 01173002
*                                                                     * 01174002
*    ATTRIBUTES = REFRESHABLE, ENTERED ENABLED, KEY ZERO,             * 01177002
*                 LOCAL LOCK HELD.                                    * 01178002
*                                                                     * 01179002
* ENTRY POINTS- IGC018                                                * 01180002
*                                                                     * 01180202
*    PURPOSE- ENTERED FROM SVC SUPERVISOR AFTER MAINLINE CODE ISSUES  * 01181002
*             SVC 18.                                                 * 01220002
*                                                                     * 01221002
*    LINKAGE- A CALLING SEQUENCE IS GENERATED BY ONE OF THE           * 01222002
*             FOLLOWING MACROS:                                       * 01240002
*                                                                       01260002
*                    FIND  DCBADDR,NAMEADDR        FIND MACRO           01280002
*                                                                       01300002
*                    LA    0,NAMEADDR                                   01320002
*                    LA    1,DCBADDR                                    01340002
*                    LCR   1,1                                          01360002
*                    SVC   18                                           01380002
*                                                                       01400002
*                    BLDL  DCBADDR,LISTADDR        BLDL MACRO           01420002
*                                                                       01440002
*                    LA    0,LISTADDR                                   01460002
*                    LA    1,DCBADDR                                    01480002
*                    SVC   18                                           01500002
*                                                                     * 01501002
*    INPUT- IN ADDITION TO THE INPUTS SHOWN ABOVE THE SVC SUPERVISOR  * 01502002
*           SETS UP THE FOLLOWING REGISTERS:                          * 01503002
*           REGISTER 3 CVT POINTER                                    * 01504002
*           REGISTER 4 TCB POINTER                                    * 01505002
*           REGISTER 5 SVRB POINTER                                   * 01506002
*           REGISTER 14 RETURN ADDRESS                                * 01507002
*           REGISTER 15 ENTRY ADDRESS                                 * 01508002
*                                                                     * 01509002
*    OUTPUT- THE LIST FILLED IN WITH INFORMATION FROM THE DIRECTORY   * 01510002
*            BLOCK FROM BLDL.  FROM FIND THE TTR IS PASSED TO THE     * 01511002
*            POINT ROUTINE AND IT UPDATES THE DCB AND IOB.            * 01512002
*                                                                     * 01513002
*    EXIT NORMAL- BRANCH TO THE ADDRESS IN REGISTER 14 ON ENTRY       * 01514002
*                 REGISTER 15  CONTAINS A 0                           * 01514202
*                                                                     * 01515002
*    EXIT ERROR - SAME AS EXIT NORMAL EXCEPT REGISTER 15 AND 0        * 01516002
*                 CONTAIN THE FOLLOWING CONDITION CODES:              * 01517002
*                 * REGISTER 15 * REGISTER 0 *   ERROR CONDITION      * 01518002
*                 *    04       *    00      *  PARTIAL LIST          * 01519002
*                 *    08       *    00      *  PERMANENT I/O ERROR   * 01520002
*                 *    08       *    04      *  GETMAIN ERROR         * 01521002
*                 *    08       *    08      *  INVALID DEB  @ZA25435 * 01522037
*                                                                     * 01524002
* ENTRY POINT = EXITRTN                                               * 01525002
*                                                                     * 01526002
*    PURPOSE = ENTERED FROM RTM VIA A SYNCH IN KEY ZERO ENABLED       * 01527002
*              WHEN THERE IS AN ATTEMPT TO ABNORMALLY TERMINATE THE   * 01528002
*              RB LEVEL ON WHICH THIS SVC IS ACTIVE.  THIS ROUTINE    * 01529002
*              WILL FIND THE ADDRESS OF THE TRR BY ISSUING A LOAD.    * 01530002
*              IT WILL ALSO FILL IN SDWACSCT AND SDWAREXN.            * 01531002
*                                                                     * 01533002
*    LINKAGE = REGISTER 0 - CODE.  IF 12 NO RTCA IS PASSED            * 01534002
*              REGISTER 1 - ADDRESS OF THE RTCA.                      * 01535002
*              REGISTER 13 - ADDRESS OF A 18 FULLWORD SAVE AREA.      * 01536002
*              REGISTER 14 - RETURN ADDRESS                           * 01537002
*              REGISTER 15 - ADDRESS OF THE BOOTSTRAP ROUTINE.        * 01538002
*                                                                     * 01539002
*    INPUT = RTCA.                                                    * 01540002
*                                                                     * 01541002
*    OUTPUT = REGS AS PASSED FROM RTM EXCEPT 15 SET TO ADDR OF TRR.   * 01542002
*             SDWACSCT SET TO CSECT NAME.                             * 01543002
*             SDWAREXN SET TO TRR NAME.                               * 01544002
*                                                                     * 01545002
*    EXIT - NORMAL = BRANCH TO TRR.                                   * 01546002
*                                                                     * 01547002
*    EXIT - ERROR = A BRANCH ON REGISTER 14 BACK TO RTM IF NO RTCA    * 01548002
*                   PASSED.                                           * 01549002
*                                                                     * 01553002
* ENTRY POINT- IECPRLTV                                               * 01554002
*                                                                     * 01555002
*    PURPOSE- ENTRY TO ROUTINE VIA A BALR THAT CONVERTS AN ABSOLUTE   * 01880002
*             DIRECT ACCESS ADDRESS, MBBCCHHR, INTO ITS RELATIVE      * 01900002
*             EQUIVALENT, TTR0.                                       * 01920002
*                                                                     * 01921002
*    LINKAGE- REGISTER CONVENTIONS UPON ENTRY AND UPON EXIT ARE AS    * 01940002
*             FOLLOWS:                                                * 01960002
*                 REGISTER         ENTRY             EXIT             * 02000002
*                   0          IGNORED            TTR0 RESULT         * 02020002
*                   1          DEB ADDRESS        TRANSPARENT         * 02040002
*                   2          ADDRESS OF         TRANSPARENT         * 02060002
*                                MBBCCHHR IN CORE                     * 02080002
*                   3-8        IGNORED            TRANSPARENT         * 02100002
*                   9-13       IGNORED            DESTROYED           * 02120002
*                   14         RETURN ADDRESS     TRANSPARENT         * 02140002
*                   15         ENTRY ADDRESS      ZERO                * 02160002
*                                                                     * 02180002
*              NOTE: IECPRLTV DOES NOT VALIDITATE THE INPUT           * 02200002
*              MBBCCHHR.  IF M IS LARGER THAN THE NUMBER OF           * 02220002
*              EXTENTS IN THE DEB, CORE BEYOND THE DEB                * 02240002
*              EXTENT SECTION WILL BE REFERENCED AS IF IT             * 02260002
*              CONTAINED VALID EXTENTS.  IF CCHH AS SPECIFIED         * 02280002
*              IS NOT WITHIN THE EXTENT SPECIFIED BY M,               * 02300002
*              AN UNREASONABLE VALUE OF TT WILL RESULT.               * 02320002
*                                                                     * 02321002
*    INPUT- DEB, MBBCCHHR IN CORE                                     * 02322002
*                                                                     * 02323002
*    OUTPUT- TTR0 IN REGISTER 0                                       * 02324002
*                                                                     * 02325002
*    EXIT NORMAL- BRANCH TO THE ADDRESS ON REGISTER 14 ON INPUT       * 02326002
*                                                                     * 02327002
*    EXIT ERROR - N/A NO ERRORS CHECKED FOR (SEE NOTE ABOVE)          * 02328002
*                                                                     * 02329002
* ENTRY POINT- IECPCNVT                                               * 02330002
*                                                                     * 02331002
*    PURPOSE- ENTRY TO ROUTINE VIA A BALR THAT CONVERTS A RELATIVE    * 02360002
*             DIRECT ACCESS ADDRESS AND CONCATENATION NUMBER, TTRN,   * 02380002
*             INTO ITS ABSOLUTE EQUIVALENT, MBBCCHHR.                 * 02400002
*                                                                     * 02401002
*    LINKAGE- REGISTER CONVENTIONS UPON ENTRY AND UPON EXIT ARE AS    * 02420002
*             FOLLOWS:                                                * 02440002
*                                                                     * 02460002
*                 REGISTER         ENTRY             EXIT             * 02480002
*                   0          ACTUAL TTRN        DESTROYED           * 02500002
*                   1          DEB ADDRESS        TRANSPARENT         * 02520002
*                   2          ADDRESS OF 8 BYTE  TRANSPARENT         * 02540002
*                                AREA FOR MBBCCHHR                    * 02560002
*                   3-8        IGNORED            TRANSPARENT         * 02580002
*                   9-13       IGNORED            DESTROYED           * 02600002
*                   14         RETURN ADDRESS     TRANSPARENT         * 02620002
*                   15         ENTRY ADDRESS      ERROR CODE          * 02640002
*                                                                     * 02660002
*                   THE ERROR CODE FOR IECPCNVT WILL BE 0 FOR         * 02680002
*                   SUCCESSFUL CONVERSION, OR 4 IF VALUE OF TT        * 02700002
*                   EXCEEDS TOTAL EXTENTS ASSIGNED.                   * 02720002
*                                                                     * 02721002
*    INPUT- TTRN IN REGISTER 0                                        * 02722002
*                                                                     * 02723002
*    OUTPUT- MBBCCHHR IN CORE LOCATION  POINTED TO BY REGISTER 2      * 02724002
*                                                                     * 02725002
*    EXIT NORMAL- BRANCH TO THE ADDRESS IN REGISTER 14 ON ENTRY       * 02726002
*                 REGISTER 15 = 0                                     * 02727002
*                                                                     * 02728002
*    EXIT ERROR - BRANCH TO THE ADDRESS IN REGISTER 14 ON ENTRY       * 02729002
*                 REGISTER 15 = 4 IF TT EXCEEDS TOTAL EXTENTS         * 02730002
*                                                                     * 02731002
* EXTERNAL REFERENCES                                                 * 02732002
*                                                                     * 02733002
*    ROUTINES - POINT ROUTINE POINTED TO BY DCBPOINT IF A FIND        * 02734002
*               IEAVVMSR LPA SEARCH ROUTINE USED IN EXITRTN.          * 02736002
*                                                                     * 02737002
*    DATA SETS - NONE                                                 * 02738002
*                                                                     * 02739002
*    DATA AREAS - DSCB, CTV, IOB,DCB,SVRB,TCB,DVCT,DEB,ECB            * 02740002
*                 BOOTSTRAP ROUTINE - RTCA,CVT                        * 02742002
*                                                                     * 02743002
*    TABLES - NONE                                                    * 02744002
*                                                                     * 02746002
*    MACROS - ESTAE, MODESET, IGGSTAE, SYNCH, EXCP, WAIT,             * 02747002
*             GETMAIN, FREEMAIN.                                      * 02747202
*                                                                     * 02748002
* CHANGE ACTIVITY                                                     * 02749002
*                                                                     * 02804002
*              RELEASE 19                                             * 02809002
*D                                                               A28189 02814002
*D                                                               A27543 02819002
*D                                                               A25998 02829002
*D                                                               M3387  02839002
*D                                                               M3385  02844002
*D                                                               M4214  02854002
*D                                                               M4612  02859002
*D                                                               M1596  02864002
*                                                                     * 02865002
*              RELEASE 20                                             * 02869002
*D                                                               TS2466 02874002
*D                                                               M1381  02879002
*                                                                     * 02904002
*              RELEASE 21                                             * 02909002
*                                                                     * 02914002
*              VS 1/1                                                 * 02919002
*                                                                XM5845 02924002
*                                                                     * 02929002
*              VS 1/2                                                 * 02934002
*                                                                     * 02939002
*              VS 1/3                                                 * 02944002
*                                                                     * 02949002
*              VS 2/1                                                 * 02954002
*                                                                     * 02959002
*              VS 2/2                                                 * 02964002
*D54200-54800,59000-59800,67800-69600,71200-72000,182800,183600  Y02072 02969002
*                                                               YM01226 02969202
*                                                               YM01287 02969402
*                                                                YM4640 02969502
*A148400-148450,148550,188300                                  @ZA12201 03169537
*C054030-054036                                                @ZA12201 03369537
*C168800                                                       @ZA11127 03469537
*D169000                                                       @ZA11127 03469637
*A039515-039555,057644-057652,058660-058720,142710-142730      @ZA12953 03519637
*C054030                                                       @ZA12953 03569637
*A057646-057647                                                @ZA17048 03649637
*C054030                                                       @ZA17048 03689637
*A041830-046600,057649-057729,066300-066450,142710-142744      @ZA25435 03699637
*C054030,070705                                                @ZA25435 03709637
*C089400,160720-167300,167700-171200                           @ZA26444 03719637
*A160620-160720,347900                                         @ZA26444 03729637
*A169530-169560                                                @ZA27485 03734637
*C054030                                                       @ZA30955 03735637
*D057649-057729,142710-142744                                  @ZA30955 03736437
*A057647-057709,142710-142748                                  @ZA30955 03737237
*A103800-103900                                                @ZA31343 03738037
         EJECT                                                          03740002
*********************************************************************** 03760002
*              EQUATE STATEMENTS                                      * 03780002
*********************************************************************** 03800002
ADDR3    EQU   B'0111'            MASK FOR ICM/STCM FOR 3 BYTE ADDRESS  03820002
CCHN     EQU   X'40'              COMMAND CHAIN IN CCW FLAGS            03840002
HALVE    EQU   1                  SHIFT AMOUNT TO DIVIDE BY 2           03880002
LOBYTE   EQU   X'FF'              MASK FOR LOW ORDER REGISTER BYTE      03900002
PSWPROB  EQU   X'01'              PROBLEM STATE FLAG--PSW+1             03920002
TIMES16  EQU   4                  SHIFT AMOUNT TO MULT BY 16            03940002
PRIVKEY  EQU   7                  KEYS 7 & LOWER ARE SYSTEM KEYS Y02072 03942002
KEYOFFST EQU   4                  VALUE TO SHIFT KEY IN BYTE     Y02072 03947002
KEYMASK  EQU   X'F0'              POSITION OF KEY IN BYTE       YM01226 03949502
DEBPK    EQU   24                 DEB PROTECT KEY DISPLACEMENT @ZA12953 03951537
JLBDCB   EQU   40                 TCB JOBLIB DISPLACEMENT      @ZA12953 03953537
DCBDB    EQU   44                 DCB DEB DISPLACEMENT         @ZA12953 03955537
         SPACE                                                          03960002
*                                 ***CCW OP CODES***                    03980002
TIC      EQU   X'08'              TRANSFER IN CHANNEL                   04000002
SKHEQ    EQU   X'69'              SEARCH KEY EQUAL OR HIGH              04020002
MRC      EQU   X'92'              MULTI-TRACK READ COUNT                04040002
SIDEQ    EQU   X'31'              SEARCH ID EQUAL                       04060002
RD       EQU   X'06'              READ DATA                             04080002
         SPACE                                                          04100002
*                                 ***USER RETURN CODES***               04120002
CNVTERR  EQU   4                  INVALID TT ON TTR TO CCHHR CONVERT    04140002
RCBADLST EQU   4                  LIST COULD NOT BE FILLED              04160002
RCIOERR  EQU   8                  I/O ERROR ON DIRECTORY READ           04180002
RCGETERR EQU   4                  GETMAIN ERROR - IN REGISTER 0  Y02072 04182002
RCDEBERR EQU   8                  INVALID DEB - IN REGISTER 0  @ZA25435 04183037
*                                 IF ON REGISTER 15 MUST BE 8    Y02072 04184002
         EJECT                                                          04200002
*********************************************************************** 04220002
*              REGISTER USAGE                                         * 04240002
*********************************************************************** 04260002
R0       EQU   0                  AT ENTRY, PARM LIST                   04280002
RCSID    EQU   R0                 DURING CCW RELOCATE--SID CCW          04300002
RSCUR    EQU   R0                 RES TAB SRCH--CURRENT TABLE ENTRY NR  04320002
R1       EQU   1                  AT ENTRY, DCB (COMPLEMENTED IF FIND)  04340002
RSMOVE   EQU   R1                 RES TAB SRCH--LENGTH FOR MOVE INSTR   04360002
RCTIC1   EQU   2                  DURING CCW RELOCATE--FIRST TIC        04380002
RCTIC2   EQU   2                  DURING CCW RELOCATE--SECOND TIC       04385002
RSULEFT  EQU   2                  NUMBER OF USER ENTRIES LEFT           04400002
R2       EQU   2                  USED FOR INPUT TO MODESET      Y02072 04402002
RCVT     EQU   3                  COMMUNICATIONS VECTOR TABLE           04420002
RX       EQU   4                  WORK REGISTER                         04440002
RCMRC    EQU   4                  DURING CCW RELOCATE--READ COUNT (M/T) 04460002
RCRD     EQU   4                  DURING CCW RELOCATE--READ DATA        04465002
RSTUB    EQU   4                  RES TAB SRCH--UPPER BOUNDARY NR       04480002
RY       EQU   5                  WORK REGISTER                         04500002
RSTLB    EQU   5                  RES TAB SRCH--LOWER BOUNDARY NR       04520002
R5       EQU   5                  UPPER LIM FOR STM FOR CCW REL  Y02072 04535002
RRB      EQU   6                  SVRB ADDRESS                   Y02072 04540002
RPDS2    EQU   7                  ENTRY IN USER BLDL LIST               04600002
RPDS1    EQU   8                  ENTRY IN DATA SET DIRECTORY           04620002
RRENT    EQU   8                  ENTRY IN RES BLDL TABLE               04640002
R8       EQU   8                  WORK REG                     @ZA25435 04660037
RDEB     EQU   9                  POINTER TO DEB                        04680002
RRES     EQU   9                  BEGINNING OF RES BLDL TABLE           04700002
R9       EQU   9                  LOWER LIMIT FOR STM IN SRC PDS Y02072 04705002
RLIST    EQU   10                 BLDL OR FIND PARAMETER LIST           04720002
RDCB     EQU   11                 LINKLIB,TASKLIB,SVCLIB, OR USER DCB   04760002
*                                 (TASKLIB INCLUDES JOBLIB OR STEPLIB)  04780002
RBASE    EQU   12                 PROGRAM BASE                          04820002
RAREA    EQU   13                 BLDL/FIND WORK AREA                   04840002
RRET     EQU   14                 RETURN REGISTER FROM MAJOR FUNCTIONS  04860002
RZ       EQU   14                 WORK REGISTER                         04865002
RSUBR    EQU   14                 SUBROUTINE RETURN REGISTER            04870002
R15      EQU   15                 AT EXIT, RETURN CODE                  04880002
RSTLEFT  EQU   R15                RES TAB SRCH--NR OF TABLE ENTS LEFT   04900002
         SPACE 3                                                        04920002
*              REGISTERS FOR TTR CONVERT ROUTINES                       04940002
*              NOTE: REGISTERS FOR THE SECTOR CONVERT ROUTINE           04960002
*                    ARE LISTED WITH THAT ROUTINE                       04980002
RGTTR    EQU   0                  TTR. (INPUT--CNVT, OUTPUT--RLTV)      05000002
RGDEB    EQU   1                  POINTER TO USER DEB                   05020002
RGMBB    EQU   2                  POINTER TO MBBCCHHR (FILLED BY CNVT)  05040002
RGV      EQU   9                  WORK REGISTER                         05060002
RGW      EQU   10                 WORK REGISTER                         05080002
RGX      EQU   11                 WORK REGISTER                         05100002
RGY      EQU   12                 WORK REGISTER                         05120002
RGZ      EQU   13                 WORK REGISTER                         05140002
         EJECT                                                          05160002
IGC018   CSECT                                                          05180002
         ENTRY SVC018                                                   05200002
SVC018   EQU *                                                          05220002
*********************************************************************** 05240002
*        SVC ENTRY POINT TO BLDL OR FIND                              * 05260002
*                                                                     * 05280002
*        THE FUNCTIONS ARE DISTINGUISHED BY R1 COMPLEMENTED FOR FIND  * 05300002
*********************************************************************** 05320002
         SPACE 2                                                        05340002
         BALR  RBASE,0            ESTABLISH BASE FOR CODE               05360002
         USING BASE1,RBASE                                              05380002
BASE1    EQU   *                                                        05400002
         B     BEGIN                   BRANCH AROUND MODULE ID   YM4640 05401002
         DC    C'IGC018  '             MODULE NAME               YM4640 05402002
         DC    C'@ZA30955'             LAST SHIP CODE          @ZA30955 05403037
         DC    C'&SYSDATE'             LAST SHIP DATE          @ZA12201 05403637
BEGIN    DS    0H                      END OF MODULE ID          YM4640 05404202
         LR    RRB,R5             SVRB ADDRESS FROM SVC SLIH     Y02072 05405002
         USING RBBASIC,RRB                                       Y02072 05410002
         USING CVT,RCVT           CVT POINTER FROM SVC SLIH      Y02072 05410402
         XC    RBEXSAVE,RBEXSAVE  CLEAR EXTENDED SAVE AREA       Y02072 05410602
         ST    RRET,EXSRET        SAVE RETURN ADDRESS            Y02072 05411402
         MVC   EXSESTAE(EXSELEN),ESTAEL MOVE IN ESTAE LIST       Y02072 05412002
*                                                                       05412402
*        THE EXTAE MACRO WILL PASS THE BOOTSTRAP ROUTINE ADDRESS        05412802
*        TO RTM.                                                        05413202
*                                                                       05413602
         ESTAE PARAM=(RRB),MF=(E,EXSESTAE)                       Y02072 05414002
         LM    R0,R1,RBGRS0       RESTORE INPUT REGISTERS        Y02072 05419002
         LTR   R1,R1              INPUT REG NEGATIVE(FIND)       Y02072 05419102
         BM    MODE1              YES                            Y02072 05419502
         OI    EXSFLG,EXSBLDL     TURN ON BLDL FLAG              Y02072 05421902
MODE1    EQU   *                                                 Y02072 05422902
         L     R2,RBLINK          ADDRESS OF CALLER RB           Y02072 05423502
         IC    R2,RBOPSW-RBBASIC+1(R2) GET CALLER KEY            Y02072 05425502
         STC   R2,EXSKEY          SAVE CALLER KEY                Y02072 05425902
         MODESET KEYADDR=EXSKEY,WORKREG=10   CALLER KEY          Y02072 05427502
         LR    RLIST,R0           SAVE LIST ADDRESS              A25998 05429502
         LTR   RDCB,R1            SAVE DCB ADDR, TST FOR 'FIND'  A25998 05440002
         BM    GETCORE            BR IF 'FIND' TO GET WK AREA    Y02072 05460002
*********************************************************************** 05500002
*        FOR BLDL ONLY, TEST THE VALIDITY OF                          * 05520002
*        THE USER-GENERATED 'BLDL' LIST                               * 05540002
*********************************************************************** 05560002
*                                                                A25998 05580002
TSTBLDL  EQU   *                                                        05582002
         USING BLDLIST,RLIST                                            05600002
         LA    R15,RCBADLST       LOAD 'BADLIST' ERROR CODE      A25998 05620002
         SR    RZ,RZ              INITLZ FOR ENTRIES TEST        A25998 05640002
         CH    RZ,BLDENTS         TEST FOR ZERO OR NEG ENTRIES,  A25998 05660002
         BNL   GETOUT             BR IF YES TO RETURN- ERROR     A25998 05680002
         LA    RZ,PDS2LIBF-PDS2   MINIMUM ENTRY LENGTH            M3385 05700002
         CH    RZ,BLDELEN         SEE IF ENTRY TOO SHORT         A25998 05720002
         BH    GETOUT             BR IF YES TO RETURN-ERROR       M5729 05740002
         DROP RLIST                                                     05760002
         C     RDCB,CVTLINK       EXPLICIT REQUEST FOR LINKLIB?  Y02072 05760802
         BE    GETSUP             YES - MUST GET KEY ZERO CORE   Y02072 05761202
         C     RDCB,CVTSVDCB      EXPLICIT REQUEST FOR SVC LIB?  Y02072 05761602
         BE    GETSUP             YES - MUST GET KEY ZERO CORE   Y02072 05761702
         LTR   RDCB,RDCB          TEST DCB POINTER               Y02072 05762002
         BNZ   GETCORE            NOT ZERO GETMAIN IN CALLER KEY Y02072 05764002
         L     RDCB,JLBDCB(RX)    GET TASKLIB DCB FROM CUR TCB @ZA12953 05764437
         LTR   RDCB,RDCB          TEST FOR DCB ADDRESS         @ZA17048 05764537
         BZ    GETSUP             NONE-DO NOT CHECK KEY        @ZA17048 05764637
         TM    CVTOPTA,CVTNIP     TEST FOR NIP IN CONTROL      @ZA30955 05764737
         BO    GETSUP             YES BYPASS DEBCHK            @ZA30955 05764837
         USING IHADCB,RDCB                                     @ZA30955 05764937
         L     RDEB,DCBDEBAD      GET DEB ADDRESS              @ZA30955 05765037
         USING DEBBASIC,RDEB                                   @ZA30955 05765137
         L     R9,0(RDEB)         LOAD THE TCB ADDR FROM DEB   @ZA30955 05765237
         LA    R9,0(R9)           CLEAR HI-ORDER BYTE          @ZA30955 05765337
         LTR   R9,R9              IS THEIR A TCB ?             @ZA30955 05765437
         BZ    ERROR              NO THEN ERROR                @ZA30955 05765537
FINDTCB  EQU   *                                               @ZA30955 05765637
         USING TCB,RX                                          @ZA30955 05765737
         LR    R5,RX              SAVE THIS TCB ADDR           @ZA30955 05765837
FINDTCBA EQU   *                                               @ZA30955 05769337
         L     RX,TCBTCB          ADDR OF NEXT TCB ON QUEUE    @ZA30955 05769437
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 05769537
         LTR   RX,RX              HIGHEST TCB ?                @ZA30955 05769637
         USING TCB,RX                                          @ZA30955 05769737
         BZ    BACKTCB            CHECK BACK TCB CHAIN         @ZA30955 05769837
         CR    R9,RX              COMPARE CURRENT TCB WITH     @ZA30955 05769937
*                                 TCBS ON TCB QUEUE            @ZA30955 05770037
         BE    DEBCHKBR           BRANCH TO CHECK DEB          @ZA30955 05770137
         B     FINDTCBA           CONTINUE CHECKING TCBS       @ZA30955 05770237
BACKTCB  EQU   *                                               @ZA30955 05770337
         LR    RX,R5              RESTORE SAVED TCB            @ZA30955 05770437
         CR    R9,RX              TCBS THE SAME                @ZA30955 05770537
         BE    DEBCHKBR           THEN GO TO DEBCHK            @ZA30955 05770637
BACKTCBA EQU   *                                               @ZA30955 05770737
         L     RX,TCBBACK         ADDR OF BACK CHAIN TCB'S     @ZA30955 05770837
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 05770937
         LTR   RX,RX              TEST FOR ZERO                @ZA30955 05771037
         USING TCB,RX                                          @ZA30955 05771137
         BZ    ERROR              TCB NOT FOUND THEN ERROR     @ZA30955 05771237
         CR    R9,RX              SAME TCB STOP CHECKING?      @ZA30955 05771337
         BE    DEBCHKBR           TCB VALID -CHECK DEB         @ZA30955 05771437
         B     BACKTCBA           CONTINUE CHECKING TCB'S      @ZA30955 05771537
ERROR    LA    R15,RCIOERR        SET R15 = 8 DEB NOT GOOD     @ZA25435 05771637
         LA    R0,RCDEBERR        SET R0 = 8 DEB NOT GOOD      @ZA25435 05771737
         B     GETOUT             CLEANUP AND LEAVE            @ZA25435 05771837
*                                                              @ZA30955 05771937
*  FOR THE BRANCH ENTRY TO DEBCHK THE REGISTERS ARE            @ZA30955 05772037
*   REG 1  - DEB  ADDR                                         @ZA30955 05772137
*   REG 10 - TCB  ADDR                                         @ZA30955 05772237
*                                                              @ZA30955 05772337
*  UPON RETURN FROM DEBCHK THE REGISTERS WILL HAVE             @ZA30955 05772437
*   REG 1 - VERIFIED DEB ADDR                                  @ZA30955 05772537
*   REG 10 - DEB TABLE POINTER                                 @ZA30955 05772637
*   REG 11 - DEB TABLE OFFSET                                  @ZA30955 05772737
*   REG 14 - RETURN ADDRESS                                    @ZA30955 05772837
*   REG 0-9 AND 12-14 REMAIN UNCHANGED                         @ZA30955 05772937
*                                                              @ZA30955 05773037
DEBCHKBR EQU   *                                               @ZA30955 05773137
         LR    R2,RLIST           SAVE USER LIST ADDR          @ZA30955 05773237
         LR    R5,RDCB            SAVE THE DCB ADDR            @ZA30955 05773337
         L     R1,DCBDEBAD        GET DEB ADDRESS FOR DEBCHK   @ZA30955 05773437
         LR    RGW,RX             REG 10 - TCB ADDR            @ZA30955 05773537
         L     RCVT,CVTPTR        GET CVT ADDR                 @ZA30955 05773637
         USING CVT,RCVT                                        @ZA30955 05773737
         L     R15,CVTEXT2        GET ADDR OF CVT EXTENSION    @ZA30955 05773837
         USING CVTXTNT2,R15                                    @ZA30955 05773937
         L     R15,CVTDEBVR       GET BR ENTRY ADDR FOR DEBCHK @ZA30955 05774037
         BALR  RRET,R15           BRANCH TO DEBCHK             @ZA30955 05774137
         NOP   0                  NOP FOR RETURN FROM DEBCHK   @ZA30955 05774237
         LTR   R15,R15            CHECK DEBCHK RET CODE        @ZA30955 05774337
         BNZ   ERROR              BAD DEB                      @ZA30955 05774437
         LR    RDCB,R5            RESTORE DCB ADDR             @ZA30955 05774537
         LR    RLIST,R2           RESTORE LIST ADDR            @ZA30955 05774637
         LR    RDEB,R1            GET DEB ADDR RETURNED        @ZA30955 05774737
         USING DEBBASIC,RDEB                                   @ZA30955 05774837
         L     R15,DEBDCBAD       GET DCB ADDR FROM DEB        @ZA30955 05774937
         LA    R15,0(R15)         CLEAR HI ORDER BYTE          @ZA30955 05775037
         CR    RDCB,R15           DCB ADDR THE SAME ?          @ZA30955 05775137
         BNE   ERROR              NO THEN ERROR - BAD DEB      @ZA30955 05775237
         TM    DEBPK(R1),KEYMASK    USER'S PROTECT KEY 0       @ZA30955 05775337
         BNZ   GETCOREU           NO BRANCH TO GET CALLER KEY  @ZA30955 05775437
         SR    RDCB,RDCB          RESTORE ZERO DCB ADDR        @ZA30955 05775537
GETSUP   EQU   *                                                        05777837
         MODESET EXTKEY=SUPR      USE SUPERVISOR KEY             Y02072 05777937
         OI    EXSFLG,EXSSYDCB    FLAG THAT SYSTEM DCB USED      Y02072 05778002
         B     GET253             GET S.P. 253 CORE             YM01226 05778502
         SPACE 2                                                        05780002
*********************************************************************** 05800002
*        OBTAIN AND INITIALIZE BLDL/FIND WORK AREA                    * 05820002
*********************************************************************** 05840002
*                                                                       05860002
GETCOREU EQU   *                  GET CORE IN USERS KEY        @ZA12953 05866037
         SR    RDCB,RDCB          RESET ZERO DCB ADDR          @ZA12953 05872037
GETCORE  EQU   *                                                 A25998 05880002
         TM    EXSKEY,KEYMASK     CHECK CALLER KEY              YM01226 05882502
         BNZ   GET229             NOT ZERO - GET S.P. 229       YM01226 05885002
GET253   EQU   *                  GET S.P. 253                  YM01226 05885502
         GETMAIN RC,LV=WORKSZ,SP=253 GET WORKAREA KEY 0         YM01226 05887502
         B     TESTGET            CHECK RETURN CODE             YM01226 05890002
GET229   EQU   *                  GET S.P. 229                  YM01226 05892502
         GETMAIN RC,LV=WORKSZ,SP=229 GET WORKAREA IN CALLER KEY  Y02072 05940002
TESTGET  EQU   *                  CHECK RETURN CODE             YM01226 05940502
         LTR   R15,R15            CHECK RETURN CODE              Y02072 05942002
         BNZ   GETERR             GO TO ERROR ROUTINE            Y02072 05944002
         LR    RAREA,R1           ESTABLISH BASE FOR WORK AREA          05960002
         USING WORKAREA,RAREA                                           05980002
         MODESET EXTKEY=SUPR      GET IN SUPV KEY                Y02072 05982002
         ST    RAREA,EXSWKAD      SAVE CORE ADDR                 Y02072 05984002
         OI    EXSFLG,EXSGTM      FLAG THAT CORE OBTAINED        Y02072 05984402
         TM    EXSFLG,EXSSYDCB    SHOULD WE STAY IN KEY 0?       Y02072 05985402
         BO    COREGOT            YES                            Y02072 05986402
         MODESET KEYADDR=EXSKEY,WORKREG=1   CALLER KEY           Y02072 05988002
COREGOT  EQU   *                                                        05990002
*                                                                       05992002
*        AT THIS POINT THE ROUTINE IS EITHER IN SUPERVISOR KEY AND      05994002
*        HAS ITS WORKAREA IN THAT KEY OR IT IS IN CALLER KEY AND ITS    05996002
*        WORKAREA IS IN CALLER KEY.                                     05998002
*                                                                       05998402
         XC    CLRSEG(WORKSZ-L'RDAREA),CLRSEG   CLEAR WORK AREA         06000002
*                                               EXCEPT READIN PORTION   06020002
         SPACE 2                                                        06040002
         LTR   RDCB,RDCB          IF DCB PTR IS 0 OR POSITIVE           06060002
         BNL   BLDLSVC            THEN GO PROCESS AS BLDL               06080002
*********************************************************************** 06100002
*        ROUTINE TO PROCESS FIND REQUEST                              * 06120002
*        THE FIRST STEP WILL BE TO DO BLDL ON NAME PROVIDED           * 06140002
*********************************************************************** 06160002
*                                                                       06180002
         USING FINDLIST,RLIST                                           06200002
         LCR   RDCB,RDCB          MAKE DCB PTR POSITIVE                 06220002
         MVC   FNDLST1,FINDHDR    INIT BLDL LIST FOR FIND               06240002
         MVC   FNDLST2,FINDNAME   MOVE NAME                             06260002
         DROP  RLIST                                                    06280002
         LA    RLIST,FNDLST1      POINT TO GENERATED BLDL LIST          06300002
         B     ALLENTRY           BRANCH TO EXECUTE 'BLDL'        M4214 06320002
FINDRET  LTR   R15,R15            BYPASS THE FOLLOWING STEP             06340002
         BP    CLEANUP            IF THERE IS AN ERROR ON BLDL          06360002
         TM    EXSFLG,EXSBLDL     IS BLDL BEING PROCESSED?       Y02072 06365002
         BO    CLEANUP            YES - SKIP SYNCH               Y02072 06370002
         SPACE 2                                                        06380002
*********************************************************************** 06400002
*        TTR WAS SUCCESSFULLY FOUND FOR SPECIFIED NAME                * 06420002
*        NOW USE POINT ROUTINE TO POSITION TO REQUESTED MEMBER        * 06440002
*********************************************************************** 06460002
*                                                                       06480002
         USING IHADCB,RDCB                                              06500002
         MVC   DCBRELAD,FNDLST3   MOVE TTR TO RELAD                     06520002
         LR    R0,RDCB            POINT TO RELAD                        06540002
         LR    R1,RDCB            POINT TO DCB                   Y02072 06545002
         SR    RZ,RZ              CLEAR REG                      Y02072 06562002
         IC    RZ,EXSKEY          GET CALLER KEY                 Y02072 06564002
         SRL   RZ,KEYOFFST        MOVE KEY TO LOW ORDER BIT      Y02072 06565002
         LA    RX,PRIVKEY         HIGHEST PRIVLEGED KEY          Y02072 06566002
         CR    RZ,RX              COMPARE KEYS                   Y02072 06568002
         BH    SYNCH              CALLER NOT SYSTEM KEY-SYNCH    Y02072 06570002
BALR     EQU   *                                                 Y02072 06572002
         POINT (1),(0)            ISSUE POINT                    Y02072 06580002
         SR    R15,R15            SET NO ERROR                          06600002
         B     CLEANUP                                           Y02072 06602002
*                                                                       06602202
*        SYNCHRTN GETS CONTROL IN USER KEY AND PROBLEM STATE            06602402
*        IT ISSUES A POINT AND THEN A BR 14 TO RETURN TO THE            06602602
*        SVC.  IT SAVES REG 14 ON ENTRY IN REG RX.                      06602802
*                                                                       06602902
SYNCHRTN EQU   *                                                 Y02072 06603502
         LR    RX,RRET            SAVE RETURN ADDRESS            Y02072 06603702
         POINT (1),(0)            ISSUE POINT                    Y02072 06604402
         LR    RRET,RX            RESTORE RETURN ADDRESS         Y02072 06604602
         BR    RRET               RETURN TO SUPERVISOR           Y02072 06605002
SYNCH    EQU   *                                                 Y02072 06605602
         MODESET EXTKEY=SUPR      KEY 0                          Y02072 06606202
         OI    EXSFLG,EXSYNCH     TURN ON IN SYNCHED RTN FLAG    Y02072 06606802
         ST    RBASE,EXSBASE      SAVE BASE ACROSS SYNCH         Y02072 06607402
         SYNCH SYNCHRTN           SYNCH TO POINT ROUTINE         Y02072 06608002
         DROP                                                           06608402
         L     RCVT,CVTPTR        ADDRESS OF CVT                 Y02072 06608802
         USING CVT,RCVT                                          Y02072 06608902
         L     RRB,CVTTCBP        ADDRESS OF TCB WORDS           Y02072 06609202
         USING TCBPTRS,RRB                                       Y02072 06609302
         L     RRB,TCBPTRC        ADDRESS OF TCB                 Y02072 06609602
         USING TCB,RRB                                           Y02072 06612002
         L     RRB,TCBRBP         ADDRESS OF SVRB                Y02072 06613602
         USING RBBASIC,RRB                                       Y02072 06615702
         NI    EXSFLG,X'FF'-EXSYNCH TURN OFF IN SYNCHED RTN FLAG Y02072 06615902
         L     RBASE,EXSBASE      RESTORE BASE REG               Y02072 06616102
         USING BASE1,RBASE                                       Y02072 06616502
         L     RAREA,EXSWKAD      RESTORE WORKAREA PTR           Y02072 06616902
         USING WORKAREA,RAREA                                    Y02027 06617302
         SR    R15,R15            SET NO ERROR                   Y02072 06617702
         SPACE 2                                                        06620002
CLEANUP  EQU   *                                                 M4214  06625037
         SR    R0,R0              CLEAR REG 0                  @ZA25435 06630037
         SPACE 2                                               @ZA25435 06635037
CLEANUP1 EQU   *                                               @ZA25435 06640037
         LR    R8,R0              SAVE ERROR CODE              @ZA25435 06645037
*********************************************************************** 06660002
*        THIS CODE IS ENTERED AT THE CONCLUSION OF EITHER BLDL OR FIND* 06680002
*        PROCESSING, AND PERFORMS VARIOUS CLEAN-UP FUNCTIONS          * 06700002
*********************************************************************** 06720002
*                                                                       06740002
         LR    RZ,R15             SAVE ERROR CODE                M4214  06760002
*                                                                M3385  06980002
***      FREE THE BLDL/FIND WORK AREA                                   07000002
*                                                                       07020002
         MODESET EXTKEY=SUPR      CHANGE TO KEY ZERO             Y02072 07040002
         NI    EXSFLG,X'FF'-EXSGTM TURN OFF GETMAIN FLAG         Y02072 07045002
         TM    EXSFLG,EXSSYDCB    USING SYSTEM DCB?              Y02072 07060002
         BO    FREECORE           YES DIFFERENT KEY ON FREE     YM01226 07062002
         MODESET KEYADDR=EXSKEY,WORKREG=1 FREE USER KEY CORE     Y02072 07067002
         TM    EXSKEY,KEYMASK     CHECK CALLER KEY              YM01226 07067702
         BNZ   FREE229            NOT ZERO FREE S.P. 229        YM01226 07067802
FREECORE EQU   *                                                YM01226 07067902
         FREEMAIN R,LV=WORKSZ,SP=253,A=(RAREA) KEY ZERO CORE    YM01226 07068002
         B     RETURN             RETURN                        YM01226 07068602
FREE229  EQU   *                  FREE S.P. 229                 YM01226 07069102
         FREEMAIN R,LV=WORKSZ,SP=229,A=(RAREA) USER KEY CORE    YM01226 07069302
RETURN   EQU   *                                                 Y02072 07070002
         LR    R0,R8              RESTORE ERROR CODE           @ZA25435 07070537
         LR    R15,RZ             RESTORE ERROR CODE                    07100002
GETOUT   EQU   *                                                        07100402
         L     RRET,EXSRET        LOAD RETURN ADDRESS            Y02072 07102002
         MODESET EXTKEY=SUPR      RETURN TO SUPERVISOR KEY       Y02072 07103002
         BR    RRET               RETURN TO CALLER               Y02072 07104002
GETERR   EQU   *                  AN INVALID RETURN FROM GETMAIN Y02072 07202002
         LA    R15,RCIOERR        SET RETURN CODE 4 IN REG 15    Y02072 07204002
         LA    R0,RCGETERR        SET RETURN CODE 4 IN REG 0     Y02072 07206002
         B     GETOUT             RETURN TO CALLER               Y02072 07208002
         EJECT                                                          07220002
BLDLSVC  EQU   *                                                        07240002
*********************************************************************** 07260002
*        ROUTINE TO PROCESS SVC ENTRY TO BLDL                         * 07280002
*********************************************************************** 07380002
         USING BLDLIST,RLIST                                            07420002
         SPACE 2                                                        08340002
*********************************************************************** 08360002
*        THIS IS THE BEGINNING OF THE ACTUAL BLDL PROCESSING.         * 08380002
*        IT MAY BE ENTERED DUE TO BLDL SVC OR AS A SUBROUTINE OF FIND.* 08400002
*                                                                     * 08440002
*        BEGIN BY TESTING FOR SPECIAL DCB'S                           * 08460002
*********************************************************************** 08480002
*                                                                       08500002
ALLENTRY LA    RAREA,WORKAREA     CLEAR HI-ORDER BYTE                   08520002
*                                                                       08540002
         L     RX,CVTLINK         LOAD LINKLIB DCB LOC                  08560002
         CR    RX,RDCB            TEST FOR EXPLICIT LINKLIB REQUEST     08580002
         BE    INLINK             IF LINKLIB,INDICATE SO                08600002
*                                                                       08640002
         L     RX,CVTSVDCB        LOAD SVCLIB DCB LOC                   08660002
         CR    RX,RDCB            TEST FOR SVC LIB REQUEST              08680002
         BE    INLINK             IF SVCLIB, INDICATE SO                08700002
NOLNKSVC LTR   RDCB,RDCB          DID USER SUPPLY DCB ADDRESS           08740002
         BP    SETCCWS            YES, NOT LINKLIB/TASKLIB DEFAULT      08760002
*                                 NO, LOOK THROUGH SYS LIBS             08780002
*********************************************************************** 08820002
*        IF A JOBLIB, STEPLIB OR TASKLIB EXISTS,                      * 08840002
*        IT WILL BE FOUND THROUGH THE CURRENT TCB.                    * 08860002
*        OTHERWISE THE SEARCH WILL BEGIN WITH LINKLIB.                * 08880002
*********************************************************************** 08900002
*                                                                       08920002
         MVI   LIB,TASKLIB        START JOBLIB SEARCH          @ZA26444 08940037
         L     RZ,CVTTCBP         FIND TCB POINTERS                     08960002
         USING TCBPTRS,RZ                                               08980002
         L     RZ,TCBPTRC         FIND CURRENT TCB                      09000002
         USING TCB,RZ                                                   09020002
         L     RDCB,TCBJLB        JOBLIB DCB ADDR                       09040002
         DROP  RZ                                                       09060002
         LTR   RDCB,RDCB          IF A JOBLIB DCB EXISTS,               09080002
         BP    SETCCWS            GO PROCESS THE LIBRARY                09100002
         L     RDCB,CVTLINK       OTHERWISE GET LINKLIB DCB ADDR        09120002
         USING IHADCB,RDCB                                              09140002
*                                                                       09160002
***            START SEARCH OF LINKLIB (OR SVCLIB)                      09180002
*                                                                       09200002
INLINK   EQU   *                                                        09220002
         MVI   LIB,LINKSVC        INDICATE SEARCHING LINK OR SVC LIB    09240002
         SPACE 2                                                        09260002
SETCCWS  EQU   *                                                        09280002
*********************************************************************** 09300002
*        SAVE REGISTERS WHICH WILL BE USED IN                         * 09320002
*        RELOCATING CHANNEL PROGRAM                                   * 09340002
*********************************************************************** 09360002
         TM    EXSFLG,EXSSYDCB    ARE WE IN KEY 0?               Y02072 09365002
         BO    CHANKYOK           YES DO STM                     Y02072 09370002
         MODESET EXTKEY=SUPR      NO - GET IN KEY 0              Y02072 09375002
CHANKYOK DS    0H                                                Y02072 09376002
*                                 ******************                    09380002
         STM   R0,R5,EXSSAVE      * SAVE REGISTERS *             Y02072 09400002
         PUSH  USING              * AND USINGS     *                    09420002
*                                 ******************                    09440002
         TM    EXSFLG,EXSSYDCB    SHOULD WE BE IN KEY 0?         Y02072 09445002
         BO    CHAN0OK            YES                            Y02072 09450002
         MODESET KEYADDR=EXSKEY,WORKREG=1 NO GET IN CALLER KEY   Y02072 09455002
CHAN0OK  DS    0H                                                Y02072 09456002
*                                 THE FOLLOWING USING/DROP SEQUENCE     09460002
*                                 IS PRIMARILY TO HIGHLIGHT PUSH/POP    09480002
*                                 IN THE CROSS REFERENCE LISTING.       09500002
         USING DUMMY,R1,RSULEFT,RCVT,RX,RY,RZ,RPDS2,RPDS1,RDEB          09520002
         DROP  R1,RSULEFT,RCVT,RX,RY,RZ,RPDS2,RPDS1,RDEB                09540002
         DROP  RLIST,RDCB                                               09560002
         SPACE 2                                                        09580002
*********************************************************************** 09600002
*        CONSTRUCT CHANNEL PROGRAM, ECB, AND IOB FOR READING          * 09620002
*        DIRECTORY BLOCKS                                             * 09640002
*********************************************************************** 09660002
*                                                                       09680002
         LM    R0,R5,CHANPROG     MOVE AND RELOCATE CHAN PROG    Y02072 09700002
         ALR   RCSID,RAREA        RELOCATE SEARCH ID CCW                09720002
         ALR   RCTIC1,RAREA       RELOCATE FIRST TIC                    09740002
         AR    RCMRC,RAREA        RELOCATE READ COUNT CCW               09760002
         STM   R0,R5,CCW1         MOVE CCW'S                     Y02072 09765002
         LM    R0,R5,SKEH         SECOND HALF                    Y02072 09770002
         AR    RCTIC2,RAREA       RELOCATE SECOND TIC                   09780002
         AR    RCRD,RAREA         RELOCATE READ DATA CCW                09800002
         STM   R0,R5,CCW4                                               09820002
*                                                                       09840002
*              INITIALIZE IOB IN WORK AREA (PREVIOUSLY ZEROED)          09860002
         LA    RY,ECB                                            Y02072 09880002
         ST    RY,IOBECBPT        POINT TO ECB                   Y02072 09900002
         LA    RY,CCW                                            Y02072 09920002
         ST    RY,IOBSTART        POINT TO CHANNEL PROGRAM       Y02072 09940002
         MVI   IOBFLAG1,IOBUNREL+IOBSPSVC  SET NON-RELATED FLAG  Y02072 09960002
*                                          AND NOP APPENDAGES    Y02072 09965002
*                                 *************************             09980002
         LM    R0,R5,EXSSAVE      * RESTORE REGISTERS     *      Y02072 10000002
         POP   USING              * AND PREVIOUS USINGS   *             10020002
*                                 *************************             10040002
         SPACE 2                                                        10060002
*********************************************************************** 10080002
*        CYCLE THROUGH USER'S BLDL LIST, SETTING EACH ENTRY 'EMPTY'   * 10100002
*        THIS IS INDICATED BY RECORD # 0 IN THE ENTRY TTR.            * 10120002
*********************************************************************** 10140002
*                                                                       10160002
         LA    RPDS2,BLDENT       SET TO FIRST ENTRY                    10220002
         USING PDS2,RPDS2                                               10240002
*                                                                       10340002
         TM    EXSFLG,EXSSYDCB+EXSBLDL IS IT USING A SYSTEM DCB  Y02072 10344002
*                                      AND BLDL?                 Y02072 10346002
         BNO   CLRENT             NO USE THE SAME KEY AS THE WKA Y02072 10348002
*                                                                       10348402
*        IF IT IS A SYSTEM DCB AND BLDL WE ARE GOING TO MODIFY   Y02072 10350002
*        THE CALLERS CORE SO WE SWITCH TO CALLER KEY             Y02072 10352002
*                                                                       10354002
         MODESET KEYADDR=EXSKEY,WORKREG=1 CALLER KEY             Y02072 10356002
*              LOOP THROUGH ENTRIES                                     10360002
CLRENT   EQU   *                                               @ZA31343 10380037
         LH    RZ,BLDENTS         PICKUP NO. OF ENTRIES        @ZA31343 10385037
CLRENTA  EQU   *                                               @ZA31343 10390037
         MVI   PDS2TTRP+2,0       ZERO R FIELD                          10400037
         AH    RPDS2,BLDELEN      GO TO NEXT ENTRY IN LIST              10410037
         BCT   RZ,CLRENTA         LOOP THROUGH ALL ENTRIES              10420037
         DROP  RPDS2                                                    10440002
*              END OF LOOP                                              10460002
         TM    EXSFLG,EXSSYDCB+EXSBLDL DID WE CHANGE KEY?        Y02072 10462002
         BNO   SEARCH             NO - CONTINUE                  Y02072 10464002
         MODESET EXTKEY=SUPR      CHANGE BACK TO SUPERVISOR KEY  Y02072 10466002
         EJECT                                                          10480002
SEARCH   EQU   *                                                        10500002
*********************************************************************** 10540002
*              RESIDENT TABLE SEARCH                                  * 10560002
*        THIS ROUTINE SEARCHES THE RESIDENT BLDL TABLES FOR LINKLIB   * 10580002
*        OR SVCLIB AS APPROPRIATE, IF THEY ARE PRESENT.               * 10600002
*        IT USES A BINARY SEARCH FOR THE FIRST ENTRY IN THE USER'S    * 10620002
*        LIST, AND THEN SCANS SEQUENTIALLY FOR THE REMAINING ENTRIES. * 10640002
*        NOTE THAT USER ENTRIES MUST BE IN ALPHAMERIC SEQUENCE.       * 10660002
*********************************************************************** 10680002
*              SPECIAL REGISTER USAGE                                 * 10700002
* 0 RSCUR--- NUMBER OF CURRENT ENTRY IN RES TABLE DURING BINARY SEARCH* 10720002
* 1 RSMOVE-- MOVE LENGTH TO BE USED EXECUTING REMOTE MVC INSTRUCTION  * 10740002
* 4 RSTUB=RX-UPPER BOUNDARY FOR BINARY SEARCH                         * 10760002
* 5 RSTLB=RY-LOWER BOUNDARY FOR BINARY SEARCH                         * 10780002
* 8 RRENT--- POINTER TO CURRENT RESIDENT TABLE ENTRY                  * 10800002
* 9 RRES---- POINTER TO RESIDENT TABLE                                * 10820002
*15 RSTLEFT- NUMBER OF RESIDENT TABLE ENTRIES REMAINING DURING SCAN   * 10840002
*********************************************************************** 10860002
*                                                                       10880002
***            FIRST TEST TO SEE IF RESIDENT TABLE CAN BE USED          10900002
*                                                                       10920002
         CLI   LIB,LINKSVC        IF NOT LINKLIB OR SVCLIB              10940002
         BNE   SRCHPDS            BYPASS RESIDENT TABLE SEARCH          10960002
         L     RRES,IEARESBL      FIND LINKLIB RESIDENT TABLE           10980002
         C     RDCB,CVTLINK       IF LINKLIB IS BEING USED              11000002
         BE    TESTRES            GO AHEAD, OTHERWISE MUST BE SVCLIB    11020002
         MVI   LIB,USERLIB        RESET TO INDICATE NOT LINKLIB         11040002
         L     RRES,IEARESBS      AND FIND SVCLIB RESIDENT TABLE        11060002
TESTRES  LTR   RRES,RRES          IF THE APPROPRIATE TABLE              11080002
         BZ    SRCHPDS            IS NOT PRESENT, GET OUT               11100002
         USING RESTAB,RRES                                              11120002
*                                                                       11140002
***            SET UP LENGTH OF DATA PORTION TO BE MOVED.               11160002
***            THIS MAY BE LIMITED EITHER BY USER OR BY RESIDENT TABLE  11180002
*                                                                       11200002
         CLC   BLDELEN,RESELEN    Q. IS USER LL GT RES TABLE            11220002
         BNH   LEN1               NO, USER LL OK SO FAR                 11240002
         LH    RSMOVE,RESELEN     YES, USE RES TABLE LL                 11260002
         B     LEN3               GO DECREMENT FOR NAME FIELD           11280002
*                                                                       11300002
LEN1     CLI   BLDELEN+1,PDS2MIN  Q. IS USER LL LESS THAN MINIMUM       11320002
         BNL   LEN2               NO, USE USER LL                       11340002
         LA    RSMOVE,PDS2MIN-L'PDS2NAME-1  YES, USE MIN LENGTH         11360002
         B     BINSRCH            GO ON                                 11380002
*                                                                       11400002
LEN2     LH    RSMOVE,BLDELEN                                           11420002
LEN3     LA    RX,L'PDS2NAME+1    CALC LENGTH-1 EXCLUDING NAME          11440002
         SR    RSMOVE,RX                                                11460002
         SPACE 2                                                        11480002
BINSRCH  EQU   *                                                        11500002
*********************************************************************** 11520002
*        BINARY SEARCH OF THE RESIDENT TABLE FOR THE FIRST USER ENTRY * 11540002
*********************************************************************** 11560002
*                                                                       11580002
         BAL   RSUBR,FIRSTMTY     GO TO FIND FIRST EMPTY USER ENTRY     11600002
         USING PDS2,RPDS2                                               11620002
*                                 CONSIDER RESTABLE ENTRIES NUMBERED    11640002
         LH    RSTUB,RESNUM       FROM 0 TO RESNUM-1                    11660002
         BCTR  RSTUB,0            UPPER BOUND IS NUMBER OF LAST ENTRY   11680002
         SR    RSTLB,RSTLB        LOWER BOUND IS NUMBER OF FIRST ENTRY  11700002
*                                                                       11720002
***            CHECK THE ENTRY HALF WAY BETWEEN UPPER AND LOWER BOUNDS  11740002
*                                                                       11760002
BISTART  LA    RSCUR,0(RSTLB,RSTUB)  SET CURRENT AS AVERAGE             11780002
         SRL   RSCUR,HALVE           OF UPPER AND LOWER BOUNDS          11800002
         LR    RRENT,RSCUR        DEVELOP POINTER TO CURRENT ENTRY      11820002
         MH    RRENT,RESELEN      RRENT = RSCUR * RES TABLE LL          11840002
         LA    RRENT,RESENT1(RRENT)       + POSITION OF FIRST ENTRY     11860002
         USING RESENT,RRENT                                             11880002
         CLC   PDS2NAME,RESNAME   COMPARE USER NAME WITH TABLE          11900002
         BH    BHI                IF HIGH, LOOK AHEAD                   11920002
         BE    SCAN               IF CORRECT, THIS IS STARTING POSITION 11940002
*                                 IF LOW, BACK UP                       11960002
***            NAME IS LOWER--RESET UPPER BOUND                         11980002
*                                                                       12000002
         LR    RSTUB,RSCUR                                              12020002
         BCTR  RSTUB,0            USE CURRENT-1 AS UPPER BOUND          12040002
         CR    RSCUR,RSTLB        IF CURRENT WAS STILL ABOVE LOW BOUND  12060002
         BH    BISTART            THEN CONTINUE BINARY SEARCH           12080002
         B     SCAN               OTHERWISE START SCAN HERE             12100002
*                                                                       12120002
***            NAME IS HIGHER--RESET LOWER BOUND                        12140002
*                                                                       12160002
BHI      LR    RSTLB,RSCUR        SET LOWER BOUND AT                    12180002
         LA    RSTLB,1(RSTLB)     CURRENT + 1                           12200002
         CR    RSCUR,RSTUB        IF UPPER BOUND NOT YET HIT,           12220002
         BL    BISTART            CONTINUE SEARCH                       12240002
         SPACE 2                                                        12260002
SCAN     EQU   *                                                        12280002
*********************************************************************** 12300002
*        AT THIS POINT WE ARE POSITIONED FROM THE BINARY SEARCH.      * 12320002
*        IF THE FIRST ENTRY EXISTS, RRENT POINTS TO IT                * 12340002
*        BEGINNING WITH THAT FIRST ENTRY, CODE WILL NOW SCAN RESIDENT * 12360002
*        TABLE, MATCHING ENTRIES AS IT GOES.                          * 12380002
*********************************************************************** 12400002
         LH    RSTLEFT,RESNUM     GET NUMBER OF RESTABLE ENTRIES        12420002
         SR    RSTLEFT,RSCUR      REMAINING TO BE SCANNED               12440002
*                                                                       12460002
***            COMPARE USER ENTRY WITH RESIDENT TABLE ENTRY             12480002
*                                                                       12500002
COMP     CLC   PDS2NAME,RESNAME   COMPARE NAMES                         12520002
         BE    FOUND              IF MATCH, GO FILL ENTRY               12540002
         BH    NEXTRES            IF USER HIGH, CONTINUE SCAN           12560002
*                                 IF USER LOW, ENTRY NOT PRESENT        12580002
         MVI   ERCODE,ERRNAME     SET ERROR CODE--NAME NOT FOUND        12600002
         BAL   RSUBR,NEXTUSER     GO TO NEXT USER ENTRY                 12620002
         B     COMP                                                     12640002
         SPACE 2                                                        12660002
*********************************************************************** 12680002
*        THIS SUBROUTINE SCANS FOR EMPTY USER ENTRIES                   12700002
*         IT HAS TWO ENTRY POINTS:                                      12720002
*              FIRSTMTY RESETS TO THE BEGINNING OF THE USER LIST,     * 12740002
*                       THEN SCANS TO THE FIRST ENTRY NOT YET FILLED  * 12760002
*              NEXTUSER SCANS FORWARD FROM CURRENT ENTRY TO NEXT      * 12780002
*                       ONE WHICH HAS NOT YET BEEN FILLED             * 12800002
*        IT NORMALLY RETURNS (ON RSUBR) AFTER UPDATING RPDS2 TO POINT * 12820002
*        TO THE NEW USER ENTRY.  HOWEVER, WHEN IT REACHES THE END OF  * 12840002
*        THE USER LIST, IT EXITS TO THE NORMAL DIRECTORY SEARCH.      * 12860002
*********************************************************************** 12880002
*                                                                       12900002
FIRSTMTY MVI   ERCODE,0           RESET ERROR INDICATION                12920002
         LH    RSULEFT,BLDENTS    RESET USER ENTRY COUNT                12940002
         LA    RPDS2,BLDENT       START WITH FIRST USER ENTRY           12960002
*                                                                       12980002
NXTEMPTY CLI   PDS2TTRP+2,0       Q. IS THIS ENTRY EMPTY                13000002
         BER   RSUBR              YES - RETURN WHENCE YOU CAME          13020002
*                                 NO-GET NEXT USER ENTRY                13040002
***            ENTRY POINT TO GET NEXT UNFILLED ENTRY                   13060002
*                                                                       13080002
NEXTUSER AH    RPDS2,BLDELEN      INCREMENT TO NEXT USER ENTRY          13100002
         BCT   RSULEFT,NXTEMPTY   IF MORE ENTRIES, GO CHECK FOR EMPTY   13120002
         B     ENDRES             ELSE START NORMAL DIRECTORY SEARCH    13140002
         SPACE 2                                                        13160002
*********************************************************************** 13180002
*        A MATCHING ENTRY HAS BEEN FOUND--FILL IT IF APPROPRIATE      * 13200002
*********************************************************************** 13220002
*                                                                       13240002
FOUND    CLI   RESREC,0           IS R OF RES TABLE TTR = 0             13260002
         BE    NOFILL             YES - DON'T PERFORM MOVE              13280002
         TM    EXSFLG,EXSSYDCB+EXSBLDL SYSTEM DCB & BLDL?        Y02072 13282002
         BNO   FOUND1             NO - KEY OK                    Y02072 13284002
         DROP  RCVT               MODESET WORKREG IS RCVT        Y02072 13285002
         MODESET KEYADDR=EXSKEY,WORKREG=3 GET IN CALLER KEY      Y02072 13286002
         L     RCVT,CVTPTR        RESTORE CVT POINTER            Y02072 13288002
         USING CVT,RCVT                                          Y02072 13289002
FOUND1 EQU     *                                                 Y02072 13290002
         EX    RSMOVE,RESMOVE     NO - MOVE ENTRY                       13300002
         TM    EXSFLG,EXSSYDCB+EXSBLDL WAS KEY CHANGED?          Y02072 13302002
         BNO   NEXT               NO - CONTINUE                  Y02072 13304002
         MODESET EXTKEY=SUPR      MODESET BACK TO SUPR KEY       Y02072 13306002
         B     NEXT               AND CONTINUE PROCESSING               13320002
*********EXECUTED INSTRUCTION****************************************** 13340002
RESMOVE  MVC   PDS2TTRP(0),RESDATA    EXECUTED IN 'FOUND' ABOVE         13360002
*********EXECUTED INSTRUCTION****************************************** 13380002
         SPACE 2                                                        13400002
*                                                                       13420002
***            IF R OF RES TABLE TTR IS 0, IGNORE ENTRY                 13440002
*                                                                       13460002
NOFILL   MVI   ERCODE,ERRNAME     SET ERROR CODE--NAME NOT FOUND        13480002
NEXT     BAL   RSUBR,NEXTUSER     GET NEXT USER ENTRY                   13500002
*                                                                       13520002
***            GO TO NEXT ENTRY IN RESIDENT TABLE IF NOT EXHAUSTED      13540002
*                                                                       13560002
NEXTRES  AH    RRENT,RESELEN      INCREMENT TO NEXT RES TABLE ENTRY     13580002
         BCT   RSTLEFT,COMP       IF MORE ENTRIES, CONTINUE PROCESSING  13600002
*                                 ELSE CURRENT ENTRY NOT MATCHED        13620002
         DROP  RRES,RRENT                                               13640002
         MVI   ERCODE,ERRNAME     SET ERROR CODE--NAME NOT FOUND        13660002
         SPACE 2                                                        13680002
*********************************************************************** 13700002
*        SCAN OF RESIDENT TABLE IS NOW COMPLETE                       * 13720002
*        CHECK TO SEE IF MORE PROCESSING IS NEEDED                    * 13740002
*********************************************************************** 13760002
*                                                                       13780002
ENDRES   CLI   ERCODE,0           WERE ALL USER NAMES FOUND             13800002
         BNE   SRCHPDS            IF NOT, TRY DA SEARCH                 13820002
         SR    R15,R15            SET RETURN CODE TO ZERO         M3385 13840002
         B     FINDRET            RETURN                         Y02072 13860002
         EJECT                                                          13880002
*********************************************************************** 13900002
*              SEARCH PDS DIRECTORY FOR REMAINING ENTRIES             * 13920002
*        BEGIN BY CONVERTING THE TTR AT WHICH SEARCH IS TO BEGIN      * 13940002
*        (NORMALLY 000) INTO AN MBBCCHHR. THIS IS DONE BY CALLING     * 13960002
*        IECPCNVT.                                                    * 13980002
*********************************************************************** 14000002
*                                                                       14020002
SRCHPDS  EQU   *                                                        14040002
         BAL   RSUBR,FIRSTMTY     FIND FIRST EMPTY USER ENTRY           14060002
         SR    R0,R0              START AT BEGINNING OF DIRECTORY       14100002
*                                                                       14120002
***            ENTRY HERE FOR TTR SUPPLIED BY CALLER                    14140002
***            TTR IS ALREADY LOADED IN R0                              14160002
*                                                                       14180002
SRCHTTR  IC    R0,CONCAT#         GET CONCATENATION NUMBER              14200002
         TM    EXSFLG,EXSSYDCB    ARE WE IN KEY 0?               Y02072 14205002
         BO    SRCHKYOK           YES - DO STM                   Y02072 14210002
         MODESET EXTKEY=SUPR      NO - GET IN KEY 0              Y02072 14215002
SRCHKYOK DS    0H                                                Y02072 14216002
*                                 ******************                    14220002
         STM   R9,R15,EXSSAVE     * SAVE REGISTERS *             Y02072 14240002
         ST    RGMBB,EXSRG2       ******************             Y02072 14260002
         TM    EXSFLG,EXSSYDCB    SHOULD WE BE IN KEY 0?         Y02072 14265002
         BO    SRCH0OK            YES - CONTINUE                 Y02072 14270002
         TM    CVTOPTA,CVTNIP     TEST FOR NIP IN CONTROL      @ZA30955 14271037
         BO    SRCH0OK            YES - CONTINUE               @ZA30955 14271137
         L     RDEB,DCBDEBAD      GET DEB ADDRESS              @ZA30955 14271237
         USING DEBBASIC,RDEB                                   @ZA30955 14271337
         L     R9,0(RDEB)         LOAD THE TCB ADDR FROM DEB   @ZA30955 14271437
         LA    R9,0(R9)           CLEAR HI-ORDER BYTE          @ZA30955 14271537
         LTR   R9,R9              TCB PRESENT ?                @ZA30955 14271637
         BZ    ERROR2             NO ERROR                     @ZA30955 14274137
         L     RZ,CVTTCBP         GET TCB POINTERS             @ZA30955 14274237
         USING TCBPTRS,RZ                                      @ZA30955 14274337
         L     RZ,TCBPTRC         FIND CURRENT TCB             @ZA30955 14274437
         LR    RX,RZ              LOAD CURRENT TCB INTO REG4   @ZA30955 14274537
         DROP  RZ                                              @ZA30955 14274637
FINDTCB3 EQU   *                                               @ZA30955 14274737
         USING TCB,RX                                          @ZA30955 14274837
         LR    R5,RX              SAVE ORIGINAL TCB ADDR       @ZA30955 14274937
FINDTCBB EQU   *                                               @ZA30955 14275037
         L     RX,TCBTCB          ADDR OF NEXT TCB ON QUEUE    @ZA30955 14275137
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 14275237
         LTR   RX,RX              HIGHEST TCB ?                @ZA30955 14275337
         USING TCB,RX                                          @ZA30955 14275437
         BZ    BACKTCB2           CHECK BACK TCB CHAIN         @ZA30955 14275537
         CR    R9,RX              COMPARE CURRENT TCB WITH     @ZA30955 14275637
*                                 TCBS ON TCB QUEUE            @ZA30955 14275737
         BE    DEBCHKB2           BRANCH TO CHECK DEB          @ZA30955 14275837
         B     FINDTCBB           CONTINUE CHECKING TCBS       @ZA30955 14275937
BACKTCB2 EQU   *                                               @ZA30955 14276037
         LR    RX,R5              RESTORE ORIGINAL TCB         @ZA30955 14276137
         CR    R9,RX              TCBS THE SAME                @ZA30955 14276237
         BE    DEBCHKB2           THEN GO TO DEBCHK RTN        @ZA30955 14276337
BACKTCBC EQU   *                                               @ZA30955 14276437
         L     RX,TCBBACK         ADDR OF BACK CHAIN TCB'S     @ZA30955 14276537
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 14276637
         LTR   RX,RX              TEST FOR ZERO                @ZA30955 14276737
         USING TCB,RX                                          @ZA30955 14276837
         BZ    ERROR2             TCB NOT FOUND THEN ERROR     @ZA30955 14276937
         CR    R9,RX              SAME TCB STOP CHECKING?      @ZA30955 14277037
         BE    DEBCHKB2           TCB VALID -CHECK DEB         @ZA30955 14277137
         B     BACKTCBC           CONTINUE CHECKING TCB'S      @ZA30955 14277237
ERROR2   LA    R15,RCIOERR        SET R15 = 8 DEB NOT GOOD     @ZA30955 14277337
         LA    R0,RCDEBERR        SET R0 = 8 DEB NOT GOOD      @ZA30955 14277437
         B     CLEANUP1           CLEANUP AND LEAVE            @ZA30955 14277537
DEBCHKB2 EQU   *                                               @ZA30955 14277637
         LR    R5,RDCB            SAVE THE DCB ADDR            @ZA30955 14277737
         L     R1,DCBDEBAD        GET DEB ADDRESS              @ZA30955 14277837
         LR    RGW,RX             REG 10 - TCB ADDR            @ZA30955 14277937
         L     RCVT,CVTPTR        GET CVT ADDR                 @ZA30955 14278037
         USING CVT,RCVT                                        @ZA30955 14278137
         L     R15,CVTEXT2        GET CVT EXTENSION ADDR       @ZA30955 14278237
         USING CVTXTNT2,R15                                    @ZA30955 14278337
         L     R15,CVTDEBVR       GET BR ENTRY ADDR OF DEBCHK  @ZA30955 14278437
         BALR  RRET,R15           BRANCH TO DEBCHK             @ZA30955 14279437
         NOP   0                  NOP FOR RETURN FROM DEBCHK   @ZA30955 14280437
         LTR   R15,R15            CHECK DEBCHK COND CODE       @ZA30955 14281437
         BNZ   ERROR2             BAD DEB                      @ZA30955 14287037
         LR    RDCB,R5            RESTORE RDCB ADDR            @ZA30955 14288037
         LR    RDEB,R1            GOOD DEB ADDR                @ZA30955 14289037
         USING DEBBASIC,RDEB                                   @ZA30955 14290037
         L     R15,DEBDCBAD       GET DCB ADDR FROM GOOD DEB   @ZA30955 14291037
         LA    R15,0(R15)         CLEAR HI-ORDER BYTE          @ZA30955 14292037
         CR    RDCB,R15           SAME DCB ADDRESSES ?         @ZA30955 14293037
         BNE   ERROR2             NO - ERROR BAD DEB           @ZA30955 14294037
         TM    DEBPK(R1),KEYMASK  USER'S PROTECT KEY 0 ?       @ZA30955 14295037
         BZ    SRCH0OK            YES - CONTINUE               @ZA30955 14296037
         MODESET KEYADDR=EXSKEY,WORKREG=9 NO SHIFT TO CALLER KEY Y02072 14297037
SRCH0OK  DS    0H                                                Y02072 14298037
         L     RGDEB,DCBDEBAD     GET ADDRESS OF DEB                    14299037
         LA    RGMBB,IOBSEEK      POINT TO LOC FOR RESULT MBBCCHHR      14300002
         LA    R15,IECPCNVT       CALL TTR CONVERT ROUTINE              14380002
         BALR  RRET,R15                                                 14400002
         LTR   R15,R15            WAS USER TTR VALID?                   14420002
*                                 *********************                 14440002
         LM    R9,R15,EXSSAVE     * RESTORE REGISTERS *          Y02072 14460002
         L     RGMBB,EXSRG2       *********************          Y02072 14480002
         BNZ   BADIO              IF TTR WAS INVALID, CALL IT I/O ERROR 14540002
         ST    RDCB,IOBDCBPT      OTHERWISE FINISH IOB (DCB ADDRESS)    14560002
         SPACE 2                                                        14580002
*********************************************************************** 14600002
*        READ IN BLOCK WHICH SHOULD CONTAIN CURRENT ENTRY             * 14620002
*        THE CHANNEL PROGRAM WILL SEARCH ON KEY FOR THE FIRST BLOCK   * 14640002
*        HAVING AN ENTRY HIGHER OR EQUAL TO CURRENT USER ENTRY NAME   * 14660002
*********************************************************************** 14680002
*                                                                       14700002
READ     STCM  RPDS2,ADDR3,CCWKEYPT   POINT TO NAME SEARCHING FOR       14720002
         EXCP  IOBSTDRD           READ IN THE CORRECT BLOCK             14740002
         TM    ECB,COMPLETE       DID ECB GET POSTED?          @ZA12201 14840037
         BO    BYWAIT             BYPASS WAIT SVC              @ZA12201 14845037
         WAIT  ECB=ECB            ELSE WAIT FOR COMPLETION              14850037
BYWAIT   EQU   *                  ECB HAS BEEN POSTED          @ZA12201 14855037
         TM    ECB,COMPLETE+NORMAL  CHECK COMPLETE AND NO-ERROR BITS    14860002
         BO    GOODIO             IF NO ERRORS, GO AHEAD                14900002
*                                 ELSE COMPLETE WITH ERROR              14920002
BADIO    LA    R15,RCIOERR        SET I/O ERROR CODE                    14940002
         B     FINDRET            RETURN                         Y02072 14960002
         SPACE 2                                                        14980002
GOODIO   EQU   *                                                        15000002
*********************************************************************** 15020002
*              SCAN DIRECTORY BLOCK                                   * 15040002
*        BEGIN BY SETTING UP SCAN LIMITS                              * 15060002
*********************************************************************** 15080002
         LA    RPDS1,PDBENT1      SET START ADDR                        15100002
         USING PDS1,RPDS1                                               15120002
MORESCAN LH    RY,PDBUSE          SET UP RY TO STOP SCAN                15140002
         AR    RY,RAREA           AT END OF IN USE PORTION              15160002
         BCTR  RY,0               BACK UP TO LAST VALID BYTE            15180002
         LA    RZ,PDS2LUSR        SET MASK FOR C BYTE                   15200002
*                                                                       15220002
***            CHECK THIS ENTRY                                         15240002
*                                                                       15260002
CMPARE   CLC   PDS1NAME,PDS2NAME  COMPARE NAMES                         15280002
         BE    DFOUND             IF FOUND, GO FILL ENTRY               15300002
         BL    NAMELO             IF LOW CONTINUE SEARCH         Y02072 15320002
*                                                                       15321002
***            NOT IN THIS DIRECTORY                                    15322002
*                                                                       15323002
         MVI   ERCODE,ERRNAME     SET ERROR CODE 4               Y02072 15325002
         B     UNFILLED           GO GET NEXT USER ENTRY         Y02072 15330002
*                                                                       15340002
***            DIRECTORY NAME LOW--GO TO NEXT DIRECTORY ENTRY           15360002
*                                                                       15380002
NAMELO   EQU   *                                                 Y02072 15385002
         IC    RX,PDS1INDC        GET DE FIELD LENGTH (HALFWORDS)       15400002
         NR    RX,RZ              MASK OFF FLAG BITS                    15420002
         LA    RX,PDS1USRD-PDS1(RX,RX)   ENTIRE ENTRY LENGTH IN BYTES   15440002
*        THE FOLLOWING BXLE ADDS RX TO RPDS1 AND COMPARES WITH RY       15460002
*        IT REQUIRES THAT RX-RY BE AN EVEN-ODD PAIR                     15480002
         BXLE  RPDS1,RX,CMPARE    LOOP IF MORE ENTRIES IN BLOCK         15500002
         MVC   CCHHR,NEWCNT       ELSE SET SEARCH ARG FOR CHANNEL       15520002
*                                 PROGRAM TO CONTINUE SCAN              15540002
         B     READ               AND GO ISSUE EXCP                     15560002
         SPACE 2                                                        15580002
*********************************************************************** 15600002
*        CORRECT ENTRY FOUND -- MOVE IT INTO USER LIST                * 15620002
*********************************************************************** 15640002
*                                                                       15660002
*********EXECUTED INSTRUCTION****************************************** 15680002
MOVE     MVC   PDS2USRD-1(0),PDS1USRD-1   EXECUTED AT E BELOW           15700002
*********EXECUTED INSTRUCTION****************************************** 15720002
*                                                                       15740002
DFOUND   MVC   PDS2TTRP,PDS1TTRP  MOVE TTR                              15760002
         IC    RX,PDS1INDC        GET C FROM DIRECTORY                  15780002
         NR    RX,RZ              MASK OFF FLAG BITS                    15800002
         LA    RY,PDS2USRD-PDS2   LENGTH OF ENTRY STANDARD PORTION      15820002
         LCR   RY,RY              TO BE SUBTRACTED FROM TOTAL LENGTH    15840002
         AH    RY,BLDELEN         YIELDING LENGTH TO MOVE               15860002
         BM    NOMOVE             BYPASS MOVE IF NEGATIVE               15880002
*              THE FOLLOWING BXLE DOUBLES THE DIRECTORY ENTRY LENGTH    15900002
*              IN RX TO CONVERT FROM HALFWORDS TO BYTES, AND USES IT    15920002
*              IF IT IS NOT GREATER THAN THE USER ENTRY LENGTH.         15940002
         BXLE  RX,RX,EXEC                                               15960002
*                                 DROPS THROUGH IF DIRECTORY LENGTH     15980002
*                                 IS GREATER.                           16000002
         LR    RX,RY              IN THIS CASE TAKE USER LENGTH         16020002
EXEC     EQU   *                                                        16040002
         TM    EXSFLG,EXSSYDCB+EXSBLDL SYSTEM DCB AND BLDL?      Y02072 16041702
         BNO   EXEC1              NO KEY CHANGE NOT NEEDED       Y02072 16041802
         DROP  RCVT               MODESET WORKREG IS RCVT        Y02072 16042502
         MODESET KEYADDR=EXSKEY,WORKREG=3 SET TO CALLER KEY      Y02072 16043202
         L     RCVT,CVTPTR        RESTORE CVT POINTER            Y02072 16043902
         USING CVT,RCVT                                          Y02072 16044102
EXEC1    EQU   *                                                        16044302
         EX    RX,MOVE            MOVE USER DATA + INDC BYTE            16045902
         TM    EXSFLG,EXSSYDCB+EXSBLDL KEY CHANGED ?             Y02072 16047902
         BNO   EXEC3              NO - CONTINUE                  Y02072 16049902
         MODESET EXTKEY=SUPR      YES - RETURN TO SUPR KEY       Y02072 16051902
EXEC3    EQU   *                                                        16053902
         SR    RX,RX              CLEAR REG                    @ZA26444 16060037
         IC    RX,LIB             JOBLIB Z BYTE                @ZA26444 16062037
         TM    LIB,JOBLIB         JOBLIB                       @ZA26444 16064037
         BZ    MOVEZ              MOVE Z BYTE                  @ZA26444 16066037
         SRL   RX,4               SHIFT OUT LOWER BIT          @ZA26444 16068037
MOVEZ    EQU   *                                               @ZA26444 16070037
         STC   RX,PDS2LIBF        MOVE LIB # TO USER Z FIELD   @ZA26444 16072037
NOMOVE   IC    RX,CONCAT#         GET CONCATENATION NUMBER              16080002
         STC   RX,PDS2CNCT        PUT IT INTO USERS LIST                16100002
         B     UNFILLED           GO GET NEXT USER ENTRY                16120002
         SPACE 2                                                        16140002
*********************************************************************** 16160002
*        THIS ROUTINE FINDS THE NEXT UNFILLED USER ENTRY              * 16180002
*        IT IS ENTERED AT LABEL 'UNFILLED'                            * 16200002
*********************************************************************** 16220002
*                                                                       16240002
UNFIL2   AH    RPDS2,BLDELEN      GO TO NEXT ENTRY                      16260002
         CLI   PDS2TTRP+2,0       IF IT HAS NOT BEEN FILLED,            16280002
         BE    MORESCAN           THEN GO PROCESS IT             Y02072 16300002
UNFILLED BCT   RSULEFT,UNFIL2     BRANCH IF THERE ARE MORE LIST ENTRIES 16320002
*                                                                       16340002
***      END OF LIST REACHED -- CHECK FOR ANY OMISSIONS                 16360002
*                                                                       16380002
         SR    R15,R15                                                  16400002
         IC    R15,ERCODE         GET ANY SAVED ERROR                   16420002
         LTR   R15,R15            TEST FOR ERROR,                A27543 16440002
         BZ    FINDRET            BR IF NOT TO RETURN            Y02072 16460002
         SPACE 2                                                        16480002
*********************************************************************** 16500002
***      DETERMINE WHETHER OR NOT THERE ARE CONCATENATED DATA    A28189 16520002
***      SETS IN WHICH TO SEARCH FOR A MEMBER. THIS CAN BE       A28189 16540002
***      DONE ONLY IF THE DATA SET IS PARTITIONED AND HAS BEEN   A28189 16560002
***      OPENED FOR INPUT.                                       A28189 16580002
*********************************************************************** 16600002
*                                                                A28189 16620002
         L     RDEB,DCBDEBAD      GET DEB ACCESS METHOD LENGTH          16640002
         USING DEBBASIC,RDEB                                            16660002
         CLC   DEBAMLNG,CONCAT#   TEST FOR MORE DATA SETS,       A28189 16680002
         BH    CNCK               IF LONGER, GO CHECK OPEN TYPE  A28189 16700002
         TM    LIB,JOBLIB         TEST FOR JOBLIB DCB,         @ZA26444 16720037
         BZ    FINDRET            BR IF NOT BACK TO COMMON     @ZA26444 16730037
*                                                                       16740037
***            SEARCH FOR DISTINCT TASK LIBS TO CONCATENATE             16750037
*                                                                       16760037
         L     RZ,CVTTCBP         FIND TCB POINTERS            @ZA26444 16770037
         USING TCBPTRS,RZ                                      @ZA26444 16780037
         L     RZ,TCBPTRC         FIND CURRENT TCB             @ZA26444 16790037
         USING TCB,RZ                                          @ZA26444 16800037
         L     RX,TCBJLB          JOBLIB DCB ADDR              @ZA26444 16810037
         SR    R0,R0              CLEAR REG                    @ZA26444 16820037
         IC    R0,LIB             GET LIBRARY FLAG             @ZA26444 16830037
         MVI   LIB,TASKLIB        MOVE IN TASKLIB FLAG         @ZA26444 16840037
         SRL   R0,4               STRIP OFF LIB IND            @ZA26444 16850037
         BCTR  R0,0               SET LOOP CONTROL             @ZA26444 16860037
TAGZ1    EQU   *                                               @ZA26444 16870037
         CR    RX,RDCB            IS THIS DCB SAME AS          @ZA26444 16880037
*                                 ONE WE JUST SEARCHED         @ZA26444 16890037
         BNE   TAGZ3              NO BRANCH                    @ZA26444 16900037
TAGZ2    EQU   *                                               @ZA26444 16910037
         IC    R15,LIB            ADD 1 TO TOP NIBBLE OF       @ZA26444 16920037
         LA    R15,16(R15)        LIBFLAG BYTE INDICATES       @ZA26444 16930037
         STC   R15,LIB            WHICH TCB LEVEL CURRENT      @ZA26444 16940037
         L     RZ,TCBOTC          LOAD MOTHER TCB              @ZA26444 16950037
         LTR   RZ,RZ              IS THE MOTHER TCB ZERO       @ZA27485 16953037
         BZ    TAGH                NO GO SEARCH LINKLIB        @ZA27495 16956037
         L     RX,TCBJLB          GET JOBLIB FOR MOTHER        @ZA26444 16960037
         LTR   RX,RX              DOES MOTHER HAVE JOBLIB      @ZA26444 16970037
         BZ    TAGH               NO GO SEARCH LINKLIB         @ZA26444 16980037
         B     TAGZ1              YES, GO ON                   @ZA26444 16990037
TAGZ3    EQU   *                                               @ZA26444 17000037
         BCT   R0,TAGZ2           IF NEW DCB PICKED UP &       @ZA26444 17010037
*                                 ITS NOT 1ST, LOOP AROUND TO  @ZA26444 17020037
*                                 UPDATE LIBFLAG BEFORE START  @ZA26444 17030037
*                                 DIRECTORY SEARCH OF THIS LIB @ZA26444 17040037
         LR    RDCB,RX            UPDATE TO NEW DCB            @ZA26444 17050037
         B     CAT8               GO BEGIN DIRECTORY SEARCH    @ZA26444 17060037
*                                                              @ZA26444 17070037
TAGH     EQU   *                                               @ZA26444 17080037
*                                                              @ZA26444 17090037
*              JOBLIB SEARCH COMPLETED                         @ZA26444 17100037
*                                                              @ZA26444 17110037
         MVI   LIB,LINKSVC        START LINKLIB SEARCH         @ZA26444 17120037
         L     RDCB,CVTLINK       LINKLIB DCB ADDR                      17420002
*                                                                       17440002
CAT8     SR    RX,RX              RESET CONCATENATION # TO ZERO   M4612 17460002
         B     STORCAT            PREPARE TO SEARCH NEW LIBRARY         17480002
         SPACE 2                                                        17500002
*********************************************************************** 17520002
*              POSSIBLE CONCATENATION WITHIN DEB                      * 17540002
*        ACCESS METHOD SECTION LENGTH INDICATES THERE MAY BE MORE     * 17560002
*        CONCATENATED DATA SETS WITHIN THIS DEB.                      * 17580002
*        FOR BPAM INPUT THIS SECTION HAS ONE BYTE PER DATA SET.       * 17600002
*        FIRST VERIFY THAT DEALING WITH BPAM INPUT.                   * 17620002
*********************************************************************** 17640002
CNCK     EQU   *                                                  13547 17660002
         TM    LIB,LINKSVC+JOBLIB   CHECK FOR LINKLIB OR JOBLIB   13547 17680002
         BM    CATINCR            IS BPAM IF EITHER               13547 17700002
         TM    DCBDSORG,DCBDSGPO  TEST FOR PARTITIONED DATA SET, A28189 17720002
         BNO   FINDRET            BR IF NOT TO RETURN            Y02072 17740002
         TM    DEBOPATB,DEBACCS   TEST FOR INPUT,                A28189 17760002
         BNZ   FINDRET            BR IF NOT TO RETURN            Y02072 17780002
         DROP  RDEB                                               22232 17800002
*                                                                       17820002
***            INCREMENT CONCATENATION NUMBER                           17840002
*                                                                       17860002
CATINCR  SR    RX,RX              CLEAR REGISTER                        17880002
         IC    RX,CONCAT#         PICK UP PREVIOUS CONCAT NR            17900002
         LA    RX,1(RX)           ADD ONE                               17920002
*                                                                       17940002
***      STORE UPDATED CONCAT NR AND RESET SCAN OF USER LIST            17960002
*                                                                       17980002
STORCAT  STC   RX,CONCAT#                                               18000002
         BAL   RSUBR,FIRSTMTY     RESTART SCAN OF USER LIST             18020002
         B     SEARCH             BEGIN SEARCH AGAIN                    18040002
         DROP  RAREA,RCVT,RPDS2,RPDS1,RDCB,RBASE,RLIST                  18740002
         EJECT                                                          18740402
*                                                                       18740802
*        BOOTSTRAP ROUTINE.  ENTERED FROM RTM ON AN ATTEMPT TO          18741202
*        ABNORMALLY TERMINATE IGC018.  THIS ROUTINE FINDS AND           18741602
*        BRANCHES TO THE TASK RECOVERY ROUTINE - IGCT0018.              18741702
*                                                                       18741802
EXITRTN  IGGSTAE TRR              BOOTSTRAP ROUTINE              Y02072 18742002
         EJECT                                                          18760002
*********************************************************************** 18780002
*              CONSTANTS                                              * 18800002
*********************************************************************** 18820002
PATCH    DC    XL50'00'           PATCH AREA                   @ZA12201 18830037
DECREC   DC    H'256'             USED TO DECREMENT R OF TTR BY 1       18840002
FINDHDR  DC    H'1',AL2(FNDENTSZ)   FIND'S BLDL LIST HEADER             18860002
TRR      DC    CL8'IGCT0018'      TRR NAME                       Y02072 18862002
IEARESBS DC    F'0'               LOC OF RES BLDL SVC-LIB-TABLE         18900002
IEARESBL DC    F'0'               LOC OF RES BLDL LINKLIB TABLE         18920002
         ENTRY IEARESBL           EXTERNAL SYMBOL FOR NIP               18940002
         ENTRY IEARESBS           EXTERNAL SYMBOL FOR NIP               18960002
ESTAEL   ESTAE EXITRTN,RECORD=YES,MF=L LIST TO MOVE TO RB        Y02072 18965002
*                                                                       18980002
***            CHANNEL PROGRAM                                          19000002
*                                                                       19020002
CHANPROG DS    0D                                                       19040002
*CCW1                             SEARCH ID EQUAL                       19060002
         CCW   SIDEQ,CCHHR-WORKAREA,CCHN,L'CCHHR                        19080002
*CCW2                             TRANSFER IN CHANNEL                   19100002
         CCW   TIC,CCW1-WORKAREA,0,0                                    19120002
*CCW3                             MULTI-TRACK READ COUNT                19140002
         CCW   MRC,NEWCNT-WORKAREA,CCHN,L'NEWCNT                        19160002
*CCW4                             SEARCH KEY HIGH OR EQUAL              19180002
SKEH     CCW   SKHEQ,0,CCHN,L'PDS2NAME                                  19200002
*CCW5                             TRANSFER IN CHANNEL                   19220002
         CCW   TIC,CCW3-WORKAREA,0,0                                    19240002
*CCW6                             READ DATA                             19260002
         CCW   RD,RDAREA-WORKAREA,0,L'RDAREA                            19280002
         EJECT                                                          19300002
*********************************************************************** 19320002
*                                                                     * 19340002
*IECPRLTV-- MBBCCHHR TO TTR0 CONVERT ROUTINE                          * 19360002
*REGISTER CONVENTION--                                                * 19380002
*        0     CONTAINS RESULT TTR0                                   * 19400002
*        1     ADDRESS OF DEB                                         * 19420002
*        2     ADDRESS OF MBBCCHHR INPUT                              * 19440002
*        3-8   TRANSPARENT                                            * 19460002
*        9-13  VOLATILE                                               * 19480002
*        14    RETURN ADDRESS                                         * 19500002
*        15    ENTRY ADDRESS-- USED FOR BASE                          * 19520002
*********************************************************************** 19540002
         SPACE 3                                                        19560002
         ENTRY IECPRLTV                                                 19580002
         USING IECPRLTV,R15                                             19600002
         USING SEEKA,RGMBB                                              19620002
IECPRLTV SR    RGTTR,RGTTR        CLEAR OUTPUT REGISTER                 19640002
         LR    RGZ,RGDEB          USED LATER TO INDEX THRU EXTENTS      19660002
         USING DEBBASIC,RGZ                                             19680002
         SR    RGY,RGY                                                  19700002
         IC    RGY,SEEKM          PICKUP M                              19720002
         TM    DEBOFLGS,DEBPOCAT  CHECK FOR PDS CONCATENATION      5798 19740002
         BZ    RLTVZ              BR. IF NOT                       5798 19760002
         SPACE 2                                                        19780002
*********************************************************************** 19800002
*              FOR PDS CONCATENATION, THE DEB CONTAINS EXTENTS FOR    * 19820002
*              ALL DATA SETS.  THE BPAM SECTION OF THE DEB HAS A      * 19840002
*              SERIES OF ONE-BYTE ENTRIES INDICATING THE FIRST        * 19860002
*              EXTENT NUMBER FOR EACH DATA SET (AFTER THE FIRST).     * 19880002
*              THE FOLLOWING CODE SCANS THE BPAM SECTION BACKWARD     * 19900002
*              TO FIND WHICH DATA SET CONTAINS THE USER SPECIFIED     * 19920002
*              EXTENT NUMBER.                                         * 19940002
*********************************************************************** 19960002
         SR    RGV,RGV            ZERO OUT REGISTER                5798 19980002
         IC    RGV,DEBNMEXT       GET NUMBER OF EXTENTS            5798 20000002
         SLL   RGV,TIMES16        MULTIPLY BY 16                   5798 20020002
         AR    RGV,RGDEB          POINT TO DEB, BYPASSING BASIC    5798 20040002
         SR    RGW,RGW                                                  20060002
         IC    RGW,DEBAMLNG       GET LENGTH OF DEB A/M SECTION  A28189 20080002
*                                 THIS IS 1 LESS THAN NUMBER            20100002
*                                 OF CONCATENATED DATA SETS             20120002
         DROP  RGZ                                                 5798 20140002
*                                                                       20160002
***            ADDRESS BPAM SECTION THROUGH REGISTER WHICH HAS          20180002
***            NOT BEEN INCREMENTED PAST BASIC SECTION                  20200002
***            (BUT DOES BYPASS EXTENTS)                                20220002
*                                                                       20240002
         USING DEBACSMD-(DEBBASND-DEBBASIC),RGV                    5798 20260002
         SR    RGX,RGX            GET FIRST M FOR DATA SET N FROM  5798 20280002
RLTVX    IC    RGX,DEBEXTNM-1(RGW)  (N-1)TH BYTE OF BPAM SECTION   5798 20300002
         CR    RGY,RGX            COMPARE WITH USERS M             5798 20320002
         BNL   RLTVY              BR. IF CORRECT DATA SET          5798 20340002
         BCT   RGW,RLTVX          BR. IF ANOTHER D.S. TO CHECK     5798 20360002
         SR    RGX,RGX            M OF FIRST DATA SET IS ZERO      5798 20380002
RLTVY    SR    RGY,RGX            ADJUST USERS M TO EXTENT IN DS   5798 20400002
         SLL   RGX,TIMES16        ADJUST DEB PTR AS IF FIRST       5798 20420002
         AR    RGZ,RGX            EXTENT OF DESIRED DATA SET WERE  5798 20440002
*                                 FIRST EXTENT IN DEB                   20460002
         DROP  RGV                                                 5798 20480002
         USING DEBDASD-(DEBBASND-DEBBASIC),RGZ                     5798 20500002
RLTVZ    EQU   *                                                   5798 20520002
         LTR   RGY,RGY            IF M IS ZERO                          20540002
         BZ    RLTVB              WE ARE NOW IN THE CORRECT EXTENT      20560002
*                                 OTHERWISE GET NEXT EXTENT             20580002
RLTVA    AH    RGTTR,DEBNMTRK     NO. OF TRKS IN EXT                    20600002
         LA    RGZ,DEBDASIZ(RGZ)  GO TO NEXT EXTENT                     20620002
         BCT   RGY,RLTVA          LOOP TILL WE REACH RIGHT EXTENT       20640002
RLTVB    BAL   RGW,CNVTDVC        PICKUP DEVICE CONSTANT                20680002
         USING DVCT,RGY                                                 20700002
         SR    RGW,RGW                                                  20720002
         IC    RGW,SEEKCC         GET FIRST CC BYTE                     20740002
         SLA   RGW,8              SHIFT FOR NEXT CC BYTE                20760002
         IC    RGW,SEEKCC+1       GET ACTUAL C                          20780002
         SH    RGW,DEBSTRCC       MINUS START CC                        20800002
         MH    RGW,DVCTRK         MULTIPLY CYL TIMES TRK/CYL            20820002
         IC    RGX,SEEKHH+1       GET ACTUAL H                          20840002
         AR    RGW,RGX            PLUS TRKS IN CC                       20860002
         SH    RGW,DEBSTRHH       MINUS START HH                        20880002
         AR    RGTTR,RGW          DEVELOP TOTAL TT                      20900002
         SLL   RGTTR,8            SHIFT OVER ONE BYTE                   20920002
         IC    RGTTR,SEEKR        PICKUP R                              20940002
         SLL   RGTTR,8            ALIGH TTR0 IN REGISTER                20960002
         SR    R15,R15            SET NORMAL RETURN CODE                20980002
         BR    RRET               RETURN                                21000002
         DROP  RGZ                                                      21020002
         EJECT                                                          22040002
*********************************************************************** 22060002
*IECPCNVT--- TTRN TO MBBCCHHR CONVERT ROUTINE                         * 22080002
*                                                                     * 22100002
*THIS ROUTINE WILL CONVERT RELATIVE TRACK TT                          * 22120002
*        TO ABSOLUTE TRACK MBBCCHH                                    * 22140002
*REGISTER CONVENTION--                                                * 22160002
*        0     CONTAINS TTRN, WHERE N IS CONCATENATION NO.            * 22180002
*        1     ADDRESS OF DEB                                         * 22200002
*        2     ADDRESS OF 8 BYTE FIELD FOR RESULT MBBCCHHR            * 22220002
*        3-8   TRANSPARENT                                            * 22240002
*        9-13  VOLATILE                                               * 22260002
*        14    RETURN ADDRESS                                         * 22280002
*        15    ENTRY ADDRESS-- USED FOR BASE                          * 22300002
*********************************************************************** 22320002
         ENTRY IECPCNVT                                                 22340002
         USING DEBBASIC,RGDEB                                           22400002
         USING IECPCNVT,R15                                             22420002
IECPCNVT SR    RGV,RGV                                                  22440002
         IC    RGV,DEBNMEXT       NUMBER OF EXTENTS                     22460002
         LR    RGW,RGV            USE FOR LIMIT                         22480002
         LA    RGZ,LOBYTE         SET UP MASK FOR LOW BYTE ONLY         22500002
         NR    RGZ,RGTTR          CONCATENATION NUMBER (N)              22520002
         BZ    CNVTA              Q. N IS ZERO                          22540002
         DROP  RGDEB                                                    22560002
         LR    RGY,RGV            NUMBER OF EXTENTS                     22580002
         SLL   RGY,TIMES16        TIMES 16                              22600002
         AR    RGY,RGZ            ADD N                                 22620002
*                                                                       22640002
***            ADDRESS BPAM SECTION THROUGH REGISTER WHICH POINTS TO    22660002
***            BASIC SECTION BUT IS INDEXED BY RGY TO BYPASS EXTENTS    22680002
*                                                                       22700002
         USING DEBACSMD-(DEBBASND-DEBBASIC),RGDEB                       22720002
         IC    RGZ,DEBEXTNM-1(RGY)      FIRST M OF DATA SET N FROM      22740002
*                                       (N-1)ST BYTE OF BPAM SECTION    22760002
         DROP  RGDEB                                                    22780002
         SR    RGW,RGZ            ADJUST LIMIT                          22800002
         SLL   RGZ,TIMES16        TIMES 16                              22820002
CNVTA    AR    RGZ,RGDEB          ADJUST DEB PTR                        22840002
         USING DEBDASD-(DEBBASND-DEBBASIC),RGZ                          22860002
         SRL   RGTTR,8            SHIFT OUT CONCAT# LEAVING 0TTR        22880002
         STC   RGTTR,SEEKR        SAVE R                                22900002
         LA    RGDEB,0(RGDEB)     CLEAR HI BYTE                  S20076 22920002
         SRL   RGTTR,8            SHIFT OUT R LEAVING TT                23160002
CNVTB    SH    RGTTR,DEBNMTRK     DECREASE BY TRKS IN EXTENT            23180002
         BM    CNVTC              Q. PROPER EXTENT                      23200002
         LA    RGZ,DEBDASIZ(RGZ)  GO TO NEXT EXTENT                     23220002
         BCT   RGW,CNVTB          Q. STILL WITHIN DEB                   23240002
         LA    R15,CNVTERR        SET ERROR CODE                        23300002
         BR    RRET               RETURN                                23320002
CNVTC    SR    RGV,RGW            DEVELOP M                             23340002
         STC   RGV,SEEKM          STORE M                               23360002
         MVC   SEEKBCH,DEBBINUM   MOVE BBCCHH FROM DEB                  23380002
         AH    RGTTR,DEBNMTRK     ADD BACK OVERDRAW                     23420002
         BZ    CNVTEND            IF ZERO, NO DIVIDE NEEDED             23440002
         BAL   RGW,CNVTDVC        PICK UP DEVICE CONSTANT               23460002
         USING DVCT,RGY                                                 23480002
         LH    RGV,DVCTRK         GET TRACKS/ CYL                       23500002
         LR    RGX,RGTTR          DIVIDE REG                            23520002
         AH    RGX,DEBSTRHH       STARTING HH                           23540002
         SR    RGW,RGW            CLEAR HIGH WORD                       23560002
         DR    RGW,RGV            QUO=CYLS, REM=TRKS                    23580002
         STC   RGW,SEEKHH+1       STORE H                               23600002
         AH    RGX,DEBSTRCC       PLUS CC START                         23620002
         STC   RGX,SEEKCC+1       STORE C                               23640002
         SRA   RGX,8              SHIFT FOR HIGH C                      23660002
         STC   RGX,SEEKCC         GET BYTE                              23680002
CNVTEND  SR    R15,R15            SET NORMAL RETURN CODE                23700002
         BR    RRET               RETURN                                23720002
*                                                                       23740002
***            PICKUP LOCATION OF APPROPRIATE DEVICE CONSTANTS          23760002
*                                                                       23780002
CNVTDVC  L     RGY,DEBDVMOD       CB ADDRESS                            23800002
         USING UCB,RGY                                                  23820002
         LA    RGX,DVCTYPMK       MASK                                  23840002
         N     RGX,UCBTYP         DEVICE TYPE CODE                      23860002
         L     RGY,CVTPTR         GET CVT ADDR                          23880002
         USING CVT,RGY                                                  23900002
         L     RGY,CVTZDTAB       GET DEVICE TABLE                      23920002
         USING DVCTI,RGY                                                23940002
         IC    RGX,DVCTIOFF(RGX)  GET DEVICE OFFSET                     23960002
         AR    RGY,RGX            GET DEVICE ENTRY                      23980002
         DROP  RGY                                                      24000002
         BR    RGW                RETURN TO CALLER                      24020002
         TITLE ' IGC018 - IEC0SCR1 - SECTOR CONVERT ROUTINE'            28200002
IEC0SCR1 CSECT                                                          28220002
*                                                                       28240002
**********************************************************************  28260002
*                                                                       28280002
*        RELEASE 22 DELETIONS                                           28300002
*        RELEASE 21 DELETIONS                                           28320002
*        RELEASE 20 DELETIONS                                           28340002
*                                                                       28360002
* FUNCTION     THIS ROUTINE CONVERTS THE RECORD NUMBER OF A FIX-        28380002
*              ED OR VARIABLE LENGTH RECORD DATA SET INTO THE           28400002
*              CORRESPONDING SECTOR VALUE FOR USE WITH AN I/O           28420002
*              DEVICE HAVING THE ROTATIONAL POSITION SENSING            28440002
*              (RPS) FEATURE.                                           28460002
*                                                                       28480002
* INPUT FOR FIXED LENGTH RECORDS --                                     28500002
*            - REGISTER 0 IS LOADED WITH A FOUR-BYTE VALUE IN           28520002
*              THE FORM OF 'DDKR' WHERE 'DD' IS A TWO-BYTE FIELD        28540002
*              CONTAINING THE PHYSICAL BLOCK SIZE, 'K' IS A ONE         28560002
*              BYTE FIELD CONTAINING THE KEY LENGTH, AND 'R' IS         28580002
*              THE RECORD NUMBER FOR WHICH A SECTOR VALUE IS            28600002
*              DESIRED.                                                 28620002
*            - REGISTER 2 CONTAINS THE ONE-BYTE UCB DEVICE TYPE         28640002
*              CODE (UCB + 19) IN THE HIGH ORDER BYTE, AND THE          28660002
*              REMAINING 3 BYTES ARE THE ADDRESS OF A ONE BYTE          28680002
*              AREA THAT IS TO RECEIVE THE SECTOR VALUE.                28700002
*            - REGISTER 14 CONTAINS THE ADDRESS TO WHICH CONTROL        28720002
*              IS TO BE RETURNED AFTER EXECUTION OF THE SECTOR          28740002
*              CONVERT ROUTINE.                                         28760002
*            - REGISTER 15 CONTAINS THE ADDRESS OF THE ENTRY            28780002
*              POINT TO THIS ROUTINE AND IS USED AS A BASE              28800002
*              REGISTER.                                                28820002
*       FOR VARIABLE LENGTH RECORDS --                                  28840002
*            - REGISTER 0 IS LOADED WITH A FOUR-BYTE VALUE IN THE       28860002
*              FORM OF BBIR, WHERE BB IS THE TOTAL NUMBER OF KEY        28880002
*              AND DATA BYTES UP TO BUT NOT INCLUDING THE TARGET        28900002
*              RECORD, I IS A ONE-BYTE KEY INDICATOR ( 1 FOR KEYED      28920002
*              RECORDS, 0 FOR NON-KEYED RECORDS), AND R IS THE SAME     28940002
*              AS FOR FIXED LENGTH RECORDS.  THE HIGH ORDER BIT OF      28960002
*              THIS REGISTER MUST BE TURNED ON TO INDICATE VLR.         28980002
*            - REGISTERS 2, 14, 15 ARE THE SAME AS FOR FIXED LENGTH     29000002
*              RECORDS.                                                 29020002
*                                                                       29040002
* OUTPUT       THE SECTOR VALUE CORRESPONDING TO THE RECORD             29060002
*              NUMBER PASSED TO THE CONVERT ROUTINE IN THE LOW-         29080002
*              ORDER BYTE OF REGISTER 0 IS PLACED AT THE ADDRESS        29100002
*              INDICATED REGISTER 2.                                    29120002
*              REGISTERS 0,9,10, AND 11 ARE MODIFIED AND NOT RESTORED.  29140002
*                                                                       29160002
* EXIT         CONTROL IS RETURNED TO THE ADDRESS PASSED IN REG-        29180002
*              ISTER 14.                                                29200002
*                                                                       29220002
* ATTRIBUTES   REENTRANT                                                29240002
*                                                                       29260002
**********************************************************************  29280002
**********************************************************************  29340002
*        GENERAL REGISTER USAGE                                      *  29360002
**********************************************************************  29380002
*                                                                       29400002
RPAR1    EQU   0                  INPUT PARAMETER REG.                  29420002
RPAR2    EQU   2                  INPUT PARAMETER REG.                  29440002
RDVCT    EQU   9                  ADDR OF DEVICE ENTRY                  29460002
RWK1     EQU   10                 WORK REGISTER                         29480002
RWK2     EQU   11                 WORK REGISTER                         29500002
RETRG    EQU   14                 POINTS TO PLACE OF RETURN             29520002
BASRG    EQU   15                 BASE REGISTER                         29540002
         SPACE 3                                                        29560002
**********************************************************************  29580002
*              SHIFT DISPLACEMENT EQUATES                            *  29600002
**********************************************************************  29620002
*                                                                       29640002
SHFT1    EQU   8                  NO. BITS FOR 1-BYTE SHIFT             29660002
SHFT2    EQU   16                 BITS FOR TWO-BYTE SHIFT               29680002
SHFT3    EQU   24                 NO. BITS FOR 3-BYTE SHIFT             29700002
SHFT4    EQU   32                 BITS FOR FOUR-BYTE SHIFT              29720002
         EJECT                                                          29760002
**********************************************************************  29780002
*        CALCULATE EFFECTIVE BLOCK LENGTH                            *  29800002
**********************************************************************  29820002
*                                                                       29840002
         USING *,R15              ESTABLISH ADDRESSABILITY              29860002
         USING SECTAREA,RPAR2                                           29880002
         STC   RPAR1,SECTAREA     SAVE RECORD # IN SECTOR AREA          29960002
         CLI   SECTAREA,0         DOES R=0 ?                            29980002
         BER   RRET               IF YES, RETURN                        30000002
         LTR   RWK1,RPAR1         VARIABLE-LENGTH RECORDS ?             30020002
         BM    VLR                BRANCH IF YES                         30040002
         SRDL  RWK1,SHFT2         PUT KEYLEN AND RECNO INTO RWK2        30060002
         SRL   RWK2,SHFT3         PUT K IN LOW ORDER BYTE               30080002
         AR    RWK1,RWK2          KEY LENGTH + DATA LENGTH              30100002
         SRDL  RWK1,SHFT4         CLEAR 1, PUT SUM IN 2                 30120002
         IC    RWK1,SECTAREA      GET R                                 30140002
         BCTR  RWK1,0             SUBTRACT 1 FROM R                     30160002
         MR    RWK1,RWK1          (R-1)*(KL+DL) INTO RWK2               30180002
*                                                                       30200002
**********************************************************************  30220002
*        CALCULATE NUMBER OF BYTES ON TRACK PRIOR TO RECORD 'R'      *  30240002
**********************************************************************  30260002
*                                                                       30280002
HERE     EQU   *                                                        30300002
         LR    RWK1,RPAR1         PUT PARAM.S IN WORK REG.              30320002
         LR    RPAR1,RWK2         SAVE TOTAL SO FAR                     30340002
         L     RWK2,CVTPTR        GET CVT ADDRESS                       30360002
         USING CVT,RWK2                                                 30380002
         L     RDVCT,CVTZDTAB     GET DCT INDEX TABLE ADDR              30400002
         USING DVCTI,RDVCT                                              30420002
         DROP  RWK2                                                     30440002
         LR    RWK2,RPAR2                                               30460002
         SRL   RWK2,SHFT3         GET DEVICE CODE                       30480002
         IC    RWK2,DVCTIOFF(RWK2) GET DCT INDEX BYTE                   30500002
         AR    RDVCT,RWK2         GET DCT ENTRY ADDRESS                 30520002
         USING DVCT,RDVCT                                               30540002
         SRDL  RWK1,SHFT2         SHIFT OUT K&R                         30560002
         SRL   RWK2,SHFT3         PUT K IN LOW ORDER BYTE               30580002
         LR    RWK1,RWK2          PUT K IN RWK1 ALSO                    30600002
         IC    RWK2,DVCOVNLB      GET BLOCK OVERHEAD                    30620002
         TM    DVCFLAGS,DVC2BOV   IS THIS A TWO BYTE DEVICE             30640002
         BZ    ONEBYTE            BRANCH IF ONE BYTE                    30660002
         LH    RWK2,DVCOVHD       GET BLOCK OVERHEAD                    30680002
ONEBYTE  EQU   *                                                        30700002
         LTR   RWK1,RWK1          KEYED RECORDS ?                       30720002
         BP    KEYED              BRANCH IF YES                         30740002
         IC    RWK1,DVCOVNK       GET SUBTRACTION FACTOR                30760002
         SR    RWK2,RWK1          SUBTRACT FOR NO KEY                   30780002
KEYED    EQU   *                                                        30800002
         IC    RWK1,SECTAREA      GET R                                 30820002
         BCTR  RWK1,0             SUBTRACT ONE FROM R                   30840002
         MR    RWK1,RWK1          (R-1)(Y-K)                            30860002
         AH    RWK2,DVCOVR0       ADD RECORD 0 OVERHEAD                 30880002
         AR    RWK2,RPAR1         ADD BB OR K+DD                        30900002
*                                                                       30920002
**********************************************************************  30940002
*        CALCULATE AND STORE THE SECTOR VALUE, RETURN                *  30960002
**********************************************************************  30980002
*                                                                       31000002
         IC    RWK1,DVCSECTD      GET NUMBER OF SECTORS                 31020002
         MR    RWK1,RWK1          (#SECTORS)(TOTAL SO FAR)              31040002
         LH    RPAR1,DVCTRKLN     TRACK CAPACITY                        31060002
         DR    RWK1,RPAR1         DIVIDE TOTAL BY TRACK CAP             31080002
         STC   RWK2,SECTAREA      STORE SECTOR                          31100002
         BR    RETRG              RETURN                                31120002
VLR      EQU   *                                                        31140002
         SLL   RWK1,1             SHIFT OUT SIGN                        31160002
         SRL   RWK1,SHFT2+1       SHIFT OUT I&R                         31180002
         LR    RWK2,RWK1          MATCH REG. SETUP                      31200002
         B     HERE                                                     31220002
         DROP  R15,RPAR2,RDVCT                                          31240002
         EJECT                                                          31260002
         TITLE ' IGC018 - DSECTS LOCAL TO THIS MODULE'                  33880002
WORKAREA DSECT                                                          33900002
*********************************************************************** 33920002
*        THIS DSECT DESCRIBES THE AREA OBTAINED BY GETMAIN AS A WORK  * 33940002
*        AREA FOR THIS MODULE.                                        * 33960002
*        (FOR BRANCH ENTRY THE WORK AREA IS PASSED TO BLDL)           * 33980002
*********************************************************************** 34000002
*                                                                       34020002
***            THE FIRST SECTION IS USED PRIMARILY TO READ              34040002
***            DIRECTORY BLOCKS BUT IS ALSO USED AS A SAVE AREA         34060002
*                                                                       34080002
RDAREA   DS    CL256              SPACE FOR ONE DIRECTORY BLOCK         34100002
         ORG   RDAREA             REDEFINE AS DIRECTORY BLOCK           34120002
PDBUSE   DS    H                  NUMBER OF BYTES USED IN BLOCK         34140002
PDBENT1  EQU   *                  START OF RIRST ENTRY                  34160002
         ORG                                                            34180002
*                                                                       34200002
***            THE NEXT SECTION CONTAINS THE CHANNEL PROGRAM            34220002
***            AND ASSOCIATED CONTROL FIELD                             34240002
*                                                                       34260002
CLRSEG   DS    0C                 BEGINNING OF SEGMENT TO CLEAR         34280002
NEWCNT   DS    C'CCHHRKDD'        COUNT FIELD READ                      34300002
*                                                                       34320002
CCW      DS    0D                 CHANNEL PROGRAM                       34340002
CCW1     DS    D                  SID=   CCHHR(5)                       34360002
CCW2     DS    D                  TIC    CCW1                           34380002
CCW3     DS    D                  RC(MT) NEWCNT(8)                      34400002
CCW4     DS    D                  SKH=   MEMBER(8)                      34420002
         ORG   CCW4                                                     34440002
         DS    C                  OP CODE                               34460002
CCWKEYPT DS    AL3                USER MEMBER NAME PTR                  34480002
         ORG                                                            34500002
CCW5     DS    D                  TIC    CCW3                           34520002
CCW6     DS    D                  RD     RDAREA(256)                    34540002
*                                                                       34560002
***            THE FOLLOWING WORD CONTAINS FLAGS AND STATUS             34580002
***            INFORMATION CONTROLLING THE PROCESSING OF BLDL           34600002
*                                                                       34620002
ERCODE   DS    XL1                RETURN CODE TO BE SET                 34640002
ERRNAME  EQU   4                  NAME NOT FOUND IN DIRECTORY           34660002
CONCAT#  DS    FL1                CONCAT NUMBER CURRENTLY SEARCHING     34680002
LIB      DS    FL1                TYPE OF LIBRARY NOW SEARCHING         34700002
USERLIB  EQU   0                  USER LIBRARY                          34720002
LINKSVC  EQU   1                  SYSTEM LINK LIBRARY                   34740002
JOBLIB   EQU   2                  USER JOB LIBRARY OR STEP LIBRARY      34760002
NOLIB    EQU   3                  LINK AND JOB/STEP ALREADY SEARCHED    34780002
TASKLIB  EQU   X'22'              TASKLIB FLAG                @ZA26444  34790037
*                                                                       34800002
***            THE NEXT SECTION CONTAINS THE IOB AND ECB FOR EXCP       34820002
*                                                                       34840002
ECB      DS    F                                                        34860002
COMPLETE EQU   X'40'              POSTED COMPLETE BY IOS                34880002
NORMAL   EQU   X'20'              ON IF NO ERRORS ON I/O                34900002
         SPACE                                                          34920002
         ORG   *-16               DO NOT USE IOB PREFIX                 34940002
*        IEZIOB DSECT=NO          MACRO GENERATED WITH PRINT NOGEN      34960002
         PRINT NOGEN                                                    34980002
         IEZIOB DSECT=NO                                                35000002
         PRINT GEN                                                      35020002
         ORG   IOBCC              REDEFINE PART OF SEEK FIELD           35040002
CCHHR    DS    C'CCHHR'                                                 35060002
*                                                                       35080002
***            THE FOLLOWING SECTION IS USED BY FIND TO BUILD           35100002
***            A PARAMETER LIST WHICH WILL BE INPUT TO BLDL             35120002
*                                                                       35140002
FNDLST1  DS    F                  COUNT AND LENGTH FIELDS               35160002
FNDLST2  DS    CL8                MEMBER NAME                           35180002
FNDLST3  DS    F                  SPACE FOR TTR                         35200002
FNDENTSZ EQU   *-FNDLST2          SIZE OF FIND'S BLDL LIST      YM01287 35220002
*                                                                       35240002
WORKSZ   EQU   *-WORKAREA                                               35380002
         EJECT                                                          35400002
SEEKA    DSECT                                                          35420002
*********************************************************************** 35440002
*        THIS DSECT DESCRIBES THE 8 BYTE IOS SEEK FIELD (MBBCCHHR)    * 35460002
*********************************************************************** 35480002
SEEKM    DS    XL1                EXTENT NUMBER                         35500002
SEEKBCH  DS    0XL6               BIN, CYL, AND HEAD NR.                35520002
SEEKBB   DS    XL2                BIN NUMBER                            35540002
SEEKCC   DS    XL2                CYLINDER NUMBER                       35560002
SEEKHH   DS    XL2                HEAD NUMBER                           35580002
SEEKR    DS    X                  RECORD NUMBER                         35600002
         SPACE 3                                                        35620002
BLDLIST  DSECT                                                          35640002
*********************************************************************** 35660002
*        THIS DSECT DESCRIBES THE HEADER PORTION OF A BLDL PARM LIST  * 35680002
*********************************************************************** 35700002
BLDENTS  DS    H                  NUMBER OF ENTRIES IN BLDL LIST        35720002
BLDELEN  DS    H                  LENGTH OF EACH ENTRY                  35740002
BLDHDSZ  EQU   *-BLDLIST          LENGTH OF HEADER                      35760002
BLDENT   DS    0C                 OFFSET TO FIRST ENTRY                 35780002
         SPACE 3                                                        35800002
FINDLIST DSECT                                                          35820002
*********************************************************************** 35840002
*        PARAMETER LIST FOR FIND                                      * 35860002
*********************************************************************** 35880002
FINDNAME DS    CL8                MEMBER NAME FOR FIND                  35900002
         SPACE 3                                                        35920002
TCBPTRS  DSECT                                                          35940002
*********************************************************************** 35960002
*        THIS DSECT DESCRIBES THE TCB POINTERS BLOCK                  * 35980002
*        THIS BLOCK IS FOUND THROUGH CVTTCBP                          * 36000002
*********************************************************************** 36020002
TCBPTRN  DS    A                  NEXT TCB TO DISPATCH                  36040002
TCBPTRC  DS    A                  CURRENT TCB                           36060002
         SPACE 3                                                        36080002
RESTAB   DSECT                                                          36100002
*********************************************************************** 36120002
*        THIS DSECT DESCRIBES THE HEADER PORTION OF A RESIDENT TABLE  * 36140002
*        THE SVC AND LINK RESIDENT TABLES ARE LOCATED THROUGH         * 36160002
*        ADDRESSES PLACED IN BLDL (IEARESBS AND IEARESBL) DURING NIP  * 36180002
*********************************************************************** 36200002
RESNUM   DS    H                  NUMBER OF ENTRIES IN TABLE            36220002
RESELEN  DS    H                  LENGTH OF EACH ENTRY                  36240002
RESENT1  DS    0C                 START OF FIRST ENTRY                  36260002
         SPACE 3                                                        36280002
RESENT   DSECT                                                          36300002
*********************************************************************** 36320002
*        THIS DSECT DESCRIBES AN ENTRY IN THE RESIDENT TABLE          * 36340002
*********************************************************************** 36360002
RESNAME  DS    CL8                MEMBER NAME                           36380002
RESDATA  DS    0C                 BEGINNING OF DATA AREA                36400002
RESTT    DS    H                  TRACK NUMBER OF FIRST BLOCK           36420002
RESREC   DS    C                  RECORD NUMBER ON TRACK OF FIRST BLOCK 36440002
         SPACE 3                                                        36460002
SECTOR   DSECT                                                          36480002
*********************************************************************** 36500002
*        DSECT OF PARAMETER PASSED TO SECTOR CONVERT ROUTINE          * 36520002
*********************************************************************** 36540002
SECTAREA DS    C                  ONE BYTE SECTOR NUMBER                36560002
         SPACE 3                                                        36580002
*********************************************************************** 36600002
DUMMY    DSECT ,                  USED ONLY TO FORCE REGISTER XREF      36620002
         TITLE ' IGC018 - DSECTS INVOKED FROM MACLIB'                   37400002
         CVT   DSECT=YES                                                37420002
         EJECT                                                          37440002
         DCBD  DSORG=PS,DEVD=DA                                         37660002
         EJECT                                                          37662002
         IEZDEB                                                         37680002
         EJECT                                                          37682002
         IHARB                                                          37700002
         EJECT                                                          37702002
         IKJTCB                                                         37720002
         EJECT                                                          37760002
*********************************************************************** 37780002
*        THE FOLLOWING DEFINITIONS ARE ADDED LOCALLY TO THE DSECT     * 37800002
*        THEY SHOULD BE REMOVED WHEN THE CORRESPONDING FUNCTIONS      * 37820002
*        HAVE BEEN INCLUDED IN THE MAPPING MACRO                      * 37840002
*********************************************************************** 37860002
DEBDASD  DSECT                    RESUME END OF DSECT IN MACRO          37880002
DEBDASIZ EQU   *-DEBDASD          LENGTH OF DASD EXTENSION              37900002
DEBPOCAT EQU   BIT7               IN DEBOFLGS--OPENED TYPORG=PO,        37920002
*                                 AND CONCATENATED                      37940002
*                                                                       37942002
*        THIS DSECT MAPS IGC018'S USE OF THE EXTENDED SAVE AREA         37944002
*                                                                       37946002
RBPRFX   DSECT                                                          37948002
         ORG   RBEXSAVE                                                 37948402
EXSKEY   DS    FL1                KEY OF CALLER                         37950002
EXSFLG   DS    X                  FLAG BYTE                             37952002
EXSSYDCB EQU   X'80'              USING SYSTEM DCB                      37954002
EXSGTM   EQU   X'40'              WORK AREA STILL HELD                  37956002
EXSBLDL  EQU   X'20'              BLDL BEING PROCESSED NOT FIND         37958002
EXSYNCH  EQU   X'10'              IN SYNCHED ROUTINE                    37958202
         DS    XL2                UNUSED                                37958402
EXSWKAD  DS    A                  WORKAREA ADDRESS                      37958802
EXSRET   DS    A                  RETURN ADDRESS                        37959202
EXSBASE  DS    A                  BASE SAVED IF SYNCH PERFORMED  Y02072 37959602
EXSRG2   DS    1F                 SAVE REG 2 DURING IECPCNVT     Y02072 37959702
EXSSAVE  DS    7F                 REG SAVE AREA DURING CCW RELOC Y02072 37959802
*                                 AND IECPCNVT                   Y02072 37961002
         ORG   EXSSAVE                                           Y02072 37962502
EXSESTAE ESTAE EXITRTN,RECORD=YES,MF=L ESTAEL LIST IN RB         Y02072 37963702
EXSELEN  EQU   *-EXSESTAE                                        Y02072 37964902
         EJECT                                                          37969902
         IHADVCT                                                        37980002
         EJECT                                                          38000002
         IHAPDS                                                         38020002
         SPACE 2                                                        38040002
*********************************************************************** 38060002
*        THE FOLLOWING DEFINITIONS ARE ADDED LOCALLY TO THE DSECT     * 38080002
*        THEY SHOULD BE REMOVED WHEN THE CORRESPONDING FUNCTIONS      * 38100002
*        HAVE BEEN INCLUDED IN THE MAPPING MACRO                      * 38120002
*********************************************************************** 38140002
PDS2MIN  EQU   PDS2LIBF-PDS2      MINIMUM ALLOWABLE USER LENGTH         38160002
         EJECT                                                          38180002
*********************************************************************** 38200002
*        THE FOLLOWING DSECT IS LOCAL TO THIS MODULE,                 * 38220002
*        BUT APPEARS HERE SINCE IT IS DEPENDENT ON IHAPDS.            * 38240002
*        IHAPDS CAN BE MADE TO EXPAND IN THE DIRECTORY ENTRY FORM     * 38260002
*        (WITHOUT BYTES ADDED BY BLDL), BUT LABELS IN THE TWO         * 38280002
*        EXPANSIONS CONFLICT, SO THAY CANNOT BOTH BE USED.            * 38300002
*********************************************************************** 38320002
*                                                                       38340002
PDS1     DSECT ,                  DIRECTORY ENTRY WITHOUT BLDL BYTES    38360002
PDS1NAME DS    CL(L'PDS2NAME)     MEMBER NAME                           38380002
PDS1TTRP DS    0CL(L'PDS2TTRP)    FIRST BLOCK TTR                       38400002
PDS1TT   DS    H                  TRACK NUMBER                          38420002
PDS1REC  DS    FL1                RECORD NUMBER                         38440002
PDS1INDC DS    B                  INDICATOR BYTE                        38460002
PDS1USRD DS    0C                 START OF USER DATA                    38480002
         EJECT                                                          38500002
         IHASDWA                                                        38502002
         EJECT                                                          38504002
UCB      DSECT                                                          38520002
         IEFUCBOB                                                       38540002
         END                                                            38560002
./  ADD  SSI=62390328,NAME=IGG021AB
         TITLE 'IGG021AB - THIRD LOAD OF BPAM STOW ROUTINE'             00100021
IGG021AB CSECT                                                          00200021
         SPACE                                                          00300021
*********************************************************************** 00400021
*                                                                     * 00500021
* MODULE NAME = IGG021AB                                              * 00502002
*                                                                     * 00504002
* DESCRIPTIVE NAME = THIRD LOAD OF BPAM STOW ROUTINE                  * 00506002
*                                                                     * 00508002
* COPYRIGHT = NONE                                                    * 00510002
*                                                                     * 01000021
* STATUS = RELEASE VS2-4, DATE OF LAST CHANGE 6/28/76                 * 01100037
*                                                                     * 01500021
*                                                                     * 01600021
* FUNCTION = MAINTAINS PARTITIONED DATA SET DIRECTORIES IN ASCENDING  * 01700002
*            ORDER OF THE BINARY VALUES OF THE NAMES OF THE MEMBERS.  * 01800002
*            THIS IS ACCOMPLISHED BY ADDING, REPLACING, CHANGING THE  * 01900002
*            NAME OF, OR DELETING DIRECTORY ENTRIES.  IF THE FUNCTION * 02000002
*            REQUESTED IS ADD, REPLACE, OR CHANGE, AND IF THERE ARE   * 02100002
*            NO UNUSED DIRECTORY BLOCKS, THEN A DRY RUN WILL BE MADE  * 02200002
*            AGAINST THE DIRECTORY TO DETERMINE IF SUFFICIENT SPACE   * 02300002
*            IS AVAILABLE IN WHICH TO PERFORM THE REQUESTED FUNCTION. * 02400002
*            FOLLOWING THE DRY RUN, OR IN THE CASE WHERE A DRY RUN IS * 02500002
*            NOT REQUIRED, THE DIRECTORY WILL BE ALTERED BY EXPANDING * 02600002
*            AND/OR COMPRESSING THE DIRECTORY IN ORDER TO PERFORM THE * 02700002
*            THE REQUESTED FUNCTION.                                  * 02800002
*                                                                     * 02900021
*                                                                     * 03000021
* NOTES = SEE BELOW                                                   * 03002002
*                                                                     * 03004002
*    DEPENDENCIES = CHARACTER CODE DEPENDENCY - THIS MODULE IS DEPEN- * 03006002
*                   DENT ON THE FOLLOWING EBCDIC CHARACTERS:          * 03008002
*                   X'FFFFFFFF' - INDICATES THE LAST ENTRY IN A       * 03010002
*                   DIRECTORY.                                        * 03012002
*                                                                     * 03014002
*    RESTRICTIONS = NONE                                              * 03016002
*                                                                     * 03018002
*    REGISTER CONVENTIONS = SEE REGISTER EQUATES BELOW                * 03020002
*                                                                     * 03022002
*    PATCH LABEL = PATCH                                              * 03024002
*                                                                     * 03026002
*                                                                     * 03028002
* MODULE TYPE = SVC ROUTINE                                           * 03030002
*                                                                     * 03032002
*    ATTRIBUTES = REENTRANT, ENABLED, PRIVILEGED, ENTERED IN          * 03034002
*                 SUPERVISOR KEY AND ISSUES A MODESET TO RUN IN THE   * 03036002
*                 CALLER'S KEY.                                       * 03038002
*                                                                     * 03040002
*                                                                     * 03042002
* ENTRY POINT = IGG021AB                                              * 03100002
*                                                                     * 03102002
*    LINKAGE = THIS ROUTINE RECEIVES CONTROL VIA A BRANCH FROM THE    * 03104037
*              SECOND LOAD OF STOW - IGG0210A.                        * 03106002
*                                                                     * 03400021
*    INPUT = THE FOLLOWING PARAMETERS ARE PASSED WHEN CONTROL IS      * 03500002
*            RECEIVED AS DESCRIBED ABOVE:                             * 03600002
*            REGISTER 10 - CONTAINS THE ADDRESS OF STOW'S WORK AREA.  * 03800002
*            REGISTER 11 - CONTAINS THE ADDRESS OF THE USER'S DCB.    * 03900002
*                                                                     * 04100021
*    OUTPUT = REGISTER 0  - CONTAINS THE REASON CODE.                 * 04200002
*             REGISTER 15 - CONTAINS THE RETURN CODE.                 * 04300002
*                                                                     * 04400021
*    EXITS-NORMAL = RETURNS TO THE CALLER VIA A BR 14 WITH REASON     * 04402002
*                   CODE REGISTER 0 AND RETURN CODE REGISTER 15       * 04404002
*                   CONTAINING THE FOLLOWING:                         * 04406002
*                   REG 0   REG 15             CONDITION              * 04406102
*                     0        0  - INDICATES NORMAL COMPLETION OF    * 04406202
*                                   THE CALLER'S REQUEST.             * 04406602
*                     0        8  - INDICATES THAT THE ENTRY TO BE    * 04407202
*                                   REPLACED COULD NOT BE FOUND, BUT  * 04407602
*                                   HAS BEEN ADDED TO THE DIRECTORY.  * 04410002
*                                                                     * 04500021
*    EXITS-ERROR = RETURNS TO THE CALLER VIA A BR 14 WITH REASON CODE * 04502002
*                  REGISTER 0 AND RETURN CODE REGISTER 15 CONTAINING  * 04504002
*                  THE FOLLOWING:                                     * 04506002
*                  REG 0   REG 15              CONDITION              * 04506402
*                    0       12  - INDICATES THERE IS NOT SUFFICIENT  * 04506802
*                                  SPACE REMAINING IN THE DIRECTORY   * 04506902
*                                  TO PERFORM THE ADD, REPLACE, OR    * 04507002
*                                  CHANGE FUNCTION REQUESTED.         * 04507102
*                    1       16  - INDICATES AN I/O ERROR OCCURED     * 04507202
*                                  WHILE WRITING OR READING DIRECTORY * 04514002
*                                  BLOCKS.                            * 04516002
*                                                                     * 04518002
*                                                                     * 04520002
* EXTERNAL REFERENCES = SEE BELOW                                     * 04600002
*                                                                     * 04602002
*    ROUTINES = EXCP(SVC 0) AND WAIT(SVC 1) - ARE USED TO PERFORM I/O * 04604002
*               OPERATIONS.                                           * 04700002
*                                                                     * 04800021
*               FREEMAIN(SVC 10) - IS USED TO FREE STOW'S WORK AREA   * 04900002
*               PRIOR TO EITHER A NORMAL OR AN ERROR EXIT.            * 05000002
*                                                                     * 05002002
*               MODESET - USED TO CHANGE THE STORAGE PROTECT KEY.     * 05004002
*                                                                     * 05100021
*    DATA AREAS = NONE                                                * 05200002
*                                                                     * 06900021
*    CONTROL BLOCKS = CVT,DCB,DEB,ECB,IOB,SVRB,TCB                    * 06902002
*                                                                     * 07000021
*                                                                     * 07002002
* TABLES = THIS MODULE USES THE STOW WORK AREA, THE FORMAT AND        * 07100002
*          CONTENTS OF WHICH ARE DESCRIBED IN THE DSECT AT THE END OF * 07200002
*          THE LISTING.                                               * 07300002
*                                                                     * 07400021
*                                                                     * 07500021
* MACROS = ACTION MACROS - EXCP,WAIT,FREEMAIN,MODESET                 * 07800002
*                                                                     * 07900021
*          MAPPING MACROS - CVT,DCBD,IEZDEB,IHAPDS,IHAPSA,IHARB,      * 08300002
*             IKJTCB,IGGSTW                                           * 08302002
*                                                                     * 08400021
*                                                                     * 08402002
* CHANGE ACTIVITY = AS FOLLOWS:                                       * 08500002
*                                                                     * 08502002
*          RELEASE 21 DELETIONS                                       * 08552002
*    THIS MODULE IS NEW FOR RELEASE 21.  THE FOLLOWING APARS WERE     * 08556002
*    CORRECTED.  28169, 33374, 35322, 42484, AND 43923.               * 08558002
*                                                                 M1088 08558402
*          RELEASE 21.8 CHANGES/DELETIONS                             * 08558537
*A515500-515900,538500-538600,552500-552940                     SA66881 08558837
*D539000                                                        SA66881 08559237
*A297500-297600,397500-397600,474500-474992                     SA72739 08559637
*          VS1 RELEASE 01 DELETIONS                                   * 08560002
*                                                                XM5415 08562002
*          VS1 RELEASE 02 DELETIONS                                   * 08562402
*                                                               OX00801 08562802
*          VS1 RELEASE 03 DELETIONS                                   * 08563002
* SEE CODE FLAGGED SA66881 FOR VS1 APAR XA03384                 XA03384 08563137
* SEE CODE FLAGGED YA06505 FOR VS1 APAR XA06889                 XA06889 08567737
*                                                               XA02065 08572437
*          VS2 RELEASE 01 DELETIONS                                   * 08577037
*                                                                YM0943 08581637
*C158500                                                        YA06505 08583637
*A158600-159600,379500-379800,419500-419800,434500-434800,      YA06505 08585637
*A449800-449993,540600-540984,133100                            YA06505 08586037
*D449800-450332                                                 YA06505 08586137
*          VS2 RELEASE 02 DELETIONS                                   * 08614837
*D001500,005500,007600,118700,119500,134000,507000-508000,       Y02072 08629037
*D668000-831000                                                  Y02072 08643237
*          VS2 RELEASE 03 CHANGES/DELETIONS                             08657437
* SEE CODE FLAGGED YA06505/SA72739 AND ZA01548(IGGSTOW MACRO)   ZA01548 08671637
*          VS2 RELEASE 04 CHANGES/DELETIONS                             08681637
*A218500-218700,221500,488500-488700                           @ZA02261 08683637
*A270300-270800,323300-323800                                  @ZA08321 08684637
*A449500-449620,667005-667015  OS77114,OX13215,OY12725,OZ10222 @ZA10229 08685837
*                                                                     * 08692837
*A651000-651200,651600                                         @ZA12202 08694837
*C667015                                                       @ZA12202 08696837
*********************************************************************** 08700021
         EJECT                                                          08800021
*********************************************************************** 08900021
****                                                               **** 09000021
****     REGISTER EQUATES                                          **** 09100021
****                                                               **** 09200021
*********************************************************************** 09300021
         SPACE                                                          09400021
R0       EQU   0                        WORK/PARAMETER REGISTER         09500021
R1       EQU   1                        WORK/PARAMETER REGISTER         09600021
RWORK1   EQU   R1                       WORK REGISTER                   09700021
R2       EQU   2                        WORK REGISTER                   09800021
RIBFR    EQU   R2                       POINTER TO INPUT BFR            09900021
R3       EQU   3                        WORK REGISTER                   10000021
RMOVE    EQU   R3                       PTR TO NEXT ELEMENT TO BE MOVED 10100021
R4       EQU   4                        WORK REGISTER                   10200021
REMAIN   EQU   R4                       AMOUNT OF DATA IN INPUT BFR     10300021
R5       EQU   5                        WORK REGISTER                   10400021
ROBFR    EQU   R5                       POINTER TO OUTPUT BFR           10500021
R6       EQU   6                        WORK REGISTER                   10600021
RFILL    EQU   R6                       PTR TO NEXT SPACE IN OUTPUT BFR 10700021
R7       EQU   7                        WORK REGISTER                   10800021
RSPACE   EQU   R7                       UNUSED SPACE IN OUTPUT BFR      10900021
R8       EQU   8                        WORK REGISTER                   11000021
RSIZE    EQU   R8                       AMOUNT OF DATA TO BE MOVED      11100021
REASONCD EQU   RSIZE                    ERROR REASON CODE        Y02072 11150002
R9       EQU   9                        WORK REGISTER                   11200021
RWORK2   EQU   R9                       WORK REGISTER                   11300021
RRETCODE EQU   RWORK2                   USED TO PASS RETURN CODE TO     11350002
*                                       ERROR ROUTINE                   11360002
RAREA    EQU   10                       POINTER TO WORK AREA            11400021
RDCB     EQU   11                       POINTER TO THE USER'S DCB       11500021
RBASE    EQU   12                       BASE REGISTER                   11600021
R13      EQU   13                       WORK REGISTER                   11700021
REXCPRET EQU   R13                      RETURN REG FROM EXCP ROUTINE    11750002
RCALCRET EQU   REXCPRET                 RETURN REG FROM CALC RTN        11760002
R14      EQU   14                       RETURN ADDR/WORK REGISTER       11800021
RMOVERET EQU   R14                      RETURN REG FROM MOVE RTN        11850002
RREADRET EQU   RMOVERET                 RETURN REG FROM WR1RD1 RTN      11860002
R15      EQU   15                       RETURN CODE/WORK REGISTER       11900021
RMOVESZ  EQU   R15                      INPUT LENGTH FOR MOVE RTN       11960002
         EJECT                                                          12000021
*********************************************************************** 12100021
****                                                               **** 12200021
****     MASKS, DISPLACEMENTS, AND OTHER EQUATES                   **** 12300021
****                                                               **** 12400021
*********************************************************************** 12500021
         SPACE                                                          12600021
RCDZERO  EQU   X'00'                    USED TO INDICATE RECORD ZERO    12700021
NOTLAST  EQU   X'00'                    USED TO CHK STATUS OF DIRECTORY 12800021
UNITEXPT EQU   X'01'                    MASK FOR UNIT EXCEPTION         12900021
NOROOM   EQU   X'0C'                    NO ROOM IN DIRECTORY ERROR CODE 13000021
IOERROR  EQU   X'10'                    I/O ERROR CODE                  13100021
STOWPERF EQU   X'80'                    USED TO INDICATE STOW    M1088  13150021
*                                       HAS BEEN PERFORMED       M1088  13160021
DIRECTRY EQU   1                        IND I/O ERROR ENCOUNTER- Y02072 13210002
*                                       ED IN THE DIRECTORY      Y02072 13260002
OFF      EQU   X'FF'                    ALL-FLAGS-ON MASK       YA06505 13310037
         EJECT                                                          13700021
****                                                                    13800021
****     ESTABLISH ADDRESSABILITY                                       13900021
****                                                                    14000021
         BALR  RBASE,0                  INITIALIZE BASE REGISTER        14100002
         USING *,RBASE                  ESTABLISH ADDRESSABILITY        14200021
         USING STWAREA,RAREA            ESTABLISH WORK AREA BASE REG    14300021
         USING IHADCB,RDCB              ESTABLISH DCB BASE REGISTER     14400021
         SPACE 2                                                        14500021
****                                                                    14600021
****     IF THE FIRST LOAD HAS OVERLAID THE TWO DIRECTORY BLOCKS WHICH  14700021
****     CONTAIN THE ONLY OR LOWER OF TWO ARGUMENTS, THEY MUST BE       14800021
****     RE-READ AT THIS TIME.                                          14900021
****                                                                    15000021
         TM    STWFLAG1,STWFLOW         HAS FIRST LOAD OVERLAID FIRST   15100021
*                                       DIRECTORY BLOCKS READ           15200021
         BNO   INITPTRS                 NO, GO TO INIT BUFFER POINTERS  15300021
         SPACE 2                                                        15400021
****                                                                    15500021
****     RE-READ ORIGINAL DIRECTORY BLOCKS.                             15600021
****                                                                    15700021
INITBFRS EQU   *                                                        15800021
         NI    STWFLAG1,OFF-STWFLOW-STWMERGE    RE-SET FUNCTION YA06505 15850037
*                                       FLOW/MERGE INDICATORS   YA06505 15860037
         MVI   STWRDFL3,0               TURN OFF COMMAND CHAIN  YA06505 15910037
*                                       AND SKIP IF MERGE OCCUR YA06505 15960037
         LA    RWORK1,STWINCP           GET ADDR OF BUFFER INITIALI-    16000021
*                                       ZATION CHANNEL PROGRAM          16100021
         ST    RWORK1,IOBSTART          SET UP CHANNEL PROG ADDR IN IOB 16200021
         L     RWORK1,DCBDEBAD          GET ADDR OF CALLERS DEB  Y02072 16300002
         USING DEBBASIC,RWORK1          ESTABLISH DEB BASE REGISTER     16400002
         MVC   IOBCC(L'IOBCC+L'IOBHH),DEBBASND+(DEBSTRCC-DEBDASD)       16500002
*                                       GET DATA SET STARTING CCHH      16550002
*                                       FROM THE DEB                    16600002
         MVI   IOBR,RCDZERO             SET SEARCH TO BEGIN AT RECORD 0 16700021
         DROP  RWORK1                   DROP DEB BASE REGISTER          16800002
         MVC   STWKYAD1,STWPARM+1       SET KEY TO READ ORIGINAL BLOCKS 16900021
         BAL   REXCPRET,EXCP            GO ISSUE EXCP                   17000002
         SPACE 2                                                        17100021
****                                                                    17200021
****     INITIALIZE INPUT BUFFER, OUTPUT BUFFER, AND CHANNEL PROGRAM    17300021
****     POINTERS.                                                      17400021
****                                                                    17500021
INITPTRS EQU   *                                                        17600021
         LA    RIBFR,STWBUF1            INIT INPUT PTR TO FIRST BUFFER  17700021
         LA    RWORK1,STWBUF2           GET ADDRESS OF SECOND BUFFER    17800021
         LA    ROBFR,STWBUF3            INIT OUTPUT PTR TO THIRD BFR    17900021
         USING BUFFER,ROBFR             ESTABLISH BASE FOR THIRD BUFFER 18000021
         ST    RIBFR,BUFADDR            CHAIN FIRST BUFFER TO THIRD     18100021
         DROP  ROBFR                    DROP THIRD BUFFER BASE REG      18200021
         USING BUFFER,RWORK1            ESTABLISH BASE FOR SECOND BFR   18300021
         ST    ROBFR,BUFADDR            CHAIN THIRD BUFFER TO SECOND    18400021
         DROP  RWORK1                   DROP SECOND BUFFER BASE REG     18500021
         USING BUFFER,RIBFR             ESTABLISH INPUT BFR BASE REG    18600021
         ST    RWORK1,BUFADDR           CHAIN SECOND BUFFER TO FIRST    18700021
         LH    RWORK2,STWOFFLW          GET OFFSET TO ADD OR DELETE     18800021
*                                       POSITION WITHIN INPUT BUFFER    18900021
         AR    RWORK2,RIBFR             CALC ADDRESS OF SAME            19000021
         LH    REMAIN,BUFN              GET USED SPACE IN INPUT BLOCK   19100021
         SH    REMAIN,COUNTSZ           CALCULATE SIZE OF ENTRIES       19200021
         LA    RWORK1,STWWRDCP          GET ADDR OF WRITE/READ CHANNEL  19300021
*                                       PROGRAM                         19400021
         ST    RWORK1,IOBSTART          SET UP CHANNEL PROG ADDR IN IOB 19500021
         SPACE 2                                                        19600021
****                                                                    19700021
****     MOVE THE DIRECTORY ENTRIES PRECEDING THE ADD OR DELETE         19800021
****     LOCATION TO THE OUTPUT BUFFER.                                 19900021
****                                                                    20000021
         LA    RMOVE,BUFENTRY           INIT MOVE POINTER TO THE FIRST  20100021
*                                       ENTRY IN THE INPUT BUFFER       20200021
         LR    RMOVESZ,RWORK2           CALCULATE SIZE OF ENTRIES PRE-  20300002
         SR    RMOVESZ,RMOVE            CEDING THE ADD LOCATION         20400002
         DROP  RIBFR                    DROP INPUT BFR BASE REG         20500021
         USING BUFFER,ROBFR             ESTABLISH OUTPUT BFR BASE REG   20600021
         LA    RFILL,BUFENTRY           INIT FILL PTR WITHIN OUTPUT BFR 20700021
         MVC   BUFCNT,BUFCNT-BUFFER(RIBFR)  MOVE COUNT FIELD TO         20800021
*                                       OUTPUT BUFFER                   20900021
         LA    RSPACE,L'BUFENTRY        INIT UNUSED SPACE IN OUTPUT BFR 21000021
         BAL   RMOVERET,MOVEMANY        MOVE ENTRIES TO OUTPUT BFR      21100002
         DROP  ROBFR                    DROP OUTPUT BFR BASE REG        21200021
         SPACE 2                                                        21300021
****                                                                    21400021
****     DETERMINE THE FUNCTION TO BE PERFORMED.                        21500021
****                                                                    21600021
         TM    STWFLAG1,STWADD+STWREPL+STWCHNG   IS FUNCTION DELETE     21700021
         BZ    DELETE                   YES, GO DO DELETE               21800021
         TM    DCBMACF1,DCBMRECP        TEST FOR EXCP          @ZA02261 21850037
         BO    NOEXCP                   YES,BYPASS CHECK ON    @ZA02261 21860037
*                                       DIRECTORY BLOCK        @ZA02261 21870037
         CLI   DCBDIRCT+1,NOTLAST       ARE THERE ANY ENTRIES IN THE    21900021
*                                       LAST DIRECTORY BLOCK            22000021
         BE    ADDCHECK                 NO, NO NEED FOR A DRY RUN       22100021
NOEXCP   EQU   *                                               @ZA02261 22150037
         XI    STWFLAG1,STWDRYRN        SET DRY RUN SWITCH              22200021
         SPACE                                                          22300021
ADDCHECK EQU   *                                                        22400021
         TM    STWFLAG1,STWADD+STWREPL  IS FUNCTION ADD, ADD-DELETE     22500021
*                                       CHANGE, OR REPLACE              22600021
         BZ    DELETE                   NO, GO DO DELETE-ADD CHANGE     22700021
         SPACE 2                                                        22800021
****                                                                    22900021
****     PERFORM INITIALIZATION FOR ADD, ADD-DELETE CHANGE, AND REPLACE 23000021
****     FUNCTIONS.  ALSO DETERMINE WHETHER THE ENTRY TO BE ADDED WILL  23100021
****     FIT IN THE FIRST OUTPUT BLOCK.                                 23200021
****                                                                    23300021
         TM    STWFLAG1,STWREPL         IS FUNCTION REPLACE             23400021
         BNO   FITCHK                   NO, GO CHECK NEW ENTRY FIT      23500021
         BAL   RCALCRET,CALCSIZE        GO CALC SIZE OF REPLACED ENTRY  23600002
         SR    REMAIN,RSIZE             DECR AMOUNT IN INPUT BUFFER     23700021
         LA    RWORK2,0(RSIZE,RWORK2)   INCR REMAINING ENTRIES POINTER  23800021
*                                       PAST ENTRY BEING REPLACED       23900021
         SPACE                                                          24000021
FITCHK   EQU   *                                                        24100021
         LA    RMOVE,STWNEWNM           POINT TO ENTRY TO BE ADDED      24200021
         BAL   RCALCRET,CALCSIZE        GO CALC SIZE OF NEW ENTRY       24300002
         LA    REMAIN,0(RSIZE,REMAIN)   ADD NEW ENTRY SIZE TO AMOUNT    24400021
*                                       OF DATA IN THE INPUT BUFFER     24500021
         TM    STWFLAG1,STWCHNG+STWDEL  IS FUNCTION DELETE-ADD CHANGE   24600021
         BO    ADD                      YES, BYPASS DRY RUN AND FIT CHK 24700021
         TM    STWFLAG1,STWDRYRN        IS THIS A DRY RUN               24800021
         BNO   ADD                      NO, GO TO ADD NEW ENTRY         24900021
         CR    REMAIN,RSPACE            CAN NEW ENTRY BE ADDED TO FIRST 25000021
*                                       INPUT BLOCK                     25100021
         BH    ADD                      NO, GO TO BEGIN MOVING DATA     25200021
         NI    STWFLAG1,X'FF'-STWDRYRN  TURN OFF DRY RUN SWITCH         25300002
         SPACE 2                                                        25400021
****                                                                    25500021
****     IF SPACE IS AVAILABLE, MOVE THE ENTRY TO BE ADDED INTO THE     25600021
****     CURRENT OUTPUT BUFFER.  OTHERWISE, WRITE THE OUTPUT BUFFER,    25700021
****     READ IN ANOTHER BLOCK, AND CONSTRUCT A NEW OUTPUT BUFFER AND   25800021
****     MOVE THE ENTRY TO BE ADDED INTO IT.                            25900021
****                                                                    26000021
ADD      EQU   *                                                        26100021
         LR    RMOVESZ,RSIZE            AMOUNT OF DATA TO BE MOVED      26200002
         BAL   RMOVERET,MOVEONE         MOVE NEW ENTRY TO OUTPUT BFR    26300002
         LTR   RMOVESZ,RMOVESZ          WAS MOVE SUCCESSFUL             26400002
         BZ    MOVEREST                 YES, CONT FILLING OUTPUT BFR    26500021
         TM    IOBCSW+3,UNITEXPT        DID UNIT EXCEPTION OCCUR FOR    26600021
*                                       LAST READ ISSUED                26700021
         BO    NOTROOM                  YES, IND NO ROOM IN DIRECTORY   26800021
         BAL   RREADRET,WR1RD1          GO WRITE OUTPUT BFR AND READ    26900002
*                                       ANOTHER BLOCK INTO IT           27000021
         TM    STWFLAG1,STWMERGE        DID MERGE 2 BLKS OCCUR @ZA08321 27030037
         BO    ADD                      YES - BYPASS SET UP OF @ZA08321 27060037
*                                       COUNT FIELD            @ZA08321 27080037
         USING BUFFER,ROBFR             ESTABLISH OUTPUT BFR BASE REG   27100021
         L     RWORK1,BUFADDR           GET ADDR OF NEXT BLOCK READ     27200021
         MVC   BUFCNT,BUFCNT-BUFFER(RWORK1)  SET UP COUNT FIELD FOR     27300021
*                                       NEXT WRITE                      27400021
         B     ADD                      MOVE NEW ENTRY INTO OUTPUT BFR  27500021
         SPACE 2                                                        27600021
****                                                                    27700021
****     MOVE THE ENTRIES REMAINING IN THE INPUT BUFFER, WHICH FOLLOW   27800021
****     THE ADD OR REPLACE LOCATION, TO THE OUTPUT BUFFER.             27900021
****                                                                    28000021
MOVEREST EQU   *                                                        28100021
         LR    RMOVE,RWORK2             RESTORE MOVE POINTER TO ENTRIES 28200021
*                                       FOLLOWING THE ADD OR REPL LOC   28300021
         B     EXPAND                   BR TO COMPLETE DIRECTORY        28400021
         SPACE 2                                                        28500021
****                                                                    28600021
****     EXPAND THE DIRECTORY TO COMPENSATE FOR THE ENTRY JUST ADDED.   28700021
****                                                                    28800021
BYPASS   EQU   *                                                        28900021
         LA    RMOVE,0(RSIZE,RMOVE)     INCR MOVE PTR PAST ENTRY TO BE  29000021
*                                       DELETED FOR ADD-DELETE CHANGE   29100021
         SR    REMAIN,RSIZE             DECR DATA REMAINING BY DELETED  29200021
*                                       ENTRY SIZE                      29300021
         OI    STWFLAG1,STWFLOW         IND CHANGE SWITCH PERFORMED     29400021
         SPACE                                                          29500021
EXPAND   EQU   *                                                        29600021
         LTR   REMAIN,REMAIN            ANY MORE ENTRIES IN INPUT BFR   29700021
         BM    BADDIR                   SOMETHINGS WRONG WITH   SA72739 29750037
*                                       DIRECTORY - GET OUT     SA72739 29760037
         BZ    ADDENDCK                 NO, GO CHK IF BOTH BFRS HAVE    29800021
*                                       BEEN PROCESSED                  29900021
         BAL   RCALCRET,CALCSIZE        GET SIZE OF NEXT ENTRY          30000002
         SPACE                                                          30002002
CHKDELET EQU   *                                                XA02065 30004002
         TM    STWFLAG1,STWCHNG+STWADD  IS FUNCTION ADD-DELETE CHANGE   30100021
         BNO   MOVENTRY                 NO, GO TO MOVE ENTRY            30200021
         USING PDS2,RMOVE               ESTABLISH ENTRY BASE REGISTER   30300002
         CLC   PDS2NAME,STWOLDNM        IS THIS ENTRY TO BE DELETED     30400002
         BE    BYPASS                   YES, GO TO GET NEXT ENTRY       30500021
         DROP  RMOVE                    DROP ENTRY BASE REGISTER        30600021
         SPACE                                                          30700021
MOVENTRY EQU   *                                                        30800021
         LR    RMOVESZ,RSIZE            SIZE OF ENTRY TO BE MOVED       30900002
         BAL   RMOVERET,MOVEONE         GO MOVE ENTRY INTO OUTPUT BFR   31000002
         LTR   RMOVESZ,RMOVESZ          WAS MOVE SUCCESSFUL             31100002
         BZ    EXPAND                   YES, GO GET NEXT ENTRY          31200021
         SPACE 2                                                        31300021
****                                                                    31400021
****     WRITE COMPLETED OUTPUT BUFFER AND READ IN ANOTHER DIRECTORY    31500021
****     BLOCK.                                                         31600021
****                                                                    31700021
         TM    IOBCSW+3,UNITEXPT        DID UNIT EXCEPTION OCCUR FOR    31800021
*                                       LAST READ ISSUED                31900021
         BO    NOTROOM                  YES, IND NO ROOM IN DIRECTORY   32000021
         SPACE                                                          32100021
CONTADD  EQU   *                                                        32200021
         BAL   R14,WR1RD1               GO TO WRITE/READ ROUTINE        32300021
         TM    STWFLAG1,STWMERGE        DID 2 BLKS MERGE OCCUR @ZA08321 32330037
         BO    CHKDELET                 YES - BYPASS SET UP OF @ZA08321 32360037
*                                       COUNT FIELD            @ZA08321 32380037
         L     RWORK1,BUFADDR           GET ADDR OF NEXT BLOCK READ     32400021
         MVC   BUFCNT,BUFCNT-BUFFER(RWORK1)  SET UP COUNT FIELD FOR     32500021
*                                       NEXT WRITE                      32600021
         B     CHKDELET                 GO CHK ENTRY FOR DELETE XA02065 32700002
         SPACE 2                                                        32800021
****                                                                    32900021
****     DETERMINE IF THE NEXT TO THE LAST BLOCK READ HAS BEEN          33000021
****     PROCESSED.                                                     33100021
****                                                                    33200021
ADDENDCK EQU   *                                                        33300021
         CLC   BUFKEY,HIGHKEY           HAS LAST ENTRY BEEN PROCESSED   33400021
         BNE   BFRCHECK                 NO, GO TO CHECK INPUT BFRS      33500021
         TM    STWFLAG1,STWDRYRN        IS THIS A DRY RUN               33600021
         BO    INITBFRS                 YES, GO TO END DRY RUN          33700021
         B     UPDTEDCB                 GO TO UPDATE DCBDIRCT FIELD     33800021
         SPACE                                                          33900021
BFRCHECK EQU   *                                                        34000021
         LR    RWORK1,RIBFR             SAVE PTR FOR LATER COMPARISON   34100021
         DROP  ROBFR                    DROP OUTPUT BUFFER BASE REG     34200021
         USING BUFFER,RIBFR             ESTABLISH INPUT BUFFER BASE REG 34300021
         L     RIBFR,BUFADDR            GET ADDR OF NEXT BLOCK READ     34400021
         LH    REMAIN,BUFN              GET USED SPACE IN INPUT BLOCK   34500021
         SH    REMAIN,COUNTSZ           CALCULATE SIZE OF ENTRIES       34600021
         LA    RMOVE,BUFENTRY           INIT MOVE PTR TO FIRST ENTRY    34700021
         CR    RWORK1,ROBFR             HAS NEXT TO LAST BLOCK READ     34800021
*                                       BEEN PROCESSED                  34900021
         BE    EXPAND                   NO, CONT EXPANDING DIRECTORY    35000021
         SPACE 2                                                        35100021
****                                                                    35200021
****     IF THIS IS A DRY RUN, RETURN TO THE BEGINNING OF THE PROGRAM   35300021
****     TO MAKE THE ALTERATION RUN ON THE DIRECTORY.                   35400021
****                                                                    35500021
         TM    STWFLAG1,STWDRYRN        IS THIS A DRY RUN               35600021
         BO    INITBFRS                 YES, GO TO END DRY RUN          35700021
         SPACE 2                                                        35800021
****                                                                    35900021
****     DETERMINE IF THE DELETE FUNCTION REMAINS TO BE PERFORMED FOR   36000021
****     ADD-DELETE CHANGE.                                             36100021
****                                                                    36200021
DELETECK EQU   *                                                        36300021
         TM    STWFLAG1,STWCHNG+STWADD  IS FUNCT ADD-DELETE CHANGE      36400021
         BNO   SWTODEL                  NO, GO CHK FOR SWITCH TO DELETE 36500021
         BAL   RCALCRET,CALCSIZE        CALC SIZE OF FIRST ENTRY IN BFR 36600002
         TM    STWFLAG1,STWFLOW         HAS BLOCK WITH ENTRY TO BE      36700021
*                                       DELETED BEEN PROCESSED          36800021
         BNO   CONTADD                  NO, CONT READING AND WRITING    36900021
*                                       UNTIL BLOCK IS FOUND            37000021
         SPACE 2                                                        37100021
****                                                                    37200021
****     IF THE FUNCTION BEING PERFORMED IS CHANGE OR REPLACE, GO TO    37300021
****     THE DELETE ROUTINE TO ENSURE THAT THE DIRECTORY HAS BEEN       37400021
****     COMPRESSED.                                                    37500021
****                                                                    37600021
SWTODEL  EQU   *                                                        37700021
         TM    STWFLAG1,STWCHNG+STWREPL IS FUNCT CHANGE OR REPLACE      37800021
         BNZ   COMPRESS                 YES, GO TO COMPRESS DIRECTORY   37900021
         TM    STWFLAG1,STWMERGE        DID WE MERGE A BLK     YA06505  37950037
*                                       DURING COMPRESS        YA06505  37960037
         BO    COMPRESS                 IF YES MUST COMPRESS   YA06505  37970037
*                                       THE ENTIRE DIRECTORY   YA06505  37980037
         B     WRLAST                   NO, GO TO WRITE LAST BLOCK      38000021
         SPACE 2                                                        38100021
****                                                                    38200021
****     DELETE THE DIRECTORY ENTRY FOR THE FUNCTIONS OF DELETE OR      38300021
****     ADD-DELETE CHANGE.                                             38400021
****                                                                    38500021
DELETE   EQU   *                                                        38600021
         BAL   RCALCRET,CALCSIZE        CALC SIZE OF ENTRY TO BE        38700002
*                                       DELETED                         38800021
         SR    REMAIN,RSIZE             DECR DATA SIZE BY DELETED ENTRY 38900021
         LA    RMOVE,0(RSIZE,RMOVE)     INCR NEXT ENTRY PTR PAST ENTRY  39000021
         SPACE 2                                                        39100021
****                                                                    39200021
****     COMPRESS THE REMAINING ENTRIES IN THE DIRECTORY TO COMPENSATE  39300021
****     FOR THE SPACE LEFT BY THE DELETED ENTRY.                       39400021
****                                                                    39500021
COMPRESS EQU   *                                                        39600021
         LTR   REMAIN,REMAIN            ANY MORE ENTRIES IN INPUT BFR   39700021
         BM    BADDIR                   SOMETHINGS WRONG WITH   SA72739 39750037
*                                       DIRECTORY - GET OUT     SA72739 39760037
         BZ    DELENDCK                 NO, GO TO CHK FOR LAST ENTRY    39800021
         TM    STWFLAG1,STWCHNG+STWDEL  IS FUNCT DELETE-ADD CHANGE      39900021
         BNO   COMPMOVE                 NO, CONT COMPRESSING DIRECTORY  40000021
         TM    STWFLAG1,STWFLOW         HAS CHANGE SW BEEN PERFORMED    40100021
         BO    COMPMOVE                 YES, CONT COMPRESSING DIRECTORY 40200021
         USING PDS2,RMOVE               ESTABLISH ENTRY BASE REGISTER   40300002
         CLC   PDS2NAME,STWNEWNM        IS THIS THE LOCATION FOR THE    40400002
*                                       NEW ENTRY                       40500021
         BH    SWTOADD                  YES, GO TO SWITCH TO ADD MODE   40600021
         DROP  RMOVE                    DROP ENTRY BASE REGISTER        40700021
         SPACE                                                          40800021
COMPMOVE EQU   *                                                        40900021
         BAL   RCALCRET,CALCSIZE        GET SIZE OF NEXT ENTRY          41000002
         LR    RMOVESZ,RSIZE            SIZE OF ENTRY TO BE MOVED       41100002
         BAL   RMOVERET,MOVEONE         GO MOVE ENTRY INTO OUTPUT BFR   41200002
         LTR   RMOVESZ,RMOVESZ          WAS MOVE SUCCESSFUL             41300002
         BZ    COMPRESS                 YES, GO GET NEXT ENTRY          41400021
         LA    RWORK1,L'BUFN(,REMAIN)   INCR SIZE OF ENTRIES LEFT IN    41500021
*                                       INPUT BFR BY SIZE FIELD LENGTH  41600021
         CH    RWORK1,BUFN              HAVE ANY ENTRIES BEEN MOVED     41700021
*                                       FROM THE INPUT BFR              41800021
         BNE   CONTCOMP                 YES, CONTINUE COMPRESSING       41900021
         TM    STWFLAG1,STWMERGE        DID WE MERGE A BLK     YA06505  41950037
*                                       DURING COMPRESS        YA06505  41960037
         BO    CONTCOMP                 IF YES MUST COMPRESS   YA06505  41970037
*                                       THE ENTIRE DIRECTORY   YA06505  41980037
         TM    STWFLAG1,STWCHNG+STWDEL  IS FUNCT DELETE-ADD CHANGE      42000021
         BNO   WRLAST                   NO, GO TO WRITE OUT LAST BLOCK  42100021
*                                       PROCESSED                       42200021
         TM    STWFLAG1,STWFLOW         HAS CHANGE SW BEEN PERFORMED    42300021
         BO    WRLAST                   YES, GO TO WRITE OUT LAST BLOCK 42400021
*                                       PROCESSED                       42500021
         SPACE 2                                                        42600021
****                                                                    42700021
****     WRITE COMPLETED OUTPUT BUFFER AND READ IN ANOTHER DIRECTORY    42800021
****     BLOCK.                                                         42900021
****                                                                    43000021
CONTCOMP EQU   *                                                        43100021
         BAL   RREADRET,WR1RD1          GO TO WRITE/READ ROUTINE        43200002
         DROP  RIBFR                    DROP INPUT BFR BASE REGISTER    43300021
         USING BUFFER,ROBFR             ESTABLISH OUTPUT BFR BASE REG   43400021
         TM    STWFLAG1,STWMERGE        DID MERGE OF 2 BLKS    YA06505  43450037
*                                       INTO ONE OCCUR         YA06505  43460037
         BO    COMPMOVE                 YES, THEN COUNT FIELD  YA06505  43470037
*                                       IN OUTPUT BUFFER IS OK YA06505  43480037
         MVC   BUFCNT,BUFCNT-BUFFER(RIBFR)  MOVE COUNT FIELD TO OUTPUT  43500021
*                                       BUFFER                          43600021
         B     COMPMOVE                 CONT COMPRESSING DIRECTORY      43700021
         SPACE 2                                                        43800021
****                                                                    43900021
****     DETERMINE IF THE LAST DIRECTORY ENTRY HAS BEEN PROCESSED.  IF  44000021
****     SO, GO TO UPDATE THE DCBDIRCT FIELD.  OTHERWISE, CONTINUE      44100021
****     COMPRESSING THE DIRECTORY.                                     44200021
****                                                                    44300021
DELENDCK EQU   *                                                        44400021
         CLC   BUFKEY,HIGHKEY           HAS LAST ENTRY BEEN PROCESSED   44500021
         BE    UPDTEDCB                 YES, GO TO UPDATE DCBDIRCT FLD  44600021
         DROP  ROBFR                    DROP OUTPUT BFR BASE REGISTER   44700021
         USING BUFFER,RIBFR             ESTABLISH INPUT BFR BASE REG    44800021
         L     RIBFR,BUFADDR            GET ADDR OF NEXT INPUT BFR      44900021
         TM    STWFLAG1,STWMERGE        MERGE OF 2 BLKS        @ZA10229 44950037
         BZ    CHECKBUF                 NO -CONTINUE           @ZA10229 44953037
         BAL   R14,WR1RD1               WRITE OUT ONE BLK      @ZA10229 44956037
         B     BYWRTBLK                 CONTINUE               @ZA10229 44959037
CHECKBUF EQU   *                                               @ZA10229 44962037
         CR    RIBFR,ROBFR              HAVE BOTH INPUT BUFFERS OX00801 44965037
*                                       BEEN EMPTIED            OX00801 44968037
         BNE   BYWRTBLK                 CONT COMPRESS IF NOT    OX00801 44971037
****                                                                    44980037
****     TWO DIRECTORY BLOCKS HAVE MERGED INTO ONE. MUST SET            44982037
****     A SWITCH SO THAT COMPRESS WILL CONTINUE TO END OF              44984037
****     THE DIRECTORY.  TWO DIRECTORY BLOCKS WILL BE READ IN           44986037
****     AT THIS POINT INSTEAD OF JUST ONE. THE NEW OUTPUT              44988037
****     BUFFER MUST PROGRESS TWO BUFFERS FORWARD THIS TIME.            44988437
****                                                                    44988837
         OI    STWFLAG1,STWMERGE        SET BIT IDENTIFYING     YA06505 44989237
*                                       THIS MERGE OF 2 BLKS    YA06505 44989637
         OI    STWRDFL3,STWCMDCH        TURN ON COMMAND CHAIN   YA06505 44989737
*                                       TO READ A 2ND BLOCK     YA06505 44989837
         MVC   STWRDAD4,BUFADDR+1       MAKE NXT BUFFER THE IN- YA06505 44989937
*                                       PUT BUFFER FOR 2ND BLK  YA06505 44993537
         BAL   R14,WR1RD1               GO WRT 1 BLK,READ 2     YA06505 44995537
         DROP  RIBFR                    DROP INPUT BUFFER       YA06505 44995937
         USING BUFFER,ROBFR             OUTPUT BUFFER IS BASE   YA06505 44996337
         L     ROBFR,BUFADDR            UPDATE NEW OUTPUT BUF   YA06505 44996737
*                                       1 MORE BUFFER, SINCE WE YA06505 44997137
*                                       READ 2 BLKS IN. THE     YA06505 44997437
*                                       COUNT FIELD IN THIS NEW YA06505 44997837
*                                       OUTPUT BUFFER IS OK     YA06505 44997937
         LA    RFILL,BUFENTRY           INITIALIZE FILL POINTER YA06505 44998037
*                                       FOR THIS OUTPUT BUFFER  YA06505 44998137
         OI    STWRDFL3,STWSKIP         SUPPRESS DATA TRANSFER  YA06505 44998237
*                                       ON THIS RD - WILL BE 2  YA06505 44998337
*                                       BLKS AHEAD FROM NOW ON  YA06505 44998637
         DROP  ROBFR                    DROP OUTPUT BUFFER      YA06505 44999037
*                                                                       44999137
BYWRTBLK EQU   *                                                OX00801 44999237
         USING BUFFER,RIBFR             INPUT BUFFER IS BASE    YA06505 44999337
         LH    REMAIN,BUFN              GET USED SPACE IN INPUT BLOCK   45066702
         SH    REMAIN,COUNTSZ           CALCULATE SIZE OF ENTRIES       45100021
         LA    RMOVE,BUFENTRY           INIT MOVE PTR TO FIRST ENTRY    45200021
         B     COMPRESS                 CONT COMPRESSING DIRECTORY      45300021
         DROP  RIBFR                    DROP INPUT BFR BASE REGISTER    45400021
         SPACE 2                                                        45500021
****                                                                    45600021
****     GO TO THE ADD ROUTINE TO ADD THE NEW ENTRY FOR THE DELETE-ADD  45700021
****     CHANGE FUNCTION.                                               45800021
****                                                                    45900021
SWTOADD  EQU   *                                                        46000021
         OI    STWFLAG1,STWFLOW         IND CHANGE SWITCH HAS BEEN      46100021
*                                       PERFORMED                       46200021
         LR    RWORK2,RMOVE             INIT MOVE PTR FOR ADD ROUTINE   46300021
         B     FITCHK                   GO TO ADD NEW ENTRY             46400021
         SPACE 2                                                        46500021
****                                                                    46600021
****     IF UNIT EXCEPTION OCCURED WHILE ATTEMPTING TO READ ANOTHER     46700021
****     BLOCK, WHICH IS REQUIRED TO EXPAND THE DIRECTORY, RETURN TO    46800021
****     THE USER WITH A 'NO ROOM' ERROR CODE.                          46900021
****                                                                    47000021
NOTROOM  EQU   *                                                        47100021
         LA    RRETCODE,NOROOM          SET NO ROOM ERROR CODE   YM0943 47200002
         B     RTRNUSR1                 GO TO RETURN ROUTINE     Y02072 47300002
         SPACE 2                                                        47400021
****                                                                    47450037
****     SOMETHING IS WRONG WITH THE USER'S DIRECTORY. EITHER           47460037
****     THE TOTAL LENGTH OF BYTES USED IN THE DIRECTORY IS             47470037
****     WRONG OR THE BYTES OF USER INFORMATION FOR A MEMBER            47480037
****     IS WRONG. THIS PROBLEM IS DETECTED WHEN THE BYTE               47490037
****     COUNTER HAS GONE NEGATIVE.                                     47492037
****                                                                    47494037
BADDIR   EQU   *                        DIRECTORY IS BAD        SA72739 47496037
         LA    R9,IOERROR               PROBLEM IS UNKNOWN AND  SA72739 47498037
*                                       MAY BE CAUSED BY IO ERR SA72739 47498437
         B     RTRNUSR1                 GO TO RETURN ROUTINE    SA72739 47499237
****                                                                    47500021
****     IF THE LAST BLOCK OF THE DIRECTORY WAS USED, STORE INTO THE    47600021
****     DCBDIRCT FIELD ONE LESS THAN THE NUMBER OF BYTES USED IN THE   47700021
****     BLOCK.  OTHERWISE, SET THE DCBDIRCT FIELD TO ZEROS.            47800021
****                                                                    47900021
UPDTEDCB EQU   *                                                        48000021
         SR    RWORK1,RWORK1            INIT REG TO IND NOT LAST BLOCK  48100021
         TM    IOBCSW+3,UNITEXPT        DID UNIT EXCEPTION OCCUR ON     48200021
*                                       LAST BLOCK READ                 48300021
         BNO   STDIRCT                  NO, GO TO STORE NOT LAST INDR   48400021
         LA    RWORK1,L'BUFDATA-1       GET BUFFER DATA LENGTH MINUS 1  48500021
         SR    RWORK1,RSPACE            CALC ONE LESS THAN USED SPACE   48600021
         SPACE                                                          48700021
STDIRCT  EQU   *                                                        48800021
         TM    DCBMACF1,DCBMRECP        TEST FOR EXCP          @ZA02261 48850037
         BO    WRLAST                   YES, BYPASS UPDATE     @ZA02261 48860037
*                                       ON DCBDIRCT FIELD      @ZA02261 48870037
         STC   RWORK1,DCBDIRCT+1        UPDATE DCBDIRCT FIELD           48900021
         SPACE 2                                                        49000021
****                                                                    49100021
****     WRITE THE LAST DIRECTORY BLOCK PROCESSED.                      49200021
****                                                                    49300021
WRLAST   EQU   *                                                        49400021
         NI    STWWFLG2,X'FF'-STWCMDCH  SUPPRESS THE READ OPERATIONS    49500002
         BAL   RREADRET,WR1RD1          GO TO WRITE LAST BLOCK          49600002
         OI    DCBCIND2,STOWPERF        INDICATE STOW PERFORMED  M1088  49650021
         SPACE 2                                                        49700021
****                                                                    49800021
****     FREE THE GOTTEN CORE, PUT THE REASON CODE IN REGISTER 0, THE   49900002
****     RETURN CODE IN REGISTER 15, AND RETURN TO THE CALLER.          50000002
****                                                                    50100021
         SR    RRETCODE,RRETCODE        CLEAR REGISTER           YM0943 50200002
         IC    RRETCODE,STWRTN          GET RETURN CODE SAVED BY YM0943 50300002
*                                       THE FIRST LOAD           YM0943 50400001
         SPACE                                                          50410002
RTRNUSR1 EQU   *                                                 Y02072 50450002
         SR    REASONCD,REASONCD        CLEAR REASON CODE REG    Y02072 50460002
         SPACE                                                          50500021
RTRNUSR2 EQU   *                                                 Y02072 50600002
         FREEMAIN  R,LV=CORESIZE,A=(RAREA),SP=229  FREE AREA     Y02072 50900002
         SPACE                                                          50902002
         LR    R0,REASONCD              GET THE REASON CODE      Y02072 50910002
         LR    R15,RRETCODE             GET THE RETURN CODE      YM0943 50950002
         USING PSA,0                    ESTABLISH PSA BASE REG   Y02072 50962002
         L     RWORK1,PSATOLD           GET CURRENT TCB ADDR     Y02072 50980002
         USING TCB,RWORK1               ESTABLISH TCB BASE REG   Y02072 50982002
         L     RWORK1,TCBRBP            GET STOW SVRB ADDR       Y02072 50990002
         USING RBSECT,RWORK1            EST SVRB BASE REG        Y02072 50992002
         L     R14,XSAREG14             RESTORE RETURN REGISTER  Y02072 50996002
         DROP  RWORK1                   DROP SVRB BASE REG       Y02072 50998002
         SPACE 2                                                        50998402
****                                                                    50998802
****     MODESET TO KEY 0 AND RETURN TO THE CALLER.                     50999202
****                                                                    50999602
         MODESET EXTKEY=SUPR            MODESET TO KEY 0         Y02072 50999702
         BR    R14                      RETURN TO THE CALLER     Y02072 51000002
         EJECT                                                          51100021
*********************************************************************** 51200021
****                                                               **** 51300021
****     THIS SUBROUTINE IS USED TO COMPLETE THE OUTPUT BUFFER,    **** 51400021
****     SET UP THE CHANNEL PROGRAM TO WRITE THE OUTPUT BUFFER AND **** 51500021
****     READ ANOTHER DIRECTORY BLOCK INTO A FOURTH BUFFER,        **** 51550037
****     FROM WHERE IT IS MOVED INTO THE OUTPUT BUFFER. IF         **** 51560037
****     TWO INPUT BLOCKS MERGED COMPLETELY INTO ONE OUTPUT        **** 51570037
****     BUFFER, TWO NEW BLOCKS ARE READ IN. A NEW OUTPUT          **** 51580037
****     BUFFER (THE NEXT IN THE CHAIN) IS INITIALIZED.            **** 51590037
****                                                               **** 51800021
****     INPUT REGISTERS -                                         **** 51900021
****           RIBFR  - ADDRESS OF THE INPUT BUFFER                **** 52000021
****           ROBFR  - ADDRESS OF THE OUTPUT BUFFER               **** 52100021
****           RSPACE - UNUSED SPACE IN THE OUTPUT BUFFER          **** 52200021
****           R14    - RETURN ADDRESS                             **** 52300021
****                                                               **** 52400021
****     OUTPUT REGISTERS -                                        **** 52500021
****           RIBFR  - SAME AS ENTRY                              **** 52600021
****           ROBFR  - ADDRESS OF NEW OUTPUT BUFFER               **** 52700021
****           RSPACE - INITIALIZED TO BUFFER ENTRY AREA SIZE      **** 52800021
****           RFILL  - ADDRESS OF OUTPUT BUFFER ENTRY AREA        **** 52900021
****                                                               **** 53000021
*********************************************************************** 53100021
WR1RD1   EQU   *                                                        53200021
         LA    RWORK1,L'BUFDATA         GET SIZE OF BUFFER DATA AREA    53300021
         SR    RWORK1,RSPACE            CALC USED SPACE IN OUTPUT BFR   53400021
         USING BUFFER,ROBFR             ESTABLISH OUTPUT BFR BASE REG   53500021
         STH   RWORK1,BUFN              PUT USED SPACE INTO OUTPUT BFR  53600021
         ST    ROBFR,STWIDAD2-1         SET UP SEARCH ID ADDRESS        53700021
         MVI   STWSRCH2,STWIDEQ         RESTORE SEARCH ID EQUAL COMMAND 53800021
         LA    RWORK1,STWBUF4           POINT TO INPUT BUFFER   SA66881 53850037
         ST    RWORK1,STWRDAD3-1        SET UP C/K/D ADDRESS    SA66881 53860037
         MVI   STWRCKD3,STWRDCKD        RESTORE READ C/K/D COMMAND      54000021
*                                                                       54050037
         TM    STWRDFL3,STWSKIP         HAVE THE NEXT 2 BLKS    YA06505 54060037
*                                       BEEN READ IN ALREADY    YA06505 54070037
*                                       (DID A MERGE OCCUR?)    YA06505 54080037
         BNO   BUFOK                    NO, THEN READ IN NEXT   YA06505 54090037
         MVC   STWRDAD4,STWRDAD3        YES, SET UP LAST READ   YA06505 54092037
*                                       CKD WITH BUFFER 4 ADDR  YA06505 54094037
*                                       HAVE READ IN THE 2 BLKS YA06505 54096037
*                                       AFTER THE ONE WRITTEN   YA06505 54098037
BUFOK    EQU   *                        SET UP WRITE ADDRESS    YA06505 54098437
         LA    RWORK1,BUFKEY            GET ADDRESS OF KEY AREA         54100021
         ST    RWORK1,STWWRAD2-1        SET UP WRITE KEY/DATA ADDRESS   54200021
         MVI   STWWRKD1,STWWRKD         RESTORE WRITE KEY/DATA COMMAND  54300021
         TM    STWFLAG1,STWDRYRN        IS THIS A DRY RUN               54400021
         BNO   GOTOEXCP                 NO, GO TO ISSUE EXCP            54500021
         MVI   STWWRKD1,STWRDKD         REPLACE WRITE COMMAND WITH A    54600021
*                                       READ IN ORDER TO SUPPRESS DATA  54700021
*                                       TRANSFER FOR THE WRITE CCW      54800021
         SPACE                                                          54900021
GOTOEXCP EQU   *                                                        55000021
         MVC   IOBCC(5),0(ROBFR)        SET UP CCHHR OF IOBSEEK FIELD   55100021
         BAL   REXCPRET,EXCP            GO ISSUE EXCP                   55200002
         MVC   0(L'BUFCNT+L'BUFKEY,ROBFR),STWBUF4 MOVE C/K FLDS SA66881 55250037
         MVC   16(L'BUFDATA,ROBFR),STWBUF4+16 MOVE DIR. BLOCK   SA66881 55260037
****                                                                    55270037
****     THE COUNT/KEY/DATA FIELDS ARE NOT READ DIRECTLY INTO           55292437
****     THE OUTPUT BUFFER, TO PROTECT THE OUTPUT BUFFER, SHOULD        55292837
****     ERROR RETRY BE REQUIRED.                                       55293237
****                                                                    55294037
         L     ROBFR,BUFADDR            INIT OUTPUT BFR POINTER         55300021
         LA    RFILL,BUFENTRY           INIT FILL POINTER               55400021
         LA    RSPACE,L'BUFENTRY        INIT UNUSED SPACE IN OUTPUT BFR 55500021
         DROP  ROBFR                    DROP OUTPUT BFR BASE REG        55600021
         BR    RREADRET                 RETURN TO CALLER                55700002
         EJECT                                                          55800021
*********************************************************************** 55900021
****                                                               **** 56000021
****     THIS SUBROUTINE IS USED TO MOVE AN ENTRY OR ENTRIES FROM  **** 56100021
****     THE INPUT BUFFER TO THE OUTPUT BUFFER AND UPDATE THE KEY  **** 56200021
****     FIELD OF THE OUTPUT BUFFER FOLLOWING EACH MOVE.  THERE    **** 56300021
****     ARE TWO ENTRY POINTS TO THIS SUBROUTINE.  THE FIRST IS    **** 56400021
****     USED TO MOVE ONE OR MORE ENTRIES OF UNKNOWN SIZE AND THE  **** 56500021
****     SECOND TO MOVE ONE ENTRY OF KNOWN SIZE.                   **** 56600021
****                                                               **** 56700021
****     INPUT REGISTERS -                                         **** 56800021
****           RMOVE  - ADDRESS DATA IS TO BE MOVED FROM           **** 56900021
****           RFILL  - ADDRESS DATA IS TO BE MOVED TO             **** 57000021
****           RSIZE  - SIZE OF ENTRY (SECOND ENTRY ONLY)          **** 57100021
****           REMAIN - AMOUNT OF DATA REMAINING IN INPUT BUFFER   **** 57200021
****           RSPACE - AMOUNT OF UNUSED SPACE IN OUTPUT BUFFER    **** 57300021
****           ROBFR  - ADDRESS OF OUTPUT BUFFER                   **** 57400021
****           R15    - AMOUNT OF DATA TO BE MOVED (EQUAL TO RSIZE **** 57500021
****                    FOR SECOND ENTRY)                          **** 57600021
****           R14    - RETURN ADDRESS                             **** 57700021
****                                                               **** 57800021
****     OUTPUT REGISTERS -                                        **** 57900021
****           RMOVE  - INCREMENTED BY AMOUNT OF DATA MOVED        **** 58000021
****           RFILL  - INCREMENTED BY AMOUNT OF DATA MOVED        **** 58100021
****           RSIZE  - AMOUNT OF DATA REMAINING TO BE MOVED       **** 58200021
****           REMAIN - AMOUNT OF DATA REMAINING IN INPUT BUFFER   **** 58300021
****           RSPACE - AMOUNT OF UNUSED SPACE IN OUTPUT BUFFER    **** 58400021
****           ROBFR  - SAME AS INPUT                              **** 58500021
****           R15    - AMOUNT OF DATA UNABLE TO MOVE              **** 58600021
****                                                               **** 58700021
*********************************************************************** 58800021
MOVEMANY EQU   *                                                        58900021
         LTR   RMOVESZ,RMOVESZ          HAS ALL DATA BEEN MOVED         59000002
         BZR   RMOVERET                 YES, RETURN TO CALLER           59100002
         BAL   RCALCRET,CALCSIZE        GO GET SIZE OF NEXT ENTRY       59200002
         SPACE                                                          59300021
MOVEONE  EQU   *                                                        59400021
         CR    RSPACE,RSIZE             WILL ENTRY FIT IN OUTPUT BFR    59500021
         BLR   RMOVERET                 NO, RETURN TO CALLER            59600002
         SR    RMOVESZ,RSIZE            CALC AMOUNT LEFT TO BE MOVED    59700002
         SR    REMAIN,RSIZE             DECR DATA LEFT IN INPUT BFR     59800021
         SR    RSPACE,RSIZE             DECR UNUSED SPACE IN OUTPUT BFR 59900021
         USING BUFFER,ROBFR             ESTABLISH OUTPUT BFR BASE REG   60000021
         USING PDS2,RMOVE               ESTABLISH ENTRY BASE REG        60100002
         MVC   BUFKEY,PDS2NAME          UPDATE OUTPUT BFR KEY FIELD     60200002
         DROP  ROBFR,RMOVE              DROP BASE REGISTERS             60300021
         BCTR  RSIZE,R0                 DECR REG FOR CORRECT MOVE LNTH  60400021
         EX    RSIZE,MOVEIT             MOVE ENTRY TO OUTPUT BFR        60500021
         LA    RMOVE,1(RSIZE,RMOVE)     INCR MOVE PTR PAST MOVED ENTRY  60600021
         LA    RFILL,1(RSIZE,RFILL)     INCR FILL PTR PAST MOVED ENTRY  60700021
         B     MOVEMANY                 CONTINUE MOVING ENTRIES         60800021
         SPACE                                                          60900021
MOVEIT   EQU   *                                                        61000021
         MVC   0(0,RFILL),0(RMOVE)      MOVE FOR EXECUTE INSTRUCTION    61100021
         SPACE 2                                                        61200021
*********************************************************************** 61300021
****                                                               **** 61400021
****     THIS SUBROUTINE IS USED TO CALCULATE THE SIZE OF A        **** 61500021
****     DIRECTORY ENTRY AND RETURN IT IN REGISTER R15.            **** 61600021
****                                                               **** 61700021
****     INPUT REGISTERS -                                         **** 61800021
****           RMOVE - ADDR OF ENTRY WHOSE SIZE IS TO BE CALCULATED**** 61900021
****           R13   - RETURN ADDRESS                              **** 62000021
****                                                               **** 62100021
****     OUTPUT REGISTERS -                                        **** 62200021
****           RMOVE - SAME AS INPUT                               **** 62300021
****           RSIZE - SIZE OF ENTRY                               **** 62400021
****                                                               **** 62500021
*********************************************************************** 62600021
CALCSIZE EQU   *                                                        62700021
         USING PDS2,RMOVE               ESTABLISH ENTRY BASE REGISTER   62800002
         IC    RSIZE,PDS2INDC           GET USER DATA SIZE              62900002
         SLL   RSIZE,27                 SHIFT OFF ALAIS BIT AND NUMBER  63000021
*                                       OF TTRN'S                       63100021
         SRL   RSIZE,26                 REPOSITION DATA SIZE AND CON-   63200021
*                                       VERT HALFWORDS TO BYTES         63300021
         LA    RSIZE,L'PDS2NAME+L'PDS2TTRP+L'PDS2INDC(,RSIZE)           63400002
*                                       CALCULATE TOTAL SIZE OF ENTRY   63402002
         DROP  RMOVE                    DROP ENTRY BASE REGISTER        63500021
         BR    RCALCRET                 RETURN TO USER                  63600002
         SPACE 2                                                        63700021
*********************************************************************** 63800021
****                                                               **** 63900021
****     THIS SUBROUTINE IS USED TO EXECUTE A CHANNEL PROGRAM AND  **** 64000021
****     CHECK THE STATUS FOLLOWING COMPLETION.                    **** 64100021
****                                                               **** 64200021
****     INPUT REGISTERS -                                         **** 64300021
****           R13 - RETURN ADDRESS                                **** 64400021
****                                                               **** 64500021
****     OUTPUT REGISTERS - NONE                                   **** 64600021
****                                                               **** 64700021
*********************************************************************** 64800021
EXCP     EQU   *                                                        64900021
         EXCP  IOBSTDRD                 EXECUTE CHANNEL PROGRAM         65000021
         TM    ECBCC,ECBPOST            HAS ECB BEEN POSTED ?? @ZA12202 65100037
         BO    BYWAIT                   BYPASS WAITING ON ECB  @ZA12202 65120037
         WAIT  ECB=ECBCC                WAIT FOR I/O TO COMPLETE        65140037
BYWAIT   EQU   *                        ECB HAS BEEN POSTED    @ZA12202 65160037
         TM    ECBCC,ECBNORM            DID I/O COMPLETE NORMALLY       65200021
         BOR   REXCPRET                 YES, RETURN TO CALLER           65300002
         NI    DCBIFLGS,X'FF'-DCBIFEC   TURN OFF ERROR FLAGS     Y02072 65350002
         TM    IOBCSW+3,UNITEXPT        DID UNIT EXCEPTION OCCUR        65400021
         BOR   REXCPRET                 YES, RETURN TO CALLER           65500002
         LA    REASONCD,DIRECTRY        INDICATE ERROR OCCURED   Y02072 65550002
*                                       IN THE DIRECTORY         Y02072 65560002
         LA    RRETCODE,IOERROR         IND AN I/O ERROR OCCURED YM0943 65600002
         B     RTRNUSR2                 GO TO RETURN TO USER     Y02072 65700002
         EJECT                                                          65800021
*********************************************************************** 65900021
****                                                               **** 66000021
****     CONSTANTS                                                 **** 66100021
****                                                               **** 66200021
*********************************************************************** 66300021
         SPACE                                                          66400021
COUNTSZ  DC    Y(L'BUFN)                SIZE OF DIRECTORY BLOCK DATA    66500021
*                                       COUNT FIELD                     66600021
HIGHKEY  DC    8X'FF'                   KEY OF HIGHEST DIRECTORY ENTRY  66700021
         DC    C'IGG021AB'              NAME OF MODULE         @ZA10229 66700537
         DC    CL8'&SYSDATE'            DATE OF CHANGE         @ZA10229 66701037
         DC    C'@ZA12202'              LATEST FLAG            @ZA12202 66701537
PATCH    DC    0XL50'0',C'IGG021AB',42X'0'  50 BYTE PATCH AREA   Y02072 66702002
         EJECT                                                          83200021
*********************************************************************** 83210002
****                                                               **** 83220002
****     CONTROL BLOCK DEFINITIONS                                 **** 83230002
****                                                               **** 83240002
*********************************************************************** 83242002
         SPACE                                                          83244002
         CVT   DSECT=YES                                         Y02072 83250002
         EJECT                                                          83260002
         DCBD  DSORG=PO                                                 83300021
         EJECT                                                          83400021
         IEZDEB                                                         83500021
         EJECT                                                          83502002
         IHAPDS PDSBLDL=NO                                              83504002
         EJECT                                                          83550002
         IHAPSA                                                  Y02072 83552002
         EJECT                                                          83554002
         IHARB                                                   Y02072 83560002
         EJECT                                                          83570002
         IKJTCB                                                  Y02072 83580002
         EJECT                                                          83590002
         IGGSTW                                                  Y02072 83592002
         END   IGG021AB                                                 83600021
./  ADD  SSI=81140497,NAME=IGG0210A
         TITLE 'IGG0210A - SECOND LOAD OF BPAM STOW ROUTINE'            00100021
IGG0210A CSECT                                                          00200021
         SPACE                                                          00300021
*********************************************************************** 00400021
*                                                                     * 00500021
* MODULE NAME = IGG0210A                                              * 00502002
*                                                                     * 00504002
* DESCRIPTIVE NAME = SECOND LOAD OF BPAM STOW ROUTINE                 * 00506002
*                                                                     * 00508002
* COPYRIGHT = NONE                                                    * 00510002
*                                                                     * 01000021
* STATUS = RELEASE VS2-4, LEVEL 04/07/78                              * 01100037
*                                                                     * 01102002
*                                                                     * 01600021
* FUNCTION = WRITES AN EOD MARKER FOLLOWING THE LAST MEMBER WRITTEN   * 01700002
*            IF THE FOLLOWING CONDITIONS ARE MET:                     * 01800002
*            1 - THE FUNCTION REQUESTED IS AN ADD OR A REPLACE.       * 02000002
*            2 - THE ENTRY BEING ADDED OR REPLACED IS NOT AN ALIAS.   * 02100002
*            3 - THE USER'S DCB IS NOT OPEN FOR RDBACK OR UPDATE.     * 02200002
*            4 - THE LAST I/O OPERATION PERFORMED BY THE CALLER WAS A * 02300002
*                WRITE.                                               * 02300402
*                                                                     * 02400021
*            RETURNS, TO THE CALLER, THE TTR OF THE LAST MEMBER       * 02500002
*            WRITTEN IF THE FOLLOWING CONDITIONS ARE MET:             * 02600002
*            1 - THE FUNCTION REQUESTED IS AN ADD OR A REPLACE.       * 02700002
*            2 - THE ENTRY BEING ADDED OR REPLACED IS NOT AN ALIAS.   * 02800002
*                                                                     * 02900021
*            BUILDS, IN THE STOW WORK AREA, THE CHANNEL PROGRAM USED  * 03000002
*            BY THE THIRD LOAD (IGG021AB) TO PERFORM THE I/O OPERA-   * 03100002
*            TIONS ON THE DIRECTORY NECESSARY TO ACCOMPLISH THE       * 03200002
*            FUNCTION REQUESTED.                                      * 03202002
*                                                                     * 03204002
*                                                                     * 03300021
* NOTES = SEE BELOW                                                   * 03302002
*                                                                     * 03304002
*    DEPENDENCIES = NONE                                              * 03306002
*                                                                     * 03308002
*    RESTRICTIONS = NONE                                              * 03310002
*                                                                     * 03312002
*    REGISTER CONVENTIONS = SEE REGISTER EQUATES BELOW                * 03314002
*                                                                     * 03316002
*    PATCH LABEL = PATCH                                              * 03318002
*                                                                     * 03318402
*                                                                     * 03320002
* MODULE TYPE = SVC ROUTINE                                           * 03322002
*                                                                     * 03324002
*    ATTRIBUTES = REENTRANT, ENABLED, PRIVILEGED, ENTERED IN          * 03326002
*                 SUPERVISOR KEY AND ISSUES A MODESET TO RUN IN THE   * 03328002
*                 CALLER'S KEY.                                       * 03330002
*                                                                     * 03332002
*                                                                     * 03400021
* ENTRY POINT = IGG0210A                                              * 03500002
*                                                                     * 03800021
*    LINKAGE = THIS ROUTINE RECEIVES CONTROL FROM THE                 * 03802003
*              FIRST LOAD OF STOW - IGC0002A.                         * 03804002
*                                                                     * 03806002
*    INPUT = THE FOLLOWING PARAMETERS ARE PASSED WHEN CONTROL IS      * 03900002
*            RECEIVED AS DESCRIBED ABOVE.                             * 04100002
*            REGISTER 10 - CONTAINS THE ADDRESS OF STOW'S WORK AREA.  * 04200002
*            REGISTER 11 - CONTAINS THE ADDRESS OF THE CALLER'S DCB.  * 04300002
*                                                                     * 04500021
*    OUTPUT = SAME REGISTERS AS INPUT.  FOR THE FUNCTIONS OF ADD OR   * 04600002
*             REPLACE WITHOUT THE ALAIS OPTION, THE BEGINNING RELATIVE* 04800002
*             ADDRESS (TTR) OF THE MEMBER ADDED OR REPLACED IS        * 05000002
*             RETURNED WITHIN THE TTR FIELD OF THE PARAMETER LIST     * 05100002
*             PASSED TO STOW.                                         * 05200002
*                                                                     * 05400021
*    EXITS-NORMAL = BRANCHES TO IGG021AB.                             * 05402003
*                                                                     * 05408002
*    EXITS-ERROR = RETURNS TO THE CALLER VIA A BR 14 WITH REASON CODE * 05410002
*                  REGISTER 0 AND RETURN CODE REGITSER 15 CONTAINING  * 05412002
*                  THE FOLLOWING:                                     * 05414002
*                  REG 0   REG 15              CONDITION              * 05416002
*                    2       16  - AN I/O ERROR OCCURED WHILE WRITING * 05418002
*                                  AN EOD MARKER AFTER THE MEMBER.    * 05420002
*                                                                     * 05420402
*                                                                     * 05422002
* EXTERNAL REFERENCES = SEE BELOW                                     * 05500002
*                                                                     * 05502002
*    ROUTINES = IECPRLTV - USED TO CONVERT AN ABSOLUTE DIRECT ACCESS  * 05504002
*               ADDRESS, MBBCCHHR, TO ITS RELATIVE EQUIVALENT, TTRN.  * 05600002
*                                                                     * 05602002
*               IECPCNVT - CONVERTS A RELATIVE DIRECT ACCESS ADDRESS  * 05800002
*               AND CONCATENATION NUMBER, TTRN, TO ITS ABSOLUTE       * 05900002
*               EQUIVALENT, MBBCCHHR.                                 * 06000002
*                                                                     * 06000402
*               MODESET - USED TO CHANGE THE STORAGE PROTECT KEY.     * 06002002
*                                                                     * 06200021
*               SETLOCK - USED TO OBTAIN AND RELEASE THE LOCAL LOCK.  * 06202002
*                                                                     * 06204002
*               DEBCHK - USED TO VERIFY THE CALLER'S DEB ADDRESS.     * 06206002
*                                                                     * 06208002
*               ABEND(SVC 13) - USED TO ABEND THE USER WITH A SYSTEM  * 06210002
*               COMPLETION CODE OF 115 IF DEBCHK IS NOT SUCCESSFUL.   * 06212002
*                                                                     * 06214002
*               EOV(SVC 55) - USED TO EXTEND THE DATA SET WHEN THE    * 06300002
*               CURRENT EXTENT DOES NOT CONTAIN SUFFICIENT SPACE TO   * 06400002
*               WRITE AN EOD MARKER.                                  * 06500002
*                                                                     * 06600021
*               EXCP(SVC 0) AND WAIT(SVC 1) - ARE USED TO PERFORM I/O * 06700002
*               OPERATIONS.                                           * 06702002
*                                                                     * 06704002
*               FREEMAIN(SVC 10) - IS USED TO FREE STOW'S WORK AREA   * 06800002
*               IN THE EVENT OF AN I/O ERROR.                         * 06900002
*                                                                     * 08200021
*    DATA AREAS = NONE                                                * 08202002
*                                                                     * 08204002
*    CONTROL BLOCKS = CVT,DCB,DEB,DVCT,ECB,IOB,PSA,SVRB,TCB           * 08206002
*                                                                     * 08206402
*                                                                     * 08208002
* TABLES = THIS MODULE USES THE STOW WORK AREA, THE FORMAT AND        * 08300002
*          CONTENTS OF WHICH ARE DESCRIBED IN THE DSECT AT THE END OF * 08400002
*          THE LISTING.                                               * 08402002
*                                                                     * 08404002
*                                                                     * 08600021
* MACROS = ACTION MACROS - MODESET,SETLOCK,ABEND,EOV,EXCP,WAIT,       * 08700002
*             FREEMAIN                                                * 08702003
*                                                                     * 09000021
*          MAPPING MACROS - CVT,DCBD,IEZDEB,IHADVCT,IHAPSA,IHARB,     * 09002002
*             IHASTOW,IKJTCB,IGGSTW                                   * 09004002
*                                                                     * 09006002
*                                                                     * 09500021
* CHANGE ACTIVITY = AS FOLLOWS:                                       * 09600002
*                                                                     * 09600402
*          RELEASE 21 DELETIONS                                       * 09602002
*    THIS MODULE WAS REWRITTEN FOR RELEASE 21.  THE FOLLOWING APARS   * 09602402
*    WERE CORRECTED.  28169, 33374, 35322, 42484, AND 43923.          * 09602802
*                                                                 M0965 09604002
*                                                               SA66881 09604437
*          VS1 RELEASE 01 DELETIONS                                   * 09606002
*                                                                XM5415 09608002
*          VS1 RELEASE 02 DELETIONS                                   * 09608402
*                                                                XM9034 09608802
*          VS1 RELEASE 03 DELETIONS                                   * 09609002
*                                                               XA02388 09609202
* SEE CODE FLAGGED SA66881 FOR APAR XA03384                     XA03384 09609637
*          VS1 RELEASE 04 DELETIONS                                     09609737
* SEE CODE FLAGGED YA06505 FOR APAR XA06889                     XA06889 09609837
*          VS2 RELEASE 01 DELETIONS                                   * 09610002
*D365000                                                         YM0943 09612002
*                                                               YA06505 09612437
*          VS2 RELEASE 02 DELETIONS                                   * 09614002
*D001500,005500,008200,138000-140000,260000,271000-273000,288000,Y02072 09616002
*D292000,294000,300000-302000,410000-411000,413000,421000-422000,Y02072 09618002
*D482000-483000,485000-486000,493000-669000                      Y02072 09620002
*                                                                YM5733 09620402
*          VS2 RELEASE 03 DELETIONS                                   * 09670403
*                                                              @Z30TSMI 09677837
*          VS2 RELEASE 04 DELETIONS                                     09692637
* SEE CODE FLAGGED YA06505 AND SA66881 FOR APAR ZA01548         ZA01548 09700037
*A364000-364500,365500,481006-481012                           @ZA12202 09730037
*                                                              @ZA12202 09760037
*C481006-481012                                                @ZA31380 09780037
*A254000-256800,270200                                         @ZA31380 09786037
*D298000                                                       @ZA31777 09793037
*********************************************************************** 09800021
         EJECT                                                          09900021
*********************************************************************** 10000021
****                                                               **** 10100021
****     REGISTER EQUATES                                          **** 10200021
****                                                               **** 10300021
*********************************************************************** 10400021
         SPACE                                                          10500021
R0       EQU   0                        WORK/PARAMETER REGISTER         10600021
R1       EQU   1                        WORK/PARAMETER REGISTER         10700021
RDEB     EQU   R1                       DEB ADDRESS                     10800021
R2       EQU   2                        WORK REGISTER                   10900021
REXTNO   EQU   R2                       NUMBER OF DEB EXTENTS    Y02072 10950002
R3       EQU   3                        WORK REGISTER                   11000021
RCVT     EQU   R3                       CVT ADDRESS                     11100021
R4       EQU   4                        WORK REGISTER                   11200021
RDEVTBL  EQU   R4                       ADDR OF DEVICE CHAR TABLE       11300021
R5       EQU   5                        WORK REGISTER                   11400021
RVOLSEQ  EQU   R5                       USED TO SAVE DEBVOLSEQ   Y02072 11450002
RAREA    EQU   6                        POINTER TO WORK AREA            11500021
RDCB     EQU   7                        POINTER TO THE USER'S DCB       11600021
RBASE    EQU   8                        BASE REGISTER                   11700021
R9       EQU   9                        WORK REGISTER                   11800021
RWORK1   EQU   R9                       WORK REGISTER                   11900021
RRETURN  EQU   RWORK1                   SUBROUTINE RETURN REG    Y02072 11950002
R10      EQU   10                       WORK/PARAMETER REGISTER         12000002
*                                       USED TO PASS WORK AREA BETWEEN  12010002
*                                       LOADS OF STOW                   12020002
RWORK2   EQU   R10                      WORK REGISTER                   12050002
R11      EQU   11                       WORK/PARAMETER REGISTER         12100002
*                                       USED TO PASS THE DCB BETWEEN    12110002
*                                       LOADS OF STOW                   12120002
RWORK3   EQU   R11                      WORK REGISTER                   12150002
R13      EQU   13                       WORK REGISTER                   12300021
RWORK4   EQU   R13                      WORK REGISTER                   12400002
R14      EQU   14                       LINK/WORK REGISTER              12500002
R15      EQU   15                       RETURN CODE /LINK /WORK REG     12600002
         EJECT                                                          12700021
*********************************************************************** 12800021
****                                                               **** 12900021
****     MASKS, DISPLACEMENTS, AND OTHER EQUATES                   **** 13000021
****                                                               **** 13100021
*********************************************************************** 13200021
         SPACE                                                          13300021
RCDZERO  EQU   X'00'                    USED TO SET TTR TO IND RECORD 0 13500021
RCDONE   EQU   X'01'                    USED TO SET TTR TO IND RECORD 1 13600021
IOERROR  EQU   X'10'                    I/O ERROR CODE                  13700021
STOWABCD EQU   X'115'                   ABEND CODE FOR FOR A     Y02072 13702002
*                                       DEBCHK FAILURE IN STOW   Y02072 13704002
EODERROR EQU   2                        IND I/O ERROR ENCOUNTER- Y02072 13950002
*                                       ED WRITING EOD MARKER    Y02072 14000002
EXTLNGTH EQU   16                       LENGTH OF A DASD DEB EXTENT     14100021
EOV      EQU   55                       EOV SVC NUMBER                  14200021
         EJECT                                                          14300021
****                                                                    14400021
****     ESTABLISH ADDRESSABILITY                                       14500021
****                                                                    14600021
         BALR  RBASE,0                  INITIALIZE BASE REGISTER        14700002
         USING *,RBASE                  ESTABLISH ADDRESSABILITY        14800021
         LR    RAREA,R10                CHANGE WORK AREA BASE REGISTER  14900021
         LR    RDCB,R11                 CHANGE DCB BASE REGISTER        15000021
         USING STWAREA,RAREA            ESTABLISH WORK AREA BASE REG    15100021
         USING IHADCB,RDCB              ESTABLISH DCB BASE REGISTER     15200021
         L     RDEB,DCBDEBAD            GET ADDRESS USER'S DEB   Y02072 15300002
         USING DEBBASIC,RDEB            ESTABLISH DEB BASE REGISTER     15400021
         L     RCVT,CVTPTR              GET CVT ADDRESS                 15500021
         USING CVT,RCVT                 ESTABLISH CVT BASE REGISTER     15600021
         SPACE 2                                                        15700021
****                                                                    15800021
****     IF THE FUNCTION IS ADD OR REPLACE, DETERMINE IF AN END OF DATA 15900021
****     MARKER MUST BE WRITTEN AFTER THE ASSOCIATED MEMBER.            16000021
****                                                                    16100021
         TM    STWFLAG1,STWCHNG+STWDEL  IS FUNCT CHANGE OR DELETE       16200021
         BNZ   BLDCHPGM                 YES, GO TO BUILD CHANNEL PGM    16300021
         TM    STWCTTRN,STWALIAS        IS NEW ENTRY AN ALIAS           16400021
         BO    BLDCHPGM                 YES, GO TO BUILD CHANNEL PGM    16500021
         TM    DEBOPATB,DEBACCS-(DEBUPDAT+DEBRDBCK)  IS DATA SET OPEN   16600002
*                                       FOR INPUT, RDBACK, OR UPDATE    16700002
         BZ    RETRNTTR                 YES, GO TO RETURN TTR TO USER   16800021
         TM    STWFLAG1,STWDCBWR        WAS LAST OPERATION ON USER'S    16900021
*                                       DCB A WRITE                     17000021
         BNO   RETRNTTR                 NO, GO TO RETURN TTR TO USER    17100021
         SPACE 2                                                        17200021
****                                                                    17300021
****     CHECK THE VOLUME AND THE CURRENT TRACK TO DETERMINE IF SPACE   17400021
****     IS AVAILABLE TO WRITE THE EOD MARKER.                          17500021
****                                                                    17600021
SPACECHK EQU   *                                                        17700021
         L     RDEVTBL,DCBDVTBL         GET ADDR OF DEVICE CHAR TABLE   17800021
         USING DVCT,RDEVTBL             ESTABLISH DEVICE TABLE BASE REG 17900002
         SR    RWORK1,RWORK1            CLEAR REGISTER                  18000021
         IC    RWORK1,DVCOVLB           GET OVERHEAD FOR KEYED RECORD   18100002
*                                       WHICH IS LAST ON TRACK          18200021
         TM    DVCFLAGS,DVC2BOV         USING TWO BYTE OVERHEAD         18300002
         BNO   NOT2BYT1                 NO, CONT SIZE CALCULATION       18400021
         LH    RWORK1,DVCOVHD           GET TWO BYTE OVERHEAD           18500002
         SPACE                                                          18600021
NOT2BYT1 EQU   *                                                        18700021
         SR    RWORK4,RWORK4            CLEAR REGISTER                  18800002
         IC    RWORK4,DVCOVNK           OVERHEAD FOR RECORD KEY         18900002
         SR    RWORK1,RWORK4            SUBTRACT KEY OVERHEAD           19000002
         LA    RWORK1,1(,RWORK1)        OVERHEAD FOR KEY AND DATA       19100021
*                                       LENGTH OF ZERO                  19200021
         CH    RWORK1,DCBTRBAL          WILL TRACK HOLD EOD RECORD      19300021
         BNH   UPTRKBAL                 YES, GO TO UPDATE TRACK BALANCE 19400021
         SPACE 2                                                        19500021
*********************************************************************** 19600021
****                                                               **** 19700021
****     THE FOLLOWING ROUTINE IS USED TO DETERMINE THE NEXT TRACK **** 19800021
****     ADDRESS.  THIS IS DONE BY ADDING 1 TO THE CURRENT TT AND  **** 19900021
****     SENDING THIS VALUE TO THE RESIDENT CONVERT ROUTINE.  IF   **** 20000021
****     THE NUMBER OF TRACKS IN THE DEB IS EXCEEDED, THE CONVERT  **** 20100021
****     ROUTINE WILL RETURN A CODE OF 4 IN REGISTER 15.  INPUT TO **** 20200021
****     AND OUTPUT FROM THE RESIDENT CONVERT ROUTINE IS AS        **** 20300021
****     FOLLOWS.                                                  **** 20400021
****                                                               **** 20500021
****     IECPRLTV - CONVERTS AN ABSOLUTE DIRECT ACCESS ADDRESS,    **** 20600021
****                MBBCCHHR, TO ITS RELATIVE EQUIVALENT, TTRN.    **** 20700021
****                                                               **** 20800021
****                INPUT REGISTERS -                              **** 20900021
****                  1  - ADDRESS OF DEB                          **** 21000021
****                  2  - ADDRESS OF MBBCCHHR IN CORE             **** 21100021
****                  14 - ENTRY ADDRESS                           **** 21200021
****                  15 - ENTRY ADDRESS                           **** 21300021
****                                                               **** 21400021
****                OUTPUT REGISTERS -                             **** 21500021
****                  0  - TTR0 RESULT                             **** 21600021
****                  1-8  TRANSPARENT                             **** 21700021
****                  9-13 DESTROYED                               **** 21800021
****                  14 - TRANSPARENT                             **** 21900021
****                  15 - ZERO                                    **** 22000021
****                                                               **** 22100021
****     IECPCNVT - CONVERTS A RELATIVE DIRECT ACCESS ADDRESS AND  **** 22200021
****                CONCATENATION NUMBER, TTRN, TO ITS ABSOLUTE    **** 22300021
****                EQUIVALENT, MBBCCHHR.                          **** 22400021
****                                                               **** 22500021
****                INPUT REGISTERS -                              **** 22600021
****                  0  - ACTUAL TTRN                             **** 22700021
****                  1  - ADDRESS OF DEB                          **** 22800021
****                  2  - ADDRESS OF 8 BYTE AREA FOR MBBCCHHR     **** 22900021
****                  14 - RETURN ADDRESS                          **** 23000021
****                  15 - ENTRY ADDRESS                           **** 23100021
****                                                               **** 23200021
****                OUTPUT REGISTERS -                             **** 23300021
****                  0  - DESTROYED                               **** 23400021
****                  1-8  TRANSPARENT                             **** 23500021
****                  9-13 DESTROYED                               **** 23600021
****                  14 - TRANSPARENT                             **** 23700021
****                  15 - ERROR CODE                              **** 23800021
****                                                               **** 23900021
****                THE ERROR CODE FOR IECPCNVT WILL BE 0 FOR      **** 24000021
****                SUCCESSFUL CONVERSION, OR 4 IF THE VALUE OF TT **** 24100021
****                EXCEEDS THE TOTAL EXTENTS ASSIGNED.            **** 24200021
****                                                               **** 24300021
*********************************************************************** 24400021
         LA    R2,DCBFDAD               GET ADDRESS OF MBBCCHHR         24500021
         L     R15,CVTPRLTV             GET ENTRY PT IN CONVERT ROUTINE 24600021
*                                       TO CONVERT MBBCCHHR TO TTRN     24700021
         BALR  R14,R15                  GO TO CONVERT ROUTINE           24800021
         LR    RWORK1,R0                SAVE TTRN                       24900021
         AL    R0,CON10000              CALC NEXT RELATIVE TRACK ADDR   25000021
         AH    RWORK1,CON00100          CALC NEXT RCD ON CURRENT TRACK  25100021
         CL    RWORK1,DCBRELAD          IS NEXT RECORD FIRST IN MEMBER  25200021
         BNE   CONVRTTR                 NO, GO TO CONVERT TTR           25300021
         LR    R5,R0                    SAVE TTRN + 1          @ZA31380 25400037
         L     R15,CVTPCNVT             ENTRY PT TO CNVRT RTN  @ZA31380 25420037
         BALR  R14,R15                  BR TO CNVT TTR-MBBCCHHR@ZA31380 25440037
         LTR   R15,R15                  TEST RC-EXCEED EXTENTS @ZA31380 25460037
*                                       IN THE DEB             @ZA31380 25480037
         BZ    STFIRST                  NO CONTINUE PROCESSING @ZA31380 25500037
         CLI   DEBNMEXT,X'10'           CHECK FOR 16 EXTENTS   @ZA31380 25520037
         BE    GOEOV                    YES- TO TO DEBCHK -EOV @ZA31380 25540037
STFIRST  EQU   *                                               @ZA31380 25560037
         ST    R5,DCBRELAD              SET DCBRELAD TO 1ST REC@ZA31380 25580037
         MVI   DCBRELAD+2,RCDONE        RECORD OF NEXT TRACK   @ZA31380 25600037
         MVC   STWTTR,DCBRELAD          UPDATE ENTRY TTR FIELD @ZA31380 25620037
         LTR   R15,R15                  EXCEED EXTENTS ?       @ZA31380 25640037
         BZ    SETRCD0                  NO, GO TO RESET REC NO @ZA31380 25660037
         B     GOEOV                    GO - DEBCHK - EOV      @ZA31380 25680037
         SPACE                                                          25800021
CONVRTTR EQU   *                                                        25900021
         L     R15,CVTPCNVT             GET ENTRY PT IN CONVERT ROUTINE 26100021
*                                       TO CONVERT TTR TO MBBCCHHR      26200021
         BALR  R14,R15                  GO TO CONVERT ROUTINE           26300021
         LTR   R15,R15                  DOES IT EXCEED EXTENTS IN DEB   26400021
         BZ    SETRCD0                  NO, GO TO RESET RECORD NUMBER   26500021
*                                       AND TRACK BALANCE               26600021
         SPACE 2                                                        26700021
****                                                                    26800021
****     GO TO EOV TO GET SPACE FOR THE EOD MARKER.                     26900021
****                                                                    27000021
GOEOV    EQU   *                                               @ZA31380 27020037
         BAL   RRETURN,CHECKDEB         BR TO DEB CHECK ROUTINE  Y02072 27050002
*                                       UPON RETURN, REG 1 WILL  Y02072 27100002
*                                       CONTAIN VERIF'D DEB ADDR Y02072 27150002
         SR    REXTNO,REXTNO            CLEAR REGISTER           Y02072 27400002
         IC    REXTNO,DEBNMEXT          GET NO. EXTENTS IN DEB   Y02072 27500002
         SLL   REXTNO,4                 MULTIPLY EXTENTS BY 16   Y02072 27600002
         LA    RWORK1,DEBBASND(REXTNO)  POINT TO ACCESS METHOD   Y02072 27800002
*                                       SECTION OF THE USER'S DEB       27900021
         USING DEBACSMD,RWORK1          EST ACCESS METHOD SECTION BASE  28000002
         L     RVOLSEQ,DEBVOLSQ         SAVE DEBVOLSQ CONTENTS   Y02072 28100002
         MVC   DEBVOLSQ,VOLSEQNO        SET CURRENT AND TOTAL NUMBER    28200021
*                                       OF VOLUMES TO ONE FOR EXCP      28300021
         DROP  RWORK1                   DROP ACCESS METHOD SECTION BASE 28400002
         BAL   RRETURN,FREELOCK         BR TO FREE LOCAL LOCK    Y02072 28450002
*                                       AND RTRN TO CALLER'S KEY Y02072 28460002
         LH    RWORK1,DCBMACRF          SAVE USER'S ACCESS METHOD FLAGS 28500002
         MVI   DCBMACF1,DCBMRECP+DCBMRABC IND EXCP & ACCURATE BLCK CNT  28600002
         MVI   DCBMACF2,0               CLEAR SECOND BYTE               28700002
         DROP  RDEB                     DROP DEB BASIC SECT BASE Y02072 28750002
         EOV   (RDCB)                   ISSUE EOV SVC            Y02072 28900002
         TM    DCBCIND2,DCBCNCLO        DID CLOSE ISSUE STOW     XM9034 28950002
         BNO   NOTCLOSE                 CONTINUE IF NOT          XM9034 28960002
         OI    DCBOFLGS,DCBOFIOF        RESET DCB BUSY BIT       XM9034 28970002
         SPACE                                                          28980002
NOTCLOSE EQU   *                                                 XM9034 28990002
         STH   RWORK1,DCBMACRF          RESTORE USER'S FLAGS            29000002
         L     RDEB,DCBDEBAD            GET ADDR OF THE CALLER'S Y02072 29100002
*                                       NEW DEB                  Y02072 29150002
         USING DEBBASIC,RDEB            EST BASE FOR DEB BASIC SECTION  29300021
         BAL   RRETURN,CHECKDEB         BR TO DEB CHECK ROUTINE  Y02072 29350002
*                                       UPON RETURN, REG 1 WILL  Y02072 29400002
*                                       CONTAIN VERIF'D DEB ADDR Y02072 29450002
         TM    DCBCIND2,DCBCNCLO        DID CLOSE ISSUE STOW    XA02388 29452002
         BNO   NOTCLOS2                 CONTINUE IF NOT         XA02388 29454002
         OI    DEBFLGS1,DEBF1CEV        IND EOV ISSUED DURING   XA02388 29456002
*                                       CLOSE                   XA02388 29458002
         SPACE                                                          29460002
NOTCLOS2 EQU   *                                                XA02388 29462002
         LA    RWORK2,DEBBASND(REXTNO)  POINT TO THE NEW EXTENT  Y02072 29500002
*                                       IN THE CALLER'S DEB      Y02072 29650002
         USING DEBACSMD-EXTLNGTH,RWORK2 EST DEB ACCESS METHOD    Y02072 29700002
*                                       SECTION BASE REGISTER    Y02072 29750002
         DROP  RWORK2                   DROP DEB ACCESS METHOD   Y02072 29900002
*                                       SECTION BASE REGISTER    Y02072 29910002
         BAL   RRETURN,FREELOCK         BR TO FREE LOCAL LOCK    Y02072 29950002
*                                       AND RTRN TO CALLER'S KEY Y02072 30000002
         USING DEBDASD,RWORK2           EST DEB DASD SECTION     Y02072 30300002
*                                       BASE REGISTER            Y02072 30350002
         SRL   REXTNO,4                 CALCULATE EXTENT NUMBER  Y02072 30400002
         STC   REXTNO,DCBFDAD           UPDATE EXTENT NO.IN DCB  Y02072 30500002
         MVC   DCBFDAD+1(L'DCBFDAD-2),DEBBINUM  UPDATE BIN, CYLINDER,   30600021
*                                       AND HEAD NUMBERS IN DCB         30700021
         DROP  RWORK2                   DROP DASD SECTION BASE   Y02072 30800002
         SPACE 2                                                        30900021
****                                                                    31000021
****     SINCE THE NEXT RECORD WILL BE WRITTEN ON A NEW TRACK, THE      31100021
****     DCBFDAD FIELD MUST BE UPDATED TO INDICATE RECORD 0 OF THE NEW  31200021
****     TRACK, AND DCBTRBAL MUST BE RESET TO MAXIMUM TRACK CAPACITY.   31300021
****                                                                    31400021
SETRCD0  EQU   *                                                        31500021
         MVI   DCBFDAD+7,RCDZERO        SET RECORD TO ZERO              31600021
         MVC   DCBTRBAL,DVCTRKLN        SET TRACK BALANCE TO MAX.       31700002
         SPACE 2                                                        31800021
****                                                                    31900021
****     CALCULATE AMOUNT OF TRACK WHICH WILL BE USED TO WRITE THE EOD  32000021
****     MARKER AND UPDATE THE DCBTRBAL FIELD.                          32100021
****                                                                    32200021
UPTRKBAL EQU   *                                                        32300021
         SR    RWORK4,RWORK4            CLEAR REGISTER                  32400002
         IC    RWORK4,DVCOVNLB          GET OVERHEAD FOR KEYED RECORD   32500002
*                                       WHICH IS NOT LAST ON TRACK      32600021
         TM    DVCFLAGS,DVC2BOV         USING TWO BYTE OVERHEAD         32700002
         BNO   NOT2BYT2                 NO, CONTINUE OVERHEAD CALC      32800021
         LH    RWORK4,DVCOVHD           GET TWO BYTE OVERHEAD           32900002
         SPACE                                                          33000021
NOT2BYT2 EQU   *                                                        33100021
         LA    RWORK4,1(,RWORK4)        OVERHEAD FOR KEY AND DATA       33200002
*                                       LENGTH OF ZERO                  33300021
         SR    RWORK1,RWORK1            CLEAR REGISTER                  33400021
         IC    RWORK1,DVCOVNK           GET OVERHEAD FOR RECORD KEY     33500002
         SR    RWORK4,RWORK1            SUBTRACT KEY OVERHEAD           33600002
         LH    RWORK1,DCBTRBAL          GET CURRENT TRACK BALANCE       33700021
         SR    RWORK1,RWORK4            CALCULATE NEW BALANCE           33800002
         STH   RWORK1,DCBTRBAL          UPDATE DCBTRBAL FIELD           33900021
         SPACE 2                                                        34000021
****                                                                    34100021
****     UPDATE DCBFDAD FIELD TO POINT TO END OF DATA MARKER.           34200021
****                                                                    34300021
         MVC   IOBSEEK,DCBFDAD          PUT NEW MBBCCHHR IN IOB         34400021
         SR    RWORK1,RWORK1            CLEAR REGISTER                  34500021
         IC    RWORK1,DCBFDAD+7         GET RECORD NUMBER               34600021
         LA    RWORK1,1(,RWORK1)        UPDATE RECORD NUMBER BY ONE     34700021
         STC   RWORK1,DCBFDAD+7         UPDATE DCBFDAD FIELD            34800021
         SPACE 2                                                        34900021
****                                                                    35000021
****     BUILD AND EXECUTE THE CHANNEL PROGRAM TO WRITE THE EOD MARKER. 35100021
****                                                                    35200021
         LM    R9,R14,EODCHPGM          GET SKELETON CHANNEL PROGRAM    35300021
         AR    R9,RAREA                 ESTABLISH SEARCH ADDRESS        35400021
         AR    R11,RAREA                ESTABLISH TIC ADDRESS           35500021
         AR    R13,RAREA                ESTABLISH BUFFER ADDRESS        35600021
         STM   R9,R14,STWWRDCP          CREATE CHANNEL PGM IN WORK AREA 35700021
         ST    R11,IOBSTART             PUT CHANNEL PGM ADDRESS IN IOB  35800021
         USING BUFFER,R13               ESTABLISH BUFFER BASE REGISTER  35900021
         MVC   BUFCCHHR,DCBFDAD+3       MOVE CCHHR TO BUFFER COUNT FLD  36000002
         XC    BUFKDD,BUFKDD            SET KEY AND DATA LENGTH TO ZERO 36100002
         DROP  RDEB                     DROP DEB BASE REIGISTER         36200021
         IC    RWORK1,IOBCSW+3          SAVE HI-ORDER BYTE OF    M0965  36250021
*                                       CSW STATUS FIELD         M0965  36260021
         EXCP  IOBSTDRD                 EXECUTE CHANNEL PROGRAM         36300021
         TM    ECBCC,ECBPOST            DID ECB GET POSTED?    @ZA12202 36400037
         BO    BYWAIT                   BYPASS WAITING ON ECB  @ZA12202 36450037
         WAIT  ECB=ECBCC                WAIT FOR I/O TO COMPLETE        36500037
BYWAIT   EQU   *                        ECB HAS BEEN POSTED    @ZA12202 36550037
         TM    ECBCC,ECBNORM            DID I/O COMPLETE NORMALLY       36600021
         BNO   ERROR                    NO, RETURN TO THE USER          36700021
         STC   RWORK1,IOBCSW+3          RESTORE HI-ORDER BYTE OF M0965  36750021
*                                       CSW STATUS FIELD         M0965  36760021
         SPACE 2                                                        36800021
****                                                                    36900021
****     UPDATE THE DCBRELAD FIELD FOR NEXT MEMBER TO BE WRITTEN.       37000021
****                                                                    37100021
         L     RDEB,DCBDEBAD            RESTORE DEB ADDRESS      Y02072 37200002
         USING DEBBASIC,RDEB            ESTABLISH DEB BASE REGISTER     37300002
         LA    R2,DCBFDAD               GET ADDRESS OF MBBCCHHR         37400021
         L     R15,CVTPRLTV             GET ENTRY PT IN CONVERT ROUTINE 37500021
*                                       TO CONVERT MBBCCHHR TO TTRN     37600021
         BALR  R14,R15                  GO TO CONVERT ROUTINE           37700021
         AH    R0,CON00100              UPDATE TTRN TO NEXT RECORD      37800021
         ST    R0,DCBRELAD              UPDATE DCBRELAD FIELD           37900021
         SPACE 2                                                        38000021
****                                                                    38100021
****     RESTORE THE EXTENT NUMBER IN THE IOBSEEK FIELD TO REFLECT THE  38200021
****     FIRST EXTENT OF THE DATA SET.                                  38300021
****                                                                    38400021
         MVI   IOBM,0                   INDICATE FIRST EXTENT           38500002
         SPACE 2                                                        38600021
****                                                                    38700021
****     IF THE FUNCTION IS ADD OR REPLACE AND THE MEMBER IS NOT AN     38800021
****     ALAIS, RETURN THE TTR OF THE MEMBER TO THE USER.               38900021
****                                                                    39000021
RETRNTTR EQU   *                                                        39100021
         L     RWORK1,STWPARM           GET ADDR OF USER'S PARM AREA    39200021
         USING STOW,RWORK1              ESTABLISH BASE FOR USER'S AREA  39300002
         MVC   STOTTR,STWTTR            RETURN TTR TO USER              39400002
         DROP  RWORK1                   DROP BASE FOR USER'S PARM AREA  39500021
         SPACE 2                                                        39600021
****                                                                    39700021
****     CREATE THE WRITE/READ CHANNEL PROGRAM USED BY THE THIRD LOAD   39800021
****     AND BRANCH TO THE THIRD LOAD TO PROCESS THE USER'S REQUEST.    39900003
****                                                                    40000021
BLDCHPGM EQU   *                                                        40100021
         DROP  RDEB                     DROP DEB BASE REGISTER          40200021
         LM    R9,R2,WRDCHPGM           GET SKELETON OF THE WRITE/READ  40300021
*                                       CHANNEL PROGRAM                 40400021
         AR    R11,RAREA                ESTABLISH TIC ADDRESS           40500021
         STM   R9,R2,STWWRDCP           CREATE WRITE/READ CHANNEL       40600021
*                                       PROGRAM IN STOW'S WORK AREA     40700021
         MVC   STWRCKD4(STWRCKD4-STWRCKD3),WRDRCKD3 SET UP 3RD  YA06505 40750037
*                                       RCKD WHICH WILL READ IN YA06505 40760037
*                                       2ND DIRECTORY BLK       YA06505 40770037
         LR    R10,RAREA                RESTORE WORK AREA REGISTER      40800021
         LR    R11,RDCB                 RESTORE DCB REGISTER            40900021
*                                                                       41200002
         L     R15,V21AB                ADDRESS OF NEXT LOAD   @Z30TSMI 41400003
         BR    R15                      BRANCH TO NEXT LOAD    @Z30TSMI 41450003
         SPACE 2                                                        41500021
****                                                                    41600021
****     FREE THE GOTTEN CORE, PUT THE REASON CODE IN REGISTER 0, THE   41700002
****     RETURN CODE IN REGISTER 15, AND RETURN TO THE CALLER.          41800002
****                                                                    41900021
ERROR    EQU   *                                                        42000021
         FREEMAIN R,LV=CORESIZE,A=(RAREA),SP=229  FREE CORE      Y02072 42300002
         NI    DCBIFLGS,X'FF'-DCBIFEC   TURN OFF ERROR FLAGS     Y02072 42302002
         LA    R0,EODERROR              GET REASON CODE          Y02072 42310002
         LA    R15,IOERROR              IND AN I/O ERROR OCCURED YM0943 42350001
         USING PSA,0                    ESTABLISH PSA BASE REG   Y02072 42370002
         L     RWORK1,PSATOLD           GET ADDR OF CURRENT TCB  Y02072 42380002
         USING TCB,RWORK1               ESTABLISH TCB BASE REG   Y02072 42382002
         L     RWORK1,TCBRBP            GET SVRB ADDRESS         Y02072 42390002
         USING RBSECT,RWORK1            EST SVRB BASE REG        Y02072 42392002
         L     R14,XSAREG14             RESTORE RETURN REGISTER  Y02072 42394002
         DROP  RWORK1                   DROP SVRB BASE REG       Y02072 42396002
         SPACE 2                                                        42398002
****                                                                    42398402
****     MODESET TO KEY 0 AND RETURN TO THE CALLER.                     42398802
****                                                                    42399202
         MODESET EXTKEY=SUPR            MODESET TO KEY 0         Y02072 42399602
         BR    R14                      RETURN TO THE CALLER     Y02072 42400002
         SPACE 2                                                        42450002
*********************************************************************** 42460002
****                                                               **** 42470002
****     THIS SUBROUTINE MODESETS TO KEY 0, OBTAINS THE LOCAL      **** 42480002
****     LOCK, AND USES THE BRANCH ENTRY TO THE DEB CHECK ROUTINE  **** 42490002
****     TO VERIFY THE DEB ADDRESS OBTAINED FROM THE CALLER'S DCB. **** 42492002
****     IF THE DEB CHECK IS NOT SUCCESSFUL A SYSTEM 115 ABEND     **** 42492102
****     WILL BE ISSUED.  OTHERWISE, CONTROL IS RETURNED TO THE    **** 42492202
****     CALLING ROUTINE.                                          **** 42492302
****                                                               **** 42492402
****     INPUT REGISTERS -                                         **** 42492802
****          1       - ADDRESS OF THE DEB TO BE VERIFIED          **** 42493202
****          RRETURN - RETURN ADDRESS TO THE CALLER               **** 42494002
****          RCVT    - ADDRESS OF THE CVT                         **** 42494102
****                                                               **** 42494202
****     OUTPUT REGISTERS -                                        **** 42494302
****          0,2-9 - UNCHANGED                                    **** 42494402
****          1     - ADDRESS OF THE VERIFIED DEB                  **** 42494502
****          10-15 - DESTROYED                                    **** 42495002
****                                                               **** 42495602
*********************************************************************** 42495802
CHECKDEB EQU   *                                                 Y02072 42496002
         MODESET EXTKEY=SUPR            MODESET TO KEY 0         Y02072 42498002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02072X42498402
               RELATED=(DEB,IGG0210A,FREELOCK)                   Y02072 42498802
         L     R10,CVTTCBP              GET ADDR OF TCB PTRS     Y02072 42498902
         L     R10,4(,R10)              GET ADDR OF CURRENT TCB  Y02072 42499002
         L     R15,CVTEXT2              GET ADDR OF CVT EXT 2    Y02072 42499102
         USING CVTXTNT2,R15             EST CVT EXT 2 BASE REG   Y02072 42499202
         L     R15,CVTDEBVR             GET ADDR OF DEB CHECK    Y02072 42499602
         DROP  R15                      DROP CVT EXT 2 BASE REG  Y02072 42501602
         LA    RDEB,0(,RDEB)            CLEAR HI-ORDER BYTE      YM5733 42502002
         BALR  R14,R15                  GO TO DEB CHECK ROUTINE  Y02072 42503602
         BR    RRETURN                  RETURN IF DEB CHECK WAS  Y02072 42505602
         NOPR  0                        SUCCESSFUL               Y02072 42507602
         BAL   RRETURN,FREELOCK         BR TO FREE LOCAL LOCK    Y02072 42509602
         ABEND STOWABCD,,,SYSTEM        ABEND IF DEB CHECK WAS   Y02072X42533202
                                        NOT SUCCESSFUL           Y02072 42543202
         SPACE 2                                                        42553202
*********************************************************************** 42563202
****                                                               **** 42565202
****     THIS SUBROUTINE FREES THE LOCAL LOCK AND MODESETS BACK    **** 42565602
****     TO THE KEY OF THE CALLER.                                 **** 42566002
****                                                               **** 42566102
****     INPUT REGISTERS -                                         **** 42566202
****          RCVT    - ADDRESS OF THE CVT                         **** 42566302
****          RRETURN - RETURN ADDRESS TO THE CALLER               **** 42568302
****                                                               **** 42568702
****     OUTPUT REGISTERS -                                        **** 42569102
****          0-9,15 - UNCHANGED                                   **** 42569502
****          11-14  - DESTROYED                                   **** 42569902
****                                                               **** 42570302
*********************************************************************** 42572302
FREELOCK SETLOCK RELEASE,TYPE=LOCAL,                             Y02072X42577702
               RELATED=(DEB,IGG0210A,GETLOCK)                    Y02072 42587702
         L     RWORK3,CVTTCBP           GET ADDR OF TCB PTRS     Y02072 42588102
         L     RWORK3,4(,RWORK3)        GET ADDR OF CURRENT TCB  Y02072 42588502
         USING TCB,RWORK3               ESTABLISH TCB BASE REG   Y02072 42588602
         MODESET EXTKEY=RBT234,WORKREG=12                        Y02072 42588702
         BR    RRETURN                  RETURN TO CALLING RTN    Y02072 42588802
         DROP  RWORK3                   DROP TCB BASE REGISTER   Y02072 42592502
         EJECT                                                          42596302
*********************************************************************** 42600021
****                                                               **** 42700021
****     SKELETON CHANNEL PROGRAMS                                 **** 42800021
****                                                               **** 42900021
*********************************************************************** 43000021
         SPACE                                                          43100021
WRDCHPGM DS    0F                       THIS CHANNEL PROGRAM IS         43200021
*                                       USED BY IGG021AB FOR WRITING    43300021
*                                       AND READING DIRECTORY BLOCKS    43400021
WRDSRHID DC    X'31'                    SEARCH ID EQUAL                 43500021
         DC    AL3(0)                   POINTER TO SEARCH ARGUMENT      43600021
         DC    X'4000'                  COMMAND CHAINING                43700021
         DC    X'0005'                  NUMBER OF BYTES                 43800021
WRDTIC   DC    X'08'                    TRANSFER CONTROL TO SEARCH ID   43900021
         DC    AL3(STWSRCH2-STWAREA)    ADDRESS OF SEARCH ID            44000021
         DC    XL4'00'                  NOT USED BUT REQUIRED           44100021
WRDWRCKD DC    X'0D'                    WRITE KEY AND DATA              44200021
         DC    AL3(0)                   ADDRESS OF KEY AND DATA         44300021
         DC    X'5000'                  COMMAND CHAIN AND SUPPRESS DATA 44400021
*                                       TRANSFER WHEN CCW IS CHANGED    44500021
*                                       TO A WRITE                      44600021
         DC    X'0108'                  NO. OF BYTES TO BE TRANSFERED   44700021
WRDRCKD1 DC    X'9E'                    READ COUNT, KEY, AND DATA       44800021
         DC    AL3(STWBUF3-STWAREA)     ADDR OF COUNT, KEY, AND DATA    44900021
         DC    X'5000'                  SUPRESS DATA TRANSFER           45000021
         DC    X'0110'                  NO. OF BYTES TO BE TRANSFERED   45100021
WRDRCKD2 DC    X'9E'                    READ COUNT, KEY, AND DATA       45200021
         DC    AL3(STWBUF3-STWAREA)     ADDR OF COUNT, KEY, AND DATA    45300021
         DC    X'0000'                  FLAGS                           45400021
         DC    X'0110'                  NO. OF BYTES TO BE TRANSFERED   45500021
WRDRCKD3 DC    X'9E'                    READ COUNT, KEY, DATA   YA06505 45550037
         DC    AL3(0)                   BUFFER ADDR TO READ CKD YA06505 45560037
         DC    X'0000'                  FLAGS                   YA06505 45570037
         DC    X'0110'                  NO. OF BYTES TRANSFERED YA06505 45580037
         SPACE 2                                                        45600021
EODCHPGM DS    0F                       THIS CHANNEL PROGRAM IS USED TO 45700021
*                                       WRITE THE EOD MARKER FOLLOWING  45800021
*                                       A MEMBER                        45900021
EODSRHID DC    X'31'                    SEARCH ID EQUAL                 46000021
         DC    AL3(IOBSEEK+3-STWAREA)   POINTER TO SEARCH ARGUMENT      46100021
         DC    X'4000'                  COMMAND CHAINING                46200021
         DC    X'0005'                  NUMBER OF BYTES                 46300021
EODTIC   DC    X'08'                    TRANSFER CONTROL TO SEARCH ID   46400021
         DC    AL3(STWSRCH2-STWAREA)    ADDRESS OF SEARCH ID            46500021
         DC    XL4'00'                  NOT USED BUT REQUIRED           46600021
EODWRCKD DC    X'1D'                    WRITE COUNT, KEY, AND DATA      46700021
         DC    AL3(STWBUF3-STWAREA)     ADDRESS OF COUNT FIELD          46800021
         DC    X'0000'                  FLAGS                           46900021
         DC    X'0008'                  NO. OF BYTES TO BE TRANSFERED   47000021
         EJECT                                                          47100021
*********************************************************************** 47200021
****                                                               **** 47300021
****     CONSTANTS                                                 **** 47400021
****                                                               **** 47500021
*********************************************************************** 47600021
         SPACE                                                          47700021
CON10000 DC    F'65536'                 USED TO ADD 1 TO REL TRACK NO.  47800021
CON00100 DC    H'256'                   USED TO ADD 1 TO REL RECORD NO. 47900021
V21AB    DC    V(IGG021AB)              ADDRESS OF NEXT LOAD   @Z30TSMI 47950003
VOLSEQNO DC    X'00010001'              USED TO SET CURRENT AND TOTAL   48000021
*                                       NUMBER OF VOLUMES TO ONE        48100021
         DC    CL8'@ZA31380'            LATEST FLAG            @ZA31380 48100637
         DC    CL8'&SYSDATE'            LATEST DATE            @ZA31380 48101037
PATCH    DC    0XL50'0',C'IGG0210A',42X'0'  50 BYTE PATCH AREA   Y02072 48102002
         EJECT                                                          48400021
*********************************************************************** 48700021
****                                                               **** 48800021
****     CONTROL BLOCK DEFINITIONS                                 **** 48900002
****                                                               **** 49000021
*********************************************************************** 49100021
         SPACE                                                          49200002
         CVT   DSECT=YES                                         Y02072 67000002
         EJECT                                                          67100021
         DCBD  DSORG=PO                                                 67200021
         EJECT                                                          67300021
         IEZDEB                                                         67400021
*                                                                       67450002
*        THE FOLLOWING ARE EQUATES TO BE USED IN THE DEBOPATB           67460002
*        FIELD.  THEY WILL BE REMOVED WHEN THE DEB DSECT IS             67470002
*        UPDATED TO INCLUDE THEM.                                       67480002
*                                                                       67490002
DEBRDBCK EQU   X'01'                    READ BACKWARDS FLAG             67492002
DEBUPDAT EQU   X'04'                    UPDATE FLAG                     67494002
         EJECT                                                          67544002
         IHADVCT                                                        67594002
         EJECT                                                          67644002
         IHAPSA                                                  Y02072 67654002
         EJECT                                                          67664002
         IHARB                                                   Y02072 67694002
         EJECT                                                          67696002
         IHASTOW                                                        67698002
         EJECT                                                          67744002
         IKJTCB                                                  Y02072 67794002
         EJECT                                                          67844002
         IGGSTW                                                  Y02072 67894002
         END                                                            92200000
