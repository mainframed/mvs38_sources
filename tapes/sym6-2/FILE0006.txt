./  ADD  SSI=52840117,NAME=IGG019T2
         TITLE 'IGG019T2-EOB RTN, DA OUTPUT WITH TRK OVFLO,TOTALING'    00030002
         MACRO                                                          00032002
&NAME    IF    &A,&IS=,&ISNOT=,&GOTO=                                   00040018
         LCLB  &NOERR                                                   00060018
&NOERR   SETB  1                                                        00080018
         AIF   ('&A' NE '').SKIP                                        00100018
         MNOTE 'TEST  ADDRESS NOT SPECIFIED.'                           00120018
&NOERR   SETB  0                                                        00140018
.SKIP    AIF   ('&GOTO' NE '').SKIP2                                    00160018
         MNOTE 'BRANCH ADDRESS MISSING.'                                00180018
&NOERR   SETB  0                                                        00200018
.SKIP2   AIF   ('&IS' NE '' OR '&ISNOT' NE '').SKIP3                    00220018
         MNOTE 'TEST CONDITION NOT SPECIFIED.'                          00240018
&NOERR   SETB  0                                                        00260018
.SKIP3   AIF   (&NOERR).SKIP4                                           00280018
         MEXIT                                                          00300018
.SKIP4   AIF   ('&IS' EQ '').NOIS                                       00320018
***                                                                     00340018
&NAME    TM    &A,&IS                                                   00360018
         BO    &GOTO                                                    00380018
***                                                                     00400018
         MEXIT                                                          00420018
.NOIS    ANOP                                                           00440001
***                                                                     00460018
&NAME    TM    &A,&ISNOT                                                00480018
         BZ    &GOTO                                                    00500018
***                                                                     00520018
         MEND                                                           00540018
         EJECT                                                          00550002
IGG019T2 CSECT                                                     UT18 00560018
         SPACE                                                          00562002
*********************************************************************** 00565002
*                                                                     * 00570002
*MODULE NAME = IGG019T2                                               * 00575002
*                                                                     * 00580002
*DESCRIPTIVE NAME = EOB RTN, DA OUTPUT WITH TRK OVFLO, USER TOTALING  * 00585002
*                                                                     * 00590002
*COPYRIGHT = NONE                                                     * 00595002
*                                                                     * 00596002
*                                                                       00600018
*FUNCTION/OPERATION - DETERMINES WHETHER CURRENT RECORD TO BE WRITTEN * 00620018
*   OR READ(F STANDARD) WILL FIT ON CURRENT TRACK. THIS CALCULATION   * 00640018
*   ASSUMES THIS RECORD WILL BE LAST ON TRACK. IF RECORD WILL FIT,    * 00660018
*   SPACE REQUIRED IS RECALCULATED ASSUMING RECORD IS NOT THE LAST.   * 00680018
*   DCBTRACKBALANCE IS REDUCED BY THIS AMOUNT. IF RECORD WILL NOT FIT * 00700018
*   THE NEXT SEQUENTIAL TRACK IS FOUND. IF NONE EXISTS,AN EOV         * 00720018
*   CONDITION IS SIMULATED. FOR STANDARD F THE SEEK ADDRESS IN THE IOB* 00740018
*   IS INCEMENTED BY ONE SINCE SEARCH DIRECT IS USED.                 * 00760018
*                                                                     * 00761002
*CHANGE ACTIVITY = AS FOLLOWS                                         * 00765002
*                                                                     * 00780018
*          RELEASE 19 DELETIONS                                       * 00783018
*          RELEASE 20 DELETIONS                                       * 00786018
*2341094600                                                      A32558 00787020
*2341035400,055600,056600,090000,096200,135200,136600            S20201 00788020
*          RELEASE 21 DELETIONS                                       * 00789018
*          VS2 RELEASE 02 DELETIONS                                   * 00799002
*D143400-143600                                                  Y02072 00801002
*                                                                YM1433 00801402
*                                                                YM4640 00801502
*                                                                XM4343 00803002
* 030700-030900                                                  YM7588 00804002
*                                                                       00806002
*        VS2 RELEASE 04 DELETIONS                                       00806403
*A125920-126192,144520-144640                                  @ZA02255 00806803
*STATUS CHANGE LEVEL 005                                                00807002
*                                                                     * 00809002
* ENTRY POINTS - IGG019T2 FROM ALL GET/PUT/READ/WRITE/MODULES      UT18 00810018
*               LA   2,DCB                                            * 00820018
*               LA   3,IOB                                            * 00840018
*               L    4,DCBOFFSR  OR DCBOFFSW                          * 00860018
*               L    15,76(2)    FOR WRITE(BSAM)                      * 00880002
*               L    15,92(2)    FOR QSAM                             * 00900002
*               BALR 14,15                                            * 00920018
*                                                                     * 00940018
*INPUT - IOB                                                          * 00960003
*         IOB+OFFSET - RECORD LENGTH IN CCW                           * 00980018
*        DCB                                                          * 01000018
*         DCBDVTBL - POINTS TO DEVICE ENTRY IN IECZDTAB               * 01020018
*         DCBDEB AD - DEBADDRESS                                      * 01040018
*         DCBTRBAL - BYTES REMAINING ON TRACK                         * 01060018
*         DCBFDAD  - POINTS TO LAST RECORD READ OR WRITTEN            * 01080018
*         DCBKEYLE - KEYLENGTH - ADDED TO BLKSIZE FOR TOTAL LENGTH    * 01100018
*         DCBCIND1 - VOL.FULL BIT ON - INDICATES PREVIOUS WRITE EOV   * 01120018
*        DEB                                                          * 01140018
*         DEBNMEXT - NUMBER OF EXTENTS IN DEB                         * 01160018
*         DEBOFLGS - X'04' MEANS SPLIT CYL EXTENTS                    * 01180018
*         DEBSTRCC AND DEBSTRHH - STARTING CCHH OF EXTENT             * 01200018
*         BEBENDCC AND DEBENDHH - ENDING CCHH OF EXTENT               * 01220018
*        IECZDTAB - I/O DEVICE TABLE                                  * 01240018
*                   LAST RECORD OV'HD                                 * 01260018
*                   NOT LAST RECORD OV'HD                             * 01280018
*                   KEY OV'HD                                         * 01300018
*                   MAX,TRACK LENGTH                                  * 01320018
*                   TOLERANCE                                         * 01340018
*                                                                     * 01360018
* OUTPUT - ECB - POSTED IN ERROR IF EOV .                               01380018
*        DCBTRBAL - UPDATED REMAING TRACK LENGTH                      * 01400018
*        DCBFDAD - UPDATED RECORD ADDRESS = LAST SEGMENT                01420018
*        IOBSEEK - RECORD ADDRESS = FIRST SEGMENT                       01440018
*        IOB+20   - UNIT EXCEP. IN CSW SET FOR EOV                    * 01460018
*                                                                     * 01480018
* EXTERNAL ROUTINES - SVC 25  ENTERED WITH THE TRACK OVERFLOW BIT IN    01500018
*                     DCBCIND2 SET- PURPOSE IS TO ERASE TO EOE.         01520018
*                                                                     * 01540018
*                    IF THE USER SPECIFIES THE USER TOTALING FACILIUT18 01550018
*                    (OPTCD=T) THEN IGG019AX WILL BE ACCESSED VIA AUT18 01560018
*                    'BALR R9,R10'                                 UT18 01570018
*EXITS/NORMAL - RETURN TO GET/PUT/WRITE/READ ROUTINE ON REG.14 AFTER  * 01580018
*               SCHEDULING I/O,OR POSTING ECB COMPLETE,ERROR IF EOV   * 01600018
*                                                                     * 01620018
*EXITS/ERROR - ABEND - CODE 002 - ISSUED VIA -                        * 01640002
*          1. DMABCOND 254 IF THE RECORD SIZE EXCEEDS 32,760 BYTES.   * 01660002
*          2. DMABCOND 204 IF THE BLOCKSIZE IN THE BDW OR THE DECB IS * 01670002
*             GREATER THAN THE BLOCKSIZE IN THE DCB.                  * 01672002
*                                                                     * 01680018
*TABLES/WORK AREAS - ASSUMES USER REGS.2-8 SAVED.SAVES REGS.9-10 INTO * 01700018
*                    SAVE AREA + 64                                     01720018
*                                                                     * 01740018
*ATTRIBUTES - READONLY,REENTRANT,REUSABLE                             * 01760018
*                                                                     * 01765002
*NOTES = SEE BELOW                                                    * 01770002
*                                                                     * 01775002
*     PATCH LABEL = PATCH A DC STATEMENT                              * 01776002
*                                                                     * 01777002
*********************************************************************** 01777402
         EJECT                                                          01778002
* REGISTER NAMES AND USAGE.                                             01780018
*                                                                       01800018
RALPHA   EQU   0                        WORK REG. ALPHA MAY NOT BE USED 01820018
*                                       AS AN ADDRESS REG.              01840018
R1       EQU   1                        THE NAME PRESERVES IDENTITY.    01860018
RDEB     EQU   1                        DEB ADDRESS LOADED IN THIS RTN. 01880018
RDCB     EQU   2                        HOLDS DCB ADDRESS UPON ENTRY.   01890002
RIOB     EQU   3                        HOLDS IOB ADDRESS UPON ENTRY.   01892002
RGAMMA   EQU   4                        WORK REG.                       01900018
RSTEPPER EQU   5                        STEPS THRU COUNT FLD AND S.A.'S 01940002
RCPBASE  EQU   6                        CP SEGMENT BASE REG.            01980002
ROFFSW   EQU   7                        HOLDS WRITE CCW OFFSET ON ENTRY 02060018
*              BUT WILL BE CLOBBERED, AND RESTORED FROM DCB PROIR TO    02080018
*              EXIT.  REG MUST BE X-PARENT FOR QSAM.                    02100018
ROVFLO   EQU   ROFFSW                   CCW OFFSET KNOWN. OVFLO =       02120018
*                                       LENGTH REMAINING TO BE WRITTEN. 02140018
DONTUSE8 EQU   8                        NOT SAVED. HOLDS USER CONTENTS. 02150002
RBETA    EQU   9                        SAVED FIRST, USED AS WORK REG.  02160018
RDEVTAB  EQU   10                       SAVED FIRST, DEVTABLE ADDRESS   02180018
*                                       LOADED.                         02200018
OR11     EQU   11                       NOT SAVED. HOLDS USER CONTENTS. 02210002
OR12     EQU   12                       NOT SAVED. HOLDS USER CONTENTS. 02212002
RSAVE    EQU   13                       USERS REGISTER SAVE AREA.       02220018
RRETN    EQU   14                       RETURN TO BSAM/QSAM RTN.        02240018
RBASE    EQU   15                       ENTRY-POINT/BASE REG.           02260018
         EJECT                                                          02280002
UNITEXC  EQU   X'01'                    SETS IOBFLAG3.                  02290002
COMPWERR EQU   X'42'                    END OF EXTENT CONDITION HAS     02420018
*                                       BEEN ENCOUNTERED.               02440018
CPSEGLEN EQU   32                       LENGTH OF ONE CP SEGMENT.       02460018
D0       EQU   0                        DISPLACEMENT OF ZERO     S20201 02462020
TBOVHD   EQU   X'08'                    TWO BYTE OVHD INDICATOR  S20201 02476020
EIGHT    EQU   8                        LENGTH OF A COUNT FIELD         02480018
RLTV     EQU   32                       VECTOR OFFSET IN CVT.           02500018
CNVT     EQU   28                       VECTOR OFFSET IN CVT.           02520018
ZERO     EQU   0                        G.P. CONSTANT.                  02540018
TRKOVFLO EQU   X'80'                    T.O. INDICATOR IN DCBCIND1      02560018
NOERROR  EQU   X'7F'                    ECB MASK. ALL BITS ON = NOERROR 02580018
ANYZERO  EQU   14                       MASK FOR TESTING ANY SELECTED   02600018
*                                       BITS = ZERO.                    02620018
ONES     EQU   X'FF'                    G.P. CONSTANT.                  02640018
VOLFULL  EQU   X'20'                                                    02660018
IOBSIZE  EQU   48                       STANDARD IOB + BSAM/QSAM EXTEN. 02680018
VALCHK   EQU   X'80'                    WRITE VALIDITY CHECK BIT IN     02700018
*                                       DCBOPTCD.                       02720018
SPLIT    EQU   X'04'                                                    02740018
* COMMAND CODES FOR THE 2841 C.U.                                       02760018
*                                                                       02780018
SEEKCYL  EQU   X'0B'                    CYLINDER SEEK.                  02800018
SRCHEQMT EQU   X'B1'                    SEARCH EQ ID IN MULTI-TRACK.    02820018
WCKD     EQU   X'1D'                    WRITE COUNT, KEY AND DATA.      02840018
WSCKD    EQU   1                        WRITE SPECIAL OP CODE.          02860018
SETSC    EQU   X'23'                    SET SECTOR COMMAND       S20201 02862020
RDSC     EQU   X'22'                    READ SECTOR COMMAND      S20201 02864020
*                                                                       02872020
* CCW FLAGS                                                             02880018
CC       EQU   X'40'                    COMMAND CHAIN.                  02900018
*                                                                       02920018
R0       EQU   0                        PARAMETRIC ZERO            UT18 02922018
R3       EQU   3                        WORK REG                   UT18 02926018
R4       EQU   4                        PARAMETRIC FOUR            UT18 02928018
R6       EQU   6                        WORK REG                   UT18 02930018
R9       EQU   9                        PARAMETRIC NINE            UT18 02932018
R10      EQU   10                       PARAMETRIC TEN             UT18 02934018
R13      EQU   13                       PARAMETRIC 13              UT18 02936018
R15      EQU   15                       WORK REG                   UT18 02938018
THREE6   EQU   36                       PARAMETRIC 36              UT18 02942018
UTFBIT   EQU   X'02'                    MASK FOR USER TOTALING TESTUT18 02944018
         EJECT                                                          02947202
         USING IGG019T2,RBASE           ESTABLISH BASE REGISTER         02948018
         USING SAMSIOB,RIOB                                             02960018
         USING IHADCB,RDCB                                              02980018
         B     BEGIN                   BRANCH AROUND MODULE ID   YM4640 02980102
         DC    C'IGG019T2'             MODULE NAME               YM4640 02980202
         DC    C' YM7588 '             LAST SHIP CODE            YM7588 02980302
         DC    C'02/19/74'             LAST SHIP DATE            YM7588 02980402
BEGIN    DS    0H                      END OF MODULE ID          YM4640 02980502
*******************************************************************UT18 03002018
         L     RDEB,DCBDEBAD            GET THE DEB BASE ADDR.     UT18 03004018
         USING DEBB,RDEB                ESTABLISH BASEREG FOR DEB  UT18 03004402
         STM   RBETA,RDEVTAB,64(R13)    STORE REGS 9,10            UT18 03006018
         TM    DCBOPTCD,UTFBIT          TEST FOR USER TOTALING     UT18 03008018
         BZ    CONTINUE                 NOT SPECIFIED - SO BRANCH  UT18 03010018
*                                                                  UT18 03012018
         SR    R9,R9                    CLEAR THIS REGISTER        UT18 03014018
         SR    R10,R10                  CLEAR THIS REGISTER        UT18 03016018
         IC    R9,DEBNMEXT              GET NO OF EXTENTS          UT18 03018018
          IC   R10,DEBEXSCL             GET DEB EXTENT SCALE       UT18 03020018
         SLL   R9,ZERO(R10)             MULT TO GET LEN OF DEV DEP UT18 03022018
         L     R15,THREE6(RDEB,R9)      GET SAVE AREA ADDR         UT18 03024018
*                                                                  UT18 03026018
*  DEBR POINTS TO BEG. OF DEB +32 POINTS TO DEV DEP SECTION, R9    UT18 03028018
*        CONTAINS LEN OF DEV DEP SECTION, +4 POINTS TO SAVE AREA   UT18 03030018
*        POINTER.  SO R10 CONTAINS SAVE AREA ADDR                  UT18 03032018
*                                                                  UT18 03034018
         USING TOTSAVWA,R15             ESTAB BASE FOR TOT WRKAREA UT18 03036018
         STM   R3,R6,TOTREGSV           SAVE REGS FOR SAVE RTN     UT18 03038018
         L     R4,TOTSVPTR              GET ADDR OF SAVE ROUTINE   UT18 03040018
         BALR  R3,R4                    GO TO SAVE ROUTINE         UT18 03042018
         LM    R3,R6,TOTREGSV           RESTORE REGISTERS          UT18 03044018
*                                                                  UT18 03046018
CONTINUE EQU   *                                                   UT18 03048018
         BALR  R15,R0                   SET NEW BASE               UT18 03050018
         USING NEWBASE,R15              RE-ESTAB MODULE BASE REG   UT18 03052018
NEWBASE  EQU   *                                                   UT18 03054018
*******************************************************************UT18 03056018
         IF    DCBCIND1,IS=VOLFULL,GOTO=POSTECB                         03060018
         SR    RCPBASE,RCPBASE                                          03100018
         IC    RCPBASE,DCBWCPO          BUILD WRITE CHANNEL PGM         03120018
         AR    RCPBASE,RIOB             ADDRESSABILITY.                 03140018
         USING WCPMAP,RCPBASE                                           03160018
* WORK REG SIGMA IS IN USE AS 'RCPBASE'.                                03180018
         SR    RSTEPPER,RSTEPPER                                        03200018
         IC    RSTEPPER,DCBWCPL         NUMBER OF CCW'S BETWEEN IOB AND 03220018
*                                       FIRST COUNT FIELD.              03240018
         SLL   RSTEPPER,3               DBL WDS TO BYTES.               03260018
*                                                                       03280018
         AR    RSTEPPER,RCPBASE         CP START ADDR + ITS LENGTH      03300018
*                                       GIVES ADDRESSABILITY FOR COUNT  03320018
*                                       FIELDS AND S.A.'S. (THEY ARE    03340018
*                                       INTERLEAVED, WITH A COUNT FIELD 03360018
*                                       BEING FIRST, EACH IS A DBL WD). 03380018
         USING COUNTFLD,RSTEPPER                                        03400018
* WORK REG DELTA IS IN USE AS 'RSTEPPER'.                               03420018
         L     RDEVTAB,DCBDVTBL         ADDRESS OF DEV TABLE ENTRY FOR  03440018
*                                       THIS UNIT.                      03460018
         USING DEVTAB,RDEVTAB                                           03480018
*                                                                       03500018
         L     RDEB,DCBDEBAD            DEB ADDRESSABILITY.             03520018
*                                                                       03524020
* CHECK FOR RCD READY FEATURE BEING USED AND IF NOT ADJUST              03528020
* RCPBASE, IF YES, UPDATE SECTOR VALUE                                  03532020
*                                                                       03536020
         CLI   CHANPGM,SETSC            RCD READY CHP            S20201 03540020
         BNE   NOFET3                   BRANCH IF NO             S20201 03544020
         AH    RCPBASE,ATE8             ADJUST RCPBASE FOR RCD   S20201 03548020
*                                       READY FEAT                      03552020
NOFET3   EQU   *                                                 S20201 03556020
*                                                                       03560018
         L     ROVFLO,DATALEN-2         GET COMPOSITE KL+DL FROM CCW.   03580018
         LA    ROVFLO,0(ROVFLO)         CLEAR OUT THE FLAGS.            03600018
         LR    RBETA,ROVFLO             TEMP WORK REG.                  03620018
         SR    RALPHA,RALPHA                                            03640018
         IC    RALPHA,DCBKEYLE          TO REMOVE KL FROM KL+DL.        03660018
         SR    RBETA,RALPHA             BETA=DL.                        03680018
         CH    RBETA,DCBBLKSI           ABEND IF RECORD LENGTH          03700018
         BH    ERREXIT1                 GREATER THAN BLKSIZE.    Y02072 03720002
         LA    RBETA,7(RBETA)           MAKES POSSIBLE AN LTR FOR       03740018
*                                       DL GT 32760.                    03760018
         SLL   RBETA,16                 ALIGN FOR SIGN TEST.            03780018
         LTR   RBETA,RBETA              DL+7 MUST BE LESS THAN 32768.   03800018
         BM    ERREXIT2                 BRANCH IF DL GT 32760    Y02072 03820002
*                                                                       03840018
         LA    RALPHA,2                 LENGTH OF CCW LENGTH FIELD.     03860018
         LR    RBETA,RSTEPPER           COPY REG.                       03880018
         CLI   CHANPGM,SETSC            RCD READY CHP            S20201 03882020
         BNE   NOFET4                   BRANCH IF NO             S20201 03884020
         TM    DCBOPTCD,VALCHK          VALIDITY CHK USED        S20201 03886020
         BO    NOFET4                   BRANCH IF YES            S20201 03888020
         AH    RALPHA,ATE8              INCREMENT FOR RD SECTOR  S20201 03890020
NOFET4   EQU   *                                                 S20201 03892020
         SR    RBETA,RALPHA             BETA POINTS TO THE LAST CCW     03900018
*                                       LENGTH FIELD. (MAY OR MAY NOT   03920018
*                                       BE THE WRITE VALIDITY CHECK     03940018
*                                       SEGMENT).                       03960018
*                                                                       03980018
         STH   ROVFLO,0(RBETA)          USING THE LAST CCW LENGTH TO    04000018
*                                       SAVE THE OVFLO AMOUNT. USED TO  04020018
*                                       RECOVER AFTER GETTING A NEW     04040018
*                                       EXTENT,  IS ALSO  THE WRITE     04060018
*                                       VALIDITY CHECK LENGTH IF THE    04080018
*                                       VAL CHK CP EXISTS.              04100018
         MVC   TEMPSAVE(2),DCBTRBAL     PRESERVE THE ORIGINAL TRK BAL.  04120018
*                                       WILL BE RESTORED IF A RECORD    04140018
*                                       CANNOT BE WRITTEN.              04160018
SETFDAD  MVC   IOBFDAD(8),DCBFDAD       COPY FDAD INTO IOB.             04180018
RUPBY1   IC    RBETA,DCBFDAD+7          GET 'R'.                        04200018
         LA    RBETA,1(RBETA)           R=R+1.                          04220018
         STC   RBETA,DCBFDAD+7          PUT IT BACK.                    04240018
*                                                                       04260018
         MVC   CYLINDER(5),DCBFDAD+3    INITIALIZE THE ID PART OF THE   04280018
*                                       FIRST COUNT FIELD.              04300018
*                                                                       04320018
* END OF FIRST TIME LOGIC.                                              04340018
*                                                                       04360018
* BEGIN LOOP LOGIC.                                                     04380018
*                                                                       04400018
* CALCULATE THE SPACE REQUIRED TO WRITE THE DATA AS A LAST RECORD.      04420018
*                                                                       04440018
STRTLOOP SR    RBETA,RBETA                                              04460018
         SR    RALPHA,RALPHA                                            04480018
         IC    RBETA,OVERL              L = OVHD FOR LAST RECORD.       04500018
         TM    DEVFLAG,TBOVHD           TWO BYTE OVHD USED       S20201 04504020
         BNO   MZ0010                   BRANCH NO                S20201 04508020
         LH    RBETA,OVERI              GET TWO BYTE OVHD        S20201 04512020
MZ0010   EQU   *                                                 S20201 04516020
         IC    RALPHA,DCBKEYCN          KEYCN = EITHER 0 OR K (IF OR    04520018
*                                       IF NOT KEYS, RESPECTIVELY).     04540018
         LR    RGAMMA,ROVFLO            COPY THE AMOUNT REMAINING TO    04560018
*                                       BE WRITTEN (OVERFLOW).          04580018
         AR    RGAMMA,RBETA             OVFLO+L                         04600018
         SR    RGAMMA,RALPHA            OVFLO+L-KEYCN IS THE SPACE FOR  04620018
*                                       A LAST RECORD.                  04640018
*                                                                       04660018
         CH    RGAMMA,DCBTRBAL          WILL THIS TRACK HOLD THE RECORD 04680018
         BNH   FINAL                    YES. BRANCH TO DO FINAL LOGIC   04700018
*                                       FOR THE LAST CP SEGMENT.        04720018
*                                                                       04740018
* RECORD WILL NOT FIT AS A LAST RECORD. CALCULATE HOW MUCH WILL FIT AND 04760018
* TAILOR THE CURRENT CP SEGMENT TO WRITE THAT AMOUNT. AT LEAST ONE MORE 04780018
* RECORD SEGMENT WILL BE WRITTEN AFTER THIS ONE.                        04800018
* CCWLENGTH=TRBAL+KEYCN-L IS AMOUNT THAT WILL FIT.                      04820018
         LH    RGAMMA,DCBTRBAL          GET TRACK BAL.                  04840018
         AR    RGAMMA,RALPHA            TRBAL+KEYCN.                    04860018
         SR    RGAMMA,RBETA             TRBAL+KEYCN-L IN GAMMA.         04880018
MIDLOOP  MVC   DCBTRBAL,TRKCAP          RESET TRBAL TO DEVICE MAX.      04900018
         NI    TRACKFUL,ZERO            HOUSEKEEP TRACK FULL SWITCH.    04920018
         LTR   RGAMMA,RGAMMA            SEE IF ANY DATA CAN BE WRITTEN. 04940018
         BP    WILLFIT                  BRANCH IF ROOM FOR DATA.        04960018
         OI    TRACKFUL,ONES            SET TRACK FULL SWITCH. OCCURS   04980018
*                                       ONLY IF FIRST TRACK HAS NO ROOM 05000018
*                                       FOR DATA. ACTION REQ'D IS TO    05020018
*                                       ADVANCE TO NEXT TRACK.          05040018
         B     CONVERT                  NO ROOM FOR DATA. OVERHEAD      05060018
*                                       EXCEEDS TRK BAL.  GET A NEW     05080018
*                                       TRACK.                          05100018
WILLFIT  SR    ROVFLO,RGAMMA            REDUCE THE OVFLO FIGURE BY THE  05120018
*                                       CURRENT TRACK LENGTH.           05140018
*                                                                       05160018
         MVI   WRTOPCD,WSCKD            WRITE SPECIAL BECAUSE THIS IS   05180018
*                                       NOT THE LAST SEGMENT.           05200018
         MVI   NULLFLAG,CC              COMMAND CHAIN TO NEXT SEGMENT.  05220018
         STH   RGAMMA,DATALEN           PUT SEGMENT LENGTH IN WRT CCW.  05240018
         SR    RALPHA,RALPHA                                            05260018
         IC    RALPHA,KEYLENTH          KEY LENGTH FROM COUNT FIELD.    05280018
         SR    RGAMMA,RALPHA            DATA LEN= SEG LEN - KL.         05300018
         STH   RGAMMA,DLDL              PUT IT IN COUNT FLD DATA LENGTH 05320018
         AR    RGAMMA,RALPHA            RECONSTRUCT SEGMENT LENGTH.     05340018
*                                                                       05360018
         L     RBETA,DATAADDR           GET THE DATA ADDRESS            05380018
         LA    RBETA,0(RBETA)           CLEAR HI BYTE.                  05400018
         AR    RGAMMA,RBETA             ADDRESS+LENGTH=NEXT ADDRESS.    05420018
*                                                                       05440018
         LA    RCPBASE,CPSEGLEN(RCPBASE) ADVANCE CP BASE TO NEXT SEG.   05460018
         LA    RSTEPPER,EIGHT(RSTEPPER)  POINTS TO S.A. THE 'CCHHR' OF  05480018
*                                       THE COUNTFLD DSECT IS VALID.    05500018
         ST    RGAMMA,DATAADDR          THIS DATA ADDRESS = LAST + LEN. 05520018
         MVI   SRCHOPCD,SRCHEQMT        OP CODE SET FOR MULTI-TRACK     05540018
*                                                                       05548020
         CLI   CHANPGM,SETSC            RCD READY CHANNEL PROG   S20201 05556020
         BE    FEATX                    BRANCH IF YES            S20201 05564020
*                                                                       05572020
*                                                                       05580018
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=CONVERT                       05600018
* RECONSTRUCT THE FIRST CCW SEARCH ADDRESS. REASON- IT MAY HAVE BEEN    05620018
* CHANGED TO A TIC TO WRT CHK CP ON A PREVIOUS USE.                     05640018
*                                                                       05650020
FEATX    EQU   *                                                 S20201 05660020
*                                                                       05670020
         MVC   SRCHADDR+1(3),PARASITE+1 THE CORRECT SEARCH ADDRESS HAS  05680018
*                                       BEEN A PARASITE IN THE TIC CCW. 05700018
*                                                                       05720018
CONVERT  EQU   *                                                        05740018
* THE DCB FULL DISK ADDRESS MUST BE UPDATED TO THE ADDRESS OF THE NEXT  05760018
* TRACK, ON WHICH THE NEXT RECORD SEGMENT WILL BE WRITTEN. THE NEXT     05780018
* TRACK MAY BE ACCROSS A CYLINDER BOUNDARY, SO THE DISK ADDRESS IS      05800018
* UPDATED IN THE TTR FORM. THE CONVERT ROUTINE ALSO PROVIDES VALIDITY   05820018
* CHECKING OF THE NEW FDAD.                                             05840018
*                                                                       05860018
         LA    RGAMMA,FDADTTR           THIS IS A CONCEALED ENTRY TO A  05880018
*                                       CLOSED SUBROUTINE.              05900018
*********************************************************************** 05920018
*        THE FOLLOWING ROUTINE WILL DETERMINE THE NEXT TRACK ADDRESS. * 05940018
*        BY ADDING 1 TO THE CURRENT TT AND SENDING THIS VALUE TO THE  * 05960018
*      RESIDENT CONVERT ROUTINE, THE NEXT TRACK WILL BE DETERMINED. IF* 05980018
*      THE NUMBER OF TRACKS IN THE DEB ARE EXCEEDED, THE CONVERT ROU- * 06000018
*      TINE WILL PASS A RETURN CODE OF 4 IN REGISTER 15               * 06020018
*                                                                     * 06040018
*        REGISTER CONTENTS PRIOR TO BRANCHING TO THE CONVERT ROUTINES * 06060018
*      ARE:                                                           * 06080018
*        R0 ---NEXT TTR RETURNED BY IECPRTLV OR TTRN IF GOING TO THE  * 06100018
*              IECPCNVT ROUTINE. (TTR TO MBBCCHHR)                    * 06120018
*        R1 ---ADDRESS OF DEB                                         * 06140018
*        R2 ---ADDRESS OF USER MBBCCHHR                               * 06160018
*        R3 ---BASE REGISTER OF THIS MODULE                           * 06180018
*        R4 ---RETURN TO USER                                         * 06200018
*        R5 ---USER (11)                                              * 06220018
*        R6 ---USER (12)                                              * 06240018
*        R7 ---ADDRESS OF SAVE AREA                                   * 06260018
*        R8 ---TEMPORARY STORAGE OF TTRN FOR SPLIT CYLINDER USE.        06280018
*              R9 ---REGS 9 - 13 ARE                                    06300018
*        R10---USED           VO                                      * 06320018
*        R11--- BY              LA                                    * 06340018
*        R12---  CONVERT          TI                                  * 06360018
*        R13---   ROUTINES               LE                           * 06380018
*                                                                     * 06400018
*        R14---RETURN FOR CONVERT ROUTINE                             * 06420018
*              R15---ENTRY/ERROR CODE REG.                              06440018
*                                                                     * 06460018
*                                                                       06480018
*                                                                       06500018
*                                                                       06520018
*                                                                       06540018
*              IECPRLTV -ENTRY TO ROUTINE VIA A BALR THAT CONVERTS AN   06560018
*                        ABSOLUTE DIRECT ACCESS ADDRESS, MBBCCHHR, INTO 06580018
*                        ITS RELATIVE EQUIVALENT, TTR0. REGISTER        06600018
*                        CONVENTIONS UPON ENTRY AND UPON EXIT ARE AS    06620018
*                        FOLLOWS--                                      06640018
*                                                                       06660018
*                           REGISTER         ENTRY             EXIT     06680018
*                             0          IGNORED            TTR0 RESULT 06700018
*                             1          DEB ADDRESS        TRANSPARENT 06720018
*                             2          ADDRESS OF         TRANSPARENT 06740018
*                                          MBBCCHHR IN CORE             06760018
*                             3-8        IGNORED            TRANSPARENT 06780018
*                             9-13       IGNORED            DESTROYED   06800018
*                             14         RETURN ADDRESS     TRANSPARENT 06820018
*                             15         ENTRY ADDRESS      ZERO        06840018
*                                                                       06860018
*              IECPCNVT -ENTRY TO ROUTINE VIA A BALR THAT CONVERTS A    06880018
*                        RELATIVE DIRECT ACCESS ADDRESS AND             06900018
*                        CONCATENATION NUMBER, TTRN, INTO ITS ABSOLUTE  06920018
*                        EQUIVALENT, MBBCCHHR. REGISTER CONVENTIONS     06940018
*                        UPON ENTRY AND UPON EXIT ARE AS FOLLOWS--      06960018
*                                                                       06980018
*                           REGISTER         ENTRY             EXIT     07000018
*                             0          ACTUAL TTRN        DESTROYED   07020018
*                             1          DEB ADDRESS        TRANSPARENT 07040018
*                             2          ADDRESS OF 8 BYTE  TRANSPARENT 07060018
*                                          AREA FOR MBBCCHHR            07080018
*                             3-8        IGNORED            TRANSPARENT 07100018
*                             9-13       IGNORED            DESTROYED   07120018
*                             14         RETURN ADDRESS     TRANSPARENT 07140018
*                             15         ENTRY ADDRESS      ERROR CODE  07160018
*                                                                       07180018
*                        THE ERROR CODE FOR IECPCNVT WILL BE 0 FOR      07200018
*                        SUCCESSFUL CONVERSION, OR 4 IF VALUE OF TT     07220018
*                        EXCEEDS TOTAL EXTENTS ASSIGNED.                07240018
*                                                                       07260018
*                                                                     * 07280018
*********************************************************************** 07300018
*                                                                       07320018
REGMANIP EQU   *                        START OF A CLOSED SUBROUTINE    07340018
*                                       FOR REGISTER MAINIPULATION.     07360018
* THE FOLLOWING REGISTER MANIPULATIONS ARE REQUIRED IN ORDER TO USE     07380018
* THE CONVERT ROUTINES.                                                 07400018
* THE CURRENT CP SEGMENT S.A. AND COUNT FIELD (2 CONTIG. DBL WDS)       07420018
* PROVIDE A CONVENIENT PLACE TO SAVE SOME REGS. RSTEPPER HAS THIS ADDR. 07440018
*                                                                       07460018
         STM   RCPBASE,DONTUSE8,0(RSTEPPER)  SAVE REGS 6,7,8. HI BYTE   07480018
*                                            OF REG 7 MUST BE ZERO FOR  07500018
*                                            IT OVERLAYS R=0 OF THE SA. 07520018
         LR    DONTUSE8,RSTEPPER        REG 8 IS TRANSPARENT ACCROSS    07540018
*                                       CONVERT, CAN HOLD S.A. ADDRESS. 07560018
*                                       USERS CONTENTS OF 8 ARE SAVED   07580018
*                                       THERE.                          07600018
* MOVE USERS REGS 11, 12, 13, 14, AND EOB BASE 15, TO 5,6,7,4,3 RESPEC- 07620018
* TIVELY.                                                               07640018
         LR    RSTEPPER,OR11            11 TO 5.                        07660018
         LR    RCPBASE,OR12             12 TO 6.                        07680018
         LR    ROVFLO,RSAVE             13 TO 7.                        07700018
         LR    RSAVE,RGAMMA             SAVE THIS ROUTINE'S RETURN REG. 07720018
         LR    RGAMMA,RRETN             14 TO 4.                        07740018
         LR    RIOB,RBASE               15 TO 3.                        07760018
         DROP  RBASE                                                    07780018
         DROP  RIOB                                                     07800018
         USING NEWBASE,RIOB             ESTABLISH TEMP BASE REG    UT18 07820018
         LA    RDCB,DCBFDAD             POINT TO M OF FDAD.             07840018
         USING DCBFDAD,RDCB                                             07860018
         BR    RSAVE                    RETURN TO CALLER OF 'REGMANIP'. 07880018
FDADTTR  EQU   *                                                        07900018
         L     RBASE,16                 GET  CVT ADDRESS                07920018
         L     RBASE,RLTV(RBASE)        GET IECPRLTV ENTRY POINT.       07940018
         BALR  RRETN,RBASE              GO TO CONVERT MBBCCHHR TO TTR.  07960018
* ON RETURN, REG 0 HAS THE TTR, LEFT ADJUSTED.                          07980018
         SRL   RALPHA,16               TRUNCATE 'RZ' OF 'TTRZ'.         08000018
         AH    RALPHA,ONE               TT=TT+1.                        08020018
         L     RBETA,DCBIOBA            TEMPORARY IOB ADDRESSABILITY.   08040018
         USING SAMSIOB,RBETA                                            08060018
         STH   RALPHA,TTSAVE            SAVE TT FOR USE IN SPLIT TESTS. 08080018
         DROP  RBETA                                                    08100018
TTRFDAD  EQU   *                                                        08120018
         SLL   RALPHA,16               RE-ALIGN TO 'TT00'.              08140018
         L     RBASE,16                 GET CVT ADDR.                   08160018
         L     RBASE,CNVT(RBASE)        GET IECPCNVT ENTRY POINT.       08180018
         BALR  RRETN,RBASE              GO TO CONVERT TTR TO MBBCCHHR.  08200018
* ON RETURN, REG 15 HAS THE RETURN CODE.                                08220018
         LR    RALPHA,RBASE             SAVE THE RETURN CODE FOR LATER  08240018
*                                       INSPECTION.                     08260018
* REGISTER RECONSTRUCTION - PUT THEM BACK AS THEY WERE BEFORE CONVER-   08280018
* SION.                                                                 08300018
* MOVE REGS 5,6,7,4,3 BACK TO 11,12,13,14,15                            08320018
         LR    OR11,RSTEPPER            5 TO 11.                        08340018
         LR    OR12,RCPBASE             6 TO 12.                        08360018
         LR    RSAVE,ROVFLO             7 TO 13.                        08380018
         LR    RRETN,RGAMMA             4 TO 14.                        08400018
         LR    RBASE,RIOB               3 TO 15.                        08420018
*                                                                       08440018
         USING NEWBASE,RBASE            RE-ESTABLISH BASE REG      UT18 08460018
*                                                                       08480018
         LR    RSTEPPER,DONTUSE8        RESTORE REG # 5 FROM XPARENT 8. 08500018
         LM    RCPBASE,DONTUSE8,0(RSTEPPER) RESTORE 6,7,8.              08520018
         USING WCPMAP,RCPBASE                                           08540018
*                                                                       08560018
         LA    RBETA,5                  OFFSET OF DCBFDAD.              08580018
         SR    RDCB,RBETA               DCB ADDRESSABILITY REGAINED.    08600018
         USING IHADCB,RDCB                                              08620018
*                                                                       08640018
         L     RIOB,DCBIOBA             IOB ADDRESSABILITY REGAINED.    08660018
         USING SAMSIOB,RIOB                                             08680018
*                                                                       08700018
         L     RDEVTAB,DCBDVTBL         DEV TABLE ADDR. REGAINED.       08720018
         USING DEVTAB,RDEVTAB                                           08740018
*                                                                       08760018
* REGISTERS RECONSTRUCTED. ALPHA, BETA, GAMMA HAVE BEEN USED.           08780018
* RETURN CODE WAS SAVED IN ALPHA. TEST IT FOR VALID FDAD.               08800018
*                                                                       08820018
         LTR   RALPHA,RALPHA            COMPARE CODE TO ZERO.           08840018
         BZ    TSTSPLIT                 BRANCH IF ZERO. CODE INDICATES  08860018
*                                       A VALID FDAD, WITHIN THIS EXT.  08880018
* THE RETURN CODE NOT-ZERO INDICATES THE FDAD WAS OUTSIDE THIS EXTENT.  08900018
* ACTION REQUIRED IS TO ISSUE SVC 25, WHICH WILL USE THE CP PORTION     08920018
* THAT HAS BEEN CONSTRUCTED TO ERASE THE UNUSED REMAINDER OF THIS EX-   08940018
* TENT. AFTER RETURN FROM SVC 25, WILL REPAIR THE CP FOR RESTART BY EOV 08960018
ERASE    EQU   *                        ERASE THE CURRENT EXTENT.       08980018
         IF    TRACKFUL,IS=ONES,GOTO=CHECKEXT                      000D 09010018
*                                                                       09020018
         LA    RBETA,CPSEGLEN           RECOVER ADDRESSABILITY FOR THE  09040018
         SR    RCPBASE,RBETA            LAST WCP SEGMENT THAT FITS ON   09060018
*                                       THIS EXTENT.                    09080018
         MVI   NULLFLAG,ZERO            TERMINATE CP.                   09100018
         L     RBETA,COUNTADR           GET ADDRESS OF THE LAST COUNT   09120018
*                                       FIELD MADE UP.                  09140018
         MVC   DCBFDAD+3(5),0(RBETA)    RECONSTRUCT THE DCBFDAD TO      09160018
*                                       POINT TO LAST SEGMENT TO BE     09180018
*                                       ERASED. MAKES CORRECT STARTING  09200018
*                                       POINT IF ANOTHER EXTENT (SAY A  09220018
*                                       DISCONTIGUOUS PRIMARY) IS AVAIL 09240018
*                                       ABLE. ALSO NEEDED FOR SVC 25    09260018
*                                       INTERFACE.                      09280018
         MVC   DCBFDAD(1),IOBFDAD       KEEPS 'M' IN STEP WITH 'CCHHR'. 09300018
*                                                                       09304018
         LH    RALPHA,TEMPSAVE          GET ORIG. TRK BAL.         000D 09308018
         LR    RCPBASE,RALPHA     SAVE IT ACCROSS SVC 25.          000D 09312018
*                                                                       09316018
         OI    DCBCIND1,TRKOVFLO        SET THE DCB TRK OVFLO IND.      09320018
*                                       WHICH TELLS SVC 25 TO ERASE TO  09340018
*                                       END OF EXTENT.                  09360018
*                                                                       09380018
         LR    RGAMMA,RRETN             SAVE 14.                        09400018
         LR    RBETA,RBASE              SAVE 15.                        09420018
         DROP  RBASE                                                    09440018
         LA    R1,0(RDCB)               DEB REG HOLDS PARAM TO   A32558 09450020
*                                       SVC 25                          09460020
*                                                                       09480018
         SVC   25                       ERASE.                          09500018
*                                                                       09520018
         LR    RRETN,RGAMMA             RESTORE 14                      09540018
         LR    RBASE,RBETA              RESTORE 15.                     09560018
         USING NEWBASE,RBASE            RE-ESTABLISH BASE REG      UT18 09580018
         L     RDEB,DCBDEBAD            RECOVER DEB ADDRESSABILITY.     09600018
*                                                                       09640018
         STH   RCPBASE,TEMPSAVE   ORIG. TRK BAL SAVED ACCROSS      000D 09646018
*                                       SVC 25.                    000D 09652018
* RECOVER INITIAL CP AND COUNT FIELD ADDRESSABILITY.                    09660018
* REASON- NEED TO RESTORE THE TOTAL BLOCK LENGTH TO BE WRITTEN INTO     09680018
* THE WRITE CCW POINTED TO BY OFFSW.  THE TOTAL LENGTH HAS BEEN SAVED   09700018
* AT THE CCW JUST IN FRONT OF THE FIRST COUNT FIELD.                    09720018
         SR    RCPBASE,RCPBASE                                          09740018
         IC    RCPBASE,DCBWCPO                                          09760018
         AR    RCPBASE,RIOB             IOBA+WCPO                       09780018
         USING WCPMAP,RCPBASE                                           09800018
         SR    RSTEPPER,RSTEPPER                                        09820018
         IC    RSTEPPER,DCBWCPL                                         09840018
         SLL   RSTEPPER,3               DBL WDS TO BYTES.               09860018
         AR    RSTEPPER,RCPBASE         IOBA+WCPO+WCPL*8                09880018
* CP ADDRESS, S.A. AND COUNT FIELD ADRESS RESTORED TO INITIAL VALUES.   09900018
         LA    RALPHA,2                 LENGTH OF A CCW LENGTH FIELD.   09920018
         LR    RBETA,RSTEPPER           COPY FOR WORK.                  09940018
         CLI   CHANPGM,SETSC            RCD READY CHP            S20201 09941020
         BNE   NOFET19                  BRANCH IF NO             S20201 09942020
         AH    RCPBASE,ATE8             IF YES INCR BASE FOR SET S20201 09943020
*                                       SCT                      S20201 09944020
         TM    DCBOPTCD,VALCHK          VALIDITY CHK USED        S20201 09945020
         BO    NOFET19                  BRANCH IF YES            S20201 09946020
         AH    RALPHA,ATE8              INCR FOR RD SECTOR       S20201 09947020
*                                                                       09948020
NOFET19  EQU   *                                                 S20201 09949020
*                                                                       09950020
         USING DEBB,RDEB                                         S20201 09951020
         SR    RBETA,RALPHA             BETA POINTS TO WHERE THE        09960018
*                                       INITIAL CCW LENGTH WAS SAVED.   09980018
         LH    ROVFLO,0(RBETA)          RESET OVFLO TO ORIGINAL VALUE.  10000018
         STH   ROVFLO,DATALEN           WILL NEED THE FULL RECORD       10020018
*                                       LENGTH ON NEXT ENTRY TO EOB IF  10040018
*                                       CAN'T EXCP THIS TIME.           10060018
*                                                                       10062018
* DETERMINE IF ERASE HAD ANY ERRORS.                               000D 10064018
         L     RGAMMA,IOBECBPT           GET ECB ADDR.             000D 10066018
         TM    0(RGAMMA),NOERROR         IS THE ECB POSTED IN ERR. 000D 10068018
         BC    ANYZERO,RESTORE           BRANCH IF YES             000D 10070018
*                                                                       10072018
CHECKEXT EQU   *                                                   000D 10074018
*                                                                       10080018
* CHECK FOR ANOTHER EXTENT, DCBFDAD 'M'+1 MUST BE LESS THAN DEBNMEXT.   10100018
         SR    RBETA,RBETA              HOUSEKEEP                       10120018
         IC    RBETA,IOBFDAD            GET M                     M2057 10140018
         LA    RBETA,1(RBETA)           M=M+1.                          10160018
         STC   RBETA,IOBFDAD            TEMP WORK AREA.                 10180018
         CLC   IOBFDAD(1),DEBNMEXT      COMPARE M+1 TO NMBR OF EXTENTS. 10200018
         BL    EXTAVAIL                 BRANCH IF ANOTHER EXTENT.       10220018
         OI    DCBCIND1,VOLFULL         SET VOLUME FULL INDICATOR.      10240018
* REPAIR DCB FDAD AND TRK BAL TO THEIR VALUES AT ENTRY TO THIS MODULE.  10260018
         BCTR  RBETA,0                  DECREMENT THE M AND       M2057 10266018
         STC   RBETA,IOBFDAD            RESTORE THE IOB           M2057 10272018
         MVC   DCBFDAD(8),IOBFDAD       IOB INITIALIZED FROM THE FIRST  10280018
*                                       DCB VALUE.                      10300018
         MVC   DCBTRBAL(2),TEMPSAVE     TRK BAL SAVED IN IOB CSW.       10320018
         B     POSTECB                  MAKES EOV RE-SCHEDULE THIS IOB. 10340018
*                                                                       10360018
EXTAVAIL EQU   *                                                        10380018
*                                                                       10500018
* GET NEXT EXTENT FDAD FROM DEB TO DCB. DCBFDAD 'M' IN BETA IS CORRECT  10520018
* EXTENT NMBR (FROM M=M+1). 'M' TIMES THE EXTENT SCALE GIVES AN INDEX-  10540018
* ING FACTOR USED TO LOCATE THE DEVICE DEPENDENT EXTENT ENTRY.          10560018
*                                                                       10580018
         STC   RBETA,DCBFDAD            UPDATE 'M' TO NEXT EXTENT.      10600018
         SR    RGAMMA,RGAMMA                                            10620018
         IC    RGAMMA,DEBEXSCL          GET EXTENT SCALE(=4 FOR DA).    10640018
         SLL   RBETA,0(RGAMMA)          EXTENT NMBR TIMES SIZE.         10660018
         AR    RDEB,RBETA               BECAUSE MVC NOT INDEXABLE.      10680018
         MVC   DCBFDAD+3(4),DEBSTRCC    GET NEXT EXTENT FDAD.           10700018
         SR    RDEB,RBETA               TAKE OUT THE INDEXING FACTOR.   10720018
         MVI   DCBFDAD+7,ZERO           SET R=0.                        10740018
         B     SETFDAD                  START UP ON NEW EXTENT.         10760018
*                                                                       10780018
TSTSPLIT EQU   *                                                        10800018
* FOLLOWING CODE ENTERED WHEN IT HAS BEEN DETERMINED THAT AT LEAST ONE  10820018
* MORE RECORD SEGMENT WILL BE NEEDED AND A TRACK TO HOLD IT HAS BEEN    10840018
* FOUND.                                                                10860018
*                                                                       10880018
*                                                                       10900018
         SR    RGAMMA,RGAMMA                                            10920018
         IC    RGAMMA,DEBEXSCL          EXTENT SCALE(=4 FOR D.A.)       10940018
         SR    RBETA,RBETA                                              10960018
         IC    RBETA,IOBFDAD            GET CURRENT/LAST 'M'.           10980018
*                                       DCB HAS CURRENT/NEXT 'M' IN IT. 11000018
         SLL   RBETA,0(RGAMMA)          EXTENT NMBR TIMES SIZE.         11020018
*                                       KEEP RBETA FOR INDEXING DEB     11040018
*                                       BASE REG.                       11060018
* TEST FOR SPLIT ALLOCATION, WHICH IS ALLOWED ONLY ON THE PRIMARY.      11080018
         CLI   DCBFDAD,0                Q-FIRST EXTENT IF         M2057 11100018
*                                       FIRST IS NOT PRIMARY, DEBOFLGS  11120018
*                                       REFLECT A NON-SPLIT ALLOC.      11140018
         BNE   TESTPRIM                 BRANCH IF NOT ON FIRST EXTENT.  11160018
*                                       CANNOT BE SPLIT.                11180018
         TM    DEBOFLGS,SPLIT           IS IT SPLIT ALLOCATION.         11200018
         BZ    TESTPRIM                 BRANCH IF NO.                   11220018
*THE FDAD IN THE DCB IS 'VALID' (AS PER THE CONVERT ROUTINE ERROR CODE) 11240018
* AND THE ALLOCATION IS 'SPLIT'. NOW DETERMINE IF THE FDAD IS WITHIN    11260018
* THE LIMITS DEFINED BY THE STARTING AND ENDING HH'S IN THE DEB. IF     11280018
* NOT, THE NEXT PART OF THE SPLIT EXTENT (THERE MUST BE ONE FOR THE     11300018
* FDAD TO BE 'VALID') MAY BE FOUND BY-                                  11320018
*  TT(OF DCBFDAD) + MAXHH - (ENDHH - STRHH) -1                          11340018
* MAXHH IS THE NUMBER OF TRACKS IN A CYLINDER, AND IS THEREFORE DEVICE  11360018
* DEPENDENT.                                                            11380018
* ALPHA AND GAMMA ARE AVAILABLE WORK REGS.                              11400018
* REG BETA HOLDS THE INDEXING FACTOR BY WHICH RDEB HAS BEEN ADJUSTED.   11420018
         AR    RDEB,RBETA               BECAUSE SS INSTRUCTIONS NOT IN- 11440018
*                                       DEXABLE.                        11460018
         CLC   DCBFDAD+6(1),DEBSTRHH+1  IS IT BELOW STARTING HH.        11480018
         BL    OUTSIDE                  BRANCH IF YES.                  11500018
         CLC   DCBFDAD+6(1),DEBENDHH+1  IS IT ABOVE ENDING HH.          11520018
         BNH   FIXRDEB                  BRANCH IF NOT ABOVE. GO TO      11540018
*                                       REPAIR DEB REG.                 11560018
OUTSIDE  EQU   *                                                        11580018
* FDAD IS OUTSIDE THE SPLIT. ADVANCE TO THE NEXT PART OF THIS SPLIT     11600018
* EXTENT, USING THE ABOVE FORMULA.                                      11620018
         SR    RALPHA,RALPHA                                            11640018
         SR    RGAMMA,RGAMMA                                            11660018
         IC    RGAMMA,DEBENDHH+1        GET UPPER LIMIT, ENDHH.         11680018
         IC    RALPHA,DEBSTRHH+1        GET LOWER LIMIT, STRHH.         11700018
         SR    RGAMMA,RALPHA            ENDHH - STRHH                   11720018
         IC    RALPHA,MAXHH             MAXHH                           11740018
         SR    RALPHA,RGAMMA            MAXHH - (ENDHH - STRHH)         11760018
         BCT   RALPHA,*+4               MAXHH - (ENDHH - STRHH) -1      11780018
         AH    RALPHA,TTSAVE            TT+MAXHH-(ENDHH-STRHH)-1        11800018
         SR    RDEB,RBETA               REPAIR DEB REG.                 11820018
         BAL   RGAMMA,REGMANIP          GO TO REGISTER MANIPULATION     11840018
*                                       INTERFACE. REQ'D FOR USE OF     11860018
*                                       CONVERT ROUTINE.                11880018
         B     TTRFDAD                  WILL DO A CONVERT.              11900018
TESTPRIM EQU   *                                                        11920018
         AR    RDEB,RBETA               BECAUSE SS INSTRUCTIONS NOT IN- 11940018
*                                       DEXABLE.                        11960018
         CLC   DCBFDAD(1),IOBFDAD       CROSS AN EXTENT           M2057 11970018
         L     RDEB,DCBDEBAD            RESTORE DEB ADDRESS       M2057 11980018
         BH    ERASE                    THE VALID TTR LAST GIVEN TO     12000018
*                                       'CONVERT' PRODUCED AN FDAD      12020018
*                                       OUTSIDE THE CURRENT EXTENT.     12040018
*                                       IT MUST BE THE FDAD FOR THE     12060018
*                                       NEXT EXTENT OF A DISCONTIGUOUS  12080018
*                                       PRIMARY. ACTION- ERASE AND      12100018
*                                       CHECK FOR ANOTHER EXTENT.       12120018
*                                       RDEB HAS BEEN TAMPERED WITH.    12140018
FIXRDEB  EQU   *                                                        12160018
*                                                                       12200018
* IF THE OVERFLOW AMOUNT WILL FIT ON THE CURRENT TRACK, WILL EXIT THE   12220018
* LOOP TO DO FINAL LOGIC.  IF NOT, WILL SET UP TO RE-ENTER THE LOOP     12240018
* BUILDING C.P.'S.                                                      12260018
*                                                                       12280018
TESTFULL IF    TRACKFUL,ISNOT=ONES,GOTO=NOTFULL                         12300018
MOVEFDAD EQU   *                        FIRST TRACK HAD NO ROOM FOR     12320018
*                                       DATA. A NEW TRACK WAS GOTTEN    12340018
*                                       FOR THE FIRST RECORD SEGMENT.   12360018
         MVC   IOBFDAD(8),DCBFDAD       COPY NEW FDAD.                  12380018
         MVC   KEYLENTH,DCBKEYLE        RE-INIT KEYKENGTH. WAS OVERLAID 12400018
*                                       WITH A SAVED REG DURING CONVERT 12420018
         B     TESTOVFL                 SEE IF RECORD WILL FIT ON THIS  12440018
*                                       NEW TRACK.                      12460018
*                                                                       12480018
* RSTEPPER POINTS TO THE CURRENT S.A.                                   12500018
*                                                                       12520018
NOTFULL  MVC   CYLINDER(5),DCBFDAD+3    INIT CCHHR IN S.A.              12540018
         LA    RSTEPPER,EIGHT(RSTEPPER) POINT TO THE COUNT FIELD.       12560018
TESTOVFL LH    RGAMMA,TRKCAP            SET DL=MAX.                     12580018
         SR    RBETA,RBETA              CLEAR REG              @ZA02255 12592003
         IC    RBETA,OVERK              GET KEY OVERHEAD       @ZA02255 12594003
         AR    RGAMMA,RBETA             ADD KEY OVERHEAD NO KEY@ZA02255 12596003
         IC    RBETA,OVERL              GET LAST BLK OVERHEAD  @ZA02255 12606003
         TM    DEVFLAG,TBOVHD           IS THIS 2 BYTE OVERHEAD@ZA02255 12616003
         BNO   MZ0050                   BRANCH IF NO           @ZA02255 12618003
         LH    RBETA,OVERI              GET 2 BYTE OVERHEAD    @ZA02255 12618403
MZ0050   EQU       *                                           @ZA02255 12618803
         SR    RGAMMA,RBETA                                    @ZA02255 12619203
         CR    ROVFLO,RGAMMA            COMPARE OVFLO TO DEVICE MAX.    12619603
         BNH   RUPBY1                   BRANCH IF OVFLO IS LT OR EQ TO  12620018
*                                       DEVICE MAX. (RECORD WILL FIT).  12640018
UPRBY1   EQU   *                                                        12660018
         IC    RBETA,DCBFDAD+7          GET 'R'.                        12680018
         LA    RBETA,1(RBETA)           R=R+1                           12700018
         STC   RBETA,DCBFDAD+7          PUT IT BACK.                    12720018
         MVC   CYLINDER(5),DCBFDAD+3    INIT CCHHR IN COUNT.            12740018
*                                                                       12760018
         B     MIDLOOP                  CLOSE THE BASIC BUILDING LOOP.  12780018
*                                                                       12800018
* FINAL LOGIC.  THE REMAINING LENGTH IN ROVFLO WILL FIT ON THE CURRENT  12820018
* TRACK. MUST CALCULATE THE SPACE REQUIRED AS A NOT-LAST RECORD, SET    12840018
* UP CP TO WRITE IT, ISSUE EXCP.                                        12860018
*                                                                       12880018
FINAL    STH   ROVFLO,DATALEN           PUT LENGTH IN WRITE CCW.        12900018
         SR    RBETA,RBETA                                              12920018
         IC    RBETA,KEYLENTH           KEY LENGTH FROM COUNT FIELD.    12940018
         SR    ROVFLO,RBETA             SEGMENT LENGTH - KL = DATA LEN. 12960018
         STH   ROVFLO,DLDL              GOES IN COUNT FIELD.            12980018
         AR    ROVFLO,RBETA             RECONSTRUCT SEGMENT LENGTH.     13000018
*                                                                       13020018
*CALCULATE SPACE FOR A NOT-LAST-RECORD, USING                           13040018
*   (SEGMENT LENGTH)*TOL/512 - DCBKEYCN + I                             13060018
*                                                                       13080018
* DEB NO LONGER NEEDED. WILL USE THE DEB REG UNDER THE ALIAS RALPHA+1   13100018
* TO INSURE CONTIGUOUS REGISTERS FOR THE MULTIPLY.                      13120018
*                                                                       13140018
         LR    RALPHA,ROVFLO            GET KL+DL                       13160018
         LH    RALPHA+1,TOLER           GET TOLERANCE                   13180018
         MR    RALPHA,RALPHA            (KL+DL)*TOL                     13200018
         SRDA  RALPHA,9                 (KL+DL)*TOL/512 IS IN RALPHA+1  13220018
         SR    RALPHA,RALPHA                                            13240018
         IC    RALPHA,OVERI             GET NOT-LAST-RECORD OVERHEAD.   13260018
         TM    DEVFLAG,TBOVHD           TWO BYTE OVHD USED       S20201 13264020
         BNO   MZ0020                   BRANCH NO                S20201 13268020
         LH    RALPHA,OVERI             GET TWO BYTE OVHD        S20201 13272020
MZ0020   EQU   *                                                 S20201 13276020
         AR    RALPHA+1,RALPHA          AOD IT.                         13280018
         SR    RALPHA,RALPHA            CLEAR REG                S20201 13290020
         IC    RALPHA,DCBKEYCN          GET KEY OVERHEAD CONSTANT.      13300018
         SR    RALPHA+1,RALPHA          (KL+DL)*TOL/512+I-DCBKEYCN IS   13320018
*                                       THE AMOUNT TO SUBTRACT FROM     13340018
*                                       TRACK BALANCE.                  13360018
         LH    RBETA,DCBTRBAL           GET TRK BALANCE.                13380018
         SR    RBETA,RALPHA+1           DETERMINE NEW BALANCE.          13400018
         STH   RBETA,DCBTRBAL           UPDATE THE DCB.                 13420018
*                                                                       13440018
* END OF TRACK LENGTH CALCULATIONS.                                     13460018
*                                                                       13480018
         MVI   WRTOPCD,WCKD             SET OP CODE OF THE FINAL WRITE. 13500018
*                                                                       13506020
         DROP  RDEB                                              S20201 13512020
         USING SAMSIOB,RIOB                                      S20201 13518020
         CLI   CHANPGM,SETSC            IS THIS RCD READY CHP    S20201 13524020
         BE    FEAT41                   GO AROUND NEXT INST      S20201 13530020
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=FLAGZERO                      13540018
*                                                                       13560018
*                                                                       13565020
FEAT41   EQU   *                                                 S20201 13570020
*                                                                       13575020
         MVI   NULLFLAG,CC              COMMAND CHAIN CCW4.             13580018
*                                                                       13600018
* ADVANCE CP BASE REG TO NEXT SEGMENT. IF IT IS NOT THE WRITE VALIDITY  13620018
* CHECK SEGMENT, OVERLAY THE FIRST CCW WITH A TIC TO THE VALIDITY       13640018
* CHECK SEGMENT. SAME FOR RCD READY.                                    13660020
*                                                                       13680018
         LA    RCPBASE,CPSEGLEN(RCPBASE) ADDRESS OF NEXT SEGMENT.       13700018
         USING VCMAP,RCPBASE                                            13720018
         CLI   SEEKOPCD,SEEKCYL         ONLY SEEK IS IN WRITE CHECK SEG 13740018
         BE    EXCP                     WRITE VALIDITY CHECK SEGMENT IS 13760018
*                                       CONTIGUOUS WITH LAST SEGMENT    13780018
*                                       MADE UP. DONT NEED A TIC TO IT. 13800018
         CLI   D0(RCPBASE),RDSC         IS THIS A READ SECTOR    S20201 13806020
         BE    EXCP                     IF YES BRANCH            S20201 13812020
         USING WCPMAP,RCPBASE                                           13820018
         SR    RBETA,RBETA                                              13840018
         IC    RBETA,DCBWCPO            BUILD ADDRESS OF WCP            13860018
         AR    RBETA,RIOB               BECAUSE MVC NOT INDEXABLE.      13880018
         CLI   CHANPGM,SETSC            IS THIS A RCD READY CHP  S20201 13882020
         BNE   NOFET27                  BRANCH IF NO             S20201 13884020
         LA    RBETA,EIGHT(RBETA)       INCREMENT FOR SET SECT   S20201 13886020
*                                       CMND                     S20201 13888020
*                                                                       13890020
NOFET27  EQU   *                                                 S20201 13892020
*                                                                       13894020
         MVC   SRCHCCW(4),12(RBETA)     OVERLAY THE SEARCH WITH         13900018
*                                       PARASITIC TIC FROM CCW2.        13920018
         B     EXCP                                                     13940018
FLAGZERO MVI   NULLFLAG,ZERO            TERMINATE CP CHAIN.             13960018
*                                                                       13980018
* PREPARE FOR EXCP. CP'S ALL BUILT.                                     14000018
*                                                                       14020018
EXCP     EQU   *                                                        14040018
         LA    R1,8(RIOB)              ADJUST POINTER FROM SAM'S TO     14060018
*                                      IOS' IOB.                        14080018
         EXCP  (1)                                                      14100018
*                                                                       14120018
RESTORE  LM    RBETA,RDEVTAB,64(RSAVE)  RESTORE USERS 9 AND 10.         14140018
         SR    ROFFSW,ROFFSW                                            14160018
         IC    ROFFSW,DCBOFFSW         QSAM NEEDS IT TO GET NEXT        14180018
*                                      BUFFER ADDRESS.                  14200018
*                                                                       14220018
         BR    RRETN                                                    14240018
POSTECB  L     RBETA,IOBECBPT           GET ECB ADDRESS.                14260018
         MVI   0(RBETA),COMPWERR        POST COMPLETE WITH ERROR.       14280018
UEX      OI    IOBSTAT0,UNITEXC         SET CSW STATUS BYTE 0 TO UEX.   14300018
         B     RESTORE                                                  14320018
ERREXIT1 EQU   *                                                        14370002
         DMABCOND 204,SVC=YES,DCB=(RDCB) CALL PROB DETERMINATION Y02072 14380002
ERREXIT2 EQU   *                                                        14390002
         DMABCOND 254,SVC=YES,DCB=(RDCB) CALL PROB DETERMINATION YM1433 14392002
         EJECT                                                          14394002
ONE      DC    H'1'                                                     14400018
ATE8     DC    H'8'                     CCW LENGTH               S20201 14402020
MODID    DC    C'IGGR19T2'              MODULE ID              @ZA02255 14452003
DATEFIX  DC    C'04/22/75'              DATE OF LATEST FIX'    @ZA02255 14462003
FIXID    DC    C' ZA02255'              LATEST FIX IN MODULE   @ZA02255 14464003
PATCH    DC    25H'0'                   PATCH AREA               Y02072 14472002
         EJECT                                                          14474002
*                                                                       14476002
* FOLLOWING IS A MAP OF A WRITE CP SEGMENT.                             14480018
*                                                                       14500018
WCPMAP   DSECT                                                          14520018
*                                                                       14540018
*        SEARCH  (CCW1 OR 5)                                            14560018
*                                                                       14580018
SRCHCCW  EQU   *                                                        14600018
SRCHADDR DS    F                                                        14620018
SRCHOPCD EQU   SRCHADDR                 OP CODE IS HI ORDER BYTE.       14640018
SRCHFLAG DS    XL1                                                      14660018
         DS    CL2                                                      14680018
SRCHLEN  DS    XL1                      LENGTHS NORMALLY FIT IN 1 BYTE. 14700018
*                                                                       14720018
*        TIC   (CCW2 OR 6)                                              14740018
*                                                                       14760018
TICADDR  DS    F                                                        14780018
TICOPCD  EQU   TICADDR                                                  14800018
UNUSED   DS    F                        ONLY REQUIRES BITS 37-39 = 0.   14820018
PARASITE EQU   UNUSED                   BITS 37-39 =0 RESTRICTION ON    14840018
*                                       OP CODES, A PLACE FOR ADDRESSES 14860018
*                                                                       14880018
*        WRITE  (CCW3)                                                  14900018
*                                                                       14920018
COUNTADR DS    F                        COUNT FIELD ADDRESS.            14940018
WRTOPCD  EQU   COUNTADR                                                 14960018
WRTFLAG  DS    XL1                      FLAG FIELD.                     14980018
         DS    CL2                      SPACER.                         15000018
COUNTLEN DS    XL1                      COUNT FIELD LENGTH (NORMALLY 8) 15020018
*                                                                       15040018
*        NULL OP CODE  (CCW4)           OP PROPAGATED FROM WRITE CCW.   15060018
*                                                                       15080018
DATAADDR DS    F                        ADDRESS OF BLOCK OF DATA TO BE  15100018
*                                       WRITTEN.                        15120018
NULLOPCD EQU   DATAADDR                 USED AS A FLAG TO SIGNAL LAST   15140018
*                                       SEGMENT.                        15160018
NULLFLAG DS    XL1                                                      15180018
         DS    C                                                        15200018
DATALEN  DS    H                        DATA TO BE WRITTEN.             15220018
*                                                                       15240018
         EJECT                                                          15242002
*                                                                       15260018
* FOLLOWING IS THE VALIDITY CHECK CP OVERLAY.                           15280018
*                                                                       15300018
VCMAP    DSECT                                                          15320018
*        SEEK  (CCW7)                                                   15340018
SEEKADDR DS    F                                                        15360018
SEEKOPCD EQU   SEEKADDR                                                 15380018
SEEKFLAG DS    XL1                                                      15400018
         DS    CL2                                                      15420018
SEEKLEN  DS    XL1                                                      15440018
*                                                                       15460018
*        SEARCH (CCW8)             LABELS PREFIXED BY 'VC' (VALIDITY    15480018
VCSRCH   EQU   *                        CHECK).                         15500018
VCSRCHAD DS    F                                                        15520018
VCSRCHOP EQU   VCSRCHAD                                                 15540018
VCSRCHFL DS    XL1                      FLAGS.                          15560018
         DS    CL2                                                      15580018
VCSRCHLE DS    XL1                      LENGTH.                         15600018
*                                                                       15620018
*        TIC   (CCW9)                                                   15640018
VCTICAD  DS    F                                                        15660018
VCTICOP  EQU   VCTICAD                                                  15680018
NOTUSED  DS    F                                                        15700018
*                                                                       15720018
*        READ DATA (CCW10)                                              15740018
VCRDAD   DS    F                                                        15760018
VCRDOP   EQU   VCRDAD                                                   15780018
VCRDFLAG DS    XL1                      NORMALLY SET FOR SKIP.          15800018
VCRDLEN  DS    FL3                                                      15820018
         EJECT                                                          15830002
*                                                                       15840018
* FOLLOWING IS AN OVERLAY OF THE COUNT FIELD.                           15860018
*                                                                       15880018
COUNTFLD DSECT                                                          15900018
*                                                                       15920018
CYLINDER DS    H                        CYLINDER ADDRESS (CC).          15940018
HEAD     DS    H                        HEAD ADDRESS     (HH).          15960018
RECORD   DS    XL1                      RECORD NUMBER    (R).           15980018
KEYLENTH DS    XL1                      KEY LENGTH       (KL).          16000018
DLDL     DS    H                        DATA LENGTH      (DLDL).        16020018
*                                                                       16040018
* END COUNT FIELD. (CCHHRKDD)                                           16060018
*                                                                       16080018
         EJECT                                                          16090002
*                                                                       16100018
* DIRECT ACCESS DEVICE TABLE OVERLAY                                    16120018
*                                                                       16140018
DEVTAB   DSECT                                                          16160018
DEVSIZE  DS    F                       MAX SIZ FOR DEVICE.              16180018
MAXHH    EQU   DEVSIZE+3                LO ORDER BYTE OF DEVICE SIZE IS 16200018
*                                       MAX HEAD ADDRESS.               16220018
TRKCAP   DS    H                       TRACK CAPACITY.                  16240018
OVERI    DS    XL1                     OVERHEAD FOR NOT-LAST RECORD.    16260018
OVERL    DS    XL1                     OVERHEAD FOR LAST RECORD.        16280018
OVERK    DS    XL1                     OVERHEAD REDUCTION FOR NON-KEY   16300018
*                                      RECORDS.                         16320018
DEVFLAG  DS    XL1                                                      16340018
TOLER    DS    H                       TOLERANCE/512 USED FOR VARIABLE  16360018
*                                       GAP LENGTH CALCULATIONS.        16380018
* END DEVTAB OVERLAY.                                                   16400018
*                                                                       16420018
*                                                                       16440018
         EJECT                                                          16450002
         DCBD  DSORG=PS                                                 16460018
         EJECT                                                          16480002
FORECORE DSECT                                                          16560018
DEBB     DSECT                         THIS DSECT DESCRIBES THE DEBUT18 16560318
DEBNMSUB DS    0CL1                    NO. OF SUB RTNS             UT18 16560618
DEBTCBAD DS    CL4                     TASK CONTROL BLOCK ADDR     UT18 16560918
DEBAMLNG DS    0CL1                    LENGTH OF ACCESS METHOD SEC UT18 16561218
DEBDEBAD DS    CL4                     ADDR OF NEXT DEB IN DEB CHAIUT18 16561518
DEBOFLGS DS    0CL1                    DEB OPEN FLAGS              UT18 16561818
DEBIRBAD DS    CL4                     ADDR OF THE IRB CONTROL BLOCUT18 16562118
DEBOPATB DS    0CL1                    OPEN ATRIBUTES              UT18 16562418
DEBSYSPG DS    CL4                     SYSTEM PURGE FIELD          UT18 16562718
DEBNMEXT DS    0CL1                    NUMBER OF EXTENTS IN DEB    UT18 16563018
DEBUSRPG DS    CL4                     USER PURGE FIELD            UT18 16563318
DEBPRIOR DS    0CL1                    INFO BYTE                   UT18 16563618
DEBECBAD DS    CL4                     EVENT CONTROL BLOCK ADDR    UT18 16563918
DEBPROTG DS    0CL1                    INFO BYTE                   UT18 16564218
DEBDEBID DS    0CL1                    INFO BYTE                   UT18 16564518
DEBDCBAD DS    CL4                     ADDR OF DCB                 UT18 16564818
DEBEXSCL DS    0CL1                    SCALING FACTOR OF DEB EXTENTUT18 16565118
DEBAPPAD DS    CL4                     APPENDAGE TABLE ADDR        UT18 16565418
DEBDVMOD DS    0CL1                    DEVICE MODIFIER BYTE        UT18 16565718
DEBUCBAD DS    CL4                     UNIT CTL BLOCK ADDR         UT18 16566018
DEBTVLSQ DS    0CL2                    VOL SEQ FOR TAPE            UT18 16566318
DEBBINUM DS    CL2                     BIN NUMBER                  UT18 16566618
DEBTVLNM DS    0CL2                    NO OF VOL FOR TAPE          UT18 16566918
DEBSTRCC DS    CL2                     START CYLINDER NUMBER       UT18 16567218
DEBSTRHH DS    CL2                     START HEAD NUMBER           UT18 16567518
DEBENDCC DS    CL2                     END CYLINDER NUMBER         UT18 16567818
DEBENDHH DS    CL2                     END HEAD NUMBER             UT18 16568118
DEBNMTRK DS    CL2                     NUMBER OF TRACKS            UT18 16568418
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS     UT18 16568718
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                         UT18 16569018
DEBVOLSQ DS    H                       VOL SEQUENCE NUMBER         UT18 16569318
DEBVOLNM DS    H                       VOLUME NUMBER               UT18 16569618
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                UT18 16569918
DEBSUBID DS    H                       SUBROUTINE ID ( 2 BYTES )   UT18 16570218
         EJECT                                                          16570302
TOTSAVWA DSECT                                                     UT18 16570518
*                                                                  UT18 16570818
*******************************************************************UT18 16571118
*  THIS DSECT ESTABLISHES THE SYMBOLIC REFERENCES FOR THE USER TOTAUT18 16571418
*        ING FACILITY SAVE WORKAREA.                               UT18 16571718
*******************************************************************UT18 16572018
TOTFLGBT DS    0CL1                     X'80' = NO SAVE FOR UTF    UT18 16572318
TOTSVPTR DS    F                        ADDR OF THE SAVE RTN       UT18 16572618
TOTCURNT DS    F                        ADDR OF CURRENT SAVE SEGMENUT18 16572918
TOTSTART DS    F                        BEGINNING ADDR OF SAVE SEGMUT18 16573218
TOTENDAD DS    F                        ADDR OF LAST SAVE SEGMENT  UT18 16573518
TOTSVLNG DS    F                        LENGTH OF THE USER'S SAVE AUT18 16573818
TOTUSRWA DS    F                        ADDR OF THE USERS TOT AREA UT18 16574118
TOTTOTLN DS    F                       TOTAL LEN OF GETMAIN        UT18 16574418
TOTEOVPT DS    F                        POINTER TO EOV SEG         UT18 16574718
TOTREGSV DS    D                        SAVE AREA FOR R11 & R12    UT18 16575018
         DS    D                       SAV AREA  FOR REG'S         UT18 16575318
         EJECT                                                          16577302
         IECDSECT                                                       16580018
*                                                                       16600018
* IOB OVERLAY                                                           16620018
* THE FORECORE DSECT IOB OVERLAY IS USED WITH THE FOLOWING ADDITIONS-   16640018
*                                                                       16660018
* BSAM/BPAM/QSAM IOB EXTENSION-                                         16680018
LINK     EQU   DXIOB-8                  FORWARD CHAIN FIELD (TO NEXT    16700018
*                                       IOB).                           16720018
SAMSIOB  EQU   LINK                                                     16740018
FLAG     EQU   LINK                     HI BYTE OF LINK USED AS FLAG.   16760018
ECB      EQU   DXIOB-4                                                  16780018
* END EXTENSION DEFINITIONS                                             16800018
*                                                                       16820018
TRACKFUL EQU   IOBCSW+1                 CSW ADDRESS BYTE USED FOR       16840018
*                                       A TEMPORARY SWITCH.             16860018
TEMPSAVE EQU   IOBCSW+2                 PLACE TO KEEP THE ORIG. TRK BAL 16880018
*                                                                       16900018
*                                       IS OK BECAUSE IOB BEING PROCESS 16920018
*                                       -ED IS NOT IN ERROR, THEREFORE  16940018
*                                       CSW NOT NEEDED.                 16960018
TTSAVE   EQU   IOBCSW+6                 PLACE TO KEEP THE UPDATED TT    16980018
IOBFDAD  EQU   DXDAADDR                 FDAD IN FORECORE IOB.           17000018
CHANPGM  EQU   DXDAADDR+8               START OF CHANNEL PROGRAM.       17020018
*                                       LENGTH MAY VARY.                17040018
* END IOB DEFINITIONS.                                                  17060018
*                                                                       17080018
         END                                                            17280018
./  ADD  SSI=81860034,NAME=IGG019V6
 TITLE 'IGG019V6-REAL ADDRESS SPACE PCI,CH.END,AB.END APPENDAGE'        00050002
IGG019V6 CSECT                                                          00100002
*********************************************************************** 00102002
*                                                                       00110002
* MODULE NAME-IGG019V6                                                  00150002
*                                                                       00160002
* DESCRIPTIVE NAME-REAL ADDRESS SPACE PCI, CHANNEL END, ABNORMAL        00200002
*   END APPENDAGE                                                       00250002
*                                                                       00260002
* COPYRIGHT-NONE                                                        00270002
*                                                                       00300002
* CHANGE ACTIVITY-AS FOLLOWS                                            00350002
*                                                                       00400002
*          RELEASE 21 DELETIONS                                       * 02100002
*                                                                M0477  02150002
*                                                                A42907 02200002
*          VS2 RELEASE 02 DELETIONS                                     02250002
*                                                                Y02072 02300002
* 210500,273500,319500,352500,419000,429000,437000               YM4635 02400002
*                                                                YM5355 02400102
*                                                                YM5998 02400202
*                                                                YM6583 02400302
*                                                                YM1002 02400402
*          VS1 RELEASE 03 DELETIONS                                     02400637
*                                                               XA02374 02400837
*          VS2 POST RELEASE 3 CHANGES                                   02401037
*A092600-092900,161100-161200,163100-163400                    @ZA00971 02401237
*A19751002-19758002                                            @ZA02259 02450037
*A210100-210200,273100,273200,319100-319200,418600-418700      @ZA11106 02490037
*428600-428700.437000-437200,437800                            @ZA11106 02510037
*A205510,205520,C275200                                        @ZA11126 02530037
*C245500                                                       @ZA11654 02550037
*A245510-245520                                                @ZA11654 02570037
*C292500                                                       @ZA08874 02580037
*A343500-343860                                                @ZA08874 02590037
*C390000                                                       @ZA17184 02600037
*A208600-208800                                                @ZA18996 02603037
*D263500-265000,266000                                         @ZA18996 02606037
*D44250002                                                     @ZA27785 02610037
*C284500,285000                                                @ZA26933 02620037
*A284600-284800,287600-287700                                  @ZA26933 02630037
*C287700                                                       @ZA33346 02640037
* MODULE TYPE- APPENDAGE USED BY BSAM/QSAM FOR PCI REQUIREMENTS.        02650002
*                                                                       02700002
* FUNCTION-TO HANDLE THE MANIPULATION OF ICB'S UNDER THREE TYPES OF     02750002
*          INTERRUPTS  1)PCI-TYPE INTERRUPT   2)CHANNEL-END INTERRUPT   02800002
*          AND  3)ABNORMAL-END INTERRUPT                                02850002
*                                                                       02900002
*          PCI ENTRY-ALL  FINISHED ICBS ARE POSTED COMPLETE. THE        02950002
*                    BLOCK COUNT UPDATED IF USING TAPE. THE MAINIOB     03000002
*                    POINTERS ARE UPDATED TO SHOW NEW ICB CHAIN'S       03050002
*                    STATUS. IF AN ICB IS BEING WAITED ON, A BRANCH     03100002
*                    ENTRY TO IOS'S 'POST' ROUTINE IS MADE TO SATISFY   03150002
*                    'WAIT'.                                            03200002
*                                                                       03250002
*          CHANNEL END ENTRY- IN ADDITION TO POSTING AND UPDATING       03300002
*                    FUNCTIONS EXACTLY AS IN PCI ENTRY, A CHECK IS      03350002
*                    MADE TO SEE IF AN ERROR HAS BEEN PREVIOUSLY        03400002
*                    PROCESSED. A CHAIN OF ICB'S MAY THEN BE RESTARTED  03450002
*                    IF THE 'START CHAIN' INDICATOR IS ON.              03500002
*                                                                       03550002
*          ABNORMAL END ENTRY- THE POSTING AND UPDATING FUNCTIONS       03600002
*                    ARE ALSO PERFORMED AS IN PCI UNTIL THE ICB IN      03650002
*                    ERROR IS FOUND. IF THIS IS FIRST ENTRY FOR THE     03700002
*                    ERROR, THE ICB IS ISOLATED FROM ANY CHAINED        03750002
*                    ICBS AND GIVEN BACK TO IOS TO RECOVER.(IF ANY      03800002
*                    ICBS ARE CHAINED ON, THE 'START CHAIN' INDICATOR   03850002
*                    IS SET ON SO THAT CHAIN MAY BE RESTARTED IF        03900002
*                    ERROR IS CORRECTED OR PROCESSING IS TO CONTINUE.)  03950002
*                    IF ERROR  HAS BEEN PROCESSED BEFORE THE ICB,       04000002
*                    AND MAINIOB ARE POSTED IN ERROR.                   04050002
*                                                                       04100002
*                                                                       04150002
* ENTRY POINT-IGG019V6 IN APPENDAGE VECTOR TABLE FOR PCI .              04200002
*             IGG019V6+4 IN APPENDAGE VECTOR TABLE FOR BOTH THE         04250002
*               ABNORMAL END APPENDAGE AND CHANNEL APPENDAGE.           04300002
*                                                                       04350002
* INPUT-REGISTERS SET UP BY IOS                                         04400002
*        1) RQE = 1      RQE ADDRESS                                    04410002
*        2) RIOB = 2     IOB(IOS) POINTER                               04450002
*        3) DCBR = 4     DCB  POINTER.                                  04500002
*        4) RSAVE = 13   PTR TO 16 FULL WORDS REGISTERS SAVEAREA Y02072 04550002
*        5) RETR = 14    RETURN ADDRESS                                 04650002
*        6) BASR = 15    BASE REG FOR THIS MODULE.                      04700002
*                                                                       04850002
*                                                                       04900002
*          FIELDS REFERENCED IN DCB                                     04950002
*        1) DCBBLKCT     TAPE BLOCK COUNT UPDATED                       05000002
*        2) DCBDEVT      CHECK FOR TAPE OR DIRECT ACCESS                05050002
*        3) DCBIFLG      CHANGE TO PERMIT OR PREVENT IOS ERROR RECOVERY 05100002
*        4) DCBIOBAD     FIRST BYTE CONTAINS NOP OFFSET FOR ICB         05150002
*                                                                       05200002
*          BITS, FIELDS AND FLAGS                                       05250002
*        1) BLOCK COUNT INCREMENT IS IN 1ST 2 BYTES OF 'DCBAD' IN ICB.  05300002
*        2) ECB IN MAINIOB AND ICB                                      05350002
*          A)WAIT BIT(10000000=X'80')                                   05400002
*          B)COMPLETE BIT(01000000=X'40')                               05450002
*        3) BYTE 1 OF '1ST ICB' IN MAINIOB                              05500002
*          A)ERRPPROC(ERROR PREVIOUSLY PROCESSED)=X'04'                 05550002
*          B)STRTCHAN(RESTART CHAIN OF ICBS) =X'02'                     05600002
*          C) PCIENTRY=X'01'  APPENDAGE WAS ENTERED DUE TO A PCI.       05650002
*        4) DCBDEVT                                                     05700002
*          A)TAPE = X'80'                                               05750002
*        5) CSW IN MAINIOB                                              05800002
*          A)CHEND(00001000) CHANNEL END.........BYTE 1                 05850002
*          B)UNITEXC(00000001) UNIT EXCEPTION....BYTE 1                 05900002
*          C)UNITCHEK(00000010) UNIT CHECK.......BYTE 1                 05950002
*          D)RONGSIZE(01000000) INCORRECT LENGTH.BYTE 2                 06000002
*          E)ERRORS(00110001) FOR CHAINING CHECK,                       06050002
*                                  PROGRAMCHECK,                        06100002
*                          OR PROTECTION CHECK...BYTE 2                 06150002
*        6)  BYTE 30, BIT 0 IN THE ICB IS A 'SPECIAL VOLUME FULL' BIT.  06200037
*            IT IS SET WHEN THE REFLECTIVE SPOT IS ENCOUNTERED ON       06240037
*            ON A WRITE WITH A WRITE ERROR.  WHEN ERROR PROCESSING      06280037
*            IS FINISHED, AN END OF TAPE CONDITION IS TO BE HANDLED.    06320037
*                                                                       06400002
* ATTRIBUTES-REENTRANT,RESUABLE,ENABLED,HOLD LOCAL LOCK,         Y02072 06450002
*            GENERALLY RUNS IN KEY IN WHICH EXCP WAS ISSUED.            06500002
*                                                                       06550002
* NOTES-SEE BELOW                                                Y02072 06560002
*   PATCH LABEL-PATCH A DC STATEMENT                                    06610002
*   THIS MODULE IS THE SAME COPY AS IGGR19CU                            06620002
*   THE REASONS FOR CREATING A NEW MODULE FOR THE V=R USERS ARE:        06622002
*    1.) THE MODULE WILL RESIDE IN SVCLIB (WHEREAS THE MODULE FOR       06624002
*        V=V USERS RESIDES IN LPALIB)                                   06626002
*    2.) THE V=R MODULE OPERATES IN A DIFFERENT ENVIRONMENT. WHEN       06628002
*        A PCI INTERRUPT IS RECEIVED WITHOUT CHANNEL END, THE PCI       06630002
*        APPENDAGE IS ENTERED FROM THE DIE. THIS ENVIRONMENT DIFFERS    06632002
*        FROM THE CHANNEL END APPENDAGE ENVIRONMENT IN 2 SIGNIFICANT    06634002
*        WAYS:                                                          06636002
*         A.) IT IS DISABLED (CE IS ENABLED)                            06638002
*         B.) IT DOES NOT HOLD THE LOCAL LOCK (CE HAS LOCAL LOCK)       06638402
*                                                                       06640002
*        3)    THE CHANNEL PROGRAMS IN THE ICBS ARE CHAINED TOGETHER BY 06642002
*              THE EOB ROUTINES AND UNCHAINED BY IGG019V6.              06644002
*                                                                       06648002
*        4)    FOR DIRECT ACCESS THE MAIN IOB HAS A CHANNEL PROGRAM     06650002
*              IN IT TO ALLOW FOR A COMMON SEARCH.  IOBSTART POINTS     06652002
*              TO THE FIRST CCW IN THE CHANNEL PROGRAM AND THE LAST     06654002
*              CCW IS A TIC TO THE CHANNEL PROGRAM OF THE FIRST ICB     06656002
*              ON THE CHAIN.  FOR NON DIRECT ACCESS THERE IS NO         06658002
*              CHANNEL PROGRAM IN THE MAIN IOB AND IOBSTART POINTS      06660002
*              TO THE CHANNEL PROGRAM IN THE FIRST ICB ON THE CHAIN.    06662002
*                                                                       06664002
*        5)    EACH ICB'S CHANNEL PROGRAM ENDS IN ONE OF THE FOLLOWING  06666002
*              WAYS:                                                    06668002
*                                                                       06670002
*              NON-RPS WHEN NOT CHAINED.                                06672002
*              |  NOP   | NXT CCW STR | ******************|             06674002
*              |__________________________________________|             06676002
*                                                                       06678002
*              NON-RPS WHEN CHAINED.                                    06680002
*              |  TIC   | NXT CCW STR | ******************|             06682002
*              |__________________________________________|             06684002
*                                                                       06686002
*              RPS WHEN NOT CHAINED.                                    06688002
*              | NOPTIC | ADR RDSCT   | NXT CCW STR       |             06690002
*              |__________________________________________|             06692002
*              | RDSCT  | SECTOR ADDR | 00   00   00   01 |             06694002
*              |__________________________________________|             06696002
*                                                                       06698002
*              RPS WHEN CHAINED.                                        06700002
*              |  TIC   | NXT CCW STR | NXT CCW STR       |             06702002
*              |__________________________________________|             06704002
*              | RDSCT  | SECTOR ADDR | 00   00   00   01 |             06706002
*              |__________________________________________|             06708002
*                                                                       06710002
*              A NOPTIC COMMAND IS A X'88'.  THE HARDWARE DECODES IT    06712002
*              THE SAME AS AN ORDINARY TIC.  BITS 0 - 3 ARE IGNORED     06714002
*              BY THE HARDWARE BUT ARE USED BY THE SOFTWARE TO IND-     06716002
*              ICATE THAT THIS IS THE LAST CHANNEL PROGRAM IN THE       06718002
*              CHAIN (AS A NOP IS FOR NON-RPS). THE NOPTIC IS WHAT      06720002
*              IOBCNOPA POINTS TO FOR AN RPS CHANNEL PROGRAM.           06722002
*                                                                       06724002
*              TO ADD OR REMOVE A NON-RPS SEGMENT ALL THAT IS           06726002
*              NEEDED IS TO CHANGE THE OPCODE FROM A NOP TO A TIC OR    06728002
*              FROM A TIC TO A NOP.                                     06730002
*              TO REMOVE AN RPS SEGMENT THE TIC IS CHANGED TO A         06732002
*              NOPTIC AND THE ADDRESS IS CHANGED TO THAT OF THE         06734002
*              READ SECTOR COMMAND FOLLOWING.  TO ADD A SEGMENT         06736002
*              THE NOPTIC IS CHANGED TO A NORMAL TIC AND THE ADDRESS    06738002
*              IN THE SECOND WORD IS MOVED TO THE FIRST WORD.           06740002
         EJECT                                                          06742002
*                                                                       06744002
*        6)    IOBCNOPA IS USED FOR SERIALIZATION BETWEEN THE EOB       06746002
*              ROUTINES AND IGG019V6. PRIOR TO VS2 RELEASE 2 THE        06748002
*              ECB WAS USED FOR THIS SERIALIZATION, HOWEVER SINCE       06750002
*              MP SUPPORT WAS ADDED AND THE APPENDAGES RUN ENABLED,     06752002
*              IT WAS NO LONGER SUFFICIENT.  THE HIGH ORDER BIT OF      06754002
*              IOBCNOPA MEANS THAT IF THE EOB ROUTINES ADD ANOTHER      06756002
*              SEGMENT THEY MUST ISSUE AN EXCP SINCE IGG019V6 HAS       06758002
*              TERMINATED THE LAST SEGMENT.  IF THE BIT IS A 0 THEN     06760002
*              EITHER 19V6 WILL RE-EXCP OR THE SEGMENT IS STILL         06762002
*              ACTIVE.  19V6 ONLY TURNS ON THE BIT IT NEVER CHANGES     06764002
*              THE ADDRESS.  THE EOB ROUTINES CHANGE THE ADDRESS        06766002
*              AND WHEN THEY ISSUE AN EXCP TURN OFF THE BIT.            06768002
*              A CS INSTRUCTION IS USED BY BOTH CU AND THE EOB          06770002
*              ROUTINES TO PREVENT INTERACTION IN AN MP ENVIRONMENT.    06772002
*              THIS SUPPORT WAS ADDED WITH PTM YM6583.                  06774002
*                                                                       06776002
*   PATCH LABEL-PATCH A DC STATEMENT                                    06778002
*                                                                       06780002
*********************************************************************** 06782002
         EJECT                                                          06784002
         USING RQE,RRQE                 RQE REGISTER             Y02072 06786002
         USING IHADCB,DCBR                                              06800002
         USING *,BASR                                                   06850002
         SPACE 2                                                        06900002
R0       EQU   0                                                        06950002
RRQE     EQU   1                        RQE REGISTER             Y02072 06960002
RIOB     EQU   2                        IOB POINTER                     07000002
RWRK4    EQU   3                        WORK REG                 Y02072 07012002
DCBR     EQU   4                        POINTER TO DCB                  07020002
R5       EQU   5                                                        07030002
RWRK6    EQU   5                        WORK REG                 Y02072 07040002
R6       EQU   6                                                        07050002
R7       EQU   7                                                        07100002
R8       EQU   8                                                        07150002
RINSERT  EQU   9                        INSERT CHARACTER REG            07160002
RWRK7    EQU   9                        WORK REG                 Y02072 07170002
R10      EQU   10                                                       07200002
RWRK1    EQU   10                                                       07210002
RWRK2    EQU   11                                                       07220002
RWRK3    EQU   12                                                       07230002
R12      EQU   12                       REG 12,FOR LM INST       Y02072 07232002
RSAVE    EQU   13                       PTR TO REG SAVEAREA      Y02072 07242002
RETR     EQU   14                       RETURN REGISTER                 07244002
BASR     EQU   15                       BASE REGISTER FOR THIS CSECT    07246002
R15      EQU   15                       REG 15,FOR STM/LM INST   Y02072 07248002
         SPACE 2                                                        07248402
FIRSTICB EQU   8                                                        07250002
CPSTART  EQU   24                                                       07300002
ZERO     EQU   X'00'                                                    07350002
INCREMNT EQU   28                                                       07400002
ECBPTR   EQU   12                                                       07450002
DABIT    EQU   X'20'                                                    07700002
NOP      EQU   X'03'                                                    08450002
EIGHT    EQU   8                        DECREMENT OF 8            M6373 08900002
UCSLOAD  EQU   X'FB'                    UCS LOAD COMMAND          M6373 08950002
SKIP0    EQU   X'83'                    SKIP TO CHANNEL 0 COMMAND M6373 09000002
FOLD     EQU   X'43'                    FOLD COMMAND              M6373 09050002
ERR1     EQU   X'02'                    ERR MASK FOR STAT1        M6373 09100002
ERR2     EQU   X'7F'                    ERROR MASK FOR STAT 2     M6373 09150002
RETRY    EQU   X'80'                    TEST FOR ERROR RETRY      M6373 09200002
CMNDRTRY EQU   X'80'                    TEST IF ERROR RETRYABLE   M6373 09250002
*  IF IOS WAS UNABLE TO GET SENSE BYTES AFTER TEN TRIES FOLLOWING       09260037
*  A UNIT CHECK ON ANY DEVICE, IOS SIMULATES SENSE BYTES BY SETTING     09270037
*  X'10FE'.                                                             09280037
SENSFAIL EQU   X'FE'                SIMULATED SENSE IN IONSENS1@ZA00971 09290037
RTRYOFF  EQU   X'7F'                    TURN OFF RETRY            M6373 09300002
SKIPFLAG EQU   X'40'                    INDICATE SKIP TO 0        M6373 09350002
SKIPOFF  EQU   X'3F'                    TURNS OFF RETRY AND SKIP  M6373 09400002
*                                        FLGS                     M6373 09450002
TAPE     EQU   X'80'                    TAPE INDICATOR IN DCBDEVT=X'80' 09500002
NULL     EQU   X'00'                                             S20202 09600002
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      20201  09750002
READSC   EQU   X'22'                    READ SECTOR CCW CMND     YM5355 09800002
TICNOP   EQU   X'88'                    RCD READY NOP TIC CMND   20201  09850002
SKIP     EQU   4                        SKIP OFFSET        IOS RETURN   10000002
EXCP     EQU   8                        EXCP OFFSET        IOS RETURN   10050002
MIOBCHP  EQU   56                       MIOB OFFSET TO CHP       20201  10300002
*                                                                       10350002
* DISPLACEMENTS AS EQUATES                                              10400002
*                                                                       10450002
D0       EQU   0                        DISPLACEMENT OF 0        20201  10500002
D5       EQU   5                        DISPLACEMENT OF 5        20201  10600002
D4       EQU   4                        DISPLACEMENT OF 4        20201  10650002
D8       EQU   8                        DISPLACEMENT OF 8        20201  10700002
* BYTE COUNTS AS EQUATES                                                10750002
B3       EQU   3                        BYTE COUNT OF 3          20201  10850002
D25      EQU   25                       DISPLACEMENT OF 25       20201  10900002
D81      EQU   81                       RR LAST TIC MIOB OFFSET  20201  10950002
*                                                                       11050002
PCIBYTE  EQU   28                                                       11100002
RONGSIZE EQU   X'40'                    CHECKS CSW...INCORRECT LENGTH   11350002
CHEND    EQU   X'08'                     *    *     CHANNEL END         11400002
UNITEXC  EQU   X'01'                     *    *     UNIT EXCEPTION      11450002
UNITCHEK EQU   X'02'                     *    *     UNIT CHECK          11500002
ERRORS   EQU   X'3F'                     * PROGRAM, PROTECTION, XA02374 11550002
* CHANNEL DATA, CHANNEL CONTROL, INTERFACE CONTROL AND CHAINING CHECKS  11600002
*                                                                       11650002
* NOTE:    USE ERRORS  MASK  WITH BYTE 2 OF 2ND                         11700002
*          HALF OF CSW--- UNITCHEK, CHEND, AND                          11750002
*          UNITEXC ARE MASKS FOR BYTE 1 OF STATUS FIELD.                11800002
*                                                                       11850002
CC       EQU   X'40'                    CHAIN COMMAND FLAG              12000002
OUTNOP   EQU   X'03'                                                    12200002
INNOP    EQU   X'02'                                                    12250002
SAVE13   EQU   52                       OFFSET TO REG 13 IN SA   Y02072 12350002
SAVE14   EQU   56                       OFFSET TO REG 14 IN SA   Y02072 12400002
SAVE15   EQU   60                       OFFSET TO REG 15 IN SA   Y02072 12450002
VCKECB   EQU   X'00'                    VALIDITY CHECK ECB MASK  Y02072 12650002
ENTRAGAN EQU   X'20'                    SECOND TIME ENTERED IND SA61524 12660002
         EJECT                                                          12700002
         USING IOBSTDRD,RIOB                                            12800002
*                                                                       12850002
*  PCI ENTRY                                                            12900002
*                                                                       12950002
         OI    PCIBYTE(RIOB),IOBPCI                                     13000002
*                                                                       13100002
* CHANNEL END OR ABNORMAL END ENTRY POINT.                              13150002
*                                                                       13200002
         DROP  BASR                                                     13250002
         BALR  BASR,R0                  FORCE BASE REG TO * +2          13300002
         USING *,BASR                   BASE REGISTER            Y02072 13350002
         SPACE                                                          13400002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 13402002
         DC    C'IGG019V6'              MODULE NAME              Y02072 13410002
         DC    C' ZA33346'              LAST SHIP CODE         @ZA18996 13420037
         DC    C'&SYSDATE'              LAST DATE MODIFIED     @ZA18996 13430037
BEGIN    DC    0H'0'                                             Y02072 13440037
         SPACE                                                          13442002
         TM    IOBFLAG1,IOBSPSVC        SVC MODULE ISSUED EXCP   Y02072 13450002
         BOR   RETR                     YES, NORMAL RETURN TO    Y02072 13550002
*                                        EXCP                    Y02072 13600002
         STM   R0,R15,0(RSAVE)          SAVE ALL REGISTERS       Y02072 13700002
         SPACE                                                          13750002
*    CHANGE THE KEY TO THAT SPECIFIED IN RQE                     Y02072 13800002
         MODESET KEYADDR=RQEPRT,WORKREG=10  ISSUE MODESET        Y02072 13850002
         SPACE                                                          13900002
         LA    RWRK1,IOBSTDRD-IOBPREFX  LENGTH OF PREFIX                13950002
         SR    RIOB,RWRK1               GET ADDRESS OF IOB PREFIX       14000002
         USING IOBPREFX,RIOB                                            14050002
         L     RWRK1,IOBCSW-1           GET COMMAND ADDRESS -  @ZA11126 14060037
         LA    RWRK1,NULL(RWRK1)        CLEAR THE HI BYTE   -  @ZA11126 14066037
         LTR   RWRK1,RWRK1              IS THE CSW ZERO ??     @ZA11126 14072037
         BNZ   TEST3211                 NO  BRANCH             @ZA11126 14078037
* IF A CSW OF ZERO IS PRESENT-THE FIRST ICB WILL BE POSTED WITH@ZA11126 14084037
* A PERMENANT ERROR SINCE IT IS IMPOSSIBLE TO DETERMINE THE    @ZA11126 14090037
* SOURCE OF THE INTERRUPT                                      @ZA11126 14096037
         SR    R5,R5                    CLEAR REGISTER         @ZA11126 14102037
         L     RWRK2,IOBCICB            GET ADDR OF 1ST ICB    @ZA11126 14108037
         LA    RWRK2,NULL(RWRK2)        CLEAR HIGH ORDER BYTE  @ZA11126 14114037
         B     PCIN5                                           @ZA11126 14120037
TEST3211 EQU   *                                               @ZA11126 14126037
         CLI   DCBDEVT,DCBDVPR3         TEST FOR 3211          @ZA11126 14132037
         BNE   NPATH                    NO DON'T NEED RETRY       M6373 14150002
*                                                                       14200002
*  IF THE DEVICE IS A 3211 THE FOLLOWING CODE SCHEDULES THE             14250002
*  ASYNCHRONOUS ROUTINE IGG019FS WHEN ERROR RECOVERY IS POSSIBLE        14300002
*                                                                       14350002
         LA    RWRK2,EIGHT              GET DECREMENT             M6373 14500002
         SR    RWRK1,RWRK2              POINT AT COMMAND          M6373 14550002
         CLI   NULL(RWRK1),UCSLOAD      UCS LOAD COMMAND          M6373 14600002
         BE    NRETIOS                  YES RETURN TO IOS         M6373 14650002
         CLI   NULL(RWRK1),SKIP0        SKIP TO CHANNEL 0 COMMAND M6373 14700002
         BE    NRET                     YES RETURN TO IOS         M6373 14750002
         CLI   NULL(RWRK1),FOLD         FOLD COMMAND              M6373 14800002
         BE    NRETIOS                  YES RETURN TO IOS         M6373 14850002
         TM    IOBCSW+3,ERR1            TEST FOR UNIT CHECK       M6373 14950002
         BNZ   SEEIF2                   YES SEE IF 2ND ENTRY      M6373 15000002
         TM    IOBCSW+4,ERR2            TEST FOR ANY OTHER ERRORS M6373 15050002
         BNZ   SEEIF2                   YES SEE IF 2ND ENTRY      M6373 15100002
         TM    IOBRFLAG,RETRY           DID WE JUST RETRY               15150002
         BZ    NPATH                    NO TAKE NORNAL PATH       M6373 15200002
*                                                                       15250002
* A RETRY HAS BEEN SUCCESSFULLY ISSUED. THE NORMAL PATH IS TAKEN.       15300002
*                                                                       15350002
         NI    IOBRFLAG,RTRYOFF         TURN OFF RETRY FLAG             15400002
         B     NPATH                    TAKE NORMAL PATH          M6373 15450002
*                                                                       15500002
NRET     NI    IOBRFLAG,SKIPOFF         TURN SKIP FLAG OFF              15550002
NRETIOS  EQU   *                                                        15600002
         MODESET EXTKEY=ZERO            RESTORE THE IOS KEY      Y02072 15650002
         LM    R0,R15,0(RSAVE)          RESTORE THE REGISTERS    Y02072 15700002
         BR    RETR                     RETURN TO IOS             M6373 15750002
*                                                                       15800002
SEEIF2   TM    IOBECBCC,ENTRAGAN        SECOND TIME ENTERED     SA61524 15850002
         BZ    YES2                     YES BRANCH                M6373 15900002
*                                                                       15950002
         TM    IOBRFLAG,RETRY           DID WE JUST DO RETRY?           16000002
         BNZ   NPATH                    YES, TAKE NORMAL PATH     M6373 16100002
         CLI   IOBSENS1,SENSFAIL        SEE IF BAD SENSE BYTES @ZA00971 16110037
         BNE   NPATH                    BR IF SIMULATED SENSE  @ZA00971 16120037
         TM    IOBSENS1,CMNDRTRY        IS COMMAND RETRYABLE      M6373 16150037
         BZ    NPATH                    NO,  GET OUT              M6373 16200002
         B     NRETIOS                  GO GET OUT                M6373 16250002
*                                                                       16300002
YES2     EQU   *                       ERPS HAVE JUST GIVEN UP @ZA00971 16310037
         CLI   IOBSENS1,SENSFAIL       SEE IF SENSE BYTES VALID@ZA00971 16320037
         BE    NPATH                   BR IF BAD SENSE BYTES   @ZA00971 16340037
         TM    IOBSENS1,CMNDRTRY        IS COMMAND RETRYABLE    SA61524 16350037
         BO    CANBE                    YES                       M6373 16400002
         NI    IOBRFLAG,RTRYOFF         TURN OFF RETRY FLAG             16450002
         B     NPATH                    TAKE NORMAL PATH          M6373 16500002
*                                                                       16550002
CANBE    TM    IOBRFLAG,RETRY           JUST DO RETRY                   16600002
         BZ    GORETRY                  NO SET UP TO DO IT        M6373 16650002
*                                                                       16700002
         NI    IOBRFLAG,RTRYOFF         TURN OFF RETRY FLAG             16750002
         OI    IOBRFLAG,SKIPFLAG        INDICATE SKIP TO 0              16800002
         BAL   RWRK6,SCHEDIT            SCHEDULE ASYNCH RTN       M6373 16850002
         B     NPATH                                              M6373 16900002
*                                                                       16950002
GORETRY  OI    IOBRFLAG,RETRY           TURN ON RETRY FLAG              17000002
         BAL   RWRK6,SCHEDIT            SCHEDULE IGG019FS         M6373 17050002
         MODESET EXTKEY=ZERO            RESTORE THE IOS KEY      Y02072 17100002
         LM    R0,R15,0(RSAVE)          RESTORE REGS             Y02072 17150002
         B     12(RETR)                 RETURN TO IOS; KEEP RQE; DON'T  17200002
*                                       POST                      M6373 17250002
SCHEDIT  EQU   *                                                        17300002
         LR    RWRK7,RSAVE              SAVE THE SAVE AREA PTR   Y02072 17350002
         L     BASR,CVTPTR                                        M6373 17400002
         L     BASR,4(BASR)             GET ADDR EXIT EFFECTOR    M6373 17450002
         SPACE 2                                                        17500002
*********************************************************************** 17550002
*    CHANGE THE KEY BACK TO IOS KEY BEFORE BRANCH TO EXIT EFFECTOR      17600002
*********************************************************************** 17650002
         SPACE                                                          17700002
         MODESET EXTKEY=ZERO            RESTORE THE IOS KEY      Y02072 17750002
         SPACE                                                          17800002
         BALR  RETR,BASR                PUT IQE OF LIST           M6373 17850002
         SPACE                                                          17900002
         LM    RSAVE,BASR,SAVE13(RWRK7) RESTORE THE REGS         Y02072 17950002
*********************************************************************** 18000002
*    CHANGE THE KEY TO THAT SPECIFIED IN RQE                            18050002
*********************************************************************** 18100002
         SPACE                                                          18150002
         MODESET KEYADDR=RQEPRT,WORKREG=10   ISSUE MODESET       Y02072 18200002
         SPACE                                                          18250002
         BR    RWRK6                    RETURN TO CALLER          M6373 18300002
         EJECT                                                          18302002
*********************************************************************** 18304002
*        FIRST THE ICB IN WHICH THE INTERUPT OCCURRED MUST BE FOUND.  * 18306002
*        THIS IS ACCOMPLISHED BY COMPARING THE ADDRESS IN THE IOBCSW  * 18308002
*        TO THE BEGINNING AND ENDING ADDRESSES OF THE ICBS.  THE MAIN * 18310002
*        IOB AND THE ICBS ARE ARRANGED IN CORE AS FOLLOWS.            * 18312002
*                                                                     * 18314002
*        ________________________________________________________     * 18316002
*        |                                                      |     * 18318002
*        |           MAIN IOB                                   |     * 18320002
*        | - - - - - - - - - - - - - - - - - - - - - - - - - - -|     * 18322002
*        |       MAIN IOB CCWS  (DIRECT ACCESS ONLY)            |     * 18324002
*        |______________________________________________________|     * 18326002
*        |                                                      |     * 18328002
*        |           FIRST ICB                                  |     * 18330002
*        | - - - - - - - - - - - - - - - - - - - - - - - - - - -|     * 18332002
*        |       FIRST ICB CCWS                                 |     * 18334002
*        |______________________________________________________|     * 18336002
*        |                                                      |     * 18338002
*        |           SECOND ICB                                 |     * 18340002
*        | - - - - - - - - - - - - - - - - - - - - - - - - - - -|     * 18342002
*        |       SECOND ICB CCWS                                |     * 18344002
*        |______________________________________________________|     * 18346002
*        ////////////////////////////////////////////////////////     * 18348002
*        ________________________________________________________     * 18348402
*        |                                                      |     * 18348802
*        |           LAST ICB                                   |     * 18349202
*        | - - - - - - - - - - - - - - - - - - - - - - - - - - -|     * 18349602
*        |       LAST ICB CCWS                                  |     * 18349702
*        |______________________________________________________|     * 18349802
*                                                                     * 18349902
*        IF THE CSW ADDRESS IS LESS THAN THE ICB BEGINNING ADDRESS    * 18351902
*        THEN THIS CANNOT BE THE ICB THAT THE INTERUPT OCCURED ON.    * 18352302
*        IF THE CSW ADDRESS IS GREATER THEN THE ICB BEGINNING         * 18352702
*        ADDRESS IT IS THEN COMPARED TO THE ENDING ADDRESS. IF IT     * 18353102
*        IS ALSO LESS THEN THE ENDING ADDRESS THEN THIS IS THE ICB    * 18353502
*        THAT HAD THE INTERUPT.  EACH ICB BEFORE THE INTERUPT IS      * 18353602
*        HANDLED AS SUCCESSFUL.  THE IOBCICB POINTER IS UPDATED AND   * 18353702
*        THE ICB CCWS ARE REMOVED FROM THE CHAIN. THE ICBECB IS ALSO  * 18353802
*        POSTED AS COMPLETE WITH NO ERRORS.  WHEN THE ICB IN WHICH    * 18355802
*        THE INTERUPT OCCURRED IS FOUND IT IS HANDLED AT PCIN5.       * 18356202
*                                                                     * 18356602
*********************************************************************** 18357002
NPATH    EQU   *                                                  M6373 18357802
         TM    0(RIOB),IOBBKSPC         WAS LAST I/O OPER A      A32514 18400002
*                                        POINT?                  A32514 18450002
         BO    NRETIOS                  YES, RETURN TO IOS       Y02072 18500002
NOTPOINT EQU   *                        POINT NOT LAST IO        A32514 18900002
         L     RWRK1,24(RIOB)           PICK UP CCW AD.FROM CSW         18950002
         LA    RWRK1,0(RWRK1)                                           19000002
         SR    R5,R5                    CLEAR FOR THE NOP OFFSET. 12356 19050002
         L     RWRK2,FIRSTICB(RIOB)     GET ICB ADDR.             12295 19100002
         LA    RWRK2,0(RWRK2)           CLEAR HI BYTE.            12295 19150002
         LA    RINSERT,X'30'(0,RIOB)    GET END OF BASIC MAIN IOB       19200002
         TM    DCBDEVT,DABIT            IS THIS DIRECT ACCESS           19250002
         BZ    AROUND                   NO  GO AROUND                   19300002
         LA    RINSERT,X'30'(RINSERT)   ADD TO COMPENSATE FOR D.A.      19350002
AROUND   EQU   *                                                        19400002
         CR    RWRK1,RINSERT            COMPARE CSW ADDR TO END ADDR    19450002
         BH    OK                       IF GREATER ,OK, GO ON           19500002
         TM    PCIBYTE+16(RIOB),IOBPCI  PCI ENTRY                M4587  19550002
         MVI   PCIBYTE+16(RIOB),X'00'   RESTORE INC FLD TO ZERO         19600002
         BO    EXITNORM                 BRANCH IF PCI ENTRY      M4587  19650002
         LA    RINSERT,X'38'(0,RIOB)                                    19700002
         B     PCIN16             CSW IS IN MAIN IOB OR IOS/ERPS  23228 19750002
* FOR MVS WE MUST DETERMINE IF THE INTERRUPT IS GREATER        @ZA02259 19800037
* THAN THE END OF THE ICB STRING AS THE ERPS CAN INTERRUPT     @ZA02259 19802037
* WITH AN ADDRESS FROM THE HIGH RANGE.                         @ZA02259 19804037
OK       EQU   *                                               @ZA02259 19806037
         SR    R6,R6              ZERO REG 6                   @ZA02259 19808037
         SR    R7,R7              ZERO REG 7                   @ZA02259 19810037
         SR    R8,R8              ZERO REG 8                   @ZA02259 19812037
         IC    R8,DCBBUFNO        PUT BUFFER NUMBER IN REG 8   @ZA02259 19814037
         TM    DCBCIND2,DCBCNQSM  ARE WE RUNNING QSAM ???      @ZA02259 19816037
         BO    *+8                BRANCH FORWARD IF YES        @ZA02259 19818037
         IC    R8,DCBNCP          PUT BSAM NCP IN REG 8        @ZA02259 19820037
         IC    R7,DCBIOBL         PUT IOB LENGTH IN REG 7      @ZA02259 19822037
         SLA   R7,3(0)            MULTIPLY BY 8                @ZA02259 19824037
         MR    R6,R8              GET TOTAL LENGTH             @ZA02259 19826037
         AR    R7,RINSERT         ADD IOB END TO TOTAL         @ZA02259 19828037
         CR    RWRK1,R7           COMPARE TOTAL TO CSW         @ZA02259 19830037
         BH    PCIN16             IT IS HIGH SO THE CSW        @ZA02259 19832037
* SHOWS THE INTERRUPT DID NOT COME FROM THE ICB STRING         @ZA02259 19834037
         OC    0(1,RIOB),PCIBYTE+16(RIOB) MOVE THE FLAG FROM            19850002
*                                       TEMP STORAGE                    19900002
         MVI   PCIBYTE+16(RIOB),X'00'   CLEAR FLAG                      19950002
*                                        LEAVE THIS EXIT.               20000002
         SR    RINSERT,RINSERT                                          20050002
         TM    0(RWRK2),IOBWRITE        IS THIS OUTPUT                  20100002
         BO    OUT001                   YES,BRANCH AROUND               20150002
         TM    DCBCIND1,DCBCNEVA        IS VOLUME FULL BIT ON           20200002
         BNO   OUT001                   NO, BRANCH                23771 20250002
         TM    0(RIOB),IOBPCI           TEST FOR PCI             A32541 20300002
         BO    EXITNORM                 BRANCH IF PCI            A32541 20350002
         OI    28(RIOB),UNITEXC         TURN ON UNIT EXCEPTION    23771 20400002
         B     PCIN8AA                                            23771 20450002
OUT001   EQU   *                                                        20500002
PCIN0    EQU   *                                                        20550002
         CR    RWRK1,RWRK2              COMPARE CSW ADDRESS TO ICB PTR. 20600002
         BH    PCIN1A                   BRANCH IF CSW HIGH        19395 20650002
PCIN1B   EQU   *                                                        20700002
         LR    RWRK1,RWRK2                                              20750002
         BAL   R8,OUTIN                 GO GET NOP                      20800002
         AR    RWRK1,R5                 COMPUTE NOP ADDRESS             20850002
         ST    RWRK1,16(RWRK2)          STORE IN ICB CSW       @ZA18996 20860037
         XC    22(2,RWRK2),22(RWRK2)    ZERO CSW COUNT         @ZA18996 20870037
         MVI   20(RWRK2),CHEND          CHANNEL END TO ICB CSW @ZA18996 20880037
         L     RWRK3,0(RWRK2)           GET NEXT ICB PTR                20900002
         L     RWRK3,CPSTART(RWRK3)     GET CHANNEL PROGRAM START       20950002
*                                        ADDRESS OF NEXT ICB.           21000002
         CLI   IOBCCW,SETSC            IS THIS AN RPS DEVICE?  @ZA11106 21010037
         BNE   NOTRRA                   BRANCH NO              @ZA11106 21020037
         CLI   D8(RWRK1),READSC         NEXT COMND READ SECTOR   YM5355 21050002
         BNE   NOTRRA                   BRANCH NO                20201  21100002
         ST    RWRK3,D4(RWRK1)          PUT ADDR IN RH NOP/TIC   20201  21150002
         LA    RINSERT,D8(RWRK1)        RD SECTOR ADDR           20201  21200002
         ST    RINSERT,D0(RWRK1)        PUT IN CCW               20201  21250002
         MVI   D0(RWRK1),TICNOP         PUT IN TICNOP CMND       20201  21300002
         B     FEATA                    GO AROUND NEXT           20201  21350002
NOTRRA   EQU   *                                                 20201  21400002
         ST    RWRK3,0(RWRK1)           STORE NEXT ICBS C.P.STARTAD     21450002
*                                        IN THIS ICBS  NOP CCW          21500002
         MVI   0(RWRK1),NOP             CHANGE TIC TO NOP               21550002
FEATA    EQU   *                                                 20201  21600002
         LA    RINSERT,8                                                21650002
         SR    RWRK1,RINSERT            GET CCW BEFORE NOP              21700002
         OI    4(RWRK1),CC              TURN ON CC FLAG IN IT           21750002
         LA    RWRK1,8(RWRK1)                                           21800002
         TM    DCBDEVT,TAPE             IS IT TAPE                      21850002
         BZ    PCIN2                    NO, BRANCH AROUND               21900002
         LH    RWRK3,INCREMNT(RWRK2)    PICK UP BLOCK COUNT INCREMENT   21950002
         A     RWRK3,DCBBLKCT           UPDATE BLOCK COUNT              22000002
         ST    RWRK3,DCBBLKCT           AND RETURN IT.                  22050002
PCIN2    EQU   *                                                        22100002
         SR    RETR,RETR                CLEAR 14 SO POST ROUTINE        22150002
*                                        WILL POST  7F                  22200002
         EJECT                                                          22500002
*********************************************************************** 22550002
*                                                                       22600002
*   SET UP TO POST ECB                                                  22650002
*                                                                       22700002
*       REG 10   COMPLETION CODE WITH WHICH TO POST                     22710002
*       REG 11   ADDRESS OF ECB TO BE POST'ED                           22800002
*       REG 13   ADDR OF A 16 FW REGISTERS SAVEAREA TO BE USED BY POST  22900002
*                                                                       23150002
*       TO USE THE POST SUBROUTINE AS A CLOSED SUBROUTINE,              23350002
*       BAL   6,PCIN3+4        AND SET THE CONDITION TO EITHER          23400002
*       X'7F'  OR X'41'  BY USING REG 14 AS AN INDICATOR.               23450002
*       IF REG 14 = 0, POST ECB AS 7F                                   23500002
*       IF REG 14 = NOT ZERO, POST ECB AS 41                            23550002
*                                                                       23600002
*********************************************************************** 23610002
         SPACE                                                          23700002
         LA    R6,PCIN3B                GET ADDRESS TO LEAVE SUBRT      23900002
PCIN3AA  EQU   *                                                        23950002
         LR    RWRK7,RWRK2              SAVE ICB POINTER         Y02072 23960002
         L     RWRK2,ECBPTR(RWRK2)      GET ECB PTR OF ICB              24200002
         LA    RWRK2,0(RWRK2)           CLEAR HI-ORDER BYTE       M0477 24250002
         SPACE                                                          24300002
         USING ECB,RWRK2                ECB REGISTER             Y02072 24350002
         SPACE                                                          24400002
*    VALIDITY CHECK ECB BEFORE BRANCH TO POST SO THAT WHEN THE          24450002
*    KEYS ARE NOT THE SAME IT WILL CAUSE PROGRAM CHECK                  24500002
         L     R10,ECBCC                VALIDITY CHECK ECB     @ZA11654 24550037
CSWP     CS    R10,R10,ECBCC            LOCK ON ECB            @ZA11654 24560037
         BNE   CSWP                     ECB CHANGED BY WAIT    @ZA11654 24570037
         SPACE                                                          24600002
         DROP  RWRK2                                                    24650002
         SPACE                                                          24700002
         L     R10,ECBNORMW             ASSUME ECB OK, LOAD POST YM1002 24750002
*                                        CODE OK WORD            Y02072 24760002
         LTR   RETR,RETR                IS ECB TO BE X'41'              24800002
         BZ    SEVENF                   NO,BRANCH                       24850002
         L     R10,ECBPERRW             LOAD IN ERROR CONDITION  YM1002 24900002
*                                        CODE WORD               Y02072 24950002
         SPACE                                                          24960002
*********************************************************************** 25600002
*    CHANGE THE KEY BACK TO IOS KEY BEFORE BRANCH TO POST               25650002
*********************************************************************** 25700002
         SPACE                                                          25750002
SEVENF   MODESET EXTKEY=ZERO            RESTORE THE IOS KEY      Y02072 25800002
         EJECT                                                          25810002
         PUSH  USING                                                    25820002
         LR    RWRK3,R6                 SAVE SUBROUTINE RET PT   Y02072 25830002
         LM    R0,R8,0(RSAVE)           RESTORE INPUT REGS       Y02072 25840002
         L     RETR,SAVE14(RSAVE)       RESTORE RETURN TO IOS    Y02072 25850002
*                                        ADDRESS                 Y02072 25860002
         PCIPOST ECB=(11),SVAREA=(13),RQE=(1),CODE=(10) POST     Y02072 25870002
         STM   R0,R15,0(RSAVE)          RESTORE REGS IN SAVEAREA Y02072 25880002
*                                        TO INPUT ORDER          Y02072 25890002
         LR    RWRK2,RWRK7              RESTORE ICB PTR          Y02072 25892002
         LR    R6,RWRK3                 RESTORE SUBRTN RETURN PT Y02072 25900002
         LA    RWRK3,IOBSTDRD-IOBPREFX  PREFIX LENGTH            Y02072 25910002
         SR    RIOB,RWRK3               IOB PREFIX               Y02072 25920002
         SR    R5,R5                    CLEAR REGISTER           Y02072 25930002
         POP   USING                                             Y02072 25940002
*    CHANGE THE KEY TO THAT SPECIFIED IN RQE                     Y02072 25950002
         MODESET KEYADDR=RQEPRT,WORKREG=14  ISSUE MODESET        Y02072 26000002
         SPACE                                                          26050002
         BR    R6                       GET OUT OF POST SUBROUTINE      26250002
PCIN3B   EQU   *                                                        26300002
         MVC   9(3,RIOB),1(RWRK2)       MOVE NEXT ICB ADDR.TO M.IOB     26350037
         L     RWRK1,24(RIOB)           PICK UP CCW ADDRESS FROM CSW    26650002
         LA    RWRK1,0(RWRK1)           CLEAR HIGH BYTE                 26700002
         L     RWRK2,0(RWRK2)           PICK UP NEXT ICB ADDR.FOR NEXT  26750002
*                                        TIME THROUGH LOOP              26800002
         LA    RWRK2,0(RWRK2)           CLEAR HIGH BYTE                 26850002
*                                        RWRK1 HAS CSW'S CCW ADDRESS    26900002
         B     PCIN0                                                    26950002
         SPACE 2                                                        27000002
PCIN1A   EQU   *                                                        27050002
*                                       COME HERE IF CSW  ADDRESS       27100002
*                                       IS GREATER THAN OR EQUAL        27150002
*                                       TO ICB POINTER.                 27200002
         BAL   R8,OUTIN                 GO GET NOP OFFSET               27250002
         LA    RWRK3,8(R5,RWRK2)        GET NOP ADDRESS + 8             27300002
         CLI   IOBCCW,SETSC            IS THIS RPS DEVICE?     @ZA11106 27310037
         BNE   NOTRRD                   BRANCH NO              @ZA11106 27320037
         CLI   0(RWRK3),READSC          NEXT CMND READ SECTOR    YM5355 27350002
         BNE   NOTRRD                   BRANCH NO                20201  27400002
         LA    RWRK3,D8(RWRK3)          INCR FOR RD SECTOR       20201  27450002
NOTRRD   EQU   *                                                 20201  27500002
         CR    RWRK1,RWRK3              COMPARE CSW ADDRESS TO ICB+OFFS 27550002
         BH    PCIN1B                   CSW GREATER--BRANCH             27600002
*                                       CSW ADDRESS IS LESS THAN        27700002
*                                       OR EQUAL TO ICB + 8 + NOP OFFS  27750002
         TM    0(RIOB),IOBPCI           WAS THIS PCI ENTRY              27800002
         BO    EXITNORM                 BRANCH IF PCI                   27850002
*                                        FALL THROUGH IF NOT PCI        27900002
         EJECT                                                          27950002
*********************************************************************** 28140037
*        COME HERE IF CHANNEL END FOUND                                 28160037
*********************************************************************** 28180037
PCIN5    MVC   16(6,RWRK2),24(RIOB)     MOVE CSW INTO ICB BECAUSE C.E.  28200037
*                                       WAS FOUND.  RWRK2 HAS ICB ADDR. 28250002
         XC    22(2,RWRK2),22(RWRK2)    ZERO CSW COUNT                  28300002
         MVC   10(2,RWRK2),18(RIOB)     MOVE IN 2 SENSE BYTES           28350002
         TM    30(RWRK2),X'80'          IS SPECIAL VOL FULL BIT ON      28400002
         BZ    PCIN5A                   NO, BRANCH             @ZA26933 28450037
         OI    20(RWRK2),UNITEXC        SET UNIT EXCEPTION IN  @ZA26933 28460037
         OI    28(RIOB),UNITEXC         IOB AND ICB            @ZA26933 28470037
         B     PCIN6A                   PROCESS UNIT EXCEPTION @ZA26933 28480037
PCIN5A   TM    28(RIOB),UNITEXC         TEST FOR UNIT EXCEPTION@ZA26933 28490037
         BNO   PCIN7                    BRANCH IF NOT UNIT EXCEP.       28550002
         TM    DCBDEVT,TAPE             IS THIS TAPE                    28600002
         BNO   NOTAPE3                  NO  GO AROUND                   28650002
         TM    28(RIOB),UNITCHEK        IS THERE A UNIT CHECK           28700002
         BNO   NOTAPE3                  NO  GO AROUND                   28750002
         TM    0(RWRK2),IOBWRITE        IS THIS OUTPUT?        @ZA26933 28760037
         BZ    PCIN7                    NO, BRANCH             @ZA33346 28770037
         OI    30(RWRK2),X'80'          TURN ON SPECIAL VOL FULL BIT    28800002
         B     PCIN7                    GO TO UNIT CHECK HANDLER        28850002
NOTAPE3  EQU   *                                                        28900002
         TM    DCBDEVT,X'40'            IS UNIT RECORD  USED            28950002
         BZ    PCIN6A                   NO BRANCH                       29000002
         TM    0(RWRK2),IOBWRITE        IS THIS OUTPUT                  29050002
         BNO   PCIN6A                   NO, BRANCH                26016 29100002
         SH    RWRK1,CON8               POINT TO COMMAND CODE     26016 29150002
         TM    0(RWRK1),X'03'           SPACE ONLY COMMAND        26016 29200002
         BO    RESTWRT                  YES, BRANCH            @ZA08874 29250037
         B     PCIN7                                              26016 29300002
PCIN6A   EQU   *                                                        29350002
*                                       UNIT EXCEPTION FOUND OR         29400002
*                                       ERROR WAS PROCESSED ALREADY     29450002
         NI    30(RWRK2),X'7F'          TURN OFF ''SPECIAL VOL FULL''   29500002
         NI    0(RIOB),255-IOBABAPP     TURN OFF ERROR INDICATOR        29550002
         MVC   FIRSTICB+1(3,RIOB),1(RWRK2) MOVE LINK FLD TO MAINIOB     29600002
         MVI   4(RIOB),ECBPERR          SET IOB COMPLETE IN ERROR       29650002
         LA    RETR,ECBPERR             SET FLAG TO REFLECT CC=41       30000002
         BAL   R6,PCIN3AA               GO TO POSTING SUBROUTINE        30050002
         TM    DCBDEVT,DABIT            TEST FOR DIRECT ACCESS          30150002
         BO    PCIN6C                   YES IT IS- BRANCH               30200002
         L     RWRK3,0(RWRK2)           GET NEXT ICB                    30300002
         MVC   33(3,RIOB),25(RWRK3)     MOVE CHANNEL PROG START ADDRESS 30350002
*                                       FROM ICB TO MAINIOB             30400002
         TM    DCBDEVT,TAPE             IS TAPE BEING USED              30450002
         BZ    NOTAPE1                  NO BRANCH                       30500002
         TM    0(RWRK2),IOBWRITE        IS THIS OUTPUT            17438 30550002
         BO    UPDATE                   YES, UPDATE BLK CNT       17438 30600002
         TM    28(RIOB),UNITEXC         IS THIS UNIT EXCEPTION          30650002
         BO    NOTAPE1                  YES,DON'T UPDATE BLOCK COUNT    30700002
UPDATE   LH    RWRK3,28(RWRK2)          UPDATE THE BLOCK          17438 30750002
         A     RWRK3,DCBBLKCT           COUNT IN THE DCB USING          30800002
         ST    RWRK3,DCBBLKCT           INCREMENT IN DCB PTR IN ICB     30850002
NOTAPE1  EQU   *                                                        30900002
         B     PCIN6D                                                   30950002
PCIN6C   EQU   *                                                        31000002
         L     RWRK3,0(RWRK2)           GET NEXT ICB                    31050002
         MVC   48(8,RIOB),32(RWRK3)     MOVE NEXT ICB'S FDAD TO MAINIOB 31100002
         CLI   MIOBCHP(RIOB),SETSC      RCD READY CHP            20201  31150002
         BNE   PCIN6CX                  BRANCH IF NO             20201  31200002
         MVC   D81(B3,RIOB),D25(RWRK3)  MOVE CHP START TO TIC    20201  31250002
*                                       MIOB                     20201  31300002
         B     PCIN6CY                  BRANCH AROUND            20201  31350002
PCIN6CX  EQU   *                                                 20201  31400002
         MVC   73(3,RIOB),25(RWRK3)     MOVE CHANNEL PROGRAM START      31450002
*                                        ADDRESS FROM ICB TO FINAL TIC  31500002
*                                        OF MAINIOB                     31550002
PCIN6CY  EQU   *                                                 20201  31600002
PCIN6D   EQU   *                                                        31650002
         BAL   R8,OUTIN                 GO GET NOP OFFSET               31700002
         LA    RWRK3,0(R5,RWRK2)        GET NOP ADDRESS OF ERR ICB      31750002
         L     RWRK4,0(RWRK2)           GET NEXT ICB PTR                31800002
         L     RWRK4,24(RWRK4)          GET CHANNEL PRG.START ADDRESS   31850002
*                                        OF NEXT ICB.                   31900002
         CLI   IOBCCW,SETSC            IS THIS AN RPS DEVICE?  @ZA11106 31910037
         BNE   NOTRRH                   BRANCH NO              @ZA11106 31920037
         CLI   D8(RWRK3),READSC         READ SECTOR CMND NEXT    YM5355 31950002
         BNE   NOTRRH                   BRANCH NO                20201  32000002
         ST    RWRK4,D4(RWRK3)          PUT ADDR IN RH OF        20201  32050002
*                                        TIC/NOP                 20201  32100002
         BAL   R7,NOPTIC                GO BUILD NOP/TIC         20201  32150002
         B     FEATH                    GO AROUND NEXT INSTS     20201  32200002
NOTRRH   EQU   *                                                 20201  32250002
         ST    RWRK4,0(RWRK3)           STORE IN THIS ICBS NOP CCW      32300002
         MVI   0(RWRK3),NOP             MOVE IN A NOP                   32350002
FEATH    EQU   *                                                 20201  32400002
         LA    RINSERT,8                                                32450002
         SR    RWRK3,RINSERT            GET CCW BEFORE NOP              32500002
         OI    4(RWRK3),CC              TURN ON CC FLAG IN IT           32550002
         LA    RWRK3,8(RWRK3)                                           32600002
         TM    0(RIOB),IOBPCI           PCI ENTRY                 19524 32650002
         BO    EXITNORM                 YES, BRANCH               19524 32700002
         B     EXITSKIP                                                 32750002
PCIN7    EQU   *                                                        32800002
*                                       TEST FOR ERRORS.                32850002
*                                       PCI AND UNIT EXCEP. NOT FOUND   32900002
         TM    28(RIOB),UNITCHEK        TEST FOR UNITCHECK              32950002
         BO    PCIN8A                   BRANCH ON YES                   33000002
CHAN9    EQU   *                                                        33050002
         TM    29(RIOB),ERRORS          TEST FOR OTHER ERRORS   XA02374 33100002
         BNZ   NOTPRINT                                           19768 33250002
*                                       ERRORS.                         33300002
         TM    29(RIOB),RONGSIZE        TEST FOR INCORRECT LENTH        33350002
         BNO   PCIN10                   NO BRANCH                       33450002
         TM    0(RWRK2),IOBWRITE        IS THIS OUTPUT                  33550002
         BO    PCIN8AA                  YES....IF OUTPUT WRONG LENGTH   33600002
*                                        GO TO PERM ERROR HANDLER       33650002
         B     PCIN9                    BRANCH TO INPUT LENGTH CHECK    33700002
         SPACE 2                                                        33750002
PCIN8A   EQU   *                                                        33800002
*                                       BEGINNING OF ERROR HANDLING     33850002
*                                       SECTION                         33900002
         TM    DCBDEVT,DCBDVPR1         IS THIS A PRINTER ?             33950002
         BNO   NOTPRINT                 NO, GO ARROUND            15065 34000002
         TM    18(RIOB),X'01'           TEST FOR CHANNEL 9        16550 34050002
         BZ    NOTPRINT                 NO, BRANCH                19768 34100002
         TM    18(RIOB),X'F2'           ERRORS WITH CHANNEL 9     19768 34150002
         BNZ   NOTPRINT                 YES, BRANCH               22216 34200002
         SH    RWRK1,CON8               POINT TO COMMAND CODE     22216 34250002
         TM    0(RWRK1),X'03'           SPACE ONLY COMMAND        22216 34300002
         BNO   CHAN9                    NO, BRANCH                22216 34350002
RESTWRT  EQU   *              WHEN THERE IS A CHAN 12 OR A     @ZA08874 34353037
*                             CHAN 9 ON A PRINTER. THE CHAN    @ZA08874 34356037
*                             PROGRAM WILL BE RESTARTED FROM   @ZA08874 34359037
*                             THE WRITE.                       @ZA08874 34362037
         LA    RWRK1,8(RWRK1)           RESET TO THE WRITE CCW @ZA08874 34365037
         ST    RWRK1,IOBSTART           SET IOBSTART TO WRITE  @ZA08874 34368037
         TM    28(RIOB),X'01'           WAS THIS A CHAN 12     @ZA08874 34371037
         BO    RESTWRT6                 YES-GO SET FLAG        @ZA08874 34374037
         OI    DCBIFLGS,DCBIFC9         NO-SET CHAN 9          @ZA08874 34377037
         B     MOREXIT                  RE-EXCP                @ZA08874 34380037
RESTWRT6 OI    DCBIFLGS,DCBIFC12        SET CHANNEL 12         @ZA08874 34383037
         B     MOREXIT                  RE-EXCP                @ZA08874 34386037
NOTPRINT EQU   *                                                        34400002
         TM    0(RIOB),IOBABAPP         TEST  ERROR PREVIOUSLY PROCESST 34450002
*                                        BIT TO SEE IF THIS IS 2ND PASS 34500002
         BZ    PCIN8B                   NO-FIRST TIME, BRANCH           34550002
PCIN8AA  EQU   *                                                        34600002
         MVC   22(2,RWRK2),30(RIOB)     MOVE IN COUNT RESIDUE           34650002
         NI    0(RIOB),255-IOBABAPP     YES,TURN IT OFF                 34700002
         B     PCIN6A                   AND GO TO PERM ERROR SECTION    34750002
PCIN8B   EQU        *                                                   34800002
*                                       ERROR HAS NOT BEEN              34850002
*                                       PROCESSED BEFORE                34900002
         BAL   R8,OUTIN                 GO GET NOP OFFSET               34950002
         LA    RWRK3,0(R5,RWRK2)        GET NOP ADDRESS                 35000002
         L     RWRK4,0(RWRK2)           GET NEXT ICB POINTER            35050002
         L     RWRK4,24(RWRK4)          GET C P STARTAD OF NEXT ICB     35100002
         TM    0(RWRK3),NOP             IS IT A NOP NOW                 35150002
         BO    PCIN8C                   YES BRANCH                      35200002
         CLI   D8(RWRK3),READSC         READ SECTOR CMND NEXT    YM5355 35250002
         BNE   PCIN8B1                  BRANCH NO                20201  35300002
         ST    RWRK4,D4(RWRK3)          PUT IN RH OF NOP/TIC     20201  35350002
         TM    D0(RWRK3),TICNOP         NOP TIC                  20201  35400002
         BO    PCIN8C2                  BRANCH YES               20201  35450002
         BAL   R7,NOPTIC                GO BUILD NOP/TIC         20201  35500002
         OI    0(RIOB),IOBRSTCH         TURN ON RESTART CHAIN    20201  35550002
*                                        BIT                     20201  35600002
         B     PCIN8C2                  GO AROUND NEXT           20201  35650002
PCIN8B1  EQU   *                                                 20201  35700002
         OI    0(RIOB),IOBRSTCH         TURN ON RESTART CHAIN    20201  35750002
*                                        BIT                     20201  35800002
PCIN8C   EQU   *                                                        35850002
         ST    RWRK4,D0(RWRK3)          PUT ADDR IN NOP          20201  35900002
         MVI   D0(RWRK3),NOP            RESTORE NOP CMND         20201  35950002
PCIN8C2  EQU   *                                                 20201  36000002
*                                       TO PREVENT TIC-ING ON TO AN ICB 36050002
*                                       DURING ERROR RECOVERY, TURN OFF 36100002
*                                       THE CHAIN COMMAND FLAG IN THE   36150002
*                                       CCW JUST BEFORE THE NOP/TIC.    36200002
         LA    RINSERT,8                                                36250002
         SR    RWRK3,RINSERT            GET CCW BEFORE NOP/TIC          36300002
         NI    4(RWRK3),255-CC          TURN OFF CC FLAG IN CCW         36350002
         TM    DCBDEVT,DABIT            TEST FOR DIRECT ACCESS          36400002
         BO    PCIN8D                   YES, BRANCH                     36450002
         MVC   33(3,RIOB),25(RWRK2)     MOVE CHANNEL PROGRAM START ADDR 36500002
*                                        FROM ICB TO MAINIOB            36550002
         B     PCIN8E                                                   36600002
PCIN8D   EQU   *                                                        36650002
         CLI   MIOBCHP(RIOB),SETSC      RCD READ CHP             20201  36700002
         BNE   PCIN8DX                  BRANCH IF NO             20201  36750002
         MVC   D81(B3,RIOB),D25(RWRK2)  MOVE CHP ADDR TO TIC     20201  36800002
*                                       MIOB                     20201  36850002
         B     PCIN8DZ                  BRANCH AROUND NORM MOVE  20201  36900002
PCIN8DX  EQU   *                                                 20201  36950002
         MVC   73(3,RIOB),25(RWRK2)     MOVE CHANNEL PROG START ADDRESS 37000002
*                                        TO FINAL TIC OF MAINIOB        37050002
PCIN8DZ  EQU   *                                                 20201  37100002
         MVC   48(8,RIOB),32(RWRK2)     MOVE MBB--R TO MAINIOB          37150002
PCIN8E   EQU   *                                                        37200002
*                                        ALLOW IOS ERROR RECOVERY       37250002
         OI    0(RIOB),IOBABAPP         TURN ON THE 'ERROR PREVIOUSLY   37300002
*                                        PROCESSED' INDICATOR           37350002
         B     EXITNORM                                                 37400002
PCIN9    EQU   *                                                        37450002
*                                       COME HERE IF WRONG LENGTH       37500002
*                                       INDICATOR IS ON                 37550002
*                                                                       37600002
*                                       A VALID TRUNCATED RECORD HAS A  37650002
*                                       LENGTH WHICH IS A MULTIPLE OF   37700002
*                                       LOGICAL RECORD LENGTH.          37750002
         SR    R6,R6                    CLEAR EVEN REG                  37800002
         LH    R7,30(RIOB)              PUT CSW COUNT RESIDUE IN ODD    37850002
*                                        REG OF EVEN/ODD PAIR           37900002
         LH    RINSERT,DCBLRECL         GET LOGICAL RECORD LENGTH AS    37950002
*                                        DIVISOR                        38000002
         DR    R6,RINSERT               DIVIDE COUNT RESIDUE BY LRECL   38050002
*                                       AFTER THE DIVISION, THE 32 BIT  38100002
*                                       SIGNED REMAINDER IS IN EVEN     38150002
*                                       REG.  (R0) AND THE 32 BIT       38200002
*                                       QUOTIENT IS IN ODD REG(1)       38250002
*                                                                       38300002
*                                       IF A TOO LARGE RECORD IS READ,  38350002
*                                       THE CSW COUNT RESIDUE WILL BE   38400002
*                                       ZERO AND THE INCORRECT LENGTH   38450002
*                                       BIT WILL BE ON.                 38500002
*                                                                       38550002
*                                       IF THE REMAINDER IS GREATER     38600002
*                                       THAN ZERO, IT IS AN INVALID     38650002
*                                       RECORD.                         38700002
*                                       IF THE QUOTIENT IS ZERO,        38750002
*                                       THE DIVIDEND WAS ZERO AND       38800002
*                                       THE RECORD IS WRONG LENGTH.     38850002
*                                                                       38900002
         LTR   R6,R6                    TEST REMAINDER                  38950002
         BP    PCIN8AA                  BRANCH IF REMAINDER    @ZA17184 39000037
*                                        GREATER THAN ZERO.             39050002
         LTR   R7,R7                    TEST QUOTIENT                   39100002
         BZ    PCIN6A                   BRANCH IF QUOTIENT IS ZERO      39150002
         TM    DCBRECFM,DCBRECSB        IS THIS DATASET STANDARD F      39200002
         BZ    PCIN15                   NO BRANCH                       39250002
*                                        STANDARD F INPUT FOUND         39300002
         L     RWRK3,0(RWRK2)           GET NEXT ICB                    39350002
         OI    20(RWRK3),UNITEXC        TURN ON UNIT EXCEPTION          39400002
         OI    20(RWRK3),CHEND          TURN ON CE                      39450002
         OI    DCBCIND1,DCBCNEVA        TURN ON VOL FULL BIT            39500002
         B     PCIN15                                                   39550002
PCIN10   EQU   *                                                        39600002
         L     RWRK3,0(RWRK2)           GET PTR TO NEXT ICB             39650002
         TM    DCBDEVT,X'20'            IS IT DIRECT ACCESS ?           39700002
         BO    PCIN11                   YES, BRANCH                     39750002
         MVC   32(4,RIOB),24(RWRK3)     MOVE CH.P.START ADDR FROM       39800002
*                                        ICB TO THE MAINIOB             39850002
         TM    DCBDEVT,TAPE             IS TAPE BEING USED              39950002
         BZ    NOTAPE2                  NO BRANCH                       40000002
         LH    RWRK3,28(RWRK2)          UPDATE THE BLOCK                40050002
         A     RWRK3,DCBBLKCT           COUNT IN THE DCB USING          40100002
         ST    RWRK3,DCBBLKCT           INCREMENT IN DCB PTR IN ICB     40150002
NOTAPE2  EQU   *                                                        40200002
         B     PCIN12                                                   40250002
PCIN11   EQU   *                                                        40300002
         MVC   48(8,RIOB),32(RWRK3)     MOVE COUNT TO MAINIOB           40350002
         CLI   MIOBCHP(RIOB),SETSC      IS THIS RCD READY CHP    20201  40400002
         BNE   PCIN11X                  NO BRANCH                20201  40450002
         MVC   D81(B3,RIOB),D25(RWRK3)  MOVE CHP ADDR TO MIOB    20201  40500002
*                                        TIC                     20201  40550002
         B     PCIN11Z                  BRANCH AROUND NORM MOVE  20201  40600002
PCIN11X  EQU   *                                                 20201  40650002
         MVC   73(3,RIOB),25(RWRK3)     MOVE CHANNEL PROG START ADDRESS 40700002
*                                        FROM ICB TO FINAL TIC MAINIOB  40750002
PCIN11Z  EQU   *                                                 20201  40800002
PCIN12   EQU   *                                                        40850002
*                                       THIS SECTION SETS IOB AND       40900002
*                                       ICB COMPLETE WITHOUT ERROR      40950002
         SR    RETR,RETR                SET FLAG TO REFLECT CC=7F       41300002
         BAL   R6,PCIN3AA               GO TO POST SUBROUTINE           41350002
         MVC   9(3,RIOB),1(RWRK2)       GET PTR TO NEXT ICB AND         41500002
         LR    RWRK1,RWRK2              SAVE ICB POINTER                41550002
         L     RWRK2,0(RWRK2)           STORE IN '1ST ICB' OF MAINIOB   41600002
         LR    R6,RWRK2                 SAVE CONTENTS                   41650002
         LR    RWRK2,RWRK1              WORK 2 NEEDED IN SUBRT          41700002
         BAL   R8,OUTIN                                                 41750002
         LR    RWRK2,R6                                                 41800002
         LA    RWRK3,0(R5,RWRK1)        GET NOP ADDRESS                 41850002
         CLI   IOBCCW,SETSC            IS THIS AN RPS DEVICE?  @ZA11106 41860037
         BNE   NOTRRP                   BRANCH NO              @ZA11106 41870037
         CLI   D8(RWRK3),READSC         READ SECTOR CMND NEXT    YM5355 41900002
         BNE   NOTRRP                   BRANCH NO                20201  41950002
         MVC   D5(B3,RWRK3),D25(RWRK2)  IN RH OF NOP             20201  42000002
         B     FEATP                    GO AROUND NEXT           20201  42050002
NOTRRP   EQU   *                                                 20201  42100002
         MVC   1(3,RWRK3),25(RWRK2)     MOVE IN NEXT CP STARTAD  A28707 42150002
FEATP    EQU   *                                                 20201  42200002
         LA    RINSERT,8                                                42250002
         SR    RWRK3,RINSERT            GET CCW BEFORE NOP              42300002
         OI    4(RWRK3),CC              TURN ON CC  FLAG IN IT          42350002
         AR    RWRK3,RINSERT            RESTORE PTR              20201  42400002
         TM    0(RIOB),IOBABAPP         HAS ERROR BEEN PREVIOUSLY PRO-  42450002
*                                       CESSED                          42500002
         BNO   PCIN13                   NO, BRANCH                      42550002
         NI    0(RIOB),255-IOBABAPP     TURN ERROR INDICATOR OFF        42600002
         TM    0(RIOB),IOBRSTCH         IS IT NECESSARY TO RESTART A    42650002
*                                        CHAIN OF ICBS                  42700002
         BO    PCIN14                   YES, BRANCH                     42750002
PCIN13   EQU   *                                                        42800002
         NI    16(RIOB),X'FB'           TURN OFF EXCEPTIONAL COND.13298 42850002
         CLI   IOBCCW,SETSC            IS THIS AN RPS DEVICE?  @ZA11106 42860037
         BNE   NOTRRS                   BRANCH NO              @ZA11106 42870037
         CLI   D8(RWRK3),READSC         READ SECTOR COMND NEXT   YM5355 42900002
         BNE   NOTRRS                   BRANCH NO                20201  42950002
         L     RWRK2,MIOBCHP(RIOB)      GET SECTOR ADDRESS       20201  43000002
         TM    D0(RWRK3),TICNOP         TIC NOP CMND             20201  43100002
         BO    CHCKEXIT                 YES, BRANCH AROUND NEXT  20201  43200002
FEATSX   EQU   *                                                 20201  43250002
         BAL   R7,NOPTIC                GO BUILD NOP/TIC         20201  43300002
         B     FEATW                    BRANCH AROUND NEXT       20201  43350002
NOTRRS   EQU   *                                                 20201  43400002
         TM    0(RWRK3),NOP             IS THE CCW NOW A NOP            43450002
         BO    CHCKEXIT                 YES - BRANCH             M6365  43500002
*                                       IF NOT A NOP, FALL THROUGH      43550002
*                                       AND USE THE EXCP EXIT BELOW     43600002
PCIN14   EQU   *                                                        43650002
         CLI   IOBCCW,SETSC            IS THIS AN RPS DEVICE?  @ZA11106 43700037
         BNE   PCIN14A                  BRANCH NO              @ZA11106 43720037
         CLI   D8(RWRK3),READSC         READ SECTOR CMND NEXT    YM5355 43740037
         BE    FEATSX                   BRANCH IF YES            20201  43760037
PCIN14A  EQU   *                        NOT RECORD READY       @ZA11106 43780037
         MVI   0(RWRK3),NOP             MAKE CCW A NOP                  43800002
FEATW    EQU   *                                                 20201  43850002
         NI    0(RIOB),255-IOBRSTCH     TURN OFF CHAIN INDICATOR        43900002
         NI    16(RIOB),X'FB'           TURN OFF EXP COND         19798 43950002
         B     EXCPEXIT                                                 44000002
PCIN15   EQU   *                                                        44050002
         BAL   R8,OUTIN                 GO GET NOP OFFSET               44100002
         LA    RWRK4,0(R5,RWRK2)        GET NOP                         44150002
         ST    RWRK4,16(RWRK2)          STORE IN CSW                    44200002
         MVC   20(4,RWRK2),28(RIOB)     MOVE 2 STATUS BYTES,COUNT AND   44300002
         MVC   10(2,RWRK2),18(RIOB)     TWO SENSE BYTES  TO ICB         44350002
         MVI   24(RIOB),ZERO            ZERO   FLAG3,                   44400002
         XC    46(2,RIOB),46(RIOB)      ERROR COUNT,                    44500002
         NI    16(RIOB),X'C3'          RESET FLAG1 ERRORS        YM5998 44510002
         NI    17(RIOB),X'30'          RESET FLAG2 ERRORS        YM5998 44520002
         NI    DCBIFLGS,X'3F'           ERROR FLAGS ,                   44550002
         MVI   28(RIOB),X'0C'           AND THE STATUS                  44600002
         MVI   29(RIOB),ZERO            ERROR BITS IN CSW               44650002
         B     PCIN10                                             17891 44700002
PCIN16   EQU   *                                                        44750002
         SR    RINSERT,RINSERT                                          44800002
         TM    0(RIOB),IOBABAPP         IS THIS 2ND ENTRY               44850002
         BC    1,PCIN6A                 YES,GO POST PERMANENT ERROR     44900002
*                                        AND GET OUT.                   44950002
*    IF NOT 2ND ENTRY   SET  UP TO DO ERROR RECOVERY                    45000002
         BAL   R8,OUTIN                 GO GET NOP OFFSET               45050002
         L     RWRK2,8(RIOB)            GET 1ST ICB                     45100002
         LA    RWRK3,0(R5,RWRK2)        GET NOP ADDRESS                 45150002
         LA    RINSERT,8                                                45200002
         SR    RWRK3,RINSERT            GET CCW BEFORE NOP/TIC          45250002
         NI    4(RWRK3),255-CC          AND TURN OFF THE CC FLAG        45300002
         B     PCIN8E                   GO SET SOME FLAGS AND RETURN    45350002
*                                        TO IOS TO ERROR RETRY.         45400002
*                                       *** EXITS  ***                  45450002
CHCKEXIT EQU   *                       SEE IF EOB HAVE ADDED     YM6583 45460002
*                                      ANOTHER ICB               YM6583 45470002
         LR    RWRK2,RWRK3             GET NOP ADDRESS           YM6583 45480002
         O     RWRK3,IOBCEXCP          TURN ON EXCP NEEDED FLAG  YM6583 45490002
         CS    RWRK2,RWRK3,12(RIOB)    TURN ON FLAG              YM6583 45492002
         BE    NORMPOST                SUCCESSFUL - EOB WILL     YM6583 45494002
*                                      EXCP IF ANOTHER ICB IS ADDED     45496002
EXCPEXIT EQU   *                                                        45500002
         L     RWRK1,8(RIOB)            GET FIRST ICB            A28707 45550002
         TM    DCBDEVT,DABIT            DIRECT ACCESS            M3932  45600002
         BO    DAEXIT                   BRANCH IF YES            M3932  45650002
         MVC   33(3,RIOB),25(RWRK1)     MOVE CP STARTAD FROM     M3932  45700002
*                                        ICB TO MAIN IOB                45750002
         B     MOREXIT                                           M3932  45800002
DAEXIT   EQU   *                                                 M3932  45850002
         MVC   48(8,RIOB),32(RWRK1)     MOVE COUNT TO MAIN IOB   A28707 45900002
         CLI   MIOBCHP(RIOB),SETSC      RPS USED                 20201  45950002
         BNE   NOTRPS                   BRANCH NO                20201  46000002
         MVC   D81(B3,RIOB),D25(RWRK1)  UPDATE ADDR FOR RPS CHP  20201  46050002
         B     RPSMOVED                 AROUND NORMAL MOVE       20201  46200002
NOTRPS   EQU   *                                                 20201  46250002
         MVC   73(3,RIOB),25(RWRK1)     MOVE CP STARTAD FROM ICB A28707 46300002
*                                        TO FINAL TIC IN MAINIOB        46350002
RPSMOVED EQU   *                                                 20201  46450002
MOREXIT  EQU   *                                                 M3932  46500002
         MVI   4(RIOB),ZERO             SET MAIN IOB NOT COMPLETE       46550002
         L     RETR,SAVE14(RSAVE)       RESTORE RETURN REG       Y02072 46600002
         LA    RETR,EXCP(RETR)                                          46650002
         B     EXIT                                                     46700002
NORMPOST MVI   4(RIOB),ECBNORM          POST MAIN IOB 7F         A27322 46750002
EXITNORM EQU   *                                                        46800002
         L     RETR,SAVE14(RSAVE)       RESTORE RETURN REG       Y02072 46850002
         B     EXIT                                                     46900002
EXITSKIP EQU   *                                                        46950002
         L     RETR,SAVE14(RSAVE)       RESTORE RETURN REGISTER  Y02072 47000002
         CLI   DCBDEVT,DCBDVPR3         TEST FOR 3211                   47050002
         BNE   EXTSKIP2                 BRANCH IF NOT                   47100002
         TM    IOBRFLAG,SKIPFLAG+RETRY  WAS THE ASYN RTN SCHEDULED ?    47200002
         BZ    EXTSKIP2                 BRANCH IF NO                    47250002
         LA    RETR,12(RETR)            KEEP THE REQUEST ELEMENT        47300002
         B     EXIT                                                     47350002
EXTSKIP2 EQU   *                        DEVICES OTHER THE 3211          47400002
         LA    RETR,SKIP(RETR)          PICK UP SKIP OFFSET             47450002
EXIT     EQU   *                                                        47500002
         NI    0(RIOB),255-IOBPCI       TURN OFF FLAG                   47550002
         MODESET EXTKEY=ZERO            RESTORE THE IOS KEY      Y02072 47600002
         LM    R0,R12,0(RSAVE)          RESTORE THE REG 0-12     Y02072 47650002
         L     R15,SAVE15(RSAVE)        RESTORE REG 15           Y02072 47700002
         BR    RETR                                                     47750002
NOPTIC   EQU   *                                                 20201  47800002
         LA    RINSERT,D8(RWRK3)        GET ADDR OF RD SECTOR    20201  47850002
         ST    RINSERT,D0(RWRK3)        PUT IN CCW               20201  47900002
         MVI   D0(RWRK3),TICNOP         INSERT TIC CMND          20201  47950002
         BR    R7                       RETURN                   20201  48000002
OUTIN    EQU   *                                                        48050002
         IC    R5,OUTNOP(RIOB)          GET OUTPUT NOP                  48100002
         TM    0(RWRK2),IOBWRITE        IS THIS ICB OUTPUT              48150002
         BCR   1,R8                     IF OUTPUT,  RETURN              48200002
         IC    R5,INNOP(RIOB)           GET INPUT NOP                   48250002
         BR    R8                       RETURN                          48300002
         EJECT                                                          48350002
CON8     DC    H'8'                                                     48400002
         DS    0F                                                       48450002
ECBPERRW DC    X'41000000'              CP HAS TERMINATED WITH   Y02072 48500002
*                                        PERMANENT ERROR         Y02072 48550002
ECBNORMW DC    X'7F000000'              CP HAS TERMINATED W/O    Y02072 48600002
*                                        ERROR                   Y02072 48650002
IOBCEXCP DC    X'80000000'             EXCP NEEDED FLAG          YM6583 48660002
         SPACE                                                          48760002
* MODULE PATCH AREA                                                     48770002
         DS    0H                                                       48780002
PATCH    DC    XL((*-IGG019V6)/20)'0'   PATCH AREA               Y02072 48790002
MODLEN   EQU   *-IGG019V6               LENGTH OF MODULE         Y02072 48792002
         EJECT                                                          48800002
         DCBD  DSORG=PS                                                 48850002
         EJECT                                                          48900002
CVT      DSECT                                                          48950002
         CVT                                                            49000002
         EJECT                                                          49050002
         IHAECB                                                  Y02072 49100002
         EJECT                                                          49150002
         IEZIOB                                                         49200002
         ORG   IOBPREFX+1                                               49250002
IOBRFLAG DS    BL1                FLAGS FOR 3211 ERROR RETRY            49300002
         EJECT                                                          49350002
         IECDRQE                                                 Y02072 49400002
         EJECT                                                          49450002
         IHASRB                                                  Y02072 49460002
         EJECT                                                          49470002
         IHAASVT                                                 Y02072 49480002
         EJECT                                                          49490002
         IECDIOSB                                                Y02072 49492002
         END                                                            49500002
./  ADD  SSI=81800183,NAME=IGG0191A
191A TITLE  'IGG0191A -- VALIDITY CHECKING RTN FOR ACCESS METHODS'      00100000
IGG0191A CSECT                                                          00200020
*                                                                       00300020
*MODULE NAME - IGG0191A                                          Y02072 00350002
*                                                                       00360002
*DESCRIPTIVE NAME - FIRST LOAD OF THE OPEN EXECUTORS FOR SAM,    Y02072 00370002
*                   PAM, AND EXCP USERS                          Y02072 00372002
*                                                                       00380002
*COPYRIGHT - NONE                                                Y02072 00390002
*                                                                       00392002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00394002
*                                                                       00396002
*          VS1 RELEASE 2 DELETIONS                                      00398002
*D156000,156004-156148,234500-235000                            SA61537 00398402
*                                                                       00400020
*          VS2 RELEASE 2 DELETIONS                                      00450002
*012000,023000-023500,109000,110000,112000,113000-114000,115000, Y02072 00500002
*188000,189000,210600,211000,212000,213000-222000,234600,234800, Y02072 00550002
*234900,330100-339000,339500,489600-494000,499000390000,478000,  Y02072 00600002
*482000,505000,589000,261000-289000                              Y02072 00650002
*                                                                YM4640 00650102
*                                                                YM6578 00650202
*                                                                       00700203
*          VS2 RELEASE 3 DELETIONS                                      00700303
*          VS2 RELEASE 03 CHANGES/DELETIONS                             00750203
*                                                              @Z30TSMI 00752203
*A234984-234988                                                 ZA00631 00760203
*C246466,249046                                                 ZA00631 00770200
*A156886-156926,235728-235799,235933,235991-235995,237500       ZA00732 00772203
*C246540                                                        ZA00737 00774203
*A23599513,23599523                                            @ZA08893 00777237
*A23599113                                                     @ZA11099 00780237
*C235998                                                       @ZA16001 00786237
*A300575,300585                                                @ZA16001 00792237
*C23564020                                                     @ZA18297 00795237
*C300765                                                       @ZA20474 00797237
*A246726-246732                                                @ZAXXXXX 00798137
*D247344-247349                                                @ZAXXXXX 00799037
*          RELEASE 21 DELETIONS                                         00800020
*1394                                                            M1803  00800121
*1394                                                            A46863 00800421
*1394                                                            A44114 00800821
*1394075000,210600,215000,222000,230000-231000,233000,246050,    S21042 00801021
*1394247740,295000-297000,480000,499000,589000-590000            S21042 00802021
*D300000,330020                                                 SA53194 00805021
*1394                                                            M0062  00807021
*1394001000,010995,019000-022000,036000-105000,123000-127000,    A37507 00810021
*1394131000-140000,143000,146000,179000,246260,249046,266000,    A37507 00820021
*1394299000-454000,489000,497000                                 A37507 00830021
*1394246130,246672-246676                                        A42897 00850021
*1394348000-455000,496000-502000                                 M0091  00870021
*          RELEASE 20 DELETIONS                                         00900020
*    IGG0191A RESEQUENCED IN RELEASE 20                                 01000020
*0970246140                                                      M6478  01000220
*                                                                A38122 01000520
*0970298300-298600                                               M0693  01001020
*0970246340-246540                                               A34919 01002020
*0970                                                            A33682 01005020
*0970                                                            A34428 01010020
*0970                                                            S20038 01020020
*0970                                                            S20016 01050020
*0970105000                                                      A31590 01070020
*0970247000-248000,251000-254000                                 A31304 01080020
*0970233200-233600,246210-246910                                 M0639  01090020
*0970                                                            M0654  01095020
*0970249400                                                      M0678  01097020
*0970224000                                                      S20201 01097120
*0970118000-122000,124000-126000,129000-130000,132000-134000,    2670   01097320
*0970136000,138000-139000,141000,150500-151000,246340            2670   01097620
*0970249400                                                      M1506  01098020
*0970                                                            M2699  01099020
*                                                                M2882  01099620
*                                                                M3296  01099720
*0970                                                            M1565  01099820
*                                                                       01100020
*                                                                       01250002
*  CHANGES IDENTIFIED BY 'DM0D' IN COLUMNS 68-71 INSERTED          DM0D 01300020
*  IN SUPPORT OF CHECKPOINT/RESTART - RELEASE 17                   DM0D 01400020
*                                                                  DM0D 01500020
*  THIS MODULE WAS SPLIT INTO IGG0196A FOR RELEASE 19                   01600020
*  THIS MODULE WAS SPLIT AGAIN IN REL 21 INTO IGG0196I                  01630021
*  MOD FLOW  IGG0191A - IGG0196I - IGG0196A                             01660021
*                                                                       01700020
*FUNCTION  THIS EXECUTOR IS ENTERED FOR USERS OF SAM AND EXCP           01800020
*          DURING OPEN FOR VALIDITY CHECKING OF USER SPECIFIED          01820021
*          PARAMETERS WHEN CODING THE DCB.                              01840021
*          CONFLICTING DCB PARAMETERS:                                  01860021
*          - DCBMACRF OPPOSITE OF OPEN OPTION                           01880021
*          - IF USER SPECIFIED DCBBUFL & IT IS LESS THAN DCBBLKSI       01900021
*          - DCBBLKSI NOT AT LEAST 4 BYTES LARGER THAN DCBLRECL FOR     01920021
*            VARIABLE LENGTH RECORDS                                    01940021
*          - DCBBLKSI NOT EQUAL TO DCBLRECL FOR FIXED LEN DATA SETS     01960021
*            WHEN BOTH ARE SPECIFIED                                    01980021
*          - DCBBLKSI NOT SPECIFIED FOR FIXED LEN DATA SETS      A44114 01990021
*          - FOR QSAM FIXED BLOCKED DATA SETS:                          02000021
*            - DCBLRECL NOT SPECIFIED                                   02020021
*            - DCBBLKSI NOT MULT OF DCBLRECL                     Y02072 02040002
*            - DCBBLKSI LESS THAN LRECL FOR UNSPANNED RECORDS           02100002
*                                                                       02120021
*          TESTING IS DONE TO SEE IF MERLIN/ZEUS CAN BE SUPPORTED WHEN  02140021
*          SPECIFIED.                                                   02160021
*                                                                       02180021
*ENTRY POINT--IGG0191A                                                  02400020
*                                                                       02500020
*          ENTEREDFROM  IGG0190M   VIA XCTL                             02600020
*                        IGG0190P                                       02700020
*                                                                       02800020
*INPUT--  DCB ADDRESS                                                   02900020
*          WORK AREA ADDRESS                                            03000020
*          WHERE TO GO TABLE                                            03100020
*          PARAMETER LIST                                               03200020
*          CURRENT ENTRY IN WHERE TO GO TABLE                           03300020
*          CURRENT PARAMETER (DCB)                                      03400020
*                                                                       03500020
*EXITS - NORMAL XCTL TO IGG0196I TO CONTINUE PROCESSING                 05500021
*        ABNORMAL - XCTL TO PROB DET (IGG0196M) FOR WTP AND 013 ABEND   07500021
*                                                                       10600020
*TABLES/WORKAREA - SEE DSECTS AT END OF LISTING.                        10700020
*                                                                       10800020
*ATTRIBUTES- RE-ENTRANT- RE-USABLE- RUNS IN DATA MANAGEMENT KEY  Y02072 10900002
*            UNLESS OTHERWISE SPECIFIED, RUNS IN SUPER STATE     Y02072 10950002
*                                                                       11100020
*MACROS : MAPPING - IFEFUBOB, DCBD, CVT, IECDSECS                Y02072 11150002
*       : ACTION - DMABCOND, XCTL, MODESET                       Y02072 11200002
         EJECT                                                          11500002
*                                                                       11600020
* MASK'S TO TEST PARAMETER LIST WITH                                    11700020
COMMUTAB EQU   16                                                       12800020
BFTEKR   EQU   X'20'                    DCBBFTEK=R               S19015 14200020
RECFMB   EQU   X'10'                    BLOCKED RECORD FORMAT    S19015 14400020
*                                       BIT                      S19015 14500020
PS       EQU   X'40'               PHYSICAL SEQUENTIAL           I19119 14700020
EXCP     EQU   X'80'               EXCP                          I19119 14800020
BSAM     EQU   X'20'               BSAM                          I19119 14900020
QSAMBIT  EQU   X'01'               QSAM INDICATOR BIT            I19119 15000020
SYS      EQU   X'20'               SYSIN/SYSOUT                  I19119 15200020
OUTPUT   EQU   X'0F'               OUTPUT FLAG                   I19119 15300020
BLKSZMRG EQU   X'10'               BLOCKSIZE MERGE BIT IN        I19119 15400020
*                                       JFCBMASK+2               I19119 15500020
TIOTTERM EQU   X'20'                    DEVICE IS TERMINAL (TSO) S20016 15550020
UORVREC  EQU   X'40'                   RECFM UNDEFIN OR VARIABLE M0639  15570020
UREC     EQU   X'C0'               FORMAT U RECS                 2670   15580020
VREC     EQU   X'40'               FORMAT V RECS                 2670   15590020
MICR3890 EQU   X'16'                    3890 DEVICE TYPE        XL03123 15600102
SHIFTCON EQU   4                        SHIFT CONSTANT          XL03123 15610102
LRECLMIN EQU   12                       LRECL CONSTANT          XL03123 15612102
LRECLMAX EQU   48                       LRECL CONSTANT          XL03123 15614102
D0       EQU   0                        DISPLACEMENT OF ZERO     S20201 15615020
D6       EQU   6                        SIX BYTE DISPLACEMENT    S20201 15620020
SDOPT    EQU   X'04'                    SEARCH DIR MASK IN DCB   S20201 15625020
INOUTIN  EQU   X'03'                    MASK FOR OUTIN OR INOUT  S20201 15630020
NOTEPT   EQU   X'04'                    NOTE - POINT MASK        S20201 15635020
SAMPAM   EQU   X'42'                    SAM & PAM MASK           S20201 15640020
QSAM     EQU   X'40'                    QSAM GET BIT             S20201 15645020
SDFLAG   EQU   X'08'                    S.D. FLAG IN JFCB        S20201 15650020
PCI      EQU   X'20'                    PCI TEST MASK            S20201 15655020
TRKOVFLO EQU   X'20'                    TRK OVERFLO MASK         S20201 15660020
UTRKOVFL EQU   X'E0'                    U - TRK OVFLO MASK       S20201 15665020
FBTRKOV  EQU   X'B0'                    FB - TRK OVFLO MASK      S20201 15670020
FSTDREC  EQU   X'08'                    F STANDARD MASK          S20201 15675020
RDBACK   EQU   X'01'                    OPEN OPTION - READ BACK SA49404 15677002
OUTIN    EQU   X'07'                    OPEN OPTION - OUTPUT    SA48921 15679002
*                                         AND THEN INPUT        SA48921 15679802
UCBOCR85 EQU   X'1A'                    DEVICE ID FOR 1285 OCR   YM6578 15679902
UCBOCR88 EQU   X'1C'                    DEVICE ID FOR 1288 OCR   YM6578 15686602
SDOFF    EQU   X'F7'                    MASK USED TO TURN OFF   ZA00732 15688603
*                                       THE SEARCH DIRECT BIT   ZA00732 15690603
*                                       IN THE JFCB             ZA00732 15692603
*                                                                       15693302
*                                                                     * 15700020
******************************           ****************************** 15800020
*                                                                       15900020
*                                                                       16000020
*                                                                       16100020
*                                                                       16200020
*                                                                       16300020
*REGISTERS ARE REFERENCED SYMBOLICALLY WHERE APPROPRIATE                16400020
*                                                                       16500020
RDCB     EQU   2         DCB REGISTER                                   16600020
RBASE    EQU   3         BASE REGISTER                                  16700020
RCORE    EQU   4         WORK AREA ADDRESS                              16800020
RPAR     EQU   5         TOP OF PARAMETER LIST                          16900020
RWTG     EQU   6         TOP OF WTG TABLE                               17000020
RPARC    EQU   7         CURRENT PARAMETER                              17100020
RWTGC    EQU   8         CURRENT TRANS LOAD                             17200020
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    17300020
RWK1     EQU   RTIOT                    WORK REGISTER            Y02072 17350002
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       17400020
RDEB     EQU   11        DEB ADDRESS                                    17500020
RB       EQU   12        WORK REG1  **                                  17600020
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          17700020
RD       EQU   14        WORK REG3  **                                  17800020
RJ       EQU   15                       WORK REG4                M1803  17850021
RE       EQU   0         WORK REG5                                      18000020
R0       EQU   RE                       USED TO PASS INTERNAL   SA51107 18050002
*                                         CODE TO PROB DETER    SA51107 18060002
RF       EQU   1         WORK REG6                                      18100020
*                                                                       18200020
*                                                                       18300020
ASCII    EQU   X'08'                    ASCII TAPE               S20038 18350020
*                                                                       18400020
*********************************************************************** 18500020
*                                                                       18600020
*                                                                       18700020
OABD056  EQU   56                                                S21042 18710021
OABD057  EQU   57                                                S21042 18720021
OABD058  EQU   58                                                S21042 18730021
OABD072  EQU   72                                                S21042 18740021
OABD083  EQU   83                                                S21042 18750021
OABD114  EQU   114                      INTERNAL CODE 114       XL03123 18752002
OABD115  EQU   115                      INTERNAL CODE 115       XL03123 18754002
OABD117  EQU   117                      INTERNAL CODE 117       XL03123 18756002
VSRDBK   EQU   221                      ERROR CODE, VAR SPAN    SA49404 18760002
*                                         AND READ BACK         SA49404 18770002
OUTINOUT EQU   222                      ERROR CODE, OUTIN/INOUT SA51107 18780002
         EJECT                                                          18800002
         BALR  RBASE,0                                                  19000020
         USING PO,RBASE                                                 19100020
         USING IHADCB,RDCB                                              19200020
         USING FORCORE,RCORE                                            19300020
         USING DEB,RDEB                                                 19400020
         USING   TCB,RD                                                 19500020
         USING TIOT,RTIOT                                               19600020
         USING UCBOB,RUCB                                               19700020
*                                                                       19800020
*                                                                       19900020
*                                                                       20000020
*                                                                       20100020
PO       EQU   *                                                        20200020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 20200102
         DC    C'IGG0191A'              MODULE NAME              YM4640 20200202
         DC    C'@ZA20474'              LAST SHIP CODE         @Z30TSMI 20200337
         DC    C'&SYSDATE'              LAST SHIP DATE         @Z30TSMI 20220337
BEGIN    DS    0H                       END OF MODULE ID         YM4640 20280037
*                                                                       20300020
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 20400020
*   NEXT INSTRUCTION IS USED AS AN INLINE CONSTANT OF FOUR              20430021
FOUR     EQU   *+2                                               A37507 20460021
         L     RCORE,4(RWTGC)           GET WORK AREA                   20500020
*                                                                       20510002
*SET A BIT IN COMMON OPENS AUDIT TRAIL INDICATING TO FORCE       Y02072 20520002
*CLOSE AND PROBLEM DETERMINATION NOT TO REFRESH THE USERS DCB    Y02072 20530002
*FROM THE KEY 5 DCB BEFORE TAKING ANY USER EXITS.                Y02072 20540002
*                                                                       20542002
         OI    DXATCOM1,DXATREFR        DO NOT REFRESH DCB       Y02072 20544002
         SR    RWK1,RWK1                PREPARE TO ZERO FIELD    Y02072 20550002
         ST    RWK1,DXMSGADR            INDICATE MSG CSECT NOT   Y02072 20560002
*                                         LOADED                 Y02072 20570002
         L     RD,COMMUTAB         CALCULATE TCB ADDRESS                20600020
         L     RD,0(0,RD)                                               20700020
         L     RD,4(0,RD)               TCB  ADDR                       20800020
         L     RTIOT,TCBTIO                                             20900020
         AH    RTIOT,DCBTIOT       RESET TIOT POINTER                   21000020
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 21030020
         BO    GETUCBAD                 YES, BR AROUND LOADING   Y02072 21080002
*                                         THE UCB ADDRESS        Y02072 21130002
         L     RUCB,DXUCBADR            GET UCB ADDRESS          Y02072 21180002
GETUCBAD EQU   *                        TEST FOR INVALID PARMS   Y02072 21230002
         TM    DCBMACRF,EXCP            EXCP A. M.               A26010 22300020
         BO    NOSDIR                   YES                      S20201 22400020
         TM    0(RPARC),X'07'           DCB OPENED FOR INPUT,    A26010 22500020
*                                       RDBACK, INOUT, OR UPDAT         22600020
         BO    TSTWP                    NO, MUST BE OUTPUT OR    A26010 22700020
*                                       OUTIN                    A26010 22800020
         TM    DCBMACRF,X'60'           GET OR READ SPECIFIED    A26010 22900020
         BNZ   A26010A                  YES, CONTINUE            S21042 22960021
         LA    RE,OABD057               PUT INTERNAL CODE IN REG S21042 23020021
*                                       0                        S21042 23080021
         B     CALLPD                   CALL PROB DET            S21042 23140021
TSTWP    TM    DCBMACRF+1,X'60'         WRITE OR PUT SPECIFIED   A26010 23200020
         BNZ   TSTOCR                   YES, CONTINUE            YM5516 23240002
         LA    RE,OABD058               PUT INTERNAL CODE IN REG S21042 23280021
*                                       0                        S21042 23320021
         B     CALLPD                                            S21042 23360021
A26010A  EQU   *                                                 A26010 23400020
         TM    0(RPARC),RDBACK          BIT ON FOR READ BACK    SA49404 23410002
         BZ    TSTOCR                   NO, BYPASS VAR SPAN TST SA49404 23420002
         TM    0(RPARC),X'0F'-RDBACK    BITS OFF FOR READ BACK   YM5516 23430002
         BNZ   TSTOCR                   IF OFF, TEST FOR OCR     YM5516 23440002
         TM    DCBRECFM,DCBRECV+DCBRECSB  VAR SPANNED RECS      SA49404 23442002
         BNO   TSTOCR                   NO, BYPASS DMABCOND     SA49404 23444002
         LA    R0,VSRDBK                SET INTERNAL CODE       SA49404 23446002
         B     CALLPD                   GO TO PROB LDET RTN     SA49404 23448002
TSTOCR   EQU   *                                                SA61537 23498002
         TM    TIOELINK,TIOTTERM        IS THIS TSO             ZA00631 23498403
         BO    NOSDIR                   YES, BRANCH             ZA00631 23498803
         CLI   UCBTBYT4,UCBOCR85        IF LESS THAN X'1A', NOT  YM6578 23500002
*                                         AN OCR DEVICE         SA61537 23500402
         BL    TSTDSORG                 NOT AN OCR DEVICE       SA61537 23500802
         CLI   UCBTBYT4,UCBOCR88        IF HIGHER THAN X'1C',    YM6578 23501202
*                                         NOT AN OCR DEVICE     SA61537 23501602
         BNH   OCRQSAM                  YES, AN OCR DEVICE      SA61537 23501702
TSTDSORG EQU   *                                                SA61537 23501802
         TM    DCBDSORG,SAMPAM          SAM OR PAM               S20201 23502020
         BZ    NOSDIR                   SCH DIR NOT ALLOWED      S20201 23504020
         TM    DCBOPTCD,SDOPT           IF THE SCH DIR OPTION IS S20201 23506020
         BNO   NOSDIR                    SPECIFIED IN THE DCB    S20201 23508020
         TM    UCBTBYT3,UCB3DACC         TEST TO SEE IF IT'S     S20201 23510020
         BNO   NOSDIR                    SUPPORTABLE             S20201 23512020
         TM    D0(RPARC),OUTPUT         OUTPUT ONLY IS NOT       S20201 23514020
         BO    NOSDIR                   SUPPORTED                S20201 23516020
         BZ    CHKMORE                  FOR INPUT ONLY BR        S20201 23518020
         TM    D0(RPARC),INOUTIN        IF ITS NOT INOUT OR      S20201 23520020
         BNO   NOSDIR                   OUTIN, DONT SET THE BIT  S20201 23522020
CHKMORE  EQU   *                                                 S20201 23524020
         TM    DCBRECFM,FSTDREC         IF THE FORMAT IS F STD   S20201 23526020
         BO    TESTMORE                 THEN TEST FURTHER        S20201 23528020
         TM    DCBRECFM,UTRKOVFL        ELSE TEST FOR U          S20201 23530020
*                                       FORMAT WITH TRKOVFLO            23532020
         BO    NOSDIR                   IN WHICH CASE DONT SET   S20201 23534020
*                                       THE S.D. BIT.                   23536020
         TM    DCBRECFM,FBTRKOV         FB - TRK OVFLO IS ALSO   S20201 23538020
         BO    NOSDIR                   NOT SUPPORTED            S20201 23540020
         B     OK                       BRANCH TO CONTINUE       S20201 23542020
*                                       TESTING                  S20201 23544020
TESTMORE EQU   *                                                 S20201 23546020
         TM    DCBRECFM,TRKOVFLO        NOW UNLESS IT'S FIXED    S20201 23548020
*                                       STD                      S20201 23550020
         BZ    NOSDIR                   WITH TRKOVFLO, DONT      S20201 23552020
*                                       PROVIDE SR.DIR.                 23554020
OK       EQU   *                                                 S20201 23556020
         TM    DCBOPTCD,PCI               NOR IS PCI             S20201 23558020
         BO    NOSDIR                   SO BR AROUND FOR THEM    S20201 23560020
         TM    DCBMACRF,QSAM            QSAM USED                S20201 23562020
         BO    PDSTST                   BRANCH IF YES          @ZA18297 23564037
         TM    DCBMACRF,NOTEPT          NOTE - POINT IS NOT      S20201 23566020
         BO    NOSDIR                     SUPPORTED ---          S20201 23568020
         TM    DCBBFTEK,BFTEKR          OFFSET RD                S20201 23570020
         BO    NOSDIR                   BRANCH IF YES            S20201 23572020
****************************************************************ZA00732 23572403
* SEARCH DIRECT CHANNEL PROGRAMS ARE NOT DESIGNED TO SUPPORT    ZA00732 23572803
* PROCESSING THAT BEGINS AT OTHER THAN R0 OF A TRACK. THEREFORE ZA00732 23573203
* WHEN A USER REQUESTS THAT THE NOTE/POINT ROUTINES BE LOADED   ZA00732 23573603
* OR OPENS TO A MEMBER (BY SPECIFYING THE MEMBER NAME IN THE    ZA00732 23573703
* JCL), A SEARCH DIRECT CHANNEL PROGRAM WILL NOT BE BUILT.      ZA00732 23573803
****************************************************************ZA00732 23573903
PDSTST   TM    JFCBIND1,JFCPDS          IS DATA SET A PDS MEMBERZA18297 23576837
         BNO   SOP235X                  IF NOT, BRANCH          ZA00732 23578803
         CLI   JFCBELNM,C' '            MEMBER NAME IN JCL      ZA00732 23579203
         BNE   NOSDIR                   IF SO, BRANCH, THE 1ST  ZA00732 23579603
*                                       CHARACTER OF THE MEMBER ZA00732 23579703
*                                       WILL BE OTHER THAN A    ZA00732 23579803
*                                       BLANK                   ZA00732 23579903
*                                                                       23580003
SOP235X  EQU   *                                                 S20201 23582620
*                                                                       23585520
*                                                                       23588420
         OI    JFCBMASK+D6,SDFLAG       SET S.D. FLAG IN JFCB    S20201 23591320
         B     BLKTEST                                          ZA00732 23593303
*                                                                       23594220
NOSDIR   EQU   *                                                 S20201 23597120
         NI    JFCBFLG2,SDOFF           TURN OFF SEARCH DIRECT  ZA00732 23599103
         TM    TIOELINK,TIOTTERM        IS THIS TSO?           @ZA11099 23599537
         BO    BLKTEST                  YES, BRANCH            @ZA11099 23599637
         CLI   UCBTBYT4,MICR3890        DEVICE A 3890 ?        @ZA08893 23599737
         BE    OCRQSAM                  YES-BRANCH             @ZA16001 23599837
*                                                                       23600020
* BSAM - QSAM BLOCKSIZE TEST                                            23700020
BLKTEST  EQU  *                                                 ZA00732 23750003
         TM    DCBDSORG,PS         PHYSICAL SEQUENTIAL SPECIFIED I19119 23800020
         BNO   CONTINUE            BRANCH IF NOT PS              I19119 23900020
         TM    DCBMACRF,EXCP       TEST FOR EXCP                 I19119 24000020
         BO    CONTINUE            BRANCH IF EXCP                I19119 24100020
         TM    DCBMACRF,BSAM       TEST FOR BSAM INPUT           I19119 24200020
         BO    TSTBLKSZ            BRANCH IF BSAM INPUT          I19119 24300020
         TM    DCBMACRF+1,BSAM     TEST FOR BSAM OUTPUT          I19119 24400020
         BO    TSTBLKSZ            BRANCH IF BSAM OUTPUT         I19119 24500020
         OI    DCBCIND2,QSAMBIT    SET QSAM INDICATOR            I19119 24600020
*                                                                       24600402
*TEST FOR INVALID QSAM OPEN OPTIONS.                            SA51107 24600802
*                                                                       24600902
         TM    0(RPARC),OUTPUT          PREPARE TO TEST FOR     SA51107 24602902
*                                         INOUT/OUTIN           SA51107 24603302
         BO    AROUND                   ALL ON, CAN'T BE EITHER SA51107 24603702
         TM    0(RPARC),INOUTIN         BITS ON FOR INOUT/OUTIN SA51107 24604602
         BNO   AROUND                   NOT ON, VALID           SA51107 24606602
         LA    R0,OUTINOUT              INTERNAL ABEND CODE     SA51107 24609402
         B     CALLPD                   GO ISSUE DMABCOND       SA51107 24609502
AROUND   CLC   DCBBUFL(2),ZEROO        DID USER SPECIFY BUF LEN? M0639  24609602
         BE    TEST                    NO,  BR AROUND TEST       M0639  24613302
         CLC   DCBBLKSI(2),DCBBUFL     TEST TO SEE IF BLKSIZE IS M0639  24617002
*                                         GREATER THAN BUF LEN          24620702
         LA    RE,OABD072               LOAD INTERNAL ABEND CODE S21042 24624402
         BH    CALLPD                   CALL PROB DET            S21042 24628102
TEST     EQU   *                                                 M0639  24631802
         TM    DCBOPTCD,ASCII      ASCII TAPE?       S20038      A31304 24635502
         BO    CONTINUE                YES - BRANCH              A42897 24639202
         TM    TIOELINK,TIOTTERM        IS THIS TSO              M0693  24642902
         BO    MOVEID                  BRANCH IF YES            ZA00631 24646603
         TM    DCBRECFM,UREC       ARE RECS FORMAT U?            2670   24650302
         BNM   CONTINUE             YES, BRANCH                 ZA00737 24654003
         TM    DCBRECFM,VREC       ARE RECS FORMAT V?            2670   24655020
         BC    8,FIXREC            NO, BR AROUND TEST FOR FORMAT 2670 S 24656020
*                                       V REC                    2670   24657020
         TM    DCBRECFM,X'08'          ARE SPANNED RECS BEING    M2699  24657220
*                                       USED?                    M2699  24657420
         BC    1,CONTINUE              YES, LRECL CAN BE LARGER  M2699  24657620
*                                        THAN BLKSIZE-BR AROUND TEST    24657820
*                                                                       24658020
*   FOR VAR LEN RECORDS, BLKSIZE MUST BE AT LEAST 4 BYTES GREATER THAN  24659020
*   LRECL.                                                              24660020
*                                                                       24661020
         LH    RE,DCBLRECL         GET LRECL FOR TEST            2670   24662020
         AH    RE,FOUR             ADD 4 BYTES FOR BDW LENGTH    2670   24663020
         CH    RE,DCBBLKSI         LRECL EQUAL OR LESS THAN      2670   24664020
*                                       BLKSIZE?                 2670   24665020
         BNH   CONTINUE            YES, CONTINUE PROCESSING      2670   24666020
         B     DCBERROR            NO, ABEND                     2670   24667020
FIXREC   EQU   *                                                 2670   24668020
         CLI   UCBTBYT4,MICR3890        DEVICE A 3890 ?         XL03123 24670002
         BE    MICRDEV                  YES,BYPASS RECFM TEST   XL03123 24672002
         CLC   DCBBLKSI,ZEROO           IS BLKSIZE EQ ZERO?     WJXXXXX 24672637
         BE    DCBERROR                 YES - ABEND             WJXXXXX 24673037
         TM    DCBRECFM,RECFMB         RECFM BLOCKED?            M0639  24674020
         BC    1,TSTBLKSZ              YES,  TEST LRECL MULT     M0639  24694020
*                                       BLKSI                    M0639  24714020
*                  RECFM IS FIXED UNBLOCKED                             24734020
* USER DOES NOT HAVE TO SPECIFY LRECL FOR RECFM=F. BLOCKSIZE IS ASSUMED 24736020
* THEREFORE WE SHOULD TEST TO SEE IF USER SPECIFIED LRECL BEFORE MAKING 24738020
* FOLLOWING TEST.                                                       24740020
         CLC   DCBLRECL(2),ZEROO       DID USER SPECIFY LRECL?   M0654  24742020
         BE    CONTINUE                NO,  DO NOT TEST EQ TO    M0654  24744020
*                                       BLKSIZE                  M0654  24746020
         CLC   DCBLRECL(2),DCBBLKSI    LRECL EQ BLKSIZE?         M0639  24754020
         LA    RE,OABD083               LOAD INTERNAL ABEND CODE S21042 24764021
         BNE   CALLPD                   CALL PROB DET            S21042 24774021
         B     CONTINUE                LRECL O.K.                M0639  24794020
TSTBLKSZ EQU   * TEST BLOCKSIZE AS A MULTIPLE OF LRECL           I19119 24900020
*  THE FOLLOWING TEST ALSO FIXES APAR NO. 34919                         24901020
*  THE FOLLOWING TEST FOR V RECS IS MADE TO KEEP BLKSIZE FROM BEING     24902020
*  ADJUSTED TO A MULTIPLE OF LRECL FOR VARIABLE & UNDEFINED RECS        24903020
*                                                                       24904020
         TM    TIOELINK,TIOTTERM        IS THIS TSO              M1565  24904320
         BO    MOVEID                  BRANCH IF YES            ZA00631 24904600
         TM    DCBRECFM,UORVREC        ARE RECS U OR V?          M0654  24905020
         BC    1,CONTINUE              YES,  BYPASS LRECL TESTS  M0654  24906020
         LH    RC,DCBBLKSI             LOAD BLKSIZE FOR DIVIDE   M0639  24910020
         LH    RE,DCBLRECL             LOAD LRECL FOR DIVIDE     M0639  24920020
         LTR   RE,RE                   TEST FOR LRECL SPECIFIED  M0639  24930020
         BZ    QSAMTEST                BRANCH IF LRECL NOT              24940020
*                                       SPECIFIED                M0639  24950020
         SR    RB,RB               CLEAR REGISTER FOR DIVIDE     I19119 25000020
         DR    RB,RE               DIVIDE BLOCKSIZE BY LRECL     I19119 25500020
         LTR   RB,RB               TEST BLOCKSIZE MULTIPLE OF    I19119 25600020
*                                       LRECL                    I19119 25700020
         BZ    CONTINUE            BRANCH IF EVEN MULTIPLE       I19119 25800020
*                                                                       25900020
*** OCIP 294 *** THIS CODE REMOVED BECAUSE HASP HANDLES SYSOUT   Y02072 26000002
*                                                                       29000020
QSAMTEST EQU   * ABEND IF QSAM - CONTINUE IF BSAM                I19119 29100020
         TM    DCBCIND2,QSAMBIT    TEST FOR QSAM OR BSAM         I19119 29200020
         BNO   CONTINUE            BRANCH IF BSAM                I19119 29300020
*                                                                       29400020
DCBERROR EQU   *                                                 S21042 29450021
         LA    RE,OABD056               PUT INTERNAL CODE IN R0  S21042 29500002
CALLPD   EQU   *                                                 S21042 29600021
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES      S21042X29650021
                                        GO TO PROB DET FOR 013 ABEND    29700021
         B     TCTLRTN                                           S21042 29750021
CONTINUE EQU   *                                                        29750402
         CLI   UCBTBYT4,MICR3890        DEVICE A 3890 ?         XL03123 29752002
         BNE   MOVEID                   NO-BRANCH               XL03123 29754002
MICRDEV  EQU   *                                                        29754402
         TM    DCBRECFM,UORVREC         RECFM=F ?               XL03123 29756002
         BO    RECFMERR                 NO-BRANCH               XL03123 29758002
         OI    DCBRECFM,RECFMB          FORCE RECFM=FB          XL03123 29758402
         SR    RB,RB                    CLEAR RB REGISTER       XL03123 29758802
         LA    RB,LRECLMIN              LOAD LRECL CONSTANT     XL03123 29759202
         CH    RB,DCBLRECL              TEST LRECL LENGTH       XL03123 29759602
         BH    LRECLERR                 LRECL TOO LOW-BRANCH    XL03123 29759702
         LA    RB,LRECLMAX              LOAD LRECL CONSTANT     XL03123 29759802
         CH    RB,DCBLRECL              TEST LRECL LENGTH       XL03123 29759902
         BL    LRECLERR                 LRECL TOO HIGH-BRANCH   XL03123 29763202
         LH    RB,DCBLRECL              LOAD LRECL TO RB REG    XL03123 29765202
         SLL   RB,SHIFTCON              MULTIPLY LRECL BY 16    XL03123 29765602
         LH    RC,DCBBUFL               LOAD BUFL INTO RC       XL03123 29766002
         LTR   RC,RC                    DCBBUFL SPECIFIED ?     XL03123 29766402
         BZ    TSTBLKSI                 NO-BRANCH               XL03123 29766502
         CR    RB,RC                    TEST DCBBUFL            XL03123 29766602
         BH    BUFLERR                  BUFL TOO SMALL-BRANCH   XL03123 29769902
TSTBLKSI EQU   *                                                XL03123 29771902
         LH    RC,DCBBLKSI              LOAD BLKSIZE INTO RC    XL03123 29772302
         LTR   RC,RC                    BLKSIZE SPECIFIED ?     XL03123 29772702
         BZ    SUPBLKSI                 NO-BRANCH               XL03123 29773102
         CR    RB,RC                    TEST BLKSIZE            XL03123 29773202
         BH    BLKSIERR                 TOO SMALL-BRANCH        XL03123 29773302
         B     MOVEID                   XCTL OUT                XL03123 29776602
SUPBLKSI EQU   *                                                XL03123 29778602
         STH   RB,DCBBLKSI              STORE GENERATED BLKSIZE XL03123 29779002
         B     MOVEID                   XCTL OUT                XL03123 29779402
RECFMERR EQU   *                                                XL03123 29779802
         LA    RE,OABD115               LOAD ABEND CODE         XL03123 29779902
         B     CALLPD                   CALL PROBLEM DETECT     XL03123 29780002
LRECLERR EQU   *                                                XL03123 29814502
         LA    RE,OABD117               LOAD ABEND CODE         XL03123 29824502
         B     CALLPD                   CALL PROBLEM DETECT     XL03123 29834502
BUFLERR  EQU   *                                                XL03123 29844502
BLKSIERR EQU   *                                                XL03123 29846502
         LA    RE,OABD114               LOAD ABEND CODE         XL03123 29848502
         B     CALLPD                   CALL PROBLEM DETECT     XL03123 29848902
*                                                                       29849502
*  SET QSAM INDICATOR FOR OCR/QSAM DATA SETS                    SA55577 29884002
*                                                                       29918502
OCRQSAM  TM    DCBMACF1,DCBMRRD         BSAM INPUT BEING USED   SA55577 29953002
         BO    CONTINUE                 YES, DON'T SET QSAM BIT SA55577 29987502
         TM    DCBMACF2,DCBMRRD         BSAM OUTPUT BEING USED  SA55577 30022002
         BO    CONTINUE                 YES, DON'T SET QSAM BIT SA55577 30056502
         TM    DCBMACRF,EXCP            EXCP USED              @ZA16001 30066537
         BO    MOVEID                   YES, BRANCH            @ZA20474 30076537
         OI    DCBCIND2,DCBCNQSM        INDICATE QSAM DATA SET  SA55577 30091002
MOVEID   EQU   *                                                        30101002
         USING WTGENTRY,RWTGC                                    Y02072 30160002
         MVC   WTGIDTTR,MOD196I         MOD 196I NEXT          @Z30TSMI 30200003
*                                                                       45600020
*********************************************************************   45700020
*                                                                       45800020
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     UPDATE WHERE TO GO ENTRY        45900020
         LA    RPARC,PLOFF(0,RPARC)     UPDATE PARA LIST ENTRY          46000020
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            46100020
         BCR   8,RBASE                  YES BR BACK TO BEGINNING        46200020
*                                                                       46300020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    46400020
         BC    7,RELOOP                 NO BRANCH                       46500020
*                                                                       46600020
         LR    RPARC,RPAR                                               46700020
         LA    RWTGC,WAOFF(0,RWTG)      RE INIT  WTG LIST               46800020
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           46900020
         BC    7,TCTLRTN                NO XCTL                         47000020
*                                                                       47100020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  47200020
         LA    RPARC,PLOFF(0,RPARC)                                     47300020
         BC    15,ZCHEK                                                 47400020
*                                                                       47500020
TCTLRTN  EQU   *                                                        47600020
         USING WTG,RWTG                                                 47650003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*48200003
               MODID=WTGENTRY                                  @Z30TSMI 48220003
        DROP  RWTGC,RWTG                                                48250003
*                                                                       48300020
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   48400020
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                48500020
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                48600020
ZEROO    DC    X'0000'                 CONSTANT FOR BUFL TEST    M0639  48650002
OPIDCNST DC    C'0S'                                                    48700020
AMIDCNST DC    C'1A'                                                    48800020
MOD196I  DC    C'6I',VL3(IGG0196I)      NEXT EXECUTOR            Y02072 48850003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION    Y02072 48900003
         SPACE                                                          48950002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 49000002
END      EQU   *                        END OF MOUDULE           Y02072 49050002
         EJECT                                                          49500002
SRT      DSECT                                                          50400020
         IEFUCBOB  PREFIX=YES                                    Y02072 50500002
*                                                                       50600020
         EJECT                                                          50700020
           DCBD  DSORG=PS                                               50800020
CVT      DSECT                                                          50900020
         CVT                                                            51000020
*   TASK CONTROL BLOCK                                                  51100020
         CNOP  0,4                                                      51200020
TCB      DSECT                                                          51300020
TCBRBP   DS    F                       PO9NTER TO EXECUTING RB          51400020
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   51500020
TCBDEB   DS    F                       POINTER TO DEB QUEUE             51600020
TCBTIO   DS    F                       POINTER TO TIOT                  51700020
TCBCMP   DS    F                       TASK COMPLETION CODE             51800020
TCBTRN   DS    F                       TESTRAN FIELD                    51900020
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 52000020
TCBPKF   DS    CL1                     RESERVED FOR FUTURE USE          52100020
TCBFLGS  DS    FL5                     FLAG BYTES                       52200020
TCBLMP   DS    CL1                     RESERVED FOR FUTURE USE          52300020
TCBDSP   DS    CL1                     RESERVED FOR FUTURE USE          52400020
TCBLLS   DS    F                       POINTER TO LOAD LIST             52500020
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            52600020
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  52700020
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       52800020
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             52900020
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  53000020
TCBTCB   DS    F                       RESERVED FOR FUTURE USE          53100020
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         53200020
         DS    CL24                                                     53300020
TIOT     DSECT                                                          53400020
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       53500020
TIOESTTA DS    CL1                           STATUS -A-                 53600020
TIOERLOC DS    CL2                           REL. LOC OF POOL           53700020
TIOEDDNM DS    2F                            DDNAME                     53800020
TIOEJFCB DS    1F                            JFCB DISK ADDR             53900020
TIOESTTB DS    0CL1                                                     54000020
TIOEFSRT DS    CL4                                                      54100020
         DS    CL1                                                      54200020
*        TIOT POOL ENTRY                                                54300020
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       54400020
         DS    CL1                                                      54500020
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      54600020
*                                             SLOTS)                    54700020
TIOPPOOL DS    CL8                           POOL NAME                  54800020
TIOPSTTB DS    XL1                           STATUS OF SLOT             54900020
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  55000020
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      55100020
TIOELINK EQU   TIOERLOC+1                                        S20016 55150020
         SPACE 1                                                        55200020
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          55300020
DEB      DSECT                                                          55400020
DEBNMSUB DS    0CL1                                                     55500020
DEBTCBAD DS    CL4                                                      55600020
DEBAMLNG DS    0CL1                                                     55700020
DEBDEBAD DS    CL4                                                      55800020
DEBOFLGS DS    0CL1                                                     55900020
DEBIRBAD DS    CL4                                                      56000020
DEBOPATB DS    0CL1                                                     56100020
DEBSYSPG DS    CL4                                                      56200020
DEBNMEXT DS    0CL1                                                     56300020
DEBUSRPG DS    CL4                                                      56400020
DEBPRIOR DS    0CL1                                                     56500020
DEBECBAD DS    CL4                                                      56600020
DEBPROTG DS    0CL1                                                     56700020
DEBDEBID DS    0CL1                                                     56800020
DEBDCBAD DS    CL4                                                      56900020
DEBEXSCL DS    0CL1                                                     57000020
DEBAPPAD DS    CL4                                                      57100020
DEBDVMOD DS    0CL1                                                     57200020
DEBUCBAD DS    CL4                                                      57300020
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     57400020
DEBBINUM DS    CL2                                                      57500020
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   57600020
DEBSTRCC DS    CL2                                                      57700020
DEBSTRHH DS    CL2                                                      57800020
DEBENDCC DS    CL2                                                      57900020
DEBENDHH DS    CL2                                                      58000020
DEBNMTRK DS    CL2                                                      58100020
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          58200020
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              58300020
DEBVOLSQ DS    H                                                        58400020
DEBVOLNM DS    H                                                        58500020
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     58600020
DEBSUBID DS    H                                                        58700020
         TITLE 'IGG0191A - FORMAT OF GOTTEN CORE'                       58800002
         IECDSECS (MAIN,(IOB,NO)),WTG,PREFX,EXPAND=YES                  58900003
CCWOFSET EQU   DXCCW12-FORCORE     CCW RELOCATABLE OFF SET FOR DXCCW12  59100020
DCBOFSET EQU   DCBDEBAD-IHADCB     DEB RLCATBL OFFSET IN DCB            59200020
           END                                                          59300020
./  ADD  SSI=81460091,NAME=IGG0191B
         TITLE 'IGG0191B  MAIN EXECUTOR'                                00020000
IGG0191B CSECT                                                          00021000
*                                                                       00021402
*MODULE NAME - IGG0191B                                          Y02072 00021502
*                                                                       00023302
*DESCRIPTIVE NAME - DETERMINES PATH THROUGH OPEN EXECS           Y02072 00025302
*                                                                       00025702
*COPYRIGHT - NONE                                                Y02072 00025802
*                                                                       00025902
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00026002
*                                                                       00026402
*          VS1 RELEASE 3 CHANGES/DELETIONS                              00026502
*                                                                XA2865 00026602
*          VS2 RELEASE 2 CHANGES/DELETIONS                              00026802
*011200,034700,034900-034960,000584-000710,113800,056370,058600, Y02072 00027202
*073820,074399,099000,105000-105400,106000,110400                Y02072 00027602
*                                                                YM6518 00027702
*                                                                       00029903
*          VS2 RELEASE 3 DELETIONS                                      00031903
*                                                              @Z30TSCF 00032303
*          VS2 RELEASE 3.7 CHANGES                                      00032537
*A070344-070351                                                @ZA16011 00032937
*A017370,063000-063160,063220-063240                           @ZA26771 00033037
*C063220-0633240                                               @ZA30524 00033137
*D063000-063160,063220-063240                                  @ZA32889 00033637
*          RELEASE 21 DELETIONS/CHANGES                                 00034137
*0297062200                                                      A47713 00035403
*0297070320-070360                                               M1802  00037603
*0297053000,053600,054020-054160                                 M1306  00039803
*0297053000,053600                                               A43247 00042003
*0297004800,030700,035320,056200,056380-056384,056392-056396,    S21042 00044203
*0297105600,107800,108000-108100,108200,113200,117000            S21042 00046403
*0297                                                            A44469 00048603
*D037300-042800                                                 SA53194 00050803
*REFER TO CODE FLAGGED XA2865                                   SA65964 00053003
*         RELEASE 20 DELETIONS/CHANGES                                  00055203
*1331036400,117800-121800                                        S20016 00057403
*1331000237,036066                                               M0001  00059603
*1331045030-045090                                               M0006  00061803
*1331125500                                                      M0005  00064003
*1331000220                                                      A32172 00066203
*1331027050,033060,036000-036180,133460                          M1227  00068403
*1331                                                            M3415  00070603
*                                                                       00072802
*STATUS CHANGE LEVEL 010                                                00074602
*                                                                       00075002
*FUNCTION/OPERATION: THIS ROUTINE SUPPLEMENTS THE INITIAL OPEN ROUTINE. 00076402
*      IT PERFORMS GENERAL AND SPECIFIC FUNCTIONS FOR THE SEQUENTIAL    00078202
*      ACCESS METHOD(QSAM,BSAM,EXCP).                                   00080000
*      IT SETS INDICATORS FOR THE APPROPRIATE ACCESS METHOD AND DEVICE  00100000
*      CLASS.                                                           00120000
*                                                                       00180000
*ENTRY POINT-IGG0191B  ENTERED FROM IGG0191A BY USE OF THE XCTL MACRO.  00200000
*                                                                       00220000
*INPUT: SEE DESCRIPTION OF REGISTERS.                                   00240000
*OUTPUT: SEE DESCRIPTION OF REGISTERS.                                  00260000
*EXTERNAL ROUTINES: NONE.                                               00280000
*EXITS - NORMAL XCTL TO IGG0196B                                        00330019
*        IGG0191B WAS SPLIT INTO IGG0196B FOR REL 19                    00380019
*                                                                       00430019
*EXITS - ERROR XCTL TO PROBLEM DETERMINATION (IGG0196M)                 00460021
*              TO ISSUE WTP AND 013 ABEND                               00490021
*                                                                       00540000
*TABLES/WORKAREAS: WHERE TO GO TABLE(WTG)                               00560000
*      BYTE  0-7  NAME                                                  00580000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00600000
*      BYTE 11    CONCATENATION NUMBER                                  00620000
*      BYTE 12    ZERO                                                  00640000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00660000
*                        ALIAS INDICATOR 1 BIT                          00680000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00700000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00720000
*      BYTE 17    ZERO                                                  00740000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00760000
*      BYTE 20    TRANSLATION TABLE                                     00780000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00800000
*      BYTE 22-23 ATTRIBUTES                                            00820000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00840000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00860000
*      BYTE 29    LENGTH OF WTG TABLE(IN DOUBLE WORDS)                  00880000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00900000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00920000
*      BYTE 35    ADDRESS OF STORAGE FOR DCB                            00940000
*      BYTE 36-39 TABLE OF IDTTR'S                                      00960000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB (3 BYTES)           00980000
*                   ADDRESS OF STORAGE FOR DCB      (1 BYTE )           01000000
*                   IDTTR OF LAST ROUTINE LOAD      (3 BYTES)           01020000
*                   NOT USED                        (1 BYTE )           01040000
*                                                                       01060000
*      WORKAREA- SEE 'FORCORE DSECT' (IECDSECT) IN THIS LISTING         01080000
*                                                                       01100000
*ATTRIBUTES: REENTRANT, REUSABLE, SUPERVISOR STATE,              Y02072 01120002
*            RUNS IN DATA MANAGEMENT KEY                         Y02072 01130002
*                                                                       01132002
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01240000
*                                                                       01260000
*********************************************************************** 01280000
*                                                                       01300000
*                                                                       01320000
RE       EQU   0                       WORK/PARAMETER REGISTER          01340000
R0       EQU   RE                      INPUT REG TO BLDL AND     YM1167 01350002
*                                        CONVERT ROUTINE         YM1167 01352002
RF       EQU   1                       WORK/PARAMETER REGISTER          01360000
RWK1     EQU   RF                      WORK REGISTER             YM1167 01370002
RDCB     EQU   2                       ADDR OF USERS DCB                01380000
RBASE    EQU   3                       BASE REGISTER                    01400000
RCORE    EQU   4                       ADDR OF OPEN WORK AREA           01420000
RPAR     EQU   5                       PARAMETER LIST                   01440000
RWTG     EQU   6                       START OF WTG                     01460000
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  01480000
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       01500000
RTIOT    EQU   9                       TIOT ADDR/WORK REGISTER          01520000
RUCB     EQU   10                      UCB ADDR/WORK REGISTER           01540000
RDEB     EQU   11                      DEB ADDRESS                      01560000
RA       EQU   11                                                       01580000
RB       EQU   12                      WORK REGISTER                    01600000
RC       EQU   13                      WORK REGISTER                    01620000
RD       EQU   14                      WORK/PARAMETER REGISTER          01640000
RJ       EQU   15                      WORK/PARAMETER REGISTER          01660000
* MASK'S TO TEST PARAMETER LIST WITH                                    01680000
*                                                                       01700000
OUTP       EQU   X'0F'                                                  01720000
INPUT    EQU   X'0F'                    INPUT MASK               A27549 01725019
VOLFULL  EQU   X'20'                    VOLUME FULL MASK         A27549 01730019
DISPNEW  EQU   X'C0'                    DATA SET STATUS MASK     A27549 01735019
*                                                                       01740000
*********************************************************************   01760000
*                                                                       01780000
*                                                                       01800000
* OFFSET FOR PARAMETER TESTS                                            01820000
*                                                                       01840000
DISPSN     EQU   X'0'                                                   01860000
*                                                                       01880000
*                                                                       01900000
*********************************************************************   01920000
*                                                                       01940000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              01960000
*                                                                       01980000
*                                                                       02000000
*                                                                       02020000
DOUBLE     EQU   X'01'                                                  02040000
P2       EQU   2                        CONSTANT OF 2            M0006  02046020
DEBLRECL EQU   46                       OFFSET OF LRECL IN DEB   M0006  02052020
PORG     EQU   X'02'                    MASK FOR DSORG=PO IN DCB   DM0P 02090018
STOWB      EQU   X'80'                                                  02100000
OVRFLO     EQU   X'20'                                                  02120000
PCI        EQU   X'20'                                                  02140000
CONCAT     EQU   X'FF'                                                  02160000
*                                                                       02180000
*******************************************************************DM0P 02181018
*                                                                  DM0P 02182018
* MASKS USED TO TEST OPTION FIELDS IN DSCB                         DM0P 02183018
*                                                                  DM0P 02184018
POFILTYP EQU   X'02'                    MASK FOR FILE TYPE         DM0P 02185018
*                                                                  DM0P 02186018
*******************************************************************DM0P 02187018
*                                                                  DM0P 02188018
* MASKS USED TO TEST OPTION FIELDS IN JFCB                         DM0P 02189018
*                                                                  DM0P 02190018
NORECRDY EQU   X'20'                     NON-RECORD-READY BIT    A44469 02190421
JFCBMEM  EQU   X'40'                    MASK FOR MEMBER NAME       DMOP 02191018
*                                                                  DMOP 02192018
*********************************************************************   02200000
*                                                                       02220000
* MASKS FOR ACCESS METHODS IN SAM                                       02240000
*                                                                       02260000
PAM        EQU   X'02'                                                  02280000
PSAM       EQU   X'42'                                                  02300000
QSAMB      EQU   X'01'                                                  02320000
*                                                                       02340000
*                                                                       02360000
* MASKS FOR MACRO'S TO BE USED                                          02380000
*                                                                       02400000
GETB       EQU   X'40'                                                  02420000
PUTB       EQU   X'40'                                                  02440000
READB      EQU   X'20'                                                  02460000
WRITEB     EQU   X'20'                                                  02480000
POINTB     EQU   X'04'                                                  02500000
CNTRLB     EQU   X'02'                                                  02520000
*                                                                       02540000
*                                                                       02560000
*********************************************************************   02580000
*                                                                       02600000
* MASKS FOR DEVICES TO BE SUPPORTED                                     02620000
*                                                                       02640000
T3525    EQU   X'4C'               3525 DEVICE                  SA53194 02650021
PRTPCH   EQU   X'30'               PRT/PCH ASSOC. D.S           SA53194 02652021
RDPCH    EQU   X'60'               RD/PCH ASSOC. D.S            SA53194 02654021
RDPRT    EQU   X'50'               RD/PRT ASSOC. D.S            SA53194 02656021
ASSOCDS  EQU   X'04'               3525 ASSOCIATED D.S.         SA53194 02658021
DABIT    EQU   X'20'                                                    02660000
URBIT    EQU   X'40'                                                    02680000
TAPEB    EQU   X'80'                                                    02700000
MICR3890 EQU   X'56'                    DCBDEVT CODE FOR 3890   XL03123 02702002
*                                       DEVC                     S20016 02710020
TIOTTERM EQU   X'20'                    DEVICE IS TERMINAL       S20016 02715020
*                                                                       02720000
*                                                                       02740000
* MASKS FOR BUFFER TECHNIQUE'S                                          02760000
*                                                                       02780000
EXCHANGB   EQU   X'10'                                                  02800000
LRECIND  EQU   X'20'                    LOGICAL RECORD INTERFACE S19015 02810019
*                                                                       02820000
*********************************************************************   02840000
*                                                                       02860000
*                                                                       02880000
* MODES OF OPERATION FOR QSAM                                           02900000
*                                                                       02920000
LOCATEB    EQU   X'08'                                                  02940000
MOVEB      EQU   X'10'                                                  02960000
*                                                                       02980000
*                                                                       03000000
*********************************************************************   03020000
*                                                                       03040000
* MASKS USED FOR NEW BUFFER CONTROL BLOCK                               03042019
*                                                                       03044019
FLGOFFST EQU   4                        OFFSET TO FLAG BYTE IN   S19015 03046019
*                                       BCB                      S19015 03048019
RAFLAG   EQU   X'80'                    RECORD AREA PRESENT      S19015 03050019
*                                                                       03052019
*********************************************************************** 03054019
*                                                                       03060000
OABD053  EQU   53                       INTERNAL CODE 53         S21042 03066021
OABD094  EQU   94                       INTERNAL CODE 94         S21042 03072021
         EJECT                                                          03140002
         BALR  RBASE,0                                                  03160000
         USING PO,RBASE                                                 03180000
         USING IHADCB,RDCB                                              03200000
         USING FORCORE,RCORE                                            03220000
         USING DEB,RDEB                                                 03240000
         USING   TCB,RD                                                 03260000
         USING CVT,RTIOT                                                03280000
         USING UCBOB,RUCB                                               03300000
         USING TIOT,RC                                           S20016 03312020
*                                                                       03320000
*                                                                       03340000
*                                                                       03360000
*                                                                       03380000
PO       EQU   *                                                        03400000
*                                                                       03420000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 03430002
         DC    C'IGG0191B'              MODULE NAME              Y02072 03432002
         DC    C'@ZA32889'              LAST SHIP CODE         @ZA30534 03434037
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZA26771 03435037
BEGIN    EQU   *                                                 Y02072 03438002
         L     RDCB,0(RPARC)           GET DCBADDRESS                   03440000
         L     RCORE,4(RWTGC)           GET WORK AREA                   03460000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 03480000
*                                                                       03500000
         L     RUCB,DEBUCBAD            GET UCB ADDRESS                 03520000
*                                                                       03520520
* FOR A TSO DCB, DCBEDVT IS SET TO X'4F' IN IGG0190L                    03521020
*                                                                       03521520
         L     RTIOT,CVTPTR             GET COMM VECTOR ADDR     M1227  03522020
         L     RD,CVTTCBP               GET TCB POINTER          M1227  03522520
         L     RD,4(RD)                 GET ADDR OF CURRENT TCB  M1227  03523020
         L     RC,TCBTIO                GET ADDR OF TIOT         M1227  03523520
         AH    RC,DCBTIOT               GET ADDR OF THIS DD      M1227  03524020
*                                       ENTRY                    M1227  03524520
         TM    TIOELINK,TIOTTERM        IS THIS A TSO DCB        M1227  03525020
         BO    GOGOGO                   BRANCH IF YES            M1227  03525520
         LA    RE,OABD094               LOAD INTERNAL CODE 94    S21042 03525721
         CLI   UCBTBYT3,X'40'           COMMUNICATIONS DEVICE?   A32172 03526020
         BE    CALLPD                   CALL PROB DET            S21042 03533021
         MVC   DCBDEVT(1),UCBTBYT3      STORE DEVICE CLASS              03540000
         NI    DCBDEVT,X'F7'            TURN OFF UR BIT IF ON           03560000
         OC    DCBDEVT(1),UCBTBYT4      STORE DEVICE NUMBER             03580000
*******************************************************************     03618620
         TM    UCBTBYT3,X'08'           UR EQ BEING USED                03620000
         BZ    GOGOGO                   BRANCH IF NOT            S20016 03640020
*                                                                       03660000
         OI    DCBDEVT,X'40'            FAKE UR BIT IN DCB              03680000
*                                                                       04500000
GOGOGO   EQU   *                                                 M0006  04500920
*                                                                       04501820
*     THIS SECTION WILL SAVE DCBLRECL FIELD IN THE DEB FOR QSAM/BSAM  * 04502720
*                                                                       04503620
         TM    DCBDSORG,DCBDSGPO        PARTIONED ORGANIZATION   XA2865 04504002
         BO    SOP100                   YES, BR, DEBLRECL DOES   XA2865 04504402
*                                         NOT EXIST              XA2865 04506702
         SR    RB,RB                    CLEAR REGISTER           M0006  04510102
         IC    RB,DEBNMEXT              PICK UP NO. OF EXTENTS   M0006  04512402
         SLL   RB,P2                    MULTIPLY BY 4 FOR NON-DA M0006  04514702
         TM    TIOELINK,TIOTTERM        IS THIS A TSO DCB        M3415  04517002
         BO    SOP90                    BRANCH IF YES            M3415  04519302
         TM    UCBTBYT3,DABIT           DIRECT ACCESS DEVICE     M0006  04521602
         BNO   SOP90                    NO, BRANCH               M0006  04523902
         SLL   RB,P2                    MULTIPLY BY 4 FOR DA     M0006  04526202
SOP90    AR    RB,RDEB                  ADD DEB ADDRESS          M0006  04528502
         MVC   DEBLRECL(P2,RB),DCBLRECL SAVE DCBLRECL IN DEB     M0006  04530802
SOP100   EQU   *                                                 XA2865 04535102
         MVC   DXCCW6(1),DCBEROPT       SAVE QSAM ERROR OPTIONS         04537702
         XC    DCBCNTRL(4),DCBCNTRL     CLEAR PARA PASSAGE VECTOR       04540000
*                                                                       04560000
         TM    DCBDEVT,X'20'            D. A. DEVICE BEING USED         04580000
         BO    A0020                    YES, BRANCH                     04590021
         OI    JFCBMASK+6,NORECRDY      SET NON-RECORD-READY BIT  M1802 04600021
*                                       FOR ALL NON-DIRECT ACCESS       04610021
*                                       DEVICES                         04612021
         B     PAM6                     BRANCH AROUND             M1802 04614021
*                                                                       04620000
A0020    EQU   *                                                        04640000
         XC    DCBRELAD(4),DCBRELAD     INITIALIZE RELAD                04660000
         L     RTIOT,CVTPTR(0,0)        GET COMM VECTOR ADDRESS         04680000
         L     RB,CVTZDTAB             DEVICE CONSTANT TABLE ADDRESS    04700000
         IC    RF,DCBDEVT              GET DEVICE CHARACTERISTICS       04720000
         N     RF,DEVTCNST             CLEAR HI 28 BYTES                04740000
         IC    RF,0(RF,RB)             ADD ID TO TABLE ADDRESS          04760000
         LA    RB,0(RF,RB)             ADD CONST AT THIS LOC-PNT DEV    04780000
         IC    RC,DCBDVTBL             SAVE POSSABLE REC NO.R           04800000
         ST    RB,DCBDVTBL             STORE ADDRESS OF DEVICE TABLE    04820000
         STC   RC,DCBDVTBL             RESTORE RECORD NUMBER            04840000
         SR    RC,RC                   CLEAR REG                        04860000
*                                                                       04880000
*                                                                       04900000
         CLI   DCBKEYLE,1              ARE KEYS SPECIFIED               04920000
         BC    10,DEVCN1               YES BRANCH OVERHEAD INCLUDED     04940000
*                                                                       04960000
DEVCNO   IC    RC,8(RB)                GET KEY OVERHEAD                 04980000
*                                                                       05000000
DEVCN1   STC   RC,DCBRELAD+4           STORE EITHER OVHEAD OR ZERO      05020000
*                                                                       05040000
         MVC   DCBTRBAL(2),4(RB)       INITILIZE TRACK BALANCE          05060000
DEVCN2   EQU   *                                                        05080000
*                                                                       05100000
PAM1     EQU   *                                                        05120000
*                                                                       05140000
         TM    0(RPARC),X'07'           DCB OPENED FOR OUTPUT OR OUTIN  05160000
         BC    1,PAM3                  YES BRANCH                       05180000
*                                                                       05220000
*  FIND MEMBER NAME STORE IN DEB ISSUE A BLDL MACRO TO FIND EXTENT      05240000
*                                                                       05260000
         TM    JFCBIND1,X'01'           DCB FOR PDS                     05280000
         BZ    PAM5                     NO BRANCH                M1306  05290021
         CLI   JFCBELNM,X'40'           IS THIS A MEMBER                05340000
         BZ    PAM5                     NO BRANCH                M1306  05360021
         TM    DSCFILTY,X'02'           DSCB SET UP FOR P. O.           05380000
         BC    8,DCBERROR               NO ABEND -- DIAGNOSTIC TEST     05400000
         MVC   BLDLLDF,BLDLCNST         FILL IN LIST DESC FIELD  YM1167 05450002
         MVC   BLDLMNAM,JFCBELNM        MEMBER NAME TO LIST      YM1167 05500002
         LA    R0,BLDLLIST              INPUT REG TO BLDL        YM1167 05510002
*                                                                       05540000
         BLDL  0(RDCB),(0)                                              05560000
*                                                                       05580000
         LTR   RJ,RJ                    HAS AN ERROR OCCURED IN BLDL    05600000
         BZ    PAM2                     NO ERROR HAS OCCURRED    S21042 05610021
*                                       IF RETURN CODE FROM BLDL IS     05630021
*                                       4, THEN INTERNAL CODE IS 54     05632021
*                                       IF RETURN CODE IS 8,            05634021
*                                       THEN INTERNAL CODE IS 55        05636021
         LA    RE,OABD053               LOAD CODE 53 INTO REG    S21042 05637621
         SRL   RJ,2                     DIVIDE BLDL RETURN CODE  S21042 05638221
*                                       BY 4                     I21042 05638821
         AR    RE,RJ                    CALCULATE INTERNAL CODE  S21042 05639221
         B     CALLPD                                            S21042 05639621
*                                                                       05640000
*                                                                       05660000
*                                                                       05680000
PAM2     EQU   *                                                        05700000
*                                                                       05720000
*                                                                       05740000
         SR    RWK1,RWK1                PREPARE REG FOR IC INST  YM1167 05790002
         IC    RWK1,BLDLR               GET R FROM TTRN          YM1167 05840002
         BCTR  RWK1,0                   DECREMENT R VALUE BY 1   YM1167 05850002
         STC   RWK1,BLDLR               NEW R VALUE TO TTRN      YM1167 05860002
         L     R0,BLDLTTRN              INPUT REG TO CNVRT RTN   YM1167 05870002
         B     PAM4                     GO CONVERT IT                   05880000
*                                                                       05900000
PAM3     EQU   *                                                        05920000
*                                                                       05940000
         TM    JFCBIND1,X'01'           DCB FOR PDS                     05960000
         BZ    PAM3D                    NO BRANCH                  DM0P 05961018
         CLI   JFCBELNM,JFCBMEM         OPENING TO A MEMBER        DM0P 05962018
         BE    PAM3D                    NO BRANCH                  DM0P 05963018
         TM    DSCFILTY,POFILTYP        DSCB SET UP FOR P.O.       DM0P 05964018
         BZ    DCBERROR                 NO ABEND                   DM0P 05965018
         B     PAM3C                    YES BRANCH                 DM0P 05966018
*                                                                  DM0P 05967018
PAM3D    EQU   *                                                   DM0P 05968018
*                                                                  DM0P 05969018
         TM    DCBDSORG,PORG            DCB SET UP FOR P.O.        DM0P 05970018
         BZ    PAM3A                    NO BRANCH                  DM0P 05971018
         TM    DSCFILTY,POFILTYP        DSCB SET FOR P.O.          DM0P 05972018
         BZ    DCBERROR                 NO ABEND                   DM0P 05973018
*                                                                       06100000
PAM3A    EQU   *                                                        06120000
*                                                                       06140000
         TM    DEBOFLGS,X'C0'           NEW DATA SET OPENING            06160000
         BC    1,PAM3B                  YES BRANCH                      06180000
         TM    DEBOFLGS,X'80'           DATA SET BEING MODIFIED         06200000
         BZ    PAM3B                   IF NOT, BRANCH AROUND     A47713 06220021
*                                       NEXT                     A47713 06222021
         OI    DCBOFLGS,X'80'          IF YES, TURN ON           A47713 06224021
*                                       LAST-IO-WAS-             A47713 06226021
*                                      WRITE BIT. TRKBAL FILLED IN      06228021
*                                      FROM DSCB; NO SVC 25 NEEDED      06230021
         B     PAM3C                   BR TO MV IN FDAD & TRKBAL A47713 06232021
*                                                                       06240000
PAM3B    EQU   *                                                        06260000
*                                                                       06280000
         TM    DCBDSORG,X'02'           DCB SET UP FOR P. O.            06300037
         BC    8,PAM5                   NO BRANCH                       06310037
*                                                                       06340000
*                                                                       06360000
*                                                                       06380000
PAM3C    EQU   *                                                        06400000
*                                                                       06420000
         MVC   DCBTRBAL(2),DSCLSTAR+3   STORE TRACK BAL OF LAST WRT     06440000
         MVC   DCBRELAD+1(3),DSCLSTAR   MOVE TTR TO WORK AREA           06460000
         L     RE,DCBRELAD              GET TTR IN REG 0                06480000
         SLL   RE,8                     SET TTR UP FOR CONVERT          06500000
         LA    RF,256                                                   06520000
         AR    RF,RE                    SET UP FOR IMPLIED NOTE         06540000
         ST    RF,DCBRELAD              IMPLIED NOTE R+1                06560000
*                                                                       06580000
PAM4     EQU   *                                                        06600000
*                                                                       06620000
         LR    RF,RDEB                  GET DEB ADDR IN PROPER REG.     06640000
         STM   2,13,DXCCW7              SAVE REGS                       06660000
         LA    RDCB,DCBFDAD             GET DCB DISK FIELD              06680000
         L     RTIOT,CVTPTR(0,0)        GET COMM VECTOR                 06700000
         L     RJ,CVTPCNVT              GET CONVERT RT ADDRESS          06720000
         BALR  RD,RJ                    TO CONVT RT.                    06740000
*                                                                       06760000
         LM    2,13,DXCCW7              RESTORE REGS                    06780000
*                                                                       06800000
         B     PAM6                                                     06820000
PAM5     EQU   *                                                        06840000
*********************************************************************** 06860000
*********************************************************************** 06880000
         XC    DCBFDAD(8),DCBFDAD      CLEAR FDAD FIELD                 06900000
         MVC   DCBFDAD+1(6),DEBBINUM    INITILIZE FDAD FIELD            06920000
         TM    DCBCIND1,X'20'           Q-DUMMY EXTENT                  06940000
         BZ    PAM6                     NO-BRANCH                       06960000
*                                                                       06980000
         MVI   DCBFDAD+3,X'FF'          FORCE ILLEGAL FDAD              07000000
PAM6     EQU   *                                                        07020000
*       ****************************************************            07030037
*       **  TURN OFF TRACK OVERFLOW INDICATOR IN DCBRECFM **            07030737
*       **  IF SPECIFIED FOR A TAPE DATA SET              **            07031437
*       ****************************************************            07032137
*                                                                       07032837
        TM    DCBDEVT,TAPEB            TAPE DEVICE?            @ZA16011 07033537
        BNO   PAM6A                    BRANCH IF NO            @ZA16011 07034337
        TM    DCBRECFM,OVRFLO          DFORMAT REC OR OVERFLOW @ZA16011 07035137
        BNO   PAM6A                    BRANCH IF NEITHER       @ZA16011 07035937
        TM    DCBRECFM,X'C0'           DFORMAT REC OR OVERFLOW @ZA16011 07036737
        BZ    PAM6A                    BRANCH IF DFORMAT REC   @ZA16011 07037537
        NI    DCBRECFM,X'FF'-OVRFLO    TURN OFF TRK OVERFLOW   @ZA16011 07038337
PAM6A   EQU   *                                                @ZA16011 07039137
        TM    DCBDEVT,X'40'            UNIT RCD EQUIP USED              07040000
        BC    8,AMOP15                 NO BRANCH                        07060000
*                                                                       07080000
        TM    DEBOPATB,X'0F'           DCB FOR INPUT ONLY               07100000
        BC    8,AMOP14                 YES BRANCH                       07120000
*                                                                       07140000
        TM    DCBMACRF+1,POINTB        NOTE/POINT USED                  07160000
        BC    1,AMOP14A                YES BRANCH                       07180000
*                                                                       07200000
        TM    DEBOPATB,X'0F'           DCB FOR INOUT OR OUTIN           07220000
        BC    1,AMOP15                 NO BRANCH                        07240000
*                                                                       07260000
AMOP14  EQU   *                                                         07280000
        TM    DCBMACRF,POINTB          NOTE POINT TO BE USED            07300000
        BC    8,AMOP15                 NO BRANCH                        07320000
AMOP14A EQU   *                                                         07340000
        MVI   DCBCNTRL+1,10            STORE ID OF DUMMY RTNE           07360000
*                                                                       07370002
*  THE FOLLOWING WILL ADJUST LRECL FOR FIXED UNBLOCKED RECORDS,  XA2865 07372002
*  UNDEFINED LENGTH RECORDS, AND VARIABLE LENGTH UNSPANNED       XA2865 07374002
*  RECORDS. FOR FIXED BLOCKED RECORDS, IGG0191A INSURES LRECL    XA2865 07376002
*  IS VALID.                                                     XA2865 07378002
*                                                                       07378402
AMOP15  EQU   *                                                         07380000
         CLI   DCBDEVT,MICR3890         DEVICE A 3890 ?         XL03123 07390002
         BE    POPEND                   YES-BRANCH              XL03123 07392002
         SR    RWK1,RWK1                CLEAR REG TO ZERO        YM6518 07470802
         CH    RWK1,DCBLRECL            LRECL = ZERO             YM6518 07472802
         BNE   POPEND                   BRANCH IF NOT ZERO       YM6518 07473102
         TM    DCBCIND2,DCBCNQSM        ADJUST FOR QSAM ONLY     XA2865 07475102
         BZ    POPEND                   BR NOT QSAM              XA2865 07477102
         LH    RWK1,DCBBLKSI            ADJUST USING BLKSIZE     XA2865 07479102
         TM    DCBRECFM,DCBRECU         RECFM UNDEFINED          XA2865 07479502
         BNM   NOTVARBL                 YES, GO ADJUST LRECL     XA2865 07479902
         TM    DCBRECFM,DCBRECF         RECFM FIXED              XA2865 07486602
         BO    NOTVARBL                 YES, GO ADJUST LRECL     XA2865 07488602
         TM    DCBRECFM,DCBRECSB        RECFM VAR SPANNED        XA2865 07490602
         BO    POPEND                   YES, BYPASS ADJUSTMENT   XA2865 07492602
         SH    RWK1,BDWLEN              SUB BDW LENGTH           XA2865 07493002
NOTVARBL EQU   *                                                 XA2865 07493102
         STH   RWK1,DCBLRECL            ADJUST LRECL             XA2865 07493202
POPEND   EQU   *                                                        07493302
*                                                                       07500000
****************************************************************** DM0B 09896016
*                                                                  DM0B 09897016
XCTLGOGO EQU   *                                                   DM0B 09898016
         LA    RF,SO6B                  ADDR OF NEXT LOAD ID     S19033 09898519
         USING WTGENTRY,RWTGC                                    Y02072 09898902
         MVC   WTGIDTTR,0(RF)           ID TO WTG ENTRY        @Z30TSCF 09904103
*                                                                       09920000
*                                                                       09940000
*                                                                       09960000
*                                                                       09980000
*                                                                       10000000
*                                                                       10020000
*********************************************************************** 10040000
*                                                                       10060000
*********************************************************************** 10080000
*                                                                       10100000
RELOOP   EQU   *                                                        10120000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     10140000
         LA    RPARC,PLOFF(0,RPARC)    INCR CURRENT DCB ENTRY PTR       10160000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            10180000
         BCR   8,RBASE                 RETURN TO INITIALIZE ANOTHER DCB 10200000
*                                                                       10220000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    10240000
         BC    7,RELOOP                 NO, CHECK NEXT ENTRY            10260000
*                                                                       10280000
         LR    RPARC,RPAR                                               10300000
         LA    RWTGC,WAOFF(0,RWTG)     REINITIALIZE WTG LIST PTR        10320000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           10340000
         BC    7,TCTLRTN           IF NOT TRANSFER CONTROL              10360000
*                                                                       10380000
         LA    RWTGC,WGOFF(0,RWTGC)    GET NEXT ENTRY                   10400000
         LA    RPARC,PLOFF(0,RPARC)                                     10420000
         BC    15,ZCHEK                                                 10440000
*                                                                       10460000
TCTLRTN  EQU   *                                                        10480000
         USING WTG,RWTG                                                 10570003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*10572003
               MODID=WTGENTRY                                  @Z30TSCF 10574003
         DROP  RWTGC,RWTG                                      @Z30TSCF 10576003
**                                                                      10620000
DCBERROR EQU   *                                                        10760000
         LA    RE,OABD053                                        S21042 10770021
*                                       0                        I21042 10790021
CALLPD   EQU   *                                                 S21042 10797021
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES      S21042X10804021
                                        013 ABEND                       10811021
         B     TCTLRTN                  GO XCTL                  S21042 10831021
         EJECT                                                          10860002
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   10940000
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                10960000
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                10980000
*                                                                       10990002
*  MODULE ID'S                                                          10992002
*                                                                       10994002
SO6B     DC    C'6B',VL3(IGG0196B)                             @Z30TSCF 10996003
PDLOAD   DC    C'6M',VL3(IGG0196M)                             @Z30TSCF 10998003
OPIDCNST DC    C'0S'                                                    11000000
AMIDCNST DC    C'1B'                                                    11020000
*                                                                       11070002
*  OTHER CONSTANTS                                                      11120002
*                                                                       11170002
DEVTCNST DC    F'15'                                                    11180000
BLDLCNST DC    X'0001',X'000C'          1 ENTRY, 12 BYTE LIST    YM1167 11182002
BDWLEN   DC    H'0004'                  LEN OF A BLK DESC WORD   XA2865 11182402
         SPACE                                                          11184002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 11186002
END      EQU   *                        END OF MODULE            Y02072 11192002
         EJECT                                                          11200002
           DCBD  DSORG=PS                                               11640000
*                                                                       11660000
*                                                                       11680000
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 11710003
         ORG   WTGIDTTR                                          Y02072 11720002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 11722002
FORCORE  DSECT                                                   YM1167 11732002
         ORG   DXCCW                                             YM1167 11734002
BLDLLIST DS    0CL12                    LENGTH OF BLDL LIST      YM1167 11736002
BLDLLDF  DS    0CL4                     BLDL LIST DESCRIPTION    YM1167 11738002
*                                         FIELD                  YM1167 11738402
BLDLNENT DS    CL2                      NUM OF ENTRIES IN LIST   YM1167 11738802
BLDLLEN  DS    CL2                      LEN OF BLDL LIST FIELD   YM1167 11739202
BLDLMNAM DS    CL8                      MEMBER NAME              YM1167 11739602
BLDLTTRN DS    0CL4                     TTRN                     YM1167 11739702
BLDLTT   DS    CL2                      RELATIVE TRACK NUM OF    YM1167 11739802
*                                         BEGINNING OF DATA SET  YM1167 11739902
*                                         MEMBER                 YM1167 11746602
BLDLR    DS    C                        RELATIVE BLOCK NUMBER    YM1167 11748602
*                                         RELATING TO TT         YM1167 11750602
BLDLN    DS    C                        CONCATINATION NUMBER OF  YM1167 11752602
*                                         DATA SET               YM1167 11753002
         EJECT                                                          11753102
*    COMMUNICATION VECTOR TABLE  (SSS)                                  11753302
*   TASK CONTROL BLOCK                                                  11760000
TIOT     DSECT                                                          12200000
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       12220000
TIOESTTA DS    CL1                           STATUS -A-                 12240000
TIOERLOC DS    CL2                           REL. LOC OF POOL           12260000
TIOEDDNM DS    2F                            DDNAME                     12280000
TIOEJFCB DS    1F                            JFCB DISK ADDR             12300000
TIOESTTB DS    0CL1                                                     12320000
TIOEFSRT DS    CL4                                                      12340000
         DS    CL1                                                      12360000
*        TIOT POOL ENTRY                                                12380000
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       12400000
         DS    CL1                                                      12420000
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      12440000
*                                             SLOTS)                    12460000
TIOPPOOL DS    CL8                           POOL NAME                  12480000
TIOPSTTB DS    XL1                           STATUS OF SLOT             12500000
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  12520000
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      12540000
TIOELINK EQU   TIOERLOC+1                                        M0005  12550020
         SPACE 1                                                        12560000
SRT      DSECT                                                          12580000
         IEFUCBOB                                                       12600000
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          12620000
DEB      DSECT                                                          12640000
DEBNMSUB DS    0CL1                                                     12660000
DEBTCBAD DS    CL4                                                      12680000
DEBAMLNG DS    0CL1                                                     12700000
DEBDEBAD DS    CL4                                                      12720000
DEBOFLGS DS    0CL1                                                     12740000
DEBIRBAD DS    CL4                                                      12760000
DEBOPATB DS    0CL1                                                     12780000
DEBSYSPG DS    CL4                                                      12800000
DEBNMEXT DS    0CL1                                                     12820000
DEBUSRPG DS    CL4                                                      12840000
DEBPRIOR DS    0CL1                                                     12860000
DEBECBAD DS    CL4                                                      12880000
DEBPROTG DS    0CL1                                                     12900000
DEBDEBID DS    0CL1                                                     12920000
DEBDCBAD DS    CL4                                                      12940000
DEBEXSCL DS    0CL1                                                     12960000
DEBAPPAD DS    CL4                                                      12980000
DEBDVMOD DS    0CL1                                                     13000000
DEBUCBAD DS    CL4                                                      13020000
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     13040000
DEBBINUM DS    CL2                                                      13060000
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   13080000
DEBSTRCC DS    CL2                                                      13100000
DEBSTRHH DS    CL2                                                      13120000
DEBENDCC DS    CL2                                                      13140000
DEBENDHH DS    CL2                                                      13160000
DEBNMTRK DS    CL2                                                      13180000
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          13200000
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              13220000
DEBVOLSQ DS    H                                                        13240000
DEBVOLNM DS    H                                                        13260000
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     13280000
DEBSUBID DS    H                                                        13300000
CVT      DSECT                                                          13320000
         CVT                                                            13340000
         IKJTCB                                                , S20016 13352020
           END                                                          13360000
./  ADD  SSI=73120052,NAME=IGG0191C
         TITLE 'IGG0191C-IECOSD06 OPEN EXECUTOR(DUMMY DATA SET)'        00020000
*MODULE NAME - IGG0191C                                          Y02072 00020102
*                                                                       00020202
*DESCRIPTIVE NAME - DUMMY OPEN EXECUTOR                          Y02072 00020302
*                                                                       00020402
*COPYRIGHT - NONE                                                Y02072 00020502
*                                                                       00020602
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00020702
*                                                                       00020902
*          VS2 RELEASE 2 DELETIONS                               Y02072 00021602
*                                                                       00021802
*D000204,009600,025200,026120,026150,026160,026170,027300,       Y02072 00022002
*D027340-027360,045000,045200,045400-045600,046000,049200,       Y02072 00022802
*D050600,060100,026010,027320,268-458,27400-29200,56400-56600    Y02072 00024802
*58400-588000                                                    Y02072 00024902
*                                                                YM1140 00034902
*                                                                YM7889 00044902
*          VS2 RELEASE 3 DELETIONS/CHANGES                              00046900
*                                                                       00047003
*A047724,047728                                                 ZA01372 00047300
*                                                              @Z30TSCF 00047503
*A038801-038832,C039000,040199                                 @ZA07053 00047637
*000001786900-01787200,01810213,01810413-01810423,03909003,    &ZA07619 00047737
*000003927003,03948103-03948703,04181000-04182000,04358421,    &ZA07619 00048037
*000004359231,04570102-04571302,04861000,05020100-05021302     &ZA07619 00048337
*A018110,026759,026867                                         @ZA11148 00048437
*A039495,039497,039499,039501,041850,046750,033851,039501      @ZA12925 00048637
*C039150,039489,041870,045920,033850,039503                    @ZA12925 00048837
*D050324-050360                                                @ZA12925 00049037
*D040820,041084-041092                                         @ZA16037 00049137
*                                                                       00049237
*          RELEASE 20 DELETIONS                                         00049437
*3525024600,025400,026200,059600,060200,060600                   S20016 00049602
*          RELEASE 21 DELETIONS                                         00051502
*2673010000,022800-023000,023800,041200-041600,057000,059600-    S21042 00053402
*2673060600,061800-062600                                        S21042 00055302
*2673                                                            A48163 00057202
*2673                                                            A45054 00059102
* 030000,030500-030520,030660-030800,031600,032000-032400,       A46862 00061002
* 035000-035200,036400-036600,037640-037680                      A46862 00062902
*                                                                A51108 00064802
*D25000,25600,26010-26090,26244-26400                           SA68439 00066802
*A040810,041030,041040,047860,047920,047930,047940             @ZA19736 00069837
*C043520                                                       @ZA27484 00071837
*STATUS CHANGE LEVEL 007                                                00074302
*********************************************************************** 00076202
*                                                                     * 00078102
*FUNCTION-OPERATION --OPENS A DCB FOR 'DUMMY'(I.E.,EFFECTIVE NOP  FOR * 00080000
*                     OPERATIONS ON DATA SET)                         * 00100000
*                                                                     * 00120000
*           VECTORS IN DCB ARE SET SUCH THAT THE FOLLOWING        15741 00126000
*              OPERATIONS WILL IN EFFECT BE                       15741 00132000
*                                                                     * 00180000
*             1.BSAM                                                  * 00200000
*                  WRITE     POST ECB AND RETURN                  15741 00206000
*                  NOTE      NOP (NO OPERATION)                   15741 00212000
*                  POINT     NOP                                      * 00260000
*                  READ      POST ECB AND RETURN                  15741 00270000
*                  CNTRL     NOP                                      * 00300000
*                  CHECK     WRITE - NOP                              * 00320000
*                  CHECK     READ - GO TO EODAD                       * 00340000
*                                                                     * 00360000
*             2 QSAM                                                  * 00380000
*                   GET(MOVE MODE)      GO TO EODAD                   * 00400000
*                   GET(LOCATE MODE)    GO TO EODAD                   * 00420000
*                   PUT(MOVE MODE)      NOP                           * 00440000
*                   PUT(LOCATE MODE)    ADDRESS OF BUFFER RETURNED IN * 00460000
*                                        REGISTER 1                   * 00480000
*                   PUTX                NOP                           * 00500000
*                   CNTRL               NOP                           * 00520000
*                   RELSE               NOP                           * 00540000
*                   TRUNC               NOP                           * 00560000
*                                                                     * 00580000
*             3.DCBIOBA       POINT TO DUMMY IOB WITHIN THIS ROUTINE  * 00600000
*                             ITS ECB IS POSTED COMP.NO ERROR FOR     * 00620000
*                             PRTOV WITH USER EXIT.                   * 00640000
*                                                                     * 00660000
*             4.BUFFER POOL   BUILD POOL IF REQUESTED.ONE BUFFER ONLY * 00680000
*                             FOR QSAM,FULL SIZE POOL FOR BSAM.       * 00700000
*                                                                     * 00720000
*             5.DEB           BUILD A 56 BYTE DUMMY DEB               * 00740002
*                                NONE - APPENDAGE VECTOR TABLE          00742002
*                             16 BYTE - PREFIX                          00744002
*                             32 BYTE - BASIC SECTION                   00746002
*                              4 BYTE - ZERO UCB ADDRESS                00748002
*                              0 BYTE - ACCESS METHOD SECTION           00748402
*                              4 BYTE - SUBROUTINE NAME SECTION         00748802
*                                       (ONLY 2 BYTES USED)             00750002
*                                                                       00750402
*           IT ALSO SETS AUDIT TRAIL BITS IN THE OPEN WORKAREA   Y02072 00752002
*           AFTER ACQUIRING RESOURCES IN CASE OF A FORCE CLOSE   Y02072 00754002
*           SITUATION.                                           Y02072 00756002
*                                                                     * 00760000
*ENTRY POINT  IGG0191C ENTERED BY XCTL                                * 00780000
*                                                                     * 00800000
*INPUT   SEE DESCRIPTION OF REGISTERS,DCB(USERS)                      * 00820000
*                                                                     * 00840000
*OUTPUT  SEE DESCRIPTION OF REGISTERS,DCB(USERS)                      * 00860000
*                                                                     * 00880000
*EXTERNAL ROUTINES  1.SUPERVISOR (GETMAIN)                            * 00900000
*                   2. SUPERVISOR (LOAD)                              * 00920000
*                                                                     * 00940000
*EXITS NORMAL - XCTL TO IGG01911 FOR DCB COPY BACK               Y02072 00960002
*                                                                     * 00980000
*EXITS ERROR: XCTL TO PROB DET (IGG0196M) FOR WTP AND 013 ABEND         01000021
*                                                                     * 01020000
*MACROS : ACTION - GETMAIN, MODESET, DEBCHK, LOAD, DMABCOND,     Y02072 01030002
*                  XCTL, XCTLTABL                                Y02072 01032002
*                                                                       01034002
*MACROS : MAPPING - CVT, IKJTCB, IECDSECS, DCBD, IEZDEB, IHAPSA, Y02072 01036002
*                   IGGPARML                                            01036102
*                                                                       01036402
*ATTRIBUTES - RE-ENTRANT, REUSUABLE, SUPERVISOR STATE,           Y02072 01036802
*             RUNS IN DATA MANAGEMENT KEY UNLESS OTHERWISE       Y02072 01037202
*             SPECIFIED.                                         Y02072 01037602
*                                                                       01038002
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              01040000
*                                                                       01060000
*      BYTE  0-7  NAME                                                  01080000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            01100000
*      BYTE 11    CONCATENATION NUMBER                                  01120000
*      BYTE 12    ZERO                                                  01140000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       01160000
*                        ALIAS INDICATOR 1 BIT                          01180000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      01200000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              01220000
*      BYTE 17    ZERO                                                  01240000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      01260000
*      BYTE 20    TRANSLATION TABLE                                     01280000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            01300000
*      BYTE 22-23 ATTRIBUTES                                            01320000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     01340000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           01360000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 01380000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        01400000
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       01420000
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        01440000
*      BYTE 40-   TABLE OF IDTTR'S                                      01460000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          01480000
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          01500000
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          01520000
*                   NOT USED                         (3 BYTES)          01540000
*                                                                     * 01560000
         EJECT                                                          01599202
*                                                                     * 01600000
*   EQUATES                                                             01620000
*                                                                       01640000
NORLD    EQU   X'10'         NO RELOCATION NECCESSARY INDICATOR  A51108 01650021
*                                FOR LOAD                               01652021
VEC1     EQU   26                                                       01660000
DCBSVC   EQU   84                                                       01680000
READB    EQU   X'20'                                                    01700000
WRITEB   EQU   X'20'                                                    01720000
LOCATEB  EQU   X'08'                                                    01740000
OUTPUT   EQU   X'0F'                                                    01760000
PRINTER  EQU   X'48'                   PRINTER DEVT MASK                01780000
LRECIND  EQU   X'20'                    LOGICAL RECORD INTERFACE A45054 01782021
QSAMB    EQU   X'01'                   DCBCIND2, BIT ON IF QSAM  A45054 01784021
FORMATVS EQU   X'48'                   VARIABLE SPANNED RECORDS  A45054 01786021
FLGOFFST EQU   4                       OFFSET TO FLAG BYTE IN    A48163 01786400
*                                       BUFFER CONTROL BLOCK            01786800
NOT      EQU   X'FF'                   MASK TO TURN OF BITS    @ZA07619 01787137
ADLEN    EQU   3                       LENGTH OF ADDRESS       @ZA07619 01787437
*                                      BUFFER CONTROL BLOCK    @ZA07619 01787737
DWDLEN   EQU   8                        DOUBLEWORD LENGTH        A48163 01788021
EXTND    EQU   X'40'                    FLAG TO INDICATE BUFCB   A48163 01788421
*                                         IS 16 BYTES IN LENGTH  A48163 01788821
LENNSPEC EQU   52                       CODE FOR BUFL OR BLKSE  SA53809 01793202
*                                         NOT SPECIFIED         SA53809 01795202
NOBUFCB  EQU   1                        INVALID ADDRESS          Y02072 01805202
DEBID    EQU   X'0F'                    DEB ID                  SA68439 01807202
DEBSIZE  EQU   56                       SIZE OF DEB FOR DD DUMMY S20016 01810020
PUTLOC   EQU   X'48'                   MACRF MASK,PUT LOCATE   @ZA07053 01810237
GETLOC   EQU   X'48'                   MACRF MASK, GET LOCATE  @ZA07619 01810437
OABD056  EQU   56                      INTERNAL CODE           @ZA07053 01810537
OABD061  EQU   61                      INTERNAL CODE           @ZA07619 01810637
RAFLAG   EQU   X'80'                   RECORD AREA PRESENT     @ZA07619 01810737
BLKFMT   EQU   X'10'                   DCB BLK FORMAT INDICATOR@ZA07053 01810837
VARIABLE EQU   X'40'                   VARIABLE REC INDICATOR  @ZA07053 01810937
FORMATF  EQU   X'80'                   FIXED REC INDICATOR     @ZA07053 01811037
ONE      EQU   1                       NUMBER OF EXTENTS       @ZA11148 01811237
TWO      EQU   2                       EXTENT SCALE            @ZA11148 01811437
FOUR     EQU   4                       ADDITION FACTOR         @ZA07053 01811637
         EJECT                                                          01812002
*                                                                       01814002
* REGISTER EQUATES                                                      01816002
*                                                                       01818002
RE       EQU   0                       WORK REGISTER/PARAM REG          01820000
R0       EQU   RE                       PARM REG FOR DMABCOND   SA53809 01830002
RF       EQU   1                       WORK REGISTER/PARAM REG          01840000
R1       EQU   RF                       PARM REGISTER            Y02072 01842002
RWK1     EQU   RF                      WORK REGISTER             Y02072 01850002
RDCB     EQU   2                       ADDR. OF CURRENT DCB             01860000
RBASE    EQU   3                       BASE REG.                        01880000
RCORE    EQU   4                       ADDR. OF OPEN WORK AREA          01900000
RPAR     EQU   5                       OPEN PARAMETER LIST              01920000
RWTG     EQU   6                       D.E. TABLE FOR XCTL & LOAD       01940000
RPARC    EQU   7                       CURRENT ENTRY IN PARAM. LIST     01960000
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       01980000
RTIOT    EQU   9                       WORK REG.                        02000000
RWK2     EQU   RTIOT                   WORK REGISTER             Y02072 02010002
RUCB     EQU   10                      WORK REG.                        02020000
RDEB     EQU   11                      WORK REG.                        02040000
RWK5     EQU   RDEB                     WORK REGISTER            Y02072 02050002
RA       EQU   11                      WORK REG.                        02060000
RB       EQU   12                      WORK REG                         02080000
RC       EQU   13                      WORK REG                         02100000
RWK6     EQU   RC                       WORK REGISTER           SA53809 02110002
RD       EQU   14                      WORK REG                         02120000
RWK3     EQU   RD                      WORK REGISTER             Y02072 02130002
RJ       EQU   15                      WORK REG/PARAM REG               02140000
RWK4     EQU   RJ                      WORK REGISTER             Y02072 02150002
         EJECT                                                          02160002
IGG0191C CSECT                                                          02220000
         BALR  RBASE,0                 SET UP BASE REG                  02260002
         USING FORCORE,RCORE                                            02340000
         USING *,RBASE                                           S21042 02380021
         USING PSA,0                                                    02390002
         USING IHADCB,RDCB                                              02400000
**                                                                      02420000
         B     BEGIN                    BR AROUND CONSTANTS             02430002
         DC    C'IGG0191C'              MODULE NAME                     02432002
         DC    C'@ZA27484'              LAST SHIP CODE         @ZA16037 02436037
         DC    C'10/27/77'              LAST DATE MODIFIED     @ZA16037 02436837
BEGIN    DS    0H                                                       02438402
**                                                                      02438802
         L     RCORE,4(RWTGC)          GET WORKAREA                     02440000
*                                                                       02450002
         SR    RWK1,RWK1                PREPARE TO CLEAR FIELD   Y02072 02450102
         ST    RWK1,DXMSGADR            ZERO SO LAST LOAD OF     Y02072 02450502
*                                         OPEN EXECS WILL NOT    Y02072 02450902
*                                         THINK MSG CSECT LOADED        02451302
*SET A BIT IN COMMON OPENS AUDIT TRAIL INDICATING TO FORCE       Y02072 02452002
*CLOSE AND PROBLEM DETERMINATION NOT TO REFRESH THE USERS DCB    Y02072 02454002
*FROM THE KEY 5 DCB BEFORE TAKING ANY USER EXITS.                Y02072 02456002
*                                                                       02458002
         OI    DXATCOM1,DXATREFR        DO NOT REFRESH DCB       Y02072 02458402
         LA    RJ,DEBSIZE               GET SIZE OF DEB          S20016 02460020
         USING PARML,RPARC                                              02470002
         L     RDCB,PARDCBAD            SET UP DCB ADDRESSABILITY       02480002
         GETMAIN R,LV=(15),SP=230       GET MAIN FOR DUMMY DEB   Y02072 02520002
         XC    0(DEBSIZE,RF),0(RF)      CLEAR CORE               S20016 02540020
         USING DEBPREFX,RWK1                                            02550002
         MVI   DEBLNGTH,(DEBSIZE+7)/8   DBL WORD LEN TO DEB     SA68439 02560002
         LA    RWK3,DEBBASIC            BASIC SECTION OF DEB    SA68439 02570002
         DROP  RWK1                                                     02572002
         ST    RWK3,24(RWTG)            TEMP STORE OF DEB ADDR.         02580002
         MVC   DCBDEBAD+1(3),25(RWTG)  MOVE DEBAD TO DCB                02600000
         L     RWK5,PSATOLD             ADDR OF CURRENT TCB     SA68439 02604002
*                                                                       02609402
* MUST USE CS INSTRUCTION TO PUT DEB ON TCB DEB CHAIN TO PREVENT Y02072 02609802
* OVERLAYING THE ADDRESS OF ANOTHER DEB BEING ADDED BY ANOTHER   Y02072 02610202
* CPU.                                                           Y02072 02610602
*                                                                       02610702
         USING TCB,RWK5                                          Y02072 02611002
         USING DEBBASIC,RWK3                                     Y02072 02613002
         L     RWK4,TCBDEB              GET FIRST DEB ON CHAIN   Y02072 02615002
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 02615102
SD04110  EQU   *                                                 Y02072 02615402
         ST    RWK4,DEBDEBAD            LINK DEBS                Y02072 02615802
         CS    RWK4,RWK3,TCBDEB         INSERT DEB INTO DEB CHN  Y02072 02616602
         BNE   SD04110                  IF CS INST FAILS, TRY    Y02072 02619202
*                                         AGAIN                  Y02072 02621202
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 02621802
         ST    RWK5,DEBTCBAD            TCB ADDR TO DEB          Y02072 02623802
         MVC   DEBOPATB,PAROPT          COPY OPEN ATTRIBUTES    SA68439 02673802
         NI    DEBOPATB,X'FF'-PARENLST  TURN OFF END LIST BIT   SA68439 02675802
         MVI   DEBNMEXT,ONE             NUMBER OF EXTENTS = 1  @ZA11148 02679837
         ST    RDCB,DEBDCBAD            DCB ADDR TO DEB         SA68439 02681837
         MVC   DEBPROTG,DXUKEY          PROTECT KEY TO DEB      SA68439 02683837
         OI    DEBDEBID,DEBID           DEB IDENTIFIER          SA68439 02685837
         MVI   DEBEXSCL,TWO             EXTENT SACLE = 2       @ZA11148 02687837
         DROP  RWK5,RPARC                                               02690602
         MVC   6(2,RWTG),SPLD          STORE ID OF DUMMY IN DE          02693302
         MVI   22(RWTG),X'CB'           PUT ATTRIBUTES IN LIST          02700000
         NI    23(RWTG),X'FF'-NORLD    RELOCATE IS REQUIRED      A51108 02710021
         MVC   14(3,RWTG),SPLD+2       STORE TTR OF DUMMY IN DE         02720000
         DEBCHK (RDCB),TYPE=ADD,AM=SAM   ADD DEB TO DEB TABLE    Y02072 02732002
*                                                                       02742002
*  LOAD IGG019AV, DUMMY ACCESS METHOD ROUTINE                           02752002
*                                                                       02762002
         USING WTGMODNM,RWTG                                     Y02072 02782002
         MVC   WTGMODID,SPLD            ID TO MOD NAME           Y02072 02832002
         DROP  RWTG                                              Y02072 02882002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 02892002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 02894002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 02896002
         DROP  R1                       DROP CVT BASE            YM1140 02898002
**                                                                      02900000
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 02920002
**                                                                      02940000
**                                                                      02960000
         OI    23(RWTG),NORLD          RESET RELOCATE BIT        A51108 02962021
         MVC   DEBSUBID-DEBSUBNM+DEBBASND+L'DEBSUCBA,SPLD SUBID SA68439 02964002
         MVI   DEBNMSUB,1               NO OF ACC METH RTNS     SA68439 02966002
         DROP  RWK3                                                     02968002
         USING ADUMMY,RTIOT            SET THE BASE              A46862 02970021
         LR    RTIOT,RE                 SAVE ADDR.OF IGG019AV           02980000
         L     RD,ADUMPUT              LOAD DUMMY PUT ADDR       A46862 02990021
         ST    RD,24(RWTG)             TEMP.STORE OF DUMMY ADDR. A46862 03000021
         MVC   DCBCNTRL+1(3),25(RWTG)  LOAD ADDR.OF CNTRC/NOTE/POINT    03020000
         MVC   DCBREAD+1(3),25(RWTG)   LOAD ADDR.OF RD/WR/GET/PUT       03040000
         TM    DCBMACRF,X'02'          USING READ/CNTRL          A28185 03042019
         BO    SD04120                 YES,BRANCH                A28185 03044019
         TM    DCBMACRF+1,X'02'        USING WRITE/CNTRL         A28185 03046019
         BZ    SD04121                 NO,BRANCH                 A28185 03048019
SD04120  L     RD,ADUMCNTR             ADDR OF DUMMY CNTRL       A46862 03050021
         ST    RD,24(RWTG)             TEMP STORE OF CNTRL ADDR  A28185 03054019
         MVC   DCBCNTRL+1(3),25(RWTG)  LOAD ADDR OF CNTRL RTN    A28185 03056019
SD04121  L     RD,ADUMCHEK             ADDR OF CHECK RTN         A46862 03066021
         ST    RD,24(RWTG)              TEMP STORE OF CHECK ADDR.       03100000
         MVC   DCBCHECK+1(3),25(RWTG)  LOAD ADDR.OF CHECK/GERR/PERR)    03120000
*                                                                       03140000
         L     RUCB,ADUMIOB            LOAD ADDR OF DUMMY IOB    A46862 03160021
         ST    RUCB,DCBIOBA             STORE IOB ADDR.INDCB            03180000
*                                                                       03260000
SD04130  TM    DCBMACRF,READB           IS THIS BSAM                    03280000
         BC    1,SD04132                YES BRANCH                      03300000
         TM    DCBMACRF+1,WRITEB        NO                              03320000
         BC    1,SD04132                YES BRANCH                      03340000
*                                                                       03360000
         OI    DCBCIND2,DCBCNQSM        SET QSAM INDICATOR       YM5574 03362002
         SR    RB,RB                    CLEAR REGISTER            M1552 03365000
         IC    RB,DCBBUFNO              GET NUMBER OF BUFFERS     M1552 03370000
         LTR   RB,RB                    IS BUFNO EQUAL TO ZERO    M1552 03375000
         BNE   NODEFALT                 NO, BRANCH AROUND         M1552 03380000
         LA    RB,5                     DEFAULT IS 5 BUFFERS   @ZA12925 03385037
         STC   RB,DCBBUFNO              NUMBER OF BUF TO DCB   @ZA12925 03387037
NODEFALT EQU   *                                                  M1552 03390000
         TM    0(RPARC),OUTPUT          QSAM OUTPUT                     03400000
         BC    14,SD04131               NO, BRANCH INPUT OR UPDATE      03420000
*                                                                       03440000
         TM    DCBMACRF+1,LOCATEB       PUT LOCATE                      03460000
         BZ    SD04200                 NO BRANCH TO GET BUF POOL        03480000
         L     RD,ADUMPUTL             LOAD DUMMY PUT LOCATE ADD A46862 03490021
         ST    RD,24(RWTG)              TEMP.STORE OF PUT ADDR.         03540000
         MVC   DCBPUT+1(3),25(RWTG)    LOAD ADDR OF PUT                 03560000
         B     SD04200                  BRANCH TO GETT POOL             03580000
*                                                                       03600000
SD04131  EQU   *                                                        03620000
         L     RD,ADUMGET              ADDR OF DUMMY GET RTN     A46862 03630021
         ST    RD,24(RWTG)              TEMP.STORE OF GET ADDR.         03680000
         MVC   DCBGET+1(3),25(RWTG)    LOAD ADDR OF GET                 03700000
         B     SD04200                 BRANCH TO GET POOL               03720000
*                                                                       03740000
SD04132  EQU   *                                                        03760000
         L     RD,ADUMBSAM             LOAD ADDR OF DUM. BSAM    A46862 03770021
         ST    RD,24(RWTG)              TEMP.STORE OF ADDRESS     15741 03772000
         MVC   DCBREAD+1(3),25(RWTG)    MOVE ADDRESS TO DCB       15741 03776000
         SR    RB,RB                    CLEAR RB                        03780000
         IC    RB,DCBBUFNO              GET NO.BUFFERS REQUESTED        03800000
         LTR   RB,RB                    ANY BUFFERS REQUIRED            03820000
         BZ    SD04END1                 NO BRANCH TO END                03840000
SD04200  EQU   *                                                        03880000
         TM    DCBCIND2,QSAMB           IS THIS QSAM?          @ZA07053 03900037
         BNO   SD04210                  NO - BY PASS BLOCK CHK @ZA07053 03903037
         TM    DCBMACRF+1,PUTLOC        PUT, IN LOCATE MODE    @ZA07053 03906037
         BNO   SD04203                  NO - BYPASS BLOCK CHK  @ZA07619 03909037
         TM    DCBRECFM,BLKFMT          BLOCK FORMAT?          @ZA07053 03912037
         BNO   SD04204                  NO - BYPASS BLOCK CHK  @ZA12925 03915037
         TM    DCBRECFM,VARIABLE        "V" RECORDS            @ZA07053 03918037
         BNO   FIXED                    NO - CHECK FOR FIXED   @ZA07053 03921037
         TM    DCBRECFM,FORMATVS        IS THIS SPAN RECS?     @ZA07053 03924037
         BO    SD04205                  YES - BYPASS BLOCK CHK @ZA07619 03927037
         LH    RC,DCBLRECL              OBTAIN LRECL           @ZA07053 03930037
         LA    RD,FOUR                  ADD LENGHT OF BDW      @ZA07053 03933037
         AR    RC,RD                                           @ZA07053 03936037
         CH    RC,DCBBLKSI              IS LRECL GT BLKSIZE?   @ZA07053 03939037
         BNH   SD04210                  NO - CONTINUE          @ZA07053 03942037
         LA    RE,OABD056               YES - ISSUE ABEND      @ZA07053 03945037
         B     ERROR                                           @ZA07053 03948037
SD04203  TM    DCBMACRF,GETLOC         GET, LOCATE MODE?       @ZA07619 03948337
         BNO   SD04210                 NO - CONTINUE           @ZA07619 03948637
SD04204  TM    DCBRECFM,FORMATVS       IS THIS SPANNED REC?    @ZA12925 03948937
         BNO   SD04210                 NO - CONTINUE           @ZA07619 03949137
SD04205  TM    DCBBUFCB+ADLEN,NOBUFCB  BUFCB SPECIFIED?        @ZA07619 03949337
         BO    FIXED                   NO - GET THE BUFFERS    @ZA12925 03949537
         MODESET  KEYADDR=DXUKEY,WORKREG=15  GOTO USER KEY     @ZA12925 03949737
         L     RJ,DCBBUFCB             GET BCB ADDRESS         @ZA12925 03949937
         TM    FLGOFFST(RJ),RAFLAG     RECORD ARE PRESENT?     @ZA12925 03950137
         BO    SD04285                 YES, EXIT               @ZA12925 03950337
         TM    DCBBFTEK,LRECIND        RECORD AREA NEEDED?     @ZA12925 03950437
         BNO   SD04285                 NO, EXIT                @ZA12925 03950537
         TM    FLGOFFST(RJ),EXTND      SPACE AVAILABLE FOR LRI?@ZA12925 03950637
         BNO   DCBERROR                NO,SET DCB IN ERROR     @ZA12925 03950737
         B     GETRALEN                BRANCH TO GET RECORD    @ZA12925 03950837
*                                      AREA ONLY               @ZA07619 03950937
FIXED    EQU   *                        CHECK FIXED BLOCK FMT  @ZA07053 03951037
         TM    DCBRECFM,FORMATF         FIXED REC ?            @ZA07053 03954037
         BZ    SD04210                  NO - CONTIUE           @ZA07053 03957037
         SR    RD,RD                    CLEAR REGISTER         @ZA07053 03960037
         LH    RJ,DCBBLKSI              OBTAIN BLKSIZE         @ZA07053 03963037
         LTR   RJ,RJ                    CHECK FOR BLKSIZE=ZERO @ZA07053 03966037
         BZ    SD04210                  BRANCH IF ZERO         @ZA07053 03969037
         LH    RA,DCBLRECL              OBTAIN LRECL           @ZA07053 03972037
         LTR   RA,RA                    CHECK FOR LRECL=ZERO   @ZA07053 03975037
         BZ    SD04210                  BRANCH IF ZERO         @ZA07053 03978037
         DR    RD,RA                    DIVIDE BLKSIZE BY LRECL@ZA07053 03981037
         LTR   RD,RD                    IS THERE A REMAINDER ? @ZA07053 03984037
         BZ    SD04210                  NO - CONTINUE          @ZA07053 03987037
         LA    RE,OABD056               YES - ISSUE ABEND      @ZA07053 03990037
         B     ERROR                                           @ZA07053 03993037
SD04210  TM    DCBBUFCB+3,1             IS THERE A BUF.CNTL.BLK@ZA07053 03996037
         BZ    SD04END1                 YES BRANCH TO END               03999037
         LH    RC,DCBBUFL               GET BUFFER LENGTH      @ZA07053 04002037
         LTR   RC,RC                    HAS IT BEEN SPECIFIED           04026602
         BC    7,SD04220                BRANCH ON YES                   04033302
         LH    RC,DCBBLKSI              GET LENGTH FROM BLOCK SIZE      04040000
         LTR   RC,RC                   IS BLOCK SIZE SPECIFIED          04060000
         BP    SD04220                 YES BRANCH TO GET POOL           04080000
         LA    RWK2,NOBUFCB            INIT REG FOR NOT PUTL   @ZA19736 04082037
*                                                                       04084037
*  TEST FOR QSAM OUTPUT WITH LOCATE MODE. IF YES,ABEND USER             04086037
*  TO KEEP HIM FROM ABENDING WHEN IGG019AV DOES NOT PASS HIM            04088037
*  A VALID BUFFER ADDRESS BECAUSE SOME DCB FIELDS ARE NOT SPECIFIED     04090037
*                                                              @ZA19736 04092037
*                                                                       04094037
         TM DCBMACF2,PUTLOC + DCBMRLCP    PUT LOCATE?          @ZA19736 04096037
         BNO SD04220                      NO BYPASS DMACOND &  @ZA19736 04098037
*                                         DO GETMAIN!          @ZA19736 04100037
         LA    R0,LENNSPEC              INTERNAL ABEND CODE     SA53809 04110002
ERROR    DMABCOND  (R0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES   SA53809 04112002
         B     TCTLRTN                  GO TO PROB DETERMINATION S21042 04160021
**                                                                      04180000
DCBERROR MODESET  EXTKEY=DATAMGT       DATA MGT KEY            @ZA12925 04185037
         LA    RE,OABD061              LOAD INTERNAL CODE      @ZA12925 04187037
         B     ERROR                                           @ZA07619 04190037
*                                                                       04195037
SD04220  LA    RC,7(0,RC)               ADJUST                          04200000
         SRL   RC,3                            TO                       04220000
         SLL   RC,3                               DOUBLE ALIGNMENT      04240000
*                                                                       04260000
         LR    RD,RB                     SAVE LENGTH AND NUMBER         04280000
         LR    RJ,RC                                                    04300000
         MR    RD,RD                    COMPUTE TOTAL LENGTH            04320000
*                                                                       04340000
         TM    DCBCIND2,QSAMB          IT IT QSAM               A45054  04350021
         BNO   DEFAULT                                         @ZA27484 04352037
         TM    DCBBFTEK,LRECIND        LRI REQUESTED            A45054  04354021
         BNO   ALIGN                                            A45054  04356021
         TM    DCBRECFM,FORMATVS       VARIABLE SPANNED         A45054  04358021
         BNO   DEFAULT                 BRANCH TO TURN OFF LRI  @ZA07619 04358437
*              ALLOW 8 EXTRA BYTES FOR EXTENDED CONTROL BLOCK           04358637
         B     SD04230                                          A45054  04358837
DEFAULT  NI    DCBBFTEK,NOT-LRECIND    TURN OFF LRI            @ZA07619 04359037
*                                                                       04359237
ALIGN    EQU   *                                                A45054  04359621
*                                                                       04360000
         TM    DCBBFTEK,1               FULL WORD ALLIGNMENT REQUIRED   04380000
         BC    1,SD04230                BRANCH ON YES                   04400000
         LA    RJ,8(0,RJ)               ADD 8 ON NO                     04420000
         B     SD04240                                                  04440000
*                                                                       04460000
SD04230  LA    RJ,16(0,RJ)              ADD  16  ON  YES                04480000
         OI    FCAOPEN,FCAOXTND         INDIC BCB IS EXTENDED    Y02072 04482002
SD04240  EQU   *                                                 Y02072 04490002
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 04492002
*                                                                       04502002
         GETMAIN R,LV=(15),SP=0                                  Y02072 04520002
*                                                                       04570002
SD0426A  EQU   *                                               &ZA07619 04580037
         TM    DCBBUFCB+3,NOBUFCB      BUFCB SPECIFIED?        &ZA07619 04581037
         BO    SD04246                 NO, GO FORMAT POOL      &ZA07619 04582037
         L     RJ,DCBBUFCB             YES, GET BUFCB ADDRESS  &ZA07619 04583037
         OI    FLGOFFST(RJ),RAFLAG     SET FLAG SHOWING        &ZA07619 04584037
*                                      REC ADDR PRESENT        &ZA07619 04585037
         ST    RF,8(RJ)                STORE REC-AREA ADDRESS  &ZA07619 04586037
         LH    RJ,DCBLRECL             LOAD LRECL IN WORK REG  &ZA07619 04587037
         LA    RJ,32(RJ)               ADD 32 BYTE CNTRL FIELD &ZA07619 04588037
         ST    RJ,0(RF)                STORE LRECL IN REC-AREA &ZA07619 04589037
         XC    4(32,RF),4(RF)          CLEAR CNTRL FIELD IN    &ZA07619 04590037
*                                      RECORD AREA             &ZA07619 04591037
         B     SD04285                 EXIT                    @ZA12925 04592037
SD04246  ST    RF,0(0,RF)              TEMP. STORE START OF BUF. POOL   04593037
         LR    RWK2,RWK1                SAVE FIRST BUFFER ADDR   Y02072 04600002
         STH   RB,4(0,RF)              STORE BUFNO IN BUF CONTROL BLK   04620037
         STH   RC,6(0,RF)              STORE LNTH IN BUF CONTROL BLK    04630037
         SPACE 2                                                        04660002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 04670002
         SPACE 2                                                        04672002
         OI    FCAOPEN,FCAOBUF          INDIC BUFFERS GETMAINED  Y02072 04674002
         STCM  RWK2,B'0111',DCBBUFCA    BCB ADR TO DCB         @ZA12925 04675037
         SPACE 2                                                        04676002
         MODESET  KEYADDR=DXUKEY,WORKREG=10  BACK TO USER KEY    Y02072 04678002
         SPACE 2                                                        04678402
         LR    RUCB,RF                  GET ADDR.IN WOKR REG.           04680000
         LA    RUCB,8(0,RUCB)           POINT TO SECOND DOUBLE WORD     04700000
         TM    DCBBFTEK,1               DOUBLE WORD ALLIGN.             04720000
         BC    8,TSTLRI                 YES BRANCH               A48163 04740021
         LA    RUCB,4(0,RUCB)           POINT TO FULL NOT DOUBLE        04760000
         B     EXTEND                   GO SET EXTEND FLAG       A48163 04770021
TSTLRI   EQU  *                                                 ZA01372 04772000
         TM    DCBCIND2,DCBCNQSM        IS IT QSAM              ZA01372 04772400
         BNO   SD04250                  NO, DO NOT TEST LRI     ZA01372 04772800
         TM    DCBBFTEK,LRECIND         LRI SUPPORTED           ZA01372 04774000
         BNO   SD04250                  NO, BRANCH TO SAVE FIRST A48163 04776021
*                                        BUFFER ADDRESS          A48163 04778021
         LA    RUCB,DWDLEN(0,RUCB)      YES, OFFSET TO NEXT DW   A48163 04778421
EXTEND   OI    FLGOFFST(RF),EXTND       SET FLAG TO INDICATE     A48163 04778821
*                                       BUFFER CONTROL BLOCK EXTENDED   04779221
*                                                                       04779621
*          THE NEXT SEQUENCE OF INSTRUCTIONS BUILDS A BUFFER POOL       04779721
SD04250  EQU   *                                                        04780000
         LTR   RC,RC                    TST FOR ZERO BUFLN     @ZA19736 04786037
         BNZ   SD04255                  BUFLN ZERO BRANCH!     @ZA19736 04791037
         ST    RC,0(0,RF)               ZERO NXT BUF PTR       @ZA19736 04796037
         B     SD04285                  LEAVE                  @ZA19736 04801037
SD04255  ST    RUCB,0(RF)               STORE BUFFER ADDR.     @ZA19736 04806037
         LR    RF,RUCB                  SAVE NEXT BUFFER ADDR.          04820000
SD04260  EQU   *                                                        04840000
         BCT   RB,SD04280               IF MORE BRANCH                  04860000
         B     SD04283                  EXIT                   &ZA07619 04880037
SD04280  EQU   *                                                        04940000
         ALR   RUCB,RC                  BUFF LEN + BUFF ADDR.           04960000
         ST    RUCB,0(RF)               STORE NEXT BUFF IN LINK         04980000
         ALR   RF,RC                    UPDATE TO NEXT LINK             05000000
         B     SD04260                                                  05020000
SD04283  TM    DCBBFTEK,LRECIND        RECORD AREA NEEDED?     &ZA07619 05020637
         BNO   SD04284                 NO, EXIT                &ZA07619 05021237
         L     RJ,DCBBUFCB             YES,GET BUFFER CNTL BLK &ZA07619 05021837
         TM    FLGOFFST(RJ),EXTND      SPACE AVAILABLE FOR     &ZA07619 05022437
*                                      RECORD AREA?            &ZA07619 05023037
         BNO   DCBERROR                NO, ABEND               &ZA07619 05023637
*                                                              &ZA07619 05024237
GETRALEN EQU   *                                               &ZA07619 05024837
         LH    RJ,DCBLRECL             LOAD LRECL IN WRK REG   &ZA07619 05025437
         LA    RJ,32(RJ)               ADD 32 BYTES FOR CNTRL  &ZA07619 05026037
*                                      INFORMATION             &ZA07619 05026637
         B     SD04240                 GET SPACE FOR REC AREA  &ZA07619 05027237
*                                                              &ZA07619 05027837
SD04284  EQU   *                                               &ZA07619 05028437
         ST    RB,0(RF)                LAST LINK TO ZERO       &ZA07619 05029037
SD04285  EQU   *                                                 Y02072 05030002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05032002
***                                                                     05040000
SD04END1 EQU   *                                                 Y02072 05050002
         USING WTGENTRY,RWTGC                                    Y02072 05052002
         MVC   WTGIDTTR,LASTLOAD        MOVE ID TO WTG ENTRY   @Z30TSCF 05060003
         LR    RA,RBASE                SET RA FOR POSSIBLE REPEAT       05080000
**                                                                      05100000
*                                                                       05120000
*          THIS IS AN OPEN PROVIDED SECTION OF CODE THAT SETS UP XCTL   05140000
*                                                                       05160000
*********************************************************************   05180000
*                                                                       05200000
*                                                                       05220000
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)    INCREMENT TO NXT ENTRY IN WRG    05240000
         LA    RPARC,PLOFF(0,RPARC)    INCREMENT TO NXT DCB IN PARAM    05260000
         CLC   0(2,RWTGC),AMIDCNST     IS NXT ALSO DUMMY                05280000
         BCR   8,RA                    YES RETURN TO START              05300000
*                                                                       05320000
         CLC   0(2,RWTGC),OPIDCNST     IS NXT END OF WTG                05340000
         BC    7,RELOOP                NO RETURN TO TEST NXT ENTRY      05360000
*                                                                       05380000
         LR    RPARC,RPAR              INITIALIZE PARAM REGISTER        05400000
         LA    RWTGC,WAOFF(0,RWTG)     INIT. WTGC REG TO START OF WTG   05420000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           05440000
         BC    7,TCTLRTN           IF NOT TRANSFER CONTROL              05460000
*                                                                       05480000
         LA    RWTGC,WGOFF(0,RWTGC)    INCREMENT TO NXT ENTRY IN WTG    05500000
         LA    RPARC,PLOFF(0,RPARC)    INC. TO NXT DCB IN PARAM LIST    05520000
         BC    15,ZCHEK                                                 05540000
*                                                                       05560000
TCTLRTN  EQU   *                                                        05580000
*                                                                       05600000
         USING WTG,RWTG                                                 05650003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*05700003
               MODID=WTGENTRY                                  @Z30TSCF 05750003
         DROP  RWTGC,RWTG                                      @Z30TSCF 05752003
*                                                                       05760000
WAOFF      EQU   32                                                     05780000
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                05800000
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                05820000
OPIDCNST DC    C'0S'                                                    05900000
AMIDCNST DC    C'1C'                                                    05920000
SPLD     DC    C'AV'                    DUMMY ROUTINE            Y02072 05930002
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETER             @Z30TSCF 05932003
LASTLOAD DC    C'11',VL3(IGG01911)      DCB COPY BACK ROUTINE  @Z30TSCF 05934003
*                                                                       05940000
PATCH    DC    25H'0'                   PATCH AREA               Y02072 05950002
END      EQU   *                        END OF MOSULE            Y02072 06000002
         SPACE 6                                                        06080002
ADUMMY   DSECT                                                   A46862 06090021
ADUMPUT  DS    A                   ADDR OF DUMMY PUT RTN         A46862 06092021
ADUMPUTL DS    A                   ADDR OF DUMMY PUT LOCATE RTN  A46862 06094021
ADUMGET  DS    A                   ADDR OF DUMMY GET RTN         A46862 06096021
ADUMCHEK DS    A                   ADDR OF DUMMY CHECK RTN       A46862 06098021
ADUMIOB  DS    A                   ADDR OF DUMMY IOB RTN         A46862 06098421
ADUMBSAM DS    A                   ADDR OF DUMMY BSAM RTN        A46862 06098821
ADUMCNTR DS    A                   ADDR OF DUMMY CNTRL RTN       A46862 06099221
*                                                                       06099621
         EJECT                                                          06104702
         IHAPSA                                                         06106702
         EJECT                                                          06108702
         IGGPARML                                                       06109102
         EJECT                                                          06109802
CVT      DSECT                                                          06114902
***                                                                     06120000
         CVT                                                            06140000
***                                                                     06160000
         IECDSECS MAIN,WTG,DCB,PREFX,EXPAND=YES                @Z30TSCF 06220003
         ORG   WTGIDTTR                                          Y02072 06230002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 06240002
         EJECT                                                          06242002
FORCORE  DSECT                                                   Y02072 06250002
         IHAFCAUD  ORG=YES                                       Y02072 06260002
         EJECT                                                          06262002
         IKJTCB                                                  Y02072 06270002
         EJECT                                                          06270402
         IEZDEB                                                  Y02072 06272002
         END                                                            06280000
./  ADD  SSI=43081005,NAME=IGG0191D
 TITLE 'IGG0191D - OPEN EXECUTOR FOR OUTPUT AND DA DEVICES'             00020002
IGG0191D CSECT                                                          00021203
*MODULE NAME - IGG0191D                                          Y02072 00022403
*                                                                       00023603
*DESCRIPTIVE NAME = BUILD IOBS                                   Y02072 00024803
*                                                                       00026003
*COPYRIGHT - NONE                                                Y02072 00027203
*                                                                       00028403
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00029603
*                                                                       00030803
*           VS2 RELEASE 2 DELETIONS                              Y02072 00032003
*012400,015000,053400,068400,068800,069200,070840,070880-070920, Y02072 00033203
*073480-073500,073502-073600,079400,137200,139900,139920-140240  Y02072 00034403
*200,124900,125800,129800,131200                                 Y02072 00035602
*                                                                YM4697 00035702
*                                                                YM7595 00037002
*                                                                       00037403
*          VS2 RELEASE 3 DELETIONS                                      00037803
*                                                              @Z30TSCF 00038203
*          RELEASE 20 DELETIONS                                       * 00038702
*0973032600-032800,058400-058600,061600,070800,073520-073540,    S20201 00040002
*0973081600-083000,108200-110600,111600-112200,113400-119800,    S20201 00041302
*0973136200-137600,139000,139400,140000                          S20201 00042602
*          RELEASE 21 DELETIONS                                       * 00043902
*0091074000,118800,120300                                        M0131  00045202
*0091004700,130800,134680-134760,139000-140000,140200,147400-    S21042 00046502
*0091147600                                                      S21042 00047802
*0091073502-073506,074600-076400,120000-121000                   A37507 00049102
*                                                                       00050402
*STATUS CHANGE LEVEL 008                                                00051702
*                                                                       00053002
*FUNCTION/OPERATION: THIS ROUTINE WILL SET UP A CODE IN THE DCBCNTRL    00060000
*      FIELD OF THE DCB FOR IGG01910. IGG01910 WILL FROM THIS CODE      00080000
*      DETERMINE WHAT INPUT/OUTPUT ROUTINES WILL BE BROUGHT INTO CORE   00100000
*      AT OPEN TIME. (BASIC)                                            00120000
*      IT WILL DETERMINE HOW MANY IOB'S ARE TO BE CREATED, USE'GETMAIN' 00140000
*      TO GET CORE FOR THE IOB'S, AND CLEAR THE CORE.                   00160000
*      IF THE DCB IS BEING OPENED FOR OUTPUT                            00170019
*      IT WILL LINK THE IOB'S AND INITIALIZE THEM.                      00180000
*      IT WILL CONSTRUCT CHANNEL PROGRAMS NEEDED FOR PROPER EXECUTION.  00200000
*      IT WILL SET UP THE NUMBER OF EXTENTS NEEDED AND PLACE THE        00220000
*      ADDRESSES IN THE DCB AND IOB'S.                                  00240000
*      IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA           Y02072 00250002
*      INDICATING TO FORCE CLOSE THAT THE CORE GETMAINED FOR THE Y02072 00252002
*      IOB'S CAN BE FREEMAINED.                                  Y02072 00254002
*                                                                       00260000
*      THIS MODULE WAS SPLIT FOR RELEASE 19.  THE RESULTING MODULE      00265019
*      IS IGG0191O.                                                     00270019
*                                                                       00275019
*ENTRY POINTS: ENTERED FROM IGG0191A BY USE OF THE XCTL MACRO.          00280000
*                                                                       00300000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00320000
*OUTPUT: IOB(USER), SEE DESCRIPTION OF THE REGISTERS, DCB(USERS)        00340000
*                                                                       00360000
*                                                                       00380000
*EXTERNAL ROUTINES: NONE.                                               00400000
*                                                                       00420000
*EXITS-NORMAL: XCTL TO IGG01910(IECOSLDA)    TO LOAD ROUTINES           00440000
*                                                                       00460000
*EXITS-ERROR-CALL PROB DET (IGG0196M) FOR WTP AND 013 ABEND,            00466021
*            INSUFFICIENT BUFFERS AVAILABLE IN                          00472021
*            BUFFER POOL TO SATISFY DCB BUFFER REQUIREMENTS       M1552 00480000
*                                                                       00500000
*MACROS : ACTION - MODESET, GETMAIN, XCTL, XCTLTABL              Y02072 00510002
*                                                                       00510402
*MACROS : MAPPING - IECDSECS(DCB,WTG), IHAFCAUD, IHACCW, IEZIOB, IGGBCB 00510802
*                                                                       00512002
*TABLES/WORKAREAS-  WHERE TO GO TABLE  (WTG)                            00520000
*                                                                       00540000
*   BYTE 0-7   NAME                                                     00560000
*   BYTE 8-10  RELATIVE DISK ADDRESS (TTR) OF FIRST RECORD              00580000
*   BYTE 11    CONCATENATION NUMBER                                     00600000
*   BYTE 12    ZERO                                                     00620000
*   BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR:          00640000
*              ALIAS INDICATOR 1 BIT                                    00660000
*              NUMBER OF TTRS IN USERS DATA FIELD  2 BITS               00680000
*   BYTE 14-16 TTR OF FIRST TEXT RECORD                                 00700000
*   BYTE 17    ZERO                                                     00720000
*   BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                         00740000
*   BYTE 20    TRANSLATION TABLE                                        00760000
*   BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST               00780000
*   BYTE 22-23 ATTRIBUTES                                               00800000
*   BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE        00820000
*   BYTE 27-28 LENGTH OF FIRST TEXT RECORD                              00840000
*   BYTE 29    LENGTH OF WTG TABLE  (IN DOUBLE WORDS)                   00860000
*   BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                           00880000
*   BYTE 32-34 IDTTR OF EXECUTOR FOR 1ST DCB                            00900000
*   BYTE 35    WORKAREA ADDRESS FOR 1ST DCB                             00920000
*   BYTE 36-39 TABLE OF IDTTR'S                                         00940000
*                                                                       00960000
*        32+N(8)   IDTTR OF EXECUTOR FOR NTH DCB      (3 BYTES)         00980000
*                  WORKAREA ADDRESS FOR NTH DCB       (1 BYTE)          01000000
*                  IDTTR OF LAST ROUTINE  LOAD        (3 BYTES)         01020000
*                  NOT USED                           (1 BYTE)          01040000
*                                                                       01060000
*                                                                       01080000
*********************************************************************** 01100000
*ATTRIBUTES: REENTRANT, REUSABLE, SUPERVISOR STATE,              Y02072 01120002
*            RUNS IN USER KEY UNLESS OTHERWISE SPECIFIED.        Y02072 01130002
*                                                                       01140000
*                                                                       01160000
*********************************************************************** 01180000
*                                                                       01200000
*                                                                       01220000
*  REGISTER CONVENTIONS USED                                            01240002
*                                                                       01260000
*********************************************************************** 01280000
*                                                                       01300000
RDCB     EQU   2         DCB REGISTER                                   01320000
RBASE    EQU   3         BASE REGISTER                                  01340000
RCORE    EQU   4         WORK AREA ADDRESS                              01360000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01380000
RWTG     EQU   6         TOP OF WTG TABLE                               01400000
RPARC    EQU   7         CURRENT PARAMETER                              01420000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01440000
RBUFADR  EQU   9                        MAINTAINS ADDR OF NEXT   Y02072 01450002
*                                         AVAILABLE BUFFER       Y02072 01460002
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01480000
RWK1     EQU   11        WORK REGISTER                           Y02072 01500002
RB       EQU   12        WORK REG1  **                                  01520000
RWK3     EQU   RB                       WORK REGISTER            Y02072 01530002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01540000
RWK2     EQU   RC                       WORK REGISTER            Y02072 01550002
RD       EQU   14        WORK REG3  **                                  01560000
RJ       EQU   15        WORK REG4                                      01580000
RWK4     EQU   RJ        WORK REG                                YM7595 01590002
RE       EQU   0         WORK REG5                                      01600000
RF       EQU   1         WORK REG6                                      01620000
*                                                                       01640000
*                                                                       01660000
PARAR    EQU   RPARC                                                    01680000
*                                                                       01700000
*********************************************************************** 01720000
*                                                                       01740000
*                                                                       01760000
*                                                                       01780000
*********************************************************************   01800000
* MASK'S TO TEST PARAMETER LIST WITH                                    01820000
INP      EQU   X'0F'                                                    01840000
OUTP       EQU   X'0F'                                                  01860000
UPDATE     EQU   X'04'                                                  01880000
INOUT      EQU   X'03'                                                  01900000
OUTIN      EQU   X'07'                                                  01920000
RDBACK     EQU   X'01'                                                  01940000
*                                                                       01960000
*                                                                       01980000
*********************************************************************   02000000
*                                                                       02020000
*                                                                       02040000
* OFFSET FOR PARAMETER TESTS                                            02060000
*                                                                       02080000
ONE        EQU   X'01'                                                  02100000
FRTYATE    EQU   48                                                     02120000
DISPSN     EQU   X'0'                                                   02140000
*                                                                       02160000
*                                                                       02180000
*********************************************************************   02200000
*                                                                       02220000
* OFFSETS FOR DEB REFERENCE                                             02240000
*                                                                       02260000
*                                                                       02280000
BIN        EQU   36                     BIN NOS.                   DM0I 02300000
BEXT       EQU   38                     BIN EXTENT                 DM0I 02320000
*                                                                       02340000
*                                                                       02360000
*                                                                       02380000
*********************************************************************   02400000
*                                                                       02420000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              02440000
*                                                                       02460000
*                                                                       02480000
*                                                                       02500000
DOUBLE     EQU   X'01'                                                  02520000
*                                                                       02540000
*                                                                       02560000
STOWB      EQU   X'80'                                                  02580000
WRTCK      EQU   X'80'                  WRITE CHECK                DM0I 02600000
OVRFLO     EQU   X'20'                                                  02620000
PCI        EQU   X'20'                                                  02640000
MINKEY     EQU   X'01'                                                  02660000
CONCAT     EQU   X'FF'                                                  02680000
*                                                                       02700000
*********************************************************************   02720000
*                                                                       02740000
* MASKS FOR ACCESS METHODS IN SAM                                       02760000
*                                                                       02780000
QSAMB      EQU   X'01'                                                  02800000
BSAMBIT    EQU   X'00'                                                  02820000
PAM        EQU   X'02'                                                  02840000
*                                                                       02860000
*                                                                       02880000
* MASKS FOR MACRO'S TO BE USED                                          02900000
*                                                                       02920000
GETB       EQU   X'40'                                                  02940000
PUTB       EQU   X'40'                                                  02960000
READB      EQU   X'20'                                                  02980000
WRITEB     EQU   X'20'                                                  03000000
POINTB     EQU   X'04'                                                  03020000
CNTRLB     EQU   X'02'                                                  03040000
*                                                                       03060000
*                                                                       03080000
*********************************************************************   03100000
*                                                                       03120000
* MASKS FOR DEVICES TO BE SUPPORTED                                     03140000
*                                                                       03160000
*                                                                       03180000
*                                                                       03200000
*********************************************************************   03220000
*                                                                       03240000
*                                                                       03242020
* DISPLACEMENTS AND BYTE COUNTS AS EQUATES                              03244020
*                                                                       03246020
D0       EQU   0                        DISPLACEMENTS OF ZERO    S20201 03248020
D5       EQU   5                        DISPLACEMENTS OF FIVE    S20201 03250020
D6       EQU   6                        DISPLACEMENTS OF SIX     S20201 03252020
B1       EQU   1                        BYTE COUNT OF ONE        S20201 03254020
B8       EQU   8                        BYTE COUNT OF EIGHT      S20201 03256020
B16      EQU   16                       BYTE COUNT OF SIXTEEN    S20201 03258020
B24      EQU   24                       BYTE COUNT OF TWENTYFOUR S20201 03260020
*                                                                       03262020
FIVE     EQU   5                        BYTE COUNT OF FIVE       S20201 03264020
SIX      EQU   6                        LNGH CHP WITH RCD READY  S20201 03266020
*                                       DW                       S20201 03268020
TEN      EQU   X'0A'                    LNGH CHP WRT CHK + RCD   S20201 03270020
*                                       RDY                      S20201 03272020
MAX      EQU   255                      MAX COUNT FOR EXEC INST  S20201 03274020
INPBIOB  EQU   80                       BASIC INPUT IOB SIZE     S20201 03276020
*                                                                       03278020
*                                                                       03280020
*                                                                       03282020
FLAGOFF  EQU   4                        OFFSET IN CCW TO FLAGS   S20201 03284020
CNTOFF   EQU   7                        OFFSET IN CCW TO CNT FLD S20201 03286020
SDFLG    EQU   X'08'                    SEARCH DIRECT INDICATOR  S20201 03288020
SDOPT    EQU   X'01'                    SEARCH DIRECT MASK       S20201 03290020
*                                                                       03292020
*                                                                       03300000
*********************************************************************   03320000
*                                                                       03340000
* MASKS FOR STATUS BITS TO BE TESTED                                    03360000
*                                                                       03380000
*                                                                       03400000
EXCPN      EQU   X'30'                                                  03420000
COMPLETE   EQU   X'60'                  COMPLETE MASK              DM0I 03440000
FIRSTIOB   EQU   X'01'                                                  03460000
*                                                                       03480000
*                                                                       03500000
*                                                                       03520000
*********************************************************************   03540000
*                                                                       03560000
* MASKS FOR BUFFER TECHNIQUE'S                                          03580000
*                                                                       03600000
CYCLICB    EQU   X'20'                                                  03620000
EXCHANGB   EQU   X'10'                                                  03640000
SIMPLEB    EQU   X'40'                                                  03660000
EXCHCYCL   EQU   X'30'                                                  03680000
*                                                                       03700000
*********************************************************************   03720000
*                                                                       03740000
*                                                                       03760000
* MODES OF OPERATION FOR QSAM                                           03780000
*                                                                       03800000
LOCATEB    EQU   X'08'                                                  03820000
MOVEB      EQU   X'10'                                                  03840000
SUBSTUTB   EQU   X'04'                                                  03860000
*                                                                       03880000
*                                                                       03900000
*********************************************************************   03920000
*                                                                       03940000
*                                                                       03960000
* COMMAND BYTES FOR THE 2841                                            03980000
*                                                                       04000000
*       CONTROL UNIT                                                    04020000
*                                                                       04040000
*                                                                       04060000
*                                                                       04080000
SRCHE      EQU   X'31'                                                  04100000
WRTCKD     EQU   X'1D'                                                  04120000
RDC        EQU   X'92'                                                  04140000
RDKD       EQU   X'8E'                                                  04160000
RDD        EQU   X'86'                                                  04180000
TIC        EQU   X'08'                                                  04200000
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      S20201 04205020
RDSC     EQU   X'22'                    READ SECTOR CCW CMND     S20201 04210020
*                                                                       04215020
*                                                                       04220000
*                                                                       04240000
*********************************************************************   04260000
*                                                                       04280000
*                                                                       04300000
* MASKS FOR RECORD FORMATS                                              04320000
*                                                                       04340000
*                                                                       04360000
STANDRDF   EQU   X'88'                  STANDARD FORMORT           DM0I 04380000
FORMATU    EQU   X'C0'                                                  04400000
FORMATF    EQU   X'80'                                                  04420000
FORMATV    EQU   X'40'                                                  04440000
BLOCKED    EQU   X'10'                                                  04460000
*                                                                       04480000
*                                                                       04500000
*********************************************************************   04520000
*                                                                       04540000
*                                                                       04560000
*   CHANNEL CONTROL WORD FLAGS                                          04580000
*                                                                       04600000
SKIP       EQU   X'10'                                                  04620000
SLI        EQU   X'20'                                                  04640000
CC         EQU   X'40'                                                  04660000
DATACH     EQU   X'A0'                                                  04680000
SLICC      EQU   X'60'                                                  04700000
SLICCSK    EQU   X'70'                                                  04720000
*                                                                       04740000
*                                                                       04760000
*********************************************************************   04780000
*                                                                       04800000
*                                                                       04820000
KEYS       EQU   X'01'                                                  04840000
QSAM       EQU   X'01'                                                  04860000
NORCDRY  EQU   X'20'                    NO RECORD READY          S20201 04865020
*                                       INDICATOR                S20201 04870020
*                                       MASK                            04875020
*                                                                       04880000
*                                                                       04900000
*********************************************************************   04920000
*                                                                       04940000
GETMAIN    EQU   4                                                      04960000
QSAMZ      EQU   X'05'                  MASK                       DM0I 04980000
COMMTABL   EQU   16                     MASK                       DM0I 05000000
IDTTR      EQU   5                      LENGTH OF IDTTR FOR MVC  S19015 05005019
CPINCR     EQU   24                     CP INCREMENT--OFFSET     S19015 05010019
*                                       READ                     S19015 05015019
NOROUT     EQU   0                      TO INDICATE NO EOB       S19015 05020019
*                                       NEEDED                   S19015 05025019
BFTEKR     EQU   X'20'                  BDAM VS SUPPORT          S19015 05030019
VSBITS     EQU   X'48'                  VS BITS IN DCBRECFM      S19015 05035019
UNRELFLG EQU   X'02'                   IOB UNRELATED FLAG        A37507 05037021
*********************************************************************   05040000
OABD060  EQU   60                                                S21042 05050021
*                                                                       05060000
*                                                                       05080000
*                                                                       05100000
*                                                                       05120000
*                                                                       05140000
*                                                                       05180000
*                                                                       05200000
*                                                                       05220000
         BALR  RBASE,0                  REG 3 IS BASE                   05240000
         USING SOP2,RBASE                                               05260000
         USING IHADCB,RDCB              REG 2 IS DCB                    05280000
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR         05320000
*                                                                       05360000
*                                                                       05380000
*                                                                       05400000
*                                                                       05420000
SOP2     EQU   *                                                        05440000
*                                                                       05460000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 05470002
         DC    C'IGG0191D'              MODULE NAME              Y02072 05472002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 05474003
         DC    C'10/18/74'              LAST DATE MODIFIED     @Z30TSCF 05476003
BEGIN    DS    0H                                                Y02072 05478002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 05480000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   05500000
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESS           05520000
*                                                                       05540000
         SR    RC,RC                    READY A WORK REG                05560000
         TM    DISPSN(RPARC),INP        FILE FOR INPUT                  05580000
         BC    7,SOP230                 NO BRANCH                       05600000
*                                                                       05620000
         TM    DCBMACRF,POINTB         POINT MACRO USED                 05640000
         BC    1,SOP220A               YES BRANCH TO STANDARD F RECS    05660000
*                                                                       05680000
SOP220   TM    DCBRECFM,STANDRDF        STANDARD F RECORDS USED         05700000
         BC    1,SOP221                 YES BRANCH                      05720000
*                                                                       05740000
*                                                                       05760000
SOP220A  EQU   *                                                        05780000
         MVI   DCBCNTRL+3,2             EGP2 ID NUMBER                  05800000
         LA    RC,8                     INCREMENT FOR NON SF RECS 20185 05820018
         TM    DCBCIND2,QSAMB           DATA SET FOR QSAM        S19015 05822019
         BO    SOP221                   YES--BRANCH              S19015 05824019
         TM    DCBBFTEK,BFTEKR          OFFSET READ              S19015 05826019
         BZ    SOP221                   NO--BRANCH               S19015 05828019
         LA    RC,CPINCR(RC)            INCREMENT FOR OFFSET     S19015 05830019
*                                       READ                     S19015 05832019
         MVI   DCBCNTRX,NOROUT          NO EOB ROUT NEEDED       S19015 05834019
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 05837020
*                                       READY                    S20201 05840020
         BO    SOP225                   BRANCH IF YES, EXTRA     S20201 05843020
*                                       SPACE                    S20201 05846020
*                                       ALREADY ACQUIRED BY OFFSET      05849020
*                                       REA                             05852020
SOP221   EQU   *                                                 S20201 05855020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 05858020
*                                       READY                    S20201 05861020
         BO    SOP225                   BRANCH IF YES            S20201 05864020
         LA    RC,B24(RC)               INCR FOR RCD READY       S20201 05867020
SOP225   EQU   *                                                 S20201 05870020
         LA    RC,INPBIOB(RC)           INCR FOR READ IOB        S20201 05873020
         B     SOP235                   GO TO GET CORE           S20201 05876020
*                                                                       05880000
*                                                                       05900000
SOP230   LA    RC,88                    AMT CORE NEEDED FOR OUTPUT IOB  05920000
         MVI   DCBCNTRX,QSAM            MOVE ID                    DM0I 05940000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 05943020
*                                       READY                    S20201 05946020
         BO    SOP233                   BRANCH IF YES            S20201 05949020
         LA    RC,B16(RC)               INCR FOR RCD READY       S20201 05952020
SOP233   EQU   *                                                 S20201 05955020
         TM    DCBOPTCD,WRTCK           WRITE VALIDITY CHECK USED       05960000
         BC    14,SOP235                NO BRANCH                       05980000
*                                                                       06000000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06002020
*                                       READY                    S20201 06004020
         BO    SOP233A                  BRANCH IF YES            S20201 06006020
         LA    RC,B8(RC)                INCR FOR RCD READY       S20201 06008020
SOP233A  EQU   *                                                 S20201 06010020
*                                                                       06012020
         LA    RC,24(RC)                AMT SPACE NEEDED FOR WRT CK CP. 06020000
*                                                                       06040000
*                                                                       06060000
*     AT THIS POINT  RC=REG.13 HAS THE SIZE OF AN IOB IN IT             06080000
*                                                                       06100000
*                                                                       06120000
SOP235   EQU   *                                                        06140000
         TM    JFCBMASK+D6,SDFLG        SEARCH DIRECT            S20201 06145020
         BNO   NOSD1                    BRANCH NO                S20201 06150020
         LA    RC,B16(RC)               INCR IOB SIZE            S20201 06155020
*                                                                       06160020
NOSD1    EQU   *                                                 S20201 06165020
*                                                                       06170020
         SRL   RC,3                     IOB IN DOUBLE WORDS             06180000
         STC   RC,DCBIOBL               STORE IN DCB                    06200000
         SLL   RC,3                     RESET IOB SIZE                  06220000
*                                                                       06240000
         SR    RF,RF                                                    06260000
         TM    DCBCIND2,QSAMB           DATA SET FOR QSAM               06280000
         BC    14,SOP237                NO BRANCH                       06300000
*                                                                       06320000
*                                                                       06340000
         IC    RF,DCBBUFNO              GET NUMBER OF IOBS TO BUILD     06360000
         B     SOP239                   SKIP TO NEXT               DM0I 06380000
*                                                                       06400000
*                                                                       06420000
SOP237   EQU   *                                                        06440000
*                                                                       06460000
         IC    RF,DCBNCP                GET NUMBER OF IOBS TO BUILD     06480000
         LTR   RF,RF                    HAS THIS BEEN SPECIFIED         06500000
         BC    7,SOP239                 YES BRANCH                      06520000
*                                                                       06540000
         LA    RF,1                     SUPPLY 1 FOR USER               06560000
         STC   RF,DCBNCP                SAVE FOR NOW                    06580000
*                                                                       06600000
SOP239   EQU   *                                                        06620000
*                                                                       06640000
         LR    RUCB,RF                                                  06660000
*                                                                       06680000
*                                                                       06700000
*********************************************************************** 06720000
*                                                                       06740000
         MR    RE,RC                    COMPUTE TOTAL AMT SPACE NEEDED  06760000
*                                                                       06762020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06764020
*                                       READY                    S20201 06766020
         BO    SOP239A                  BRANCH IF YES            S20201 06768020
         LA    RF,B8(RF)                INCR FOR THETA VALUES    S20201 06770020
SOP239A  EQU   *                                                 S20201 06772020
         LR    RD,RF                                                    06780000
         LR    RB,RF                    SAVE FOR FUTURE USE             06800000
*                                                                       06820000
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE IOBS YM4697 06822002
*  IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE EXECUTOR.  YM4697 06824002
*                                                                       06828002
         ST    RD,DXATEXC2              SAVE LENGTH              YM4697 06828402
*                                                                       06828802
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06830002
*                                                                       06860000
         GETMAIN R,LV=(RD),SP=0                                  Y02072 06880002
*                                                                       06900000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06910002
**                                                                      06940000
*    THIS SECTION CLEARS THE SPACE RECIEVED FROM GETMAIN                06960000
**                                                                      06980000
*                                                                       07000000
         LR    RJ,RB                    RESTORE LENGTH TO CLEAR         07020000
         LA    RE,B8                    CONSTANT OF EIGHT        S20201 07030020
         ST    RF,DCBIOBA               SAVE FIRST IOB ADDRESS          07040000
         OI    FCAOPEN,FCAOIOB          OK TO FREE IOB CORE      Y02072 07050002
         BCTR  RJ,0                     REDUCE AMT BT ONE               07060000
*                                                                       07064020
* OBTAIN  THETA ADDRESSES MAY BE USED LATER                             07068020
*                                                                       07072020
         AR    RB,RF                    GET ADDR TOTAL AREA + 1  S20201 07076020
         SR    RB,RE                    BACK UP A DW             S20201 07080020
         ST    RB,DXCCW11               TEMP STORE SECT ADDR     Y02072 07084002
         LA    RB,MAX                   GET MAX EXECUTE VALVE    S20201 07096020
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 07096402
COMPARE  CR    RJ,RB                    IS AMT TO CLEAR GREATER 255     07100000
         BC    12,ONECLEAR              NO BRANCH                       07120000
*                                                                       07140000
         EX    RB,CLEAR                 CLEAR 256 BYTES                 07160000
         SR    RJ,RB                    SUBT 255 FROM AMT TO BE CLEARED 07180000
         BCTR  RJ,0                     SUBT ONE MORE BYTE              07200000
         LA    RF,256(RF)               UPDATE AREA ADDR BY 256         07220000
         B     COMPARE                  CHECK AGAIN                DM0I 07240000
*                                                                       07260000
CLEAR    XC    0(1,RF),0(RF)            ACTUAL CLEAR INSTRUCTION        07280000
*                                                                       07300000
ONECLEAR EX    RJ,CLEAR                 CLEARS LESS THAN 256            07320000
*                                                                       07340000
         L     RB,DCBIOBA              GET IOB ADDR              A37507 07340221
         CH    RUCB,ONEIOB             ONE IOB?                  A37507 07340421
         BNE   NTONEIOB                NO, BRANCH                A37507 07340621
         USING IOBQSAMN,RWK3            ESTABLISH ADDR FOR IOB          07340702
*                                       DSECT                    A37507 07341021
         OI    IOBFLAG1,IOBUNREL       YES, SET UNRELATED FLAG   Y02072 07341202
         DROP  RWK3                                                     07341402
NTONEIOB EQU   *                                                 A37507 07341621
         TM    DISPSN(RPARC),INP        FILE FOR INPUT           S19015 07342019
         BO    SOP240A                  NO--CP WILL BE BUILT     S19015 07344019
*                                       HERE                     S19015 07346019
         MODESET  EXTKEY=DATAMGT                                 Y02072 07359602
         USING WTGENTRY,RWTGC                                    Y02072 07359702
         MVC   WTGIDTTR,SOPSLDIN       CP TO BE BUILT IN 1910  @Z30TSCF 07360003
         TM    JFCBMASK+D6,SDFLG        SEARCH DIRECT USED       S20201 07367202
         BNO   NOSD5                    BRANCH NO                S20201 07368802
         MVC   WTGIDTTR,SOPSD         MOVE IN SEARCH DIRECT ID @Z30TSCF 07370403
NOSD5    EQU   *                                                 S20201 07375202
         B     RELOOP                   GO PROCESS DCBS          S20201 07376802
*                                                                       07378402
*                                                                       07380000
SOP240A  EQU   *                                                 S19015 07390019
         LR    RC,RB                    SET UP WORK REG                 07420000
         LR    RD,RB                    SET UP WORK REG                 07440000
         SPACE 2                                                        07660000
*                                                                       07680000
SOP242   EQU   *                                                        07700000
*                                                                       07720000
         ST    RB,0(RD)                 LINK NEW IOB TO LAST ONE BUILT  07740000
         LR    RD,RB                    UPDATE CURRENT IOB POINTER      07760000
         LA    RB,4(RB)                 POINT TO ECB SLOT               07780000
         OI    0(RB),X'7F'              SET ECB COMPLETE WITHOUT ERROR  07800000
         ST    RB,12(RD)                STORE ECB ADDR IN IOB           07820000
         LA    RB,20(RB)                POINT TO CP POINTER SLOT        07840000
         LR    RC,RB                    SAVE ADDR                       07860000
         LA    RB,24(RB)                POINT TO CP START ADDR          07880000
SOP243   EQU   *                                                        07900000
         ST    RB,0(RC)                 STORE CP STARTAD IN IOB         07920000
         L     RWK1,DXUDCBAD            GET ADDR OF USERS DCB    Y02072 07930002
         USING IOBSIOCC,RWK2                                     Y02072 07940002
         ST    RWK1,IOBDCBPT            USERS DCB ADDR TO IOB    Y02072 07942002
         DROP  RWK2                                              Y02072 07944002
         MVC   40(8,RD),DCBFDAD        INITIALIZE IOBFDAD.              07950013
*                                                                       07960000
*********************************************************************** 07980000
*                                                                       08000000
*     CONSTRUCTION OF CHANNEL PROGRAM FOLLOWS                           08020000
*                                                                       08040000
*********************************************************************** 08060000
*                                                                       08080000
SOP255   EQU   *                                                        08100000
*                                                                       08120000
         LA    RC,19(RC)                POINT TO CCHHR FIELD IN IOB     08140000
*                                                                       08148020
* CHECK FOR RCD READY FEATURE ON ALL DEVICES FOR DATA SET AND IF ON     08156020
* ALL DEVICES BUILD RCD READY CHPS, BIT 2 OF JFCBMASK BEING A ONE       08164020
* SAYS ALL DEVICES DO NOT HAVE RCD READY FEATURE                        08172020
*                                                                       08180020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 08188020
*                                       READY                    S20201 08196020
         BO    SOP257                   BRANCH IF YES            S20201 08204020
         BAL   RJ,SOP2STA               GO BUILD SET SECTOR CMND S20201 08212020
SOP257   EQU   *                                                 S20201 08220020
*                                                                       08228020
         BAL   RJ,SOP2SCH               GO BUILD SRCH AND TIC    S20201 08236020
*                                                                       08244020
         SR    RC,RC                    CLEAR REG                S20201 08252020
         IC    RC,DCBKEYLE              GET KL                   S20201 08260020
         AH    RC,DCBBLKSI              ADD DL                   S20201 08268020
         SR    RB,RE                    BACK UP CCW PTR          S20201 08276020
         STH   RC,D6(RB)                KL+DL IN RH OF TIC FOR   S20201 08284020
*                                       EOB                      S20201 08292020
*                                       ROUTINE                         08300020
         AR    RB,RE                    RESTORE CCW PTR          S20201 08308020
*                                                                       08320000
*     SRCH AND TIC CCWS HAVE BEEN GENERATED AT THIS POINT               08340000
*                                                                       08360000
*********************************************************************** 08380000
*                                                                       08400000
*                                                                       10540000
*********************************************************************** 10560000
*                                                                       10580000
*     CONSTRUCTION OF WRITE CHANNEL PROGRAMS FOLLOW                     10600000
*                                                                       10620000
*********************************************************************** 10640000
*                                                                       10660000
*                                                                       10680000
SOP260   EQU   *                                                        10700000
         LR    RC,RB                    TEMP HOLD ADDR OF WCKD   S20201 10820020
         OI    FLAGOFF(RB),DATACH       SET FLAGS                S20201 10840020
         MVI   CNTOFF(RB),B8            SET BYTE COUNT TO EIGHT  S20201 10860020
         AR    RB,RE                    INCR CCW PTR             S20201 10880020
*                                                                       10900020
         LR    RF,RB                    GET ADDR OF WRT CCW      S20201 10920020
         SR    RB,RD                    GET WRT CCW OFFSET       S20201 10940020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10942002
         STC   RB,DCBOFFSW              PUT IN DCB               S20201 10960020
         TM    DCBMACRF+1,POINTB        NOTE-POINT NEEDED               10960402
         BZ    AA                       BRANCH IF ZEROS            DM0I 10960802
         MVI   DCBCNTRZ,QSAMZ           MOVE ID                    DM0I 10961202
AA       EQU   *                        COME HERE                  DM0I 10961602
         MVI   DCBWCPO,48               OFFSET FOR START OF CP.         10961702
         MVI   DCBWCPL,X'04'            WRT C.P. LEN IN DBLE WRDS       10961802
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 10962002
         AR    RB,RD                    RESTORE PTR              S20201 10980020
*                                                                       11080000
         TM    DCBCIND2,QSAMB           IS QSAM USED                    11100000
         BC    14,SOP262                NO BRANCH                       11120000
*                                                                       11140000
* FILL IN BUFFER ADDRESS AND BYTE COUNT                                 11150002
*                                                                       11152020
         L     RWK4,DCBBUFCB            BUFFER CNTRL BLK ADDRESS YM7595 11162002
         USING BCBLK,RWK4                                        YM7595 11164002
         L     RBUFADR,BCBBUFPT         NEXT AVAIL BUFFER        YM7595 11166002
         LTR   RBUFADR,RBUFADR          IS BUFFER ADDR ZERO      YM7595 11168002
         BZ    BUFERR                   YES, ISSUE DMABCOND      YM7595 11168402
         USING CCW,RF                                            YM7595 11168802
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 11169202
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 11169602
         USING BUFFER,RBUFADR                                    YM7595 11169702
         MVC   BCBBUFAD,BUFNXPTB        UPDATE TO NEXT AVAIL BUF YM7595 11169802
         DROP  RWK4,RBUFADR,RF                                   YM7595 11169902
SOP262   EQU   *                                                 S20201 11170020
         AR    RB,RE                    INCR PTR                 S20201 11176020
*                                                                       11182020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 11188020
*                                       READY                    S20201 11194020
         BO    SOP265                   BRANCH IF YES            S20201 11200020
         BAL   RJ,SOP2RTA               GO BUILD RD SECTOR CMND  S20201 11206020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11208002
         MVI   DCBWCPL,SIX              SET CHP LENGTH TO        S20201 11212020
*                                       INCLUDE                  S20201 11218020
*                                       RCD RDY                         11224020
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 11226002
SOP265   EQU   *                                                 S20201 11230020
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    11240000
         BC    14,SOP263               NO. BRANCH                       11260000
*                                                                       11280000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11282002
         MVI   DCBWCPL,X'07'            WRITE CHAN PORG LENGTH IF       11300000
*                                       WRITE CHECK IS SPECIFIED        11320000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 11320402
         SR    RB,RE                    BACK UP CCW PTR          S20201 11330020
         OI    FLAGOFF(RB),CC           SET CMND CHAIN IN        S20201 11340020
*                                       PREVIOUS                 S20201 11350020
*                                       CCW                             11360020
         AR    RB,RE                    RESTORE PTR              S20201 11370020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 11380020
*                                       READY                    S20201 11390020
         BO    SOP262A                  BRANCH IF YES            S20201 11400020
         BAL   RJ,SOP2RTA               GO TO RD SECT BUILD RTN  S20201 11410020
         SR    RB,RE                    BACKUP CCW PTR           S20201 11420020
         OI    FLAGOFF(RB),CC           TURN ON CMND CHAIN       S20201 11430020
         MVI   D0(RB),SETSC             CHANGE CMND TO SET SECT  S20201 11440020
         AR    RB,RE                    RESTORE PTR              S20201 11450020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11450402
         MVI   DCBWCPL,TEN              SET CHP SIZE TO INCLD.   S20201 11460020
*                                       RCD                      S20201 11470020
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 11470402
SOP262A  EQU   *                                                 S20201 11480020
         LA    RF,B24(RB)               PT RF TO CNT FIELD AT    S20201 11490020
*                                       END                      S20201 11500020
*                                       CHANNEL PROG                    11510020
*                                                                       11520020
         ST    RF,D0(RC)                PUT ADD IN WRT CKD CCW   S20201 11530020
         MVI   D0(RC),WRTCKD            PUT IN CCW CMND          S20201 11540020
*                                                                       11550020
         LR    RC,RF                    PUT ADDR IN REG FOR SRCH S20201 11560020
*                                       AND TIC RTN                     11570020
         BAL   RJ,SOP2SCH               GO BLD SCH CCW           S20201 11580020
*                                                                       11590020
         MVI   D0(RB),RDKD              SET READ CMND FOR WRT    S20201 11600020
*                                       CHK                      S20201 11610020
         OI    FLAGOFF(RB),SKIP         TURN ON SKIP FLAG        S20201 11620020
         AR    RB,RE                    INCR PTR                 S20201 11630020
*                                                                       11640020
         B     SOP266                   GO TO FIN IOB            S20201 11650020
SOP263   EQU   *                                                 S20201 11660020
         ST    RB,D0(RC)                PUT ADDR IN WRT CKD      S20201 11670020
         MVI   D0(RC),WRTCKD            PUT IN WRT CKD CMND      S20201 11680020
*                                                                       11690020
*                                                                       11700020
SOP266   EQU   *                                                 S20201 11710020
         MVC   D5(B1,RB),DCBKEYLE       INIT KEY LENGTH          S20201 11720020
         AR    RB,RE                    INCR PTR                 S20201 11730020
         BCT   RUCB,SOP242             NOT LAST IOB - BRANCH     A37507 11780021
         MODESET  EXTKEY=DATAMGT        KEY OF AUDIT TRAIL              11790002
         SPACE                                                          11800002
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 11810002
         MODESET  KEYADDR=DXUKEY,WORKREG=12                             11820002
         SPACE                                                          11822002
         L     RB,DCBIOBA              LAST IOB - LINK IOB'S     A37507 11830021
         USING IOBQSAMN,RD              ESTABLISH ADDR FOR IOB          11880002
*                                       DSECT                    A37507 11930021
         ST    RB,IOBNIOBA                FIRST TO LAST          A37507 11980021
         DROP  RD                                                       12050002
*                                                                       12120000
*********************************************************************** 12140000
*                                                                       12160000
SOP2END  EQU   *                                                        12180000
*                                                                       12200000
*                                                                       12220000
*********************************************************************** 12240000
         TM    DCBDSORG,X'02'          DCB FOR PO                       12260000
         BC    8,SOP2ENDA              NO, BRANCH                       12280000
*                                                                       12300000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12302002
         MVI   DCBCNTRZ,QSAMZ                                      DM0I 12320000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 12322002
*                                                                       12340000
SOP2ENDA EQU   *                                                        12360000
*                                                                       12380000
         L     RB,DCBIOBA               GET FIRST IOB                   12400000
         OI    0(RB),FIRSTIOB           SET INDICATOR ON FOR CLOSE      12420000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12440402
         TM    DCBRECFM,FORMATV         VARIABLE FORMAT ?          DM0I 12450000
         BZ    SOP2STOP                 BRANCH NOT V FORMAT        DM0I 12460000
         TM    DCBRECFM,FORMATF         FIXED FORMAT               DM0I 12470000
         BC    1,SOP2STOP               YES, BRANCH                DM0I 12480000
         USING WTGENTRY,RWTGC                                    Y02072 12482002
         MVC   WTGIDTTR,SOPSLDVT        VARIABLE, GET 1915     @Z30TSCF 12484003
         B     RELOOP                   BACK TO MAIN LINE          DM0I 12500000
SOP2STOP EQU   *                                                        12540000
         MVC   WTGIDTTR,SOPSLDFT        NON-VARIABLE, GET 1910 @Z30TSCF 12550003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        12600000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     12620000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            12640000
         BCR   RWTGC,RBASE              BACK TO OPEN CONTROL ROUTINDM0I 12660000
*                                                                       12680000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    12700000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             12720000
*                                                                       12740000
         LR    RPARC,RPAR                                               12760000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       12780000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           12800000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         12820000
*                                                                       12840000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  12860000
         LA    RPARC,PLOFF(0,RPARC)                                     12880000
         B     ZCHEK                    TO ZERO CHECK              DM0I 12900000
*                                                                       12920000
TCTLRTN  EQU   *                                                        12940000
         USING WTG,RWTG                                                 12990003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*13040003
               MODID=WTGENTRY                                  @Z30TSCF 13090003
         DROP  RWTGC,RWTG                                      @Z30TSCF 13140003
*                                                                       13420000
**********************************************************************  13440000
*                                                                    *  13460000
BUFERR   EQU   *                                                  M1552 13464000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 13466002
         DMABCOND OABD060,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X13468021
                                        CALL PROBLEM DETERMINATION      13472021
         B     TCTLRTN                                           S21042 13476021
WAOFF    EQU   32                                                       13480000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           13500000
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           13520000
OPIDCNST DC    C'0S'                    ID                         DM0I 13540000
AMIDCNST DC    C'1D'                    ID                         DM0I 13560000
ONEIOB   DC    H'1'                    TEST FOR ONE IOB          A37507 13570021
*                                                                       13580000
*********************************************************************** 13600000
*                                                                       13604020
* SEARCH AND TIC BUILDING RTN                                           13608020
*                                                                       13612020
SOP2SCH  EQU   *                                                 S20201 13616020
         ST    RC,D0(RB)                STORE SRCH ADDR IN CCW   S20201 13620020
         MVI   CNTOFF(RB),FIVE          SET CNT TO FIVE          S20201 13624020
         OI    FLAGOFF(RB),CC           SET CMND CHAIN FLAG      S20201 13628020
         MVI   D0(RB),SRCHE             PUT IN SRCH CMND         S20201 13632020
         ST    RB,B8(RB)                PUT SRCH ADDR IN NEXT    S20201 13636020
*                                       CCW                      S20201 13640020
         AR    RB,RE                    INCR PTR FOR SEARCH      S20201 13644020
         MVI   D0(RB),TIC               PUT IN TIC CMND          S20201 13648020
         AR    RB,RE                    INCR PTR FOR TIC         S20201 13652020
         BR    RJ                       RETURN                   S20201 13656020
*                                                                       13660020
* SET SECTOR BUILD RTN                                                  13664020
*                                                                       13668020
SOP2STA  EQU   *                                                 S20201 13672020
         L     RF,DXCCW11               GET THETA ADDR           S20201 13676020
         ST    RF,D0(RB)                PUT IN CCW               S20201 13680020
         OI    FLAGOFF(RB),CC           TURN ON CMND CHAIN       S20201 13684020
         MVI   D0(RB),SETSC             PUT IN CMND              S20201 13688020
         B     SOP2FIN                  GO TO FINISH CCW         S20201 13692020
*                                                                       13696020
*                                                                       13700020
*                                                                       13704020
* READ SECTOR BUILD RTN                                                 13708020
*                                                                       13712020
SOP2RTA  EQU   *                                                 S20201 13716020
         L     RF,DXCCW11               GET THETA ADDR           Y02072 13720002
         ST    RF,D0(RB)                PUT IN CCW               S20201 13724020
         SR    RB,RE                    BACK UP PTR              S20201 13728020
         OI    FLAGOFF(RB),CC           TURN CMND CHAIN ON IN    S20201 13732020
         AR    RB,RE                    RESTORE PTR              S20201 13736020
         MVI   D0(RB),RDSC              PUT IN CCW CMND          S20201 13740020
SOP2FIN  EQU   *                                                 S20201 13744020
         MVI   CNTOFF(RB),B1            SET BYTE CNT TO ONE      S20201 13748020
         AR    RB,RE                    INCR PTR                 S20201 13752020
         BR    RJ                       RETURN                   S20201 13756020
*                                                                       13780000
* MODULE IDS                                                            13830002
*                                                                       13880002
SOPSLDFT DC    C'10',VL3(IGG01910)      IGG01910               @Z30TSCF 13890003
SOPSLDVT DC    C'15',VL3(IGG01915)      IGG01915               @Z30TSCF 13900003
SOPSLDIN DC    C'1O',VL3(IGG0191O)      IGG0191O               @Z30TSCF 13902003
PDLOAD   DC    C'6M',VL3(IGG0196M)      IGG0196M               @Z30TSCF 13904003
SOPSD    DC    C'9O',VL3(IGG0199O)      IGG0199O               @Z30TSCF 13906003
*                                                                       13956002
* PATCH AREA                                                            13966002
*                                                                       13976002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 13978002
END      EQU   *                        END OF MODULE            Y02072 13988002
         EJECT                                                          13988403
CVT      DSECT                                                 @Z30TSCF 13988803
         CVT                                                   @Z30TSCF 13989203
         IECDSECS DCB,WTG,(MAIN,(IOB,NO)),PREFX,EXPAND=YES     @Z30TSCF 13990003
         ORG   WTGIDTTR                                          Y02072 14000002
WTGID    DS    CL2                      ID NEXT MOD              Y02072 14010002
DCBCNTRZ EQU   DCBCNTRL+1                                          DM0I 14026000
DCBCNTRX EQU   DCBCNTRL+3                                          DM0I 14032000
         EJECT                                                          14032102
FORCORE  DSECT                                                   Y02072 14032402
         IHAFCAUD  ORG=YES                                       Y02072 14032802
         EJECT                                                          14032902
         IHACCW  DSECT=YES                                       Y02072 14033202
         EJECT                                                          14033602
         IEZIOB                                                  Y02072 14034002
         EJECT                                                          14084002
         IGGBCB  TYPE=SAM                                               14134002
           END                                                          14780000
./  ADD  SSI=40530022,NAME=IGG0191F
         TITLE 'IGG0191F - OUTPUT, EXCHANGE BUFFER OPEN EXECUTOR '      00020002
*MODULE NAME - IGG0191F                                          Y02072 00020102
*                                                                       00020202
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00020302
*                                                                       00022002
*COPYRIGHT - NONE                                                Y02072 00024002
*                                                                       00024102
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00024202
*                                                                       00024302
*          VS2 RELEASE 2 DELETIONS                               Y02072 00024502
*000350,040400,040600,041000,042280-042300,053400,056000,        Y02072 00026002
*060000-060200,060760,092000,09320022800,23400,69200,            Y02072 00027702
*74000,74600                                                     Y02072 00029702
*                                                                YM3914 00031702
*                                                                YM4697 00033702
*                                                                YM7595 00035702
*          RELEASE 20 DELETIONS                                         00037902
*0972                                                            S20038 00039602
*0972024600-024800,033800,052400,060600-060800,064200,067200,    S20201 00041302
*0972076600,082200,085400,085800                                 S20201 00043002
*          RELEASE 21 DELETIONS                                         00044702
*0082004400,074200,090400-090800,091600-093000,093200-093600     S21042 00046402
*                                                                       00048102
*STATUS CHANGE LEVEL 004                                                00056602
*                                                                       00057002
*FUNCTION                                                             * 00058302
*        1.GET CORE FOR IOB'S AND CHANNEL PROGRAMS                      00060000
*        2 CLEAR CORE                                                   00080000
*        3 CONSTRUCT IOBS AND CHANNEL PROGRAMS FOR DISK AND TAPE        00100000
*        4 IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA       Y02072 00110002
*          INDICATING TO FORCE CLOSE THAT THE CORE GETMAINED FOR Y02072 00112002
*          THE IOB'S CAN BE FREEMAINED.                          Y02072 00116002
*                                                                     * 00120000
*ENTRY POINT                                                          * 00140000
*        IGG0191F  BY  XCTL                                             00160000
*                                                                     * 00180000
*INPUT                                                                * 00200000
*        SEE REGISTER DESCRIPTION                                     * 00220000
*                                                                     * 00240000
*OUTPUT                                                               * 00260000
*        SEE REGISTER DESCRIPTION                                     * 00280000
*        IOBS AND CHANNEL PROGRAMS                                    * 00300000
*                                                                     * 00320000
*EXTERNAL ROUTINES-NONE                                               * 00340000
*                                                                     * 00360000
*EXITS                                                                * 00380000
*        NORMAL BY XCTL TO IGG01924 LOAD EXECUTOR                       00400000
*                                                                     * 00420000
*        ERROR - XCTL TO PROB DET (IGG0196M) FOR WTP AND 013 ABEND      00440021
*                                                                     * 00460000
*TABLES/WORKAREAS                                                     * 00480000
*                                                                     * 00500000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00520000
*                                                                       00540000
*      BYTE  0-7  NAME                                                  00560000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00580000
*      BYTE 11    CONCATENATION NUMBER                                  00600000
*      BYTE 12    ZERO                                                  00620000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00640000
*                        ALIAS INDICATOR 1 BIT                          00660000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00680000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00700000
*      BYTE 17    ZERO                                                  00720000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00740000
*      BYTE 20    TRANSLATION TABLE                                     00760000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00780000
*      BYTE 22-23 ATTRIBUTES                                            00800000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00820000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00840000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00860000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00880000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00900000
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        00920000
*      BYTE 36-39 TABLE OF IDTTR'S                                      00940000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          00960000
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          00980000
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01000000
*                   NOT USED                         (1 BYTE)           01020000
*                                                                       01030002
*MACROS ACTION - MODESET, GETMAIN, XCTL, DMABCOND, XCTLTABL      Y02072 01032002
*                                                                       01040000
*MACROS MAPPING - IECDSECS, IGGBCB, IHACCW, DCBD, IEZIOB,        Y02072 01050002
*                 IECDSECT, IHAFCAUD                             Y02072 01050402
*                                                                       01052002
*ATTRIBUTES                                                           * 01060000
*        REENTRANT,REUSABLE,RUNS IN USER KEY UNLESS              Y02072 01080002
*        OTHERWISE SPECIFIED,SUPER STATE                         Y02072 01082002
*                                                                     * 01100000
*NOTES                                                                * 01120000
*        ALL REG EQUATES HAVE AN 'R' AT BEGINNING OR END OF SYMBOL    * 01140000
*        THIS ROUTINE IS ONLY USED FOR EXCHANGE BUFFERING.IMBEDDED      01160000
*        CONSTANTS FROM THE INSTRUCTION STREAM ARE USED                 01180000
*                                                                     * 01200000
RDCB     EQU   2                       DCB                              01220000
RBASE    EQU   3                       BASE                             01240000
RCORE    EQU   4                       WORK AREA ADDRESS                01260000
RPAR     EQU   5                       TOP OF PARAMETER LIST            01280000
RWTG     EQU   6                       TOP OF WTG TABLE                 01300000
RPARC    EQU   7                       CURRENT PARAMETER                01320000
RWTGC    EQU   8                       CURRENT TRANSFER LOAD            01340000
RTIOT    EQU   9                       IOB COUNTER                      01360000
RBUFADR  EQU   10                      MAINTAINS ADDR OF NEXT    Y02072 01380002
*                                         AVAILABLE BUFFER       Y02072 01390002
RDEB     EQU   11                                                       01400000
RB       EQU   12                      CONSTANT 1(TAPE)RD CNT ADDR DISK 01420000
RWK2     EQU   RB                      WORK REGISTER             Y02072 01430002
RC       EQU   13                      BUFFER ADDRESS                   01440000
RD       EQU   14                                                       01460000
RJ       EQU   15                      CCW ADDRESS                      01480000
RWK1     EQU   RJ                      WORK REGISTER             YM7595 01490002
RE       EQU   0                       BLK FACTOR DURING CHP CONST      01500000
RF       EQU   1                       IOB ADDRESS                      01520000
DISK     EQU   X'20'                                                    01540000
PCI      EQU   X'20'                                                    01560000
DOUBLE   EQU   X'02'                                                    01580000
*****************************************************************  DMOR 01580120
*                                                                  DMOR 01580220
* OFFSETS, MASKS, INDICATORS, AND CCW COMMAND CODES                     01580320
*                                                                  DMOR 01580420
FLAGOFF  EQU   4                        CCW FLAG OFFSET          S20201 01580520
CNTOFF   EQU   7                        CCW BYTE COUNT OFFSET    S20201 01580620
CCWOFF   EQU   8                        CCW LENGTH               S20201 01580720
CHPOFF   EQU   24                       OFFSET TO CHP START ADDR S20201 01580820
D0       EQU   0                        DISP OF ZERO             S20201 01580920
D1       EQU   1                        DISP OF ONE              S20201 01581020
D2       EQU   2                        DISP OF TWO              S20201 01581120
D4       EQU   4                        DISP OF FOUR             S20201 01581220
D6       EQU   6                        DISP OF SIX              S20201 01581320
D8     EQU     8                        DISP OF EIGHT            S20201 01581420
CC       EQU   X'40'                    COMMAND CHAINING FLAG    S20201 01587502
SETSC    EQU   X'23'                    SET SECTOR CCW COMMAND   S20201 01590002
RDSC     EQU   X'22'                    READ SECTOR CCW COMMAND  S20201 01592502
NONCARN  EQU   X'20'                    NOW DISCONNECT INDICATOR S20201 01595002
FORMATD  EQU   X'20'                    D FORMAT RECORDS         S20038 01597502
L        EQU   X'40'                    BUFOFF=(L)               S20038 01600002
BLOCKED  EQU   X'10'                    BLOCKED RECORDS          S20038 01602502
USASCII  EQU   X'08'                    USASCII TAPE             S20038 01605002
ZERO     EQU   X'0'                     CONSTANT OF ZERO         S20038 01607502
OABD063  EQU   63                                                S21042 01610002
IGG0191F CSECT                                                          01612502
*                                                                       01615002
*                                                                       01617502
*                                                                       01620002
*                                                                       01622502
*                                                                       01625002
*                                                                       01627502
*                                                                       01630002
*                                                                       01632502
*                                                                       01635002
         BALR  RBASE,0                                                  01637502
         USING ENTRY1,RBASE                                             01640000
         USING IHADCB,RDCB                                              01660000
         USING FORCORE,RCORE                                            01680000
*                                                                     * 01700000
*********************************************************************** 01720000
*        THIS SECTION DETERMINES AMT OF CORE NEEDED FOR IOBS            01740000
*        AND CHANNEL PROGRAMS                                           01760000
*                                                                     * 01780000
*********************************************************************** 01800000
*                                                                     * 01820000
ENTRY1   EQU   *                                                        01840000
         B     BEGIN                    BR AROUND CONSTANTS      YM4697 01850002
         DC    C'IGG0191F'              MODULE NAME              Y02072 01852002
         DC    C' YM7595 '              LAST SHIP CODE           YM7595 01854002
         DC    C'02/08/74'              LAST DATE MODIFIED       YM7595 01856002
BEGIN    DS    0H                                                Y02072 01858002
         L     RDCB,0(0,RPARC)         DCB ADDRESS                      01860000
         L     RCORE,D4(RWTGC)          INIT O/C/E WORK AREA     S20201 01870020
         LA    RDCB,0(0,RDCB)           CLEAR BYTE ZERO                 01880000
**********************************************************************  01900000
*        TEST FOR MODES AND RECORD FORMATS NOT SUPPORTED FOR EXC BUFF   01920000
**********************************************************************  01940000
*                                                                       01960000
         TM    DCBOPTCD,USASCII         USASCII TAPE             S20038 01962020
         BZ    NEXTCHEK                 NO, BRANCH               S20038 01964020
         TM    DCBRECFM,FORMATD         D-FORMAT RECORDS         S20038 01966020
         BO    NOALLOW                  YES, GIVE SIMPLE BUFFER  S20038 01968020
         CLI   DCBBUFOF,ZERO            BLOCK PREFIX EQUAL ZERO  S20038 01970020
         BNE   NOALLOW                  NO, BRANCH - GIVE        S20038 01972020
*                                       SIMPLE BUFFERING.               01974020
NEXTCHEK EQU   *                                                 S20038 01976020
         TM    DCBMACRF+1,X'04'        TEST FOR SUBSTITUTE MODE         01980000
         BZ    MMODE                   BRANCH NOT SUBSTITUTE            02000000
*                                                                       02020000
         TM    DCBRECFM,X'C0'          TEST FOR  U RECORD               02040000
         BC    9,CONTINUE              BRANCH ON YES                    02060000
*                                                                       02080000
         TM    DCBRECFM,X'40'          TEST FOR  V RECORD               02100000
         BO    NOALLOW                 'V' NOT ALLOWED                  02120000
*                                                                       02140000
MMODE    EQU   *                                                        02160000
         TM    DCBMACRF+1,X'14'        TEST FOR MOVE OR SUBS MODE       02180000
         BM    CONTINUE                CONTINUE IF EITHER ONE           02200000
*                                                                       02220000
NOALLOW  EQU   *                                                        02240000
         NI    DCBCIND1,X'FE'          TURN OFF EXC BIT GOING TO SIMPL  02260000
         USING WTGENTRY,RWTGC                                    Y02072 02270002
         MVC   WTGID,SOP2               MOVE DISK ID TO WTG      Y02072 02272002
         TM    DCBDEVT,DISK            TEST FOR DISK                    02300000
         BO    RELOOP                                                   02320000
         MVC   WTGID,SOP5               TAPE ID TO WTG           Y02072 02330002
         DROP  RWTGC                                             Y02072 02340002
         B     RELOOP                                                   02360000
CONTINUE EQU   *                                                        02380000
         TM    DCBRECFM,X'50'           TEST FOR VB RECORD NOT ALLOWED  02400000
*                                       WITH MOVE MODE                  02420000
         BO    NOALLOW                  YES BRANCH                      02440000
         LA    RDEB,CCWOFF              LOAD CCW LENGTH CONSTANT S20201 02470020
         MVI   DCBCNTRL+3,X'01'        SET EOB IND FOR LOAD             02500000
*                                                                     * 02520000
*        DETERMINE BLOCKING FACTOR,BLOCKSIZE DIVIDED BY LRECL         * 02540000
*                                                                     * 02560000
         LH    RJ,DCBBLKSI             BLOCKSIZE IS ODD REG             02580000
         SR    RD,RD                   CLEAR REG                        02600000
         LH    RB,DCBLRECL             LOGICAL RECORD LENGTH            02620000
         DR    RD,RB                   GET BLOCK FACTOR IN RJ           02640000
         TM    DCBRECFM,X'90'          TEST FOR FB RECORD               02660000
         BO    E000                    BRANCH  YES                      02680000
         LA    RJ,1                    GET CONSTANT 1 FOR BLOCK FACTOR  02700000
E000     EQU   *                                                        02720000
         STH   RJ,DCBEROPT+4           PLACE BLOCKING FACTOR IN DCB     02740000
*                                                                     * 02760000
*                                                                     * 02780000
*        DETERMINE SEGMENT SIZE,BUFFERSIZE DIVIDED BY BLOCKING FACTOR * 02800000
*                                                                     * 02820000
*                                                                     * 02840000
         SR    RC,RC                   CLEAR REG                        02860000
         AH    RC,DCBBUFL              GET BUFFER LENGTH                02880000
         BC    6,F0000                 BRANCH THERE IS A BUFFER LENGTH  02900000
*                                                                       02920000
         STH   RB,DCBPRECL              USE LRECL AS SEG LENGTH         02940000
         B     F000A                                                    02960000
F0000    EQU   *                                                        02980000
         SR    RB,RB                   CLEAR REG                        03000000
         DR    RB,RJ                   GET SEGMENTED LENGTH             03020000
         STH   RC,DCBPRECL              PLACE SEG LENGTH IN DCB         03040000
F000A    EQU   *                                                        03060000
         TM    DCBBFALN,X'03'          IS ALIGNMENT SPECIFIED           03080000
         BZ    F0001                   NO-BRANCH                        03100000
         TM    DCBRECFM,X'90'          TEST FOR FB RECORD               03120000
         BC    14,F0001                BRANCH NOT FB NO ALIGNMENT       03140000
*                                                                       03160000
         NI    DCBPRECL+1,X'F8'        ROUND SEG LENGTH TO DBL WORDS    03180000
         CLC   DCBPRECL(2),DCBLRECL     COMPARE SEG LENGTH TO LRECL     03200000
         BL    NOALLOW                 SUPPLY SIMPLE BUFFERING          03220000
*                                                                     * 03240000
*        DETERMINE NO OF BUFFERS TIMES EIGHT AND HOLD IN REG          * 03260000
*                                                                     * 03280000
F0001    EQU   *                                                        03300000
         SR    RTIOT,RTIOT             CLEAR REG                        03320000
         IC    RTIOT,DCBBUFNO          GET NO. OF BUFFERS               03340000
         LR    RF,RTIOT                COPY BUFNO                       03360000
         MR    RE,RDEB                  MULTIPLY BY EIGHT        S20201 03380020
*                                                                       03400000
*        AT THIS POINT RJ=BLKF,RF=8N,RC=PRECL,RTIOT=BUFNO               03420000
*                                                                       03440000
         LR    RB,RJ                   COPY BLOCK F                     03460000
*                                                                       03480000
         TM    DCBDEVT,DISK            Q-DISK SUPPORTED                 03520000
         BO    E1B2                    YES-BRANCH                       03540000
*                                                                       03560000
         MVI   DCBCNTRL+3,X'02'        TAPE EOB ID FOR LOAD MODULE      03600000
*                                                                     * 03620000
         LA    RB,5(0,RB)              ADD 5 TO BF FOR TAPE             03640000
         B     E1B3                    BRANCH TO CALC AMT OF CORE       03660000
*                                                                       03680000
E1B2     EQU   *                                                        03700000
         LA    RB,10(0,RB)             ADD 10 TO BF FOR DISK            03720000
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 03723020
*                                       DISCONNECT               S20201 03726020
         BO    E1B2A                    BRANCH IF YES            S20201 03729020
         LA    RB,D2(D0,RB)             INCREMENT FOR 2 CCWS     S20201 03732020
E1B2A    EQU   *                                                 S20201 03735020
         TM    DCBOPTCD,X'80'          Q- WRITE VALIDITY CHECK          03740000
         BZ    E1B3                    NO BRANCH                        03760000
*                                                                       03780000
         LA    RB,3(0,RB)              ADD 3 TO BF FOR WRITE CHECK      03800000
         TM    JFCBMASK+D6,NONCARN      ANY DEVICE W/O           S20201 03804020
*                                       DISCONNECT               S20201 03808020
         BO    E1B3                     BRANCH IF YES            S20201 03812020
         LA    RB,D1(D0,RB)             INCREMENT FOR 1 CCW      S20201 03816020
E1B3     EQU   *                                                        03820000
         LR    RC,RF                   BF + CONSTANTS TIMES 8N          03840000
         MR    RB,RB                   CALCULATE AMT OF CORE NEEDED     03860000
*                                      ANSWER IN REG C                  03880000
         LR    RB,RC                   COPY AMT USE WHEN CLEARING       03900000
*                                                                       03902020
* CHECK FOR DISCONNECT AND GET 1 DW IF FEATURE IS AVAILABLE        DMOR 03904020
*                                                                       03906020
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 03908020
*                                       DISCONNECT               S20201 03910020
         BO    E1B3A                    BRANCH IF YES            S20201 03912020
         LA    RC,CCWOFF(D0,RC)         OTHERWISE INCREMENT      S20201 03914020
         LR    RB,RC                    COPY AMOUNT FOR CLEARING S20201 03916020
E1B3A    EQU   *                                                 S20201 03918020
*                                                                       03928002
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE IOBS YM4697 03968002
*  IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE EXECUTOR.  YM4697 04018002
*                                                                       04028402
         ST    RC,DXATEXC2              SAVE LENGTH              YM4697 04028802
*                                                                       04029202
         MODESET  KEYADDR=DXUKEY,WORKREG=15  GET INTO USER KEY   Y02072 04030002
*                                                                       04040002
         GETMAIN R,LV=(RC),SP=0                                  Y02072 04060002
*                                                                     * 04080000
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 04100002
*                                                                       04110002
*        THIS SECTION CLEARS CORE GOT,SETS IOBL SO CLOSE CAN REL CORE   04120000
*********************************************************************** 04140000
         ST    RF,DCBIOBA              ADDRESS OF FIRST IOB             04160000
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 04170002
*                                                                     * 04180000
         LR    RC,RF                   COPY ADDRESS FOR CLEARING        04200000
         LR    RJ,RB                   COPY AMOUNT                      04220000
*                                                                       04221020
* SET UP THETA ADDRESS IN CASE DISCONNECT FEATURE AVAILABLE        DMOR 04222020
*                                                                       04223020
         AR    RJ,RF                    GET LAST AREA ADDR       S20201 04224020
         SR    RJ,RDEB                  SUB ONE DW               S20201 04225020
         ST    RJ,DXCCW11               TEMP STORE SET THETA     S20201 04226020
*                                       ADDR                     S20201 04227020
         LR    RJ,RB                    RESTORE AMOUNT           S20201 04231020
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 04232020
*                                       DISCONNECT               S20201 04233020
         BO    NOTDISCT                 BRANCH YES               S20201 04234020
         SR    RJ,RDEB                  DECREMENT ONE DW         S20201 04235020
NOTDISCT EQU   *                                                 S20201 04236020
         SR    RD,RD                   CLEAR REG                        04240000
         DR    RD,RTIOT                DIVIDE BY NO.OF BUFFERS          04260000
         SRL   RJ,3                    CONVERT TO DBL WORDS             04280000
         STC   RJ,DCBIOBL              STORE AMT FOR CLOSE              04300000
*                                                                     * 04320000
*        RB    HAS AMOUNT TO CLEAR                                    * 04340000
*                                                                     * 04360000
         BCTR  RB,0                    REDUCE AMOUNT BY ONE             04380000
         MODESET  KEYADDR=DXUKEY,WORKREG=15  GET INTO USER KEY   Y02072 04382002
         LA    RJ,255                  LOAD 255                         04400000
COMPARE  EQU   *                                                        04420000
         CR    RB,RJ                   Q-AMT TO CLEAR GREATER THAN 255  04440000
         BC    12,ONECLEAR             NO-BRANCH                        04460000
         EX    RJ,CLEAR                CLEAR 256 BYTES                  04480000
         SR    RB,RJ                   AMT TO CLEAR MINUS 255           04500000
         BCTR  RB,0                    SUBTRACT ONE MORE                04520000
         LA    RC,256(0,RC)            UPDATE AREA ADDRESS              04540000
*                                                                       04560000
         B     COMPARE                 TRY AGAIN                        04580000
*                                                                     * 04600000
CLEAR    EQU   *                                                        04620000
         XC    0(1,RC),0(RC)           CLEAR CORE                       04640000
*                                                                       04660000
ONECLEAR EQU   *                                                        04680000
         EX    RB,CLEAR                CLEARS LESS THAN 256             04700000
*                                                                       04720000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   04740000
*                                                                       04760000
*                                                                       04780000
*                                                                       04800000
*                                                                     * 04820000
*        AT THIS POINT RF IS ADDRESS OF CLEARED CORE                  * 04840000
*                                                                     * 04860000
         LR    RJ,RF                   REDUNDANT FOR 1 IOB BUT NEEDED   04880000
*                                                                       04900000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   04920000
*                                                                       04940000
*                                                                       04960000
*        CONSTRUCT COMMON IOB,ICB FIELDS HERE                           04980000
*                                                                       05000000
*        RF= RJ= FIRST IOB ADDRESS                                      05020000
*        OFFSET0                       LINK ADDRESS TO NEXT ICB,IOB     05040000
*        OFFSET4                       E C B                            05060000
*        OFFSET8                       IOS FLAGS                        05080000
*        OFFSET12                      ECB ADDRESS                      05100000
*        OFFSET 16                     CSW                              05120000
*        OFFSET24                      CHP START ADDRESS                05140000
*        OFFSET28                      DCB ADDRESS                      05160000
*                                                                       05180000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   05200000
E1H3     EQU   *                                                      * 05220000
         LR    RF,RJ                   POSITION FOR NEXT IOB,ICB        05260000
         LA    RJ,4(0,RF)              ECB ADDRESS                      05280000
         ST    RJ,12(0,RF)             STORE IN IOB,ICB                 05300000
         MVI   0(RJ),X'7F'              INDICATE COMPLETE NO ERROR      05320000
         L     RWK2,DXUDCBAD            GET USERS DCB ADDR       Y02072 05330002
         USING IOBQSAMN,RF                                       Y02072 05340002
         ST    RWK2,IOBDCBPT            DCB ADDRESS TO IOB       Y02072 05350002
         DROP  RF                                                Y02072 05352002
         TM    DCBRECFM,X'10'           USING BLOCKED RECORDS           05360000
         BZ    E1H4                     NO-BRANCH                       05380000
*                                                                       05400000
         OI    8(RF),X'80'              TURN ON DC FLAG FOR IOS ERROR   05420000
*                                       RECOVERY ROUTINE                05440000
E1H4     EQU   *                                                        05460000
*                                                                       05480000
         L     RWK1,DCBBUFCB            ADDR OF BUFFER CNTRL BLK YM7595 05530002
         USING BCBLK,RWK1                                        YM7595 05540002
         L     RBUFADR,BCBBUFPT         NEXT AVAIL BUFFER        YM7595 05550002
         LTR   RBUFADR,RBUFADR          IS THERE A BUFFER ADDR   Y02072 05580002
         BZ    ABEND                    NO, ISSUE DMABCOND       Y02072 05590002
         USING BUFFER,RBUFADR                                    YM7595 05600002
         MVC   BCBBUFAD,BUFNXPTB        UPDATE BUF CNTRL BLK     YM7595 05610002
         DROP  RWK1,RBUFADR                                      YM7595 05612002
*                                                                       05620000
* RBUFADR CONTAINS BUFFER ADDRESS                                Y02072 05640002
*                                                                       05660000
         LA    RJ,32(RDEB,RF)          STARTAD FOR TAPE MB--R FOR DISK  05680000
         MVI   37(RF),X'01'            INC COUNT FOR LABELS             05700000
*                                                                     * 05720000
E1K4     EQU   *                                                        05740000
         ST    RJ,24(0,RF)             STORE STARTAD                    05760000
         TM    DCBDEVT,DISK             IS DEV TYPE DIR ACCESS   Y02072 05810002
         BO    E2F4                     YES, BR                  Y02072 05860002
         B     E2A21                    NO, BR                   Y02072 05870002
E2A2     EQU   *                                                        05880000
*                                                                     * 05900000
         LH    RE,DCBEROPT+D4           GET BLOCKING FACTOR      S20201 05910020
E2B4     EQU   *                                                        05920000
         USING CCW,RJ                                            Y02072 05930002
         ST    RBUFADR,CCWADDRA         ADDR TO CCW              Y02072 05932002
         MVI   0(RJ),X'01'             CMND BYTE FOR TAPE               05960000
*                                      NOT USED BY DISK CHP             05980000
         MVC   CCWBYTE,DCBLRECL         LOG REC LEN TO CHAN PGM  Y02072 06032002
         OI    CCWFLGS,CCWSLI           SILI BIT ON IN CHAN PGM  Y02072 06034002
         DROP  RJ                                                Y02072 06036002
         AH    RBUFADR,DCBPRECL         ADD SEG LEN TO ADDR      Y02072 06038002
         AR    RJ,RDEB                  ADD 8 TO POS CCW         S20201 06043020
         BCT   RE,E2B4                  MORE CCW'S TO BUILD      S20201 06046020
*                                                                       06049020
* CHECK FOR DISCONNECT FEATURE AND SET UP READ THETA CMND          DMOR 06052020
*                                                                       06055020
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 06058020
*                                       DISCONNECT               S20201 06061020
         BO    E2B5                     BRANCH IF YES            S20201 06064020
         SR    RJ,RDEB                  DECREMENT CCW PTR        S20201 06067020
         OI    FLAGOFF(RJ),CC           SET COMMAND CHAIN FLAG   S20201 06070020
         AR    RJ,RDEB                  RESTORE CCW PTR          S20201 06073020
         L     RE,DXCCW11               RETRIEVE RD THETA ADDR   Y02072 06076002
         ST    RE,D0(D0,RJ)             PUT IN RD THETA ADDR     S20201 06079020
         MVI   CNTOFF(RJ),D1            SET BYTE COUNT TO ONE    S20201 06082020
         MVI   D0(RJ),RDSC              MOVE IN RD  SECTOR       S20201 06085020
*                                       COMMAND                  S20201 06088020
         AR    RJ,RDEB                  INCR POINTER             S20201 06091020
E2B5     EQU   *                                                 S20201 06094020
*                                                                     * 06100000
         TM    DCBDEVT,DISK            Q-DISK                           06120000
         BZ    E1H2                    BRANCH ON NO                     06140000
*                                                                       06160000
         TM    DCBOPTCD,X'80'          WRITE CHECK PRESENT              06180000
         BO    E2D3                    BRANCH ON YES                    06200000
*                                                                       06220000
*                                                                     * 06240000
E2E3     EQU   *                                                        06260000
E2F2     EQU   *                                                        06280000
*                                                                     * 06300000
         TM    DCBDEVT,DISK            Q-DISK                           06320000
         BZ    E1H2                    BRANCH NOT DISK                  06340000
*                                                                       06360000
         ST    RJ,0(0,RB)              WRT CKD ADDRESS TO PROPER CCW    06380000
         MVI   0(RB),X'1D'             PLACE CMND BYTE                  06400000
         AR    RJ,RDEB                  POS PTR TO NEXT ICB,IOB  S20201 06420020
*                                                                       06440000
E1H2     EQU   *                                                      * 06460000
         ST    RJ,0(0,RF)              STORE LINKAD IN IOB              06480000
         OI    0(RF),X'40'             TURN ON WRITE BIT FOR EOB RT     06500000
         BCT   RTIOT,E1H3              BRANCH IF MORE IOB,ICB TO MAKE   06520000
*                                                                     * 06540000
         L     RC,DCBIOBA              GET FIRST IOB ADDRESS            06560000
         MVC   1(3,RF),DCBIOBA+1       PLACE LAST LINKAD                06580000
         MVI   0(RC),X'41'              FIRST IOB AND WRITE BITS ON     06600000
         L     RB,24(0,RF)             GET STARTAD                      06620000
         LR    RD,RB                   COPY ADDRESS                     06640000
         SR    RB,RF                   GET WCPO                         06660000
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 06662002
         STC   RB,DCBWCPO              STORE WRITE CHP OFFSET           06680000
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 06690002
         SR    RJ,RD                   GET WCPL                         06700000
         SR    RJ,RDEB                  CORRECT VALUE            S20201 06720020
         SRL   RJ,3                    DIVIDE BY EIGHT                  06740000
         STC   RJ,DCBWCPL              STORE WRITE CHP LENGTH           06760000
         XC    DCBPRECL(2),DCBPRECL     CLEAR COUNTER                   06780000
*                                                                     * 06800000
*                                                                       06820000
*                                                                       06840000
*                                                                       06860000
*                                                                       06880000
XCTL     EQU   *                                                        06900000
         USING WTGENTRY,RWTGC                                    Y02072 06910002
         MVC   WTGID,NXTEXEC            XCTL TO LOAD EXEC        Y02072 06912002
         DROP  RWTGC                                             Y02072 06914002
RELOOP   EQU   *                                                        06960000
         L     RCORE,4(0,RWTGC)        LOAD RCORE BASE                  06980000
         LA    RWTGC,8(0,RWTGC)             INCREMENT CURR WTG ENTRY    07000000
         LA    RPARC,4(0,RPARC)             INC CURRENT DCB ENTRY PTR   07020000
         CLC   0(2,RWTGC),AMIDCNST     Q- THIS RT NEEDED AGAIN          07040000
         BCR   8,RBASE                                                  07060000
*                                                                       07080000
         CLC   0(2,RWTGC),OPIDCNST     Q- END OF TABLE                  07100000
         BC    7,RELOOP                    NO-CHECK NEXT ENTRY          07120000
*                                                                       07140000
         LR    RPARC,RPAR                                               07160000
         LA    RWTGC,32(0,RWTG)             REINIT WTG LIST PTR         07180000
ZCHEK    EQU   *                                                        07200000
         CLI   0(RWTGC),X'00'               Q-IS THIS ENTRY COMPLETE    07220000
         BC    7,TCTLRTN                                                07240000
*                                                                       07260000
         LA    RWTGC,8(0,RWTGC)             GET NEXT ENTRY              07280000
         LA    RPARC,4(0,RPARC)                                         07300000
         B     ZCHEK                                                    07320000
*                                                                       07340000
TCTLRTN  EQU   *                                                        07360000
         MVC   6(2,RWTG),0(RWTGC)      STORE ID IN WTG TABLE            07380000
         LA    RJ,DXXCTL                SET UP FOR XCTL          S21042 07420021
         XC    DXXCTL,DXXCTL            CLEAR PARM LIST, NO DCB  Y02072 07430002
*                                         FOR LPALIB             Y02072 07432002
*                                                                       07440000
         XCTL  EPLOC=(RWTG),SF=(E,(15))                          Y02072 07460002
*                                                                       07480000
*                                                                       07500000
*                                                                       07520000
*                                                                       07540000
*                                                                       07560000
*                                                                       07580000
E2F4     EQU   *                                                        07600000
         MVC   0(8,RJ),DCBFDAD         MOVE MBBCCHHR FROM DCB TO IOB    07620000
         LA    RB,3(0,RJ)              ADDRESS FOR SRCH CCW             07640000
         AR    RJ,RDEB                  ADD 8 TO POSITION CCW    S20201 07660020
         ST    RJ,24(0,RF)             STORE STARTAD                    07680000
*                                                                       07700000
*                                      TO CONSTRUCT WRT(CKD) CCW        07720000
*                                                                     * 07740000
*        MAKE SRCH TIC      CCWS HERE                                 * 07760000
*                                                                     * 07780000
*                                                                       07781020
* IF DISCONNECT FEATURE ON ALL DEVICES, SET SECT USED IN CHP       DMOR 07782020
*                                                                       07783020
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 07784020
*                                       DISCONNECT               S20201 07785020
         BO    E2J3                     BRANCH IF YES            S20201 07786020
         L     RE,DXCCW11               RETRIEVE SET THETA ADDR  S20201 07787020
         ST    RE,D0(D0,RJ)             PUT ADDR IN CCW          S20201 07788020
         OI    FLAGOFF(RJ),CC           SET CMND CHAIN BIT       S20201 07789020
         MVI   CNTOFF(RJ),D1            SET BYTE CNT TO ONE      S20201 07790020
         MVI   D0(RJ),SETSC             SET SECTOR CMND          S20201 07791020
         AR    RJ,RDEB                  INCREMENT CCW PTR        S20201 07792020
E2J3     EQU   *                                                 S20201 07793020
         ST    RB,0(0,RJ)              STORE SEARCH ADDRESS             07800000
         MVI   0(RJ),X'31'             PLACE SEARCH CMND BYTE           07820000
         MVI   4(RJ),X'40'             TURN ON CC FLAG                  07840000
         MVI   7(RJ),X'05'             SET COUNT OF 5                   07860000
*                                                                     * 07880000
*        SEARCH CCW COMPLETED                                         * 07900000
*                                                                     * 07920000
         ST    RJ,8(0,RJ)              STORE TIC ADDRESS                07940000
         MVI   8(RJ),X'08'             PLACE TIC CMND BYTE              07960000
*                                                                     * 07980000
*        TIC   CCW COMPLETED                                          * 08000000
*                                                                     * 08020000
         LA    RJ,16(0,RJ)             POSITION POINTER AT WR CKD CCW   08040000
E2J4     EQU   *                                                        08060000
*                   CONSTRUCT RIGHT HALF OF WRT CKD CCW HERE          * 08080000
*                   CMND BYTE & ADDRESS OF CCHHRKDLDL COMES LAST      * 08100000
*                                      AT E2G2 ADDRESS                * 08120000
         LR    RB,RJ                   COPY WRT(CKD) ADDRESS            08140000
         MVI   7(RJ),X'08'             PLACE COUNT OF EIGHT             08160000
         MVI   4(RJ),X'A0'             SET DC AND SIL FLAG ON           08180000
E1J4     EQU   *                                                        08200000
         AR    RJ,RDEB                  POSITION FOR WRITE CCW   S20201 08220020
*                                                                     * 08240000
*        NO DC FLAGS NEEDED ACCESS METHOD SETS FLAGS                  * 08260000
E2A21    EQU   *                                                      * 08280000
         SR    RJ,RF                   DERIVE OFFSW                     08300000
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 08302002
         STC   RJ,DCBOFFSW             STORE OFFSET IN DCB              08320000
         MODESET  KEYADDR=DXUKEY,WORKREG=14  GET INTO USER KEY   Y02072 08322002
         AR    RJ,RF                   RESTORE CCW ADDRESS              08340000
         B     E2A2                                                     08360000
*                                                                     * 08380000
*                                                                     * 08400000
*                                                                     * 08420000
E2D3     EQU   *                                                        08440000
*********************************************************************** 08460000
*        MAKE  CHP FOR CHECKING WRITE HERE                            * 08480000
*********************************************************************** 08500000
*                                                                     * 08520000
         SR    RJ,RDEB                  BACKUP POINTER           S20201 08540020
         MVI   4(RJ),X'40'             TURN ON  CC  FLAG IN LAST CCW    08560000
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 08561020
*                                       DISCONNECT               S20201 08562020
         BO    E2D3A                    BRANCH IF YES            S20201 08563020
*                                                                       08564020
* IF DISCONNECT FEATURE ON ALL DEVICES USE SET SECT COMMAND        DMOR 08565020
*                                                                       08566020
         MVC   D8(CCWOFF,RJ),D0(RJ)     MOVE READ SECTOR ONE CCW S20201 08567020
         AR    RJ,RDEB                  RESTORE CCW PTR          S20201 08568020
         MVI   D0(RJ),SETSC             CHANGE CMND TO SET       S20201 08569020
*                                       SECTOR                   S20201 08570020
E2D3A    EQU   *                                                 S20201 08571020
         AR    RJ,RDEB                  POSITION AT SRCH CCW     S20201 08581020
         MVI   7(RJ),X'05'             LENGTH FOR SRCH CCW              08600000
         MVI   4(RJ),X'40'             TURN ON CC FLAG                  08620000
*                                                                     * 08640000
*        ADDRESS OF  CCHHRKDLDL & CMND BYTE DONE LATER                * 08660000
*                                                                     * 08680000
         ST    RJ,8(0,RJ)              TIC ADDRESS                      08700000
         MVI   8(RJ),X'08'             PLACE TIC OP                     08720000
         MVC   22(2,RJ),DCBBUFL        MOVE BUFFER SIZE TO READ CCW     08740000
         MVI   20(RJ),X'10'            MOVE SKIP FLAG TO CCW            08760000
         MVI   16(RJ),X'86'            MOVE RD(D) CMND BYTE TO CCW      08780000
*                                                                     * 08800000
E2E51    EQU   *                                                        08820000
*                                                                       08840000
         LA    RD,24(0,RJ)             ADDR OF CCHHRKDD FOR SRCH        08860000
E2E5     EQU   *                                                        08880000
         ST    RD,0(0,RJ)              STORE IN SRCH CCW                08900000
         MVI   0(RJ),X'31'             PLACE SEARCH CMND BYTE           08920000
         LA    RJ,24(0,RJ)             ADDRESS CCHHRKLDLDL              08940000
         B     E2E3                                                     08960000
*                                                                       08980000
*                                                                       09000000
ABEND    EQU   *                                                        09020000
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 09022002
         DMABCOND OABD063,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X09040021
                                        CALL PROBLEM DETERMINATION      09060021
         B     TCTLRTN                                           S21042 09080021
AMIDCNST DC    C'1F'                    THIS ID                         09100002
OPIDCNST DC    C'0S'                    END ID                          09120002
SOP2     DC    C'1D'                    ABNORMAL, DA WHEN EXCH   Y02072 09130002
*                                         BUFFERING UNSUPPORT    Y02072 09132002
SOP5     DC    C'1G'                    ABNORMAL, NON-DA WHEN EX Y02072 09134002
*                                         BUFFERING UNSUPPORT    Y02072 09136002
NXTEXEC  DC    C'14'                    3RD STAGE EXEC TO LOAD   Y02072 09138002
*                                         ACCESS METHOD RTNS     Y02072 09138402
PDLOAD   DC    C'6M'                    PROBLEM DETERMINATION    Y02072 09138802
         SPACE                                                          09139202
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 09184402
END      EQU   *                        END OF MODULE            Y02072 09274802
         IECDSECS (MAIN,(IOB,NO)),IOB,DCB,WTG,EXPAND=YES         Y02072 09320002
         ORG   WTGIDTTR                                          Y02072 09330002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 09340002
         EJECT                                                          09350002
FORCORE  DSECT                                                   Y02072 09360002
         IHAFCAUD  ORG=YES                                       Y02072 09362002
         EJECT                                                          09364002
         IGGBCB  TYPE=SAM                                        Y02072 09370002
         EJECT                                                          09370402
         IHACCW  DSECT=YES                                       Y02072 09372002
         END                                                            09380000
./  ADD  SSI=73270042,NAME=IGG0191G
  TITLE  'IGG0191G - OPEN EXECUTOR - STAGE 2 - UR, MAG AND PAPER TAPE'  00002010
IGG0191G CSECT                                                          00004003
*MODULE NAME - IGG0191G                                          Y02072 00012002
*                                                                       00014002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00016002
*                                                                       00018002
*COPYRIGHT - NONE                                                Y02072 00020002
*                                                                       00020402
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00020802
*                                                                       00021202
*          RELEASE 20 DELETIONS                                       * 00022000
*2380121680                                                      S20038 00023020
*          RELEASE 21 DELETIONS                                       * 00024000
*2590065960                                                      M0129  00024121
*2590000020,001200,002000-002200,002400-002600,003000,004600,    A37507 00024221
*2590011800,015600,019800-020000,021600-021800,022200,024200-    A37507 00024421
*2590024400,025200-027000,027800-028000,028400,029600-029800,    A37507 00024621
*2590030200-030600,032200,034400-035400,036800,037800-038400,    A37507 00024821
*2590039200-043800,045600-047000,065600,073000-073600,074800,    A37507 00025021
*2590088800-117600,118400-118600,121000-121600,132800            A37507 00025221
*2590065800-066000,066200                                        A37507 00025421
*2590                                                            M0063  00025621
*2590132700-134200                                               M0091  00025821
*          VS2 RELEASE 2 DELETIONS                                      00025902
*000400,011400,060800,065415,065420,065425,065600,067800,068600, Y02072 00026602
*069000,085800,135200-135490,135500,135510-135570,133800,118800  Y02072 00027002
*121620,121720,123800,129000,129800                              Y02072 00027402
*                                                                YM4697 00027802
*C80200,C80400                                                 @ZA27760 00027937
*                                                                       00028002
*          VS2 RELEASE 3 DELETIONS                                      00038010
*                                                              @Z30TSMI 00038403
*          VS2 RELEASE 4 DELETIONS                                      00038510
*                                                              @Z40MSMI 00038610
*C08840000                                                     @ZM40309 00038810
*A06686000,06692000,09840000                                   @ZM40309 00039210
*                                                                       00039610
*STATUS CHANGE LEVEL 007                                                00040002
*                                                                       00060000
*FUNCTION/OPERATION: THIS ROUTINE WILL GET CORE(GETMAIN) TO SET UP THE  00080000
*      NECESSARY IOB'S. IT WILL CLEAR THE CORE AND LINK THE IOB'S       00100000
*      TOGETHER FOR TAPE & UNIT RECORD. (FOR UNIT RECORD, THEN GO       00110010
*      TO IGG0196K. FOR TAPE CONTINUE PROCESSING).                      00120021
*      IT WILL SET UP THE NECESSARY BUFFERS IF NOT AVAILABLE.           00140000
*      IT WILL CONNECT THE DCB AND IOB.                                 00160000
*      IT WILL DETERMINE WHAT ROUTINES ARE NEEDED FOR PROPER EXECUTION  00180000
*      AND SET A CODE IN THE DCBCNTRL FIELD OF THE DCB.                 00210021
*      IT WILL SET UP CCW'S FOR TAPE.                                   00220021
*      IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA           Y02072 00222002
*      INDICATING TO FORCE CLOSE THAT THE CORE GETMAINED FOR THE Y02072 00224002
*      IOB'S CAN BE FREEMAINED.                                  Y02072 00226002
*                                                                       00230021
*      THIS MODULE WAS SPLIT INTO IGG0196K FOR REL 21.                  00240021
*                                                                       00280000
*ENTRY POINTS: ENTERED FROM IGG0196B, IGG0193I, IGG0191T, IGG0191U,     00285021
*              IGG0191V, IGG0196Q  (NORMAL CONDITIONS)                  00290010
*              ENTERED FROM IGG0191F, IGG0191Q, IGG0191R -              00305021
*              (ABNORMAL CONDITIONS - CHAINED SCHEDULING UNSUPPORTABLE) 00310010
*                                                                       00320000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00340000
*                                                                       00360000
*OUTPUT: SEE DESCRIPTION OF REGISTERS, IOB(USERS), DCB(USERS).          00380000
*                                                                       00400000
*EXTERNAL ROUTINES: IFG019RA.                                           00420010
*                                                                       00440000
*EXITS- NORMAL: IGG0196K FOR UNIT RECORD AFTER GETMAIN                  00450010
*             : IGG01910, IGG01912, IGG01915 TO LOAD                    00460010
*               ACCESS METHOD ROUTINES                                  00470021
*EXITS-ERROR: NONE.                                                     00480000
*                                                                       00500000
*MACROS - ACTION : MODESET, GETMAIN, IECRES                             00510010
*                                                                       00520000
*TABLES/WORKAREAS-  SEE DSECTS AT THE END OF THIS LISTING               00540010
*                                                                       00560000
*                                                                       01100000
*                                                                       01120000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY           01140010
*            UNLESS OTHERWISE SPECIFIED, SUPERVISOR STATE               01150010
*                                                                       01160000
*NOTES: THIS ROUTINE GETS CORE FOR MAG & PAPER TAPE AND UNIT RECORD.    01168021
*       GOES TO IGG0196K TO CONSTRUCT IOB'S FOR UNIT RECORD.            01176010
*       THIS MODULE SAVES THE NUMBER OF IOB'S TO BE BUILT IN THE        01184021
*       HIGH ORDER BYTE OF DCBIOBA FOR MODULE IGG0196K.                 01192021
*       FOR THE 3886 OCR DEVICE, ADDITIONAL CORE IS GOTTEN FOR          01194002
*       A 152 BYTE BUFFER ALONG WITH THE IOB.                           01196002
*                                                                       01200000
*       FOR A 3800 PRINTER(@Z40MSMI) WHEN OPTCD=J (DYNAMIC TRANSLATE    01202010
*       TABLE SELECTION) HAS BEEN REQUESTED, THE CHANNEL PROGRAM        01206010
*       AREA MUST BE INCREASED TO ACCOMODATE THE EXTRA SELECT           01208010
*       TRANSLATE TABLE CCW. THE CHANNEL PROGRAM WILL BE:               01210010
*              NOP/ASA CNTRL                                            01212010
*              NOP/SEL TRANS TBL                                        01214010
*              WRITE                                                    01216010
*       THE LEADING NOP IS STILL REQUIRED AND CANNOT BE USED FOR        01218010
*       THE SELECT BECAUSE OF PRINT OVERFLOW SUPPORT WHICH CHANGES      01218410
*       THE NOP TO A SKIP-TO-ONE WHEN REQUESTED.                        01218810
*                                                                       01220000
*                                                                       01240000
*********************************************************************** 01260000
*                                                                       01280000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01300000
*                                                                       01320000
*********************************************************************** 01340000
*                                                                       01360000
RDCB     EQU   2         DCB REGISTER                                   01380000
RBASE    EQU   3         BASE REGISTER                                  01400000
RCORE    EQU   4         WORK AREA ADDRESS                              01420000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01440000
RWTG     EQU   6         TOP OF WTG TABLE                               01460000
RPARC    EQU   7         CURRENT PARAMETER                              01480000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01500000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01520000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01540000
RWK1     EQU   11                       WORK REGISTER            Y02072 01550002
RB       EQU   12        WORK REG1  **                                  01580000
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01600000
RWK2     EQU   RC                       WORK REGISTER            Y02072 01610002
RD       EQU   14        WORK REG3  **                                  01620000
RJ       EQU   15        WORK REG4                                      01640000
RE       EQU   0         WORK REG5                                      01660000
RF       EQU   1         WORK REG6                                      01680000
*                                                                       01700000
*                                                                       01760000
PARAR    EQU   RPARC                                         @ZA27760   01766010
DISPSN   EQU   X'0'                                          @ZA27760   01772010
*********************************************************************** 01780000
*                                                                       01800000
*                                                                       01820000
*                                                                       01840000
* MASKS FOR DEVICES TO BE SUPPORTED                                     01860000
*                                                                       01880000
*                                                                       01900000
*                                                                       01920000
TAPEB    EQU   X'80'                                                    01940000
URBITS   EQU   X'40'                                                    01960000
*                                                                       02040000
*                                                                       02060000
*********************************************************************   02280000
*                                                                       02300000
*          OPERATIONS                                                   02320000
*                                                                       02340000
WRITE      EQU   X'01'                                                  02360000
READ       EQU   X'02'                                                  02380000
READBACK   EQU   X'0C'                                                  02400000
EOR        EQU   X'04'                  END OF RECORD              DM0I 02460000
*                                                                       02480000
*********************************************************************   02500010
* GENERAL EQUATES                                                       02520010
*                                                                       02540010
ECBNORM  EQU   X'7F'                    NORMAL COMPLETION CODE          02560010
MULT8    EQU   3                        SHIFT VALUE TO DIV OR MULT BY 8 02640010
OCRIBSZ  EQU   216                      SIZE FOR 3886 OCR       XL03127 04736002
*                                       IOB&BUFR (40+24+152)    XL03127 04738002
*********************************************************************   04740000
         EJECT                                                          04762010
         BALR  RBASE,0                  SET BASE                   DM0I 04820010
         USING SOP5,RBASE                                               04840000
         USING WTG,RWTG                                                 04882010
         USING WTGENTRY,RWTGC                                           04884010
         USING PARML,RPARC                                              04886010
*                                                                       04900000
*                                                                       04920000
SOP5     EQU   *                                                        04940000
*                                                                       04960000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 04970002
         DC    C'IGG0191G'              MODULE NAME              Y02072 04972002
         DC    C'@ZA27760'              LAST SHIP CODE         @Z40MSMI 04974010
         DC    C'11/08/77'              LAST DATE MODIFIED     @Z40MSMI 04975010
BEGIN    DS    0H                                                YM4697 04978002
         SR    RE,RE                    INITIALIZE                      04980000
         L     RDCB,PARDCBAD            GET DCB ADDRESS                 05000010
         USING IHADCB,RDCB                                              05004010
         LA    RDCB,IHADCB              CLEAR HI BYTE                   05020010
         L     RCORE,WTGCORE-1          GET WRK AREA ADDRESS            05040010
         USING FORCORE,RCORE                                            05044010
         LA    RF,IOBEXTEN-IOBQSAMN+L'CCW  SIZE OF IOB + CCW            05060010
*                                                                       05080000
         TM    DCBDEVT,TAPEB            DCB USING TAPE                  05100000
         BO    SOP52                    YES BRANCH                      05120010
*                                       NO MUST BE UNIT RECORD          05140010
*                                                                       05140810
*   IF THE DEVICE IS THE 3886 OCR, ESTABLISH SIZE FOR THE IOB   XL03127 05141610
*   AND SPECIAL CONTIGUOUS BUFFER. 40(BASIC)+24(CP)+152(BUFR)   XL03127 05142410
*                                                                       05143210
         CLI   DCBDEVT,DCBDVOR9         IS DEVICE A 3886        XL03127 05143310
         BNE   SOP50                    NO,BRANCH AROUND        XL03127 05143410
         LA    RF,OCRIBSZ               YES,SET REQ'D SIZE      XL03127 05143510
         B     SOP55                    GO DO GETMAIN           XL03127 05144710
*                                                                       05147510
*                                                                       05148710
*    IF THE DEVICE IS A 3800 PRINTER AND OPTCD=J (DYNAMIC SELECTION     05149910
*    OF TRANSLATE TABLES) HAS BEEN REQUESTED, THEN AN ADDITIONAL 8      05152010
*    BYTES MUST BE GETMAINED IN THE CHANNEL PROGRAM AREA                05156010
*    FOR THE SELECT TRANSLATE TABLE CCW.                                05156810
*                                                                       05157610
SOP50    EQU   *                        NOT 3886                XL03127 05157710
         CLI   DCBDEVT,DCBDVPR5         IS THIS A 3800         @Z40MSMI 05158410
         BNE   SOP51                    NO - CONTINUE          @Z40MSMI 05159210
         TM    DCBOPTCD,DCBOPTJ         OPTCD=J SPECIFIED      @Z40MSMI 05159310
         BZ    SOP54                    NO - ADD 1 CCW         @Z40MSMI 05159510
         B     SOP53                    YES - ADD 2 CCW'S      @Z40MSMI 05159610
SOP51    EQU   *                        NOT 3800               @Z40MSMI 05159710
         TM    PAROPT,PAROUTPT          TEST OPEN OPTIONS               05160010
         BO    SOP54                    OUTPUT ADD 1 CCW                05180010
         BM    SOP53                    IN/OUT OUT/IN ADD 2 CCW'S       05184010
*                                                                       05200000
         TM    DCBMACF1,DCBMRCRL        IS THE CNTRL MACRO USED         05220010
         BO    SOP54                    YES ADD ONE CCW                 05240010
         B     SOP55                    ADD 0 CCW'S                     05260010
*                                                                       05360000
*                                                                       05380000
*********************************************************************** 05400000
*                                                                       05404010
*                 TAPE                                                  05408010
*                                                                       05412010
SOP52    TM    PAROPT,PAROUTPT-PARRDBCK DCB FOR IN/OUT                  05420010
         BM    SOP54                    IN/OUT OUT/IN ADD 1 CCW         05440010
         B     SOP55                    OUTPUT-INPUT-RDBACK ADD 0 CCW'S 05460010
*                                                                       05480000
SOP53    LA    RF,L'CCW(RF)             ADD 8 TO IOB SIZE               05500010
SOP54    LA    RF,L'CCW(RF)             ADD 8 TO IOB SIZE               05520010
SOP55    EQU   *                                                        05560000
         SRL   RF,MULT8                 DIVIDE BY 8                     05580010
         STC   RF,DCBIOBL               STORE LENGTH                    05600000
         SLL   RF,MULT8                 RESET                           05620010
*                                                                       05640000
SOP56    TM    DCBCIND2,DCBCNQSM        DCB USING QSAM                  05660010
         BO    SOP57                    YES BRANCH                      05680010
*                                                                       05700000
         IC    RE,DCBNCP                GET NO. BUFFER TO GEN           05720000
         LTR   RE,RE                    HAS NO. BEEN SPEC.              05740000
         BNZ   SOP58                    YES BRANCH                      05760010
*                                                                       05780000
         LA    RE,1                     SUPPLY 1 IOB                    05800000
         B     SOP58                    SKIP TO NEXT               DM0I 05840000
*                                                                       05860000
SOP57    IC    RE,DCBBUFNO              GET NO OF IOBS TO BUILD         05880000
*                                                                       05900000
*                                                                       05920000
SOP58    LR    RUCB,RE                  SAVE NO AS COUNTER              05940000
         MR    RE,RE                    COMPUTE SPACE REQUIRED          05960000
         LR    RB,RF                    SAVE FOR FUTURE USE             05980000
*                                                                       06000000
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE IOBS YM4697 06010002
*  IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE EXECUTOR.  YM4697 06012002
*                                                                       06020000
         ST    RF,DXATEXC2              SAVE LENGTH              YM4697 06030002
*********************************************************************** 06040000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06050002
*                                                                       06060000
         GETMAIN R,LV=(RF),SP=0                                  Y02072 06080002
*                                                                       06100000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06110002
*********************************************************************** 06120000
*                                                                       06140000
*                                                                       06160000
         ST    RF,DCBIOBA               SAVE FIRST IOB ADDR             06200000
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 06202002
         LR    RC,RF                   SAVE IOB ADDRESS          A37507 06210021
         LR    RD,RF                    SAVE IOB ADDRESS         M0129  06215021
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06242002
*********************************************************************** 06262010
*                                                                       06280010
*                   CLEAR GETMAINED AREA                                06300010
*                                                                       06320010
         SR    RJ,RJ                    SET FROM LENGTH TO ZERO         06340010
         LR    RE,RF                    SET ADDRESS TO AREA OBTAINED    06360010
         LR    RF,RB                    SET LENGTH                      06380010
         MVCL  RE,RD                    CLEAR AREA                      06400010
*                                                                       06500000
*                                                                       06520000
*********************************************************************** 06540000
         CH    RUCB,ONE                 ONE IOB?                 A37507 06540510
         BNE   NTONEIOB                 NO - BRANCH              A37507 06541010
         USING IOBQSAMN,RWK2            ADDRESSABILITY FOR DSECT        06541510
         OI    IOBFLAG1,IOBUNREL        YES - SET UNRELATED FLG  Y02072 06542010
         DROP  RWK2                                                     06542502
NTONEIOB EQU   *                                                 A37507 06543021
         CLI   DCBDEVT,DCBDVOR9         DCB FOR 3886 OCR?       XL03127 06543410
         BE    SOP500                   YES,GOTO UR EXEC        XL03127 06543802
         TM    DCBDEVT,DCBDVPTP         DCB FOR PAPER TAPE?      A37507 06544010
         BO    SOP505                   YES, CONTINUE            A37507 06548010
         TM    DCBDEVT,URBITS           DCB FOR UNIT RECORD?     A37507 06552010
         BZ    SOP505                   NO, CONTINUE             A37507 06556010
SOP500   EQU   *                                                 Y02072 06558002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06558102
         MVC   WTGIDTTR,SOPUNREC        YES, LOAD ID OF UNIT   @Z30TSMI 06560010
*                                       RECORD MODULE IGG0196K   A37507 06564010
         STC   RUCB,DCBIOBA             SAVE NO. OF IOB'S FOR    M0063  06569010
*                                       MOD IGG0196K             M0063  06570010
         B     RELOOP                                            A37507 06572021
SOP505   EQU   *                                                 A37507 06576021
         LR    RB,RD                    SAVE IOB ADDRESS         M0129  06586021
         B     SOP512                   MUST BE AT LEAST ONE     A37507 06606010
*                                       IOB, THEREFORE BYPASS    A37507 06616010
*                                       FOLLOWING TEST           A37507 06626010
SOP510   EQU   *                        BEGINNING OF IOB BUILD LOOP     06640010
*                                                                       06680000
         LTR   RUCB,RUCB                TEST FOR LAST IOB      @ZM40309 06686010
         BC    7,SOP512                 BRANCH IF NOT LAST IOB @ZM40309 06692010
         L     RB,DCBIOBA               GET FIRST IOB ADDR              06700000
         USING IOBQSAMN,RD                                              06710010
         ST    RB,IOBNIOBA              LINK FIRST IOB TO LAST          06720010
         DROP  RD                                                       06725010
         USING IOBQSAMN,RB                                              06730010
         OI    IOBNFLG1,IOBFIRST        SET INDICATOR                   06740010
         DROP  RB                                                       06745010
         USING IOBQSAMN,RD                                              06746010
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06750002
         TM    JFCBTSDM,JFCSDS          SYSIN OR SYSOUT                 06760010
         BZ    SOP5180                  NO BRANCH                       06780010
         CLI   DCBRTN2,RTN6             NOTE/POINT SPECIFIED            06800010
         BE    SOP511                   YES BRANCH                      06820010
         CLI   DCBRTN1,RTN9             CONTROL SPECIFIED               06840010
         BNE   SOP5180                  NO BRANCH                       06860010
*                                                                       06880000
SOP511   EQU   *                                                        06890002
         MVI   DCBRTN2,RTN10            STORE DUMMY ID                  06900010
         B     SOP5180                  CHECK FOR QSAM             DM0I 06920000
*                                                                       06940000
*                                                                       06960000
SOP512   EQU   *                                                        06980000
*                                                                       07000000
         ST    RB,IOBNIOBA              LINK THIS IOB TO LAST           07020010
         LR    RD,RB                    UPDATE WORK REG                 07040000
         LA    RB,IOBNECB               POINT TO ECB                    07060010
         OI    IOBNECB,ECBNORM          SET ECB COMPLETE WITHOUT ERROR  07080010
         ST    RB,IOBECBPT              STORE ECB IN POINTER            07100010
         LA    RB,IOBEXTEN              POINT TO CHANNEL PROGRAM (CP)   07160010
         ST    RB,IOBSTART              STORE CP ADDRESS IN IOB         07180010
         L     RWK1,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 07190002
         ST    RWK1,IOBDCBPT            DCB ADDR TO IOB          Y02072 07210002
         MVI   IOBINCAM+1,1             STORE INCREMENT AMOUNT          07220010
*                                                                       07240000
*                                                                       07260000
         LR    RC,RB                    UPDATE REG                      07280000
         USING CCW,RB                                                   07285010
*                                                                       07380000
*********************************************************************** 07400000
*                                                                       07420000
*      THIS SECTION DEALS WITH MAG AND PAPER TAPE CHANNEL PROGRAMS      07440010
*                                                                       07444010
*********************************************************************** 07460000
*                                                                       07470021
*                                                                       07480021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07482002
         MVI   DCBRTN4,RTN2             EGP2 ID NUMBER                  07500010
         MVI   DCBWCPO,IOBEXTEN-IOBQSAMN STORE FIRST OFFSET             07520010
         MVC   DCBWCPL(3),DCBWCPO       STORE REMAINING TREE            07540000
         MVI   DCBWCPL,1                CHANNEL PROG.IN DOUBLE WORDS    07560010
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 07562002
         TM    PAROPT,PAROUTPT          DCB FOR OUTPUT ONLY             07580010
         BO    SOP523                   YES BRANCH                      07600010
*                                                                       07620000
         TM    DCBRECFM,DCBRECU         U RECORDS USED                  07640010
         BNM   SOP520E                  YES,BRANCH                 DM0I 07660010
         TM    DCBDEVT,DCBDVPTP         TEST FOR DEVICE CODE       DM0I 07680010
         BNO   SOP5201                  NO ,BRANCH                 DMOI 07700010
         TM    DCBCIND2,DCBCNQSM        TEST                       DM0I 07720010
         BZ    SOP5201                  NO,BRANCH                  DM0I 07740010
         TM    DCBCODE,X'FE'-DCBPTCDN   TEST FOR TRANSLATE REQUEST DMOI 07760010
         BZ    SOP5201                  NO                         DM0I 07780000
         B     SOP520M                  YES                        DM0I 07800000
*                                       REMARKS                    DM0I 07820000
SOP520E  EQU   *                        ZERO                       DM0I 07840000
         TM    DCBDEVT,DCBDVPTP         PAPER TAPE                 DM0I 07860010
         BNO   SOP520M                  NO                         DM0I 07880010
         OI    CCWCOMCD,EOR             SET BIT IN READ CCW        DM0I 07900010
SOP520M  EQU   *                        HERE AGAIN                 DM0I 07920000
         OI    CCWFLGS,CCWSLI           SET SLI BIT FOR TYPE 4 REC.DM0I 07940010
*                                       PAPER TAPE FIXED TRANSLATE.     07980010
SOP5201  EQU   *                                                        08000000
         TM    DISPSN(PARAR),X'03'     BACKWARDS INPUT       @ZA27760   08020037
         BNM   SOP521                  BRANCH NOT MIXED      @ZA27760   08030037
*                                                                       08060000
         MVI   CCWCOMCD,READBACK        STORE RD BACK CMD BYTE          08080010
*                                                                       08100000
         B     SOP521AA                                                 08120010
*                                                                       08140000
SOP521   EQU   *                                                        08160000
         OI    CCWCOMCD,READ            SET READ OP CODE                08180010
SOP521AA EQU   *                                                        08181010
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08182002
         TM    DCBMACF1,DCBMRPT1        NOTE-POINT NEEDED               08200010
         BZ    SOP521A                  NO  BRANCH TO TEST CONTROL      08220010
         TM    DCBDEVT,DCBDVPTP         DCB FOR PAPER TAPE              08240010
         BO    SOP522                   YES,  LEAVE DUMMY ID            08260010
*                                       IN DCBCNTRL+1                   08280000
         MVI   DCBRTN2,RTN6             TAPE NOTE/POINT ID              08300010
         B     SOP522                   GO ON                      DM0I 08320000
SOP521A  EQU   *                                                        08340000
         TM    DCBMACF1,DCBMRCRL        CNTRL FOR TAPE NEEDED           08360010
         BZ    SOP522                   NO BRANCH                       08380010
         MVI   DCBRTN1,RTN9             CNTRL TAPE ID NUMBER            08400010
*                                                                       08420000
SOP522   LA    RB,L'CCW(RB)             UPDATE CP.ADDRESS               08440010
         TM    PAROPT,PAROUTPT-PARRDBCK DCB FOR IN/OUT                  08460010
         BZ    SOP524                   NO BRANCH                       08480010
*                                                                       08500000
         MVI   DCBRTN3,RTN2             SECOND EOB RT (IN-OUT)          08520010
         MVI   DCBWCPO,IOBEXTEN-IOBQSAMN+L'CCW UPDATE OFFSETS           08540010
         MVI   DCBOFFSW,IOBEXTEN-IOBQSAMN+L'CCW                         08560010
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 08570002
SOP523   EQU   *                                                 Y02072 08574002
         MVI   CCWCOMCD,WRITE           STORE WRT CMD BYTE              08580010
         OI    CCWFLGS,CCWSLI           SET SLI FLAG IN WRT CCW         08600010
         LA    RB,L'CCW(RB)             UPDATE TO NEXT IOB              08620010
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08622002
         TM    DCBMACF2,DCBMRPT2        NOTE-POINT NEEDED               08640010
         BZ    SOP523A                  NO BR TO TEST FOR CNTRL         08660010
         MVI   DCBRTN2,RTN6             NPT2 ID NUMBER                  08680010
         B     SOP524                   GO ON                      DM0I 08700000
SOP523A  TM    DCBMACF2,DCBMRCTL        CNTRL MACRO USED                08720010
         BZ    SOP524                   NO BRANCH                       08740010
         MVI   DCBRTN1,RTN9             CNTRL TAPE ID NUMBER            08760010
*                                                                       08780000
SOP524   EQU   *                                                        08800000
*                                                                       08820000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 08822002
         BCTR  RUCB,0                   DECREMENT IOB COUNTER  @ZM40309 08840010
         B     SOP510                   GO BUILD NEXT IOB      @ZM40309 09840010
*                                                                       11780000
SOP5180  EQU   *                                                        11800000
*                                                                       11820000
         MODESET EXTKEY=DATAMGT                                         11870010
         MVC   WTGIDTTR,SOPSLDFT        XCTL TO LOAD 1910      @Z30TSMI 11970010
         TM    DCBRECFM,DCBRECF         FIX FORMAT                 DM0I 12164010
         BO    SOP5STOP                 YES, BRANCH                DM0I 12166000
         TM    DCBRECFM,DCBRECV+DCBRECD V OR D FORMAT RECORDS    S20038 12168010
         BZ    SOP5STOP                 NO, BRANCH                 DM0I 12170000
         MVC   WTGIDTTR,SOPSLDVT        XCTL TO LOAD 1915      @Z30TSMI 12170410
SOP5STOP EQU   *                                                        12280000
*                                                                       12300000
         TM    DCBDEVT,DCBDVPTP         PAPER TAPE DEVICE               12340010
         BNO   RELOOP                   BRANCH ON NO                    12360010
         MVC   WTGIDTTR,SOPPTLD         YES, USE ALTER LOAD ID @Z30TSMI 12370003
         MVI   DCBPTFLG,0               INITIALIZE PAPER TAPE FLAGS     12400010
*                                                                       12420000
*                                                                       12440000
*********************************************************************** 12460000
*                                                                       12480000
*                                                                       12500000
RELOOP   LA    RWTGC,WTGEND             INCREMENT CURR WTG ENTRY        12520010
         LA    RPARC,L'PARDCBAD(0,RPARC) INCR CURRENT DCB ENTRY PRTR    12540010
         CLC   WTGID,AMIDCNST           THIS RT NEEDED AGAIN            12560010
         BER   RBASE                    BACK TO OPEN CONTROL ROUTINDM0I 12580010
*                                                                       12600000
         CLC   WTGID,OPIDCNST           END OF TABLE                    12620010
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             12640010
*                                                                       12660000
         LR    RPARC,RPAR               REINITIALIZA PARM LIST PTR      12680010
         DROP  RWTGC                                                    12690010
         LA    RWTGC,WTGENTRY           REINITIALIZE WTG LIST PTR       12700010
         USING WTGENTRY,RWTGC                                           12710010
ZCHEK    CLI   WTGENTRY,0               ENTRY COMPLETE             DM0I 12720010
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         12740010
*                                                                       12760000
         LA    RWTGC,WTGEND             GET NEXT ENTRY                  12780010
         LA    RPARC,L'PARDCBAD(0,RPARC) GET NEXT PARM ENTRY            12800010
         B     ZCHEK                    ZERO CHECK                 DM0I 12820000
*                                                                       12840000
TCTLRTN  EQU   *                                                        12860000
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*12930003
               MODID=WTGENTRY           GO TO NEXT ROUTINE     @Z30TSMI 12980003
**                                                                      13000000
*                                                                       13020000
*********************************************************************   13040000
*                                                                       13060000
OPIDCNST DC    C'0S'                    ID                         DM0I 13140000
AMIDCNST DC    C'1G'                    ID                         DM0I 13160000
SOPUNREC DC    C'6K',VL3(IGG0196K)      UNIT REC EXECUTOR      @Z30TSMI 13162003
SOPSLDVT DC    C'15',VL3(IGG01915)      VAR LEN RECORDS        @Z30TSMI 13164003
SOPSLDFT DC    C'10',VL3(IGG01910)      FIXED LEN RECORDS      @Z30TSMI 13166003
SOPPTLD  DC    C'12',VL3(IGG01912)      PAPER TAPE             @Z30TSMI 13168003
ONE      DC    H'1'                     USED FOR ONE IOB TEST    A37507 13168810
PATCH    DC    25H'0'                   PATCH AREA               Y02072 13188810
END      EQU   *                                                        13200010
         EJECT                                                          13300010
         IHACCW                                                         13400010
         EJECT                                                          13500010
CVT      DSECT                                                          13600010
         CVT                                                            13700010
         EJECT                                                          13800010
         DCBD  DSORG=PS                                                 13900010
         ORG   DCBCNTRL                                                 14000010
DCBRTN1  DS    X                                                        14100010
DCBRTN2  DS    X                                                        14200010
DCBRTN3  DS    X                                                        14300010
DCBRTN4  DS    X                                                        14400010
RTN1     EQU   1                        ROUTINE 1 ID                    14500010
RTN2     EQU   2                        ROUTINE 2 ID                    14600010
RTN3     EQU   3                        ROUTINE 3 ID                    14700010
RTN4     EQU   4                        ROUTINE 4 ID                    14800010
RTN5     EQU   5                        ROUTINE 5 ID                    14900010
RTN6     EQU   6                        ROUTINE 6 ID                    15000010
RTN7     EQU   7                        ROUTINE 7 ID                    15100010
RTN8     EQU   8                        ROUTINE 8 ID                    15200010
RTN9     EQU   9                        ROUTINE 9 ID                    15300010
RTN10    EQU   10                       ROTUINE 10 ID                   15400010
         EJECT                                                          15500010
         IECDSECS (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES              15600010
         ORG   WTGIDTTR                                                 15700010
WTGID    DS    CL2                                                      15800010
         EJECT                                                          15900010
FORCORE  DSECT                                                          15920010
         IHAFCAUD ORG=YES                                               16000010
         EJECT                                                          16100010
         IGGPARML                                                       16200010
         END                                                            16300010
./  ADD  SSI=43081008,NAME=IGG0191H
         TITLE 'IGG0191H, LEVEL 2 EXEC FOR D.A. WITH TRK OVFLOW.'       00032002
         MACRO                                                          00034002
&NAME    IF    &A,&IS=,&ISNOT=,&GOTO=                                   00040000
         LCLB  &NOERR                                                   00060000
&NOERR   SETB  1                                                        00080000
         AIF   ('&A' NE '').SKIP                                        00100000
         MNOTE 'TEST  ADDRESS NOT SPECIFIED.'                           00120000
&NOERR   SETB  0                                                        00140000
.SKIP    AIF   ('&GOTO' NE '').SKIP2                                    00160000
         MNOTE 'BRANCH ADDRESS MISSING.'                                00180000
&NOERR   SETB  0                                                        00200000
.SKIP2   AIF   ('&IS' NE '' OR '&ISNOT' NE '').SKIP3                    00220000
         MNOTE 'TEST CONDITION NOT SPECIFIED.'                          00240000
&NOERR   SETB  0                                                        00260000
.SKIP3   AIF   (&NOERR).SKIP4                                           00280000
         MEXIT                                                          00300000
.SKIP4   AIF   ('&IS' EQ '').NOIS                                       00320000
***                                                                     00340000
&NAME    TM    &A,&IS                                                   00360000
         BO    &GOTO                                                    00380000
***                                                                     00400000
         MEXIT                                                          00420000
.NOIS    ANOP                                                           00440002
***                                                                     00460000
&NAME    TM    &A,&ISNOT                                                00480000
         BZ    &GOTO                                                    00500000
***                                                                     00520000
         MEND                                                           00540000
IGG0191H CSECT                                                          00560000
*                                                                       00580000
*                                                                       00610002
*MODULE NAME - IGG0191H                                          Y02072 00612002
*                                                                       00614002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00616002
*                                                                       00618002
*COPYRIGHT - NONE                                                Y02072 00618402
*                                                                       00618802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00619202
*                                                                       00619602
*          VS2 RELEASE 2 DELETIONS                               Y02072 00620402
*005500,044300,044420,044600-044720,060090-060120,062800,        Y02072 00620802
*075720,110370,126040,120200,120350,124400-124800,125400         Y02072 00620902
*100400,110340-110350,106000                                     YM1086 00622902
*                                                                YM2424 00624902
*                                                                YM4640 00625002
*                                                                YM7595 00627002
*                                                                       00627403
*          VS2 RELEASE 3 DELETIONS                                      00627803
*                                                              @Z30TSCF 00628203
*          RELEASE 20 DELETIONS                                       * 00629000
*0973020200-020800,043000,044600,045000-059800,063000,064200,    S20201 00629120
*0973067800-068000,068200,069200,070400,075800,076800,077800,    S20201 00629220
*0973079600,089200,092400,093400,097200,099200,100600,102200-    S20201 00629320
*0973102400,110400,111000,111400-111600,119600,125600-125800,    S20201 00629420
*0973126000-126200,129400,134800-135200,138000-138400,145600-    S20201 00629520
*0973145800                                                      S20201 00629620
*          RELEASE 21 DELETIONS                                       * 00630000
*0091042300,043000,075700,110360,120000,125000,127600-127700,    S21042 00630321
*0091132900,157400                                               S21042 00630621
*                                                                       00631002
*STATUS CHANGE LEVEL 007                                                00636001
*                                                                       00640000
*                                                                       00660000
* THIS EXECUTOR RUNS IN TANDEM WITH IGG0191S, WHICH COMPLETES DCB       00680000
* FIELDS THAT ARE KNOWN PRIOR TO GETTING CORE FOR THE IOB/CP'S.         00700000
*                                                                       00720000
* THE MAJOR FUNCTIONS OF THIS EXEC ARE-                                 00740000
*                                                                       00760000
* 1. STRUCTURE EACH IOB/CP WITH THE ADDRESSES AND FLAGS THAT ARE        00820002
*    KNOWN AT OPEN TIME.                                                00840000
* 2. COMPLETE THE RELATED DCB FIELDS.                                   00860002
* 3. REPEAT FOR EACH DCB BEING OPENED.                                  00880002
*                                                                       00900000
* ENTRY POINTS- FROM IGG0191S BY XCTL.                                  00920000
* EXITS- TO IGG01913 BY XCTL.                                           00940000
*                                                                       00960000
*                                                                       00980000
*INPUT-REGISTERS WITH THE ADDRESSES OF THE FOLLOWING-                   01000000
*   THE PARAMETER LIST  (POINTERS TO TOP AND CURRENT ENTRY).            01020000
*   THE WHERE-TO-GO TABLE (WTG) (POINTERS TO TOP AND CURRENT).          01040000
* EXTERNAL ROUTINES- NONE.                                              01060000
* ATTRIBUTES- REENTRANT, REUSABLE, RUNS IN USER KEY UNLESS       Y02072 01080002
*             OTHERWISE SPECIFIED, SUPER STATE                   Y02072 01090002
* TABLES/WORKAREAS-                                                     01100000
*                                                                       01110002
*MACROS : ACTION - MODESET, XCTL, XCTLTABL                       Y02072 01112002
*                                                                       01114002
*MACROS : MAPPING - IHACCW, IGGBCB, IECDSECS(DCB,WTG), IHAFCAUD         01116002
*                                                                       01120000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              01140000
*      BYTE  0-7  NAME                                                  01160000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            01180000
*      BYTE 11    CONCATENATION NUMBER                                  01200000
*      BYTE 12    ZERO                                                  01220000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       01240000
*                        ALIAS INDICATOR 1 BIT                          01260000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      01280000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              01300000
*      BYTE 17    ZERO                                                  01320000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      01340000
*      BYTE 20    TRANSLATION TABLE                                     01360000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            01380000
*      BYTE 22-23 ATTRIBUTES                                            01400000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     01420000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           01440000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 01460000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        01480000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       01500000
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        01520000
*      BYTE 36-39 TABLE OF IDTTR'S                                      01540000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          01560000
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          01580000
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01600000
*                   NOT USED                         (1 BYTE)           01620000
*                                                                       01640000
*    WORKAREA- SEE 'FORCORE DSECT' (IECDSECT) IN THIS LISTING           01660000
*                                                                       01680000
*TABLES/WORKAREAS- PARAMETER LIST                                       01700000
*                                                                       01720000
*WORD ZERO                                                              01740000
*      BYTE  0    OPEN ATTRIBUTE  (INPUT, OUTPUT, UPDATE, IN/OUT,       01760000
*                                  OUT/IN, READ BACKWD, LEAVE , REREAD) 01780000
*      BYTES 1-3  DCB ADDRESS FOR FIRST DCB BEING OPENED.               01800000
*                                                                       01820000
*THE PARAMETER LIST HAS A ONE WORD ENTRY FOR EACH DCB BEING OPENED. THE 01840000
*FORMAT IS THE SAME AS WORD ZERO.                                       01860000
*END PARAMETER LIST.                                                    01880000
*                                                                       01900000
* REGISTER CONVENTIONS USED IN ALL OF OPEN-                             01920000
*                                                                       01940000
RDCB     EQU   2                        DCB REGISTER                    01960000
RBASE    EQU   3                        BASE REGISTER                   01980000
RCORE    EQU   4                        I/O SUPPORT WORK AREA           02000000
RPAR     EQU   5                        TOP OF PARAMETER LIST           02100000
RBUFADR  EQU   RPAR                     MAINTAINS ADDR OF NEXT   Y02072 02110002
*                                         AVAILABLE BUFFER       Y02072 02112002
RWTG     EQU   6                        TOP OF WTG TABLE                02120000
RPARC    EQU   7                        CURRENT PARAMETER               02140000
RWTGC    EQU   8                        CURRENT LOAD IN TRANSIENT AREA  02160000
RTIOT    EQU   9                        USED AS A WORK REG              02180000
RIOB     EQU   RTIOT                    USED AS IOB BASE REG WITH THE   02200000
*                                       IOB OVERLAY FROM FORECORE.      02220000
RUCB     EQU   10                       USED AS A WORK REG              02240000
RCPSIZE  EQU   RUCB                     USED TO CALCULATE AND HOLD THE  02260000
*                                       CHANNEL PGM SIZE.               02280000
RDEB     EQU   11                       DEB BASE REG.                   02300000
RB       EQU   12                       WORK REG.                       02320000
RCPBASE  EQU   RB                       CHANNEL PGM BASE REG USED WITH  02340000
*                                       'CPSEGMAP' DUMMY SECTION.       02360000
RC       EQU   13                       WORK REG.                       02380000
RSTEPPER EQU   RC                       POINTS TO THE CURRENT SEARCH    02400000
*                                       ADDRESS OR COUNT FIELD BEING    02420000
*                                       USED FOR CP CONSTRUCTION. WHEN  02440000
*                                       POINTING TO A COUNT FLD THE     02460000
*                                       'COUNTFLD' DUMMY SECTION IS     02480000
*                                       USED BASED ON THIS REG.         02500000
*                                                                       02520000
RE       EQU   0                        WORK REG. VOLATILE ACCROSS SVC. 02540000
RF       EQU   1                        WORK REG. VOLATILE ACCROSS SVC. 02560000
RD       EQU   14                       WORK REG. VOLATILE ACCROSS SVC. 02580000
RWK1     EQU   RD                       WORK REGISTER            Y02072 02590002
RJ       EQU   15                       WORK REG. VOLATILE ACCROSS SVC. 02600000
RA       EQU   RJ                       USED AS WORK REG         S20201 02605020
RVALCHK  EQU   RA                       VALIDITY CHK CP BASEREG, S20201 02610020
*                                       USES 'VCMAP' DSECT.             02615020
*                                                                       02620000
*                                                                       02640000
* MASK CONFIGURATIONS FOR TESTING THE HI ORDER BYTE OF EACH PARAMETER   02660000
* LIST ENTRY. SIGNIFICANCE IS THE SAME AS THE DEB OPEN ATTRIBUTE FIELD. 02680000
*                                                                       02700000
INPUT    EQU   X'0F'                    TEST MASKED BITS FOR ZEROS.     02720000
OUTPUT   EQU   X'0F'                    TEST MASKED BITS FOR ONES.      02740000
INOUT    EQU   X'03'                                                    02760000
OUTIN    EQU   X'07'                                                    02780000
RDBACK   EQU   X'01'                                                    02800000
UPDAT    EQU   X'04'                                                    02820000
LEAVE    EQU   X'10'                                                    02840000
REREAD   EQU   X'30'                                                    02860000
*                                                                       02880000
* COMMAND CODES FOR THE 2841 CONTROL UNIT.                              02900000
*                                                                       02920000
SRCHEQ   EQU   X'31'                    SEARCH EQUAL ID.                02940000
SRCHEQMT EQU   X'B1'                    SEARCH EQUAL ID IN MULTI-TRACK. 02960000
TIC      EQU   X'08'                    TRANSFER IN CHANNEL.            02980000
WCKD     EQU   X'1D'                    WRITE COUNT, KEY, AND DATA.     03000000
WSCKD    EQU   X'01'                    WRITE SPECIAL, COUNT,KEY,DATA.  03020000
SEEKCYL  EQU   X'0B'                    SEEK CYLINDER.                  03040000
READDATA EQU   X'06'                    READ DATA SINGLE TRACK.         03060000
RDDATAMT EQU   86                       MULTI-TRACK READ DATA.          03080000
READKD   EQU   14                       READ KEY AND DATA.              03100000
READCT   EQU   X'92'                    READ COUNT M/T MODE.            03120000
RDSC     EQU   X'22'                    SET THETA CCW COMMAND    S20201 03126020
SETSC    EQU   X'23'                    READ THETA CCW COMMAND   S20201 03132020
*                                                                       03140000
* CHANNEL COMMAND WORD FLAGS.                                           03160000
*                                                                       03180000
SKIP     EQU   X'10'                    SKIP FLAG.                      03200000
SILI     EQU   X'20'                    SUPPRESS INCORRECT LENGTH IND.  03220000
CC       EQU   X'40'                    COMMAND CHAIN.                  03240000
DC       EQU   X'80'                    DATA CHAIN.                     03260000
SILICC   EQU   X'60'                    SILI AND CC TOGETHER            03280000
SILICCSK EQU   X'70'                    SILI, CC, AND SKIP.             03300000
* END CCW FLAGS.                                                        03320000
*                                                                       03340000
* DISPLACEMENTS  AS EQUATES                                             03341020
*                                                                       03342020
D0       EQU   0                        DISPLACEMENT OF ZERO     S20201 03343020
D1       EQU   1                        DISPLACEMENT OF ONE      S20201 03344020
D2       EQU   2                        DISPLACEMENT OF TWO      S20201 03345020
D4       EQU   4                        DISPLACEMENT OF FOUR     S20201 03346020
D6       EQU   6                        DISPLACEMENT OF SIX      S20201 03347020
D8       EQU   8                        DISPLACEMENT OF EIGHT    S20201 03348020
D12      EQU   12                       DISPLACEMENT OF TWELVE   S20201 03349020
D15      EQU   15                       DISPLACEMENT OF FIFTEEN  S20201 03350020
CNTOFF   EQU   7                        CCW COUNT FIELD OFFSET   S20201 03351020
SXTN     EQU   16                       ADDITIONAL CHP LENGTH    S20201 03352020
*                                       FOR                      S20201 03353020
*                                       RECORD READY FEATURE            03354020
*                                                                       03360000
* MISCELLANEOUS ITEMS.                                                  03380000
*                                                                       03400000
COMPNOER EQU   X'7F'                   USED TO INIT. ECB.               03420000
DCANDCC  EQU   X'C0'                    USED TO SET IOBFLAG1.           03440000
IDLENGTH EQU   X'05'                    NMBR OF BYTES IN A 'CCHHR'.     03460000
POINT    EQU   X'04'                    DCBMACRF IF NOTE/POINT USED.    03480000
QSAM     EQU   X'01'                    QSAM BIT IN DCBIND2.            03500000
*                                                                       03520000
NPD2     EQU   5                        NOTE/POINT FOR PCI,UPD,T.O.     03540000
EPDT     EQU   9                        EOB FOR T.O.                    03560000
EGP2     EQU   8                        EOB FOR D.A. INPUT.             03580000
*                                                                       03600000
*                                                                       03620000
VALCHK   EQU   X'80'                    MASK TO DETERMINE IF WRITE      03640000
*                                       VALIDITY CHECK OPTION CALLED.   03660000
IOBSIZE  EQU   48                       LENGTH OF A STANDARD IOB WITH   03680000
*                                       BSAM/QSAM/BPAM EXTENSION.       03700000
IOBDBLWD EQU   6                        NMBR OF DBL WDS IN IOB.         03720000
OFFSW    EQU   24                       OFFSET OF CCW THAT WRITES DATA. 03740000
OFFSR    EQU   32                       OFFSET OF THE READ CCW THAT     03760000
*                                       RECEIVES THE BLOCK LENGTH TO    03780000
*                                       BE READ.                        03800000
CPSEGLEN EQU   32                       LENGTH OF ONE CP SEGMENT.       03820000
NOTZERO  EQU   7                        CONDITION MASK USED AFTER       03840000
*                                       ARITHMETIC INSTRUCTIONS FOR THE 03860000
*                                       NOT-ZERO TEST.                  03880000
BBCCHH   EQU   6                        MIN. SEEK LENGTH.               03900000
*                                                                       03920000
ZERO     EQU   X'00'                    AN IMMEDIATE BYTE OF ZERO'S.    03940000
B1       EQU   1                        BYTE COUNT OF ONE        S20201 03941020
TWO      EQU   2                        CONST OF TWO             S20201 03942020
B5       EQU   5                        BYTE COUNT OF FIVE       S20201 03943020
*                                                                       03944020
NORCDRY  EQU   X'20'                    NO RECORD READY MASK     S20201 03945020
RCDRYSL  EQU   48                       SEG LENGTH WHEN USING    S20201 03946020
*                                       RCD                      S20201 03947020
*                                       READY FEATURE                   03948020
*                                                                       03949020
*                                                                       03950020
*                                                                       03951020
VRCDS    EQU   X'40'                    V TYPE RCD MSK           S20201 03952020
*                                                                       03953020
*                                                                       03954020
EIGHT    EQU   8                        LENGTH OF A COUNT FIELD.        03960000
ANYZERO  EQU   14                       MASK FOR MIXED OR ZEROS.        03980000
FIRST    EQU   X'01'                    USED TO SET IOB FLAG IN FIRST   04000000
*                                       IOB AND INIT. 'R'.              04020000
READCPL  EQU   40                       NMBR OF BYTES IN READ CP.       04040000
RCPDBLWD EQU   5                        NMBR OF DBL WDS IN RCP.         04060000
REMNANT  EQU   READCPL-OFFSR            OFFSR+REMNANT=READCPL.          04080000
OPCODE   EQU   0                        OFFSET OF CCW OPCODE(IN CCW).   04100000
ADDRESS  EQU   0                        OFFSET OF ADDRESS IN CCW        04120000
*                                       (IMPLIES THAT THE ADDRESS MUST  04140000
*                                       BE PUT IN BEFORE THE OP CODE)   04160000
FLAGS    EQU   4                        CCW FLAG BYTE.                  04180000
LENFLD   EQU   6                        START OF LENGTH FLD IN CCW.     04200000
U        EQU   X'C0'                    CODE FOR DCBRECFM=U             04220000
OABD062  EQU   62                                                S21042 04230021
*                                                                       04240000
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY.       04260000
         USING SOP6,RBASE                                               04280000
         USING FORCORE,RCORE            OPEN COMMON WKAREA       S21042 04300021
         USING IHADCB,RDCB              DCB ADDRESSABILITY.             04320000
*                                                                       04340000
*                                                                       04360000
SOP6     EQU   *                                                        04380000
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 04380102
         DC    C'IGG0191H'              MODULE NAME              YM4640 04380202
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 04380303
         DC    C'10/17/74'              LAST SHIP DATE         @Z30TSCF 04380403
BEGIN    DS    0H                       END OF MODULE ID         YM4640 04380502
*                                                                       04400000
         L     RDCB,0(RPARC)            GET DCB ADDRESS FROM PARM. LIST 04420000
         L     RDEB,DCBDEBAD            DEB ADDRESSABILITY.             04440000
         L     RCORE,D4(RWTGC)          GET WORK AREA ADDR       S20201 04450020
         ST    RPAR,DXREGSAV            SAVE REG SO IT CAN BE    Y02072 04460002
*                                         USED AS RBUFADR        Y02072 04470002
         LA    RDCB,0(RDCB)             HOUSEKEEP HI BYTE.              04480000
         SR    RUCB,RUCB                CLEAR REG                S20201 04680020
         IC    RUCB,DCBNCP              GET NO. OF IOBS REQUIRED S20201 04880020
         IF    DCBCIND2,ISNOT=QSAM,GOTO=SOP6L12                  S20201 05080020
         IC    RUCB,DCBBUFNO            IF QSAM USE BUFNO        S20201 05280020
SOP6L12  EQU   *                                                 S20201 05480020
         L     RIOB,DCBIOBA             GET FIRST IOB ADDRESS.          06000000
         MODESET  KEYADDR=DXUKEY,WORKREG=14 GET INTO USER KEY    Y02072 06008002
         USING SAMSIOB,RIOB            IOB ADDRESSABILITY READY.        06020000
         MVI   FLAG,FIRST               FLAG FIRST IOB             DM0I 06030000
*                                                                       06040000
BUILDIOB EQU   *                                                        06060000
*                                                                       06080000
* RIOB POINTS TO START OF AN IOB. USING THIS AS A BASE, GET THE CP      06100000
* START ADDRESS AND THE ADDRESS OF THE COUNT FIELDS AND S.A.'S.         06120000
*                                                                       06140000
*                                                                       06160000
         MVI   ECB,COMPNOER            INIT. ECB FOR QSAM.              06180000
         LA    RF,ECB                   INITIALIZE THE                  06200000
         ST    RF,IOBECBPT              ECB POINTER.                    06220000
*                                                                       06240000
         OI    IOBFLAG1,DCANDCC         INDICATE COMMAND AND DATA CHAIN 06260000
         DROP  RIOB                                              Y02072 06262002
         L     RWK1,DXUDCBAD            GET USERS DCB ADDR       Y02072 06270002
         USING SAMSIOB,RIOB                                      Y02072 06272002
         ST    RWK1,IOBDCBPT-1          INIT DCB PT IN IOB.      Y02072 06280002
         MVC   IOBSEEK(8),DCBFDAD       INIT. ALL IOB FDAD'S. SUPPORTS  06286013
*                                       EVERYBODY INCLUDING 2321.       06292013
         LA    RCPBASE,CHANPGM          GET CHP ADDR             S20201 06296020
         ST    RCPBASE,IOBSTART-D1      PUT IN IOB               S20201 06300020
*                                                                       06304020
* TEST FOR INPUT ONLY                                                   06308020
*                                                                       06312020
         USING DEB,RDEB                 DEB ADDRESSABILITY       S20201 06316020
         IF    DEBOPATB,ISNOT=OUTPUT,GOTO=RCPREQD                       06320000
         DROP  RDEB                                              S20201 06330020
BUILDWCP EQU   *                                                        06340000
         SR    RCPBASE,RCPBASE         NEEDED ON 2ND PASS.              06360000
         IC    RCPBASE,DCBWCPO          NEED OFFSET TO BUILD            06380000
         AR    RCPBASE,RIOB             WRITE CP BASE ADDRESS.          06400000
         USING WCPMAP,RCPBASE                                           06440000
         SR    RSTEPPER,RSTEPPER       NEEDED ON 2ND PASS.              06460000
         IC    RSTEPPER,DCBWCPL         BUILD ADDRESS OF COUNT FIELDS   06480000
         SLL   RSTEPPER,3               APPENDED TO WCP.                06500000
         AR    RSTEPPER,RCPBASE         ADDRESS OF FIRST COUNT FIELD.   06520000
         USING COUNTFLD,RSTEPPER                                        06540000
*                                                                       06560000
*   RIOB = IOB ADDRESS.                                                 06580000
*   RCPBASE = CHANNEL PROGRAM ADDRESS.                                  06600000
*   RSTEPPER = COUNT FIELD AND S.A. ADDRESS.                            06620000
*                                                                       06640000
* IOB INITIALIZED EXCEPT FOR LINK FIELD.                                06660000
*                                                                       06680000
* BUILD WRITE CHANNEL PROGRAMS.  THE CORRECT NUMBER OF CP SEGMENTS IS   06700000
* THAT WHICH CAN BE BUILT UP TO THE FIRST COUNT FIELD APPENDED TO THIS  06720000
* IOB.                                                                  06740000
*                                                                       06760000
*                                                                       06770020
* CHECK FOR RCD READY FEATURE AND SET UP SET THETA COMMAND IF           06780020
* THE FEATURE IS ON ALL THE DATA SETS DEVICES                           06790020
*                                                                       06800020
*                                                                       06805020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06810020
*                                       READY                    S20201 06815020
         BO    NOFET3                   BRANCH IF YES            S20201 06820020
         BAL   RD,SOP6STA               GO BUILD SET SECTOR CCW  S20201 06825020
         AH    RCPBASE,DBLWDLEN         INCR BASE FOR SET SECTOR S20201 06830020
NOFET3   EQU   *                                                 S20201 06835020
CCW1     EQU   *                                                        06840000
         LA    RD,IOBSEEK+3             GET ADDRESS OF CCHHR IN IOB.    06860000
         ST    RD,SRCHADDR              PUT IN FIRST SEARCH COMMAND.    06880000
         MVI   SRCHOPCD,SRCHEQ          SET OP CODE = SEARCH.           06900000
*                                                                       06940000
* BUILD  FIRST  TIC CCW.                                                06960000
*                                                                       06980000
CCW2     EQU   *                                                        07000000
         ST    RCPBASE,TICADDR          STORE ADDRESS OF PREVIOUS SRCH. 07020000
         MVC   SRCHFLAG(B5),FLAGLEN     FLAGS, LEN, TIC OP CODE  S20201 07040020
*                                                                       07060000
*                                                                       07080000
         LR    RVALCHK,RSTEPPER         COPY PTR TO BEGINNING OF COUNTS 07100000
*                                       AND S.A.'S. WILL BE USED FOR    07120000
*                                       VAL CHK CP ADDRESSABILITY (IF   07140000
*                                       NEEDED) AND TO FLAG THE LAST    07160000
*                                       CCW OF THE WRITE SEGMENTS.      07180000
*                                                                       07200000
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=FLAGLAST                      07220000
*                                                                       07240000
* VALIDITY CHECK IS CALLED. BUILD THE VAL CHK CP SEGMENT WHILE ADDR-    07260000
* ESSABILITY IS AVAILABLE. CCW'S TO BE BUILT ARE A SEEK (CCW7), SEARCH  07280000
* (CCW8), TIC (CCW9) AND READ DATA (CCW10).                             07300000
*                                                                       07320000
         SH    RVALCHK,VALCKLEN         BACK UP TO BEGINNING OF VAL CHK 07340000
*                                       CP.                             07360000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 07362020
*                                       READY                    S20201 07364020
         BO    FEAT7                    BRANCH IF YES            S20201 07366020
         SH    RVALCHK,DBLWDLEN         DECREMENT ADDITIONAL CCW S20201 07368020
*                                       SINCE FEATURES WRITE CHK        07370020
*                                       CHP LARGER                      07372020
FEAT7    EQU   *                                                 S20201 07374020
         USING VCMAP,RVALCHK            VAL CHK SEGMENT ADDRESSABILITY. 07380000
*                                                                       07400000
CCW7     EQU   *                        BUILD SEEK COMMAND. SEEK        07420000
*                                       ADDRESS SAME AS CCHH IN FIRST   07440000
*                                       COUNT FIELD.                    07460000
         LA    RD,IOBSEEK+1             POINTS TO IOB SEEK ADDR.        07480000
         ST    RD,SEEKADDR                                              07500000
         MVI   SEEKOPCD,SEEKCYL                                         07520000
         MVI   SEEKFLAG,CC              COMMAND CHAIN.                  07540000
         MVI   SEEKLEN,BBCCHH           LENGTH OF A 'BBCCHH'.           07560000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 07562020
*                                       READY                    S20201 07564020
         BO    NOFET9                   BRANCH IF YES            S20201 07566020
         DROP  RIOB                                              S20201 07568020
         USING FORCORE,RCORE            OPEN COMMON WKAREA       S21042 07570021
         L     RD,DXCCW11               GET SECTOR ADDR          Y02072 07572002
         USING SAMSIOB,RIOB                                      S20201 07574020
         ST    RD,D8(RVALCHK)           PUT IN CCW               S20201 07576020
         OI    D12(RVALCHK),CC          TURN ON COMMAND CHAIN    S20201 07578020
         MVI  D15(RVALCHK),B1           SET BYTE COUNT TO ONE    S20201 07580020
         MVI   D8(RVALCHK),SETSC        PUT IN CCW CMND          S20201 07582020
         AH    RVALCHK,DBLWDLEN         INCREMENT RVALCHK BASE   S20201 07584020
*                                       REG                      S20201 07586020
*                                       TO ELIMINATE SET SECTOR         07588020
*                                       OFFSETS IN DSECT                07590020
NOFET9   EQU   *                                                 S20201 07592020
CCW8     EQU   *                        BUILD SEARCH ID EQUAL WITH SAME 07600000
*                                       CCHH AS THE SEEK.               07620000
         ST    RSTEPPER,VCSRCHAD        ADDRESS OF FIRST COUNT FIELD.   07640000
         MVI   VCSRCHOP,SRCHEQ          OP CODE.                        07660000
*                                                                       07700000
CCW9     EQU   *                        BUILD A TIC BACK TO CCW8.       07720000
         LA    RD,VCSRCH                ADDRESS OF SEARCH.              07740000
         ST    RD,VCTICAD               PUT IN TIC ADDRESS.             07760000
         MVC   VCSRCHFL(B5),FLAGLEN     FLAGS, LEN, TIC OP CODE  S20201 07780020
* TIC COMPLETE. NO FLAGS REQ'D.                                         07800000
*                                                                       07820000
CCW10    EQU   *                        BUILD READ DATA WITH SKIP.      07840000
         MVI   VCRDOP,READKD            TO READ DATA + KEYS (IF ANY).   07860000
         MVI   VCRDFLAG,SKIP            SKIP FLAG.                      07880000
* SKIP ON MAKES ADDRESS IMMATERIAL, LENGTH WILL BE SET AT EOB TIME.     07900000
*                                                                       07920000
* VALIDITY CHECK CP IS BUILT.                                           07940000
*                                                                       07943020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 07946020
*                                       READY                    S20201 07949020
         BO    FEATL17                  BRANCH IF YES            S20201 07952020
         SH    RVALCHK,DBLWDLEN         IF YES RVALCHK WAS INCR  S20201 07955020
*                                       TO WRT CHK PGM PLUS  8  TO      07958020
*                                       ELIMINATE SET SECTOR OFF-       07961020
*                                       SETS AND NOW MUST BE RE-        07964020
*                                       STORED                          07967020
FEATL17  EQU   *                                                 S20201 07970020
         ST    RVALCHK,PARASITE         PUT VAL CHK CP ADDRESS IN       07980000
*                                       R.H. OF CCW2.                   08000000
         MVI   PARASITE,TIC             PUT IN TIC OP CODE, OK BECAUSE  08020000
*                                       BITS 37-39=0.                   08040000
*                                                                       08060000
* PARASITE TIC IN CCW2 WILL BE USED TO TRANSFER-IN-CHANNEL AROUND ANY   08080000
* UNUSED CP SEGMENTS WHEN WRITE CHECK IS CALLED.                        08100000
*                                                                       08120000
         DROP  RVALCHK                  RELINQUISH VC CP ADDRESS.       08140000
*                                                                       08160000
FLAGLAST EQU   *                                                        08180000
*                                                                       08200000
         SH    RVALCHK,DBLWDLEN         THE CCW BEFOR THE VAL CHK CP    08220000
*                                       (OR THE S.A.'S AND COUNT FLDS)  08240000
*                                       IS THE END OF THE WRITE SEGMENT 08260000
*                                       CP'S. POINT TO IT.              08280000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 08282020
*                                       READY                    S20201 08284020
         BO    NOFETFLG                 BRANCH IF YES            S20201 08286020
         ST    RVALCHK,PARASITE         PUT RD SECT ADDR IN      S20201 08288020
*                                       PARASIT                  S20201 08290020
         MVI   PARASITE,TIC             PUT IN TIC CMND          S20201 08292020
         SH    RVALCHK,DBLWDLEN         BACK UP TO NULL OP CD    S20201 08294020
NOFETFLG EQU   *                                                 S20201 08296020
         MVI   0(RVALCHK),WSCKD         FLAG LAST CCW4 OP CODE BYTE     08300000
*                                       WITH A NON-ZERO VALUE.          08320000
*                                                                       08340000
         LA    RF,NULLOPCD              ADDRESS OF CCW WHICH RECEIVES   08360000
         BAL   RE,GETBUFAD              BUFFER ADDRESS.                 08380000
*                                                                       08400000
         MVC   KEYLENTH(1),DCBKEYLE     KEY WILL BE WRITTEN ON FIRST    08420000
*                                       RECORD SEGMENT ONLY.            08440000
*                                                                       08460000
CCW3     EQU   *                        ALL FIRST TIME LOGIC IS DONE.   08480000
*                                       BEGIN HERE WITH A LOOP TO BUILD 08500000
*                                       THE REST OF CP SEG 1 (CCW'S 3   08520000
*                                       AND 4) AND ALL REMAINING SEG-   08540000
*                                       MENTS (MADE UP OF CCW'S 5,6,3,4 08560000
*                                       IN THAT ORDER.)                 08580000
*                                                                       08600000
         ST    RSTEPPER,COUNTADR        FILL IN COUNT FIELD ADDRESS.    08620000
         MVI   COUNTLEN,EIGHT           LENGTH OF A COUNT FIELD.        08640000
         MVI   WRTFLAG,DC               DATA CHAIN TO NEXT CCW.         08660000
*                                                                       08680000
CCW4     EQU   *                        THIS IS THE CCW THAT WRITES THE 08700000
*                                       DATA. NOTHING IS KNOWN AT OPEN  08720000
*                                       TIME EXCEPT THAT IT IS COMMAND  08740000
*                                       CHAINED, AND THE FIRST CCW4     08760000
*                                       WILL HAVE THE BUFFER ADDRESS IF 08780000
*                                       QSAM IS USED                    08800000
*                                       IF IT IS THE LAST CCW4, THE OP  08820000
*                                       CODE BYTE HAS BEEN SET TO NON-  08840000
*                                       ZERO.                           08860000
*                                                                       08880000
         MVI   RECORD,FIRST             INIT. 'R' TO 1.                 08900000
         CLI   NULLOPCD,ZERO            IS THIS THE LAST CP SEGMENT?    08940000
         BNE   THRULOOP                 YES. BRANCH TO DO FINAL LOGIC.  08960000
*                                                                       08980000
* PREPARE TO BUILD NEXT CP SEGMENT. ADVANCE THE CP ADDR REG TO NEXT CP, 09000000
* AND MOVE THE COUNT FIELD AND S.A. POINTER TO NEXT S.A.                09020000
*                                                                       09040000
         LA    RCPBASE,CPSEGLEN(RCPBASE)   POINT TO NEXT SEGMENT.       09060000
         LA    R13,EIGHT(R13)           POINT TO NEXT S.A.         DM0I 09070000
R13      EQU   13                       13                         DM0I 09080000
*                                       THE COUNT FIELD OVERLAY IS NOT  09100000
*                                       VALID UNTIL RSTEPPER IS BUMPED  09120000
*                                       8 MORE.                         09140000
*                                                                       09160000
CCW5     EQU   *                        SEARCH                          09180000
*                                                                       09200000
         ST    RSTEPPER,SRCHADDR        PUT IN POINTER TO SEARCH ADDR.  09220000
*                                                                       09260000
CCW6     EQU   *                        TIC                             09280000
*                                                                       09300000
         ST    RCPBASE,TICADDR          STORE ADDRESS OF CCW5.          09320000
         MVC   SRCHFLAG(B5),FLAGLEN     FLAGS, LEN, AND TIC OP   S20201 09330020
*                                       CODE                     S20201 09340020
*                                                                       09360000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 09365020
*                                       READY                    S20201 09370020
         BNO   FEATAX                   BRANCH IF NO             S20201 09375020
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=PTRUPBY8                      09380000
*                                                                       09400000
* VAL CHK CALLED. NEED A PARASITE SEARCH ADDRESS IN CCW6 (TIC) TO BE    09420000
* USED FOR RECONSTRUCTION OF CCW5 AT EOB TIME.                          09440000
FEATAX   EQU   *                                                 S20201 09450020
*                                                                       09460000
         ST    RSTEPPER,PARASITE        PUT IN SEARCH ADDRESS.          09480000
*                                       SEARCH OP CODE IS IMPLIED, AND  09500000
*                                       FILLED IN AT EOB.               09520000
*                                                                       09540000
PTRUPBY8 EQU   *                                                        09560000
         LA    R13,EIGHT(R13)           POINT TO NEXT COUNT FIELD  DM0I 09580000
*                                       OVERLAY NOW APPLIES.            09600000
*                                                                       09620000
         B     CCW3                     CLOSE THE LOOP FOR BUILDING     09640000
*                                       CCW'S.                          09660000
*                                                                       09680000
THRULOOP EQU   *                        CCW'S ARE BUILT. FINAL LOGIC TO 09700000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 09705020
*                                       READY                    S20201 09710020
         BO    NOFET19                  BRANCH IF YES            S20201 09715020
         BAL   RD,SOP6RTA               GO BUILD READ SECTOR CCW S20201 09720020
NOFET19  EQU   *                                                 S20201 09725020
         USING DEB,RDEB                                          S20201 09730020
*                                                                       09740000
*                                                                       09760000
*                                                                       09780000
         IF    DEBOPATB,IS=OUTPUT,GOTO=NEXTIOB                          09800000
*  MUST DROP RDEB BECAUSE  THE FORECORE DSECT LAYOUT PRODUCES A         09820000
* SMALLER OFFSET WITH RDEB FOR 'CHANPGM'. RIOB IS THE DESIRED REG.      09840000
         DROP  RDEB                                                     09860000
         B     BUILDRCP                 TO BUILD  RECORD READ CHAN.DM0I 09880000
RCPREQD  EQU   *                                                        09900000
         USING RCPOVLAY,RCPBASE                                         09940000
         LA    RSTEPPER,RDCCW           STEPPER+8=NEXT IOB.             09960000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 09963020
*                                       READY                    S20201 09966020
         BO    NOFET25                  BRANCH IF YES            S20201 09969020
         LA    RSTEPPER,SXTN(RSTEPPER)  INCR FOR RCD READY       S20201 09972020
NOFET25  EQU   *                                                 S20201 09975020
BUILDRCP EQU   *                                                        09980000
         LA    RCPBASE,CHANPGM          READ CP CONTIG. TO IOB.         10000000
         USING RCPOVLAY,RCPBASE                                         10020000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICESW/O RCD READY S20201 10046020
         BO    NOTRR2A                  BRANCH IF YES            S20201 10052020
         BAL   RD,SOP6STA               GO BUILD SET SECTOR CCW  S20201 10058020
         AH    RCPBASE,DBLWDLEN         INCR BASE FOR SET SECTOR S20201 10064020
NOTRR2A  EQU   *                                                 S20201 10070020
CCWA     EQU   *                                                        10080000
         LA    RD,IOBSEEK+3             SEARCH ON IOB FDAD.             10100000
         ST    RD,SRCHCCW+ADDRESS       FILL IN SEARCH ADDRESS.         10120000
         MVI   SRCHCCW+OPCODE,SRCHEQ    SEARCH OP CODE .                10140000
         MVC   SRCHCCW+FLAGS(4),FLAGLEN SET COMMAND CHAIN ON, LENGTH=   10160000
*                                       5=L'CCHHR.                      10180000
CCWB     EQU   *                                                        10200000
         LA    RD,SRCHCCW               GET SEARCH CCW ADDR      S20201 10210020
         ST    RD,TICCCW+ADDRESS        PUT IN TIC CCW           S20201 10220020
         MVC   SRCHCCW+FLAGS(B5),FLAGLEN FLAGS,LEN TIC OP CODE   S20201 10230020
CCWC     EQU   *                                                        10260000
         MVI   SKIPCCW+OPCODE,READDATA  CCW TO SKIP OVER PREVIOUS.      10280000
         MVI   SKIPCCW+FLAGS,SKIP+SILI+CC                               10300000
         MVI   SKIPCCW+LENFLD+1,NOTZERO                                 10320000
CCWD     EQU   *                                                        10340000
         IF    DCBCIND2,IS=QSAM,GOTO=TESTBUF                            10360000
         MVI   RKDCCW+OPCODE,READKD     CCWE, USING THE QSAM DECISION.  10380000
         CLI   DCBNCP,ZERO+1                                            10400000
         B     DECIDE                   IF MORE THAN ONE IOB.           10420000
TESTBUF  MVI   RDCCW+OPCODE,READDATA    CCWE, USING THE QSAM DECISION.  10440000
         CLI   DCBBUFNO,ZERO+1                                          10460000
DECIDE   BH    IOBAREQD                 READ INTO NEXT IOB IF THERE     10480000
*                                       IS ONE.                         10500000
         DROP  RIOB                                              YM1086 10502002
         L     RDCB,DXUDCBAD            USERS COPY OF DCB        Y02072 10510002
         LA    RD,DCBFDAD+3             ONLY ONE IOB. READ COUNT INTO   10520000
*                                       DCBFDAD.                        10540000
         L     RDCB,0(RPARC)            PROTECTED COPY OF DCB    Y02072 10550002
         B     STOREIT                                                  10560000
IOBAREQD EQU   *                                                        10580000
         USING SAMSIOB-8,RSTEPPER       STEPPER+8=NEXT IOB.             10620000
         LA    RD,IOBSEEK+3             NEXT IOB SEEK.                  10640000
         DROP  RSTEPPER                                                 10660000
         USING SAMSIOB,RIOB             RESUME ON CURRENT IOB.          10680000
STOREIT  ST    RD,RDCTCCW+ADDRESS                                       10700000
         MVI   RDCTCCW+OPCODE,READCT                                    10720000
         MVI   RDCTCCW+FLAGS,CC+SILI    COMMAND CHAIN AND SILI FLAGS ON 10740000
         MVI   RDCTCCW+LENFLD+1,IDLENGTH                                10760000
CCWE     EQU   *                                                        10780000
* OP CODE ALREADY SET AS REQ'D BY BSAM OR QSAM. MAY BE CHANGED AS       10800000
* REQ'D BY KEY LENGTH, ACCORDING TO WHETHER IT IS OR IS NOT ZERO.       10820000
         CLI   DCBKEYLE,ZERO                                            10840000
         BNE   OPCODEOK                 OP CODE OK                 DM0I 10860000
         MVI   RDCCW+OPCODE,READDATA                                    10880000
OPCODEOK EQU   *                                                        10900000
         TM    DCBRECFM,U                                               10920000
         BC    ANYZERO,NOSILI           BRANCH IF NOT 'U' RECORDS.      10940000
         OI    RDCCW+FLAGS,SILI         NEED SILI BIT FOR 'U' RCDS.     10960000
NOSILI   EQU   *                                                        10980000
         LA    RF,RDCCW                 POINT TO CCW WHICH RECEIVES     11000000
         BAL   RE,GETBUFAD              BUFFER ADDRESS.                 11020000
*                                                                       11021020
* IF RCD READY FEATURE USED BUILD A READ SECTOR COMMAND                 11022020
*                                                                       11023020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 11024020
*                                       READY                    S20201 11025020
         BO    NOFET29                  BRANCH IF YES            S20201 11026020
         TM    DCBRECFM,VRCDS           V TYPE RCDS              S20201 11027020
         BZ    NOSILIX                  BRANCH IF NO             S20201 11028020
         OI    RDCCW+FLAGS,SILI         TURN ON SILI BIT         S20201 11029020
NOSILIX  EQU   *                                                 S20201 11030020
*                                                                       11031020
* MUST DROP RIOB TO USE RCORE                                           11032002
         DROP  RIOB                                              S20201 11033020
         USING FORCORE,RCORE            OPEN COMMON WKAREA       S21042 11036021
         L     RD,DXCCW11               GET THETA ADDR           Y02072 11037002
         ST    RD,RRSADDR               PUT IN CCW               S20201 11038020
         OI    RDCCW+FLAGS,CC           CMND CHAIN PREVIOUS CCW  S20201 11039020
         MVI   RRSCNT,B1                SET BYTE COUNT TO ONE    S20201 11040020
         MVI   RRSCMND,RDSC             PUT IN CCW CMND          S20201 11041020
         DROP  RCORE                                             S20201 11042020
NOFET29  EQU   *                                                 S20201 11043020
         USING SAMSIOB,RIOB                                      S20201 11044020
NEXTIOB  EQU   *                        TEST FOR ANOTHER IOB TO BE      11060000
*                                       BUILT.                          11080000
         BCTR  RUCB,RE                  DECR IOB COUNT           S20201 11090020
         LTR   RUCB,RUCB                HAVE ALL IOBS BEEN BUILT S20201 11100020
*                                       FLAGGED.                        11120000
         BNP   ALLBUILT                 YES BRANCH TO CLOSE IOB  S20201 11150020
*                                      CHAIN AND THEN DO WTG LOGIC.     11180000
* MORE IOB'S TO BE BUILT.                                               11200000
         LA    RD,EIGHT(RSTEPPER)       NEXT IOB STARTS AFTER LAST      11220000
*                                       COUNT FLD OF THE PREVIOUS.      11240000
         O     RD,LINK                  FORWARD CHAIN TO NEXT IOB.      11260000
*                                       OR'ING PRESERVES THE FLAG.      11280000
         ST    RD,LINK                  STORE THE PREPARED LINK FIELD.  11300000
*                                                                       11320000
         LR    RIOB,RD                  NOW HAVE ADDRESSABILITY FOR THE 11340000
*                                       NEXT IOB.                       11360000
*                                                                       11380000
         B     BUILDIOB                 GO BACK AND BUILD IT.           11400000
*                                                                       11420000
ALLBUILT EQU   *                                                        11440000
         MVC   LINK+1(3),DCBIOBA+1      LINK LAST IOB TO THE FIRST.     11460000
         USING DEB,RDEB                                          S20201 11470020
*                                                                       11480000
* TEST FOR OUTPUT ONLY.                                                 11500000
         IF    DEBOPATB,IS=OUTPUT,GOTO=ALLTHRU                          11520000
         DROP  RDEB                                              S20201 11530020
* LINK LAST IOB'S READ COUNT CCW TO FIRST IOB. NOT DONE IF ONLY 1 IOB.  11540000
         L     RA,DCBIOBA               GET FIRST IOB'S ADDRESS.        11560000
         CR    RA,RIOB                  ONLY 1 IOB IF CURRENT = FIRST.  11580000
         BE    ALLTHRU                  BRANCH IF 1 IOB.                11600000
         LA    RA,IOBSEEK-SAMSIOB+3(RA) FIRST IOB'S SEEK ADDRESS.       11620000
         ST    RA,RDCTCCW+ADDRESS                                       11640000
         MVI   RDCTCCW+OPCODE,READCT    OP CODE GOES IN AFTER ADDRESS.  11660000
ALLTHRU  EQU   *                        EVERY THING DONE.               11680000
*                                                                       11700000
*                                                                       11860000
         DROP  RIOB                                                     11880000
*******************  WTG LOGIC GOES HERE. **********************        11900000
*                                                                       11920000
STOPSOP6 EQU   *                                                        11940000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11950002
         SPACE                                                          11960002
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESSABILITY.   11980000
         USING FORCORE,RCORE            OPEN COMMON WKAREA       S21042 12000021
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 12000402
         L     RPAR,DXREGSAV            RELOAD REGISTER          YM2424 12002002
         USING WTGENTRY,RWTGC                                    Y02072 12010002
         MVC   WTGIDTTR,LOADEXEC        NEXT MOD               @Z30TSCF 12012003
         TM    DCBRECFM,X'80'           VARIABLE RECORD FORMAT    22688 12025018
         BO    RELOOP                   NO,BRANCH                 22688 12030018
         MVC   WTGIDTTR,OPENVREC        GO TO 1916             @Z30TSCF 12032003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY.    12060000
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY PTR 12080000
         CLC   0(2,RWTGC),AMIDCNST      IS THIS RTN NEEDED AGAIN?       12100000
         BCR   EGP2,RBASE               RETURN TO OPEN             DM0I 12120000
*                                                                       12140000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE?                   12160000
         BC    7,RELOOP                 NO, CHECK NEXT ENTRY.           12180000
*                                                                       12200000
         LR    RPARC,RPAR                                               12220000
         LA    RWTGC,WAOFF(0,RWTG)      REINIT. WTG LIST PTR.           12240000
ZCHEK    CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETE?         12260000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL.        12280000
*                                                                       12300000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY.                 12320000
         LA    RPARC,PLOFF(0,RPARC)                                     12340000
         B     ZCHEK                    ZERO CHECK                 DM0I 12360000
*                                                                       12380000
TCTLRTN  EQU   *                                                        12400000
         USING WTG,RWTG                                                 12450003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*12500003
               MODID=WTGENTRY                                  @Z30TSCF 12510003
         DROP  RWTGC,RWTG                                      @Z30TSCF 12520003
*                                                                       12544020
* END WTG LOGIC                                                         12548020
*                                                                       12552020
* SET SECTOR BUILD RTN                                                  12556020
*                                                                       12560020
SOP6STA  EQU   *                                                 S20201 12564020
*                                                                       12568020
         L     RE,DXCCW11               GET THETA ADDR           S20201 12572020
         ST    RE,D0(RCPBASE)           PUT IN CCW               S20201 12576020
         OI    FLAGS(RCPBASE),CC        TURN ON CMND CHAIN       S20201 12580020
         MVI   CNTOFF(RCPBASE),B1       SET BYTE COUNT TO ONE    S20201 12584020
         MVI   D0(RCPBASE),SETSC        PUT IN SET SECT CMND     S20201 12588020
         BR    RD                       RETURN                   S20201 12592020
*                                                                       12594020
* READ SECTOR BUILD ROUTINE                                             12596020
*                                                                       12598020
         USING WCPMAP,RCPBASE                                    S20201 12600020
SOP6RTA  EQU   *                                                 S20201 12602020
         L     RE,DXCCW11               GET THETA ADDR           Y02072 12604002
         ST    RE,WRSADDR               PUT IN CCW               S20201 12606020
*                                                                       12608020
         OI    NULLFLAG,CC              TURN ON PREVIOUS CCW     S20201 12610020
*                                       CMND                     S20201 12612020
*                                       CHAIN                           12614020
         MVI   WRSCNT,B1                SET BYTE COUNT TO ONE    S20201 12616020
         MVI   WRSCMND,RDSC             PUT IN CCW CMND          S20201 12618020
         BR    RD                       RETURN                   S20201 12620020
         DROP  RCPBASE                                           S20201 12622020
*                                                                       12624020
GETBUFAD EQU   *                                                 S20201 12626020
         IF    DCBCIND2,ISNOT=QSAM,GOTO=RETURN                          12640000
         L     RWK1,DCBBUFCB            ADDR OF BUF CNTRL BLK    YM7595 12690002
         USING BCBLK,RWK1                                               12692002
         L     RBUFADR,BCBBUFPT         ADDR NEXT AVAIL BUFFER   YM7595 12694002
         LTR   RBUFADR,RBUFADR          IS THERE AN ADDR         Y02072 12700002
         BC    NOTZERO,AVAIL            BRANCH IF BUFF AD NOT 0.        12740000
         L     RPAR,DXREGSAV            RELOAD REG FOR PROB DET  YM2424 12740402
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12742002
         SPACE                                                          12752002
         DMABCOND OABD062,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X12760021
                                        013 ABEND                       12780021
         B     TCTLRTN                  GO XCTL                  S21042 12800021
AVAIL    EQU   *                                                        12810402
         USING BUFFER,RBUFADR                                           12810802
         MVC   BCBBUFAD,BUFNXPTB        UPDATE WITH NEXT AVAIL   YM7595 12811202
*                                         BUFFER                 YM7595 12811602
         USING CCW,RF                                            Y02072 12811702
         STCM  RBUFADR,B'0111',CCWADDRB  BUFER ADDR TO CCW       Y02072 12812002
         MVC   CCWBYTE,DCBBLKSI         INIT CCW LENGTH                 12860002
         DROP  RF,RWK1,RBUFADR                                          12870002
RETURN   LR    RF,RE                                                    12880000
         BR    RF                       EXIT                       DM0I 12900000
*                                                                       12920000
TWOCON   DC    H'2'                     CONSTANT OF TWO          S20201 12940020
DBLWDLEN DC    H'8'                     LENGTH OF A DOUBLE WORD.        12960000
VALCKLEN DC    H'32'                    VALIDITY CHK CP LENGTH.         12980000
FLAGLEN  DC    X'40'                    COMMAND CHAIN FLAG.             13000000
         DC    X'00'                    SPACER                          13020000
         DC    H'5'                     LENGTH OF A 'CCHHR'.            13040000
         DC    X'08'                    TIC OP CODE              S20201 13050020
*                                                                       13060000
*                                                                       13080000
* WTG CONSTANTS AND EQUATES.                                            13100000
*                                                                       13120000
WAOFF    EQU   32                                                       13140000
PLOFF    EQU   4                                                        13160000
WGOFF    EQU   8                                                        13180000
OPIDCNST DC    C'0S'                    ID                         DM0I 13200000
AMIDCNST DC    C'1H'                    ID                         DM0I 13220000
LOADEXEC DC    C'13',VL3(IGG01913)      NEXT EXEC              @Z30TSCF 13230003
OPENVREC DC    C'16',VL3(IGG01916)      NEXT EXEC              @Z30TSCF 13232003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETERMINATION     @Z30TSCF 13234003
*                                                                       13240000
* END WTG CONSTANTS.                                                    13260000
*                                                                       13280000
PATCH    DC    25H'0'                   PATCH AREA               YM4640 13330002
END      EQU   *                        END OF MODULE            Y02072 13390002
         EJECT                                                          13390403
CVT      DSECT                                                 @Z30TSCF 13390803
         CVT                                                   @Z30TSCF 13391203
         EJECT                                                          13392002
         IGGBCB  TYPE=SAM                                               13394002
         EJECT                                                          13400002
         IHACCW  DSECT=YES                                       Y02072 13410002
         EJECT                                                          13412002
*                                                                       13420000
* READ CHANNEL PROGRAM OVERLAY.  CCW FIELDS ARE ACCESSED BY ABSOLUTE    13440000
* OFFSETS FROM THE CCW NAME.                                            13460000
*                                                                       13480020
RCPOVLAY DSECT                                                          13500020
SRCHCCW  DS    D                        SEARCH CCW                 DM0I 13540000
*        TIC    (CCWB)                                                  13560000
TICCCW   DS    D                        TIC                        DM0I 13580000
*        READ DATA WITH SKIP  (CCWC)                                    13600000
SKIPCCW  DS    D                        SKIP CCW                   DM0I 13620000
*        READ COUNT (CCWD)                                              13640000
RDCTCCW  DS    D                        READCCW                    DM0I 13660000
*        READ DATA (CCWE)                                               13680000
RDCCW    DS    D                        READ CCW                   DM0I 13700000
*        READ KEY AND DATA (ALTERNATE CCWE)                             13720000
RKDCCW   EQU   RDCCW                                                    13740000
*                                                                       13741020
* READ SECTOR COMMAND, USED ONLY WITH RECORD READY FEATURE              13742020
*                                                                       13743020
RRSCMND  DS    F                        READ SECTOR COMMAND      S20201 13744020
RRSADDR  EQU   RRSCMND                  SECTOR ADDR              S20201 13745020
RRSFLAG  DS    XL1                      FLAG FIELD               S20201 13746020
         DS    CL2                      FILLER                   S20201 13747020
RRSCNT   DS    XL1                      BYTE COUNT ONLY ONE BYTE S20201 13748020
RCCHHR   DS    D                        ADDR OF READ CNT WHEN    S20201 13749020
*                                       USING                    S20201 13750020
*                                       RECORD READY FEATURE            13751020
*                                                                       13752020
* END READ CP CCW DEFINITION                                            13760000
* FOLLOWING IS A MAP OF A WRITE CHANNEL PROGRAM (WCP) SEGMENT.          13780000
*                                                                       13800020
WCPMAP   DSECT                                                          13820020
*                                                                       13840020
*        SEARCH  (CCW1 OR 5)                                            13860000
*                                                                       13880000
SRCHADDR DS    F                        SEARCH                     DM0I 13900000
SRCHOPCD EQU   SRCHADDR                 OP CODE IS HI ORDER BYTE.       13920000
SRCHFLAG DS    XL1                      SEARCH FLAG                DM0I 13940000
         DS    CL2                      FLAG                       DM0I 13960000
SRCHLEN  DS    XL1                      LENGTHS NORMALLY FIT IN 1 BYTE. 13980000
*                                                                       14000000
*        TIC   (CCW2 OR 6)                                              14020000
*                                                                       14040000
TICADDR  DS    F                        TIC                        DM0I 14060000
TICOPCD  EQU   TICADDR                  TIC  OP                    DM0I 14080000
UNUSED   DS    F                        ONLY REQUIRES BITS 37-39 = 0.   14100000
PARASITE EQU   UNUSED                   MAY BE USED TO STORE AN ADDRESS 14120000
*                                       BUT THE ABOVE RESTRICTION       14140000
*                                       LIMITS THE OP CODES THAT MAY    14160000
*                                       BE STORED IN THE HI BYTE.       14180000
*                                                                       14200000
*        WRITE  (CCW3)                                                  14220000
*                                                                       14240000
COUNTADR DS    F                        COUNT FIELD ADDRESS.            14260000
WRTOPCD  EQU   COUNTADR                                                 14280000
WRTFLAG  DS    XL1                      FLAG FIELD.                     14300000
         DS    CL2                      SPACER.                         14320000
COUNTLEN DS    XL1                      COUNT FIELD LENGTH (NORMALLY 8) 14340000
*                                                                       14360000
*        NULL OP CODE  (CCW4)           OP PROPAGATED FROM WRITE CCW.   14380000
*                                                                       14400000
DATAADDR DS    F                        ADDRESS OF BLOCK OF DATA TO BE  14420000
*                                       WRITTEN.                        14440000
NULLOPCD EQU   DATAADDR                 USED AS A FLAG TO SIGNAL LAST   14460000
*                                       SEGMENT.                        14480000
NULLFLAG DS    XL1                      NULL FLAG                  DM0I 14500000
         DS    XL1                      SPACER.                         14520000
DATALEN  DS    H                        2 BYTES HOLDS DATA LENGTH.      14540000
*                                                                       14544020
* READ SECTOR COMMAND USED ONLY WITH RECORD READY FEATURE               14548020
*                                                                       14552020
WRSCMND  DS    F                        READ SECTOR COMMAND      S20201 14556020
WRSADDR  EQU   WRSCMND                  SECTOR ADDR              S20201 14560020
WRSFLAG  DS    XL1                      FLAG FIELD               S20201 14564020
         DS    CL2                      FILLER                   S20201 14568020
WRSCNT   DS    XL1                      BYTE COUNT FIELD         S20201 14572020
*                                                                       14576020
*                                                                       14580020
*                                                                       14584020
*                                                                       14588020
* FOLLOWING IS THE VALIDITY CHECK CHANNEL PROGRAM OVERLAY.              14600000
*                                                                       14620000
VCMAP    DSECT                                                          14640000
*        SEEK  (CCW7)                                                   14660000
SEEKADDR DS    F                        SEEK ADDRESS               DM0I 14680000
SEEKOPCD EQU   SEEKADDR                                                 14700000
SEEKFLAG DS    XL1                      FLAG                       DM0I 14720000
         DS    CL2                      COUNT                      DM0I 14740000
SEEKLEN  DS    XL1                      SEEK LENGTH                DM0I 14760000
*                                                                       14780000
*        SEARCH (CCW8)                  LABELS PREFIXED BY 'VC' (VAL    14800000
VCSRCH   EQU   *                        CHECK).                         14820000
VCSRCHAD DS    F                        SEARCH ADDRESS             DM0I 14840000
VCSRCHOP EQU   VCSRCHAD                 SEARCH OP                  DM0I 14860000
VCSRCHFL DS    XL1                      FLAGS.                          14880000
         DS    CL2                      COUNT                      DM0I 14900000
VCSRCHLE DS    XL1                      LENGTH.                         14920000
*                                                                       14940000
*        TIC   (CCW9)                                                   14960000
VCTICAD  DS    F                        TIC                        DM0I 14980000
VCTICOP  EQU   VCTICAD                  TIC ADDRESS                DM0I 15000000
NOTUSED  DS    F                        NOT USED                   DM0I 15020000
*                                                                       15040000
*        READ DATA (CCW10)                                              15060000
VCRDAD   DS    F                        RECORD ADDRESS             DM0I 15080000
VCRDOP   EQU   VCRDAD                   RECORD ADDR.               DM0I 15100000
VCRDFLAG DS    XL1                      NORMALLY SKIP.                  15120000
VCRDLEN  DS    FL3                      RECORD LENGTH              DM0I 15140000
*                                                                       15160000
* FOLLOWING IS AN OVERLAY OF THE COUNT FIELD.                           15180000
*                                                                       15200000
COUNTFLD DSECT                                                          15220000
*                                                                       15240000
CYLINDER DS    H                        CYLINDER ADDRESS (CC).          15260000
HEAD     DS    H                        HEAD ADDRESS     (HH).          15280000
RECORD   DS    XL1                      RECORD NUMBER    (R).           15300000
KEYLENTH DS    XL1                      KEY LENGTH       (KL).          15320000
DLDL     DS    H                        DATA LENGTH      (DLDL).        15340000
*                                                                       15360000
* END COUNT FIELD. (CCHHRKDD)                                           15380000
*                                                                       15400000
*                                                                       15420000
* DIRECT ACCESS DEVICE TABLE OVERLAY                                    15440000
*                                                                       15460000
DEVTAB   DSECT                                                          15480000
DEVSIZE  DS    F                       MAX SIZ FOR DEVICE.              15500000
TRKCAP   DS    H                       TRACK CAPACITY.                  15520000
OVERI    DS    XL1                     OVERHEAD FOR NOT-LAST RECORD.    15540000
OVERL    DS    XL1                     OVERHEAD FOR LAST RECORD.        15560000
OVERK    DS    XL1                     OVERHEAD REDUCTION FOR NON-KEY   15580000
*                                      RECORDS.                         15600000
DEVFLAG  DS    XL1                      DEVICE FLAG                DM0I 15620000
TOLER    DS    H                       TOLERANCE/512 USED FOR VARIABLE  15640000
*                                       GAP LENGTH CALCULATIONS.        15660000
* END DEVTAB OVERLAY.                                                   15680000
*                                                                       15700000
*                                                                       15720000
         IECDSECS MAIN,DCB,WTG,PREFX,EXPAND=YES                @Z30TSCF 15800003
         ORG   WTGIDTTR                                          Y02072 15850002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 15860002
*                                                                       15880000
* IOB OVERLAY                                                           15900000
* THE FORECORE DSECT IOB OVERLAY IS USED WITH THE FOLOWING ADDITIONS-   15920000
*                                                                       15940000
* BSAM/BPAM/QSAM IOB EXTENSION-                                         15960000
SAMSIOB  EQU   DXIOB-8                  START OF SAM'S IOB.             15980000
LINK     EQU   SAMSIOB                  FORWARD CHAIN FIELD (TO NEXT    16000000
*                                       IOB).                           16020000
FLAG     EQU   LINK                     HI BYTE OF LINK USED AS FLAG.   16040000
ECB      EQU   DXIOB-4                  ECB                        DM0I 16060000
* END EXTENSION DEFINITIONS                                             16080000
*                                                                       16100000
IOBSEEK  EQU   DXDAADDR                 SEEK ADDRESS               DM0I 16120000
CHANPGM  EQU   DXDAADDR+8               START OF CHANNEL PROGRAM.       16140000
*                                       LENGTH MAY VARY.                16160000
* END IOB DEFINITIONS.                                                  16180000
*                                                                       16200000
DEB      EQU   DXDEB                                                    16220000
DEBOPATB EQU   DXDEBSYS                 DEB ADDRESS                DM0I 16240000
         EJECT                                                          16250002
FORCORE  DSECT                                                          16250402
         IHAFCAUD ORG=YES                                               16252002
         END                                                            16260000
./  ADD  SSI=62740045,NAME=IGG0191I
         TITLE ' IGG0191I    BUFFER CONSTRUCTION      '                 00020000
IGG0191I CSECT                                                          00024000
*MODULE NAME - IGG0191I                                          Y02072 00026002
*                                                                       00028002
*DESCRIPTIVE NAME - BUFFER BUILDER                               Y02072 00030002
*                                                                       00032002
*COPYRIGHT - NONE                                                Y02072 00032402
*                                                                       00032802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00033202
*                                                                       00034002
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00044002
*000221,000805,032900,033100-033200,037179,037201-037348,043692, Y02072 00046002
*043788,044400,049360,000480-000517,009600,043620-043632,        Y02072 00046402
*043656-043788,049397,079200,52200,75000,75870,75900,77000-77200 Y02072 00048402
*          VS2 RELEASE 3 DELETIONS                                      00050402
*C037441,037474,037507                                          ZA01275 00050802
*A036908,036912                                                 ZA01373 00051202
*                                                              @Z30TSCF 00051303
*           VS2 RELEASE 4 DELETIONS                                     00051737
*C036400,032360,032380                                         @XA01495 00051837
*A037626-037630,037940-037956                                  @XA01495 00051937
*         RELEASE 20 DELETIONS                                       *  00052002
*0281001400-001600,003000-003100,051400-067200,071200-072800,    S20201 00052320
*0281078600-080720,098600                                        S20201 00052620
*0281036400,038800,039500-040140                                 A30808 00053020
*0281014600,037000,082800-086800                                 S20016 00054020
*0281036845-036854                                               M0017  00055020
*0281063600                                                      A30962 00055520
*0281034800-035400,036809-037151,081260,081290,081320,081350     M3415  00055720
*                                                                 M5005 00055820
*                                                                 M4843 00055920
*          RELEASE 21 DELETIONS                                       * 00056000
*0892                                                            A48163 00056421
*A                                                              SA52300 00060821
*                                                               SA56446 00061221
*0892003400,074600-075000,075850,075880,078300-081200,082000-    S21042 00064901
*0892082200                                                      S21042 00068801
*D000280-000460,000600,050600-051000,067400-067600               XM6327 00070801
*D036804-036860,037355                                           YM3034 00072800
*                                                               SA67354 00074802
*C442380                                                       @ZA12970 00075737
*                                                                       00076601
*STATUS CHANGE LEVEL 010                                        ZA01373 00080502
*                                                                       00084401
*FUNCTION/OPERATION- THIS ROUTINE SUPPLEMENTS THE INITIAL OPEN ROUTINE. 00088301
*      IT PERFORMS GENERAL AND SPECIFIC FUNCTIONS FOR THE SEQUENTIAL    00092201
*      ACCESS METHOD                                                    00096101
*      IT DETERMINES THE NUMBER OF BUFFERS NEEDED AND ISSUES A'GETMAIN' 00100000
*      FOR THE CORRECT AREA AND STORES THE ADDRESS IN THE DCB.          00120000
*                                                                       00180000
*      IF A RECORD AREA IS NEEDED FOR LOGICAL RECORD PROCESSING         00190021
*      OF VARIABLE LENGTH SPANNED RECORDS, IT DETERMINES THE SIZE       00192021
*      AND ISSUES A GETMAIN FOR THE RECORD AREA.  IT PUTS THE ADDRESS   00194021
*      OF THE RECORD AREA IN THE BUFFER CONTROL BLOCK AND SETS FLAGS    00196021
*      TO INDICATE THE PRESENCE OF A RECORD AREA.                       00198021
*                                                                       00198402
*      IT ALSO SETS AUDIT TRAIL BITS IN THE OPEN WORKAREA AFTER  Y02072 00198802
*      ACQUIRING RESOURCES IN CASE OF A FORCE CLOSE SITUATION.   Y02072 00199202
*                                                                       00199602
*ENTRY POINT- IGG0191I ENTERED FROM IGG0191A BY XCTL                    00200000
*                                                                       00220000
*INPUT: SEE DESCRIPTION OF REGISTERS.                                   00240000
*OUTPUT: SEE DESCRIPTION OF REGISTERS.                                  00260000
*EXTERNAL ROUTINES: NONE.                                               00280000
*EXIT NORMAL  XCTL TO IGG0193I                                          00300020
*                                                                       00320000
*EXITS-ERROR CALL PROB DET (IGG0196M) FOR WTP AND 013 ABEND             00340021
*                                                                       00350002
*MACROS - ACTION : MODESET, XCTL, GETMAIN, DMABCOND, XCTLTABL    Y02072 00352002
*                                                                       00354002
*MACROS - MAPPING : IKJTSB, IHAASCB, IEZJSCB, IKJTCB, DCBD,      Y02072 00356002
*                   IECDSECS, CVT, IEFUCBOB, IGGBCB, IGGPARML    Y02072 00358002
*                                                                       00360000
*TABLES/WORKAREAS: WHERE TO GO TABLE(WTG)                               00380000
*      BYTE  0-7  NAME                                                  00400000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00420000
*      BYTE 11    CONCATENATION NUMBER                                  00440000
*      BYTE 12    ZERO                                                  00460000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00480000
*                        ALIAS INDICATOR 1 BIT                          00500000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00520000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00540000
*      BYTE 17    ZERO                                                  00560000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00580000
*      BYTE 20    TRANSLATION TABLE                                     00600000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00620000
*      BYTE 22-23 ATTRIBUTES                                            00640000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00660000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00680000
*      BYTE 29    LENGTH OF WTG TABLE(IN DOUBLE WORDS)                  00700000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00720000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00740000
*      BYTE 35    ADDRESS OF STORAGE FOR DCB                            00760000
*      BYTE 36-39 TABLE OF IDTTR'S                                      00780000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB (3 BYTES)           00800000
*                   ADDRESS OF STORAGE FOR DCB      (1 BYTE )           00820000
*                   IDTTR OF LAST ROUTINE LOAD      (3 BYTES)           00840000
*                   NOT USED                        (1 BYTE )           00860000
*                                                                       00880000
*      WORKAREA- SEE 'FORCORE DSECT' (IECDSECT) IN THIS LISTING         00900000
*                                                                       00920000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATAMANAGEMENT KEY     Y02072 00940002
*            UNLESS OTHERWISE SPECIFIED, SUPER STATE             Y02072 00950002
*                                                                       00952002
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01060000
*                                                                       01080000
*********************************************************************** 01100000
*                                                                       01120000
*                                                                       01140000
RE       EQU   0                       WORK/PARAMETER REGISTER          01160000
RWK1     EQU   RE                       WORK REGISTER            Y02072 01170002
RF       EQU   1                       WORK/PARAMETER REGISTER          01180000
RWK2     EQU   RF                       WORK REGISTER            Y02072 01190002
RDCB     EQU   2                       ADDR OF USERS DCB                01200000
RBASE    EQU   3                       BASE REGISTER                    01220000
RCORE    EQU   4                       ADDR OF OPEN WORK AREA           01240000
RPAR     EQU   5                       PARAMETER LIST                   01260000
RWTG     EQU   6                       START OF WTG                     01280000
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  01300000
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       01320000
RTIOT    EQU   9                       TIOT ADDR/WORK REGISTER          01340000
RWK3     EQU   RTIOT                    WORK REGISTER            Y02072 01350002
RUCB     EQU   10                      UCB ADDR/WORK REGISTER           01360000
RDEB     EQU   11                      DEB ADDRESS                      01380000
RA       EQU   11                                                       01400000
RB       EQU   12                      WORK REGISTER                    01420000
RC       EQU   13                      WORK REGISTER                    01440000
RD       EQU   14                       TCB ADDR/WORK/PARAMETER  S20016 01450020
*                                       REG                      S20016 01460020
RJ       EQU   15                      WORK/PARAMETER REGISTER          01480000
RWK4     EQU   RJ                       WORK REGISTER            Y02072 01490002
* MASK'S TO TEST PARAMETER LIST WITH                                    01500000
*                                                                       01520000
OUTP       EQU   X'0F'                                                  01540000
*                                                                       01560000
*********************************************************************   01580000
*                                                                       01600000
*                                                                       01620000
* OFFSET FOR PARAMETER TESTS                                            01640000
*                                                                       01660000
DISPSN     EQU   X'0'                                                   01680000
*                                                                       01700000
*                                                                       01720000
*********************************************************************   01740000
*                                                                       01760000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              01780000
*                                                                       01800000
*                                                                       01820000
*                                                                       01840000
DOUBLE     EQU   X'01'                  ALIGNMENT BIT                   01860021
*                                                                       01880000
C2       EQU   2                        GENERAL CONSTANT 2       S20201 01886020
C6       EQU   6                        GENERAL CONSTANT 6       S20201 01892020
C3       EQU   3                        GENERAL CONSTANT 3       S21042 01894021
ZERO     EQU   0                        GENERAL CONSTANT 0       S21042 01896021
*                                                                       01900000
STOWB      EQU   X'80'                                                  01920000
OVRFLO     EQU   X'20'                                                  01940000
PCI        EQU   X'20'                                                  01960000
CONCAT     EQU   X'FF'                                                  01980000
*                                                                       02000000
QSAMODE  EQU   X'01'                    DENOTES QSAM IN DCBCIND2 M0017  02010020
BLKFLG   EQU   X'04'                    USED TO TELL CLOSE BLKD SA52300 02012021
*                                       BIT TURNED OFF          SA52300 02014021
*********************************************************************   02020000
*                                                                       02040000
* MASKS FOR ACCESS METHODS IN SAM                                       02060000
*                                                                       02080000
PAM        EQU   X'02'                                                  02100000
PSAM       EQU   X'42'                                                  02120000
QSAMB      EQU   X'01'                                                  02140000
*                                                                       02160000
*                                                                       02180000
* MASKS FOR MACRO'S TO BE USED                                          02200000
*                                                                       02220000
GETB       EQU   X'40'                                                  02240000
PUTB       EQU   X'40'                                                  02260000
READB      EQU   X'20'                                                  02280000
WRITEB     EQU   X'20'                                                  02300000
POINTB     EQU   X'04'                                                  02320000
CNTRLB     EQU   X'02'                                                  02340000
*                                                                       02360000
*                                                                       02380000
*********************************************************************   02400000
*                                                                       02420000
* MASKS FOR DEVICES TO BE SUPPORTED                                     02440000
*                                                                       02460000
DABIT    EQU   X'20'                                                    02480000
URBIT    EQU   X'40'                                                    02500000
TAPEB    EQU   X'80'                                                    02520000
TERM     EQU   X'4F'                    DCBDEVT FOR TS TASK      S20016 02521020
D1285    EQU   X'5A'               TEST DCBDEVT FOR 1285         S19017 02523019
*                                  DCBDEVT FOR 1287 IS X'5B'     S19017 02526019
D1288    EQU   X'5C'               TEST DCBDEVT FOR 1288         S19017 02529019
D1419    EQU   X'5D'                   DCBDEVT CODE FOR 1419     S19033 02532019
D1275    EQU   X'5F'                    DCBDEVT CODE FOR 1275    S19033 02535019
*                                                                       02540000
*                                                                       02560000
* MASKS FOR BUFFER TECHNIQUE'S                                          02580000
*                                                                       02600000
EXCHANGB   EQU   X'10'                                                  02620000
*                                                                       02670002
* MODES OF OPERATION FOR QSAM                                           02720000
*                                                                       02740000
LOCATEB    EQU   X'08'                                                  02760000
MOVEB      EQU   X'10'                                                  02780000
*                                                                       02800000
* MASKS USED FOR NEW BUFFER CONTROL BLOCK WHICH HAS A RECORD AREA       02800919
* ADDRESS                                                               02801819
* THE RECORD AREA IS PROVIDED IN SUPPORT OF QSAM LOCATE MODE OF         02802719
* OPERATION WITH LOGICAL RECORD INTERFACE FOR VARIABLE LENGTH           02803619
* SPANNED RECORDS                                                       02804519
*                                                                       02805419
LRECIND  EQU   X'60'                    LOGICAL REC INTERFACE   SA56446 02806321
FORMATVS EQU   X'48'                    VARIABLE LENGTH SPANNED  S19015 02807219
*                                           RECORD                      02808119
CTLINFO  EQU   32                       LENGTH OF CONTROL INFO   S19015 02809019
*                                            IN RECORD AREA             02809919
ADDRLEN  EQU   4                        LENGTH OF RECORD AREA    S19015 02810819
*                                       ADDR                     S19015 02811719
ADLEN    EQU   3                        LENGTH OF ADDR           S19015 02812619
FLGOFFST EQU   4                        OFFSET TO FLAG BYTE IN   S19015 02813519
*                                       BCB                      S19015 02814419
RAFLAG   EQU   X'80'                    RECORD AREA PRESENT      S19015 02815319
EXTND    EQU   X'40'                    BIT ON INCICATES BUFFER  A48163 02815721
*                                       CONTROL BLOCK HAS LENGTH        02816121
*                                       OF 16 BYTES                     02818021
ONE      EQU   1                        CONSTANT ONE             S19015 02820521
WDLEN    EQU   4                        FULLWORD LENGTH          S19015 02822421
DWDLEN   EQU   8                        LENGTH OF DOUBLEWORD     A48163 02822800
RAADOFST EQU   8                        RECORD AREA ADDR OFFSET  S19015 02824321
NOT      EQU   X'FF'                    MASK TO TURN OFF BITS    S19015 02826221
*                                                                       02828121
OABD061  EQU   61                                                S21042 02830021
IDTTR     EQU   5                       ID, TTR OF MOD FOR WTGT  XM6327 02830101
         EJECT                                                          02976002
         BALR  RBASE,0                                                  02980000
         USING START,RBASE                                              03000000
         USING IHADCB,RDCB                                              03020000
         USING FORCORE,RCORE                                            03040000
         USING DEB,RDEB                                                 03060000
         USING   TCB,RD                                                 03080000
         USING CVT,RTIOT                                                03100000
         USING UCBOB,RUCB                                               03120000
         USING WTGT,RWTG                                         Y02072 03130002
START    EQU   *                                                        03220000
*                                                                       03230002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 03232002
         DC    C'IGG0191I'              MOD NAME                 Y02072 03234002
         DC    C'@ZA01495'              LAST SHIP CODE         @ZA01495 03236037
         DC    C'04/30/75'              LAST DATE MODIFIED     @ZA01495 03238037
BEGIN    DS    0H                                               Y02072  03238402
*                                                                       03240000
         USING PARML,RPARC                                              03250002
         L     RDCB,PARDCBAD            GET DCB ADDRESS                 03260002
         L     RCORE,4(RWTGC)           GET WORK AREA                   03280000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 03300000
*                                                                       03340000
*        THIS SECTION DETERMINES IF A BUFFER POOL                       03360000
*        MUST BE ACQUIRED BY OPEN < < < < < < < < < < < < <             03380000
*                                                                       03400000
         TM    DCBBUFCB+ADLEN,ONE       BUFCB SPECIFIED          S19015 03402019
         BNO   GETRALEN                 BRANCH TO GET RECORD     A48163 03412000
*                                       AREA ONLY                       03412421
A0015    EQU   *                                                 S19015 03416019
*                                                                       03418019
         SR    RB,RB                   CLEAR REG                        03420000
*                                                                       03440000
         IC    RB,DCBBUFNO              GET BUFFER NUMBER               03460000
*                                                                       03560000
A0010    EQU   *                                                        03580000
         LH    RC,DCBBUFL               GET BUFFER LENGTH EXPECTED      03590021
         LTR   RC,RC                    SPECIFIED                       03620000
         BNZ   A0011                    YES--USE IT            @ZA01495 03640037
*                                                                       03660000
         AH    RC,DCBBLKSI              USE BLOCK SIZE IF THERE         03680000
         BZ   TSOCHK                    BRANCH IF NO BLOCKSIZE   XM5359 03687121
         TM   DCBCIND2,QSAMB            IS IT QSAM               XM5359 03688221
         BO   A0011                     YES,BRANCH              SA52300 03689321
*                                                                       03690421
         TM   DCBDEVT,DCBDSGDA          DIRECT ACCESS DEVICE    ZA01373 03690802
         BNO  A0012                     BRANCH NOT DA DEVICE    ZA01373 03691202
         SR   RD,RD                                                     03691521
         IC   RD,DCBKEYLE               GET KEY LENGTH           XM5359 03692621
         AR   RC,RD                     BUFL EQ KEYLENGTH,BLKSI  XM5359 03693721
         B    A0012                     CONTINUE                 XM5359 03694821
*                                                                       03695921
TSOCHK   EQU  *                                                         03697021
         CLI   DCBDEVT,TERM             CHECK FOR TSO                   03698121
         BNE   DCBERROR                 BRANCH IF NOT                   03699221
*  TSO MODIFICATION - WHEN BLKSI IS NOT SPECIFIED, FOR QSAM, LRECL      03700321
*  IS ASSUMED IF THERE, OTHERWISE, USER'S TERMINAL LINE SIZE IS         03701421
*  ASSUMED, FOR BSAM USER'S TERMINAL LINE SIZE IS ASSUMED.              03702521
*                                                                       03703621
*                                                                       03704721
         TM    DCBCIND2,QSAMODE         TEST IF BSAM OR QSAM            03705821
         BNO   USELNSZ                  BRANCH IF BSAM                  03706921
         AH    RC,DCBLRECL              USE LRECL IF THERE              03708021
         BNZ   A0012                    BRANCH IF LRECL THERE           03709121
USELNSZ  EQU   *                                                        03710221
         USING PSA,0                                             Y02072 03710602
         L     RWK4,PSAAOLD             GET CURRENT ASCB ADDR    Y02072 03711002
         USING ASCB,RWK4                                         Y02072 03731902
         L     RWK3,ASCBTSB             GET TSB POINTER          Y02072 03732002
         DROP  RWK4                                              Y02072 03732102
         MODESET  EXTKEY=TCAM           KEY 6 TO ACCESS TSB      Y02072 03735402
         USING TSBASCBA,RWK3                                     Y02072 03737402
         SR    RC,RC                    CLEAR REGISTER          ZA01275 03744102
         IC    RC,TSBLNSZ               GET TSB LINE SIZE       ZA01275 03747402
         MODESET  EXTKEY=DATAMGT                                 Y02072 03749402
         STH   RC,DCBLRECL              SET LRECL TO LINE SIZE  ZA01275 03750702
*                                                                       03752702
*   THIS CODE WAS COPIED FROM IGG0196K. IT ADJUSTS BLOCKSIZE    SA52300 03754002
*   TO LRECL IF IT IS OUTPUT TO A UR DEVICE AND USES THIS VALUE SA52300 03757302
*   WHEN COMPUTING AMOUNT OF CORE NEEDED FOR A BUFFER POOL.     SA52300 03759302
*                                                                       03759702
A0011    EQU   *                                                SA52300 03760602
         TM    DCBCIND2,QSAMB           IS IT QSAM             @XA01495 03762637
         BNO   A0012                    NO CONTINUE            @XA01495 03763037
         TM    DCBRECFM,DCBRECBR        IS IT BLOCKED FORMAT?   SA52300 03763902
         BZ    A0012                    NO CONTINUE             SA52300 03767202
         TM    DCBDEVT,URBIT            IS IT UNIT RECORD?      SA52300 03770502
         BZ    A0012                    NO CONTINUE             SA52300 03773802
         TM    PAROPT,PAROUTPT          IS IT OUTPUT?           SA52300 03777102
         BZ    A0012                    NO CONTINUE             SA52300 03780402
         DROP  RPARC                                                    03782402
         TM    DCBRECFM,DCBRECU         IS IT UNDEF FORMAT      SA67354 03783702
         BNM   A0012                    YES, LEAVE BLKSIZE      SA67354 03787002
         TM    DCBRECFM,DCBRECV         IS IT VAR FORMAT        SA67354 03789002
         BO    A0011A                   YES, LEAVE BLKSIZE      SA67354 03789402
         LH    RC,DCBLRECL              USE LRECL TO BUILD BFR  SA52300 03790302
         STH   RC,DCBBLKSI              CHANGE BLOCKSIZE        SA52300 03793602
         LH    RC,DCBBUFL               GET BUFFER LENGTH EXPTD@XA01495 03794037
         LTR   RC,RC                    SPECIFIED              @XA01495 03794437
         BNZ   A0011A                   YES - USE IT           @XA01495 03794837
         LH    RC,DCBBLKSI              IF NOT RESTORE LRECL   @XA01495 03795637
A0011A   NI    DCBRECFM,X'FF'-DCBRECBR  TURN OFF BLOCKED BIT    SA52300 03796902
         OI    DCBCIND1,BLKFLG          TELL CLOSE              SA52300 03800202
*                                                                       03803502
*                                                                       03806802
*   RB HAS NO. OF BUFFERS DESIRED                                       03810102
*   RC HAS BUFFER SIZE TO BE SUPPLIED                                   03813402
*                                                                       03816702
*  *                                                                    03820000
*      AN INDICATOR IS BEING SET SO CLOSE KNOWS WHETHER OR NOT TO       03840000
*      FREE THE QSAM BUFFER POOL FOR THE CASE OF CONCATENATION WITH     03860000
*      UNLIKE ATTRIBUTES.  POOL IS NOW FREED AND REOBTAINED EVEN IF     03870020
*      USER SPECIFIES BUFFER LENGTH, SINCE USER HAS NO CHOICE ON DD *   03880020
*                                                                       03900000
*                                                                       03920000
A0012    EQU   *                                                 M4899  03930019
         OI    DCBCIND2,X'08'           SET BUFFER POOL INDICATOR       03940000
         LA    RC,7(0,RC)              ADJUST TO DBL WORD BY ADDING 7   04020000
         SRL   RC,3                    ROUND TO                         04040000
         SLL   RC,3                       DOUBLE WORD                   04060000
*                                                                       04080000
*                                                                       04100000
*                                                                       04120000
         LR    RD,RB                   SAVE LNGTH AND NUMBER            04140000
         LR    RJ,RC                     OF BUFFERS                     04160000
         MR    RD,RD                    COMPUTE LENGTH                  04180000
         LA    RJ,8(0,RJ)              ADD 8 FOR CNTRL BLK              04200000
         TM    DCBBFTEK,DOUBLE         DOUBLE WD. ALIGN.                04220000
         BC    14,A0030                YES, BRANCH              A48163  04240021
*                                                                       04260000
         LA    RJ,8(RJ)                 ADD 8 FOR FW ALIGNMENT          04280021
         OI    FCAOPEN,FCAOXTND         INDIC BCB EXTENDED       Y02072 04290002
*                                                                       04300000
A0030    EQU   *                                                        04320000
         TM    DCBBFTEK,LRECIND         LOGICAL REC INTERFACE   SA56446 04325021
         BNO   GETCORE                  NO,GOTO GETMAIN         SA56446 04335021
*                                                                       04335119
* LOGICAL RECORD INTERFACE TEST PRIOR TO GETMAIN. DETERMINE IF          04335219
* BUFFER CONTROL BLOCK HAS TO BE EXTENDED FOR A RECORD AREA.            04335321
* IF SO, ADD 8 BYTES TO THE BUFFER CONTROL BLOCK LENGTH.                04335721
*                                                                       04335819
         TM    DCBCIND2,QSAMB           QSAM DATA SET           SA56446 04335921
         BNO   DEFAULT                  NO,BR TO TURN OFF BITS  SA56446 04336021
         TM    DCBRECFM,FORMATVS        IS FORMAT VARIABLE       S19015 04336219
*                                       SPANNED                  S19015 04336319
         BNO   DEFAULT                  BRANCH NO TO TURN OFF    S19015 04336419
*                                           LOGICAL RECORD              04336519
*                                           INTERFACE INDICATOR         04336619
         TM    DCBMACRF,LOCATEB         LOCATE MODE              S19015 04336719
         BO    TSTFW                    BRANCH YES TO ADD RA LEN A48163 04336821
         TM    DCBMACRF+ONE,LOCATEB     LOCATE MODE              S19015 04336919
         BNO   DEFAULT                  BRANCH NO TO TURN OFF    S19015 04337019
*                                           LOGICAL RECORD              04337119
*                                           INTERFACE INDICATOR         04337219
TSTFW    EQU   *                                                 A48163 04338400
* LOGICAL RECORD INTERFACE IS SUPPORTED.  DETERMINE IF BUFFER    A48163 04338821
* CONTROL BLOCK MUST BE EXTENDED TO CONTAIN THE RECORD AREA      A48163 04339221
* ADDRESS.                                                              04339621
         TM    DCBBFTEK,DOUBLE          FULL WORD ALIGNMENT             04340021
         BO    GETCORE                  BRANCH YES -- BUFFER     A48163 04340121
*                                       CONTROL BLOCK HAS SPACE  A48163 04340221
*                                       FOR RECORD AREA ADDRESS  A48163 04340321
         LA    RJ,8(RJ)                 ADD 8 BYTES                     04340821
         OI    FCAOPEN,FCAOXTND         INDIC BCB EXTENDED       Y02072 04342402
         B     GETCORE                  GO GET BUFFER POOL SPACE A48163 04342800
*                                                                       04344800
*  LOGICAL RECORD INTERFACE PROCESSING IS NOT SUPPORTED.                04346800
*                                                                       04346921
DEFAULT  NI    DCBBFTEK,NOT-LRECIND     TURN OFF LOGICAL RECORD  A48163 04347221
*                                       INDICATOR                       04347600
GETCORE  EQU   *                                                 S19015 04359621
*                                                                       04360821
         SR    RF,RF                    HOUSEKEEP PARM REG 1.     DM0E  04364421
         SPACE 2                                                        04364502
         MODESET  KEYADDR=DXUKEY,WORKREG=14 GET INTO USER KEY    Y02072 04364802
         SPACE 2                                                        04377202
         GETMAIN R,LV=(15),SP=0                                  Y02072 04378802
         SPACE 2                                                        04402402
         TM    DCBBUFCB+ADLEN,ONE       BUFCB SPECIFIED          S19015 04403019
         BO    GETSTBUF                 NO, GO FORMAT POOL       A48163 04404000
*                                                                       04405019
         L     RJ,DCBBUFCB              YES, GET BUFCB ADDR      S19015 04406000
         OI    FLGOFFST(RJ),RAFLAG      SET FLAG TO INDICATE     S19015 04407019
*                                       RECORD AREA PRESENT             04408000
         ST    RF,RAADOFST(RJ)          STORE RECORD AREA ADDR   S19015 04409019
*                                                                       04410019
         LH    RJ,DCBLRECL              LOAD LRECL IN WORK REG   S19015 04411019
         LA    RJ,CTLINFO(RJ)           ADD 32 BYTES CONTROL     S19015 04412019
*                                       INFO                     S19015 04413019
         ST    RJ,DISPSN(RF)            STORE LRECL IN RECORD    S19015 04414019
*                                       AREA                     S19015 04415019
         XC    WDLEN(CTLINFO-4,RF),WDLEN(RF) CLR CONTROL FLDS  @ZA12970 04423837
*                                       IN RA                    S19015 04427702
         SPACE 2                                                        04429702
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 04430102
         SPACE 2                                                        04430502
         OI    FCAOPEN,FCAORECA         INDIC REC AREA GOTTEN    Y02072 04430902
         B     A0093                    EXIT                     Y02072 04431602
*                                                                       04435502
GETSTBUF EQU   *                                                 S19015 04439402
*                                                                       04443302
         ST    RF,DISPSN(RF)            STORE START ADDRESS      S19015 04447202
*                                       DM0E                     S19015 04451102
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 04455002
         STCM  RWK2,B'0111',DCBBUFCA    BCB ADDR TO DCB          Y02072 04457002
         MODESET  KEYADDR=DXUKEY,WORKREG=14 GET INTO USER KEY    Y02072 04459002
*                                                                       04460000
         STH   RB,4(0,RF)              STORE NO.OF BUF. IN BCB          04480000
         STH   RC,6(0,RF)              STORE LNGTH OF BUF. IN BCB       04500000
         SPACE 2                                                        04520002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 04530002
         SPACE 2                                                        04532002
         OI    FCAOPEN,FCAOBUF          INDIC BUFFERS GOTTEN     Y02072 04534002
         SPACE 2                                                        04536002
         MODESET  KEYADDR=DXUKEY,WORKREG=14  BACK TO USER KEY    Y02072 04538002
         SPACE 2                                                        04538402
         LR    RUCB,RF                  GET ADDRESS IN WRK REG          04540000
         LA    RUCB,DWDLEN(0,RUCB)      GET ADDR +8 TO POINT TO         04540400
*                                       FIRST AVAILABLE BUFFER          04540800
* DETERMINE IF BUFFER CONTROL BLOCK IS EXTENDED.  IF SO, SET FLAGS      04542200
* AND UPDATE POINTER TO FIRST BUFFER.                                   04542400
         TM    DCBBFTEK,DOUBLE          FULL WORD ALIGNMENT      A48163 04543000
         BZ    TSTLRI                   NO, TEST LRI             A48163 04543200
         LA    RUCB,WDLEN(0,RUCB)       YES, OFFSET ADDR TO FW   A48163 04543400
         B     EXTEND                   GO SET EXTEND FLAG       A48163 04543600
TSTLRI   TM    DCBBFTEK,LRECIND         LRI SUPPORTED            A48163 04543900
         BNO   ALIGNED                  NO, BRANCH TO SAVE FIRST A48163 04544100
*                                       BUFFER ADDRESS                  04548500
         LA    RUCB,DWDLEN(0,RUCB)      YES, OFFSET TO NEXT DW   A48163 04551900
*                                                                       04554500
EXTEND   OI    FLGOFFST(RF),EXTND       SET FLAG TO INDICATE     A48163 04555721
*                                       BUFFER CONTROL BLOCK EXTENDED   04555800
*                                                                       04580000
*        THE NEXT SEQUENCE OF INSTRUCTIONS BUILDS A BUFFER POOL         04600000
*                                                                       04655019
ALIGNED  EQU   *                                                 S19015 04774019
*                                                                       04776019
         ST    RUCB,0(0,RF)             STORE BUFFER ADDRESS            04780000
         LR    RF,RUCB                  SAVE NEXT BUFF. ADDR            04800021
*                                                                       04820000
A0050    EQU   *                                                        04840000
         BCT   RB,A0060                 IF MORE, BRANCH          A48163 04842021
         B     SETLAST                  EXIT                     A48163 04844021
A0060    EQU   *                                                        04846021
         ALR   RUCB,RC                  UPDATE TO NEXT BUFFER           04850000
         ST    RUCB,0(RF)               STORE POINTER                   04852000
         ALR   RF,RC                    BUFFER LEN + BUFFER ADDR A48163 04854000
         B     A0050                    IF MORE BRANCH                  04860021
*                                                                       04889619
SETLAST  EQU   *                                                 S19015 04898619
         ST    RB,0(0,RF)               LAST LINK TO ZERO               04900000
         TM    DCBBFTEK,LRECIND         RECORD AREA NEEDED              04910000
         BNO   A0090                    NO,EXIT                         04920000
         L     RJ,DCBBUFCB              GET BUFFER CONTROL BLOCK A48163 04930000
         TM    FLGOFFST(RJ),EXTND       SPACE FOR RECORD AREA    A48163 04932000
*                                       ADDR AVAILABLE                  04934000
         BNO   A00100                   N0, ABEND                Y02072 04936002
*                                                                       04938000
GETRALEN EQU   *                                                        04938400
         LH    RJ,DCBLRECL              LOAD LRECL IN WORK REG   A48163 04938821
         LA    RJ,CTLINFO(RJ)           ADD 32 BYTES FOR CONTROL A48163 04939221
*                                       INFORMATION                     04939600
         B     GETCORE                  GO GET SPACE FOR RECORD  YM1262 04939702
*                                       AREA                            05030002
*                                                                       05075002
A0090    EQU   *                                                        05120000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05180002
         USING WTGENTRY,RWTGC                                    Y02072 05190002
A0093    MVC   WTGIDTTR,LOAD3I       NEXT MODS ID TO WTG TAB   @Z30TSCF 05200003
RELOOP   EQU   *                                                        06780000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     06800000
         LA    RPARC,PLOFF(0,RPARC)    INCR CURRENT DCB ENTRY PTR       06820000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            06840000
         BCR   8,RBASE                 RETURN TO INITIALIZE ANOTHER DCB 06860000
*                                                                       06880000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    06900000
         BC    7,RELOOP                 NO, CHECK NEXT ENTRY            06920000
*                                                                       06940000
         LR    RPARC,RPAR                                               06960000
         LA    RWTGC,WAOFF(0,RWTG)     REINITIALIZE WTG LIST PTR        06980000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           07000000
         BC    7,TCTLRTN           IF NOT TRANSFER CONTROL              07020000
*                                                                       07040000
         LA    RWTGC,WGOFF(0,RWTGC)    GET NEXT ENTRY                   07060000
         LA    RPARC,PLOFF(0,RPARC)                                     07080000
         BC    15,ZCHEK                                                 07100000
A00100   EQU   *                                                        07410002
         SPACE 3                                                        07410102
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07410402
         SPACE 3                                                        07412402
DCBERROR EQU   *                                                        07420000
*                                                                       07440000
         OI    DCBOFLGS,X'90'           TURN ON WRITE,OPEN BITS   10929 07450015
         DMABCOND OABD061,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X07460021
                                        CALL PROBLEM DETERMINATION      07470021
TCTLRTN  EQU   *                                                 S20201 07582020
         USING WTG,RWTG                                                 07584003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*07586003
               MODID=WTGENTRY                                  @Z30TSCF 07588003
         DROP  RWTGC,RWTG                                      @Z30TSCF 07590003
*                                                                       07591020
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   07600000
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                07620000
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                07640000
OPIDCNST DC    C'0S'                                                    07660000
AMIDCNST DC    C'1I'                    THIS ROUTINE ID                 07680000
LOAD3I   DC    C'3I',VL3(IGG0193I)      NEXT MODS ID           @Z30TSCF 07730003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETER             @Z30TSCF 07732003
         SPACE 2                                                        07742002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 07782002
END      EQU   *                        END OF MODULE            Y02072 07832002
         EJECT                                                          07882002
         IGGPARML                                                       07932002
         EJECT                                                          08022002
         IHAPSA                                                  Y02072 08032002
         EJECT                                                          08064002
         IGGBCB  TYPE=SAM                                        Y02072 08070002
         EJECT                                                          08120002
         IKJTCB                                                , S20016 08123020
           DCBD  DSORG=PS                                               08140000
*                                                                       08160000
*                                                                       08180000
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 08210003
         ORG   WTGIDTTR                                          Y02072 08220002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 08230002
         EJECT                                                          08230402
FORCORE  DSECT                                                   Y02072 08232002
         IHAFCAUD  ORG=YES                                       Y02072 08234002
         EJECT                                                          08244002
*   TASK CONTROL BLOCK                                                  08260000
TIOT     DSECT                                                          08700000
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       08720000
TIOESTTA DS    CL1                           STATUS -A-                 08740000
TIOERLOC DS    CL2                           REL. LOC OF POOL           08760000
TIOEDDNM DS    2F                            DDNAME                     08780000
TIOEJFCB DS    1F                            JFCB DISK ADDR             08800000
TIOESTTB DS    0CL1                                                     08820000
TIOEFSRT DS    CL4                                                      08840000
         DS    CL1                                                      08860000
*        TIOT POOL ENTRY                                                08880000
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       08900000
         DS    CL1                                                      08920000
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      08940000
*                                             SLOTS)                    08960000
TIOPPOOL DS    CL8                           POOL NAME                  08980000
TIOPSTTB DS    XL1                           STATUS OF SLOT             09000000
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  09020000
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      09040000
         SPACE 1                                                        09060000
SRT      DSECT                                                          09080000
         IEFUCBOB                                                       09100000
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          09120000
DEB      DSECT                                                          09140000
DEBNMSUB DS    0CL1                                                     09160000
DEBTCBAD DS    CL4                                                      09180000
DEBAMLNG DS    0CL1                                                     09200000
DEBDEBAD DS    CL4                                                      09220000
DEBOFLGS DS    0CL1                                                     09240000
DEBIRBAD DS    CL4                                                      09260000
DEBOPATB DS    0CL1                                                     09280000
DEBSYSPG DS    CL4                                                      09300000
DEBNMEXT DS    0CL1                                                     09320000
DEBUSRPG DS    CL4                                                      09340000
DEBPRIOR DS    0CL1                                                     09360000
DEBECBAD DS    CL4                                                      09380000
DEBPROTG DS    0CL1                                                     09400000
DEBDEBID DS    0CL1                                                     09420000
DEBDCBAD DS    CL4                                                      09440000
DEBEXSCL DS    0CL1                                                     09460000
DEBAPPAD DS    CL4                                                      09480000
DEBDVMOD DS    0CL1                                                     09500000
DEBUCBAD DS    CL4                                                      09520000
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     09540000
DEBBINUM DS    CL2                                                      09560000
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   09580000
DEBSTRCC DS    CL2                                                      09600000
DEBSTRHH DS    CL2                                                      09620000
DEBENDCC DS    CL2                                                      09640000
DEBENDHH DS    CL2                                                      09660000
DEBNMTRK DS    CL2                                                      09680000
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          09700000
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              09720000
DEBVOLSQ DS    H                                                        09740000
DEBVOLNM DS    H                                                        09760000
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     09780000
DEBSUBID DS    H                                                        09800000
CVT      DSECT                                                          09820000
         CVT                                                            09840000
         SPACE 3                                                        11940020
         IEZJSCB                                                        12640020
         SPACE 3                                                        14740020
         IKJTSB                                                         15440020
         SPACE 3                                                        15490002
         IHAASCB                                                 Y02072 15540002
         SPACE 3                                                        15590002
WTGT     DSECT                                                   Y02072 16840002
XCTMODNM DS    CL8                      MODULE NAME              S20201 23840020
         DS    CL6                      *                        S20201 30840020
XCTTTR   DS    CL3                      TTR                      S20201 37840020
         DS    CL5                      *                        S20201 44840020
XCTATTRB DS    CL2                      ATTRIBUTES               S20201 51840020
XCTMODSZ DS    CL3                      MAIN STORAGE REQUIRED    S20201 58840020
XCTTXTLN DS    CL2                      LENGTH OF FIRST TEXT REC S20201 65840020
XWTGLENG DS    C                        *                        S20201 72840020
XWTGPATH DS    CL2                      *                        S20201 79840020
         END                                                            86840020
./  ADD  SSI=71730213,NAME=IGG0191J
  TITLE  'IGG0191J - BSAM, STAGE 2 OPEN EXEC, DIRECT ACCESS, OUTIN,    ,00021402
               INOUT'                                                   00021802
IGG0191J CSECT                                                          00021903
*MODULE NAME - IGG0191J                                          Y02072 00022202
*                                                                       00022602
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00022702
*                                                                       00022802
*COPYRIGHT - NONE                                                Y02072 00022902
*                                                                       00025002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00027002
*                                                                       00027402
*          VS2 RELEASE 2 DELETIONS                               Y02072 00027502
*000430,037400,037600,037800-038000,039860-040040,041360,        Y02072 00029602
*041420,041850,042650,042700,042750,045400,053690,055690,        Y02072 00031702
*056690,086000,086100,086105-086185,085300,57190,62800,          Y02072 00033802
*63800,86100                                                     Y02072 00043802
*                                                                YM4697 00045802
*                                                                YA3136 00046202
*                                                                       00046303
*          VS2 RELEASE 3 DELETIONS                                      00049403
*                                                              @Z30TSCF 00051403
*          RELEASE 20 DELETIONS                                       * 00053503
*0973012800,016400,017200-018800,020400-021600,024200-025400,    S20201 00056603
*0973026400-027000,029400,030200-037200,037600,038800-041400,    S20201 00059703
*0973042200,043600-048400,050000-054200,055400-055800,056600-    S20201 00062803
*0973057000,059200,063400,066800,071000,071400,073000,079000-    S20201 00065903
*0973083200                                                      S20201 00069003
*          RELEASE 21 DELETIONS                                       * 00072103
*0082041400,042700,055190,089010-089160                          A37507 00075203
*0082041390-044400,056190,084800-085800                          M0081  00078303
*                                                                A37507 00081403
* STATUS CHANGE LEVEL 009                                               00084503
*                                                                       00087603
*   THIS MODULE WAS SPLIT INTO IGG0196L FOR REL 21.                     00090703
*FUNCTION/OPERATION: THIS ROUTINE WILL GET CORE(GETMAIN) TO SET UP THE  00093803
*      NECESSARY IOB'S. IT WILL CLEAR THE CORE AND LINK THE IOB'S       00096903
*      TOGETHER.(DIRECT ACCESS)                                         00100000
*      IT SETS CODES  IN THE DCBCNTRL FIELD OF THE DCB. IT WILL         00110021
*      CONSTRUCT - THE SET SECTOR COMMAND (MERLIN/ZEUS)                 00120021
*                - THE SEARCH COMMAND                                   00130021
*                - THE TIC BACK TO SEARCH COMMAND                       00140021
*                - THE READ COMMANDS                                    00150021
*      IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA           Y02072 00152002
*      INDICATING TO FORCE CLOSE THAT THE CORE GETMAINED FOR     Y02072 00154002
*      THE IOB'S CAN BE FREEMAINED.                              Y02072 00156002
*      IT THEN XCTL'S TO IGG0196L FOR COMPLETION OF THE IOB'S           00160021
*                                                                       00220000
*ENTRY POINTS:  IGG0191J BY XCTL FROM IGG0193I OR IGG0196B.             00230021
*                                                                       00260000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00280000
*                                                                       00300000
*OUTPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS), IOB(USERS).          00320000
*                                                                       00330002
*MACROS - ACTION : MODESET, GETMAIN, XCTL, XCTLTABL              Y02072 00332002
*                                                                       00334002
*MACROS - MAPPING : IECDSECS, DCBD, IEZIOB, IECDSECT, IHAFCAUD   Y02072 00336002
*                                                                       00340000
*EXTERNAL ROUTINES : NONE                                               00360000
*                                                                       00380000
*EXITS-NORMAL: XCTL TO IGG0196L                                         00400021
*                                                                       00420000
*EXITS-ERROR: NONE                                                      00440000
*                                                                       00460000
*TABLES/WORKAREAS: DUPE WTG TABLE************************************** 00480000
*      SEE DEVICETB DSECT.                                              00500000
*                                                                       00520000
*ATTRIBUTES: REENTRANT, REUSABLE, SUPERVISOR STATE,              Y02072 00540002
*            RUNS IN USER KEY UNLESS OTHERWISE SPECIFIED.        Y02072 00550002
*                                                                       00560000
* NOTES- THIS EXECUTOR DEALS WITH DIRECT ACCESS FOR IN/OUT - OUT/IN.    00580000
*                                                                       00600000
         SPACE 1                                                        00620000
*                                                                       00640000
*                                                                     * 00660000
*    2841  OP  CODES                                                  * 00680000
*                                                                     * 00700000
TIC      EQU   X'08'          TIC OP CODE                               00740000
WRTCK    EQU   X'80'                                                    00760000
SRCHE    EQU   X'31'          SEARCH OP CODE                            00780000
READATA  EQU   X'86'          READ DATA CCW                             00820000
READKEDA EQU   X'8E'                    READ KEY AND DATA OP CODE       00840000
READCOUN EQU   X'92'          READ COUNT OP CODE                        00860000
SETSC    EQU   X'23'                    SET SECTOR COMMAND       S20201 00885020
VFORMAT  EQU   X'40'                    MASK FOR V FORMAT        S20201 00895020
*                                                                     * 00900000
*********************************************************************** 00920000
*                                                                     * 00940000
*    CCW  CONSTRUCTION  EQUATES                                       * 00960000
*                                                                     * 00980000
SILI     EQU   X'20'                   SILI FLAG                        01020000
CMDSKPSL EQU   X'70'                    COMMAND SKIP AND SILI           01040000
COMSILI  EQU   X'60'         COMMAND AND SILI                           01060000
COMCHAIN EQU   X'40'          COMMAND CHAIN BIT                         01120000
ONE      EQU   1                                                        01180000
FIVE     EQU   5                                                        01220000
ATE8     EQU   8                                                        01260000
CC       EQU   X'40'                    COMMAND CHAIN            S20201 01280020
*********************************************************************** 01300000
*                                                                     * 01320000
*    MISC  EQUATES                                                    * 01340000
*                                                                     * 01360000
MINKEY   EQU   X'01'                                                    01380000
UFORMAT  EQU   X'C0'                    U  FORMAT TEST  MASK            01440000
BWCHP    EQU   4                        BASIC WRITE CHP LENGTH   S20201 01602020
BIOB     EQU   16                       BASIC IOB LENGTH         S20201 01604020
MAX      EQU   256                      MAX VALUE FOR LENGTH FLD S20201 01606020
NOERR    EQU   X'7F'                    ECB INDICATION OF NO     S20201 01608020
*                                       ERROR                    S20201 01610020
NONCARN  EQU   X'20'                    NO DISCONNECT USED       S20201 01612020
SDOPT    EQU   X'08'                    SEARCH DIRECT OPTION     S20201 01614020
*                                       BYTE                     S20201 01616020
UNRELFLG EQU   X'02'                   IOB UNRELATED FLG         A37507 01618021
*********************************************************************** 01620000
*                                                                       01621020
* DISPLACEMENTS AS EQUATES                                              01622020
*                                                                       01623020
D0       EQU   0                        DISPLACEMENT OF ZERO     S20201 01624020
D1       EQU   1                        DISPLACEMENT OF ONE      S20201 01625020
D2       EQU   2                        DISPLACEMENT OF TWO      S20201 01626020
D3       EQU   3                        DISPLACEMENT OF THREE    S20201 01627020
D4       EQU   4                        DISPLACEMENT OF FULLWORD S20201 01628020
D5       EQU   5                        DISPLACEMENT OF FIVE     S20201 01629020
D6       EQU   6                        DISPLACEMENT OF SIX      S20201 01630020
D8       EQU   8                        DISPLACEMENT OF DW       S20201 01632020
D12      EQU   12                       DISPLACEMENT OF THREE    S20201 01633020
*                                       WORDS                    S20201 01634020
D15      EQU   15                       DISPLACEMENT OF FIFTEEN  S20201 01635020
D24      EQU   24                       DISPLACEMENT OF SIX      S20201 01638020
*                                       WORDS                    S20201 01639020
D40      EQU   40                       DISPLACEMENT OF TEN      S20201 01640020
*                                       WORDS                    S20201 01641020
D43      EQU   43                       DISPLACEMENT OF CCHHR    S20201 01642020
*                                       IOB                      S20201 01643020
D44      EQU   44                       DISPLACEMENT OF CP PTR   S20201 01644020
FLAGOFF  EQU   4                        CCW FLAG OFFSET          S20201 01645020
CNTOFF   EQU   7                        CCW COUNT OFFSET         S20201 01646020
*********************************************************************** 01660000
*********************************************************************** 01680000
*                                                                       01700000
*                                                                       01750020
* REGISTER CONVENTIONS USED THROUGHOUT ALL OPEN PASSES                  01800020
*                                                                       01850020
*                                                                       01900000
*********************************************************************** 01920000
*                                                                       01940000
RE       EQU   0                                                        01960000
RF       EQU   1                        WORK REG ONE             S20201 01963020
RWK1     EQU   RF                      WORK REGISTER             Y02072 01965002
RDCB     EQU   2                        DCB REGISTER             S20201 01966020
RBASE    EQU   3                        BASE REGISTER            S20201 01969020
RCORE    EQU   4                        WORK AREA ADDR           S20201 01972020
RWTG     EQU   6                                                        01980000
RPARC    EQU   7                        CURRENT PARAMETER        S20201 01990020
*                                                                       02000000
RWTGC    EQU   8                                                        02020000
RWK2     EQU   9                       WORK REGISTER             Y02072 02070002
RUCB     EQU   10                       ADDRESS OF UCB           S20201 02100020
RDEB     EQU   11                       ADDRESS OF DEB           S20201 02140020
RB       EQU   12 2                                                     02180000
RWK3     EQU   RB                      WORK REGISTER             Y02072 02190002
RC       EQU   13 3                                                     02200000
RD       EQU   14 4                                                     02220000
RJ       EQU   15 5                                                     02240000
*                                                                       02260000
*                                                                       02280000
*********************************************************************** 02300000
*                                                                       02320000
*********************************************************************** 02340000
*                                                                       02360000
*                                                                       02380000
         USING SOP810,RBASE                                      S20201 02410020
         USING IHADCB,RDCB              REG 2 IS DCB             S20201 02420020
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR  S20201 02430020
         BALR  RBASE,RE                 REG 3 IS BASE   RE=0     S20201 02440020
*                                                                       02450020
SOP810   EQU   *                                                 S20201 02460020
*                                                                       02470020
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 02472002
         DC    C'IGG0191J'              MODULE NAME              Y02072 02474002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 02476003
         DC    C'10/18/74'              LAST DATE MODIFIED     @Z30TSCF 02478003
BEGIN    DS    0H                                                Y02072 02478402
         L     RDCB,D0(RPARC)           GET DCB ADDR             S20201 02480020
         LA    RDCB,D0(RDCB)            CLEAR HI BYTE            S20201 02490020
         L     RCORE,D4(RWTGC)          GET WORK AREA ADDR       S20201 02500020
*                                                                       02560000
*                                                                       02580000
*                                                                       02600000
*                                                                       02620000
         SR    RD,RD                                                    02720000
         ST    RD,DCBCNTRL              CLEAR CONTROL            S20201 02730020
         NI    DCBCIND2,X'FE'           TURN OFF QSAM BIT IF ON         02740000
         MVI   DCBCNTRL+3,2             READ EOB RT ID                  02760000
         MVI   DCBCNTRL+2,1             ID OF WRT EOB RT.               02780000
         TM    DCBMACRF,X'04'           NOTE POINT USED                 02800000
         BC    1,SOP810A                YES BRANCH                      02820000
         TM    DCBMACRF+1,X'04'                                         02840000
         BC    14,SOP810B               NO BRANCH                       02860000
SOP810A  EQU   *                                                        02880000
         MVI   DCBCNTRL+1,5             NPDT ID NO.                     02900000
SOP810B  EQU   *                                                        02920000
         LA    RC,BIOB                  BASIC IOB SIZE           S20201 02930020
         LA    RD,BWCHP                 BASIC WRT CHP SIZE       S20201 02940020
*                                                                       02950020
*                                                                       02960000
*                                                                       02980000
*                                  BSAM USED                            03000000
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 03010020
*                                       DISCONNECT               S20201 03020020
         BO    SOP811                   BRANCH IF YES            S20201 03030020
         LA    RC,D5(RC)                INCREMENT FOR 5 CCW      S20201 03040020
         LA    RD,D2(RD)                INCREMENT FOR 2 CCW      S20201 03050020
*                                                                       03060020
*                                                                       03070020
SOP811   EQU   *                                                 S20201 03080020
         TM    DCBOPTCD,WRTCK           WRITE CHK USED           S20201 03090020
         BNO   SOP815                   BRANCH IF NO             S20201 03100020
         LA    RC,D3(RC)                INCREMENT FOR 3 CCW      S20201 03110020
         LA    RD,D3(RD)                INCREMENT FOR 3 CCW      S20201 03120020
*                                                                       03140020
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 03150020
*                                       DISCONNECT               S20201 03160020
         BO    SOP815                   BRANCH IF YES            S20201 03170020
         LA    RC,D1(RC)                IOB+1 DW                 S20201 03180020
         LA    RD,D1(RD)                WRT CHP +1  DW           S20201 03190020
SOP815   EQU   *                                                 S20201 03200020
*                                                                       03210020
         TM    JFCBMASK+D6,SDOPT       SEARCH DIRECT USED        S20201 03220020
         BZ    SOP816                   BRANCH IF NO             S20201 03230020
*                                       SD                       S20201 03240020
         LA    RC,D2(RC)                INCREMENT FOR TWO CCWS   S20201 03250020
SOP816   EQU   *                                                 S20201 03260020
*                                                                       03270020
* STORE DW LENGTHS THEN CALCULATE  IOB SIZE TIMES NO. OF IOBS           03280020
*                                                                       03290020
         STC   RC,DCBIOBL               IOB LENGTH               S20201 03300020
         STC   RD,DCBWCPL               WRITE CHP LENGTH         S20201 03310020
*                                                                       03320020
         SR    RUCB,RUCB                CLEAR REG                S20201 03330020
         IC    RUCB,DCBNCP              GET NO. OF CHPS          S20201 03340020
         LTR   RUCB,RUCB                BEEN SPECIFIED           S20201 03350020
         BNZ   SOP817                   BRANCH IF SPECIFIED      S20201 03360020
         LA    RUCB,ONE                 FURNISH ONE IF NOT       S20201 03370020
SOP817   EQU   *                                                 S20201 03380020
         LA    RDEB,ATE8                CONSTANT OF EIGHT        S20201 03390020
         MR    RB,RDEB                  IOB DW SIZE TIMES  8     S20201 03400020
         LR    RE,RC                    KEEP SIZE                S20201 03410020
         MR    RB,RUCB                  SIZE TIMES NO. OF IOBS   S20201 03420020
*                                                                       03430020
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 03440020
*                                       DISCONNENT               S20201 03450020
         BO    SOP821                   BRANCH IF YES            S20201 03460020
         LA    RC,D8(RC)                INCREMENT 1 DW           S20201 03470020
SOP821   EQU   *                                                 S20201 03480020
         LR    RB,RC                    SAVE AMOUNT              S20201 03490020
         LR    RDEB,RE                  SAVE IOB SIZE            S20201 03500020
*                                                                       03550002
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE IOBS YM4697 03560002
*  IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE EXECUTOR.  YM4697 03570002
*                                                                       03580002
         ST    RC,DXATEXC2              SAVE LENGTH              YM4697 03590002
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 03600002
*                                                                       03650002
         GETMAIN R,LV=(RC),SP=0                                  Y02072 03760002
*                                                                       03810002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 03823202
*                                                                       03828802
*********************************************************************** 03834402
* THE FOLLOWING CODE WILL CLEAR STORAGE RECEIVED FROM GETMAIN           03840000
*                                                                       03860000
         ST    RF,DCBIOBA               ADDR IOB TO DCB          S20201 03878020
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 03880002
         LR    RD,RF                    COPY ADDRESS USE TO CLR  S20201 03887020
         LR    RE,RDEB                  RESTORE IOB SIZE         S20201 03896020
         LA    RDEB,ATE8                CONSTANT OF EIGHT        S20201 03905020
*                                                                       03914020
* SET UP THETA ADDRS, MAY BE USED LATER                                 03923020
*                                                                       03932020
         LR    RJ,RB                    COPY AMOUNT              S20201 03941020
         AR    RJ,RF                    GET AREA +1 ADDR         S20201 03950020
         SR    RJ,RDEB                  SUB 1 DW                 S20201 03959020
         ST    RJ,DXCCW11               TEMP STORE SET THETA     S20201 03968020
*                                       ADDR                     S20201 03977020
*                                                                       04013020
* CLEAR CORE HERE     RB=AMT    RD=ADDR                                 04022020
*                                                                       04031020
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 04031402
         LA    RJ,MAX                   CONSTANT OF 256          S20201 04040020
         B     CLEAR                    GO AROUND EXEC MODELS    S20201 04049020
SOP8LO   XC    D0(ONE,RD),D0(RD)        CLEARS REMAINIG BYTES    S20201 04058020
SOP8HI   XC    D0(MAX,RD),D0(RD)        CLEARS 256 BYTES         S20201 04067020
         AR    RD,RJ                    ADD 256 TO ADDR          S20201 04076020
CLEAR    SR    RB,RJ                    SUB 256 FROM AMT         S20201 04085020
         BH    SOP8HI                   IF AMT GT 256 BRANCH     S20201 04094020
         AR    RB,RJ                    CORRECT AMT              S20201 04103020
         BCTR  RB,RE                    REDUCE BY ONE BYTE       S20201 04112020
         EX    RB,SOP8LO                CLEAR REMAINING BYTES    S20201 04121020
         LR    RB,RF                    COPY ADDR                S20201 04130020
         USING IOBQSAMN,RF             USE IOB PREFIX DSECT      Y02072 04136002
         ST    RB,IOBNIOBA             STORE FIRST IOB ADDR IN   Y02072 04142002
*                                      FIRST IOB FOR THE CASE    M0081  04150021
*                                      OF ONE IOB - INSTRUCTION  M0081  04160021
*                                      UNNECESSARY IF MORE THAN  M0081  04170021
*                                      ONE IOB                   M0081  04180021
         DROP  RF                                                Y02072 04185002
         B     SOP830                  BYPASS LINKING IOB'S      M0081  04190021
*                                                                       04200021
*      BEGIN LOOP TO CONSTRUCT IOB'S                                    04210021
*                                                                       04220021
SOP829   EQU   *                                                 M0081  04230021
         LR    RB,RF                    GET POINTER TO LAST      M0081  04240021
*                                        IOB BUILT               M0081  04250021
         AR    RB,RE                   NEXT IOB TO BE BUILT      M0081  04260021
         USING IOBQSAMN,RF             ADDRESSABILITY FOR DSECT  Y02072 04265002
         ST    RB,IOBNIOBA             LINK IOB'S                Y02072 04270002
         DROP  RF                                                Y02072 04275002
         LR    RF,RB                   NEXT IOB TO BE BUILT      M0081  04280021
SOP830   EQU   *                       COME HERE IF FIRST IOB    M0081  04290021
         LA    RB,D4(RB)                PT TO ECB                S20201 04460020
         ST    RB,D12(RF)               PUT PTR IN IOB           S20201 04480020
         MVI   D0(RB),NOERR             INDICATE COMP NO ERROR   S20201 04500020
*                                                                       04520020
         L     RWK2,DXUDCBAD           GET USERS DCB ADDRESS     Y02072 04530002
         USING IOBNECB,RB                                        Y02072 04540002
         ST    RWK2,IOBDCBPT           DCB ADDR TO IOB           Y02072 04550002
         DROP  RB                                                Y02072 04552002
         LA    RB,D44(RB)               PT TO CHP STARTAD        S20201 04560020
         ST    RB,D24(RF)               PUT ADDR IN IOB          S20201 04580020
         MVC   D40(ATE8,RF),DCBFDAD     INITIALIZE IOBFDAD       S20201 04600020
*                                                                       04620020
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 04640020
*                                       DISCONNECT               S20201 04660020
         BO    SOP831                   BRANCH IF YES            S20201 04680020
         BAL   RD,SOP8STA               IF NO GO BUILD SET CMND  S20201 04700020
*                                                                       04720020
* UPON RETURN SET UP TO BUILD SRCH CMND AND GO BUILD IT                 04740020
*                                                                       04760020
SOP831   EQU   *                                                 S20201 04780020
         LA    RC,D43(RF)               GET PTR TO CCHHR         S20201 04800020
         BAL   RD,SOP8SRTC              GO BUILD SRCH AND TIC    S20201 04820020
*                                                                       04860000
*    THE 'SEARCH AND TIC CCWS  HAVE NOW BEEN CONSTRUCTED.               04880000
*                                                                       04900000
*                                                                       04920000
         LA    RB,16(0,RB)              WRITE CCW POINTER               04960000
*                                                                       04980000
         LA    RC,D43(RF)               PT TO CCHHR              S20201 04983020
         AR    RC,RE                    NOW INCREMENT TO NEXT    S20201 04986020
*                                       IOB                      S20201 04989020
         CH    RUCB,CON1                IS THIS THE LAST IOB     S20201 04992020
         BNE   SOP832A                  BRANCH IF NO             S20201 04995020
         L     RC,DCBIOBA               GET FIRST IOB ADDR       S20201 04998020
         LA    RC,D43(RC)               PT TO CCHHR              S20201 05001020
SOP832A  EQU   *                                                 S20201 05004020
         CLI   DCBNCP,ONE               ONLY ONE IOB             S20201 05007020
         BH    SOP833                   BRANCH IF MORE           S20201 05010020
         L     RDCB,DXUDCBAD           GET USERS DCB ADDR        Y02072 05012002
         LA    RC,DCBFDAD+D3            IF NOT PT TO IOB CCHHR   S20201 05013020
         L     RDCB,0(RPARC)           GET PROTECTED COPY AGAIN  Y02072 05015002
SOP833   EQU   *                                                 S20201 05016020
         BAL   RD,SOP8READ              GO BUILD READ CCWS       S20201 05019020
         BCT   RUCB,SOP829                                              05319021
         USING IOBQSAMN,RF             ADDRESSABILITY FOR DSECT  Y02072 05369002
         MVC   IOBNIOBB,DCBIOBA+1      LINK LAST TO FIRST        A37507 05419021
         CLI   DCBNCP,ONE              ONE IOB?                  A37507 05469021
         BNE   NTONEIOB                NO - BRANCH               A37507 05519021
         OI    IOBFLAG1,IOBUNREL       YES - SET UNREL FLG       Y02072 05569002
NTONEIOB EQU   *                                                 A37507 05619021
         DROP  RF                                                Y02072 05669002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05671002
         USING WTGENTRY,RWTGC                                    Y02072 05681002
         MVC   WTGIDTTR,MOD196L         NEXT MOD               @Z30TSCF 05691003
         LR    RSTART,RBASE             RESTORE BASE REG         S20201 05920020
*                                                                       05940000
RELOOP   LA    RCWG,WGOFF(0,RCWG)      INCREMENT CURR WTG ENTRY         05960000
         LA    RCPL,PLOFF(0,RCPL)      INCR CURRENT DCB ENTRY POINTER   05980000
         CLC   0(2,RCWG),AMIDCNST      THIS RT NEEDED AGAIN             06000000
         BCR   EGHT,RSTART              BACK TO OPEN AGAIN         DM0I 06020000
         CLC   0(2,RCWG),OPIDCNST      END OF WTG TABLE                 06040000
         BC    7,RELOOP                NO,CHECK NEXT ENTRY              06060000
         LR    RCPL,RPL                                                 06080000
         LA    RCWG,WAOFF(0,RWG)       REINITIALIZE WTG LIST PTR        06100000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           06120000
         BC    7,TCTLRTN               IF NOT TRANSFER CONTROL          06140000
         LA    RCWG,WGOFF(0,RCWG)      GET NEXT ENTRY                   06160000
         LA    RCPL,PLOFF(0,RCPL)                                       06180000
         B     ZCHEK                    ZERO CHECK                 DM0I 06200000
**                                                                      06220000
TCTLRTN  EQU   *                                                        06240000
         USING WTG,RWTG                                                 06290003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*06340003
               MODID=WTGENTRY                                  @Z30TSCF 06390003
         DROP  RWTGC,RWTG                                      @Z30TSCF 06392003
**                                                                      06400000
RPL      EQU   5                                                        06520000
RWG      EQU   6                                                        06540000
RCPL     EQU   7                                                        06560000
RCWG     EQU   8                                                        06580000
RSTART   EQU   11                                                       06600000
WAOFF    EQU   32                                                       06620000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES      DM0I 06640000
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            06660000
OPIDCNST DC    C'0S'                    ID                         DM0I 06700000
AMIDCNST DC    C'1J'                    ID                         DM0I 06720000
MOD196L  DC    C'6L',VL3(IGG0196L)      NEXT MODULE            @Z30TSCF 06730003
*                                                                       06740000
*********************************************************************** 06760000
*                                                                       06780000
*    THIS SECTION OF CODE BUILDS A READ CHANNEL PROGRAM               * 06800000
*                                                                     * 06820000
*    R2 POINTS TO NEXT CCW ON ENTRY AND EXIT                          * 06840000
*                                                                     * 06860000
*    R4 IS RETURN -- R6 POINTS TO COUNT READ IN                       * 06880000
*                                                                       06900000
*                                                                     * 06920000
*********************************************************************** 06940000
*                                                                       06960000
SOP8READ MVI   7(RB),ONE                COUNT                           06980000
         MVI   0(RB),READATA            READ DATA OP CODE               07000000
         MVI   4(RB),CMDSKPSL           COMMAND CHAIN,SKIP,SILI         07020000
*                                                                       07040000
         MVI   15(RB),FIVE              COUNT                           07060000
         MVI   12(RB),COMSILI           COMMAND CHAIN,SILI              07080000
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O RCD      S20201 07084020
*                                       READY                    S20201 07088020
         BO    SOP8RD7                  BRANCH IF YES            S20201 07092020
         LR    RC,RF                    GET IOB PTR              S20201 07096020
         AR    RC,RE                    INCR TO NEXT IOB         S20201 07100020
         SR    RC,RDEB                  BACK UP ONE DW           S20201 07104020
         MVI   D15(RB),ATE8                                      S20201 07108020
SOP8RD7  EQU   *                                                 S20201 07112020
         ST    RC,D8(RB)                ADDRESS                  S20201 07116020
         MVI   8(RB),READCOUN           READ COUNT OP CODE              07120000
         AR    RB,RDEB                  INCREMENT PTR            S20201 07126020
         TM    JFCBMSK6,JFCSDRPS        SEARCH DIRECT            YA3136 07128002
         BO    SOP8RD8                  YES, READ DATA CCW       YA3136 07130002
*                                        BEFORE READ COUNT CCW   YA3136 07130402
         AR    RB,RDEB                  INCR PTR                 S20201 07132020
SOP8RD8  EQU   *                                                        07134002
         SR    RB,RF                    GET RD CCW OFFSET        S20201 07138020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07138402
         STC   RB,DCBOFFSR              PUT IN DCB               S20201 07144020
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 07144402
         AR    RB,RF                    RESTORE PTR              S20201 07150020
*                                                                       07160000
SOP8RD10 CLI   DCBKEYLE,MINKEY          ARE KEYS SPECIFIED              07180000
         BC    4,SOP8RD15               BRANCH ON NO (LESS THAN 1)      07200000
         MVI   0(RB),READKEDA           READ KEY AND DATA OP CODE       07220000
         B     SOP8RD18                 SKIP                       DM0I 07240000
SOP8RD15 MVI   0(RB),READATA            READ DATA OP CODE               07260000
SOP8RD18 TM    DCBRECFM,UFORMAT         U FORMAT SPECIFIED              07280000
         BNM   SOP8RDU                  BRANCH IF U FORMAT       S20201 07288020
         TM    DCBRECFM,VFORMAT          IS IT V FORMAT          S20201 07296020
         BNO   SOP8RD20                 IF NOT, DONT SET SILI    S20201 07304020
SOP8RDU  EQU   *                                                 S20201 07312020
         MVI   4(RB),SILI               SILI FLAG                       07320000
SOP8RD20 LA    RB,8(0,RB)               INCREMENT CCW POINTER           07340000
         BR    RD                       EXIT                       DM0I 07360000
*                                                                       07380000
*********************************************************************** 07400000
*                                                                       07420000
*                                                                       07440000
*********************************************************************** 07460000
*                                                                       07480000
*    THIS SECTION OF CODE BUILDS A SEARCH AND TIC CCW                 * 07500000
*                                                                       07520000
*                                                                       07540000
*    RC POINTS TO SEARCH ADDRESS-- RB POINTS TO NEXT CCW ON ENTRY     * 07560000
*   RB IS NOT CHANGED IN ROUTINE.-- RD  IS  RETURN--                  * 07580000
*                                                                     * 07600000
*********************************************************************** 07620000
SOP8SRTC ST    RC,0(0,RB)              SEARCH ADDRESS                   07640000
         MVI   0(RB),SRCHE             SEARCH OP CODE                   07660000
         MVI   7(RB),FIVE              COUNT                            07680000
         MVI   4(RB),COMCHAIN          COMMAND CHAIN                    07700000
*                                                                       07720000
*    TIC                                                                07740000
*                                                                       07760000
         LA    RC,5(0,RC)              SEARCH ADDRESS                   07780000
         ST    RB,8(0,RB)              TIC TO SEARCH                    07800000
         MVI   8(RB),TIC               TIC OP CODE                      07820000
         BR    RD                       EXIT                       DM0I 07840000
*********************************************************************** 07860000
*                                                                       07861020
* THIS RTN BUILDS SET THETA COMMANDS, RB POINTS TO CCW                  07862020
*                                                                       07863020
SOP8STA  EQU   *                                                 S20201 07864020
         L     RC,DXCCW11               GET SET THETA ADDR       S20201 07865020
         ST    RC,D0(RB)                PUT IN CCW               S20201 07866020
         OI    FLAGOFF(RB),CC           TURN ON COMMAND CHAIN    S20201 07867020
*                                       FLAG                     S20201 07868020
         MVI   CNTOFF(RB),ONE           SET COUNT TO ONE         S20201 07869020
         MVI   D0(RB),SETSC             PUT IN COMMAND           S20201 07870020
         AR    RB,RDEB                  INCREMENT PTR            S20201 07871020
         BR    RD                       RETURN                   S20201 07872020
*******************************************************************     07895020
***                                                                     07896020
CON1     DC    H'1'                     CONSTANT OF ONE          S20201 08350020
         SPACE 2                                                        08360000
EGHT     EQU   8                                                   DM0I 08380000
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 08390002
         SPACE 2                                                        08400000
         EJECT                                                          08450003
CVT      DSECT                                                 @Z30TSCF 08500003
         CVT                                                   @Z30TSCF 08550003
         EJECT                                                          08580002
         IECDSECS  (MAIN,(IOB,NO)),DCB,IOB,WTG,PREFX,EXPAND=YES         08610003
*                                                              @Z30TSCF 08610403
         ORG   WTGIDTTR                                          Y02072 08612002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 08614002
FORCORE  DSECT                                                          08614102
         ORG   JFCBMASK                                                 08614202
         DS    6B                                                       08614302
JFCBMSK6 DS    B                        SIXTH BYTE OF JFCB MASK         08615102
         EJECT                                                          08616802
FORCORE  DSECT                                                   Y02072 08617602
         IHAFCAUD  ORG=YES                                       Y02072 08618402
DCBKEYL  EQU   DCBKEYLE                                                 08620000
         END                                                            09220000
./  ADD  SSI=71240564,NAME=IGG0191K
         TITLE ' IGG0191K INPUT DA EXECUTOR FOR PCI SCHEDULING'  S20201 00010020
IGG0191K CSECT                                                          00023000
*MODULE NAME - IGG0191K                                          Y02072 00023402
*                                                                       00023802
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00024202
*                                                                       00024602
*COPYRIGHT - NONE                                                Y02072 00024702
*                                                                       00024802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00024902
*                                                                       00026802
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00028702
*000550,011000,052600,067800,068900-068950,077200,119600,129118, Y02072 00030602
*129306,133200,134800,143000,146400,161300                       Y02072 00040602
*                                                                YM2424 00050602
*                                                                YM4697 00052602
*                                                                YM6583 00052702
*                                                                YM7595 00054702
*                                                                       00056703
*          VS2 RELEASE 3 DELETIONS                                      00057103
*                                                              @Z30TSCF 00060103
*          RELEASE 20 DELETIONS                                         00064003
*1242000200,031400,040800-041000,050000-051000,055400-055600,    S20201 00067003
*1242056800-059800,068600-069000,084200,085800-086000,097200-    S20201 00070003
*1242097600,097800,099200-099400,101200-117600,120200,121000-    S20201 00073003
*1242121200,125400-125800                                        S20201 00076003
*          RELEASE 21 DELETIONS                                         00079003
*0216005200,134400,140800-141400,149810-149930,161200-161400     S21042 00082003
*                                                                       00085003
*STATUS CHANGE LEVEL 005                                                00088003
*                                                                       00091003
*FUNCTION/OPERATION -- THIS EXECUTOR BUILDS THE MAIN IOB & ICBS THAT    00094003
*                      WILL CONTROL THEIR ASSOCIATED CHANNEL PROGRAMS.  00097003
*                      IT ALSO CONSTRUCTS INPUT OR OUTPUT CHANNEL PROG. 00100000
*                      AND FILLS IN DEVICE DEPENDANT FIELDS IN THE DCB. 00120000
*                      FOR QSAM THE CHANNEL PROGRAMS INCLUDE THE BUFFER 00140000
*                      ADDRESS,THE PHYSICAL BLOCK SIZE AND ASSC FLAGS.  00160000
*                      ALL ICBS ARE LINKED TOGETHER                     00180000
*                      THE GETMAIN MACRO IS USED TO OBTAIN SPACE FOR    00200000
*                      THE IOB & ICBS.                                  00220000
*                      IT SETS AN AUDIT TRAIL BIT IN THE OPEN    Y02072 00230002
*                      WORKAREA INDICATING TO FORCE CLOSE THAT   Y02072 00232002
*                      THE CORE GETMAINED FOR THE IOB'S CAN BE   Y02072 00234002
*                      FREEMAINED.                               Y02072 00236002
*                                                                       00260000
*ENTRY POINTS  -   ENTERED AT IGG0191K FROM THE LEVEL ONE               00280000
*                      EXECUTOR IGG0191B VIA THE XCTL MACRO             00300000
*                                                                       00320000
*INPUT SUPPLIED-   USER DCB AND OPEN PARAMETERS -- SEE REGISTER USAGE   00340000
*                                                                       00360000
*OUTPUT GIVEN  -   MAIN IOB , ICBS AND CHANNEL PROGRAMS , DCB INITIAL   00380000
*                                                                       00400000
*                                                                       00420000
*EXTERNAL RTS. -   NONE                                                 00440000
*                                                                       00460000
*EXITS-NORMAL: XCTL TO IGG01910(IECOSLDA)    TO LOAD ROUTINES           00480000
*                                                                       00500000
*EXITS-ERROR: XCTL TO PROBLEM DETERMINATION FOR WTP AND 013 ABEND       00520021
*                                                                       00530002
*MACROS : ACTION - MODESET, GETMAIN, XCTL, XCTLTABL, DMABCOND    Y02072 00532002
*                                                                       00534002
*MACROS : MAPPING - IECDSECS, IEZIOB, IHAICB, IHACCW, IKJTCB,    Y02072 00536002
*                   IEZDEB, DCBD, IHAFCAUD, IGGBCB               Y02072 00538002
*                                                                       00540000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00560000
*                                                                       00580000
*      BYTE  0-7  NAME                                                  00600000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00620000
*      BYTE 11    CONCATENATION NUMBER                                  00640000
*      BYTE 12    ZERO                                                  00660000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00680000
*                        ALIAS INDICATOR 1 BIT                          00700000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00720000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00740000
*      BYTE 17    ZERO                                                  00760000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00780000
*      BYTE 20    TRANSLATION TABLE                                     00800000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00820000
*      BYTE 22-23 ATTRIBUTES                                            00840000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00860000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00880000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00900000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00920000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00940000
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        00960000
*      BYTE 36-39 TABLE OF IDTTR'S                                      00980000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          01000000
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          01020000
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01040000
*                   NOT USED                         (1 BYTE)           01060000
*                                                                       01080000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN USER KEY               Y02072 01100002
*            UNLESS OTHERWISE SPECIFIED, SUPER STATE             Y02072 01110002
*                                                                       01120000
*                                                                       01140000
*********************************************************************** 01160000
*                                                                       01180000
*                                                                       01200000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01220000
*                                                                       01240000
*********************************************************************** 01260000
*                                                                       01280000
RDCB     EQU   2         DCB REGISTER                                   01300000
RBASE    EQU   3         BASE REGISTER                                  01320000
RCORE    EQU   4         WORK AREA ADDRESS                              01340000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01360000
RWTG     EQU   6         TOP OF WTG TABLE                               01380000
RPARC    EQU   7         CURRENT PARAMETER                              01400000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01420000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01440000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01460000
RWK1     EQU   RUCB                     WORK REGISTER            Y02072 01470002
RDEB     EQU   11        DEB ADDRESS                                    01480000
RWK2     EQU   RDEB                     WORK REGISTER            Y02072 01490002
RB       EQU   12        WORK REG1  **                                  01500000
RWK3     EQU   RB                       WORK REGISTER            Y02072 01510002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01520000
RBUFADR  EQU   RC        ADDR OF NEXT AVAILABLE BUFFER           YM7595 01530002
RD       EQU   14        WORK REG3  **                                  01540000
RWK5     EQU   RD                       WORK REGISTER            Y02072 01550002
RJ       EQU   15        WORK REG4                                      01560000
RE       EQU   0         WORK REG5                                      01580000
RF       EQU   1         WORK REG6                                      01600000
RWK6     EQU   RF                       WORK REGISTER            Y02072 01610002
*                                                                       01620000
*                                                                       01640000
PARAR    EQU   RPARC                                                    01660000
*                                                                       01680000
*********************************************************************** 01700000
*                                                                       01720000
*                                                                       01740000
*                                                                       01760000
*********************************************************************   01780000
* MASK'S TO TEST PARAMETER LIST WITH                                    01800000
INP      EQU   X'0F'                                                    01820000
OUTP       EQU   X'0F'                                                  01840000
UPDATE     EQU   X'04'                                                  01860000
INOUT      EQU   X'03'                                                  01880000
OUTIN      EQU   X'07'                                                  01900000
RDBACK     EQU   X'01'                                                  01920000
*                                                                       01940000
*                                                                       01960000
*********************************************************************   01980000
*                                                                       02000000
*                                                                       02020000
* OFFSET FOR PARAMETER TESTS                                            02040000
*                                                                       02060000
ONE        EQU   X'01'                                                  02080000
FRTYATE    EQU   48                                                     02100000
DISPSN     EQU   X'0'                                                   02120000
*                                                                       02140000
*                                                                       02160000
*********************************************************************   02180000
*                                                                       02200000
* OFFSETS FOR DEB REFERENCE                                             02220000
*                                                                       02240000
*                                                                       02260000
*                                                                       02280000
*                                                                       02300000
*                                                                       02320000
*********************************************************************   02340000
*                                                                       02360000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              02380000
*                                                                       02400000
*                                                                       02420000
*                                                                       02440000
DOUBLE     EQU   X'01'                                                  02460000
*                                                                       02480000
*                                                                       02500000
STOWB      EQU   X'80'                                                  02520000
WRTCK    EQU   X'80'                                                    02540000
OVRFLO     EQU   X'20'                                                  02560000
PCIB     EQU   X'20'                                                    02580000
MINKEY     EQU   X'01'                                                  02600000
CONCAT     EQU   X'FF'                                                  02620000
SRCHDIRB EQU   X'40'                                                    02640000
ONONYES  EQU   X'0C'                                                    02660000
*                                                                       02680000
*********************************************************************   02700000
*                                                                       02720000
* MASKS FOR ACCESS METHODS IN SAM                                       02740000
*                                                                       02760000
QSAMB      EQU   X'01'                                                  02780000
BSAMBIT    EQU   X'00'                                                  02800000
PAM        EQU   X'02'                                                  02820000
*                                                                       02840000
*                                                                       02860000
* MASKS FOR MACRO'S TO BE USED                                          02880000
*                                                                       02900000
GETB       EQU   X'40'                                                  02920000
PUTB       EQU   X'40'                                                  02940000
READB      EQU   X'20'                                                  02960000
WRITEB     EQU   X'20'                                                  02980000
POINTB     EQU   X'04'                                                  03000000
CNTRLB     EQU   X'02'                                                  03020000
*                                                                       03040000
*                                                                       03060000
*********************************************************************   03080000
*                                                                       03100000
* MASKS FOR DEVICES TO BE SUPPORTED                                     03120000
NORCDRY  EQU   X'20'                    NO RECORD READY MASK     S20201 03140020
*                                                                       03160000
*                                                                       03180000
*********************************************************************   03200000
*                                                                       03220000
* MASKS FOR STATUS BITS TO BE TESTED                                    03240000
*                                                                       03260000
*                                                                       03280000
EXCPN      EQU   X'30'                                                  03300000
COMPLETE EQU   X'60'                                                    03320000
FIRSTIOB   EQU   X'01'                                                  03340000
*                                                                       03360000
*                                                                       03380000
*                                                                       03400000
*********************************************************************   03420000
*                                                                       03440000
* MASKS FOR BUFFER TECHNIQUE'S                                          03460000
*                                                                       03480000
EXCHANGB   EQU   X'10'                                                  03500000
SIMPLEB    EQU   X'40'                                                  03520000
*                                                                       03540000
*********************************************************************   03560000
*                                                                       03580000
*                                                                       03600000
* MODES OF OPERATION FOR QSAM                                           03620000
*                                                                       03640000
LOCATEB    EQU   X'08'                                                  03660000
MOVEB      EQU   X'10'                                                  03680000
SUBSTUTB   EQU   X'04'                                                  03700000
*                                                                       03720000
*                                                                       03740000
*********************************************************************   03760000
*                                                                       03780000
*                                                                       03800000
* COMMAND BYTES FOR THE 2841                                            03820000
*                                                                       03840000
*       CONTROL UNIT                                                    03860000
*                                                                       03880000
*                                                                       03900000
*                                                                       03920000
SRCHE      EQU   X'31'                                                  03940000
WRTCKD     EQU   X'1D'                                                  03960000
RDC        EQU   X'92'                                                  03980000
RDKD       EQU   X'8E'                                                  04000000
RDD        EQU   X'86'                                                  04020000
NOP      EQU   X'03'                                                    04040000
TIC        EQU   X'08'                                                  04060000
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      S20201 04070020
RDSC     EQU   X'22'                    RD SECTOR CCW CMND       S20201 04080020
TICNOP   EQU   X'88'                    RCD READY TIC NOP        S20201 04090020
*                                                                       04100020
*                                                                       04110020
*********************************************************************   04120000
*                                                                       04140000
*                                                                       04160000
* MASKS FOR RECORD FORMATS                                              04180000
*                                                                       04200000
*                                                                       04220000
STANDRDF   EQU   X'08'                                                  04240000
FORMATU    EQU   X'C0'                                                  04260000
FORMATF    EQU   X'80'                                                  04280000
FORMATV    EQU   X'40'                                                  04300000
BLOCKED    EQU   X'10'                                                  04320000
FSTANDRD EQU   X'88'                                                    04340000
FIXBKD   EQU   X'90'                                                    04360000
NOTPNTID EQU   X'05'                                                    04380000
FORMATVS EQU X'48'    VARIABLE SPANNED                           M3641  04390019
*                                                                       04400000
*                                                                       04420000
*********************************************************************   04440000
*                                                                       04460000
*                                                                       04480000
*   CHANNEL CONTROL WORD FLAGS                                          04500000
*                                                                       04520000
SKIP       EQU   X'10'                                                  04540000
SLI        EQU   X'20'                                                  04560000
PCI      EQU   X'08'                                                    04580000
CC         EQU   X'40'                                                  04600000
DATACH     EQU   X'A0'                                                  04620000
SLICC      EQU   X'60'                                                  04640000
SLICCSK    EQU   X'70'                                                  04660000
*                                                                       04680000
*                                                                       04700000
*********************************************************************   04720000
*                                                                       04740000
*                                                                       04760000
KEYS       EQU   X'01'                                                  04780000
QSAM       EQU   X'01'                                                  04800000
*                                                                       04820000
*                                                                       04840000
*********************************************************************   04860000
*                                                                       04880000
COMMTABL EQU   16                                                       04900000
OABD065  EQU   65                                                S21042 04910021
*                                                                       04920000
*********************************************************************   04940000
*                                                                       04960000
*                                                                       04980000
*                                                                       04985020
* MISCELLANEOUS EQUATES AND DISPLACEMENTS                               04990020
*                                                                       04995020
D0       EQU   0                        DISPLACEMENT OF 0        S20201 05000020
D1       EQU   1                        DISPLACEMENT OF 1        S20201 05005020
D2       EQU   2                        DISPLACEMENT OF 2        S20201 05010020
D3       EQU   3                        DISPLACEMENT OF 3        S20201 05015020
D4       EQU   4                        DISPLACEMENT OF 4        S20201 05020020
D5       EQU   5                        DISPLACEMENT OF 5        S20201 05025020
D6       EQU   6                        DISPLACEMENT OF 6        S20201 05030020
D7       EQU   7                        DISPLACEMENT OF 7        S20201 05035020
D8       EQU   8                        DISPLACEMENT OF 8        S20201 05040020
D15      EQU   15                       DISPLACEMENT OF 15       S20201 05045020
*                                                                       05050020
D40      EQU   40                       DISPLACEMENT OF 40       S20201 05055020
D51      EQU   51                       DISPLACEMENT OF 51       S20201 05060020
D52      EQU   52                       DISPLACEMENT OF 52       S20201 05065020
*                                                                       05070020
B0       EQU   0                        BYTE COUNT OF 0          S20201 05075020
B1       EQU   1                        BYTE COUNT OF 1          S20201 05080020
B3       EQU   3                        BYTE COUNT OF 3          S20201 05085020
B8       EQU   8                        BYTE COUNT OF 8          S20201 05090020
B16      EQU   16                       BYTE COUNT OF 16         S20201 05095020
*                                                                       05100020
IOBCEXCP EQU   X'80'                    IOBCNOPA FLAG            YM6583 05102002
RRRDNOP  EQU   64                       RCD READYS READ NOP      S20201 05105020
*                                       OFFSET                   S20201 05110020
*                                                                       05115020
*                                                                       05120000
*                                                                       05140000
         BALR  RBASE,0                  REG 3 IS BASE                   05160000
         USING SOPA,RBASE               ESTABLISH BASE REGISTER         05180000
         USING IHADCB,RDCB              REG 2 IS DCB                    05200000
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR         05240000
*                                                                       05280000
*                                                                       05300000
SOPA     EQU   *                        FOR ADDRESSABILITY              05320000
*                                                                       05340000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 05350002
         DC    C'IGG0191K'              MODULE NAME              Y02072 05352002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 05354003
         DC    C'10/17/74'              LAST DATE MODIFIED     @Z30TSCF 05356003
BEGIN    DS    0H                                                Y02072 05358002
*                                                                       05360000
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 05380000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   05400000
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESS           05420000
*                                                                       05440000
         SR    RC,RC                    READY A WORK REG                05460000
         SR    RDEB,RDEB                                                05480000
*                                                                       05500000
*                                                                       05520000
*                                                                       05580000
         ST    RC,DCBCNTRL                                              05600000
         SR    RTIOT,RTIOT                                              05620000
         IC    RTIOT,DCBNCP             GET NUMBER OF ICBS TO BUILD     05640000
*                                                                       05660000
*                                                                       06000000
SOPA003  EQU   *                                                        06020000
*                                                                       06040000
         LA    RF,64                    CONSTANT SIZE FOR ICB & CP.     06060000
*                                                                       06062020
* CHECK FOR RCD READY AND IF TO BE USED INCR ICB SIZE                   06064020
*                                                                       06066020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06068020
*                                       READY                    S20201 06070020
         BO    SOPA03A                  BRANCH IF YES            S20201 06072020
         LA    RF,B8(RF)                INCR ICB SIZE            S20201 06074020
SOPA03A  EQU   *                                                 S20201 06076020
         MVI   DCBCNTRL+3,2             STORE INDEX FACTOR FOR PCI EOB  06080000
         TM    DCBMACRF,POINTB          NOTE/POINT TO BE USED           06100000
         BC    8,SOPA007                NO BRANCH                       06120000
*                                                                       06140000
SOPA005  EQU   *                                                        06160000
*                                                                       06180000
         MVI   DCBCNTRL+1,5             STORE INDEX FOR NOTE-POINT ID   06200000
*                                                                       06220000
SOPA007  EQU   *                                                        06240000
*                                                                       06260000
         TM    DCBCIND2,QSAMB           IS QSAM BEING USED              06280000
         BC    8,SOPA009                NO BRANCH                       06300000
*                                                                       06320000
         IC    RTIOT,DCBBUFNO           GET NO. OF ICBS TO GENERATE     06340000
SOPA009  EQU   *                                                        06360000
*                                                                       06380000
         LTR   RTIOT,RTIOT              HAS NO OF CPS BEEN SPECIFIED    06400000
         BC    8,NOPCI                  N O BRANCH                      06420000
         CH    RTIOT,CONONE             DOES BUFFER NO  = 1             06440000
*                                                                       06460000
         BC    8,NOPCI                  YES BRAN CH                     06480000
*                                                                       06500000
*                                                                       06520000
SOPA011  EQU   *                                                        06540000
*                                                                       06560000
         LR    RE,RF                    COPY ICB SIZE                   06580000
         SRL   RE,3                     DIVIDE BY EIGHT                 06600000
         STC   RE,DCBIOBL               SAVE FOR CLOSE                  06620000
         LR    RE,RTIOT                 PREPARE TO COMPUTE SPACE REQ.   06640000
         MR    RE,RE                    NO. ICBS BY THEIR SIZE          06660000
         LA    RF,80(RF)                ADD SPACE FOR MAIN IOB          06680000
*                                                                       06682020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06684020
*                                       READY                    S20201 06686020
         BO    SOPA11A                  BRANCH IF YES            S20201 06688020
         LA    RF,B16(RF)               INCR MAIN IOB FOR SET    S20201 06690020
*                                       SECTS                    S20201 06692020
*                                       AND THETA VALUES                06694020
SOPA11A  EQU   *                                                 S20201 06696020
*                                                                       06698020
         LR    RB,RF                    SAVE FOR CLEARING RT.           06700000
         OI    DCBCIND2,DCBCNCHS        SET TRUE PCI INDICATOR   YM4697 06710002
*                                                                       06720000
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE      YM4697 06730002
*  IOB AND ICBS IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE     YM4697 06732002
*  EXECUTOR.                                                     YM4697 06734002
*                                                                       06736002
         ST    RF,DXATEXC2              SAVE LENGTH              YM4697 06738002
**********************************************************************  06740000
*                                                                       06760000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06770002
         GETMAIN R,LV=(RF),SP=0                                  Y02072 06780002
*                                                                       06800000
**********************************************************************  06840000
*                                                                       06845020
* OBTAIN AND TEMP SAVE THETA ADDRS MAY BE USED LATER                    06850020
*                                                                       06855020
         LR    RJ,RB                    GET AREA LENGTH          S20201 06860020
         AR    RJ,RF                    OBTAIN LAST AREA+1 ADDR  S20201 06865020
         LA    RE,B8                    CONSTANT                 S20201 06870020
         SR    RJ,RE                    BACK UP ONE DW           S20201 06875020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06877002
         ST    RJ,DXCCW11               TEMP STORE SET SECTORS   S20201 06880020
*                                       THETA ADDR                      06885020
**                                                                      06940000
*    THIS SECTION CLEARS THE SPACE RECIEVED FROM GETMAIN                06960000
**                                                                      06980000
*                                                                       07000000
         LR    RJ,RB                    RESTORE LENGTH TO CLEAR         07020000
         ST    RF,DCBIOBAD              STORE MAIN IOB ADDRESS          07040000
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 07050002
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 07052002
         BCTR  RJ,0                     REDUCE AMT BT ONE               07060000
         LA    RB,255                   GET MAX AMT CAN CLEAR           07080000
COMPARE  CR    RJ,RB                    IS AMT TO CLEAR GREATER 255     07100000
         BC    12,ONECLEAR              NO BRANCH                       07120000
*                                                                       07140000
         EX    RB,CLEAR                 CLEAR 256 BYTES                 07160000
         SR    RJ,RB                    SUBT 255 FROM AMT TO BE CLEARED 07180000
         BCTR  RJ,0                     SUBT ONE MORE BYTE              07200000
         LA    RF,256(RF)               UPDATE AREA ADDR BY 256         07220000
         B     COMPARE                                                  07240000
*                                                                       07260000
CLEAR    XC    0(1,RF),0(RF)            ACTUAL CLEAR INSTRUCTION        07280000
*                                                                       07300000
ONECLEAR EX    RJ,CLEAR                 CLEARS LESS THAN 256            07320000
*                                                                       07340000
*                                                                       07360000
*                                                                       07380000
         L     RB,DCBIOBAD              GET MAIN IOB ADDRESS            07400000
         LR    RC,RB                    SET UP WORK REG                 07420000
         LR    RD,RB                    SET UP WORK REG                 07440000
*                                                                       07460000
*                                                                       07480000
*    THIS SECTION OF CODE WILL BUILD THE MAIN IOB & CHANNEL PROGRAM     07500000
*                                                                       07520000
SOPA013  EQU   *                                                        07540000
*                                                                       07560000
         LA    RUCB,80(RB)              POINT TO FIRST ICB              07580000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 07583020
*                                       READY                    S20201 07586020
         BO    SOPA13AX                 BRANCH IF YES            S20201 07589020
         LA    RUCB,B8(RUCB)            INCR FOR RD SECTOR       S20201 07592020
SOPA13AX EQU   *                                                 S20201 07595020
         ST    RUCB,8(RB)               STORE IN MAIN IOB               07600000
         LA    RD,4(RB)                 POINT TO ECB IN MAIN IOB        07620000
*                                                                       07640000
         MVI   0(RD),X'7F'              POST MAINIOB COMPLETE           07660000
*                                                                       07680000
         LA    RF,56(RB)                POINT TO CP START ADDRESS       07700000
         USING IOBQSAMC,RWK3                                     Y02072 07710002
         ST    RD,IOBECBPT              ECB ADDR TO IOB          Y02072 07720002
         ST    RF,IOBSTART              CHAN PGM ADDRESS TO IOB  Y02072 07730002
         L     RWK2,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 07732002
         ST    RWK2,IOBDCBPT            DCB ADDRESS TO IOB       Y02072 07734002
         DROP  RWK3                                              Y02072 07736002
         MVC   48(8,RB),DCBFDAD         MOVE D.A. ADDRESS TO MAIN IOB   07740000
         LA    RUCB,51(RB)              POINT TO CCHHR IN MAIN IOB      07760000
*                                                                       07761020
* CHECK FOR RCD READY AND IF USED BUILD SET SECTOR                      07762020
*                                                                       07763020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 07764020
*                                       READY                    S20201 07765020
         BO    SOPA13A                  BRANCH IF YES            S20201 07766020
         L     RDEB,DXCCW11             GET SET SECTOR ADDR      S20201 07767020
         ST    RDEB,D0(RF)              PUT IN CCW               S20201 07768020
         MVI   D0(RF),SETSC             PUT SET SECT CCW CMND    S20201 07769020
         OI    D4(RF),CC                TURN ON CMND CHAIN       S20201 07770020
         MVI   D7(RF),B1                BYTE CNT EQS ONE         S20201 07771020
         LA    RB,B8(RB)                INCREMENT BY EIGHT       S20201 07772020
SOPA13A  EQU   *                                                 S20201 07773020
*                                                                       07774020
         ST    RUCB,56(RB)              STORE IN SRCH CCW               07780000
         MVI   56(RB),SRCHE             STORE SRCH EQUAL CMD BYTE       07800000
         LA    RUCB,56(RB)              POINT TO SRCH CCW               07820000
         ST    RUCB,64(RB)              STORE IN TIC CCW                07840000
         MVC   60(5,RB),SCCWCNST        STORE CC FLG,LEN = 5 ,TIC OP    07860000
*                                       IN TIC                          07875018
*                                                                       07880000
*                                                                       07900000
SOPA015  EQU   *                                                        07920000
*                                                                       07940000
         MVI   72(RB),TIC               STORE TIC CMD BYTE              07960000
*                                                                       07980000
*                                                                       08000000
         LA    RB,80(RB)                POINT TO FIRST ICB              08020000
         MODESET  EXTKEY=DATAMGT        DATA MANAG KEY FOR ST    Y02072 08030002
         ST    RB,DCBIOBA               STORE ICB ADDRESS               08040000
         MODESET  KEYADDR=DXUKEY,WORKREG=11  BACK TO USER KEY    Y02072 08050002
         LR    RC,RB                    COPY ICB ADDRESS                08060000
*                                                                       08080000
*                                                                       08100000
ICBLOOP  EQU   *                                                        08120000
*                                                                       08140000
*                                                                       08160000
         LTR   RTIOT,RTIOT              HAVE ALL ICBS BEEN GENERAED     08180000
         BC    8,SOPAEND                YES BRANCH                      08200000
*                                                                       08220000
*                                                                       08240000
************** CONSTRUCTION OF ICB & CP COMMENCE ********************** 08260000
*                                                                       08280000
*                                                                       08300000
         ST    RC,0(RB)                 STORE NEXT ICBAD IN LINK FLD.   08320000
         LR    RB,RC                    UPDATE TO NEXT ICB              08340000
         LA    RC,4(RB)                 POINT TO ECB IN ICB             08360000
         ST    RC,12(RB)                STORE ECB ADDRESS IN ICB        08380000
         MVI   4(RB),X'7F'              POST ECB COMPLETE FOR NOW       08400000
         LA    RC,D40(RB)               GET ICB CHP ADDR         S20201 08420020
         ST    RC,24(RB)                STORE CP ADDRESS IN ICB         08440000
         MVC   32(8,RB),DCBFDAD         STORE D.A. ADDRESS IN ICB       08460000
*                                                                       08480000
*                                                                       08500000
*        NOTE THAT THE DCB ADDRESS IS NOT STORED IN THE ICB             08520000
*                                                                       08540000
*                                                                       08560000
*                                                                       08620000
*                                                                       08640000
SOPA017  EQU   *                                                        08660000
*                                                                       08680000
*                                                                       08700000
SOPA019  EQU   *                                                        08720000
*                                                                       08740000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08752002
         MVI   DCBOFFSR,48              STORE READ DATA CCW OFFSET      08760000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 08762002
         L     RUCB,DCBIOBAD                                            08780000
         MVI   2(RUCB),56               STORE READ NOP OFFSET           08800000
         LA    RE,99(RB)                POINT TO NEXT ICBS CCHHR FLD    08820000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 08822020
*                                       READY                    S20201 08824020
         BO    SOPA19A                  BRANCH IF YES            S20201 08826020
         LA    RDEB,B8                  CONSTANT                 S20201 08828020
         AR    RE,RDEB                  INCR CCHHR PTR FOR RD    S20201 08830020
*                                       SECT                     S20201 08832020
SOPA19A  EQU   *                                                 S20201 08834020
*                                                                       08836020
         ST    RE,40(RB)                STORE IN THE CURR RD CNT CCW    08840000
         MVI   40(RB),RDC               STORE READ CMD BYTE (COUNT)     08860000
         MVC   44(4,RB),CCWCNSTS        STORE PCI,CC,SILI FLGSAND LEN   08880000
*                                                                       08890002
* MUST TEST FOR VIRTUAL ENVIRONMENT.  IF YES, TURN PCI FLAG OFF  Y02072 08892002
* IN CHAN PGM.  IF NO, LEAVE PCI FLAG ON.                        Y02072 08894002
*                                                                       08896002
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02072 08898002
         USING DEBBASIC,RDEB                                     Y02072 08898402
         L     RWK2,DEBTCBAD            GET THE TCB ADDRESS      Y02072 08898802
         DROP  RDEB                                              Y02072 08899202
         USING TCB,RWK2                                          Y02072 08899602
         TM    TCBFLGS6,TCBRV           JOB RUNNING VIRTUAL      Y02072 08899702
         BO    SOPA19C                  NO, LEAVE PCI ON         Y02072 08899802
         USING ICB,RWK3                                          Y02072 08899902
         NI    CCWFLGS,X'FF'-CCWPCI     YES, TURN PCI OFF        Y02072 08906602
         DROP  RWK3                                              Y02072 08908602
         DROP  RWK2                                              Y02072 08910602
SOPA19C  MVI   48(RB),RDD               STORE READ DATA CMD BYTE Y02072 08913302
         OI    52(RB),SLICC             TURN ON SILI AND CC FLAGS       08920000
         TM    DCBRECFM,X'C0'           U  TYPE RECORDS                 08940000
         BC    9,SOPA020A               YES  BRANCH                     08960000
*                                                                       08980000
         TM    DCBRECFM,X'40'           V  RECORDS                      09000000
         BC    1,SOPA020A               YES  BRANCH                     09020000
*                                                                       09040000
*                                                                       09060000
SOPA020  EQU   *                                                        09080000
*                                                                       09100000
         NI    52(RB),X'DF'             TURN SILI FLAG OFF              09120000
*                                                                       09140000
SOPA020A EQU   *                                                        09160000
*                                                                       09180000
*                                                                       09200000
         TM    DCBCIND2,QSAMB           DCB USING QSAM                  09220000
         BC    8,SOPA021                NO BRANCH                       09240000
*                                                                       09260000
         LA    RUCB,48(RB)              POINT TO READ DATA CCW          09280000
*                                                                       09290002
* THE FOLLOWING PUTS BUFFER ADDRESS AND BYTE COUNT IN CCW               09300002
*                                                                       09310002
         L     RWK6,DCBBUFCB            ADDR BUF CNTRL BLOCK     YM7595 09320002
         USING BCBLK,RWK6                                               09330002
         L     RBUFADR,BCBBUFPT         ADDR NEXT AVAIL BUFFER   YM7595 09340002
         LTR   RBUFADR,RBUFADR          BUFFER ADDR VALID        YM7595 09350002
         BZ    ABEND                    NO, GO ISSUE DMABCOND    YM7595 09352002
         USING BUFFER,RBUFADR                                           09354002
         MVC   BCBBUFAD,BUFNXPTB        UPDATE WITH NEXT AVAIL   YM7595 09356002
         USING CCW,RUCB                                                 09358002
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 09358402
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 09358802
         DROP  RUCB,RWK6,RBUFADR                                        09359202
         B     ICBCOMPT                                                 09360000
*                                                                       09380000
SOPA021  EQU   *                                                        09400000
*                                                                       09420000
         SR    RE,RE                                                    09440000
         IC    RE,DCBKEYLE              GET KEY LEN IF SPECIFIED        09460000
         LTR   RE,RE                    ARE KEYS SPECIFIED ?            09480000
         BC    8,ICBCOMPT               NO  BRANCH                      09500000
         MVI   48(RB),RDKD              STORE READ KEY&DATA CMD BYTE    09520000
*                                                                       09540000
ICBCOMPT EQU   *                                                        09560000
*                                                                       09580000
         LA    RD,56(RB)                POINT TO NOP CCW                09600000
         LA    RC,64(RB)                POINT TO NEXT POSSIBLE ICB      09620000
*                                                                       09640000
SOPA023  EQU   *                                                        09660000
*                                                                       09680000
ICBCOMON EQU   *                                                        09700000
*                                                                       09708020
* CHECK FOR RCD READY AND IF USED BUILD RD SECTOR                       09716020
*                                                                       09724020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 09732020
*                                       READY                    S20201 09740020
         BO    SOPA023A                 BRANCH IF YES            S20201 09748020
         LA    RC,B8(RC)                INCR ICB PTR             S20201 09756020
SOPA023A EQU   *                                                 S20201 09764020
         LA    RUCB,D40(RC)             PT TO NEXT ICBS CP       S20201 09774020
*                                                                       09800000
*                                                                       09820000
         ST    RUCB,0(RD)               STORE NEXT CP ADDR IN NOP CCW   09840000
         MVI   0(RD),NOP                STORE NOP CMD BYTE              09860000
         OI    4(RD),X'20'              SET SILI ON IN CCW              09880000
         MVI   7(RD),ONE                STORE LENGTH IN CCW             09900000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 09904020
*                                       READY                    S20201 09908020
         BO    SOPA023D                 BRANCH IF YES            S20201 09912020
         L     RUCB,DXCCW11             GET RD SECTOR ADDR       Y02072 09916002
         ST    RUCB,D8(RD)              PUT IN CCW               S20201 09920020
         MVI   D8(RD),RDSC              PUT IN RD SECT CMND      S20201 09924020
         MVI   D15(RD),B1               SET BYTE CNT TO ONE      S20201 09928020
         MVC   D5(B3,RD),D1(RD)         MOVE ICB ADDR TO RH OF   S20201 09932020
*                                       CCW                      S20201 09936020
         LA    RUCB,D8(RD)              GET PTR TO RD SECT       S20201 09940020
         ST    RUCB,D0(RD)              PUT IN PREV CCW          S20201 09944020
         MVI   D0(RD),TICNOP            CHANGE CMND TO TIC       S20201 09948020
SOPA023D EQU   *                                                 S20201 09952020
*                                                                       09956020
*   AT THIS POINT A COMPLETE ICB AND CHANNEL PROGRAM IS GENERATED       09960000
*                                                                       09980000
*                                                                       10000000
*                                                                       10020000
         BCTR  RTIOT,0                  DECREMENT ICB COUNTER           10040000
         B     ICBLOOP                  REPEAT ICB LOOP                 10060000
*                                                                       10080000
*********************************************************************** 10100000
*                                                                       11780000
*                                                                       11800000
*                                                                       11820000
SOPAEND  EQU   *                                                        11840000
         SPACE                                                          11850002
         MODESET  EXTKEY=DATAMGT                                        11860002
         SPACE                                                          11870002
         OI    FCAOPEN2,FCAOIOBC        INDIC ICBS COMPLETED     YM7595 11880002
         SPACE                                                          11890002
         MODESET  KEYADDR=DXUKEY,WORKREG=10                             11900002
         SPACE                                                          11910002
         L     RUCB,DCBIOBA             GET FIRST ICB GENERATED         11980000
         ST    RUCB,0(RB)               TIE LAST ICB TO FIRST           12000000
         LA    RDEB,D40(RUCB)           GET FRST ICB CHP ADDR    S20201 12004020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 12008020
*                                       READY                    S20201 12012020
         BO    SOPAXX                   BRANCH IF YES            S20201 12016020
         ST    RDEB,D4(RD)              PUT FIRST ICB CHP ADDR   S20201 12020020
*                                       IN                       S20201 12024020
*                                       RH OF TIC                       12028020
         B     SOPAXZ                   GO AROUND NEXT           S20201 12032020
SOPAXX   EQU   *                                                 S20201 12036020
*                                                                       12040000
         ST    RDEB,0(RD)               STORE IN NOP CCW OF LAST ICB    12060000
         MVI   0(RD),NOP                STORE NOP CMD BYTE              12080000
SOPAXZ   EQU   *                                                 S20201 12090020
*                                                                       12140000
         LA    RDEB,35(RUCB)            POINT TO FIRST ICBS CCHHR FLD   12160000
         ST    RDEB,40(RB)              STORE IN RD COUNT CCW           12180000
         MVI   40(RB),RDC               STORE READ CNT CMD BYTE         12200000
         L     RB,DCBIOBA               GET FIRST ICB                   12460000
         SR    RC,RC                                                    12480000
         L     RUCB,DCBIOBAD                                            12500000
         IC    RC,2(RUCB)               GET INPUT NOP OFFSET            12520000
*                                                                       12600000
NO       EQU   *                                                        12620000
*                                                                       12640000
         AR    RC,RB                    POIMT TO NOP CCW                12660000
*                                                                       12680000
         ST    RC,12(RUCB)              NOP ADDRESS IN MAIN IOB         12700000
         MVI   12(RUCB),IOBCEXCP        CAUSE EOB TO DO EXCP     YM6583 12710002
         MVC   32(8,RB),DCBFDAD         STORE MBBCCHHR IN ICB           12720000
         L     RB,0(RB)                 SPECIAL CONSIDERATIONS          12740000
         MVC   32(8,RB),DCBFDAD         STORE MBBCCHHR IN ICB           12760000
*                                                                       12780000
*                                                                       12800000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12810002
         TM    DCBDSORG,DCBDSGPO        DCB USING PAM            Y02072 12814002
         BZ    SOPAEND2                 NO BRANCH                Y02072 12816002
         MVI   NTPTINDX+1,5             STORE INDEX FOR          Y02072 12818002
*                                         NOTE-POINT ID          Y02072 12818402
*********************************************************************** 12820000
*                                                                       12880000
*        SELECT 3RD STAGE EXECUTOR                                      12884019
*                                                                       12884402
SOPAEND2 EQU   *                                                        12897702
         USING FORCORE,RCORE                                            12899702
         TM    DCBRECFM,FORMATVS           VARIABLE/SPANNED TEST A28683 12902402
         BO    UTEST                    POSSIBLE VS              A28683 12907102
         USING WTGENTRY,RWTGC                                    Y02072 12909102
LOAD13   MVC   WTGIDTTR,SOPSLDFT        GET NON-SPAN LOAD EXEC @Z30TSCF 12911103
         B     RELOOP                                            A28683 12916502
UTEST    TM    DCBRECFM,FORMATU         UNDEFINED TEST           A28683 12921202
         BO    LOAD13                   NOT VS                   A28683 12925902
         MVC   WTGIDTTR,SOP3            GET SPAN LOAD EXEC     @Z30TSCF 12927903
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        12940000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     12960000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            12980000
         BCR   8,RBASE                                                  13000000
*                                                                       13020000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    13040000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             13060000
*                                                                       13080000
         LR    RPARC,RPAR                                               13100000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       13120000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           13140000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         13160000
*                                                                       13180000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  13200000
         LA    RPARC,PLOFF(0,RPARC)                                     13220000
         BC    15,ZCHEK                                                 13240000
*                                                                       13260000
TCTLRTN  EQU   *                                                        13280000
         USING WTG,RWTG                                                 13330003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*13380003
               MODID=WTGENTRY                                  @Z30TSCF 13430003
         DROP  RWTGC,RWTG                                      @Z30TSCF 13480003
*                                                                       14000000
*********************************************************************   14020000
*                                                                       14040000
ABEND    EQU   *                                                        14060000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 14072002
         SPACE                                                          14074002
         DMABCOND OABD065,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X14080021
                                        CALL PROBLEM DETERMINATION      14100021
         B     TCTLRTN                                           S21042 14120021
*                                                                       14160000
*                                                                       14180000
*********************************************************************** 14200000
*                                                                       14220000
*                                                                       14240000
NOPCI    EQU    *                                                       14260000
*                                                                       14280000
         USING WTGENTRY,RWTGC                                    Y02072 14290002
         MVC   WTGIDTTR,SOP2           MUST GO TO NON PCI EXEC @Z30TSCF 14292003
         B      RELOOP                                                  14320000
         EJECT                                                          14340002
WAOFF    EQU   32                                                       14440000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           14460000
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           14480000
AMIDCNST DC    C'1K'                                                    14500000
OPIDCNST DC    C'0S'                                                    14520000
SOPSLDFT DC    C'13',VL3(IGG01913)      NON-SPANNED EXEC       @Z30TSCF 14530003
SOP3     DC    C'16',VL3(IGG01916)      SPANNED RECORDS        @Z30TSCF 14532003
SOP2     DC    C'1D',VL3(IGG0191D)     ABNORMAL, PCI UNSUPPORT @Z30TSCF 14534003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION  @Z30TSCF 14536003
*                                                                       14540000
*********************************************************************** 14560000
*      CONSTANTS AND RESERVED STORAGE.                                  14580000
*                                                                       14620000
CONONE   DC    H'1'                                                     14660000
CCWCNSTS DC    X'68000005'                                              14760000
SCCWCNST DC    X'4000000508'                                            14820000
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 14830002
END      EQU   *                        END OF MODULE            Y02072 14920002
         EJECT                                                          14930002
         IGGBCB  TYPE=SAM                                               14940002
         EJECT                                                          14970002
         DCBD  DSORG=PS                                                 15400002
NTPTINDX EQU   DCBCNTRL                 NOTE/POINT INDEX         Y02072 15450002
         EJECT                                                          15500003
CVT      DSECT                                                 @Z30TSCF 15550003
         CVT                                                   @Z30TSCF 15600003
         IECDSECS (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES     @Z30TSCF 16130003
         ORG   WTGIDTTR                                          Y02027 16132002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 16134002
         EJECT                                                          16134402
FORCORE  DSECT                                                   Y02072 16134802
         IHAFCAUD  ORG=YES                                       Y02072 16135202
         EJECT                                                          16136002
         IEZDEB                                                  Y02072 16140002
         EJECT                                                          16142002
         IKJTCB                                                  Y02072 16150002
         EJECT                                                          16150402
         IHAICB                                                  Y02072 16152002
         ORG   ICBR+1                                            Y02072 16154002
         IHACCW  DSECT=NO                                        Y02072 16156002
           END                                                          16160000
./  ADD  SSI=81440197,NAME=IGG0191N
         TITLE 'IGG0191N-DEB CONSTRUCTION FOR D.A.DEVICE EXTENTS'       00100000
IGG0191N CSECT                                                          00120021
*                                                                       00122002
*MODULE NAME - IGG0191N                                          Y02072 00124002
*                                                                       00126002
*DESCRIPTIVE NAME - BUILD DA SECTION OF DEB                      Y02072 00128002
*                                                                       00128402
*COPYRIGHT - NONE                                                Y02072 00128802
*                                                                       00129202
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00129602
*                                                                       00129702
*        VS1 RELEASE 2 DELETIONS                                        00129802
*D329000                                                        XA02093 00129902
*                                                                       00130021
*        VS2 RELEASE 2 DELETIONS                                 Y02072 00180002
*001100,003600,093000,174500,175500-175800,194000-207000,209000, Y02072 00190002
*250500,252500-252800,272500,273500-274000,478000-512000,        Y02072 00192002
*514000-515000,425100,377000,382630,383000,405000,409000,425100, Y02072 00194002
*342070-342840                                                   Y02072 00204002
*                                                                YM1168 00214002
*          VS2 RELEASE 3 DELETIONS                                      00214403
*0000101000-110000,113000-114000,116000-118000,118820,         @Y30LSBS 00216003
*142000-143000,425400                                          @Y30LSBS 00218003
*                                                              @ZA04216 00218137
*                                                              @Z30TSCF 00218403
*          RELEASE VS2-3 ADDITTIONS AND CHANGES                         00218637
*A350500                                                       @ZA02655 00218737
*A242010,242020,266000 OZ10225 IS SYSROUTE FROM OY11230        @ZA02655 00218837
*A119161,119461                                                @ZA10592 00218937
*C368320-368350                                                @ZA10592 00219037
*A119101,368311,368312                                         @ZA12185 00219237
*C100000-100540,119160-119170,368161-369879,409610-409980,     @ZA17532 00219424
*C487500                                                       @ZA17532 00219524
*A369363,369414,369416,369456,369458                           @ZA26462 00219624
*C369482                                                       @ZA30847 00219724
*A369483,369484                                                @ZA30847 00221724
*                                                                       00223724
*          RELEASE 20 DELETIONS                                         00228024
*0973329000                                                      A33681 00230020
*0973328400,328800,329200,329600                                 M1055  00235020
*          RELEASE 21 DELETIONS                                         00240000
* 297000-299600                                                  A50696 00240421
*2880                                                            A43880 00242021
*2880                                                            A43880 00245021
*2880                                                            A39782 00250021
*D001400-001980,002600-002800,003200,011000-012000,152000,      SA54462 00250121
*D417000-424200,425800-428000,513000                            SA54462 00250221
*STATUS CHANGE LEVEL 007                                                00270224
*                                                                       00290224
*OZ28203  - MSS ACQUIRE ENHANCEMENTS                            OZ28203 00310224
*C100020,368206,369456                                          OZ28203 00330224
*A368207,368281-368300                                          OZ28203 00350224
*                                                                       00400000
* FUNCTION - THIS EXECUTOR IS ENTERED FOR USERS OF SAM AND EXCP DURING  00500021
*            OPEN FOR THE CONSTRUCTION OF DEBS. THIS EXEC SUPPLEMENTS   00600021
*            IGG0191A BY BUILDING THE EXTENT PORTION (DEVICE DEPENDENT  00700021
*            SECTION) FOR DIRECT ACCESS DEVICES.                        00800021
*            THE MODULE ALSO CHECKS THE AUTHORIZED LIBRARY       Y02072 00850002
*            TABLE (ALT) TO DETERMINE IF THE DATASET BEING       Y02072 00860002
*            OPENED BELONGS TO AN AUTHORIZED LIBRARY.  IF THE    Y02072 00870002
*            DATASET DOES BELONG TO AN AUTHORIZED LIBRARY, A BIT Y02072 00880002
*            IS SET IN THE DEB.                                  Y02072 00890002
*            UPON COMPLETION OF THE DEB, A LOOP THROUGH ITS             00891003
*            EXTENTS IS MADE TO BUILD PARAMETER LISTS FOR  AC-          00892003
*            QUIRING VIRTUAL DASD SPACE FOR ANY MSS  SUBSYSTEM          00893003
*            VIRTUAL DASD PACKS.                                        00894003
*                                                                       00900000
* ENTRY POINT - IGG0191N (ENTERED FROM IGG0191A VIA XCTL)               01000021
*                                                                       01300000
* INPUT -  DCB ADDRESS                                                  01400021
*          WORK AREA ADDRESS                                            01500000
*          WHERE TO GO TABLE                                            01600000
*          PARAMETER LIST                                               01700000
*          CURRENT ENTRY IN WHERE TO GO TABLE                           01800000
*          CURRENT PARAMETER (DCB)                                      01900000
*                                                                       02000000
* OUTPUT- DA EXTENT SECTION AS OUTLINED BELOW.                          02100021
*                                                                       02200000
*MACROS-MAPPING - IEFUCBOB, DCBD, TCB, IEZDEB, IECDSECS, ALTABLE,       02250003
*                 ICBACREL                                     @Y30LSBS 02260003
*                                                                       02300000
*        BASIC DEB LAYOUT FOR ALL I/O DEVICES SUPPORTED                 02400000
*                                                                       02500000
*        **********************************                             02600000
*   -16  *I/OS* I/O SUPPORT DCB ADDRESS   *                             02700000
*   -12  *    * RESERVED                  *                             02800000
*   -08  *    * DCB MODIF MASK            *                             02900000
*   -04  *DEBL*                           *                             03000000
*   +00  *SUBL* TCB ADDRESS               *                             03100000
*   +04  *AML * DEB LINK FIELD            *                             03200000
*   +08  *DPAT* IRB ADDRESS               *                             03300000
*   +12  *FLTP* SYSTEM PUTGE CHAIN        *                             03400000
*   +16  *NEXT* USER PURGE CHAIN          *                             03500000
*   +20  *PRTY* ECB ADDRESS               *                             03600000
*   +24  *KEYD* DCB ADDRESS               *                             03700000
*   +28  *SCAL* APPENDAGE ADDRESS         *                             03800000
*        **********************************                             03900000
*                                                                       04000000
*                                                                       04100000
*        DEVICE DEPENDENT SECTION OF DEB                                04200000
*                                                                       04300000
* TAPE/URE                                                              04400000
*                                                                       04500000
*                                                                       04600000
*        **********************************                             04700000
*   +32  *DMOD*  UCB ADDRESS              *                             04800000
*   +36  *VOL SEQ NO     *NO. OF VOLS.    *                             04900000
*        **********************************                             05000000
*                                                                       05100000
*                                                                       05200000
* FOLLOWING ARE DA EXTENTS BUILT BY THIS EXEC.                          05300000
*                                                                       05400000
* D.A.SAM DEB.                                                          05500000
*        **********************************                             05600000
*   +32  *FMSK*  UCB ADDRESS              *                             05700000
*   +36  *EXTENT FIELD BBCCHHCCHH         *                             05800000
*   +40  *                                *                             05900000
*   +44  *               *NO.TRACKS ALL.  *                             06000000
*   +48  *VOL SEQ NO     *NO. OF VOLS     *                             06100000
*        **********************************                             06200000
*                                                                       06300000
*                                                                       06400000
* NOTE.+32 - +44 IS REPEATED PER EXTENT                                 06500000
*                                                                       06600000
*                                                                       06700000
* D.A.TO MEMBER FOR OUTPUT                                              06800000
*        **********************************                             06900000
*   +E2  *MEMBER NAME THAT IS OPENING     *                             07000000
*   +56  *MEMBER NAME THAT IS OPENING     *                             07100000
*        **********************************                             07200000
*                                                                       07300000
*                                                                       07400000
* DA BPAM CONCATENATION (INPUT)                                         07500000
*        **********************************                             07600000
*   +48  *DSNO DSNO  DSNO DSNO            *                             07700000
*        *EXTU EXT2  EXT3 EXT4            *                             07800000
*        **********************************                             07900000
*                                                                       08000000
*                                                                       08100000
* NOTES- BPAM DEB SAME AS SAM DEB WITH EXCLUSSION OF FIELD AT +48       08200021
*                                                                       08300000
*        USER LABEL EXTENT IS NOT INCLUDED IN F1 EXTENT COUNT           08330018
*        AND IS NOT INCLUDED IN DEB EXTENTS.                            08360018
*                                                                       08400000
*        ROUTINE ALSO MERGES CLASS BYTE AND DEVICE BYTE OF UCB/SRT      08500000
*        INTO DCB FIELD (DEVT)                                          08600000
*                                                                       08700000
* EXITS NORMAL - XCTL TO IGG0191B  SAM MAIN EXECUTOR                    08800021
*                                                                       08810021
* EXITS ERROR - XCTL TO PROB DET FOR 413-2C ABEND IF ERROR              08900003
*               IS DISCOVERED UPON RETURN FROM ICBACREL MACRO           08950003
*                                                                       09000000
* TABLES/WORKAREA - SEE DSECTS AT END OF LISTING.                       09100021
*                   DXRGSAVE-USED TO SAVE REGISTER CONTENTS      Y02072 09150002
*                                                                       09200000
* ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY, Y02072 09300002
*              SUPERVISOR STATE                                  Y02072 09400002
*                                                                       09500000
*                                                                       09600000
*                                                                       09700000
*******************************************************************     09800000
*********************************************************************   09900000
         EJECT                                                 @ZA17532 10000024
*        THE FOLLOWING TABLE SHOWS WHAT STAGING IS PERFORMED   @ZA17532 10001024
*        FOR DATA SETS RESIDING ON AN MSS VIRTUAL VOLUME       @ZA17532 10002024
*        NOTE:                                                  OZ28203 10003024
*        (1)  THAT A  ( ? ) - INDICATES A NOT TESTED CONDITION  OZ28203 10004024
*        (2)  PROCESS (OUT) = OPENED FOR(OUTPUT OR OUTIN)       OZ28203 10005024
*                     (IN)  = OPEN FOR(INPUT,INOUT OR UPDATE)   OZ28203 10006024
*-------------------------------------------------------------  OZ28203 10007024
*PROCESS| DISP| ALLOC| TTRLL  |DSORG |ACCESS|  TYPE OF STAGING  OZ28203 10008024
*       |     |      |        |      |METHOD|      REQUEST      OZ28203 10009024
*-------------------------------------------------------------  OZ28203 10010024
* IN    |  ?  | TEMP |   ?    |   ?  |  ?    |NO STAGING        OZ28203 10011024
*       |     |      |        |      |       |                  OZ28203 10012024
*   ?   | NEW |  ?   | NOT=0  |  PS  |  ?    |NO STAGING        OZ28203 10013024
* IN    | NEW |  ?   |  =0    |  PS  |NOT PDS|STAGE ALL EXTENTS OZ28203 10014024
* OUT   | NEW | CYL  |  =0    |  PS  |NOT PDS|INHIBIT STAGE ALL OZ28203 10015024
* OUT   | NEW | TRK  |  =0    |  PS  |NOT PDS|STAGE ALL EXTENTS OZ28203 10016024
*       |     |      |        |      |       |                  OZ28203 10017024
* IN    | OLD |  ?   | NOT=0  |  PS  |NOT PDS|STAGE TO EOF      OZ28203 10018024
* IN    | OLD |  ?   |  =0    |  PS  |NOT PDS|STAGE ALL EXTENTS OZ28203 10019024
* OUT   | OLD | TEMP | NOT=0  |  PS  |  ?    |NO STAGING        OZ28203 10020024
* OUT   | OLD | TRK  |   ?    |  PS  |NOT PDS|STAGE ALL EXTENTS OZ28203 10021024
* OUT   | OLD | CYL  |   ?    |  PS  |EXCP   |STAGE ALL EXTENTS OZ28203 10022024
* OUT   | OLD | CYL  |   ?    |  PS  |SAM    |IF(MACRF POINT)   OZ28203 10023024
*       |     |      |        |      |       |STAGE ALL. ELSE   OZ28203 10024024
*       |     |      |        |      |       |INHIBIT STAGE ALL OZ28203 10025024
*       |     |      |        |      |       |                  OZ28203 10026024
* IN    | MOD |  ?   | NOT=0  |  PS  |NOT PDS|STAGE TO EOF      OZ28203 10027024
* IN    | MOD |  ?   |  =0    |  PS  |NOT PDS|STAGE ALL EXTENTS OZ28203 10028024
* OUT   | MOD | CYL  |   ?    |  PS  |SAM    |STAGE CYL OF LAST OZ28203 10029024
*       |     |      |        |      |       |RECORD INHBIT TO  OZ28203 10030024
*       |     |      |        |      |       |EOF.              OZ28203 10031024
* OUT   | MOD | TRK  |   ?    |  PS  |SAM    |STAGE CYL OF LAST OZ28203 10032024
*       |     |      |        |      |       |RECORD TO EOF.    OZ28203 10033024
* IN    | ?   |  ?   |   ?    |  PS  |PDS    |STAGE DIRECTORY   OZ28203 10034024
* IN    | ?   |  ?   |   ?    |  PO  |PDS    |STAGE ALL EXTENTS OZ28203 10035024
*       |     |      |        |      |       |                  OZ28203 10036024
* OUT   | ?   | CYL  |   ?    |  PS  |PDS    |STAGE DIRECTORY   OZ28203 10037024
*       |     |      |        |      |       |CYL OF EOF        OZ28203 10038024
*       |     |      |        |      |       |INHIBIT TO EOD    OZ28203 10039024
* OUT   | ?   | TRK  |   ?    |  PS  |PDS    |STAGE DIRECTORY   OZ28203 10040024
*       |     |      |        |      |       |CYL OF EOF TO EOD OZ28203 10041024
*-------------------------------------------------------------  OZ28203 10042024
         EJECT                                                 @ZA17532 10054024
* MASK'S TO TEST PARAMETER LIST WITH                                    10100000
DEBBSLNG EQU   80                                                       11100000
COMMUTAB EQU   16                                                       11200000
NEXTCORE EQU   140                                                      11500000
UCBADDR  EQU   NEXTCORE+4               ADDR OF UCB (OTHER THAN  Y02072 11550002
*                                         FIRST) FOR BPAM DS     Y02072 11560002
ULEXTYP  EQU   X'40'  EXTENT TYPE INDICATOR FOR USER LABEL TRACK   UL17 11850000
INMASK   EQU   X'0E'                    MASK FOR INPUT TEST        UT18 11858018
POTEST   EQU   X'02'                    MASK FOR PO DATA SET       UT18 11866018
TOTMASK  EQU   X'02'                    MASK FOR TOTALING TEST     UT18 11874018
ZERO     EQU   0                        PARAMETRIC VALUE OF 0      UT18 11890018
ONE      EQU   1                        CONSTANT OF 1            A50696 11890421
XNTOFSET EQU   6                       OFFSET TO EXTENT IN DSCB  A43880 11891021
EIGHT    EQU   8                       8 BYTES                   A43880 11892021
ADDRLEN  EQU   B'0111'                 TO GET AN ADDR THAT IS    Y02072 11894002
*                                        LEFT ALIGNED            Y02072 11896002
JFQMPREF EQU   X'10'                    LEN OF QUE MANAG PREFIX  YM1168 11898002
*                                         TO THE JFCB            YM1168 11898402
*                                                                       11900000
*    SOME MSS  EQUATES AND MASKS                               @Y30LSBS 11902003
*                                                              @Y30LSBS 11903003
INHIBST  EQU   X'20'                    INHIBIT STAGING        @Y30LSBS 11910024
OUTIN    EQU   X'07'                    MASK FOR OUTPUT/OUTIN  @ZA17532 11916024
DEBCYL   EQU   X'18'                    CYL ALLOC IN DEB EXTENT@ZA17532 11917024
X7F      EQU   X'7F'                    VERY HI EXTENT NUMBER  @Y30LSBS 11918024
D1       EQU   1                        DISPLACEMENT OF ONE    @Y30LSBS 11922003
D3       EQU   3                        DISPLACEMENT OF THREE  @Y30LSBS 11924024
D4       EQU   4                        DISPLACEMENT OF FOUR   @Y30LSBS 11954024
******************************           ****************************** 12000000
*                                                                       12100000
*                                                                       12200000
*                                                                       12300000
*                                                                       12400000
*                                                                       12500000
*REGISTERS ARE REFERENCED SYMBOLICALLY WHERE APPROPRIATE                12600000
RE       EQU   0         WORK REG5                                      12700003
RWK3     EQU   RE        WORK REGISTER                           Y02072 12750003
RF       EQU   1         WORK REG6                                      12760003
R1       EQU   1         PARAMETER LIST REGISTER               @Y30LSBS 12770003
RDCB     EQU   2         DCB REGISTER                                   12800000
RWK1     EQU   RDCB      WORK REGISTER                           Y02072 12850002
RBASE    EQU   3         BASE REGISTER                                  12900000
RCORE    EQU   4         WORK AREA ADDRESS                              13000000
RPAR     EQU   5         TOP OF PARAMETER LIST                          13100000
RWK4     EQU   RPAR      WORK REGISTER                           Y02072 13150002
RWTG     EQU   6         TOP OF WTG TABLE                               13200000
RWK5     EQU   RWTG      WORK REGISTER                           Y02072 13250002
RPARC    EQU   7         CURRENT PARAMETER                              13300000
RWTGC    EQU   8         CURRENT TRANS LOAD                             13400000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    13500000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       13600000
RWK6     EQU   RUCB      WORK REGISTER                          XA02093 13650002
RDEB     EQU   11        DEB ADDRESS                                    13700000
RB       EQU   12        WORK REG1  **                                  13800000
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          13900000
RD       EQU   14        WORK REG3  **                                  14000000
RWK2     EQU   RD        WORK REGISTER                           Y02072 14050002
RJ       EQU   15        WORK REG4                                      14100000
*                                                                       14400000
*                                                                       14500000
*                                                                       14600000
*********************************************************************** 14700000
*                                                                       14800000
*                                                                       14900000
*                                                                       15000000
*                                                                       15100000
*                                                                       15300000
         BALR  RBASE,0                                                  15400000
         USING PO,RBASE                                                 15500000
         USING IHADCB,RDCB                                              15600000
         USING FORCORE,RCORE                                            15700000
         USING   TCB,RD                                                 15900000
         USING TIOT,RTIOT                                               16000000
         USING UCBOB,RUCB                                               16100000
*                                                                       16200000
*                                                                       16300000
*                                                                       16400000
*                                                                       16500000
PO       EQU   *                                                        16600000
         B     BEGIN                                           @Z30TSCF 16650003
         DC    C'IGG0191N'              MODULE NAME            @Z30TSCF 16660003
         DC    C'&SYSDATE'              LAST SHIP DATE         @ZA17532 16670024
         DC    C'@ZA30847'              LAST SHIP CODE         @ZA17532 16676024
BEGIN    DS    0H                                              @Z30TSCF 16690003
*                                                                       16700000
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 16800000
         L     RCORE,4(RWTGC)           GET WORK AREA                   16900000
         L     RD,COMMUTAB         CALCULATE TCB ADDRESS                17000000
         L     RD,0(0,RD)                                               17100000
         L     RD,4(0,RD)               TCB  ADDR                       17200000
         L     RTIOT,TCBTIO                                             17300000
         AH    RTIOT,DCBTIOT       RESET TIOT POINTER                   17400000
         L     RDEB,DCBDEBAD                                            17500000
         USING DEBBASIC,RDEB                                     Y02072 17550002
         TM    DSCFILTY,POTEST          IS DATA SET PARTIONED    Y02072 17560002
         BNO   OBPAM170                 NO, BR AROUND            Y02072 17570002
         OI    DEBFLGS1,DEBAPFIN        ASSUME DATASET IS IN ALT Y02072 17580002
OBPAM170 EQU   *                        COME HERE IF NOT PO      Y02072 17590002
         SR    RC,RC                                                    17600000
         IC    RC,DEBNMEXT                                              17700000
*                                                                       17800000
*        EXTENTS                                                        17900000
*                                                                       18000000
         LR    RB,RC                    NO OF EXTENTS                   18100000
         SLL   RB,4                                                     18200000
         LA    RB,32(RDEB,RB)           POINT TO ACCESS METHOD SECTION  18300000
*                                                                       18400000
         DROP  RDEB                                              Y02072 18450002
         USING DEBDASD-(DEBBASND-DEBBASIC),RDEB                  Y02072 18460002
         LA    RJ,DEBUCBAD              FIRST DEB EXTENT                18500000
         DROP  RDEB                                              Y02072 18550002
         LR    RDCB,RCORE                                               18600000
         SH    RDCB,OBPAMK44            FIRST DSCB                      18700000
         LR    RDEB,RDCB                SAVE CURRENT DSCB ADDR          18800000
         SR    RF,RF                    START M COUNTER WITH ZERO       18900000
         SR    RD,RD                                                    19000000
         ST    RD,DXCCW4                SET TOTAL TT CTR TO ZERO        19100000
         L     RUCB,DXUCBADR            ADDR OF ONLY UCB FOR SAM Y02072 19150002
*                                         OF FIRST UCB FOR BPAM  Y02072 19160002
*                                                                       19200000
OBPAM180 EQU   *                                                        19300000
         STH   RD,4(0,RJ)               ZERO BB FIELD                   19310002
         USING UCBOB,RUCB                                               20800000
*                                                                       20810002
* MUST NEXT TEST TO SEE IF THE DATASET BEING OPENED IS A MEMBER  Y02072 20820002
* OF THE AUTHORIZED LIBRARY TABLE.  IF IT DOES BELONG TO THE ALT Y02072 20830002
* A BIT MUST BE SET IN THE DEB.                                  Y02072 20840002
*                                                                       20842002
         TM    DSCFILTY,POTEST          DATA SET PARTITIONED     Y02072 20850002
         BZ    OBPAM186                 NO, BYPASS ALT TESTING   Y02072 20860002
         STM   RWK4,RWK5,DXRGSAVE       SAVE REGS                Y02072 20862002
         L     RWK2,CVTPTR              GET CVT ADDRESS          Y02072 20870002
         USING CVTMAP,RWK2                                       Y02072 20880002
         L     RWK2,CVTAUTHL            GET ADDRESS OF ALT       Y02072 20890002
         DROP  RWK2                                              Y02072 20892002
         LTR   RWK2,RWK2                WAS AN ALT BUILT         Y02072 20894002
         BZ    OBPAM184                 NO, BYPASS ALT TESTING   Y02072 20896002
         USING ALTABLE,RWK2                                      Y02072 20898402
         SR    RWK3,RWK3                PREPARE TO GET NUMBER OF Y02072 20898802
*                                         ENTRIES IN THE ALT FOR Y02072 20898902
*                                         LOOP CONTROL           Y02072 20899002
         IC    RWK3,ALTNOENT            GET NUMBER OF ENTRIES    Y02072 20899602
         LA    RWK2,ALTENT              INCR TO THE FIRST ENTRY  Y02072 20899702
         DROP  RWK2                                              Y02072 20899802
         USING ALTENTRY,RWK2                                     Y02072 20899902
         SR    RWK4,RWK4                PREPARE REG FOR COUNT    Y02072 20933202
*                                         FOR CLC INST           Y02072 20935202
OBPAM182 EQU   *                                                 Y02072 20943202
         IC    RWK4,ALTLNENT            INIT REG FOR INST TO GET Y02072 20953202
*                                         TO THE NEXT ENTRY      Y02072 20963202
         CLC   ALTVOLID,UCBVOLI         UCB VOLID EQUAL TO ALT   Y02072 20965202
*                                         ENTRY VOLID            Y02072 20965602
         BNE   OBPAM183                 NO, GO INCR TO NXT ENTRY Y02072 20966002
         SH    RWK4,VLIDLNP1            SUBT LEN OF ENTRY FOR    Y02072 20966402
*                                         VOLID PLUS ONE FOR     Y02072 20966502
*                                         EXECUTE INST           Y02072 20966602
         ICM   RWK5,ADDRLEN,TIOEJFCB    GET ADDR OF JFCB         Y02072 20976602
         LA    RWK5,JFQMPREF(RWK5)      ADD LEN OF PREFIX        YM1168 20977002
         EX    RWK4,CLCINST             EXECUTE CLC INST FOR DSN Y02072 20977702
         BNE   NEXTALT                  GO PREPARE FOR NEXT ALT OZ03183 20987737
         CL    RWK4,OBPAMK43            IS DSN 44 BYTES LONG?   OZ03183 20987837
         BE    OBPAM185                 YES, VALID JFCB DSN     OZ03183 20987937
         AR    RWK5,RWK4                POINT END OF JFCB DSN   OZ03183 20988037
         USING INFMJFCB,RWK5                                    OZ03183 20988137
         CLI   JFCBDSNM+1,C' '          BLANK AT END OF DSN?    OZ03183 20988237
         BNE   NEXTALT                  NO, PREPARE FOR NEXT ALTOZ03183 20988337
         LA    RWK4,3(,RWK4)            DETERMINE NUMBER        OZ03183 20988437
         LCR   RWK4,RWK4                    OF BLANKS TO BE     OZ03183 20988537
         AH    RWK4,OBPAMK44               CHECKED IN EX INST   OZ03183 20988637
         BM    OBPAM185                 MINUS, VALID 43 BYTE DSNOZ03183 20988737
         EX    RWK4,DSNCLC              CHECK FOR ALL BLANKS    OZ03183 20988837
         BE    OBPAM185                 YES, DS BELONGS TO ALT  OZ03183 20988937
         IC    RWK4,ALTLNENT            INIT REG FOR NEXT ALT   OZ03183 20989037
         B     OBPAM183                 GO INCR TO NEXT ENTRY   OZ03183 20989137
NEXTALT  AH    RWK4,VLIDLNP1            NOT EQUAL, PREPARE FOR  OZ03183 20989237
*                                         NEXT ENTRY IN THE ALT OZ03183 20989337
OBPAM183 EQU   *                                                 Y02072 20989437
         LA    RWK2,L'ALTLNENT(RWK4,RWK2) INCR TO THE NEXT ENTRY Y02072 20989537
*                                         (CONTENTS OF ALTLNENT  Y02072 20990802
*                                         PLUS 1 FOR LENGTH OF   Y02072 20991202
*                                         ALTLNENT)              Y02072 20991602
         BCT   RWK3,OBPAM182            RETURN IF MORE ENTRIES   Y02072 20992502
OBPAM184 L     RWK5,0(RPARC)            GET DCB ADDR             Y02072 20992902
         DROP  RDCB                                              Y02072 20993302
         USING IHADCB,RWK5                                       Y02072 20993702
         L     RWK5,DCBDEBAD            GET DEB ADDR             Y02072 20994102
         DROP  RWK5                                              Y02072 20994202
         USING DEBBASIC,RWK5                                     Y02072 20994302
         NI    DEBFLGS1,X'FF'-DEBAPFIN  TURN BIT OFF IF NO MORE  Y02072 20994502
*                                         ENTRIES OR NO ALT      Y02072 20994902
OBPAM185 EQU   *                                                 Y02072 20995002
         LM    RWK4,RWK5,DXRGSAVE       RESTORE REG VALUE        Y02072 20995102
         DROP  RWK5                                              Y02072 20995502
OBPAM186 EQU   *                                                 Y02072 20996102
         ST    RUCB,0(0,RJ)             MAIN UCB PTR IN CURRENT EXTENT. 20996302
         SR    RD,RD                                                    21000000
         IC    RD,59(0,RDCB)            GET NO OF EXTENT ON THIS DS     21100000
         LA    RDCB,105(0,RDCB)         POINT TO 1ST EXTENT ENTRY  UL17 21110000
         LA    RUCB,3                   MAX OF 3 EXTENTS           UL17 21120000
         CLI   0(RDCB),ULEXTYP          CHECK,BR IF 1ST EXTENT NOT UL17 21130000
         BC    7,OBPAM187               A USER LABEL TRACK         UL17 21140000
         LA    RDCB,10(0,RDCB)          POINT TO 2ND EXTENT ENTRY  UL17 21150000
         BCTR  RUCB,0                   DEC MAX NO EXTENTS LEFT    UL17 21160000
OBPAM187 EQU   *                                                   UL17 21180000
         LTR   RD,RD                    CHECK FOR ZERO                  21200000
         BC    7,OBPAM190               NO BRANCH                       21300000
*                                                                       21400000
         LA    RD,1                     TO FORM DUMMY EXTENT            21500000
OBPAM190 EQU   *                                                        21600000
*                                                                       21700000
         TM    0(RPARC),X'0F'           CK FOR INPUT                    21900000
         BC    8,OBPAM200              BR IF YES                        22000000
         MVI   0(RJ),X'10'              INH WR HA, R0 PERM HEAD SEEKS   22100000
         BC    15,OBPAM210                                              22200000
*                                                                       22300000
OBPAMK43 DC    H'43'                                            OZ03183 22350037
OBPAMK44 DC    H'44'                                                    22400000
*                                                                       22500000
OBPAM200 EQU   *                                                        22600000
         MVI   0(RJ),X'50'              INH ALL WR PERM HEAD SEEKS      22700000
*                                                                       22800000
OBPAM210 EQU   *                                                        22900000
         SR    RE,RE                    SET FORMAT 3 SW OFF             23000000
*                                                                       23200000
OBPAM220 EQU   *                                                        23300000
         MVC   6(8,RJ),2(RDCB)          SET UP ONE EXTENT CCHH TO CCHH  23400000
*    APAR 43880 RESULTED FROM THE USER BEING ABLE TO SPECIFY     A43880 23410021
*    ZERO FOR PRIMARY SPACE ALLOCATION AND THUS GETTING EXTENT   A43880 23420021
*    SECTION OF DEB ALL ZEROS.                                   A43880 23430021
         CLC   XNTOFSET(EIGHT,RJ),NOALLOC  IS THE EXTENT ALL 0   A43880 23440021
         BNE   ALLOC                   IF NOT   NO PROBLEM       A43880 23450021
         MVC   XNTOFSET(L'FOXES,RJ),FOXES INVALIDATE DEB        SA54462 23460021
ALLOC    EQU   *                                                 A43880 23470021
         CLI   0(RDCB),X'81'            CHECK FOR CYLINDER BOUNDRY      23500000
         BE    OBPAM224                 YES BRANCH. PERMIT HEAD SEEKS.  23600000
         OI    0(RJ),X'18'              INHIBIT ALL SEEKS               23700000
OBPAM224 EQU   *                                                        23800000
*                                                                       23900000
*                                                                       24000000
*        SET NO OF TRACKS                                               24100000
*                                                                       24200000
         CLC   XNTOFSET(L'FOXES,RJ),FOXES  DEB INVALID?        @ZA10225 24230037
         BE    BYPASS                      YES,BYPASS CONVERT  @ZA10225 24260037
         STM   RE,RJ,DXCCW5             SAVE ALL REGS                   24300000
         LR    RPAR,RJ                  SAVE CURR EXTNT PNTR            24400000
         STC   RF,DXDAADDR              SET CONST M FOR CONVERT         24500000
         MVC   DXDAADDR+1(2),4(RJ)      BB                              24600000
         MVC   DXDAADDR+3(4),10(RJ)     END CCHH IN EXTENT              24700000
*                                                                       24800000
*        USE CONVERT ROUTINE                                            24900000
*                                                                       25000000
         L     RF,0(0,RPARC)            DCB PTR                         25100000
         L     RF,DCBOFSET(0,RF)   PT TO DEB                            25200000
         LA    RDCB,DXDAADDR            PT TO CONST FOR CONVERT RTNE    25300000
         L     RJ,CVTPTR                GET COMM VECTOR ADDRESS         25400000
         L     RJ,CVTPRLTV-CVT(0,RJ)    CONVERT RTNE                    25500000
         BALR  RD,RJ                                                    25600000
*                                                                       25700000
         LR    RF,RE                    MOVE TTR TO RF                  25800000
         SRL   RF,16                    USE TT ONLY                     25900000
         LA    RF,1(0,RF)               ADD ONE TO TT                   26000000
         SH    RF,DXCCW4                SUBTRACT TT OF LAST EXTENT      26100000
         STH   RF,14(0,RPAR)            STORE NO OF TRKS IN EXTNT       26200000
         AH    RF,DXCCW4                RESET TOTAL TT CTR              26300000
         STH   RF,DXCCW4                                                26400000
         LM    RE,RJ,DXCCW5             RESTORE ALL REGS                26500000
BYPASS   EQU   *                                               @ZA10225 26600037
         LA    RF,1(0,RF)              ADD 1 TO M CTR, PT TO NEXT EXTNT 26700000
*                                                                       26800000
         BCT   RC,OBPAM260              NEXT                            26900000
*                                                                       27000000
         USING DEBBASIC,RDEB                                     Y02072 27050002
         USING IHADCB,RDCB                                       Y02072 27060002
*                                                                       27100000
         L     RDCB,0(0,RPARC)          RE-SET DCB PTR                  27200000
         L     RDEB,DCBDEBAD            RE-SET DEB PTR                  27300000
         TM    DCBDSORG,POTEST          TEST FOR PO DATA SET       UT18 27420018
         BZ    OBPAM227                 BR IF NOT SPECIFIED        UT18 27440018
*                                                                  UT18 27460018
         SR    RC,RC                   ZERO REG. FOR IC INSTR.     5798 27500000
         IC    RC,DEBAMLNG             PICK UP NO. OF DATA SET     5798 27600000
         LTR   RC,RC                                               5798 27700000
         BZ    OBPAM227                BRANCH IF ZERO              5798 27800000
         OI    DEBOFLGS,1              SET CONCATENATION IND.      5798 27900000
OBPAM227 EQU   *                                                   5798 28000000
*                                                                  5798 28100000
         TM    DCBMACRF,X'80'           DCB USING EXCP MACRO            28200000
         BC    8,OBPAM230               NO BRANCH                       28300000
         TM    DCBMACRF,X'40'          CK FOR FOUND EXT                 28400000
         BC    1,OBPAM230               YES BRANCH                      28500000
*                                                                       28600000
         TM    DSCFILTY,X'02'           PO IN DSCB                      28700000
         BC    8,OBPAM232               NO BRANCH                       28800000
         B     OBPAM250                                                 28900000
*                                                                       29000000
OBPAM230 EQU   *                                                        29100000
*                                                                       29200000
         TM    DCBDSORG,X'02'           CK FOR PO                       29300000
         BC    1,OBPAM240               BR IF YES                       29400000
OBPAM232 EQU   *                                                        29500000
         SR    RD,RD                                              MC0W  29510000
         SR    RC,RC                                              MC0W  29520000
         IC    RD,JFCBNVOL              PICK UP NO. OF VOLUMES    MC0W  29530000
         IC    RC,JFCBVLCT              GET VOLUME COUNT          MC0W  29540000
         CR    RC,RD                                              MC0W  29550000
         STH   RC,18(RJ)                IS VOLUME COUNT GREATER   MC0W  29560000
         BH    OBPAM172                 YES USE VOLUME COUNT      MC0W  29570000
         STH   RD,18(RJ)                NO USE NUMBER OF VOLUMES  MC0W  29580000
OBPAM172 EQU   *                                                  MC0W  29590000
         LH    RD,JFCBVLSQ              LOAD VOL SEQ NO          A50696 29640021
         TM    JFCBIND2,X'40'         TEST FOR OLD OR NEW          6831 29760013
         BNE   OBPAM234               BIF EITHER.                       29820013
         TM    0(RPARC),X'07'   TEST FOR OUT-OUT/IN. MVT SYSOUT PROB.   29880013
         BC    12,OBPAM234            BIF NEITHER.   MVT SYSOUT PROB.   29940013
         LTR   RD,RD                    TEST FOR ZERO             18987 29980000
         BE    OBPAM233                 YES                       18987 30000000
         STH   RD,16(RJ)                STORE VOL SEQ NO. IN DEB  18987 30020000
         B     OBPAM23A                                           18987 30040000
OBPAM233 EQU   *                                                  18987 30060000
         CLI   DXVOLSEQ+1,X'00'         TEST FOR ZERO          @ZA05445 30063037
         BC    8,OBPAM23B               YES                    @ZA05445 30066037
         IC    RD,DXVOLSEQ+1            PICK UP DEBVOLSEQ      @ZA05445 30069037
         B     OBPAM234                                        @ZA05445 30072037
OBPAM23B EQU   *                                               @ZA05445 30075037
         IC    RD,JFCBNVOL              PICK UP NO. OF VOLUMES    18987 30080000
OBPAM234 EQU   *                                                        30100000
         LTR   RD,RD                    VOL SEQ ZERO             A50696 30150021
         BNZ   OBPAM235                 NO, BR                   A50696 30200021
         LA    RD,ONE                   YES, USE VOL 1           A50696 30210021
OBPAM235 EQU   *                                                 A50696 30220021
         STH   RD,16(RJ)                USE VOL SEQ FROM JFCB    A50696 30230021
OBPAM23A EQU   *                                                  18987 30250000
         LA    RJ,4(RJ)                 SKIP PS SECTION                 30300000
         LNR   RJ,RJ                    MAKE NEGATIVE FOR BPAM   A25961 30360019
*                                       TEST BELOW                      30420019
         MVI   DEBAMLNG,X'10'           16 BYTE ACCESS METHOD    A25961 30480019
*                                       SECTION                         30540019
OBPAM240 EQU   *                                                        30600000
         TM    DSCFILTY,X'02'           CK PO IN DSCB                   30700000
         BC    8,DEBFINI                BRANCH IF NO                    30800000
OBPAM250 EQU   *                                                        30900000
*                                                                       31000000
         TM    0(RPARC),X'0F'           CK FOR INPUT                    31100000
         BC    8,DEBFINI                BRANCH IF YES                   31200000
*                                                                       31300000
         CLI   JFCBELNM,X'40'           CK FOR MEMBER NAME              31400000
         BC    8,DEBFINI                BRANCH IF NO                    31500000
*                                                                       31600000
*     CHECK FOR GDG RELATIVE GENERATION SPECIFICATION             18185 31610000
         CLI   JFCBELNM,C'+'                                      18185 31620000
         BC    8,DEBFINI               BRANCH IF PLUS             18185 31630000
         CLI   JFCBELNM,C'-'                                      18185 31640000
         BC    8,DEBFINI               BRANCH IF MINUS            18185 31650000
         TM    JFCBELNM,X'F0'                                     18185 31660000
         BC    1,DEBFINI               BRANCH IF NUMERIC          18185 31670000
         LTR   RJ,RJ                    TEST FOR BPAM ACCESS     A25961 31690019
*                                       METHOD SECTION                  31710019
         BP    OBPAM253                 BR IF YES                A25961 31730019
         LPR   RJ,RJ                    MAKE RJ POSITIVE         A25961 31750019
         B     OBPAM256                 ACCESS METHOD LENGTH     A25961 31770019
*                                       ALLREADY SET TO 16              31790019
OBPAM253 OI    DEBAMLNG,X'08'           8 BYTE BPAM SECTION      A25961 31810019
*                                       FOR MEMBER NAME                 31830019
OBPAM256 MVC   16(8,RJ),JFCBELNM        STORE MEMBER NAME IN     A25961 31850019
*                                       DEB                             31870019
         BC    15,DEBFINI                                               31900000
*                                                                       32000000
*                                                                       32100000
*                                                                       32200000
OBPAM260 EQU   *                                                        32300000
         BCT   RD,OBPAM280              BR IF MORE EXTENT ON CURRENT DS 32400000
         STC   RF,0(0,RB)               PUT M PTR IN AM SECTION         32500000
         LA    RB,1(0,RB)               NEXT ENTRY IN AM SECTION        32600000
         L     RDEB,NEXTCORE(0,RDEB)    NEXT DSCB ADDR                  32700000
         SR    RWK6,RWK6                PREPARE REG FOR IC INST XA02093 32710002
         IC    RWK6,TIOELNGH            GET LEN OF THIS DD ENT  XA02093 32720002
         LA    RTIOT,0(RWK6,RTIOT)      INCRE TO NEXT DD ENTRY  XA02093 32730002
         L     RUCB,UCBADDR(RDEB)       RE-INIT UCB REG FOR BPAM Y02072 32750002
*                                         MULTI VOL DATA SETS    Y02072 32760002
         LR    RDCB,RDEB                NEW CORE                        32800000
         LA    RJ,16(0,RJ)              NEXT DEB EXTENT                 33000000
         BC    15,OBPAM180                                              33100000
*                                                                       33200000
*        MORE EXTENTS FOR CURRENT DATA SET                              33300000
*                                                                       33400000
OBPAM280 EQU   *                                                        33500000
         LA    RDCB,10(0,RDCB)          UPDATE DSCB PTR                 33600000
         BCT   RUCB,OBPAM300            BR IF MORE EXT FOR CURR FORMAT  33700000
         LA    RDCB,1(0,RDCB)           UPDATE DSCB EXTNT PNTR          33800000
         LTR   RE,RE                    IS IT WORKING ON FORMAT 3       33900000
         BC    7,OBPAM320               BR IF YES                       34000000
*                                                                       34100000
         L     RDCB,4(RDCB)             GET NEXT FORMAT 3 DSCB          34200000
         LR    RDEB,RDCB                SAVE CURRENT DSCB ADDR          34300000
         LA    RDCB,4(0,RDCB)           UPDATE DSCB PNTR                34400000
         LA    RUCB,4                   START WITH 4 EXTENTS IN KEY     34500000
         LA    RE,1                     SET FORMAT 3 SW ON              34600000
*                                                                       34700000
OBPAM300 EQU   *                                                        34800000
         MVC   16(6,RJ),0(RJ)           MOD,UCB AND BB FOR NEXT EXTENT  34900000
         LA    RJ,16(0,RJ)              NEXT DEB EXTENT                 35000000
         NI    0(RJ),X'F7'              RESET FILE MASK        @ZA02655 35050037
         BC    15,OBPAM220                                              35100000
*                                                                       35200000
*                                                                       35300000
OBPAM320 EQU   *                                                        35400000
         LA    RUCB,9                   MAX 9 MORE EXTENTS              35500000
         SR    RE,RE                    FORMAT 3 SW OFF                 35600000
         BC    15,OBPAM300                                              35700000
*                                                                       35800000
DEBFINI  EQU   *                                                        35900000
         L     RF,DEBAPPAD              ADDRESS OF FIRST BYTE OF GOTTEN 36000000
*                                       CORE FOR DEB. USED TO ADDRESS   36100000
*                                       THE DEBDSCBA FIELD IN THE PRE-  36200000
*                                       FIX.                            36300000
         DROP  RDEB                                              Y02072 36350002
         USING DEBDASD-(DEBBASND-DEBBASIC),RDEB                  Y02072 36360002
         MVC   21(2,RF),DEBBINUM        BB- COMPLETES FDAD FOR F1 DSCB. 36400000
*                                       CCHHR WAS PUT IN BY 191A.       36500000
         DROP  RDEB                                              Y02072 36550002
         USING DEBBASIC,RDEB                                     Y02072 36560002
*                                                                       36600000
*                                                                       36700000
         L     RDCB,0(RPARC)            RESTORE DCB ADDRESS             36800000
*                                                                       36801003
*        THIS ROUTINE SCANS THROUGH THE DEB EXTENTS TO PICK UP @Y30LSBS 36802003
*        THOSE EXTENTS WHICH RESIDE ON VIRTUAL MSS  DASD.  THE @Y30LSBS 36803003
*        UCBTBYT2, X'08' OF EACH EXTENT IDENTIFIES  A          @Y30LSBS 36804003
*        VIRTUAL DASD VOLUME.   IF AN                          @Y30LSBS 36804403
*        EXTENT RESIDES ON VIRTUAL DASD, THE HIGH AND LOW      @Y30LSBS 36805003
*        EXTENT VALUES ARE PUT INTO A PARM LIST APPROPRIATLY   @Y30LSBS 36806003
*        FORMATTED FOR THAT PARTICULAR VOLUME.  THE            @Y30LSBS 36807003
*        LIST IS USED TO ACQUIRE THE DASD SPACE FOR THE        @Y30LSBS 36808003
*        EXTENTS AND PROPERLY STAGE OR INHIBIT STAGE THE DATA. @Y30LSBS 36809003
*                                                              @Y30LSBS 36814003
*                                                              @Y30LSBS 36815003
VIRTPROC EQU   *                                               @Y30LSBS 36816003
         STM   RPAR,RTIOT,DXCCW6        SAVE REGISTERS         @ZA17532 36816124
         XC    DXCCW12+4(4),DXCCW12+4   NO ACQUIRE LIST YET    @ZA17532 36816424
*                                       THIS IS USED AS ANCHOR @ZA17532 36816724
*                                       POINT FOR ACQUIRE LISTS@ZA17532 36817024
         SR    RD,RD                    CLEAR WORK REGISTER    @ZA17532 36817324
         IC    RD,DEBNMEXT              NUMBER OF DEB EXTENTS  @ZA17532 36817624
         LR    RC,RCORE                 USE THIS 'TRICK' SO CAN@ZA17532 36817924
         SH    RC,OBPAMK44              ADDR ALL DSCB'S ALIKE  @ZA17532 36818224
         DROP  RCORE                                           @ZA17532 36818524
         USING FORCORE-L'JFCBDSNM,RC                           @ZA17532 36818824
         LA    RPAR,DEBBASND            POINT TO DEB EXTENT    @ZA17532 36819124
         USING DEBDASD,RPAR                                    @ZA17532 36819424
OBPAM322 EQU   *                                               @ZA17532 36819724
         L     RUCB,DEBUCBAD            GET UCB ADDRESS        @ZA17532 36820024
         TM    UCBTBYT2,UCBRVDEV        IS IT VIRTUAL DASD     @Y30LSBS 36820324
         BO    VIRTRTN                  YES, PROCESS           @OZ28203 36820624
NOACQ    EQU   *                        CHECK FOR CANCAT PDS   @OZ28203 36820724
         TM    DEBOFLGS,DEBRERR         IS IT CONCATENATED PDS @ZA17532 36820924
         BNO   OBPAM600                 NO, GO AROUND VIRT RTN.@Y30LSBS 36821224
OBPAM324 EQU   *                        BYPASS DATA SET        @ZA17532 36821524
         SR    RB,RB                    PICK UP NUMBER OF      @ZA17532 36821824
         IC    RB,DSCNOEXT              EXTENTS IN THE DEB FOR @ZA17532 36822124
*                                       THIS DATA SET. NOTE NO @ZA17532 36822424
*                                       USER LABELS FOR PDS    @ZA17532 36822724
         SR    RD,RB                    REDUCE NUM OF EXTENTS  @ZA17532 36823024
         SLL   RB,4                     ADJUST DEB PTR TO      @ZA17532 36823324
         AR    RPAR,RB                  BYPASS THIS DATA SET   @ZA17532 36823624
OBPAM328 EQU   *                                               @ZA17532 36823924
         L     RC,DSCCORE               GET NEXT DSCB IN CHAIN @ZA17532 36824224
         LTR   RC,RC                    IS THERE ONE?          @ZA17532 36824524
         BZ    OBPAM330                 NO,ANY OF THEM VV?     @ZA17532 36824824
         CLI   DSCFMTID,C'1'            YES,IS IT A FORMAT 1?  @ZA17532 36825124
         BNE   OBPAM328                 NO,ANY MORE?           @ZA17532 36825424
         B     OBPAM322                 YES,IS IT A VV?        @ZA17532 36825724
OBPAM330 EQU   *                                               @ZA17532 36826024
         DROP  RC                                              @ZA17532 36826324
         USING FORCORE,RCORE                                   @ZA17532 36826624
         NC    DXCCW12+4(4),DXCCW12+4   ANY DATA SET ON VV?    @ZA17532 36826924
         BZ    OBPAM600                 NO,WE ARE DONE         @ZA17532 36827224
         B     OBPAM540                 YES,GO ISSUE ACQUIRE   @ZA17532 36827524
VIRTRTN  EQU   *                        START OF STAGING LOGIC @ZA17532 36827824
*      CHECK FOR PREVIOUSLY ACQUIRED DATA SETS                 @OZ28203 36828124
*      (1) NEW DATA WITH TTR OF ZERO                           @OZ28203 36828224
*      (2) TEMP DATA SET PASSED FROM STEP TO STEP              @OZ28203 36828324
         TM    JFCBIND2,JFCNEW          NEW  DATA SET?         @OZ28203 36828424
         BO    CKPOTTR                  YES CHECK TTR          @OZ28203 36828524
         TM    JFCBIND2,JFCTEMP         TEMP DATA SET?         @OZ28203 36828624
         BNO   DOACQ                    NO PROCESS             @OZ28203 36828724
         TM    UCBSTAT,UCBRESV+UCBPRES  PERM MOUNTED VOLUME ?  @OZ28203 36828824
         BM    CKOUTPUT                 YES, GO CHECK OUTPUT   @OZ28203 36828924
         BO    CKOUTPUT                                        @OZ28203 36829024
         B     DOACQ                    NO, DO ACQUIRE         @OZ28203 36829124
CKOUTPUT EQU   *                                               @OZ28203 36829224
         TM    DEBOPATB,OUTIN           OUTPUT PROCESSING ?    @OZ28203 36829324
         BNO   NOACQ                    NO , BY PASS ACQUIRE   @OZ28203 36829424
CKPOTTR  EQU   *                        CHECK FOR TTR OF ZERO  @OZ28203 36829524
         TM    DSCFILTY,POTEST          P.O. DATASET ?         @OZ28203 36829624
         BO    DOACQ                    YES.TTR IS NEVER ZERO  @OZ28203 36829724
         CLC   DSCLSTAR(3),NOALLOC      TTR = ZERO ?           @OZ28203 36829824
         BNE   NOACQ                    NO  , BY PASS ACQUIRE  @OZ28203 36829924
DOACQ    EQU   *                                               @OZ28203 36830024
         CLC   DEBSTRCC,FOXES           VALID EXTENT?          @ZA17532 36830124
         BE    OBPAM600                 NO,EXIT                @ZA17532 36830224
*                                                              @ZA17532 36830324
*        INITIALIZE FOR VIRTUAL DASD PROCESSING                @ZA17532 36830424
*                                                              @ZA17532 36830524
         BAL   RPARC,GETMAIN            YES,GETMAIN FOR ACQUIRE@ZA17532 36830624
         USING ACQLST,RTIOT                                    @ZA17532 36830724
         SR    RJ,RJ                    NO EXTENTS IN LIST YET @ZA17532 36830824
*                                       THIS REGISTER USED TO  @ZA17532 36830924
*                                       COUNT NUM OF EXTENTS   @ZA17532 36831024
*                                       IN ACQUIRE LIST        @ZA17532 36831324
         NC    DXCCW12+4(4),DXCCW12+4   FIRST ACQUIRE LIST?    @ZA17532 36831424
         BNZ   OBPAM332                 NO,CHAIN TO LAST       @ZA17532 36831724
         ST    R1,DXCCW12+D4            SAVE THE POINTER       @Y30LSBS 36832024
         B     OBPAM334                 CONTINUE               @ZA17532 36832324
OBPAM332 EQU   *                                               @ZA17532 36832624
         ST    R1,ARNEDB                CHAIN ACQUIRE LIST     @ZA17532 36832924
*                                                              @ZA17532 36833224
*        THIS LOGIC KEEPS TRACK OF ACQUIRE LISTS AS FOLLOWS    @ZA17532 36833524
*              RTIOT  ADDRESS OF BEGINNING OF ACQUIRE LIST     @ZA17532 36833824
*              RWTGC  ADDRESSABILITY FOR FILLING IN EXTENTS    @ZA17532 36834124
*                                                              @ZA17532 36834424
OBPAM334 EQU   *                                               @ZA17532 36834724
         LR    RTIOT,R1                 SAVE ACQUIRE LIST      @ZA17532 36835024
         LR    RWTGC,RTIOT              NEW NOW CURRENT        @ZA17532 36835324
         TM    DSCFILTY,POTEST          IS THIS A PDS?         @ZA17532 36835624
         BZ    OBPAM338                 NO,BRANCH              @ZA17532 36835924
*                                                              @ZA17532 36836224
*        PDS PROCESSING                                        @ZA17532 36836524
*                                                              @ZA17532 36836824
         DROP  RTIOT                                           @ZA17532 36837124
         USING ACQLST,RWTGC                                    @ZA17532 36837724
         BAL   RPARC,CONVERT            FIND EOF               @ZA17532 36838024
         MVC   AREXT(2),DEBSTRCC        STAGE FIRST CYLINDER   @ZA17532 36838324
         MVC   AREXT+2(2),AREXT         (CONTAINS DIRECTORY)   @ZA17532 36838924
         LA    RJ,1(RJ)                 ONE EXTENT IN ACQUIRE  @ZA17532 36839524
         TM    DEBOPATB,OUTIN           OUTPUT?                @ZA17532 36840124
         DROP  RWTGC                                           @ZA17532 36840724
         USING ACQLST,RTIOT                                    @ZA17532 36841324
         STC   RJ,ARNMEXTS              ONE EXTENT             @ZA17532 36841924
         LA    RWTGC,L'AREXT(RWTGC)     DIRECTORY IN LIST      @ZA17532 36842524
         BNO   OBPAM324                 NO,GO BYPASS THIS D.S. @ZA17532 36843124
         DROP  RTIOT                                           @ZA17532 36844324
         USING ACQLST,RWTGC                                    @ZA17532 36844924
         CLC   AREXT-4(2),DXCCW5+4      IS EOF ON CYL CONTAIN- @ZA17532 36845924
*                                       ING THE DIRECTORY      @ZA17532 36846224
         BNE   OBPAM403                 NO,GO STAGE EOF        @ZA17532 36846524
         B     OBPAM404                 YES,DON'T STAGE IT ANEW@ZA17532 36846824
OBPAM338 EQU   *                                               @ZA17532 36847424
         TM    DEBOPATB,OUTIN           OUTPUT OR OUTIN?       @ZA17532 36848124
         BO    OBPAM400                 YES,OUTPUT PROCESSING  @ZA17532 36848824
*                                                              @ZA17532 36849524
*        INPUT PROCESSING   - INPUT,INOUT,UPDAT                @ZA17532 36850224
*        ACQUIRE (WITH STAGE) UP TO AND INCLUDING EOF          @ZA17532 36850924
         CLC   DSCLSTAR(5),NOALLOC      EMBEDDED EOF?          @ZA17532 36853024
         MVI   DXCCW5,X7F               IF NO,STAGE ALL        @ZA17532 36853724
         BE    OBPAM350                 NO,NO CVT TTR CONVERT  @ZA17532 36854424
         BAL   RPARC,CONVERT            CONVERT TTR TO MBBCCHHR@ZA17532 36855124
*                                       AND PLACE IT IN DXCCW5 @ZA17532 36855824
*                                                              @ZA17532 36856524
*        AT THIS POINT DXCCW5 CONTAINS 7F OR 0MBBCCHH          @ZA17532 36857224
OBPAM350 EQU   *                        LOOP FOR FILLING IN    @ZA17532 36857924
*                                       ACQUIRE LIST EXTENTS   @ZA17532 36858624
         MVC   AREXT(2),DEBSTRCC        STARTING CC OF EXTENTCS@ZA17532 36860724
         CH    RJ,DXCCW5                THIS EXT HAVE LAST REC @Y30LSBS 36861424
*                                       COMPARING EXTENT NUM   @ZA17532 36862124
*                                       TO M OF MBBCCHHR       @ZA17532 36862824
         BE    OBPAM370                 YES,GO HANDLE IT       @ZA17532 36863524
         MVC   AREXT+2(2),DEBENDCC      NO,END CC TO PARM LIST @ZA17532 36864224
         B     OBPAM390                 GO SEE IF MORE EXTENTS @ZA17532 36864924
OBPAM370 EQU   *                                               @ZA17532 36865624
         LH    R1,DXCCW5+4              CYL WHERE LAST REC IS  @ZA17532 36866324
         CLC   DXCCW5+6(2),DEBENDHH     IS LAST TRACK OF D.S.  @ZA17532 36867024
*                                       ON THIS CYLINDER?      @ZA17532 36867724
         BNE   OBPAM380                 NO,STAGE UP TO AND     @ZA17532 36868424
*                                       INCLUDING THIS CYLINDER@ZA17532 36869124
         CH    R1,DEBENDCC              ON LAST CYLINDER OF    @ZA17532 36869824
*                                       THIS EXTENT?           @ZA17532 36870524
         BE    OBPAM382                 YES, IGNORE EOF MARKER @ZA17532 36871224
         LA    R1,1(R1)                 NO,EOF MAY BE ON NEXT  @ZA17532 36871924
OBPAM380 EQU   *                                               @Y30LSBS 36872624
         STH   R1,AREXT+2               LAST CYL TO BE STAGED  @ZA17532 36873324
         B     OBPAM384                 GO ACCOUNT FOR THIS EXT@ZA17532 36874024
*                                                              @ZA17532 36874724
*        THIS CODE IS REQUIRED IN THE UNUSUAL CONDITION WHERE  @ZA17532 36875424
*        THE EOF WAS WRITTEN ON THE NEXT EXTENT.               @ZA17532 36876124
*                                                              @ZA17532 36876824
OBPAM382 EQU   *                                               @ZA17532 36877524
         STH   R1,AREXT+2               LAST CYL OF THIS EXTENT@ZA17532 36878224
         LA    RJ,1(RJ)                 ACCOUNT FOR THIS EXTENT@ZA17532 36878924
         CR    RJ,RD                    EXHAUSTED ALL EXTENTS? @ZA17532 36879624
         BE    OBPAM500                 YES,NO EOF WRITTEN     @ZA17532 36880324
         LA    RPAR,DEBEXTLN            NO,POINT TO NEXT       @ZA17532 36881024
         LA    RWTGC,L'AREXT(RWTGC)     EXTENT LISTS           @ZA17532 36881724
         MVC   AREXT(2),DEBSTRCC        EOF MAY BE ON THE FIRST@ZA17532 36882424
         MVC   AREXT+2(2),DEBSTRCC      TRACK OF THIS EXTENT   @ZA17532 36883124
OBPAM384 EQU   *                                               @ZA17532 36883824
         LA    RJ,D1(RJ)                PUT EXT NUMBER IN LIST @Y30LSBS 36884524
         B     OBPAM500                 GO TO ISSUE ACQUIRE    @ZA17532 36885224
*                                                              @ZA17532 36885924
*        SEE IF EXHAUSTED ALL EXTENTS                          @ZA17532 36886624
*                                                              @ZA17532 36887324
OBPAM390 EQU   *                                               @ZA17532 36888024
         LA    RJ,1(RJ)                 INCREMENT NUM OF EXTENT@ZA17532 36888724
         LA    RWTGC,L'AREXT(RWTGC)     NEXT EXTENT IN ACQUIRE @ZA17532 36889424
         CR    RJ,RD                    PROCESSED ALL EXTENTS? @ZA17532 36890124
         LA    RPAR,DEBEXTLN            NEXT DEB EXTENT        @ZA17532 36890824
         BNE   OBPAM350                 NO,GO PROCESS THIS ONE @ZA17532 36891524
         B     OBPAM500                 YES,GO ISSUE ACQUIRE   @ZA17532 36892224
*                                                              @ZA17532 36892924
*        OUTPUT PROCESSING - OUTPUT OR OUTIN                   @ZA17532 36893624
*                                                              @ZA17532 36894324
OBPAM400 EQU   *                                               @ZA17532 36895024
         TM    JFCBIND2,JFCOLD          IS DATA SET OLD OR NEW?@ZA17532 36895724
         BO    OBPAM408                 YES,THEN NOT MOD       @ZA17532 36896424
*                                                              @ZA17532 36897124
*        DISP=MOD PROCESSING                                   @ZA17532 36897824
*                                                              @ZA17532 36898524
*        FOR DISP=MOD,THE CYLINDER CONTAINING THE EOF IS STAGED@ZA17532 36899224
*        NO ACQUIRE IS ISSUED FOR THE CYLINDERS PRECEEDING THE @ZA17532 36899924
*        EOF. ALL EXTENTS BEYOND EOF ARE TREATED AS NORMAL     @ZA17532 36900624
*        OUTPUT IE. WE WILL ACQUIRE ALL EXTENTS - WITH INHIBIT @ZA17532 36901324
*        STAGE IF POSSIBLE.                                    @ZA17532 36902024
*                                                              @ZA17532 36902724
         BAL   RPARC,CONVERT            CONVERT TTRN OF EOF    @ZA17532 36904124
OBPAM403 EQU   *                                               @ZA17532 36904824
         MVC   AREXT(2),DXCCW5+4        STAGE CYLINDER CONTAIN-@ZA17532 36905524
         MVC   AREXT+2(2),DXCCW5+4      ING LAST RECORD        @ZA17532 36906224
         LA    RJ,1(RJ)                 ACCOUNT FOR THIS CYL   @ZA17532 36906924
         DROP  RWTGC                                           @ZA17532 36907124
         USING ACQLST,RTIOT                                    @ZA17532 36907324
         STC   RJ,ARNMEXTS              NUM OF EXTENTS IN ACQ  @ZA17532 36907624
         SR    RB,RB                    CLEAR WORK REGISTER    @ZA17532 36908324
OBPAM402 EQU   *                                               @ZA17532 36909024
         CH    RB,DXCCW5                LAST REC IN THIS EXTENT@ZA17532 36909724
         BE    OBPAM404                 YES,NOW GO SET UP NEW  @ZA17532 36910424
         LA    RPAR,DEBEXTLN            NO,SET UP TO CHECK NEXT@ZA17532 36911124
         LA    RB,1(RB)                 INCREASE M             @ZA17532 36911824
         BCT   RD,OBPAM402              GO CHECK THIS EXTENT   @ZA17532 36912524
OBPAM404 EQU   *                                               @ZA17532 36914624
         LH    RB,DXCCW5+4              LAST REC IN THIS CYL   @ZA17532 36915324
         CH    RB,DEBENDCC              LAST CYLINDER OF EXTENT@ZA17532 36916024
         BNE   OBPAM406                 NO,ACQUIRE REST OF EXT @ZA17532 36916724
         BCTR  RD,0                     YES,ANY MORE EXTENTS?  @ZA17532 36917424
         BZ    OBPAM540                 NO,GO ISSUE ACQUIRE    @ZA17532 36918124
         LA    RPAR,DEBEXTLN            YES,POINT TO NEXT ONE  @ZA17532 36918824
         LH    RB,DEBSTRCC              FIRST CYL OF NEW EXT   @ZA17532 36919524
         B     OBPAM407                 TO ACQUIRE LIST        @ZA17532 36920224
OBPAM406 EQU   *                                               @ZA17532 36920924
         LA    RB,1(RB)                 CYLINDER AFTER LAST REC@ZA17532 36921624
OBPAM407 EQU   *                                               @ZA17532 36922324
         BAL   RPARC,GETMAIN            ACQUIRE LIST FOR REST  @ZA17532 36923024
         ST    R1,ARNEDB                CHAIN IT TO PREVIOUS   @ZA17532 36925124
         LR    RWTGC,R1                 ADDRESSABILITY FOR     @ZA17532 36925824
         LR    RTIOT,R1                 NEW ACQUIRE LIST       @ZA17532 36926524
         OI    ARFLAG,INHIBST           INHIBIT STAGE THIS TIME@ZA17532 36927224
         DROP  RTIOT                                           @ZA17532 36927924
         USING ACQLST,RWTGC                                    @ZA17532 36928624
         STH   RB,AREXT                 FIRST CYL TO ACQUIRE   @ZA17532 36929324
         SR    RJ,RJ                    NO EXTENTS IN LIST     @ZA17532 36930024
         B     OBPAM412                 CONTINUE AS NORMAL OUT @ZA17532 36930724
*                                                              @ZA17532 36931424
*        OUPUT PROCESSING - DISP=OLD OR NEW                    @ZA17532 36932124
*                                                              @ZA17532 36932824
*        IF ANY EXTENT OF THE DATA SET IS NOT ON A CYLINDER    @ZA17532 36933524
*        BOUNDARY,THEN ALL EXTENTS WILL BE STAGED              @ZA17532 36934224
*                                                              @ZA17532 36934924
OBPAM408 EQU   *                                               @ZA17532 36935624
         DROP  RWTGC                                           @ZA26462 36936324
         USING ACQLST,RTIOT                                    @ZA17532 36936624
         OI    ARFLAG,INHIBST           SET INHIBIT STAGE BIT  @ZA17532 36936924
OBPAM410 EQU   *                        LOOP FOR FILLING IN    @ZA17532 36937224
*                                       EXTENTS IN ACQUIRE LIST@ZA17532 36937524
         DROP  RTIOT                                           @ZA17532 36937824
         USING ACQLST,RWTGC                                    @ZA17532 36938124
         MVC   AREXT(2),DEBSTRCC        STARTING CYL TO LIST   @ZA17532 36938424
OBPAM412 EQU   *                                               @ZA17532 36939124
         MVC   AREXT+2(2),DEBENDCC      ENDING CC TO LIST      @ZA17532 36939824
         TM    DEBDVMOD,DEBCYL          CYLINDER BOUNDARY?     @ZA17532 36940524
         BNO   OBPAM416                 YES,DON'T RESET        @ZA17532 36941224
         DROP  RWTGC                                           @ZA26462 36941424
         USING ACQLST,RTIOT                                    @ZA26462 36941524
         NI    ARFLAG,X'FF'-INHIBST     NO,RESET INHIBIT BIT   @ZA17532 36941924
OBPAM416 EQU   *                                               @ZA17532 36942624
         LA    RWTGC,L'AREXT(RWTGC)     NEXT ACQUIRE EXTENT    @ZA17532 36943324
         LA    RPAR,DEBEXTLN            NEXT DEB EXTENT        @ZA17532 36944024
         LA    RJ,1(RJ)                 COUNT THIS EXTENT      @ZA17532 36944724
         BCT   RD,OBPAM410              ACQUIRE ALL EXTENTS    @ZA17532 36945424
         TM    JFCBIND2,JFCNEW          NEW DATA SET?          @OZ28203 36945624
         BO    OBPAM500                 YES,CAN INHIBIT        @ZA26462 36946024
         TM    DCBMACRF,DCBMRECP        DCB USING EXCP MACRO?  @ZA17532 36946124
         BO    OBPAM418                 YES,STAGE ALL          @ZA17532 36946824
         TM    DCBMACRF,DCBMRPT1        USING READ NOTE/POINT? @ZA17532 36947524
         BO    OBPAM418                 BIF YES TO STAGE DATA  @ZA30847 36947724
         TM    DCBMACF2,DCBMRPT2        USING WRITE NOTE/POINT @ZA30847 36947924
         BZ    OBPAM500                 BIF NO, CAN INHIBIT    @ZA30847 36948124
OBPAM418 EQU   *                                               @ZA17532 36948924
         NI    ARFLAG,X'FF'-INHIBST     YES,STAGE ALL          @ZA17532 36951024
*                                                              @ZA17532 36951724
*        THIS IS THE ACQUIRE ROUTINE.  IT ISSUES THE ICBACREL  @Y30LSBS 36952424
*        MACRO TO GET DASD SPACE IF THE DATA SET IS ON MSS     @Y30LSBS 36953124
*        VIRTUAL DASD.                                         @ZA17532 36953824
*                                                              @Y30LSBS 36957024
OBPAM500 EQU   *                                               @Y30LSBS 36957624
         STC   RJ,ARNMEXTS              YES, STORE NUMB EXTENTS@Y30LSBS 36958224
*                                                              @Y30LSBS 36963003
*              ISSUE THE ACQUIRE.  IF IT FAILS, XCTL TO        @Y30LSBS 36963703
*              PROBLEM DETERMINATION FOR A 413-2C ABEND.       @Y30LSBS 36965003
*                                                              @Y30LSBS 36965403
OBPAM540 EQU   *                                               @Y30LSBS 36966003
         L     RTIOT,DXCCW12+4          GET FIRST ACQUIRE LIST @ZA17532 36967024
         LR    R1,RTIOT                 SET UP FOR ACQUIRE     @ZA17532 36967524
         ICBACREL TYPE=ACQ,MF=(E,ACQLST)   GET THE DASD SPACE  @Y30LSBS 36968024
         LTR   RJ,RJ                    ANY ERRORS             @Y30LSBS 36968524
         BZ    OBPAM550                 NO                     @Y30LSBS 36969024
*        ACQUIRE FAILED - ABEND                                @Y30LSFY 36969524
*        NOTE IFG0199B DESTROYS SECOND WORD OF PARM LIST       @ZA17532 36970024
*                                                              @ZA17532 36970524
OBPE111  EQU   111                      IDMS FAILURE CODE      @Y30LSFY 36971024
         LM    RPAR,RTIOT,DXCCW6        RESTORE REGS           @ZA17532 36971524
         LR    RDEB,R1                  PASS PARM LIST PTR     @Y30LSFY 36972103
         DMABCOND OBPE111,SOP6M,RES=NO,REGSAVE=YES,RETURN=NONE @Y30LSFY 36972803
         B     TCTLRTN                  XCTL TO PROB DET       @Y30LSFY 36973503
OBPAM550 EQU   *                                               @Y30LSBS 36974203
*                                                              @Y30LSBS 36974924
*        FREE UP ALL THE CORE                                  @Y30LSBS 36975924
*                                                              @Y30LSBS 36976924
         LR    R1,RTIOT                 AREA TO BE FREED       @ZA17532 36977924
         L     RTIOT,ARNEDB             ADDR OF CHAIN IF ANY   @ZA17532 36978924
         USING WTG,RWTG                                        @ZA17532 36979924
OBPAMFRE IECRES FREE,A=(R1),PREFIX=YES,STM=(RDCB,RJ,WTGPREFX)  @Y30LSBS 36980924
         LTR   RTIOT,RTIOT              ANOTHER ACQUIRE LIST?  @ZA17532 36981924
         BNZ   OBPAM550                 YES,GO FREE IT         @ZA17532 36982924
OBPAM600 EQU   *                        END OF MSS ROUTINE     @ZA17532 36983924
         LM    RPAR,RTIOT,DXCCW6        RESTORE REGS           @ZA17532 36984924
         DROP  RWTG                                            @ZA17532 36985924
         DROP  RTIOT                                           @ZA17532 36986924
         DROP  RPAR                                            @ZA17532 36987924
         EJECT                                                          36996103
*********************************************************************** 37000000
*                                                                       37100000
*      TEST FOR USER OF EXCP NOT BSAM OR QSAM                           37200000
*                                                                       37300000
*********************************************************************** 37400000
*                                                                       37500000
         TM    DCBMACRF,X'80'           EXCP BIT ON                     37600000
         BC    8,SAMOUT                 NO BRANCH                       37700000
         USING WTGENTRY,RWTGC                                    Y02072 37750002
         MVC   WTGIDTTR,SOP11           COPY DCB BACK TO USER  @Z30TSCF 37760003
         B     RELOOP                                                   37900000
*                                                                       38000000
SAMOUT   EQU   *                                                        38100000
*                                                                       38200000
         TM    ZERO(RPARC),INMASK       TEST FOR INPUT DATA SET    UT18 38209018
         BZ    SAMOUT1                  BR IF INPUT                UT18 38218018
         TM    DCBDSORG,POTEST          TEST FOR PO DATA SET       UT18 38227018
         BO    SAMOUT1                  BR IF  PO DATA SET         UT18 38236018
         TM    DCBOPTCD,TOTMASK         TEST FOR TOTALING          UT18 38245018
         BZ    SAMOUT1                  BR IF NOT SPECIFIED        UT18 38254018
         MVC   WTGIDTTR,SOP1Y           ST ID IN WTG TABLE     @Z30TSCF 38256003
         B     RELOOP                   UNCONDITIONAL BRANCH       UT18 38272018
*                                                                  UT18 38281018
SAMOUT1  EQU   *                        SYMBOLIC ADDR              UT18 38290018
         MVC   WTGIDTTR,SOP1B           ST ID IN WTG TABLE     @Z30TSCF 38292003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     UPDATE WHERE TO GO ENTRY        38600000
         LA    RPARC,PLOFF(0,RPARC)     UPDATE PARA LIST ENTRY          38700000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            38800000
         BCR   8,RBASE                  YES BR BACK TO BEGINNING        38900000
*                                                                       39000000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    39100000
         BC    7,RELOOP                 NO BRANCH                       39200000
*                                                                       39300000
         LR    RPARC,RPAR                                               39400000
         LA    RWTGC,WAOFF(0,RWTG)      RE INIT  WTG LIST               39500000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           39600000
         BC    7,TCTLRTN                NO XCTL                         39700000
*                                                                       39800000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  39900000
         LA    RPARC,PLOFF(0,RPARC)                                     40000000
         BC    15,ZCHEK                                                 40100000
*                                                                       40200000
TCTLRTN  EQU   *                                                        40300000
         USING WTG,RWTG                                                 40850003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*40900003
               MODID=WTGENTRY                                  @Z30TSCF 40950003
         DROP  RWTGC,RWTG                                      @Z30TSCF 40960003
*                                                              @ZA17532 40961024
*        THIS ROUTINE BALRS TO THE RESIDENT CONVERT ROUTINE TO @ZA17532 40962024
*        DETERMINE IN WHAT EXTENT AND WHERE THE LAST PHYSICAL  @ZA17532 40963024
*        RECORD OF THE DATA SET IS.                            @ZA17532 40964024
*                                                              @ZA17532 40965024
CONVERT  EQU   *                                               @ZA17532 40966024
         USING ACQLST,RTIOT                                    @ZA17532 40967024
         ST    RDCB,DXCCW12             SAVE DCB ADDRESS       @ZA17532 40968024
         STM   RTIOT,RJ,DXCCW8          SAVE WORK REGS         @ZA17532 40969024
         SR    RE,RE                    ZERO WORK REGISTER     @ZA17532 40970024
         ICM   RWK3,B'1110',DSCLSTAR    GET TTR                @ZA17532 40971024
         LA    RDCB,AREXT               GET RETURN ADDRESS     @ZA17532 40972024
         LR    R1,RDEB                  REG 1 NEEDS DEB        @ZA17532 40973024
         L     RJ,CVTPTR                GET      CVT           @ZA17532 40974024
         USING CVT,RJ                   ADDRESSABILITY         @ZA17532 40975024
         L     RJ,CVTPCNVT              GET CONVERT ROUTINE    @ZA17532 40976024
         DROP  RJ                                              @ZA17532 40977024
         BALR  RD,RJ                    GO TO CONVERT ROUTINE  @ZA17532 40978024
         L     RDCB,DXCCW12             RESTORE DCB ADDRESS    @ZA17532 40979024
         LM    RTIOT,RJ,DXCCW8          RESTORE THE REGS       @ZA17532 40980024
         MVC   DXCCW5,AREXT-1           SAVE 0MBBCCHH          @ZA17532 40981024
         XC    AREXT(8),AREXT           CLEAN UP               @ZA17532 40981524
         BR    RPARC                    RETURN                 @ZA17532 40982024
         DROP  RTIOT                                           @ZA17532 40983024
*                                                              @ZA17532 40984024
*        THIS ROUTINE OBTAINS CORE FOR AN ACQUIRE LIST         @ZA17532 40985024
*        THE CORE IS CLEARED AND KNOWN VALUES ARE INSERTED     @ZA17532 40986024
*                                                              @ZA17532 40987024
         USING WTG,RWTG                                        @ZA17532 40988024
GETMAIN  IECRES GET,PREFIX=YES,SP=230,LV=ACQPLN,ID=MSS1,       @ZA17532.40989024
               STM=(RDCB,RJ,WTGPREFX)   OBTAIN CORE FOR LIST   @ZA17532 40990024
         USING ACQLST,R1                ACQUIRE ADDRESSABILITY @ZA17532 40991024
         XC    ACQLST(ACQPLN),ACQLST    CLEAR CORE             @ZA17532 40992024
         MVC   ARVOL,UCBVOLI            MOVE IN VOLID          @ZA17532 40993024
         MVI   ACQLST+D3,ACQPLN         SET LIST LENGTH        @ZA17532 40994024
         MVI   AROP,ACQOP               SET ACQUIRE OPTION     @ZA17532 40995024
         BR    RPARC                    RETURN                 @ZA17532 40996024
         DROP  RWTG                                            @ZA17532 40997024
         DROP  R1                                              @ZA17532 40998024
*                                                                       41000000
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   41100000
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                41200000
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                41300000
*                                                                       41350002
*  MODULE ID'S                                                          41360002
*                                                                       41370002
SOP11    DC    C'11',VL3(IGG01911)      LAST EXECUTOR          @Z30TSCF 41380003
SOP1Y    DC    C'1Y',VL3(IGG0191Y)      USER TOTALING EXECUTO  @Z30TSCF 41390003
SOP1B    DC    C'1B',VL3(IGG0191B)      ANY OTHER CONDITION    @Z30TSCF 41392003
SOP6M    DC    C'6M',VL3(IGG0196M)      PROBLEM DET.           @ZA04216 41392237
OPIDCNST DC    C'0S'                                                    41400000
AMIDCNST DC    C'1N'                    THIS EXEC'S ID.                 41500000
*                                                                       41502002
*  OTHER CONSTANTS                                                      41504002
*                                                                       41506002
NOALLOC  DC    2F'0'                   COMPARE FOR 0 IN EXTENT   A43880 41510021
FOXES    DC    F'-1'                    INVALID EXTENT FOR DEB  SA54462 41520021
         USING INFMJFCB,RWK5                                     Y02072 41530002
DSNCLC   CLC   JFCBDSNM+1(0),JFCBDSNM+2 IS REST OF DSN BLANK?   OZ03183 41550037
CLCINST  CLC   JFCBDSNM(0),ALTDSNAM     USED TO COMPARE DSN IN   Y02072 41570002
*                                         ALT AGAINST DSN IN     Y02072 41580002
*                                         THE JFCB               Y02072 41590002
VLIDLNP1 DC    0H'0',AL2(L'ALTVOLID+1)  LENGTH OF THE ALT VOLID  Y02072 41592002
*                                         FIELD PLUS '1' FOR AN  Y02072 41594002
*                                         EXECUTE INSTRUCTION    Y02072 41596002
*                                                                       41600000
*                                                                       42520021
PATCH    DC    0H'0',50X'00'            PATCH AREA             @Z30TSCF 42540003
END      EQU   *                        END OF MODULE            Y02072 42620002
         EJECT                                                          42670002
SRT      DSECT                                                          42900000
         IEFUCBOB                                                       43000000
*                                                                       43100000
         EJECT                                                          43200000
         DCBD  DSORG=PS                                                 43300021
CVT      DSECT                                                          43400000
         CVT                                                            43500000
*   TASK CONTROL BLOCK                                                  43600000
         CNOP  0,4                                                      43700000
TCB      DSECT                                                          43800000
TCBRBP   DS    F                       PO9NTER TO EXECUTING RB          43900000
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   44000000
TCBDEB   DS    F                       POINTER TO DEB QUEUE             44100000
TCBTIO   DS    F                       POINTER TO TIOT                  44200000
TCBCMP   DS    F                       TASK COMPLETION CODE             44300000
TCBTRN   DS    F                       TESTRAN FIELD                    44400000
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 44500000
TCBPKF   DS    CL1                     RESERVED FOR FUTURE USE          44600000
TCBFLGS  DS    FL5                     FLAG BYTES                       44700000
TCBLMP   DS    CL1                     RESERVED FOR FUTURE USE          44800000
TCBDSP   DS    CL1                     RESERVED FOR FUTURE USE          44900000
TCBLLS   DS    F                       POINTER TO LOAD LIST             45000000
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            45100000
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  45200000
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       45300000
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             45400000
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  45500000
TCBTCB   DS    F                       RESERVED FOR FUTURE USE          45600000
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         45700000
         DS    CL24                                                     45800000
TIOT     DSECT                                                          45900000
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       46000000
TIOESTTA DS    CL1                           STATUS -A-                 46100000
TIOERLOC DS    CL2                           REL. LOC OF POOL           46200000
TIOEDDNM DS    2F                            DDNAME                     46300000
TIOEJFCB DS    1F                            JFCB DISK ADDR             46400000
TIOESTTB DS    0CL1                                                     46500000
TIOEFSRT DS    CL4                                                      46600000
         DS    CL1                                                      46700000
*        TIOT POOL ENTRY                                                46800000
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       46900000
         DS    CL1                                                      47000000
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      47100000
*                                             SLOTS)                    47200000
TIOPPOOL DS    CL8                           POOL NAME                  47300000
TIOPSTTB DS    XL1                           STATUS OF SLOT             47400000
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  47500000
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      47600000
         SPACE 1                                                        47700000
         IEZDEB                                                         47750003
DEBEXTLN EQU   DEBNMTRK+L'DEBNMTRK                             @ZA17532 48750024
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 51250003
         ORG   WTGIDTTR                                          Y02072 51260002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 51270002
DXRGSAVE EQU   DXCCW5                   SAVE AREA FOR REGISTER   Y02072 51300002
CCWOFSET EQU   DXXCTL-FORCORE           XCTL PARM LIST OFFSET  @Y30LSFY 51600003
DCBOFSET EQU   DCBDEBAD-IHADCB     DEB RLCATBL OFFSET IN DCB            51700000
DXUCBA   EQU   DSCBEND                  UCB ADDR FOR CURRENT VOL Y02072 51710002
*                                                                       51750002
* DSECT FOR THE AUTHORIZED LIBRARY TABLE                         Y02072 51760002
*                                                                       51770002
ALTABLE  DSECT                                                   Y02072 51780002
ALTLENTH DS    X                        LENGTH OF TABLE DBL WDS  Y02072 51790002
ALTNOENT DS    X                        NUMBER OF ENTRIES IN ALT Y02072 51792002
ALTENT   EQU   *                        FOR ADDRESSABILITY FROM  Y02072 51792402
*                                         ALTABLE DSECT          Y02072 51792502
ALTENTRY DSECT                          DATA SET ENTRY           Y02072 51792802
ALTLNENT DS    X                        LEN OF ALTVOLID+ALTDSNAM Y02072 51794002
ALTVOLID DS    CL6                      VOLUME ID FOR DATASET    Y02072 51796002
ALTDSNAM DS    C                        DATASET NAME - LEN VAR   Y02072 51798002
ACQLST   DSECT                                                 @Y30LSBS 51798424
ACQOP    EQU   X'02'                    ACQUIRE OP CODE        @Y30LSBS 54798424
ACQPLN   EQU   96                       PARM LIST LENGTH       @Y30LSBS 57798424
         ICBACREL TYPE=ACQ,MF=L         LIST FORM              @Y30LSBS 60798424
           END                                                          63798424
./  ADD  SSI=43081075,NAME=IGG0191O
 TITLE 'IGG0191O--STAGE 2 OPEN EXECUTOR FOR INPUT ON DA'                00100002
IGG0191O CSECT                                                          00101019
*MODULE NAME - IGG0191O                                          Y02072 00103002
*                                                                       00105002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00107002
*                                                                       00107402
*COPYRIGHT - NONE                                                Y02072 00107802
*                                                                       00108202
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00108602
*                                                                       00109002
*          VS 1 RELEASE 3 DELETIONS/CHANGES                             00109402
*                                                                XA2057 00109802
*          VS2 RELEASE 2 DELETIONS                               Y02072 00111002
*019800,307600-307800,312000,337000,467080,520000-522000,        Y02072 00121002
*530000-532000,651000,537000,540000,561000,568000,651000         Y02072 00131002
*                                                                YM7595 00133002
*                                                                       00135003
*          VS2 RELEASE 3 DELETIONS                                      00137003
*                                                              @Z30TSCF 00139003
*                                                                       00140019
*          RELEASE 20 DELETIONS                                       * 01500019
*3632107000-109000,179000,233000,310100-310400,314000-322000,    S20201 01520020
*3632353000-354000,382000-388000,402000-403000,416000,425000-    S20201 01540020
*3632438000,440000-449000,452000-453000,457000-459000,466000-    S20201 01560020
*3632467000,471000-475000,479100-479200,488000-489000,603000     S20201 01580020
*          RELEASE 21 DELETIONS                                       * 01600019
*0091042000,566000,589000-591000,613000-619000,651000,689000-    S21042 01630021
*0091690000                                                      S21042 01660021
*  REFER TO CODE FLAGGED XA2057                                 SA62781 01710002
*                                                                       01950019
*STATUS CHANGE LEVEL 003                                                01980002
*                                                                       02010019
*FUNCTION/OPERATION--FOR DCB'S BEING OPENED FOR INPUT                   02100019
*      IT WILL LINK THE IOB'S AND INITIALIZE THEM.                      02700019
*      IT WILL CONSTRUCT CHANNEL PROGRAMS NEEDED FOR PROPER EXECUTION.  02800019
*      IT WILL SET UP THE NUMBER OF EXTENTS NEEDED AND PLACE THE        02900019
*      ADDRESSES IN THE DCB AND IOB'S.                                  03000019
*                                                                       03100019
*      THIS MODULE WAS SPLIT FROM IGG0191D FOR RELEASE 19               03110019
*                                                                       03120019
*ENTRY POINTS--ENTERED FROM IGG0191D BY USE OF THE XCTL MACRO.          03200019
*                                                                       03300019
*INPUT--SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       03400019
*OUTPUT--IOB(USER), SEE DESCRIPTION OF THE REGISTERS, DCB(USERS)        03500019
*                                                                       03600019
*                                                                       03700019
*EXTERNAL ROUTINES--NONE.                                               03800019
*                                                                       03900019
*EXITS-NORMAL--XCTL TO IGG01915 TO LOAD ROUTINES                        04000019
*                                                                       04100019
*EXITS-ERROR--XCTL TO PROB DET (IGG0196M) FOR WTP AND 013 ABEND         04160021
*            INSUFFICIENT BUFFERS AVAILABLE IN                          04220021
*            BUFFER POOL TO SATISFY DCB BUFFER REQUIREMENTS       M1552 04300019
*                                                                       04350002
*MACROS-ACTION-MODESET, XCTL, XCTLTABL, DMABCOND                 Y02072 04360002
*                                                                       04370002
*MACROS-MAPPING-IECDSECS(DCB,IOB,WTG),IHACCW,IGGBCB,IHAFCAUD     Y02072 04380002
*                                                                       04400019
*TABLES/WORKAREAS-- WHERE TO GO TABLE  (WTG)                            04500019
*                                                                       04600019
*   BYTE 0-7   NAME                                                     04700019
*   BYTE 8-10  RELATIVE DISK ADDRESS (TTR) OF FIRST RECORD              04800019
*   BYTE 11    CONCATENATION NUMBER                                     04900019
*   BYTE 12    ZERO                                                     05000019
*   BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR           05100019
*              ALIAS INDICATOR 1 BIT                                    05200019
*              NUMBER OF TTRS IN USERS DATA FIELD  2 BITS               05300019
*   BYTE 14-16 TTR OF FIRST TEXT RECORD                                 05400019
*   BYTE 17    ZERO                                                     05500019
*   BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                         05600019
*   BYTE 20    TRANSLATION TABLE                                        05700019
*   BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST               05800019
*   BYTE 22-23 ATTRIBUTES                                               05900019
*   BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE        06000019
*   BYTE 27-28 LENGTH OF FIRST TEXT RECORD                              06100019
*   BYTE 29    LENGTH OF WTG TABLE  (IN DOUBLE WORDS)                   06200019
*   BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                           06300019
*   BYTE 32-34 IDTTR OF EXECUTOR FOR 1ST DCB                            06400019
*   BYTE 35    WORKAREA ADDRESS FOR 1ST DCB                             06500019
*   BYTE 36-39 TABLE OF IDTTR'S                                         06600019
*                                                                       06700019
*        32+N(8)   IDTTR OF EXECUTOR FOR NTH DCB      (3 BYTES)         06800019
*                  WORKAREA ADDRESS FOR NTH DCB       (1 BYTE)          06900019
*                  IDTTR OF LAST ROUTINE  LOAD        (3 BYTES)         07000019
*                  NOT USED                           (1 BYTE)          07100019
*                                                                       07200019
*                                                                       07300019
*********************************************************************** 07400019
*ATTRIBUTES--REENTRANT, REUSABLE, SUPERVISOR STATE,              Y02072 07500002
*            RUNS IN USER KEY UNLESS OTHERWISE SPECIFIED         Y02072 07550002
*                                                                       07600019
*                                                                       07700019
*********************************************************************** 07800019
*                                                                       07900019
*                                                                       08000019
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                08100019
*                                                                       08200019
*********************************************************************** 08300019
*                                                                       08400019
RDCB     EQU   2                        DCB REGISTER                    08500019
RBASE    EQU   3                        BASE REGISTER                   08600019
RCORE    EQU   4                        WORK AREA ADDRESS               08700019
RPAR     EQU   5                        TOP OF PARAMETER LIST           08800019
RWTG     EQU   6                        TOP OF WTG TABLE                08900019
RPARC    EQU   7                        CURRENT PARAMETER               09000019
RWTGC    EQU   8                        CURRENT TRANS LOAD              09100019
RBUFADR  EQU   9                        MAINTAINS ADDR OF NEXT   Y02072 09150002
*                                         AVAILABLE BUFFER       Y02072 09160002
RUCB     EQU   10                       COUNTER IN IOB GENERATION       09300019
RDEB     EQU   11                       DEB ADDRESS                     09400019
RB       EQU   12                       WORK REG1  **                   09500019
RC       EQU   13                       WORK REG2  **  IOB GENERATION   09600019
RWK1     EQU   RC                       WORK REGISTER            Y02072 09650002
RD       EQU   14                       WORK REG3  **                   09700019
RJ       EQU   15                       WORK REG4                       09800019
CPR      EQU   RJ                       ADDR OF CHANNEL PROG            09900019
RWK2     EQU   RJ                       WORK REGISTER            Y02072 09950002
RE       EQU   0                        WORK REG5                       10000019
RF       EQU   1                        WORK REG6                       10100019
*                                                                       10200019
*                                                                       10300019
PARAR    EQU   RPARC                                                    10400019
*                                                                       10500019
*********************************************************************** 10600019
*                                                                       10610020
* DISPLACEMENTS AS EQUATES                                              10620020
*                                                                       10630020
D0       EQU   0                        DISPLACEMENT OF ZERO     S20201 10640020
D1       EQU   1                        DISPLACEMENT OF ONE      S20201 10650020
D4       EQU   4                        DISPLACEMENT OF FOUR     S20201 10660020
D6       EQU   6                        DISPLACEMENT OF SIX      S20201 10670020
D7       EQU   7                        DISPLACEMENT OF SEVEN    S20201 10680020
D8       EQU   8                        DISPLACEMENT OF EIGHT    S20201 10690020
D16      EQU   16                       DISPLACEMENT OF SIXTEEN  S20201 10700020
*                                         DMO                    S20201 10710020
D24      EQU   24                       DISPLACEMENT OF 24       S20201 10720020
D28      EQU   28                       DISPLACEMENT OF          S20201 10730020
*                                       TWENTYEIGHT              S20201 10740020
D31      EQU   31                       DISPLACEMENT OF          S20201 10750020
*                                       THIRTYONE                S20201 10760020
D36      EQU   36                       DISPLACEMENT OF          S20201 10770020
*                                       THIRTYSIX                S20201 10780020
D40      EQU   40                       DISPLACEMENT OF FORTY    S20201 10790020
D44      EQU   44                       DISPLACEMENT OF          S20201 10800020
*                                       FORTYFOUR                S20201 10810020
D47      EQU   47                       DISPLACEMENT OF          S20201 10820020
*                                       FORTYSEVEN               S20201 10830020
D48      EQU   48                       DISPLACEMENT OF 48       S20201 10840020
D64      EQU   64                       DISPLACEMENT OF 64       S20201 10850020
*                                                                       10860020
* BYTE COUNTS AS EQUATES                                                10870020
*                                                                       10880020
B0       EQU   0                        BYTE COUNT OF ZERO       S20201 10890020
B1       EQU   1                        BYTE COUNT OF ONE        S20201 10900020
B8       EQU   8                        BYTE COUNT OF EIGHT      S20201 10910020
*                                                                       10920020
*********************************************************************   11000019
* MASK'S TO TEST PARAMETER LIST WITH                                    11100019
INP      EQU   X'0F'                                                    11200019
OUTP       EQU   X'0F'                                                  11300019
UPDATE     EQU   X'04'                                                  11400019
INOUT      EQU   X'03'                                                  11500019
OUTIN      EQU   X'07'                                                  11600019
RDBACK     EQU   X'01'                                                  11700019
*                                                                       11800019
*                                                                       11900019
*********************************************************************   12000019
*                                                                       12100019
*                                                                       12200019
* OFFSET FOR PARAMETER TESTS                                            12300019
*                                                                       12400019
ONE        EQU   X'01'                                                  12500019
FRTYATE    EQU   48                                                     12600019
DISPSN     EQU   X'0'                                                   12700019
*                                                                       12800019
*                                                                       12900019
*********************************************************************   13000019
*                                                                       13100019
* OFFSETS FOR DEB REFERENCE                                             13200019
*                                                                       13300019
*                                                                       13400019
BIN        EQU   36                     BIN NOS.                   DM0I 13500019
BEXT       EQU   38                     BIN EXTENT                 DM0I 13600019
*                                                                       13700019
*                                                                       13800019
*                                                                       13900019
*********************************************************************   14000019
*                                                                       14100019
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              14200019
*                                                                       14300019
*                                                                       14400019
*                                                                       14500019
DOUBLE     EQU   X'01'                                                  14600019
*                                                                       14700019
*                                                                       14800019
STOWB      EQU   X'80'                                                  14900019
WRTCK      EQU   X'80'                  WRITE CHECK                DM0I 15000019
OVRFLO     EQU   X'20'                                                  15100019
PCI        EQU   X'20'                                                  15200019
MINKEY     EQU   X'01'                                                  15300019
CONCAT     EQU   X'FF'                                                  15400019
*                                                                       15500019
*********************************************************************   15600019
*                                                                       15700019
* MASKS FOR ACCESS METHODS IN SAM                                       15800019
*                                                                       15900019
QSAMB      EQU   X'01'                                                  16000019
BSAMBIT    EQU   X'00'                                                  16100019
PAM        EQU   X'02'                                                  16200019
*                                                                       16300019
*                                                                       16400019
* MASKS FOR MACRO'S TO BE USED                                          16500019
*                                                                       16600019
GETB       EQU   X'40'                                                  16700019
PUTB       EQU   X'40'                                                  16800019
READB      EQU   X'20'                                                  16900019
WRITEB     EQU   X'20'                                                  17000019
POINTB     EQU   X'04'                                                  17100019
CNTRLB     EQU   X'02'                                                  17200019
*                                                                       17300019
*                                                                       17400019
*********************************************************************   17500019
*                                                                       17600019
* MASKS FOR DEVICES TO BE SUPPORTED                                     17700019
*                                                                       17800019
SRCHDRK  EQU   X'40'                    SRCH DIRECT MASK         S20201 17840020
NOTSILI  EQU   X'DF'                    NOT SIL BIT MASK         S20201 17880020
NORCDRY  EQU   X'20'                    NO RCD READY FOR ENTIRE  S20201 17920020
*                                       DATA SET MASK                   17960020
*                                                                       18000019
*********************************************************************   18100019
*                                                                       18200019
*                                                                       18300019
COFFSR   EQU   88                       OFFSET OF RDCCW IF RCD   S20201 18310020
*                                       READY USED                      18320020
CSTOFFSR EQU   72                       OFFSET OF RDCCW IF RCD   S20201 18330020
*                                       READY AND F-STD RCDS            18340020
SRCHD    EQU   X'40'                    SEARCH DIRECT MASK       S20201 18350020
*                                         DMO                    S20201 18360020
*                                                                  DMOR 18370020
*                                                                       18400019
*                                                                       18500019
*********************************************************************   18600019
*                                                                       18700019
* MASKS FOR STATUS BITS TO BE TESTED                                    18800019
*                                                                       18900019
*                                                                       19000019
EXCPN      EQU   X'30'                                                  19100019
COMPLETE   EQU   X'60'                  COMPLETE MASK              DM0I 19200019
FIRSTIOB   EQU   X'01'                                                  19300019
*                                                                       19400019
*                                                                       19500019
*                                                                       19600019
*********************************************************************   19700019
*                                                                       19800019
* MASKS FOR BUFFER TECHNIQUE'S                                          19900019
*                                                                       20000019
BFTEKR     EQU   X'20'                  BDAM VS                         20100019
VSBITS     EQU   X'48'                  VS BITS IN DCBRECFM             20200019
CYCLICB    EQU   X'20'                                                  20300019
EXCHANGB   EQU   X'10'                                                  20400019
SIMPLEB    EQU   X'40'                                                  20500019
EXCHCYCL   EQU   X'30'                                                  20600019
*                                                                       20700019
*********************************************************************   20800019
*                                                                       20900019
*                                                                       21000019
* MODES OF OPERATION FOR QSAM                                           21100019
*                                                                       21200019
LOCATEB    EQU   X'08'                                                  21300019
MOVEB      EQU   X'10'                                                  21400019
SUBSTUTB   EQU   X'04'                                                  21500019
*                                                                       21600019
*                                                                       21700019
*********************************************************************   21800019
*                                                                       21900019
*                                                                       22000019
* COMMAND BYTES FOR THE 2841                                            22100019
*                                                                       22200019
*       CONTROL UNIT                                                    22300019
*                                                                       22400019
*                                                                       22500019
*                                                                       22600019
SRCHE      EQU   X'31'                                                  22700019
WRTCKD     EQU   X'1D'                                                  22800019
RDC        EQU   X'92'                                                  22900019
RDKD       EQU   X'8E'                                                  23000019
RDD        EQU   X'86'                                                  23100019
TIC        EQU   X'08'                                                  23200019
MTRCT    EQU   X'92'                    M/T RD CNT CCW CMND      S20201 23240020
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      S20201 23280020
RDSC     EQU   X'22'                    READ SECTOR CCW CMND     S20201 23320020
*                                                                       23360020
*                                                                       23400019
*********************************************************************   23500019
*                                                                       23600019
*                                                                       23700019
* MASKS FOR RECORD FORMATS                                              23800019
*                                                                       23900019
*                                                                       24000019
STANDRDF   EQU   X'88'                  STANDARD FORMORT           DM0I 24100019
FORMATU    EQU   X'C0'                                                  24200019
FORMATF    EQU   X'80'                                                  24300019
FORMATV    EQU   X'40'                                                  24400019
BLOCKED    EQU   X'10'                                                  24500019
*                                                                       24600019
*                                                                       24700019
*********************************************************************   24800019
*                                                                       24900019
*                                                                       25000019
*   CHANNEL CONTROL WORD FLAGS                                          25100019
*                                                                       25200019
SKIP       EQU   X'10'                                                  25300019
SLI        EQU   X'20'                                                  25400019
SLIBIT     EQU   X'DF'                  TO TURN OFF SLI BIT             25500019
CCWNOP     EQU   X'03'                  NOP                             25600019
CC         EQU   X'40'                                                  25700019
DATACH     EQU   X'A0'                                                  25800019
SLICC      EQU   X'60'                                                  25900019
SLICCSK    EQU   X'70'                                                  26000019
*                                                                       26100019
*                                                                       26200019
*********************************************************************   26300019
*                                                                       26400019
*                                                                       26500019
KEYS       EQU   X'01'                                                  26600019
QSAM       EQU   X'01'                                                  26700019
*                                                                       26800019
*                                                                       26900019
*********************************************************************   27000019
*                                                                       27100019
GETMAIN    EQU   4                                                      27200019
QSAMZ      EQU   X'05'                  MASK                       DM0I 27300019
NRMLEND    EQU   X'7F'                  NORMAL END CODE FOR ECB         27310019
SRCHDRCT   EQU   X'40'                  SEARCH DIRECT--DCBCIND1         27320019
POBIT      EQU   X'02'                  PARTITIONED ORGANIZATION        27330019
ABCODE     EQU   X'013'                  ABEND CODE                     27340019
COMMTABL   EQU   16                     MASK                       DM0I 27400019
NULL       EQU   0                      CONSTANT 0                      27410019
IOBNUM     EQU   1                      DEFAULT NO OF IOB'S             27500019
K2         EQU   2                      CONSTANT 2                      27510019
K3         EQU   3                      CONSTANT 3                      27520019
WORD       EQU   4                      LENGTH OF A FULL WORD           27530019
K5         EQU   5                      CONSTANT 5                      27540019
K6         EQU   6                      CONSTANT 6                      27550019
K7         EQU   7                      CONSTANT 7                      27551019
K8         EQU   8                      CONSTANT 8                      27560019
L1CCW      EQU   8                      LENGTH OF 1 CCW                 27600019
K12        EQU   12                     CONSTANT 12                     27610019
K14        EQU   14                     CONSTANT 14                     27620019
K16        EQU   16                     CONSTANT 16                     27630019
L2CCW      EQU   16                     LENGTH OF 2 CCW'S               27700019
K19        EQU   19                     CONSTANT 19                     27710019
K20        EQU   20                     CONSTANT 20                     27720019
K23        EQU   23                     CONSTANT 23                     27730019
L3CCW      EQU   24                     LENGTH OF 3 CCW'S               27800019
K24        EQU   24                     CONSTANT 24                     27810019
K28        EQU   28                     CONSTANT 28                     27820019
K31        EQU   31                     CONSTANT 31                     27830019
K32        EQU   32                     CONSTANT 32                     27840019
K36        EQU   36                     CONSTANT 36                     27850019
L5CCW      EQU   40                     LENGTH OF 5 CCW'S               27900019
K40        EQU   40                     CONSTANT 40                     27910019
K43        EQU   43                     CONSTANT 43                     27920019
IOBLNGTH   EQU   48                     LENGTH OF IOB                   28000019
K48        EQU   48                     CONSTANT 48                     28001019
CPLNGTH    EQU   64                     LENGTH OF CHANNEL PRGM          28010019
K64        EQU   64                     CONSTANT 64                     28020019
K80        EQU   80                     CONSTANT 80                     28030019
K83        EQU   83                     CONSTANT 83                     28040019
K104       EQU   104                    CONSTANT 104                    28050019
OABD064  EQU   64                                                S21042 28070021
*********************************************************************   28100019
*                                                                       28200019
*                                                                       28300019
*                                                                       28400019
*                                                                       28500019
*                                                                       28600019
*                                                                       28800019
*                                                                       28900019
*                                                                       29000019
         BALR  RBASE,NULL               REG 3 IS BASE                   29100019
         USING SOP2,RBASE                                               29200019
         USING IHADCB,RDCB              REG 2 IS DCB                    29300019
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR         29500019
SOP2     EQU   *                                                        30100019
*                                                                       30150002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 30160002
         DC    C'IGG0191O'              MODULE NAME              Y02072 30170002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 30180003
         DC    C'10/18/74'              LAST DATE MODIFIED     @Z30TSCF 30190003
BEGIN    DS    0H                                                Y02072 30192002
*                                                                       30200019
         L     RDCB,NULL(RPARC)         GET DCB ADDRESS                 30300019
         LA    RDCB,NULL(RDCB)          CLEAR HI BYTE                   30400019
         L     RCORE,WORD(RWTGC)        GET WORK AREA ADDRESS           30500019
*                                                                       30600019
         L     RB,DCBIOBA               GET FIRST IOB ADDR              30700019
         MODESET  KEYADDR=DXUKEY,WORKREG=9  GET INTO USER KEY    Y02072 30742002
         LR    RC,RB                    SET UP WORK REG                 30800019
         LR    RD,RB                    SET UP WORK REG                 30900019
         SR    RF,RF                    CLEAR FOR IC                    31000019
         IC    RF,DCBNCP                GET NO OF IOB'S                 31100019
         TM    DCBCIND2,QSAMB           QSAM USED                S20201 31120020
         BNO   SOP230                   BRANCH IF NO             S20201 31140020
         IC    RF,DCBBUFNO              USE BUFFER NO FOR IOB    S20201 31160020
*                                       CNT                      S20201 31180020
SOP230   EQU   *                                                 S20201 31400020
         LR    RUCB,RF                  LOAD REGISTER            S20201 31500020
         LR    RDEB,RUCB                PUT COUNT IN DECR REG    S20201 31600020
*                                         DMO                    S20201 31700020
SOPSTART EQU   *                                                 S20201 31800020
*                                                                       31900020
* START OF IOB BUILD ROUTINE                                            32000020
*                                                                       32100020
         SPACE 2                                                        32300019
*                                                                       32400019
SOP242   EQU   *                                                        32500019
*                                                                       32600019
         ST    RB,NULL(RD)              LINK NEW IOB TO LAST ONE BUILT  32700019
         LR    RD,RB                    UPDATE CURRENT IOB POINTER      32800019
         LA    RB,WORD(RB)              POINT TO ECB SLOT               32900019
         OI    NULL(RB),NRMLEND         SET ECB COMPLETE WITHOUT ERROR  33000019
         ST    RB,K12(RD)               STORE ECB ADDR IN IOB           33100019
         LA    RB,K20(RB)               POINT TO CP POINTER SLOT        33200019
         LR    RC,RB                    SAVE ADDR                       33300019
         LA    RB,K24(RB)               POINT TO CP START ADDR          33400019
SOP243   EQU   *                                                        33500019
         ST    RB,NULL(RC)              STORE CP STARTAD IN IOB         33600019
         L     RWK2,DXUDCBAD            GET USERS DCB ADDR       Y02072 33700002
         USING IOBSIOCC,RC                                       Y02072 33750002
         ST    RWK2,IOBDCBPT            DCB ADDR TO IOB          Y02072 33760002
         DROP  RC                                                Y02072 33770002
         MVC   K40(L'DCBFDAD,RD),DCBFDAD  INITIALIZE IOBFDAD.           33800019
*                                                                       33900019
*********************************************************************** 34000019
*                                                                       34100019
*    CONSTRUCTION OF READ CHANNEL PROGRAM FOLLOWS                       34200019
*                                                                       34300019
*********************************************************************** 34400019
*                                                                       34500019
SOP255   EQU   *                                                        34600019
*                                                                       34700019
         LA    RC,K19(RC)               POINT TO CCHHR FIELD IN IOB     34800019
         TM    JFCBMASK+D6,NORCDRY      ANY NON RPS DEVICES      S20201 34810020
         BO    SOP2NC1                  BRANCH IF YES            S20201 34820020
         BAL   RJ,SOP2STA               IF NOT GO BUILD SET      S20201 34830020
*                                       SECTOR                   S20201 34840020
SOP2NC1  EQU   *                                                 S20201 34850020
         ST    RC,NULL(RB)              STORE ADDR IN SRCH CCW          34900019
         MVI   NULL(RB),SRCHE           STORE CMD BYTE                  35000019
         MVI   K7(RB),K5                STORE COUNT OF 5 IN CCW         35100019
         OI    WORD(RB),CC              SET CMD CHAIN FLAG ON           35200019
         ST    RB,D8(RB)                PUT SEARCH ADDR IN TIC   S20201 35270020
*                                       CCW DMO                  S20201 35340020
         LR    RC,RB                    UPDATE PTR               S20201 35410020
         MVI   K8(RB),TIC               STORE TIC CMD BYTE              35500019
         SR    RE,RE                                              17363 35600019
         IC    RE,DCBKEYLE              OBTAIN KL                 17363 35700019
         AH    RE,DCBBLKSI              ADD DL                    17363 35800019
*     KL+DL TO RH OF TIC FOR USE BY EOB ROUT                      17363 35810019
         STH   RE,K14(RB)                                         17363 35900019
SOP255B  EQU   *                                                  17363 36000019
*                                                                       36100019
*                                                                       36200019
*     SRCH AND TIC CCWS HAVE BEEN GENERATED AT THIS POINT               36300019
*                                                                       36400019
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 36410002
         MVI   DCBOFFSR,K80             OFFSET TO RD CCW                36500019
         TM    DCBMACRF,POINTB          POINT MACRO USED ON INPUT       36600019
         BZ    SOP255A0                 NO BRANCH                       36700019
         MVI   DCBCNTRZ,QSAMZ           MOVE ID                    DM0I 36800019
         B     SOP2550                  GO ON                      DM0I 36900019
*                                                                       37000019
SOP255A0 EQU   *                                                        37100019
         TM    DCBRECFM,STANDRDF        STANDARD F RECORDS USED         37200019
         BO    SOP258                   YES BRANCH                      37300019
*                                                                       37400019
SOP2550  EQU   *                                                        37500019
         MODESET  KEYADDR=DXUKEY,WORKREG=15 GET INTO USER KEY    YM1393 37510002
         LA    RE,K24(RB)                                               37600019
         ST    RE,K16(RB)                                               37700019
         MVI   K16(RB),TIC              STORE TIC CMD BYTE              37800019
         OI    K20(RB),SLICCSK          SET SLI,CC,AND SKIP FLAGS       37900019
         MVI   K23(RB),ONE              STORE A COUNT OF ONE            38000019
*                                                                       38100019
         CH    RUCB,CONONE              ONE IOB TO BE BUILT      S20201 38300020
*                                         DMO                    S20201 38500020
SOP256   BE    SOP256C                  YES BRANCH                      38900019
*                                                                       39000019
*                                                                       39100019
SOP256A  LA    RC,K83(RC)               POINT TO NEXT DA ADDR FIELD     39200019
SOP256B  ST    RC,K24(RB)               STORE IN RD COUNT CCW           39300019
         MVI   K24(RB),RDC              STORE RD CNT CMD BYTE           39400019
         B     SOP257                   GO ON                      DM0I 39500019
*                                                                       39600019
SOP256C  L     RDCB,DXUDCBAD            GET ADDR OF USERS COPY   Y02072 39650002
         LA    RC,DCBFDAD+K3            POINT TO CCHHR IN DCB           39700002
         L     RDCB,0(RPARC)            GET ADDR OF PROTECTED    Y02072 39750002
         B     SOP256B                  BACK                       DM0I 39800019
*                                                                       39900019
SOP257   MVI   K31(RB),K5               STORE COUNT OF 5 IN RDC CCW     40000019
         OI    K28(RB),SLICC            SET SLI AND CC FLAGS            40100019
*                                                                       40120020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 40140020
*                                       READY                    S20201 40160020
         BO    SOP258A                  BRANCH IF YES            S20201 40180020
         MVI   D31(RB),B8               SET BYTE COUNT TO EIGHT  S20201 40200020
         LA    RE,D48(RB)               GET DW END CHP           S20201 40220020
         ST    RE,D24(RB)               PUT AS ADDRESS IN CCW    S20201 40240020
         MVI   D24(RB),RDC              PUT IN RD CNT CCW        S20201 40260020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 40262002
         MVI   DCBOFFSR,COFFSR          PUT IN CARN OFFSET       S20201 40280020
         MODESET  KEYADDR=DXUKEY,WORKREG=15 GET INTO USER KEY    YM1393 40282002
         OI    D36(RB),SLI              SILI ON FOR ALL BUT      S20201 40300020
*                                       STNDRD                   S20201 40320020
         NI    D28(RB),NOTSILI          CLEAR SILI BIT           S20201 40340020
         B     SOP258A                  EVER ONWARD              S20201 40360020
SOP258   SH    RB,SXTEN                 SUBT 16 FROM START OF CP ADDR   40400019
         MVI   DCBCNTRL+K3,ONE          EPD2 ID NUMBER                  40500019
         OI    DCBCIND1,SRCHDRCT        SET SRCH DIRECT FLAG            40600019
         MODESET  KEYADDR=DXUKEY,WORKREG=15 GET INTO USER KEY    YM1393 40610002
*                                                                       40700019
SOP258A  EQU   *                                                        40800019
         TM    DCBCIND2,QSAMB           QSAM USED                       40900019
         BO    SOP259                   YES BRANCH                      41000019
*                                                                       41100019
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         41200019
         BL    SOP259A                  NO BRANCH                       41300019
*                                                                       41400019
         MVI   K32(RB),RDKD             STORE RD KEY&DATA CMD BYTE      41500019
         B     SOP259C                  GO AROUND NEXT           S20201 41600020
*                                                                       41700019
SOP259   EQU   *                                                        41800019
         LA    RF,K32(RB)               POINT TO ACTUAL RD DATA CCW     41900019
*                                                                       41950002
* FILL IN CCW WITH BUFFER ADDRESS AND BYTE COUNT                        42000002
*                                                                       42050002
         L     RWK2,DCBBUFCB            ADDR OF BUF CNTRL BLK    YM7595 42100002
         USING BCBLK,RWK2                                               42150002
         L     RBUFADR,BCBBUFPT         ADDR OF NEXT AVAIL BUF   YM7595 42160002
         LTR   RBUFADR,RBUFADR          IS BUFFER ADDR VALID     YM7595 42170002
         BZ    BUFERR                   NO, GO ISSUE DMABCOND    YM7595 42180002
         USING BUFFER,RBUFADR                                           42190002
         MVC   BCBBUFAD,BUFNXPTB        UPDATE WITH NEW BUF ADD  YM7595 42192002
         USING CCW,RF                                                   42194002
         STCM  RBUFADR,B'0111',CCWADDRB  BUF ADDR TO CCW         YM7595 42196002
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 42198002
         DROP  RF,RWK2,RBUFADR                                          42198402
SOP259A  EQU   *                                                        42200019
         MVI   K32(RB),RDD              STORE RD DATA CMD BYTE          42300019
*                                                                       42400019
*                                                                       42440020
SOP259C  EQU   *                                                 S20201 42480020
*                                                                       42520020
         TM    DCBRECFM,FORMATU         FORMAT U RECORDS         S20201 42560020
*                                         DMO                    S20201 42600020
         BM    SOP259XB                 BRANCH IF NO             S20201 42640020
*                                         DMO                    S20201 42680020
         OI    D36(RB),SLI              TURN ON SILI FLAG        S20201 42720020
*                                         DMO                    S20201 42760020
SOP259XB EQU   *                                                 S20201 42800020
         TM    DCBCIND1,SRCHDRK         SERARCH DIRECT USED      S20201 42840020
         BNO   SOP2NST                  IF NO BRANCH             S20201 42880020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 42882002
         MVI   DCBOFFSR,D64             SET OFFSET FOR NORM F    S20201 42920020
*                                       RCDS                     S20201 42960020
         MODESET  KEYADDR=DXUKEY,WORKREG=15 GET INTO USER KEY    YM1393 42962002
         TM    JFCBMASK+D6,NORCDRY      STAND F AND RCD READY    S20201 43000020
         BO    SOP259G                  BRANCH IF NO             S20201 43040020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 43042002
         MVI   DCBOFFSR,CSTOFFSR        IF NO PUT CARNIVAL       S20201 43080020
*                                       OFFSET                   S20201 43120020
         MODESET  KEYADDR=DXUKEY,WORKREG=15 GET INTO USER KEY    YM1393 43122002
         MVI   D40(RB),MTRCT            IF YES PUT IN MT RD CNT  S20201 43160020
         OI    D36(RB),CC               TURN ON CMND CHAIN IN    S20201 43200020
*                                       PRE-                     S20201 43240020
*                                       VIOUS CCW                       43280020
         OI    D44(RB),CC+SLI+SKIP      CMND CHAIN + SLI + SKIP  S20201 43320020
*                                       IN THIS CCW                     43360020
         MVI   D47(RB),B1               SET BYTE CNT TO ONE      S20201 43400020
         LA    RB,B8(RB)                INCR PTR                 S20201 43440020
SOP2NST  EQU   *                                                 S20201 43480020
*                                                                       43520020
         TM    JFCBMASK+D6,NORCDRY      NOT STND F, BUT WITH RCD S20201 43560020
*                                       READY                           43600020
         BO    SOP2NRR                  BRANCH IF NO             S20201 43640020
         BAL   RJ,SOP2RTA               GO BUILD RD SECTOR CCW   S20201 43680020
SOP2NRR  EQU   *                                                 S20201 43720020
*                                                                       43760020
*******************************************************************DMOR 43800020
SOP259D  EQU   *                                                        43900019
         CH    RUCB,CONONE              ONE IOB TO BE BUILT      S20201 44200020
*                                         DMO                    S20201 44500020
SOP259E1 BE    SOP259G                  YES BRANCH                      45000019
*                                                                       45100019
         CH    RDEB,CONONE              THIS LAST IOB            S20201 45200020
         BNE   SOP259G                  BRANCH IF NO             S20201 45300020
*                                                                       45400019
         L     RC,DCBIOBA               GET FIRST IOB GENERATED         45500019
         LA    RC,K43(RC)               POINT TO CCHHR FIELD            45600019
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 45630020
*                                       READY  DMO               S20201 45660020
         BNO   SOP259G                  BRANCH IF NO             S20201 45690020
*                                         DMO                    S20201 45720020
         ST    RC,D24(RB)               RD CNT OF LAST IOB TO    S20201 45750020
*                                       FRST DMO                 S20201 45780020
         MVI   D24(RB),RDC              RESTORE CCW CMND         S20201 45810020
*                                         DMO                    S20201 45840020
SOP259G  EQU   *                                                  20185 45910019
         TM    DCBCIND1,SRCHDRCT        IS THIS SRCH DIRECT       20185 46100019
         BO    SOP259H                  YES, BRANCH               20185 46200019
         TM    DCBCIND2,QSAMB           QSAM USED                       46201019
         BO    SOP259I                  YES--BRANCH                     46202019
         TM    DCBBFTEK,BFTEKR          OFFSET READ                     46210019
         BZ    SOP259I                  NO--BRANCH                      46220019
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 46225020
*                                       READY  DMO               S20201 46230020
         BNO   SOP259I                  IF NO RCD READY          S20201 46235020
*                                       ACCOMPLISH DMO           S20201 46240020
*                                       ES OFFSET RD FUNCTION      DMOR 46245020
         LA    RB,CPLNGTH(RB)           TO NEXT IOB LOC                 46250019
         B     SOP240                   RETURN FOR NEXT IOB             46260019
SOP259I  EQU   *                                                        46270019
         LA    RB,K40(RB)               TO NEXT POSSIBLE IOB LOC  20185 46300019
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 46310020
*                                       READY  DMO               S20201 46320020
         BO    SOP259GX                 BRANCH IF YES            S20201 46330020
*                                         DMO                    S20201 46340020
         LA    RB,B8(RB)                INCR PTR                 S20201 46350020
*                                         DMO                    S20201 46360020
SOP259GX EQU   *                                                 S20201 46370020
*                                         DMO                    S20201 46380020
         B     SOP240                   RETURN FOR NEXT IOB       20185 46400019
SOP259H  EQU   *                                                  20185 46500019
         LA    RB,D40(RB)               PT TO NEXT POSS IOB      S20201 46508020
SOP240   EQU   *                                                 S20201 46516020
         SH    RDEB,CONONE              DECR IOB COUNT           S20201 46524020
*                                         DMO                    S20201 46532020
         BP    SOPSTART                 IF MOR IOBS BRANCH       S20201 46540020
         L     RB,DCBIOBA               IF NOT LINK LAST TO      S20201 46548020
*                                       FIRST  DMO               S20201 46556020
         ST    RB,D0(RD)                PUT FIRST ADDR IN LAST   S20201 46564020
*                                         DMO                    S20201 46572020
         B     OFFSETRD                 GO AROUND INTERNAL       S20201 46580020
*                                       SUBROUT DMO              S20201 46588020
*                                                                       46596020
* SET SECTOR CCW BUILD RTN                                              46604020
*                                                                       46612020
SOP2STA  EQU   *                                                 S20201 46620020
         L     RE,DXCCW11               GET SET SECTOR ADDR      S20201 46628020
         ST    RE,D0(RB)                PUT IN CCW               S20201 46636020
         MVI   D0(RB),SETSC             PUT IN CCW CMND          S20201 46644020
         MVI   D7(RB),B1                SET BYTE CNT TO ONE      S20201 46652020
         OI    D4(RB),CC                TURN ON CMND CHAIN       S20201 46660020
         B     CMNDFIN                  GO TO FINISH DETAILS     S20201 46668020
*                                                                       46676020
* READ SECTOR CCW BUILD RTN                                             46684020
*                                                                       46692020
SOP2RTA  EQU   *                                                 S20201 46700020
         L     RE,DXCCW11               GET READ SECTOR ADDR     Y02072 46708002
         ST    RE,D40(RB)               PUT IN CCW               S20201 46716020
         MVI   D40(RB),RDSC             PUT IN RD SECT CMND      S20201 46724020
         OI    D36(RB),CC               CMND CHAIN PREVIOUS CCW  S20201 46732020
         MVI   D47(RB),B1               SET BYTE CNT TO ONE      S20201 46740020
CMNDFIN  EQU   *                                                 S20201 46748020
         LA    RB,B8(RB)                INCR PTR                 S20201 46756020
         BR    RJ                       RETURN                   S20201 46764020
*                                                                       46772020
*                                                                       46780020
*                                                                       46800019
*                                                                       46900019
*                                                                       47000019
*                                                                       47030020
*                                                                       47060020
OFFSETRD EQU   *                                                 S20201 47090020
*                                                                       47120020
* IF RCD READY CHANNEL PROGRAM USED OFFSET RD FUNCTION ALREADY          47150020
* INSTITUTED                                                            47180020
*                                                                       47210020
         TM    DCBCIND2,QSAMB           IS IT QSAM               S20201 47240020
         BO    SOP2END                  YES LEAVE THIS RTN       S20201 47270020
         SR    RE,RE                    ELSE ZERO OUT A REG      S20201 47300020
         IC    RE,DCBNCP                GET NUMBER OF IOBS       S20201 47330020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 47360020
*                                       READY                    S20201 47390020
         BNO   SOP260                   BRANCH IF NO, SINCE CHP  S20201 47420020
*                                       AL-                      S20201 47450020
*                                       READY HAS FUNCTION              47480020
*                                       INCORPORATED IN CHANNEL PROG    47510020
* THE READ CHANNEL PROGRAMS WHICH HAVE JUST BEEN GENERATED MUST BE      47600019
* MODIFIED IF THE DCB IS BEING OPENED FOR OFFSET READ.                  47700019
*                                                                       47800019
         USING CPDEF,CPR                                                47900019
         TM    DCBBFTEK,BFTEKR          OFFSET READ                     48000019
         BZ    SOP2END                  NO--BRANCH                      48100019
         SR    RF,RF                    CLEAR FOR IC                    48400019
         IC    RF,DCBOFFSR              OFFSET TO READ CCW              48500019
         LA    RF,L1CCW(RF)             INCREMENT                       48600019
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 48610002
         STC   RF,DCBOFFSR              UPDATE OFFSET                   48700019
         MODESET  KEYADDR=DXUKEY,WORKREG=15 GET INTO USER KEY    YM1393 48710002
SOP260   EQU   *                                                        49000019
         LA    CPR,IOBLNGTH(RB)         ADDR OF CHANNEL PROG            49100019
         TM    JFCBMASK+D6,NORCDRY      IS IT RPS                S20201 49120020
         BNO   SOP2ENDX                 YES INITIALIZE COUNT     S20201 49140020
*                                       FIELD                    S20201 49160020
*                                                                       49200019
*    THE TOTAL EFFECT OF THE NEXT THREE INSTRUCTIONS IS TO PUSH         49300019
*    THE EXISTING CCW'S DOWN TO MAKE ROOM FOR AN EXTRA CCW AT THE       49400019
*    BEGINNING OF THE CHANNEL PROGRAM.                                  49500019
         MVC   CPRDKD(L3CCW),CPTIC1                                     49600019
         MVC   CPTIC2(L2CCW),CPNOP1                                     49610019
         MVC   CPSCH(L5CCW),CPTIC2                                      49800019
*                                                                       49900019
         MVI   NOP1CC,CCWNOP            NOP COMMAND                     50000019
         OI    NOP1FLAG,CC              CHAIN CCW                       50100019
         L     RF,CPTIC1                FIRST TIC                       50200019
         LA    RF,L1CCW(RF)             UPDATE DATA ADDR                50300019
         ST    RF,CPTIC1                                                50400019
         MVI   CPTIC1,TIC               TIC COMMAND                     50500019
         L     RF,CPTIC2                SECOND TIC                      50600019
         LA    RF,L1CCW(RF)             UPDATE DATA ADDR                50700019
         ST    RF,CPTIC2                                                50800019
         MVI   CPTIC2,TIC               TIC COMMAND                     50900019
         MVI   NOP2CC,CCWNOP            NOP COMMAND                     51000019
         L     RF,NULL(RB)              NEXT IOB ADDR                   51010019
         LA    RF,K104(RF)              AREA TO READ COUNT INTO         51100019
         ST    RF,RCTDATAD              STORE IN READ COUNT CCW         51200019
         NI    RCTFLAGS,SLIBIT          TURN OFF SLI BIT                51300019
         MVI   RCTBYTCT+ONE,L'CPCOUNT   READ ENTIRE COUNT FIELD         51400019
         MVI   RCTCC,RDC                RESTORE COMMAND CODE            51500019
SOP2ENDX EQU   *                                                 S20201 51550020
         TM    DCBRECFM,DCBRECF+DCBRECSB  FIXED STANDARD         XA2057 51560002
         BO    SOP2ENDY                 YES, BYPASS MOVING ID    XA2057 51570002
*                                         AS CCHHR FIELD DOES    XA2057 51580002
*                                         NOT EXIST              XA2057 51590002
         MVC   CPCOUNT(K5),K43(RB)      FIRST BLOCK ID                  51600019
SOP2ENDY EQU   *                                                 XA2057 51650002
         L     RB,NULL(RB)              NEXT IOB                        51700019
         BCT   RE,SOP260                NEXT CHANNEL PROG               51800019
SOP2END  EQU   *                                                        51900019
         L     RB,DCBIOBA               GET FIRST IOB            Y02072 51950002
         OI    NULL(RB),FIRSTIOB        SET INDIC ON FOR CLOSE   Y02072 52000002
         LR    RC,RB                    SAVE ADDR FOR QSAM USE   Y02072 52050002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 52150002
         SPACE                                                          52200002
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 52250002
         TM    DCBDSORG,POBIT          DCB FOR PO                       52300019
         BZ    SOP2ENDA                NO, BRANCH                       52400019
*                                                                       52500019
         MVI   DCBCNTRZ,QSAMZ                                      DM0I 52600019
*                                                                       52700019
SOP2ENDA EQU   *                                                        52800019
*                                                                       52900019
         TM    DCBRECFM,FORMATV         VARIABLE FORMAT            DM0I 53300019
         BZ    SOP2STOP                 BRANCH NOT V FORMAT        DM0I 53400019
         TM    DCBRECFM,FORMATF         FIXED FORMAT               DM0I 53500019
         BO    SOP2STOP                 YES, BRANCH                DM0I 53600019
         USING WTGENTRY,RWTGC                                    Y02072 53610002
         MVC   WTGIDTTR,SOPSLDVT        VARIABLE, GET 1915     @Z30TSCF 53650003
         B     RELOOP                   BACK TO MAIN LINE          DM0I 53800019
SOP2STOP EQU   *                                                        53900019
         MVC   WTGIDTTR,SOPSLDFT        FIXED, GET 1910        @Z30TSCF 53950003
RELOOP   LA    RWTGC,WGOFF(RE,RWTGC)    INCREMENT CURR WTG ENTRY        54200019
         LA    RPARC,PLOFF(NULL,RPARC)  INCR CURRENT DCB ENTRY PRTR     54210019
         CLC   NULL(L'AMIDCNST,RWTGC),AMIDCNST  THIS RT NEEDED AGAIN    54400019
         BCR   RWTGC,RBASE              BACK TO OPEN CONTROL ROUTINDM0I 54500019
*                                                                       54600019
         CLC   NULL(L'OPIDCNST,RWTGC),OPIDCNST  END OF TABLE            54700019
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             54800019
*                                                                       54900019
         LR    RPARC,RPAR                                               55000019
         LA    RWTGC,WAOFF(NULL,RWTG)   REINITIALIZE WTG LIST PTR       55100019
ZCHEK    CLI   NULL(RWTGC),NULL         IS THIS ENTRY COMPLETE          55200019
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         55300019
*                                                                       55400019
         LA    RWTGC,WGOFF(NULL,RWTGC)  GET NEXT ENTRY                  55500019
         LA    RPARC,PLOFF(NULL,RPARC)                                  55600019
         B     ZCHEK                    TO ZERO CHECK              DM0I 55700019
*                                                                       55800019
TCTLRTN  EQU   *                                                        55900019
         USING WTG,RWTG                                                 55950003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*56000003
               MODID=WTGENTRY                                  @Z30TSCF 56050003
         DROP  RWTGC,RWTG                                      @Z30TSCF 56100003
         EJECT                                                          56850002
*                                                                       58500019
**********************************************************************  58600019
*                                                                    *  58700019
BUFERR   EQU   *                                                  M1552 58800019
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 58810002
         DMABCOND OABD064,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X58900021
                                        CALL PROBLEM DETERMINATION      59000021
         B     TCTLRTN                                           S21042 59100021
WAOFF    EQU   32                                                       59200019
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           59300019
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           59400019
OPIDCNST DC    C'0S'                    ID                         DM0I 59500019
AMIDCNST DC    C'1O'                    ID                         DM0I 59600019
*                                                                       59700019
*********************************************************************** 59800019
*      CONSTANTS AND RESERVED STORAGE.                                  59900019
*                                                                       60000019
*                                                                       60100019
SXTEN    DC    H'16'                    SIXTEEN                    DM0I 60200019
CONONE   DC    H'1'                     CONSTANT OF ONE          S20201 60300020
SOPSLDFT DC    C'10',VL3(IGG01910)      FIXED LEN RECORDS      @Z30TSCF 60350003
SOPSLDVT DC    C'15',VL3(IGG01915)      VARIABLE LEN RECORDS   @Z30TSCF 60400003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETERMINATION     @Z30TSCF 60450003
         SPACE 3                                                        60550002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 60600002
END      EQU   *                        END OF MODULE            Y02072 60650002
         EJECT                                                          60660003
CVT      DSECT                                                 @Z30TSCF 60670003
         CVT                                                   @Z30TSCF 60680003
         EJECT                                                          60700002
CPDEF    DSECT                          OFFSET READ CHANNEL PROG        62200019
CPNOP1   DS    0D                       NOP OR SET SECTOR               62300019
NOP1CC   DS    0X                       COMMAND CODE                    62400019
NOP1DATA DS    A                        DATA ADDR                       62500019
NOP1FLAG DS    BL1                      FLAGS                           62600019
         DS    1X                       NOT USED                        62700019
NOP1BYTC DS    2X                       BYTE COUNT                      62800019
CPSCH    DS    D                        SEARCH ID EQUAL                 62900019
CPTIC1   DS    D                        TIC TO SEARCH                   63000019
CPTIC2   DS    D                        TIC TO READ COUNT               63100019
CPRDCNT  DS    0D                       READ COUNT                      63200019
RCTCC    DS    0X                       COMMAND CODE                    63300019
RCTDATAD DS    A                        DATA ADDR                       63400019
RCTFLAGS DS    BL1                      FLAGS                           63500019
         DS    1X                       NOT USED                        63600019
RCTBYTCT DS    2X                       BYTE COUNT                      63700019
CPRDKD   DS    0D                       READ (KEY) DATA                 63800019
RKDCC    DS    0X                       COMMAND CODE                    63900019
RKDDATAD DS    A                        DATA ADDR                       64000019
RKDFLAGS DS    BL1                      FLAGS                           64100019
         DS    1X                       NOT USED                        64200019
RKDBYTCT DS    2X                       BYTE COUNT                      64300019
CPNOP2   DS    0D                       NOP OR READ SECTOR              64400019
NOP2CC   DS    0X                       COMMAND CODE                    64500019
NOP2DATA DS    A                        DATA ADDR                       64600019
NOP2FLAG DS    BL1                      FLAGS                           64700019
         DS    1X                       NOT USED                        64800019
NOP2BYTC DS    2X                       BYTE COUNT                      64900019
CPCOUNT  DS    D                        FIELD TO READ COUNT INTO        65000019
         IECDSECS DCB,(MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES @Z30TSCF 65100003
         ORG   WTGIDTTR                                          Y02072 65150002
WTGID    DS    CL2                      2 BYTE ID OF MODULE      Y02072 65160002
DCBCNTRZ EQU   DCBCNTRL+1                                          DM0I 65200019
DCBCNTRX EQU   DCBCNTRL+3                                          DM0I 65300019
         EJECT                                                          65310002
FORCORE  DSECT                                                          65312002
         IHAFCAUD ORG=YES                                               65320002
         EJECT                                                          65350002
         IHACCW  DSECT=YES                                       Y02072 65360002
         EJECT                                                          65400002
         IGGBCB  TYPE=SAM                                               65450002
           END                                                          69100019
./  ADD  SSI=43081076,NAME=IGG0191P
         TITLE 'IGG0191P OPEN EXECUTOR (D/A UPDATE)'                    00020000
IGG0191P CSECT                                                          00020520
*MODULE NAME - IGG0191P                                          Y02072 00020902
*                                                                       00021302
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00021702
*                                                                       00022102
*COPYRIGHT - NONE                                                Y02072 00022202
*                                                                       00022302
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00022402
*                                                                       00023602
*          VS2 RELEASE 2 DELETIONS                               Y02072 00025602
*000204,000400,034000,035300-035800,047000,047400,047800,        Y02072 00026802
*081000-085000,120500-121200,089000,101000,1168000,118000,46300  Y02072 00028002
*43000,44000,44600-45400                                         YM2268 00030002
*                                                                YM4697 00030102
*                                                                YM7062 00030202
*                                                                       00030303
*          VS2 RELEASE 3 DELETIONS                                      00033203
*                                                              @Z30TSCF 00035203
*                                                                       00036803
*          RELEASE 20 DELETIONS                                         00039703
*2960001600-002200,004200,032800,053200-112200,120600-121600     S20201 00042603
*                                                                       00045503
*          RELEASE 21 DELETIONS                                         00048403
* 026600,036800,039400,040000,040600                             A31983 00051303
*                                                               SA53279 00054203
*STATUS CHANGE LEVEL 007                                                00057103
*FUNCTION/OPERATION- THIS ROUTINE WILL SET UP A CODE IN THE DCBCNTRL    00060000
*      FIELD FOR IGG01912.  IGG01912 (LOAD EXECUTOR) WILL DETERMINE     00080000
*      FROM THIS CODE WHICH ROUTINES WILL BE BROUGHT INTO CORE AT       00100000
*      OPEN TIME.  IT WILL DETERMINE HOW MANY IOB'S ARE TO BE CREATED,  00120000
*      USE 'GETMAIN' TO GET CORE FOR THE IOB'S, AND CLEAR THE CORE.     00140000
*      IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA           Y02072 00190002
*      INDICATING TO FORCE CLOSE THAT THE CORE GETMAINED FOR THE Y02072 00200002
*      IOB'S CAN BE FREEMAINED.                                  Y02072 00210002
*                                                                       00240000
*ENTRY POINTS- ENTERED FROM IGG0191B BY USE OF THE XCTL MACRO.          00260000
*                                                                       00280000
*INPUT- SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00300000
*                                                                       00320000
*OUTPUT & IOB(USER)- SEE DESCRIPTION OF REGISTERS, DCB(USERS).          00340000
*                                                                       00360000
*EXTERNAL ROUTINES- NONE.                                               00380000
*                                                                       00400000
*EXITS NORMAL-XCTL TO IGG0191Z FOR RECORD READY                         00410020
*             XCTL TO IGG0196P FOR NON RECORD READY                     00420020
*                                                                       00440000
*EXITS-ERROR- NONE.                                                     00460000
*                                                                       00470002
*MACROS : ACTION - MODESET, GETMAIN, XCTL                        Y02072 00472002
*                                                                       00480000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00500000
*                                                                       00520000
*      BYTE  0-7  NAME                                                  00540000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00560000
*      BYTE 11    CONCATENATION NUMBER                                  00580000
*      BYTE 12    ZERO                                                  00600000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00620000
*                        ALIAS INDICATOR 1 BIT                          00640000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00660000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00680000
*      BYTE 17    ZERO                                                  00700000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00720000
*      BYTE 20    TRANSLATION TABLE                                     00740000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00760000
*      BYTE 22-23 ATTRIBUTES                                            00780000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00800000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00820000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00840000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00860000
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       00880000
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        00900000
*      BYTE 40-   TABLE OF IDTTR'S                                      00920000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          00940000
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          00960000
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          00980000
*                   NOT USED                         (3 BYTES)          01000000
*                                                                       01020000
*      SEE DEVICETB DSECT                                               01040000
*                                                                       01060000
*ATTRIBUTES- REENTRANT,REUSABLE, RUNS IN SUPERVISOR STATE,       Y02072 01080002
*            RUNS IN USER KEY UNLESS OTHERWISE SPECIFIED.        Y02072 01090002
*                                                                       01100000
*                                                                       01120000
*********************************************************************** 01140000
*                                                                       01160000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01180000
*                                                                       01200000
*********************************************************************** 01220000
*                                                                       01240000
RDCB     EQU   2         DCB REGISTER                                   01260000
RBASE    EQU   3         BASE REGISTER                                  01280000
RCORE    EQU   4         WORK AREA ADDRESS                              01300000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01320000
RWTG     EQU   6         TOP OF WTG TABLE                               01340000
RPARC    EQU   7         CURRENT PARAMETER                              01360000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01380000
RTIOT    EQU   9         WRK REG AND COMM VECTOR ADDR.                  01400000
RUCB     EQU   10        COUNTER IN IOB GENERATION                      01420000
RDEB     EQU   11        DEB ADDRESS                                    01440000
RB       EQU   12        WORK REG1  **                                  01460000
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01480000
RD       EQU   14        WORK REG3  **                                  01500000
RJ       EQU   15        WORK REG4                                      01520000
RE       EQU   0         WORK REG5                                      01540000
RF       EQU   1         WORK REG6                                      01560000
*                                                                       01580000
*********************************************************************** 01600000
*                                                                       01620000
* MASKS FOR ACCESS METHODS IN SAM                                       01640000
*                                                                       01660000
QSAMB    EQU   X'01'                                                    01680000
*                                                                       01700000
*                                                                       01720000
*********************************************************************** 01740000
*                                                                       01760000
* MASKS FOR MACRO'S TO BE USED                                          01780000
*                                                                       01800000
POINTB   EQU   X'04'                                                    01820000
*                                                                       01840000
*********************************************************************** 01860000
*                                                                       01880000
* DCB OFFSET CONSTANTS                                                  01900000
*                                                                       01920000
WCPO     EQU   48                                                       01940000
WCWCPL   EQU   7              NO. OF CCW'S IN WRITE CHANNEL       18445 01946000
*                             PROGRAM IF WRITE CHECK IS SPECIFIED 18445 01952000
WCPL     EQU   3                                                        01960000
OFFSR    EQU   112                                                      01980000
WCOFFSR  EQU   144            OFFSET OF READ CCW FROM START OF    18445 01990000
*                             IOB PREFIX IF WRITE CHECK IS        18445 02000000
*                             SPECIFIED WITH QSAM                 18445 02010000
OFFSW    EQU   64                                                       02020000
OFFSRB   EQU   104                                                      02040000
WRTCKL   EQU   32             LENGTH OF WRITE CHECK SECTION OF    18445 02050000
*                             WRITE CHANNEL PROGRAM               18445 02060000
WCOFFSRB EQU   136            OFFSET OF READ CCW FROM START OF    18445 02070000
*                             IOB PREFIX IF WRITE CHECK IS        18445 02080000
*                             SPECIFIED WITH BSAM                 18445 02090000
*                                                                       02100000
*********************************************************************** 02120000
*                                                                       02140000
* MASKS USED TO TEST OPTION FIELDS IN DCB                               02160000
*                                                                       02180000
DOUBLE   EQU   X'01'                                                    02200000
WRTCK    EQU   X'80'                                                    02220000
UPDATEB  EQU   X'80'                                                    02240000
TRKOVFLB EQU   X'20'                    TRACK OVERFLOW OPTION           02260000
*                                                                       02280000
*********************************************************************** 02300000
*                                                                       02320000
* COMMAND BYTES FOR THE 2841                                            02340000
*                                                                       02360000
*       CONTROL UNIT                                                    02380000
*                                                                       02400000
SEEK     EQU   X'0B'                                                    02420000
SRCHE      EQU   X'31'                                                  02440000
RDC        EQU   X'92'                                                  02460000
RDD        EQU   X'86'                                                  02480000
RDDX     EQU   X'06'                                                    02500000
TIC        EQU   X'08'                                                  02520000
WRTD       EQU   X'05'                                                  02540000
WRTKD    EQU   X'0D'                                                    02560000
RDKD     EQU   X'8E'                                                    02580000
*                                                                       02600000
*********************************************************************** 02620000
*                                                                       02640000
NRECREDY EQU   X'20'                   NON RECORD READY MASK     S20201 02641020
UFORMAT  EQU   X'C0'                    UFORMAT                  S20201 02642020
TRKOVFL  EQU   X'20'                    TRACK OVERFLOW OPTION    S20201 02643020
ZERO     EQU   0                                                 S20201 02644020
TWO      EQU   2                        TWO                      S20201 02645020
THREE    EQU   3                        THREE                    S20201 02646020
FOUR     EQU   4                       FOUR                      S20201 02647020
FIVE     EQU   5                                                 S20201 02648020
SIX      EQU   6                        SIX                      S20201 02649020
EIGHT    EQU   8                        EIGHT                    S20201 02650020
NINE     EQU   9                                                 S20201 02651020
TWENTY4  EQU  24                        CONSTANT OF 24           S20201 02652020
FSTDX    EQU   X'88'                    FIXED STANDARD BIT      SA53279 02653021
QIOBCP   EQU  128                       QSAM IOB + CHAN PGM LEN  A31983 02655021
BIOBCP   EQU  120                       BSAM IOB + CHAN PGM      A31983 02659421
NOSKCYL  EQU  24                        WRT CHK AND NOT TRK OVFL A31983 02666621
SKCYLCCW EQU  8                         WRT CHK AND TRK OVFLOW   A31983 02668621
ROUNDCNT EQU   8                        USED TO ROUND UP COUNT   Y02072 02670602
*   CHANNEL CONTROL WORD FLAGS                                          02673321
*                                                                       02680000
SLI        EQU   X'20'                                                  02700000
CC         EQU   X'40'                                                  02720000
SLICC    EQU   X'60'                                                    02740000
CCSK     EQU   X'50'                                                    02760000
SLICCSK  EQU   X'70'                                                    02780000
*                                                                       02800000
*********************************************************************** 02820000
*                                                                       02840000
* MASKS FOR RECORD FORMATS                                              02860000
*                                                                       02880000
FORMATU    EQU   X'C0'                                                  02900000
*                                                                       02920000
*********************************************************************** 02940000
*                                                                       02960000
* OFFSET FOR PARAMETER TESTS                                            02980000
*                                                                       03000000
ONE      EQU   1                                                        03020000
NOT      EQU   X'FF'                                                    03040000
*                                                                       03060000
*********************************************************************** 03080000
*                                                                       03100000
* MASKS FOR STATUS BITS TO BE TESTED                                    03120000
*                                                                       03140000
FIRSTIOB   EQU   X'01'                                                  03160000
READONLY EQU   X'20'                    IOB READ ONLY INDICATOR         03180000
*                                                                       03200000
*********************************************************************** 03220000
*                                                                       03240000
* MASKS USED TO LOAD IGG01915 IN SUPPORT OF QSAM LOCATE MODE OF         03242019
* OPERATION WITH LOGICAL RECORD INTERFACE FOR VARIABLE LENGTH           03244019
* SPANNED RECORD                                                        03246019
*                                                                       03248019
FLGOFFST EQU   4                        OFFSET TO FLAG IN BCB    S19015 03250019
RAFLAG   EQU   X'80'                    RECORD AREA PRESENT      S19015 03252019
NULL     EQU   0                        ZERO DISPLACEMENT        S19015 03254019
IDLEN    EQU   5                        LENGTH OF IDTTR          S19015 03256019
*                                                                       03260000
*                                                                       03282000
*                                                                       03284000
*                                                                       03286000
*                                                                       03288000
*                                                                       03290000
*                                                                       03292000
*                                                                       03294000
*                                                                       03296000
*                                                                       03298000
*                                                                       03300000
*                                                                       03320000
         BALR  RBASE,0                  REG 3 IS BASE                   03340000
         USING SOPB,RBASE                                               03360000
         USING IHADCB,RDCB              REG 2 IS DCB                    03380000
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDRESS      03420000
*                                                                       03460000
SOPB     EQU   *                                                        03480000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 03490002
         DC    C'IGG0191P'              MODULE NAME              Y02072 03492002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 03494003
         DC    C'10/18/74'              LAST DATE MODIFIED     @Z30TSCF 03496003
BEGIN    DS    0H                                                Y02072 03498002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 03500000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   03520000
         USING WTGENTRY,RWTGC                                    YM7062 03570002
         ICM   RCORE,B'0111',WTGCORE    GET WORKAREA ADDRESS     YM7062 03580002
         DROP  RWTGC                                             YM7062 03590002
         SR    RC,RC                    READY A WORK REG                03600000
         ST    RC,DCBCNTRL              CLEAR PARAMETER LINK FIELD      03620000
         MVI   DCBCNTRL+3,X'02'         EOB RTN ID FOR LD EXEC          03640000
*                                                                       03660000
         TM    DCBRECFM,UFORMAT         IS IT FORMAT U           S20201 03662020
         BM    LAB01                    NO, BRANCH AROUND        S20201 03664020
         TM    DCBRECFM,TRKOVFL         IS IT TRACK OVERFLOW     S20201 03666020
         BNO   LAB01                    BRANCH IF NOT            S20201 03668020
         OI    JFCBMASK+SIX,NRECREDY                             S20201 03670020
LAB01    EQU   *                                                 S20201 03672020
         LA   RF,QIOBCP                 QSAM IOB + CP LEN        A31983 03682021
         TM    DCBCIND2,QSAMB           QSAM USED                       03700000
         BC    1,SOPB12                 BRANCH ON YES                   03720000
*                                  BSAM USED                            03740000
         TM    DCBMACRF,POINTB          NOTE POINT USED                 03760000
         BC    1,SOPB10                 YES, BRANCH                     03780000
         TM    DCBMACRF+1,POINTB        NOTE POINT USED                 03800000
         BC    14,SOPB11                NO, BRANCH                      03820000
*                                                                       03840000
SOPB10   EQU   *                                                        03860000
         MVI   DCBCNTRL+1,X'05'         NPDT ID NUMBER                  03880000
*                                                                       03900000
SOPB11   EQU   *                                                        03920000
         LA   RF,BIOBCP                 BSAM IOB + CP LEN        A31983 03930021
*                                                                       03960000
SOPB12   EQU   *                                                        03980000
         TM    JFCBMASK+SIX,NRECREDY    IS IT NON RECORD READY   S20201 04002020
         BO    SOPB14                   YES BRANCH AROUND REC    S20201 04004020
*                                       READY                    S20201 04006020
         LA    RF,TWENTY4(RF)           INCREASE FOR RECORD      S20201 04008020
*                                       READY                    S20201 04010020
         TM    DCBRECFM,TRKOVFLB        TRK OVFL                SA53279 04012021
         BO    SOPB14                   BRANCH YES              SA53279 04014021
         TM    DCBRECFM,FSTDX           FIXED STANDARD?         SA53279 04014421
         BO    SOPB14                   BRANCH YES              SA53279 04014821
         LA    RF,EIGHT(RF)             BUMP BY EIGHT            S20201 04016020
SOPB14   EQU   *                                                 S20201 04018020
         TM    DCBOPTCD,WRTCK           WRITE CHECK USED                04020000
         BC    14,SOPB20                NO, BRANCH                      04040000
         LA   RF,NOSKCYL(RF)            WRT CHK, NO TRK OVFLW    A31983 04050021
         TM   DCBRECFM,TRKOVFLB         TRK OVFLOW USED?         A31983 04060021
         BNO  NOTRKOVF                  NO, DON'T ADD FOR SEEK   A31983 04062021
*                                          CYLINDER CCW          A31983 04062421
         LA   RF,SKCYLCCW(RF)           YES, ADD FOR SK CYL CCW  A31983 04062821
NOTRKOVF EQU  *                                                  A31983 04062921
         TM    JFCBMASK+SIX,NRECREDY    IS IT NON RECORD READY   S20201 04063020
         BO    SOPB20                   YES BRANCH AROUND REC    S20201 04066020
*                                       READY                    S20201 04069020
         LA    RF,EIGHT(RF)             INCREASE FOR RECORD      S20201 04072020
*                                       READY                    S20201 04075020
*                                                                       04080000
*    AT THIS POINT RF=REG.1 CONTAINS THE LENGTH OF ONE IOB              04100000
*                                                                       04120000
SOPB20   EQU   *                                                        04140000
*                                                                       04160000
         SRL   RF,3                     DIVIDE BY 8 (DOUBLE WORDS)      04180000
         STC   RF,DCBIOBL               STORE 1 IOB LGN FOR CLOSE EXEC  04200000
         SR    RE,RE                    READY A WORK REG                04220000
         TM    DCBCIND2,QSAMB           QSAM BEING USED                 04240000
         BC    14,SOPB21                NO, BRANCH                      04260000
         IC    RE,DCBBUFNO              OBTAIN NUMBER OF IOB'S TO BUILD 04280000
         B     SOPB22                                                   04320000
SOPB21   EQU   *                                                        04360000
         IC    RE,DCBNCP                OBTAIN NUMBER OF IOB'S TO BUILD 04380000
         LTR   RE,RE                    DID PP SPEC NO OF CP     YM2268 04390002
         BNZ   SOPB22                   YES, USE SPEC VALUE      YM2268 04392002
         LA    RE,1                     NO, DEFAULT TO ONE       YM2268 04394002
         STC   RE,DCBNCP                  IF NOT SPECIFIED       YM2268 04396002
SOPB22   EQU   *                                                        04440000
         LR    RUCB,RE                  RUCB WILL BE USED AS A COUNTER  04560000
*                                                                       04580000
         SLL   RF,3                     CONVERT IOB LENGTH TO BYTES     04600000
         MR    RE,RE                    COMPUTE TOTAL SPACE NEEDED      04620000
         TM    JFCBMASK+SIX,NRECREDY    IS IT NON RECORD READY   S20201 04622020
         BO    SOPB25                   YES BRANCH AROUND        S20201 04624020
         LR    RDEB,RF                  BYTES FOR IOB'S          S20201 04626020
         LR    RB,RUCB                                           S20201 04628020
*                                                                       04628402
* THE NUMBER OF SECTOR SAVE AREAS REQUIRED IS 1 MORE THAN THE    Y02072 04628802
* NUMBER OF IOBS. ALL READ CHAN PGMS USE THE SAME SECTOR SAVE    Y02072 04629202
* AREA BUT EACH WRITE CHAN PGM HAS A DIFFERENT SECT SAVE AREA.   Y02072 04629602
*                                                                       04629702
         LA    RB,ROUNDCNT(RB)          ROUND UP COUNT           Y02072 04629802
         SRL   RB,THREE                                          S20201 04632020
         SLL   RB,THREE                                          S20201 04634020
         AR    RF,RB                                             S20201 04636020
SOPB25   EQU   *                                                 S20201 04638020
         LR    RD,RF                    SAVE FOR                        04640000
         LR    RB,RF                       LATER USE                    04660000
*                                                                       04670002
*  THE FOLLOWING SAVE THE AMOUNT OF CORE GETMAINED FOR THE IOBS  YM4697 04672002
*  IN THE FORCE CLOSE AUDIT TRAIL FOR FORCE CLOSE.               YM4697 04674002
*                                                                       04680000
         ST    RD,DXATEXC2              SAVE LENGTH              YM4697 04690002
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 04700002
*                                                                       04720000
         GETMAIN R,LV=(RD),SP=0                                  Y02072 04740002
*                                                                       04760000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 04780002
**                                                                      04800000
*    THIS SECTION CLEARS THE SPACE RECEIVED FROM GETMAIN                04820000
**                                                                      04840000
*********************************************************************** 04860000
*                                                                       04880000
         LR    RJ,RB                    RESTORE LENGTH TO CLEAR         04900000
         ST    RF,DCBIOBA               SAVE FIRST IOB ADDRESS          04920000
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 04930002
         BCTR  RJ,0                     REDUCE AMT BT ONE               04940000
         LA    RB,255                   GET MAX AMT CAN CLEAR           04960000
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 04962002
COMPARE  CR    RJ,RB                    IS AMT TO CLEAR GREATER 255     04980000
         BC    12,ONECLEAR              NO BRANCH                       05000000
*                                                                       05020000
         EX    RB,CLEAR                 CLEAR 256 BYTES                 05040000
         SR    RJ,RB                    SUBT 255 FROM AMT TO BE CLEARED 05060000
         BCTR  RJ,0                     SUBT ONE MORE BYTE              05080000
         LA    RF,256(RF)               UPDATE AREA ADDR BY 256         05100000
         B     COMPARE                                                  05120000
*                                                                       05140000
CLEAR    XC    0(1,RF),0(RF)            ACTUAL CLEAR INSTRUCTION        05160000
*                                                                       05180000
ONECLEAR EX    RJ,CLEAR                 CLEARS LESS THAN 256            05200000
*                                                                       05220000
         L     RB,DCBIOBA               GET FIRST IOB ADDR              05240000
         ST    RUCB,ZERO(RB)            STORE IOB COUNT          S20201 05700020
         TM    JFCBMASK+SIX,NRECREDY    IS THIS NON RECORD READY S20201 06100020
         BO    AROUND                   NO, FORGET RPS INSTRS    S20201 06500020
         AR    RDEB,RB                  ADDR OF FIRST SECTOR     S20201 06900020
*                                       BYTE                     S20201 07300020
         ST    RDEB,FOUR(RB)            STORE ADDR OF SECTOR1    S20201 07700020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07710002
         USING WTGENTRY,RWTGC                                    Y02072 07760002
         MVC   WTGIDTTR,IGG0191Z        191Z FOR RPS DEVICES   @Z30TSCF 07810003
         B     RELOOP                   BR AROUND INSTR FOR 6P   S20201 09300020
AROUND   EQU   *                                                 S20201 09700020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 09710002
         MVC   WTGIDTTR,IGG0196P      196P FOR NON=RPS DEVICES @Z30TSCF 09760003
RELOOP   EQU   *                                                        11260000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        11280000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     11300000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            11320000
         BCR   8,RBASE                                                  11340000
*                                                                       11360000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    11380000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             11400000
*                                                                       11420000
         LR    RPARC,RPAR                                               11440000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       11460000
*                                                                       11480000
ZCHEK    EQU   *                                                        11500000
         CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           11520000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         11540000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  11560000
         LA    RPARC,PLOFF(0,RPARC)                                     11580000
         BC    15,ZCHEK                                                 11600000
*                                                                       11620000
TCTLRTN  EQU   *                                                        11640000
         USING WTG,RWTG                                                 11690003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11740003
               MODID=WTGENTRY                                  @Z30TSCF 11790003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11800003
**                                                                      11820000
*                                                                       11900000
WAOFF    EQU   32                                                       11920000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           11940000
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           11960000
OPIDCNST DC    C'0S'                                                    11980000
AMIDCNST DC    C'1P'                                                    12000000
IGG0196P DC    C'6P',VL3(IGG0196P)      NON-RPS                @Z30TSCF 12010003
IGG0191Z DC    C'1Z',VL3(IGG0191Z)      RPS                    @Z20TSCF 12012003
         SPACE 2                                                        12014002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 12016002
END      EQU   *                        END OF MODULE            Y02072 12018002
         EJECT                                                          12050002
           DCBD  DSORG=PS                                               12180000
CVT      DSECT                                                          12200000
         CVT                                                            12220000
*                                                                       12240000
*      DATA EXTENT BLOCK                                                12260000
           CNOP  0,4                                                    12280000
BLDEB    DSECT                                                          12300000
DEBNMSUB DS    0CL1                                                     12320000
DEBTCBAD DS    CL4                                                      12340000
DEBAMLNG DS    0CL1                                                     12360000
DEBDEBAD DS    CL4                                                      12380000
DEBOFLGS DS    0CL1                                                     12400000
DEBIRBAD DS    CL4                                                      12420000
DEBOPATB DS    0CL1                                                     12440000
DEBSYSPG DS    CL4                                                      12460000
DEBNMEXT DS    0CL1                                                     12480000
DEBUSRPG DS    CL4                                                      12500000
DEBPRIOR DS    0CL1                                                     12520000
DEBECBAD DS    CL4                                                      12540000
DEBPROTG DS    0CL1                                                     12560000
DEBDEBID DS    0CL1                                                     12580000
DEBDCBAD DS    CL4                                                      12600000
DEBEXSCL DS    0CL1                                                     12620000
DEBAPPAD DS    CL4                                                      12640000
DEBDVMOD DS    0CL1                                                     12660000
DEBUCBAD DS    CL4                                                      12680000
DEBBINUM DS    CL2                                                      12700000
DEBSTRCC DS    CL2                                                      12720000
DEBSTRHH DS    CL2                                                      12740000
DEBENDCC DS    CL2                                                      12760000
DEBENDHH DS    CL2                                                      12780000
DEBNMTRK DS    CL2                                                      12800000
*                                                                       12840000
*                                                                       12860000
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 12910003
         ORG   WTGIDTTR                                          Y02072 12912002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 12914002
         EJECT                                                          12916002
FORCORE  DSECT                                                   Y02072 12918002
         IHAFCAUD  ORG=YES                                       Y02072 12918402
         EJECT                                                          12918802
           END                                                          12920000
./  ADD  SSI=72640533,NAME=IGG0191Q
    TITLE ' IGG0191Q - OPEN EXECUTOR FOR CHAINED SCHEDULING (TAPE-UR)'  00020004
IGG0191Q CSECT                                                          00021016
*MODULE NAME - IGG0191Q                                          Y02072 00021102
*                                                                       00021202
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00021302
*                                                                       00023302
*COPYRIGHT - NONE                                                Y02072 00025302
*                                                                       00027302
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00027702
*                                                                       00028002
*        VS 2 RELEASE 2 DELETIONS                                Y02072 00030002
*000204,000600,011400,050300,050420-050480,065400,073600,117400  Y02072 00032002
*120350,120500,125400-125600,126200,130000                       Y02072 00042002
*                                                                YM4697 00052002
*                                                                YM6583 00052102
*                                                                       00052503
*        VS2 RELEASE 3 DELETIONS                                        00052903
*                                                              @Z30TSCF 00053303
*        VS2 RELEASE 4 DELETIONS                                        00053704
*                                                              @Z40MSMI 00053804
*        RELEASE 20 DELETIONS                                           00054002
*0485130700,131400,131800                                        M6128  00056002
*0485002800,005000-005200,120400,130800                          M5071  00058002
*0485130700                                                      M5898  00060002
*0485120250                                                      M6413  00062002
*        RELEASE 21 DELETIONS                                           00064002
*1300                                                            A45221 00066002
*1300107000-107600                                               A36955 00068002
*                                                               SA67354 00070002
*                                                                       00076002
*STATUS CHANGE LEVEL 007                                                00078002
*                                                                       00080000
*FUNCTION/OPERATION-- THIS ROUTINE GETS THE AMOUNT OF SPACE REQUIRED    00100000
*                     FOR THE MAIN IOB AND ICBS WITH THEIR CHANNEL      00120000
*                     PROGRAMS.TAPE AND UR ARE SUPPORTED BY THIS        00140004
*                     ROUTINE.THE ROUTINE ALSO GENERATES THE CHANNEL    00160000
*                     PROGRAMS REQUIRED,STORES THE ID'S OF THE EOB      00180000
*                     RTS NEEDED IN DCB(TEMPORARILY),AND INITIALIZES    00200000
*                     FIELDS IN THE DCB.                                00220000
*                     IT SETS AN AUDIT TRAIL BIT IN THE OPEN     Y02072 00230002
*                     WORKAREA INDICATING TO FORCE CLOSE THAT    Y02072 00232002
*                     THE CORE GETMAINED FOR THE IOB'S CAN BE    Y02072 00234002
*                     FREEMAINED.                                Y02072 00236002
*                                                                       00240000
*                                                                       00260000
*ENTRY POINT:  IGG0191Q FROM IGG0191T, IGG0191U, IGG0191V, IGG0193I,    00270004
*              IGG0196B OR IGG0196Q                                     00280004
*                                                                       00300000
*INPUT      --  SEE DESCRIPTION OF REGISTERS,USER DCB,WHERE TO GO TABLE 00320000
*               CURRENT ENTRY IN WHERE TO GO TABLE,USER PARAMETER LIST, 00340000
*               CURRENT ENTRY IN PARAMETER LIST,AND OPEN'S 536 BYTE     00360000
*               WORK AREA (SEE FORECORE DSECT) ASSOCIATED WITH EACH DCB 00380000
*                                                                       00400000
*OUTPUT     --  ICBS AND CHANNEL PROGRAMS ,MAIN IOB ,DCB INITIALIZATION 00420000
*                                                                       00440000
*EXTERNAL RTS.  IFG019RA.                                               00460004
*                                                                       00480000
*EXITS      --  NORMAL - IGG01913, IGG01916                             00500004
*               ABNORMAL - IGG0191G WHEN CHAINED SCHEDULING             00520004
*                          NOT SUPPORTABLE                              00526004
*                                                                       00530002
*MACROS : ACTION -- MODESET, GETMAIN, IECRES                            00532004
*                                                                       00534002
*MACROS : MAPPING -- IHACCW, DCBD, IECDSECS, IEZIOB, IEZDEB,            00536004
*                    IKJTCB, IGGPARML                                   00538004
*                                                                       00546002
*TABLES     --  SEE FORECORE DSECT ,DCB DSECT ; WHERE TO GO DSECT       00560000
*                                                                       00580000
*ATTRIBUTES --  RE-ENTRANT, RE-USABLE, ENABLED, RUNS IN DATA     Y02072 01140002
*               MANAGEMENT KEY UNLESS OTHERWISE SPECIFIED        Y02072 01180002
*               RUNS IN SUPERVISOR STATE                         Y02072 01190002
*                                                                       01200000
*NOTES      --  THIS EXECUTOR WILL GO TO IGG0191G IF CHAINED SCHEDULING 01220004
*               CANNOT BE SUPPORTED BUT THE USER IS CAPABLE OF RUNNING. 01240004
*                                                                       01260000
*               3800 PRINTER SUPPORT (@Z40MSMI) - OPTCD=J (DYNAMIC      01270004
*               SELECTION OF TRANSLATE TABLES) REQUIRES AN ADDITIONAL   01290004
*               CCW IN THE CHANNEL PROGRAM. WHEN IT IS REQUIRED THIS    01300004
*               MODULE WILL INCREASE THE ICB/CP SIZE TO BE GETMAINED    01310004
*               BY 8 BYTES PER ICB. THE NEW CHANNEL PROGRAM WILL BE:    01320004
*                  NOP/ASA                                              01330004
*                  NOP/SELECT TRANSLATE TABLE                           01340004
*                  WRITE                                                01350004
*                  NOP                                                  01352004
*                  NOP/TIC                                              01354004
*                                                                       01360000
*********************************************************************** 01380000
*                                                                       01400000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01420000
*                                                                       01440000
*********************************************************************** 01460000
*                                                                       01480000
RDCB     EQU   2         DCB REGISTER                                   01500000
RBASE    EQU   3         BASE REGISTER                                  01520000
RCORE    EQU   4         WORK AREA ADDRESS                              01540000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01560000
RWTG     EQU   6         TOP OF WTG TABLE                               01580000
RPARC    EQU   7         CURRENT PARAMETER                              01600000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01620000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01640000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01660000
RDEB     EQU   11        DEB ADDRESS, WORKREG AND FOR MODESET           01680004
RB       EQU   12        WORK REG1  **                                  01700000
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01720000
RD       EQU   14        WORK REG3  **                                  01740000
RRET     EQU   RD                       RETURN ADDRESS REGISTER  Y02072 01752002
RJ       EQU   15        WORK REG4                                      01760000
RWK4     EQU   RJ                       WORK REGISTER            Y02072 01770002
RE       EQU   0         WORK REG5                                      01780000
RF       EQU   1         WORK REG6                                      01800000
RWK5     EQU   RF                       WORK REGISTER            Y02072 01810002
*                                                                       01820000
*                                                                       01880000
*********************************************************************** 01900000
*                                                                       01920000
*                                                                       01940000
*                                                                       01960000
* MASKS FOR DEVICES TO BE SUPPORTED                                     01980000
*                                                                       02000000
*                                                                       02020000
*                                                                       02040000
TAPEB    EQU   X'80'                                                    02060000
URBITS   EQU   X'40'                                                    02080000
PRINTER  EQU   X'48'                                                    02100000
*                                                                       02160000
*                                                                       02180000
*********************************************************************   02400000
*                                                                       02420000
*          CCW COMMAND CODES                                            02440004
*                                                                       02460000
WRITE    EQU   X'01'                    WRITE COMMAND                   02480004
PRTSPC1  EQU   X'09'                    PRINT AND SINGLE SPACE 1        02490004
READ     EQU   X'02'                    READ COMMAND                    02500004
READBACK EQU   X'0C'                    READ BACKWARDS COMMAND          02520004
TIC      EQU   X'08'                    TIC COMMAND                     02540004
NOP      EQU   X'03'                    NOP COMMAND                     02560004
EJCT     EQU   X'80'                    EJECT MODE FOR 1442             02570004
COLBIN   EQU   X'20'                    COLUMN BINARY MODE              02580004
STCK2    EQU   X'40'                    STACKER TWO MODE                02590004
*                                                                       02600000
*********************************************************************   02610004
*                                                                       02620004
*          MISCELLANEOUS EQUATES                                        02630004
*                                                                       02640004
TIMES8   EQU   3                        SHIFT VALUE TO MULTIPLY BY 8    02650004
ECBNORM  EQU   X'7F'                    CODE TO SET NORMAL COMPLETION   02660004
ICBLRD   EQU   7                        ICB LEN. FOR READ IN DBL WRDS   02690004
ICBLWT   EQU   8                        ICB LEN. FOR WRITE IN DBL WRDS  02700004
ICBLWA   EQU   9                        ICB LEN FOR 3800 IN DBL WRDS    02702004
WCPO     EQU   32                       CHANNEL PROG OFFSETS FOR DCB    02710004
NOPR     EQU   48                       NOP OFFSET FOR READ             02720004
NOPW     EQU   56                       NOP OFFSET FOR WRITE            02730004
NOPA     EQU   64                       NOP OFFSET FOR 3800             02740004
*********************************************************************   04660000
         EJECT                                                          04682004
         BALR  RBASE,0                                                  04720000
         USING SOPC,RBASE                                               04740000
         USING PARML,RPARC                                              04790004
         USING WTGENTRY,RWTGC                                           04792004
         USING WTG,RWTG                                                 04794004
*                                                                       04800000
*                                                                       04820000
SOPC     EQU   *                                                        04840000
*                                                                       04860000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 04870002
         DC    C'IGG0191Q'              MODULE NAME              Y02072 04872002
         DC    C'@Z40MSMI'              LAST SHIP CODE         @Z40MSMI 04874004
         DC    C'01/31/75'              LAST DATE MODIFIED     @Z40MSMI 04876004
BEGIN    DS    0H                                                YM4697 04878002
         SR    RE,RE                    INITIALIZE                      04880000
         L     RDCB,PARDCBAD            GET DCB ADDRESS                 04900004
         USING IHADCB,RDCB                                              04910004
         LA    RDCB,IHADCB              CLEAR HI BYTE                   04920004
         L     RCORE,WTGCORE-1          GET WRK AREA ADDRESS            04940004
         USING FORCORE,RCORE                                            04950004
*                                                                       04960000
*********************************************************************** 04980000
*                                                                       05000000
         MVC   WTGIDTTR,SOP5            NXT RTN IF CH SCH NOT PERMITTED 05030004
*                                                                       05200000
*                                                                       05220000
         TM    PAROPT,PAROUTPT-PARRDBCK DCB OPENED FOR OUT/IN OR IN/OUT 05240004
         BM    RELOOP                   YES BRANCH - NO CH SCHED        05260004
*                                                                       05280000
         BO    SOPC005                  BRANCH IF OPENED FOR OUTPUT     05300004
*                                                                       05320000
         TM    DCBMACF1,DCBMRCRL        IS CNTRL MACRO USED             05340004
         BO    RELOOP                   YES BRANCH  NO CH SCHEDULE      05360004
*                                                                       05380000
         LA    RF,ICBLRD                ICB SIZE IN DBL WRDS      19768 05400004
         B     SOPC007                                                  05420000
*                                                                       05440000
SOPC005  EQU   *                                                        05460000
*                                                                       05480000
         TM    DCBMACF2,DCBMRCTL        IS CNTRL MACRO USED             05500004
         BO    RELOOP                   YES BRANCH  NO CH SCHEDULE      05520004
*                                                                       05540000
         LA    RF,ICBLWT                ICB SIZE IN DBL WRDS      19768 05560004
*                                                                       05560404
*   FOR 3800 WITH OPTCODE = J SPACE MUST BE GOTTEN FOR AN EXTRA CCW     05562004
*                                                                       05564004
         CLI   DCBDEVT,DCBDVPR5         IS THIS A 3800         @Z40MSMI 05566004
         BNE   SOPC007                  NO - CONTINUE          @Z40MSMI 05568004
         TM    DCBOPTCD,DCBOPTJ         OPTCD=J SPECIFIED      @Z40MSMI 05570004
         BZ    SOPC007                  NO - CONTINUE          @Z40MSMI 05572004
         LA    RF,ICBLWA                ICB SIZE IN DBL WORDS  @Z40MSMI 05574004
*                                                                       05580000
SOPC007  EQU   *                                                        05600000
*                                                                       05620000
         STC   RF,DCBIOBL               STORE ICB&CP LEN IN DBL.WRDS.   05640000
         SLL   RF,TIMES8                GET LENGTH IN BYTES             05660004
*                                                                       05680000
         SR    RE,RE                                                    05700000
         IC    RE,DCBBUFNO              GET BUFFER NUMBER--QSAM PARA.   05720000
         TM    DCBCIND2,DCBCNQSM        IS QSAM BEING USED              05740004
         BO    SOPC013                  YES BRANCH                      05760004
*                                                                       05780000
         TM    DCBMACF1,DCBMRPT1        IS NOTE/POINT TO BE USED        05800004
         BO    SOPC009                  YES BRANCH                      05820004
         TM    DCBMACF2,DCBMRPT2        IS NOTE/POINT TO BE USED        05840004
         BZ    SOPC011                  NO BRANCH                       05860004
*                                                                       05880000
SOPC009  EQU   *                                                        05900000
*                                                                       05920000
         MVI   DCBRTN2,RTN6             STORE PCI NOTE/POINT ID INDEX   05940004
         TM    DCBDEVT,TAPEB            IS DCB USING TAPE               05960004
         BO    SOPC011                  YES BRANCH                      05980004
*                                                                       06000000
         MVI   DCBRTN2,RTN10            STORE DUMMY RT ID INDEX VALUE   06020004
*                                                                       06040000
SOPC011  EQU   *                                                        06060000
*                                                                       06080000
         IC    RE,DCBNCP                GET NUMBER OF ICBS TO GEN.      06100000
*                                                                       06120000
SOPC013  EQU   *                                                        06140000
*                                                                       06160000
         LR    RTIOT,RE                 SAVE NO. OF ICBS TO BUILD       06180000
*                                                                       06200000
         CH    RE,CONONE                IS NCP EQUAL TO 1 OR ZERO       06260004
         BNH   RELOOP                   YES BRANCH                      06300004
*                                                                       06320000
         MR    RE,RE                    COMPUTE AMT SPACE REQ FOR ICBS  06340000
         LA    RF,IOBEXTEN-IOBQSAMC(RF) SPACE REQ FOR MAIN IOB          06360004
         LR    RB,RF                    SAVE AMT TO CLEAR               06380000
         OI    DCBCIND2,DCBCNCHS        SET TRUE PCI INDICATOR   YM4697 06430002
*                                                                       06520000
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE      YM4697 06520404
*  IOB AND ICBS IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE     YM4697 06520802
*  EXECUTOR.                                                     YM4697 06521202
*                                                                       06521602
         ST    RF,DXATEXC2              SAVE LENGTH              YM4697 06521702
*                                                                       06521802
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06522002
         GETMAIN R,LV=(RF),SP=0                                  Y02072 06540002
*                                                                       06540402
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06554002
*                                                                       06560000
*********************************************************************** 06580000
*                                                                       06600000
*                                                                       06620000
         ST    RF,DCBIOBAD              SAVE MAIN IOB ADDRESS           06660000
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 06670002
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06682002
*********************************************************************** 06732004
*                                                                       06782004
*        CLEAR THE AREA GETMAINED                                       06832004
*                                                                       06882004
         SR    RJ,RJ                    INDICATE CLEAR TO X'00'         06932004
         LR    RE,RF                    LOCATION TO CLEAR               06942004
         LR    RF,RB                    LENGTH TO CLEAR                 06952004
         MVCL  RE,RD                    CLEAR THE AREA                  06954004
*                                                                       06960000
*                                                                       06980000
*********************************************************************** 07000000
         L     RB,DCBIOBAD              GET MAIN IOB ADDRESS            07020000
         USING IOBQSAMC,RB                                              07030004
*                                                                       07080000
*     THIS SECTION OF CODE WILL BUILD THE MAIN IOB                      07100000
*                                                                       07120000
*                                                                       07140000
         LA    RUCB,IOBEXTEN            POINT TO FIRST ICB              07180004
         ST    RUCB,IOBCICB             STORE IN MAIN IOB               07200004
         LA    RD,IOBCECB               POINT TO ECB IN MAIN IOB        07220004
*                                                                       07240000
         MVI   IOBCECB,ECBNORM          POST MAIN IOB COMPLETE          07260004
*                                                                       07280000
*                                                                       07300000
         LA    RF,IOBEXTEN+ICBEXTEN-ICB POINT TO FIRST ICB CHANNEL PRG  07320004
*                                                                       07340000
         ST    RD,IOBECBPT              ECB ADDRESS TO IOB       Y02072 07360002
         ST    RF,IOBSTART              CHAN PGM ADDR TO IOB     Y02072 07370002
         L     RWK4,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 07372002
         ST    RWK4,IOBDCBPT            DCB ADDRESS TO IOB       Y02072 07374002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07376402
*                                                                       07380000
*                                                                       07400000
         MVI   DCBWCPO,WCPO             MOVE IN FIRST OFFSET  AND       07420004
         MVC   DCBWCPL(3),DCBWCPO       PROPAGATE THE BYTE ACROSS       07440000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 07442002
IOBOFF   MVI   IOBCINOP,NOPR            NOP OFFSET IN IOB         19768 07460004
         MVI   IOBCONOP,NOPR            NOP OFFSET IN IOB         19768 07480004
*                                                                       07500000
         OI    IOBFLAG1,IOBCMDCH        INDICATE COMMAND CHAINING       07510004
*                                                                       07520000
*   ASSUME TAPE OR CARD READER CHANNEL PROGRAM FOR OFFSETS STORED       07540000
*                                                                       07560000
         LA    RB,IOBEXTEN              POINT TO FIRST ICB              07580004
         DROP  RB                                                       07580404
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07582002
         ST    RB,DCBIOBA               SAVE ADDRESS FOR SUBROUTINES    07600000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 07610002
         LR    RC,RB                    COPY ICB ADDRESS                07620000
*                                                                       07640000
*                                       DURING THE FOLLOWING LOOP, RB   07660000
*                                       MUST REMAIN INTACT FOR IT IS    07680000
*                                       NEEDED TO PUT LINK ADDRESS IN   07700000
*                                       1ST ICB.                        07720000
*                                                                       07740000
*                                                                       07760000
*                                                                       07780000
*   ICB CONSTRUCTION BEGINS AT THIS POINT                               07800000
*                                                                       07820000
*                                                                       07840000
ICBLOOP  EQU   *                                                        07860000
*                                                                       07940000
         USING ICB,RB                                                   07950004
         ST    RC,ICBNICBA              LINK LAST ICB TO CURRENT ICB    07960004
         LR    RB,RC                    UPDATE LAST ICB POINTER         07980004
         LA    RC,ICBNECB               POINT TO ICBS ECB               08000004
         ST    RC,ICBECBPT              SAVE IN ECB SLOT                08020004
         MVI   ICBNECB,ECBNORM          POST ICB COMPLETE               08040004
         LA    RC,ICBEXTEN              POINT TO CP START ADDR          08060004
         USING CCW,RC                                                   08070004
         ST    RC,ICBSTART              SAVE IN ICB CP STARTAD          08080004
*                                                                       08100004
*    NORMAL ICB HAS BEEN GENERATED                                      08120000
*                                                                       08140000
         TM    DCBDEVT,TAPEB            DCB USING TAPE                  08160000
         BO    SOPC043                  YES BRANCH                      08180004
*                                                                       08200000
         TM    PAROPT,PAROUTPT          DCB FOR OUTPUT                  08220004
         BZ    SOPC029                  NO BRANCH                       08240004
*                                                                       08260000
*      SUPPLY AUTOMATIC UNBLOCKING FUNCTION FOR QSAM U.R. OUTPUT        08280000
*                                                                       08320000
         TM    DCBCIND2,DCBCNQSM        QSAM BEING USED FOR OUTPUT      08340004
         BZ    SOPC023                  NO BRANCH                       08360004
         TM    DCBRECFM,DCBRECBR        BLOCKED RECORDS         SA67354 08370002
         BZ    SOPC023                  NO, BYPASS UNBLOCKING   SA67354 08380002
         TM    DCBCIND2,DCBCNBFP        DID OPEN BUILD BUFFERS  SA67354 08390002
         BO    SOPC023                  YES, FUNCTION ALREADY   SA67354 08392002
*                                         PROVIDED              SA67354 08394002
         TM    DCBRECFM,DCBRECU         U RECORDS BEING USED            08400002
         BNM   SOPC023                  YES BRANCH              SA67354 08420002
         SPACE                                                          08430002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08432002
         SPACE                                                          08434002
         TM    DCBRECFM,DCBRECF         F RECORDS USED                  08440004
         BZ    SOPC021                  NO BRANCH                       08460004
         MVC   DCBBLKSI,DCBLRECL        FORCE UNBLOCKED RECORDS TO BE   08500004
*                                       OUTPUT TO UNIT RECORD EQUIPMENT 08520002
SOPC021  EQU   *                                                        08560000
         NI    DCBRECFM,X'FF'-DCBRECBR  TURN BLOCKED BIT OFF            08600004
         OI    DCBCIND1,DCBCNBRM        SET BIT FOR CLOSE. MUST  A45221 08610002
*                                         KNOW BIT TURNED OFF.   A45221 08630021
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 08630402
SOPC023  EQU   *                        BUILD WRITE CHANNEL PROGRAM     08640004
         MVI   CCWCOMCD,NOP             STORE NOP CMD BYTE              08780004
         MVI   CCWFLGS,CCWCC            SET CMD CHAIN FLAG              08800004
         MVI   CCWBYTE+1,1              SAVE COUNT OF ONE               08820004
*                                                                       08840000
*   NOP CCW HAS BEEN GENERATED FOR OUTPUT CHANNEL PROGRAM               08860000
*                                                                       08880000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08932002
         TM    DCBRECFM,DCBRECCA        ASA CHARACTERS USED             08940004
         BZ    SOPC025                  NO BRANCH                       08960004
*                                                                       08980000
         MVI   DCBRTN4,RTN4             SAVE DDB'S ID INDEX VALUE       09000004
         B     SOPC027                                                  09020000
*                                                                       09040000
SOPC025  EQU   *                                                        09060000
*                                                                       09080000
         MVI   DCBRTN4,RTN3             SAVE DDA'S ID INDEX VALUE       09100004
*                                                                       09120000
SOPC027  EQU   *                                                        09140000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 09142002
*                                                                       09160000
         L     RD,DCBIOBAD              GET MAIN IOB ADDRESS            09180000
         USING IOBQSAMC,RD                                              09190004
         MVI   IOBCINOP,NOPW            NOP OFFSET IN IOB               09200004
         MVI   IOBCONOP,NOPW            NOP OFFSET IN IOB               09210004
*                                                                       09215004
*        FOR 3800 WITH OPTCD=J AN ADDITIONAL NOP MUST BE BUILT          09220004
*                                                                       09225004
         CLI   DCBDEVT,DCBDVPR5         IS THIS A 3800         @Z40MSMI 09230004
         BNE   SOPC024                  NO - CONTINUE          @Z40MSMI 09235004
         TM    DCBOPTCD,DCBOPTJ         OPTCD=J SPECIFIED      @Z40MSMI 09240004
         BZ    SOPC024                  NO - CONTINUE          @Z40MSMI 09245004
         LA    RC,CCW+L'CCW             INCREMENT TO NEXT CCW  @Z40MSMI 09250004
         MVI   CCWCOMCD,NOP             SET NOP                @Z40MSMI 09255004
         MVI   CCWFLGS,CCWCC            SET CHAIN COMMAND      @Z40MSMI 09260004
         MVI   CCWBYTE+1,1              SET COUNT              @Z40MSMI 09265004
         MODESET EXTKEY=DATAMGT         GET IN DM KEY          @Z40MSMI 09267004
         NI    DCBPRBYT,X'FF'-DCBTRCID  SET ACT TRANS TBL ID   @Z40MSMI 09270004
         MODESET KEYADDR=DXUKEY,WORKREG=11 GET IN CALLER KEY   @Z40MSMI 09272004
         MVI   IOBCINOP,NOPA            SET NOP OFFSET         @Z40MSMI 09275004
         MVI   IOBCONOP,NOPA            SET NOP OFFSET         @Z40MSMI 09280004
         DROP  RD                                                       09280404
SOPC024  EQU   *                                                        09281004
         LA    RC,CCW+L'CCW             UPDATE CCW POINTER              09285004
         MVI   CCWCOMCD,WRITE           STORE WRITE CMD BYTE            09290004
         OI    CCWFLGS,CCWCC+CCWSLI+CCWPCI SET FLAGS                    09300004
         BAL   RRET,SOPC070             GO RESET PCI BIT IF      Y02072 09310002
*                                         NECESSARY              Y02072 09312002
         TM    DCBDEVT,PRINTER          DCB USING PRINTER               09320000
         BO    SOPC037                  YES BRANCH                      09340004
*                                                                       09360000
         CLI   DCBDEVT,DCBDVCRP         1442 BEING USED FOR OUTPUT      09380004
         BNE   SOPC031                  NO BRANCH                       09400004
*                                                                       09420000
         OI    CCWCOMCD,EJCT            TURN ON EJECT MOD.              09440004
         B     SOPC031                                                  09460000
*                                                                       09480000
*                                                                       09500000
SOPC029  EQU   *                        BUILD READ CHANNEL PROGRAM      09520004
*                                                                       09540000
         OI    CCWFLGS,CCWCC+CCWSLI+CCWPCI SET PCI,SILI, CC FLAGS       09560004
         BAL   RRET,SOPC070             GO RESET PCI BIT IF      Y02072 09570002
*                                         NECESSARY              Y02072 09572002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 09572402
         MVI   DCBRTN4,RTN2             STORE EPG2 INDEX  VALUE         09580004
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 09582002
         OI    CCWCOMCD,READ            TURN ON READ CMD IN CCW         09600004
SOPC031  EQU   *                                                        09620000
*                                                                       09640000
         TM    DCBMODE,DCBMODEC         PROCESSING COLUMN BINARY        09660004
         BZ    SOPC033                  NO BRANCH                       09680004
*                                                                       09700000
         OI    CCWCOMCD,COLBIN          SET COL BIN MOD ON IN CCW       09720004
SOPC033  EQU   *                                                        09740000
*                                                                       09760000
         TM    DCBSTACK,DCBSTCK2        STACKER TWO SPECIFIED           09780004
         BZ    SOPC061                  NO BRANCH                       09800004
*                                                                       09820000
         OI    CCWCOMCD,STCK2           TURN STACKER TWO MOD ON         09840004
         B     SOPC061                                                  09860000
*                                                                       10000000
SOPC037  EQU   *                                                        10020000
*                                                                       10040000
         MVC   CCWCOMCD,DCBPRTSP        STORE PRINTER CMD IF SPECIFIED  10060004
         TM    DCBRECFM,DCBRECCA        ASA CHARACTERS USED             10080004
         BZ    SOPC039                  NO BRANCH                       10100004
*                                                                       10120000
         MVI   CCWCOMCD,WRITE           STORE PRINT SUPPRESS CMD BYTE   10140004
SOPC039  EQU   *                                                        10160000
         CLI   CCWCOMCD,0               WAS PRINTER CMD GENERATED       10180004
         BNE   SOPC041                  YES BRANCH                      10200004
*                                                                       10220000
         MVI   CCWCOMCD,PRTSPC1         SAVE PRINT CMD SPACE ONE LINE   10240004
*                                                                       10260000
SOPC041  EQU   *                                                        10280000
*                                                                       10300000
         B     SOPC061                  BUILD TAPE CHANNEL PROGRAMS     10320004
*                                                                       10340000
SOPC043  EQU   *                                                        10360000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10362002
         MVI   DCBRTN4,RTN2             STORE EGP2'S ID VALUE           10380004
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 10382002
         MVI   ICBINCAM+1,1             SAVE INCREMENT VALUE            10400004
         OI    CCWFLGS,CCWCC+CCWSLI+CCWPCI SET FLAGS                    10420004
         BAL   RRET,SOPC070             GO RESET PC I BIT IF     Y02072 10430002
*                                         NECESSARY              Y02072 10432002
         MVI   CCWCOMCD,WRITE           SET FOR WRITE                   10434004
         TM    PAROPT,PAROUTPT          DCB FOR OUTPUT                  10440004
         BO    SOPC061                  YES BRANCH                      10460004
*                                                                       10480000
         MVI   CCWCOMCD,READ            STORE READ CMD BYTE             10500004
         TM    PAROPT,PARRDBCK          READ BACKWARDS BIT ON           10510004
         BZ    SOPC045                  NO - NOT READ BACKWARDS         10512004
         TM    PAROPT,PAROUTPT-PARRDBCK ANY OTHER BITS ON               10520004
         BNZ   SOPC045                  YES - NOT READ BACKWARDS        10540004
*                                                                       10560000
*        READ BACKWARDS CHANGE COMMAND CODE AND INCREMENT AMOUNT        10570004
*                                                                       10572004
         MVI   CCWCOMCD,READBACK        SAVE RD BACK CMD BYTE           10580004
         MVC   ICBINCAM,NEGONE          SAVE INCREMENT VALUE NEGATIVE   10600004
*                                                                       10620000
*                                                                       10640000
SOPC045  EQU   *                                                        10660000
*                                                                       10680000
*    APAR 36955 RESULTED FROM A BAD APAR FIX (17073).  THE       A36955 10689021
*    PROBLEM SYMPTOM WAS THAT THE SILI BIT WAS BEING LEFT ON FOR A36955 10698021
*    FIXED UNBLOCKED RECORDS.                                    A36955 10707021
         TM    DCBRECFM,DCBRECF         TEST FOR FIXED OR        A36955 10716004
*                                       UNDEFINED                A36955 10725021
         BNO   SOPC061                  NO, MUST BE VARIABLE     A36955 10734004
*    AT THIS POINT RECORDS COULD BE EITHER UNDEFINED OR          A36955 10743021
*    FIXED.  MUST TEST FURTHER.                                  A36955 10752021
         TM    DCBRECFM,DCBRECU         RECORDS FORMAT U         A36955 10761004
         BO    SOPC061                                           A36955 10770021
*                                                                       10780000
*                                                                       10800000
*                                                                       10840000
         NI    CCWFLGS,X'FF'-CCWSLI     TURN SILI FLAG OFF              10860004
*                                                                       11100000
SOPC061  EQU   *                        ALL DEVICES                     11120004
*                                                                       11140000
*                                                                       11143018
*             THIS NOP MUST BE INSERTED TO INSURE A SIMULTANEOUS        11146018
*             CHANNEL END DEVICE END INTERUPT IN THE EVENT THIS         11149018
*             ICB'S CHANNEL PROGRAM IS RESTARTED BY THE ERPS            11152018
*                                                                       11155018
         LA    RC,CCW+L'CCW             GET NEXT CCW              19768 11158004
         MVI   CCWCOMCD,NOP             NOP COMMAND CODE          19768 11161004
         MVI   CCWBYTE+1,1              COUNT OF 1 IN CCW         19768 11164004
         MVI   CCWFLGS,CCWCC            SET CMD CHAIN FLAG        19768 11167004
*                                                                       11170018
         LA    RC,CCW+L'CCW             POINT TO NOP/TIC          19768 11173004
*                                                                       11180000
         LA    RD,ICBEXTEN-ICB+L'CCW(RC) POINT TO NEXT POSSIBLE ICB CP. 11200004
         ST    RD,CCWADDRA              SAVE IN NOP/TIC CCW             11220004
         MVI   CCWCOMCD,NOP             SAVE CMD BYTE                   11240004
         OI    CCWFLGS,CCWSLI           SET SILI ON IN CCW              11260004
         MVI   CCWBYTE+1,1              COUNT OF ONE IN CCW             11280004
         LA    RC,CCW+L'CCW             POINT TO NEXT POSSIBLE ICB      11300004
         BCT   RTIOT,ICBLOOP            DECREMENT ICB COUNTER           11320004
*                                                                       11360000
*                                                                       11380000
**********************************************************************  11400000
*                                                                       11420000
*                                                                       11440000
SOPCEND  EQU   *                                                        11460000
*                                                                       11480000
*                                                                       11500000
*                                                                       11560000
         L     RD,DCBIOBA               GET FIRST ICB ADDRESS           11580000
         ST    RD,ICBNICBA              LINK FIRST ICB TO LAST ICB.     11600004
         DROP  RB                                                       11610004
         USING ICB,RD                                                   11612004
         LA    RE,ICBEXTEN              POINT TO ICB'S CP START AD.     11620004
         LA    RF,L'CCW                 CONSTANT OF EIGHT               11640004
         SR    RC,RF                    POINT BACK TO LAST ICB'S NOP    11660000
         ST    RE,CCWADDRA              STORE FIRST ICB'S CP AD IN NOP  11680004
         MVI   CCWCOMCD,NOP             RESTORE NOP CMD BYTE            11700004
         DROP  RC,RD                                                    11710004
*                                                                       11720000
*                                                                       11760000
*                                                                       11780000
*                                                                       11800000
         L     RDEB,DCBIOBAD            PICK UP MAIN IOB ADDRESS        11820000
         USING IOBQSAMC,RDEB                                            11830004
*                                                                       11840000
         IC    RF,IOBCINOP              PICK UP NOP OFFSET              11860004
         AR    RD,RF                    GET NOP ADDRESS AND             11880000
         ST    RD,IOBCNOPA               STORE AS 'LAST NOP' IN MAINIOB 11900004
         MVI   IOBCNOPA,IOBCEXCP         SET EXCP NEEDED FLAG    YM6583 11910004
*                                                                       11920000
*                                                                       11940000
*                                                                       11960000
*    GENERATION OF ICB'S AND CHANNEL PROGRAMS ARE COMPLETE              11980000
*                                                                       12000000
*                                                                       12020000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12020102
         TM    DCBRECFM,DCBRECV+DCBRECSB  VARIABLE SPANNED     M6413    12025004
         BO    LOAD1916                YES, XCTL TO 1916         M5071  12030020
         MVC   WTGIDTTR,SOPSLDFT        NO, XCTL TO 1913       @Z30TSCF 12034003
         B     RELOOP                                            M5071  12040020
LOAD1916 EQU   *                                                 M5071  12045020
         MVC   WTGIDTTR,SOPS1916        XCTL TO 1916           @Z30TSCF 12047003
         EJECT                                                          12099002
RELOOP   LA    RWTGC,WTGEND             INCREMENT CURR WTG ENTRY        12160004
         LA    RPARC,L'PARDCBAD(0,RPARC) INCR CURRENT DCB ENTRY PRTR    12180004
         CLC   WTGID,AMIDCNST           THIS RT NEEDED AGAIN            12200004
         BER   RBASE                                                    12220004
*                                                                       12240000
         CLC   WTGID,OPIDCNST           END OF TABLE                    12260004
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             12280004
*                                                                       12300000
         LR    RPARC,RPAR               REINITIALIZE PARM LIST PTR      12320004
         DROP  RWTGC                                                    12330004
         LA    RWTGC,WTGENTRY           REINITIALIZE WTG LIST PTR       12340004
         USING WTGENTRY,RWTGC                                           12350004
ZCHEK    CLI   WTGENTRY,0               IS THIS ENTRY COMPLETE          12360004
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         12380004
*                                                                       12400000
         LA    RWTGC,WTGEND             GET NEXT ENTRY                  12420004
         LA    RPARC,L'PARDCBAD(0,RPARC)                                12440004
         B     ZCHEK                                                    12460004
*                                                                       12480000
TCTLRTN  EQU   *                                                        12500000
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*12600003
               MODID=WTGENTRY                                  @Z30TSCF 12610003
*                                                                       13040000
* THE FOLLOWING ROUTINE TESTS TO SEE IF THIS JOB IS RUNNING IN   Y02072 13042002
* A VIRTUAL ENVIRONMENT.  IF YES, PCI BIT SHOULD NOT BE TURNED   Y02072 13044002
* ON.  IF NO, PCI BIT CAN BE LEFT ON.                            Y02072 13046002
* ON INPUT RC MUST POINT TO THE CCW                                     13047004
*                                                                       13048002
SOPC070  L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02072 13052002
         USING DEBBASIC,RDEB                                     Y02072 13054002
         L     RWK5,DEBTCBAD            TCB ADDR FOR V=R TEST    Y02072 13056002
         DROP  RDEB                                              Y02072 13058002
         USING TCB,RWK5                                          Y02072 13058402
         TM    TCBFLGS6,TCBRV           JOB RUNNING VIRT=REAL    Y02072 13058802
         BOR   RRET                     NO, RETURN               Y02072 13059202
         USING CCW,RC                                            Y02072 13059602
         NI    CCWFLGS,X'FF'-CCWPCI     YES, TURN OFF PCI FLAG   Y02072 13059702
         DROP  RC                                                Y02072 13059802
         BR    RRET                     RETURN MAINLINE          Y02072 13059902
*                                                                       13060000
**                                                                      13060104
*                                                                       13060204
*********************************************************************   13060304
*                                                                       13062904
OPIDCNST DC    C'0S'                                                    13064904
AMIDCNST DC    C'1Q    '                                                13065304
SOPS1916 DC    C'16',VL3(IGG01916)      VAR, SPANNED RECS      @Z30TSCF 13065404
SOPSLDFT DC    C'13',VL3(IGG01913)      OTHER THAN IGG01916    @Z30TSCF 13065504
SOP5     DC    C'1G',VL3(IGG0191G)   CHAINED SCHEDULING UNSUP  @Z30TSCF 13066404
NEGONE   DC    X'FFFF'                                                  13066804
CONONE   DC    H'1'                                                     13067204
*                                                                       13068104
*                                                                       13068504
*********************************************************************** 13068904
*                                                                       13070604
DS       DS    0H                                                       13071004
*                                                                       13071404
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 13072304
END      EQU   *                        END OF MODULE            Y02072 13074004
         EJECT                                                          13075704
         IHACCW  DSECT=YES                                              13077404
         EJECT                                                          13079104
CVT      DSECT                                                          13080804
         CVT                                                            13090804
         EJECT                                                          13110802
         DCBD    DSORG=PS                                               13240004
*                                                                       13242104
*        THE FOLLOWING EQUATES REPRESENT A TABLE IN THE STAGE 3         13242404
*        EXECUTORS AND IS USED TO DECIDE WHICH ROUTINES TO LOAD.        13242704
*                                                                       13243004
         ORG   DCBCNTRL                                                 13243304
DCBRTN1  DS    X                        ROUTINE 1                       13243604
DCBRTN2  DS    X                        ROUTINE 2                       13243904
DCBRTN3  DS    X                        ROUTINE 3                       13244204
DCBRTN4  DS    X                        ROUTINE 4                       13244504
RTN1     EQU   1                        ROUTINE 1 ID                    13244804
RTN2     EQU   2                        ROUTINE 2 ID                    13245104
RTN3     EQU   3                        ROUTINE 3 ID                    13245404
RTN4     EQU   4                        ROUTINE 4 ID                    13245704
RTN5     EQU   5                        ROUTINE 5 ID                    13246004
RTN6     EQU   6                        ROUTINE 6 ID                    13246304
RTN7     EQU   7                        ROUTINE 7 ID                    13246604
RTN8     EQU   8                        ROUTINE 8 ID                    13246904
RTN9     EQU   9                        ROUTINE 9 ID                    13247204
RTN10    EQU   10                       ROUTINE 10 ID                   13247504
         EJECT                                                          13260004
         IEZDEB  LIST=YES                                               13292004
         EJECT                                                          13294004
         IECDSECS  (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES             13350004
         ORG   WTGIDTTR                                                 13352004
WTGID    DS    CL2                      NEXT MODS ID                    13354004
IOBCEXCP EQU   X'80'                    FLAG TO SAY EXCP NEEDED  YM6583 13354404
         EJECT                                                          13356004
         IHAICB                                                         13356404
         EJECT                                                          13356804
FORCORE  DSECT                                                          13358004
         IHAFCAUD  ORG=YES                                              13358404
         EJECT                                                          13358504
         IGGPARML                                                       13358604
         EJECT                                                          13358704
         IKJTCB                                                         13358804
UCB      DSECT                                                          13359204
         IEFUCBOB  LIST=YES                                             13359604
         END                                                            13360004
./  ADD  SSI=72620462,NAME=IGG0191R
 TITLE 'IGG0191R - 2ND STAGE, IN/OUT, OUT/IN, TAPE, BSAM, CHAINED SCHEDX00020002
               ULING'                                                   00020202
IGG0191R CSECT                                                          00020302
*                                                                       00020402
*MODULE NAME - IGG0191R                                          Y02072 00020502
*                                                                       00020602
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00020702
*                                                                       00020802
*COPYRIGHT - NONE                                                Y02072 00021002
*                                                                       00021402
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00021502
*                                                                       00021602
*          VS 1 RELEASE 3 CHANGES/DELETIONS                             00021702
*                                                                XA1824 00021802
*                                                                XA2035 00023902
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00026102
*000200,000340011600,013800,033400,040600,088500-088760,         Y02072 00028202
*105200-105400,21000,95600,100400,101000,105592                  Y02072 00030302
*                                                                YM4697 00032402
*                                                                YM6583 00032502
*                                                                       00034503
*          VS2 RELEASE 3 DELETIONS                                      00036503
*                                                              @Z30TSCF 00036903
*          RELEASE 20 DELETIONS                                       * 00037502
*0972001600,016400,020200-020600,023800-030200,041400-041600,    S20201 00039002
*0972046000-046200,055800-087400,091000-091200,093400-093600,    S20201 00040502
*0972103600,104200                                               S20201 00042002
*0972090200                                                      A40435 00043502
*          RELEASE 21 DELETIONS                                       * 00045002
* 055100-055200,091800,092200,092600-094800                      A43732 00046502
*  REFER TO CODE FLAGGED XA1824                                 SA63262 00046902
*  REFER TO CODE FLAGGED XA2035                                 SA62862 00047302
*                                                               SA69762 00047702
*                                                                       00048002
*STATUS CHANGE LEVEL 008                                                00052502
*                                                                       00054002
*   THIS MOD SPLIT INTO MOD IGG0191X IN REL 20.1                 A43732 00055502
*                                                                       00057002
*FUNCTION                                                             * 00058502
*        1 GET CORE FOR IOB'S AND DATA CHAINED CHANNEL PROGRAMS         00060002
*        2 CLEAR CORE                                                   00080000
*        3 CONSTRUCT IOBS                                               00100000
*        4 CONSTRUCT CHANNEL PROGRAMS FOR DISK OR TAPE                  00120000
*        3 CLEAR CORE FOR THE ABOVE                                     00140002
*        5 CONSTRUCT IOB'S OR ICB'S                                     00180002
*        6 IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA       Y02072 00190002
*          INDICATING TO FORCE CLOSE THAT THE CORE GETMAINED     Y02072 00192002
*          FOR THE IOB'S CAN BE FREEMIANED.                      Y02072 00194002
*                                                                     * 00200000
*ENTRY POINT                                                          * 00220000
*        IGG0191R BY XCTL                                               00240000
*                                                                     * 00260000
*INPUT                                                                * 00280000
*        SEE REGISTER DESCRIPTION,DCB                                 * 00300000
*                                                                     * 00320000
*OUTPUT                                                               * 00340000
*        SEE REGISTER DESCRIPTION                                     * 00360000
*                                                                     * 00380000
*        USERS DCB                                                    * 00400000
*EXTERNAL ROUTINES-NONE                                               * 00420000
*                                                                     * 00440000
*EXITS                                                                * 00460000
*        NORMAL BY XCTL TO IGG01913                                     00480000
*        NORMAL BY XCTL TO IGG0191J FOR DISK OR IGG0191G FOR TAPE       00500000
*                                   WHEN ONE BUFFER IS SPECIFIED        00520000
*                                                                     * 00540000
*        ERROR-NONE                                                   * 00560000
*                                                                       00570002
*MACROS : ACTION - MODESET, GETMAIN, XCTL                        Y02072 00572002
*                                                                       00574002
*MACROS : MAPPING - IECDSECS, IEZIOB, IHAICB, DCBD, IKJTCB,      Y02072 00576002
*                   IEZDEB, IHACCW, IHAFCAUD                     Y02072 00578002
*                                                                     * 00580000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00600000
*                                                                       00620000
*      BYTE  0-7  NAME                                                  00640000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00660000
*      BYTE 11    CONCATENATION NUMBER                                  00680000
*      BYTE 12    ZERO                                                  00700000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00720000
*                        ALIAS INDICATOR 1 BIT                          00740000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00760000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00780000
*      BYTE 17    ZERO                                                  00800000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00820000
*      BYTE 20    TRANSLATION TABLE                                     00840000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00860000
*      BYTE 22-23 ATTRIBUTES                                            00880000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00900000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00920000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00940000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00960000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00980000
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        01000000
*      BYTE 36-39 TABLE OF IDTTR'S                                      01020000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          01040000
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          01060000
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01080000
*                   NOT USED                         (1 BYTE)           01100000
*                                                                     * 01120000
*ATTRIBUTES                                                           * 01140000
*        REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY UNLESS Y02072 01160002
*        OTHERWISE SPECIFIED, SUPER STATE                        Y02072 01170002
*NOTES                                                                * 01180000
*        ALL REG EQUATES HAVE AN 'R' AT BEGINNING OR END OF SYMBOL    * 01200000
*                                                                     * 01220000
RDCB     EQU   2                       DCB                              01240000
RBASE    EQU   3                       BASE                             01260000
RCORE    EQU   4                       WORK AREA ADDRESS                01280000
RPAR     EQU   5                       TOP OF PARAMETER LIST            01300000
RWTG     EQU   6                       TOP OF WTG TABLE                 01320000
RPARC    EQU   7                       CURRENT PARAMETER                01340000
RWTGC    EQU   8                       CURRENT TRANSFER LOAD            01360000
RWK1     EQU   9                       WORK REGISTER             Y02072 01380002
*                                      IOB COUNTER DURING IOB CONST   * 01400000
RUCB     EQU   10                      BRANCH REG                       01420000
RDEB     EQU   11                                                       01440000
RB       EQU   12                                                       01460000
RC       EQU   13                      BUFFER ADDRESS                   01480000
RD       EQU   14                                                       01500000
RJ       EQU   15                      CCW ADDRESS                      01520000
RE       EQU   0                       BLOCKING FACTOR DURING CHP CONST 01540000
RF       EQU   1                       IOB ADDRESS                      01560000
RWK2     EQU   RF                       WORK REGISTER            Y02072 01570002
DOUBLE   EQU   X'02'                                                    01580000
NTPTINDX EQU   6                        NOTE/POINT INDEX         XA2035 01590002
FSTD     EQU   X'88'                                                    01620000
IOBCEXCP EQU   X'80'                    IOBCNOPA FLAG            YM6583 01640002
*                                                                       01660000
         EJECT                                                          01670002
         BALR  RBASE,0                                                  01740000
         USING ENTRY1,RBASE                                             01760000
         USING IHADCB,RDCB                                              01780000
         USING FORCORE,RCORE                                            01800000
*                                                                     * 01820000
ENTRY1   EQU   *                                                        01840000
*                                                                     * 01860000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 01870002
         DC    C'IGG0191R'              MODULE NAME              Y02072 01872002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 01874003
         DC    C'10/17/74'              LAST DATE MODIFIED     @Z30TSCF 01876003
BEGIN    DS    0H                                                Y02072 01878002
         L     RDCB,0(0,RPARC)         DCB ADDRESS                      01880000
         L     RCORE,4(0,RWTGC)         LOAD WORKAREA ADDR       Y02072 01890002
*                                                                     * 01900000
*TEST FOR ONE BUFFER WHICH IS NOT ALLOWED WITH CHAINED SCHEDULING     * 01920000
*                                                                     * 01940000
         CLI   DCBNCP,X'01'             IS NUMBER OF CHP ONE            01960000
         BH    A0000                    NO-BRANCH                       01980000
*                                       YES XCTL                      * 02000000
*                                                                     * 02080000
         USING WTGENTRY,RWTGC                                    Y02072 02090002
         MVC   WTGIDTTR,SOP5            ID FOR TAPE EXEC       @Z30TSCF 02092003
         B     RELOOP                   XCTL                            02120000
*                                                                     * 02140000
*                                                                     * 02160000
A0000    EQU   *                                                        02180000
         OI    DCBCIND2,X'04'           SET PCI INDICATOR ON            02200000
*                                                                     * 02220000
*                                                                     * 02240000
         MVI   DCBIOBA,X'28'            START TO SET NOP OFFSR     MC0L 02260000
         MVI   DCBIOBA+1,X'38'          START TO SET NOP OFFSR     MC0L 02280000
         LA    RF,48                    CNST 48 FOR PART OF MIOB LGTH   02300000
          SR    RD,RD                   CLEAR ACC REG                   02320000
         MVI   DCBCNTRL+3,X'02'         TAPE IN-OUT; DA IN EOB IDS      02340000
         TM    DCBMACF1,DCBMRPT1        NOTE/POINT, INPUT        XA2035 02350002
         BO    A0005                    YES, GO SET INDEX        XA2035 02360002
         TM    DCBMACF2,DCBMRPT2        NOTE/POINT, OUTPUT       XA2035 02370002
         BZ    A0010                    NO, BYPASS SETTING INDEX XA2035 02380002
A0005    EQU   *                                                 XA2035 02382002
         MVI   DCBCNTRL+1,NTPTINDX      SET NOTE/POINT INDEX     XA2035 02384002
A0010    EQU   *                                                        02390002
         LA    RD,64                    LGTH OF ICB PLUS CHP FOR TAPE   03060000
         LR    RB,RD                    COPY AMT                        03120000
         SRL   RB,3                     DETERMINE IOBL FOR CLOSE        03140002
         STC   RB,DCBIOBL               PLACE IN IOBL                   03160000
*                                                                     * 03180000
         SR    RJ,RJ                    CLEAR REG                       03200000
         IC    RJ,DCBNCP                GET NUMBER OF CHP               03220000
         MR    RD,RD                    AMT SPACE NEEDED MINUS MIOB     03240000
*                                                              LENGTH * 03260000
         AR    RJ,RF                    TOTAL AMT OF SPACE NEEDED       03280000
         LR    RD,RJ                    SAVE LENGTH                     03300000
*                                                                       03310002
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE      YM4697 03312002
*  IOB AND ICBS IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE     YM4697 03314002
*  EXECUTOR.                                                     YM4697 03316002
*                                                                     * 03320000
         ST    RJ,DXATEXC2              SAVE LENGTH              YM4697 03322002
*                                                                       03324002
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 03330002
         GETMAIN R,LV=(RJ),SP=0                                  Y02072 03340002
*                                                                     * 03360000
         LR    RC,RF                    SAVE ADDRESS RETURNED FROM      03380000
*                                       GETMAIN FOR CLEARING          * 03400000
* THIS SECTION CLEARS CORE                                            * 03420000
*                                                                     * 03440000
         LR    RJ,RD                    RESTORE LENGTH                  03460000
         LA    RD,255                   CONSTANT 255                    03480000
         BCTR  RJ,0                     REDUCE AMOUNT BY ONE            03500000
COMPARE  EQU   *                                                        03520000
         CR    RJ,RD                    AMT TO CLEAR GREATER THAN 255   03540000
         BC    12,ONECLEAR              NO-BRANCH                       03560000
         EX    RD,CLEAR                 CLEAR 256 BYTES                 03580000
         SR    RJ,RD                    AMT TO CLEAR MINUS 255          03600000
         BCTR  RJ,0                     SUBTRACT ONE MORE               03620000
         LA    RC,256(0,RC)             UPDATE AREA ADDRESS             03640000
         B     COMPARE                  TRY AGAIN                       03660000
*                                                                     * 03680000
CLEAR    EQU   *                                                        03700000
         XC    0(1,RC),0(RC)            CLEAR CORE                      03720000
*                                                                       03740000
ONECLEAR EQU   *                                                        03760000
         EX    RJ,CLEAR                 CLEARS LESS THAN 256            03780000
*                                                                     * 03800000
* CLEARING OF CORE FINISHED HERE RF EQUALS ADDRESS                    * 03820000
*                                                                     * 03840000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 03850002
         ST    RF,DCBIOBAD              THIS IS MAIN IOB ADDRESS        03860000
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 03870002
          LR    RJ,RF                    COPY MIOB ADDRESS              03880000
*********************************************************************** 03900000
* START CONSTRUCTION OF MAIN IOB HERE                                 * 03920000
*********************************************************************** 03940000
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 03952002
         MVC   2(2,RF),DCBIOBA          MOVE NOP OFFSETS TO MIOB        03960000
         LA    RE,4(0,RF)               ECB ADDRESS                     03980000
         ST    RE,20(0,RF)              PLACE ADDRESS IN ECB POINTER    04000000
         MVI   4(RF),X'7F'              INDICATE COMP NO ERROR          04020000
         L     RWK1,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 04050002
         USING IOBQSAMC,RF                                       Y02072 04060002
         ST    RWK1,IOBDCBPT            DCB ADDR TO IOB          Y02072 04070002
         DROP  RF                                                Y02072 04072002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 04076002
*                                                                       04080000
         MVC   DCBOFFSR(2),OFFSETT       TAPE OFFSR,OFFSW TO DCB        04100000
*                                                                     * 04120000
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 04130002
*                                                                     * 04180000
         LA    RD,80(0,RF)              TAPE STARTAD                    04200000
         ST    RD,32(0,RF)              ADDRESS TO MIOB                 04220000
         LA    RD,48(0,RF)              FIRST ICB ADDRESS               04240000
A0020    EQU   *                        ICB ADDRESS TO DCB              04260000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 04262002
         ST    RD,DCBIOBA                                               04280000
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 04282002
         ST    RD,8(0,RF)               FIRST ICBAD TO MIOB             04300000
         LR    RF,RD                    COPY ICB ADDRESS FOR FIRST TIME 04320000
         SR    RE,RE                    CLEAR REG                       04340000
         IC    RE,DCBNCP                NUMBER OF CHP FOR COUNTING      04360000
*********************************************************************** 04380000
* CONSTRUCT ICB HERE                                                  * 04400000
*********************************************************************** 04420000
A0025    EQU   *                                                        04440000
         ST    RD,0(0,RF)               LINKAD TO ICB                   04460000
*                                       REDUNDANT FOR FIRST TIME        04480000
         LR    RF,RD                    NEW ADDRESS TO ICB REG          04500000
         LA    RD,4(0,RF)               ECB ADDRESS                     04520000
         ST    RD,12(0,RF)              PLACE IN ICB                    04540000
         MVI   4(RF),X'7F'              INDICATE COMP NO ERROR          04560000
*                                                                       04580000
*                                                                       04640000
          MVI   29(RF),X'01'             INC COUNT FOR TAPE             04660000
*                                                                     * 04680000
* CCWS FOR TAPE HERE                                                  * 04700000
*                                                                     * 04720000
         MVI   36(RF),X'68'             CC,SIL,PCI FLAGS TO CCW         04740000
*                                                                       04742002
* MUST TEST FOR VIRTUAL ENVIRONMENT.  IF YES, TURN PCI FLAG OFF. Y02072 04744002
* IF NO, LEAVE PCI FLAG ON.                                      Y02072 04746002
*                                                                       04748002
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02072 04750002
         USING DEBBASIC,RDEB                                     Y02072 04752002
         L     RWK1,DEBTCBAD            GET TCB ADDRESS          Y02072 04754002
         DROP  RDEB                                              Y02072 04756002
         USING TCB,RWK1                                          Y02072 04758002
         TM    TCBFLGS6,TCBRV           JOB RUNNING V=R          Y02072 04758402
         BO    A0028                    NO, LEAVE FLAG ON        Y02072 04758802
         USING ICB,RF                                            Y02072 04759202
         NI    CCWFLGS,X'FF'-CCWPCI     YES, TURN FLAG OFF       Y02072 04759602
A0028    EQU   *                                                 Y02072 04759902
*                                                                       04760002
*  BUILD WRITE CCW                                                      04760102
*                                                                       04760202
         MVC   48(8,RF),32(RF)          COPY READ CCW INTO      SA69762 04760302
*                                         WRITE CCW             SA69762 04760402
         MVI   48(RF),X'01'             WRITE CMND BYTE         SA69762 04760702
*                                                                       04761902
*  MUST RESET SILI BIT IF FIXED LENGTH RECORDS                   XA1824 04763902
*                                                                       04765902
         TM    DCBRECFM,DCBRECU         UNDEFINED LEN RECORDS    XA1824 04766302
         BNM   A0050                    YES, LEAVE SILI ON       XA1824 04766402
         TM    DCBRECFM,DCBRECV         VARIABLE LEN RECORDS     XA1824 04766502
         BO    A0050                    YES, LEAVE SILI ON       XA1824 04773202
         NI    CCWFLGS,X'FF'-CCWSLI     RESET SILI BIT           XA1824 04775202
A0050    EQU   *                                                 XA1824 04777202
         DROP  RWK1,RF                                           Y02072 04779902
         MVI   32(RF),X'02'             READ CMND BYTE                  04786602
         LA    RD,96(0,RF)              NOP/TIC ADDRESS FOR CCW         04940000
         ST    RD,40(0,RF)              PLACE ADDRESS IN CCW            04960000
         MVI   44(RF),X'20'             TURN ON SIL FLAG                04980000
         MVI   47(RF),X'01'             COUNT OF ONE                    05000000
         MVI   40(RF),X'03'             NOP CMND BYTE                   05020000
         LA    RD,112(0,RF)             NOP/TIC ADDRESS FOR CCW         05100000
         ST    RD,56(0,RF)              PLACE IN CCW                    05120000
         MVC   60(4,RF),44(RF)          COPY FLAG AND LGTH FROM NOP RD  05140000
         MVI   56(RF),X'03'             NOP CMND BYTE                   05160000
*                                                                     * 05180000
*                                                                     * 05200000
*                                                                     * 05220000
         LA    RD,64(0,RF)              NXT ICB ADDRESS                 05240000
*                                                                     * 05260000
         BCT   RE,A0025                 MORE ICBS TO MAKE BRANCH        05280000
*                                                                     * 05300000
*                                                                     * 05320000
         L     RD,DCBIOBA               GET FIRST ICB ADDRESS           05340000
         ST    RD,0(0,RF)               PLACE AS LAST LINK ADDRESS      05360000
         LA    RC,32(0,RD)              FIRST RD CCW ADDRESS            05380000
         ST    RC,40(0,RF)              PLACE IN LAST RD NOP            05400000
         MVI   40(RF),X'03'             SET CMND BYTE                   05420000
*                                                                     * 05440000
         LA    RC,48(0,RD)              FIRST WR CCW ADDRESS            05460000
         ST    RC,56(0,RF)              PLACE IN LAST WR NOP            05480000
         MVI   56(RF),X'03'             SET CMND BYTE                   05500000
*                                                                     * 05540000
*********************************************************************** 05560000
*                                                                     * 08760000
* THIS FINISHES NOP/TIC ADDRESSES LAST NOW POINTS TO FIRST CHPS       * 08780000
*                                                                     * 08800000
*                                                                     * 08820000
A0200    EQU   *                                                        08840000
*                                       RD EQUALS FIRST ICB ADDRESS   * 08880000
*                                                                     * 08900000
         LA    RC,56(0,RD)              NOP ADDRESS FOR MIOB          * 08920000
*                                       WHEN OPENED FOR IN/OUT        * 08940000
*                                       DEVICE DISK OR FOR OUT/IN     * 08960000
*                                       WHEN A TAPE                   * 08980000
*                                                                     * 09000000
         TM    12(RDEB),X'07'          IS DCB FOR OUT/IN?        A40435 09020020
         BC    1,A0220                  YES BRANCH                      09040000
*                                                                     * 09060000
*                                                                     * 09080000
*                                                                       09140000
         LA    RC,40(0,RD)              LAST NOP ADDR FOR TAPE          09160000
A0220    EQU   *                                                 A43732 09180021
         ST    RC,12(0,RJ)              LAST NOP ON Q TO MIOB           09200000
         MVI   12(RJ),IOBCEXCP          SET EXCP NEEDED FLAG     YM6583 09220002
*                                                                     * 09240000
*                                                                     * 09500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     09520000
XCTL     EQU   *                                                        09540000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 09542002
         USING WTGENTRY,RWTGC                                    Y02072 09552002
         MVC   WTGIDTTR,NXTEXEC         XCTL TO LOAD EXECUTOR  @Z30TSCF 09554003
RELOOP   EQU   *                                                        09600000
         L     RCORE,4(0,RWTGC)        LOAD RCORE BASE                  09620000
         LA    RWTGC,8(0,RWTGC)             INCREMENT CURR WTG ENTRY    09640000
         LA    RPARC,4(0,RPARC)             INC CURRENT DCB ENTRY PTR   09660000
         CLC   0(2,RWTGC),AMIDCNST     Q- THIS RT NEEDED AGAIN          09680000
         BCR   8,RBASE                                                  09700000
*                                                                       09720000
         CLC   0(2,RWTGC),OPIDCNST     Q- END OF TABLE                  09740000
         BC    7,RELOOP                    NO-CHECK NEXT ENTRY          09760000
*                                                                       09780000
         LR    RPARC,RPAR                                               09800000
         LA    RWTGC,32(0,RWTG)             REINIT WTG LIST PTR         09820000
ZCHEK    EQU   *                                                        09840000
         CLI   0(RWTGC),X'00'               Q-IS THIS ENTRY COMPLETE    09860000
         BC    7,TCTLRTN                                                09880000
*                                                                       09900000
         LA    RWTGC,8(0,RWTGC)             GET NEXT ENTRY              09920000
         LA    RPARC,4(0,RPARC)                                         09940000
         B     ZCHEK                                                    09960000
*                                                                       09980000
TCTLRTN  EQU   *                                                        10000000
         USING WTG,RWTG                                                 10050003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*10100003
               MODID=WTGENTRY                                  @Z30TSCF 10110003
         DROP  RWTGC,RWTG                                      @Z30TSCF 10112003
*                                                                       10120000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   10140000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   10160000
*                                                                       10180000
AMIDCNST DC    C'1R'                    THIS ID                         10200000
OPIDCNST DC    C'0S'                   END ID                           10220000
SOP5     DC    C'1G',VL3(IGG0191G)      PCI UNSUPPORTABLE      @Z30TSCF 10270003
NXTEXEC  DC    C'13',VL3(IGG01913)     NEXT EXEC, NORMAL PATH  @Z30TSCF 10272003
OFFSETT   DC   X'2030'                   TAPE OFFSR,OFFSW               10280000
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 10290002
END      EQU   *                        END OF MODULE            Y02072 10300002
         EJECT                                                          10380002
         DCBD  DSORG=PS                                                 10500000
         EJECT                                                          10510002
CVT      DSECT                                                 @Z30TSCF 10520003
         CVT                                                   @Z30TSCF 10530003
         EJECT                                                          10540003
         IHAICB                                                  Y02072 10550002
         EJECT                                                          10550402
         ORG   ICBEXTEN                                          Y02072 10552002
         IHACCW  DSECT=NO                                        Y02072 10554002
         EJECT                                                          10554402
         IEZDEB                                                  Y02072 10556002
         EJECT                                                          10558002
         IKJTCB                                                  Y02072 10558402
         EJECT                                                          10558802
         IECDSECS  (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES    @Z30TSCF 10559203
         ORG   WTGIDTTR                                          Y02072 10559602
WTGID    DS    CL2                      NEXT MOD ID              Y02072 10559702
         EJECT                                                          10559802
FORCORE  DSECT                                                   Y02072 10559902
         IHAFCAUD  ORG=YES                                       Y02072 10609902
         END                                                            10659902
./  ADD  SSI=80240438,NAME=IGG0191S
         TITLE 'IGG0191S, LEVEL 2 EXEC FOR D.A. WITH TRACK OVERFLOW.'   00030002
         MACRO                                                          00032002
&NAME    IF    &A,&IS=,&ISNOT=,&GOTO=                                   00040000
         LCLB  &NOERR                                                   00060000
&NOERR   SETB  1                                                        00080000
         AIF   ('&A' NE '').SKIP                                        00100000
         MNOTE 'TEST  ADDRESS NOT SPECIFIED.'                           00120000
&NOERR   SETB  0                                                        00140000
.SKIP    AIF   ('&GOTO' NE '').SKIP2                                    00160000
         MNOTE 'BRANCH ADDRESS MISSING.'                                00180000
&NOERR   SETB  0                                                        00200000
.SKIP2   AIF   ('&IS' NE '' OR '&ISNOT' NE '').SKIP3                    00220000
         MNOTE 'TEST CONDITION NOT SPECIFIED.'                          00240000
&NOERR   SETB  0                                                        00260000
.SKIP3   AIF   (&NOERR).SKIP4                                           00280000
         MEXIT                                                          00300000
.SKIP4   AIF   ('&IS' EQ '').NOIS                                       00320000
***                                                                     00340000
&NAME    TM    &A,&IS                                                   00360000
         BO    &GOTO                                                    00380000
***                                                                     00400000
         MEXIT                                                          00420000
.NOIS    ANOP                                                           00440001
***                                                                     00460000
&NAME    TM    &A,&ISNOT                                                00480000
         BZ    &GOTO                                                    00500000
***                                                                     00520000
         MEND                                                           00540000
IGG0191S CSECT                                                          00560000
*MODULE NAME - IGG0191S                                          Y02072 00560402
*                                                                       00560802
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00561202
*                                                                       00561602
*COPYRIGHT - NONE                                                Y02072 00561702
*                                                                       00561802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00561902
*                                                                       00562002
*        VS 1 RELEASE 3 DELETIONS/CHANGES                               00562102
*                                                                XA2992 00562202
*        VS2 RELEASE 2 DELETIONS                                 Y02072 00562402
*005520,006000,043120,043300-043360,069780-069800,079580,70400,  Y02072 00562802
*70700,74600,75600,104400,104600                                 Y02072 00564802
*                                                                YM4697 00566802
*                                                                       00568803
*        VS2 RELEASE 3 DELETIONS                                        00569203
*                                                              @Z30TSCF 00569603
*        OS RELEASE 21 DELETIONS                                 Y02072 00570302
*0083079040-080000                                               A37507 00577802
*   REFER TO CODE FLAGGED XA2992                                SA62479 00578202
*        OS RELEASE 20 DELETIONS                                        00579802
*3004058400,061800,067800-068200,068600,068800-069800,070600,    S20201 00585202
*3004079000,080000                                               S20201 00592602
*A3540100,A5000100-5000900 OX20778 FLAGGED AS------------------@ZA29383 00593637
*                                                                       00594637
*                                                                       00595637
*STATUS CHANGE LEVEL 003                                                00600002
* THIS EXECUTOR RUNS IN TANDEM WITH IGG0191H, WHICH GETS CORE FOR AND   00620000
* COMPLETES BUILDING THE IOB/CP'S.                                      00640000
*                                                                       00660000
* THE MAJOR FUNCTIONS OF THIS EXEC ARE-                                 00680000
*                                                                       00700000
* 1. STORE THE ID'S FOR THE EOB, NOTE/POINT ROUTINES REQ'D.             00720000
* 2. COMPLETE THE DCB FIELDS KNOWN PRIOR TO GETTING CORE FOR IOB/CP'S.  00740000
* 3. REPEAT FOR EACH DCB BEING OPENED.                                  00760000
* 4. CALCULATE AMOUNT OF CORE NEEDED FOR IOB'S AND GETMAIN IT    Y02072 00770002
* 5. SET AN AUDIT TRAIL BIT IN THE OPEN WORKAREA INDICATING      Y02072 00772002
*    TO FORCE CLOSE THAT THE CORE GETMAINED FOR THE IOB'S CAN    Y02072 00774002
*    BE FREEMAINED.                                              Y02072 00776002
*                                                                       00780000
* ENTRY POINTS- FROM IGG0191B BY XCTL.                                  00800000
*                                                                       00820000
* EXITS- TO IGG0191H BY XCTL                                            00840000
*        TO IGG0199K IF SEARCH DIRECT                                   00850020
*                                                                       00860000
*INPUT-REGISTERS WITH THE ADDRESSES OF THE FOLLOWING-                   00880000
*   THE PARAMETER LIST  (POINTERS TO TOP AND CURRENT ENTRY).            00900000
*   THE WHERE-TO-GO TABLE (WTG) (POINTERS TO TOP AND CURRENT).          00920000
* EXTERNAL ROUTINES- NONE.                                              00940000
* ATTRIBUTES- REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 00960002
*             UNLESS OTHERWISE SPECIFIED, RUNS IN SUPER STATE    Y02072 00970002
* TABLES/WORKAREAS-                                                     00980000
*                                                                       00990002
*MACROS : ACTION - MODESET, XCTL, XCTLTABL, GETMAIN              Y02072 00992002
*                                                                       01000000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              01020000
*      BYTE  0-7  NAME                                                  01040000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            01060000
*      BYTE 11    CONCATENATION NUMBER                                  01080000
*      BYTE 12    ZERO                                                  01100000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       01120000
*                        ALIAS INDICATOR 1 BIT                          01140000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      01160000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              01180000
*      BYTE 17    ZERO                                                  01200000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      01220000
*      BYTE 20    TRANSLATION TABLE                                     01240000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            01260000
*      BYTE 22-23 ATTRIBUTES                                            01280000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     01300000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           01320000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 01340000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        01360000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       01380000
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        01400000
*      BYTE 36-39 TABLE OF IDTTR'S                                      01420000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          01440000
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          01460000
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01480000
*                   NOT USED                         (1 BYTE)           01500000
*                                                                       01520000
*    WORKAREA- SEE 'FORCORE DSECT' (IECDSECT) IN THIS LISTING           01540000
*                                                                       01560000
*TABLES/WORKAREAS- PARAMETER LIST                                       01580000
*                                                                       01600000
*WORD ZERO                                                              01620000
*      BYTE  0    OPEN ATTRIBUTE  (INPUT, OUTPUT, UPDATE, IN/OUT,       01640000
*                                  OUT/IN, READ BACKWD, LEAVE , REREAD) 01660000
*      BYTES 1-3  DCB ADDRESS FOR FIRST DCB BEING OPENED.               01680000
*                                                                       01700000
*THE PARAMETER LIST HAS A ONE WORD ENTRY FOR EACH DCB BEING OPENED. THE 01720000
*FORMAT IS THE SAME AS WORD ZERO.                                       01740000
*END PARAMETER LIST.                                                    01760000
*                                                                       01780000
* REGISTER CONVENTIONS USED IN ALL OF OPEN-                             01800000
*                                                                       01820000
RDCB     EQU   2                        DCB REGISTER                    01840000
RBASE    EQU   3                        BASE REGISTER                   01860000
RCORE    EQU   4                        I/O SUPPORT WORK AREA           01880000
RA       EQU   RCORE                    USED FOR WORK REG UNTIL RCORE   01900000
*                                       IS NEEDED IN WTG LOGIC.         01920000
RVALCHK  EQU   RA                       VALIDITY CHECK CP BASEREG,      01940000
*                                       USES 'VCMAP' DSECT.             01960000
RPAR     EQU   5                        TOP OF PARAMETER LIST           01980000
RWTG     EQU   6                        TOP OF WTG TABLE                02000000
RPARC    EQU   7                        CURRENT PARAMETER               02020000
RWTGC    EQU   8                        CURRENT LOAD IN TRANSIENT AREA  02040000
RTIOT    EQU   9                        USED AS A WORK REG              02060000
RIOB     EQU   RTIOT                    USED AS IOB BASE REG WITH THE   02080000
*                                       IOB OVERLAY FROM FORECORE.      02100000
RUCB     EQU   10                       USED AS A WORK REG              02120000
RCPSIZE  EQU   RUCB                     USED TO CALCULATE AND HOLD THE  02140000
*                                       CHANNEL PGM SIZE.               02160000
RDEB     EQU   11                       DEB BASE REG.                   02180000
RB       EQU   12                       WORK REG.                       02200000
RCPBASE  EQU   RB                       CHANNEL PGM BASE REG USED WITH  02220000
*                                       'CPSEGMAP' DUMMY SECTION.       02240000
RC       EQU   13                       WORK REG.                       02260000
RSTEPPER EQU   RC                       POINTS TO THE CURRENT SEARCH    02280000
*                                       ADDRESS OR COUNT FIELD BEING    02300000
*                                       USED FOR CP CONSTRUCTION. WHEN  02320000
*                                       POINTING TO A COUNT FLD THE     02340000
*                                       'COUNTFLD' DUMMY SECTION IS     02360000
*                                       USED BASED ON THIS REG.         02380000
*                                                                       02400000
RE       EQU   0                        WORK REG. VOLATILE ACCROSS SVC. 02420000
RF       EQU   1                        WORK REG. VOLATILE ACCROSS SVC. 02440000
RD       EQU   14                       WORK REG. VOLATILE ACCROSS SVC. 02460000
RJ       EQU   15                       WORK REG. VOLATILE ACCROSS SVC. 02480000
*                                                                       02500000
*                                                                       02520000
* MASK CONFIGURATIONS FOR TESTING THE HI ORDER BYTE OF EACH PARAMETER   02540000
* LIST ENTRY. SIGNIFICANCE IS THE SAME AS THE DEB OPEN ATTRIBUTE FIELD. 02560000
*                                                                       02580000
INPUT    EQU   X'0F'                    TEST MASKED BITS FOR ZEROS.     02600000
OUTPUT   EQU   X'0F'                    TEST MASKED BITS FOR ONES.      02620000
INOUT    EQU   X'03'                                                    02640000
OUTIN    EQU   X'07'                                                    02660000
RDBACK   EQU   X'01'                                                    02680000
UPDAT    EQU   X'04'                                                    02700000
LEAVE    EQU   X'10'                                                    02720000
REREAD   EQU   X'30'                                                    02740000
*                                                                       02760000
* COMMAND CODES FOR THE 2841 CONTROL UNIT.                              02780000
*                                                                       02800000
SRCHEQ   EQU   X'31'                    SEARCH EQUAL ID.                02820000
SRCHEQMT EQU   X'B1'                    SEARCH EQUAL ID IN MULTI-TRACK. 02840000
TIC      EQU   X'08'                    TRANSFER IN CHANNEL.            02860000
WCKD     EQU   X'1D'                    WRITE COUNT, KEY, AND DATA.     02880000
WSCKD    EQU   X'01'                    WRITE SPECIAL, COUNT,KEY,DATA.  02900000
SEEKCYL  EQU   X'0B'                    SEEK CYLINDER.                  02920000
READDATA EQU   X'06'                    READ DATA SINGLE TRACK.         02940000
RDDATAMT EQU   86                       MULTI-TRACK READ DATA.          02960000
READKD   EQU   14                       READ KEY AND DATA.              02980000
READCT   EQU   X'92'                    READ COUNT M/T MODE.            03000000
*                                                                       03020000
* CHANNEL COMMAND WORD FLAGS.                                           03040000
*                                                                       03060000
SKIP     EQU   X'10'                    SKIP FLAG.                      03080000
SILI     EQU   X'20'                    SUPPRESS INCORRECT LENGTH IND.  03100000
CC       EQU   X'40'                    COMMAND CHAIN.                  03120000
DC       EQU   X'80'                    DATA CHAIN.                     03140000
SILICC   EQU   X'60'                    SILI AND CC TOGETHER            03160000
SILICCSK EQU   X'70'                    SILI, CC, AND SKIP.             03180000
* END CCW FLAGS.                                                        03200000
*                                                                       03220000
*                                                                       03240000
* MISCELLANEOUS ITEMS.                                                  03260000
*                                                                       03280000
COMPNOER EQU   X'7F'                   USED TO INIT. ECB.               03300000
DCANDCC  EQU   X'C0'                    USED TO SET IOBFLAG1.           03320000
IDLENGTH EQU   X'05'                    NMBR OF BYTES IN A 'CCHHR'.     03340000
POINT    EQU   X'04'                    DCBMACRF IF NOTE/POINT USED.    03360000
QSAM     EQU   X'01'                    QSAM BIT IN DCBIND2.            03380000
*                                                                       03400000
NPD2     EQU   5                        NOTE/POINT FOR PCI,UPD,T.O.     03420000
EPDT     EQU   9                        EOB FOR T.O.                    03440000
EGP2     EQU   8                        EOB FOR D.A. INPUT.             03460000
*                                                                       03480000
*                                                                       03500000
VALCHK   EQU   X'80'                    MASK TO DETERMINE IF WRITE      03520000
*                                       VALIDITY CHECK OPTION CALLED.   03540000
TBOVHD   EQU   X'08'                    FLAG FOR 2 BYTE OVERHD @ZA29383 03550037
IOBSIZE  EQU   48                       LENGTH OF A STANDARD IOB WITH   03560000
*                                       BSAM/QSAM/BPAM EXTENSION.       03580000
IOBDBLWD EQU   6                        NMBR OF DBL WDS IN IOB.         03600000
OFFSW    EQU   24                       OFFSET OF CCW THAT WRITES DATA. 03620000
OFFSR    EQU   32                       OFFSET OF THE READ CCW THAT     03640000
*                                       RECEIVES THE BLOCK LENGTH TO    03660000
*                                       BE READ.                        03680000
CPSEGLEN EQU   32                       LENGTH OF ONE CP SEGMENT.       03700000
NOTZERO  EQU   7                        CONDITION MASK USED AFTER       03720000
*                                       ARITHMETIC INSTRUCTIONS FOR THE 03740000
*                                       NOT-ZERO TEST.                  03760000
BBCCHH   EQU   6                        MIN. SEEK LENGTH.               03780000
*                                                                       03800000
ZERO     EQU   X'00'                    AN IMMEDIATE BYTE OF ZERO'S.    03820000
TWO      EQU   2                        NO. OF CCWS FOR RCD      S20201 03820820
*                                       READY                    S20201 03821620
*                                       READY FEATURE PER SEGMENT       03822420
THREE    EQU   3                        NO. OF DW REQUIRED FOR   S20201 03823220
*                                       RCD                      S20201 03824020
D0       EQU   0                        NO DISPLACEMENT          S20201 03824820
D1       EQU   1                        DISPLACEMENT OF ONE      S20201 03825620
D2       EQU   2                        DISP AND COUNT OF TWO    S20201 03826420
WDLEN    EQU   4                        DISPLACEMENT OF ONE WD   S20201 03827220
B5       EQU   5                        BYTE COUNT OF FIVE       S20201 03828020
D6       EQU   6                        DISPLACEMENT OF SIX      S20201 03828820
SXTN     EQU   16                       ADDED LENGTH OF A CHP    S20201 03829620
*                                       SEG-                     S20201 03830420
*                                       MENT IF RCD READY USED          03831220
B24      EQU   24                       ADDITIONAL BYTES IN RD   S20201 03832020
*                                       PROG                     S20201 03832820
*                                       FOR RECORD READY FEATURE        03833620
*                                                                       03834420
NORCDRY  EQU   X'20'                    NO RCD READY MASK        S20201 03835220
SDOPT    EQU   X'01'                    SEARCH DIRCT OPTION MASK S20201 03836020
SDFLG    EQU   X'08'                    SEARCH DIRECT INDICATOR  S20201 03836820
*                                                                       03837620
MAX      EQU   256                      MAX COUNT FOR SS INST    S20201 03838420
EIGHT    EQU   8                        LENGTH OF A COUNT FIELD.        03840000
ANYZERO  EQU   14                       MASK FOR MIXED OR ZEROS.        03860000
FIRST    EQU   X'01'                    USED TO SET IOB FLAG IN FIRST   03880000
*                                       IOB AND INIT. 'R'.              03900000
READCPL  EQU   40                       NMBR OF BYTES IN READ CP.       03920000
RCPDBLWD EQU   5                        NMBR OF DBL WDS IN RCP.         03940000
REMNANT  EQU   READCPL-OFFSR            OFFSR+REMNANT=READCPL.          03960000
OPCODE   EQU   0                        OFFSET OF CCW OPCODE(IN CCW).   03980000
ADDRESS  EQU   0                        OFFSET OF ADDRESS IN CCW        04000000
*                                       (IMPLIES THAT THE ADDRESS MUST  04020000
*                                       BE PUT IN BEFORE THE OP CODE)   04040000
FLAGS    EQU   4                        CCW FLAG BYTE.                  04060000
LENFLD   EQU   6                        START OF LENGTH FLD IN CCW.     04080000
U        EQU   X'C0'                    CODE FOR DCBRECFM=U             04100000
UNRELFLG EQU   X'02'                   IOB UNRELATED FLAG        A37507 04110021
*                                                                       04120000
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY.       04140000
         USING SOP1S,RBASE                                              04160000
         USING FORCORE,RCORE                                     Y02072 04170002
*                                                                       04180000
         USING IHADCB,RDCB              DCB ADDRESSABILITY.             04200000
*                                                                       04220000
*                                                                       04240000
SOP1S    EQU   *                                                        04260000
*                                                                       04280000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 04290002
         DC    C'IGG0191S'              MODULE NAME              Y02072 04292002
         DC    C'@ZA29393'              LAST SHIP CODE         @Z30TSCF 04294037
         DC    C'01/18/78'              LAST DATE MODIFIED     @Z30TSCF 04295037
BEGIN    DS    0H                                                Y02072 04298002
*                                                                       04298402
         L     RDCB,0(RPARC)            GET DCB ADDRESS FROM PARM. LIST 04300000
         L     RCORE,WDLEN(RWTGC)       COMMON WORK AREA         S20201 04310020
         L     RDEB,DCBDEBAD            DEB ADDRESSABILITY.             04320000
         USING DEB,RDEB                                                 04340000
         TM    DCBRECFM,U               U FORMAT                 S20201 04343020
         BM    OKRR                     BRANCH IF NO             S20201 04346020
         OI    JFCBMASK+D6,NORCDRY      ASSURE RCD READY NOT     S20201 04349020
*                                       USED                     S20201 04352020
OKRR     EQU   *                                                 S20201 04355020
         XC    DCBCNTRL,DCBCNTRL        CLEAR FOR LATER USE      XA2992 04355402
*                                                                       04357002
*  ISURE NOTE/POINT ROUTINE GETS LOADED FOR BPAM                 XA2992 04359002
*                                                                       04359402
         IF    DCBDSORG,ISNOT=DCBDSGPO,GOTO=CHKQSAM              XA2992 04359802
         MVI   DCBCNTRL+1,NPD2          NOTE/POINT INDEX ID      XA2992 04359902
         B     OUTTEST                  BYPASS QSAM TEST FOR PO  XA2992 04366602
CHKQSAM  EQU   *                                                 XA2992 04368602
         IF    DCBCIND2,ISNOT=QSAM,GOTO=OUTTEST                  XA2992 04373302
ISQSAM   IF    DEBOPATB,ISNOT=OUTPUT,GOTO=RCPONLY                       04380000
         B     SOMEOUT                  NOTE/POINT NOT REQ'D.           04400000
OUTTEST  IF    DEBOPATB,IS=OUTPUT,GOTO=PEROUT                           04440000
PERIN    IF    DCBMACRF,ISNOT=POINT,GOTO=INTEST                         04460000
         MVI   DCBCNTRL+1,NPD2          SET NOTE/POINT FOR DISK ID.     04480000
INTEST   IF    DEBOPATB,ISNOT=OUTPUT,GOTO=RCPONLY                       04500000
PEROUT   IF    DCBMACRF+1,ISNOT=POINT,GOTO=SOMEOUT                      04520000
         MVI   DCBCNTRL+1,NPD2          NOTE/POINT LOAD ID.             04540000
SOMEOUT  EQU   *                        NPD2 ID SET AS REQ'D.           04560000
*                                                                       04580000
* OPEN ATTRIBUTES SPECIFY SOME FORM OF OUTPUT (OUTPUT, IN/OUT, OUT/IN). 04600000
* GET A POINTER TO THE DEVICE CHARACTERISTICS TABLE ENTRY FOR THE       04620000
* DEVICE BEING USED.                                                    04640000
*                                                                       04660000
         L     RD,DCBDVTBL              RD POINTS TO THE TABLE ENTRY    04680000
*                                       FOR DEVICE USED.                04700000
*                                                                       04720000
         USING DEVTAB,RD                DEVICE TABLE ADDRESSABILITY.    04740000
*                                                                       04760000
* THE DIRECT ACCESS DEVICE TABLE OVERLAY APPLIES TO THE ENTRY BASED ON  04780000
* REGISTER RD.                                                          04800000
*                                                                       04820000
*CALCULATE THE MAXIMUM NUMBER OF RECORD SEGMENTS REQUIRED TO WRITE THE  04840000
* SPECIFIED BLOCKSIZE. APPLIES TO BSAM AND QSAM.                        04860000
*                                                                       04880000
*                                                                       04900037
         SR    RE,RE                                                    04907037
         LH    RF,DCBBLKSI              GET BLOCKSIZE FROM DCB.         04914037
*                                                                       04921037
* CALCULATE MAXIMUM TRACK CAPACITY BY SUBTRACTING OUT OVERHEAD @ZA29383 04928037
*                                                                       04935037
         LH    RJ,TRKCAP          GET TRACK CAP. FROM DEV TABLE.        04942037
         SR    RB,RB              CLEAR REGISTER               @ZA29383 04949037
         IC    RB,OVERK           GET KEY OVERHEAD             @ZA29383 04956037
         AR    RJ,RB              ADD KEY OVERHD TO TRKCAP     @ZA29383 04963037
         IC    RB,OVERL           GET LAST BLOCK OVERHEAD      @ZA29383 04970037
         TM    DEVFLAG,TBOVHD     IS THIS 2 BYTE OVERHEAD?     @ZA29383 04977037
         BNO   MZ0050             BRANCH IF NO                 @ZA29383 04984037
         LH    RB,OVERI           GET 2 BYTE OVERHEAD          @ZA29383 04991037
MZ0050   EQU   *                                                        04998037
         SR    RJ,RB              SUBTRACT LAST BLOCK OVERHD   @ZA29383 05005037
*                                                                       05020000
* DEVICE TABLE ADDRESSABILITY MAY BE RELINQUISHED                       05040000
*                                                                       05060000
         DROP  RD                                                       05080000
*                                                                       05100000
* DIVIDE BLOCKSIZE BY TRACK CAPACITY.                                   05106037
* REGS RE/RF MUST BE EVEN/ODD PAIR.                                     05112037
*                                                                       05120000
         DR    RE,RJ                    BLOCKSIZE/TRACK-CAPACITY.       05140000
*                                       RF = QUOTIENT.                  05160000
*                                       RE = REMAINDER                  05180000
*                                                                       05200000
* IF REMAINDER IS GREATER THAN 1, ROUND UP THE QUOTIENT.  QUOTIENT      05220000
* VALUE WILL BE ONE LESS THAN MAXIMUM NUMBER OF RECORD SEGMENTS REQ'D.  05240000
*                                                                       05260000
         CH    RE,ONE                   REMAINDER GREATER THAN ONE.     05280000
         BNH   GETCORE                  NO. BRANCH AROUND THE ROUND-UP. 05300000
*                                                                       05320000
         LA    RF,1(RF)                 ROUND UP THE QUOTIENT.          05340000
*                                                                       05360000
GETCORE  EQU   *                                                        05380000
*                                                                       05400000
         LA    RCPSIZE,1(RF)            RF+1 = MAX NMBR OF SEGMENTS.    05420000
*                                                                       05440000
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=GETCPSIZ                      05460000
*                                                                       05480000
         LA    RCPSIZE,1(RCPSIZE)       ADJUST FOR WRT CHECK SEGMENT.   05500000
*                                                                       05520000
GETCPSIZ EQU   *                                                        05540000
*                                                                       05560000
* RCPSIZE CONTAINS THE MAX NUMBER OF RECORD SEGMENTS, ADJUSTED FOR WRT  05580000
* CHECK OPTION. THIS NUMBER OF CHANNEL PROGRAM SEGMENTS WILL BE BUILT.  05600000
* THE  METHOD WORKS SO LONG AS ALL CHANNEL PROGRAM SEGMENTS ARE EQUAL   05620000
* LENGTHS.                                                              05640000
* RF, THE UNADJUSTED VALUE, IS KEPT FOR USE IN CALCULATING S.A. AND     05660000
* COUNT FIELD CORE SIZE.                                                05680000
*                                                                       05700000
* COMPUTE THE AMOUNT OF CORE (EXPRESSED IN DOUBLE WORDS) NEEDED FOR     05720000
* THE CHANNEL PROGRAM SEGMENTS (FOR ONE IOB).  DONE BY-                 05740000
* (SEGMENT SIZE) TIMES (NMBR OF SEGMENTS) DIVIDED BY 8. SINCE SEGMENT   05760000
* SIZE IS A MULTIPLE OF 8 (4 CCW'S = 32 BYTES) IT SIMPLIFIES TO         05780000
* 32/8 TIMES (NMBR OF SEGMENTS)= SHIFT NMBR OF SEGMENTS LEFT 2 PLACES.  05800000
         SLA   RCPSIZE,2                WRITE CP LENGTH (DBL WDS).      05820000
         LA    RJ,IOBSIZE               STARTING POINT FOR BUILDING     05860000
*                                       VARIOUS OFFSETS                 05880000
         STC   RJ,DCBWCPO               PUT OFFSET IN DCB        S20201 05881020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 05882020
*                                       READY                    S20201 05883020
         BO    NOTRR2A                  BRANCH IF NO             S20201 05884020
         LA    RJ,EIGHT(RJ)             INCREMENT OFFSET PTR     S20201 05885020
         LA    RCPSIZE,D2(RCPSIZE)      INCR IOB SIZE            S20201 05886020
         TM    DCBOPTCD,VALCHK          RCD READY AND VALIDITY   S20201 05887020
*                                       CHK                      S20201 05888020
         BZ    NOTRR2A                  BRANCH IF NO             S20201 05889020
         LA    RCPSIZE,D1(RCPSIZE)      INCR FOR FEAT IN VAL CHK S20201 05890020
NOTRR2A  EQU   *                                                 S20201 05891020
         STC   RCPSIZE,DCBWCPL          PUT LENGTH IN DCB        S20201 05892020
         IF    DEBOPATB,IS=OUTPUT,GOTO=OUTONLY                          05900000
* OPENED FOR IN/OUT OR OUT/IN.                                          05920000
*                                                                       05940000
         MVI   DCBCNTRL+3,EGP2          EOB ID FOR NON-F INPUT.         05960000
         MVI   DCBCNTRL+2,EPDT          EOB ID FOR T.O. OUTPUT.         05980000
         LA    RJ,OFFSR(RJ)             CCW THAT RECEIVES BLOCK LENGTH. 06000000
         STC   RJ,DCBOFFSR              SAVE IT.                        06020000
         LA    RJ,REMNANT(RJ)           MOVE POINTER (RJ) TO WCP.       06040000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06043020
*                                       READY                    S20201 06046020
         BO    NOTRR2C                  BRANCH IF NO             S20201 06049020
         LA    RJ,EIGHT(RJ)             INCR OFFSET PTR          S20201 06052020
NOTRR2C  EQU   *                                                 S20201 06055020
         STC   RJ,DCBWCPO               SAVE IT.                        06060000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06062020
*                                       READY                    S20201 06064020
         BO    NOTRR2G                  BRANCH IF NO             S20201 06066020
         LA    RJ,EIGHT(RJ)             INCR OFFSET PTR          S20201 06068020
         LA    RCPSIZE,D2(RCPSIZE)      INCR IOB SIZE            S20201 06070020
NOTRR2G  EQU   *                                                 S20201 06072020
         LA    RJ,OFFSW(RJ)             CCW THAT RECEIVES BLOCK LENGTH. 06080000
         LA    RCPSIZE,RCPDBLWD(RCPSIZE) ADD NMBR OF CCW'S IN RCP.      06100000
         B     STOREWRT                                                 06120000
OUTONLY  EQU   *                                                        06140000
         MVI   DCBCNTRL+3,EPDT          TRK OVFLO OUTPUT EOB ID.        06160000
         LA    RJ,OFFSW(RJ)             CCW THAT RECEIVES BLOCK LENGTH. 06200000
         STC   RJ,DCBOFFSR              BYPASSED IF RCP PRESENT.        06220000
STOREWRT STC   RJ,DCBOFFSW                                              06240000
         LA    RCPSIZE,IOBDBLWD(RCPSIZE) ADD NMBR OF DBL WDS IN IOB.    06260000
* RCPSIZE HAS IOBL/8+WCPL/8+(READCPL/8 IF REQ'D).                       06280000
* SEARCH ADDRESSES (S.A.) AND COUNT FIELDS ARE 8 BYTES EACH. THERE IS   06300000
* ONE S.A. AND COUNT FIELD FOR EACH C.P. SEGMENT EXCEPT THE FIRST,      06320000
* WHOSE S.A. IS THE IOB FDAD.                                           06340000
* CALCULATE CORESIZE FOR S.A.'S AND COUNT FIELDS AS FOLLOWS-            06360000
*   CALL THE VALUE IN REG RF 'N'. (MAX NMBR OF SEGMENTS MINUS 1)        06380000
*   THERE ARE 2N+1 S.A.'S & COUNT FIELDS (NONE REQ'D FOR VAL CHK).      06400000
*   BUILD THE CORESIZE VALUE IN REG 1 (=RF)                             06420000
*                                                                       06440000
         SLA   RF,1                     MULTIPLY BY 2 = 2N.             06460000
         LA    RF,1(RF)                 ADD 1 GIVES 2N+1                06480000
* ADD THE IOB LENGTH AND CP SIZE (IN DBL WDS) TO THE NUMBER OF S.A.'S   06500000
* AND COUNT FIELDS.                                                     06520000
*                                                                       06540000
         AR    RF,RCPSIZE               (IOB+CP)/8+(2N+1)               06560000
*                                       RE IS FREED.                    06580000
* MULITPLICATION BY 8 EXPRESSES THE IOB/CP SIZE IN BYTES, AND           06600000
* MULTIPLIES THE THE NMBR OF S.A.'S AND COUNT FIELDS BY THEIR SIZE.     06620000
*                                                                       06640000
         B     TIMES8                                                   06660000
RCPONLY  EQU   *                                                        06680000
         MVI   DCBCNTRL+3,EGP2          EOB ID FOR NON-F INPUT.         06700000
* FILL IN DCB FIELDS REQ'D FOR READING ONLY.                            06720000
* DCBOFFSR  (SET DCBOFFSW THE SAME).                                    06740000
* DCBIOBL                                                               06760000
         MVI   DCBOFFSR,IOBSIZE+OFFSR   PUT OFFSET IN DCB        S20201 06800020
         LA    RF,IOBDBLWD+RCPDBLWD     GET NMBR OF DBL WD FOR IOB+CP.  06840000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06842020
*                                       READY                    S20201 06844020
         BO    NOTRR2K                  BRANCH IF NO             S20201 06846020
         LA    RF,D2(RF)                INCR IOB DW SIZE         S20201 06848020
         MVI   DCBOFFSR,IOBSIZE+OFFSR+EIGHT  PUT NEW OFFSET IN   S20201 06850020
*                                       IOB                      S20201 06852020
NOTRR2K  EQU   *                                                 S20201 06854020
TIMES8   EQU   *                                                 S20201 06855020
         TM    DEBOPATB,OUTPUT          IF OUT ONLY THEN         S20201 06856020
         BO    NOSDIR                   DONT INCR OFFSETS        S20201 06857020
         TM    JFCBMASK+D6,SDFLG        IS SCH DIR SPECIFIED     S20201 06858020
         BZ    NODIRECT                 IF NOT, DONT INCR FOR 2  S20201 06859020
*                                       DOUBLE WORDS                    06860020
         LA    RF,D2(RF)                NEED TWO MORE CCWS       S20201 06861020
         SR    RE,RE                    CLEAR REGISTER           S20201 06862020
         IC    RE,DCBOFFSR              GET READ OFFSET          S20201 06863020
         SH    RE,CON8                  BACK UP A DW             S20201 06864020
         STC   RE,DCBOFFSR              RETURN TO DCB            S20201 06865020
         IC    RE,DCBWCPO               FOR INOUT OT OUTIN (INPU S20201 06866020
         AH    RE,SDINCR16              T ONLY DOESNT MATTER) PT S20201 06867020
         STC   RE,DCBWCPO               TO WRT CP MUST BE INCR   S20201 06868020
*                                       OVER THE 2 DWS SET ASIDE        06869020
*                                       FOR THE S.D. FEATURE.           06870020
*                                       THEY FOLLOW THE RD C.P.         06871020
         IC    RE,DCBOFFSW                  INCREMENT THE OFFSET S20201 06872020
         AH    RE,SDINCR16              TO THE WRITE CHANNEL PGM S20201 06873020
         STC   RE,DCBOFFSW              IF SEARCH DIRECT IS USED S20201 06874020
NOSDIR   EQU   *                                                 S20201 06875020
NODIRECT EQU   *                                                 S20201 06876020
         SR    RE,RE                    REMOVE GARBAGE           S20201 06877020
         STC   RF,DCBIOBL               PUT IOB LENGTH IN DCB    S20201 06878020
         SLL   RF,THREE                 MULTIPLY BY EIGHT        S20201 06880020
         IC    RE,DCBNCP                GET IOB COUNT            S20201 06882020
         TM    DCBCIND2,QSAM            QSAM USED                S20201 06884020
*                                                                       06886020
         BZ    MULT                     BRANCH IF YES            S20201 06888020
         IC    RE,DCBBUFNO              GET CONT FROM BUFR NO    S20201 06890020
MULT     EQU   *                                                 S20201 06892020
         LTR   RE,RE                    IOB CNT SPECIFIED        S20201 06894020
         BP    SPECIF                   BRANCH IF YES            S20201 06896020
         LA    RE,D1                    OTHERWISE FURNISH ONE    S20201 06898020
SPECIF   EQU   *                                                 S20201 06900020
         LR    RIOB,RE                 SAVE NO IOB'S             A37507 06901021
         MR    RE,RE                    MULTIPLY IOB CNT TIMES   S20201 06902020
*                                       NO                       S20201 06904020
*                                                                       06906020
* CHECK FOR RCD READY AND IF USED GET DW FOR THETA VALUES               06908020
*                                                                       06910020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06912020
*                                       READY                    S20201 06914020
         BO    NORRM                    BRANCH IF YES            S20201 06916020
         LA    RF,EIGHT(RF)             INCR SIZE FOR RCD READY  S20201 06918020
NORRM    EQU   *                                                 S20201 06920020
         LR    RC,RF                    SAVE AMT FOR CLEARING    S20201 06922020
         DROP  RDEB                                              Y02072 06922102
*                                                                       06922402
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE IOBS YM4697 06922802
*  IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE EXECUTOR.  YM4697 06923202
*                                                                       06923602
         ST    RF,DXATEXC2              SAVE LENGTH              YM4697 06923702
*                                                                       06924020
* GET MAIN FOR IOBS,  RF=RC=AMOUNT                                      06926020
*                                                                       06928020
         MODESET  KEYADDR=DXUKEY,WORKREG=12 GET INTO USER KEY    Y02072 06928402
         GETMAIN R,LV=(RF),SP=0                                  Y02072 06930002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06930402
         ST    RF,DCBIOBA               PUT FIRST IOB ADDR IN    S20201 06932020
*                                       DCB                      S20201 06934020
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 06936102
         MODESET  KEYADDR=DXUKEY,WORKREG=12 GET INTO USER KEY    Y02072 06940202
         USING DEB,RDEB                                          Y02072 06942302
         LR    RB,RF                    COPY ADDR USE TO CLR     S20201 06944402
*                                                                       06946502
* CLEAR OF RECEIVED CORE    RB=ADDRESS,  RC=AMOUNT                      06948602
*                                                                       06950702
         LR    RJ,RC                    COPY AMOUNT              S20201 06952802
         LA    RD,MAX                   CONSTANT OF 256          S20201 06954902
         B     CLEAR                    BRANCH                   S20201 06957002
SOP1SLO  XC    D0(D1,RB),D0(RB)         CLEARS REMAINING BYTES   S20201 06959102
SOP1SHI  XC    D0(MAX,RB),D0(RB)        CLEARS 256 BYTES         S20201 06961202
         AR    RB,RD                    ADD 256 TO ADDR          S20201 06963302
CLEAR    SR    RC,RD                    SUB 256 FROM AMT         S20201 06965402
         BH    SOP1SHI                  IF AMT GT 256 BRANCH     S20201 06967502
         AR    RC,RD                    CORRECT AMT              S20201 06969602
         BCTR  RC,RE                    REDUCE BY ONE BYTE, RE=0 S20201 06971702
         EX    RC,SOP1SLO               CLEAR REMAING BYTES      S20201 06973802
*                                                                       06975902
* SET UP THETA ADDRS, MAY BE USED LATER                                 06978002
*                                                                       06980102
         AR    RJ,RF                    GET AREA + 1 ADDR        S20201 06982202
         LA    RD,EIGHT                 CONSTANT OF EIGHT        S20201 06984302
         SR    RJ,RD                    BACKUP ONE DW            S20201 06986402
         CH    RIOB,ONE                ONE IOB?                  A37507 06988502
         BNE   NTONEIOB                NO - BRANCH               A37507 06990602
         USING SAMSIOB,RF              ADDRESSABILITY FOR DSECT  A37507 06992702
         OI    IOBFLAG1,UNRELFLG       YES - TURN ON IOB         A37507 06994802
*                                       UNRELATED FLG            A37507 06996902
         DROP  RF                                                A37507 06999002
NTONEIOB EQU   *                                                 A37507 07001102
*                                                                       07003202
* WTG LOGIC GOES HERE                                                   07005302
*                                                                       07007402
STOPSOP6 EQU   *                                                 S20201 07009502
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07011602
         DROP  RDEB                                              S20201 07013702
         ST    RJ,DXCCW11               SAVE SECTOR ADDRESS      Y02072 07015802
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESSABILITY.   07017902
         USING FORCORE,RCORE                                     Y02072 07020002
         USING WTGENTRY,RWTGC                                    Y02072 07030002
         MVC   WTGIDTTR,NEXTEXEC        GET NEXT EXEC ID.      @Z30TSCF 07032003
         TM    JFCBMASK+D6,SDFLG        IF SCH DIRECT IS NOT     S20201 07048020
         BZ    NODERECT                  SPECIFIED OR IF DCB IS  S20201 07052020
         TM    DEBOPATB,OUTPUT           OPENED FOR OUTPUT ONLY, S20201 07056020
         BO    NODERECT                  THEN GO XCTL TO MODULE  S20201 07060020
*                                       IGG0191H, ELSE TO MOD           07064020
*                                        IGG0199K                       07068020
         MVC   WTGIDTTR,SDEXEC          SEARCH DIRECT EXEC     @Z30TSCF 07070003
NODERECT EQU   *                                                 S20201 07076020
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY.    07080000
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY PTR 07100000
         CLC   0(2,RWTGC),AMIDCNST      IS THIS RTN NEEDED AGAIN?       07120000
         BCR   8,RBASE                                                  07140000
*                                                                       07160000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE?                   07180000
         BC    7,RELOOP                 NO, CHECK NEXT ENTRY.           07200000
*                                                                       07220000
         LR    RPARC,RPAR                                               07240000
         LA    RWTGC,WAOFF(0,RWTG)      REINIT. WTG LIST PTR.           07260000
ZCHEK    CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETE?         07280000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL.        07300000
*                                                                       07320000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY.                 07340000
         LA    RPARC,PLOFF(0,RPARC)                                     07360000
         BC    15,ZCHEK                                                 07380000
*                                                                       07400000
TCTLRTN  EQU   *                                                        07420000
         USING WTG,RWTG                                                 07470003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*07520003
               MODID=WTGENTRY                                  @Z30TSCF 07570003
         DROP  RWTGC,RWTG                                      @Z30TSCF 07572003
*                                                                       07580000
* END WTG LOGIC. *****                                                  07600000
*                                                                       07620000
ONE      DC    H'1'                     G.P. CONSTANT.                  07640000
*                                                                       07660000
*                                                                       07680000
* WTG CONSTANTS AND EQUATES.                                            07700000
*                                                                       07720000
WAOFF    EQU   32                                                       07740000
PLOFF    EQU   4                                                        07760000
WGOFF    EQU   8                                                        07780000
OPIDCNST  DC   C'0S'                                                    07800000
AMIDCNST DC    C'1S'                    IDTTRL                          07820000
*                                                                       07840000
* END WTG CONSTANTS.                                                    07860000
*                                                                       07880000
CON8     DC    H'8'                     CONSTANT OF EIGHT        S20201 07886020
SDINCR16 DC    H'16'                    TWO DWS FOR S.D. COUNT   S20201 07892020
*                                         FIELD INCREMENT               07898020
SDEXEC   DC    C'9K',VL3(IGG0199K)     SEARCH DIRECT EXECUTOR  @Z30TSCF 07908003
NEXTEXEC DC    C'1H',VL3(IGG0191H)      NON-SEARCH DIRECT      @Z30TSCF 07918003
         SPACE 2                                                        07928002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 07938002
END      EQU   *                        END OF MODULE            Y02707 07940002
         EJECT                                                          07948002
*                                                                       08020000
* READ CHANNEL PROGRAM OVERLAY.  CCW FIELDS ARE ACCESSED BY ABSOLUTE    08040000
* OFFSETS FROM THE CCW NAME.                                            08060000
*                                                                       08080000
RCPOVLAY DSECT                                                          08100000
*        SEARCH (CCWA)                                                  08120000
SRCHCCW  DS    D                                                        08140000
*        TIC    (CCWB)                                                  08160000
TICCCW   DS    D                                                        08180000
*        READ DATA WITH SKIP  (CCWC)                                    08200000
SKIPCCW  DS    D                                                        08220000
*        READ COUNT (CCWD)                                              08240000
RDCTCCW  DS    D                                                        08260000
*        READ DATA (CCWE)                                               08280000
RDCCW    DS    D                                                        08300000
*        READ KEY AND DATA (ALTERNATE CCWE)                             08320000
RKDCCW   EQU   RDCCW                                                    08340000
* END READ CP CCW DEFINITION                                            08360000
* FOLLOWING IS A MAP OF A WRITE CHANNEL PROGRAM (WCP) SEGMENT.          08380000
*                                                                       08400000
WCPMAP   DSECT                                                          08420000
*                                                                       08440000
*        SEARCH  (CCW1 OR 5)                                            08460000
*                                                                       08480000
SRCHADDR DS    F                                                        08500000
SRCHOPCD EQU   SRCHADDR                 OP CODE IS HI ORDER BYTE.       08520000
SRCHFLAG DS    XL1                                                      08540000
         DS    CL2                                                      08560000
SRCHLEN  DS    XL1                      LENGTHS NORMALLY FIT IN 1 BYTE. 08580000
*                                                                       08600000
*        TIC   (CCW2 OR 6)                                              08620000
*                                                                       08640000
TICADDR  DS    F                                                        08660000
TICOPCD  EQU   TICADDR                                                  08680000
UNUSED   DS    F                        ONLY REQUIRES BITS 37-39 = 0.   08700000
PARASITE EQU   UNUSED                   MAY BE USED TO STORE AN ADDRESS 08720000
*                                       BUT THE ABOVE RESTRICTION       08740000
*                                       LIMITS THE OP CODES THAT MAY    08760000
*                                       BE STORED IN THE HI BYTE.       08780000
*                                                                       08800000
*        WRITE  (CCW3)                                                  08820000
*                                                                       08840000
COUNTADR DS    F                        COUNT FIELD ADDRESS.            08860000
WRTOPCD  EQU   COUNTADR                                                 08880000
WRTFLAG  DS    XL1                      FLAG FIELD.                     08900000
         DS    CL2                      SPACER.                         08920000
COUNTLEN DS    XL1                      COUNT FIELD LENGTH (NORMALLY 8) 08940000
*                                                                       08960000
*        NULL OP CODE  (CCW4)           OP PROPAGATED FROM WRITE CCW.   08980000
*                                                                       09000000
DATAADDR DS    F                        ADDRESS OF BLOCK OF DATA TO BE  09020000
*                                       WRITTEN.                        09040000
NULLOPCD EQU   DATAADDR                 USED AS A FLAG TO SIGNAL LAST   09060000
*                                       SEGMENT.                        09080000
NULLFLAG DS    XL1                                                      09100000
         DS    XL1                      SPACER.                         09120000
DATALEN  DS    H                        2 BYTES HOLDS DATA LENGTH.      09140000
*                                                                       09160000
*                                                                       09180000
* FOLLOWING IS THE VALIDITY CHECK CHANNEL PROGRAM OVERLAY.              09200000
*                                                                       09220000
VCMAP    DSECT                                                          09240000
*        SEEK  (CCW7)                                                   09260000
SEEKADDR DS    F                                                        09280000
SEEKOPCD EQU   SEEKADDR                                                 09300000
SEEKFLAG DS    XL1                                                      09320000
         DS    CL2                                                      09340000
SEEKLEN  DS    XL1                                                      09360000
*                                                                       09380000
*        SEARCH (CCW8)                  LABELS PREFIXED BY 'VC' (VAL    09400000
VCSRCH   EQU   *                        CHECK).                         09420000
VCSRCHAD DS    F                                                        09440000
VCSRCHOP EQU   VCSRCHAD                                                 09460000
VCSRCHFL DS    XL1                      FLAGS.                          09480000
         DS    CL2                                                      09500000
VCSRCHLE DS    XL1                      LENGTH.                         09520000
*                                                                       09540000
*        TIC   (CCW9)                                                   09560000
VCTICAD  DS    F                                                        09580000
VCTICOP  EQU   VCTICAD                                                  09600000
NOTUSED  DS    F                                                        09620000
*                                                                       09640000
*        READ DATA (CCW10)                                              09660000
VCRDAD   DS    F                                                        09680000
VCRDOP   EQU   VCRDAD                                                   09700000
VCRDFLAG DS    XL1                      NORMALLY SKIP.                  09720000
VCRDLEN  DS    FL3                                                      09740000
*                                                                       09760000
* FOLLOWING IS AN OVERLAY OF THE COUNT FIELD.                           09780000
*                                                                       09800000
COUNTFLD DSECT                                                          09820000
*                                                                       09840000
CYLINDER DS    H                        CYLINDER ADDRESS (CC).          09860000
HEAD     DS    H                        HEAD ADDRESS     (HH).          09880000
RECORD   DS    XL1                      RECORD NUMBER    (R).           09900000
KEYLENTH DS    XL1                      KEY LENGTH       (KL).          09920000
DLDL     DS    H                        DATA LENGTH      (DLDL).        09940000
*                                                                       09960000
* END COUNT FIELD. (CCHHRKDD)                                           09980000
*                                                                       10000000
*                                                                       10020000
* DIRECT ACCESS DEVICE TABLE OVERLAY                                    10040000
*                                                                       10060000
DEVTAB   DSECT                                                          10080000
DEVSIZE  DS    F                       MAX SIZ FOR DEVICE.              10100000
TRKCAP   DS    H                       TRACK CAPACITY.                  10120000
OVERI    DS    XL1                     OVERHEAD FOR NOT-LAST RECORD.    10140000
OVERL    DS    XL1                     OVERHEAD FOR LAST RECORD.        10160000
OVERK    DS    XL1                     OVERHEAD REDUCTION FOR NON-KEY   10180000
*                                      RECORDS.                         10200000
DEVFLAG  DS    XL1                                                      10220000
TOLER    DS    H                       TOLERANCE/512 USED FOR VARIABLE  10240000
*                                       GAP LENGTH CALCULATIONS.        10260000
* END DEVTAB OVERLAY.                                                   10280000
*                                                                       10300000
*                                                                       10320000
         DCBD  DSORG=PS                                                 10340000
*                                                                       10360000
*                                                                       10380000
*                                                                       10400000
*                                                                       10420000
         EJECT                                                          10430003
CVT      DSECT                                                 @Z30TSCF 10440003
         CVT                                                   @Z30TSCF 10450003
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 10470003
         ORG   WTGIDTTR                                          Y02072 10472002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 10474002
         EJECT                                                          10476002
FORCORE  DSECT                                                   Y02072 10478002
         IHAFCAUD  ORG=YES                                       Y02072 10478402
         EJECT                                                          10478802
*                                                                       10480000
* IOB OVERLAY                                                           10500000
* THE FORECORE DSECT IOB OVERLAY IS USED WITH THE FOLOWING ADDITIONS-   10520000
*                                                                       10540000
* BSAM/BPAM/QSAM IOB EXTENSION-                                         10560000
SAMSIOB  EQU   DXIOB-8                  START OF SAM'S IOB.             10580000
LINK     EQU   SAMSIOB                  FORWARD CHAIN FIELD (TO NEXT    10600000
*                                       IOB).                           10620000
FLAG     EQU   LINK                     HI BYTE OF LINK USED AS FLAG.   10640000
ECB      EQU   DXIOB-4                                                  10660000
* END EXTENSION DEFINITIONS                                             10680000
*                                                                       10700000
IOBSEEK EQU DXDAADDR                                                    10720000
CHANPGM  EQU   DXDAADDR+8               START OF CHANNEL PROGRAM.       10740000
*                                       LENGTH MAY VARY.                10760000
* END IOB DEFINITIONS.                                                  10780000
*                                                                       10800000
DEB      EQU   DXDEB                                                    10820000
DEBOPATB EQU   DXDEBSYS                                                 10840000
         END                                                            10860000
./  ADD  SSI=43081080,NAME=IGG0191T
         TITLE 'IGG0191T - UCS LOAD,FCB PATH DETERMINER'         M0191  00100021
IGG0191T CSECT                                                          00102021
*                                                                       00180001
*MODULE NAME - IGG0191T                                          Y02072 00230002
*                                                                       00280002
*DESCRIPTIVE NAME - UCSB/FCB PATH DETERMINER                     Y02072 00330002
*                                                                       00380002
*COPYRIGHT - NONE                                                Y02072 00430002
*                                                                       00480002
*CHANGE ACTIVITY - AS FOLLOWS                                    Y02072 00490002
*          RELEASE 19 DELETIONS                                         00500000
*                                                                M4179  00550019
*          RELEASE 20 DELETIONS                                         00600000
*1355183000,186000,188000,344600-346200                          A33665 00650020
*1355020000-023000,027000-028000,041000,045000-048000,052000,    S20202 00660020
*1355242000,302000-306000,322000,328000,350000-358000,415000-    S20202 00670020
*1355418000,431000,455000-531000,536000,552000,708000,714000-    S20202 00680020
*1355717000                                                      S20202 00690020
*1355255000                                                      M5143  00695020
*          RELEASE 21 DELETIONS                                         00700000
*0791276005-276015,287600,566360                                 M0151  00701021
*0791046400,141001-141002,566480-56662                           M1830  00702021
*0791552080-552110,552140-552200,552260-552290,552320-552350,    M0009  00710021
*0791552380-552410                                               M0009  00720021
*0791                                                            S21092 00750021
*0791                                                             M0191 00760021
*0791001200,001400,001500,004000,004500,004600,004700,004800,    A50376 00768021
*0791008000,009000,010000,011000,012000,113200,622050,708000,    A50376 00776021
*0791709000,710000,711000,712000,713000,713800,714600,715400,    A50376 00784021
*0791716200,717000,718000,719000,720000                          A50376 00792021
*                                                                       01100021
*        VS2    RELEASE 01 DELETIONS                                    01112001
*552440,552470                                                   YM3213 01122001
*                                                                       01124002
*        VS2 RELEASE 02 DELETIONS                                       01126002
*001010,011100,011320,012000,058000,113200-113600,158000,169500, Y02072 01128002
*170500-171000,219300-219500,276415-276430,341000-343800,        Y02072 01130002
*356000-361000,579000,606070-606980,622050-622600,693000-697600, Y02072 01130402
*699500,707600,733000-734000,746000,747000,748000-785100,785200  Y02072 01130802
*063000,641000,673000,677000,580000,692000                       Y02072 01131202
*                                                                YM4697 01131602
*D238000-241000                                                  YM6054 01131702
*                                                                YM7889 01131802
*                                                                       01131903
*        VS2 RELEASE 3 DELETIONS                                        01154603
*                                                              @Z30TSCF 01164603
*                                                                       01177303
*STATUS CHANGE LEVEL 009                                                01200002
*                                                                       01300000
*FUNCTION/OPERATION - EXECUTE BLOCK DATA CHECK OR RESET BLOCK DATA      01400000
*                     CHECK                                             01500000
*                                                                       01550002
*                   - LOAD MSG CSECT FOR WTO'S/WTOR'S            Y02072 01600002
*                                                                       01650002
*                   - FOR PRINTERS WITH UCS:                     Y02072 01700002
*                     1) ISSUE IEC123D TO REQUEST OPERATOR TO    Y02072 01750002
*                        TO SPECIFY A UCS IMAGE TO BE USED IF    Y02072 01800002
*                        UCS IS NOT SPECIFIED IN THE DD CARD AND Y02072 01850002
*                        CURRENT IMAGE IS NOT A DEFAULT OR NO    Y02072 01900002
*                        IMAGE IS CURRENTLY LOADED.              Y02072 01910002
*                     2) SET SWITCHES TO INDICATE TO SUBSEQUENT  Y02072 02100002
*                        OPEN EXECUTORS WHAT WORK IS TO BE DONE  Y02072 02150002
*                   - FOR PRINTERS WITH FCB'S BUT NOT UCSB'S:    Y02072 02200002
*                     1) ISSUE IEC129D TO REQUEST OPERATOR TO    Y02072 02250002
*                        SPECIFY AN FCB IMAGE TO BE USED IF A    Y02072 02252002
*                        FCB IMAGE IS NOT SPECIFIED IN THE DD    Y02072 02254002
*                        CARD OR THE CURRENT IMAGE IS NOT A      Y02072 02256002
*                        DEFAULT.                                Y02072 02258002
*                   - FOR PRINTERS WITH FCB'S AND UCSB'S:        Y02072 02258402
*                     1) SET SWITCHES TO INDICATE TO SUBSEQUENT  Y02072 02258802
*                        OPEN EXECUTORS WHAT WORK IS TO BE DONE  Y02072 02259202
*                                                                       02260020
*                   _ ISSUES SVC 105 TO BUILD A DCB AND DEB FOR         02290002
*                     SYS1.IMGLIB AND SETS AN AUDIT TRAIL BIT    YM4697 02320002
*                     INDICATING TO FORCE CLOSE THAT             YM4697 02400002
*                     SYS1.IMAGELIB HAS BEEN OPENED              YM4697 02450002
*                                                                       02470002
*ENTRY POINT - ENTERED FROM THE FOLLOWING EXECUTORS BY USE OF THE XCTL  02500000
*              MACRO                                                    02600000
*              *FROM IGG0196A IF DCB IS EXCP THAT'S BEING OPENED TO     02660020
*               A 1403 WITH UCS OR A 3211 PRINTER                       02720020
*              *FROM IGG0196B IF DCB IS BEING OPENED TO A 1403 WITH     02780020
*               UCS OR 3211 PRINTER                                     02840020
*              *FROM 6A OR 6B IF A 2245 PRINTER.                        02870021
*                                                                       02900000
*INPUT - DCB ADDRESS                                                    03000000
*      - OPEN WORK AREA ADDRESS                                         03100000
*      - WHERE-TO-GO TABLE                                              03200000
*      - PARAMETER LIST                                                 03300000
*      - CURRENT ENTRY IN W-T-G TABLE                                   03400000
*      - CURRENT PARAMETER(DCB)                                         03500000
*                                                                       03600000
*OUTPUT - IF NO UCS IMAGE IS SPECIFIED AND THE UCS IMAGE LOADED BY      03700000
*         PREVIOUS JOB STEP WAS NOT A DEFAULT IMAGE,THE MESSAGE         03800000
*         'IEC123D XXX SPECIFY UCS PARAMETER' IS DISPLAYED.             03900000
*       - IF A UCS IMAGE IS NOT TO BE LOADED, THE MESSAGE        Y02072 03930002
*         'IEC129D XXX,SPECIFY FCB PARAMETERS' IS DISPLAYED      Y02072 03940002
*                                                                       04000000
*EXTERNAL ROUTINES _ A SVC 105 IS ISSUED TO CONSTRUCT A DCB AND A DEB   04050020
*                    FOR SYS1.IMAGELIB SO A UCS AND/OR A FCB IMAGE      04100002
*                    CAN TO BE LOADED INTO CORE                         04150002
*                                                                       04152002
*EXTERNAL REFERENCES - MESSAGE CSECT FOR WTO/WTOR'S              Y02072 04154002
*                                                                       04200000
*EXIT - NORMAL - FOR PRINTERS WITH UCSB'S, XCTL TO IGG0191U      Y02072 04250002
*              - FOR PRINTERS WITHOUT UCSB'S, XCTL TO IGG0197E   Y02072 04260002
*              - FOR COMPOSIT CONSOLES, XCTL TO IGG0191V TO      Y02072 04310002
*                DETERMINE 2ND STAGE EXECUTOR.                   Y02072 04360002
*                                                                       05100000
*EXIT - ERROR - IF AN ERROR OCCURED WHILE DCB AND DEB FOR SYS1.IMGLIB   05150002
*               WERE BEING CONSTRUCTED AN ABEND RETURN CODE IS SET      05200020
*               AND AN EXIT IS MADE TO IGG0191V TO ABEND                05250020
*             - IF EXCP IS UNSUCCESSFUL WHEN TRYING TO SET LATCH Y02072 05260002
*               FOR BLK/UNBLK OF DATA CHECKS AN EXIT TO IGG0191V Y02072 05270002
*               IS MADE TO GET A WTP.                            Y02072 05272002
*                                                                       05280002
*MACROS-ACTION:MODESET, EXCP, WAIT, XCTL                         Y02072 05290002
*                                                                       05292002
*MACROS-MAPPING:IKJTCB, IEZDEB, IHAPSA, IEFUCBOB, IGGMSG,        Y02072 05294002
*              IECDSECS(MAIN,WTG), DCBD, IGGSCW, IHAFCAUD,       Y02072 05296002
*              IEECUCM                                           YM6054 05300002
*                                                                       05350002
*TABLES/WORK AREAS - WHERE-TO-GO TABLE (SEE LISTING OF EXECUTOR         05400000
*                                       IGG0191B)                       05500000
*                  - OPEN WORK AREA (SEE IECDSECT IN THIS LISTING)      05600000
*                                                                       05700000
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 05800002
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 05850002
*                                                                       05900000
*NOTES - EXCP/WAIT SVCS IS USED TO EXECUTE DATA CHECK COMMAND           06000000
*        DATA CHECK.                                                    06100000
*      - WTO/WTOR SVC IS USED TO REQUEST AN OPERATOR REPLY              06200000
*      - IOB/ECB IN OPEN WORK AREA IS USED FOR EXCP                     06400000
*      - IF THE PRINTER IS FOR A COMPOSITE CONSOLE,THE UCS SUPPORT IS   06500000
*        NOPED.                                                         06600000
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 06650002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 06660002
*                                                                       06700000
*********************************************************************** 06800000
*                                                                       06900000
         EJECT                                                          07000000
*                                                                       07100000
**********************************************************************  07200000
*                                                                       07300000
*   REGISTER CONVENTIONS USED THROUGH OUT OPEN EXECUTORS                07400000
*                                                                       07500000
**********************************************************************  07600000
*                                                                       07700000
RE       EQU   0                        WORK/PARAMETER REGISTER         07800000
R0       EQU   RE                       INPUT TO GETMAIN, FREEMN Y02072 07810002
RWK1     EQU   RE                       WORK REGISTER            Y02072 07850002
RF       EQU   1                        WORK/PARAMETER REGISTER         07900000
R1       EQU   RF                       INPUT TO EXCP, WAIT      Y02072 07910002
RWK2     EQU   RF                       WORK REGISTER            Y02072 07950002
RDCB     EQU   2                        ADDR OF USERS DCB               08000000
RBASE    EQU   3                        BASE REGISTER                   08100000
RCORE    EQU   4                        ADDR OF OPEN WORK AREA          08200000
RPAR     EQU   5                        PARAMETER LIST                  08300000
RWTG     EQU   6                        START OF WTG                    08400000
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 08500000
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      08600000
RTCB     EQU   9                        TCB ADDR/WORK REGISTER   Y02072 08700002
RWK3     EQU   RTCB                     WORK REGISTER            Y02072 08750002
RUCB     EQU   10                       UCB ADDR                        08800000
RDEB     EQU   11                       DEB ADDR                        08900000
RWK7     EQU   RDEB                     WORK REGISTER            Y02072 08950002
RB       EQU   12                       WORK AREA BASE REGISTER         09000000
RWK5     EQU   RB                       WORK REGISTER            Y02072 09050002
RC       EQU   13                       WORK REGISTER                   09100000
RWK6     EQU   RC                       WORK REGISTER            Y02072 09150002
RD       EQU   14                       WORK/PARAMETER REGISTER         09200000
RWK8     EQU   RD                       WORK REGISTER            Y02072 09250002
RJ       EQU   15                       WORK/PARAMETER REGISTER         09300000
RWK4     EQU   RJ                       WORK REGISTER            Y02072 09350002
R15      EQU   RJ                       RETURN CODE REGISTER     Y02072 09360002
*                                                                       09400000
*********************************************************************** 09500000
*                                                                       10500000
*   EQUATE WTG OFFSET                                                   10600000
*                                                                       10700000
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   10800000
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   10900000
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TBL  11000000
*                                                                       11100000
*   MASKS                                                               11200000
*                                                                       11300000
TWENTY   EQU   X'14'                    X'14'                           11400000
UNRLMASK EQU   X'02'                    IOB IS UNRELATED                11500000
SILIMASK EQU   X'20'                    SILI BIT IS ON                  11600000
ONE      EQU   X'01'                    X'01'                           11700000
BLOCKCCW EQU   X'73'                    COMMAND CODE = BLOCK DATA CHECK 11800000
UNBLKCCW EQU   X'7B'                    COMMAND CODE = UNBLK DATA CHECK 11900000
BLOCKMSK EQU   X'40'                    DCB OPTCD=U (X'40')             12000000
IEC120RQ EQU   X'40'                    IF ON, MSG IEC120 IS REQ Y02072 12092002
IEC123RQ EQU   X'80'                    IF ON, MSG IEC123 IS REQ Y02072 12096002
NULL     EQU   X'00'                    X'00'                           12100000
THREE    EQU   X'03'                    X'03'                           12200000
BLANK    EQU   X'40'                    X'40'                           12300000
ABENDBIT EQU   X'80'                    ABEND TERMINATION IN PROCESS    14100000
PRTM3211 EQU   X'09'                    MASK FOR 3211 PRINTER    S20202 14100320
SHIFTRHT EQU   X'02'                    FLAG USED TO SET FCB     S20202 14100520
*                                       OPTIONS                  S20202 14100620
SHIFTLFT EQU   X'06'                    FLAG USED TO SET FCB     S20202 14100720
*                                       OPTIONS                  S20202 14100820
IEC129RQ EQU   X'80'                    MESSAGE IEC129 REQ'D     S20202 14101102
IMCLOSED EQU   X'FF'                    FLAG SET FOR IMAGELIB    S20202 14102720
*                                       NOT OPENED               S20202 14102802
STAGE2   EQU   X'FF'                    TO INDIC TO 191V ENTRY   Y02072 14102902
*                                         TO FIND 2ND STG EXEC   Y02072 14103002
BUFPAR   EQU   X'01'                    UCSB BUFFER PARITY ERROR Y02072 14103102
DEFALT   EQU   X'80'                    IF ON IN IMAGE, IMAGE    Y02072 14103202
*                                         IS A DEFAULT           Y02072 14103302
ABEND    EQU   X'FF'                    INDICATES TO SUBSEQUENT  Y02072 14103402
*                                         LOADS ENTRY FOR ABEND  Y02072 14103502
*                                                                       14103602
*   EQUATES FOR CONSTANTS                                               14103702
*                                                                       14103802
K1       EQU   1                        CONSTANT EQUATED TO 1    S20202 14103902
K7       EQU   7                        CONSTANT EQUATED TO 7    S20202 14104002
K15      EQU   15                       CONSTANT EQUATED TO 15   S20202 14104420
PRT2245  EQU   X'0B'                    MASK FOR 2245 PRINTER    S21092 14107521
*                                                                  DM0Q 14110018
*    EQUATES FOR CONSTANTS                                         DM0Q 14120018
*                                                                  DM0Q 14130018
K4       EQU   4                                                   DM0Q 14140018
OABD095  EQU   95                       INTERNAL CODE 95         M0009  14170021
EXCPFAIL EQU   100                      INTERNAL CODE FOR EXCP   Y02072 14180002
*                                         FAILED                 Y02072 14190002
*                                                                       14190202
*  THE FOLLOWING MESSAGE NUMBERS ARE EQUAL TO THEIR POSITION     Y02072 14190402
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 14190802
*  OF AN INDEX)                                                  Y02072 14191202
*                                                                       14191602
MSG123   EQU   2*2                      MESSAGE NO IN MSG CSECT  Y02072 14192002
MSG129   EQU   3*2                      MESSAGE NO IN MSG CSECT  Y02072 14194002
*                                                                       14200000
*********************************************************************** 14300000
*                                                                       14400000
*                                                                       14500000
*********************************************************************** 14600000
*                                                                       14700000
*                                                                       14800000
*   INITIALIZE REGISTERS                                                14900000
*                                                                       15000000
*                                                                       15100000
*********************************************************************** 15200000
*                                                                       15300000
         BALR  RBASE,0                                                  15400000
         USING UCSTART,RBASE                                            15500000
         USING IHADCB,RDCB                                              15600000
         USING FORCORE,RCORE                                            15700000
         USING DEBBASIC,RDEB                                     Y02072 15800002
         USING UCBOB,RUCB                                               15900000
*                                                                       16100000
*********************************************************************** 16200000
*                                                                       16300000
UCSTART  EQU   *                                                        16400000
*                                                                       16500000
*********************************************************************** 16600000
*                                                                       16700000
         B     AROUND                   BR AROUND CONSTANTS      Y02072 16750002
         DC    C'IGG0191T'              MODULE NAME              Y02072 16760002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 16770003
         DC    C'10/10/74'              LAST DATE MODIFIED     @Z30TSCF 16780003
AROUND   DS    0H                                                Y02072 16790002
*                                                                       16792002
         L     RDCB,0(RPARC)            GET DCB ADDR                    16800000
         L     RCORE,4(RWTGC)           GET WORK AREA                   16900000
         L     RDEB,DCBDEBAD            GET DEB ADDR                    17000000
         L     RUCB,DEBSUCBA            GET UCB ADDR             Y02072 17100002
         DROP  RDEB                                              Y02072 17150002
*                                                                       17200000
*                                                                       17210020
*   SET FLAG TO INDICATE THAT DCB AND DEB FOR SYS1.IMAGELIB HAVE NOT    17220020
*   BEEN CONSTRUCTED                                                    17230020
*                                                                       17240020
         XC    DXFCBUCS,DXFCBUCS        CLEAR PARM LISTS         Y02072 17240402
         MVI   DXIMGDCB,IMCLOSED        MOVE IN FLAG FOR         Y02072 17242002
*                                       IMAGELIB CLOS            S20202 17260020
         MVC   DXEROPT,DXCCW6           SAVE DCB EROPT FIELD     Y02072 17262002
*                                                                       17270020
*********************************************************************** 17300000
*                                                                       17400000
WTORTN   EQU   *                                                        17500000
*                                                                       17600000
*********************************************************************** 17700000
*                                                                       17800000
*   INTIALIZE WTO/WTOR AREA IN OPEN WORK AREA                           17900000
*                                                                       18000000
*********************************************************************** 18100000
*                                                                       18200000
         LA    RD,RPLY                  LOAD REPLY ADDRESS       A33665 18300020
         ST    RD,REPLYLTH              STORE REPLY ADDR                18400000
         MVI   REPLYLTH,TWENTY          MOVE REPLY LENGTH=20            18500000
         LA    RD,RPLYECB               LOAD ADDR OF ECB FOR     A33665 18560020
*                                       WTOR                     A33665 18620020
         ST    RD,REPLYECB              STORE REPLY ECB ADDR            18700000
         MVC   LOMASK(8),LOWER          MOVE X'40'S TO WORK AREA A33665 18800020
*                                                                       18810021
*********************************************************************** 18820021
*                                                                       18830021
*    IS DEVICE A 2245 PRINTER                                           18840021
*                                                                       18850021
*********************************************************************** 18860021
*                                                                       18870021
         CLI   UCBTBYT4,PRT2245        IS DEVICE A 2245 PRINTER  S21092 18880021
         BE    SYSABEND                YES, CHECK FOR ABEND      S21092 18890021
*                                                                       18900000
*********************************************************************** 19000000
*                                                                       19100000
BLKDATA  EQU   *                                                        19200000
*                                                                       19300000
**********************************************************************  19400000
*                                                                       19500000
*   EXCP BLOCK/RESET BLOCK DATA CHECK ACCORDING TO DCB SPECIFICATION    19600000
*                                                                       19700000
*********************************************************************** 19800000
*                                                                       19900000
         MVI   IOBFLAG1,UNRLMASK        SET UNRELATED BIT ON            20000000
         XC    DXCCW1(8),DXCCW1         RESET CCW AREA                  20100000
         MVI   DXCCW1+4,SILIMASK        SET SILI FLAG ON                20200000
         MVI   DXCCW1+7,ONE             SET LENGTH=1                    20300000
         MVI   DXCCW1,BLOCKCCW          COMMAND CODE = BLOCK DATA CHECK 20400000
*                                                                 20961 20410018
*   TEST IF OPTCD IN DCB SPECIFIES UCS FEATURE                    20961 20420018
*                                                                 20961 20430018
         TM    DCBMACRF,X'80'           TEST IF DCB MACRF=E       20961 20440018
         BO    EXCPGOGO                 IF YES,GOTO EXCP RTN      20961 20450018
*                                                                 20961 20460018
*                                                                       20500000
*   TEST IF OPTCD IN DCB SPECIFIES RESET BLOCK DATA CHECK               20600000
*                                                                       20700000
         TM    DCBOPTCD,BLOCKMSK        TEST IF DCB OPTCD=U             20800000
         BC    14,EXCPGOGO              IF NOT,GOTO EXCP RTN            20900000
*                                                                       21000000
         MVI   DXCCW1,UNBLKCCW          IF YES,SET CCW= UNBLK DATA CHK  21100000
*                                                                       21200000
EXCPGOGO EQU   *                                                        21300000
*                                                                       21400000
         LA    RF,DXIOB                 LOAD IOB ADDR                   21500000
         EXCP  (1)                       EXCP ON DATA CHECK             21600000
*                                                                       21700000
         WAIT  ECB=DXECB                WAIT ON EXCP                    21900002
         TM    DXECB,X'20'              TEST FOR SUCCESSFUL I/O   8M226 21910018
         BO    CONSOLE                  BRANCH IF O.K.            8M226 21920018
         LA    RWK4,EXCPFAIL            INTERNAL CODE FOR PROB   Y02072 21970002
*                                         DETERMINATION          Y02072 21980002
         B     PDEXIT                   GO TO SET UP WTP         Y02072 21990002
*                                                                       22000000
*********************************************************************** 22100000
*                                                                       22200000
CONSOLE  EQU   *                                                        22300000
*                                                                       22400000
*********************************************************************** 22500000
*                                                                       22600000
*   THIS ROUTINE CHECKS IF THE OPEN IS FOR A COMPOSITE CONSOLE.IF YES,  22700002
*   XCTL TO A 2ND STAGE EXECUTOR BECAUSE ANY WTO/WTOR WILL PUT   YM6054 22800002
*   THE COMMUNICATIONS TASK INTO A WAIT STATE.                   YM6054 22850002
*                                                                       22900000
*********************************************************************** 23000000
*                                                                       23100000
         USING PSA,0                                             Y02072 23150002
         L     RTCB,PSATOLD             GET CURRENT TCB ADDR     Y02072 23200002
         USING TCB,RTCB                                          Y02072 23600002
         L     RWK6,CVTPTR              ADDR OF CVT              YM6054 23650002
         USING CVT,RWK6                                          YM6054 23700002
         L     RWK6,CVTCUCB             ADDR OF UCM              YM6054 23750002
         DROP  RWK6                                              YM6054 23800002
         USING UCM,RWK6                                          YM6054 23850002
         L     RWK6,UCMPXA              COMM TASKS TCB ADDR      YM6054 23900002
         CR    RWK6,RTCB                IS THIS COMM TASK        YM6054 23950002
         DROP  RWK6                                              YM6054 24000002
         BNE   SYSABEND                 NO, GO TEST FOR ABEND IN Y02072 24150002
*                                         CONTROL                Y02072 24200002
         MVI   DXSTAGE2,STAGE2          ENTRY TO XCTL TO 2ND STG Y02072 24250002
         B     XCTL191V                 GO XCTL                  Y02072 24260002
*                                                                       24300000
*********************************************************************** 24400000
*                                                                       24500000
SYSABEND EQU   *                                                        24600000
*                                                                       24700000
*********************************************************************** 24800000
*                                                                       24900000
*   THIS ROUTINE CHECKS IF ABEND HAS CONTROL.IF YES,SET A SWITCH TO     25000002
*   AVOID ISSUING ANOTHER ABEND.                                        25100000
*                                                                       25200000
*********************************************************************** 25300000
*                                                                       25400000
         TM    TCBFLGS1,TCBFA           TEST IF ABEND IS IN PROCESS     25700001
         BNO   LDMSGCST                 IF NO, GO LOAD MSG CSECT Y02072 25750002
         MVI   DXNABEND,ABENDBIT        INDIC DO NOT ABEND AGAIN Y02072 25950002
*                                                                       26100000
*********************************************************************** 26200000
*                                                                       26300000
LDMSGCST EQU   *                                                 Y02072 26400002
*                                                                       26500000
*********************************************************************** 26600000
*                                                                       26700000
*   UCS PARM FIELD  (DXUCSP) - BYTE 0   - DXUCSSW1               Y02072 26750002
*                                           B0 - IEC123 REQUIRED Y02072 26760002
*                                           B1 - IEC120 REQUIRED Y02072 26770002
*                              BYTE 1   - EROPT                  Y02072 26800002
*                              BYTE 2   - DXNABEND               Y02072 26850002
*                              BYTE 3   - DXUCSOPT               Y02072 26900002
*                                           B0 - NOT USED        Y02072 26910002
*                                           B1 - FOLD REQUESTED  Y02072 26920002
*                                           B3 - NOT USED        Y02072 26930002
*                                           B4 - VERIFY REQ      Y02072 26940002
*                              BYTE 4-7 - UCS ID                        26950002
*                                                                       27100000
*********************************************************************** 27200000
*                                                                       27412002
* LOAD THE MESSAGE CSECT FOR WTO'S/WTOR'S                        Y02072 27414002
* PASS LOAD THE ADDRESS OF LINK LIB'S DCB. THIS WILL CAUSE LPA   Y02072 27414402
* TO BE SEARCHED.                                                Y02072 27414802
*                                                                       27416002
         L     RWK2,CVTPTR              GET CVT ADDRESS          Y02072 27416402
         USING CVT,RWK2                                          Y02072 27416802
         L     R1,CVTLINK               DCB ADDR FOR LINK LIB    Y02072 27417202
         DROP  RWK2                                              Y02072 27417602
         LOAD  EPLOC=MSGCSECT,DCB=(1)   MACRO TO GET MSG CSECT   Y02072 27418002
         ST    RWK1,DXMSGADR            SAVE CSECT ADDRESS       Y02072 27418402
         L     RWK4,UCBXTADR            GET UCB EXT ADDRESS      Y02072 27420002
         USING UCBUCS,RWK4                                       Y02072 27422002
         CLI   UCBTBYT4,PRT2245        CHECK FOR 2245 PRINTER    S21092 27430021
         BE    WKARINFO                YES, SKIP UCS CODE        S21092 27460021
         MVC   DXUCSID,JFCUCSID         MOVE UCS ID IN JFCB      Y02072 27470002
         MVC   DXUCSOPT,JFCUCSOP        MOVE UCS OPTION BITS     Y02072 27480002
         CLI   UCBTBYT4,PRTM3211        CK IF DCB BEING OPENED   S20202 27602020
*                                       FOR 3211                 S20202 27602502
         BNE   TESTUCS                  NO GO CK UCS PARAMETER   Y02072 27603002
*                                       FOR 1403                 S20202 27603502
*                                                                       27604020
*********************************************************************** 27604520
*                                                                       27605020
*   FCB PARM FIELD  (DXFCBP) - BYTE 0   - DXFCBSW1               Y02072 27605502
*                                           B0 - IEC129 REQUIRED Y02072 27605902
*                                           B1 - CORE TRANSFER   Y02072 27606102
*                              BYTE 1   - FCB FLAG BYTE          Y02072 27607502
*                              BYTE 2   - FLAG BYTE              Y02072 27607702
*                              BYTE 3   - DXFCBOPT               Y02072 27607902
*                                           B0 - ALIGN REQUESTED Y02072 27608002
*                                           B1 - VERIFY REQ      Y02072 27608102
*                              BYTE 4-8 - FCB IMAGE ID           Y02072 27608802
*                                                                       27608902
*********************************************************************** 27609002
*                                                                       27609102
WKARINFO EQU   *                                                 S21092 27609202
*                                                                       27609302
*********************************************************************** 27609402
*                                                                       27609502
         MVC   DXFCBID,JFCFCBID         MOVE FCB ID TO WKAREA    Y02072 27609902
*                                                                       27621502
*    THIS ROUTINE PUTS THE FCB OPTIONS INTO THE FCB WORKAREA FROM JFCB  27622002
*                                                                       27624002
         IC    RB,JFCUCSOP              LOAD FCB OPTIONS INTO    S20202 27624502
*                                       REG 12                   S20202 27625002
         SRL   RB,SHIFTRHT              SHIFT OUT BITS 6 & 7 OF  S20202 27625502
*                                       BYTE 3                   S20202 27626002
         SLL   RB,SHIFTLFT              SHIFT BITS 6 & 7 OF BYTE S20202 27626502
*                                       3 TO                     S20202 27627002
*                                       BITS 0 & 1 OF BYTE 3            27627502
         STC   RB,DXFCBOPT              LOAD FCB OPT INTO        Y02072 27627902
*                                       WORKAREA                 S20202 27628502
*                                                                       27629002
*                                                                       27629502
*********************************************************************** 27630002
*                                                                       27630502
*   TEST IF FCB PARAMETERS ARE SPECIFIED IN DD STATEMENT FOR DCB        27631002
*   AND SET SWITCHES (DXFCBSW1) FOR FCB                          Y02072 27631502
*                                                                       27634502
*********************************************************************** 27635002
*                                                                       27635502
         CLI   DXFCBID,0                CK IF FCB SPECIFIED IN   Y02072 27635902
*                                       DD ST                    S20202 27636502
         BNE   PADFCBID                 YES GO PAD FCB ID WITH   S20202 27637002
*                                       BLANKS                   S20202 27637502
*                                                                       27638002
*********************************************************************** 27638502
*                                                                       27639002
*   WHEN FCB NOT SPECIFIED IN DD STATEMENT,CHECK IF CURRENT FCB IN THE  27639502
*   BUFFER IS A DEFAULT                                                 27640002
*                                                                       27640502
*********************************************************************** 27641002
*                                                                       27641502
         CLI   UCBFCBID,0               CK IF FCB ID IN UCB      Y02072 27641902
         BE    GTMSG129                 IF NOT, GO WTOR IEC129   Y02072 27643502
         TM    UCBFCBOP,DEFALT          CK IF CURRENT FCB IS A   Y02072 27643902
*                                       DEFAULT                  S20202 27644502
         BZ    GTMSG129                 NO GO TO WTOR IEC129     Y02072 27645002
         MVC   DXFCBID,UCBFCBID         SET UP FOR FCB LOAD      Y02072 27645402
         MVI   DXFCBOPT,0               CLR FLAG AS USER CANNOT  Y02072 27645802
*                                         SPEC OPTIONS IF HE     Y02072 27646202
*                                         DOES NOT SPEC IMAGE ID Y02072 27646302
         B     UCSIDTST                 GO TEST FOR UCS          S20202 27646502
*                                       PARAMETERS               S20202 27647002
*                                                                       27647502
*********************************************************************** 27648002
*                                                                       27648502
*   WHEN THE FCB IMAGE IN THE BUFFER IS NOT A DEFAULT OR NO FCB IMAGE   27649002
*   LOADED REQUEST OPERATOR TO SPECIFY AN ALTERNATE BY ISSUEING A WTOR  27649502
*   'IEC129D XXX SPECIFY FCB PARAMETER'                                 27650002
*                                                                       27650502
*********************************************************************** 27651002
*                                                                       27651502
GTMSG129 EQU   *                                                 Y02072 27652002
         OI    DXFCBSW1,IEC129RQ        SET SWITCH FOR IEC129    Y02072 27655002
*                                       REQUIRED                 S20202 27655402
         B     UCSIDTST                 GO TEST UCS PARAMETERS   S20202 27655802
WTOR129  EQU   *                                                 Y02072 27681002
         TM    DXFCBSW1,IEC129RQ        IS MSG129 REQUIRED       Y02072 27683002
         BZ    XCTL197E                 NO, XCTL TO 197E         Y02072 27683402
         LA    RWK5,MSG129              MSG ID FOR MSG ROUTINE   Y02072 27683502
         BAL   RWK6,MSGRTN              GO GET MSG TEXT FOR WTOR Y02072 27683602
*                                                                       27684002
* GO FILL IN DEVICE ADDR AND ISSUE WTOR                          Y02072 27684402
*                                                                       27684802
         BAL   RD,WTORSEQ               ISSUE WTOR               Y02072 27684902
*                                                                       27685002
*   LOAD ID OF IGG0197E AND GO ISSUE SVC 105 TO BUILD DCB AND DEB       27685202
*                                                                       27685502
XCTL197E EQU   *                                                 S20202 27687002
*                                                                       27687502
         LA    RDEB,MODNM7E             LOAD ADDR OF TTR FOR     S20202 27688502
*                                       IGG0197E                 S20202 27689002
         B     OPENIMLB                 GO OPEN SYS1.IMAGELIB    S20202 27689502
*                                                                       27900000
*********************************************************************** 27960002
*                                                                       27970002
*   WHEN FCB SPECIFIED IN DD STATEMENT,PAD FCB IMAGE ID WITH BLANKS     27980002
*                                                                       27990002
*********************************************************************** 27992002
*                                                                       27994002
PADFCBID EQU   *                                                 S20202 27996002
*                                                                       27998002
         LA    RB,DXFCBID+1             LOAD ADDR OF FCB ID + 1  Y02072 27998402
         BAL   RD,PADNAME               GO PAD FCB ID WITH       S20202 27998802
*                                       BLANKS                   S20202 27999202
UCSIDTST EQU   *                                                        28000000
*                                                                       28100000
*********************************************************************** 28200000
*                                                                       28300000
*   TEST IF UCS PARAMETER IS SPECIFIED IN DD STATEMENT FOR THE DCB      28400000
*                                                                       28500000
**********************************************************************  28600000
*                                                                       28700000
         CLI   UCBTBYT4,PRT2245        CHECK FOR 2245 PRINTER    S21092 28730021
         BE    WTOR129                 YES, GO TEST FOR MSG      Y02072 28760002
*                                         IEC129 REQUIRED        Y02072 28760402
TESTUCS  EQU   *                                                 Y02072 28762002
         CLI   DXUCSID,0                TEST FOR UCS IN DD STAT  Y02072 28770002
         BC    7,PADUCSID               IF YES,GOTO PAD UCS ID ROUTINE  28900000
*                                                                       29200000
NOUCSID  EQU   *                                                        29300000
*                                                                       29400000
*********************************************************************** 29500000
*                                                                       29600000
*   WHEN UCS IS NOT SPECIFIED IN DD STATEMENT, CHECK UCB TO SEE IF A    29700002
*   DEFALT UCS IMAGE IS IN THE BUFFER                                   29800000
*                                                                       29900000
*********************************************************************** 30000000
*                                                                       30100000
         CLI   UCBUCSID,0               CK IF UCS ID IN UCB      Y02072 30150002
         BE    WTOR123                  IF NOT, GO WTOR IEC123   Y02072 30220002
         TM    UCBUCSOP,DEFALT          TEST IF UCS IMAGE IS A   Y02072 30230002
*                                       DEFAULT                  S20202 30300020
         BNO   WTOR123                  NO GO TO WTOR IEC123     S20202 30320020
         MVC   DXUCSID,UCBUCSID         MOVE UCS ID TO PARM LIST Y02072 30370002
         MVC   DXUCSOPT,UCBUCSOP        MOVE UCS OP TO PARM LIST Y02072 30380002
         NI    DXUCSOPT,X'FF'-BUFPAR-DEFALT  LEAVE LOAD MODE ON  Y02072 30430002
         B     XCTL191U                 GO XCTL TO NEXT EXEC     Y02072 30480002
*                                                                       30700000
*********************************************************************** 33000000
*                                                                       33100000
WTOR123  EQU   *                                                        33200000
*                                                                       33205020
*********************************************************************** 33210020
*                                                                       33215020
*   SET SWITCH TO INDICATE ENTRY TO IGG191U WILL BE FROM IEC123         33220020
*                                                                       33225020
*********************************************************************** 33230020
*                                                                       33235020
         OI    DXUCSSW1,IEC123RQ        SET SW FOR IEC123 REQ    Y02072 33245002
         LA    RD,XCTL191U              GET ADDRESS OF XCTL191U  S20202 33250020
*                                       ROUTINE TO LOAD ID OF           33255002
*                                       MODULE IGG0191U                 33260020
*                                                                       33300000
*********************************************************************** 33400000
*                                                                       33500000
*   WHEN THE IMAGE IN THE BUFFER IS NOT A DEFALT, REQUEST AN ALTERNATE  33600002
*   UCS IMAGE AND CHAIN TO BE MOUNTED                                   33700000
*   WTOR 'IEC123D SPECIFY UCS PARAMETER'                                33800000
*                                                                       33900000
*********************************************************************** 34000000
         LA    RWK5,MSG123              MESSAGE NO. FOR MSG RTN  Y02072 34050002
         BAL   RWK6,MSGRTN              GO GET MESSAGE           Y02072 34100002
         USING MSGENTRY,RWK2                                     Y02072 34259002
WTORSEQ  EQU   *                                                 S20202 34260002
         IC    RWK7,MSGOFF1             OFFSET TO FIRST VAR FLD  Y02072 34290002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF FIRST VAR FLD Y02072 34340002
         MVC   0(L'UCBNAME,RWK3),UCBNAME  MOVE DEV NAME TO MSG   Y02072 34390002
         MVI   RPLY,BLANK                                        A33665 34460020
         MVC   RPLY+1(19),RPLY          CLEAR REPLY AREA         A33665 34540020
         MVI   RPLYECB,NULL             RESET REPLY ECB          A33665 34620020
         LA    RF,REPLYLTH              LOAD WTOR ADDR                  34700000
*                                                                       34800000
         SVC   35                       ISSUE WTOR SVC                  34900000
*                                                                       35000020
*                                                                       35100020
*                                                                       35200020
         BR    RD                       GO TO ADDRESS IN         S20202 35300020
*                                       REGISTER 14              S20202 35400020
         DROP  RWK2                                              Y02072 35490002
*                                                                       35500020
PADUCSID EQU   *                                                        36200000
*                                                                       36300000
*********************************************************************** 36400000
*                                                                       36500000
*   WHEN UCS IS SPECIFIED IN DD STATEMENT,PAD UCS IMAGE ID WITH X'40'   36600000
*                                                                       36700000
*********************************************************************** 36800000
*                                                                       36900000
         LA    RD,COMPUCS               RET ADDR FROM PAD RTN    Y02072 36930002
         LA    RB,DXUCSID+1             LOAD UCS ID + 1 ADDR     Y02072 36970002
*                                                                       37020020
PADNAME  EQU   *                                                 S20202 37040020
*                                                                       37060020
*                                                                       37080020
         LA    RC,THREE                 LOAD X'03'                      37100000
*                                                                       37200000
COMPBYTE EQU   *                                                        37300000
*                                                                       37400000
         CLI   NULL(RB),NULL            TEST IF UCS IMAGE HAS X'00'     37500000
         BC    7,NEXTBYTE               IF NOT,GOTO TEST NEXT BYTE      37600000
*                                                                       37700000
         MVI   NULL(RB),BLANK           IF YES,REPLACE X'00' BY X'40'   37800000
*                                                                       37900000
NEXTBYTE EQU   *                                                        38000000
*                                                                       38100000
         LA    RB,ONE(RB)               INCREMENT REG. BY '1'           38200000
         BCT   RC,COMPBYTE              GOTO COMPARE NEXT BYTE          38300000
         BR    RD                       BRANCH TO SET SWITCHES   S20202 38350020
*                                                                       40600000
COMPUCS  EQU   *                                                        40700000
*                                                                       40800000
*********************************************************************** 40900000
*                                                                       41000000
*   TEST IF UCS PARAMETERS IN UCB = UCS PARAMETERS IN DD STATEMENT      41100000
*                                                                       41200000
*********************************************************************** 41300000
*                                                                       41400000
         CLC   UCBUCSID,DXUCSID         CK IF SPECIFIED          Y02072 41410002
*                                       UCS=CURRENT              S20202 41540020
         BE    XCTL191U                 NO IEC120 REQ IF EQ      Y02072 41542002
         OI    DXUCSSW1,IEC120RQ        SET IEC120 REQ TO GET    Y02072 41544002
*                                         THE TRAIN MOUNTED      Y02072 41560002
*                                                                       54300000
XCTL191U EQU   *                                                        54400000
*                                                                       54500000
*********************************************************************** 54600000
*                                                                       54700000
*   XCTL TO EXECUTOR IGG0191U TO LOAD IMAGE.                            54800000
*                                                                       54900000
*********************************************************************** 55000000
*                                                                       55100000
*                                                                       55103020
*                                                                       55106020
*                                                                       55109020
         LA    RDEB,MODNM1U             LOAD ADDR OF TTR FOR     S20202 55112020
*                                       IGG0191U                 S20202 55115002
*                                                                       55118020
*                                                                       55121020
*                                                                       55124020
OPENIMLB EQU   *                                                 S20202 55127020
*                                                                       55130020
*                                                                       55133020
         SR    RF,RF                    ZERO OUT REGISTER 1      S20202 55136020
*                                                                       55139020
*  ISSUE SVC TO OPEN SYS1.IMAGELIB                                      55142020
*                                                                       55145020
         SVC   105                      ISSUE SVC TO OPEN        S20202 55148020
*                                       SYS1.IMAGELI             S20202 55151020
         LTR   RF,RF                    TEST IF IMAGELIB OPENED  S20202 55154020
*                                       SUCCES                   S20202 55157020
         BE    IMAGEROR                 IF NOT GO LOAD TTR OF    S20202 55160020
*                                       OPEN MOD                 S20202 55163020
         ST    R1,DXIMGDCB              SAVE ADDR OF IMGLIB DCB  Y02072 55165002
         OI    FCAOPEN2,FCAOIMGL        INDIC IMAGELIB OPENED    YM4697 55175002
         LR    RF,RDEB                  GET ADDR OF OPEN         S20202 55181020
*                                       EXECUTOR TTR             S20202 55184020
         BC    K15,MVEIDTTR             GOTO MOVE ID TTR ROUTINE S20202 55187020
*                                                                       55196020
IMAGEROR EQU   *                                                 S20202 55199020
*                                                                       55205020
*   THIS ROUTINE CONVERTS RETURN CODE FROM IMAGELIB TO AN               55207021
*   INTERNAL CODE FOR PROBLEM DETERMINATION                             55209021
*              RETURN CODE              INTERNAL CODE                   55211021
*              X'04'                    95                              55213021
*              X'08'                    96                              55215021
*              X'0C'                    97                              55217021
*                                                                       55223020
         LA    RF,OABD095-K1            PUT INTERNAL CODE IN REG M0009  55227021
         SRL   RJ,2                     DIVIDE RTN CODE BY 4     YM3213 55227401
         AR    RJ,RF                    IF REG15=1, THEN         M0009  55228021
*                                       INTERNAL CODE IS 95,            55229021
*                                       ABEND CODE IS B13-20            55230021
*                                       IF REG 15=2, THEN               55231021
*                                       INTERNAL CODE IS 96,            55232021
*                                       ABEND CODE IS B13-24            55233021
*                                       IF REG 15=3, THEN               55234021
*                                       INTERNAL CODE IS 97,            55235021
*                                       ABEND CODE IS B13-28            55236021
PDEXIT   EQU   *                        GO TO PROB DET           Y02072 55246002
         MVI   DXABEND,ABEND            SET ABEND FLAG           Y02072 55248002
         STC   RJ,DXABRETC              STORE RETURN CODE        Y02072 55250002
XCTL191V EQU   *                                                 Y02072 55252002
         LA    RF,MODNM1V               GET IDTTR OF IGGO191V    S20202 55256020
MVEIDTTR EQU   *                                                        63300000
*                                                                       63400000
*********************************************************************** 63500000
*                                                                       63600000
*   MOVE IDTTR TO XCTL WTG TABLE                                        63700000
*                                                                       63800000
*********************************************************************** 63900000
*                                                                       64000000
         USING WTGENTRY,RWTGC                                    Y02072 64050002
         MVC   WTGIDTTR,0(RF)           ST NEXT MOD ID IN WTG  @Z30TSCF 64060003
*                                                                       64200000
*********************************************************************** 64300000
*                                                                       64400000
RELOOP   EQU   *                                                        64500000
*                                                                       64600000
*********************************************************************** 64700000
*                                                                       64800000
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            64900000
*                                                                       65000000
*********************************************************************** 65100000
*                                                                       65200000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     65300000
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY     65400000
         CLC   0(2,RWTGC),AMIDCNST      IS THE RTN NEEDED AGAIN         65500000
         BCR   8,RBASE                  IF YES,RETURN TO PROCESS        65600000
*                                                                       65700000
         CLC   0(2,RWTGC),OPIDCNST      TEST END OF WTG TABLE           65800000
         BC    7,RELOOP                 IF NOT,CHECK NEXT ENTRY         65900000
*                                                                       66000000
         LR    RPARC,RPAR               RESET REG TO '0'                66100000
         LA    RWTGC,WAOFF(0,RWTG)      RESET WTG REG TO POINT +32(WTG) 66200000
ZCHECK   CLI   0(RWTGC),X'00'           TEST IF THIS ENTRY COMPLETE     66300000
         BC    7,TCTLRTN                IF NOT,XCTL                     66400000
*                                                                       66500000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY OF WTG TABLE     66600000
         LA    RPARC,PLOFF(0,RPARC)     GET NEXT ENTRY OF DCB           66700000
         BC    15,ZCHECK                GOTO TEST COMPLETION            66800000
*                                                                       66900000
TCTLRTN  EQU   *                                                        67000000
*                                                                       67050003
         USING WTG,RWTG                                                 67100003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*67150003
               MODID=WTGENTRY                                  @Z30TSCF 67200003
         DROP  RWTGC,RWTG                                      @Z30TSCF 67250003
*                                                                       67800000
         EJECT                                                          67802002
*********************************************************************** 67810002
*  'MSGRTN' SUBROUTINE                                           Y02072 67820002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 67830002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 67832002
*                                                                       67834002
*    INPUT TO THIS ROUTINE:                                      Y02072 67836002
*      REG 12 - MESSAGE NUMBER IN MSG CSECT                      Y02072 67838002
*      REG 13 - RETURN ADDRESS                                   Y02072 67838402
*                                                                       67838802
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 67839202
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 67839602
*      REG 1 - POINTER TO MESSAGE ENTRY IN THE MESSAGE CSECT     Y02072 67839702
*********************************************************************** 67840002
MSGRTN   EQU   *                        ENTRY POINT, MSG ROUTINE Y02072 67850002
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 67860002
         LH    RWK2,0(RWK7,RWK5)        GET INDEX TO MESSAGE     Y02072 67870002
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 67880002
         USING MSGENTRY,RWK2                                     Y02072 67890002
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 67892002
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 67894002
*                                         ENTRY                  Y02072 67896002
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 67898002
         SR    RWK7,RWK7                PREPARE REGISTER FOR RET Y02072 67898402
         USING MSGTXTD,RWK3                                      Y02072 67898802
         IC    RWK7,MSGLNG              GET LEN OF MSG - 1       Y02072 67899202
         EX    RWK7,MVCINST             MOVE MESSAGE             Y02072 67899602
         BR    RWK6                     RETURN                   Y02072 67899702
MVCINST  MVC   MSGAREA(0),MSGTXT        EXECUTED BY EX INST      Y02072 67899802
         EJECT                                                          67899902
*                                                                       68338502
*********************************************************************** 68359002
*                                                                       68379502
*   CONSTANTS                                                           68400000
*                                                                       68500000
*********************************************************************** 68600000
*                                                                       68900000
OPIDCNST DC    C'0S'                                                    69000000
AMIDCNST DC    C'1T'                                                    69100000
LOWER    DC    X'4040404040404040'      MASK TO OR REPLY                69800000
MSGCSECT DC    CL8'IGGMSG01'            NAME OF MSG CSECT        Y02072 69950002
*                                                                       70100000
*********************************************************************** 70200000
*                                                                       70300000
*   XCTL TABLE                                                          70400000
*                                                                       70500000
*********************************************************************** 70600000
*                                                                       70700000
MODNM1U  DC    C'1U',VL3(IGG0191U)      MODULE IGG0191U        @Z30TSCF 70724003
MODNM1V  DC    C'1V',VL3(IGG0191V)      MODULE IGG0191V        @Z30TSCF 70726003
MODNM7E  DC    C'7E',VL3(IGG0197E)      MODULE IGG0197E        @Z30TSCF 70728403
         SPACE                                                          70729202
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 70729902
END      EQU   *                        END OF MODULE            Y02072 70730002
         EJECT                                                          70740002
         IEECUCM FORMAT=NEW                                      YM6054 70750002
         EJECT                                                          70780002
         IHAPSA                                                  Y02072 70830002
         EJECT                                                          70880002
         DCBD  DSORG=PS                                                 72900000
         EJECT                                                          73250002
         IGGMSG                                                  Y02072 73260002
         EJECT                                                          73270002
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 73280003
         ORG   WTGIDTTR                                          Y02072 73330002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 73380002
FORCORE  DSECT                                                   Y02072 73430002
         ORG   REPLYLTH+52                                       A33665 73440020
RPLY     DS    20C                                               A33665 73480020
RPLYECB  DS    F                                                 A33665 73520020
MCSMASK  DS    H                                                 A33665 73560020
LOMASK   DS    8C                                                A33665 73600020
UCSID    DS    4C                                                A33665 73640020
         ORG   MSGLSTSZ                                          Y02072 73650002
MSGAREA  DS    0CL64                    TAREA TO MOVE 64 BYTES   Y02072 73660002
*                                         TO FOR WTO/WTOR'S      Y02072 73670002
         EJECT                                                          73680002
         IGGSCW                                                  Y02072 73682002
         EJECT                                                          73690002
         IHAFCAUD  ORG=YES                                       YM4697 73740002
         EJECT                                                          73790002
SRT      DSECT                                                          74000000
         IEFUCBOB                                                       74100000
         EJECT                                                          74600002
         IEZDEB                                                  Y02072 74650002
         EJECT                                                          74700002
         IKJTCB                                                  Y02072 74750002
         EJECT                                                          74800002
         CVT  DSECT=YES,LIST=NO                                  Y02072 74850002
         END                                                            78800000
./  ADD  SSI=52590010,NAME=IGG0191U
191U  TITLE 'IGG0191U - UCS IMAGE RETRIEVAL'                            00100003
IGG0191U CSECT                                                          00200000
*                                                                       00250002
*MODULE NAME - IGG0191U                                          Y02072 00300002
*                                                                       00350002
*DESCRIPTIVE NAME - UCS IMAGE RETRIEVAL                          Y02072 00400002
*                                                                       00450002
*COPYRIGHT - NONE                                                Y02072 00500002
*                                                                       00550002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00560002
*                                                                       00570002
*          RELEASE 20 DELETIONS                                         00600000
*3364511000,514000                                               M5149  00605020
*3364305400-306200,319000,337000-340000,344000,347000,377000,    A33665 00610020
*3364386000,396000,445000,466000,478000,507000-508000            A33665 00620020
*3364412500,774000,783600                                        A33684 00650020
*3364013000-016000,040000,044000-045000,051000-058000,066000-    S20202 00660020
*3364067000,139000,140000-141000,195000,202000-205000,241000,    S20202 00670020
*3364249000,314000-315000,354000-365000,479000-495000,530000-    S20202 00680020
*3364576000,582000-592000,604000,719000-750000                   S20202 00690020
*3364475000                                                      A34950 00695020
*          RELEASE 21 DELETIONS                                         00700000
*1033361800,603930,791000-799000,811000-816000                   S21042 00750021
*                                                                       00760002
*        VS 2 RELEASE 02 DELETIONS                                      00770002
*001200-001800,012000,048000,064000,109200-109600,113000-115000, Y02072 00780002
*150000,163500-164800,245000-277000,289000-291000,295000-300000, Y02072 00790002
*304000-305250,411000-415000,646060-646840,662050-662600,        Y02072 00792002
*769000-775000,783300-804000,810000,812000,814000,003000-005500  Y02072 00794002
*008000-011000,681000,713000,717000,812000,620000,765000         Y02072 00794402
*                                                                YM7889 00794802
*                                                                       00795203
*        VS2 RELEASE 3 DELETIONS                                        00795603
*                                                              @Z30TSCF 00795703
*        VS2 RELEASE 4 CHANGES                                          00795903
*C782600-783000                                                @ZA01357 00796003
*                                                                       00796103
*LAST DATE CHANGED - JULY 2, 1975                                       01200003
*                                                                       01250002
*FUNCTION/OPERATION - ISSUE BLDL MACRO TO LOCATE THE UCS IMAGE          01300002
*                     IN SYS1.IMAGELIB                                  01400003
*                   - DISPLAY IEC120 MESSAGE TO REQUEST AN OPERATOR     01700000
*                     MOUNT THE CHAIN IF NECESSARY                      01800002
*                   - WHEN IMAGE NOT IN SYS1.IMAGELIB DISPLAY MESSAGE   01950003
*                     IEC122 TO REQUEST OPERATOR SPECIFY AN             02000002
*                     ALTERNATE CHAIN.                                  02100000
*                   - ANALIZE REPLY MADE BY AN OPERATOR                 02200000
*                                                                       02500000
*ENTRY POINT - ENTERED FROM IGG0191T BY THE USE OF XCTL MACRO           02600000
*                                                                       02700000
*INPUT - DCB ADDRESS                                                    02800000
*      - OPEN WORK AREA ADDRESS                                         02900000
*      - WHERE-TO-GO TABLE                                              03000000
*      - PARAMETER LIST                                                 03100000
*      - CURRENT ENTRY IN W-T-G TABLE                                   03200000
*      - CURRENT PARAMETER(DCB)                                         03300000
*      - REPLY IN OPEN WORK AREA BY OPERATOR                            03400000
*      - ADDRESS OF SYS1.IMAGELIB DCB IN OPEN WORKAREA(DXCCW8)          03450020
*                                                                       03500000
*OUTPUT - TO REQUEST AN OPERATOR MOUNT PROPER CHAIN                     03600000
*         'IEC120A M XXX,YYYY' MESSAGE IS DISPLAYED                     03700000
*       - TO REQUEST AN OPERATOR SPECIFY AN ALTERNATE UCS IMAGE.        03800000
*         'IEC122D XXX,YYYY IMAGE NOT FOUND' MESSAGE IS DISPLAYED       03900000
*       - MESSAGE IEC125A - ERROR - REPEAT REPLY, WHEN OPERATOR  Y02072 03950002
*         REPLY IS INVALID                                       Y02072 03960002
*       - THE ADDRESS OF UCS IMAGE RETRIEVED FROM SYS1.IMAGELIB         04000003
*                                                                       04100000
*EXTERNAL REFERENCES - MESSAGE CSECT                             Y02072 04200002
*                                                                       04300000
*EXIT - NORMAL - XCTL TO IGG0191V TO LOAD IMAGE                  Y02072 04350002
*                                                                       05180020
*EXIT - ERROR - XCTL TO IGG0191V FOR THE FOLLOWING:              Y02072 05230002
*               *PERMANENT I/O ERROR OCCURED DURING BLDL                05630002
*               *OPERATOR ISSUED CANCEL FOR MESSAGE IEC120,IEC122,OR    05720020
*                IEC123                                                 05810002
*                                                                       05900000
*TABLES/WORK AREAS - WHERE-TO-GO TABLE(SEE LISTING OF EXECUTOR          06000000
*                                      IGG0191B)                        06100000
*                  - OPEN WORK AREA (SEE IECDSECT IN THIS LISTING)      06200000
*                                                                       06300000
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 06400002
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 06450002
*                                                                       06452002
*MACROS-MAPPING:IGGMSG, CVT, IEFUCBOB, IECDSECS(WTG,MAIN), DCBD, Y02072 06460002
*               IGGSCW                                           Y02072 06470002
*                                                                       06500000
*NOTES - BLDL SVC IS ISSUED TO LOCATE UCS IMAGE IN SYS1.IMAGELIB        06600020
*      - WTO/WTOR SVC IS USED TO REQUEST OPERATOR REPLY.                06800000
*      - THE REPLY IS ORED TO ALLOW LOWER CASE ALPHA                    07000000
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 07060002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 07070002
*                                                                       07100000
*********************************************************************** 07200000
*                                                                       07300000
         EJECT                                                          07400000
*                                                                       07500000
*********************************************************************** 07600000
*                                                                       07700000
*   REGISTER CONVENTIONS                                                07800002
*                                                                       07900000
*********************************************************************** 08000000
*                                                                       08100000
*                                                                       08200000
RE       EQU   0                        WORK/PARAMETER REGISTER         08300000
RWK1     EQU   RE                       WORK REGISTER            Y02072 08350002
RF       EQU   1                        WORK/PARAMETER REGISTER         08400000
RWK2     EQU   RF                       WORK REGISTER            Y02072 08450002
RDCB     EQU   2                        ADDR OF USER'S DCB              08500000
RBASE    EQU   3                        BASE REGISTER                   08600000
RCORE    EQU   4                        ADDR OF OPEN WORK AREA          08700000
RPAR     EQU   5                        PARAMETER LIST                  08800000
RWTG     EQU   6                        START OF WTG                    08900000
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 09000000
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      09100000
RTIOT    EQU   9                        TIOT ADDR/WORK REGISTER         09200000
RWK3     EQU   RTIOT                    WORK REGISTER            Y02072 09250002
RUCB     EQU   10                       UCB ADDR/WORK REGISTER          09300000
RDEB     EQU   11                       DEB ADDR                        09400000
RWK4     EQU   RDEB                     WORK REGISTER            Y02072 09450002
RB       EQU   12                       WORK REGISTER/BREG FOR DSECT    09500000
RWK5     EQU   RB                       WORK REGISTER            Y02072 09550002
RC       EQU   13                       WORK REGISTER                   09600000
RWK6     EQU   RC                       WORK REGISTER            Y02072 09650002
RD       EQU   14                       WORK/PARAMETER REGISTER         09700000
RJ       EQU   15                       WORK/PARAMETER REGISTER         09800000
RWK7     EQU   RJ                       WORK REGISTER            Y02072 09850002
*                                                                       09900000
*********************************************************************** 10000000
*                                                                       10100000
*                                                                       10200000
*   EQUATE WTG OFFSET                                                   10300000
*                                                                       10400000
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   10500000
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   10600000
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TBL  10700000
*                                                                       10800000
*  THE FOLLOWING MESSAGE NUMBERS ARE EQUAL TO THEIR POSITION     Y02072 10850002
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 10860002
*  OF AN INDEX)                                                  Y02072 10870002
*                                                                       10900000
MSG120I3 EQU   4*2                      MESSAGE NO IN MSG CSECT  Y02072 10950002
MSG120I4 EQU   5*2                      MESSAGE NO IN MSG CSECT  Y02072 10960002
MSG120I5 EQU   6*2                      MESSAGE NO IN MSG CSECT  Y02072 10970002
MSG120I6 EQU   7*2                      MESSAGE NO IN MSG CSECT  Y02072 10980002
MSG122   EQU   8*2                      MESSAGE NO IN MSG CSECT  Y02072 10990002
MSG125   EQU   9*2                      MESSAGE NO IN MSG CSECT  Y02072 10992002
UCSIMLNG EQU   4                        LENGTH OF UCS IMAGE NAME Y02072 10994002
VERIFY   EQU   X'10'                    VERIFY                          11100000
BLDL     EQU   X'80'                    BLDL IS REQUIRED                11600000
IEC120   EQU   X'40'                    IEC120 MESSAGE IS REQUIRED      11700000
IEC123RQ EQU   X'80'                    IF ON, MUST ISSUE IEC123 Y02072 11750002
LOAD     EQU   X'20'                    LOAD FROM SYS1.IMGLIB IS REQUIR 11800002
ALPHAF   EQU   X'C6'                    C'F'                            12100000
NULL     EQU   X'00'                    X'00' MASK                      12600000
EXCP     EQU   X'10'                    EXCP TO LOAD UCSB        Y02072 12650002
FOLDMASK EQU   X'40'                    FOLD MASK                       12800000
COMMA    EQU   X'6B'                    C','                            12900002
BLANK    EQU   X'40'                    C' '                            13000000
REPEATNO EQU   5                        NO OF REPEAT IN REPLYRTN        13100000
BLANKMSK EQU   X'40'                    C' '                            13200000
NOVERLAP EQU   X'FD'                    RESET OVERLAP BIT               13400000
FOUR     EQU   X'04'                    X'04'                           13500000
NODELETE EQU   X'7F'                    NO DELETE IS REQUIRED           13600000
ABEND    EQU   X'FF'                    ABEND CODE OR SWITCH     S20202 13820020
PRTM3211 EQU   X'09'                    MASK FOR 3211 PRINTER    S20202 13986020
TWOCON   EQU   C'2'                                              S20202 14016020
OABD070  EQU   70                                                S21042 14180021
OABD071  EQU   71                                                S21042 14182021
         EJECT                                                          14184002
         BALR  RBASE,0                                                  14400000
         USING GOGOGO,RBASE                                             14500000
         USING FORCORE,RCORE                                            14600000
         USING UCBOB,RUCB                                               14700000
         USING IHADCB,RDCB                                              14800000
         USING DEB,RDEB                                                 14900000
*                                                                       15100000
*********************************************************************** 15200000
*                                                                       15300000
GOGOGO   EQU   *                                                        15400000
*                                                                       15500000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 15550002
         DC    C'IGG0191U'              MODULE NAME              Y02072 15560002
         DC    C' OZ01357'              LAST SHIP CODE                  15570003
         DC    C' 7/02/75'              LAST DATE MODIFIED              15580003
BEGIN    DC    0H'0'                                                    15590003
*                                                                       15592002
*********************************************************************** 15600000
*                                                                       15700000
*   INITIALIZE REGISTERS                                                15800000
*                                                                       15900000
*********************************************************************** 16000000
*                                                                       16100000
         L     RDCB,0(RPARC)            LOAD CURRENT DCB ADDR           16200000
         L     RCORE,4(RWTGC)           LOAD CURRENT WORK AREA ADDR     16300000
         L     RDEB,DCBDEBAD            LOAD DEB ADDR                   16400000
         L     RUCB,DEBUCBAD            LOAD UCB ADDR                   16500000
         DROP  RDEB                                              Y02072 16550002
         L     RTIOT,CVTPTR(0)          LOAD CVT ADDR                   16600000
*                                                                       16700000
*********************************************************************** 16800000
*                                                                       16900000
TSTENTRY EQU   *                                                        17000000
*                                                                       17100000
*********************************************************************** 17200000
*                                                                       17300000
*   TEST THE ENTRY SWITCH TO DETERMINE REQUIRED OPERATION. (DXUCSSW1)   17400002
*                                                                       17850002
*********************************************************************** 17900000
*                                                                       18000000
         TM    DXUCSSW1,IEC123RQ        IF ON, GO WAIT ON        Y02072 18002002
*                                         MSG IEC123             Y02072 18100002
         BO    RETURN                   GO ISSUE WAIT            Y02072 18150002
*                                                                       19000000
BLDLRTN  EQU   *                                                        19100000
*                                                                       19200000
*********************************************************************** 19300000
*                                                                       19400000
*   BLDL ROUTINE IS USED TO LOCATE UCS IMAGE IN SYS1.IMAGELIB           19500002
*                                                                       19600000
*********************************************************************** 19700000
*                                                                       19800000
         MVC   DXBLDL,BLDLCNST          MOVE BLDL LEN TO LIST    Y02072 19850002
         MVC   DXBLDLIM,UCSCONST        MOVE 'UCS1' TO LIST      Y02072 19860002
         CLI   UCBTBYT4,PRTM3211        CK IF DCB BEING OPENED   S20202 20010020
*                                       FOR 3211                 S20202 20020003
         BNE   CONTBLDL                 NO GO CONTINUE WITH BLDL S20202 20030020
         MVI   DXBLDLIM+3,TWOCON        CHANGE UCS ID PREFIX TO  Y02072 20032002
*                                       UCS2                     S20202 20050020
*                                                                       20060020
CONTBLDL EQU   *                                                 S20202 20070020
*                                                                       20080020
         MVC   DXIMGNAM,DXUCSID         MOVE UCS NAME FROM JFCB  Y02072 20150002
*                                                                       20170020
*   GET ADDRESS OF IMAGELIB DCB                                         20240003
*                                                                       20310020
         L     RF,DXIMGDCB              GET ADDR OF IMGLIB       Y02072 20360002
*                                       DCB                      S20202 20450020
*                                                                       20520020
         LA    RE,DXBLDL                LOAD BLDL LIST ADDR      Y02072 20570002
*                                                                       20700000
         BLDL  (1),(0)                  BLDL THE UCS SET                20800000
*                                                                       20900000
*                                                                       21000000
*   TEST RETURN CODE FOR THE ABOVE FIND IN RJ                           21100000
*               X'00'--- FOUND                                          21200000
*               X'04'--- NOT FOUND                                      21300000
*               X'08'--- PERMANENT I/O ERROR                            21400000
*                                                                       21500000
         LA    RD,FOUR                  LOAD X'04' TO TEST RETURN CODE  21600000
         CLR   RJ,RD                    TEST RETURN CODE                21700000
         BC    2,ABEND08                IF X'08',GOTO ABEND ROUTINE     21800000
*                                                                       21900000
         BC    8,WTOR122                IF X'04',GOTO WTOR IEC122       22000000
*                                                                       22100000
*********************************************************************** 22200000
*                                                                       22300000
CHCK120  EQU   *                                                        22400000
*                                                                       22500000
*********************************************************************** 22600000
*                                                                       22700000
*   WHEN THE IMAGE IS FOUND,TEST IF MESSAGE IEC120 IS REQUIRED          22800000
*                                                                       22900000
*********************************************************************** 23000000
*                                                                       23100000
         TM    DXUCSSW1,IEC120          TEST IF IEC120 REQ       Y02072 23150002
         BNO   XCTL191V                 IF NOT, GO LOAD IMAGE    Y02072 23200002
*                                                                       23400000
*********************************************************************** 23500000
*                                                                       23600000
WTOR120  EQU   *                                                        23700000
*                                                                       23800000
*********************************************************************** 23900000
*                                                                       24000000
*   WHEN UCS IS FOUND IN SYS1.IMAGELIB BY BLDL                          24100020
*   WTOR 'IEC120A M XXX,YYYY' TO REQUEST MOUNTING SPECIFIED CHAIN       24200003
*                                                                       24300000
*********************************************************************** 24400000
         LA    RWK6,W120RET             RETURN ADDRESS           Y02072 24450002
         TM    DXUCSOPT,FOLDMASK+VERIFY  FOLD OR VERIFY SPEC     Y02072 24500002
         LA    RWK5,MSG120I5            MSG NO FOR FOLD AND VER  Y02072 24550002
         BO    WTORTN                   YES, BRANCH TO GET MSG   Y02072 24600002
         LA    RWK5,MSG120I3            MSG NO FOR NEITHER FOLD  Y02072 24650002
*                                         OR VERIFY SPECIFIED    Y02072 24700002
         BZ    WTORTN                   NO, BRANCH TO GET MSG    Y02072 24750002
         TM    DXUCSOPT,FOLDMASK        FOLD SPECIFIED           Y02072 24800002
         LA    RWK5,MSG120I6            MSG NO FOR FOLD SPEC     Y02072 24850002
         BO    WTORTN                   YES, BRANCH TO GET MSG   Y02072 24900002
         LA    RWK5,MSG120I4            MSG NO FOR VERIFY SPEC   Y02072 24950002
         B     WTORTN                   BRANCH TO GET MESSAGE    Y02072 24960002
W120RET  EQU   *                        FILL IN VAR FLD 2        Y02072 25010002
         USING MSGENTRY,RWK2                                     Y02072 25020002
         IC    RWK7,MSGOFF2             OFFSET TO SECOND VAR FLD Y02072 25060002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF SEC VAR FLD   Y02072 25110002
         MVC   0(UCSIMLNG,RWK3),DXUCSID  UCS IMAGE TO MSG        Y02072 25160002
         B     STVARFLD                 GO STORE VAR FLD 1       Y02072 25210002
*                                                                       27900000
WTOR122  EQU   *                                                        28000000
*                                                                       28100000
*********************************************************************** 28200000
*                                                                       28300000
*   WTOR 'IEC122D XXX,YYY IMAGE NOT FOUND' TO REQUEST FOR ALTERNATE     28400000
*   CHAIN SET                                                           28500000
*                                                                       28600000
*********************************************************************** 28700000
*                                                                       28800000
         LA    RWK5,MSG122              MESSAGE NO               Y02072 28810002
         BAL   RWK6,WTORTN              GO GET MESSAGE           Y02072 28820002
         NI    DXUCSSW1,NODELETE        RESET BLDL BIT TO INDIC  Y02072 28822002
*                                       NO IMAGE HAS BEEN LOADED        28840002
         IC    RWK7,MSGOFF2             OFFSET TO SECOND VAR FLD Y02072 28840402
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF SEC VAR FLD   Y02072 28840802
         MVC   0(UCSIMLNG,RWK3),DXUCSID  UCS IMAGE TO MSG        Y02072 28841202
         XC    DXUCSID,DXUCSID          RESET UCS IMAGE ID       Y02072 28841602
STVARFLD EQU   *                        STORE VARIABLE FIELD     Y02072 28850002
         IC    RWK7,MSGOFF1             OFFSET TO FIRST VAR FLD  Y02072 28950002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF FIRST VAR FLD Y02072 29050002
         MVC   0(L'UCBNAME,RWK3),UCBNAME  MOVE DEV NAME TO MSG   Y02072 29100002
         DROP  RWK2                                              Y02072 29180002
*                                                                       30100000
*   WTOR ROUTINE                                                        30200000
*                                                                       30300000
MESSAGO  EQU   *                                                 A27331 30530019
         MVI   RPLY,BLANK                                        A33665 30620020
         MVC   RPLY+1(19),RPLY          CLEAR REPLY AREA         A33665 30710020
         MVI   RPLYECB,NULL             CLEAR REPLY ECB          A33665 30800020
*                                                                       30900000
         LA    RF,REPLYLTH              LOAD WTOR ADDR                  31000000
*                                                                       31100000
         SVC   35                       ISSUE WTOR SVC                  31200000
*                                                                       31300000
*                                                                       31600000
RETURN   EQU   *                                                        31700000
*                                                                       31800000
         LA    RF,RPLYECB               LOAD REPLY ECB ADDRESS   A33665 31900020
*                                                                       32000000
         WAIT  ECB=(1),LONG=YES         WAIT ON REPLY            Y02072 32100002
*                                                                       32500000
GOREPLY  EQU   *                                                        32600000
*                                                                       32700000
*********************************************************************** 32800000
*                                                                       32900000
*   REPLY ANALYSIS                                                      33000000
*   (1) 'U' - USE THE ONE ON THE PRINTER                                33100000
*   (2) 'CANCEL' - CHAIN SET NOT AVAILABLE                              33200000
*   (3) 'UCS-ID' - UCS ID                                               33300000
*                                                                       33400000
*********************************************************************** 33500000
*                                                                       33600000
         OC    RPLY(8),LOMASK           OR IN X'40' TO ALLOW     A33665 33700020
         OC    RPLY+8(8),LOMASK         REPLY IN LOWER CASE      A33665 33800020
         CLC   RPLY(2),UBLANK           TEST IF REPLY = 'U'      A33665 33900020
         BE    BLDLSETU                 IF YES, GO TO SET UP     Y02072 33950002
*                                         FOR BLDL               Y02072 34300002
         CLC   RPLY(6),CANCELCN         TEST IF REPLY = 'CANCEL' A33665 34400020
         BC    8,CANCELGO               IF YES,GOTO CANCEL ROUTINE      34500000
         CLC   RPLY(2),CBLANK           TEST IF REPLY = 'C'      A33665 34700020
         BC    7,TSTUCSID               IF NOT,GOTO UCS ID TEST         34800000
*                                                                       34900000
*********************************************************************** 35000000
*                                                                       35100000
CANCELGO EQU   *                                                        35200000
*                                                                       35300000
*********************************************************************** 35380020
*                                                                       35460020
*   SINCE THE SPECIFIED UCS CHAIN IS NOT AVAILABLE,JOB STEP IS          35540020
*   CANCELLED BY OPERATOR. THE ABEND SWITCH AND CODE-X'04'- IS          35620020
*   SET,AND A XCTL IS MADE TO IGG0191V TO ABEND,CHECK IF IMAGE ID WAS   35700002
*   SPECIFIED CORRECTLY, OR ADD IMAGE TO SYS1.IMAGELIB                  35780020
*                                                                       35860020
*********************************************************************** 35940020
*                                                                       36020020
*                                                                       36100020
         MVI   DXABRETC,OABD071         MOVE INTERNAL CODE TO    Y02072 36110002
*                                       WKAREA                   S21042 36200021
         MVI   DXABEND,ABEND            SET ABEND FLAG           Y02072 36250002
         B     XCTL191V                 GO XCTL TO IGG0191V      S20202 36340020
*                                                                       36420020
*                                                                       36600000
*********************************************************************** 36700000
*                                                                       36800000
TSTUCSID EQU   *                                                        36900000
*                                                                       37000000
*********************************************************************** 37100000
*                                                                       37200000
*   ANALYZE REPLY UCS PARAMETERS                                        37300000
*                                                                       37400000
*********************************************************************** 37500000
*                                                                       37600000
         LA    RD,RPLY                  LOAD REPLY ADDRESS       A33665 37700020
         LA    RJ,REPEATNO              LOAD 5 IN REG. RJ               37800000
*                                                                       37900000
         CLI   0(RD),COMMA              TEST IF 1ST CHAR=','            38000000
         BC    8,ERRORTN                IF YES,GOTO ERROR ROUTINE       38100000
*                                                                       38200000
         CLI   0(RD),BLANKMSK           TEST IF 1ST CHAR=BLANK          38300000
         BC    8,ERRORTN                IF YES,GOTO ERROR ROUTINE       38400000
*                                                                       38500000
         MVI   MCSMASK,NULL             SET LOAD MODE BIT =      A33665 38540020
*                                       X'00'                    A33665 38580020
         MVC   UCSID(4),BLANKS          BLANK OUT AREA TO MOVE   A33665 38620020
*                                       REPLY ID INTO                   38660020
*                                                                       38700000
TSTREPLY EQU   *                                                        38800000
*                                                                       38900000
         CLI   0(RD),BLANKMSK           TEST IF CHAR=BLANK              39000000
         BC    8,TSTNAME                IF YES,GOTO TEST IMAGE IDS.     39100000
*                                                                       39200000
         CLI   0(RD),COMMA              TEST IF CHAR=','                39300000
         BC    8,TSTOPT                 IF YES,GOTO OPTION TEST ROUTINE 39400000
*                                                                       39500000
         MVC   UCSID-RPLY(1,RD),0(RD)                            A33665 39600020
*                                                                       39700000
         LA    RD,1(RD)                 MODIFY REPLY ADDR               39800000
*                                                                       39900000
         BCT   RJ,TSTREPLY              GO BACK TO REPLY UCS ID ANALY   40000000
*                                                                       40100000
*********************************************************************** 40200000
*                                                                       40300000
ERRORTN  EQU   *                                                        40400000
*                                                                       40500000
*********************************************************************** 40600000
*                                                                       40700000
*   REPLY ERROR ROUTINE                                                 40800000
*                                                                       40900000
*********************************************************************** 41000000
         LA    RWK6,MESSAGO             RETURN ADDRESS           Y02072 41050002
         LA    RWK5,MSG125              MESSAGE NO FOR MSG RTN   Y02072 41100002
         B     WTORTN                   GO GET AND ISSUE MSG     Y02072 41150002
*********************************************************************** 41600000
*                                                                       41700000
TSTOPT   EQU   *                                                        41800000
*                                                                       41900000
*********************************************************************** 42000000
*                                                                       42100000
*   TEST FOLD/VERIFY SPECIFIED                                          42200000
*                                                                       42300000
*********************************************************************** 42400000
*                                                                       42500000
         CLI   1(RD),COMMA              TEST IF NEXT CHAR=','           42600000
*                                                                       42700000
         BC    8,TSTVRFY                IF YES,GOTO TEST 'VERIFY'       42800000
*                                                                       42900000
         CLC   1(4,RD),FOLDCN           TEST IF FOLD IS SPECIFIED       43000000
         BC    7,TSTALPHF               IF NOT,GOTO TEST IF 'F'         43100000
         LA    RD,4(RD)                 IF YES,SET POINTER TO NEXT WORD 43200000
         BC    15,SETFOLD               GOTO SET FOLD BIT               43300000
*                                                                       43400000
TSTALPHF EQU   *                                                        43500000
*                                                                       43600000
         CLI   1(RD),ALPHAF             TEST IF 'F' IS SPECIFIED        43700000
         LA    RD,1(RD)                 SET POINTER TO NEXT WORD        43800000
         BC    7,ERRORTN                IF NOT,GOTO ERROR RTN           43900000
*                                                                       44000000
SETFOLD  EQU   *                                                        44100000
*                                                                       44200000
*                                                                       44300000
*                                                                       44400000
         MVI   MCSMASK,FOLDMASK         SET LOAD MODE = FOLD     A33665 44500020
*                                                                       44600000
         CLI   1(RD),COMMA              TEST IF C',' FOLLOWS AFTER FOLD 44700000
         BC    8,TSTVRFY                IF YES,GOTO TEST VERIFY RTN     44800000
*                                                                       44900000
         CLI   1(RD),BLANKMSK           TEST IF A BLANK FOLLOWS         45000000
         BC    8,TSTNAME                IF YES,GOTO TEST NAME ROUTINE   45100000
*                                                                       45200000
         BC    15,ERRORTN               IF NOT,GOTO ERROR ROUTINE       45300000
*                                                                       45400000
TSTVRFY  EQU   *                                                        45500000
*                                                                       45600000
*   TEST VERIFY IS SPECIFIED                                            45700000
*                                                                       45800000
         CLC   2(6,RD),VERIFYCN         TEST IF 'VERIFY' SPECIFIED      45900000
         BC    8,SETVRFY                IF YES,GOTO SET VERIFY BIT      46000000
         CLC   2(2,RD),VBLANK           TEST IF REPLY='V'               46100000
         BC    7,ERRORTN                IF NOT,GOTO ERROR ROUTINE       46200000
*                                                                       46300000
SETVRFY  EQU   *                                                        46400000
*                                                                       46500000
         OI    MCSMASK,VERIFY           SET VERIFY = YES         A33665 46600020
*                                                                       46700000
*********************************************************************** 46800000
*                                                                       46900000
TSTNAME  EQU   *                                                        47000000
*                                                                       47100000
*********************************************************************** 47200000
*                                                                       47300000
*   TEST IF REPLY ID = REQUESTED ID                                     47400000
*        YES - TEST TO SEE IF OPERATOR SPECIFIED VERIFICATION OF A34950 47430020
*              IMAGE. (OPERATORS OPTIONS MIGHT BE DIFFERENT THAN A34950 47460020
*              USERS OPTIONS). IF NO, GO TO 191V. IF YES, FOLLOW A34950 47490020
*              SAME PATH AS IF NEW IMAGE.                        A34950 47520020
*                                                                A34950 47550020
*********************************************************************** 47600000
*                                                                       47700000
         CLC   DXUCSID,UCSID            CK FOR SAME ID'S         Y02072 47710002
         BE    XCTL191V                 IF EQUAL, GO LOAD IMAGE  Y02072 47720002
         MVC   DXUCSOPT,MCSMASK         SET LODE MODE            Y02072 50670002
         MVC   DXUCSID,UCSID            MOVE REPLIED UCS NAME    Y02072 50672002
         MVI   DXUCSSW1,0               RESET SWITCH             Y02072 50682002
         B     BLDLRTN                  GO ISSUE BLDL TO FIND IM Y02072 50772002
*                                                                       50822002
*********************************************************************** 50872002
*                                                                       50882002
*   WHEN OPERATOR REPLIES 'U', THE IMAGE CURRENTLY LOADED IS TO BE      50922002
*   USED.  GET THE IMAGE ID AND IMAGE OPTIONS FROM THE UCB AND          50972002
*   SET UP THE BLDL PARM LIST.                                          51022002
*                                                                       51032002
*********************************************************************** 51072002
*                                                                       51122002
BLDLSETU EQU   *                                                 Y02072 51172002
*                                                                       51222002
         L     RWK7,UCBXTADR            GET ADDR OF UCB/UCS XTN  Y02072 51272002
         USING UCBUCS,RWK7                                       Y02072 51322002
         MVC   DXUCSID,UCBUCSID         UCS IMAGE ID TO WORKAREA Y02072 51372002
         MVC   DXUCSOPT,UCBUCSOP        UCS OPTIONS TO WORKAREA  Y02072 51422002
         MVI   DXUCSSW1,0               RESET SWITCH             Y02072 51432002
         DROP  RWK7                                              Y02072 51472002
         B     CONTBLDL                 GO ISSUE BLDL            Y02072 51522002
*                                                                       60351020
ABEND08  EQU   *                                                 S20202 60354020
*                                                                       60357020
*********************************************************************** 60360020
*                                                                     * 60363020
*   PERMANENT I/O ERROR WAS FOUND WHEN BLDL WAS ISSUED TO LOCATE AN   * 60366020
*   UCS IMAGE IN SYS1.IMAGELIB RETURN CODE=X'08' IS STORED              60369020
*   ABEND SWITCH IS SET AND A XCTL IS MADE TO IGG0191V TO ABEND.      * 60372003
*   IF THE ERROR PERSISTS, RUN DIAGNOSTICS ON IMAGELIB VOLUME.        * 60378003
*   +368(REG.4) POINTS TO THE BLDL LIST                               * 60381020
*                                                                     * 60384020
*********************************************************************** 60387020
*                                                                       60390020
         MVI   DXABRETC,OABD070         MOVE INTERNAL CODE TO    Y02072 60390402
*                                       WKAREA                   S21042 60394021
         MVI   DXABEND,ABEND            SET ABEND FLAG           Y02072 60394402
*                                                                       60399020
*                                                                       60402020
*                                                                       60405020
XCTL191V EQU   *                                                 S20202 60408020
*                                                                       60411020
*********************************************************************** 60414020
*                                                                       60417020
*   XCTL TO NEXT EXECUTOR IGG0191V                                      60420020
*                                                                       60423020
*********************************************************************** 60426020
*                                                                       60429020
         LA    RF,MODNM1V               LOAD IDTTR NEXT EXECUTOR S20202 60432020
*                                                                       67200000
MVEIDTTR EQU   *                                                        67300000
*                                                                       67400000
*********************************************************************** 67500000
*                                                                       67600000
*   MOVE IDTTR TO XCTL WTG TABLE                                        67700000
*                                                                       67800000
*********************************************************************** 67900000
*                                                                       68000000
         USING WTGENTRY,RWTGC                                    Y02072 68050002
         MVC   WTGIDTTR,0(RF)           ST NEXT MOD ID IN WTG  @Z30TSCF 68060003
*                                                                       68200000
*********************************************************************** 68300000
*                                                                       68400000
RELOOP   EQU   *                                                        68500000
*                                                                       68600000
*********************************************************************** 68700000
*                                                                       68800000
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            68900000
*                                                                       69000000
*********************************************************************** 69100000
*                                                                       69200000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     69300000
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY     69400000
         CLC   0(2,RWTGC),AMIDCNST      IS THE RTN NEEDED AGAIN         69500000
         BCR   8,RBASE                  IF YES,RETURN TO PROCESS        69600000
*                                                                       69700000
         CLC   0(2,RWTGC),OPIDCNST      TEST END OF WTG TABLE           69800000
         BC    7,RELOOP                 IF NOT,CHECK NEXT ENTRY         69900000
*                                                                       70000000
         LR    RPARC,RPAR               RESET REG TO '0'                70100000
         LA    RWTGC,WAOFF(0,RWTG)      RESET WTG REG TO POINT +32(WTG) 70200000
ZCHECK   CLI   0(RWTGC),X'00'           TEST IF THIS ENTRY COMPLETE     70300000
         BC    7,TCTLRTN                IF NOT,XCTL                     70400000
*                                                                       70500000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY OF WTG TABLE     70600000
         LA    RPARC,PLOFF(0,RPARC)     GET NEXT ENTRY OF DCB           70700000
         BC    15,ZCHECK                GOTO TEST COMPLETION            70800000
*                                                                       70900000
TCTLRTN  EQU   *                                                        71000000
*                                                                       71100000
         USING WTG,RWTG                                                 71150003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*71200003
               MODID=WTGENTRY                                  @Z30TSCF 71250003
         DROP  RWTGC,RWTG                                      @Z30TSCF 71300003
*                                                                       71800000
         EJECT                                                          75100002
*********************************************************************** 75200000
*  'WTORTN' SUBROUTINE                                           Y02072 75250002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 75300002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 75350002
*                                                                       75400002
*    INPUT TO THIS ROUTINE:                                      Y02072 75450002
*      REG 12 - MESSAGE NUMBER IN CSECT                          Y02072 75460002
*      REG 13 - RETURN ADDRESS                                   Y02072 75470002
*                                                                       75480002
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 75490002
*      REG 1 - POINTER TO MESSAGE ENTRY IN THE MESSAGE CSECT     Y02072 75492002
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 75494002
*********************************************************************** 75500000
WTORTN   EQU   *                        ENTRY POINT, MSG RTN     Y02072 75550002
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 75560002
         LH    RWK2,0(RWK7,RWK5)        GET INDEX TO MESSAGE     Y02072 75570002
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 75580002
         USING MSGENTRY,RWK2                                     Y02072 75590002
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 75592002
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 75594002
*                                         ENTRY                  Y02072 75596002
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 75598002
         USING MSGTXTD,RWK3                                      Y02072 75598402
         SR    RWK7,RWK7                PREPARE REG FOR RETURN   Y02072 75598802
         IC    RWK7,MSGLNG              LEN OF MSG - 1           Y02072 75599202
         EX    RWK7,MVCINST             MOVE MESSAGE TO AREA     Y02072 75599602
         BR    RWK6                     RETURN                   Y02072 75599702
MVCINST  MVC   MSGAREA(0),MSGTXT        EXECUTED BY A EX INST    Y02072 75599802
         EJECT                                                          75599902
*                                                                       75600000
*   CONSTANTS                                                           75700000
*                                                                       75800000
*********************************************************************** 75900000
*                                                                       76000000
*   FOR WTG TABLE                                                       76100000
*                                                                       76200000
OPIDCNST DC    C'0S'                                                    76300000
AMIDCNST DC    C'1U'                                                    76400000
*                                                                       76600000
*   MESSAGE TEXT                                                        76700000
*                                                                       76800000
VERIFYCN DC    C'VERIFY'                REPLY=UCS,,VERIFY               77600000
FOLDCN   DC    C'FOLD'                  REPLY=UCS,FOLD                  77700000
CANCELCN DC    C'CANCEL'                REPLY='CANCEL'                  77800000
UBLANK   DC    C'U '                    REPLY = 'U'                     77900000
CBLANK   DC    C'C '                    REPLY = 'C'                     78000000
VBLANK   DC    C'V '                    VERIFY='V'                      78100000
UCSCONST DC    C'UCS1'                  UCS IMAGE ID PREFIX             78200000
BLANKS   DC    4C' '                    FOUR BLANKS              A33665 78250020
*   THE FIRST TWO BYTES OF A BLDL PARAMETER LIST IS THE NUMBER OF       78260003
*   ENTRIES THAT FOLLOW AND THE NEXT TWO BYTES SHOW THE LENGTH OF       78270003
*   EACH ENTRY.  IT MUST BE LONG ENOUGH FOR A 'LOAD' MACRO, BUT         78280003
*   NOT LONG ENOUGH TO OVERLAY OUR IMAGELIB DCB ADDRESS.                78290003
BLDLCNST DC    0CL4' ',YL2(1),YL2(DXIMGDCB-(DXBLDL+4))         @ZA01357 78300003
*                                                                       78400000
*********************************************************************** 78500000
*                                                                       78600000
*   XCTL TABLE                                                          78700000
*                                                                       78800000
*********************************************************************** 78900000
*                                                                       79000000
MODNM1V  DC    C'1V',VL3(IGG0191V)      MODULE IGG0191V        @Z30TSCF 79160003
         SPACE                                                          79180002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 79190002
END      EQU   *                        END OF MOKULE            Y02072 79192002
         IECDSECS  DCB,EXPAND=YES                                Y02072 80950002
         EJECT                                                          80960002
         IECDSECS MAIN,EXPAND=YES                                Y02072 81200002
         ORG   REPLYLTH+52                                       A33665 81640020
RPLY     DS    20C                                               A33665 81680020
RPLYECB  DS    F                                                 A33665 81720020
MCSMASK  DS    H                                                 A33665 81760020
LOMASK   DS    8C                                                A33665 81800020
UCSID    DS    4C                                                A33665 81840020
         ORG   MSGLSTSZ                                          Y02072 81850002
MSGAREA  DS    0CL64                    AREA TO MOVE 64 BYTES    Y02072 81860002
*                                         TO FOR WOT/WTOR'S      Y02072 81870002
         EJECT                                                          81880002
         IGGSCW                                                  Y02072 81882002
         EJECT                                                          81890002
         IGGMSG                                                  Y02072 81890402
         EJECT                                                          81890802
         IECDSECS  WTG,PREFX,EXPAND=YES                        @Z30TSCF 81892003
         ORG   WTGIDTTR                                          Y02072 81894002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 81896002
*                                                                       81900000
*********************************************************************** 82000000
*                                                                       82100000
SRT      DSECT                                                          82200000
         IEFUCBOB                                                       82300000
*                                                                       82400000
*********************************************************************** 82500000
*                                                                       82600000
CVT      DSECT                                                          82700000
         CVT                                                            82800000
*                                                                       82900000
*********************************************************************** 83000000
*                                                                       83100000
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          83200000
DEB      DSECT                                                          83300000
DEBNMSUB DS    0CL1                                                     83400000
DEBTCBAD DS    CL4                                                      83500000
DEBAMLNG DS    0CL1                                                     83600000
DEBDEBAD DS    CL4                                                      83700000
DEBOFLGS DS    0CL1                                                     83800000
DEBIRBAD DS    CL4                                                      83900000
DEBOPATB DS    0CL1                                                     84000000
DEBSYSPG DS    CL4                                                      84100000
DEBNMEXT DS    0CL1                                                     84200000
DEBUSRPG DS    CL4                                                      84300000
DEBPRIOR DS    0CL1                                                     84400000
DEBECBAD DS    CL4                                                      84500000
DEBPROTG DS    0CL1                                                     84600000
DEBDEBID DS    0CL1                                                     84700000
DEBDCBAD DS    CL4                                                      84800000
DEBEXSCL DS    0CL1                                                     84900000
DEBAPPAD DS    CL4                                                      85000000
DEBDVMOD DS    0CL1                                                     85100000
DEBUCBAD DS    CL4                                                      85200000
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     85300000
DEBBINUM DS    CL2                                                      85400000
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   85500000
DEBSTRCC DS    CL2                                                      85600000
DEBSTRHH DS    CL2                                                      85700000
DEBENDCC DS    CL2                                                      85800000
DEBENDHH DS    CL2                                                      85900000
DEBNMTRK DS    CL2                                                      86000000
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          86100000
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              86200000
DEBVOLSQ DS    H                                                        86300000
DEBVOLNM DS    H                                                        86400000
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     86500000
DEBSUBID DS    H                                                        86600000
*                                                                       86700000
*********************************************************************** 86800000
         IKJTCB                                                         86840001
*                                                                       86900000
         END                                                            87000000
./  ADD  SSI=52470070,NAME=IGG0191V
191V   TITLE 'IGG0191V -SAM && EXCP PRINTER UCS BUFFER LOADING'         00100003
IGG0191V CSECT                                                          00400000
*                                                                       00450002
*MODULE NAME - IGG0191V                                          Y02072 00500002
*                                                                       00510002
*DESCRIPTIVE NAME - SAM & EXCP PRINT UCS BUFFER LOADING                 00512003
*                                                                       00514002
*COPYRIGHT - NONE                                                Y02072 00516002
*                                                                       00518002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00518402
*                                                                       00518802
*          RELEASE 20 DELETIONS                                         00520000
*0216109000                                                      A38811 00525020
*0216609000-611000,615000,620000-621000,624000,627000,629000,    A33665 00530020
*0216632000,635000                                               A33665 00540020
*0216008000-015000,017000,028000-030000,035000,041000-042000,    S20202 00542020
*0216045000-048000,123000-133000,177000,189000,231000,235000,    S20202 00544020
*0216272000,284000-287000,316000-324000,443000-660000,693000,    S20202 00546020
*0216756000-759000,762000-763000,764000-772000,780000,786000     S20202 00548020
*0216109000                                                      M5148  00548520
*0216317800,318200-318500                                        M5143  00549020
*          RELEASE 21 DELETIONS                                         00550000
*0934125600-125800,319800,321600                                 M1803  00552021
*0934041000,136000,257000,439000,665000-667000,670000-680000,    S21042 00560021
*0934734000-738000,780000-786000,802000-803000                   S21042 00570021
*0934                                                            M0092  00575021
*A                                                               XM5898 00575101
*        VS2 RELEASE 02 DELETIONS                                       00625102
*001600-003400,007400,054000,106200-106600,162500,163500-163800, Y02072 00675102
*250000-253000,271800-271920,272120-272984,317700-318000,318100, Y02072 00725102
*343000,370060-370840,386050-386600,753000-763600,781000-791000, Y02072 00735102
*802000,405000,437000,441000,344000,750500-750900,752000         Y02072 00737102
*192390-192470,192500-192560                                     SM5451 00737502
*                                                                YM4697 00737902
*                                                                       00738303
*        VS2 RELEASE 3.0 CHANGES                                        00738703
*                                                              @Z30TSCF 00738803
*A733500                                                       @ZA04647 00739003
*        VS2 RELEASE 4.0 CHANGES                                        00739103
*A190200-191840,270200                                         @ZA02191 00739203
*C239000                             ABEND 0C4 IF UCS NOT RENT @ZA02191 00739403
*D192180-192250,203000-208000,219120,219400-219500             @ZA02191 00739603
*                                                                       00764603
*STATUS - SEE BEGINNING OF OBJECT CODE                                  00777303
*                                                                       00790002
*FUNCTION/OPERATION - EXECUTE UCS IMAGE LOAD INTO STORAGE AND THEN INTO 00800002
*                     UCS BUFFER                                        01050002
*                   - SET AUDIT TRAIL BIT FOR FORCE CLOSE        YM4697 01100002
*                     INDICATING LOAD ISSUED FOR UCS IMAGE       YM4697 01110002
*                   - RESET AUDIT TRAIL BITS TO INDICATE UCS     YM4697 01120002
*                     IMAGE DELETED AND IMAGELIB CLOSED          YM4697 01122002
*                   - UPDATE UCB TO REFLECT STATUS OF IMAGE IN BUFFER   01130020
*                     IF VERIFY NOT SPECIFIED                           01210020
*                   - DETERMINE NEXT OPEN EXECUTOR TO XCTL TO AND IF    01290020
*                     NECESSARY ISSUE MESSAGE IEC129 TO OPERATOR        01370020
*                   - CLOSE SYS1.IMAGELIB IF PRINTER IS 1403            01450003
*                                                                       01600000
*ENTRY POINT - ENTERED FROM IGG0191T OR IGG0191U BY USE OF IECRES MACRO 01700003
*                                                                       01800000
*INPUT - DCB ADDRESS                                                    01900000
*      - OPEN WORK AREA ADDRESS                                         02000000
*      - WHERE-TO-GO TABLE                                              02100000
*      - PARAMETER LIST                                                 02200000
*      - CURRENT ENTRY IN W-T-G TABLE                                   02300000
*      - CURRENT PARAMETER(DCB)                                         02400000
*      - THE ADDRESS OF UCS IMAGE RETRIEVED                             02500000
*      - THE ADDRESS OF SYS1.IMAGELIB DCB IN OPEN WORKAREA(DXCCW8)      02550020
*                                                                       02600000
*OUTPUT - UCS BUFFER LOAD                                               02700000
*       - UPDATED UCB TO REFLECT THE STATUS OF UCS BUFFER               03100002
*       - ISSUE REQUEST FOR OPERATOR TO SPECIFY FCB IMAGE               03130020
*                     'IEC129  XXX,SPECIFY ,FCB PARAMETERS'  MESSAGE    03160020
*       - ISSUE MESSAGE 'IEC126I XXX, UNCORRECTABLE ERROR        Y02072 03170002
*                       LOADING UCS BUFFER'                      Y02072 03180002
*                                                                       03200000
*EXTERNAL REFERENCES - MESSAGE CSECT                             Y02072 03300002
*                                                                       03400000
*EXIT - NORMAL - XCTL TO ONE OF THE FOLLOWING MODULES:           Y02072 03410002
*               *IGG0197U IF UCS IMAGE TO BE VERIFIED            Y02072 03460002
*               *IGG0197E IF AN FCB IMAGE IS TO BE LOADED               03520020
*               *IGG01911 IF THE DCB IS EXCP.                    Y02072 03600002
*               *IGG0191I IF BUFFER CNTRL BLOCK IS SPECIFIED.           03700000
*               *IGG0191G IF NORMAL SCHEDULING IS SPECIFIED.            03800000
*               *IGG0191Q IF CHAINED SCHEDULING IS SPECIFIED.           03900000
*                                                                       04000000
*EXIT - ERROR - XCTL TO PROBLEM DETERMINATION FOR WTP AND B13 ABEND     04060021
*               FOR ONE OF THE FOLLOWING:                               04120002
*              *MODULE IGG0191U SET SWITCH TO ABEND                     04200020
*              *PERMANENT I/O ERROR OCCURED DURING UCS BUFFER LOAD.     04300000
*                                                                       04900000
*TABLES/WORK AREAS - WHERE-TO-GO TABLE (SEE WTGTABLE IN THIS LISTING)   05000003
*                  - OPEN WORK AREA (SEE IECDSECT IN THIS LISTING)      05200000
*                                                                       05250002
*MACROS-ACTION:MODESET, LOAD, EXCP, WAIT,DELETE, XCTL, DMABCOND, Y02072 05260002
*              XCTLTABL                                          Y02072 05270002
*                                                                       05280002
*MACROS-MAPPING:IEFUCBOB, IGGMSG, IECDSECS(WTG,MAIN),DCBD,IGGSCW Y02072 05290002
*               IHAFCAUD                                         YM4697 05292002
*                                                                       05300000
*ATTRIBUTES - REENTRANT, REFRESHABLE, RUNS IN DATA MANAGEMENT KEYY02072 05400003
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 05450002
*                                                                       05500000
*NOTES - EXCP/WAIT SVCS ARE USED TO LOAD UCS BUFFER AND WRITE IMAGE     05600002
*        ON THE PRINTER FOR VERIFICATION.                               05700000
*      - DELETE SVC IS USED TO DELETE THE RETRIEVED IMAGE.              05800000
*      - WTOR SVC IS USED TO REQUEST OPERATOR REPLY                     05900000
*      - IOB/ECB IN OPEN WORK AREA IS USED FOR EXCP                     06000000
*      - THE REPLY IS ORED TO ALLOW LOWER CASE ALPHA                    06100000
*      - SVC (105) IS USED TO DELETE DCB AND DEB OF SYS1.IMAGELIB       06150003
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 06170002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 06180002
*                                                                       06200000
*********************************************************************** 06300000
*                                                                       06400000
         EJECT                                                          06500000
*                                                                       06600000
*********************************************************************** 06700000
*                                                                       06800000
*   REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES               06900000
*                                                                       07000000
*********************************************************************** 07100000
*                                                                       07200000
*                                                                       07300000
RE       EQU   0                        WORK/PARAMETER REGISTER         07400000
RF       EQU   1                        WORK/PARAMETER REGISTER         07500000
RWK2     EQU   RF                       WORK REGISTER            Y02072 07550002
RDCB     EQU   2                        ADDR OF USER'S DCB              07600000
RBASE    EQU   3                        BASE REGISTER                   07700000
RCORE    EQU   4                        ADDR OF OPEN WORK AREA          07800000
RPAR     EQU   5                        PARAMETER LIST                  07900000
RWTG     EQU   6                        START OF WTG                    08000000
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 08100000
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      08200000
RWK3     EQU   9                        WORK REGISTER            Y02072 08300002
RUCB     EQU   10                       UCB ADDR/WORK REGISTER          08400000
RDEB     EQU   11                       DEB ADDR                        08500000
RWK6     EQU   RDEB                     WORK REGISTER            Y02072 08550002
RB       EQU   12                       WORK REGISTER/BREG FOR DSECT    08600000
RC       EQU   13                       WORK REGISTER                   08700000
RD       EQU   14                       WORK/PARAMETER REGISTER         08800000
RJ       EQU   15                       WORK/PARAMETER REGISTER         08900000
RWK7     EQU   RJ                       WORK REGISTER            Y02072 08950002
*                                                                       09000000
*********************************************************************** 09100000
*                                                                       09200000
*                                                                       09300000
*   EQUATE WTG OFFSET                                                   09400000
*                                                                       09500000
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   09600000
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   09700000
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TBL  09800000
*                                                                       09900000
*   EQUATE ABEND CODE AND RETURN CODE                                   10000000
*                                                                       10100000
PCIMASK  EQU   X'20'                    OPTCD=PCI SPECIFIED             10700000
BFCNTRL  EQU   X'01'                    BUFFER CNTRL BLOCK SPECIFIED    10800000
EXCPMASK EQU   X'80'                    LOAD EXCP                A38811 10900020
UNRLMASK EQU   X'42'                    IOB IS UNRELATED AND C.C.       11000000
NULL     EQU   X'00'                    X'00'                           11100000
CNTRLMSK EQU   X'EB'                    COMMAND CODE = CNTRL            11200000
SILIMASK EQU   X'60'                    C.C. AND SILI ON                11300000
ONEMASK  EQU   X'01'                    X'01'                           11400000
UCSLNGTH EQU   X'F0'                    UCS IMAGE LENGTH                11500000
TWOMASK  EQU   X'02'                    X'02'                           11600000
UNFLCCW  EQU   X'FB'                    COMMAND CODE = LOAD NO FOLD     11700000
FLDCCW   EQU   X'F3'                    COMMAND CODE = LOAD FOLD        11800000
FOLDMASK EQU   X'40'                    LOAD MODE = FOLD                11900000
VERIFY   EQU   X'10'                    VERIFY = YES                    12000000
RESETMSK EQU   X'CF'                    RESET VERIFY                    12100000
*                                                                       12220020
*   EQUATES FOR SYS1.IMAGELIB SUPPORT AND 3211 PRINTER SUPPORT          12240020
*                                                                       12260020
PARITYER EQU   X'01'                    BUFFER PARITY ERR        Y02072 12270002
*                                         IN UCSB                Y02072 12272002
ABEND    EQU   X'FF'                    1U ABEND SWITCH          S20202 12280020
NONZERO  EQU   X'01'                    NON-ZERO BYTE COUNT      SM5451 12410002
SILIMSK  EQU   X'20'                    SILI FLAG FOR CCW'S      SM5451 12420002
UCSLDCC  EQU   X'FB'                    UCS LOAD COMMAnD         S20202 12440020
ABENDBIT EQU   X'80'                    ABEND IN PROCESS SWITCH  S20202 12480020
UCSFLDCC EQU   X'43'                    COMMAND CODE = FOLD UCS  S20202 12600020
UCSUNFLD EQU   X'23'                    COM CODE TO UNFOLD UCS   SM5451 12610002
PRTM3211 EQU   X'09'                    MASK FOR 3211 PRINTER    S20202 12620020
IEC129RQ EQU   X'80'                    MESSAGE IECU29D REQUIRED S20202 12640002
*                                       MASK                     S20202 12660020
UCSIDOFS EQU   X'00'                    UCS OFFSET FROM START    S20202 12680020
*                                       UCB WK A                 S20202 12700020
UCSOPOFS EQU   X'04'                    UCS OPTIONS OFFSET       S20202 12720020
IMCLOSED EQU   X'FF'                    FLAG SET FOR IMAGELIB    S20202 12840020
*                                         NOT OPEN                      12890002
K1       EQU   1                        CONSTANT EQUATED TO 1    S20202 12920020
K2       EQU   2                        CONSTANT EQUATED TO 2    S20202 12940020
K4       EQU   4                        CONSTANT EQUATED TO 4    S20202 12980020
K6       EQU   6                        CONSTANT EQUATED TO 6    S20202 13020020
K8       EQU   8                        CONSTANT EQUATED TO 8    S20202 13060020
K35      EQU   35                       CONSTANT EQUATED TO 35   S20202 13280020
OABD069  EQU   69                                                S21042 13650021
*  THE FOLLOWING MESSAGE NUMBERS ARE EQUAL TO THEIR POSITION     Y02072 13652002
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 13654002
*  OF AN INDEX)                                                  Y02072 13656002
MSG126   EQU   10*2                     MESSAGE NO IN MSG CSECT  Y02072 13660002
MSG129   EQU   3*2                      MESSAGE NO IN MSG CSECT  Y02072 13670002
*                                                                       13700000
*********************************************************************** 13800000
*                                                                       13900000
*   HOUSE KEEPING                                                       14000000
*                                                                       14100000
*********************************************************************** 14200000
*                                                                       14300000
         BALR  RBASE,0                                                  14400000
         USING *,RBASE                                                  14500003
         USING IHADCB,RDCB                                              14600000
         USING FORCORE,RCORE                                            14700000
         USING DEB,RDEB                                                 14800000
         USING UCBOB,RUCB                                               14900000
*                                                                       15000000
*                                                                       15200000
*                                                                       15400000
*********************************************************************** 15500000
*                                                                       15600000
*   INITIALIZE REGISTERS                                                15700000
*                                                                       15800000
*********************************************************************** 15900000
*                                                                       16000000
         B     AROUND                   BR AROUND CONSTANTS      Y02072 16050002
         DC    C'IGG0191V'              MODULE NAME              Y02072 16060002
         DC    C' ZA02191'              LAST SHIP CODE         @ZA02191 16070003
         DC    C' 7/29/75'              LAST DATE MODIFIED     @ZA02191 16080003
AROUND   DS    0H                                                Y02072 16090002
*                                                                       16092002
         L     RDCB,0(RPARC)            LOAD CURRENT DCB ADDR           16100000
         L     RCORE,4(RWTGC)           LOAD CURRENT WORK AREA ADDR     16200000
         L     RDEB,DCBDEBAD            LOAD DEB ADDR                   16300000
         L     RUCB,DEBUCBAD            LOAD UCB ADDR                   16400000
         DROP  RDEB                                              Y02072 16450002
*                                                                       16500000
*                                                                       16503020
*********************************************************************** 16504020
*                                                                       16505020
*   THIS ROUTINE TESTS FLAG BYTES SET BY IT OR 1U TO DETERMINE WHAT     16506002
*   ACTIONS ARE TO BE TAKEN BY THIS MODULE                              16507002
*                                                                       16508020
*********************************************************************** 16509020
*                                                                       16510020
         CLI   DXSTAGE2,0               IF NOT ZERO, ENTRY IS TO Y02072 16512002
*                                         XCTL TO 2ND STAGE EXEC Y02072 16514002
*                                         (COMPOSITE CONSOLES)   Y02072 16514402
         BNE   TSTEXCP                  GO XCTL TO 2ND STG EXEC  Y02072 16516002
         CLI   DXABEND,ABEND            ABEND SWITCH ON          Y02072 16516402
         BE    ABENROUT                 GO SET ABEND CODE        S20202 16518020
*                                                                       16528020
*********************************************************************** 16529020
*                                                                       16530020
*   LOAD UCS IMAGE FROM SYS1.IMAGELIB                                   16531020
*                                                                       16532020
*********************************************************************** 16533020
*                                                                       16534020
         LA    RE,DXBLDLIM              LOAD BLDL LIST ADDR      Y02072 16534402
*                                                                       16536020
         L     RF,DXIMGDCB              GET ADDR OF IMAGELIB     Y02072 16536403
*                                       DCB                      S20202 16538020
*                                                                       16539020
         LOAD  DE=(0),DCB=(1)           LOAD UCS SET FROM        S20202 16540020
*                                       SYS1.IMAGELIB            S20202 16541003
*                                                                       16542020
         LR    RB,RE                    RETAIN LOAD ADDR IN REG. S20202 16543020
*                                       RB                       S20202 16544020
         MVC   DXSAVUCS,DXBLDLIM        SAVE UCS IMAGE NAME      Y02072 16546402
         OI    FCAOPEN2,FCAOUCSL        INDIC UCS IMAGE LOADED   YM4697 16596402
*                                                                       16600000
*********************************************************************** 16700000
*                                                                       16800000
*   SET UP DXCCW1 FOR EXCP TO LOAD UCSB                          Y02072 16900002
*                                                                       17000000
*********************************************************************** 17100000
*                                                                       17200000
         MVI   IOBFLAG1,UNRLMASK        SET IOBFLAG= C.C/UNRELATED 'ON' 17300000
         XC    DXCCW1(16),DXCCW1        RESET CCW AREA TO X'00'         17400000
*                                                                       17800000
*                                                                       18200000
*********************************************************************** 18300000
*                                                                       18400000
*   WHEN UCS IS TO BE LOADED, BUILD CCWS IN WORK AREA                   18500003
*                                                                       18600000
*********************************************************************** 18700000
*                                                                       18800000
         LA    RC,TWOMASK               LOAD NUMBER OF RETRIES   S20202 18900020
*                                                                       19000000
*      WE NOW MUST GET INTO PROTECTION KEY ZERO TO ACCESS THE UCS       19020003
* IMAGE BECAUSE THE USER MAY HAVE LINK EDITED IT INTO SYS1.IMAGELIB     19040003
* WITHOUT THE 'RENT' ATTRIBUTE, AND IT THEREFORE HAS BEEN LOADED        19060003
* INTO VIRTUAL STORAGE IN THE USER'S KEY ACCORDING TO TCBPKF.  IT       19080003
* WOULD BE FETCH PROTECTED.                                             19100003
         MODESET EXTKEY=SUPR           GET INTO PROT.KEY ZERO  @ZA02191 19120003
         SR    RF,RF                   PREPARE TO GET LINE NUM @ZA02191 19160003
         IC    RF,1(RB)                GET NUM OF VERIFY LINES @ZA02191 19180003
         LA    RE,2(RF,RB)             PT TO REAL UCS IMAGE    @ZA02191 19184003
*                                                                       19200000
*********************************************************************** 19201020
*                                                                       19202020
*   DETERMINE WHICH CCW CHAIN IS TO BE GENERATED TO LOAD THE UCS        19203020
*   (1) FOR 1403/2821 THE SEQ IS A GATE LOAD FOLLOWED BY A LOAD OR      19204020
*       LOAD AND FOLD.                                                  19205020
*   (2) FOR 3211/3811 THE SEQUENCE IS A LOAD FOLLOWED BY A FOLD OR      19206020
*       JUST A LOAD COMMAND                                             19207020
*                                                                       19208020
*********************************************************************** 19209020
*                                                                       19210020
         CLI   UCBTBYT4,PRTM3211        CK IF DCB BEING OPENED   S20202 19211020
*                                       FOR 321                  S20202 19212020
         BNE   GOCNSTGL                 NO GO CONSTRUCT GATE     S20202 19213020
*                                       LOAD SEQ.                S20202 19214020
*                                       YES FALLS THROUGH TO FORM LOAD  19215020
*                                       OR LOAD AND FOLD CCW'S          19216020
*                                                                       19217020
*                                                                       19226020
*   BUILD CCW'S TO LOAD UCS BUFFER FOR 3211/3811                        19227020
*                                                                       19228020
         ST    RE,DXCCW1                STORE ADDRESS OF IMAGE   S20202 19229020
*                                       IN CCW                   S20202 19230020
         MVI   DXCCW1,UCSLDCC           MOVE LOAD UCS COMMAND CD S20202 19231020
*                                       TO CC                    S20202 19232020
         MVC   DXCCW1+K6(K2),UCSLTHEX   MOVE LENGTH OF UCS TO    S20202 19233020
*                                       CCW                      S20202 19234020
         MVI   DXCCW1+K4,SILIMASK       SET CCW FLAGS FOR CC AND S20202 19235020
*                                       SILI                     S20202 19236020
*                                                                       19236402
*  FORM CCW TO FOLD OR UNFOLD UCS IMAGE SM5451                          19236802
*                                                                       19236902
         MVI   DXCCW2+7,NONZERO         NON-ZERO COUNT TO CCW    SM5451 19239002
         MVI   DXCCW2+4,SILIMSK         SET SILI FLAG            SM5451 19241002
         MVI   DXCCW2,UCSFLDCC          ASSUME FOLDING OF IMAGE  SM5451 19243002
         TM    DXUCSOPT,FOLDMASK        CK IF FOLD SPEC FOR      Y02072 19243102
*                                       UCS                      S20202 19245402
         BO    EXCPGOGO                 YES, GO ISSUE EXCP TO    SM5451 19247402
*                                         LOAD + FOLD IMAGE      SM5451 19247602
         MVI   DXCCW2,UCSUNFLD          NO, RESET COM CODE TO    SM5451 19247702
*                                         UNFOLD IMAGE           SM5451 19247802
         B     EXCPGOGO                 GO ISSUE EXCP TO LOAD    SM5451 19247902
*                                                                       19285302
*   BUILD CCW'S TO LOAD UCS BUFFER FOR PRINTERS USING 2821 CONTROL UNIT 19287402
*                                                                       19289502
GOCNSTGL EQU   *                                                 S20202 19291602
*                                                                       19293702
*   CONSTRUCT CONTROL COMMAND                                           19295802
*                                                                       19297902
         MVI   DXCCW1,CNTRLMSK          COMMAND CODE = GATE LOAD        19300000
         MVI   DXCCW1+4,SILIMASK        SET SILI AND C.C ON             19400000
         MVI   DXCCW1+7,ONEMASK         SET LENGTH=X'01'                19500000
*                                                                       19800000
*   CONSTRUCT LOAD COMMAND                                              19900000
*                                                                       20000000
         MVI   DXCCW2+7,UCSLNGTH        MOVE UCS IMAGE LENGTH = 240     20100000
*                                                                       20200000
         ST    RE,DXCCW2                STORE UCS ADDR IN CCW           20900003
*                                                                       21000000
         MVI   DXCCW2,UNFLCCW           COMMAND CODE = LOAD UCS,UNFOLD  21100000
*                                                                       21200000
         TM    DXUCSOPT,FOLDMASK        TEST IF FOLD IS SPEC     Y02072 21250002
         BC    14,EXCPGOGO              IF NOT,GOTO EXCP ROUTINE        21400000
*                                                                       21500000
         MVI   DXCCW2,FLDCCW            COMMAND CODE = LOAD UCS,FOLD    21600000
*                                                                       21700000
EXCPGOGO EQU   *                                                        21800000
*                                                                       21900000
         L     RF,UCBXTADR              LOAD UCB EXTENSION ADDR  M0092  21910021
         MVC   UCBUCSID-UCBUCSID(4,RF),DXUCSID   PUT UCS IMAGE ID       21922003
*                                       IN UCB EXTENSION AREA           21930003
         LA    RF,DXIOB                 LOAD IOB ADDR IN REG.1          22000000
         EXCP  (1)                                                      22100000
*                                                                       22200000
         WAIT  ECB=DXECB                WAIT ON THE ABOVE EXCP          22400003
*                                                                       22500000
         CLI   DXECB,X'7F'              TEST COMP CODE OF ABOVE EXCP    22600000
         BC    8,UCSVRFY                IF YES,GOTO TEST VERIFY OPTION  22700000
*                                                                       22800000
*********************************************************************** 22900000
*                                                                       23000000
*   IF ERROR ,REPEAT UCS LOAD EXCP ONE TIME                             23100020
*                                                                       23200000
*********************************************************************** 23300000
*                                                                       23400000
         BCT   RC,EXCPGOGO              IF ERROR REPEAT ONCE     S20202 23500020
*                                                                       23600000
*********************************************************************** 23700000
*                                                                       23800000
         MODESET EXTKEY=DATAMGT         GET BACK IN OUR KEY    @ZA02191 23900003
*                                                                       24000000
*********************************************************************** 24100000
*                                                                       24200000
*   WHEN THERE WAS AN I/O ERROR DURING LOAD UCS,UPDATE UCB WITH X'00'   24300000
*   TO SHOW NO IMAGE IN THE BUFFER.RETURN CODE = X'0C' IN REG.15        24400000
*   WTO 'IEC126I XXX UCS PARITY ERROR.COMP CODE=B13' TO AN OPERATOR     24500000
*   RUN C.E. DIAGNOSTICS FOR THE UCS FEATURE.                           24600000
*   +280(REG.4) POINTS TO THE IOB USED FOR THE EXCP ABOVE.              24700000
*                                                                       24800000
*********************************************************************** 24900000
         LA    RWK3,MSG126              MESSAGE NO FOR MSG RTN   Y02072 24910002
         BAL   RWK6,GETMSG              GO GET MESSAGE           Y02072 24920002
         LA    RF,MSGLSTSZ              LOAD WTO ADDR                   25400000
         SVC   35                       ISSUE WTO SVC                   25500000
*                                                                       25600000
         LA    RB,OABD069               INTERNAL CODE 69         S21042 25700021
*                                                                       25800000
         BC    15,UPUCBEND              GOTO UPDATE UCB WITH X'00'      25900000
*                                                                       26000000
*********************************************************************** 26100000
*                                                                       26200000
UCSVRFY  EQU   *                                                        26300000
*                                                                       26400000
*********************************************************************** 26500000
*                                                                       26600000
*   TEST IF VERIFY OPTION IS SPECIFIED.                                 26700000
*                                                                       26800000
*********************************************************************** 26900000
*                                                                       27000000
         MODESET EXTKEY=DATAMGT         GET BACK IN OUR KEY    @ZA02191 27020003
         TM    DXUCSOPT,VERIFY          TEST IF VERIFY IS SPEC   Y02072 27050002
         BC    K8,UPDTUCB               IF NO GO UPDATE UCB-UCS  S20202 27110002
*                                       FIELDS                   S20202 27120020
*                                                                       27130020
*   VERIFY SPECIFIED GO LOAD ADDRESS IGG0197U AND XCTL                  27140020
*                                                                       27150020
*                                                                       27160020
         LA    RF,MODNM7U               LOAD ' MOD IGG0197U      S20202 27200020
         B     MVEIDTTR                 GO TO WTG SEQUENCE       S20202 27210020
*                                                                       27300000
*********************************************************************** 27400000
*                                                                       27500000
UPDTUCB  EQU   *                                                        27600000
*                                                                       27700000
*********************************************************************** 27800000
*                                                                       27900000
*   UPDATE UCB - UCS FIELDS                                             28000000
*                                                                       28100000
*********************************************************************** 28200000
*                                                                       28300000
         L     RJ,UCBXTADR              GET ADDRESS OF UCB       S20202 28350020
*                                       EXTENTION                S20202 28400020
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 28410002
         SPACE                                                          28420002
         MVC   UCSOPOFS(1,RJ),DXUCSOPT  MVOE UCS OPTION BITS     Y02072 28510002
*                                       TO UCB                   S20202 28600020
         OC    UCSOPOFS(K1,RJ),NULL(RB) SET DEFAULT BIT IF ANY   S20202 28650020
         NI    UCSOPOFS(RJ),RESETMSK    RESET VERIFY IF ANY      S20202 28700020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 28750002
*                                                                       30178020
*********************************************************************** 30200000
*                                                                       30300000
*   DELETE UCS IMAGE                                                    30400000
*                                                                       30500000
*********************************************************************** 30600000
*                                                                       30700000
         LA    RE,DXSAVUCS              LOAD ADDR OF ENTRY PT    Y02072 30750002
*                                                                       30900000
         DELETE EPLOC=(0)               DELETE UCS IMAGE                31000000
         NI    FCAOPEN2,X'FF'-FCAOUCSL  INDIC IMAGE DELETED      YM4697 31050002
*                                                                       31100000
*********************************************************************** 31200000
*                                                                       31510020
UCSEXIT  EQU   *                                                 S20202 31520020
*                                                                       31530020
         CLI   UCBTBYT4,PRTM3211        IF NOT 3211, GO TO 2ND   Y02072 31530402
*                                         STAGE EXECUTOR         Y02072 31530802
         BNE   RESTERPT                 GO RESTORE DCB EROPT     Y02072 31531202
         MVI   DXFLAG1,0                RESET FCB SW TO BE USED  Y02072 31532002
*                                       BY IGG0197E                     31560002
         TM    DXFCBSW1,IEC129RQ        CK IF IEC129 MSG REQ     Y02072 31582002
         BNO   XCTL197E                 NO GO LOAD FCB IMAGE IN  S20202 31670003
*                                       IGG0197E                 S20202 31680002
*                                                                       31690020
**********************************************************************  31700020
*                                                                       31710020
*        ISSUE MESSAGE IEC129 AND XCTL TOIGG0197E                       31720020
*                                                                       31730020
**********************************************************************  31740020
*                                                                       31750020
         LA    RWK3,MSG129              MESSAGE NO FOR MSG RTN   Y02072 31810002
         BAL   RWK6,GETMSG              GO GET MESSAGE           Y02072 31820002
         XC    RPLY(24),RPLY           CLEAR REPLY AREA AND ECB  M5143  31830020
*                                       COMPLETE                 S20202 31860020
         LA    RF,REPLYLTH              GET ADDR FOR WTOR        S20202 31870020
         SVC   K35                      ISSUE WTOR IEC129        S20202 31880020
*                                                                       31890020
XCTL197E EQU   *                                                 S20202 31900020
*                                                                       31910020
         LA    RF,MODNM7E               GET IDTTR ADDR OF        S20202 31920020
*                                       IGG0197E                 S20202 31930003
         B     MVEIDTTR                 GO TO WTG SEQ            S20202 31940020
*********************************************************************** 32060020
*                                                                       32070020
*   RESTORE DCB EROPT                                                   32080020
*                                                                       32090020
*********************************************************************** 32100020
*                                                                       32110020
RESTERPT EQU   *                                                 S20202 32120020
*                                                                       32130020
         MVC   DXCCW6(1),DXEROPT        MOVE IN DCB EROPT        Y02072 32164002
*                                                                       32180020
*                                                                       32190020
*   SEE IF SYS1.IMAGELIB HAS BEEN OPENED IF YES CLOSE IT                32200020
*                                                                       32210020
         CLI   DXIMGDCB,IMCLOSED        CK IF IMAGELIB CLOSED    Y02072 32212003
         BE    TSTEXCP                  IF NOT GO TEST IF EXCP   S20202 32230020
*                                       SPECIFED                 S20202 32240003
*                                                                       32250020
         L     RF,DXIMGDCB              GET ADDR OF IMAGELIB     Y02072 32252003
*                                       DCB                      S20202 32270020
         SVC   105                      ISSUE SVC TO CLOSE       S20202 32280020
*                                       SYS1.IMAGEL              S20202 32290020
         NI    FCAOPEN2,X'FF'-FCAOIMGL  INDIC IMAGELIB CLOSED    YM4697 32340002
*                                                                       32500000
*********************************************************************** 32600000
*                                                                       32700000
*   DETERMINE THE NEXT STAGE 2 EXECUTOR TO BE XCTLED                    32800000
*                                                                       32900000
*********************************************************************** 33000000
*                                                                       33100000
TSTEXCP  EQU   *                                                        33200000
*                                                                       33300000
*********************************************************************** 33400000
*                                                                       33500000
*   TEST IF EXCP IS SPECIFIED.IF YES,XCTL TO THE LAST OPEN EXECUTOR     33600000
*                                                                       33700000
*********************************************************************** 33800000
*                                                                       33900000
         TM    DCBMACRF,EXCPMASK        TEST IF EXCP IS SPECIFIED       34000000
         BC    14,TSTBLKBF              IF NOT,GOTO BUFFER CNTRL BLK    34100000
*                                                                       34200000
         LA    RF,MODNM11               GO DO DCB COPY BACK      Y02072 34210002
         BC    15,MVEIDTTR              GOTO WTG TABLE UPDATE    Y02072 34400002
*                                                                       34500000
*********************************************************************** 34600000
*                                                                       34700000
TSTBLKBF EQU   *                                                        34800000
*                                                                       34900000
*********************************************************************** 35000000
*                                                                       35100000
*   TEST IS BUFFER CONTROL BLOCK IS SPECIFIED.IF YES,XCTL TO IGG0911I   35200000
*                                                                       35300000
*********************************************************************** 35400000
*                                                                       35500000
         TM    DCBBUFNO+3,BFCNTRL       BUFFER CONTROL BLOCK SPECIFIED  35600000
         BC    14,TSTPCI                IF YES,GOTO TEST PCI ROUTINE    35700000
*                                                                       35800000
         CLI   DCBBUFNO,0               SEE IF BUFFER POOL REQUESTED    36000003
         BE    TSTPCI                   IF YES, GO TO TEST CH. SCHED.   36200003
*                                                                       36300000
         LA    RF,MODNM1I               LOAD ADDR OF IDTTR OF IGG0191I  36400000
         BC    15,MVEIDTTR              GOTO MOVE IDTTR ROUTINE         36500000
*                                                                       36600000
*********************************************************************** 36700000
*                                                                       36800000
TSTPCI   EQU   *                                                        36900000
*                                                                       37000000
*********************************************************************** 37100000
*                                                                       37200000
*   TEST IF CHAINED SCHEDULING IS REQUESTED.  IF YES, XCTL TO IGG0191Q. 37300003
*                                                                       37400000
*********************************************************************** 37500000
*                                                                       37600000
         TM    DCBOPTCD,PCIMASK         TEST IF CHAINED SCHED.REQUESTED 37700003
         BC    14,BQSAMOUT              IF NOT,GOTO BSAM/QSAM ROUTINE   37800003
*                                                                       37900000
         LA    RF,MODNM1Q               LOAD ADDR OF IDTTR OF IGG0191Q  38000000
         BC    15,MVEIDTTR              GOTO MOVE IDTTR ROUTINE         38100000
*                                                                       38200000
*********************************************************************** 38300000
*                                                                       38400000
BQSAMOUT EQU   *                                                        38500000
*                                                                       38600000
*********************************************************************** 38700000
*                                                                       38800000
*   BSAM/QSAM EXIT.XCTL TO IGG0191G                                     38900000
*                                                                       39000000
*********************************************************************** 39100000
*                                                                       39200000
         LA    RF,MODNM1G               LOAD ADDR OF IDTTR IF IGG0191G  39300000
*                                                                       39400000
*********************************************************************** 39500000
*                                                                       39600000
MVEIDTTR EQU   *                                                        39700000
*                                                                       39800000
*********************************************************************** 39900000
*                                                                       40000000
*   MOVE IDTTR TO XCTL WTG TABLE                                        40100000
*                                                                       40200000
*********************************************************************** 40300000
*                                                                       40400000
         USING WTGENTRY,RWTGC                                    Y02072 40450002
         MVC   WTGIDTTR,0(RF)         ST NEXT MODULE ID IN WTG @Z30TSCF 40460003
*                                                                       40600000
*********************************************************************** 40700000
*                                                                       40800000
RELOOP   EQU   *                                                        40900000
*                                                                       41000000
*********************************************************************** 41100000
*                                                                       41200000
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            41300000
*                                                                       41400000
*********************************************************************** 41500000
*                                                                       41600000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     41700000
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY     41800000
         CLC   0(2,RWTGC),AMIDCNST      IS THE RTN NEEDED AGAIN         41900000
         BCR   8,RBASE                  IF YES,RETURN TO PROCESS        42000000
*                                                                       42100000
         CLC   0(2,RWTGC),OPIDCNST      TEST END OF WTG TABLE           42200000
         BC    7,RELOOP                 IF NOT,CHECK NEXT ENTRY         42300000
*                                                                       42400000
         LR    RPARC,RPAR               RESET REG TO '0'                42500000
         LA    RWTGC,WAOFF(0,RWTG)      RESET WTG REG TO POINT +32(WTG) 42600000
ZCHECK   CLI   0(RWTGC),X'00'           TEST IF THIS ENTRY COMPLETE     42700000
         BC    7,TCTLRTN                IF NOT,XCTL                     42800000
*                                                                       42900000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY OF WTG TABLE     43000000
         LA    RPARC,PLOFF(0,RPARC)     GET NEXT ENTRY OF DCB           43100000
         B     ZCHECK                   GO CHECK NEXT ENTRY      XM5898 43150001
TCTLRTN  EQU   *                                                        43498801
*                                                                       43500000
         USING WTG,RWTG                                                 43550003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*43600003
               MODID=WTGENTRY                                  @Z30TSCF 43650003
         DROP  RWTGC,RWTG                                      @Z30TSCF 43700003
*                                                                       44200000
*   IF THE I/O ERROR PERSISTS,RUN C.E. DIAGNOSTICS ON THE PRINTER       66100000
*                                                                       66200000
*********************************************************************** 66300000
*                                                                       66400000
*                                                                       66710020
ABENROUT EQU   *                                                 S20202 66720020
*                                                                       66730020
         SR    RB,RB                    ZERO OUT REG 12          S20202 66740020
         IC    RB,DXABRETC              PUT COMP CODE INTO       Y02072 66742002
*                                       REG 1                    S20202 66760020
         B     ABENDRTN                 GO TO ABEND ROUTINE      S20202 66770020
*********************************************************************** 66800000
*                                                                       66900000
*                                                                       68100000
*********************************************************************** 68200000
*                                                                       68300000
UPUCBEND EQU   *                                                        68400000
*                                                                       68500000
*********************************************************************** 68600000
*                                                                       68700000
*   UPDATE THE UCB WITH X'00' TO INDICATE THAT THE IMAGE IN THE BUFFER  68800000
*   IS NOT USABLE                                                       68900000
*                                                                       69000000
*********************************************************************** 69100000
*                                                                       69200000
         L     RJ,UCBXTADR              GET ADDRESS OF UCB       S20202 69250020
*                                       EXTENTION                S20202 69300020
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 69310002
         SPACE                                                          69320002
         USING UCBUCS,RJ                                         Y02072 69330002
         XC    UCBUCSID,UCBUCSID        CLR UCS IMAGE ID         Y02072 69344002
         NI    UCBUCSOP,PARITYER        LEAVE PAR ER BIT ON      Y02072 69346002
*                                         IF ON                  Y02072 69348002
         DROP  RJ                                                Y02072 69358002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 69360002
*                                                                       71100000
*********************************************************************** 71200000
*                                                                       71300000
*   DELETE THE UCS IMAGE LOADED                                         71400000
*                                                                       71500000
*********************************************************************** 71600000
*                                                                       71700000
         LA    RE,DXSAVUCS              LOAD ADDR OF IMAGE ID    Y02072 71750002
         DELETE EPLOC=(0)                                               71900000
         NI    FCAOPEN2,X'FF'-FCAOUCSL  INDIC UCS IMAGE DELETED  YM4697 71950002
*                                                                       72000000
*********************************************************************** 72100000
*                                                                       72200000
ABENDRTN EQU   *                                                        72300000
*                                                                       72400000
*********************************************************************** 72500000
*                                                                       72600000
*   ABEND ROUTINE.COMPLETION CODE=B13.RETURN CODE IS IN REG15.          72700000
*                                                                       72800000
*********************************************************************** 72900000
*                                                                       73000000
         TM    DXNABEND,ABENDBIT         TEST IF ABEND IN CNTRL  Y02072 73050002
         BC    1,UCSEXIT                IF YES,GOTO EXIT ROUTINE        73200000
*                                                                       73300000
         L     RWK3,DXREG9              SAVE DCB ADDRESS       @ZA04647 73350003
         DMABCOND (RB),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES     S21042X73400021
                                        XCTL TO PROBLEM DETERMINATION   73500021
         B     TCTLRTN                                           S21042 73600021
         EJECT                                                          73650002
*********************************************************************** 73700002
*  'GETMSG' SUBROUTINE                                           Y02072 73750002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 73800002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 73850002
*                                                                       73860002
*    INPUT TO THIS ROUTINE:                                      Y02072 73870002
*      REG 9 - MESSAGE NUMBER IN CSECT                           Y02072 73880002
*      REG 11 - RETURN ADDRESS                                   Y02072 73890002
*                                                                       73892002
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 73894002
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 73898002
*********************************************************************** 73898402
GETMSG   EQU   *                        ENTRY POINT, MSG RTN     Y02072 73898802
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 73899202
         LH    RWK2,0(RWK7,RWK3)        GET INDEX TO MESSAGE     Y02072 73899602
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 73899702
         USING MSGENTRY,RWK2                                     Y02072 73899802
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 73899902
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 73933202
*                                         ENTRY                  Y02072 73943202
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 73953202
         USING MSGTXTD,RWK3                                      Y02072 73963202
         SR    RWK7,RWK7                PREPARE REG FOR RETURN   Y02072 73965202
         IC    RWK7,MSGLNG              LEN OF MSG - 1           Y02072 73965602
         EX    RWK7,MVCINST             MOVE MESSAGE TO AREA     Y02072 73966002
         IC    RWK7,MSGOFF1             OFFSET TO FIRST VAR FLD  Y02072 73966102
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF FIRST VAR FLD Y02072 73966202
         MVC   0(L'UCBNAME,RWK3),UCBNAME  MOVE DEV NAME TO MSG   Y02072 73966302
         BR    RWK6                     RETURN                   Y02072 73966402
MVCINST  MVC   MSGAREA(0),MSGTXT        EXECUTED BY A EX INST    Y02072 73966502
         EJECT                                                          73966602
*                                                                       73966702
*********************************************************************** 74000000
*                                                                       74100000
*********************************************************************** 74200000
*                                                                       74300000
*   CONSTANTS                                                           74400000
*                                                                       74500000
*********************************************************************** 74600000
*                                                                       74700000
*   FOR WTG TABLE                                                       74800000
*                                                                       74900000
OPIDCNST DC    C'0S'                                                    75000000
AMIDCNST DC    C'1V'                                                    75100000
UCSLTHEX DC    X'0200'                  UCS LENGTH CONSTANT =    S20202 76660020
*                                       512                      S20202 76960020
*                                                                       77300000
*********************************************************************** 77400000
*                                                                       77500000
*   XCTL TABLE                                                          77600000
*                                                                       77700000
*********************************************************************** 77800000
*                                                                       77900000
MODNM1G  DC    C'1G',VL3(IGG0191G)      MOD IGG0191G           @Z30TSCF 77950003
MODNM1I  DC    C'1I',VL3(IGG0191I)      MOD IGG0191I           @Z30TSCF 77960003
MODNM1Q  DC    C'1Q',VL3(IGG0191Q)      MOD IGG0191Q           @Z30TSCF 77972003
MODNM7E  DC    C'7E',VL3(IGG0197E)      MOD IGG0197E           @Z30TSCF 77980003
MODNM7U  DC    C'7U',VL3(IGG0197U)      MOD IGG0197U           @Z30TSCF 77992003
MODNM11  DC    C'11',VL3(IGG01911)      MOD IGG01911           @Z30TSCF 77994003
PDLOAD   DC    C'6M',VL3(IGG0196M)      MOD IGG0196M           @Z30TSCF 77996003
         SPACE                                                          77998002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 78048002
END      EQU   *                        END OF MODULE            Y02072 78148002
*                                                                       79200000
*   DSECT                                                               79300000
*                                                                       79400000
*********************************************************************** 79500000
*                                                                       79600000
*                                                                       79700000
         DCBD  DSORG=PS,DEVD=PR         MAP A PRINTER DCB               79800003
*                                                                       79900000
*********************************************************************** 80000000
*                                                                       80100000
         EJECT                                                          80150002
CVT      DSECT                                                 @Z30TSCF 80160003
         CVT                                                   @Z30TSCF 80170003
         EJECT                                                          80172003
         IECDSECS MAIN,EXPAND=YES                                S21042 80180021
         ORG   REPLYLTH+52                                       A33665 80340020
RPLY     DS    20C                                               A33665 80380020
RPLYECB  DS    F                                                 A33665 80420020
MCSMASK  DS    H                                                 A33665 80460020
LOMASK   DS    8C                                                A33665 80500020
UCSID    DS    4C                                                A33665 80540020
         ORG   MSGLSTSZ                                          Y02072 80590002
MSGAREA  DS    0CL64                    AREA TO MOVE 64 BYTES    Y02072 80592002
*                                         TO FOR WTO/WOTR'S      Y02072 80594002
*                                                                       80600000
         EJECT                                                          80610002
         IGGSCW                                                  Y02072 80620002
         EJECT                                                          80630002
         IHAFCAUD  ORG=YES                                       YM4697 80640002
         EJECT                                                          80650002
         IECDSECS  WTG,PREFX,EXPAND=YES                        @Z30TSCF 80660003
         ORG   WTGIDTTR                                          Y02072 80662002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 80664002
         EJECT                                                          80670002
         IGGMSG                                                  Y02072 80680002
*********************************************************************** 80700000
*                                                                       80800000
SRT      DSECT                                                          80900000
         IEFUCBOB                                                       81000000
*                                                                       81100000
*********************************************************************** 81200000
*                                                                       81300000
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          81400000
DEB      DSECT                                                          81500000
DEBNMSUB DS    0CL1                                                     81600000
DEBTCBAD DS    CL4                                                      81700000
DEBAMLNG DS    0CL1                                                     81800000
DEBDEBAD DS    CL4                                                      81900000
DEBOFLGS DS    0CL1                                                     82000000
DEBIRBAD DS    CL4                                                      82100000
DEBOPATB DS    0CL1                                                     82200000
DEBSYSPG DS    CL4                                                      82300000
DEBNMEXT DS    0CL1                                                     82400000
DEBUSRPG DS    CL4                                                      82500000
DEBPRIOR DS    0CL1                                                     82600000
DEBECBAD DS    CL4                                                      82700000
DEBPROTG DS    0CL1                                                     82800000
DEBDEBID DS    0CL1                                                     82900000
DEBDCBAD DS    CL4                                                      83000000
DEBEXSCL DS    0CL1                                                     83100000
DEBAPPAD DS    CL4                                                      83200000
DEBDVMOD DS    0CL1                                                     83300000
DEBUCBAD DS    CL4                                                      83400000
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     83500000
DEBBINUM DS    CL2                                                      83600000
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   83700000
DEBSTRCC DS    CL2                                                      83800000
DEBSTRHH DS    CL2                                                      83900000
DEBENDCC DS    CL2                                                      84000000
DEBENDHH DS    CL2                                                      84100000
DEBNMTRK DS    CL2                                                      84200000
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          84300000
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              84400000
DEBVOLSQ DS    H                                                        84500000
DEBVOLNM DS    H                                                        84600000
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     84700000
DEBSUBID DS    H                                                        84800000
*                                                                       84900000
         END                                                            85200000
./  ADD  SSI=43081083,NAME=IGG0191W
         TITLE ' IGG0191W OUTPUT DA EXECUTOR FOR PCI SCHEDULING'        00008020
IGG0191W CSECT                                                          00016020
*MODULE NAME - IGG0191W                                          Y02072 00016402
*                                                                       00016802
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00017202
*                                                                       00017602
*COPYRIGHT - NONE                                                Y02072 00017702
*                                                                       00017802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00017902
*                                                                       00018002
*          VS2 RELEASE 2 DELETIONS                                      00018402
*000550,011000,052200,068940-069000,077200,119600,122800-124000, Y02072 00020002
*139780,149814,154200-154400,161200,000260-000377,000440-000500  Y02072 00022002
*56500,129071,129306,133200,134800                               Y02072 00032002
*                                                                YM2396 00034002
*                                                                YM2424 00036002
*                                                                YM4697 00036402
*                                                                YM5373 00036802
*                                                                YM6583 00036902
*                                                                YM7595 00037502
*                                                                       00037903
*          VS2 RELEASE 3 DELETIONS                                      00039403
*                                                              @Z30TSCF 00041403
*          RELEASE 20 DELETIONS                                         00041503
*0000064200                                                      M6190  00043003
*0000002800,052600,058600,058720,059380,064400,064800,066400-    M5725  00044503
*0000066600,068760,070200,070600-071000,071600-072000,073200,    M5725  00046003
*0000075800,075920,076000,077600,084200,103900,105400,111500,    M5725  00047503
*0000128880-129080,136600-138350,142000-143800,146400,146600-    M5725  00049003
*0000147600,155000-160400                                        M5725  00050503
*          RELEASE 21 DELETIONS                                         00052003
*                                                                       00053503
*STATUS CHANGE LEVEL 002                                                00055002
*FUNCTION/OPERATION -- THIS EXECUTOR BUILDS THE MAIN IOB & ICBS THAT    00060020
*                      WILL CONTROL THEIR ASSOCIATED CHANNEL PROGRAMS.  00080020
*                      IT ALSO CONSTRUCTS INPUT OR OUTPUT CHANNEL PROG. 00100020
*                      AND FILLS IN DEVICE DEPENDANT FIELDS IN THE DCB. 00120020
*                      FOR QSAM THE CHANNEL PROGRAMS INCLUDE THE BUFFER 00140020
*                      ADDRESS,THE PHYSICAL BLOCK SIZE AND ASSC FLAGS.  00160020
*                      ALL ICBS ARE LINKED TOGETHER                     00180020
*                      THE GETMAIN MACRO IS USED TO OBTAIN SPACE FOR    00200020
*                      THE IOB & ICBS.                                  00220020
*                      IT SETS AN AUDIT TRAIL BIT IN THE OPEN    Y02072 00230002
*                      WORKAREA INDICATING TO FORCE CLOSE THAT   Y02072 00232002
*                      THE CORE GETMAINED FOR THE IOB'S CAN BE   Y02072 00234002
*                      FREEMAINED.                               Y02072 00236002
*                                                                       00260020
*ENTRY POINTS  -   ENTERED AT IGG0191W FROM LEVEL ONE                   00280020
*                      EXECUTOR IGG0191B VIA THE XCTL MACRO             00300020
*                                                                       00320020
*INPUT SUPPLIED-   USER DCB AND OPEN PARAMETERS -- SEE REGISTER USAGE   00340020
*                                                                       00360020
*OUTPUT GIVEN  -   MAIN IOB , ICBS AND CHANNEL PROGRAMS , DCB INITIAL   00380020
*                                                                       00400020
*                                                                       00420020
*EXTERNAL RTS. -   NONE                                                 00440020
*                                                                       00460020
*EXITS-NORMAL: XCTL TO IGG01910(IECOSLDA)    TO LOAD ROUTINES           00480020
*                                                                       00500020
*EXITS-ERROR: NONE.                                                     00520020
*                                                                       00540020
*MACROS - MAPPING : IECDSECS, IEZIOB, IEZDEB, IKJTCB, IHAICB,    Y02072 00550002
*                   IHACCW, DCBD, IHAFCAUD, IGGBCB               Y02072 00552002
*                                                                       00554002
*MACROS - ACTION : MODESET, GETMAIN, XCTL, XCTLTABL, DMABCOND    Y02072 00556002
*                                                                       00558002
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00560020
*                                                                       00580020
*      BYTE  0-7  NAME                                                  00600020
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00620020
*      BYTE 11    CONCATENATION NUMBER                                  00640020
*      BYTE 12    ZERO                                                  00660020
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00680020
*                        ALIAS INDICATOR 1 BIT                          00700020
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00720020
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00740020
*      BYTE 17    ZERO                                                  00760020
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00780020
*      BYTE 20    TRANSLATION TABLE                                     00800020
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00820020
*      BYTE 22-23 ATTRIBUTES                                            00840020
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00860020
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00880020
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00900020
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00920020
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00940020
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        00960020
*      BYTE 36-39 TABLE OF IDTTR'S                                      00980020
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          01000020
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          01020020
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01040020
*                   NOT USED                         (1 BYTE)           01060020
*                                                                       01080020
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY    Y02072 01100002
*            UNLESS OTHERWISE SPECIFIED, SUPER STATE             Y02072 01120002
*                                                                       01140020
*********************************************************************** 01160020
*                                                                       01180020
*                                                                       01200020
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01220020
*                                                                       01240020
*********************************************************************** 01260020
*                                                                       01280020
RDCB     EQU   2         DCB REGISTER                                   01300020
RBASE    EQU   3         BASE REGISTER                                  01320020
RCORE    EQU   4         WORK AREA ADDRESS                              01340020
RPAR     EQU   5         TOP OF PARAMETER LIST                          01360020
RWTG     EQU   6         TOP OF WTG TABLE                               01380020
RPARC    EQU   7         CURRENT PARAMETER                              01400020
RWTGC    EQU   8         CURRENT TRANS LOAD                             01420020
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01440020
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01460020
RDEB     EQU   11        DEB ADDRESS                                    01480020
RWK2     EQU   RDEB                     WORK REGISTER            Y02072 01490002
RB       EQU   12        WORK REG1  **                                  01500020
RWK3     EQU   RB                       WORK REGISTER            Y02072 01510002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01520020
RD       EQU   14        WORK REG3  **                                  01540020
RJ       EQU   15        WORK REG4                                      01560020
RBUFADR  EQU   RJ        BUFFER ADDRESS REGISTER                 YM7595 01575002
RE       EQU   0         WORK REG5                                      01580020
RF       EQU   1         WORK REG6                                      01600020
RWK6     EQU   RF                       WORK REGISTER            Y02072 01610002
*                                                                       01620020
*                                                                       01640020
PARAR    EQU   RPARC                                                    01660020
*                                                                       01680020
*********************************************************************** 01700020
*                                                                       01720020
*                                                                       01740020
*                                                                       01760020
*********************************************************************   01780020
* MASK'S TO TEST PARAMETER LIST WITH                                    01800020
INP      EQU   X'0F'                                                    01820020
OUTP       EQU   X'0F'                                                  01840020
UPDATE     EQU   X'04'                                                  01860020
INOUT      EQU   X'03'                                                  01880020
OUTIN      EQU   X'07'                                                  01900020
RDBACK     EQU   X'01'                                                  01920020
*                                                                       01940020
*                                                                       01960020
*********************************************************************   01980020
*                                                                       02000020
*                                                                       02020020
* OFFSET FOR PARAMETER TESTS                                            02040020
*                                                                       02060020
ONE        EQU   X'01'                                                  02080020
FRTYATE    EQU   48                                                     02100020
DISPSN     EQU   X'0'                                                   02120020
*                                                                       02140020
*                                                                       02160020
*********************************************************************   02180020
*                                                                       02200020
* OFFSETS FOR DEB REFERENCE                                             02220020
*                                                                       02240020
*                                                                       02260020
*                                                                       02280020
*                                                                       02300020
*                                                                       02320020
*********************************************************************   02340020
*                                                                       02360020
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              02380020
*                                                                       02400020
*                                                                       02420020
*                                                                       02440020
DOUBLE     EQU   X'01'                                                  02460020
*                                                                       02480020
*                                                                       02500020
STOWB      EQU   X'80'                                                  02520020
WRTCK    EQU   X'80'                                                    02540020
OVRFLO     EQU   X'20'                                                  02560020
PCIB     EQU   X'20'                                                    02580020
MINKEY     EQU   X'01'                                                  02600020
CONCAT     EQU   X'FF'                                                  02620020
SRCHDIRB EQU   X'40'                                                    02640020
ONONYES  EQU   X'0C'                                                    02660020
*                                                                       02680020
*********************************************************************   02700020
*                                                                       02720020
* MASKS FOR ACCESS METHODS IN SAM                                       02740020
*                                                                       02760020
QSAMB      EQU   X'01'                                                  02780020
BSAMBIT    EQU   X'00'                                                  02800020
PAM        EQU   X'02'                                                  02820020
*                                                                       02840020
*                                                                       02860020
* MASKS FOR MACRO'S TO BE USED                                          02880020
*                                                                       02900020
GETB       EQU   X'40'                                                  02920020
PUTB       EQU   X'40'                                                  02940020
READB      EQU   X'20'                                                  02960020
WRITEB     EQU   X'20'                                                  02980020
POINTB     EQU   X'04'                                                  03000020
CNTRLB     EQU   X'02'                                                  03020020
*                                                                       03040020
*                                                                       03060020
*********************************************************************   03080020
*                                                                       03100020
* MASKS FOR DEVICES TO BE SUPPORTED                                     03120020
*                                                                       03140020
NORCDRY  EQU   X'20'                    NO RCD READY MASK               03160020
*                                                                       03180020
*********************************************************************   03200020
*                                                                       03220020
* MASKS FOR STATUS BITS TO BE TESTED                                    03240020
*                                                                       03260020
*                                                                       03280020
EXCPN      EQU   X'30'                                                  03300020
COMPLETE EQU   X'60'                                                    03320020
FIRSTIOB   EQU   X'01'                                                  03340020
IOBCEXCP EQU   X'80'                    IOBCNOPA FLAG            YM6583 03350002
*                                                                       03360020
*                                                                       03380020
*                                                                       03400020
*********************************************************************   03420020
*                                                                       03440020
* MASKS FOR BUFFER TECHNIQUE'S                                          03460020
*                                                                       03480020
EXCHANGB   EQU   X'10'                                                  03500020
SIMPLEB    EQU   X'40'                                                  03520020
*                                                                       03540020
*********************************************************************   03560020
*                                                                       03580020
*                                                                       03600020
* MODES OF OPERATION FOR QSAM                                           03620020
*                                                                       03640020
LOCATEB    EQU   X'08'                                                  03660020
MOVEB      EQU   X'10'                                                  03680020
SUBSTUTB   EQU   X'04'                                                  03700020
*                                                                       03720020
*                                                                       03740020
*********************************************************************   03760020
*                                                                       03780020
*                                                                       03800020
* COMMAND BYTES FOR THE 2841                                            03820020
*                                                                       03840020
*       CONTROL UNIT                                                    03860020
*                                                                       03880020
*                                                                       03900020
*                                                                       03920020
SRCHE      EQU   X'31'                                                  03940020
WRTCKD     EQU   X'1D'                                                  03960020
RDC        EQU   X'92'                                                  03980020
RDKD       EQU   X'8E'                                                  04000020
RDD        EQU   X'86'                                                  04020020
NOP      EQU   X'03'                                                    04040020
TIC        EQU   X'08'                                                  04060020
SETSC    EQU   X'23'                    SET SECTOR CCW CMND             04067020
RDSC     EQU   X'22'                    READ SECTOR CCW CMND            04074020
RDHA     EQU   X'1A'                    READ HOME ADDR                  04081020
MTSID    EQU   X'B1'                    MULTI-TRK SRCH ID               04088020
TICNOP   EQU   X'88'                    RCD READY TIC NOP               04095020
*                                                                       04102020
*                                                                       04109020
*********************************************************************   04120020
*                                                                       04140020
*                                                                       04160020
* MASKS FOR RECORD FORMATS                                              04180020
*                                                                       04200020
*                                                                       04220020
STANDRDF   EQU   X'08'                                                  04240020
FORMATU    EQU   X'C0'                                                  04260020
FORMATF    EQU   X'80'                                                  04280020
FORMATV    EQU   X'40'                                                  04300020
BLOCKED    EQU   X'10'                                                  04320020
FSTANDRD EQU   X'88'                                                    04340020
FIXBKD   EQU   X'90'                                                    04360020
NOTPNTID EQU   X'05'                                                    04380020
FORMATVS EQU X'48'    VARIABLE SPANNED                           M3641  04390020
*                                                                       04400020
*                                                                       04420020
*********************************************************************   04440020
*                                                                       04460020
*                                                                       04480020
*   CHANNEL CONTROL WORD FLAGS                                          04500020
*                                                                       04520020
SKIP       EQU   X'10'                                                  04540020
SLI        EQU   X'20'                                                  04560020
PCI      EQU   X'08'                                                    04580020
CC         EQU   X'40'                                                  04600020
DATACH     EQU   X'A0'                                                  04620020
SLICC      EQU   X'60'                                                  04640020
SLICCSK    EQU   X'70'                                                  04660020
*                                                                       04680020
*                                                                       04700020
*********************************************************************   04720020
*                                                                       04740020
*                                                                       04760020
KEYS       EQU   X'01'                                                  04780020
QSAM       EQU   X'01'                                                  04800020
*                                                                       04820020
*                                                                       04840020
*********************************************************************   04860020
*                                                                       04880020
COMMTABL EQU   16                                                       04900020
*                                                                       04920020
*********************************************************************   04940020
*                                                                       04960020
*                                                                       04980020
* DISPLACEMENTS, BYTE COUNTS AS EQUATES                                 04983020
*                                                                       04986020
D0       EQU   0                        DISPLACEMENT OF 0               04989020
D1       EQU   1                        DISPLACEMENT OF 1               04992020
D2       EQU   2                        DISPLACEMENT OF 2               04995020
D3       EQU   3                        DISPLACEMENT OF 3               04998020
D4       EQU   4                        DISPLACEMENT OF 4               05001020
D5       EQU   5                        DISPLACEMENT OF 5               05004020
D6       EQU   6                        DISPLACEMENT OF 6               05007020
D7       EQU   7                        DISPLACEMENT OF 7               05010020
D8       EQU   8                        DISPLACEMENT OF 8               05013020
D12      EQU   12                       DISPLACEMENT OF 12              05016020
D16      EQU   16                       DISPLACEMENT OF 16              05019020
D25      EQU   25                       DISPLACEMENT OF 25              05022020
D32      EQU   32                       DISPLACEMENT OF 32              05025020
D35      EQU   35                       DISPLACEMENT OF 35              05028020
D40      EQU   40                       DISPLACEMENT OF 40              05031020
D51      EQU   51                       DISPLACEMENT OF 51              05034020
D52      EQU   52                       DISPLACEMENT OF 52              05037020
D56      EQU   56                       DISPLACEMENT OF 56              05040020
D80      EQU   80                       DISPLACEMENT OF 80       M5725  05041020
D255     EQU   255                      DISPLACEMENT OF 255      M5725  05042020
*                                                                       05043020
* BYTE COUNTS AS EQUATES                                                05046020
*                                                                       05049020
B1       EQU   1                        BYTE CNT OF 1                   05052020
B2       EQU   2                        BYTE CNT OF 2                   05055020
B3       EQU   3                        BYTE CNT OF 3                   05058020
B4       EQU   4                        BYTE CNT OF 4                   05061020
B5       EQU   5                        BYTE CNT OF 5                   05064020
B8       EQU   8                        BYTE CNT OF 8                   05067020
B16      EQU   16                       BYTE COUNT OF 16                05070020
B24      EQU   24                       BYTE COUNT OF 24                05073020
*                                                                       05076020
* MISCELLANEOUS EQUATES                                                 05079020
*                                                                       05082020
RRWCHPL  EQU   10                       RCD READY WRT CHP LEN           05085020
RRNWCHPL EQU   6                        RCD READY NORM WRT CHP LEN      05088020
*                                       IN DOUBLE WORDS                 05091020
NWNOPOFF EQU   72                       NORM NOP OFFSET                 05094020
FLAGOFF  EQU   4                        FLAG OFFSET IN CCW              05097020
CNTOFF   EQU   7                        CNT FLD OFFSET                  05100020
OABD065  EQU   65                       INTERNAL ABEND CODE 65   I21042 05102021
*                                                                       05103020
*                                                                       05106020
*                                                                       05120020
*                                                                       05140020
         BALR  RBASE,0                  REG 3 IS BASE                   05160020
         USING SOPA,RBASE               ESTABLISH BASE REGISTER         05180020
         USING IHADCB,RDCB              REG 2 IS DCB                    05200020
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR         05240020
*                                                                       05280020
*                                                                       05300020
SOPA     EQU   *                        FOR ADDRESSABILITY              05320020
*                                                                       05340020
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 05350002
         DC    C'IGG0191W'              MODULE NAME              Y02072 05352002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 05354003
         DC    C'10/17/74'              LAST DATE MODIFIED     @Z30TSCF 05356003
BEGIN    DS    0H                                                Y02072 05358002
*                                                                       05360020
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 05380020
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESS           05420020
*                                                                       05440020
         SR    RTIOT,RTIOT                                              05500020
         ST    RTIOT,DCBCNTRL                                           05560020
         IC    RTIOT,DCBNCP             GET NUMBER OF ICBS TO BUILD     05640020
         USING WTGENTRY,RWTGC                                    Y02072 05642002
         MVC   WTGIDTTR,SOP2            NON-PCI EXECUTOR       @Z30TSCF 05644003
         TM    DCBMACRF+1,POINTB        NOTE/POINT MACRO USED           05720020
         BC    8,SOPA001                NO BRANCH                       05740020
*                                                                       05760020
         MVI   DCBCNTRL+1,NOTPNTID      STORE INDEX FOR NOTE/POINT ID.  05780020
*                                                                       05800020
SOPA001  EQU   *                                                        05820020
         LA    RF,88                    SIZE OF OUTPUT ICB +CP.         05840020
         LA    RUCB,B8                  DOUBLE WORD CONSTANT     M5725  05850020
*                                                                       05862020
* CHECK FOR RCD READY AND IF USED INCR ICB SIZE                         05864020
*                                                                       05866020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       05868020
         BO    SOPA01A                  BRANCH IF YES                   05870020
         AR    RF,RUCB                  INCR ICB SIZE            M5725  05872020
SOPA01A  EQU   *                                                        05874020
         MVI   DCBCNTRL+3,1             STORE INDEX FACTOR FOR PCI EOB  05880020
         TM    DCBOPTCD,WRTCK           WRITE VALIDITY SPECIFIED        05900020
         BC    8,SOPA007                NO BRANCH                       05920020
         TM    JFCBMASK+D6,NORCDRY      RCD READY WITH WRT CHK          05926020
         BO    SOPA01D                  BRANCH IF YES                   05932020
         AR    RF,RUCB                  INCR ICB SIZE            M5725  05938020
SOPA01D  EQU   *                                                        05944020
*                                                                       05950020
         LA    RF,24(RF)                ADD CNST TO ICB & CP LENGTH     05960020
SOPA007  EQU   *                                                        06240020
*                                                                       06260020
         LR    RC,RF                    SAVE ICB SIZE                   06270020
         TM    DCBCIND2,QSAMB           IS QSAM BEING USED              06280020
         BC    8,SOPA009                NO BRANCH                       06300020
*                                                                       06320020
         IC    RTIOT,DCBBUFNO           GET NO. OF ICBS TO GENERATE     06340020
SOPA009  EQU   *                                                        06360020
*                                                                       06380020
         CH    RTIOT,RCCWCNST+2         BUFFER # =1 ?            M6190  06420020
*                                                                       06460020
         BNH   RELOOP                   BRANCH IF NOT GT ONE     M5725  06480020
*                                                                       06500020
*                                                                       06520020
SOPA011  EQU   *                                                        06540020
*                                                                       06560020
         LR    RE,RF                    COPY ICB SIZE                   06580020
         SRL   RE,3                     DIVIDE BY EIGHT                 06600020
         STC   RE,DCBIOBL               SAVE FOR CLOSE                  06620020
         MR    RE,RTIOT                 COMPUTE SPACE REQ        M5725  06650020
         LA    RF,80(RF)                ADD SPACE FOR MAIN IOB          06680020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       06682020
         BO    SOPA11A                  BRANCH IF YES                   06684020
         LA    RF,B16(RF)               INCR FOR THETA VALUES AND       06686020
*                                       SET SECTOR IN MIOB              06688020
SOPA11A  EQU   *                                                        06690020
*                                                                       06692020
         LR    RB,RF                    SAVE FOR CLEARING RT.           06700020
         OI    DCBCIND2,DCBCNCHS        SET TRUE PCI INDICATOR   YM4697 06710002
*                                                                       06720020
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE      YM4697 06730002
*  IOB AND ICBS IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE     YM4697 06732002
*  CLOSE EXECUTOR.                                               YM4697 06734002
*                                                                       06736002
         ST    RF,DXATEXC2              SAVE LENGTH              YM4697 06738002
*                                                                       06760020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 06770002
         GETMAIN R,LV=(RF),SP=0                                  Y02072 06780002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06790002
*                                                                       06800020
*                                                                       06820020
**********************************************************************  06840020
*                                                                       06846020
* OBTAIN THETA ADDRS MAY BE USED LATER                                  06852020
*                                                                       06858020
         LR    RJ,RB                    GET AREA SIZE                   06864020
         AR    RJ,RF                    GET LAST AREA + 1 ADDR          06870020
         SR    RJ,RUCB                  BACK UP AREA ADDR ONE DW        06882020
         ST    RJ,DXCCW11               TEMP STORE SET SECT ADDR        06888020
*                                                                       06906020
**********************************************************************  06920020
**                                                                      06940020
*    THIS SECTION CLEARS THE SPACE RECIEVED FROM GETMAIN                06960020
**                                                                      06980020
*                                                                       07000020
         ST    RF,DCBIOBAD              STORE MAIN IOB ADDRESS          07040020
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 07050002
         BCTR  RB,0                     REDUCE AMT BY ONE        M5725  07060020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 07062002
         LA    RJ,D255                  GET MAX AMT CAN CLEAR    M5725  07080020
COMPARE  CR    RB,RJ                    IS AMT TO CLEAR GT 255   M5725  07100020
         BC    12,ONECLEAR              NO BRANCH                       07120020
*                                                                       07140020
         EX    RJ,CLEAR                 CLEAR 256 BYTES          M5725  07150020
         SR    RB,RJ                    SUBT 255 FROM AMT TO     M5725  07160020
*                                       CLEAR                    M5725  07170020
         BCTR  RB,0                     SUBT ONE MORE BYTE       M5725  07180020
         LA    RF,256(RF)               UPDATE AREA ADDR BY 256         07220020
         B     COMPARE                                                  07240020
*                                                                       07260020
CLEAR    XC    0(1,RF),0(RF)            ACTUAL CLEAR INSTRUCTION        07280020
*                                                                       07300020
ONECLEAR EX    RB,CLEAR                 CLEARS LESS THAN 256     M5725  07320020
*                                                                       07340020
*                                                                       07360020
*                                                                       07380020
         L     RB,DCBIOBAD              GET MAIN IOB ADDRESS            07400020
*                                                                       07480020
*    THIS SECTION OF CODE WILL BUILD THE MAIN IOB & CHANNEL PROGRAM     07500020
*                                                                       07520020
SOPA013  EQU   *                                                        07540020
*                                                                       07560020
         LA    RJ,D80(RB)               POINT TO FIRST ICB       M5725  07570020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       07584020
         BO    SOPA13A                  BRANCH IF YES                   07588020
         AR    RJ,RUCB                  INCR ICB PTR             M5725  07592020
SOPA13A  EQU   *                                                        07596020
         ST    RJ,D8(RB)                STORE IN MAIN IOB        M5725  07606020
         LA    RD,4(RB)                 POINT TO ECB IN MAIN IOB        07620020
*                                                                       07640020
         MVI   0(RD),X'7F'              POST MAINIOB COMPLETE           07660020
*                                                                       07680020
         LA    RF,56(RB)                POINT TO CP START ADDRESS       07700020
         USING IOBQSAMC,RWK3                                     Y02072 07710002
         ST    RD,IOBECBPT              ECB ADDR TO IOB          Y02072 07720002
         ST    RF,IOBSTART              CHAN PGM ADDR TO IOB     Y02072 07730002
         L     RWK2,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 07732002
         ST    RWK2,IOBDCBPT            DCB ADDR TO IOB          Y02072 07734002
         DROP  RWK3                                              Y02072 07736002
         MVC   48(8,RB),DCBFDAD         MOVE D.A. ADDRESS TO MAIN IOB   07740020
         LR    RD,RC                    PUT ICB SIZE IN INDEX REG       07750020
*                                                                       07770020
* CHECK FOR RCD READY AND IF USED GO BUILD SET SECTOR                   07780020
*                                                                       07790020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICE W/O RCD READY        07800020
         BO    SOPA13D                  BRANCH IF YES                   07810020
         L     RE,DXCCW11               GET THETA ADDR                  07820020
         BAL   RJ,SOPASTA               GO BUILD SET SECTOR             07830020
SOPA13D  EQU   *                                                        07840020
*                                                                       07850020
* CONSTRUCTION OF SEARCH AND TIC FOLLOWS                                07860020
*                                                                       07870020
         LA    RE,D51(RB)               PT TO CCHHR IN MAIN IOB         07880020
         BAL   RJ,SOPSRCH               GO BUILD SRCH AND TIC           07890020
*                                                                       07900020
         AR    RF,RUCB                  CHP PTR TO TIC                  07910020
         SR    RC,RC                    CLEAR REG                       07920020
         IC    RC,DCBKEYLE              GET KEY LENGTH                  07930020
         AH    RC,DCBBLKSI              ADD BLOCK SIZE                  07940020
         ST    RC,D4(RF)                PUT IN RH OF TIC                07950020
*                                                                       07960020
         AR    RF,RUCB                  INCR PTR                        07970020
         MVI   D0(RF),TIC               PUT TIC CMND IN CCW             07980020
*                                                                       07990020
         AR    RF,RUCB                                                  08000020
*                                                                       08010020
* MAIN IOB COMPLETE, FROM HERE ON RB=ICB, RF=CHP PTR, RUCB=8,           08020020
* RD=ICB SIZE,RDEB=16 HERE FOR INDEX TO NORM CHP ADDR                   08030020
*                                                                       08040020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08040402
         ST    RF,DCBIOBA               PUT ICB PTR IN DCB              08050020
         LR    RB,RF                    COPY ADDRESS                    08060020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   YM2396 08112402
         SPACE                                                          08112802
ICBLOOP  EQU   *                                                        08120020
*                                                                       08140020
************** CONSTRUCTION OF ICB & CP COMMENCE ********************** 08260020
*                                                                       08300020
         ST    RF,D0(RB)                LINK ICBS, REDUNDANT FOR        08310020
*                                       FIRST SINCE RF=RB               08320020
         LR    RB,RF                    UPDATE ICB PTR                  08330020
         LA    RC,4(RB)                 POINT TO ECB IN ICB             08360020
         ST    RC,12(RB)                STORE ECB ADDRESS IN ICB        08380020
         MVI   4(RB),X'7F'              POST ECB COMPLETE FOR NOW       08400020
         LA    RC,56(RB)                POINT TO ICBS NORMAL CP  M5725  08420020
         ST    RC,24(RB)                STORE CP ADDRESS IN ICB         08440020
         MVC   32(8,RB),DCBFDAD         STORE D.A. ADDRESS IN ICB       08460020
*                                                                       08480020
*                                                                       08500020
*        NOTE THAT THE DCB ADDRESS IS NOT STORED IN THE ICB             08520020
*                                                                       08540020
*                                                                       08560020
*********************************************************************** 10100020
*                                                                       10120020
SOPA025  EQU   *                                                        10140020
*                                                                       10160020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10162002
         MVC   DCBWCPO(4),PCIOFST       STORE CP OFFSETS IN DCB         10180020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 10180402
         LA    RF,D40(RB)               PT RF TO CHP START              10190020
         L     RC,DCBIOBAD              GET MAIN IOB PTR                10200020
         LA    RE,D35(RB)               PT TO ICB CCHHR FLD             10210020
         BAL   RJ,SOPSRCH               GO BUILD SRCH AND TIC           10220020
         MVI   D0(RF),MTSID             CHANGE CMND TO MULTI-TRK        10230020
         AR    RF,RUCB                  INCR CHP PTR FOR SRCH           10240020
         AR    RF,RUCB                  INCR CHP PTR FOR TIC            10250020
*                                                                       10260020
* WRT CCW BUILD  RTN                                                    10270020
*                                                                       10280020
         LA    RE,D0(RB,RD)             PT TO NEXT ICB                  10290020
         SR    RE,RUCB                  BACK UP ONE DW                  10300020
         ST    RE,D0(RF)                PUT IN CHP AS CCHHRKDD FLD      10310020
         MVI   D0(RF),WRTCKD            PUT IN CCW CMND                 10320020
         MVC   FLAGOFF(B4,RF),WCCWCNST  FLAGS AND LENT TO CCW           10330020
*                                                                       10330402
* MUST TEST TO SEE IF THIS JOB IS RUNNING IN A VIRTUAL ENVIRON-  Y02072 10330802
* MENT.  IF YES, PCI BIT SHOULD NOT BE LEFT ON.  IF NO, PCI BIT  Y02072 10331202
* SHOULD BE LEFT ON.                                             Y02072 10331602
*                                                                       10331702
         L     RDEB,DCBDEBAD            GET DEB ADDR             Y02072 10332002
         USING DEBBASIC,RDEB                                     Y02072 10334002
         L     RWK2,DEBTCBAD            TCB ADDR FOR V=R TEST    Y02072 10336002
         DROP  RDEB                                              Y02072 10338002
         USING TCB,RWK2                                          Y02072 10338402
         TM    TCBFLGS6,TCBRV           JOB RUNNING VIRT         Y02072 10338802
         BO    SOPA027                  NO, LEAVE PCI ON         Y02072 10339202
         DROP  RWK2                                              Y02072 10339302
         USING CCW,RWK6                                          Y02072 10339602
         NI    CCWFLGS,X'FF'-CCWPCI     YES, TURN PCI FLAG OFF   Y02072 10339702
         DROP  RWK6                                              Y02072 10339802
SOPA027  EQU   *                        LEAVE PCI FLAG ON        Y02072 10339902
         AR    RF,RUCB                  INCR PTR                        10346702
*                                                                       10350020
*                                                                       10360020
         TM    DCBCIND2,QSAMB           QSAM USED                       10370020
         BZ    SOPA029                  BRANCH IF NO                    10380020
         L     RWK2,DCBBUFCB            ADDR OF BUF CNTRL BLK    YM7595 10383002
         USING BCBLK,RWK2                                               10386002
         L     RBUFADR,BCBBUFPT         ADDR NEXT AVAIL BUFFER   YM7595 10389002
         LTR   RBUFADR,RBUFADR          IS THERE A BUFFER        Y02072 10390402
         BZ    ABEND                    NO, ISSUE DMABCOND       Y02072 10390802
         USING BUFFER,RBUFADR                                           10392002
         MVC   BCBBUFAD,BUFNXPTB        NEXT AVAIL BUFFER        YM7595 10392602
         USING CCW,RF                                            Y02072 10393202
         STCM  RBUFADR,B'0111',CCWADDRB  YES, STORE ADDR IN CCW  Y02072 10394402
         MVC   CCWBYTE,DCBBLKSI         BLKSIZE TO CCW           M5725  10400602
         DROP  RF,RWK2,RBUFADR                                          10403602
SOPA029  EQU   *                                                        10405302
         OI    FLAGOFF(RF),SLI          SET SILI BIT                    10410020
         AR    RF,RUCB                  INCR PTR FOR 2ND WRT CCW        10420020
*                                                                       10430020
* CHECK FOR WRT CHK                                                     10440020
*                                                                       10450020
         TM    DCBOPTCD,WRTCK           WRT CHK SPECIFIED               10460020
         BZ    SOPA444                  BRANCH IF NO                    10470020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10470402
         MVI   DCBWCPL,B8               SET WRT CHP LEN                 10480020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 10480402
         SR    RF,RUCB                  BACK UP CHP PTR                 10490020
         OI    FLAGOFF(RF),CC           CMND CHAIN PREVIOUS CCW         10500020
         AR    RF,RUCB                  RESTORE PTR                     10510020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICE W/O RCD READY        10520020
         BO    SOPA29A                  BRANCH IF YES                   10530020
         BAL   RJ,SOPARTA               GO BUILD RD SECT CMND           10550020
         USING CCW,RF                                           SA57269 10552002
         SR    RF,RUCB                  POSITION AT RD SECT CCW YM5373  10554002
         OI    CCWFLGS,CCWCC            SET COM CHAIN TO SET    SA57269 10562002
*                                         SECTOR CCW            SA57269 10572002
         AR    RF,RUCB                  POSITION AT SET SEC CCW YM5373  10572402
         DROP  RF                                               SA57269 10574002
         L     RE,DXCCW11               GET THETA ADDR           Y02072 10580002
         BAL   RJ,SOPASTA               GO BUILD SET SECTOR CMND        10590020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10590402
         MVI   DCBWCPL,RRWCHPL          SET WRT CHP LEN FOR RCD RDY     10600020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 10600402
SOPA031  EQU   *                                                        10610020
SOPA29A  EQU   *                                                        10620020
         LA    RE,D0(RB,RD)             PT OT NEXT ICB                  10630020
         SR    RE,RUCB                  BACK UP TO CCHHRKDD ADDR        10640020
         BAL   RJ,SOPSRCH               GO BUILD SRCH AND TIC           10650020
         AR    RF,RUCB                  INCR PTR FOR SRCH               10660020
         AR    RF,RUCB                  INCR PTR FOR TIC                10670020
*                                                                       10680020
*                                                                       10690020
         MVI   D0(RF),RDD               PUT IN RD DATA CMND             10700020
         MVC   FLAGOFF(B4,RF),RCCWCNST  PUT IN FLAGS AND LEN            10710020
*                                                                       10720020
         TM    DCBCIND2,QSAMB           QSAM USED                       10730020
         BO    SOPA035                  BRANCH IF YES                   10740020
         CLI   DCBKEYLE,B1              KEY LENGTH SPECIFIED            10750020
         BNH   SOPA035                  BRANCH IF NO                    10760020
         MVI   D0(RF),RDKD              PUT IN RD KEY DATA CMND         10770020
*                                                                       10780020
SOPA035  EQU   *                                                        10790020
         SR    RF,RB                    OBTAIN RD OFFSET                10800020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10800402
         STC   RF,DCBOFFSR              PUT IN DCB                      10810020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 10810402
         LA    RF,B8(RF,RB)             RESTORE AND INCR PTR            10820020
SOPA444  EQU   *                                                        10830020
         TM    DCBCIND2,QSAMB           QSAM USED                       10840020
         BO    SOPA449                  BRANCH IF YES                   10850020
         LA    RC,D0(RB,RD)             PT TO NEXT ICB                  10860020
         SR    RC,RUCB                  BACK UP TO CCHHRKDD FLD         10870020
         MVC   B5(B1,RC),DCBKEYLE       MOVE IN KEY LENGTH              10880020
SOPA449  EQU   *                                                        10890020
*                                                                       10900020
*                                                                       10910020
         SR    RF,RB                    OBTAIN NOP OFFSET               10920020
         L     RC,DCBIOBAD              GET MIOB                        10930020
         STC   RF,D3(RC)                PUT IN MAIN IOB                 10940020
         AR    RF,RB                    RESTORE PTR                     10950020
*                                                                       10960020
*                                                                       10970020
         LA    RC,D56(RD,RB)            PT TO NEXT ICB CHP              10980020
         ST    RC,D0(RF)                PUT IN CCW                      10990020
         MVI   D0(RF),NOP               MOVE IN NOP CMND                11000020
         OI    FLAGOFF(RF),SLI          SILI FLAG ON                    11010020
         MVI   D7(RF),B1                BYTE COUNT TO ONE               11020020
         AR    RF,RUCB                  INCR POINTER                    11030020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       11040020
         BO    SOPA477                  BRANCH IF YES                   11050020
         TM    DCBOPTCD,WRTCK           WRITE CHECK USED                11060020
         BO    SOPA477                  BRANCH IF YES                   11070020
         SR    RF,RUCB                  BACK UP POINTER                 11080020
         MVC   D5(B3,RF),D1(RF)         MOVE NEXT ICBADDR TO RH         11090020
*                                       OF CCW                          11100020
         LA    RDEB,D8(RF)              PT TO NEXT CCW                  11110020
         ST    RDEB,D0(RF)              PUT IN CCW                      11120020
         MVI   D0(RF),TICNOP            PUT IN TIC CMND                 11130020
         AR    RF,RUCB                  INCR PTR FOR NOP-TIC            11140020
         BAL   RJ,SOPARTA               GO BUILD RD THETA               11160020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11160402
         MVI   DCBWCPL,RRNWCHPL         SET CHP LENGTH                  11170020
         MODESET  KEYADDR=DXUKEY,WORKREG=11  GET INTO USER KEY   Y02072 11170402
SOPA477  EQU   *                                                        11180020
         AR    RF,RUCB                  INCR PTR FOR CNT                11190020
         BCT   RTIOT,ICBLOOP            IF MORE TO BUILD DECR AND       11200020
*                                       GO DO IT AGAIN                  11210020
*                                                                       11220020
*                                                                       11780020
*                                                                       11800020
*                                                                       11820020
SOPAEND  EQU   *                                                        11840020
         SPACE                                                          11855002
         MODESET  EXTKEY=DATAMGT                                        11870002
         SPACE                                                          11885002
         OI    FCAOPEN2,FCAOIOBC        INDIC ICBS COMPLETED     YM7595 11900002
         SPACE                                                          11915002
         MODESET  KEYADDR=DXUKEY,WORKREG=10                             11930002
         SPACE                                                          11945002
         L     RUCB,DCBIOBA             GET FIRST ICB GENERATED         11980020
         ST    RUCB,0(RB)               TIE LAST ICB TO FIRST           12000020
         LA    RDEB,D56(RUCB)           PT TO FIRST ICB CHP             12010020
         L     RD,DCBIOBAD              GET MAIN IOB ADDR               12020020
*                                                                       12040020
         SR    RC,RC                    CLEAR REG                       12050020
         IC    RC,D3(RD)                GET NOP OFFSET                  12060020
         AR    RC,RB                    OBTAIN NOP ADDR                 12070020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       12080020
         BO    SOPAXX                   BRANCH IF YES                   12090020
         TM    DCBOPTCD,WRTCK                                           12100020
         BO    SOPAXX                   BR IF WRT CHK SPECIFIED         12110020
         ST    RDEB,D4(RC)              PUT RDEB IN RH OF TIC           12120020
         B     SOPAXZ                   GO AROUND NEXT                  12130020
SOPAXX   EQU   *                                                        12140020
         ST    RDEB,D0(RC)              PUT IN PTR TO FIRST ICB         12150020
         MVI   D0(RC),NOP               RESTORE NOP                     12160020
SOPAXZ   EQU   *                                                        12170020
         SR    RC,RB                    RECOVER OFFSET OF NOP           12500020
         AR    RC,RUCB                  GET FIRST ICB NOP ADDR          12530020
         ST    RC,D12(RD)               PUT IN MAIN IOB                 12560020
         MVI   D12(RD),IOBCEXCP         SET EXCP NEEDED FLAG     YM6583 12570002
         MVC   D32(B8,RUCB),DCBFDAD     INITIALIZE ICB SEEK             12590020
         L     RUCB,D0(RUCB)            SPECIAL CONSIDERATIONS          12620020
         MVC   D32(B8,RUCB),DCBFDAD     INITIALIZE ICB SEEK             12650020
*                                                                       12680020
*                                                                       12780020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12790002
*                                                                       12800020
         TM    DCBDSORG,DCBDSGPO        DCB USING PAM            Y02072 12812002
         BZ    SOPAEND2                 NO BRANCH                Y02072 12814002
         MVI   NTPTINDX+1,5             STORE INDEX FOR          Y02072 12816002
*                                         NOTE-POINT ID          Y02072 12818002
*********************************************************************** 12820020
*                                                                       12840020
*                                                                       12880020
*        SELECT 3RD STAGE EXECUTOR                                      12884020
*                                                                       12884402
SOPAEND2 EQU   *                                                        12897702
*                                                                       12902402
         USING FORCORE,RCORE                                     Y02072 12902802
         USING WTGENTRY,RWTGC                                    Y02072 12904402
         MVC   WTGIDTTR,SOPSLDFT        GET NON-SPAN EXEC      @Z30TSCF 12906403
         TM    DCBRECFM,FORMATVS        VAR SPAN TEST            M5725  12911802
         BNO   RELOOP                   NO CHANCE FOR VS         M5725  12916502
         TM    DCBRECFM,FORMATU         UNDEFINED                M5725  12921202
         BO    RELOOP                   YES,NOT VS               M5725  12925902
         MVC   WTGIDTTR,SOP3            GET SPAN LOAD EXEC     @Z30TSCF 12927903
*                                                                       12935302
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        12940020
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     12960020
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            12980020
         BCR   8,RBASE                                                  13000020
*                                                                       13020020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    13040020
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             13060020
*                                                                       13080020
         LR    RPARC,RPAR                                               13100020
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       13120020
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           13140020
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         13160020
*                                                                       13180020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  13200020
         LA    RPARC,PLOFF(0,RPARC)                                     13220020
         BC    15,ZCHEK                                                 13240020
*                                                                       13260020
TCTLRTN  EQU   *                                                        13280020
         USING WTG,RWTG                                                 13330003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*13380003
               MODID=WTGENTRY                                  @Z30TSCF 13430003
         DROP  RWTGC,RWTG                                      @Z30TSCF 13480003
**                                                                      13500020
*                                                                       13520020
*********************************************************************   13540020
*                                                                       13560020
*                                                                       13580020
*   THIS SECTION OF CODE FILLS IN RD/WRT CCW WITH BUFFER AND LENGTH     13600020
*                                                                       13620020
*********************************************************************** 13640020
*                                                                       13842020
* SEARCH AND TIC BUILD RTN                                              13849020
*                                                                       13856020
SOPSRCH  EQU   *                                                        13863020
         ST    RE,D0(RF)                SRCH ADDR TO CCW                13870020
         MVI   D0(RF),SRCHE             SEARCH CMND                     13877020
         ST    RF,D8(RF)                SRCH ADDR TO TIC CCW            13884020
         MVC   FLAGOFF(B5,RF),SCCWCNST  FLAGS, LEN AND TIC CMND         13891020
         BR    RJ                       RETURN                          13898020
*                                                                       13905020
* SET SECTOR BUILD RTN                                                  13912020
SOPASTA  EQU   *                                                        13919020
         ST    RE,D0(RF)                THETA ADDR TO CCW               13926020
         MVI   D0(RF),SETSC             SET SECT CMND                   13933020
         OI    FLAGOFF(RF),CC           CMND CHAIN                      13940020
         B     CMNDFIN                  GO FINISH CMND                  13947020
*                                                                       13954020
* READ SECTOR BUILD RTN                                                 13961020
*                                                                       13968020
SOPARTA  EQU   *                                                        13975020
         L     RE,DXCCW11               GET THETA ADDRESS        Y02072 13978002
         ST    RE,D0(RF)                THETA ADDR TO CCW               13982020
         MVI   D0(RF),RDSC              RD SECT CMND                    13989020
         SR    RF,RUCB                  BACK UP PTR                     13996020
         OI    FLAGOFF(RF),CC           CMND CHAIN PREV CCW             14003020
         AR    RF,RUCB                  RESTORE PTR                     14010020
CMNDFIN  EQU   *                                                        14017020
         MVI   CNTOFF(RF),B1            BYTE CNT TO ONE                 14024020
         AR    RF,RUCB                  INCR PTR                        14031020
         BR    RJ                       RETURN                          14038020
*                                                                       14045020
ABEND    EQU   *                                                        14060020
*                                                                       14080020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 14082002
         SPACE                                                          14092002
         DMABCOND OABD065,PDLOAD,RES=NO,REGSAVE=YES              I21042X14100021
                                        CALL PD FOR 013 ABEND           14110021
         B     TCTLRTN                                           I21042 14120021
*                                                                       14160020
*                                                                       14180020
**********************************************************************  14400020
*                                                                    *  14420020
WAOFF    EQU   32                                                       14440020
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           14460020
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           14480020
AMIDCNST DC    C'1W'                    ID OF THIS MODULE               14500020
OPIDCNST DC    C'0S'                                                    14520020
SOPSLDFT DC    C'13',VL3(IGG01913)      NON-SPANNED EXEC       @Z30TSCF 14530003
SOP3     DC    C'16',VL3(IGG01916)      SPANNED RECORDS        @Z30TSCF 14532003
SOP2     DC    C'1D',VL3(IGG0191D)   ABNORMAL, PCI UNSUPPORT   @Z30TSCF 14534003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION  @Z30TSCF 14536003
*                                                                       14540020
*********************************************************************** 14560020
*      CONSTANTS AND RESERVED STORAGE.                                  14580020
*                                                                       14600020
*                                                                       14620020
WCCWCNST DC    X'A8000008'                                              14780020
RCCWCNST DC    X'50000001'                                              14800020
SCCWCNST DC    X'4000000508'                                            14820020
PCIOFST  DC    X'28'                                                    14840020
         DC    X'05'                    NUMBER OF DBL WRDS IN CP        14860020
         DC    X'00'                    READ CCW OFFSET                 14880020
         DC    X'40'                    WRITE CCW OFFSET                14900020
         SPACE                                                          14950002
PATCH    DC    0H'0',54X'00'            PATCH AREA               Y02072 14960002
END      EQU   *                        END OF MODULE            Y02072 15050002
         EJECT                                                          15053002
         IGGBCB  TYPE=SAM                                               15065002
         EJECT                                                          15100002
         DCBD  DSORG=PS                                                 15400002
NTPTINDX EQU   DCBCNTRL                 NOTE/POINT INDEX         Y02072 15450002
         EJECT                                                          15500003
CVT      DSECT                                                 @Z30TSCF 15550003
         CVT                                                   @Z30TSCF 15600003
         IECDSECS (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES     @Z30TSCF 16120003
         ORG   WTGIDTTR                                          Y02072 16122002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 16124002
         EJECT                                                          16126002
FORCORE  DSECT                                                   Y02072 16128002
         IHAFCAUD  ORG=YES                                       Y02072 16128402
         EJECT                                                          16128802
         IEZDEB                                                  Y02072 16130002
         EJECT                                                          16132002
         IHAICB                                                  Y02072 16140002
         ORG   ICBR+1                                            Y02072 16150002
         EJECT                                                          16150402
         IHACCW  DSECT=YES                                       Y02072 16152002
         EJECT                                                          16152402
         IKJTCB                                                  Y02072 16154002
           END                                                          16160020
./  ADD  SSI=43081084,NAME=IGG0191X
         TITLE 'IGG0191X DISK OUTIN, INOUT PCI EXECUTOR'                00100020
IGG0191X CSECT                                                          00200020
*MODULE NAME - IGG0191X                                          Y02072 00250002
*                                                                       00260002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00270002
*                                                                       00280002
*COPYRIGHT - NONE                                                Y02072 00290002
*                                                                       00292002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00294002
*                                                                       00300020
*        VS 2 RELEASE 2 DELETIONS                                Y02072 00350002
*001500,070000,083000-084000,302000-303000,328000-329000,        Y02072 00360002
*339000-340000,563500,564500-564800,650000,699000-702000,        Y02072 00370002
*004000-005000,007000-012000,688000-694000,215000,586000,612000, Y02072 00420002
*616000                                                          Y02072 00430002
*                                                                YM4697 00480002
*                                                                YM6583 00480102
*                                                                       00530103
*        VS2 RELEASE 3 DELETIONS                                        00580103
*                                                              @Z30TSCF 00590103
*        RELEASE 21 DELETIONS                                           00600020
* 407000-411000                                                  A46882 00650021
*                                                                       00700002
*STATUS CHANGE LEVEL 002                                                01300002
*                                                                       01350021
*   THIS MODULE NEW IN REL 20.1 FROM SPLIT OF MODULE IGG0191R           01360021
*                                                                       01370021
*FUNCTION                                                               01400020
*        1  GET CORE FOR IOB'S AND CHAINED CHANNEL PROGRAMS FOR DISK    01500020
*        2  CLEAR THIS CORE                                             01600020
*        3  CONSTRUCT IOBS AND ICBS                                     01700020
*        4  CONSTRUCT CHANNEL PROGRAMS FOR DISK                         01800020
*        5 IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA       Y02072 01850002
*          INDICATING TO FORCE CLOSE TAHT THE CORE GETMAINED     Y02072 01860002
*          FOR THE IOB'S CAN BE FREEMAINED.                      Y02072 01880002
*                                                                       01900020
*ENTRY POINT                                                            02000020
*        IGG0191W BY XCTL                                               02100020
*                                                                       02200020
*INPUT                                                                  02300020
*        SEE REGISTER DESCRIPTION,DCB                                   02400020
*                                                                       02500020
*OUTPUT                                                                 02600020
*        SEE REGISTER DESCRIPTION                                       02700020
*        USERS DCB                                                      02800020
*                                                                       02900020
* EXTERNAL ROUTINES-NONE                                                03000020
*                                                                       03100020
* EXITS                                                                 03200020
*        NORMAL BY XCTL TO IGG01913                                     03300020
*        NORMAL BY XCTL TO IGG0191J WHEN ONE BUFFER SPECIFIED           03400020
*                                                                       03500020
*        ERROR-NONE                                                     03600020
*                                                                       03650002
*MACROS, ACTION  MODESET, GETMAIN, XCTL                          Y02072 03660002
*                                                                       03670002
*MACROS, MAPPING  DCBD, IECDSECS, IEZDEB, IKJTCB, IEZIOB, IHACCW Y02072 03680002
*                                                                       03700020
*TABLES/WORKAREAS-WHERE TO GO TABLE (WTG)                               03800020
*                                                                       03900020
*        BYTE  0-7     NAME                                             04000020
*        BYTE  8-10    RELATIVE DISK ADDRESS(TTR) O                     04100020
*        BYTE  11      CONCATENATION NUMBER                             04200020
*        BYTE  12      ZERO                                             04300020
*        BYTE  13      ALIAS INDICATOR AND USER DATA                    04400020
*                             ALIAS INDICATOR 1 BIT                     04500020
*                             NUMBER OF TTRS IN USE                     04600020
*        BYTE  14-16   TTR OF FIRST TEXT RECORD                         04700020
*        BYTE  17      ZERO                                             04800020
*        BYTE  18-19   TTR OF NOTE LIST OR SCATTER                      04900020
*        BYTE  20      TRANSLATION TABLE                                05000020
*        BYTE  21      ZERO OR NUMBER OF ENTRIES IN                     05100020
*        BYTE  22-23   ATTRIBUTES                                       05200020
*        BYTE  24-26   TOTAL CONTIGUOUS MAIN STORAG                     05300020
*        BYTE  27-28   LENGTH OF FIRST TEXT RECORD                      05400020
*        BYTE  29      LENGTH OF WTG TABLE (IN DOUB                     05500020
*        BYTE  30231   PATH THROUGH LOADS OF ROUTIN                     05600020
*        BYTE  32-34   IDTTR OF EXECUTOR FOR FIRST                      05700020
*        BYTE  35      WORKAREA ADDRESS FOR FIRST D                     05800020
*        BYTE  36-39   TABLE OF IDTTRS                                  05900020
*        BYTE  32+N(8) IDTTR OF EXECUTOR FOR NTH DCB  (3 BYTES)         06000020
*                      WORKAREA ADDRESS FOR NTH DCB   (1 BYTE )         06100020
*                      IDTTR OF LAST ROUTINE LOAD     (3 BYTES)         06200020
*                      NOT USED                                         06300020
*                                                                       06400020
*                                                                       06500020
*                                                                       06600020
*                                                                       06700020
*                                                                       06800020
* ATTRIBUTES                                                            06900020
*        REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY UNLESS Y02072 06950002
*        OTHERWISE SPECIFIED, SUPER STATE                        Y02072 07000002
*                                                                       07100020
*NOTES                                                                  07200020
*        ALL REG EQUATES HAVE AN 'R' AT BEGINNING                       07300020
*                                                                       07400020
*                                                                       07500020
RDCB     EQU   2                        DCB ADDR                        07600020
RBASE    EQU   3                        BASE REG                        07700020
RCORE    EQU   4                        WORK AREA ADDR                  07800020
RPAR     EQU   5                        TOP OF PARAMETER LIST           07900020
RWTG     EQU   6                        TOP OF WTG TABLE                08000020
RPARC    EQU   7                        CURRENT PARAMETER               08100020
RWTGC    EQU   8                        CURRENT TRANSFER LOAD           08200020
RWK1     EQU   9                        WORK REGISTER            Y02072 08300002
RUCB     EQU   10                       HERE HOLD CONST 8               08500020
RDEB     EQU   11                       HERE HOLDS DCBCHP               08600020
RB       EQU   12                       CHP POINTER                     08700020
RC       EQU   13                       IOB POINTER                     08800020
RRET     EQU   RC                       RETURN ADDR REGISTER     Y02072 08850002
RD       EQU   14                       WORK REG AND CCW POINTER        08900020
RWK3     EQU   RD                       WORK REGISTER            Y02072 08950002
RJ       EQU   15                       WORK REG AND INDEX REG          09000020
RE       EQU   0                        WORK REG                        09100020
RF       EQU   1                        WORK REG                        09200020
RWK4     EQU   RF                       WORK REGISTER            Y02072 09250002
*                                                                       09300020
*                                                                       09400020
*                                                                       09500020
*                                                                       09600020
*                                                                       09700020
*                                                                       09800020
* DISPLACEMENTS AS EQUATES                                              09900020
*                                                                       10000020
*                                                                       10100020
D0       EQU   0                        DISPLACEMENT OF ZERO            10200020
D1       EQU   1                        DISPLACEMENT OF ONE             10300020
D2       EQU   2                        DISPLACEMENT OF TWO             10400020
D3       EQU   3                        DISPLACEMENT OF THREE           10500020
D4       EQU   4                        DISPLACEMENT OF FOUR            10600020
D5       EQU   5                        DISPLACEMENT OF FIVE            10700020
D6       EQU   6                        DISPLACEMENT OF SIX             10800020
D12      EQU   12                       DISPLACEMENT OF TWELVE          10900020
D14      EQU   14                       DISPLACEMENT OF FOURTEEN        11000020
D16      EQU   16                       DISPLACEMENT OF SIXTEEN         11100020
D32      EQU   32                       DISPLACEMENT OF THIRTYTWO       11200020
*                                                                       11300020
*                                                                       11400020
* BYTE COUNTS AS EQUATES                                                11500020
*                                                                       11600020
ZERO     EQU   0                        BYTE COUNT OF ZERO              11700020
TWNTY    EQU   20                       BYTE COUNT OF 20                11800020
ONE      EQU   1                        BYTE COUNT OF ONE               11900020
TWO      EQU   2                        BYTE COUNT OF TWO               12000020
THREE    EQU   3                        BYTE COUNT OF THREE             12100020
FIVE     EQU   5                        BYTE COUNT OF FIVE              12200020
EIGHT    EQU   8                        BYTE COUNT OF EIGHT             12300020
SXTN     EQU   16                       BYTE COUNT OF SIXTEEN           12400020
TWFOUR   EQU   24                       BYTE COUNT OF 24                12500020
THRYSIX  EQU   36                       BYTE COUNT OF 36                12600020
FRTY     EQU   40                       BYTE COUNT OF 40                12700020
*                                                                       12800020
*                                                                       12900020
* CCW COMMANDS                                                          13000020
*                                                                       13100020
SRCH     EQU   X'31'                    SEARCH COMMAND                  13200020
TIC      EQU   X'08'                    TIC                             13300020
RDCNT    EQU   X'92'                    READ COUNT                      13400020
RDDATA   EQU   X'86'                    READ DATA                       13500020
NOP      EQU   X'03'                    NO OPERATION                    13600020
MTSRCH   EQU   X'B1'                    MULTI TRACK SEARCH              13700020
WRTCKD   EQU   X'1D'                    WRT COUNT, KEY AND DATA         13800020
MTRDD    EQU   X'86'                    READ DATA                       13900020
SETSC    EQU   X'23'                    SET SECTOR                      14000020
RDSC     EQU   X'22'                    READ SECTOR                     14100020
*                                                                       14200020
*                                                                       14300020
* CCW FLAGS                                                             14400020
*                                                                       14500020
PCI      EQU   X'08'                    PROGRAM CONTROLED INTERR        14600020
SKIP     EQU   X'10'                    SKIP FLAG                       14700020
SIL      EQU   X'20'                    SILI FLAG                       14800020
CC       EQU   X'40'                    COMMAND CHAIN                   14900020
DC       EQU   X'80'                    DATA CHAIN                      15000020
*                                                                       15100020
*                                                                       15200020
* MASKS                                                                 15300020
*                                                                       15400020
UFORM    EQU   X'C0'                    FORMAT 'U' RECORDS              15500020
FFORM    EQU   X'80'                    FORMAT 'F' RECORDS              15600020
UORVFORM EQU   X'40'                    FORMAT 'U' OR 'V' RECS   A46882 15650021
VALCHK   EQU   X'80'                    VALIDITY CHECK                  15700020
POINTB   EQU   X'04'                    POINT                           15800020
NORCDRY  EQU   X'20'                    NO RECORD READY                 15900020
PCIIND   EQU   X'04'                    PCI INDICATOR                   16000020
OUTIN    EQU   X'07'                    DCB FOR OUT/IN                  16100020
*                                                                       16200020
*                                                                       16300020
* MISCELLANEOUS EQUATES                                                 16400020
*                                                                       16500020
CMPNOERR EQU   X'7F'                    ECB INITIALIZATION              16600020
*                                       COMPLETE NO ERROR               16700020
CHPOFF   EQU   56                       CHANNEL PROG OFFSET IN MIOB     16800020
CHPADO   EQU   32                       OFF IN MIOB TO CHP ADDR         16900020
CCHHRO   EQU   51                       OFFSET IN MIOB TO SEEK FLD      17000020
RRWOF    EQU   96                       RCD READY WRITE CCW OFFSET DMOR 17100020
NWCPO    EQU   X'40'                    NORMAL CHP WRT OFFSET           17200020
NWCPL    EQU   X'05'                    NORMAL WRT CHP LENGTH IN        17300020
*                                       DWS                             17400020
MIOBSIZE EQU   80                       MAIN IOB SIZE                   17500020
RNOPOFF  EQU   56                       RD CHP NOP OFFSET               17600020
WNOPOFF  EQU   96                       WRT CHP NOP OFFSET              17700020
ICBWO    EQU   60                       WRT OFFSET IN ICB               17800020
ICBSEEK  EQU   35                       SEEK FIELD OFFSET IN ICB        17900020
ICBCHPO  EQU   40                       OFFSET IN ICB TO CHP            18000020
NWRTCHP  EQU   88                       NORM WRITE CHP OFFSET           18100020
BICBSIZE EQU   112                      BASIC ICB SIZE                  18200020
MAX      EQU   256                      MAXIMUM SS LENGTH OPERAND       18300020
OFFSICBS EQU   147                      BASIC OFFSET FROM ONE ICB       18400020
*                                       TO CHP OF NEXT ICB              18500020
IOBCEXCP EQU   X'80'                    IOBCNOPA FLAG            YM6583 18550002
SEEKOFF  EQU   48                       OFFSET TO MIOB SEEK             18600020
CNTOFF   EQU   7                        OFFSET IN CCW TO CNT FLD        18700020
FLAGOFF  EQU   4                        OFFSET IN CCW TO FLAG BYTE      18800020
RRWCPO   EQU   NWCPO+EIGHT              RECORD READY CHP OFFSET         18900020
*                                                                       19000020
*                                                                       19100020
*                                                                       19200020
*                                                                       19300020
*                                                                       19400020
*                                                                       19500020
*                                                                       19600020
*                                                                       19700020
*                                                                       19800020
         BALR  RBASE,RE                 ESTABLISH ADDRESSABILITY        19900020
         USING ENTRY,RBASE                                              20000020
         USING IHADCB,RDCB              DCB DSECT                       20100020
         USING FORCORE,RCORE            COMMON OPEN WORK AREA           20200020
*                                                                       20300020
ENTRY    EQU   *                                                        20400020
*                                                                       20450002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 20460002
         DC    C'IGG0191X'              MODULE NAME              Y02072 20470002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 20480003
         DC    C'10/17/74'              LAST DATE MODIFIED     @Z30TSCF 20490003
BEGIN    DS    0H                                                Y02072 20492002
*                                                                       20500020
         L     RCORE,D4(RWTGC)          LOAD RCORE BASE                 20600020
*                                                                       20700020
         L     RDCB,D0(RPARC)           GET DCB ADDRESS                 20800020
*                                                                       20900020
* TEST FOR ONE BUFFER WHICH IS NOT ALLOWED WITH CHAINED SCHEDULING      21000020
*                                                                       21100020
         CLI   DCBNCP,ONE               IS NUMBER OF CHP EQ ONE         21200020
         BH    LAB007                   IF NO BRANCH                    21300020
*                                       YES SET UP TO XCTL              21400020
         USING WTGENTRY,RWTGC                                    Y02072 21450002
         MVC   WTGIDTTR,SOP8A           ID FOR DISK EXECUTOR   @Z30TSCF 21460003
         B     RELOOP                   GO TO XCTL RTN                  21600020
*                                                                       21700020
*                                                                       21800020
LAB007   EQU   *                                                        21900020
         OI    DCBCIND2,PCIIND          TURN ON PCI INDICATOR           22000020
         LA    RF,MIOBSIZE              GET BASIC IOB SIZE              22100020
         LA    RUCB,EIGHT               CONSTANT OF EIGHT               22200020
*                                                                       22300020
* TEST OF NOTE/POINT BEING USED                                         22400020
*                                                                       22500020
         TM    DCBMACRF,POINTB          NOTE/POINT BEING USED           22600020
         BZ    LAB011                   NO THEN BRANCH                  22700020
         MVI   DCBCNTRL+D1,FIVE         STORE INDEX FOR N/P ID          22800020
LAB011   EQU   *                                                        22900020
*                                                                       23000020
*                                                                       23100020
         SR    RD,RD                    CLEAR REG FOR ACCUMULATION      23200020
*                                       OF ICB LENGTH                   23300020
*                                                                       23400020
* SET UP CONTROL FIELDS AND INITIALIZE COUNT REGS                       23500020
*                                                                       23600020
         MVI   DCBCNTRL+D2,ONE          DISK EOBW IND FOR LOAD MOD      23700020
         MVI   DCBCNTRL+D3,TWO          DA IN EOB IDS                   23800020
         MVI   DCBWCPO,NWCPO            PUT NORMAL WRT CHP OFFSET       23900020
*                                       IN DCB                          24000020
         LA    RC,NWCPL                 GET NORMAL WRT CHP LENGTH       24100020
         MVC   DCBOFFSR(TWO),OFFSETD    PUT OFFSETS IN DCB              24200020
         LA    RDEB,WNOPOFF             GET NORMAL WRITE NOP OFFSET     24300020
*                                                                       24400020
* CHECK FOR RECORD READY FEATURE IF BEING USED INCREMENT COUNTS         24500020
*                                                                       24600020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       24700020
         BO    LAB017                   BRANCH IF YES                   24800020
         MVI   DCBOFFSW,RRWOF           CHANGE WRITE OFFSET             24900020
         MVI   DCBWCPO,RRWCPO           RCD READY OFFSET IN DCB         25000020
         LA    RC,ONE(RC)               INCREMENT CCW COUNT             25100020
         AR    RDEB,RUCB                NOP OFFSET PLUS EIGHT (WRT)     25200020
         LA    RF,SXTN(RF)              INCR MAIN IOB SIZE              25300020
         LA    RD,SXTN(RD)              INCR ICB SIZE                   25400020
LAB017   EQU   *                                                        25500020
*                                                                       25600020
* STORE COUNTS                                                          25700020
*                                                                       25800020
*                                                                       25900020
*                                                                       26000020
* CHECK FOR VALIDITY CHK AND INCREMENT COUNTS                           26100020
*                                                                       26200020
         TM    DCBOPTCD,VALCHK          VAL CHK USED                    26300020
         BNO   LAB029                   BRANCH IF NO                    26400020
         LA    RD,TWFOUR(RD)            INCR ICB SIZE                   26500020
         LA    RDEB,TWFOUR(RDEB)        INCR WRT NOP OFFSET             26600020
         LA    RC,THREE(RC)             INCR CCW COUNT                  26700020
*                                                                       26800020
* NOW CHK AGAIN FOR RCD READY FEATURE AND INCREMENT COUNTS              26900020
LAB021   EQU   *                                                        27000020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       27100020
         BO    LAB029                   BRANCH IF YES                   27200020
         AR    RD,RUCB                  INCR ICB COUNT FOR SET          27300020
*                                       SECTOR CMND IN WRT CHK          27400020
         AR    RDEB,RUCB                INCR NOP OFFSET FOR SAME        27500020
*                                       CMND                            27600020
         AR    RDEB,RUCB                INCREMENT                       27700020
         LA    RC,ONE(RC)               INCR WRT CHP LENGTH             27800020
*                                                                       27900020
* STORE OF REMAINING COUNTS                                             28000020
LAB029   EQU   *                                                        28100020
         STC   RC,DCBWCPL               PUT CHP LENGTH IN DCB           28200020
*                                                                       28300020
* NOW CALCULATE TOTAL CORE NEEDED FOR ICBS                              28400020
*                                                                       28500020
         LA    RD,BICBSIZE(RD)          INCREMENT ICB COUNT FOR         28600020
*                                       BASIC ICB                       28700020
         LR    RB,RD                    COPY AMOUNT                     28800020
         SRL   RB,THREE                 DIVIDE BY DW                    28900020
         STC   RB,DCBIOBL               PUT IN DCB                      29000020
         SR    RJ,RJ                    CLEAR REGISTER                  29100020
         IC    RJ,DCBNCP                GET NO. OF CHPS TO BE BUILT     29200020
         MR    RD,RD                    AMOUNT OF SPACE NEEDED          29300020
*                                       MINUS MAIN IOB                  29400020
*                                                                       29500020
* GET TOTAL AMOUNT OF CORE NEEDED AND ISSUSE GET MAIN                   29600020
*                                                                       29700020
         AR    RJ,RF                    MAIN IOB PLUS TOTAL ICBS        29800020
         LR    RC,RJ                    SAVE AMOUNT FOR CLEARING        29900020
*                                                                       30000020
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE      YM4697 30050002
*  IOB AND ICBS IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE     YM4697 30060002
*  CLOSE EXECUTOR.                                               YM4697 30070002
*                                                                       30100020
         ST    RJ,DXATEXC2              SAVE LENGTH              YM4697 30110002
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 30150002
         GETMAIN R,LV=(RJ),SP=0                                  Y02072 30200002
         LR    RB,RF                    COPY ADDRESS USED TO CLR        30400020
*                                                                       30500020
* CLEAR OF RECEIVED CORE  RB=ADDRESS   RC=AMOUNT                        30600020
*                                                                       30700020
         LR    RJ,RC                    SAVE AMOUNT FOR THETA ADDRS     30800020
         LA    RD,MAX                   CONST OF 256                    30900020
         B     LABCLR                   BRANCH TO CLEAR                 31000020
LABSLO   EQU   *                                                        31100020
         XC    D0(D1,RB),D0(RB)         CLEARS REMAING BYTES            31200020
LABSHI   EQU   *                                                        31300020
         XC    D0(MAX,RB),D0(RB)        CLEAR 256 BYTES                 31400020
         AR    RB,RD                    ADD 256 TO ADDR                 31500020
LABCLR   EQU   *                                                        31600020
         SR    RC,RD                    SUB 256 FROM AMOUNT             31700020
         BH    LABSHI                   BRANCH AMT GT 256               31800020
         AR    RC,RD                    CORRECT AMT                     31900020
         BCTR  RC,RE                    REDUCE AMT BY ONE RE=0          32000020
         EX    RC,LABSLO                                                32100020
*                                                                       32200020
* SET UP THETA ADDRESSES MAY BE USED LATER                              32300020
*                                                                       32400020
         AR    RJ,RF                    GET LAST AREA ADDR + 1          32500020
         SR    RJ,RUCB                  REDUCE BY EIGHT                 32600020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 32610002
         ST    RWK4,DCBIOBAD            PUT MAIN IOB IN DCB      Y02072 32650002
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 32660002
         ST    RJ,DXCCW11               TEMP STORE SET THETA ADDR       32700020
*                                                                       33000020
* START CONST OF MAIN IOB HERE                                          33100020
*                                                                       33200020
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 33260002
         STC   RDEB,D3(RF)              PUT WRT NOP OFFSET IN MIOB      33300020
         IC    RDEB,DCBNCP              LOAD NO. OF CHANL PROGRAMS      33400020
         MVI   D2(RF),RNOPOFF                                           33500020
         LA    RE,D4(RF)                ECB ADDR                        33600020
         ST    RE,TWNTY(RF)             PUT ADDR IN ECB POINTER         33700020
         MVI   D4(RF),CMPNOERR          INITIALIZE ECB                  33800020
         L     RWK1,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 33850002
         USING IOBQSAMC,RWK4                                     Y02072 33900002
         ST    RWK1,IOBDCBPT            DCB ADDR TO IOB          Y02072 33950002
         DROP  RWK4                                              Y02072 34000002
*                                                                       34100020
*                                                                       34200020
         LA    RD,CHPOFF(RF)            GET CHP OFFSET IN IOB           34300020
         ST    RD,CHPADO(RF)            PUT IN MAIN IOB                 34400020
         MVC   SEEKOFF(EIGHT,RF),DCBFDAD DISK ADDR TO MIOB              34500020
*                                                                       34600020
* START CONSTRUCTION OF MAIN IOB CHP                                    34700020
*                                                                       34800020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       34900020
         BO    LAB033                   BRANCH IF YES                   35000020
         BAL   RC,LABSTA                IF NO GO BUILD SET SECT         35100020
LAB033   EQU   *                                                        35200020
*                                                                       35300020
* CONSTRUCTION OF SEARCH AND TIC CCWS                                   35400020
*                                                                       35500020
         LA    RE,CCHHRO(RF)            GET CCHHR ADDR                  35600020
         BAL   RC,LABSRCH               GO BUILD IN SUB ROUTINE         35700020
*                                                                       35800020
* POINT TO FIRST ICB AND COMPLETE SECOND TIC CCW                        35900020
*                                                                       36000020
         LA    RB,EIGHT(RD)             PT RB TO FIRST ICB              36100020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 36160002
         ST    RB,DCBIOBA               PUT IN DCB                      36200020
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 36260002
         LA    RC,FRTY(RB)              GET ICB CHP ADDR                36300020
         ST    RC,D0(RD)                PUT IN CCW                      36400020
         MVI   D0(RD),TIC               PUT IN TIC CMND                 36500020
         ST    RB,EIGHT(RF)             FIRST ICBAD TO MIOB             36600020
         AR    RD,RUCB                  INCR CCW PTR                    36700020
*                                                                       36800020
*                                                                       36900020
*                                                                       37000020
* START OF LOOP TO BUILD ICBS                                           37100020
*                                                                       37200020
LAB051   EQU   *                                                        37300020
         ST    RD,D0(RB)                     LINKAD TO ICB              37400020
*                                            REDUNDANT FOR FIRST        37500020
*                                            TIME                       37600020
         LR    RB,RD                         NEW ICB ADDR               37700020
         LA    RC,D4(RB)                     ECB ADDR                   37800020
         ST    RC,D12(RB)                    PUT IN ICB                 37900020
         MVI   D4(RB),CMPNOERR               INIT ECB COMPLETE NO       38000020
*                                            ERROR                      38100020
         LA    RD,D32(RB)                    PT TO MBBCCHHR FIELD OF    38200020
*                                            ICB                        38300020
         MVC   D0(EIGHT,RD),DCBFDAD          FULL DISK ADDR TO ICB      38400020
*                                                                       38500020
* ICB INITIALIZATION COMPLETE                                           38600020
*                                                                       38700020
         AR    RD,RUCB                       INCR RD TO BECOME CCW      38800020
*                                            PTR                        38900020
* CLEAR INDEX REG AND GET ICB SIZE                                      39000020
*                                                                       39100020
         SR    RJ,RJ                         CLEAR REG                  39200020
         IC    RJ,DCBIOBL               GET ICB SIZE IN DW              39300020
         SLL   RJ,THREE                 TIMES EIGHT                     39400020
         LA    RE,ICBSEEK(RB,RJ)        NEXT ICB SEEK FIELD             39500020
         ST    RE,D0(RD)                PUT IN CCW                      39600020
         MVI   FLAGOFF(RD),CC+PCI+SIL   SET FLAGS                       39700020
         BAL   RRET,LAB666              GO RESET PCI BIT IF      Y02072 39750002
*                                         NECESSARY              Y02072 39760002
         MVI   CNTOFF(RD),FIVE          SET BYTE COUNT                  39800020
         MVI   D0(RD),RDCNT             PUT IN CMND BYTE                39900020
         AR    RD,RUCB                  INCR CCW PTR                    40000020
*                                                                       40100020
* READ COUNT CCW COMPLETED                                              40200020
*                                                                       40300020
*                                                                       40400020
         MVI   FLAGOFF(RD),CC           TURN ON CMND CHAIN              40500020
         TM    DCBRECFM,UORVFORM        TEST FOR UNDEF OR        A46882 40550021
*                                          VARIABLE LENGTH RECS  A46882 40600021
*                                          IF YES, TURN ON SILI  A46882 40650021
         BNO   LAB069                   NO, DON'T TURN ON SILI   A46882 40700021
         OI    FLAGOFF(RD),SIL          TURN ON SILI BIT                41300020
LAB069   EQU   *                                                        41400020
*                                                                       41500020
         MVI   D0(RD),RDDATA            SET CCW CMND BYTE               41600020
         AR    RD,RUCB                  INCR CCW PTR                    41700020
*                                                                       41800020
* READ DATA CCW COMPLETETED                                             41900020
*                                                                       42000020
*                                                                       42100020
         LA    RE,ICBCHPO(RB,RJ)        GET ADDR OF NEXT ICB CHP        42200020
         BAL   RC,LABNOP                GO BUILD NOP                    42300020
*                                                                       42400020
* NOP COMMAND COMPLETED READ PORTION OF CHANNEL PROG COMPLETED          42500020
*                                                                       42600020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       42700020
         BO    LAB075                   BRANCH IF YES                   42800020
         BAL   RC,LABNOPS               GO BUILD NOP/TIC AND RD SEC     42900020
LAB075   EQU   *                                                        43000020
*                                                                       43100020
* IF NEEDED READ SECTOR COMMAND COMPLETED                               43200020
*                                                                       43300020
* START OF WRITE CHANNEL PROGRAM                                        43400020
*                                                                       43500020
         LA    RE,ICBSEEK(RB)           GET ICB SEEK ADDR               43600020
         BAL   RC,LABSRCH               GO BUILD SEARCH AND TIC         43700020
         SH    RD,CON16                 BACK UP POINTER                 43800020
         MVI   D0(RD),MTSRCH            PUT I M-T SRCH CMND             43900020
         AH    RD,CON16                 INCR CCW PTR                    44000020
*                                                                       44100020
* SEARCH AND TIC CMND COMPLETE                                          44200020
*                                                                       44300020
*                                                                       44400020
*                                                                       44500020
         LA    RE,ZERO(RB,RJ)           POINT TO NEXT ICB               44600020
         SR    RE,RUCB                  BACK UP TO CCHHRR FIELD         44700020
         ST    RE,D0(RD)                PUT IN CCW                      44800020
         MVI   FLAGOFF(RD),DC+SIL+PCI   TURN ON DC, SILI, AND PCI       44900020
*                                       FLAGS                           45000020
         BAL   RRET,LAB666              GO RESET PCI BIT IF      Y02072 45050002
*                                         NECESSARY              Y02072 45060002
         MVI   CNTOFF(RD),EIGHT         SET BYTE CNT TO EIGHT           45100020
         MVI   D0(RD),WRTCKD            PUT IN WRT COUNT KEY DATA       45200020
*                                       CCW CMND                        45300020
         AR    RD,RUCB                  INCR CCW PTR                    45400020
*                                                                       45500020
* WRT COUNT KEY DATA CCW COMPLETED                                      45600020
*                                                                       45700020
         MVI   FLAGOFF(RD),SIL+CC       TURN ON SILI FLAG IN CCW        45800020
*                                       NEXT CCW ALL THAT IS NEEDED     45900020
*                                       SINCE REST COMPLETED BY EOB     46000020
         AR    RD,RUCB                  INCR CCW PTR                    46100020
*                                                                       46200020
*                                                                       46300020
* CHECK FOR WRITE CHECK REQUESTED                                       46400020
*                                                                       46500020
         TM    DCBOPTCD,VALCHK          VAL CHK REQUESTED               46600020
         BNO   LAB101                   BRANCH IF NO                    46700020
         SR    RD,RUCB                  BACK UP CCW POINTER             46800020
         OI    FLAGOFF(RD),CC           COMMAND CHAIN PREV CCW          46900020
         AR    RD,RUCB                  RESTORE POINTER                 47000020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       47100020
         BO    LAB095                   BRANCH IF YES                   47200020
         OI    FLAGOFF(RD),CC           COMMAND CHAIN CCW               47300020
         BAL   RC,LABRTA                GO BUILD RD SECTOR              47400020
         BAL   RC,LABSTA                GO BUILD SET SECT CMND          47500020
         SR    RD,RUCB                  BACK UP POINTER                 47600020
         OI    D3(RD),D1                INCREMENT ADDR BY ONE           47700020
*                                       THIS WORKS SINCE ADDR IS        47800020
*                                       ALWAYS ON A DW BOUNDARY         47900020
         AR    RD,RUCB                  RESTORE POINTER                 48000020
LAB095   EQU   *                                                        48100020
*                                                                       48200020
* BUILD SRCH AND TIC CMND                                               48300020
*                                                                       48400020
         LA    RE,D0(RJ,RB)             POINT TO NEXT ICB               48500020
         SR    RE,RUCB                  BACK UP TO CCHHR ADDR           48600020
         BAL   RC,LABSRCH               GO BUILD SEARCH AND TIC         48700020
*                                                                       48800020
* SRCH AND TIC FOR VAL CHK COMPLETED                                    48900020
*                                                                       49000020
         MVI   FLAGOFF(RD),CC+SIL+SKIP  TURN ON SILI, SKIP AND SKIP     49100020
*                                       FLAGS                           49200020
         MVI   D0(RD),MTRDD             PUT IN CCW CMND                 49300020
         AR    RD,RUCB                  INCR CCW PTR                    49400020
*                                                                       49500020
*                                                                       49600020
* LAST CCW IN CHP IS NOP                                                49700020
*                                                                       49800020
LAB101   EQU   *                                                        49900020
         LA    RE,NWRTCHP(RB,RJ)        GET NORM WRT CHP ADDR OF        50000020
*                                       NEXT ICB                        50100020
         BAL   RC,LABNOP                GO BUILD NOP                    50200020
*                                                                       50300020
* CHECK FOR RCD READY FEATURE AND IF BEING USED MUST BUILD READ         50400020
* SECTOR COMMAND                                                        50500020
*                                                                       50600020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       50700020
         BO    LAB091                   BRANCH IF YES                   50800020
         TM    DCBOPTCD,VALCHK          WRT CHECK USED                  50900020
         BO    LAB091                   BRANCH IF YES                   51000020
         BAL   RC,LABNOPS               GO BUILD NOP/TIC AND RD SEC     51100020
LAB091   EQU   *                                                        51200020
*                                                                       51300020
* CHANNEL PROGRAM FINISHED HERE, CHECK FOR MORE TO BE BUILT             51400020
*                                                                       51500020
         AR    RD,RUCB                  INCR PTR TO NEXT ICB            51600020
         BCT   RDEB,LAB051              IF MORE CCWS TO BE BUILT        51700020
*                                       GO BUILD THEM                   51800020
*                                                                       51900020
* IF ALL ICBS BUILT DO FINISH UP LOGIC                                  52000020
*                                                                       52100020
         L     RC,DCBIOBA               GET FIRST ICB POINTER      DMOR 52200020
         ST    RC,ZERO(RB)              PUT IN LAST ICB            DMOR 52300020
         LA    RE,ICBSEEK(RC)           GET FIRST ICB SSEK ADDR    DMOR 52400020
         ST    RE,ICBCHPO(RB)           PUT IN LAST ICB RD CNT     DMOR 52500020
         MVI   ICBCHPO(RB),RDCNT        RESTORE CCW CMND           DMOR 52600020
         LA    RE,ICBCHPO(RC)           PT TO FIRST ICB CHP        DMOR 52700020
*                                                                  DMOR 52800020
* ICBS AND RD CNTS LINKED                                          DMOR 52900020
*                                                                  DMOR 53000020
         LA    RDEB,RNOPOFF(RB)         PT TO LAST ICBS RD NOP          53100020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY  DMOR 53200020
         BO    LAB111                   BRANCH IF YES              DMOR 53300020
         ST    RE,D4(RDEB)              PUT ADDR IN RH OF NOP/TIC  DMOR 53400020
         B     LAB115                   BRANCH AROUND NEXT         DMOR 53500020
*                                                                  DMOR 53600020
LAB111   EQU   *                                                   DMOR 53700020
*                                                                  DMOR 53800020
         ST    RE,D0(RDEB)              PUT IN NOP CCW             DMOR 53900020
         MVI   D0(RDEB),NOP             RESTORE NOP CMND           DMOR 54000020
*                                                                  DMOR 54100020
*                                                                  DMOR 54200020
LAB115   EQU   *                                                        54300020
*                                                                  DMOR 54400020
         LA    RC,RNOPOFF(RC)           PT TO WRT CHP ADDR         DMOR 54500020
         SH    RD,CON16                 BACK UP CCW PTR PAST CCHHR DMOR 54600020
         TM    DCBOPTCD,VALCHK          WRT CHK USED               DMOR 54700020
         BO    LAB121                   BRANCH IF YES              DMOR 54800020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY  DMOR 54900020
         BO    LAB121                   BRANCH IF YES              DMOR 55000020
         SR    RD,RUCB                  BACK PAST RD SECTOR        DMOR 55100020
         AR    RC,RUCB                  INCR POINTER                    55200020
         ST    RC,D4(RD)                PUT ADDR IN RH OF NOP/TIC  DMOR 55300020
         B     LAB141                   GO AROUND NEXT INSTS       DMOR 55400020
*                                                                  DMOR 55500020
LAB121   EQU   *                                                   DMOR 55600020
*                                                                  DMOR 55700020
         ST    RC,D0(RD)                PUT ADDR IN LAST ICB NOP   DMOR 55800020
         MVI   D0(RD),NOP               RESTORE NOP CMND           DMOR 55900020
*                                                                  DMOR 56000020
LAB141   EQU   *                                                   DMOR 56100020
*                                                                  DMOR 56200020
         L     RC,DCBIOBA               GET FIRST ICB ADDR         DMOR 56300020
         L     RDEB,DCBDEBAD            GET DEB ADDR               DMOR 56400020
*                                                                  DMOR 56500020
* NOPS NOW LINKED TO CHANNEL PROGRAMS                              DMOR 56600020
*                                                                  DMOR 56700020
         TM    SXTN(RDEB),OUTIN         DCB FOR OUT/IN             DMOR 56800020
         BO    LAB151                   BRANCH IF YES              DMOR 56900020
         LA    RE,RNOPOFF(RC)           GET RD NOP ADDR            DMOR 57000020
         B     LAB161                   GO AROUND NEXT             DMOR 57100020
*                                                                  DMOR 57200020
LAB151   EQU   *                                                   DMOR 57300020
*                                                                  DMOR 57400020
         LA    RE,WNOPOFF(RC)           GET NORM WRITE NOP OFFSET  DMOR 57500020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY  DMOR 57600020
         BO    LAB161                   BRANCH IF YES              DMOR 57700020
         AR    RE,RUCB                  INCR OFFSET REG            DMOR 57800020
*                                                                  DMOR 57900020
LAB161   EQU   *                                                   DMOR 58000020
*                                                                  DMOR 58100020
         ST    RE,D12(RF)               PUT NOP OFFSET IN MIOB          58200020
         MVI   12(RF),IOBCEXCP          SET EXCP NEEDED FLAG     YM6583 58250002
*                                                                       58300020
* SET UP FOR XCTL OUT TO NEXT EXECUTOR                                  58400020
*                                                                       58500020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 58510002
         USING WTGENTRY,RWTGC                                    Y02072 58560002
         MVC   WTGIDTTR,NXTEXEC         NEXT EXECUTOR          @Z30TSCF 58570003
RELOOP   EQU   *                                                        58900020
         LA    RWTGC,EIGHT(RWTGC)       INCR  CURRENT WTG ENTRY         59000020
         LA    RPARC,D4(RPARC)          INCR DCB ENTRY PTR              59100020
         CLC   D0(TWO,RWTGC),AMIDCNST   IS THIS RTN NEEDED AGAIN        59200020
         BCR   EIGHT,RBASE              IF YES GO BACK                  59300020
*                                                                       59400020
         CLC   D0(TWO,RWTGC),OPIDCNST   IS THIS END OF TABLE            59500020
         BNE   RELOOP                   BRANCH IF NO                    59600020
*                                                                       59700020
         LR    RPARC,RPAR                                               59800020
         LA    RWTGC,D32(RWTG)          REINIT WTG LIST PTR             59900020
ZCHEK    EQU   *                                                        60000020
         CLI   D0(RWTGC),ZERO           THIS ENTRY COMPLETE             60100020
         BNE   TCTLRTN                  BRANCH IF NO                    60200020
*                                                                       60300020
*                                                                       60400020
         LA    RWTGC,EIGHT(RWTGC)       GET NEXT ENTRY                  60500020
         LA    RPARC,D4(RPARC)                                          60600020
         B     ZCHEK                    GO TO NEXT ENTRY                60700020
*                                                                       60800020
*                                                                       60900020
TCTLRTN  EQU   *                                                        61000020
*                                                                       62000020
         USING WTG,RWTG                                                 62050003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*62060003
               MODID=WTGENTRY                                  @Z30TSCF 62080003
         DROP  RWTGC,RWTG                                      @Z30TSCF 62090003
*                                                                       62100020
*                                                                       62200020
* SET SECTOR BUILD RTN                                                  62300020
*                                                                       62400020
LABSTA   EQU   *                                                        62500020
         L     RE,DXCCW11               GET SET THETA ADDR              62600020
         ST    RE,D0(RD)                PUT IN CCW                      62700020
         MVI   D0(RD),SETSC             PUT IN CCW CMND                 62800020
         OI    FLAGOFF(RD),CC           COMMAND CHAIN CCW               62900020
         B     LAB555                   GO FINISH CCW                   63000020
*                                                                       63100020
*                                                                       63200020
*                                                                       63300020
*                                                                       63400020
* NOP AND READ SECTOR ENTRY                                             63500020
*                                                                       63600020
*                                                                       63700020
LABNOPS  EQU   *                                                        63800020
*                                                                       63900020
         SR    RD,RUCB                  BACK UP POINTER                 64000020
         MVC   D5(THREE,RD),D1(RD)      MOVE ADDR TO RH OF TIC NOP      64100020
         LA    RE,EIGHT(RD)             GET NEXT CCW POINTER            64200020
         ST    RE,D0(RD)                PUT IN CCW                      64300020
         MVI   D0(RD),TIC               CHANGE NO TO TIC                64400020
         AR    RD,RUCB                  INCR POINTER                    64500020
*                                                                       64600020
*                                                                       64700020
* READ SECTOR BUILD RTN                                                 64800020
LABRTA   EQU   *                                                        64900020
         L     RE,DXCCW11               GET READ THETA ADDR      Y02072 65000002
         ST    RE,D0(RD)                PUT IN CCW                      65100020
         MVI   D0(RD),RDSC              PUT IN CCW CMND                 65200020
LAB555   EQU   *                                                        65300020
         MVI   CNTOFF(RD),ONE           SET BYTE CNT TO ONE             65400020
         AR    RD,RUCB                  INCR PTR                        65500020
         BR    RC                       RETURN                          65600020
*                                                                       65700020
* SEARCH AND TIC BUILD ROUTINE                                          65800020
*                                                                       65900020
LABSRCH  EQU   *                                                        66000020
         ST    RE,D0(RD)                PUT ADDR IN CCW                 66100020
         MVI   FLAGOFF(RD),CC           TURN ON CC                      66200020
         MVI   CNTOFF(RD),FIVE          SET BYTE CNT TO FIVE            66300020
         ST    RD,EIGHT(RD)             PUT SRCH CCW ADDR IN NEXT       66400020
*                                       CCW                             66500020
         MVI   D0(RD),SRCH              PUT IN SRCH CMND                66600020
         AR    RD,RUCB                  INCREMENT CCW PTR               66700020
         MVI   D0(RD),TIC               PUT IN TIC CMND                 66800020
         AR    RD,RUCB                  INCR CCW PTR                    66900020
         BR    RC                       RETURN                          67000020
*                                                                       67100020
* NOP BUILD ROUTINE                                                     67200020
*                                                                       67300020
LABNOP   EQU   *                                                        67400020
         ST    RE,D0(RD)                PUT IN CCW                      67500020
         MVI   FLAGOFF(RD),SIL          TURN ON SILI FLAG               67600020
         MVI   D0(RD),NOP               ENTER NOP CCW CMND              67700020
         MVI   CNTOFF(RD),ONE           SET BYTE COUNT TO ONE           67800020
         AR    RD,RUCB                  INCR POINTER                    67900020
         BR    RC                       RETURN                          68000020
*                                                                       68050002
* THE FOLLOWING ROUTINE TESTS TO SEE IF THIS JOB IS RUNNING IN   Y02072 68060002
* A VIRTUAL ENVIRONMENT.  IF YES, PCI BIT SHOULD NOT BE LEFT ON. Y02072 68070002
* IF NO, PCI BIT SHOULD BE LEFT ON.                              Y02072 68080002
*                                                                       68082002
LAB666   EQU   *                                                 Y02072 68084002
         L     RWK1,DCBDEBAD            GET DEB ADDRESS          Y02072 68086002
         USING DEBBASIC,RWK1                                     Y02072 68088002
         L     RWK1,DEBTCBAD            TCB ADDR FOR V=R TEST    Y02072 68088402
         DROP  RWK1                                              Y02072 68088802
         USING TCB,RWK1                                          Y02072 68089202
         TM    TCBFLGS6,TCBRV           JOB RUNNING VIRT         Y02072 68089602
         BOR   RRET                     NO, LEAVE PCI BIT ON     Y02072 68089702
         USING CCW,RWK3                                          Y02072 68089802
         NI    CCWFLGS,X'FF'-CCWPCI     YES, TURN PCI BIT OFF    Y02072 68089902
         DROP  RWK3                                              Y02072 68093202
         BR    RRET                     RETURN MAINLINE          Y02072 68095202
*                                                                       68096702
* CONSTANTS                                                             68100020
*                                                                       68200020
CON16    DC    H'16'                    CONSTANT OF SIXTEEN             68300020
AMIDCNST DC    C'1X'                    THS ID                    DMOR  68400020
OPIDCNST DC    C'0S'                    END ID                          68500020
SOP8A    DC    C'1J',VL3(IGG0191J)      DISK EXECUTOR          @Z30TSCF 68550003
NXTEXEC  DC    C'13',VL3(IGG01913)   TO LOAD ACCESS METH RTNS  @Z30TSCF 68560003
OFFSETD  DC    X'3058'                  OFFSET                          68600020
         SPACE 6                                                        68650002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 68660002
END      EQU   *                        END OF MODULE            Y02072 68670002
         EJECT                                                          68680002
*                                                                       68700020
*                                                                       69500020
* DSECTS USED IN MODULE                                                 69600002
*                                                                       69700020
         DCBD  DSORG=PS                                                 69800020
*                                                                       70500020
         EJECT                                                          70510003
CVT      DSECT                                                 @Z30TSCF 70520003
         CVT                                                            70530003
         IECDSECS (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES     @Z30TSCF 70550003
         ORG   WTGIDTTR                                          Y02072 70552002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 70554002
         EJECT                                                          70556002
FORCORE  DSECT                                                   Y02072 70558002
         IHAFCAUD  ORG=YES                                       Y02072 70558402
         EJECT                                                          70558802
         IHACCW  DSECT=YES                                       Y02072 70560002
         EJECT                                                          70562002
         IKJTCB                                                  Y02072 70570002
         EJECT                                                          70572002
         IEZDEB                                                  Y02072 70580002
         END                                                            70600020
./  ADD  SSI=52840118,NAME=IGG0191Y
         TITLE  'IGG0191Y - SAM USER TOTALING FACILITY '                00100018
IGG0191Y CSECT                                                          00110003
*                                                                       00250002
*MODULE NAME - IGG0191Y                                          Y02072 00300002
*                                                                       00350002
*DESCRIPTIVE NAME - USER TOTALING OPEN EXECUTOR                  Y02072 00360002
*                                                                       00370002
*COPYRIGHT - NONE                                                Y02072 00380002
*                                                                       00390002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00392002
*                                                                       00394002
*          VS 1 RELEASE 3 DELETIONS/CHANGES                             00394402
*                                                                XA3085 00394802
*          VS2 RELEASE 2 DELETIONS                                      00396002
*001500,065000-066000,100000-102000,153500,154500,155500-155700, Y02072 00398002
*197000-198000,202500-252000,307000,441000,475000-482000,        Y02072 00398402
*508000-515000,567000-568000,352000-365000,373000,417000,        Y02072 00398802
*442000,443000,446000                                            Y02072 00398902
*                                                                YM1140 00399302
*          VS2 RELEASE 3 DELETIONS                                      00399903
*                                                              @Z30TSCF 00400003
*A146500-146800                                                 ZA00743 00409702
*D152000-155000                                                 ZA00743 00420002
*C145800                                                        ZA00743 00422002
*    OZ07019 IS FLAGGED AS AZ07019                              AZ07019 00426003
*                                                                       00430002
*          RELEASE 20 DELETIONS                                       * 00440002
*1753226000                                                      A30539 00450020
*1753345000,374000                                               M0653  00470020
*          RELEASE 21 DELETIONS                                       * 00500018
*3021164000-166000,335000,372000                                 A44122 00550021
*   REFER TO CODE FLAGGED XA3085                                SA66735 00560002
*                                                                       00600002
* STATUS CHANGE LEVEL 005                                               01200002
*                                                                       01300002
* FUNCTION                                                              01400018
*                                                                       01500018
* THE MODULE PERFORMS TWO FUNCTIONS FOR DATA SETS REQUIRING SUPPORT     01600018
* FROM THE SAM USER TOTALING FACILITY: FIRST IT CALCULATES THE SIZE OF  01700018
* THE WORK AREA REQUIRED TO SAVE THE USER'S HASH TOTALING AREA AND PRO- 01800018
* VIDES A GETMAIN FOR THIS SPACE AND SECONDLY IS ISSUED A LOAD FOR THE  01900018
* RESIDENT SAVE ROUTINE, IGG019AX.                                      02000018
*                                                                       02100018
*                                                                       02200018
* INPUT                                                                 02300018
*                                                                       02400018
* THE INPUT TO THIS MODULE IS THE SAME AS TO ALL OTHER SAM OPEN EXEC-   02500018
* CUTORS:                                                               02600018
*                                                                       02700018
*      REG 5 - THE ADDRESS OF THE WHERE-TO-GO TABLE                     02800018
*                                                                       02900018
*      REG 6 - THE ADDRESS OF THE (DCB) PARAMETER LIST                  03000018
*                                                                       03100018
*      REG 7 - THE CURRENT ENTRY IN THE WTG TABLE                       03200018
*                                                                       03300018
*      REG 8 - THE CURRENT DCB ADDRESS                                  03400018
*                                                                       03500018
*                                                                       03600018
* OUTPUT                                                                03700018
*                                                                       03800018
* SAME AS INPUT PLUS A POINTER IN THE USER'S DEB TO THE FORMATTED USER  03900018
* TOTALING SAVE AREA, WHICH IN TURN POINTS TO THE LOADED RESIDENT SAVE  04000018
* ROUTINE.                                                              04100018
*                                                                       04200018
*                                                                       04300018
* GENERAL FLOW                                                          04400018
*                                                                       04500018
* THIS MODULE IS ENTERED VIA AN XCTL FROM 196A OR 191N WHENEVER A DCB   04600002
* IS ENCOUNTERED WHICH HAS SPECIFIED USER TOTALING.  AFTER DETERMINING  04700002
* THAT THERE IS AN ENTRY FOR USER TOTALING IN THE DCB EXIT LIST (IF NOT 04800018
* FOUND, THE DCB IS SET AS NOT OPERABLE AND AN XCTL TO NEXT MODULE IS   04900018
* ACCOMPLISHED) THE SIZE OF THE AREA REQUIRED TO SAVE THE USER'S TOTAL- 05000018
* ING AREAS (PLUS CONTROL BLOCKS) IS CALCULATED AND A GETMAIN FOR THIS  05100018
* SPACE IS ISSUED.  AFTER THE GETMAIN THE CONTROL BLOCKS FOR THE WORK   05200018
* AREA ARE CONSTRUCTED AND THE ADDRESS OF THE SAVE AREA IS PLACED IN    05300018
* THE ACCESS METHOD PORTION OF THE DEB.  NEXT A LOAD IS ISSUED FOR THE  05400018
* RESIDENT SAVE ROUTINE (IGG019AX) AND THE ADDRESS OF THE SAVE ROUTINE  05500018
* IS PLACED IN THE SAVE AREA.  AN XCTL TO THE NEXT MODULE OF OPEN IS    05600018
* THEN ACCOMPLISHED.                                                    05700018
*                                                                       05800018
*                                                                       05900018
* SPECIAL CONDITIONS                                                    06000018
* 1.  IF THERE IS INSUFFICIENT FREE CORE TO SATISFY THE GETMAIN AN      06100018
*     ABEND OCCURS.                                                     06200018
*                                                                       06300018
* 2.  IF ANY OF THE FOLLOWING OCCUR THE DCB WILL BE SET TO       Y02072 06350002
*     'NOT OPENABLE' AND A DMABCOND MACRO WILL BE ISSUED.        Y02072 06400002
*      THE DMABCOND WILL CAUSE A WRITE TO PROGRAMMER WITHOUT     Y02072 06410002
*      AN ABEND FOR COMPATIBILITY WITH PREVIOUS RELEASES.        Y02072 06420002
*        A. NO DCB EXIT LIST                                     Y02072 06450002
*        B. NO TOTALING ENTRY IN DCB EXIT LIST                   Y02072 06500002
*        C. IMAGE AREA ADDRESS IS ZERO                           Y02072 06550002
*                                                                       06800018
* EXITS                                                                 06900018
*                                                                       07000018
* THIS MODULE XCTL'S TO THE NEXT OPEN EXECUTOR AS SPECIFIED IN THE WTG  07100018
* TABLE.  FOR NORMAL EXIT THE NEXT MODULE SELECTED FOR DATA SETS SUCC-  07200018
* ESSFULLY PROCESSED IS IGG0191B.                                       07300018
*                                                                     * 07400018
*FUNCTION      THIS EXECUTOR IS ENTERED IF THE OPTION                 * 07500002
*              CODE SPECIFIES THAT THE USER REQUIRES SUPPORT OF HIS   * 07600018
*              TATALING FEATURE AT END OF VOLUME (OPTCD=T).  IT       * 07700018
*              ISSUES A GETMAIN FOR THE WORKAREA REQUIRED TO SAVE     * 07800018
*              THE USER'S TOTALING FIELDS AND THE NECESSARY CONTROL   * 07900018
*              BLOCKS TO ENABLE THE EOV ROUTINE TO PRESENT THE        * 08000018
*              CORRECT FIELD TO HIM AT EOV TIME                       * 08100018
*                                                                     * 08200018
*ENTRY POINT - IGG0191Y                                               * 08300018
*                                                                     * 08400018
*              ENTERED FROM IGG0196A OR IGG0191N VIA AN XCTL          * 08500002
*                                                                     * 08600018
*INPUT                                                                * 08700018
*                                                                     * 08800018
*              WHERE-TO-GO (WTG) TABLE            REG 5 = RPAR        * 08900018
*              PARAMETER LIST                     REG 6 = RWTG        * 09000018
*              CURRENT ENTRY IN WTG TABLE         REG 7 = RPARC       * 09100018
*              CURRENT PARAMETER (DCB)            REG 8 = RWTGC       * 09200018
*                                                                     * 09300018
*OUTPUT        THE OUTPUT IS A FORMATTED SAVE AREA FOR THE USER       * 09400018
*              TOTALING FIELDS ASSOCIATED WITH PHYSICAL BLOCKS OF     * 09500018
*              DATA.  THE ADDR OF THIS AREA IS PLACED IN THE DEB      * 09600018
*                                                                     * 09700018
*EXITS         NORMAL - BALR TO SAM TOTALING ROUTINE - IGG019YY       * 09800018
*                       XCTL TO SAM EXECUTOR - IGG0191B               * 09900018
*              ABNORMAL - DCB IS SET AS NOT OPENABLE AND AN XCTL Y02072 10000002
*                         TO PROBLEM DETERMINATION IS MADE.      Y02072 10050002
*                                                                     * 10300018
*TABLES/WORKAREAS                                                     * 10400018
*                                                                     * 10500018
*              THE DSECTS USED ARE AT THE END OF THIS MODULE          * 10600018
*              THE WORKAREA IS SECURED VIA A GETMAIN, IS FORMATTED    * 10700018
*              AND IT IS DESCRIBED IN TOTSAVWA DSECT                    10800018
*                                                                     * 10900018
*MACROS - ACTION : GETMAIN, LOAD, XCTL, XCTLTABL, MODESET,       Y02072 10950002
*                  DMABCOND                                      Y02072 10960002
*                                                                       10970002
*ATTRIBUTES : REENTRANT, REUSABLE, RUNS IS SUPERVISOR STATE AND  Y02072 10980002
*             USER KEY UNLESS OTHERWISE SPECIFIED                Y02072 10990002
*                                                                     * 11000018
*********************************************************************** 11100018
*  REGISTER CONVENTIONS USED THRUOUT OPEN                             * 11200018
*                                                                     * 11300018
*********************************************************************** 11400018
RE       EQU   0                        WORK REG/PARM REG               11500018
RF       EQU   1                        WORK REG/PARM REG               11600018
RWK1     EQU   RF                       WORK REGISTER            Y02072 11650002
RDCB     EQU   2                        DCB BASE REG                    11700018
RBASE    EQU   3                        BASE REG FOR CSECT              11800018
RCORE    EQU   4                        WORK AREA BASE REG              11900018
RPAR     EQU   5                        START OF PARM LIST              12000018
RWTG     EQU   6                        START OF WTG TABLE              12100018
RPARC    EQU   7                        CURRENT ENTRY IN PARM LIST      12200018
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      12300018
RTIOT    EQU   9                        BASE REG FOR TIOT               12400018
RUCB     EQU   10                       BASE REG FOR UCB                12500018
RDEB     EQU   11                       BASE REG FOR DEB                12600018
RB       EQU   12                       WORK REG                        12700018
RC       EQU   13                       WORK REG                        12800018
RD       EQU   14                       WORK REG                        12900018
RJ       EQU   15                       WORK REG                        13000018
R15      EQU   RJ                       INPUT TO XCTL MACRO      Y02072 13050002
*                                                                     * 13100018
*********************************************************************** 13200018
*                                                                     * 13300018
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        13400018
         USING SUTF000,RBASE            ESTAB BASE REG                  13500018
         USING IHADCB,RDCB              ESTAB BASE REG                  13600018
         USING FORCORE,RCORE            ESTAB BASE REG FOR WRK AREA     13700018
         USING DEBB,RDEB                ESTAB DEB BASE REG              13800018
         USING TCB,RD                   ESTAB TCB BASE REG              13900018
         USING TIOT,RTIOT               ESTAB TIOT BASE REG             14000018
         USING UCBOB,RUCB               ESTAB UCB BASE REG              14100018
         USING TOTSAVWA,RF              ESTAB BASE FOR THIS DSECT     * 14200018
*********************************************************************** 14300018
*                                                                     * 14400018
SUTF000  EQU   *                                                        14500018
*                                                                       14510002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 14550002
         DC    C'IGG0191Y'              MODULE NAME              Y02072 14560002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 14570003
         DC    C'10/09/74'              LAST DATE MODIFIED     @Z30TSCF 14580003
BEGIN    DS    0H                                                Y02072 14590002
*                                                                     * 14600018
         L     RDCB,0(RPARC)            GET DCB ADDR            ZA00743 14650002
         LA    RDCB,0(RDCB)             CLEAR HI ORDER BYTE     ZA00743 14660002
         L     RDEB,DCBDEBAD            GET DEB ADDR            ZA00743 14670002
         L     RCORE,FOUR(RWTGC)        GET WORK AREA ADDR      ZA00743 14680002
         TM    0(RPARC),X'04'           TEST FOR UPDATE            UT18 14700018
         BZ    SUTF003                  NOT UPDAT,BRANCH           UT18 14800018
         TM    0(RPARC),X'0B'           MAY BE UPDAT,TEST FURTHER  UT18 14900018
         BZ    TURNOFF                  IF UPDAT,SKIP TOLTALING    UT18 15000018
SUTF003  EQU   *                                                   UT18 15100018
         MVI   TWENTY2(RWTG),LOADMASK   SET CODE IN WTG TO LOAD ONLY    15600018
LOADMASK EQU   X'CB'                    MASK FOR ONLY LOADABLE          15700018
*                                                                     * 15800018
         SR    RUCB,RUCB                CLEAR REG                       15900018
         SR    RF,RF                    CLEAR REG                       16000018
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS FROM DEB  16100018
         IC    RF,DEBEXSCL              GET SCALING FACTOR FROM DEB     16200018
         SLL   RUCB,0(RF)               SHIFT (MULT) PER EXTENT SIZE    16300018
         LA    RUCB,DEBBASI(RUCB,RDEB)  ADD BASIC DEB SIZE AND   A44122 16350021
*                                       DEB ADDR                        16400021
*                                                                       16450021
*        RUCB NOW POINTS TO ACCESS METHOD DEPENDENT SECTION             16500021
*        OF THE DEB                                                     16550021
*                                                                       16600021
*********************************************************************** 16700018
*  THE FOLLOWING SBRTN CHECKS THE USERS DCB EXIT LIST FOR A POINTER   * 16800018
*        TO HIS HASH TOTALING SAVE AREA                               * 16900018
*********************************************************************** 17000018
*                                                                     * 17100018
SUTF010  EQU   *                        SYMBOLIC ADDR                   17200018
*                                                                       17300018
         MODESET KEYADDR=DXUKEY,WORKREG=12  GET INTO USER KEY    Y02072 17350002
         L     RB,DCBEXLST              GET ADDR OF EXIT LIST           17400018
         LA    RB,ZERO(RB)              CLEAR HI BYTE                   17500018
         LTR   RB,RB                    TEST FOR EXITLIST               17600018
         BZ    SUTF036                  BR IF ZERO - NO EXIT LIST       17700018
*                                                                       17800018
SUTF011  EQU   *                        SYMBOLIC ADDR                   17900018
*                                                                       18000018
         CLI   ZERO(RB),UTENTRY         TEST FOR TOTALING ENTRY         18100018
         BE    SUTF049                  YES, BRANCH                     18200018
         CLI   ZERO(RB),UTENTRY+ENDOLIST TEST FOR TOTALING ENTRY        18300018
         BE    SUTF049                  YES, BRANCH                     18400018
*                                                                       18500018
         TM    ZERO(RB),ENDOLIST        TEST FOR LAST ENTRY             18600018
         BO    SUTF036                  BRANCH IF LAST ENTRY            18700018
*                                                                       18800018
         LA    RB,FOUR(RB)              POINT TO NEXT ENTRY             18900018
         B     SUTF011                  UNCONDIT9ONAL BRANCH            19000018
*                                                                       19100018
*                                                                       19200018
SUTF036  EQU   *                        SYMBOLIC ADDR                   19300018
*                                                                       19400018
*  THE DCB IS UNOPENABLE DUE TO TOTALING BEING SPECIFIED AND NO         19500018
*              TOTALING ENTRY IN THE DCB EXIT LIST, A ZERO TOTALING     19560018
*              AREA ADDRESS, OR A ZERO TOTALING AREA LENGTH.  IT IS     19620018
*              NECESSARY TO ISSUE A DMABCOND MACRO AND TO SET    Y02072 19700002
*              THE DCBOFLGS FIELD AS UNOPENABLE                  Y02072 19900002
*                                                                       20000018
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 20050002
         NI    DCBOFLGS,SETOFF          MARK DCB AS UNOPENABLE          20100018
*                                                                       20200018
         DMABCOND TOTUNSUP,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES Y02072 20210002
         B     TCTLRTN                  GO XCTL                  Y02072 20220002
*                                                                       25300018
SUTF049  EQU   *                        SYMBOLIC ADDR                   25400018
*                                                                     * 25500018
*********************************************************************** 25600018
*  AT THIS POINT REGISTER 12 (RB) POINTS TO THE FULL WORD WHICH CON-  * 25700018
*        TAINS THE ADDRESS OF THE USERS TOTALING SAVE AREA.  THE FIRST* 25800018
*        TWO BYTES OF THIS AREA CONTAIN ITS LENGTH IN BYTES           * 25900018
*        IF THIS LENGTH IS AN ODD NUMBER OF BYTES, IT IS ROUNDED UP   * 26000018
*        TO AN EVEN NUMBER FOR THE IMAGE SEGMENT LENGTH SO THAT EACH  * 26100018
*        SEGMENT WILL START ON A HALF-WORD BOUNDARY.  HOWEVER, ONLY   * 26200018
*        THE NUMBER OF BYTES INDICATED IN THE USER'S AREA WILL BE     * 26300018
*        MOVED TO THE IMAGE SEGMENT.                                  * 26400018
*********************************************************************** 26500018
*                                                                     * 26600018
         L     RB,ZERO(RB)              GET IMAGE AREA ADDR             26700018
         LA    RB,ZERO(RB)              CLEAR HI BYTE                   26720018
         LTR   RB,RB                    CHECK FOR ZERO ADDR             26740018
         BZ    SUTF036                  BR,NO ADDRESS SPECIFIED         26760018
         LH    RC,ZERO(RB)              GET LENGTH ATTRIBUTE            26800018
         LTR   RC,RC                    CHECK FOR ZERO LENGTH           26830018
         BZ    SUTF036                  BR IF LENGTH IS ZERO            26860018
         TM    1(RB),X'01'              TEST FOR EVEN LENGTH            26900018
         BZ    SUTF050A                 BRANCH IF ALREADY EVEN          27000018
         LA    RC,ONE(RC)               ROUND UP TO EVEN LENGTH         27100018
*                                                                     * 27200018
*********************************************************************** 27300018
*  NOTE -- COMPUTE THE NUMBER OF BYTES REQUIRED FOR SAM SAVE AREA     * 27400018
*********************************************************************** 27500018
*                                                                     * 27600018
SUTF050A EQU   *                                                        27700018
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 27750002
         SR    RD,RD                    CLEAR THIS REG                  27800018
         SR    RJ,RJ                    CLEAR THIS REGISTER             27900018
         TM    DCBCIND2,QSAMTEST        TEST FOR QSAM                   28000018
         BO    SUTF050                  IT IS QSAM                      28100018
*                                                                     * 28200018
         IC    RJ,DCBNCP                GET NO. OF CHAN PROG'S          28300018
         LTR   RJ,RJ                    WAS NCP SPECIFIED        XA3085 28350002
         BNZ   SUTF060                  YES, USE IT              XA3085 28360002
         LA    RJ,DEFNCP                DEFAULT TO 1             XA3085 28370002
         B     SUTF060                  UNCONDITIONAL BRANCH            28400018
*                                                                     * 28500018
SUTF050  EQU   *                        SYMBOLIC ADDR                   28600018
*                                                                     * 28700018
         IC    RJ,DCBBUFNO              GET NO. OF BUFFERS              28800018
         LTR   RJ,RJ                    WAS BUFNO SPECIFIED      XA3085 28850002
         BNZ   SUTF060                  YES, USE IT              XA3085 28860002
         LA    RJ,DEFBUFNO              DEFAULT TO 5            AZ07019 28870003
*                                                                       28900018
SUTF060  EQU   *                        SYMBOLIC ADDR                   29000018
*                                                                       29100018
         LA    RJ,ONE(RJ)               ADD ONE IMAGE AREA TO TOT       29200018
         MR    RD,RC                    MULT TO GET SAVE ELNGTH         29300018
         MODESET  KEYADDR=DXUKEY,WORKREG=9  GET INTO USER KEY    Y02072 29350002
*                                                                       29400018
*********************************************************************** 29500018
*   THE RESULT IS IN RJ - SO ADD ENOUGH BYTES FOR CONTROL BLOCKS - THEN 29600018
*        ISSUE A GETMAIN FOR THE SAM SAVE AREA                        * 29700018
*********************************************************************** 29800018
*                                                                       29900018
         AH    RJ,FORTY8                ADD 48 BYTES FOR CB'S           30000018
*                                                                     * 30400018
         LR    RTIOT,RJ                 SAVE GETMAIN LENGTH             30500018
*                                                                       30600018
         GETMAIN   R,LV=(RJ),SP=0                                Y02072 30700002
*                                                                     * 30800018
*********************************************************************** 30900018
*  PICK UP THE POINTER TO THE WORKAREA FROM RF (REGISTER 1) AND CLEAR * 31000018
*        THE WORKAREAS FIRST 48 BYTES                                 * 31100018
*********************************************************************** 31200018
*                                                                       31300018
*                                                                       31400018
         XC    ZERO(48,RF),ZERO(RF)     CLEAR FIRST 48 BYTES            31500018
*                                                                       31600018
*********************************************************************** 31700018
*  FORMAT THE CONTROL BLOCKS IN SAVE AREA - CURRENT REG VALUES ARE      31800018
*********************************************************************** 31900018
*        RJ =  LENGTH OF GETMAIN                                        32000018
*        RB =  POINTER TO USER'S IMAGE AREA                             32100018
*        RC =  LENGTH OF IMAGE AREA AND ALSO SEG SAVE LENGTH            32200018
*        RD =  VOLATILE - MAY BE USED FOR ANY PURPUSE                   32300018
*        RJ =  NO. OF CHAN PROG'S OR NO. OF BUFFERS (+1)                32400018
*        RF =  ADDRESS OF GETMAIN AREA                                  32500018
*        RUCB= POINTER TO DEB ACCESS METHOD SEC + 4                     32600018
*        RDCB= POINTER TO DCB                                           32700018
*        RBASE=BASE REG                                                 32800018
*        RCORE THRU RWTGC CONTAIN XCTL CONTROL POINTERS                 32900018
*        RTIOT = NUMBER OF BYTES IN GETMAIN                             33000018
*        RE =   VOLATILE                                                33100018
*********************************************************************** 33200018
         ST    RB,TOTUSRWA              STORE POINTER TO USER IMAGE     33300018
         ST    RTIOT,TOTTOTLN           SAVE LENGTH OF GETMAIN          33400018
         MODESET  EXTKEY=SUPR           BACK TO DATA MANAG KEY   Y02072 33450002
         ST    RF,FOUR(RUCB)            SAVE WA IN DEB AM        A44122 33460021
*                                       SECTION                  A44122 33520021
         MODESET  KEYADDR=DXUKEY,WORKREG=14  GET INTO USER KEY   Y02072 33570002
         ST    RC,TOTSVLNG              STORE IMAGE AND SV LENGTH       33600018
         LA    RD,FOUR8(RF)             GET ADDR OF FIRST SEG           33700018
         ST    RD,TOTSTART              STORE IT IN TABLE               33800018
         LA    RD,ZERO(RTIOT,RF)        GET END ADDR OF TABLE           33900018
         SR    RD,RC                    SUBTRACT 1 SEG LENGTH           34000018
*                                                                       34100018
*  RD NOW CONTAINS ADDR OF LAST SEGMENT OF THE SAVE AREA                34200018
*                                                                       34300018
         ST    RD,TOTENDAD              STORE IT IN CONTROL BLOCK       34400018
         LR    RC,RF                    SAVE WA POINTER          M0653  34500020
*                                                                     * 34600018
*********************************************************************** 34700018
*  IT IS NOW NECESSARY TO SETUP FOR THE LOADING OF THE RESIDENT SAVE  * 34800018
*        ROUTINE WHICH WILL BE BALR'D TO BY THE END OF BLOCK ROUTINES * 34900018
*********************************************************************** 35000018
*                                                                     * 35100018
         MODESET  EXTKEY=DATAMGT        GET INTO DATA MANAG KEY  Y02072 35150002
         USING WTG,RWTG                                          Y02072 35200002
         MVC   WTGMODID,SAVMOD          ID TO MOD NAME           Y02072 35250002
         DROP  RWTG                                              Y02072 35300002
         L     RWK1,CVTPTR              LOAD CVT ADDRESS         YM1140 35350002
         USING CVT,RWK1                 CVT ADDRESSABILITY       YM1140 35400002
         L     RWK1,CVTLINK             GET LPALIB DCB ADDRESS   YM1140 35450002
         DROP  RWK1                     DROP CVT BASE            YM1140 35500002
*                                                                       35550002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 36500002
*********************************************************************** 36600018
*                                                                     * 36700018
*********************************************************************** 36800018
*  THE ADDR OF THE LOADED ROUTINE IS RETURNED IN RE (REG 0)           * 36900018
*                                                                       36910021
*  RUCB POINTS TO DEB AT ACCESS METHOD DEPENDENT SECTION.  ADD          36920021
*  SIZE OF ACCESS METHOD DEPENDENT SECTION TO POINT TO DEB              36930021
*  SUBROUTINE ID SECTION.                                               36940021
*                                                                       36950021
*********************************************************************** 37000018
*                                                                       37100018
         SR    RF,RF                                             A44122 37140021
         IC    RF,DEBAMLNG              GET LENGTH               A44122 37180021
         AR    RUCB,RF                  POINT TO SUBROUTINE ID   A44122 37220021
*                                       SECTION OF DEB                  37260021
         MVC   0(L'WTGMODID,RUCB),SAVMOD  MOVE ID TO DEB         Y02072 37270002
         LR    RF,RC                    RESTORE WA POINTER       M0653  37400020
         USING TOTSAVWA,RF              ESTABLISH BASE THIS DSECT       37500018
         SR    RD,RD                    CLEAR REGISTER                  37600018
         IC    RD,DEBNMSUB              PICK UP DEB SUBRTN COUNT        37700018
         LA    RD,ONE(RD)               BUMP COUNT BY ONE               37800018
         STC   RD,DEBNMSUB              STORE IT BACK IN DEB            37900018
         MODESET  KEYADDR=DXUKEY,WORKREG=12  GET INTO USER KEY   Y02072 37950002
         ST    RE,TOTSVPTR              STORE SAVE RTN ADDR             38000018
*                                                                     * 38100018
* IT IS NOW NECESSARY TO SAVE THE USERS IMAGE AREA INITIALLY          * 38200018
*                                                                     * 38300018
         L     RB,TOTUSRWA              GET PTR TO USERS IMAGE AREA     38400018
         L     RC,TOTSTART              GET FIRST IMAGE SAVE SEG        38500018
         ST    RC,TOTCURNT              INITIALIZE TOTCURNT POINTER     38600018
         ST    RC,TOTEOVPT              INITIALIZE EOV POINTER          38700018
         LA    RJ,KON256                LOAD VALUE OF 256               38800018
         LH    RD,0(RB)                 GET USER'S LENGTH               38900018
SUTF070  EQU   *                                                        39000018
         CR    RD,RJ                    COMPARE SEG LENGTH TO 256       39100018
         BNH   SUTF080                  BR IF LEN NOT HIGH              39200018
*                                                                     * 39300018
*                                                                     * 39400018
         BCTR  RJ,0                     DECR LNGTH TO 255 FOR MOVE      39500018
         EX    RJ,MOVIMAGE              MOVE 256 BYTES                  39600018
         LA    RJ,1(RJ)                 RESTORE TO 256                  39700018
         AR    RC,RJ                    BUMP ADDR BY 256                39800018
         AR    RB,RJ                    BUMP ADDR BY 256                39900018
         SR    RD,RJ                    SUB 256 FROM IMAGE LEN          40000018
         B     SUTF070                  BR TO MOVE MORE BYTES           40100018
SUTF080  EQU   *                        SYMBOLIC ADDR                   40200018
*                                                                     * 40300018
         BCTR  RD,0                     DECR LNGTH FOR MOVE INSTR       40400018
         EX    RD,MOVIMAGE              MOVE REMAINING BYTES            40500018
*                                                                     * 40600018
*  THE USER'S IMAGE AREA HAS NOW BEEN STORED IN THE FIRST SAVE SEG    * 40700018
*                                                                     * 40800018
*                                                                     * 40900018
*********************************************************************** 41000018
*  AT THIS POINT THE SAVE ROUTINE HAS BEEN LOADED, THE ID HAS BEEN    * 41100018
*        PLACED IN THE DEB, AND THE SUBROUTINE COUNT HAS BEEN UP-     * 41200018
*        DATED.  ALSO THE GETMAIN FOR THE SAVE AREAS HAS BEEN MADE    * 41300018
*********************************************************************** 41400018
*                                                                     * 41500018
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 41550002
RELOOPA  EQU   *                                                   UT18 41600018
         USING WTGENTRY,RWTGC                                    Y02072 41650002
         MVC   WTGIDTTR,SOP1B           ID TO WTG TABLE        @Z30TSCF 41660003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        42000018
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     42100018
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            42200018
         BC    8,SUTF000                YES, THIS MODULE REQD AGAIN     42300018
*                                                                       42400018
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    42500018
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             42600018
*                                                                       42700018
         LR    RPARC,RPAR                                               42800018
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       42900018
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           43000018
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         43100018
*                                                                       43200018
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  43300018
         LA    RPARC,PLOFF(0,RPARC)                                     43400018
         BC    15,ZCHEK                                                 43500018
TURNOFF  EQU   *                                                   UT18 43600018
         NI    DCBOPTCD,X'FD'           TURN OFF TOTALING BIT      UT18 43700018
         B     RELOOPA                  BRANCH TO SET UP XCTL      UT18 43800018
*                                                                       43900018
TCTLRTN  EQU   *                                                        44000018
         USING WTG,RWTG                                                 44050003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*44100003
               MODID=WTGENTRY                                  @Z30TSCF 44150003
         DROP  RWTGC,RWTG                                      @Z30TSCF 44200003
*                                                                       44700018
*                                                                       44800018
*                                                                       44900018
WAOFF    EQU   32                       PARAMETRIC 32                   45000018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           45100018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           45200018
DEBBASI  EQU   32                       SIZE OF DEB BASIC        A44122 45230021
*                                       SECTION                  A44122 45260021
ZERO     EQU   0                        PARAMETRIC 0                    45300018
ONE      EQU   1                        PARAMETRIC 1                    45400018
TWO      EQU   2                        PARA2                           45500018
THREE    EQU   3                        PARA 3                          45600018
FOUR     EQU   4                        PARA 4                          45700018
FIVE     EQU   5                        PARA 5                          45800018
SIX      EQU   6                        PARA 6                          45900018
EIGHT    EQU   8                        PARA 8                          46000018
FOURTEEN EQU   14                       PARA 14                         46100018
TWENTY2  EQU   22                       PARA 22                         46200018
TWENTY4  EQU   24                       PARA  24                        46300018
TWENTY5  EQU   25                       PARA 25                         46400018
TWENTY7  EQU   27                       PARA 27                         46500018
THREE2   EQU   32                       OFFSET TO DEB LENGTH            46600018
THREE6   EQU   36                       PARAMETRIC 36                   46700018
FOUR8    EQU   48                       PARAMETRIC 48                   46800018
KON256   EQU   256                      LENGTH FOR MOVE INSTRUCTION     47000018
QSAMTEST EQU   X'01'                    MASK FOR QSAM TEST              47100018
SETOFF   EQU   X'FE'                    MASK FOR DCBOFLGS               47200018
NINE     EQU   9                        PARAMETRIC 9                    47300018
DEFNCP   EQU   1                        DEFAULT NCP              XA3085 47350002
DEFBUFNO EQU   5                        DEFAULT BUFNO           AZ07019 47360003
OPIDCNST DC    C'0S'                    CONSTANT FOR OS TEST            47400018
AMIDCNST DC    C'1Y'                    ID FOR THIS MODUEL              48300018
SOP1B    DC    C'1B',VL3(IGG0191B)      NEXT MOD               @Z30TSCF 48350003
SAVMOD   DC    C'AX'                    USER TOTALING MOD        Y02072 48360002
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETER             @Z30TSCF 48370003
*                                                                       48400018
MOVIMAGE MVC   ZERO(0,RC),ZERO(RB)      VARIABLE MOVE INSTRUCTION       48500018
*                                                                       48600018
*                                                                       48700018
         DS    0H                                                       48800018
*********************************************************************** 48900018
*  THE FOLLOWING ARE ALL OF THE EQUATE STATEMENTS FOR THIS MODULE     * 49000018
*********************************************************************** 49100018
*                                                                     * 49200018
UTENTRY  EQU   X'0A'                    MASK FOR TOTALING ENTRY         49300018
ENDOLIST EQU   X'80'                    MASK FOR END OF LIST            49400018
CNTLBLKS EQU   16                       ABSOLUTE OFFSET OF CVT          49500018
TOTUNSUP EQU   104                      USER TOTALING UNSUPPORT  Y02072 49550002
*                                                                     * 49600018
*********************************************************************** 49700018
*  THE FOLLOWING ARE THE CONSTANTS REQUIRED IN THIS MODULE            * 49800018
*********************************************************************** 49900018
*                                                                     * 50000018
FORTY8   DC    H'48'                    CONSTANT OF 48                  50100018
ZEROHW   DC    H'0'                                                     50200018
         SPACE 2                                                        50210002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 50220002
END      EQU   *                        END OF MODULE            Y02072 50300002
         EJECT                                                          50350002
*                                                                     * 51600018
SRT      DSECT                                                          51700018
         IEFUCBOB                                                       51800018
*                                                                       51900018
         EJECT                                                          52000018
           DCBD  DSORG=PS                                               52100018
CVT      DSECT                                                          52200018
         CVT                                                            52300018
*   TASK CONTROL BLOCK                                                  52400018
         CNOP  0,4                                                      52500018
TCB      DSECT                                                          52600018
TCBRBP   DS    F                       PO9NTER TO EXECUTING RB          52700018
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   52800018
TCBDEB   DS    F                       POINTER TO DEB QUEUE             52900018
TCBTIO   DS    F                       POINTER TO TIOT                  53000018
TCBCMP   DS    F                       TASK COMPLETION CODE             53100018
TCBTRN   DS    F                       TESTRAN FIELD                    53200018
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 53300018
TCBPKF   DS    CL1                     RESERVED FOR FUTURE USE          53400018
TCBFLGS  DS    FL5                     FLAG BYTES                       53500018
TCBLMP   DS    CL1                     RESERVED FOR FUTURE USE          53600018
TCBDSP   DS    CL1                     RESERVED FOR FUTURE USE          53700018
TCBLLS   DS    F                       POINTER TO LOAD LIST             53800018
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            53900018
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  54000018
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       54100018
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             54200018
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  54300018
TCBTCB   DS    F                       RESERVED FOR FUTURE USE          54400018
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         54500018
         DS    CL24                                                     54600018
TIOT     DSECT                                                          54700018
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       54800018
TIOESTTA DS    CL1                           STATUS -A-                 54900018
TIOERLOC DS    CL2                           REL. LOC OF POOL           55000018
TIOEDDNM DS    2F                            DDNAME                     55100018
TIOEJFCB DS    1F                            JFCB DISK ADDR             55200018
TIOESTTB DS    0CL1                                                     55300018
TIOEFSRT DS    CL4                                                      55400018
         DS    CL1                                                      55500018
*        TIOT POOL ENTRY                                                55600018
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       55700018
         DS    CL1                                                      55800018
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      55900018
*                                             SLOTS)                    56000018
TIOPPOOL DS    CL8                           POOL NAME                  56100018
TIOPSTTB DS    XL1                           STATUS OF SLOT             56200018
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  56300018
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      56400018
         SPACE 1                                                        56500018
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          56600018
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 56650003
         ORG   WTGIDTTR                                          Y02072 56700002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 56750002
CCWOFSET EQU   DXCCW12-FORCORE     CCW RELOCATABLE OFF SET FOR DXCCW12  56900018
DCBOFSET EQU   DCBDEBAD-IHADCB     DEB RLCATBL OFFSET IN DCB            57000018
DEBB     DSECT                         THIS DSECT DESCRIBES THE DEB     57100018
DEBNMSUB DS    0CL1                    NO. OF SUB RTNS                  57200018
DEBTCBAD DS    CL4                     TASK CONTROL BLOCK ADDR          57300018
DEBAMLNG DS    0CL1                    LENGTH OF ACCESS METHOD SEC      57400018
DEBDEBAD DS    CL4                     ADDR OF NEXT DEB IN DEB CHAIN    57500018
DEBOFLGS DS    0CL1                    DEB OPEN FLAGS                   57600018
DEBIRBAD DS    CL4                     ADDR OF THE IRB CONTROL BLOCK    57700018
DEBOPATB DS    0CL1                    OPEN ATRIBUTES                   57800018
DEBSYSPG DS    CL4                     SYSTEM PURGE FIELD               57900018
DEBNMEXT DS    0CL1                    NUMBER OF EXTENTS IN DEB         58000018
DEBUSRPG DS    CL4                     USER PURGE FIELD                 58100018
DEBPRIOR DS    0CL1                    INFO BYTE                        58200018
DEBECBAD DS    CL4                     EVENT CONTROL BLOCK ADDR         58300018
DEBPROTG DS    0CL1                    INFO BYTE                        58400018
DEBDEBID DS    0CL1                    INFO BYTE                        58500018
DEBDCBAD DS    CL4                     ADDR OF DCB                      58600018
DEBEXSCL DS    0CL1                    SCALING FACTOR OF DEB EXTENT     58700018
DEBAPPAD DS    CL4                     APPENDAGE TABLE ADDR             58800018
DEBDVMOD DS    0CL1                    DEVICE MODIFIER BYTE             58900018
DEBUCBAD DS    CL4                     UNIT CTL BLOCK ADDR              59000018
DEBTVLSQ DS    0CL2                     VOL SEQ FOR TAPE                59100018
DEBBINUM DS    CL2                     BIN NUMBER                       59200018
DEBTVLNM DS    0CL2                     NO OF VOL FOR TAPE              59300018
DEBSTRCC DS    CL2                     START CYLINDER NUMBER            59400018
DEBSTRHH DS    CL2                     START HEAD NUMBER                59500018
DEBENDCC DS    CL2                     END CYLINDER NUMBER              59600018
DEBENDHH DS    CL2                     END HEAD NUMBER                  59700018
DEBNMTRK DS    CL2                     NUMBER OF TRACKS                 59800018
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          59900018
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              60000018
DEBVOLSQ DS    H                       VOL SEQUENCE NUMBER              60100018
DEBVOLNM DS    H                       VOLUME NUMBER                    60200018
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     60300018
DEBSUBID DS    H                       SUBROUTINE ID ( 2 BYTES )        60400018
TOTSAVWA DSECT                                                          60500018
*                                                                     * 60600018
*********************************************************************** 60700018
*  THIS DSECT ESTABLISHES THE SYMBOLIC REFERENCES FOR THE USER TOTAL- * 60800018
*        ING FACILITY SAVE WORKAREA.                                  * 60900018
*********************************************************************** 61000018
TOTFLGBT DS    0CL1                     X'80' = NO SAVE FOR UTF    UT18 61100018
TOTSVPTR DS    F                        ADDR OF THE SAVE RTN            61200018
TOTCURNT DS    F                        ADDR OF CURRENT SAVE SEGMENT    61300018
TOTSTART DS    F                        BEGINNING ADDR OF SAVE SEGMENTS 61400018
TOTENDAD DS    F                        ADDR OF LAST SAVE SEGMENT       61500018
TOTSVLNG DS    F                        LENGTH OF THE USER'S SAVE AREA  61600018
TOTUSRWA DS    F                        ADDR OF THE USERS TOT AREA      61700018
TOTTOTLN DS    F                       TOTAL LEN OF GETMAIN             61800018
TOTEOVPT DS    F                        POINTER TO EOV SEG              61900018
TOTREGSV DS    D                        SAVE AREA FOR R11 & R12         62000018
         DS    D                       SAV AREA  FOR REG'S              62100018
*********************************************************************** 62200018
           END                                                          62300018
./  ADD  SSI=43081096,NAME=IGG0191Z
         TITLE 'IGG0191Z OPEN EXECUTOR  D/A UPDATE RECORD READY CHANNEL*00010021
                PROGRAMS'                                               00012021
IGG0191Z CSECT                                                          00014020
*MODULE NAME - IGG0191Z                                          Y02072 00016002
*                                                                       00018002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00020002
*                                                                       00022002
*COPYRIGHT - NONE                                                Y02072 00022402
*                                                                       00022802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00023202
*                                                                       00024002
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00024402
*000947,010800,034000,034400,039800-040800,053060-053100,        Y02072 00024802
*058600,060420-060440,070950,109500,112500-112540,122000-129170  Y02072 00024902
*109000,116800,118000,120800,15400,83600-83800,84200-84400       Y02072 00030602
*                                                                YM4640 00030702
*C24200,70880,81800                                              YM5362 00032702
*                                                                YM7595 00034702
*                                                                       00035103
*          VS2 RELEASE 3 DELETIONS                                      00035503
*                                                              @Z30TSCF 00035903
*          RELEASE 20 DELETIONS                                         00036702
*                                                                S20201 00042402
*          RELEASE 21 DELETIONS                                         00048102
*0335120500-121600                                               A37507 00053802
*0335112040-112200                                               A40538 00059502
*0335029129,088060,088860,098060                                 M1760  00065202
*0335019449-019480,019720,019920,070100-070500,070800,080400,    A31983 00070902
*0335080600,087600-087800                                        A31983 00076602
*0335088120,088920,098120                                        M1779  00082302
*                                                               SA53268 00088002
*                                                                XM6306 00093701
* STATUS LEVEL = 002                                                    00094702
*                                                                       00121221
*    THIS MODULE SPLIT INTO IGG01923 FOR RELEASE 21                     00171221
*                                                                       00221221
*FUNCTION/OPERATION - INITIALIZE AND LINK IOB'S                         00231221
*        BEGINS CONSTRUCTION OF CHANNEL PROGRAMS FOR RECORD READY       00241221
*        DEVICES WITH OPTIONS OF WRITE CHECK AND TRACK OVERFLOW         00251221
*        IF SPECIFIED                                                   00253221
*        CHANNEL PROGRAM FORMAT--                                       00255221
*              - WRITE SECTION                                          00257221
*              - WRITE CHECK SECTION                                    00259221
*              - READ SECTION                                           00259621
*                                                                       00259721
*ENTRY POINTS- ENTERED FROM IGG0191P BY USE OF THE XCTL MACRO.          00260020
*                                                                       00280020
*INPUT- SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00300020
*                                                                       00320020
*OUTPUT & IOB(USER)- SEE DESCRIPTION OF REGISTERS, DCB(USERS).          00340020
*                                                                       00360020
*EXTERNAL ROUTINES- NONE.                                               00380020
*                                                                       00400020
*EXITS-NORMAL-XCTL TO IGG01923 TO CONTINUE BUILDING CHAN PGMS           00420021
*                                                                       00440020
*EXITS-ERROR- NONE.                                                     00460020
*                                                                       00480020
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00500020
*                                                                       00520020
*      BYTE  0-7  NAME                                                  00540020
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00560020
*      BYTE 11    CONCATENATION NUMBER                                  00580020
*      BYTE 12    ZERO                                                  00600020
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00620020
*                        ALIAS INDICATOR 1 BIT                          00640020
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00660020
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00680020
*      BYTE 17    ZERO                                                  00700020
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00720020
*      BYTE 20    TRANSLATION TABLE                                     00740020
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00760020
*      BYTE 22-23 ATTRIBUTES                                            00780020
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00800020
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00820020
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00840020
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00860020
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       00880020
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        00900020
*      BYTE 40-   TABLE OF IDTTR'S                                      00920020
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          00940020
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          00960020
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          00980020
*                   NOT USED                         (3 BYTES)          01000020
*                                                                       01020020
*      SEE DEVICETB DSECT                                               01040020
*                                                                       01060020
*MACROS - ACTION : MODESET, XCTL, XCTLTABL                       Y02072 01070002
*                                                                       01070402
*MACROS - MAPPING : IEZDEB, IHACCW, IECDSECS(MAIN, IOB, WTG),    YM5362 01070802
*                   DCBD, IGGBCB                                 YM5362 01071202
*                                                                       01072002
*ATTRIBUTES- REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY    Y02072 01080002
*            UNLESS OTHERWISE SPECIFIED, SUPER STATE             Y02072 01090002
*                                                                       01100020
*NOTE - SECTOR VALUES PASSED BY IGG0191P IN OPEN WORK AREA              01110021
*     - DCBREAD AND DCBCHECK FIELDS OF DCB USED TO PASS PARAMETERS      01112021
*       TO MODULE IGG01923                                              01114021
*     - IOB CSW FIELD USED TO PASS BUFFER ADDRESSES TO 1923      YM7595 01116002
*                                                                       01120020
*********************************************************************** 01140020
*                                                                       01160020
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01180020
*                                                                       01200020
*********************************************************************** 01220020
*                                                                       01240020
RDCB     EQU   2         DCB REGISTER                                   01260020
RBASE    EQU   3         BASE REGISTER                                  01280020
RCORE    EQU   4         WORK AREA ADDRESS                              01300020
RPAR     EQU   5         TOP OF PARAMETER LIST                          01320020
RWTG     EQU   6         TOP OF WTG TABLE                               01340020
RPARC    EQU   7         CURRENT PARAMETER                              01360020
RWTGC    EQU   8         CURRENT TRANS LOAD                             01380020
RBUFADR  EQU   9         ADDR OF BUFFER                          YM7595 01390002
RUCB     EQU   10        COUNTER IN IOB GENERATION                      01420020
RDEB     EQU   11        DEB ADDRESS                                    01440020
RB       EQU   12        WORK REG1  **                                  01460020
RWK2     EQU   RB                       WORK REGISTER            Y02072 01470002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01480020
RWK3     EQU   RC                       WORK REGISTER            Y02072 01490002
RD       EQU   14        WORK REG3  **                                  01500020
RBRNCH   EQU   15                       SUBROUTINE BR REGISTER   YM5362 01520002
RWK1     EQU   RBRNCH     WORK REGISTER                          YM7595 01530002
RWK5     EQU   0         WORK REG5                               Y02072 01540002
RF       EQU   1         WORK REG6                                      01560020
RWK4     EQU   RF                       WORK REGISTER            Y02072 01570002
*                                                                       01580020
* MASKS FOR ACCESS METHODS IN SAM                                       01640020
QSAMB    EQU   X'01'                                                    01680020
* DCB OFFSET CONSTANTS                                                  01900020
WCPO     EQU   48                                                       01940020
WCWCPL   EQU  8                         WRITE CP LEN WITH WRTCK  A31983 01950021
WCTOWCPL EQU  9                         WRITE CP LEN WITH WRTCK  A31983 01950421
*                                          AND TRK OVFLOW        A31983 01950821
THREECCW EQU  24                        LEN OF 3 CCW'S           A31983 01951221
WCPL     EQU   4                        NORMAL WRITE CP LENGTH          01952020
*        THE READ CCW OFFSET IN THE DCBOFFSR FIELD IS THE OFFSET        01956020
*        OF THE READ DATA CCW FROM THE BEGINNING OF THE SAM IOB         01960020
*        PREFIX                                                         01964020
OFFSR    EQU   X'80'                    NORMAL RD CCW OFFSET     XM6306 01968001
OFFSW    EQU   X'48'                    WRITE CCW OFFSET                01976020
WCOSRQ   EQU  X'A0'                     READ CCW OFFSET FOR WRT  A31983 01990021
*                                          CHK WITH QSAM         A31983 01992021
TOWCOSRQ EQU  X'A8'                     READ CCW OFFSET FOR WRT  A31983 01994021
*                                          CHK + TRK OV FOR QSAM A31983 01994421
WCWTOCCW EQU   46                       OFFSET FOR COUNT FIELD          01994521
WCCCW    EQU   38                       WRT CHK - NO TRK OV             01994621
EIGHT    EQU   8                        EIGHT                           01996020
FIVE     EQU   5                        FIVE                            02012020
SIX      EQU   6                        CONSTANT OF SIX                 02014021
FOUR     EQU   X'4'                     FOUR                            02016020
SETSECTR EQU   X'23'                    COMMAND CODE                    02032020
ZERO     EQU   0                        ZERO                            02036020
TWO      EQU   2                                                        02040020
THREE    EQU   3                        THREE                           02044020
SEVEN    EQU   7                        SEVEN                           02048020
D7       EQU   SEVEN                    CONST OF SEVEN                  02052021
TWELVE   EQU   12                       CONSTANT OF 12                  02056020
SIXTY5   EQU   65                       CONSTANT OF 65                  02084020
C20      EQU   20                       CONSTANT OF 20                  02088020
C23      EQU   23                       CONSTANT OF 23                  02138021
* MASKS USED TO TEST OPTION FIELDS IN DCB                               02160020
WRTCK    EQU   X'80'                                                    02220020
TRKOVFLB EQU   X'20'                    TRACK OVERFLOW OPTION           02260020
* COMMAND BYTES FOR THE 2841 CONTROL UNIT                               02340021
SEEK     EQU   X'1B'                    SEEK HEAD OP CODE        YM5362 02420002
NOP      EQU   X'03'                    NO-OPERATION OP CODE     YM5362 02430002
SRCHE      EQU   X'31'                                                  02440020
RDD        EQU   X'86'                                                  02480020
RDDX     EQU   X'06'                                                    02500020
TIC        EQU   X'08'                                                  02520020
WRTD       EQU   X'05'                                                  02540020
WRTKD    EQU   X'0D'                                                    02560020
RDKD     EQU   X'8E'                                                    02580020
*   CHANNEL CONTROL WORD FLAGS                                          02660020
SLI        EQU   X'20'                                                  02700020
CC         EQU   X'40'                                                  02720020
SLICCSK  EQU   X'70'                                                    02780020
* MASKS FOR RECORD FORMATS                                              02860020
FORMATF  EQU   X'40'                    NON FORMAT F MASK               02906020
* OFFSET FOR PARAMETER TESTS                                            02980020
ONE      EQU   1                                                        03020020
NOT      EQU   X'FF'                                                    03040020
* MASKS FOR STATUS BITS TO BE TESTED                                    03120020
SEEKCYHD EQU   X'18'                    IF BOTH ON IN FILE MASK, YM5362 03170002
*                                         INHIBIT ALL SEEKS      YM5362 03172002
READONLY EQU   X'20'                    IOB READ ONLY INDICATOR         03180020
UNRELFLG EQU   X'02'                   IOB UNRELATED FLAG        A37507 03190021
NULL     EQU   0                        ZERO DISPLACEMENT        S19015 03254020
IDLEN    EQU   5                        LENGTH OF IDTTR          S19015 03256020
*                                                                       03260020
*********************************************************************** 03270021
*                                                                       03320020
         BALR  RBASE,0                  REG 3 IS BASE                   03340020
         USING SOPB,RBASE                                               03360020
         USING IHADCB,RDCB              REG 2 IS DCB                    03380020
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDRESS      03420020
         USING DEBBASIC,RDEB                                     YM5362 03470002
         SPACE 3                                                        03472002
SOPB     EQU   *                                                        03480020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 03485002
         DC    C'IGG0191Z'              MODULE NAME              YM4640 03490002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 03495003
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 03496003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 03497002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 03500020
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   03520020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          YM5362 03530002
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESS           03560020
         L     RB,DCBIOBA               GET ADDR OF GETMAIN AREA        03680020
         LR    RD,RB                    GET ADDR OF FIRST IOB           03780020
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 03830002
         USING IOBQSAMN,RB                                       Y02072 03840002
         L     RWK3,IOBNECB             GET SECTOR ADDR          Y02072 03850002
         DROP  RB                                                Y02072 03860002
         L     RUCB,ZERO(RB)            GET IOB COUNT                   03880020
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 03890002
         STC   RUCB,DCBREAD+ONE         SAVE NO OF BUFFERS FOR IGG01923 03930021
         ST    RWK3,SECTORAD            SAVE SECTOR ADDR         Y02072 03980002
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 03990002
         XC    ZERO(TWELVE,RB),ZERO(RB)  ZERO OUT FIRST 12 BYTES        04180020
*                                       WHICH WERE USED TO PASS         04280020
*                                       INFORMATION FROM IGG0191P       04380020
         L     RWK5,SECTORAD            INIT REG TO FIRST SECTOR Y02072 04530002
*                                         ADDRESS                Y02072 04580002
         CH    RUCB,ONEIOB             ONE IOB?                  A37507 05302021
         BNE   NTONEIOB                NO - BRANCH               A37507 05304021
         USING IOBQSAMN,RB             ADDRESSABILITY FOR DSECT  Y02072 05306002
         OI    IOBFLAG1,IOBUNREL       YES - SET UNRELATED FLAG  Y02072 05308002
         DROP  RB                                                Y02072 05310002
         B     NTONEIOB                 BYPASS NEXT IOB FUNCTION        05312002
NEXTIOB  EQU   *                                                        05314021
         SR    RF,RF                    ZERO REG                        05364021
         IC    RF,DCBIOBL               IOB LENGTH IN DOUBLE WORDS      05414021
         SLL   RF,THREE                 IOB LENGTH IN BYTES             05424021
         LA    RB,ZERO(RF,RD)           ADDR OF NEXT IOB                05434021
*                                                                       05460020
*********************************************************************** 05480020
*                                                                       05500020
*    REGISTER USEAGE FOR CHANNEL PROGRAM CONSTRUCTION                   05520020
*       RB - RD/WRT SEQUENCE POINTER                                    05540020
*       RC - FDA POINTER                                                05560020
*       RD - CURRENT IOB POINTER                                        05580020
*       RJ - LINK REG TO INTERNAL SUBROUTINE                            05600020
*       RF - PARAREG FOR INTERNAL SUBROUTINE                            05620020
*       RE - INTERNAL POINTER IN READ SEQUENCE                          05640020
*                                                                       05660020
*********************************************************************** 05680020
*                                                                       05700020
NTONEIOB EQU   *                                                        05710021
         AH    RWK5,NXTSECSV            INCRE TO NEXT SECTOR     Y02072 05720002
         ST    RB,0(RD)                 LINK NEW IOB TO LAST ONE BUILT  05740020
         OI    0(RD),READONLY           IOB FOR READ ONLY         22484 05750020
         LR    RD,RB                    UPDATE CURRENT IOB POINTER      05760020
         OI    8(RD),CC                 INDICATE COMMAND CHAINING 21282 05790020
         LA    RB,4(RB)                 POINT TO ECB SLOT               05800020
         OI    0(RB),X'7F'              SET ECB COMPLETE WITHOUT ERROR  05820020
         ST    RB,12(RD)                STORE ECB ADDR IN IOB           05840020
         L     RWK4,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 05850002
         USING IOBQSAMN,RD                                       Y02072 05860002
         ST    RWK4,IOBDCBPT            DCB ADDRESS TO IOB       Y02072 05870002
         DROP  RD                                                Y02072 05872002
*                                                                       05880020
*********************************************************************** 05900020
*                                                                       05920020
*     CONSTRUCTION OF CHANNEL PROGRAM FOLLOWS                           05940020
*                                                                       05960020
*********************************************************************** 05980020
*                                                                       06000020
         LA    RB,48(RD)                UPDATE TO WRITE SEQUENCE        06040020
         USING CCW,RWK2                                          Y02072 06042002
         ST    RWK5,CCWADDRA            SECT ADDR TO CCW         Y02072 06042402
         DROP  RWK2                                              Y02072 06044402
         MVI   ZERO(RB),SETSECTR        MOVE IN COMMAND CODE            06046020
         OI    FOUR(RB),CC              TURN ON COMMAND CHAIN           06048020
         MVI   D7(RB),ONE               STORE LENGTH                    06050020
         LA    RB,EIGHT(RB)             BUMP COUNTER BY EIGHT           06052020
*                                         SET SECTOR CCW GENERATED      06054021
         LA    RC,43(RD)                POINT TO CCHHR FIELD IN IOB     06060020
         ST    RC,0(RB)                 STORE ADDR IN SRCH CCW          06080020
         MVI   0(RB),SRCHE              STORE CMD BYTE                  06100020
         MVI   7(RB),X'05'              STORE COUNT OF 5 IN CCW         06120020
         OI    4(RB),CC                 SET CMD CHAIN FLAG ON           06140020
         ST    RB,8(RB)                 STORE IN TIC CCW                06160020
         MVI   8(RB),TIC                STORE TIC CMD BYTE              06180020
*                                                                       06200020
*********************************************************************** 06220020
*     SRCH AND TIC CCWS HAVE BEEN GENERATED AT THIS POINT               06260020
*     CONSTRUCTION OF WRITE CHANNEL PROGRAMS FOLLOW                     06340020
*********************************************************************** 06380020
*                                                                       06420020
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 06422002
         MVI   DCBWCPO,WCPO             WRITE CHANNEL PROGRAM OFFSET    06440020
         MVI   DCBWCPL,WCPL             STORE NORMAL WRT CP LEN.        06460020
         MVI   DCBOFFSW,OFFSW           WRITE CCW OFFSET                06480020
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 06482002
         TM    DCBRECFM,FORMATF         FORMAT F USED                   06520020
         BNO   SOPB50                   BRANCH YES                      06540020
         OI    20(RB),SLI               SET SILI FLAG ON                06560020
SOPB50   EQU   *                                                        06600020
         OI    20(RB),CC                SET COMMAND CHAIN FLAG ON       06620020
         MVI   16(RB),WRTD              STORE WRITE DATA CMD OP         06660020
         TM    DCBCIND2,QSAMB           IS QSAM USED                    06700020
         BO    SOPB505                  YES, BRANCH                     06720021
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         06760020
         BC    4,SOPB52                 NO, BRANCH                      06780020
         MVI   16(RB),WRTKD             STORE WRT KEY & DATA CMD BYTE   06820020
         B     SOPB52                                                   06840020
SOPB505  EQU   *                                                        06880021
         LA    RF,16(RB)                POINT TO ACTUAL WRT CCW         06900020
*                                                                       06950021
*        THE FOLLOWING CODE SETS UP THE CCW WITH LENGTH AND BUF ADDR    06952021
*                                                                       06954021
         TM    DCBOPTCD,WRTCK           WRITE CHECK USED?               06956021
         BNO   SOPB51                   NO, BRANCH                      06958021
         TM    DCBRECFM,TRKOVFLB        TRK OV?                         06958421
         BZ    NOTRKOV                  NO, BR                          06958821
         MVC   WCWTOCCW(TWO,RF),DCBBLKSI  COUNT OTHER THAN ZERO         06959221
         B     SOPB51                   BR AROUND                       06959621
NOTRKOV  EQU   *                                                        06959721
         MVC   WCCCW(TWO,RF),DCBBLKSI   COUNT OTHER THAN ZERO           06959821
SOPB51   EQU   *                                                        06959921
         L     RWK1,DCBBUFCB            ADDR BUF CNTRL BLOCK     YM7595 06969902
         USING BCBLK,RWK1                                               06971902
         L     RBUFADR,BCBBUFPT         ADDR OF NEXT AVAIL BUF   YM7595 06972302
         USING BUFFER,RBUFADR                                           06972702
         MVC   BCBBUFAD,BUFNXPTB        UPDATE WITH NEXT AVAIL   YM7595 06973102
         USING CCW,RF                                                   06973202
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 06979902
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 06981902
         USING IOBQSAMN,RD                                              06983902
         ST    RBUFADR,IOBFLAG3         SAVE BUFF ADDR FOR 1923  YM7595 06985902
         DROP  RD,RF,RWK1,RBUFADR                                       06986302
SOPB52   EQU   *                                                        06986602
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    06993302
         BC    14,SOPB53               NO. BRANCH                       07000020
         LA   RB,THREECCW(RB)           ADD FOR WRT CHK CCW'S    A31983 07002021
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 07002102
         MVI  DCBWCPL,WCWCPL            WRITE CP LEN, WRT CHK    A31983 07004021
         TM   DCBRECFM,TRKOVFLB         TRK OVFLOW SPECIFIED?    A31983 07006021
         BNO  NOTRKOV1                  NO, DON'T UPDATE CP LEN  A31983 07008021
         MVI  DCBWCPL,WCTOWCPL          WRITE CP LEN, WRT CHK    A31983 07058021
*                                          + TRK OVFLOW          A31983 07068021
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 07070002
         LA    RF,41(RD)                POINT TO BBCCHHR IN       18445 07082020
*                                       IOBSEEK FIELD             18445 07084020
         ST    RF,0(RB)                 STORE SEEK ADDRESS        18445 07086020
         BAL   RBRNCH,SOPB700           GO GET PROPER OP CODE    YM5362 07088002
         MVI   4(RB),CC                 SET COMMAND CHAIN FLAG ON 18445 07090020
         MVI   7(RB),X'06'              STORE COUNT OF 6 IN CCW   18445 07092020
         LA    RB,8(RB)                 UPDATE RB TO NEXT CCW     18445 07094020
         B     SOPB52A                  BR AROUND MODESET        Y02072 07094102
NOTRKOV1 EQU  *                                                  A31983 07094421
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 07094502
         USING CCW,RB                                            Y02072 07095202
SOPB52A  ST    RWK5,CCWADDRA            SECTOR ADDR TO CHAN PGM  Y02072 07107502
         DROP  RB                                                Y02072 07119502
         MVI   ZERO(RB),SETSECTR        MOVE IN COMMAND CODE            07131402
         MVI   FOUR(RB),CC              MOVE IN LENGTH                  07143302
         MVI   SEVEN(RB),ONE            INCREASE POINTER BY CCW LEN     07155202
         LA    RB,EIGHT(RB)                                             07167102
         OI    C20(RB),SLICCSK          SET SILI AND CC FLAGS ON        07179020
         ST    RC,0(RB)                 SAVE ADDRESS IN SRCH CCW        07260020
         MVI   0(RB),SRCHE              STORE SRCHE CMD BYTE            07280020
         OI    4(RB),CC                 SET CMD CHAIN FLAG ON           07300020
         MVI   7(RB),X'05'              STORE COUNT OF 5 IN CCW         07320020
         ST    RB,8(RB)                 SRCH ADDR IN TIC CCW            07340020
         MVI   8(RB),TIC                STORE TIC CMD BYTE              07360020
         MVI   16(RB),RDD               STORE READ DATA CMD OP          07380020
         MVI   C23(RB),ONE              SET READ VERIFY LENGTH ONE      07390020
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  07400020
         BO    SOPB55                   YES, BRANCH                     07420020
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         07460020
         BC    4,SOPB53                 NO, BRANCH                      07480020
         MVI   16(RB),RDKD              STORE RD KEY & DATA CMD BYTE    07520020
SOPB53   EQU   *                                                        07560020
         TM    DCBCIND2,QSAMB           QSAM USED                       07580020
         BC    1,SOPB55                 YES, BRANCH                     07600020
         NI    20(RB),NOT-CC            CLEAR COMMAND CHAIN FOR BSAM    07620020
         LA    RB,16(RB)                POINT TO BSAM OFFSET            07660020
         B     SOPB56                                                   07680020
SOPB55   EQU   *                                                        07720020
         LA    RB,24(RB)                POINT TO READ SEQ.              07740020
*                                                                       07760020
*********************************************************************** 07780020
*    THIS SECTION GENERATES READ CHANNEL PROGRAMS                       07820020
*********************************************************************** 07860020
*                                                                       07880020
SOPB56   EQU   *                                                        07900020
         LA    RC,8(RB)                 POINT TO SRCH CCW OF RD SEQ     07940020
         ST    RC,24(RD)                STORE CP STARTAD IN IOB         07960020
         TM    DCBCIND2,QSAMB           QSAM USED?                      07970021
         BNO   SOPB60                   NO, BR                          07972021
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 07972402
         MVI   DCBOFFSR,OFFSR           STORE NORMAL RD CCW OFFSET      07980020
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    08000020
         BC    14,SOPB60                NO, BRANCH                      08020020
         MVI  DCBOFFSR,WCOSRQ           READ CCW OFFSET FOR QSAM A31983 08030021
*                                          WITH WRT CHK          A31983 08040021
         TM   DCBRECFM,TRKOVFLB         TRK OVFLOW SPECIFIED?    A31983 08050021
         BNO  SOPB60                    NO, DON'T UPDATE OFFSET  A31983 08052021
         MVI  DCBOFFSR,TOWCOSRQ         YES, READ CCW OFFSET FOR A31983 08054021
*                                          QSAM WITH WRTCK + TKOVA31983 08056021
SOPB60   EQU   *                                                        08080020
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 08082002
         LA    RC,SIXTY5(RB)            POINT TO BBCCHH FIELD           08100020
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  08120020
         BZ    SOPB601                  NO. BRANCH                      08140020
         ST    RC,0(RB)                 STORE ADDR IN SEEK CCW          08160020
         BAL   RBRNCH,SOPB700           GO GET PROPER OP CODE    YM5362 08180002
         MVI   7(RB),X'06'              STORE COUNT OF 6 IN CCW         08200020
         OI    4(RB),CC                 SET COMMAND CHAIN FLAG ON       08220020
SOPB601  EQU   *                                                        08240020
         LA    RB,EIGHT(RB)             BUMP COUNTER BY CCW LENGTH      08243020
         MVC   ONE(THREE,RB),DXCCW11+ONE  MOVE IN ADDR OF SECTOR        08246020
         MVI   ZERO(RB),SETSECTR        MOVE IN COMMAND CODE            08249020
         OI    FOUR(RB),CC              TURN ON COMMAND CHAIN           08252020
         MVI   SEVEN(RB),ONE            MOVE IN LENGTH                  08255020
         LA    RC,2(RC)                 POINT TO CCHH FIELD             08260020
         ST    RC,8(RB)                 STORE ADDR IN SRCH CCW          08280020
         MVI   8(RB),SRCHE              STORE SEARCH COMMAND BYTE       08300020
         MVI   15(RB),X'05'             STORE COUNT OF 5 IN CCW         08320020
         OI    12(RB),CC                SET COMMAND CHAIN FLAG ON       08340020
         LA    RWK4,L'CCW(RB)           GET ADDR OF SEARCH CCW   Y02072 08350002
         ST    RWK4,2*L'CCW(RB)         STORE IN TIC CCW         Y02072 08352002
         MVI   16(RB),TIC               STORE TIC COMMAND BYTE          08400020
         LA    RWK4,4*L'CCW(RB)         GET ADDR OF RD COUNT CCW Y02072 08410002
         ST    RWK4,3*L'CCW(RB)         ST IN TIC CCW            Y02072 08412002
         MVI   24(RB),TIC               STORE TIC COMMAND BYTE          08460020
         TM    DCBRECFM,TRKOVFLB        TRACK OVERFLOW SPECIFIED        08480020
         BZ    SOPB605                  NO, BRANCH                      08500020
*                                       YES, CHANGE TIC CCW TO RD DATA  08520020
         MVI   24(RB),RDDX              READ DATA CMD OP FOR T/O        08540020
         MVI   28(RB),SLICCSK           SKIP, SILI, CC FLAGS            08560020
         MVI   31(RB),50                NON-ZERO LENGTH                 08580020
SOPB605  EQU   *                                                        08620020
         BCT   RUCB,NEXTIOB             GO BUILD NEXT IOB               08670021
         L     RWK4,DCBIOBA             GET FIRST IOB ADDR       Y02072 08720002
         USING IOBQSAMN,RD                                       Y02072 08730002
         ST    RWK4,IOBNIOBA            LINK FIRST TO LAST       Y02072 08770002
         OI    IOBNFLG1,IOBREAD         READ ONLY BIT            Y02072 08820002
         DROP  RD                                                Y02072 08830002
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 08840002
         USING WTGENTRY,RWTGC                                    Y02072 08890002
         MVC   WTGIDTTR,IGG01923        ID TO WTG TABLE        @Z30TSCF 08940003
         MVC   DCBCHCKA,SECTORA         SAVE SECTOR ADDRESS      Y02072 10950002
         SR    RB,RD                    GET OFFSET INTO IOB FOR         11000021
*                                          IGG01923                     11050021
         STC   RB,DCBREAD+TWO           SAVE OFFSET                     11100021
         SR    RC,RD                    OFFSET FOR IGG01923             11150021
         STC   RC,DCBREAD+THREE         SAVE OFFSET                     11200021
RELOOP   EQU   *                                                        11260020
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        11280020
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     11300020
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            11320020
         BCR   8,RBASE                                                  11340020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    11380020
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             11400020
         LR    RPARC,RPAR                                               11440020
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       11460020
ZCHEK    EQU   *                                                        11500020
         CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           11520020
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         11540020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  11560020
         LA    RPARC,PLOFF(0,RPARC)                                     11580020
         BC    15,ZCHEK                                                 11600020
TCTLRTN  EQU   *                                                        11640020
         USING WTG,RWTG                                                 11690003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11740003
               MODID=WTGENTRY                                  @Z30TSCF 11790003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11840003
         EJECT                                                          11850002
*                                                                       11860002
*  THE FOLLOWING WILL SET UP THE NEXT CCW AS A SEEK HEAD OR A    YM5362 11870002
*  NOP DEPENDING ON THE DEB FILE MAS FOR PERFORMANCE REASONS.    YM5362 11880002
*  IF THE FILE MASK INDICATES ALLOCATION IN CYLINDERS, SET CCW   YM5362 11890002
*  OP CODE TO A SEEK HEAD. IF ALLOCATION IS BY TRACKS, SET TO A  YM5362 11892002
*  NOP. THIS WILL PREVENT FILE MASK VIOLATIONS DURING I/O        YM5362 11894002
*  OPERATIONS AND THUS LESS ERROR PROCESSING BY APPENDAGES,      YM5362 11896002
*  EXCP, AND THE ERP.                                            YM5362 11898002
*                                                                       11900020
SOPB700  EQU   *                                                 YM5362 11910002
         LA    RWK4,DEBBASND            ADDR OF DEB FILE MASK    YM5362 11912002
         USING DEBDASD,RWK4                                      YM5362 11914002
         USING CCW,RB                                            YM5362 11916002
         MVI   CCWCOMCD,SEEK            ASSUME ALLOC IN CYLS     YM5362 11918002
         TM    DEBDVMOD,SEEKCYHD        IS ALLOCATION IN CYLS    YM5362 11918402
         BNOR  RBRNCH                   YES, SEEK HEAD OP CD OK  YM5362 11918802
         MVI   CCWCOMCD,NOP             NO, MAKE OP CD A NOP     YM5362 11919202
         BR    RBRNCH                   RETURN MAINLINE          YM5362 11919602
         DROP  RB,RWK4                                           YM5362 11924702
         SPACE 6                                                        11929802
WAOFF    EQU   32                                                       11934902
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           11940020
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           11960020
OPIDCNST DC    C'0S'                                                    11980020
AMIDCNST DC    C'1Z'                    THIS MODULES ID                 12000020
ONEIOB   DC    H'1'                    FOR NO OF IOB'S TEST      A37507 12030021
NXTSECSV EQU   ONEIOB                   LEN OF A SECTOR SAVE AR  Y02072 12032002
IGG01923 DC    C'23',VL3(IGG01923)      NEXT MOD               @Z30TSCF 12040003
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 12050002
END      EQU   *                        END OF MODULE            Y02072 12100002
         EJECT                                                          12102003
CVT      DSECT                                                 @Z30TSCF 12104003
         CVT                                                   @Z30TSCF 12106003
         EJECT                                                          12110002
         IGGBCB  TYPE=SAM                                               12112002
         EJECT                                                          12114002
         IEZDEB                                                         12120002
         EJECT                                                          12130002
         DCBD  DSORG=PS                                                 12150002
         TITLE 'IGG0191Z - FORMAT OF GOTTEN CORE'                       12820002
*                                                                       12840020
         IECDSECS  (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES    @Z30TSCF 12890003
         ORG   WTGIDTTR                                          Y02072 12892002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 12894002
FORCORE  DSECT                                                   Y02072 12896002
         ORG   DXCCW11                                           Y02072 12900002
SECTORAD DS    0F                       SAVE AREA FOR SECTOR AD  Y02072 12910002
         DS    X                        FILLER                   Y02072 12912002
SECTORA  DS    AL3                                               Y02072 12914002
         EJECT                                                          12914402
         IHACCW  DSECT=YES                                       Y02072 12916002
           END                                                          12920020
./  ADD  SSI=43081101,NAME=IGG01910
 TITLE 'IGG01910-IECOSLDA OPEN EXECUTOR (SAM)'                          00020000
IGG01910 CSECT                                                          00020403
*                                                                       00021201
*MODULE NAME - IGG01910                                          Y02072 00021602
*                                                                       00022002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00022102
*                                                                       00022202
*COPYRIGHT - NONE                                                Y02072 00022302
*                                                                       00022402
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00022502
*                                                                       00022802
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00022902
*000206,000550,006200,052500,052620,052900-052940,055729-055733, Y02072 00023002
*100000,106500-106597,116610-117200,55760,106400-106600,107400,  Y02072 00025202
*111800-113600,114200,145600-145800                              Y02072 00035202
*                                                                YM1140 00045202
*                                                                YM4640 00045302
*                                                                       00047303
*          VS2 RELEASE 3 DELETIONS                                      00049303
*                                                              @Z30TSCF 00049703
*          RELEASE 20 DELETIONS                                         00050102
*2161055746,055754,144120-144140                                 M5150  00052402
*2161                                                            S20038 00054702
*2161055720-055750,122000,144400,144700                          S20202 00057002
*2161144120-144140                                               M5701  00059302
*          RELEASE 21 DELETIONS                                         00061602
*1091122000,144660-144720                                        S21040 00063902
*D73400-74200                                                   SA66897 00065902
*                                                                       00066202
*STATUS CHANGE LEVEL 007                                                00075402
*                                                                       00077702
*FUNCTION/OPERATION - THIS ROUTINE WILL LOAD SOME OF THE I/O       UT18 00080018
*      PROCESSING MODULES.  THE MODULES TO BE LOADED ARE DETERMINEDUT18 00100018
*      FOR THE ACCESS METHODS AND DEVICE TYPE TO BE USED.          UT18 00120018
*      IT WILL PLACE THE ADDRESS OF THE LOADED MODULES IN THE           00160000
*      APPROPRIATE DCB FIELDS, AND THE ID'S IN THE DEB.                 00180000
*      IT WILL BRING IN THE APPROPRIATE ERROR ROUTINES.                 00200000
*      THIS MODULE WAS SPLIT IN RELEASE 18 TO INCLUDE USER         UT18 00220018
*      TOTALING SUPPORT.  THE SECOND HALF OF THIS MODULE IS NOW    UT18 00240018
*      IGG01917.                                                   UT18 00260018
*                                                                       00280000
*ENTRY POINTS: ENTERED FROM IGG0191J, IGG0191D, IGG0191G BY USE OF THE  00300000
*      XCTL MACRO.                                                      00320000
*                                                                       00340000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS)                        00360000
*                                                                       00380000
*OUTPUT: DCB(USERS),IOB(USERS).                                         00400000
*                                                                       00420000
*EXTERNAL ROUTINES: NONE.                                               00440000
*                                                                       00460000
*EXITS-NORMAL   XCTL TO IGG01917.                                  UT18 00480018
*                                                                       00500000
*EXITS-ERROR: NONE.                                                     00520000
*                                                                       00540000
*TABLES/WORAREA: DUPE EVERYTHING*************************************** 00560000
*********************************************************************** 00580000
*                                                                       00600000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY,   Y02072 00620002
*            SUPERVISOR STATE                                    Y02072 00630002
*                                                                       00640000
*NOTES: THIS ROUTINE HAS A LIST OF ALL BSAM, QSAM MODULES SUPPORTED.    00660000
*                                                                       00680000
*********************************************************************** 00700000
*                                                                       00720000
*                                                                       00740000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                00760000
*                                                                       00780000
*********************************************************************** 00800000
*                                                                       00820000
RE       EQU   0         WORK REG5                                      00830002
RF       EQU   1         WORK REG6                                      00832002
R1       EQU   RF        PARM REG                                YM1140 00834002
RDCB     EQU   2         DCB REGISTER                                   00840000
RBASE    EQU   3         BASE REGISTER                                  00860000
RCORE    EQU   4         WORK AREA ADDRESS                              00880000
RPAR     EQU   5         TOP OF PARAMETER LIST                          00900000
RWTG     EQU   6         TOP OF WTG TABLE                               00920000
RPARC    EQU   7         CURRENT PARAMETER                              00940000
RWTGC    EQU   8         CURRENT TRANS LOAD                             00960000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    00980000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01000000
RDEB     EQU   11        DEB ADDRESS                                    01020000
RB       EQU   12        WORK REG1  **                                  01040000
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01060000
RD       EQU   14        WORK REG3  **                                  01080000
RJ       EQU   15        WORK REG4                                      01100000
*                                                                       01160000
*                                                                       01180000
PARAR    EQU   RPARC                                                    01200000
*                                                                       01220000
*********************************************************************** 01240000
*                                                                       01260000
*********************************************************************** 01280000
*                                                                       01300000
* MASK'S TO TEST PARAMETER LIST WITH                                    01320000
*                                                                       01340000
*********************************************************************   01360000
INP      EQU   X'0F'                                                    01380000
OUTP       EQU   X'0F'                                                  01400000
UPDATE     EQU   X'04'                                                  01420000
INOUT      EQU   X'03'                                                  01440000
OUTIN      EQU   X'07'                                                  01460000
RDBACK     EQU   X'01'                                                  01480000
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 01490018
*                                                                       01500000
*                                                                       01520000
*********************************************************************   01540000
*                                                                       01560000
*                                                                       01580000
* OFFSET FOR PARAMETER TESTS                                            01600000
*                                                                       01620000
ONE        EQU   X'01'                                                  01640000
THREE    EQU   X'03'                    CONSTANT=O               S20202 01645020
K24      EQU   X'18'                    CONSTANT=24              S20202 01650020
K25      EQU   X'19'                    CONSTANT=25              S20202 01655020
FRTYATE    EQU   48                                                     01660000
DISPSN     EQU   X'0'                                                   01680000
*                                                                       01700000
*                                                                       01720000
*********************************************************************   01740000
*                                                                       01760000
* OFFSETS FOR DEB REFERENCE                                             01780000
*                                                                       01800000
*                                                                       01820000
ABEAPPOF EQU   17                       OFFSET TO AB END APP     S20202 01830020
*                                       ADDR                     S20202 01835020
FOUR     EQU   X'04'                                             M5150  01839020
BIN      EQU   36                                                       01840000
BEXT     EQU   38                                                       01860000
*                                                                       01880000
*                                                                       01900000
*                                                                       01920000
*********************************************************************   01940000
*                                                                       01960000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              01980000
*                                                                       02000000
*                                                                       02020000
*                                                                       02040000
DOUBLE     EQU   X'01'                                                  02060000
*                                                                       02080000
*                                                                       02100000
STOWB      EQU   X'80'                                                  02120000
WRTCK      EQU   X'80'                                                  02140000
OVRFLO     EQU   X'20'                                                  02160000
PCI        EQU   X'20'                                                  02180000
MINKEY     EQU   X'01'                                                  02200000
CONCAT     EQU   X'FF'                                                  02220000
UTFMASK  EQU   X'02'                    MASK FOR TOTALING FACILITY UT18 02230018
*                                                                       02240000
*********************************************************************   02260000
*                                                                       02280000
* MASKS FOR ACCESS METHODS IN SAM                                       02300000
*                                                                       02320000
QSAMB      EQU   X'01'                                                  02340000
BSAMBIT    EQU   X'00'                                                  02360000
PAM        EQU   X'02'                                                  02380000
*                                                                       02400000
*                                                                       02420000
* MASKS FOR MACRO'S TO BE USED                                          02440000
*                                                                       02460000
GETB       EQU   X'40'                                                  02480000
PUTB       EQU   X'40'                                                  02500000
READB      EQU   X'20'                                                  02520000
WRITEB     EQU   X'20'                                                  02540000
POINTB     EQU   X'04'                                                  02560000
CNTRLB     EQU   X'02'                                                  02580000
*                                                                       02600000
*                                                                       02620000
*********************************************************************   02640000
*                                                                       02660000
* MASKS FOR DEVICES TO BE SUPPORTED                                     02680000
*                                                                       02700000
OCR3886  EQU   X'57'                    DCBDEVT FOR 3886 OCR    XL03127 02710002
*                                                                       02720000
*                                                                       02740000
*********************************************************************   02760000
*                                                                       02780000
*                                                                       02800000
*                                                                       02820000
*                                                                       02840000
*********************************************************************   02860000
*                                                                       02880000
* MASKS FOR STATUS BITS TO BE TESTED                                    02900000
*                                                                       02920000
*                                                                       02940000
EXCPN      EQU   X'30'                                                  02960000
COMPLETE   EQU   X'80'                                                  02980000
FIRSTIOB   EQU   X'01'                                                  03000000
*                                                                       03020000
*                                                                       03040000
*                                                                       03060000
*********************************************************************   03080000
*                                                                       03100000
* MASKS FOR BUFFER TECHNIQUE'S                                          03120000
*                                                                       03140000
CYCLICB    EQU   X'20'                                                  03160000
EXCHANGB   EQU   X'10'                                                  03180000
SIMPLEB    EQU   X'40'                                                  03200000
EXCHCYCL   EQU   X'30'                                                  03220000
*                                                                       03240000
*********************************************************************   03260000
*                                                                       03280000
*                                                                       03300000
* MODES OF OPERATION FOR QSAM                                           03320000
*                                                                       03340000
LOCATEB    EQU   X'08'                                                  03360000
MOVEB      EQU   X'10'                                                  03380000
MOVEXCHB EQU   X'14'                                                    03400000
SUBSTUTB   EQU   X'04'                                                  03420000
*                                                                       03440000
*                                                                       03460000
*********************************************************************   03480000
*                                                                       03500000
*                                                                       03520000
* COMMAND BYTES FOR THE 2841                                            03540000
*                                                                       03560000
*       CONTROL UNIT                                                    03580000
*                                                                       03600000
*                                                                       03620000
*                                                                       03640000
SRCHE      EQU   X'31'                                                  03660000
WRTCKD     EQU   X'1D'                                                  03680000
RDC        EQU   X'92'                                                  03700000
RDKD       EQU   X'8E'                                                  03720000
RDD        EQU   X'86'                                                  03740000
TIC        EQU   X'08'                                                  03760000
*                                                                       03780000
*                                                                       03800000
*********************************************************************   03820000
*                                                                       03840000
*                                                                       03860000
* MASKS FOR RECORD FORMATS                                              03880000
*                                                                       03900000
*                                                                       03920000
STANDRDF   EQU   X'08'                                                  03940000
FORMATU    EQU   X'C0'                                                  03960000
FORMATF    EQU   X'80'                                                  03980000
FORMATV    EQU   X'40'                                                  04000000
FORMATD  EQU   X'20'                    D FORMAT RECORDS         S20038 04010020
BLOCKED    EQU   X'10'                                                  04020000
FIXEDBLK   EQU   X'90'                                                  04040000
*                                                                       04060000
*                                                                       04080000
*********************************************************************   04100000
*                                                                       04120000
*                                                                       04140000
*   CHANNEL CONTROL WORD FLAGS                                          04160000
*                                                                       04180000
SKIP       EQU   X'10'                                                  04200000
SLI        EQU   X'20'                                                  04220000
CC         EQU   X'40'                                                  04240000
DATACH     EQU   X'A0'                                                  04260000
SLICC      EQU   X'60'                                                  04280000
SLICCSK    EQU   X'70'                                                  04300000
*                                                                       04320000
*                                                                       04340000
*********************************************************************   04360000
*                                                                       04380000
*                                                                       04400000
KEYS       EQU   X'01'                                                  04420000
QSAM       EQU   X'01'                                                  04440000
*                                                                       04460000
*                                                                       04480000
*********************************************************************   04500000
*                                                                       04520000
GETMAIN    EQU   4                                                      04540000
XCTL       EQU   7                                                      04560000
LOAD       EQU   8                                                      04580000
*                                                                       04600000
*********************************************************************   04620000
*                                                                       04640000
D2       EQU   2                        DISPLACEMENT OF 2        S21040 04642021
D3       EQU   3                        DISPLACEMENT OF 3        S21040 04644021
D6       EQU   6                        DISPLACEMENT OF 6        S21040 04646021
L1       EQU   1                        LENGTH OF 1              S21040 04648021
L3       EQU   3                        LENGTH OF 3              S21040 04650021
L4       EQU   4                        LENGTH OF 4              S21040 04652021
*                                                                       04660000
**********************************************************************  04680000
ASA        EQU   X'04'                                                  04700000
BKREAD     EQU   X'01'                                                  04720000
URBITS   EQU   X'40'                                                    04740000
TAPEB    EQU   X'80'                                                    04760000
DABIT    EQU   X'20'                                                    04780000
OVRDMSK  EQU   X'C0'                    INDICATES OPEN OVERRITE  S21040 04782021
OVRDIN   EQU   X'0F'                    TEST FOR LABEL=(,,,IN)   S21040 04784021
ERREOB   EQU   X'0B'                    UTF EOB DISP. IN TABLE   S21040 04786021
PTR3211  EQU   X'49'                    MASK FOR 3211 PRINTER    S20202 04790020
*                                                                       04800000
**********************************************************************  04820000
*                                                                       04840000
**********************************************************************  04860000
*                                                                       04880000
*                                                                       04900000
*                                                                       04920000
*                                                                       04942000
*                                                                       04944000
*                                                                       04946000
*                                                                       04948000
*                                                                       04950000
*                                                                       04952000
*                                                                       04954000
*                                                                       04956000
*                                                                       04958000
*                                                                       04960000
*                                                                       04980000
         BALR  RBASE,0                                                  05000000
         USING SLDA,RBASE                                               05020000
         USING IHADCB,RDCB                                              05040000
         USING FORCORE,RCORE                                            05080000
*                                                                       05120000
*                                                                       05140000
SLDA     EQU   *                                                        05160000
*                                                                       05180000
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 05180102
         DC    C'IGG01910'              MODULE NAME              YM4640 05180202
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 05180303
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 05180403
BEGIN    DS    0H                       END OF MODULE ID         YM4640 05180502
*                                                                       05200000
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 05220000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   05240000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 05260000
         USING DEBBASIC,RDEB                                            05270001
         L     RCORE,4(RWTGC)           GET WORK AREA                   05280000
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  05300000
*                                                                       05320000
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           05340000
         USING DEBAVT,RTIOT                                             05350001
         SR    RUCB,RUCB                CLEAR REG                       05360000
         SR    RF,RF                    CLEAR RER                       05380000
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           05400000
         IC    RF,DEBEXSCL              GET SCALING FACTOR              05420000
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  05440000
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        05460000
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    05480000
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      05500000
*                                                                       05520000
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB                05540000
*                                                                       05560000
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING          UT18 05561018
         BZ    SLDAA                    BR IF NOT SPECIFIED        UT18 05562018
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 05563018
         BZ    SLDAA                    IF YES, NO TOTALING REQ'D  UT18 05564018
*                                                                  UT18 05565018
* SINCE UTF WAS SPECIFIED THE TOTALING SAVE ROUTINE (IGG019AX)     UT18 05566018
*        WAS LOADED BY IGG0191Y IN STAGE 1 - SO IT IS NECESSARY    UT18 05567018
*        TO UPDATE THE SUBROUTINE ID POINTER (RUCB) TO POINT       UT18 05568018
*        TO THE SECOND ID SUBFIELD.                                UT18 05569018
*                                                                  UT18 05570018
         LA    RUCB,2(RUCB)             POINT TO NEXT ID SUBFIELD  UT18 05571018
SLDAA    EQU   *                                                 S20202 05571220
         CLI   DCBDEVT,PTR3211          TEST FOR 3211 PRINTER    S20202 05571420
         BNE   SLDAB                    NO BRANCH AROUND         S20202 05571620
*                                                                       05571820
*   FOR A 3211 PRINTER LOAD AN ABNORMAL END APPENDAGE AND AN ERROR      05572020
*   RETRY MODULE.                                                       05572220
*                                                                       05572420
         LA    RB,ABEAPP11        ABNORMAL END APD ID            S20202 05572601
         BAL   RC,SLDROUT              GO LOAD APP AND RETURN    S20202 05572701
         MVC   DEBXCEAD,25(RWTG)       MOVE APP ADDR INTO AVT    S20202 05572801
         LA    RB,ERRMOD                GET ADDR OF ERROR RETRY  S20202 05573420
         BAL   RC,SLDROUT               GO LOAD ERROR RETRY MOD  S20202 05573620
*                                                                       05573820
*   WHEN RETURN FROM 'SLDROUT'- R0 CONTAINS THE ADDR OF THE             05574020
*   ASYNCHRONOUS ERROR ROUTINE. NOW BUILD AN IRB TO BE USED  IN         05574220
*   SCHEDULING THIS ROUTINE                                             05574420
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE)                          05574601
         ST    RF,K24(RWTG)             TEMP SAVE FOR IRB ADDR   S20202 05574820
         MVC   DEBIRBB,25(RWTG)   MOVE IRB ADDR INTO DEB         S20202 05575001
SLDAB    EQU   *                                                 M5150  05575720
         USING WTGENTRY,RWTGC                                    Y02072 05575802
         MVC   WTGIDTTR,NEXTMOD         ID OF NEXT MOD IN WTG  @Z30TSCF 05575903
         TM    DCBCIND2,QSAMB           DCB FOR QSAM                    05594002
         BC    1,SLD100                 YES BRANCH                      05600000
*                                                                       05620000
         CLI   DCBDEVT,OCR3886          IS DEVICE A 3886        XL03127 05670002
         BNE   SLDAC                    NO,BR FOR STD BSAM CHECKXL03127 05672002
         LA    RB,OCRCHK                YES,GET ADDR OCR CHK ID XL03127 05674002
         B     SLDAE                    BRANCH AROUND           XL03127 05676002
SLDAC    LA    RB,CHECK                 GET ADDRESS OF CHECK ID         05680002
SLDAE    EQU   *                        BRANCH POINT            XL03127 05690002
         TM    DCBOFLGS,X'20'           CONCATENATION UNLIKE ATTRIBUTES 05700000
         BC    8,SLDA0                  NO BRANCH                       05720000
         BAL   RC,SLDROUT1              STORE THE ID OF CHECK IN DEB    05740000
         B     SLDA1                                                    05760000
*                                                                       05780000
SLDA0    BAL   RC,SLDROUT               LOAD CHECK ROUTINE              05800000
         MVC   DCBCHECK+1(3),25(RWTG)  LOAD CHECK ADDR. INTO DCB        05820000
*                                                                       05840000
SLDA1    EQU   *                                                        05860000
*                                                                       05880000
         CLI   DCBDEVT,OCR3886          IS DEVICE A 3886        XL03127 05890002
         BNE   SLDA3                    NO,BR FOR STD BSAM READ XL03127 05892002
         LA    RB,OCRREAD               YES,GET ADDR OCR RD ID  XL03127 05894002
         B     SLDA5                    BRANCH AROUND           XL03127 05896002
*                                                                       05898002
SLDA3    LA    RB,WRH2                  GET RD/WRT ID ADDRESS           05900002
SLDA5    BAL   RC,SLDROUT               TO LOAD FUNCTION                05920002
         MVC   DCBREAD+1(3),25(RWTG)   LOAD READ/WR ADDR. IN DCB        05940000
*                                                                       05960000
         B     SLDEOB                   GET SPECIAL ROUTINES            05980000
*                                                                       06000000
*********************************************************************** 06020000
*                                                                       06040000
SLD100   EQU   *                                                        06060000
*                                                                       06080000
         TM    DISPSN(PARAR),OUTP       DCB  EOR  OUTPUT                06120000
         BC    1,SLD200                 YES BRANCH                      06140000
*                                                                       06160000
         LA    RB,GERR                  GET ADDRESS OF GERR ID          06180000
*                                                                       06200000
         TM    DCBOFLGS,X'20'           CONCATENATION UNLIKE ATTRIBUTES 06220000
         BC    8,SLD100A                NO BRANCH                       06240000
*                                                                       06260000
         BAL   RC,SLDROUT1              JUST STORE GERRS ID IN DEB      06280000
         B     SLD101                                                   06300000
*                                                                       06320000
*                                                                       06340000
SLD100A  BAL   RC,SLDROUT               LOAD GERR                       06360000
         MVC   DCBGERR+1(3),25(RWTG)   LOAD GERR ADDR. IN DCB           06380000
*                                                                       06400000
*                                                                       06420000
SLD101   EQU   *                                                        06440000
*                                                                       06460000
         TM    DCBDEVT,URBITS           DCB USING URE                   06480000
         BC    1,SLD170                 YES BRANCH                      06500000
*                                                                       06520000
         TM    DCBDEVT,TAPEB            DCB USING TAPE                  06540000
         BC    8,SLD160                 NO BRANCH                       06560000
*                                                                       06580000
         TM    DEBOPATB,X'03'          OPEN FOR BACKWARD READ           06600000
         BC    9,SLD160                NO BRANCH                        06620000
*                                                                       06640000
         LA    RB,SBLF                  SET UP BASE FOR BACKWARD GETS   06660000
         TM    DCBMACRF,MOVEXCHB       DCB USING MOVE OR SUBST. MODE    06680000
         BC    8,SLD150                 NO BRANCH MUST BE LOCATE MODE   06700000
         LA    RB,L'NXTENTRY(RB)        POINT TO MVOE MODE       Y02072 06732002
*                                                                       06740000
*                                                                       06760000
SLD150   EQU   *                                                        06780000
         BAL   RC,SLDROUT               TO LOAD FUNCTION                06800000
         MVC   DCBGET+1(3),25(RWTG)    LOAD GET ADDR. IN DCB            06820000
*                                                                       06840000
*******************************************************************     06860000
*******************************************************************     06880000
*                                                                       06900000
         B     SLDEOB                   TO SPECIAL ROUTINES             06920000
*                                                                       06940000
SLD160   EQU   *                                                        06960000
*                                                                       06980000
         LA    RB,SGLF                  SET UP FOR NORMAL GET IDS       07000000
         B     SLD172                                                   07020000
*                                                                       07040000
SLD170   TM    DCBMACRF,CNTRLB          IS CNTRL MACRO USED READER      07060000
         BC    8,SLD160                 NO USE NORMAL GETS              07080000
*                                                                       07100000
         LA    RB,GMFC                  POINT TO SPECIAL GET MOVE       07120000
*                                                                       07140000
         B     SLD175                                                   07160000
*                                                                       07180000
SLD172   EQU   *                                                        07200000
         TM    DCBMACRF,MOVEXCHB        DCB USING MOVE OR SUBST. MODE   07220000
         BC    8,SLD175                 NO BRANCH MUST BE LOCATE MODE   07240000
*                                                                       07260000
SLD173   EQU   *                                                        07280000
         LA    RB,2*L'NXTENTRY(RB)      UPDATE TO MOVE MODE      Y02072 07282002
SLD175   EQU   *                                                        07320000
         TM    DCBRECFM,DCBRECF         FORMAT F OR U           SA66897 07370002
         BO    SLD150                   YES, GO LOAD ROUTINE    SA66897 07420002
         TM    DCBRECFM,DCBRECV         FORMAT V                SA66897 07422002
         BO    SLD1760                  YES, GO INCR TO NEXT ID SA66897 07424002
*                                                                       07426002
* BECAUSE DCBRECFM FIELD BITS 0, 1, & 2 HAVE DUPLICATE MEANINGS         07428002
* IT IS NECESSARY TO MAKE THE FOLLOWING TWO TESTS TO DETERMINE          07428402
* IF FORMAT D RECORDS ARE BEING USED.                                   07428802
*   RECFM = 001XXXXX - UNDEFINED REC FORMAT WITH TRK OVERFLO            07428902
*   RECFM = 001XXXXX - ASCII TAPE (OPTCD = Q)                           07429002
* AT THIS POINT BITS 0 & 1 ARE ZERO.                                    07429102
*                                                                       07429202
         TM    DCBRECFM,DCBRECD         ASCII TAPE OR TRK OVFLO SA66897 07429602
         BZ    SLD150                   NO, GO LOAD FOR FORMAT  SA66897 07429702
*                                         U RECORDS             SA66897 07429802
         TM    DCBOPTCD,DCBOPTQ         ASCII TAPE              SA66897 07429902
         BZ    SLD150                   NO, GO LOAD U FORMAT    SA66897 07437402
SLD1760  EQU   *                                                 S20038 07445002
         LA    RB,L'NXTENTRY(RB)        UPDATE TO V REC IDS      Y02072 07452502
         B     SLD150                   TO LOAD FUNCTION                07460000
*                                                                       07480000
SLD200   LA    RB,PERR                  GET ADDRESS OF PERR ID          07500000
         BAL   RC,SLDROUT               TO LOAD SUBROUTINE              07520000
         MVC   DCBPERR+1(3),25(RWTG)   LOAD PERR ADDR.IN DCB            07540000
*                                                                       07560000
*                                                                       07580000
SLD250   LA    RB,SPLF                  ESTABLISH BASE FOR PUTS         07600000
*                                                                       07620000
         TM    DCBMACRF+1,MOVEXCHB     DCB USING MOVE OR SUBST. MODE    07640000
         BC    8,SLD175                 NO BRANCH MUST BE LOCATE MOGE   07660000
         B     SLD173                   SET UP FOR MOVE ROUTINES        07680000
*                                                                       07700000
*********************************************************************** 07720000
*                                                                       07740000
SLDEOB   EQU   *                                                        07760000
*                                                                       07780000
*    THIS SECTION OF CODE UP TO THE LABEL ENDOVR WILL ENSURE THAT       07850021
*    THE EOB ROUTINE IGG019CT GETS LOADED BY IGG01917 FOR ANY           07920021
*    OPEN OVERRIDE.                                                     07990021
*                                                                       08060021
         TM    JFCBMASK+D6,OVRDMSK      WAS AN OVERRIDE USED     S21040 08130021
         BNO   ENDOVR                   BR IF NO                 S21040 08200021
         TM    0(RPARC),OVRDIN          WAS IT LABEL=(,,,IN)     S21040 08270021
         BZ    INCHNG                   BR IF YES                S21040 08340021
         MVC   DCBCNTRL+D2(L1),DCBCNTRL+D3 SAVE WRITE EOB DISP   S21040 08410021
         MVI   DCBCNTRL+D3,ERREOB       SET READ EOB ROUTINE FOR S21040 08480021
*                                       THE ERROR EOB ROUTINE           08550021
         B     ENDOVR                   CONTINUE                 S21040 08620021
INCHNG   EQU   *                                                 S21040 08690021
         MVI   DCBCNTRL+D2,ERREOB       SET WRITE EOB ROUTINE    S21040 08760021
*                                       FOR ERROR EOB ROUTINE           08830021
ENDOVR   EQU   *                                                 S21040 08900021
*                                                                       08970021
*    IF USER TOTALING IS TO BE USED, EOB ROUTINES WHICH CONTAIN         09040021
*    THE TOTALING LINKAGE MUST BE LOADED INSTEAD OF THE NORMAL EOB      09110021
*    ROUTINES. THIS IS ACCOMPLISHED BY DOING A TRANSLATE OF THE         09180021
*    DCBCNTRL FIELD TO CONVERT NORMAL EOB DISPLACEMENTS INTO            09250021
*    DISPLACEMENTS FOR THE UTF EOB ROUTINE. THE ROUTINES ARE            09320021
*    LOADED BY IGG01917.                                                09390021
*                                                                       09460021
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING OPTION S21040 09530021
         BZ    RELOOP                   BR IF NOT SPECIFIED      Y02072 09600002
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK S21040 09670021
         BZ    RELOOP                   IF YES, NO TOTALING REQD Y02072 09740002
         TR    DCBCNTRL(L4),UTFTBL      CHANGE TO UTF DISP.      S21040 09810021
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        10280000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     10300000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            10320000
         BCR   8,RBASE                                                  10340000
*                                                                       10360000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    10380000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             10400000
*                                                                       10420000
         LR    RPARC,RPAR                                               10440000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       10460000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           10480000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         10500000
*                                                                       10520000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  10540000
         LA    RPARC,PLOFF(0,RPARC)                                     10560000
         BC    15,ZCHEK                                                 10580000
*                                                                       10600000
TCTLRTN  EQU   *                                                        10620000
         USING WTG,RWTG                                                 10670003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*10720003
               MODID=WTGENTRY                                  @Z30TSCF 10730003
         DROP  RWTGC,RWTG                                      @Z30TSCF 10740003
*                                                                       10760000
*                                                                       10780000
*                                                                       10800000
WAOFF    EQU   32                                                       10820000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           10840000
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           10860000
OPIDCNST DC    C'0S'                                                    10880000
AMIDCNST DC    C'10'                                                    11060000
*                                                                       11080000
*                                                                       11100000
*                                                                       11120000
         DS    0H                                                       11140000
SLDROUT  EQU   *                                                        11160000
         USING WTGMODNM,RWTG                                     Y02072 11210002
         MVC   WTGMODID,0(RB)           ID TO MOD NAME           Y02072 11260002
         DROP  RWTG                                              Y02072 11310002
*                                                                       11380000
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 11390002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 11392002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 11394002
         DROP  R1                       DROP CVT BASE            YM1140 11396002
*                                                                       11400000
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 11420002
*                                                                       11440000
*                                                                       11460000
*                                                                       11480000
         ST    RE,24(RWTG)             TEMP STORE OF ROUTINE ADDR,      11500000
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        11520000
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               11540000
         SR    RD,RD                    CLEAR REG                       11560000
         IC    RD,DEBNMSUB              GET NO.OF SUBRTS LOADED SO FAR  11580000
         LA    RD,1(RD)                 ONE MORE SUB RT LOADED          11600000
         STC   RD,DEBNMSUB              STORE NEW TOTAL SUBRTS LOADED   11620000
         BR    RC                      RETURN                           11640000
*                                                                       11660000
*                                                                       11730021
*    THE FOLLOWING TABLE IS USED WITH A TRANSLATE INSTRUCTION           11740021
*    TO CONVERT DISPLACEMENTS FOR THE EOB TABLE INTO THE                11750021
*    ENTRIES FOR THE CORRESPONDING UTF EOB ROUTINES.                    11760021
*                                                                       11770021
UTFTBL   EQU   *                                                 S21040 11780021
         DC    X'00'                    NO CHANGE                S21040 11790021
         DC    X'0C'                    IGG019CD TO IGG019TD     S21040 11800021
         DC    X'0D'                    IGG019CC TO IGG019TC     S21040 11810021
         DC    X'03'                    NO CHANGE                S21040 11820021
         DC    X'04'                    NO CHANGE                S21040 11830021
         DC    X'05'                    NO CHANGE                S21040 11840021
         DC    X'06'                    NO CHANGE                S21040 11850021
         DC    X'07'                    NO CHANGE                S21040 11860021
         DC    X'08'                    NO CHANGE                S21040 11870021
         DC    X'09'                    NO CHANGE                S21040 11880021
         DC    X'0A'                    NO CHANGE                S21040 11890021
         DC    X'0B'                    NO CHANGE                S21040 11900021
*                                                                       12060000
*********************************************************************** 12080000
*                                                                       12100000
*   BELOW ARE THE QSAM ROUTINES BEING SUPPORTED                         12120000
*                                                                       12140000
*********************************************************************   12160000
*                                                                       12180000
NEXTMOD  DC    C'17',VL3(IGG01917)      IGG01917 - THIS IS THE @Z30TSCF 12240003
*                                       SECOND HALF OF THIS MODULE UT18 12260002
SGLF     DC    C'AA'                    SIMPLE GET LOC MODE FIXED REC.  12300000
SGLV     DC    C'AB'                    SIMPLE GET LOC MODE VARIABLE R. 12360000
SGMF     DC    C'AC'                    SIMPLE GET MOVE MD FIXED RECS.  12420000
SGMV     DC    C'AD'                    SIMPLE GET MOVE MD VARIABLE REC 12480000
GMFC     DC    C'AG'                    SIMPLE GET CARD RDR-CNTRL MOVEF 12540000
GMVC     DC    C'AG'                    SIMPLE GET CARD RDR-CNTRL 25005 12590018
*                                       MOVEF                     25005 12600018
SPLF     DC    C'AI'                    SIMPLE PUT LOC MD. FIXED RECS   12660000
SPLV     DC    C'AJ'                    SIMPLE PUT LOC MD. VARIABLE REC 12720000
SPMF     DC    C'AK'                    SIMPLE PUT MOVE MD. FIXED REGS  12780000
SPMV     DC    C'AL'                    SIMPLE PUT MOVE MD. VARIABLE RC 12840000
SBLF     DC    C'AM'                    SIMPLE GETBACKWARDS LOC MD  FIX 12900000
SBMF     DC    C'AN'                    SIMPLE GETBACKWARDS MOVE MD VAR 12960000
GERR     DC    C'AQ'                    GET ERROR ROUTINE               13020000
PERR     DC    C'AR'                    PUT ERROR ROUTINE               13080000
*                                                                       13140000
*  THIS CONCLUDES THOSE QSAM MODULES THAT ARE BEING SUPPORTED NOW       13160000
*                                                                       13180000
*   BELOW ARE THE BSAM MODULES BEING SUPPORTED AT THIS TIME             13240000
*                                                                       13260000
*                                                                       13280000
WRH2     DC    C'BA'                    READ-WRITE ROUTINE              13300000
CHECK    DC    C'BB'                    CHECK ROUTINE                   13360000
OCRREAD  DC    C'LU'                    READ ROUTINE FOR 3886   XL03127 13430002
OCRCHK   DC    C'LS'                    CHECK ROUTINE FOR 3886  XL03127 13436002
*    THIS CONCLUDES THE BSAM MODES BEING SUPPORTED NOW                  13480000
*                                                                       13500000
*   3211 ERROR RETRY MODULES                                            14402020
*                                                                       14404020
ABEAPP11 DC    C'FR'       TTR FOR 3211 ABN APP                  M5150  14412002
ERRMOD   DC    C'FS'       TTR FOR ERR RETRY MODS                M5150  14414002
NXTENTRY DS    0CL2                     TO GET 2 BYTE LEN ATTR   Y02072 14416002
         SPACE 3                                                        14422002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 14430002
END      EQU   *                        END OF MODULE            Y02072 14480002
         TITLE 'IGG01910 - FORMAT OF GOTTEN CORE'                       14540002
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 14590003
         ORG   WTGIDTTR                                          Y02072 14600002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 14610002
*                                                                       14620000
CVT      DSECT                                                          14640000
         CVT                                                            14660000
*                                                                       14680000
*                                                                       14700000
         IEZDEB                                                         14720001
*                                                                       15260000
           DCBD  DSORG=PS                                               15280000
*                                                                       15300000
**********************************************************************  15320000
*                                                                       15340000
           END                                                          15360000
./  ADD  SSI=51370292,NAME=IGG01911
1911 TITLE 'IGG01911-LAST LOAD OF SAM, PAM, AND EXCP OPEN EXECUTORS'    00020003
IGG01911 CSECT                                                          00024000
*                                                                       00026002
*MODULE NAME - IGG01911                                          Y02072 00026402
*                                                                       00026802
*DESCRIPTIVE NAME - SAM/EXCP LAST LOAD                           Y02072 00027202
*                                                                       00027602
*COPYRIGHT - NONE                                                Y02072 00027702
*                                                                       00027802
*RELEASE ACTIVITY - AS FOLLOWS:                                  Y02072 00027902
*                                                                       00037902
*          RELEASE 20 DELETIONS                                       * 00052000
*2964                                                            A36344 00053020
*2964                                                            S20038 00054020
*2964074000-074400                                               A30962 00055020
*2964030400-031000,041200,085400                                 S20201 00055520
*2964084600-084800,090600                                        M1557  00055720
*                                                                       00055802
*          RELEASE 21 DELETIONS                                       * 00056000
*0934093320-093400                                               M1630  00056121
*0934001000-001150,017550,045840-045960,093000-096100,097840-    M0474  00056321
*0934097960,108100                                               M0474  00056621
*0934003500,102480-102520,103400,105600-106400,107600-108600     S21042 00057021
*0934093400,094200,095600,096000                                 S21045 00058021
* 062000-062200                                                  A41465 00058421
*0934000950,093000,093760-093840                                 M1044  00059021
*0934093760-093800,093880-093920,094240-094400,095320            M1812  00059521
*                                                                       00059602
*        VS1 RELEASE 2 DELETIONS                                        00059702
*D59400                                                         XA02987 00059802
*                                                                       00061702
*        VS2 RELEASE 2 DELETIONS                                        00065602
*200-220,280-600,1400,1600,2800,16400-17500,41800-43600,         Y02072 00067502
*94240-94330,94480-94680,94920-95720,97600,105400,106000         Y02072 00069402
*                                                                YM4635 00069802
*                                                                YM4697 00070202
*D46000                                                          YM5778 00070602
*                                                                YM5940 00071002
*                                                                YM6506 00071102
*                                                                YM6583 00071202
*                                                                YM7595 00071302
*                                                                YM7889 00074902
*                                                                       00078602
*                                                                       00081403
*        VS2 RELEASE 3 DELETIONS/CHANGES                                00081503
*D086250-086300                                                @Z30TSMI 00081803
*                                                                       00082303
*        VS2 RELEASE 04 CHANGES/DELETIONS                               00084303
*A072300-072380                                                 ZA01361 00084703
*                                                                       00085802
*FUNCTION/OPERATION-                                                    00089402
*                                                                       00093002
*    - FOR ALL DATA SETS IT WILL ISSUE THE IECRES MACRO TO GET   Y02072 00096602
*      THE USERS COPY OF THE DCB REFRESHED.                      Y02072 00100202
*    - IT SETS BITS IN THE FORCE CLOSE AUDIT TRAIL TO            YM7595 00103802
*      INDICATE TO FORCE CLOSE THAT ANY FORCE CLOSE PROCESSING   Y02072 00107402
*      SHOULD BE DONE BY THE NORMAL CLOSE EXECUTORS AND FOR      YM7595 00111002
*      TAPE AND UNIT RECORD DEVICES THAT IOB CONSTRUCTION IS     YM7595 00114602
*      COMPLETED (BUFFER ADDRESSES TO CCWS).                     YM7595 00118202
*    - FOR PRINTERS IT WILL DELETE IGGMSG01 IF IT HAS BEEN       Y02072 00121802
*      LOADED AND ZERO THE FIELD ITS ADDRESS WAS IN.             Y02072 00125402
*    - IT WILL SET THE TYPE OF RELATED REQUEST IN THE IOBS       Y02072 00129002
*    - BUFFERS ARE PRIMED FOR QSAM INPUT BY BRANCHING TO THE EOB        00132602
*      MODULE.  THE CALLING SVRB IS TESTED TO DETERMINE IF A BALR       00136202
*      (IF KEY <8) OR SYNCH (IF KEY >7) IS TAKEN, THE LATTER     Y02072 00139802
*      ALLOWING THE EOB ROUTINE TO EXECUTE IN PROBLEM PROGRAM    Y02072 00143402
*      STATE, USER KEY.                                          Y02072 00147002
*    - A GETMAIN IS ISSUED IN USER KEY TO PROVIDE THE EOB RTN    Y02072 00150602
*      WITH A SAVEAREA IN SP 230. OPENS REGISTERS ARE SAVED IN   Y02072 00154202
*      THE SVRB EXTENDED SAVEAREA.                               Y02072 00157802
*                                                                       00161402
*ENTRY POINTS: ENTERED FROM STAGE 1 AND STAGE 3 EXECUTORS BY     Y02072 00165002
*              USE OF THE XCTL MACRO.                            Y02072 00175002
*                                                                       00180000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00200000
*                                                                       00220000
*OUTPUT: SEE DESCRIPTION OF REGISTERS,DCB(USERS),IOB(USERS).            00240000
*                                                                       00260000
*EXTERNAL ROUTINES - EOB ROUTINE, O/C/E RESIDENT ROUTINE         Y02072 00280002
*                                                                       00300000
*EXTERNAL REFERENCES - IGGMSG01                                  Y02072 00310002
*                                                                       00310402
*MACROS:ACTION - IECRES, DELETE, MODESET, EXCP, DMABCOND, XCTL,  Y02072 00310802
*                GETMAIN                                         Y02072 00311202
*                                                                       00311602
*MACROS:MAPPING - IECDSECS(MAIN,WTG,PREFX), DCBD, CVT, IEZDEB,   Y02072 00316302
*                 IEZIOB, IHAPSA, IKJTCB, IHARB, IGGBCB, IHACCW  Y02072 00318302
*                                                                       00330602
*EXITS-NORMAL-XCTL TO IGG0190S  (OPEN).                                 00335302
*                                                                       00340000
*EXITS-ERROR XCTL TO PROB DET (IGG0196M) FOR WTP AND 013 ABEND          00346021
*      INSUFFIEIENT BUFFERS AVAILABLE                                   00352021
*      IN BUFFER POOL TO SATISFY DCB BUFFER REQUIREMENTS          16059 00360016
*                                                                       00380000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00400000
*                                                                       00420000
*      BYTE  0-7  NAME                                                  00440000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00460000
*      BYTE 11    CONCATENATION NUMBER                                  00480000
*      BYTE 12    ZERO                                                  00500000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00520000
*                        ALIAS INDICATOR 1 BIT                          00540000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00560000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00580000
*      BYTE 17    ZERO                                                  00600000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00620000
*      BYTE 20    TRANSLATION TABLE                                     00640000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00660000
*      BYTE 22-23 ATTRIBUTES                                            00680000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00700000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00720000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00740000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00760000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00780000
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        00800000
*      BYTE 36-39 TABLE OF IDTTR'S                                      00820000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          00840000
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          00860000
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          00880000
*                   NOT USED                         (1 BYTE)           00900000
*                                                                       00920000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN SUPERVISOR STATE AND   Y02072 00940002
*            USER KEY UNLESS OTHERWISE SPECIFIED.                Y02072 00950002
*                                                                       00960000
         EJECT                                                          01010002
*********************************************************************** 01060000
*                                                                       01100000
*  REGISTER CONVENTIONS USED                                            01120002
*                                                                       01140000
*********************************************************************** 01160000
*                                                                       01180000
RDCB     EQU   2         DCB REGISTER                                   01200000
RBASE    EQU   3         BASE REGISTER                                  01220000
RCORE    EQU   4         WORK AREA ADDRESS                              01240000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01260000
RWTG     EQU   6         TOP OF WTG TABLE                               01280000
RPARC    EQU   7         CURRENT PARAMETER                              01300000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01320000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01340000
RWK4     EQU   RTIOT     WORK REGISTER                           Y02072 01350002
RIOB     EQU   10        IOB REGISTER                                   01360002
RDEB     EQU   11        DEB ADDRESS                                    01380000
RB       EQU   12        WORK REG1  **                                  01400000
RWK2     EQU   RB        WORK REGISTER                           Y02072 01410002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01420000
RSAVE    EQU   RC        REG USED TO PASS SAVE AREA TO EOB RTN   Y02072 01430002
RBUFADR  EQU   RC        ADDRESS OF CURRENT BUFFER               YM7595 01430102
RD       EQU   14        WORK REG3  **                                  01440000
R14      EQU   RD        PARAMETER RIGISTER                      Y02072 01450002
RWK3     EQU   RD        WORK REGISTER                           Y02072 01452002
RJ       EQU   15        WORK REG4                                      01460000
RE       EQU   0         WORK REG5                                      01480000
R0       EQU   RE        PARAMETER REGISTER                      Y02072 01490002
RF       EQU   1         WORK REG6                                      01500000
RWK1     EQU   RF        WORK REGISTER                           Y02072 01510002
R1       EQU   RF        PARAMETER REGISTER                             01512002
*                                                                       01520000
*                                                                       01540000
PARAR    EQU   RPARC                                                    01560000
*                                                                       01580000
*********************************************************************** 01600000
*                                                                       01620000
OUTP     EQU   X'0F'                                                    01660002
DEBOUTPT EQU   X'0F'                    PROCESSING TYPE, OUTPUT  Y02072 01710002
DEBUPDAT EQU   X'04'                    PROCESSING TYPE, UPDATE  Y02072 01720002
*                                         OR OUTIN               Y02072 01730002
DEBINOUT EQU   X'02'                    PROCESSING TYPE, INOUT   Y02072 01740002
SAVELG   EQU   72                      LENGTH OF SAVE AREA       S21045 01745021
KEYMASK  EQU   X'80'                    MASK TO DISTINGUISH      Y02072 01755002
*                                         BETWEEN USER AND       Y02072 01760002
*                                         SYSTEM KEYS            Y02072 01780002
*********************************************************************   01800000
*                                                                       01820000
*                                                                       01840000
* OFFSET FOR PARAMETER TESTS                                            01860000
*                                                                       01880000
ONE        EQU   X'01'                                                  01900000
FRTYATE    EQU   48                                                     01920000
DISPSN     EQU   X'0'                                                   01940000
*                                                                       01960000
*                                                                       01980000
*********************************************************************   02000000
*                                                                       02020000
* OFFSETS FOR DEB REFERENCE                                             02040000
*                                                                       02060000
*                                                                       02080000
BIN      EQU   36                                                       02100000
BEXT     EQU   38                                                       02120000
*                                                                       02140000
*                                                                       02160000
*                                                                       02180000
*********************************************************************   02200000
*                                                                       02220000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              02240000
*                                                                       02260000
*                                                                       02280000
*                                                                       02300000
LASTDCB    EQU   X'01'                                                  02320000
DOUBLE     EQU   X'01'                                                  02340000
*                                                                       02360000
*                                                                       02380000
STOWB      EQU   X'80'                                                  02400000
WRTCK      EQU   X'80'                                                  02420000
OVRFLO     EQU   X'20'                                                  02440000
PCI        EQU   X'20'                                                  02460000
MINKEY     EQU   X'01'                                                  02480000
CONCAT     EQU   X'FF'                                                  02500000
*                                                                       02520000
*********************************************************************   02540000
*                                                                       02560000
* MASKS FOR ACCESS METHODS IN SAM                                       02580000
*                                                                       02600000
QSAMB      EQU   X'01'                                                  02620000
BSAMBIT    EQU   X'00'                                                  02640000
PAM        EQU   X'02'                                                  02660000
PSAM       EQU   X'42'                                                  02680000
*                                                                       02700000
*                                                                       02720000
* MASKS FOR MACRO'S TO BE USED                                          02740000
*                                                                       02760000
PUTB       EQU   X'40'                                                  02780000
READB      EQU   X'20'                                                  02800000
CNTRLB   EQU   X'02'                                                    02820000
*                                                                       02840000
*********************************************************************   02860000
*                                                                       02880000
* MASKS FOR DEVICES TO BE SUPPORTED                                     02900000
*                                                                       02920000
DABIT    EQU   X'20'                                                    02940000
URBIT    EQU   X'40'                                                    02960000
TAPE     EQU   X'80'                    TAPE DEVICE              S20038 02970020
*                                                                       02980000
*                                                                       03000000
*********************************************************************   03020000
*                                                                       03026020
* BYTE COUNTS AS EQUATES                                                03032020
*                                                                       03038020
B0       EQU   0                        BYTE COUNT OF 0          S20201 03044020
B1       EQU   1                        BYTE COUNT OF 1          S20201 03050020
B2       EQU   2                        BYTE COUNT OF 2          S20201 03056020
B3       EQU   3                        BYTE COUNT OF 3          S20201 03062020
B4       EQU   4                        BYTE COUNT OF 4          S20201 03068020
B5       EQU   5                        BYTE COUNT OF 5          S20201 03074020
B8       EQU   8                        BYTE COUNT OF 8          S20201 03080020
B12      EQU   12                       BYTE COUNT OF 12         M0474  03083021
B56      EQU   56                       BYTE COUNT OF 56         S20201 03086020
B80      EQU   80                       BYTE COUNT OF 80         S20201 03092020
*                                                                       03098020
*                                                                       03104020
*********************************************************************   03120000
*                                                                       03140000
* MASKS FOR STATUS BITS TO BE TESTED                                    03160000
*                                                                       03180000
*                                                                       03200000
COMPLETE   EQU   X'80'                                                  03220000
FIRSTIOB   EQU   X'01'                                                  03240000
*                                                                       03260000
*                                                                       03280000
*                                                                       03300000
*********************************************************************   03320000
*                                                                       03340000
* MASKS FOR BUFFER TECHNIQUE'S                                          03360000
*                                                                       03380000
EXCHANGB   EQU   X'10'                                                  03400000
SIMPLEB    EQU   X'40'                                                  03420000
*                                                                       03440000
*********************************************************************   03460000
*                                                                       03480000
*                                                                       03500000
* MODES OF OPERATION FOR QSAM                                           03520000
*                                                                       03540000
LOCATEB    EQU   X'08'                                                  03560000
MOVEB      EQU   X'10'                                                  03580000
SUBSTUTB   EQU   X'04'                                                  03600000
*                                                                       03620000
FLGOFFST EQU   4                        OFFSET TO FLAG IN BCB    S19015 03625019
RAFLAG   EQU   X'80'                    RECORD AREA INDICATOR    S19015 03630019
SPANNED  EQU   X'08'                    SPANNED RECORDS          S19015 03635019
*                                                                       03640000
*********************************************************************   03660000
*                                                                       03680000
* OTHER MASKS                                                     OC022 03690000
*                                                                       03700000
UNUSED   EQU   X'80'                    DCB OPENED-NOT YET USED   OC022 03710000
*                                                                       03720000
*                                                                       03740000
*********************************************************************   03760000
*                                                                       03780000
*                                                                       03800000
* MASKS FOR RECORD FORMATS                                              03820000
*                                                                       03840000
*                                                                       03860000
STANDRDF   EQU   X'08'                                                  03880000
FORMATU    EQU   X'C0'                                                  03900000
FORMATF    EQU   X'80'                                                  03920000
FORMATV    EQU   X'40'                                                  03940000
FORMATD  EQU   X'20'                    D FORMAT RECORDS         S20038 03950020
*                                                                       03960000
*                                                                       03980000
*********************************************************************   04000000
*                                                                       04020000
*       COMMAND BYTES NEEDED                                            04040000
*                                                                       04060000
TIC      EQU   X'08'                                                    04080000
NOP      EQU   X'03'                                                    04100000
OABD066  EQU   66                                                S21042 04103021
NOPTIC   EQU   X'88'                    NOP TIC COMMAND          S20201 04106020
         EJECT                                                          04160002
         BALR  RBASE,0                                                  04420000
         USING SOP90,RBASE                                              04440000
         USING IHADCB,RDCB                                              04460000
         USING FORCORE,RCORE                                            04480000
SOP90    EQU   *                                                        04500000
*                                                                       04520000
         B     BEGIN                                             Y02072 04530002
         DC    C'IGG01911'              MODULE NAME              Y02072 04532002
         DC    C' ZA01361'              LAST SHIP CODE          ZA01361 04534003
         DC    C'02/25/75'              LAST DATE MODIFIED      ZA01361 04536003
BEGIN    DS    0H                                                Y02072 04538002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 04540000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   04560000
         L     RCORE,4(RWTGC)           GET WRK AREA ADDRESS            04580000
         L     RDEB,DCBDEBAD            GET DEB ADDR             Y02072 04610002
         USING DEBBASIC,RDEB                                     Y02072 04612002
*                                                                       04614002
* ISSUE IECRES MACRO TO GET USERS COPY OF THE DCB REFRESHED      Y02072 04616002
*                                                                       04618002
         USING WTG,RWTG                                          Y02072 04618402
         IECRES  INIT,DCBCOPY=FRWKAR,STM=(R0,R14,WTGPREFX)       Y02072 04618802
         DROP  RWTG                                              Y02072 04619202
         MVC   DEBDCBB,DXUDCBAD+1       USERS DCB ADDR TO DEB    Y02072 04619602
*                                                                       04619702
* DELETE THE MESSAGE CSECT (IGGMSG01) IF IT HAS BEEN LOADED      Y02072 04619802
*                                                                       04619902
         L     RWK1,DXMSGADR            NO, GET MSG CSECT ADDR   Y02072 04630602
         LTR   RWK1,RWK1                WAS MSG CSECT LOADED     Y02072 04632602
         BZ    SOP70                    NO, DON'T DELETE         Y02072 04633002
         DELETE  EPLOC=MSGCSECT         YES, DELETE MSG CSECT    Y02072 04633102
         SR    RWK2,RWK2                PREPARE TO ZERO FIELD    Y02072 04634602
         ST    RWK2,DXMSGADR            INDICATE MSG CSECT HAS   Y02072 04636602
*                                         BEEN DELETED           Y02072 04638602
SOP70    EQU   *                                                 Y02072 04638702
         TM    JFCBMSK4,JFCBDUMY        DUMMY DATA SET           Y02072 04639302
         BO    SOPSTOP3                 YES, RETURN TO COM OPEN  Y02072 04639402
         TM    DCBMACF1,DCBMRECP        EXCP BEING USED          Y02072 04640002
         BO    SOPSTOP3                 YES, RETURN TO COM OPEN  Y02072 04641502
         SR    RWK1,RWK1                PREPARE REGISTER         YM4697 04641902
*                                                                       04643002
*  MUST CLEAR AUDIT TRAIL TO KEEP FORCE CLOSE EXECUTOR FROM      YM4697 04645002
*  TRYING TO FREEMAIN AN AREA NOT YET GETMAINED (AREA FOR QSAM   YM4697 04647002
*  BUFFER PRIMING)                                               YM4697 04649002
*                                                                       04651002
         ST    RWK1,DXATEXC2            CLEAR IN CASE FORCE      YM4697 04654002
*                                         EXECUTOR GET CONTROL   YM4697 04655502
         OI    FCAOPEN,FCAOCOPY         INDICATE TO FORCE CLOSE  Y02072 04657002
*                                         EXEC TO USE NORMAL     Y02072 04658502
*                                         CLOSE EXECUTORS        Y02072 04660002
         EJECT                                                          04660402
*                                                                       04661502
* SET THE TYPE OF RELEATED REQUEST (RR) FOR NORMAL SCHEDULING    Y02072 04663502
* DATA SETS WITH MORE THAN 1 IOB. THE TYPE OF RR SETTING DEFINES Y02072 04665502
* THE TIME IN THE PROCESSING OF THE CURRENT REQUEST THAT IOS CAN Y02072 04665902
* START THE NEXT RR. THIS IS CONTROLLED BY THE PROCESSING REQD   Y02072 04667302
* TO PREPARE THE NEXT RR FOR I/O INITIATION. (IE, IF CHAN END    Y02072 04669302
* APPENDAGE UPDATES THE NEXT IOB AFTER COMPLETION OF THE CURRENT Y02072 04669702
* IOB, I/O CANNOT BE STARTED FOR THE NEXT REQUEST UNTIL IOS HAS  Y02072 04670102
* RECEIVED CONTROL BACK FROM THE CHAN END APPENDAGE).            Y02072 04670502
* THE FOLLOWING MATRIX SHOWS THE TYPES OF RELATED REQUESTS.      Y02072 04670902
*                                                                       04671002
*                                _______________________________ Y02072 04671102
*                                | TYPE I | TYPE II | TYPE III | Y02072 04671202
* _______________________________|________|_________|__________| Y02072 04671302
* |ERP PROCESSING REQD           |        |    X    |          | Y02072 04671402
* |______________________________|________|_________|__________| Y02072 04671502
* |CE APPEND PROCESSING REQD     |        |    X    |          | Y02072 04671802
* |______________________________|________|_________|__________| Y02072 04671902
* |CE INTERRUPT REQD             |        |         |     X    | Y02072 04672002
* |______________________________|________|_________|__________| Y02072 04672102
* |SIO APPEND PROCESSING REQD    |   X    |         |          | Y02072 04672302
* |______________________________|________|_________|__________| Y02072 04672402
* |EOE APPEND PROCESSING REQD    |   X    |         |          | Y02072 04672702
* |______________________________|________|_________|__________| Y02072 04672802
*                                                                       04672902
*  NOTE: THE ONLY EXCEPTION TO THE ABOVE MATRIX IS FOR MAG TAPE. Y02072 04673002
*        UNIT EXCEPTION IS PRESENTED FROM TRYING TO WRITE OVER   Y02072 04673402
*        THE REFLECTIVE MARKER OR READING A TAPE MARK. TO KEEP   Y02072 04673802
*        IOS FROM STARTING THE NEXT RR IT IS NECESSARY FOR THE   Y02072 04674202
*        ERP TO MARK THIS IN PERMANENT ERROR. SINCE ERP PROCESS- Y02072 04674602
*        ING IS AFTER CE PROCESSING (AND SAM OUTPUT DATA SETS,   Y02072 04675202
*        SAM TAPE INPUT DATA SETS DO NOT HAVE CE APPENDAGES),    Y02072 04675602
*        THE TYPE MUST BE II.                                    Y02072 04676002
*                                                                       04676402
         L     RDCB,DXUDCBAD            USERS DCB ADDR           Y02072 04676802
         MODESET  KEYADDR=DXUKEY,WORKREG=15                      Y02072 04677202
*                                                                       04677602
* TEST FOR CHAINED SCHEDULING. ONLY ONE IOB (MIOB) SO REQUEST    Y02072 04678002
* IS UNRELATED.                                                  Y02072 04678902
*                                                                       04679702
         TM    DCBCIND2,DCBCNCHS        CHAIN SCHED BEING USED   Y02072 04681102
         BZ    SOP72                    NO, TEST FOR 1 IOB       Y02072 04682502
         L     RIOB,DCBIOBAD            GET MIOB ADDRESS         Y02072 04682602
         USING IOBQSAMC,RIOB                                     Y02072 04682902
         OI    IOBFLAG1,IOBUNREL        SET UNRELATED REQ FLAG   Y02072 04683302
         DROP  RIOB                                              Y02072 04683702
         L     RIOB,DCBIOBA             GET ICB ADDRESS          Y02072 04683802
         B     SOP88                    BYPASS RR SETTING        Y02072 04683902
*                                                                       04684002
* FOR NORMAL SCHEDULING, CHECK FOR MORE THAN 1 IOB. REQUEST IS   Y02072 04684402
* UNRELATED IF ONLY ONE.                                         Y02072 04684602
*                                                                       04685302
SOP72    EQU   *                                                 Y02072 04685502
         L     RIOB,DCBIOBA             GET FIRST IOB ADDR       YM5778 04685902
         USING IOBQSAMN,RIOB                                     Y02072 04686002
         IC    RWK1,DCBBUFNO            GET NO OF IOB'S (QSAM)   Y02072 04686102
         TM    DCBCIND2,DCBCNQSM        IS THIS QSAM             Y02072 04686202
         BO    SOP75                    YES, USE BUFNO           Y02072 04686302
         IC    RWK1,DCBNCP              USE NCP FOR BSAM         Y02072 04686402
SOP75    EQU   *                                                 Y02072 04686802
         CH    RWK1,ONEBUFER            USING ONLY ONE IOB       Y02072 04686902
         BNH   SOP88                    YES, BYPASS RR SETTING   YM6506 04687302
*                                                                       04692302
* MUST COMPARE ADDRESS IN USERS APPENDAGE VECTOR TABLE AGAINST   Y02072 04693702
* ADDRESSES IN IOS'S AVT TO SEE IF AN APPENDAGE HAS BEEN LOADED. Y02072 04695102
*                                                                       04696502
         L     RWK2,CVTPTR              GET THE CVT ADDR         Y02072 04697902
         USING CVTMAP,RWK2                                       Y02072 04699302
         L     RWK2,CVTXAPG             IOS'S APPENDAGE VECT TAB Y02072 04700702
         DROP  RWK2                                              Y02072 04702102
         USING IOSAPTAB,RWK2                                     Y02072 04703502
         L     RWK3,DEBAPPAD            GET USERS APP VCT TAB    Y02072 04727502
         DROP  RDEB                                              Y02072 04729002
         USING DEBAVT,RWK3                                       Y02072 04730502
         CLC   DEBSIOA,IOSAPPND         SIO APPEND LOADED        Y02072 04733502
         BNE   SOP88                    YES, DO NOT SET FLAGS    Y02072 04735002
*                                         IN IOB FOR TYPE I REQ  Y02072 04736502
*                                         (DEFAULT IS BITS OFF)  Y02072 04736602
         CLC   DEBEOEA,IOSAPPND         EOE APPEND LOADED        Y02072 04736902
         BNE   SOP88                    YES, DO NOT SET FLAGS    Y02072 04737302
         CLC   DEBCEA,IOSAPPND          WAS A CE APP LOADED      Y02072 04738002
         BNE   SOP82                    YES, GO TO SET TYPE II   Y02072 04739502
         TM    DCBDEVT,TAPE             IS THIS MAG TAPE         Y02072 04739902
         BO    SOP82                    YES, GO SET TYPE II      Y02072 04740302
SOP81    OI    IOBFLAG2,IOBRRT3         NO, MUST BE TYPE III REQ Y02072 04741002
         L     RIOB,IOBNIOBA            GET NEXT IOB             Y02072 04742502
         BCT   RWK1,SOP81               GO TO SET IN NEXT IOB    Y02072 04744002
*                                         IF MORE                Y02072 04745502
         B     SOP88                    COMPLETED SETTNG REL REQ Y02072 04747002
SOP82    OI    IOBFLAG2,IOBRRT2         SET TYPE II REL REQ      Y02072 04748502
         L     RIOB,IOBNIOBA            GET NEXT IOB             Y02072 04750002
         BCT   RWK1,SOP82               GO TO SET IN NEXT IOB    Y02072 04751502
*                                         IF MORE                Y02072 04753002
*                                                                       04754502
* EXIT THIS MODULE IF NOT USING QSAM.                            Y02072 04756002
*                                                                       04757502
SOP88    TM    DCBCIND2,DCBCNQSM        QSAM BEING USED          Y02072 04759002
         BZ    SOPSTOP2                 NO, RETURN TO COM OPEN   Y02072 04760502
         L     RIOB,DCBIOBA             GET IOB                  Y02072 04762002
         DROP  RWK2                                              Y02072 04763502
         DROP  RWK3                                              Y02072 04765002
         DROP  RIOB                                              Y02072 04766502
         EJECT                                                          04766902
         LR    RTIOT,RIOB               SAVE FOR WORK REGISTER          04768002
*                                                                       04769502
         XC    DCBEOBAD(8),DCBEOBAD     FORCE END OF BUFFER CONDITION   04771002
*                                                                       04772502
         SR    RB,RB                                                    04774002
         TM    DCBDEVT,X'20'            DCB USING A D.A. DEVICE         04775502
         BC    1,SOP901                 YES BRANCH                      04777002
*                                                                       04778502
         TM    DCBDEVT,X'40'            DCB USING U.R. DEVICE           04780000
         BO    SOP9X                    YES BRANCH                      04800000
*                                                                       04820000
         TM    DCBCIND1,X'01'           IS EXCHANGE BUFFERING USED      04840000
         BO    SOP901                   YES. BRANCH                     04860000
*                                                                       04880000
**********************************************************************  04900000
*        THIS SECTION WILL SET THE READ OR WRITE CCW'S UP WITH THE      04920000
*        BUFFER ADDRESS AND THE BLOCK SIZE FOR TAPE OR UNIT             04940000
*        RECORD EQUIPMENT                                               04960000
**********************************************************************  04980000
*                                                                       05000000
SOP9X    EQU   *                                                        05020000
         IC    RB,DCBBUFNO              GET NO. OF BUFFERS TO PRIME     05040000
         LR    RDEB,RB                  COPY BUFFER NUMBER              05060000
         LR    RD,RTIOT                 SAVE ADDRESS OF FIRST IOB/ICB   05080000
SOP900A  EQU   *                                                        05100000
*                                                                       05120000
         LA    RTIOT,32(RTIOT)          POINT TO CCW  ASSUME PCI        05140000
         TM    DCBCIND2,X'04'           PCI SCHEDULING USED             05160000
         BC    1,SOP900B                YES, BRANCH                     05180000
         LA    RTIOT,8(RTIOT)           ADJUST FOR NORMAL SCHEDULING    05200000
         TM    DCBMACRF,CNTRLB          CNTRL MACRO USED FOR INPUT      05220000
         BC    14,SOP900B               NO BRANCH                       05240000
         TM    DCBDEVT,X'40'        DCB USING U.R. DEVICE               05260000
         BC    14,SOP900B          NO BRANCH                            05280000
         LA    RTIOT,8(RTIOT)           ADJUST CHANNEL PROGRAM ADDRESS  05300000
*                                                                       05320000
SOP900B  EQU   *                                                        05340000
*                                                                       05360000
         L     RWK1,DCBBUFCB            ADDR OF BUF CNTRL BLK    YM7595 05360102
         USING BCBLK,RWK1                                               05360202
         L     RBUFADR,BCBBUFPT         ADDR OF NEXT AVAIL BUF   YM7595 05360302
         LTR   RBUFADR,RBUFADR          VALID BUFFER ADDRESS     YM7595 05360402
         BE    BUFERR                   NO, BRANCH TO ABEND       16059 05412002
         USING BUFFER,RBUFADR                                           05412502
         MVC   BCBBUFAD,BUFNXPTB        UPDATE TO NEXT AVAIL BUF YM7595 05412602
         USING CCW,RTIOT                                                05412702
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 05412802
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 05412902
         DROP  RWK1,RBUFADR,RTIOT                                       05413002
         L     RTIOT,0(RD)              GET THE NEXT IOB TO INITIALIZE  05500000
         LR    RD,RTIOT                 UPDATE IOB POINTER              05520000
         BCT   RB,SOP900A               IF MORE IOBS/ICBS CONTINUE.     05540002
         SPACE                                                          05540102
         MODESET  EXTKEY=DATAMGT                                        05540202
         SPACE                                                          05540302
         OI    FCAOPEN2,FCAOIOBC        INDIC BUFFERS CAN BE     YM7595 05540402
*                                         RETURNED TO BUF POOL   YM7595 05540502
         SPACE                                                          05540602
         MODESET  KEYADDR=DXUKEY,WORKREG=1                              05540702
         SPACE                                                          05540802
*                                                                       05560000
SOP901   EQU   *                                                        05580000
*                                                                       05600000
*                                                                       05620000
*                                                                       05640000
SOP902   EQU   *                                                        05660000
*                                                                       05680000
         TM    0(RPARC),OUTP            FILE FOR OUTPUT ONLY            05700000
         BC    14,SOP908                NO BRANCH                       05720000
*                                                                       05740000
         OI    DCBIOBA,X'42'           TURN ON OUTPUT BIT               05760000
         IC    RB,DCBOFFSW              GET WRITE CCW OFFSET            05780000
         TM    DCBCIND1,X'01'           EXCHANGE BUFFERING USED         05800000
         BC    8,SOP903                 NO BRANCH                       05820000
*                                                                       05840000
         LA    RD,0(RB,RIOB)            POINT TO WRITE CCW              05860002
         LH    RC,DCBEROPT+4            GET BLKNG FACTOR                05880000
         SLL   RC,3                     MULT. BY '8'                    05900000
         AR    RC,RD                    POINT TO LAST WRT CCW           05920000
         ST    RC,DCBLCCW               SET TO LAST CCW         XA02987 05930002
         ST    RC,DCBCCCW               FORCE END OF BLOCK COND XA02987 05940002
         B     SOP905                                                   05960000
*                                                                       05980000
SOP903   EQU   *                                                        06000000
*                                                                       06020000
         AR    RB,RIOB                  GET TO WRITE CCW                06040002
         L     RB,0(RB)                 GET BUFFER ADDRESS FROM CCW     06060000
         LA    RB,0(RB)                HI BYTE CLEARED                  06080000
*                                                                       06100000
         LH    RC,DCBBLKSI              GET BLOCK SIZE                  06120000
         AR    RC,RB                   CCOMPUTE EOB ADDRESS             06140000
         ST    RC,DCBEOBAD              STORE AS EOB ADDRESS            06160000
*                                                                       06180000
         TM    DCBRECFM,FORMATU         U RECORDS USED           A41465 06182021
         BC    1,SOP904                 YES, BRANCH              A41465 06182421
         TM    DCBDEVT,TAPE             TAPE DEVICE              S20038 06183020
         BZ    SOP90300                 NO, BRANCH               S20038 06186020
         TM    DCBRECFM,FORMATD         D FORMAT RECORDS         S20038 06189020
         BO    SOP903A                  YES, BRANCH              S20038 06192020
SOP90300 EQU   *                                                 S20038 06195020
*                                                                       06240000
         TM    DCBRECFM,FORMATV         V RECS USED                     06260000
         BC    8,SOP904                 NO BRANCH                       06280000
*                                                                       06300000
SOP903A  EQU   *                                                 S20038 06310020
         XC    0(8,RB),0(RB)            ZERO SMALL AND LARGE LL FIELDS  06320000
         MVI   1(RB),X'04'             INIT LARGE LL TO FOUR            06340000
         LA    RB,4(RB)                                                 06360000
         L     RC,DCBBUFCB              GET BUFCB ADDRESS        S19015 06361019
         LA    RC,DISPSN(RC)            CLEAR HI ORDER BYTE      S19015 06362019
         TM    FLGOFFST(RC),RAFLAG      RECORD AREA PRESENT      S19015 06363019
         BNO   SOP904                   NO,GOTO STORE RECAD      S19015 06364019
         TM    DCBRECFM,SPANNED         TEST IF SPANNED RECORD   S19015 06365019
*                                            FORMAT                     06366019
         BNO   SOP904                   NO,GOTO STORE RECAD      S19015 06367019
*                                                                       06368019
         O     RB,PRIME                 SET INDICATOR FOR 1ST    S19015 06369019
*                                       ENTRY                    S19015 06370019
*                                                                       06380000
SOP904   EQU   *                                                        06400000
         ST    RB,DCBRECAD             STORE FIRST RECORD ADDRESS       06420000
*                                                                       06440000
SOP905   EQU   *                                                        06460000
*                                                                       06480000
*********************************************************************** 06500000
*                                                                       06520000
*   SET UP FOR PUNCH RETRY OPTION 3 OR MORE BUFFERS                     06540000
*                                                                       06560000
*********************************************************************** 06580000
*                                                                       06600000
         CLI   DCBDEVT,X'45'            DEVICE A 2520?           A36344 06606020
         BE    SOP9051                                           A36344 06612020
         CLI   DCBDEVT,X'42'            THIS FOR THE 2540 PUNCH         06620000
         BC    7,SOPSTOP1               NO, BRANCH                      06640002
SOP9051  EQU   *                                                 A36344 06643020
         OI    DCBCIND1,UNUSED          SET BIT TO SHOW DCB NOT   OC022 06646000
*                                       YET USED                  OC022 06652000
         CLI   DCBBUFNO,X'03'           3 IOBS OR MORE                  06660000
         BC    4,SOPSTOP1               NO,BRAMCH                       06680000
         TM    DCBOPTCD,PCI             PCI SCHEDULING USED             06700000
         BC    1,SOPSTOP1               YES BRANCH                      06720000
*                                                                       06740000
         SR    RF,RF                                               9656 06780015
         IC    RF,DCBBUFNO             BUFNO = NUMBER OF IOB'S.    9656 06820015
         LR    RC,RIOB                  COPY FIRST IOB ADDRESS          06860002
         L     RIOB,0(RIOB)             GET TO NEXT IOB                 06920002
         L     RIOB,0(RIOB)            LINK TO NEXT IOB.           9656 06940002
*                                                                       06960000
*                                                                       06980000
SOP9063  EQU   *                                                        07000000
*                                                                       07020000
         LA    RD,4(RC)                 GET IOBS ECB ADDRESS            07040000
         ST    RD,12(RIOB)              STORE ECB ADDRESS IN CURR IOB   07060002
         OI    9(RIOB),X'01'            SET PUNCH RETRY FLG FOR IOS     07080002
         L     RIOB,0(RIOB)             UPDATE CURR IOB POINTER         07100002
         L     RC,0(RC)                 UPDATE TO CURR ECB ADDRESS      07120000
         BCT   RF,SOP9063               PROCESS ALL IOBS                07140000
         B     SOPSTOP1                 YES                             07160000
*                                                                       07180000
SOP908   EQU   *                                                        07200000
*                                                                       07220000
         TM    DCBRECFM,DCBRECV+DCBRECSB DATA SET VARIABLE SPAN ZA01361 07230003
         BNO   NOTVS                    NO, THEN BRANCH         ZA01361 07232003
         XC    DCBPRECL(1),DCBPRECL     ZERO BYTE FOR FIRST PASSZA01361 07234003
*                                       THROUGH GET PROCESSING  ZA01361 07236003
NOTVS    EQU   *                                                ZA01361 07238003
         TM    0(RPARC),X'03'           DCB FOR BACKWARDS INPUT         07240000
         BC    9,SOP909                 NO BRANCH                       07260000
*                                                                       07280000
*                                                                       07300000
         OI    DCBOFLGS,X'40'  SET BIT ON BEFORE PRIME BUFFERS    0279  07310013
         LR    RB,RIOB                  COPY IOB ADDRESS                07320002
         LA    RC,1                     GET A CONSTANT OF ONE           07340000
         LNR   RC,RC                    NEGATE ONE                      07360000
*                                                                       07380000
SOP908A  EQU   *                                                 A30962 07388020
         TM    DCBCIND2,X'04'  CHAIN SCHEDULING SUPPORTED        A30962 07396020
         BC    8,SOP908B  NO - BRANCH                            A30962 07404020
         STH   RC,X'1C'(RB)  STORE AS INCREMENT COUNT - ICB      A30962 07412020
         BC    15,SOP908C                                        A30962 07420020
SOP908B  EQU   *                                                 A30962 07428020
         STH   RC,X'24'(RB)  STORE AS INCREMENT COUNT - IOB      A30962 07436020
SOP908C  EQU   *                                                 A30962 07444020
         LR    RF,RB                    COPY IOB ADDRESS                07460000
         SR    RE,RE                                                    07480000
         IC    RE,DCBOFFSR              GET READ CCW OFFSET             07500000
         ALR   RF,RE                    POINT TO READ CCW               07520000
         LR    RD,RF                    COPY CCW ADDRESS                07540000
         L     RF,0(RF)                 GET BUFFER ADDRESS FROM CCW     07560000
         AH    RF,DCBBLKSI              ADD BLOCK SIZE TO ADDRESS       07580000
         BCTR  RF,0                     REDUCE ADDRESS BY ONE           07600000
         ST    RF,0(RD)                 RESTORE BUFFR ADDRESS TO CCW    07620000
         MVI   0(RD),X'0C'              READ BACK CMD BYTE              07640000
         L     RB,0(RB)                 GET NEXT IOB                    07660000
         BCT   RDEB,SOP908A             BRANCH IF MORE IOB/ICB'S        07680000
*                                                                       07700000
SOP909   EQU   *                                                        07720000
*                                                                       07740000
         TM    DCBCIND2,X'04'           PCI SCHEDULING USED             07760000
         BC    8,SOPPRIME               NO BRANCH                       07780000
*                                                                       07800000
*      THIS SECTION WILL INITIALIZE THE ICBS FOR PRIMING                07820000
*                                                                       07840000
*                                                                       07860000
         SR    RB,RB                                                    07880000
         IC    RB,DCBBUFNO              GET NUMBER OF BUFFERS           07900000
         LR    RTIOT,RB                 COPY NUMBER OF BUFFERS          07920000
         BCTR  RTIOT,0                  SUBTRACT 1 FROM BUFNO FOR LOOP  07940002
         L     RD,DCBIOBAD              GET MAIN IOB ADDRESS            07960000
         L     RC,0(RIOB)               GET SECOND ICB                  07980002
         MVC   9(3,RD),1(RIOB)          PUT 2ND ICB IN AS '1ST IOB'     08000002
         LA    RC,32(RC)                ADD BASIC ICB SIZE              08020000
         TM    DCBDEVT,DABIT            DCB USING DA DEVICE             08040000
         BC    8,SOP90900               NO  BRANCH                      08060000
*                                                                       08080000
         LA    RC,8(RC)                 ADD '8' TO SKIP MBB---R FLD     08100000
         TM    JFCBFLG2,JFCNRPS         ANY DEVICES NON-RPS      YM4635 08102002
         BO    NOTRRA                   YES, BRANCH              YM4635 08104002
         ST    RC,B80(RD)               PUT ICB CHP ADDR IN RCD  S20201 08106020
*                                       READY TIC                       08108020
         MVI   B80(RD),TIC              RESTORE TIC CMND         S20201 08110020
         B     SOP90901                 GO AROUND NEXT           S20201 08112020
NOTRRA   EQU   *                                                 S20201 08114020
         ST    RC,72(RD)                STORE CP STARTAD IN MIOBS TIC   08120000
         MVI   72(RD),TIC               RESTORE TIC CMD BYTE            08140000
         B     SOP90901                                                 08160000
*                                                                       08180000
SOP90900 EQU   *                                                        08200000
*                                                                       08220000
         ST    RC,32(RD)                STORE CP STARTAD IN M-IOB SLOT  08240000
*                                                                       08260000
SOP90901 EQU   *                                                        08280000
         L     RIOB,0(RIOB)             LINK TO NEXT ICB                08300002
         MVI   4(RIOB),X'00'                                            08320002
         IC    RB,2(RD)                 PICK UP INPUT NOP OFFSET        08340000
         LA    RC,0(RB,RIOB)            POINT TO NOP CCW                08360002
         TM    JFCBFLG2,JFCNRPS         ANY DEVICES NON-RPS      YM4635 08362002
         BO    NOTRRE                   YES, BRANCH              YM4635 08364002
         MVC   B1(B3,RC),B5(RC)         MOVE ADDR FROM RH OF     S20201 08366020
*                                       TIC/NOP OF RCD READY            08368020
*                                                                       08370020
NOTRRE   EQU   *                                                 S20201 08372020
*                                                                       08374020
         MVI   0(RC),TIC                STORE TIC CMD BYTE              08380000
*                                                                       08400000
         BCT   RTIOT,SOP90901           IF MORE ICBS RELOOP             08420000
*                                                                       08440000
         TM    DCBMACRF,X'15'          USING DATA, MOVE, OR      M1557? 08450020
*                                       SUBST MODE               M1557  08460020
         BC    5,SOP90903              YES,  BRANCH AROUND       M1557  08470020
*                                       LOCATE                   M1557  08480020
         MVI   0(RC),NOP                RESTORE NOP CMD IN LAST ICB     08500000
         ST    RC,12(RD)                STORE LAST NOP ADDR IN MAINIOB  08520000
*                                                                       08525020
         TM    JFCBFLG2,JFCNRPS         ANY DEVICES NON-RPS      YM4635 08535002
         BO    NOTRRG                   YES, BRANCH              YM4635 08537002
         LA    RB,B8(RC)                GET RD SECTOR CCW ADDR   S20201 08540020
         ST    RB,B0(RC)                PUT IN NOP/TIC CCW       S20201 08545020
         MVI   B0(RC),NOPTIC            PUT IN TIC CMND          S20201 08550020
NOTRRG   EQU   *                                                 S20201 08555020
         B     SOP90902                                                 08560000
SOP90903   EQU  *                                                       08580000
         L     RIOB,0(RIOB)                                             08600002
         MVI   4(RIOB),X'00'                                            08620002
**********************************************************************  08640000
*                                                                       08660000
*      PRIME ICBS BY SCHEDULING THE MAIN IOB FOR EXECUTION              08680000
*                                                                       08700000
**********************************************************************  08720000
*                                                                       08740000
SOP90902 EQU   *                                                        08760000
*                                                                       08780000
**********************************************************************  08800000
         MVI   12(RD),0                 CLEAR EXCP NEEDED FLAG @Z30TSMI 08810003
         EXCP  16(RD)                                                   08820000
**********************************************************************  08840000
*                                                                       08860000
         B     SOPSTOP1                 GO TO XCTL               Y02072 08880002
SOPPRIME EQU   *                                                        08980000
         SR    RB,RB                    CLEAR REG                       09000000
         IC    RB,DCBBUFNO              NO. OF IOBS TO PRIME            09020000
*                                                                       09040000
         TM    DCBMACRF,X'15'           USING DATA, MOVE, OR      M1557 09050002
*                                         SUBST MODE              M1557 09060002
         BC    5,SOP90A                 YES BRANCH                      09080000
*                                                                       09100000
         BCTR  RB,0                     REDUCE BY ONE                   09120000
         LTR   RB,RB                    MORE THAN 1 IOB                 09140000
         BZ    SOPSTOP1                 NO BRANCH                Y02072 09160002
*                                                                       09180000
SOP90A   EQU   *                                                        09200000
*                                                                       09250002
* MUST ISSUE A GETMAIN FOR A REG SAVE AREA FOR EOB ROUTINE       Y02072 09252002
* IN USER KEY TO PREVENT PGM CHECKS. IF THE LENGTH FOR THIS      YM4697 09254002
* GETMAIN IS CHANGED, THE FREEMIAN IN IGG020T1 (SAM/PAM/DAM      YM4697 09254402
* FORCE CLOSE EXECUTOR) MUST ALSO BE CHANGED.                    YM4697 09254802
*                                                                       09256002
         GETMAIN  R,LV=SAVELG,SP=230  ISSUE GETMAIN              Y02072 09258002
*                                                                       09260000
         SPACE                                                          09262002
         MODESET  EXTKEY=DATAMGT        KEY OF AUDIT TRAIL       YM4697 09264002
         SPACE                                                          09266002
         ST    R1,DXATEXC2              SAVE ADDR IN CASE FORCE  YM4697 09268002
*                                         CLO EXEC MUST FREEMAIN YM4697 09268402
         SPACE                                                          09268802
         MODESET  KEYADDR=DXUKEY,WORKREG=13  RESUME USER KEY     YM4697 09269202
         SPACE                                                          09269602
         LR    RSAVE,R1                 PREPARE FOR EOB ROUTINE  Y02072 09270002
         L     RIOB,0(RIOB)             GET NEXT IOB                    09280002
*                                                                       09284021
* THIS ROUTINE TESTS THE CALLING RB TO DETERMINE WHETHER TO BALR        09296002
* (IF KEY <8) OR SYNCH (IF KEY >7) TO EOB ROUTINE. OPENS         Y02072 09300002
* REGISTERS 2-12 ARE SAVED IN THE EXTENDED SVRB SAVEAREA.        Y02072 09302002
*                                                                       09320021
SOP92    EQU   *                                                 M0474  09324021
         ST    RIOB,DCBIOBA             ST IOB PTR IN DCB        M0474  09328002
         USING PSA,0                                             Y02072 09346002
         L     RWK3,PSATOLD             GET CURRENT TCB ADDR     Y02072 09346402
         DROP  0                                                 Y02072 09346802
         USING TCB,RWK3                                          Y02072 09347202
         L     RWK3,TCBRBP              NEED RB ADDR FOR SAVE    Y02072 09347602
*                                         AREA                   Y02072 09349702
         DROP  RWK3                                              Y02072 09352802
         USING RBSECT,RD                                         M0474  09354902
         SPACE 2                                                        09357002
         MODESET  EXTKEY=SUPR           KEY 0 TO STORE IN RB     Y02072 09359102
         SPACE 2                                                        09361202
         STM   RDCB,RB,RBEXSAVE+B4      SAVE OPEN REG 2-12 IN    M0474  09363302
*                                       SVRB+4                   M0474  09365402
*                                       THE 1ST WORD OF SAVEAREA IS     09367502
*                                       PARAMETER LIST IF CONCATENA-    09369602
*                                       TION OF UNLIKE ATTRIBUTES       09371702
         SPACE 2                                                        09373802
         MODESET  KEYADDR=DXUKEY,WORKREG=7  BACK TO USER KEY     Y02072 09375902
         SPACE 2                                                        09378002
         SR   RPARC,RPARC               ZERO R7                  M1630  09380102
         IC   RPARC,DCBOFFSR            INSERT CP OFFSET IN REG  M1630  09382202
*                                         FOR EOB                M1630  09384302
         TM    DXUKEY,KEYMASK           IS RB IN USER KEY        Y02072 09391202
         BO    PRB                      IF YES, BRANCH TO SYNCH  Y02072 09396002
         L     RJ,DCBEOB                LOAD PTR TO EOB MODULE   M0474  09408021
         LR    RBASE,RIOB               SET UP IOB PTR IN R3 FOR M0474  09412002
*                                       EOB                      M0474  09416021
         BALR  RD,RJ                    BR TO EOB                M0474  09420021
         USING *,RD                                              Y02072 09430002
         B     LOADREG                  BR TO LOAD ALL REGISTERS M1812  09439021
         DROP  RD                                                Y02072 09441002
         USING SOP90,RBASE                                       Y02072 09443002
PRB      EQU   *                                                 M0474  09444021
         L     RDCB,DXPDCBAD            USE PROTECTD COPY OF THE Y02072 09454002
*                                         DCB FOR FOLLOWING INST Y02072 09464002
         L     RJ,DCBEOB                LOAD EOB ADDRESS         M0474  09472021
         L     RDCB,DXUDCBAD            GET USERS COPY AGAIN     Y02072 09474002
         LR    RBASE,RIOB               PUT IOB IN R3 FOR EOB    M0474  09476002
         SYNCH (RJ)                     SYNCH TO EOB             M0474  09480021
         USING PSA,0                                             Y02072 09530002
LOADREG  L     RWK3,PSATOLD             GET CURRENT TCB ADDR     Y02072 09540002
         DROP  0                                                 Y02072 09550002
         USING TCB,RWK3                                          Y02072 09550402
         L     RWK3,TCBRBP              GET PTR TO SVRB          Y02072 09550802
         DROP  RWK3                                              Y02072 09551202
         USING RBSECT,RWK3                                       Y02072 09554002
         LM    RDCB,RB,RBEXSAVE+B4      RESTORE OPEN REGISTERS   M0474  09556021
*                                       2-12                     M0474  09560021
         DROP  RD                                                M0474  09564021
         L     RIOB,0(RIOB)             GET NEXT IOB                    09620002
         BCT   RB,SOP92                 MORE TO PRIME  BRANCH           09640000
*                                                                       09660000
         LR    R1,RSAVE                 BEGINNING ADDR TO FREE   Y02072 09670002
*                                                                       09680000
         FREEMAIN  R,A=(1),SP=230,LV=SAVELG  FREEMAIN SAVEAREA   Y02072 09690002
         SPACE                                                          09692002
         MODESET  EXTKEY=DATAMGT        KEY OF AUDIT TRAIL       YM4697 09694002
         SPACE                                                          09696002
         SR    RWK3,RWK3                PREPARE REGISTER         YM4697 09698002
         ST    RWK3,DXATEXC2            TO KEEP FORCE CLOSE EXEC YM4697 09698402
*                                         FROM TRYING TO FREE    YM4697 09698802
*                                         AN AREA ALREADY FREED  YM4697 09699202
         SPACE                                                          09699602
         MODESET  KEYADDR=DXUKEY,WORKREG=14  RESUME USER KEY     YM4697 09699702
         SPACE                                                          09699802
*                                                                       09700000
         ST    RTIOT,DCBIOBA           RESET DCB TO ORIGINAL IOB.       09720000
*                                      NEXT FUNCTION                    09740000
SOPSTOP1 EQU   *                                                        09780000
         NI    DCBIOBA,X'FE'            TURN OFF FIRST IOB BIT.         09800000
*                                                                       09820000
SOPSTOP2 EQU   *                        COME HERE TO MODESET     Y02072 09830002
         MODESET  EXTKEY=DATAMGT        DATA MGT KEY TO XCTL     Y02072 09832002
SOPSTOP3 EQU   *                        COME HERE IF IN KEY 5    Y02072 09834002
         MVI   0(RWTGC),X'00'           CLEAR WTG ENTRY                 09840000
*                                                                       09900000
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        09920000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     09940000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            09960000
         BCR   8,RBASE                                                  09980000
*                                                                       10000000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    10020000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             10040000
*                                                                       10060000
         LR    RPARC,RPAR                                               10080000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       10100000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           10120000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         10140000
*                                                                       10160000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  10180000
         LA    RPARC,PLOFF(0,RPARC)                                     10200000
         BC    15,ZCHEK                                                 10220000
*                                                                       10240000
*                                                                 16059 10242016
BUFERR   EQU   *                                                  16059 10244016
         SPACE                                                          10246002
         MODESET  EXTKEY=DATAMGT        KEY OF OPEN WORKAREA     YM5940 10248002
         SPACE                                                          10248402
         DMABCOND OABD066,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X10250021
                                        CALL PROBLEM DETERMINATION      10254021
TCTLRTN  EQU   *                                                        10260000
         USING WTG,RWTG                                                 10310003
         USING WTGENTRY,RWTGC                                           10320003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*10360003
               MODID=WTGENTRY                                  @Z30TSCF 10370003
         DROP  RWTG,RWTGC                                      @Z30TSCF 10380003
**                                                                      10400000
*                                                                       10420000
WAOFF    EQU   32                                                       10440000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           10460000
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           10480000
         DS    0F                       FULL WORD ALIGNMENT      S19015 10486019
PRIME    DC    X'40000000'              1ST ENTRY INDICATOR      S19015 10492019
OPIDCNST DC    C'0S'                                                    10500000
AMIDCNST DC    C'11'                                                    10520000
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION  @Z30TSCF 10570003
MSGCSECT DC    CL8'IGGMSG01'            NAME OF MSG CSECT        Y02072 10620002
ONEBUFER DC    H'1'                     FOR TESTING FOR ONE BUF  Y02072 10670002
PATCH    DC    0H'0',54X'00'            PATCH AREA               Y02072 10720002
END      EQU   *                        END OF MODULE            Y02072 10730002
         SPACE 4                                                        10740002
IOSAPTAB DSECT                          FOR IOS'S AVT <- CVT     Y02072 10750002
IOSAPPND DS    F                        FOR ADDRESSABILITY TO    Y02072 10760002
*                                         BRANCH BACK INST       Y02072 10770002
         TITLE 'CHANNEL COMMAND WORK DSECT'                      Y02072 10770102
         IHACCW                                                  Y02072 10770202
         TITLE 'BUFFER CONTROL BLOCK DSECT'                      Y02072 10770402
         IGGBCB  TYPE=SAM                                        Y02072 10770802
         TITLE 'IGG01911 - DCB DSECT'                            Y02072 10772002
         DCBD  DSORG=PS                                          Y02072 10774002
         TITLE 'IGG01911 - FORMAT OF OPEN WORKAREA'              Y02072 10780002
         IECDSECS  (MAIN,(IOB,NO)),WTG,PREFX,EXPAND=YES          Y02072 10830002
FORCORE  DSECT                                                   Y02072 10840002
         ORG   JFCBMASK                                          Y02072 10850002
         DS    4B                       FILLER                   Y02072 10860002
JFCBMSK4 DS    B                        JFCBMASK + 4             Y02072 10870002
JFCBDUMY EQU   X'20'                    INDICATES DD DUMMY       Y02072 10872002
         TITLE 'IGG01911 - FORCE CLOSE AUDIT TRAIL DSECT'               10874002
         IHAFCAUD  ORG=YES                                       Y02072 10876002
         TITLE 'IGG01911 - DEB DSECT'                            Y02072 10880002
         IEZDEB                                                  Y02072 10890002
         TITLE 'IGG01911 - IOB DSECT'                            Y02072 10892002
         IEZIOB                                                  Y02072 10894002
         TITLE 'IGG01911 - PSA DSECT'                            Y02072 10896002
         IHAPSA                                                  Y02072 10898002
         TITLE 'IGG01911 - TCB DSECT'                            Y02072 10898402
         IKJTCB                                                  Y02072 10898802
         TITLE 'IGG01911 - RB DSECT'                             Y02072 10899202
         IHARB                                                   Y02072 10899602
         TITLE 'IGG01911 - CVT DSECT'                            Y02072 10899702
CVT      DSECT                                                   Y02072 10899802
         CVT                                                     Y02072 10899902
         END                                                            10900000
./  ADD  SSI=52840119,NAME=IGG01912
 TITLE 'IGG01912 - SAM PAPER TAPE/UPDATE'                               00007018
*                                                                       00009001
*                                                                       00011001
IGG01912 CSECT                                                     UT18 00014018
*MODULE NAME - IGG01912                                          Y02072 00014402
*                                                                       00014802
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00015202
*                                                                       00015602
*COPYRIGHT - NONE                                                Y02072 00015702
*                                                                       00015802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00015902
*                                                                       00018102
*          VS2 RELEASE 2 DELETIONS                               Y02072 00020602
*000080,000550,010800,057500,057700,057900-057940,081400,082000, Y02072 00022802
*089860-090000,090800,091240,091280,091320,091360,091400-091600, Y02072 00025002
*091756-091762,101000,120210-120558,123400,053570-053599,        Y02072 00027202
*60160,110800-111000,116600,117000-118400,119200                 Y02072 00037202
*                                                                YM1141 00037302
*                                                                YM1140 00047302
*                                                                YM4640 00047402
*                                                                       00049403
*          VS2 RELEASE 3 DELETIONS                                      00051403
*                                                              @Z30TSCF 00053403
*00009341020,9342020                                           @ZA05572 00054403
*          RELEASE 20 DELETIONS                                         00055802
*0930080800,081800                                               A34004 00058002
*0930129000,150800,151400                                        S20201 00060202
*          RELEASE 21 DELETIONS                                         00062402
*0090055600,068200-068400,111200,129000-151800,152400-152600     S21042 00064602
*                                                                       00066802
*STATUS CHANGE LEVEL 007                                                00075602
*                                                                       00077802
*FUNCTION/OPERATION: THIS ROUTINE WILL LOAD MODULES NECESSARY FOR       00080000
*      PROCESSING PAPER TAPE INPUT OR UPDATE AFTER DETERMINING          00100000
*      WHAT THEY ARE.  IT WILL PLACE THE ADDRESS OF THE LOADED          00120000
*      MODULES IN THE APPROPRIATE DCB FIELDS, AND THE ID'S IN THE DEB   00140000
*      IT WILL BRING IN THE APPROPRIATE ERROR ROUTINES.                 00160000
*      IT WILL BRING IN ANY SIO APPENDAGES REQUIRED TO PERFORM SPECIFIC 00200000
*      FUNCTIONS.                                                       00220000
*      THIS MODULE WAS SPLIT IN RELEASE 18 TO INCLUDE USER         UT18 00225018
*      TOTALING SUPPORT.  THE SECOND HALF OF THIS MODULE IS NOW    UT18 00230018
*      IGG01918.                                                   UT18 00235018
*                                                                       00240000
*ENTRY POINTS  ENTERED FROM IGG0191G OR IGG0191P BY USE OF THE XCTL     00260000
*      MACRO                                                            00280000
*                                                                       00300000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS)                        00320000
*                                                                       00340000
*OUTPUT: DCB(USERS),IOB(USERS).                                         00360000
*                                                                       00380000
*EXTERNAL ROUTINES: NONE.                                               00400000
*                                                                       00420000
*EXITS-NORMAL   XCTL TO IGG01918.                                  UT18 00440018
*                                                                       00460000
*EXITS-ERROR: NONE.                                                     00480000
*                                                                       00500000
*TABLES/WORKAREAS - WHERE TO GO TABLE (WTG)                             00520000
*                                                                       00540000
*      BYTE 0-7    NAME                                                 00560000
*      BYTE 8-10   RELATIVE DISK ADDRESS (TTR) OF FIRST RECORD          00580000
*      BYTE 11     CONCATENATION NUMBER                                 00600000
*      BYTE 12     ZERO                                                 00620000
*      BYTE 13     ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.      00640000
*                       ALIAS INDICATOR 1 BIT                           00660000
*                       NUMBER OF TTRS IN USERS DATA FIELD 2 BITS       00680000
*      BYTE 14-16  TTR OF FIRST TEXT RECORD                             00700000
*      BYTE 17     ZERO                                                 00720000
*      BYTE 18-19  TTR OF NOTE LIST OR SCATTER LIST                     00740000
*      BYTE 20     TRANSLATION TABLE                                    00760000
*      BYTE 21     ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST           00780000
*      BYTE 22-23  ATTRIBUTES                                           00800000
*      BYTE 24-26  TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE    00820000
*      BYTE 27-28  LENGTH OF FIRST TEXT RECORD                          00840000
*      BYTE 29     LENGTH OF WTG TABLE (IN DOUBLE WORDS)                00860000
*      BYTE 30-31  PATH THROUGH LOADS OF ROUTINES                       00880000
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       00900000
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        00920000
*      BYTE 40-   TABLE OF IDTTR'S                                      00940000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          00960000
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          00980000
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          01000000
*                   NOT USED                         (3 BYTES)          01020000
*********************************************************************** 01040000
*                                                                       01060000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY    Y02072 01080002
*                                                                       01100000
*NOTES  THIS ROUTINE HAS A LIST OF ALL BSAM, QSAM MODULES SUPPORTED     01120000
*      FOR PAPER TAPE AND UPDATE.                                       01140000
*                                                                       01160000
*********************************************************************** 01180000
*                                                                       01200000
*                                                                       01220000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01240000
*                                                                       01260000
*********************************************************************** 01280000
*                                                                       01300000
RE       EQU   0         WORK REG5                                      01310002
RWK1     EQU   RE        WORK REGISTER                           Y02072 01312002
RF       EQU   1         WORK REG6                                      01314002
R1       EQU   RF        PARM REG                                YM1140 01316002
RDCB     EQU   2         DCB REGISTER                                   01320000
RBASE    EQU   3         BASE REGISTER                                  01340000
RCORE    EQU   4         WORK AREA ADDRESS                              01360000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01380000
RWTG     EQU   6         TOP OF WTG TABLE                               01400000
RPARC    EQU   7         CURRENT PARAMETER                              01420000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01440000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01460000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01480000
RDEB     EQU   11        DEB ADDRESS                                    01500000
RB       EQU   12        WORK REG1  **                                  01520000
RC       EQU   13        WORK REG2  **                                  01540000
RWK2     EQU   RC                       WORK REGISTER            Y02072 01550002
RD       EQU   14        WORK REG3  **                                  01560000
RJ       EQU   15        WORK REG4                                      01580000
*                                                                       01640000
*                                                                       01660000
PARAR    EQU   RPARC                                                    01680000
*                                                                       01700000
*********************************************************************** 01720000
*                                                                       01740000
*********************************************************************** 01760000
*                                                                       01780000
* MASK'S TO TEST PARAMETER LIST WITH                                    01800000
*                                                                       01820000
*********************************************************************   01840000
INP      EQU   X'0F'                                                    01860000
OUTP       EQU   X'0F'                                                  01880000
UPDATE     EQU   X'04'                                                  01900000
INOUT      EQU   X'03'                                                  01920000
OUTIN      EQU   X'07'                                                  01940000
RDBACK     EQU   X'01'                                                  01960000
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 01970018
*                                                                       01980000
*                                                                       02000000
*********************************************************************   02020000
*                                                                       02040000
*                                                                       02060000
* OFFSET FOR PARAMETER TESTS                                            02080000
*                                                                       02100000
ONE        EQU   X'01'                                                  02120000
FRTYATE    EQU   48                                                     02140000
DISPSN     EQU   X'0'                                                   02160000
*                                                                       02180000
*                                                                       02200000
*********************************************************************   02220000
*                                                                       02240000
* OFFSETS FOR DEB REFERENCE                                             02260000
*                                                                       02280000
*                                                                       02300000
BIN      EQU   36                                                       02320000
BEXT     EQU   38                                                       02340000
*                                                                       02360000
*                                                                       02380000
*                                                                       02400000
*********************************************************************   02420000
*                                                                       02440000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              02460000
*                                                                       02480000
*                                                                       02500000
*                                                                       02520000
DOUBLE     EQU   X'01'                                                  02540000
*                                                                       02560000
*                                                                       02580000
STOWB      EQU   X'80'                                                  02600000
WRTCK      EQU   X'80'                                                  02620000
OVRFLO     EQU   X'20'                                                  02640000
PCI        EQU   X'20'                                                  02660000
MINKEY     EQU   X'01'                                                  02680000
CONCAT     EQU   X'FF'                                                  02700000
UPDATEB  EQU   X'80'                                                    02720000
OVFLBIT  EQU   X'20'                                                    02740000
UTFMASK  EQU   X'02'                    MASK FOR TOTALING FACILITY UT18 02750018
*********************************************************************   02760000
*                                                                       02780000
* MASKS FOR ACCESS METHODS IN SAM                                       02800000
*                                                                       02820000
QSAMB      EQU   X'01'                                                  02840000
BSAMBIT    EQU   X'00'                                                  02860000
PAM        EQU   X'02'                                                  02880000
*                                                                       02900000
*                                                                       02920000
* MASKS FOR MACRO'S TO BE USED                                          02940000
*                                                                       02960000
GETB       EQU   X'40'                                                  02980000
PUTB       EQU   X'40'                                                  03000000
READB      EQU   X'20'                                                  03020000
WRITEB     EQU   X'20'                                                  03040000
POINTB     EQU   X'04'                                                  03060000
CNTRLB     EQU   X'02'                                                  03080000
*                                                                       03100000
*                                                                       03120000
*********************************************************************   03140000
*                                                                       03160000
* MASKS FOR DEVICES TO BE SUPPORTED                                     03180000
*                                                                       03200000
*                                                                       03220000
*                                                                       03240000
*********************************************************************   03260000
*                                                                       03280000
*                                                                       03300000
*                                                                       03320000
*                                                                       03340000
*********************************************************************   03360000
*                                                                       03380000
* MASKS FOR STATUS BITS TO BE TESTED                                    03400000
*                                                                       03420000
*                                                                       03440000
EXCPN      EQU   X'30'                                                  03460000
COMPLETE   EQU   X'80'                                                  03480000
FIRSTIOB   EQU   X'01'                                                  03500000
*                                                                       03520000
*                                                                       03540000
*                                                                       03560000
*********************************************************************   03580000
*                                                                       03600000
* MASKS FOR BUFFER TECHNIQUE'S                                          03620000
*                                                                       03640000
CYCLICB    EQU   X'20'                                                  03660000
EXCHANGB   EQU   X'10'                                                  03680000
SIMPLEB    EQU   X'40'                                                  03700000
EXCHCYCL   EQU   X'30'                                                  03720000
*                                                                       03740000
*********************************************************************   03760000
*                                                                       03780000
*                                                                       03800000
* MODES OF OPERATION FOR QSAM                                           03820000
*                                                                       03840000
LOCATEB    EQU   X'08'                                                  03860000
MOVEB      EQU   X'10'                                                  03880000
SUBSTUTB   EQU   X'04'                                                  03900000
*                                                                       03920000
*                                                                       03940000
*********************************************************************   03960000
*                                                                       03980000
*                                                                       04000000
* COMMAND BYTES FOR THE 2841                                            04020000
*                                                                       04040000
*       CONTROL UNIT                                                    04060000
*                                                                       04080000
*                                                                       04100000
*                                                                       04120000
SRCHE      EQU   X'31'                                                  04140000
WRTCKD     EQU   X'1D'                                                  04160000
RDC        EQU   X'92'                                                  04180000
RDKD       EQU   X'8E'                                                  04200000
RDD        EQU   X'86'                                                  04220000
TIC        EQU   X'08'                                                  04240000
*                                                                       04260000
*                                                                       04280000
*********************************************************************   04300000
*                                                                       04320000
*                                                                       04340000
* MASKS FOR RECORD FORMATS                                              04360000
*                                                                       04380000
*                                                                       04400000
STANDRDF   EQU   X'08'                                                  04420000
FORMATU    EQU   X'C0'                                                  04440000
FORMATF    EQU   X'80'                                                  04460000
FORMATV    EQU   X'40'                                                  04480000
BLOCKED    EQU   X'10'                                                  04500000
FIXEDBLK   EQU   X'90'                                                  04520000
TRANS    EQU   X'7E'                    TRANSLATE MODE MASK.            04540000
*                                                                       04560000
*                                                                       04580000
*********************************************************************   04600000
*                                                                       04620000
*                                                                       04640000
*   CHANNEL CONTROL WORD FLAGS                                          04660000
*                                                                       04680000
SKIP       EQU   X'10'                                                  04700000
SLI        EQU   X'20'                                                  04720000
CC         EQU   X'40'                                                  04740000
DATACH     EQU   X'A0'                                                  04760000
SLICC      EQU   X'60'                                                  04780000
SLICCSK    EQU   X'70'                                                  04800000
*                                                                       04820000
*                                                                       04840000
*********************************************************************   04860000
*                                                                       04880000
*                                                                       04900000
KEYS       EQU   X'01'                                                  04920000
QSAM       EQU   X'01'                                                  04940000
IDLNG    EQU   2                        LENGTH OF XCTL ID        Y02072 04950002
*                                                                       04960000
*                                                                       04980000
*********************************************************************   05000000
*                                                                       05020000
GETMAIN    EQU   4                                                      05040000
XCTL       EQU   7                                                      05060000
LOAD       EQU   8                                                      05080000
*                                                                       05100000
*********************************************************************   05120000
*                                                                       05140000
*                                                                       05160000
**********************************************************************  05180000
ASISVLN  EQU   9                        DBLWORDS FOR IRB WKA     YM1141 05190002
ASA        EQU   X'04'                                                  05200000
BKREAD     EQU   X'01'                                                  05220000
URBITS   EQU   X'40'                                                    05240000
TAPEB    EQU   X'80'                                                    05260000
DABIT    EQU   X'20'                                                    05280000
OABD075  EQU   75                                                S21042 05290021
*                                                                       05300000
**********************************************************************  05320000
*                                                                       05340000
*     RECORD READY CONSTANTS                                            05343020
*                                                                       05346020
SIX      EQU   6                        CONSTANT OF SIX          S20201 05349020
NRECREDY EQU X'20'                      NON RECORD READY BIT     S20201 05352020
TRKOVFL  EQU   X'20'                    TRACK OVERFLOW BIT       S20201 05355020
**********************************************************************  05360000
*                                                                       05380000
*                                                                       05400000
*                                                                       05420000
*                                                                       05442000
*                                                                       05444000
*                                                                       05446000
*                                                                       05448000
*                                                                       05450000
*                                                                       05452000
*                                                                       05454000
*                                                                       05456000
*                                                                       05458000
*                                                                       05460000
*                                                                       05480000
         BALR  RBASE,0                                                  05500000
         USING SLDA,RBASE                                               05520000
         USING IHADCB,RDCB                                              05540000
         USING DEB,RDEB                                          S21042 05560021
         USING FORCORE,RCORE                                            05580000
*                                                                       05620000
*                                                                       05640000
SLDA     EQU   *                                                        05660000
*                                                                       05680000
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 05682002
         DC    C'IGG01912'              MODULE NAME              YM4640 05684002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 05686003
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 05688003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 05690002
*                                                                       05700000
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 05720000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   05740000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 05760000
         L     RCORE,4(RWTGC)           GET WORK AREA                   05780000
         MVI   22(RWTG),X'CB'           CHANGE ATTRIBUTES TO ONLY LOAD  05800000
*                                                                       05820000
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           05840000
         USING AVT,RTIOT                                                05850001
         SR    RUCB,RUCB                CLEAR REG                       05860000
         SR    RF,RF                   CLEAR REG                        05880000
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           05900000
         IC    RF,DEBEXSCL              GET SCALING FACTOR              05920000
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  05940000
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        05960000
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    05980000
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      06000000
*                                                                  UT18 06001018
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING          UT18 06002018
         BZ    SLDAA                    BR IF NOT SPECIFIED        UT18 06003018
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 06004018
         BZ    SLDAA                    IF YES, NO TOTALING REQ'D  UT18 06005018
*                                                                  UT18 06006018
* SINCE UTF WAS SPECIFIED THE TOTALING SAVE ROUTINE (IGG019AX)     UT18 06007018
*        WAS LOADED BY IGG0191Y IN STAGE 1 - SO IT IS NECESSARY    UT18 06008018
*        TO UPDATE THE SUBROUTINE ID POINTER (RUCB) TO POINT       UT18 06009018
*        TO THE SECOND ID SUBFIELD.                                UT18 06010018
*                                                                  UT18 06011018
         LA    RUCB,2(RUCB)             POINT TO NEXT ID SUBFIELD  UT18 06012018
*                                                                  UT18 06013018
SLDAA    EQU   *                        SYMBOLIC ADDR              UT18 06014018
*                                                                  UT18 06015018
         USING WTGENTRY,RWTGC                                    Y02072 06015402
         MVC   WTGIDTTR,NEXTMOD         ID OF NEXT MOD IN WTG  @Z30TSCF 06015803
*                                                                       06020000
* AN OFFSET IS USED TO LOAD THE PROPER MODULES FROM THE LIST OF MODULES 06040000
*   IN THE LOAD TABLE.  THIS OFFSET IS SET TO ZERO FOR BSAM, TWO FOR    06060002
*   QSAM.  THE ARRANGEMENT OF THE LOAD TABLE MUST BE A BSAM MODULE      06080000
*   FOLLOWED BY THE CORRESPONDING QSAM MODULE.                          06100000
*                                                                       06120000
SLD02    EQU   *                                                        06140000
         TM    DCBCIND2,QSAMB           IS THIS DCB FOR QSAM            06160000
         BZ    SLD100                   NO,BRANCH TO SET UP FOR BSAM    06180000
*                                                                       06200000
SLD80    EQU   *                                                        06220000
         LA    RD,IDLNG                 SET UP FOR QSAM          Y02072 06240002
         STH   RD,OFFSET                SET OFFSET TO LOAD QSAM  Y02072 06260002
*                                        MODULES                        06280000
         B     SLD105                                                   06320000
*                                                                       06340000
SLD100   EQU   *                                                        06360000
         SR    RD,RD                    CLEAR THE REGISTER              06400000
         STH   RD,OFFSET                SET OFFSET = 0 TO LOAD BSAM     06420000
*                                        MODULES                        06440000
*                                                                       06460000
SLD105   EQU   *                                                        06480000
         TM    DCBCIND2,UPDATEB         IS THIS UPDATE                  06500000
         BO    SLD106                  YES,GO TO LOAD FOR UPDATE        06520000
*                                                                       06540000
*THIS SECTION LOADS BSAM OR QSAM MODULES FOR PAPER TAPE                 06560000
*                                                                       06580000
SLD200   EQU   *                                                        06600000
         LA    RB,CHECKPT               GET PAPER TAPE CHECK/GERR ID    06620000
         AH    RB,OFFSET                ADD OFFSET TO GET CORRECT ID    06640000
*                                                                       06660000
         TM    DCBOFLGS,X'20'           CONCATENATION UNLIKE ATTRIBUTES 06680000
         BZ    SLD210                   NO,GO TO LOAD ROUTINE           06700000
*                                                                       06720000
SLD205   EQU   *                                                        06740000
*                                       YES, CANNOT HAVE CONCATENATION  06760000
*                                      OF UNLIKE ATTRIBUTES WITH        06780000
*                                      PAPER TAPE, MUST ABEND.          06800000
         DMABCOND OABD075,PDLOAD,RETURN=NONE,RES=NO 013 ABEND    S21042 06820021
         B     TCTLRTN                                           S21042 06840021
SLD210   EQU   *                                                        06860000
         BAL   RC,SLDROUT               TO LOAD CHECK OR GERR           06880000
         MVC   DCBCHECK+1(3),25(RWTG)   STORE ADDRESS IN DCB            06900000
*                                                                       06920000
         LA    RB,RPTU                  GET ADDRESS OF READ/GET TRANS   06940000
*                                                                       06960000
         TM    DCBCODE,TRANS            IS THIS TRANSLATE MODE          06980000
         BM    SLD220                   YES,GO TO LOAD MODULE           07000000
*                                                                       07020000
         LA    RB,WRH2                  NO,GET ADDRESS OF READ ID       07040000
SLD220   EQU   *                                                        07060000
         AH    RB,OFFSET                ADD OFFSET TO GET CORRECT ID    07080000
         BAL   RC,SLDROUT               TO LOAD READ OR GET ROUTINE     07100000
         MVC   DCBREAD+1(3),25(RWTG)    STORE ADDRESS IN DCBREAD/GET    07120000
*********************************************************************** 07140000
*      GET THE TRANSLATE TABLES NECESSARY FOR PAPER TAPE                07160000
*                                                                       07180000
SLDAPP00 EQU   *                                                        07200000
*                                                                       07220000
         SR    RE,RE                    GET TRANSLATION CODE.           07240000
         IC    RE,DCBCODE                                               07260000
         LA    RF,128                   POINT TO FIRST BIT IN TRAN CODE 07280000
         LA    RJ,7                     SET NUMBER OF CODES             07300000
SLDAPP10 EQU   *                                                        07320000
*                                                                       07340000
         CR    RE,RF                    IS THIS BIT ON?                 07360000
         BE    SLDAPP11                 YES, BRANCH.                    07380000
         SRL   RF,1                     NO, SHIFT TEST BIT OVER ONE.    07400000
         BCT   RJ,SLDAPP10              BRANCH WHEN NOT AT LAST BIT.    07420000
SLDAPP11 EQU   *                                                        07440000
*                                                                       07460000
*                                       ADJUST COUNT TO GET PROPER      07480000
*                                         ENTRY IN EXECUTE TABLE.       07500000
         SLL   RJ,2                     MULTIPLY BY FOUR (BYTES/INSTR). 07520000
         EX    0,SLDTTBX(RJ)            EXECUTE PROPER LOAD FOR THIS    07540000
*                                         BIT ON.                       07560000
         BAL   RC,SLDROUT               LOAD ROUTINE                    07580000
         MVC   DCBLCTBL+1(3),25(RWTG)   STORE ADDRESS                   07600000
SLDAPP14 EQU   *                                                        07620000
*                                                                       07640000
         B     SLDAPP15                                                 07660000
*                                                                       07680000
SLDTTBX  EQU   *-4                                                      07700000
*                                                                       07720000
*     ONE OF THESE INSTRUCTIONS WILL BE EXECUTED TO LOAD THE PROPER     07740000
* CONVERSION TABLE OR NONE, AS DETERMINED FROM DCBCODE.                 07760000
*                                                                       07780000
         LA    RB,TLTY                  TELETYPE                        07800000
         LA    RB,ASCI                  ASCII                           07820000
         LA    RB,NCRC                  NCR                             07840000
         LA    RB,BURR                  BURROUGHS                       07860000
         LA    RB,FRID                  FRIDEN                          07880000
         LA    RB,PTTC                  IBM                             07900000
         B     SLDAPP14                 NONE                            07920000
*                                                                       07940000
**********************************************************************  07960000
*THIS SECTION DETERMINES IF A LENGTH CHECKING APPENDAGE IS NEEDED       07980000
*   FOR PAPER TAPE                                                      08000000
*                                                                       08020000
SLDAPP15 EQU   *                                                        08040000
         TM    DCBRECFM,FORMATU         TYPE U RECORDS                  08060000
         BO    RELOOP                   YES, DON'T LOAD          A34004 08070020
*                                       APPENDAGE                A34004 08080020
         LA    RB,ACEP                  GET ID OF WLI APPENDAGE         08100000
         TM    DCBCIND2,QSAMB           IS DCB FOR QSAM                 08120000
         BNO   SLDAPP17                 NO,GO TO LOAD APPENDAGE  Y02072 08140002
         TM    DCBCODE,TRANS            IS IT FOR TRANSLATE             08160000
         BM    RELOOP                   YES, DON'T LOAD          A34004 08170020
*                                       APPENDAGE                A34004 08180020
SLDAPP17 BAL   RWK2,SLDROUT             GO LOAD APPENDAGE        Y02072 08192002
         ST    RWK1,AVTCE               APPEN ADDR TO AVT        Y02072 08194002
         B     RELOOP                   BRANCH TO GET OUT        Y02072 08200002
*                                                                       08220000
*THIS SECTION LOADS BSAM OR QSAM MODULES FOR UPDATE                     08240000
*                                                                       08260000
SLD106   EQU   *                                                        08280000
         LA    RB,CHECKUP               GET CHECK/GERR ID               08300000
         AH    RB,OFFSET                ADD OFFSET TO GET CORRECT ID    08320000
*                                                                       08340000
         TM    DCBOFLGS,X'20'           CONCATENATION UNLIKE ATTRIBUTES 08360000
         BZ    SLD110                   NO,GO LOAD CHECK/GERR ROUTINE   08380000
*                                                                       08400000
         BAL   RC,SLDROUT1              STORE CHECK OR GERR ID IN DEB   08420000
*                                                                       08440000
         B     SLD120                                                   08460000
*                                                                       08480000
SLD110   EQU   *                                                        08500000
         BAL   RC,SLDROUT               TO LOAD CHECK OR GERR           08520000
         MVC   DCBCHECK+1(3),25(RWTG)   STORE ADDRESS IN DCBCHECK/GERR  08540000
SLD120   EQU   *                                                        08560000
         LA    RB,BUEOE                GET END OF EXTENT ID FOR UPDATE  08580000
         AH    RB,OFFSET               ADD OFFSET TO GET CORRECT ID     08600000
         BAL   RC,SLDROUT                                               08620000
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   08640001
*                                                                       08660000
         LA    RB,UPRW                  GET READ/WRITE ADDRESS ID       08680000
         AH    RB,OFFSET                ADD OFFSET TO GET CORRECT ID    08700000
         BAL   RC,SLDROUT               TO LOAD READ/WRITE OR GET       08720000
         MVC   DCBREAD+1(3),25(RWTG)    STORE ADDRESS IN DCBREAD/GET    08740000
*                                                                       08760000
*                                                                       08780000
*THIS SECTION LOADS START IO AND, IF NECESSARY,                         08800000
*   LENGTH CHECKING AND TRACK OVERFLOW APPENDAGES FOR UPDATE            08820000
*                                                                       08840000
SLDAPP16 EQU   *                                                        08860000
*                                                                       08880000
         NI    DCBCIND2,X'7F'           TURN OFF UPDATE BIT             08900000
*                                                                       08920000
         LA    RB,USIO                  GET SIO APPENDAGE ID UPDATE     08940000
         BAL   RC,SLDROUT               LOAD ROUTINE                    08960000
         ST    RE,AVTSIO                APPENDAGE TABLE ENTRY FOR SIO   08980001
SLDAPPA  EQU   *                                                        09060000
*                                        APPENDAGE FOR TRACK OVERFLOW   09100000
*                                        INPUT.                         09120000
*     IGG019C3, OFFSET 0, USED FOR THE TRACK OVERFLOW ABNORMAL   Y02072 09124002
*     END, AND OFFSET 4 IS USED FOR THE TRACK OVERFLOW CHANNEL   Y02072 09132002
*     END APPENDAGE                                              Y02072 09136002
         TM    DCBRECFM,OVFLBIT         ARE TRACK OVERFLOW        23591 09165018
*                                       MODULES REQ               23591 09170018
         BZ    SLDAPPB                  NO,BRANCH                 23591 09175018
         LA    RB,TOABNE                GET ADDRESS OF ABNORMAL END     09175402
         BAL   RC,SLDROUT               LOAD THE APPENDAGE              09175502
         ST    RE,AVTABNE               APPENDAGE TABLE ENTRY FOR       09177001
*                                       ABNORMAL END APPENDAGE          09178001
         LA    RB,ASYNCH               GET ID OF ASYNCHRONOUS ROUTINE   09180000
         BAL   RC,SLDROUT              LOAD ROUTINE                     09200000
*  WHEN RETURNING FROM 'SLDROUT', REGISTER 0 CONTAINS THE ADDRESS       09220000
*   OF THE ASYNCHRONOUS ERROR ROUTINE                                   09240000
*                                                                       09260000
*        BUILD IRB FOR IGG019C1 - WORKAREA IS USED IN 19C3              09265002
*                                                                       09270002
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE),WKAREA=ASISVLN    YM1141 09280002
         ST    RF,24(RWTG)             STORE ADDRESSS OF IRB            09300000
         MVC   DEBIRBAD+1(3),25(RWTG)  PUT IRB ADDRESS IN DEB           09320000
SLDAPPB  EQU   *                                                        09340000
         TM    DCBRECFM,FORMATU         FORMAT U RECORDS         S20201 09343020
         BM    LAB03                    NO BRANCH AROUND         S20201 09344020
         TM    DCBRECFM,TRKOVFL         IS IT TRACK OVERFLOW     S20201 09345020
         BO    SLDAPP19                 YES BRANCH TO SLDAPP19   S20201 09346020
         LA    RB,ACEU                  NO GET U FORMAT CHAN END S20201 09347020
         B     SLDAPP18                 LOAD U FORMAT CHAN END   S20201 09348020
LAB03    EQU   *                                                 S20201 09349020
         TM    DCBRECFM,FORMATF         FIXED LENGTH RECS        S20201 09350020
         BO    LAB02                    BRANCH TO LOAD MOD       S20201 09351020
LAB01    EQU   *                                                 S20201 09352020
         TM    DCBRECFM,FORMATU        FORMAT U RECORDS                 09360000
         BC    9,SLDAPP19              BRANCH IF SPECIFIED FORMAT U     09380000
*                                        OR NOT SPECIFIED AT ALL.       09400000
         LA    RB,ACEV                 GET VARIABLE RD LGN CHECK APPN.  09420000
         TM    DCBRECFM,FORMATV        FORMAT V RECORDS                 09440000
         BO    SLDAPP18                YES,LOAD VARIABLE LGN APPEN      09460000
         TM    DCBRECFM,FIXEDBLK       FIXED BLOCK RECORDS              09480000
         BC    12,SLDAPP19             NO,DON'T LOAD APPENDAGE          09500000
LAB02    EQU   *                                                 S20201 09510020
         LA    RB,ACEF                 YES, GET FIXED LGN CHECK APPEN   09520000
*                                                                       09540000
SLDAPP18 EQU   *                                                        09560000
         BAL   RC,SLDROUT               LOAD ROUTINE                    09580000
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    09600001
         TM    DCBRECFM,DCBRECTO        TRACK OVERFLOW           Y02072 09600402
         BO    RELOOP                   YES, BYPASS SEC ENT PT   Y02072 09600802
         AH    RWK1,SECENTRY            ABNORMAL END ENTRY       Y02072 09602002
         ST    RWK1,AVTABNE             ABNOR END ENTRY TO AVT   Y02072 09604002
         B     RELOOP                                            A26750 09610019
*                                                                       09620000
*THIS SECTION LOADS MODULES NEEDED BY EITHER PAPER TAPE OR UPDATE       09640000
*                                                                       09660000
SLDAPP19 EQU   *                                                        09680000
*                                                                       09700000
         TM    DCBRECFM,OVFLBIT    TRK OVERFLOW                  A26750 09800019
         BZ    RELOOP              NO, BRANCH                    A26750 09900019
         L     RE,16(RTIOT)        GET ABN END ADDRESS           A26750 10000019
         AH    RWK1,SECENTRY            ADDR OF CHANNEL END APPG Y02072 10100002
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    10200001
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        10720000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     10740000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            10760000
         BCR   8,RBASE                                                  10780000
*                                                                       10800000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    10820000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             10840000
*                                                                       10860000
         LR    RPARC,RPAR                                               10880000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       10900000
ZCHEK    CLI   0(RWTGC),0               IS THIS ENTRY COMPLETE          10920000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         10940000
*                                                                       10960000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  10980000
         LA    RPARC,PLOFF(0,RPARC)                                     11000000
         BC    15,ZCHEK                                                 11020000
*                                                                       11040000
TCTLRTN  EQU   *                                                        11060000
         USING WTG,RWTG                                                 11110003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11160003
               MODID=WTGENTRY                                  @Z30TSCF 11170003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11180003
**                                                                      11200000
*                                                                       11220000
*                                                                       11240000
*                                                                       11260000
WAOFF    EQU   32                                                       11280000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           11300000
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           11320000
OPIDCNST DC    C'0S'                                                    11520000
AMIDCNST DC    C'12'                                                    11540000
*                                                                       11560000
*                                                                       11580000
*                                                                       11600000
         DS    0H                                                       11620000
SLDROUT  EQU   *                                                        11640000
         MVC   6(2,RWTG),0(RB)          MOVE 2 BYTE ID TO DE            11680000
*                                                                       11860000
*                                                                       11880000
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 11890002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 11892002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 11894002
         DROP  R1                       DROP CVT BASE            YM1140 11896002
**                                                                      11900000
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 11920002
**                                                                      11940000
*                                                                       11960000
*                                                                       11980000
*                                                                       12000000
         ST    RE,24(RWTG)              STORE ADDRESSS OF LOADED ROUTIN 12020000
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ID IN DEB                 12057901
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               12060000
         SR    RD,RD                                                    12080000
         IC    RD,DEBNMSUB              GET NO. OF SUBRT LOADED         12100000
         LA    RD,1(RD)                 ADD ONE TO TOTAL                12120000
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF SUBRT LOADED 12140000
         BR    RC                       RETURN                          12160000
*                                                                       12180000
*                                                                       12200000
*********************************************************************** 12220000
*                                                                       12240000
SECENTRY DC    H'4'                     OFFSET TO SECOND ENTRY   Y02072 12340002
*                                                                       12580000
*********************************************************************** 12600000
*                                                                       12620000
*                                                                       12640000
*                                                                       12660000
*                                                                       12700000
* THIS MODULE IS DEPENDENT ON THE ARRANGEMENT OF THE FOLLOWING LOAD     12720000
*   TABLE.  THE LOAD TABLE IS SET UP WITH A BSAM ENTRY, FOLLOWED        12740000
*   BY THE CORRESPONDING QSAM ENTRY.  THIS PATTERN MUST BE MAINTAINED   12760000
*   TO ENSURE THAT THE PROPER MODULE IS LOADED                          12780000
*                                                                       12800000
*********************************************************************   12820000
*                                                                       12840000
***                                                                     12880000
         DC    0D'0'                    ALIGN TO DOUBLE WORD BDY Y02072 12930002
NEXTMOD  DC    C'18',VL3(IGG01918)      ID OF MODULE IGG01918  @Z30TSCF 12980003
CHECKUP  DC    C'BI'                    ID OF MODULE IGG019BI    Y02072 13030002
UPER     DC    C'AF'                    ID OF MODULE IGG019AF    Y02072 13080002
UPRW     DC    C'BH'                    ID OF MODULE IGG019BH    Y02072 13130002
UGFV     DC    C'AE'                    ID OF MODULE IGG019AE    Y02072 13180002
CHECKPT  DC    C'BG'                    ID OF MODULE IGG019BG    Y02072 13230002
GERR     DC    C'AQ'                    ID OF MODULE IGG019AQ    Y02072 13280002
RPTU     DC    C'BF'                    ID OF MODULE IGG019BF    Y02072 13330002
GPTF     DC    C'AT'                    ID OF MODULE IGG019AT    Y02072 13380002
WRH2     DC    C'BA'                    ID OF MODULE IGG019BA    Y02072 13430002
GPTN     DC    C'AC'                    ID OF MODULE IGG019AC    Y02072 13480002
BUEOE    DC    C'BM'                    ID OF MODULE IGG019BM    Y02072 13530002
QUEOE    DC    C'AW'                    ID OF MODULE IGG019AW    Y02072 13580002
USIO     DC    C'CG'                    ID OF MODULE IGG019CG    Y02072 13630002
TOABNE   DC    C'C3'                    ID OF MODULE IGG019C3    Y02072 13680002
ASYNCH   DC    C'C1'                    ID OF MODULE IGG019C1    Y02072 13730002
ACEF     DC    C'CI'                    ID OF MODULE IGG019CI    Y02072 13780002
ACEP     DC    C'CS'                    ID OF MODULE IGG019CS    Y02072 13830002
ACEV     DC    C'CJ'                    ID OF MODULE IGG019CJ    Y02072 13880002
TLTY     DC    C'CM'                    ID OF MODULE IGG019CM    Y02072 13930002
ASCI     DC    C'CN'                    ID OF MODULE IGG019CN    Y02072 13980002
BURR     DC    C'CO'                    ID OF MODULE IGG019CO    Y02072 14030002
FRID     DC    C'CP'                    ID OF MODULE IGG019CP    Y02072 14080002
PTTC     DC    C'CQ'                    ID OF MODULE IGG019CQ    Y02072 14130002
NCRC     DC    C'CR'                    ID OF MODULE IGG019CR    Y02072 14180002
ACEU     DC    C'C0'                    ID OF MODULE IGG019C0    Y02072 14230002
PDLOAD   DC    C'6M'                    ID OF MODULE IGG0196M    Y02072 14280002
         SPACE                                                          14330002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 14430002
END      EQU   *                        END OF MODULE            Y02072 15200002
         TITLE 'IGG01912 - FORMAT OF GOTTEN CORE'                       15220002
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 15250003
         ORG   WTGIDTTR                                          Y02072 15260002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 15270002
*                                                                       15280000
*                                                                       15300000
AVT      DSECT                          APPENDAGE VECTOR TABLE          15301001
AVTEOEPG DS    0CL1                     NO.PAGES MODULE REQUIRES        15302001
AVTEOE   DS    A                        ADDR OF END OF EXTENT           15303001
*                                       APPENDAGE                       15304001
AVTSIOPG DS    0CL1                     NO.PAGES MODULE REQUIRES        15305001
AVTSIO   DS    A                        ADDR OF START I/O               15306001
*                                       APPENDAGE                       15307001
AVTPCIPG DS    0CL1                     NO.PAGES MODULE REQUIRES        15308001
AVTPCI   DS    A                        ADDR OF PCI APPENDAGE           15309001
AVTCEPG  DS    0CL1                     NO.PAGES MODULE REQUIRES        15310001
AVTCE    DS    A                        ADDR OF CHANNEL END             15311001
*                                       APPENDAGE                       15312001
AVTABNPG DS    0CL1                     NO.PAGES MODULE REQUIRES        15313001
AVTABNE  DS    A                        ADDR OF ABNORMAL END            15314001
*                                       APPENDAGE                       15315001
CVT      DSECT                                                          15320000
         CVT                                                            15340000
*                                                                       15360000
*                                                                       15380000
BLDEB    DSECT                                                          15400000
DEB      DS    0F                                                       15420000
DEBNMSUB DS    0CL1                                                     15440000
DEBTCBAD DS    CL4                                                      15460000
DEBAMLNG DS    0CL1                                                     15480000
DEBDEBAD DS    CL4                                                      15500000
DEBOGLGS DS    0CL1                                                     15520000
DEBIRBAD DS    CL4                                                      15540000
DEBOPATB DS    0CL1                                                     15560000
DEBSYSPG DS    CL4                                                      15580000
DEBNMEXT DS    0CL1                                                     15600000
DEBUSRPG DS    CL4                                                      15620000
DEBPRIOR DS    0CL1                                                     15640000
DEBECBAD DS    CL4                                                      15660000
DEBPROTG DS    0CL1                                                     15680000
DEBDEBID DS    0CL1                                                     15700000
DEBDCBAD DS    CL4                                                      15720000
DEBEXSCL DS    0CL1                                                     15740000
DEBAPPAD DS    CL4                                                      15760000
DEBDVMOD DS    0CL1                                                     15780000
DEBUCBAD DS    CL4                                                      15800000
DEBBINUM DS    CL2                                                      15820000
DEBSTRCC DS    CL2                                                      15840000
DEBSTRHH DS    CL2                                                      15860000
DEBENDCC DS    CL2                                                      15880000
DEBENDHH DS    CL2                                                      15900000
DEBNMTRK DS    CL2                                                      15920000
*                                                                       15940000
           DCBD  DSORG=PS                                               15960000
* DCBREAD IS A TEMPORARY STORAGE AREA USED FOR THE OFFSET USED IN       15980000
*  LOADING EITHER QSAM MODULES OR BSAM MODULES                          16000000
OFFSET   EQU   DCBREAD+2                                                16020000
**********************************************************************  16040000
*                                                                       16060000
           END                                                          16080000
./  ADD  SSI=43081104,NAME=IGG01913
 TITLE 'IGG01913 - SAM EXECUTOR FOR PCI/TRACK OVERFLOW'                 00007018
IGG01913 CSECT                                                     UT18 00014018
*MODULE NAME - IGG01913                                          Y02072 00024002
*                                                                       00034002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00034402
*                                                                       00034802
*COPYRIGHT - NONE                                                Y02072 00034902
*                                                                       00037902
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00039902
*                                                                       00040302
*          RELEASE 20 DELETIONS                                         00041002
*0945059134,059142,143400                                        M5150  00044002
*0945                                                            S20038 00047002
*0945059120-059150,125000,147800                                 S20202 00050002
*0945143400                                                      M5701  00053002
*          RELEASE 21 DELETIONS                                         00056002
*1091002800,118000-118600                                        A39228 00059002
*                                                               SA66897 00059402
*          VS2 RELEASE 2 DELETIONS                                      00061002
*000090,000230-000320,000410-000500,125000,055900,056100,        Y02072 00061402
*056300-056340,59160,107200-107400,108200,108800,110400-112400,  Y02072 00061802
*113000-117200                                                   Y02072 00061902
*                                                                YM1141 00062102
*                                                                YM1140 00062202
*                                                                       00066103
*          VS2 RELEASE 3 DELETIONS                                      00068103
*                                                              @Z30TSCF 00068503
*                                                                       00070103
*STATUS CHANGE LEVEL 004                                                00074002
*                                                                       00077002
*FUNCTION/OPERATION - THIS ROUTINE WILL LOAD SOME OF THE I/O       UT18 00080018
*      PROCESSING MODULES.  THE MODULES TO BE LOADED ARE DETERMINEDUT18 00100018
*      FOR THE ACCESS METHODS AND DEVICE TYPE TO BE USED.          UT18 00120018
*      IT WILL PLACE THE ADDRESS OF THE LOADED MODULES IN THE           00160000
*      APPROPRIATE DCB FIELDS, AND THE ID'S IN THE DEB.                 00180000
*      IT WILL BRING IN THE APPROPRIATE ERROR ROUTINES.                 00200000
*      THIS MODULE WAS SPLIT IN RELEASE 18 TO INCLUDE USER         UT18 00210018
*      TOTALING SUPPORT.  THE SECOND HALF OF THIS MODULE IS NOW    UT18 00220018
*      IGG01919.                                                   UT18 00230018
*                                                                       00260000
*ENTRY POINT -- ENTERED FROM IGG0191K,IGG0191R,IGG0191Q                 00280021
*      AND IGG0191H BY USE OF THE XCTL MACRO.                           00300000
*                                                                       00320000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS)                        00340000
*                                                                       00360000
*OUTPUT: DCB(USERS),IOB(USERS).                                         00380000
*                                                                       00400000
*EXTERNAL ROUTINES: NONE.                                               00420000
*                                                                       00430018
*EXITS-NORMAL   XCTL TO IGG01919.                                  UT18 00440018
*                                                                       00460000
*EXITS-ERROR: NONE.                                                     00480000
*                                                                       00500000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00520000
*                                                                       00540000
*      BYTE  0-7  NAME                                                  00560000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00580000
*      BYTE 11    CONCATENATION NUMBER                                  00600000
*      BYTE 12    ZERO                                                  00620000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00640000
*                        ALIAS INDICATOR 1 BIT                          00660000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00680000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00700000
*      BYTE 17    ZERO                                                  00720000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00740000
*      BYTE 20    TRANSLATION TABLE                                     00760000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00780000
*      BYTE 22-23 ATTRIBUTES                                            00800000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00820000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00840000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00860000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00880000
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       00900000
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        00920000
*      BYTE 40-   TABLE OF IDTTR'S                                      00940000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          00960000
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          00980000
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          01000000
*                   NOT USED                         (3 BYTES)          01020000
*                                                                       01040000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY,   Y02072 01060002
*            SUPERVISOR STATE                                    Y02072 01070002
*                                                                       01080000
*NOTES: THIS ROUTINE HAS A LIST OF ALL BSAM, QSAM MODULES SUPPORTED.    01100000
*                                                                       01120000
*********************************************************************** 01140000
*                                                                       01160000
*                                                                       01180000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01200000
*                                                                       01220000
*********************************************************************** 01240000
*                                                                       01260000
RE       EQU   0         WORK REG5                                      01262002
RF       EQU   1         WORK REG6                                      01264002
R1       EQU   RF        PARM REG                                YM1140 01270002
RDCB     EQU   2         DCB REGISTER                                   01280000
RBASE    EQU   3         BASE REGISTER                                  01300000
RCORE    EQU   4         WORK AREA ADDRESS                              01320000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01340000
RWTG     EQU   6         TOP OF WTG TABLE                               01360000
RPARC    EQU   7         CURRENT PARAMETER                              01380000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01400000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01420000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01440000
RDEB     EQU   11        DEB ADDRESS                                    01460000
RB       EQU   12        WORK REG1  **                                  01480000
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01500000
RD       EQU   14        WORK REG3  **                                  01520000
RJ       EQU   15        WORK REG4                                      01540000
*                                                                       01600000
*                                                                       01620000
PARAR    EQU   RPARC                                                    01640000
*                                                                       01660000
*********************************************************************** 01680000
*                                                                       01700000
*********************************************************************** 01720000
*                                                                       01740000
* MASK'S TO TEST PARAMETER LIST WITH                                    01760000
*                                                                       01780000
*********************************************************************   01800000
INP      EQU   X'0F'                                                    01820000
OUTP       EQU   X'0F'                                                  01840000
UPDATE     EQU   X'04'                                                  01860000
INOUT      EQU   X'03'                                                  01880000
OUTIN      EQU   X'07'                                                  01900000
RDBACK     EQU   X'01'                                                  01920000
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 01930018
*                                                                       01940000
*                                                                       01960000
*********************************************************************   01980000
*                                                                       02000000
*                                                                       02020000
* OFFSET FOR PARAMETER TESTS                                            02040000
*                                                                       02060000
ONE        EQU   X'01'                                                  02080000
THREE    EQU   X'03'                    CONSTANT=3               S20202 02085020
K24      EQU   X'18'                    CONSTANT=24              S20202 02090020
K25      EQU   X'19'                    CONSTANT=25              S20202 02095020
FRTYATE    EQU   48                                                     02100000
DISPSN     EQU   X'0'                                                   02120000
*                                                                       02140000
*                                                                       02160000
*********************************************************************   02180000
*                                                                       02200000
* OFFSETS FOR DEB REFERENCE                                             02220000
*                                                                       02240000
*                                                                       02260000
DEBIRBOF EQU   9                        OFFSET TO IRB ADDR       S20202 02265020
FOUR     EQU   X'04'                                             M5150  02279020
BIN      EQU   36                                                       02280000
BEXT     EQU   38                                                       02300000
*                                                                       02320000
*                                                                       02340000
*                                                                       02360000
*********************************************************************   02380000
*                                                                       02400000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              02420000
*                                                                       02440000
*                                                                       02460000
*                                                                       02480000
DOUBLE     EQU   X'01'                                                  02500000
*                                                                       02520000
*                                                                       02540000
STOWB      EQU   X'80'                                                  02560000
WRTCK      EQU   X'80'                                                  02580000
OVRFLO   EQU   X'20'                                                    02600000
PCI        EQU   X'20'                                                  02620000
MINKEY     EQU   X'01'                                                  02640000
CONCAT     EQU   X'FF'                                                  02660000
UTFMASK  EQU   X'02'                    MASK FOR TOTALING FACILITY UT18 02670018
*                                                                       02680000
*********************************************************************   02700000
*                                                                       02720000
* MASKS FOR ACCESS METHODS IN SAM                                       02740000
*                                                                       02760000
QSAMB      EQU   X'01'                                                  02780000
BSAMBIT    EQU   X'00'                                                  02800000
PAM        EQU   X'02'                                                  02820000
*                                                                       02840000
*                                                                       02860000
* MASKS FOR MACRO'S TO BE USED                                          02880000
*                                                                       02900000
GETB       EQU   X'40'                                                  02920000
PUTB       EQU   X'40'                                                  02940000
READB      EQU   X'20'                                                  02960000
WRITEB     EQU   X'20'                                                  02980000
POINTB     EQU   X'04'                                                  03000000
CNTRLB     EQU   X'02'                                                  03020000
*                                                                       03040000
*                                                                       03060000
*********************************************************************   03080000
*                                                                       03100000
* MASKS FOR DEVICES TO BE SUPPORTED                                     03120000
*                                                                       03140000
*                                                                       03160000
*                                                                       03180000
PTR3211  EQU   X'49'                    MASK FOR 3211 PRINTER    S20202 03190020
*********************************************************************   03200000
*                                                                       03220000
*                                                                       03240000
*                                                                       03260000
*                                                                       03280000
*********************************************************************   03300000
*                                                                       03320000
* MASKS FOR STATUS BITS TO BE TESTED                                    03340000
*                                                                       03360000
*                                                                       03380000
EXCPN      EQU   X'30'                                                  03400000
COMPLETE   EQU   X'80'                                                  03420000
FIRSTIOB   EQU   X'01'                                                  03440000
*                                                                       03460000
*                                                                       03480000
*                                                                       03500000
*********************************************************************   03520000
*                                                                       03540000
* MASKS FOR BUFFER TECHNIQUE'S                                          03560000
*                                                                       03580000
EXCHANGB   EQU   X'10'                                                  03600000
SIMPLEB    EQU   X'40'                                                  03620000
*                                                                       03640000
*********************************************************************   03660000
*                                                                       03680000
*                                                                       03700000
* MODES OF OPERATION FOR QSAM                                           03720000
*                                                                       03740000
LOCATEB    EQU   X'08'                                                  03760000
MOVEB      EQU   X'10'                                                  03780000
MOVEXCHB EQU X'14'                                                      03800000
SUBSTUTB   EQU   X'04'                                                  03820000
*                                                                       03840000
*                                                                       03860000
*********************************************************************   03880000
*                                                                       03900000
*                                                                       03920000
* COMMAND BYTES FOR THE 2841                                            03940000
*                                                                       03960000
*       CONTROL UNIT                                                    03980000
*                                                                       04000000
*                                                                       04020000
*                                                                       04040000
SRCHE      EQU   X'31'                                                  04060000
WRTCKD     EQU   X'1D'                                                  04080000
RDC        EQU   X'92'                                                  04100000
RDKD       EQU   X'8E'                                                  04120000
RDD        EQU   X'86'                                                  04140000
TIC        EQU   X'08'                                                  04160000
*                                                                       04180000
*                                                                       04200000
*********************************************************************   04220000
*                                                                       04240000
*                                                                       04260000
* MASKS FOR RECORD FORMATS                                              04280000
*                                                                       04300000
*                                                                       04320000
STANDRDF   EQU   X'08'                                                  04340000
FORMATU    EQU   X'C0'                                                  04360000
FORMATF    EQU   X'80'                                                  04380000
FORMATV    EQU   X'40'                                                  04400000
FORMATD  EQU   X'20'                    D FORMAT RECORDS         S20038 04410020
BLOCKED    EQU   X'10'                                                  04420000
FIXEDBLK   EQU   X'90'                                                  04440000
*                                                                       04460000
*                                                                       04480000
*********************************************************************   04500000
*                                                                       04520000
*                                                                       04540000
*   CHANNEL CONTROL WORD FLAGS                                          04560000
*                                                                       04580000
SKIP       EQU   X'10'                                                  04600000
SLI        EQU   X'20'                                                  04620000
CC         EQU   X'40'                                                  04640000
DATACH     EQU   X'A0'                                                  04660000
SLICC      EQU   X'60'                                                  04680000
SLICCSK    EQU   X'70'                                                  04700000
*                                                                       04720000
*                                                                       04740000
*********************************************************************   04760000
*                                                                       04780000
*                                                                       04800000
KEYS       EQU   X'01'                                                  04820000
QSAM       EQU   X'01'                                                  04840000
*                                                                       04860000
*                                                                       04880000
*********************************************************************   04900000
*                                                                       04920000
*                                                                       04940000
*********************************************************************   04960000
*                                                                       04980000
*                                                                       05000000
**********************************************************************  05020000
ASISVLN  EQU   9                        DBLWORDS FOR IRB WKA     YM1141 05030002
ASA        EQU   X'04'                                                  05040000
BKREAD     EQU   X'01'                                                  05060000
URBITS   EQU   X'40'                                                    05080000
TAPEB    EQU   X'80'                                                    05100000
DABIT    EQU   X'20'                                                    05120000
         EJECT                                                          05170002
         BALR  RBASE,0                                                  05340000
         USING SLDA,RBASE                                               05360000
         USING IHADCB,RDCB                                              05380000
         USING BLDEB,RDEB                                               05400000
         USING FORCORE,RCORE                                            05420000
*                                                                       05460000
*                                                                       05480000
SLDA     EQU   *                                                        05500000
*                                                                       05520000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 05530002
         DC    C'IGG01913'              MODULE NAME              Y02072 05532002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 05536003
         DC    C'10/22/74'              LAST DATE MODIFIED     @Z30TSCF 05538003
BEGIN    DS    0H                                                       05538402
*                                                                       05540000
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 05560000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   05580000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 05600000
         L     RCORE,4(RWTGC)           GET WORK AREA                   05620000
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  05640000
*                                                                       05660000
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           05680000
         SR    RUCB,RUCB                CLEAR REG                       05700000
         SR    RF,RF                    CLEAR RER                       05720000
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           05740000
         IC    RF,DEBEXSCL              GET SCALING FACTOR              05760000
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  05780000
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        05800000
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    05820000
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      05840000
*                                                                       05860000
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB                05880000
*                                                                       05900000
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING          UT18 05901018
         BZ    SLDAA                    BR IF NOT SPECIFIED        UT18 05902018
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 05903018
         BZ    SLDAA                    IF YES, NO TOTALING REQ'D  UT18 05904018
*                                                                  UT18 05905018
* SINCE UTF WAS SPECIFIED THE TOTALING SAVE ROUTINE (IGG019AX)     UT18 05906018
*        WAS LOADED BY IGG0191Y IN STAGE 1 - SO IT IS NECESSARY    UT18 05907018
*        TO UPDATE THE SUBROUTINE ID POINTER (RUCB) TO POINT       UT18 05908018
*        TO THE SECOND ID SUBFIELD.                                UT18 05909018
*                                                                  UT18 05910018
         LA    RUCB,2(RUCB)             POINT TO NEXT ID SUBFIELD  UT18 05911018
SLDAA    EQU   *                                                 S20202 05911220
         CLI   DCBDEVT,PTR3211          TEST FOR 3211 PRINTER    S20202 05911420
         BNE   SLDAB                    NO BRANCH AROUND         S20202 05911620
*                                                                       05911820
*   FOR A 3211 PRINTER LOAD AN ERROR RETRY MODULE                       05912020
*                                                                       05912220
         LA    RB,ERRMOD                GET ADDR OF ERROR RETRY  S20202 05912420
         BAL   RC,SLDROUT               GO LOAD ERROR RETRY MOD  S20202 05912620
*   WHEN RETURN FROM 'SLDROUT'- R0 CONTAINS THE ADDR OF THE             05912820
*   ASYNCHRONOUS ERROR ROUTINE. NOW BUILD AN IRB TO BE USED  IN         05913020
*   SCHEDULING THIS ROUTINE. WKA IS USED IN IGG019C3.                   05913202
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE),WKAREA=ASISVLN    YM1141 05913402
         ST    RF,K24(RWTG)             TEMP SAVE FOR IRB ADDR   S20202 05913620
         MVC   DEBIRBOF(THREE,RDEB),K25(RWTG) MV IRB ADDR INTO   S20202 05913820
*                                       DEB                      S20202 05914020
SLDAB    EQU   *                                                 M5150  05915420
         USING WTGENTRY,RWTGC                                    Y02072 05915802
         MVC   WTGIDTTR,NEXTMOD         ID OF NEXT MOD         @Z30TSCF 05915903
         TM    DCBCIND2,QSAMB          DCB FOR QSAM                     05940000
         BO    SLD100                  YES,BRANCH                       05960000
*                                                                       05980000
         LA    RB,CHECK                GET ID OF CHECK ROUTINE          06000000
         B     SLD105                                                   06040000
*                                                                       06060000
SLD100   EQU   *                                                        06080000
         LA    RB,GERR                 GET GERR ROUTINE ID              06120000
*                                                                       06140000
         TM    DISPSN(PARAR),OUTP      DCB FOR OUTPUT                   06160000
         BO    SLD200                  YES, BRANCH                      06180000
*                                                                       06200000
SLD105   EQU   *                                                        06220000
         TM    DCBOFLGS,X'20'           CONCATENATION UNLIKE ATTRIBUTES 06240000
         BZ    SLDA0                   NO,GO TO LOAD ROUTINE            06260000
*                                                                       06280000
         BAL   RC,SLDROUT1             STORE CHECK OR GERR ID IN DEB    06300000
         B     SLDA1                                                    06320000
*                                                                       06340000
SLDA0    EQU   *                                                        06360000
         BAL   RC,SLDROUT              GO TO LOAD ROUTINE               06380000
         MVC   DCBCHECK+1(3),25(RWTG)  STORE CHECK/GERR ID IN DCB       06400000
*                                                                       06420000
SLDA1    EQU   *                                                        06440000
         TM    DCBCIND2,QSAMB          DCB FOR QSAMB                    06460000
         BO    SLD101                  YES,BRANCH                       06480000
*                                                                       06500000
         LA    RB,WRH2                 GET READ WRITE ID                06520000
         B     SLD150                  GO TO LOAD ROUTINE               06540000
*                                                                       06560000
*                                                                       06580000
*                                                                       06600000
SLD101   EQU   *                                                        06620000
         TM    DCBDEVT,TAPEB            DCB USING TAPE                  06640000
         BZ    SLD160                   NO,BRANCH                       06660000
*                                                                       06680000
         TM    DEBOPATB,X'03'           OPEN FOR BACKWARD READ          06700000
         BC    9,SLD160                 NO,BRANCH                       06720000
*                                                                       06740000
         LA    RB,SBLF                  SET UP BASE FOR BACKWARD GETS   06760000
         TM    DCBMACRF,MOVEXCHB       DCB USING MOVE OR SUBST. MODE    06780000
         BZ    SLD150                   NO,BRANCH MUST BE LOCATE MODE   06800000
         LA    RB,L'IDLEN(RB)           POINT TO MOVE MODE       Y02072 06810002
SLD150   EQU   *                                                        06860000
         BAL   RC,SLDROUT               TO LOAD FUNCTION                06880000
         MVC   DCBGET+1(3),25(RWTG)    PUT ADDRESS IN DCBGET/READ       06900000
         B     SLDEOB                   TO SPECIAL ROUTINES             07000000
*                                                                       07020000
SLD160   EQU   *                                                        07040000
*                                                                       07060000
         LA    RB,SGLF                  SET UP FOR NORMAL GET IDS       07080000
         TM    DCBMACRF,MOVEXCHB       DCB USING MOVE OR SUBST. MODE    07200000
         BZ    SLD175                   NO,BRANCH MUST BE LOCATE MODE   07220000
SLD173   EQU   *                                                        07260000
         LA    RB,2*L'IDLEN(RB)         UPDATE TO MOVE MODE      Y02072 07270002
SLD175   EQU   *                                                        07320000
         TM    DCBRECFM,DCBRECF         FORMAT F OR U           SA66897 07370002
         BO    SLD150                   YES, GO LOAD ROUTINE    SA66897 07420002
         TM    DCBRECFM,DCBRECV         FORMAT V                SA66897 07422002
         BO    SLD180                   YES, GO INCR TO NEXT ID SA66897 07424002
*                                                                       07426002
* BECAUSE DCBRECFM FIELD BITS 0, 1, & 2 HAVE DUPLICATE MEANINGS         07428002
* IT IS NECESSARY TO MAKE THE FOLLOWING TWO TESTS TO DETERMINE          07428402
* IF FORMAT D RECORDS ARE BEING USED.                                   07428802
*   RECFM = 001XXXXX - UNDEFINED REC FORMAT WITH TRK OVERFLO            07429202
*   RECFM = 001XXXXX - ASCII TAPE (OPTCD = Q)                           07429602
* AT THIS POINT BITS 0 & 1 ARE ZERO.                                    07429702
*                                                                       07429802
         TM    DCBRECFM,DCBRECD         ASCII TAPE OR TRK OVFLO SA66897 07429902
         BZ    SLD150                   NO, GO LOAD FOR FORMAT  SA66897 07437402
*                                         U RECORDS             SA66897 07439402
         TM    DCBOPTCD,DCBOPTQ         ASCII TAPE              SA66897 07441402
         BZ    SLD150                   NO, GO LOAD U FORMAT    SA66897 07443402
SLD180   EQU   *                                                 S20038 07445002
         LA    RB,L'IDLEN(RB)           UPDATE TO V REC IDS      Y02072 07452502
         B     SLD150                   TO LOAD FUNCTION                07460000
*                                                                       07480000
SLD200   LA    RB,PERR                  GET ADDRESS OF PERR ID          07500000
         BAL   RC,SLDROUT               TO LOAD SUBROUTINE              07520000
         MVC   DCBPERR+1(3),25(RWTG)    LOAD PERR ADDRESS IN DCB        07540000
*                                                                       07560000
SLD250   LA    RB,SPLF                  ESTABLISH BASE FOR PUTS         07580000
*                                                                       07600000
         TM    DCBMACRF+1,MOVEXCHB     DCB USING MOVE OR SUBST. MODE    07620000
         BZ    SLD175                   NO,BRANCH MUST BE LOCATE MODE   07640000
         B     SLD173                   SET UP FOR MOVE ROUTINES        07660000
*                                                                       07680000
*********************************************************************** 07700000
*                                                                       07720000
SLDEOB   EQU   *                                                        07740000
*                                                                       07760000
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        10360000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     10380000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            10400000
         BCR   8,RBASE                                                  10420000
*                                                                       10440000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    10460000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             10480000
*                                                                       10500000
         LR    RPARC,RPAR                                               10520000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       10540000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           10560000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         10580000
*                                                                       10600000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  10620000
         LA    RPARC,PLOFF(0,RPARC)                                     10640000
         BC    15,ZCHEK                                                 10660000
*                                                                       10680000
TCTLRTN  EQU   *                                                        10700000
         USING WTG,RWTG                                                 10750003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*10800003
               MODID=WTGENTRY                                  @Z30TSCF 10810003
         DROP  RWTGC,RWTG                                      @Z30TSCF 10820003
*                                                                       10840000
WAOFF    EQU   32                                                       10940000
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           10960000
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           10980000
OPIDCNST DC    C'0S'                                                    11000000
AMIDCNST DC    C'13'                                                    11020000
         DS    0H                                                       11260000
SLDROUT  EQU   *                                                        11280000
         USING WTGMODNM,RWTG                                     Y02072 11330002
         MVC   WTGMODID,0(RB)           ID TO MOD NAME           Y02072 11380002
         DROP  RWTG                                              Y02072 11430002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 11480002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 11530002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 11580002
         DROP  R1                       DROP CVT BASE            YM1140 11630002
*                                                                       11680002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 11720002
*                                                                       11740000
*                                                                       11760000
*                                                                       11780000
         ST    RE,24(RWTG)              TEMP STORE OF ROUTINE ADDR,     11880000
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        11900000
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               11920000
         SR    RD,RD                                             A39228 11922021
         IC    RD,DEBNMSUB              GET NO. OF SUBROUTINES   A39228 11924021
*                                       LOADED                   A39228 11926021
         LA    RD,1(RD)                 ADD ONE TO TOTAL         A39228 11928021
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF       A39228 11930021
*                                       SUBROUTINES LOADED              11932021
         BR    RC                      RETURN                           11940000
         EJECT                                                          11990002
*                                                                       12400000
*   BELOW ARE THE QSAM ROUTINES BEING SUPPORTED                         12420000
*                                                                       12440000
NEXTMOD  DC    C'19',VL3(IGG01919)      IGG01919 - THIS IS THE @Z30TSCF 12540003
SGLF     DC    C'AA'                    SIMPLE GET LOC MODE FIXED REC.  12600000
SGLV     DC    C'AB'                    SIMPLE GET LOC MODE VARIABLE R. 12660000
SGMF     DC    C'AC'                    SIMPLE GET MOVE MD FIXED RECS.  12720000
SGMV     DC    C'AD'                    SIMPLE GET MOVE MD VARIABLE REC 12780000
SPLF     DC    C'AI'                   SIMPLE PUT LOC MD. FIXED RECS.   12840000
SPLV     DC    C'AJ'                    SIMPLE PUT LOC MD. VARIABLE REC 12900000
SPMF     DC    C'AK'                    SIMPLE PUT MOVE MD. FIXED REGS  12960000
SPMV     DC    C'AL'                    SIMPLE PUT MOVE MD. VARIABLE RC 13020000
SBLF     DC    C'AM'                    SIMPLE GETBACKWARDS LOC MD  FIX 13080000
SBMF     DC    C'AN'                    SIMPLE GETBACKWARDS MOVE MD VAR 13140000
GERR     DC    C'AQ'                    GET ERROR ROUTINE               13200000
PERR     DC    C'AR'                    PUT ERROR ROUTINE               13260000
*                                                                       13320000
*  THIS CONCLUDES THOSE QSAM MODULES THAT ARE BEING SUPPORTED NOW       13340000
*                                                                       13360000
*   BELOW ARE THE BSAM MODULES BEING SUPPORTED AT THIS TIME             13420000
*                                                                       13460000
WRH2     DC    C'BA'                    READ-WRITE ROUTINE              13480000
CHECK    DC    C'BB'                    CHECK ROUTINE                   13540000
*                                                                       13640000
*    THIS CONCLUDES THE BSAM MODES BEING SUPPORTED NOW                  13660000
*                                                                       13740000
*   3211 ERROR RETRY MODULE                                             13840020
*                                                                       13940020
ERRMOD   DC    C'FS'        ERR RTRY MOD TTR                     M5150  14340002
IDLEN    DS    0CL2                     LENGTH OF MODULE ID      Y02072 14390002
         SPACE                                                          14440002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 14490002
END      EQU   *                        END OF MODULE            Y02072 14800002
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 14890003
         ORG   WTGIDTTR                                          Y02072 14892002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 14894002
*                                                                       14900000
*                                                                       14920000
CVT      DSECT                                                          14940000
         CVT                                                            14960000
*                                                                       14980000
*                                                                       15000000
BLDEB    DSECT                                                          15020000
DEB      DS    0F                                                       15040000
DEBNMSUB DS    0CL1                                                     15060000
DEBTCBAD DS    CL4                                                      15080000
DEBAMLNG DS    0CL1                                                     15100000
DEBDEBAD DS    CL4                                                      15120000
DEBOGLGS DS    0CL1                                                     15140000
DEBIRBAD DS    CL4                                                      15160000
DEBOPATB DS    0CL1                                                     15180000
DEBSYSPG DS    CL4                                                      15200000
DEBNMEXT DS    0CL1                                                     15220000
DEBUSRPG DS    CL4                                                      15240000
DEBPRIOR DS    0CL1                                                     15260000
DEBECBAD DS    CL4                                                      15280000
DEBPROTG DS    0CL1                                                     15300000
DEBDEBID DS    0CL1                                                     15320000
DEBDCBAD DS    CL4                                                      15340000
DEBEXSCL DS    0CL1                                                     15360000
DEBAPPAD DS    CL4                                                      15380000
DEBDVMOD DS    0CL1                                                     15400000
DEBUCBAD DS    CL4                                                      15420000
DEBBINUM DS    CL2                                                      15440000
DEBSTRCC DS    CL2                                                      15460000
DEBSTRHH DS    CL2                                                      15480000
DEBENDCC DS    CL2                                                      15500000
DEBENDHH DS    CL2                                                      15520000
DEBNMTRK DS    CL2                                                      15540000
*                                                                       15560000
           DCBD  DSORG=PS                                               15580000
*                                                                       15600000
**********************************************************************  15620000
*                                                                       15640000
           END                                                          15660000
./  ADD  SSI=71180732,NAME=IGG01915
 TITLE 'IGG01915-SAM STAGE 3 OPEN EXEC FOR VARIABLE LNGTH/SPANNED RECS' 00100018
IGG01915 CSECT                                                          00200000
*                                                                       00202003
*MODULE NAME - IGG01915                                          Y02072 00210002
*                                                                       00220002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00230002
*                                                                       00240002
*COPYRIGHT - NONE                                                Y02072 00242002
*                                                                       00244002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00246002
*                                                                       00248002
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00250002
*001100,011500,014800,190500,191100,192500-193500,207799-207803, Y02072 00260002
*506050-508150,207840,458000-459000,463000,485000-497000,        Y02072 00270002
*508320,508400-508750                                            Y02072 00320002
*                                                                YM1140 00370002
*                                                                       00420003
*          VS2 RELEASE 3 DELETIONS                                      00470003
*                                                              @Z30TSCF 00480003
* D281200-281700,D307200-307620,A281500,A307500                @ZA01530 00490003
*APAR @ZA08271 UPDATES APAR @ZA01530                           @ZA08271 00492003
*C265000,267000                                                @ZA08271 00494003
*A281500,281560,281620-283500,307500-307740                    @ZA08271 00496003
*          RELEASE 20 DELETIONS                                       * 00500000
*0911207822,207830,613000-614000                                 M5150  00510020
*0911279300-279600,305300-305600                                 A36867 00520020
*0911213000                                                      A31594 00550020
*0911                                                            M2687  00570020
*0911533000,625600-626200                                        S20202 00580020
*0911613000-614000                                               M5701  00590020
*          RELEASE 21 DELETIONS                                       * 00600000
*1093014400,264000-273000,460000,529000-627000,629000-630000     S21042 00620021
*1093533000,625500-626500                                        S21040 00650021
*578000                                                          M1816  00660021
*          RELEASE 22 DELETIONS                                       * 00700000
*          RELEASE 23 DELETIONS                                       * 00800000
*          RELEASE 24 DELETIONS                                       * 00900000
*          RELEASE 25 DELETIONS                                       * 01000000
*          RELEASE 26 DELETIONS                                       * 01100000
*STATUS CHANGE LEVEL 007                                                01150002
*                                                                       01210018
*FUNCTION/OPERATION - THIS MODULE LOADS ACCESS METHOD SUBROUTINES FOR   01220018
*    PROCESSING VARIABLE OR SPANNED RECORDS.  IT DETERMINES WHICH       01230018
*    MODULES SHOULD BE LOADED, LOADS THEM AND ENTERS THE ADDRESS OF     01240018
*    THE LOADED MODULES IN THE APPROPRIATE DCB FIELDS AND THE ID'S IN   01250018
*    THE DEB.  IT LOADS GET/PUT OR READ/WRITE ROUTINES AND ERROR CHECK  01260018
*    ROUTINES.                                                          01270018
*                                                                       01280018
*    THIS MODULE WAS SPLIT FOR RELEASE 18.  THE RESULTING NEW MODULE    01290018
*    IS IGG01991.                                                       01300018
*                                                                       01310018
*ENTRY POINTS - THE MODULE MAY BE ENTERED FROM STAGE 2 EXECUTORS        01320018
*    IGG0191J, IGG0191G, IGG0191D, OR IGG0191P.                         01330019
*                                                                       01340018
*INPUT - SEE DESCRIPTION OF REGISTER CONTENTS                           01350018
*                                                                       01360018
*OUTPUT - ADDRESSES OF SUBROUTINES LOADED ARE PLACED IN DCB, ID'S       01370018
*    ARE PLACED IN DEB SUBROUTINE ID SECTION.                           01380018
*                                                                       01390018
*EXTERNAL ROUTINES - NONE                                               01400018
*                                                                       01400402
*MACROS - ACTION - MODESET, LOAD, XCTL, CIRB, DMABCOND, XCTLTABL Y02072 01402002
*                                                                       01410018
*EXITS - NORMAL - XCTL TO IGG01991 TO COMPLETE LOADING OF ACCESS        01420018
*                 METHOD SUBROUTINES.                                   01430018
*       - ERROR - XCTL TO PROBLEM DETERMINATION FOR WTP AND 013 ABEND   01440021
*                                                                       01450018
*TABLES/WORKAREAS - DESCRIBED BY DSECTS AT END OF MODULE LISTING.       01460018
*                                                                       01470018
*ATTRIBUTES - REENTRANT, REUSABLE, SUPERVISOR STATE,             Y02072 01480002
*             RUNS IN DATA MANAGEMENT KEY UNLESS OTHEWISE        Y02072 01482002
*             SPECIFIED.                                         Y02072 01484002
*                                                                       01490018
*                                                                       01500018
* REGISTER CONVENTIONS                                                  01510018
RE       EQU   0                        WORK REG5                       01560002
RF       EQU   1                        WORK REG6                       01610002
R1       EQU   RF                       PARM REG                 YM1140 01660002
RDCB     EQU   2                        DCB                             01700000
RBASE    EQU   3                        BASE                            01800000
RCORE    EQU   4                        WORE AREA                       01900000
RPAR     EQU   5                        TOP OF PARAMETER                02000000
RWTG     EQU   6                        TOP OF WTG TABLE                02100000
RPARC    EQU   7                        CURRENT PARAMETER               02200000
RWTGC    EQU   8                        CURRENT TRANS LOAD              02300000
RTIOT    EQU   9                        TIOT                            02400000
RUCB     EQU   10                       UCB                             02500000
RDEB     EQU   11                       DEB                             02600000
RB       EQU   12                       WORK REG1                       02700000
RC       EQU   13                       WORK REG2                       02800000
RD       EQU   14                       WORK REG3                       02900000
RJ       EQU   15                       WORK REG4                       03000000
*                                                                       03300000
*                                                                       03400000
PARAR    EQU   RPARC                                                    03500000
THREE    EQU   X'03'                    CONSTANT=3               S20202 03520020
K24      EQU   X'18'                    CONSTANT=24              S20202 03540020
K25      EQU   X'19'                    CONSTANT=25              S20202 03560020
*                                                                       03600000
*********************************************************************** 03700000
*                                                                       03800000
*********************************************************************** 03900000
*                                                                       04000000
* MASK'S TO TEST PARAMETER LIST WITH                                    04100000
*                                                                       04200000
*********************************************************************   04300000
INP      EQU   X'0F'                    MASK                            04400000
OUTP     EQU   X'0F'                    MASK                            04500000
UPDATE   EQU   X'04'                    MASK                            04600000
INOUT    EQU   X'03'                    MASK                            04700000
OUTIN    EQU   X'07'                    MASK                            04800000
RDBACK   EQU   X'01'                    MASK                            04900000
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 04950018
*                                                                       05000000
*                                                                       05100000
*********************************************************************   05200000
*                                                                       05300000
*                                                                       05400000
* OFFSET FOR PARAMETER TESTS                                            05500000
*                                                                       05600000
FRTYATE  EQU   48                       MASK                            05700000
DISPSN   EQU   X'0'                     MASK                            05800000
*                                                                       05900000
*                                                                       06000000
*********************************************************************   06100000
*                                                                       06200000
* OFFSETS FOR DEB REFERENCE                                             06300000
*                                                                       06400000
*                                                                       06500000
ABEAPPOF EQU   17                       OFFSET TO AB END APP     S20202 06540020
*                                       ADDR                     S20202 06560020
FOUR     EQU   X'04'                                             M5150  06590020
BIN      EQU   36                                                       06600000
BEXT     EQU   38                                                       06700000
*                                                                       06800000
*                                                                       06900000
*                                                                       07000000
*********************************************************************   07100000
*                                                                       07200000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              07300000
*                                                                       07400000
*                                                                       07500000
*                                                                       07600000
DOUBLE   EQU   X'01'                    MASK                            07700000
*                                                                       07800000
*                                                                       07900000
STOWB    EQU   X'80'                    MASK                            08000000
WRTCK    EQU   X'80'                    MASK                            08100000
OVRFLO   EQU   X'20'                    MASK                            08200000
PCI      EQU   X'20'                    MASK                            08300000
MINKEY   EQU   X'01'                    MASK                            08400000
CONCAT   EQU   X'FF'                    MASK                            08500000
UTFMASK  EQU   X'02'               MASK FOR TOTALING FACILITY      UT18 08550018
BFTEKR   EQU   X'20'                    MASK FOR OFFSET READ     S19015 08570019
*                                                                       08600000
*********************************************************************   08700000
*                                                                       08710019
* MASKS USED TO TEST OPTION FIELDS IN DEB                               08720019
*                                                                       08730019
INOROUT  EQU   X'0F'                    INPUT OR OUTPUT          S19015 08740019
*                                                                       08750019
******************************************************************      08760019
*                                                                       08800000
* MASKS FOR ACCESS METHODS IN SAM                                       08900000
*                                                                       09000000
QSAMB    EQU   X'01'                    MASK                            09100000
BSAMBIT  EQU   X'00'                    MASK                            09200000
PAM      EQU   X'02'                    MASK                            09300000
*                                                                       09400000
*                                                                       09500000
* MASKS FOR MACRO'S TO BE USED                                          09600000
*                                                                       09700000
GETB     EQU   X'40'                    MASK                            09800000
PUTB     EQU   X'40'                    MASK                            09900000
READB    EQU   X'20'                    MASK                            10000000
WRITEB   EQU   X'20'                    MASK                            10100000
POINTB   EQU   X'04'                    MASK                            10200000
CNTRLB   EQU   X'02'                    MASK                            10300000
*                                                                       10400000
*                                                                       10500000
*********************************************************************   10600000
* MASKS FOR DEVICES TO BE SUPPORTED                                     10700000
*                                                                       10800000
*                                                                       10900000
*********************************************************************   11000000
*                                                                       11100000
*                                                                       11200000
PTR3211  EQU   X'49'                    MASK FOR 3211 PRINTER    S20202 11250020
*                                                                       11300000
*                                                                       11400000
*********************************************************************   11500000
*                                                                       11600000
* MASKS FOR STATUS BITS TO BE TESTED                                    11700000
*                                                                       11800000
*                                                                       11900000
EXCPN    EQU   X'30'                    MASK                            12000000
COMPLETE EQU   X'80'                    MASK                            12100000
FIRSTIOB EQU   X'01'                    MASK                            12200000
*                                                                       12300000
*                                                                       12400000
*                                                                       12500000
*********************************************************************   12600000
*                                                                       12700000
* MASKS FOR BUFFER TECHNIQUE'S                                          12800000
*                                                                       12900000
CYCLICB  EQU   X'20'                                                    13000000
EXCHANGB EQU   X'10'                                                    13100000
SIMPLEB  EQU   X'40'                                                    13200000
EXCHCYCL EQU   X'30'                                                    13300000
*                                                                       13400000
*    MASKS FOR OPEN OVERRIDE OPTIONS                                    13410021
*                                                                       13420021
OVRDMSK  EQU   X'C0'                    INDICATES OPEN OVERRIDE  S21040 13430021
OVRDIN   EQU   X'0F'                    TEST FOR LABEL=(,,,IN)   S21040 13440021
CTDISP   EQU   X'10'                    CT DISPLACEMENT IN TABLE S21040 13450021
*                                                                       13500000
* MODES  OPERATION FOR QSAM                                             13600000
LOCATEB  EQU   X'08'                                                    13700000
MOVEB    EQU   X'10'                                                    13800000
MOVEXCHB EQU   X'14'                                                    13850003
SUBSTUTB EQU   X'04'                                                    13900000
DATAMODE EQU   X'01'                                                    14000000
* COMMAN YTES FOR THE 2841                                              14100000
SRCHE    EQU   X'31'                                                    14200000
WRTCKD   EQU   X'1D'                                                    14300000
RDC      EQU   X'92'                                                    14400000
RDKD     EQU   X'8E'                                                    14500000
RDD      EQU   X'86'                                                    14600000
TIC      EQU   X'08'                                                    14700000
* MASKS   RECORD FORMATS                                                14800000
STANDRDF EQU   X'08'                                                    14900000
FORMATU  EQU   X'C0'                                                    15000000
FORMATF  EQU   X'80'                                                    15100000
FORMATV  EQU   X'40'                                                    15200000
SPANNED  EQU   X'08'                                                    15300000
BLOCKED  EQU   X'10'                                                    15400000
FIXEDBLK EQU   X'90'                                                    15500000
*   CHAN  CONTROL WORD FLAGS                                            15600000
SKIP     EQU   X'10'                                                    15700000
SLI      EQU   X'20'                                                    15800000
CC       EQU   X'40'                                                    15900000
DATACH   EQU   X'A0'                                                    16000000
SLICC    EQU   X'60'                                                    16100000
SLICCSK  EQU   X'70'                                                    16200000
KEYS     EQU   X'01'                                                    16300000
QSAM     EQU   X'01'                                                    16400000
GETMAIN  EQU   4                                                        16500000
XCTL     EQU   7                                                        16600000
LOAD     EQU   8                                                        16700000
ASA      EQU   X'04'                                                    16800000
BKREAD   EQU   X'01'                                                    16900000
URBITS   EQU   X'40'                                                    17000000
TAPEB    EQU   X'80'                                                    17100000
DABIT    EQU   X'20'                                                    17200000
D2       EQU   2                        DISPLACEMENT OF 2        S21040 17210021
D3       EQU   3                        DISPLACEMENT OF 3        S21040 17220021
D6       EQU   6                        DISPLACEMENT OF 6        S21040 17230021
L1       EQU   1                        LENGTH OF 1              S21040 17240021
L4       EQU   4                        LENGTH OF 4              S21040 17250021
R25      EQU   25                       CONSTANT                        17300000
R3       EQU   3                        CONSTANT                        17400000
R5       EQU   5                        CONSTANT                        17500000
R2       EQU   2                        CONSTANT                 S19015 17510019
ATBOFST  EQU   22                       OFFSET TO ATTRIBUTE      S19015 17520019
LENOFST  EQU   27                       OFFSET TO LENGTH OF TEXT S19015 17530019
ONLYLOAD EQU   X'CB'                    ONLY LOADABLE            S19015 17540019
MULTTEXT EQU   X'CA'                    MULTIPLE TEXT            S19015 17550019
UPDATEB  EQU   X'80'                    OPEN FOR UPDATE          S19015 17560019
FLGOFFST EQU   4                        OFFSET TO FLAG IN BCB    S19015 17570019
RAFLAG   EQU   X'80'                    RECORD AREA INDICATOR    S19015 17580019
OABD076  EQU   76                                                S21042 17590021
*                                                                       17600000
*                                                                       17700000
         BALR  RBASE,RE                 SET BASE                        17800000
         USING SLDA,RBASE                                               17900000
         USING IHADCB,RDCB                                              18000000
         USING FORCORE,RCORE                                            18200000
*                                                                       18400000
*                                                                       18500000
SLDA     EQU   *                                                        18600000
         B     BEGIN                    BR AROUND CONSTANTS    @Z30TSCF 18650003
         DC    C'IGG01915'              MODULE ID              @Z30TSCF 18700003
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 18750003
         DC    C'11/18/74'              LAST SHIP DATE         @Z30TSCF 18760003
BEGIN    DS    0H                                                       18770003
*                                                                       18800000
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 18900000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   19000000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 19100000
         USING DEBBASIC,RDEB                                            19150001
         L     RCORE,4(RWTGC)           GET WORK AREA                   19200000
*                                                                       19400000
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           19500000
         USING DEBAVT,RTIOT                                             19550001
         SR    RUCB,RUCB                CLEAR REG                       19600000
         SR    RF,RF                    CLEAR RER                       19700000
         SR    RD,RD                                                    19800000
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           19900000
         IC    RF,DEBEXSCL              GET SCALING FACTOR              20000000
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  20100000
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        20200000
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    20300000
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      20400000
*                                                                       20500000
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB                20600000
*                                                                       20700000
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING          UT18 20706018
         BZ    SLDAA                    BR IF NOT SPECIFIED        UT18 20712018
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 20718018
         BZ    SLDAA                    IF YES,NO TOTALING REQ'RD  UT18 20724018
*                                                                       20730018
*  SINCE UTF WAS SPECIFIED, THE TOTALING SAVE ROUTINE (IGG019AX)        20736018
*  WAS LOADED BY IGG0191Y IN STAGE 1 - SO IT IS NECESSARY TO       UT18 20742018
*  UPDATE THE SUBROUTINE ID POINTER (RUCB) TO POINT TO THE         UT18 20748018
*  SECOND ID SUBFIELD.                                             UT18 20754018
*                                                                  UT18 20760018
         LA    RUCB,2(RUCB)             INCREMENT POINTER BY 2     UT18 20766018
         IC    RD,DEBNMSUB              NO. OF SUBRTNS LOADED SO A29249 20768019
*                                       FAR                      A29249 20770019
*                                                                  UT18 20772018
SLDAA    EQU   *                                                   UT18 20778018
         CLI   DCBDEVT,PTR3211          TEST FOR 3211 PRINTER    S20202 20778220
         BNE   SLDAB                    NO BRANCH AROUND         S20202 20778420
*                                                                       20778620
*   FOR A 3211 PRINTER LOAD AN ABNORMAL END APPENDAGE AND AN ERROR      20778820
*   RETRY MODULE.                                                       20779020
*                                                                       20779220
         LA    RB,ABEAPP11              GET ADDR ABNORMAL END    S20202 20779420
*                                      APP ID                    S20202 20779601
         BAL   RC,SLDROUT              GO LOAD APP AND RETURN    S20202 20779701
         MVC   DEBXCEAD,25(RWTG)       MOVE APP ADDR INTO AVT    S20202 20779801
         LA    RB,ERRMOD                GET ADDR OF ERROR RETRY  S20202 20780620
*                                       MOD                      S20202 20780820
         BAL   RC,SLDROUT               GO LOAD ERROR RETRY MOD  S20202 20781020
*                                       3211                     S20202 20781220
*                                                                       20781420
*   WHEN RETURN FROM 'SLDROUT'- R0 CONTAINS THE ADDR OF THE             20781620
*   ASYNCHRONOUS ERROR ROUTINE. NOW BUILD AN IRB TO BE USED  IN         20781820
*   SCHEDULING THIS ROUTINE                                             20782020
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE)                          20782201
         ST    RF,K24(RWTG)             TEMP SAVE FOR IRB ADDR   S20202 20782420
         MVC   DEBIRBB,25(RWTG)   MOVE IRB ADDR INTO DEB         S20202 20782601
SLDAB    EQU   *                                                 M5150  20783820
         USING WTGENTRY,RWTGC                                    Y02072 20783902
         MVC   WTGIDTTR,NEXTMOD         ID OF NEXT MOD         @Z30TSCF 20789203
         TM    DCBCIND2,QSAMB           DCB FOR QSAM                    20800000
         BC    1,SLD100                YES                              20900000
*                                                                       21100000
         LA    RB,CHECK                 GET ADDRESS OF CHECK ID         21200000
         TM    DCBOFLGS,X'20'          CONCATENATING UNLIKE      A31594 21260020
*                                       ATTRIBUTES               A31594 21320020
         BC    8,SLDA0                  NO BRANCH                       21400000
         BAL   RC,SLDROUT1              STORE THE ID OF CHECK IN DEB    21500000
         B     SLDA1                    DO NOT LOAD CHECK ROUTINE       21600000
*                                                                       21700000
SLDA0    BAL   RC,SLDROUT               LOAD CHECK ROUTINE              21800000
         MVC   DCBECC(R3),R25(RWTG)     LOAD CHECK ADDR INTO DCB        21900000
*                                                                       22000000
SLDA1    EQU   *                                                        22100000
         TM    DCBBFTEK,BFTEKR          VS SUPPORT NEEDED        S19015 22110019
         BZ    SLDA3                    NO--BRANCH               S19015 22120019
         LA    RB,OFFSETRD              OFFSET READ ID           S19015 22130019
         B     SLDA4                    GO TO LOAD ROUTINE       S19015 22140019
*                                                                       22150019
*                                                                       22200000
SLDA3    EQU   *                                                 S19015 22250019
         LA    RB,WRH2                  GET RD/WRT ID ADDRESS           22300000
SLDA4    EQU   *                                                 S19015 22350019
         BAL   RC,SLDROUT               TO LOAD FUNCTION                22400000
         MVC   DCBREAD+1(R3),R25(RWTG)  LOAD R/W ADDR.                  22500000
         B     SLDEOB                   GET SPECIAL ROUTINES            22600000
SLD100   EQU   *                                                        22700000
         TM    DCBCIND2,UPDATEB         IS THIS UPDATE           S19015 22760019
         BO    SLD106                   YES, LOAD UPDATE ERR RTN S19015 22820019
         TM    DISPSN(PARAR),OUTP       DCB FOR OUTPUT                  22900000
         BC    1,SLD200                 YES, BRANCH                     23000000
*                                                                       23100000
         LA    RB,GERR                  GET ADDRESS OF GERR ID          23200000
         B     SLD107                   BRANCH TO TEST ATTRIBUTE S19015 23210019
*                                                                       23220019
SLD106   EQU   *                                                 S19015 23230019
*                                                                       23240019
         LA    RB,UERR                  GET ADDRESS OF UERR ID   S19015 23250019
*                                                                       23260019
SLD107   EQU   *                                                 S19015 23270019
*                                                                       23300000
         TM    DCBOFLGS,X'20'           CONTATENTION UNLIKE ATTRIBUTES/ 23400000
         BC    8,SLD100A                NO, BRANCH                      23500000
*                                                                       23600000
         BAL   RC,SLDROUT1                                              23700000
         B     SLD101                   TO CHECK NEXT PARAMETER         23800000
*                                                                       23900000
*                                                                       24000000
SLD150   EQU   *                                                        24100000
         BAL   RC,SLDROUT               TO LOADING FUNCTION             24200000
*                                                                       24230019
SLD151   EQU   *                                                 S19015 24260019
         MVC   DCBGET+1(3),25(RWTG)     INSERT ADDRESS OF THE MODULE    24300000
         B     SLDEOB                   JUST LOADED INTO DCB FIELD      24400000
*                                                                       24500000
SLD100A  EQU   *                                                        24600000
         BAL   RC,SLDROUT               TO OUTPUT                       24700000
         MVC   DCBGERR+1(3),25(RWTG)    LOAD GERR ADDR. IN DCB          24800000
*                                                                       24900000
*                                                                       25000000
SLD101   EQU   *                                                        25100000
         CLI   DCBLRECL,X'80'          LRECL=X                          25200000
         BE    CHECKLOC                YES                              25300000
SLD172   EQU   *                                                        25400000
*                                                                       25500000
         TM    DCBRECFM,SPANNED                                         25600000
         BO    SLD173                   NOT SPANNED                     25700000
         TM    DCBMACRF,MOVEXCHB        MOVE OR SUBST?         @Z30TSMI 25800003
         BNZ   SLD171                   YES                    @Z30TSMI 25900003
         LA    RB,GL                   IGG019AB                         26000000
         B     SLD150                   DONE                            26100000
CHECKLOC TM    DCBMACRF,LOCATEB        IS IT LOCATE MODE                26200000
         BO    SLD172                  YES                              26300000
ABEND013 DMABCOND OABD076,PDLOAD,RETURN=NONE,RES=NO,           @ZA08271*26500003
               REGSAVE=YES              CALL PROBLEM DETERM    @ZA08271 26700003
         B     TCTLRTN                                           S21042 26900021
SLD171   EQU   *                                                        27400000
         LA    RB,GM                   IGG019AD                         27500000
         B     SLD150                   DONE                            27600000
SLD173   EQU   *                                                        27700000
         TM    DCBCIND2,UPDATEB         IS THIS UPDATE           S19015 27730019
         BO    SLD170                   YES, BRANCH              S19015 27760019
         TM    DCBMACRF,DATAMODE        DCB USING DATA MODE             27800000
         BO    SLD176                   NOT DATA MODE                   27900000
         TM    DCBMACRF,MOVEXCHB        MOVE OR SUBST?         @Z30TSMI 28000003
         BNZ   SLD177                   YES                    @Z30TSMI 28100003
         L     RC,DCBBUFCB              GET BUFFCB ADDRESS     @ZA08271 28150003
         LA    RC,DISPSN(RC)            CLEAR HI ORDER BYTE    @ZA08271 28156003
         MODESET KEYADDR=DXUKEY,WORKREG=15 GET USER KEY        @ZA08271 28162003
         TM    FLGOFFST(RC),RAFLAG      RECORD AREA PRESENT?   @ZA08271 28168003
         MODESET EXTKEY=DATAMGT                                @ZA08271 28174003
         BO    SLD169                   YES, BRANCH              S19015 28180019
         LA    RB,GLS                  IGG019FB                         28200000
         B     SLD150                   ALL DONE                        28300000
*                                                                       28310019
SLD169   EQU   *                                                 S19015 28320019
         TM    DCBLRECL,X'80'           LRECL=X                @ZA08271 28330003
         BO    ABEND013                 YES-GO ABEND           @ZA08271 28335003
         LA    RB,GLSLR                 GET SPECIAL GET MODULE   S19015 28340019
         B     SLD150                   ALL DONE                 S19015 28350019
SLD170   EQU   *                                                 S19015 28360019
         LA    RB,UGET                  GET UPDATE GET MODULE    S19015 28370019
         B     SLD150                   LOAD                     S19015 28380019
SLD176   EQU   *                                                        28400000
         LA    RB,GDS                  IGG019FF                         28500000
         B     SLD150                   ALL DONE                        28600000
SLD177   EQU   *                                                        28700000
         LA    RB,GMS                  IGG019FD                         28800000
         B     SLD150                   ALL DNOE                        28900000
SLD200   LA    RB,PERR                  GET THE ADDR. OF PERR ID INTO   29000000
         BAL   RC,SLDROUT               LOAD SUBROUTINE                 29100000
         MVC   DCBPERR+1(3),25(RWTG)    INSERT PERR ADDR. INTO DCB      29200000
*                                                                       29300000
         TM    DCBRECFM,SPANNED         SPANNED                         29400000
         BO    SLD175                   NOT SPANNED                     29500000
         TM    DCBMACRF+1,MOVEXCHB      MOVE OR SUBST?         @Z30TSMI 29600003
         BNZ   SLD174                   YES, BRANCH            @Z30TSMI 29700003
         LA    RB,PL                   IGG019AJ                         29800000
         B     SLD150                   GO TO NEXT CHECKING             29900000
SLD174   EQU   *                                                        30000000
         LA    RB,PM                   IGG019AL                         30100000
         B     SLD150                   GO TO NEXT CHECKING             30200000
SLD175   EQU   *                                                        30300000
         TM    DCBMACRF+1,DATAMODE                                      30400000
         BO    SLD178                  SKIP                             30500000
         TM    DCBMACRF+1,MOVEXCHB      MOVE OR SUBST?         @Z30TSMI 30600003
         BNZ   SLD179                   YES                    @Z30TSMI 30700003
         L     RB,DCBBUFCB             GET BUFFCB ADDRESS      @ZA08271 30750003
         LA    RB,DISPSN(RB)           CLEAR HI ORDER BYTE     @ZA08271 30756003
         MODESET KEYADDR=DXUKEY,WORKREG=15  GET USER KEY       @ZA08271 30762003
         TM    FLGOFFST(RB),RAFLAG     LRI PRESENT?            @ZA08271 30768003
         MODESET EXTKEY=DATAMGT                                @ZA08271 30774003
         BO    SLD180                   YES, BRANCH LD BP        S19015 30780003
         LA    RB,PLS                  IGG019FJ                         30800000
         B     SLD150                   GO TO NEXT CHECKING             30900000
SLD180   EQU   *                                                 S19015 30920019
         LA    RB,PLSLR                 GET SPECIAL PUT MODULE   S19015 30940019
         B     SLD150                   TO NEXT ONE              S19015 30960019
SLD179   EQU   *                                                        31000000
         LA    RB,PMS                  IGG019FL                         31100000
         B     SLD150                   TO NEXT ONE                     31200000
SLD178   EQU   *                                                        31300000
         LA    RB,PDS                  IGG019FG                         31400000
         B     SLD150                   TO NEXT ONE                     31500000
SLDEOB   EQU   *                                                        31600000
         STC   RD,DEBNMSUB              STORE NBR OF MODULES       UT18 37600018
*                                                                       43900000
*    THIS SECTION OF CODE UP TO THE LABEL ENDOVER WILL ENSURE THAT      43903021
*    THE EOB ROUTINE IGG019CT GETS LOADED FOR ANY OPEN OVERRIDE.        43906021
*    ROUTINE LOADED BY IGG01991.                                        43909021
*                                                                       43912021
         TM    JFCBMASK+D6,OVRDMSK      WAS AN OVERRIDE USED     S21040 43915021
         BNO   ENDOVR                   BR IF NO                 S21040 43918021
         TM    0(RPARC),OVRDIN          WAS IT LABEL=(,,,IN)     S21040 43921021
         BZ    INCHNG                   BRANCH IF YES            S21040 43924021
         MVC   DCBCNTRL+D2(L1),DCBCNTRL+D3 SAVE WRITE EOB DISP   S21040 43927021
         MVI   DCBCNTRL+D3,CTDISP       SET READ EOB ROUTINE FOR S21040 43930021
*                                       THE ERROR EOB ROUTINE           43933021
         B     ENDOVR                   CONTINUE                 S21040 43936021
INCHNG   EQU   *                                                 S21040 43939021
         MVI   DCBCNTRL+D2,CTDISP       SET WRITE EOB ROUTINE    S21040 43942021
*                                        FOR ERROR EOB ROUTINE          43945021
ENDOVR   EQU   *                                                 S21040 43948021
*                                                                       43951021
*    IF USER TOTALING WAS SPECIFIED, EOB ROUTINES CONTAINING            43954021
*    LINKAGE TO THE TOTALING SAVE ROUTINES MUST BE LOADED INSTEAD       43957021
*    OF NORMAL EOB ROUTINES.  THIS IS ACCOMPLISHED BY DOING A           43960021
*    TRANSLATE OF THE DCBCNTRL FIELD TO CONVERT NORMAL EOB              43963021
*    DISPLACEMENTS INTO DISPLACEMENTS FOR THE UTF EOB ROUTINES.         43966021
*    EOB ROUTINES ARE LOADED BY IGG01991.                               43969021
*                                                                       43972021
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING OPTION S21040 43975021
         BZ    SLD250                   BR IF NOT SPECIFIED      S21040 43978021
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK S21040 43981021
         BZ    SLD250                   BR YES NO TOTALING REQ'D S21040 43984021
         TR    DCBCNTRL(L4),UTFTBL      CHANGE TO UTF DISP.      S21040 43987021
SLD250   EQU   *                                                 S21040 43990021
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        44000000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     44100000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            44200000
         BCR   8,RBASE                  BACK TO OPEN CONTROL            44300000
*                                                                       44400000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    44500000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             44600000
*                                                                       44700000
         LR    RPARC,RPAR                                               44800000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       44900000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           45000000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         45100000
*                                                                       45200000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  45300000
         LA    RPARC,PLOFF(0,RPARC)                                     45400000
         B     ZCHEK                    COMPLETE                        45500000
*                                                                       45600000
TCTLRTN  EQU   *                                                        45700000
         USING WTG,RWTG                                                 45750003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*45800003
               MODID=WTGENTRY                                  @Z30TSCF 45850003
         DROP  RWTGC,RWTG                                      @Z30TSCF 45900003
*                                                                       48000000
*                                                                       48100000
*                                                                       48200000
         DS    0H                       HALF WORD BOUNDARY              48300000
SLDROUT  EQU   *                                                        48400000
         USING WTGMODNM,RWTG                                     Y02072 48450002
         MVC   WTGMODID,0(RB)           ID TO MOD NAME           Y02072 48500002
         DROP  RWTG                                              Y02072 48550002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 48600002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 48650002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 48700002
         DROP  R1                       DROP CVT BASE            YM1140 48750002
*                                                                       48800002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 49700002
*                                                                       49800000
*                                                                       49900000
*                                                                       50000000
         ST    RE,24(RWTG)             TEMP STORE OF ROUTINE ADDR,      50100000
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        50200000
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               50300000
         LA    RD,1(RD)                 ONE MORE SUB RT LOADED          50400000
         BR    RC                      RETURN                           50500000
*                                                                       50600000
WAOFF    EQU   32                                                       50820018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           50825018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           50830018
OPIDCNST DC    C'0S'                    ID                              50835018
AMIDCNST DC    C'15'                    MODULE ID                       50880018
*                                                                       50900000
*                                                                       50903021
*    THE FOLLOWING TABLE IS USED WITH A TRANSLATE INSTRUCTION TO        50906021
*    CONVERT DISPLACEMENTS FOR THE EOB TABLE INTO THOSE FOR THE         50909021
*    ENTRIES FOR THE CORRESPONDING UTF ROUTINES.                        50912021
*                                                                       50915021
UTFTBL   EQU   *                                                 S21040 50918021
         DC    X'00'                    NO CHANGE                S21040 50921021
         DC    X'0B'                    IGG019CD TO IGG019TD     S21040 50924021
         DC    X'0C'                    IFG019CC TO IGG019TC     S21040 50927021
         DC    X'03'                    NO CHANGE                S21040 50930021
         DC    X'04'                    NO CHANGE                S21040 50933021
         DC    X'05'                    NO CHANGE                S21040 50936021
         DC    X'06'                    NO CHANGE                S21040 50939021
         DC    X'07'                    NO CHANGE                S21040 50942021
         DC    X'08'                    NO CHANGE                S21040 50945021
         DC    X'09'                    NO CHANGE                S21040 50948021
         DC    X'0A'                    NO CHANGE                S21040 50951021
         DC    X'0B'                    NO CHANGE                S21040 50954021
         DC    X'0C'                    NO CHANGE                S21040 50957021
         DC    X'0D'                    NO CHANGE                S21040 50960021
         DC    X'0E'                    NO CHANGE                S21040 50963021
         DC    X'0F'                    NO CHANGE                S21040 50966021
         DC    X'10'                    NO CHANGE                S21040 50969021
*                                                                       50972021
*    NOTE, THERE MUST BE AN ENTRY IN THIS TRANSLATE TABLE FOR           50975021
*    EACH ENTRY IN THE EOB TABLE.                                       50978021
*                                                                       50981021
*                                                                       51000000
*                                                                       52600000
*********************************************************************** 52700000
*                                                                       52800000
*         MODULE IDS LOADED BY THIS MODULE                              52850002
*                                                                       52900002
NEXTMOD  DC    C'91',VL3(IGG01991)      ID OF MODULE IGG01991  @Z30TSCF 52950003
PERR     DC    C'AR'                    ID OF MODULE IGG019AR    Y02072 53000002
GERR     DC    C'AQ'                    ID OF MODULE IGG019AQ    Y02072 53050002
UERR     DC    C'BQ'                    ID OF MODULE IGG019BQ    Y02072 53100002
UGET     DC    C'BN'                    ID OF MODULE IGG019BN    Y02072 53150002
GL       DC    C'AB'                    ID OF MODULE IGG019AB    Y02072 53200002
GM       DC    C'AD'                    ID OF MODULE IGG019AD    Y02072 53250002
PL       DC    C'AJ'                    ID OF MODULE IGG019AJ    Y02072 53300002
PM       DC    C'AL'                    ID OF MODULE IGG019AL    Y02072 53350002
GLSLR    DC    C'BO'                    ID OF MODULE IGG019BO    Y02072 53400002
GLS      DC    C'FB'                    ID OF MODULE IGG019FB    Y02072 53450002
GMS      DC    C'FD'                    ID OF MODULE IGG019FD    Y02072 53500002
GDS      DC    C'FF'                    ID OF MODULE IGG019FF    Y02072 53550002
PLSLR    DC    C'BP'                    ID OF MODULE IGG019BP    Y02072 53600002
PLS      DC    C'FJ'                    ID OF MODULE IGG019FJ    Y02072 53650002
PMS      DC    C'FL'                    ID OF MODULE IGG019FL    Y02072 53700002
PDS      DC    C'FG'                    ID OF MODULE IGG019FG    Y02072 53750002
WRH2     DC    C'BA'                    ID OF MODULE IGG019BA    Y02072 53800002
OFFSETRD DC    C'BU'                    ID OF MODULE IGG019BU    Y02072 53850002
CHECK    DC    C'BB'                    ID OF MODULE IGG019BB    Y02072 53900002
ABEAPP11 DC    C'FR'                    ID OF MODULE IGG019FR    Y02072 53950002
ERRMOD   DC    C'FS'                    ID OF MODULE IGG019FS    Y02072 54000002
PDLOAD   DC    C'6M',VL3(IGG0196M)      ID OF MODULE IGG0196M  @Z30TSCF 54050003
*                                                                       54060002
PATCH    DC    0H'0',C'IGG01915',XL42'00'   PATCH AREA           Y02072 54100002
 TITLE 'IGG01915 - FORMAT OF GOTTEN CORE'                               62800018
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 62900003
         ORG   WTGIDTTR                                          Y02072 62950002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 63000002
*                                                                       63100000
*                                                                       63200000
CVT      DSECT                                                          63300000
         CVT                                                            63400000
*                                                                       63500000
*                                                                       63600000
         IEZDEB                                                         63700001
*                                                                       66400000
           DCBD  DSORG=PS                                               66500000
DCBECC   EQU   DCBCHECK+1               DCB FIELD                       66600000
         END                                                            66700000
./  ADD  SSI=71180734,NAME=IGG01916
 TITLE 'IGG01916-SAM STG 3 OPEN EXEC FOR VLR/SPANNED/TRK OVFLO/PCI'     00200018
IGG01916 CSECT                                                          00400000
*MODULE NAME - IGG01916                                          Y02072 00410002
*                                                                       00420002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00430002
*                                                                       00440002
*COPYRIGHT - NONE                                                Y02072 00442002
*                                                                       00444002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00446002
*                                                                       00448002
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00450002
*002500,023000,032400,236500,238500,240500-241500,263600,586000, Y02072 00500002
*578000-580000,614000-644000,646000                              Y02072 00550002
*                                                                YM1140 00600002
*                                                                       00650003
*          VS2 RELEASE 3 DELETIONS                                      00700003
*D332400-333600,A333000-333608                                 @ZA01530 00710003
*                                                              @Z30TSCF 00750003
*          RELEASE 21 DELETIONS                                       * 01200000
*2963648000-654000                                               A39228 01250021
*2963031200,348000-358000,582000,688000-820000,824000-826000     S21042 01300021
*                                                                       01400002
*STATUS CHANGE LEVEL 006                                                02300002
*                                                                       02430018
*FUNCTION/OPERATION - THIS MODULE LOADS ACCESS METHOD SUBROUTINES FOR   02460018
*    PROCESSING VARIABLE OR SPANNED RECORDS.  IT DETERMINES WHICH       02490018
*    MODULES SHOULD BE LOADED, LOADS THEM AND ENTERS THE ADDRESS OF     02520018
*    THE LOADED MODULES IN THE APPROPRIATE DCB FIELDS AND THE ID'S IN   02550018
*    THE DEB.  IT LOADS GET/PUT OR READ/WRITE ROUTINES AND ERROR CHECK  02580018
*    ROUTINES.                                                          02610018
*                                                                       02640018
*    THIS MODULE WAS SPLIT FOR RELEASE 18.  THE RESULTING NEW MODULE    02670018
*    IS IGG01992.                                                       02700018
*                                                                       02730018
*ENTRY POINTS - THE MODULE MAY BE ENTERED FROM STAGE 2 EXECUTOR         02760018
*    IGG0191H.                                                          02790018
*                                                                       02820018
*INPUT - SEE DESCRIPTION OF REGISTER CONTENTS                           02850018
*                                                                       02880018
*OUTPUT - ADDRESSES OF SUBROUTINES LOADED ARE PLACED IN DCB, ID'S       02910018
*    ARE PLACED IN DEB SUBROUTINE ID SECTION.                           02940018
*                                                                       02970018
*EXTERNAL ROUTINES - NONE                                               03000018
*                                                                       03010002
*MACROS - ACTION - MODESET, XCTL, LOAD, DMABCOND, XCTLTABL       Y02072 03020002
*                                                                       03030018
*EXITS - NORMAL - XCTL TO IGG01992 TO COMPLETE LOADING OF ACCESS        03060018
*                 METHOD SUBROUTINES.                                   03090018
*       - ERROR - XCTL TO PROB DET FOR WTP AND 013 ABEND                03120021
*                                                                       03150018
*TABLES/WORKAREAS - DESCRIBED BY DSECTS AT END OF MODULE LISTING.       03180018
*                                                                       03210018
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT       Y02072 03240002
*             KEY UNLESS OTHERWISE SPECIFIED, SUPERVISOR STATE   Y02072 03290002
*                                                                       03300018
* REGISTER CONVENTIONS                                                  03330018
*                                                                       03400000
RE       EQU   0                        WORK REG5                       03600000
RF       EQU   1                        WORK REG6                       03800000
R1       EQU   RF                       PARM REG                 YM1140 03850002
RDCB     EQU   2                        DCB                             04000000
RBASE    EQU   3                        BASE                            04200000
RCORE    EQU   4                        WORE AREA                       04400000
RPAR     EQU   5                        TOP OF PARAMETER                04600000
RWTG     EQU   6                        TOP OF WTG TABLE                04800000
RPARC    EQU   7                        CURRENT PARAMETER               05000000
RWTGC    EQU   8                        CURRENT TRANS LOAD              05200000
RTIOT    EQU   9                        TIOT                            05400000
RUCB     EQU   10                       UCB                             05600000
RDEB     EQU   11                       DEB                             05800000
RB       EQU   12                       WORK REG1                       06000000
RC       EQU   13                       WORK REG2                       06200000
RD       EQU   14                       WORK REG3                       06400000
RJ       EQU   15                       WORK REG4                       06600000
T3       EQU   3                                                        06800000
T25      EQU   25                       25                              07000000
PARAR    EQU   RPARC                                                    07200000
* MASK'S TO TEST PARAMETER LIST WITH                                    07400000
INP      EQU   X'0F'                    MASK                            07600000
OUTP     EQU   X'0F'                    MASK                            07800000
INOUT    EQU   X'03'                    MASK                            08000000
OUTIN    EQU   X'07'                    MASK                            08200000
RDBACK   EQU   X'01'                    MASK                            08400000
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 08500018
* OFFSET FOR PARAMETER TESTS                                            08600000
FRTYATE  EQU   48                       MASK                            08800000
ONE      EQU   X'01'                                                    09000000
DISPSN   EQU   X'0'                                                     09200000
* OFFSETS FOR DEB REFERENCE                                             09400000
BIN      EQU   36                                                       09600000
BEXT     EQU   38                                                       09800000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              10000000
DOUBLE   EQU   X'01'                                                    10200000
STOWB    EQU   X'80'                                                    10400000
WRTCK    EQU   X'80'                                                    10600000
OVRFLO   EQU   X'20'                                                    10800000
CONCAT   EQU   X'FF'                                                    11000000
MINKEY   EQU   X'01'                                                    11200000
PCI      EQU   X'20'                                                    11400000
UTFMASK  EQU   X'02'               MASK FOR TOTALING FACILITY      UT18 11500018
* MASKS FOR ACCESS METHODS IN SAM                                       11600000
QSAMB    EQU   X'01'                    MASK                            11800000
BSAMBIT  EQU   X'00'                    MASK                            12000000
PAM      EQU   X'02'                    MASK                            12200000
* MASKS FOR MACRO'S TO BE USED                                          12400000
GETB     EQU   X'40'                    MASK                            12600000
PUTB     EQU   X'40'                    MASK                            12800000
READB    EQU   X'20'                    MASK                            13000000
WRITEB   EQU   X'20'                    MASK                            13200000
POINTB   EQU   X'04'                    MASK                            13400000
CNTRLB   EQU   X'02'                                                    13600000
* MASKS FOR STATUS BITS TO BE TESTED                                    13800000
EXCPN    EQU   X'30'                    MASK                            14000000
COMPLETE EQU   X'80'                                                    14200000
FIRSTIOB EQU   X'01'                    MASK                            14400000
* MASKS FOR BUFFER TECHNIQUE'S                                          14600000
EXCHANGB EQU   X'10'                                                    14800000
SIMPLEB  EQU   X'40'                                                    15000000
* MODES  OPERATION FOR QSAM                                             15200000
LOCATEB  EQU   X'08'                                                    15400000
MOVEB    EQU   X'10'                                                    15600000
MOVEXCHB EQU X'14'                                                      15800000
SUBSTUTB EQU   X'04'                                                    16000000
* COMMAN YTES FOR THE 2841                                              16200000
SRCHE    EQU   X'31'                                                    16400000
WRTCKD   EQU   X'1D'                                                    16600000
RDC      EQU   X'92'                                                    16800000
RDKD     EQU   X'8E'                                                    17000000
RDD      EQU   X'86'                                                    17200000
TIC      EQU   X'08'                                                    17400000
* MASKS   RECORD FORMATS                                                17600000
STANDRDF EQU   X'08'                                                    17800000
FORMATU  EQU   X'C0'                                                    18000000
FORMATF  EQU   X'80'                                                    18200000
FORMATV  EQU   X'40'                                                    18400000
SPANNED  EQU   X'08'                                                    18600000
BLOCKED  EQU   X'10'                                                    18800000
FIXEDBLK EQU   X'90'                                                    19000000
*   CHAN  CONTROL WORD FLAGS                                            19200000
SKIP     EQU   X'10'                                                    19400000
SLI      EQU   X'20'                                                    19600000
DATACH   EQU   X'A0'                                                    19800000
CC       EQU   X'40'                                                    20000000
SLICC    EQU   X'60'                                                    20200000
SLICCSK  EQU   X'70'                                                    20400000
KEYS     EQU   X'01'                                                    20600000
QSAM     EQU   X'01'                                                    20800000
ASA      EQU   X'04'                                                    21000000
BKREAD   EQU   X'01'                                                    21200000
URBITS   EQU   X'40'                                                    21400000
TAPEB    EQU   X'80'                                                    21600000
DABIT    EQU   X'20'                                                    21800000
FLGOFFST EQU   4                        OFFSET TO FLAG IN BCB    S19015 21840019
RAFLAG   EQU   X'80'                    RECORD AREA PRESENT      S19015 21960019
OABD076  EQU   76                                                S21042 21980021
         BALR  RBASE,RE                 SET BASE                        22000000
         USING SLDA,RBASE                                               22200000
         USING IHADCB,RDCB                                              22400000
         USING BLDEB,RDEB                                               22600000
         USING FORCORE,RCORE                                            22800000
SLDA     EQU   *                                                        23200000
         B     BEGIN                    BR AROUND CONSTANTS    @Z30TSCF 23250003
         DC    C'IGG01916'              MODULE NAME            @Z30TSCF 23300003
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 23350003
         DC    C'11/18/74'              LAST SHIP DATE         @Z30TSCF 23360003
BEGIN    DS    0H                                                       23370003
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 23400000
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   23600000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 23800000
         L     RCORE,4(RWTGC)           GET WORK AREA                   24000000
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  24200000
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           24400000
         SR    RUCB,RUCB                CLEAR REG                       24600000
         SR    RF,RF                    CLEAR RER                       24800000
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           25000000
         IC    RF,DEBEXSCL              GET SCALING FACTOR              25200000
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  25400000
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        25600000
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    25800000
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      26000000
*                                                                       26200000
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB                26210018
*                                                                       26220018
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING          UT18 26230018
         BZ    SLDAA                    BR IF NOT SPECIFIED        UT18 26240018
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 26250018
         BZ    SLDAA                    IF YES,NO TOTALING REQ'RD  UT18 26260018
*                                                                       26270018
*  SINCE UTF WAS SPECIFIED, THE TOTALING SAVE ROUTINE (IGG019AX)        26280018
*  WAS LOADED BY IGG0191Y IN STAGE 1 - SO IT IS NECESSARY TO       UT18 26290018
*  UPDATE THE SUBROUTINE ID POINTER (RUCB) TO POINT TO THE         UT18 26300018
*  SECOND ID SUBFIELD.                                             UT18 26310018
*                                                                  UT18 26320018
         LA    RUCB,2(RUCB)             INCREMENT POINTER BY 2     UT18 26330018
*                                                                  UT18 26340018
SLDAA    EQU   *                                                   UT18 26350018
         USING WTGENTRY,RWTGC                                    Y02072 26352002
         MVC   WTGIDTTR,NEXTMOD         ID OF NEXT MOD TO WTG  @Z30TSCF 26354003
         TM    DCBCIND2,QSAMB          DCB FOR QSAM                     26400000
         BO    SLD100                  YES,BRANCH                       26600000
         LA    RB,CHECK                GET ID OF CHECK ROUTINE          26800000
         B     SLD105                   BRANCH                          27200000
SLD100   EQU   *                                                        27400000
         LA    RB,GERR                 GET GERR ROUTINE ID              27800000
         TM    DISPSN(PARAR),OUTP      DCB FOR OUTPUT                   28000000
         BO    SLD200                  YES, BRANCH                      28200000
*                                                                       28400000
SLD105   EQU   *                                                        28600000
         TM    DCBOFLGS,X'20'           CONCATENATION UNLIKE ATTRIBUTES 28800000
         BZ    SLDA0                   NO,GO TO LOAD ROUTINE            29000000
         BAL   RC,SLDROUT1             STORE CHECK OR GERR ID IN DEB    29200000
         B     SLDA1                    BRANCH                          29400000
SLDA0    EQU   *                                                        29600000
         BAL   RC,SLDROUT              GO TO LOAD ROUTINE               29800000
         MVC   DCBCHECZ(T3),T25(RWTG)   STORE ID IN DCB                 30000000
SLDA1    EQU   *                                                        30200000
         TM    DCBCIND2,QSAMB          DCB FOR QSAMB                    30400000
         BO    SLD101                  YES,BRANCH                       30600000
         LA    RB,WRH2                 GET READ WRITE ID                30800000
         B     SLD150                  GO TO LOAD ROUTINE               31000000
SLD101   EQU   *                        DETERMINE TO LOAD PROPER MODUL  31200000
         CLI   DCBLRECL,X'80'           LRECL=X                         31400000
         BE    CHECKLOC                 TO CHECK WHEATHER IT IS LOCATE  31600000
SLD172   LA    RB,SGMF                  GET THE ENTRY OF TABLE          31800000
         TM    DCBMACRF,QSAMB           DATA MODE                       32000000
         BO    SLD171                   IF YES, BRANCH TO IT            32200000
         TM    DCBMACRF,MOVEXCHB        MOVE OR SUBST. MODE?   @Z30TSMI 32400003
         BNZ   SLD170                   IF YES, BRANCH         @Z30TSMI 32600003
SLD173   LA    RB,2*L'NXTENTRY(RB)      STEP TO LOCATE MODE ENT  Y02072 32650002
SLD170   TM    DCBRECFM,STANDRDF        SPANNED RECORD?                 33000000
         BZ    SLD150                   IF NO, BRANCH                   33200000
         TM    DCBMACRZ,MOVEB           MOVE MODE?             @ZA01530 33300003
         BO    SLD175                   YES, LOAD FL           @ZA01530 33350003
         TM    DCBBFTEK,X'60'           LRI PRESENT            @ZA01530 33350403
         BO    SLD174                   YES, LOAD BP           @ZA01530 33350803
SLD175   EQU   *                                               @ZA01530 33360803
         LA    RB,L'NXTENTRY(RB)        STEP TO SPANNED MODULE   Y02072 33370002
         B     SLD150                   DONE                            33600000
SLD174   LA    RB,3*L'NXTENTRY(RB)      GET SPECIAL LOCATE       Y02072 33610002
*                                       MODULE                   S19015 33700019
         B     SLD150                   ALL DONE                 S19015 33750019
*                                                                       33800000
SLD171   LA    RB,4*L'NXTENTRY(RB)      GET DATA MODE MODULE ENT Y02072 33850002
         B     SLD150                   TO LOADER                       34200000
CHECKLOC TM    DCBMACRF,LOCATEB         LOCATE MODE?                    34400000
         BO    SLD172                   IF YES, BRANCH                  34600000
         DMABCOND OABD076,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X34900021
                                        CALL PROBLEM DETERMINATION      35200021
         B     TCTLRTN                                           S21042 35500021
SLD200   LA    RB,PERR                  GET ADDRESS OF PERR ID          36000000
         BAL   RC,SLDROUT               TO LOAD SUBROUTINE              36200000
         MVC   DCBPERZ(T3),T25(RWTG)    LOAD PERR ADDR.                 36400000
SLD250   LA    RB,SPMF                  (RB)=ENTRIES OF PUT MODULES     36600000
         TM    DCBMACRZ,QSAMB           DATA MODE?                      36800000
         BO    SLD171                   BRANCH IF YES                   37000000
         TM    DCBMACRZ,MOVEXCHB        MOVE OR SUBST. MODE?   @Z30TSMI 37200003
         BNZ   SLD170                   BRANCH IF YES          @Z30TSMI 37400003
         B     SLD173                   BRANCH IF YES                   37600000
SLD150   EQU   *                                                        37800000
         BAL   RC,SLDROUT               TO LOAD FUNCTION                38000000
         MVC   DCBGETZ(T3),T25(RWTG)   PUT ADDRESS IN DCBGET/READ       38200000
SLDEOB   EQU   *                                                        38400000
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        55000000
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     55200000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            55400000
         BCR   RWTGC,RBASE              RETURN                          55600000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    55800000
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             56000000
         LR    RPARC,RPAR                                               56200000
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       56400000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           56600000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         56800000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  57000000
         LA    RPARC,PLOFF(0,RPARC)                                     57200000
         B     ZCHEK                    TO ZERO CHECK                   57400000
TCTLRTN  EQU   *                                                        57600000
         USING WTG,RWTG                                                 57650003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*57700003
               MODID=WTGENTRY                                  @Z30TSCF 57750003
         DROP  RWTGC,RWTG                                      @Z30TSCF 57800003
*                                                                       60800000
         DS    0H                       HALF WORD ALIGMENT              61000000
SLDROUT  EQU   *                                                        61200000
         USING WTGMODNM,RWTG                                     Y02072 61250002
         MVC   WTGMODID,0(RB)           ID TO MOD NAME           Y02072 61300002
         DROP  RWTG                                              Y02072 61350002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 61400002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 61450002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 61500002
         DROP  R1                       DROP CVT BASE            YM1140 61550002
*                                                                       61600002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 64600002
         ST    RE,24(RWTG)              TEMP STORE OF ROUTINE ADDR,     65600000
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        65800000
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               66000000
         SR    RD,RD                                             A39228 66020021
         IC    RD,DEBNMSUB              GET NO. OF SUBROUTINES   A39228 66040021
*                                       LOADED                   A39228 66060021
         LA    RD,1(RD)                 ADD ONE TO TOTAL         A39228 66080021
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF       A39228 66100021
*                                       SUBROUTINES LOADED              66120021
         BR    RC                      RETURN                           66200000
         EJECT                                                          66250002
WAOFF    EQU   32                                                       68150018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           68200018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           68250018
*                                                                       68260002
*  MODULE ID'S                                                          68270002
*                                                                       68280002
NEXTMOD  DC    C'92',VL3(IGG01992)                             @Z30TSCF 68290003
SGMF     DC    C'AD'                                             Y02072 68292002
GMS      DC    C'FD'                                             Y02072 68294002
GL       DC    C'AB'                                             Y02072 68296002
GLS      DC    C'FB'                                             Y02072 68298002
GDS      DC    C'FF'                                             Y02072 68298402
GLSLR    DC    C'BO'                                             Y02072 68298802
SPMF     DC    C'AL'                                             Y02072 68299202
PMS      DC    C'FL'                                             Y02072 68299602
PL       DC    C'AJ'                                             Y02072 68299702
PLS      DC    C'FJ'                                             Y02072 68299802
PDS      DC    C'FG'                                             Y02072 68299902
PLSLR    DC    C'BP'                                             Y02072 68316602
GERR     DC    C'AQ'                                             Y02072 68326602
PERR     DC    C'AR'                                             Y02072 68328602
WRH2     DC    C'BA'                                             Y02072 68330602
CHECK    DC    C'BB'                                             Y02072 68332602
PDLOAD   DC    C'6M',VL3(IGG0196M)                             @Z30TSCF 68333003
OPIDCNST DC    C'0S'                     ID                             68333302
AMIDCNST DC    C'16'                    MODULE ID                       68350018
NXTENTRY DS    0CL2                     TO GET 2 BYTE LEN ATTR   Y02072 68352002
         SPACE 6                                                        68360002
PATCH    DC    0H'0',50X'00'            PATCH AREA             @Z30TSCF 68370003
         EJECT                                                          68380002
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 82500003
         ORG   WTGIDTTR                                          Y02072 82550002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 82600002
CVT      DSECT                                                          82800000
         CVT                                                            83000000
BLDEB    DSECT                                                          83200000
DEB      DS    0F                       ALIGN                           83400000
DEBNMSUB DS    0CL1                     NO. OF SUB.                     83600000
DEBTCBAD DS    CL4                      TCB ADDR.                       83800000
DEBAMLNG DS    0CL1                     ACCESS METHOD LEN.              84000000
DEBDEBAD DS    CL4                      DEB ADDR.                       84200000
DEBOGLGS DS    0CL1                     OPTION                          84400000
DEBIRBAD DS    CL4                      IRB ADDRESS                     84600000
DEBOPATB DS    0CL1                     OPTION                          84800000
DEBSYSPG DS    CL4                      SYS ABEND                       85000000
DEBNMEXT DS    0CL1                     NO. OF EXTENT                   85200000
DEBUSRPG DS    CL4                      USER PROG.                      85400000
DEBPRIOR DS    0CL1                     PRIORITY                        85600000
DEBECBAD DS    CL4                      ECB ADDRESS.                    85800000
DEBPROTG DS    0CL1                     PROTECTION KEY                  86000000
DEBDEBID DS    0CL1                     DEB ID                          86200000
DEBDCBAD DS    CL4                      DCB ADDRESS                     86400000
DEBEXSCL DS    0CL1                     EXCEPTION                       86600000
DEBAPPAD DS    CL4                      APPENDAGE ADDRESS               86800000
DEBDVMOD DS    0CL1                     DEVICE                          87000000
DEBUCBAD DS    CL4                      UCB ADDRESS                     87200000
DEBBINUM DS    CL2                      BIN NUMBER                      87400000
DEBSTRCC DS    CL2                      START CYC.                      87600000
DEBSTRHH DS    CL2                      START TRACK                     87800000
DEBENDCC DS    CL2                      END CYCLINDER                   88000000
DEBENDHH DS    CL2                      END TRACK                       88200000
DEBNMTRK DS    CL2                      NO. OF TRACKS                   88400000
DEBIRBAZ EQU   DEBIRBAD+1                                               88600000
*                                                                       88800000
           DCBD  DSORG=PS                                               89000000
DCBEOBZ  EQU   DCBEOB+1                                                 89200000
DCBCNTZZ EQU   DCBCNTRL+3                                               89400000
DCBEOBWZ EQU   DCBEOBW+1                                                89600000
DCBCNTRZ EQU   DCBCNTRL+1                                               89800000
DCBEOBRZ EQU   DCBEOBR+1                                                90000000
DCBSYZ   EQU   DCBSYNAD+2                                               90200000
DCBSYX   EQU   DCBSYNAD+3                                               90400000
DCBGETZ  EQU   DCBGET+1                                                 90600000
DCBMACRZ EQU   DCBMACRF+1                                               90800000
DCBPERZ  EQU   DCBPERR+1                                                91000000
DCBCHECZ EQU   DCBCHECK+1                                               91200000
           END                                                          91400000
./  ADD  SSI=81860266,NAME=IGG01917
 TITLE 'IGG01917 - SAM OPEN EXECUTOR (SECOND HALF OF IGG01910)'    UT18 00100018
IGG01917 CSECT                                                          00150020
*MODULE NAME - IGG01917                                          Y02072 00152002
*                                                                       00154002
*DESCRIPTIVE NAME - LOADS ACCESS METHOD ROUTINES                 Y02072 00156002
*                                                                       00158002
*COPYRIGHT - NONE                                                Y02072 00158402
*                                                                       00158802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00159202
*                                                                       00159602
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00160002
*001100,011000,020000-021000,031000,038000,256200-256600,283500, Y02072 00170002
*284500,285500-286500,342480-342704,343280-343760,353530-353950, Y02072 00180002
*360300-367150,390000-394000,399000-402000,413000,505050-505900, Y02072 00190002
*598040-598096,623300,624200,624240-624400,335500-337500,342000  Y02072 00192002
*381010-381100,594200-594800,624100-624500,403000,479000-480000, Y02072 00242002
*484000,489000-501000,537000-544000                              Y02072 00252002
*                                                                YM1140 00262002
*                                                                YM2507 00272002
*                                                                YM4640 00272102
*D381600-381800                                                  YM5922 00282102
*                                                                       00292103
*          VS2 RELEASE 3 DELETIONS                                      00294103
*                                                              @Z30TSCF 00296103
*C371000-371100                                                @OS73907 00298137
*A371420-371424                                                @OS73907 00298537
*          RELEASE 20 DELETIONS                                         00300018
*0872                                                            S20038 00350020
*0872290000-292000                                               A32160 00370020
*0872259000,343000,345000,352000,568000,626000                   S20201 00380020
*          RELEASE 21 DELETIONS                                         00400018
*0090                                                            A49371 00402021
*0090                                                             M0062 00410021
*D139000-151000,261000-266000,325000-335000,337000              SA53194 00412021
*D381020-381040,381050                                          SA53194 00416021
*0090286000-299000,326000-338000,548000-564000,568000,625600     S21040 00420021
*0090                                                            A42906 00450021
*          VS2.037 CHANGES                                              00500037
*C280030,280040                                               @ZA28034  00550037
*A368000-369000                                               @ZA28034  00600037
*STATUS CHANGE LEVEL 005                                                01100002
*                                                                       01200018
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE      UT18 01300018
*      IGG01910 AND LOADS THE REMAINING I/O MODULES.  WHAT IS TO   UT18 01400018
*      BE LOADED IS DETERMINED FROM THE CODES IN THE DCBCNTRL      UT18 01500018
*      FIELD WHICH WAS SET BY PREVIOUS LOADS OF THE OPEN EXECUTORS.UT18 01600018
*      IT WILL PLACE THE ADDRESS OF THE LOADED MODULES IN THE           01700018
*      APPROPRIATE DCB FIELDS, AND THE ID'S IN THE DEB.                 01800018
*      IT WILL BRING IN THE APPROPRIATE END-OF-BLOCK(EOB) ROUTINE       01900018
*      IT WILL BRING IN A SIO APPENDAGE FOR PRINTERS THAT        Y02072 02000002
*      REQUIRE IT.                                               Y02072 02100002
*                                                                       02200018
*ENTRY POINTS - ENTERED ONLY FROM IGG01910 BY USE OF XCTL MACRO    UT18 02300018
*                                                                       02400018
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS)                        02500018
*                                                                       02600018
*OUTPUT: DCB(USERS),IOB(USERS).                                         02700018
*                                                                       02800018
*EXTERNAL ROUTINES: NONE.                                               02900018
*                                                                       03000018
*EXITS-NORMAL: XCTL TO IGG01911(IECOSOP9)                        Y02072 03100002
*                                                                       03200018
*EXITS-ERROR: NONE.                                                     03300018
*                                                                       03400018
*TABLES/WORKAREAS               *************************************** 03500018
*********************************************************************** 03600018
*                                                                       03700018
*ATTRIBUTES: REENTRANT, REUSABLE, SUPERVISOR STATE,              Y02072 03800002
*            RUNS IN DATA MANAGEMENT KEY                         Y02072 03850002
*                                                                       03900018
*NOTES: THIS ROUTINE HAS A LIST OF ALL BSAM, QSAM MODULES SUPPORTED.    04000018
*                                                                       04100018
*********************************************************************** 04200018
*                                                                       04300018
*                                                                       04400018
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                04500018
*                                                                       04600018
*********************************************************************** 04700018
*                                                                       04800018
RE       EQU   0         WORK REG5                                      04850002
RF       EQU   1         WORK REG6                                      04860002
R1       EQU   RF        PARM REG                                YM1140 04870002
RDCB     EQU   2         DCB REGISTER                                   04900018
RBASE    EQU   3         BASE REGISTER                                  05000018
RCORE    EQU   4         WORK AREA ADDRESS                              05100018
RPAR     EQU   5         TOP OF PARAMETER LIST                          05200018
RWTG     EQU   6         TOP OF WTG TABLE                               05300018
RPARC    EQU   7         CURRENT PARAMETER                              05400018
RWTGC    EQU   8         CURRENT TRANS LOAD                             05500018
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    05600018
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       05700018
RDEB     EQU   11        DEB ADDRESS                                    05800018
RB       EQU   12        WORK REG1  **                                  05900018
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          06000018
RD       EQU   14        WORK REG3  **                                  06100018
RJ       EQU   15        WORK REG4                                      06200018
*                                                                       06500018
*                                                                       06600018
PARAR    EQU   RPARC                                                    06700018
*                                                                       06800018
*********************************************************************** 06900018
*                                                                       07000018
*********************************************************************** 07100018
*                                                                       07200018
* MASK'S TO TEST PARAMETER LIST WITH                                    07300018
*                                                                       07400018
*********************************************************************   07500018
INP      EQU   X'0F'                                                    07600018
OUTP       EQU   X'0F'                                                  07700018
UPDATE     EQU   X'04'                                                  07800018
INOUT      EQU   X'03'                                                  07900018
OUTIN      EQU   X'07'                                                  08000018
RDBACK     EQU   X'01'                                                  08100018
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 08200018
*                                                                       08300018
*                                                                       08400018
*********************************************************************   08500018
*                                                                       08600018
*                                                                       08700018
* OFFSET FOR PARAMETER TESTS                                            08800018
*                                                                       08900018
ONE        EQU   X'01'                                                  09000018
FRTYATE    EQU   48                                                     09100018
DISPSN     EQU   X'0'                                                   09200018
*                                                                       09300018
*                                                                       09400018
*********************************************************************   09500018
*                                                                       09600018
* OFFSETS FOR DEB REFERENCE                                             09700018
*                                                                       09800018
*                                                                       09900018
BIN      EQU   36                                                       10000018
BEXT     EQU   38                                                       10100018
*                                                                       10200018
*                                                                       10300018
*                                                                       10400018
*********************************************************************   10500018
*                                                                       10600018
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              10700018
*                                                                       10800018
*                                                                       10900018
*                                                                       11000018
DOUBLE     EQU   X'01'                                                  11100018
*                                                                       11200018
*                                                                       11300018
STOWB      EQU   X'80'                                                  11400018
WRTCK      EQU   X'80'                                                  11500018
OVRFLO     EQU   X'20'                                                  11600018
PCI        EQU   X'20'                                                  11700018
MINKEY     EQU   X'01'                                                  11800018
CONCAT     EQU   X'FF'                                                  11900018
UTFMASK  EQU   X'02'                    MASK FOR TOTALING FACILITY UT18 12000018
BYPASS   EQU   X'10'                    BYPASS DOS EMBED CHKPT   S21040 12030021
*                                       RECORDS MASK, TAPE FILE         12060021
*                                                                       12100018
*********************************************************************   12200018
*                                                                       12300018
* MASKS FOR ACCESS METHODS IN SAM                                       12400018
*                                                                       12500018
QSAMB      EQU   X'01'                                                  12600018
BSAMBIT    EQU   X'00'                                                  12700018
PAM        EQU   X'02'                                                  12800018
*                                                                       12900018
*                                                                       13000018
* MASKS FOR MACRO'S TO BE USED                                          13100018
*                                                                       13200018
GETB       EQU   X'40'                                                  13300018
PUTB       EQU   X'40'                                                  13400018
READB      EQU   X'20'                                                  13500018
WRITEB     EQU   X'20'                                                  13600018
POINTB     EQU   X'04'                                                  13700018
CNTRLB     EQU   X'02'                                                  13800018
*********************************************************************   15200018
*                                                                       15300018
* MASKS FOR STATUS BITS TO BE TESTED                                    15400018
*                                                                       15500018
*                                                                       15600018
EXCPN      EQU   X'30'                                                  15700018
COMPLETE   EQU   X'80'                                                  15800018
FIRSTIOB   EQU   X'01'                                                  15900018
*                                                                       16000018
*                                                                       16100018
*                                                                       16200018
*********************************************************************   16300018
*                                                                       16400018
* MASKS FOR BUFFER TECHNIQUE'S                                          16500018
*                                                                       16600018
CYCLICB    EQU   X'20'                                                  16700018
EXCHANGB   EQU   X'10'                                                  16800018
SIMPLEB    EQU   X'40'                                                  16900018
EXCHCYCL   EQU   X'30'                                                  17000018
*                                                                       17100018
*********************************************************************   17200018
*                                                                       17300018
*                                                                       17400018
* MODES OF OPERATION FOR QSAM                                           17500018
*                                                                       17600018
LOCATEB    EQU   X'08'                                                  17700018
MOVEB      EQU   X'10'                                                  17800018
MOVEXCHB EQU   X'14'                                                    17900018
SUBSTUTB   EQU   X'04'                                                  18000018
*                                                                       18100018
*                                                                       18200018
*********************************************************************   18300018
*                                                                       18400018
*                                                                       18500018
* COMMAND BYTES FOR THE 2841                                            18600018
*                                                                       18700018
*       CONTROL UNIT                                                    18800018
*                                                                       18900018
*                                                                       19000018
*                                                                       19100018
SRCHE      EQU   X'31'                                                  19200018
WRTCKD     EQU   X'1D'                                                  19300018
RDC        EQU   X'92'                                                  19400018
RDKD       EQU   X'8E'                                                  19500018
RDD        EQU   X'86'                                                  19600018
TIC        EQU   X'08'                                                  19700018
*                                                                       19800018
*                                                                       19900018
*********************************************************************   20000018
*                                                                       20100018
*                                                                       20200018
* MASKS FOR RECORD FORMATS                                              20300018
*                                                                       20400018
*                                                                       20500018
STANDRDF   EQU   X'08'                                                  20600018
FORMATU    EQU   X'C0'                                                  20700018
FORMATF    EQU   X'80'                                                  20800018
FORMATV    EQU   X'40'                                                  20900018
FORMATD  EQU   X'20'                    D FORMAT RECORDS         S20038 20950020
BLOCKED    EQU   X'10'                                                  21000018
FIXEDBLK   EQU   X'90'                                                  21100018
*                                                                       21200018
*                                                                       21300018
*********************************************************************   21400018
*                                                                       21500018
*                                                                       21600018
*   CHANNEL CONTROL WORD FLAGS                                          21700018
*                                                                       21800018
SKIP       EQU   X'10'                                                  21900018
SLI        EQU   X'20'                                                  22000018
CC         EQU   X'40'                                                  22100018
DATACH     EQU   X'A0'                                                  22200018
SLICC      EQU   X'60'                                                  22300018
SLICCSK    EQU   X'70'                                                  22400018
*                                                                       22500018
*                                                                       22600018
*********************************************************************   22700018
*                                                                       22800018
*                                                                       22900018
KEYS       EQU   X'01'                                                  23000018
QSAM       EQU   X'01'                                                  23100018
*                                                                       23200018
*                                                                       23300018
*********************************************************************   23400018
*                                                                       23500018
GETMAIN    EQU   4                                                      23600018
XCTL       EQU   7                                                      23700018
LOAD       EQU   8                                                      23800018
*                                                                       23900018
*********************************************************************   24000018
*                                                                       24100018
*                                                                       24200018
**********************************************************************  24300018
ASA        EQU   X'04'                                                  24400018
BKREAD     EQU   X'01'                                                  24500018
URBITS   EQU   X'40'                                                    24600018
TAPEB    EQU   X'80'                                                    24700018
DABIT    EQU   X'20'                                                    24800018
WAOFF    EQU   32                                                       24900018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           25000018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           25100018
*                                                                       25200018
**********************************************************************  25300018
D3525    EQU   X'4C'               3525 DEVICE                  SA53194 25301021
RP       EQU   X'60'               PRT/PCH ASSOC D.S.           SA53194 25302021
RW       EQU   X'50'               RD/PCH ASSOC D.S             SA53194 25303021
PW       EQU   X'30'               RD/PRT ASSOC D.S.            SA53194 25304021
ASSOCDS  EQU   X'04'               3525 ASSOCIATED D.S          SA53194 25304421
SIX      EQU   6                                                 S20201 25305020
NRECREDY EQU   X'20'                                             S20201 25310020
THREE    EQU   3                        CONSTANT OF 3            S20201 25315020
FIVE     EQU   5                        CONSTANT OF 5            S20201 25320020
TWENTY5  EQU   25                       CONSTANT OF 25           S20201 25325020
ABENDISP EQU   17                       OFFSET IN AVT ABE ADDR   S20201 25330020
ADLEN    EQU   3                        ADDR LENGTH              S20201 25335020
ADDISP   EQU   25                       DISP OF LOADS RTRN ADDR  S20201 25340020
STANDF   EQU   X'08'                                             S20201 25345020
SDINDIC  EQU   X'08'                    SEARCH DIRECT INDICATOR  S20201 25350020
TRKOVFL  EQU   X'20'                    TRACK OVERFLOW MASK      S20201 25355020
ZERO     EQU   0                        DISPLACEMENT OF 0        S20201 25360020
D1       EQU   1                        DISPLACEMENT OF 1        S20201 25365020
D5       EQU   5                        DISPLACEMENT OF 5        S20201 25370020
D6       EQU   6                        DISPLACEMENT OF 6        S20201 25375020
D13      EQU   13                       DISPLACEMENT OF 13       S20201 25380020
D17      EQU   17                       DISPLACEMENT OF 17       S20201 25385020
D25      EQU   25                       DISPLACEMENT OF 25       S20201 25390020
TEMPSAVE EQU   24                       OFFSET TO TEMP SAVE ADDR  M5467 25392002
*                                         OF LOADED ROUTINES      M5467 25394002
IDLEN    EQU   2                        LENGTH OF A MODULE ID    Y02072 25396002
         EJECT                                                          25400002
         BALR  RBASE,0                                                  27100018
         USING SLDA,RBASE                                               27200018
         USING IHADCB,RDCB                                              27300018
         USING BLDEB,RDEB                                               27400018
         USING FORCORE,RCORE                                            27500018
*                                                                       27700018
*                                                                       27800018
SLDA     EQU   *                                                        27900018
*                                                                       28000018
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 28001002
         DC    C'IGG01917'              MODULE NAME              YM4640 28002002
         DC    C'@ZA28034'              LAST SHIP CODE         @ZA28034 28003037
         DC    C'02/02/78'              LAST SHIP DATE         @ZA28034 28003637
BEGIN    DS    0H                       END OF MODULE ID         YM4640 28005002
*                                                                       28100018
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 28200018
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   28300018
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 28400018
         L     RCORE,4(RWTGC)           GET WORK AREA                   28500018
*                                                                       29200021
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  30000018
*                                                                       30100018
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           30200018
         USING AVT,RTIOT                                                30250001
         SR    RUCB,RUCB                CLEAR REG                       30300018
         SR    RF,RF                    CLEAR RER                       30400018
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           30500018
         IC    RF,DEBEXSCL              GET SCALING FACTOR              30600018
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  30700018
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        30800018
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    30900018
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      31000018
*                                                                       31100018
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB AND MUST  UT18 31200018
*  NOW BE INCREMENTED TO POINT BEYOND THE LAST ENTRY.              UT18 31300018
*                                                                  UT18 31400018
SLDAA    CLI   0(RUCB),X'00'            IS RUCB BEYOND LAST ENTRY  UT18 31500018
         BE    SLDAB                    BR IF YES                  UT18 31600018
         LA    RUCB,2(RUCB)             INCREMENT TO NEXT ID FIELD UT18 31700018
         B     SLDAA                    TEST NEXT FIELD            UT18 31800018
*                                                                  UT18 31900018
*                                                                  UT18 32000018
*                                                                  UT18 32100018
*  RUCB NOW POINTS TO THE NEXT AVAILABLE SUBROUTINE ID FIELD IN    UT18 32200018
*  THE DEB.                                                        UT18 32300018
SLDAB    EQU   *                                                        32400018
*********************************************************************** 33900018
*      GET THE EOB MODULES NEEDED FOR THIS FILE                         34000018
*                                                                       34100018
         TM    DCBDEVT,URBITS           UNIT RECORD DEVICE       A42906 34202021
         BO    SLDAPP01                 YES,BRANCH               A42906 34204021
         TM    JFCBMASK+D6,SDINDIC      SEARCH DIRECT USED       S20201 34208020
         BNO   NOSDOPT                  BRANCH NO                S20201 34216020
         LA    RB,CEAFP                 GET SEARCH DIRECT CE     S20201 34224020
         BAL   RC,SLDROUT               LOAD ROUTINE             S20201 34232020
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    34240001
         LA    RB,AEOESF                GET END OF EXTENT APPEN  S20201 34272020
         BAL   RC,SLDROUT               LOAD IT IN AND PUT       S20201 34280020
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   34288001
         B     SLDAPP17                 AROUND NEXT              Y02072 34304002
*                                                                       34312020
NOSDOPT  EQU   *                                                 S20201 34320020
*                                                                       34384020
         TM    0(RPARC),OUTP            DCB FOR OUTPUT ONLY             34400018
         BO    SLDAPP10                 AROUND NEXT              S20201 34500020
*                                                                       34600018
*  END OF EXTENT  APPENDAGE NEEDED FOR DISK INPUT                       34700018
*                                                                       34800018
         TM    DCBDEVT,X'20'           D.A. DEVICE                      34900018
         BZ    SLDAPP01                NO BRANCH                        35000018
         TM    DCBCIND1,X'40'          SEARCH DIRECT INPUT              35100018
         BNO   LAB04                   NO LOAD CH                S20201 35120020
         TM    JFCBMASK+SIX,NRECREDY    IS IT NON RPS            S20201 35140020
         BO    SLDAPP01                 YES BRANCH AROUND        S20201 35160020
         LA    RB,AEOESF                GET END OF EXTENT        S20201 35180020
*                                       APPENDAGE                S20201 35200020
*                                       FOR STANDARD FIXED              35220020
         B     LAB05                    GO AROUND NEXT           S20201 35240020
*                                                                       35300018
LAB04    EQU   *                                                 S20201 35350020
         LA    RB,AEOE                 GET END OF EXTENT ID             35400018
LAB05    EQU   *                                                 S20201 35450020
         BAL   RC,SLDROUT              LOAD ROUTINE                     35500018
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   35600001
*                                                                       35700018
*        LENGTH CHECKING IS REQUIRED FOR DCB                            35800018
*                                                                       35900018
SLDAPP01 EQU   *                                                        36000018
         TM    DCBDEVT,DCBDVTAP         MAG TAPE BEING USED     SA57129 36010002
         BZ    SLDAPP10                 NO, BYPASS DOS/CHKP     SA57129 36020002
         TM    DCBOPTCD,DCBBCKPT        BYPASS DOS CHKPT RCD     Y02072 36050002
         BZ    AROUND                   NO, BRANCH              SA57129 36100002
         LA    RB,DACEV                 GET BYPASS DOS CHKPT RCD S21040 36720021
*                                       V LENGTH APPENDAGE ID           36730021
         TM    DCBRECFM,FORMATF         FORMAT F OR U RCDS       S21040 36740021
         BZ    SLDAPP12                 BRANCH IF NO             S21040 36750021
         LA    RB,DACEUF                BYPASS DOS CHKPT RCD     S21040 36760021
*                                APPEND ID FOR FORMATS U AND F          36770021
         B     SLDAPP12                                          S21040 36780021
*                                                                       36790021
SLDAPP10 EQU   *                                                        36800018
         TM    0(RPARC),OUTP            OUTPUT DCB            @ZA28034  36820037
         BO    SLDAPP14                 YES-NO LENGTH CHECK   @ZA28034  36840037
*                                       APPEN NEEDED.         @ZA28034  36860037
*                                                                       36900018
         TM    JFCBMASK+SIX,NRECREDY    IS IT RECORD READY       S20201 36907020
         BO    AROUND                   NO BRANCH AROUND         S20201 36914020
LAB002   EQU   *                                                 S20201 36921020
         TM    DCBRECFM,FORMATU         FORMAT U RECORDS         S20201 36928020
         BM    LAB03                    NO BRANCH AROUND         S20201 36935020
         TM    DCBRECFM,TRKOVFL         IS IT TRACK OVERFLOW     S20201 36942020
         BO    SLDAPP14                 YES BRANCH TO SLDAPP14   S20201 36949020
         LA    RB,ACEU                  NO GET U FORMAT CHAN END S20201 36956020
         B     SLDAPP12                 LOAD U FORMAT CHAN END   S20201 36963020
LAB03    EQU   *                                                 S20201 36970020
         TM    DCBRECFM,FORMATF         FIXED LENGTH RECS        S20201 36977020
         BO    SLDAPP11                 YES LOAD CI              S20201 36984020
         B     SALADS                   BRANCH FOR V FORMAT      A49371 36986021
AROUND   EQU   *                                                 S20201 36991020
         TM    0(RPARC),OUTP            OPEN FOR OUTPUT ONLY     A49371 36993021
         BO    SLDAPP14                 BRANCH YES -- NO LENGTH- A49371 36995021
*                                       CHECKING APPENDAGE NEEDED       36997021
         TM    DCBRECFM,FORMATU         U RECORDS                       37000018
         BO    SLDAPP14                 YES, BRANCH            @OS73907 37100037
         BM    SALAD                    NO, F OR V RCDS        @OS73907 37110037
         TM    DCBRECFM,FORMATD         D OR T RCDS?           @OS73907 37120037
         BZ    SLDAPP14                 NO, EXIT               @OS73907 37130037
         TM    DCBDEVT,TAPEB            IS IT TAPE             @OS73907 37140037
         BZ    SLDAPP14                 NO, EXIT               @OS73907 37142037
         B     SALADS                   YES, BRANCH            @OS73907 37142437
SALAD    EQU   *                                                 S20038 37150020
         TM    DCBRECFM,FIXEDBLK        FIXED BLKD RECORDS              37200018
         BC    1,SLDAPP11               YES BRANCH                      37300018
         TM    DCBRECFM,FORMATV         VARIABLE RECORDS                37400018
         BC    8,SLDAPP14               NO BRANCH                       37500018
SALADS   EQU   *                                                 S20038 37550020
         LA    RB,ACEV                  GET V LN CKNG APPN.             37600018
         B     SLDAPP12                                                 37700018
SLDAPP11 EQU   *                                                        37800018
         LA    RB,ACEF                  GET F LN CKNG APPN              37900018
SLDAPP12 BAL   RC,SLDROUT               LOAD ROUTINE                    38000018
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    38100001
         TM    DCBDEVT,DABIT            IS THIS DA               YM5922 38102002
         BZ    SALAD13                  NO, TEST FOR TAPE        YM5922 38104002
         AH    RE,SECENTRY              OFFSET TO ABNOR ENTRY    YM5922 38106002
         B     SLDAPP13                 GO STORE ABNOR ENTRY AD  YM5922 38108002
SALAD13  DS    0H                                                YM5922 38108402
         TM    DCBDEVT,DCBDVTAP         MAG TAPE BEING USED     SA57129 38110002
         BZ    SLDAPP14                 NO, BYPASS DOS/CHKPT    SA57129 38112002
         TM    DCBOPTCD,BYPASS          BYPASS DOS CHKPT RCD     S21040 38120021
         BZ    SLDAPP14                 BRANCH IF NO             S21040 38140021
SLDAPP13 DS    0H                                                YM5922 38190002
         ST    RE,AVTABNE               ABNOR END APP ADDR       YM5922 38192002
SLDAPP14 EQU   *                                                        38200018
* * * * * * *        3525   3505   SUPORT   * * * * * * * * * *         38220021
         CLI   DCBDEVT,X'4C'           IS THIS A 3525            M0062  38240021
         BE    SLDAPP17                YES, BRANCH               M0062  38260021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 38280021
         TM    DCBDEVT,X'48'            PRINTER USED                    38300018
         BC    14,SLDAPP17              NO BRANCH                       38400018
         LA    RB,PSIO                  GET SIO APPNDAGE                38500018
         BAL   RC,SLDROUT               LOAD ROUTINE                    38600018
         ST    RE,AVTSIO                APPENDAGE TABLE ENTRY FOR SIO   38700001
*                                                                       38800018
SLDAPP17 EQU   *                                                        38900018
         BAL   RF,EOBROUT               GET EOB RT ID                   39500018
*                                                                       39600018
         BAL   RC,SLDROUT               LOAD ROUTINE                    39700018
*                                                                       39800018
*                                                                       39900018
*                                                                       40200018
         USING WTGENTRY,RWTGC                                    Y02072 40250002
         MVC   WTGIDTTR,SOP9            ID OF NEXT MOD         @Z30TSCF 40260003
         TM    DCBCIND2,DCBCNQSM       QSAM BEING USED           Y02072 40350002
         BZ    SLDEOB2                 NO BRANCH                 Y02072 40360002
         MVC   DCBEOB+1(3),25(RWTG)    STORE EOB ROUTINE                40400018
         MVC   DCBCNTRL+3(1),DCBCNTRL+1  SETUP FOR QSAM CNTRL TEST      40500018
         TM    DCBDEVT,X'80'           DCB FOR TAPE                     40600018
         BZ    SLDEOB8                 NO BRANCH                        40700018
         B     SLDEOBC                 YES BRANCH                       40800018
*                                                                       40900018
*                                                                       41000018
SLDEOB2  EQU   *                                                        41100018
*                                                                       41200018
         MVC   DCBEOBR+1(3),25(RWTG)  LOAD EOB ADDR IN DCB              41400018
*                                                                       41500018
SLDEOB20 EQU   *                                                        41600018
*                                                                       41700018
         MVC   DCBEOBW+1(3),25(RWTG)  LOAD EOB WRITE ADDR IN DCB        41800018
*                                                                       41900018
*                                                                       42000018
SLDEOB4  EQU   *                                                        42100018
*                                                                       42200018
         BAL   RF,EOBROUT               GET POSSIBLE WRT ROUT (IN/OUT)  42300018
*                                                                       42400018
*                                                                       42500018
         LTR   RC,RC                    DCB FOR IN/OUT                  42600018
         BC    8,SLDEOB6                NO BRANCH                       42700018
*                                                                       42800018
         BAL   RC,SLDROUT               LOAD WRT EOB RT.                42900018
*                                                                       43000018
         MVC   DCBEOBW+1(3),25(RWTG)  LOAD EOB WRITE ADDR.IN DCB        43100018
*                                                                       43200018
*                                                                       43300018
SLDEOB6  EQU   *                                                        43400018
*                                                                       43500018
         BAL   RF,EOBROUT               IS NOTE/POINT USED              43600018
*                                                                       43700018
         LTR   RC,RC                    TEST FOR ITS ID                 43800018
         BP    SLDEOB9                 YES BRANCH                       43900018
*                                                                       44000018
SLDEOB8  EQU   *                                                        44100018
*                                                                       44200018
         BAL   RF,EOBROUT               GET POSSIBLE CNTRL RT ID        44300018
         LTR   RC,RC                    IS THERE A CNTRL ID             44400018
         BC    8,SLDEOBC                NO BRANCH                       44500018
*                                                                       44600018
SLDEOB9  BAL   RC,SLDROUT              LOAD NOTE/POINT OR CONTROL       44700018
         CLC   DUMY(2),0(RB)            DUMMY CONTROL MODULE      M5467 44750002
         BNE   SLDEOB10                 NO, BR AROUND             M5467 44760002
         AH    RE,CNTOFSET              GET ADDR OF CNTRL ENT PT  M5467 44770002
         ST    RE,TEMPSAVE(RWTG)        TEMP SAVE ADDR            M5467 44780002
SLDEOB10 EQU   *                        NOT DUMMY                 M5467 44790002
         MVC   DCBCNTRL+1(3),25(RWTG)  STORE N/P OR CNTRL ADDR. IN DCB  44800018
         B     SLDEOBE                                                  44900018
*                                                                       45000018
SLDEOBC  EQU   *                                                        45100018
         XC    DCBCNTRL(4),DCBCNTRL     CLEAR PARA LIST                 45200018
         OI    DCBCNTRL+3,X'01'         SET VECTOR  TO  ONE             45300018
*                                                                       45400018
SLDEOBE  EQU   *                        END.                            45500018
         MVC    DCBEROPT(1),DXCCW6      REPLACE QSAM ERROR OPTIONS      45600018
*                                                                       45700018
*                                                                       45800018
*********************************************************************** 45900018
*                                                                       46000018
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        46100018
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     46200018
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            46300018
         BCR   8,RBASE                                                  46400018
*                                                                       46500018
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    46600018
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             46700018
*                                                                       46800018
         LR    RPARC,RPAR                                               46900018
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       47000018
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           47100018
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         47200018
*                                                                       47300018
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  47400018
         LA    RPARC,PLOFF(0,RPARC)                                     47500018
         BC    15,ZCHEK                                                 47600018
*                                                                       47700018
TCTLRTN  EQU   *                                                        47800018
         USING WTG,RWTG                                                 47850003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*47900003
               MODID=WTGENTRY                                  @Z30TSCF 47950003
         DROP  RWTGC,RWTG                                      @Z30TSCF 48000003
*                                                                       48500018
*                                                                       48600018
*                                                                       48700018
SLDROUT  EQU   *                                                        48800018
         USING WTGMODNM,RWTG                                     Y02072 48850002
         MVC   WTGMODID,0(RB)           ID TO MOD NAME           Y02072 48900002
         DROP  RWTG                                              Y02072 48950002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 49000002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 49050002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 49100002
         DROP  R1                       DROP CVT BASE            YM1140 49150002
*                                                                       49200002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 50100002
*                                                                       50200018
*                                                                       50300018
*                                                                       50400018
         ST    RE,24(RWTG)             TEMP STORE OF ROUTINE ADDR,      50500018
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        50600018
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               50700018
         SR    RD,RD                    CLEAR REG                       50800018
         IC    RD,DEBNMSUB              GET NO.OF SUBRTS LOADED SO FAR  50900018
         LA    RD,1(RD)                 ONE MORE SUB RT LOADED          51000018
         STC   RD,DEBNMSUB              STORE NEW TOTAL SUBRTS LOADED   51100018
         BR    RC                      RETURN                           51200018
*                                                                       51300018
*                                                                       51400018
*********************************************************************** 51500018
*                                                                       51600018
*                                                                       51700018
*********************************************************************** 51800018
*                                                                       51900018
EOBROUT  EQU   *                                                        52000018
*                                                                       52100018
         SR    RC,RC                                                    52200018
         LA    RE,EOBTABL               GET TABLE OF NAMES              52300018
         LA    RB,IDLEN                 LEN OF MODULE ID         Y02072 52400002
         IC    RC,DCBCNTRL+3            GET ID NO. DEVICE DEP.          52500018
         L     RJ,DCBCNTRL              SHIFT IDS RIGHT BY ONE BYTE     52600018
         SRL   RJ,8                                                     52700018
         ST    RJ,DCBCNTRL                                              52800018
         MR    RB,RB                    CALCULATE WHERE ID IS           52900018
         LR    RB,RC                    PREPARE TO LOAD  MODULE         53000018
         AR    RB,RE                    POINT TO CORRECT ID             53100018
         BR    RF                       RETURN                          53200018
*                                                                       53300018
*********************************************************************** 53400018
*                                                                       53500018
CNTOFSET DC    H'24'                    OFFSET OF CONTROL ROUTINE M5467 53550002
*                                         IN DUMMY MODULE         M5467 53560002
SECENTRY DC    H'4'                     OFFSET TO ABNORMAL END   YM5922 53570002
*                                         ENTRY IN APPENDAGE     YM5922 53580002
OPIDCNST DC    C'0S'                                                    53600018
AMIDCNST DC    C'17'                    ID OF THIS MODULE          UT18 54500018
SOP9     DC    C'11',VL3(IGG01911)  IGGO1911 OR IECOS90X -QSAM @Z30TSCF 57000003
*                                                                       57050002
*        BELOW ARE THE SHARABLE ROUTINES USED BY BSAM / QSAM            57600018
*                                                                       57800018
*                                                                       57900018
*        APPENDAGES USED BY BSAM AND QSAM   ---------------------       58000018
*                                                                       58100018
*                                                                       58200018
AEOE     DC    C'CH'                    END OF EXTENT APPNDG NON-SF-INP 58300018
ACEF     DC    C'CI'                    CHANNEL END APPNDG LEN CHK FREC 58600018
ACEV     DC    C'CJ'                    CHANNEL END APPNDG LEN CHK VREC 58900018
PSIO     DC    C'CL'                    APPENDAGE FOR PRINTERS SIO      59500018
DACEUF   DC    C'EI'                    CHANNEL/ABNORMAL END     S21040 59810021
*                                       APPNDG TO                S21040 59820021
*                                       BYPASS DOS CHKPT RCDS. U,F RCD  59830021
DACEV    DC    C'EJ'                    CHANNEL/ABNORMAL END     S21040 59850021
*                                       APPNDG TO                S21040 59860021
*                                       BYPASS DOS CHKPT RCDS, V RCDS   59870021
*                                                                       59890021
*                                                                       59900018
*********************************************************************** 60000018
*                                                                       60100018
*        DEVICE DEPENDENT ROUTINES SUPPORTED                            60200018
*                                                                       60300018
EOBTABL  EQU   *                                                        60400018
         DC    C'  '                                                    60500002
EPD2     DC    C'CD'                    EOB RT DISK-OUTP/STANDRF INP    60700002
EGP2     DC    C'CC'                    EOB RT. DISK-TP-RDR. INP/OUTP.  60800002
DDA2     DC    C'CE'                    EOB RT. PRNTR/PUNCH NORMAL      60900002
DDB2     DC    C'CF'                    EOB RT. PRNTR/PUNCH ASA         61000002
NPD2     DC    C'BC'                    NOTE-POINT DISK                 61100002
NPT2     DC    C'BD'                    NOTE-POINT TAPE                 61200002
CNT1     DC    C'CA'                    CNTRL RT READER                 61300002
CNT2     DC    C'CB'                    CNTRL RT. PRINTER               61400002
CNT3     DC    C'BE'                    CNTRL RT. TAPE                  61500002
DUMY     DC    C'AV'                   DUMMY PUT/NOP ROUTINE            61600002
OVRD     DC    C'CT'                    OPEN OVERRIDE ERROR RTN   OC034 61700002
UTF1     DC    C'TD'                    USER TOTALLING EOB ROUTINE UT18 61800002
UTF2     DC    C'TC'                    USER TOTALLING EOB ROUTINE UT18 61900002
UTF3     DC    C'TV'                    USER TOTALLING EOB ROUTINE UT18 62000002
UTF4     DC    C'TW'                    USER TOTALLING EOB ROUTINE UT18 62100002
UTF5     DC    C'T2'                    USER TOTALLING EOB ROUTINE UT18 62200002
ACEU     DC    C'C0'                    CHANNEL END FOR FORMAT U S20201 62310002
AEOESF   DC    C'C4'                    SF INPUT END OF EXT      S20201 62320002
         DC    C'  '                    FILLER FOR IGG019FN      YM2507 62330002
CEAFP    DC    C'FP'                    SEARCH DIRECT CHANNEL    S20201 62340002
DDC2     DC    C'FK'                    EOB RT. DATA PROTECTION   M0062 62342002
DDD2     DC    C'FQ'                    EOB RT. PRT FOR 3525 DEV  M0062 62344002
DDE2     DC    C'FU'                    EOB RT. 3525 INTRPRT FILE M0062 62346002
CNT4     DC    C'FA'                    CNTRL RT. 3525 DEV        M0062 62348002
OCRCNTRL DC    C'LT'                    CNTRL RTNE FOR 3886 OCR XL03127 62348402
         SPACE                                                          62398402
PATCH    DC    25H'0'                   PATCH AREA               YM4640 62450002
END      EQU   *                        END OF MODULE            Y02072 62500002
         TITLE 'IGG01917 - FORMAT OF GOTTEN CORE'                       63000002
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 63050003
         ORG   WTGIDTTR                                          Y02072 63100002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 63150002
*                                                                       63300018
*                                                                       63400018
CVT      DSECT                                                          63500018
         CVT                                                            63600018
*                                                                       63700018
AVT      DSECT                          APPENDAGE VECTOR TABLE          63706001
AVTEOEPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63712001
AVTEOE   DS    A                        ADDR OF END OF EXTENT           63718001
*                                       APPENDAGE                       63724001
AVTSIOPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63730001
AVTSIO   DS    A                        ADDR OF START I/O               63736001
*                                       APPENDAGE                       63742001
AVTPCIPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63748001
AVTPCI   DS    A                        ADDR OF PCI APPENDAGE           63754001
AVTCEPG  DS    0CL1                     NO.PAGES MODULE REQUIRES        63760001
AVTCE    DS    A                        ADDR OF CHANNEL END             63766001
*                                       APPENDAGE                       63772001
AVTABNPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63778001
AVTABNE  DS    A                        ADDR OF ABNORMAL END            63784001
*                                       APPENDAGE                       63790001
*                                                                       63800018
BLDEB    DSECT                                                          63900018
DEB      DS    0F                                                       64000018
DEBNMSUB DS    0CL1                                                     64100018
DEBTCBAD DS    CL4                                                      64200018
DEBAMLNG DS    0CL1                                                     64300018
DEBDEBAD DS    CL4                                                      64400018
DEBOGLGS DS    0CL1                                                     64500018
DEBIRBAD DS    CL4                                                      64600018
DEBOPATB DS    0CL1                                                     64700018
DEBSYSPG DS    CL4                                                      64800018
DEBNMEXT DS    0CL1                                                     64900018
DEBUSRPG DS    CL4                                                      65000018
DEBPRIOR DS    0CL1                                                     65100018
DEBECBAD DS    CL4                                                      65200018
DEBPROTG DS    0CL1                                                     65300018
DEBDEBID DS    0CL1                                                     65400018
DEBDCBAD DS    CL4                                                      65500018
DEBEXSCL DS    0CL1                                                     65600018
DEBAPPAD DS    CL4                                                      65700018
DEBDVMOD DS    0CL1                                                     65800018
DEBUCBAD DS    CL4                                                      65900018
DEBBINUM DS    CL2                                                      66000018
DEBSTRCC DS    CL2                                                      66100018
DEBSTRHH DS    CL2                                                      66200018
DEBENDCC DS    CL2                                                      66300018
DEBENDHH DS    CL2                                                      66400018
DEBNMTRK DS    CL2                                                      66500018
*                                                                       66600018
           DCBD  DSORG=PS                                               66700018
DCBDVTAP EQU   X'80'                    DEVICE CLASS FOR MG TAP SA57129 66702002
         IKJTCB                                                         66710001
           END                                                          67100018
./  ADD  SSI=43081108,NAME=IGG01918
 TITLE 'IGG01918 - SAM OPEN EXECUTOR (SECOND HALF OF IGG01912)'    UT18 00100018
IGG01918 CSECT                                                          00102003
*MODULE NAME - IGG01918                                          Y02072 00110002
*                                                                       00120002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00130002
*                                                                       00140002
*COPYRIGHT - NONE                                                Y02072 00142002
*                                                                       00144002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00146002
*                                                                       00148002
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00150002
*001500,011000,027000,059000,307500,308500-309700,376000,405000, Y02072 00160002
*576000-577000,437000-438000,448000-457000,494000-507000         Y02072 00170002
*                                                                YM1140 00220002
*                                                                YM4640 00220102
*                                                                       00270103
*          VS2 RELEASE 3 DELETIONS                                      00280103
*                                                              @Z30TSCF 00290103
*          RELEASE 20 DELETIONS                                         00300018
*0892339500-340000                                               M6184  00310020
*0892339000-342000                                               A39226 00320020
*0892314000-316000                                               A32160 00350020
*          RELEASE 21 DELETIONS                                         00400018
*                                                                       00500002
*STATUS CHANGE LEVEL 004                                                01100002
*                                                                       01200018
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE      UT18 01300018
*      IGG01912 AND LOADS THE REMAINING I/O MODULES.  WHAT IS TO   UT18 01400018
*      BE LOADED IS DETERMINED FROM THE CODES IN THE DCBCNTRL      UT18 01500018
*      FIELD WHICH WAS SET BY PREVIOUS LOADS OF THE OPEN EXECUTORS.UT18 01600018
*      IT WILL BRING IN THE APPROPRIATE END-OF-BLOCK(EOB) ROUTINE       01700018
*                                                                       01800018
*ENTRY POINTS - ENTERED ONLY FROM IGG01912 BY USE OF XCTL MACRO    UT18 01900018
*                                                                       02000018
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS)                        02100018
*                                                                       02200018
*OUTPUT: DCB(USERS),IOB(USERS).                                         02300018
*                                                                       02400018
*EXTERNAL ROUTINES: NONE.                                               02500018
*                                                                       02600018
*EXITS-NORMAL: XCTL TO IGG01911(IECOSOP9)                        Y02072 02700002
*                                                                       02800018
*EXITS-ERROR: NONE.                                                     02900018
*                                                                       02950002
*MACROS - ACTION: XCTL, LOAD, IECDSECS(MAIN,WTG), DCBD, CVT      Y02072 02960002
*                                                                       03000018
*TABLES/WORKAREAS - WHERE TO GO TABLE (WTG)                             03100018
*                                                                       03200018
*      BYTE 0-7    NAME                                                 03300018
*      BYTE 8-10   RELATIVE DISK ADDRESS (TTR) OF FIRST RECORD          03400018
*      BYTE 11     CONCATENATION NUMBER                                 03500018
*      BYTE 12     ZERO                                                 03600018
*      BYTE 13     ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.      03700018
*                       ALIAS INDICATOR 1 BIT                           03800018
*                       NUMBER OF TTRS IN USERS DATA FIELD 2 BITS       03900018
*      BYTE 14-16  TTR OF FIRST TEXT RECORD                             04000018
*      BYTE 17     ZERO                                                 04100018
*      BYTE 18-19  TTR OF NOTE LIST OR SCATTER LIST                     04200018
*      BYTE 20     TRANSLATION TABLE                                    04300018
*      BYTE 21     ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST           04400018
*      BYTE 22-23  ATTRIBUTES                                           04500018
*      BYTE 24-26  TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE    04600018
*      BYTE 27-28  LENGTH OF FIRST TEXT RECORD                          04700018
*      BYTE 29     LENGTH OF WTG TABLE (IN DOUBLE WORDS)                04800018
*      BYTE 30-31  PATH THROUGH LOADS OF ROUTINES                       04900018
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       05000018
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        05100018
*      BYTE 40-   TABLE OF IDTTR'S                                      05200018
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          05300018
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          05400018
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          05500018
*                   NOT USED                         (3 BYTES)          05600018
*********************************************************************** 05700018
*                                                                       05800018
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY    Y02072 05900002
*            AND SUPERVISOR STATE                                Y02072 05950002
*                                                                       06000018
*NOTES  THIS ROUTINE HAS A LIST OF ALL BSAM, QSAM MODULES SUPPORTED     06100018
*      FOR PAPER TAPE AND UPDATE.                                       06200018
*                                                                       06300018
*********************************************************************** 06400018
*                                                                       06500018
*                                                                       06600018
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                06700018
*                                                                       06800018
*********************************************************************** 06900018
*                                                                       07000018
RE       EQU   0         WORK REG5                                      07050002
RF       EQU   1         WORK REG6                                      07060002
R1       EQU   RF        PARM REG                                YM1140 07070002
RDCB     EQU   2         DCB REGISTER                                   07100018
RBASE    EQU   3         BASE REGISTER                                  07200018
RCORE    EQU   4         WORK AREA ADDRESS                              07300018
RPAR     EQU   5         TOP OF PARAMETER LIST                          07400018
RWTG     EQU   6         TOP OF WTG TABLE                               07500018
RPARC    EQU   7         CURRENT PARAMETER                              07600018
RWTGC    EQU   8         CURRENT TRANS LOAD                             07700018
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    07800018
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       07900018
RDEB     EQU   11        DEB ADDRESS                                    08000018
RB       EQU   12        WORK REG1  **                                  08100018
RC       EQU   13        WORK REG2  **                                  08200018
RD       EQU   14        WORK REG3  **                                  08300018
RJ       EQU   15        WORK REG4                                      08400018
*                                                                       08700018
*                                                                       08800018
PARAR    EQU   RPARC                                                    08900018
*                                                                       09000018
*********************************************************************** 09100018
*                                                                       09200018
*********************************************************************** 09300018
*                                                                       09400018
* MASK'S TO TEST PARAMETER LIST WITH                                    09500018
*                                                                       09600018
*********************************************************************   09700018
INP      EQU   X'0F'                                                    09800018
OUTP       EQU   X'0F'                                                  09900018
UPDATE     EQU   X'04'                                                  10000018
INOUT      EQU   X'03'                                                  10100018
OUTIN      EQU   X'07'                                                  10200018
RDBACK     EQU   X'01'                                                  10300018
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 10400018
*                                                                       10500018
*                                                                       10600018
*********************************************************************   10700018
*                                                                       10800018
*                                                                       10900018
* OFFSET FOR PARAMETER TESTS                                            11000018
*                                                                       11100018
ONE        EQU   X'01'                                                  11200018
FRTYATE    EQU   48                                                     11300018
DISPSN     EQU   X'0'                                                   11400018
*                                                                       11500018
*                                                                       11600018
*********************************************************************   11700018
*                                                                       11800018
* OFFSETS FOR DEB REFERENCE                                             11900018
*                                                                       12000018
*                                                                       12100018
BIN      EQU   36                                                       12200018
BEXT     EQU   38                                                       12300018
*                                                                       12400018
*                                                                       12500018
*                                                                       12600018
*********************************************************************   12700018
*                                                                       12800018
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              12900018
*                                                                       13000018
*                                                                       13100018
*                                                                       13200018
DOUBLE     EQU   X'01'                                                  13300018
*                                                                       13400018
*                                                                       13500018
STOWB      EQU   X'80'                                                  13600018
WRTCK      EQU   X'80'                                                  13700018
OVRFLO     EQU   X'20'                                                  13800018
PCI        EQU   X'20'                                                  13900018
MINKEY     EQU   X'01'                                                  14000018
CONCAT     EQU   X'FF'                                                  14100018
UPDATEB  EQU   X'80'                                                    14200018
OVFLBIT  EQU   X'20'                                                    14300018
UTFMASK  EQU   X'02'                    MASK FOR TOTALING FACILITY UT18 14400018
*                                                                       14500018
*********************************************************************   14600018
*                                                                       14700018
* MASKS FOR ACCESS METHODS IN SAM                                       14800018
*                                                                       14900018
QSAMB      EQU   X'01'                                                  15000018
BSAMBIT    EQU   X'00'                                                  15100018
PAM        EQU   X'02'                                                  15200018
*                                                                       15300018
*                                                                       15400018
* MASKS FOR MACRO'S TO BE USED                                          15500018
*                                                                       15600018
GETB       EQU   X'40'                                                  15700018
PUTB       EQU   X'40'                                                  15800018
READB      EQU   X'20'                                                  15900018
WRITEB     EQU   X'20'                                                  16000018
POINTB     EQU   X'04'                                                  16100018
CNTRLB     EQU   X'02'                                                  16200018
*                                                                       16300018
*                                                                       16400018
*********************************************************************   16500018
*                                                                       16600018
* MASKS FOR DEVICES TO BE SUPPORTED                                     16700018
*                                                                       16800018
*                                                                       16900018
*                                                                       17000018
*********************************************************************   17100018
*                                                                       17200018
*                                                                       17300018
*                                                                       17400018
*                                                                       17500018
*********************************************************************   17600018
*                                                                       17700018
* MASKS FOR STATUS BITS TO BE TESTED                                    17800018
*                                                                       17900018
*                                                                       18000018
EXCPN      EQU   X'30'                                                  18100018
COMPLETE   EQU   X'80'                                                  18200018
FIRSTIOB   EQU   X'01'                                                  18300018
*                                                                       18400018
*                                                                       18500018
*                                                                       18600018
*********************************************************************   18700018
*                                                                       18800018
* MASKS FOR BUFFER TECHNIQUE'S                                          18900018
*                                                                       19000018
CYCLICB    EQU   X'20'                                                  19100018
EXCHANGB   EQU   X'10'                                                  19200018
SIMPLEB    EQU   X'40'                                                  19300018
EXCHCYCL   EQU   X'30'                                                  19400018
*                                                                       19500018
*********************************************************************   19600018
*                                                                       19700018
*                                                                       19800018
* MODES OF OPERATION FOR QSAM                                           19900018
*                                                                       20000018
LOCATEB    EQU   X'08'                                                  20100018
MOVEB      EQU   X'10'                                                  20200018
SUBSTUTB   EQU   X'04'                                                  20300018
*                                                                       20400018
*                                                                       20500018
*********************************************************************   20600018
*                                                                       20700018
*                                                                       20800018
* COMMAND BYTES FOR THE 2841                                            20900018
*                                                                       21000018
*       CONTROL UNIT                                                    21100018
*                                                                       21200018
*                                                                       21300018
*                                                                       21400018
SRCHE      EQU   X'31'                                                  21500018
WRTCKD     EQU   X'1D'                                                  21600018
RDC        EQU   X'92'                                                  21700018
RDKD       EQU   X'8E'                                                  21800018
RDD        EQU   X'86'                                                  21900018
TIC        EQU   X'08'                                                  22000018
*                                                                       22100018
*                                                                       22200018
*********************************************************************   22300018
*                                                                       22400018
*                                                                       22500018
* MASKS FOR RECORD FORMATS                                              22600018
*                                                                       22700018
*                                                                       22800018
STANDRDF   EQU   X'08'                                                  22900018
FORMATU    EQU   X'C0'                                                  23000018
FORMATF    EQU   X'80'                                                  23100018
FORMATV    EQU   X'40'                                                  23200018
BLOCKED    EQU   X'10'                                                  23300018
FIXEDBLK   EQU   X'90'                                                  23400018
TRANS    EQU   X'7E'                    TRANSLATE MODE MASK.            23500018
*                                                                       23600018
*                                                                       23700018
*********************************************************************   23800018
*                                                                       23900018
*                                                                       24000018
*   CHANNEL CONTROL WORD FLAGS                                          24100018
*                                                                       24200018
SKIP       EQU   X'10'                                                  24300018
SLI        EQU   X'20'                                                  24400018
CC         EQU   X'40'                                                  24500018
DATACH     EQU   X'A0'                                                  24600018
SLICC      EQU   X'60'                                                  24700018
SLICCSK    EQU   X'70'                                                  24800018
*                                                                       24900018
*                                                                       25000018
*********************************************************************   25100018
*                                                                       25200018
*                                                                       25300018
KEYS       EQU   X'01'                                                  25400018
QSAM       EQU   X'01'                                                  25500018
*                                                                       25600018
*                                                                       25700018
*********************************************************************   25800018
*                                                                       25900018
GETMAIN    EQU   4                                                      26000018
XCTL       EQU   7                                                      26100018
LOAD       EQU   8                                                      26200018
*                                                                       26300018
*********************************************************************   26400018
*                                                                       26500018
*                                                                       26600018
**********************************************************************  26700018
ASA        EQU   X'04'                                                  26800018
BKREAD     EQU   X'01'                                                  26900018
URBITS   EQU   X'40'                                                    27000018
TAPEB    EQU   X'80'                                                    27100018
DABIT    EQU   X'20'                                                    27200018
WAOFF    EQU   32                                                       27300018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           27400018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           27500018
IDLEN    EQU   2                        LENGTH OF MODULE ID      Y02072 27550002
*                                                                       27600018
**********************************************************************  27700018
*                                                                       27800018
**********************************************************************  27900018
*                                                                       28000018
*                                                                       28100018
*                                                                       28200018
*                                                                       28400018
*                                                                       28500018
*                                                                       28600018
*                                                                       28700018
*                                                                       28800018
*                                                                       28900018
*                                                                       29000018
*                                                                       29100018
*                                                                       29200018
*                                                                       29300018
*                                                                       29400018
         BALR  RBASE,0                                                  29500018
         USING SLDA,RBASE                                               29600018
         USING IHADCB,RDCB                                              29700018
         USING BLDEB,RDEB                                               29800018
         USING FORCORE,RCORE                                            29900018
*                                                                       30100018
*                                                                       30200018
SLDA     EQU   *                                                        30300018
*                                                                       30400018
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 30405002
         DC    C'IGG01918'              MODULE NAME              YM4640 30410002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 30415003
         DC    C'10/24/74'              LAST SHIP DATE         @Z30TSCF 30420003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 30425002
*                                                                       30500018
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 30600018
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   30700018
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 30800018
         USING WTGENTRY,RWTGC                                    Y02072 30850002
         L     RCORE,WTGCORE-1          GET WORK AREA ADDR       Y02072 30900002
         DROP  RWTGC                                             Y02072 30950002
*                                                                 OC034 31000018
*   THIS SECTION OF CODE UP TO THE LABEL ENDOVR WILL ENSURE THAT  OC034 31100018
*   THE EOB ROUTINE IGG019CT GETS LOADED FOR ANY OPEN OVERRIDE.   OC034 31200018
         TM    JFCBMASK+6,X'C0'         WAS AN OVERRIDE USED      OC034 31300018
         BNO   ENDOVR                   BR IF NO                 A32160 31400020
         TM    0(RPARC),X'0F'           WAS IT LABEL=(,,,IN)     A32160 31500020
         BZ    INCHNG                   BR IF YES                A32160 31600020
         MVC   DCBCNTRL+2(1),DCBCNTRL+3 SAVE WRITE EOB DISP       OC034 31700018
         MVI   DCBCNTRL+3,X'0B'         SET READ EOB ROUTINE FOR  OC034 31800018
*                                       THE ERROR EOB ROUTINE     OC034 31900018
         B     ENDOVR                   CONTINUE                  OC034 32000018
INCHNG   MVI   DCBCNTRL+2,X'0B'         SET WRITE EOB ROUTINE FOR OC034 32100018
*                                       THE ERROR EOB ROUTINE     OC034 32200018
ENDOVR   EQU   *                        CONTINUE                  OC034 32300018
         MVI   22(RWTG),X'CB'           CHANGE ATTRIBUTES TO ONLY LOAD  32400018
*                                                                       32500018
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           32600018
         SR    RUCB,RUCB                CLEAR REG                       32700018
         SR    RF,RF                   CLEAR REG                        32800018
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           32900018
         IC    RF,DEBEXSCL              GET SCALING FACTOR              33000018
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  33100018
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        33200018
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    33300018
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      33400018
*                                                                       33500018
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB AND MUST  UT18 33600018
*  NOW BE INCREMENTED TO POINT BEYOND THE LAST ENTRY.              UT18 33700018
*                                                                  UT18 33800018
SLDAA    SR    RF,RF                    CLEAR REG                A39226 33850020
*                                       A3922                    A39226 33900020
         IC    RF,0(RDEB)              GET NO. OF SUBROUTINES    M6184  33970020
         SLL   RF,1                     MULTIPLY BY TWO          A39226 34050020
*                                       A3922                    A39226 34100020
         AR    RUCB,RF                  ADD TO SUBID POINTER     A39226 34150020
*                                       A3922                    A39226 34200020
*                                                                  UT18 34300018
*  RUCB NOW POINTS TO THE NEXT AVAILABLE SUBROUTINE ID FIELD IN    UT18 34400018
*  THE DEB.                                                        UT18 34500018
SLDAB    EQU   *                                                        34600018
*                                                                  UT18 34700018
*  IF USER TOTALING IS TO BE USED, EOB ROUTINES WHICH CONTAIN THE  UT18 34800018
*  TOTALING LINKAGE MUST BE LOADED INSTEAD OF THE NORMAL EOB RTNS. UT18 34900018
*  THIS IS ACCOMPLISHED BY DOING A TRANSLATE OF THE DCBCNTRL FIELD UT18 35000018
*  TO CONVERT NORMAL EOB DISPLACEMENTS INTO DISPLACEMENTS FOR THE  UT18 35100018
*  UTF EOB ROUTINES.                                               UT18 35200018
*                                                                       35300018
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING OPTION   UT18 35400018
         BZ    SLDAC                    BR IF NOT SPECIFIED        UT18 35500018
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 35600018
         BZ    SLDAC                    IF YES, NO TOTALING REQ'D  UT18 35700018
         TR    DCBCNTRL(4),UTFTBL       CHANGE TO UTF DISPLACEMENT UT18 35800018
SLDAC    EQU   *                                                   UT18 35900018
*                                                                  UT18 36000018
*                                                                       36100018
*                                                                       36200018
*                                                                       36300018
*                                                                       36400018
*                                                                       36500018
*THIS SECTION LOADS MODULES NEEDED BY EITHER PAPER TAPE OR UPDATE       36600018
*                                                                       36700018
         BAL   RF,EOBROUT               GET EOB RT ID                   36800018
*                                                                       36900018
         BAL   RC,SLDROUT               LOAD ROUTINE                    37000018
*                                                                       37100018
         USING WTGENTRY,RWTGC                                    Y02072 37150002
         MVC   WTGIDTTR,SOP9            IDTTR OF NEXT MOD      @Z30TSCF 37160003
*                                                                       37200018
         TM    DCBCIND2,QSAMB           QSAM BEING USED                 37300018
         BO    SLDEOB8                  YES,BRANCH                      37400018
*                                                                       37500018
*                                                                       37700018
SLDEOB2  EQU   *                                                        37800018
*                                                                       37900018
*                                                                       38000018
         MVC   DCBEOBR+1(3),25(RWTG)    STORE ADDRESS                   38100018
*                                                                       38200018
*                                                                       38300018
         MVC   DCBEOBW+1(3),25(RWTG)    STORE ADDRESS                   38400018
*                                                                       38500018
*                                                                       38600018
SLDEOB4  EQU   *                                                        38700018
*                                                                       38800018
         BAL   RF,EOBROUT               GET POSSIBLE WRT ROUT (IN/OUT)  38900018
*                                                                       39000018
*                                                                       39100018
*                                                                       39200018
SLDEOB6  EQU   *                                                        39300018
*                                                                       39400018
         BAL   RF,EOBROUT               IS NOTE/POINT USED              39500018
*                                                                       39600018
         LTR   RC,RC                    TEST FOR ITS ID                 39700018
         BC    8,SLDEOBC                NO,BRANCH                       39800018
*                                                                       39900018
         BAL   RC,SLDROUT               LOAD NOTE/POINT ROUTINE         40000018
         MVC   DCBCNTRL+1(3),25(RWTG)   STORE NOTE/POINT ADDRESS        40100018
         B     SLDEOBE                                                  40200018
*                                                                       40300018
SLDEOB8  EQU   *                                                        40400018
         MVC   DCBEOB+1(3),25(RWTG)     STORE ADDRESS FOR QSAM          40600018
*                                                                       40700018
SLDEOBC  EQU   *                                                        40800018
*                                                                       40900018
         XC    DCBCNTRL(4),DCBCNTRL     CLEAR PARAMETER LIST            41000018
         OI    DCBCNTRL+3,X'01'         SET VECTOR  TO  ONE             41100018
*                                                                       41200018
SLDEOBE  EQU   *                        END.                            41300018
         MVC    DCBEROPT(1),DXCCW6      REPLACE QSAM ERROR OPTIONS      41400018
*                                                                       41500018
*                                                                       41600018
*********************************************************************** 41700018
*                                                                       41800018
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        41900018
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     42000018
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            42100018
         BCR   8,RBASE                                                  42200018
*                                                                       42300018
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    42400018
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             42500018
*                                                                       42600018
         LR    RPARC,RPAR                                               42700018
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       42800018
ZCHEK    CLI   0(RWTGC),0               IS THIS ENTRY COMPLETE          42900018
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         43000018
*                                                                       43100018
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  43200018
         LA    RPARC,PLOFF(0,RPARC)                                     43300018
         BC    15,ZCHEK                                                 43400018
*                                                                       43500018
TCTLRTN  EQU   *                                                        43600018
         USING WTG,RWTG                                                 43650003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*43700003
               MODID=WTGENTRY                                  @Z30TSCF 43750003
         DROP  RWTGC,RWTG                                      @Z30TSCF 43800003
**                                                                      44300018
*                                                                       44400018
*                                                                       44500018
*                                                                       44600018
SLDROUT  EQU   *                                                        44700018
         USING WTGMODNM,RWTG                                     Y02072 44750002
         MVC   WTGMODID,0(RB)           ID TO MOD NAME           Y02072 44800002
         DROP  RWTG                                              Y02072 44850002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 44900002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 44950002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 45000002
         DROP  R1                       DROP CVT BASE            YM1140 45050002
*                                                                       45800018
*                                                                       45900018
**                                                                      46000018
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 46100002
**                                                                      46200018
*                                                                       46300018
*                                                                       46400018
*                                                                       46500018
         ST    RE,24(RWTG)              STORE ADDRESSS OF LOADED ROUTIN 46600018
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ID IN DEB                 46700018
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               46800018
         SR    RD,RD                                                    46900018
         IC    RD,DEBNMSUB              GET NO. OF SUBRT LOADED         47000018
         LA    RD,1(RD)                 ADD ONE TO TOTAL                47100018
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF SUBRT LOADED 47200018
         BR    RC                       RETURN                          47300018
*                                                                       47400018
*                                                                       47500018
*********************************************************************** 47600018
*                                                                       47700018
*                                                                       47800018
*********************************************************************** 47900018
*                                                                       48000018
EOBROUT  EQU   *                                                        48100018
*                                                                       48200018
         SR    RC,RC                                                    48300018
         LA    RE,EOBTABL               GET TABLE OF NAMES              48400018
         LA    RB,IDLEN                 LEN OF MODULE ID         Y02072 48500002
         IC    RC,DCBCNTRL+3            GET ID NO. DEVICE DEP.          48600018
         L     RJ,DCBCNTRL              SHIFT IDS RIGHT BY ONE BYTE     48700018
         SRL   RJ,8                                                     48800018
         ST    RJ,DCBCNTRL                                              48900018
         MR    RB,RB                    CALCULATE WHERE ID IS           49000018
         LR    RB,RC                    PREPARE TO LOAD  MODULE         49100018
         AR    RB,RE                    POINT TO CORRECT ID             49200018
         BR    RF                       RETURN                          49300018
         EJECT                                                          49350002
OPIDCNST DC    C'0S'                                                    50800018
AMIDCNST DC    C'18'                    ID OF THIS MODULE          UT18 50900018
*                                                                       51000018
*      THE FOLLOWING TABLE IS USED WITH A TRANSLATE INSTRUCTION TO UT18 51100018
*      CONVERT DISPLACEMENTS FOR THE EOB TABLE INTO THE ENTRIES    UT18 51200018
*      FOR THE CORRESPONDING UTF EOB ROUTINES.                     UT18 51300018
*                                                                  UT18 51400018
UTFTBL   DC    X'00'                    NO CHANGE                  UT18 51500018
         DC    X'0C'                    IGG019CD BECOMES IGG019TD  UT18 51600018
         DC    X'0D'                    IGG019CC BECOMES IGG019TC  UT18 51700018
         DC    X'03'                    NO CHANGE                  UT18 51800018
         DC    X'04'                    NO CHANGE                  UT18 51900018
         DC    X'05'                    NO CHANGE                  UT18 52000018
         DC    X'06'                    NO CHANGE                  UT18 52100018
         DC    X'07'                    NO CHANGE                  UT18 52200018
         DC    X'08'                    NO CHANGE                  UT18 52300018
         DC    X'09'                    NO CHANGE                  UT18 52400018
         DC    X'0A'                    NO CHANGE                  UT18 52500018
         DC    X'0B'                    NO CHANGE                  UT18 52600018
*                                                                       52700018
*                                                                       52800018
* THIS MODULE IS DEPENDENT ON THE ARRANGEMENT OF THE FOLLOWING LOAD     52900018
*   TABLE.  THE LOAD TABLE IS SET UP WITH A BSAM ENTRY, FOLLOWED        53000018
*   BY THE CORRESPONDING QSAM ENTRY.  THIS PATTERN MUST BE MAINTAINED   53100018
*   TO ENSURE THAT THE PROPER MODULE IS LOADED                          53200018
*                                                                       53300018
SOP9     DC    C'11',VL3(IGG01911)     LAST LOAD OF OPEN EXECS @Z30TSCF 54200003
*                                                                       54500018
*********************************************************************** 54600018
*                                                                       54700018
*        DEVICE DEPENDENT ROUTINES SUPPORTED                            54800018
*                                                                       54900018
EOBTABL  EQU   *                                                        55000018
         DC    C'  '                                                    55100002
EPD2     DC    C'CD'                    EOB RT DISK-OUTP/STANDRF INP    55200002
EGP2     DC    C'CC'                    EOB RT. DISK-TP-RDR. INP/OUTP.  55300002
DDA2     DC    C'CE'                    EOB RT. PRNTR/PUNCH NORMAL      55400002
DDB2     DC    C'CF'                    EOB RT. PRNTR/PUNCH ASA         55500002
NPD2     DC    C'BK'                    NOTE POINT DISK                 55600002
NPT2     DC    C'BD'                    NOTE-POINT TAPE                 55700002
CNT1     DC    C'CA'                    CNTRL RT READER                 55800002
DUMA     DC    C'  '                    TABLE FILLER                    55900002
DUMB     DC    C'  '                    TABLE FILLER                    56000002
DUMC     DC    C'AV'                    DUMMY EXECUTOR                  56100002
OVRD     DC    C'CT'                    OPEN OVERRIDE ERROR RTN   OC034 56200002
UTF1     DC    C'TD'                    USER TOTALLING EOB ROUTINE UT18 56300002
UTF2     DC    C'TC'                    USER TOTALLING EOB ROUTINE UT18 56400002
UTF3     DC    C'TV'                    USER TOTALLING EOB ROUTINE UT18 56500002
UTF4     DC    C'TW'                    USER TOTALLING EOB ROUTINE UT18 56600002
UTF5     DC    C'T2'                    USER TOTALLING EOB ROUTINE UT18 56700002
         SPACE                                                          56800002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 56900002
END      EQU   *                        END OF MODULE            Y02072 56910002
***                                                                     56950002
         TITLE 'IGG01918 - FORMAT OF GOTTEN CORE'                       57500002
*                                                                       57800018
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 57850003
         ORG   WTGIDTTR                                          Y02072 57860002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 57870002
*                                                                       57900018
CVT      DSECT                                                          58000018
         CVT                                                            58100018
*                                                                       58200018
*                                                                       58300018
BLDEB    DSECT                                                          58400018
DEB      DS    0F                                                       58500018
DEBNMSUB DS    0CL1                                                     58600018
DEBTCBAD DS    CL4                                                      58700018
DEBAMLNG DS    0CL1                                                     58800018
DEBDEBAD DS    CL4                                                      58900018
DEBOGLGS DS    0CL1                                                     59000018
DEBIRBAD DS    CL4                                                      59100018
DEBOPATB DS    0CL1                                                     59200018
DEBSYSPG DS    CL4                                                      59300018
DEBNMEXT DS    0CL1                                                     59400018
DEBUSRPG DS    CL4                                                      59500018
DEBPRIOR DS    0CL1                                                     59600018
DEBECBAD DS    CL4                                                      59700018
DEBPROTG DS    0CL1                                                     59800018
DEBDEBID DS    0CL1                                                     59900018
DEBDCBAD DS    CL4                                                      60000018
DEBEXSCL DS    0CL1                                                     60100018
DEBAPPAD DS    CL4                                                      60200018
DEBDVMOD DS    0CL1                                                     60300018
DEBUCBAD DS    CL4                                                      60400018
DEBBINUM DS    CL2                                                      60500018
DEBSTRCC DS    CL2                                                      60600018
DEBSTRHH DS    CL2                                                      60700018
DEBENDCC DS    CL2                                                      60800018
DEBENDHH DS    CL2                                                      60900018
DEBNMTRK DS    CL2                                                      61000018
*                                                                       61100018
           DCBD  DSORG=PS                                               61200018
* DCBREAD IS A TEMPORARY STORAGE AREA USED FOR THE OFFSET USED IN       61300018
*  LOADING EITHER QSAM MODULES OR BSAM MODULES                          61400018
OFFSET   EQU   DCBREAD+2                                                61500018
**********************************************************************  61600018
*                                                                       61700018
           END                                                          61800018
./  ADD  SSI=50160043,NAME=IGG01919
1919  TITLE 'IGG01919 - SAM OPEN EXECUTOR (SECOND HALF OF IGG01913)'    00100003
*********************************************************************** 00106003
*                                                                       00108001
IGG01919 CSECT                                                          00150020
*                                                                       00160002
*MODULE NAME - IGG01919                                          Y02072 00170002
*                                                                       00180002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00190002
*                                                                       00192002
*COPYRIGHT - NONE                                                Y02072 00194002
*                                                                       00196002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00198002
*                                                                       00198402
*                                                                       00200002
*        VS2 RELEASE 02 DELETIONS                                Y02072 00250002
*001010-001020,012000,061000,274500-286000,301500,302500,        Y02027 00260002
*303500-304500,367180-367261,367720-367780,367950-368070,425000, Y02072 00270002
*425500,541080-541840,583010-585000,585890,585910-585930,        Y02072 00280002
*586500,587000,517000,519000-533000,538000,50600-507000,511000,  Y02072 00290002
*516000,547000,573000,576000-583000,676000-677000                Y02072 00340002
*                                                                YM1141 00340102
*                                                                YM1140 00390102
*                                                                YM2507 00392102
*C367660                                                         YM5922 00394102
*                                                                YM1002 00394202
*        VS2 RELEASE 03 DELETIONS                               ZA02510 00396203
*511580                                                        @Z30TSCF 00398203
*                                                                       00398603
*          RELEASE 20 DELETIONS                                         00400018
*2370                                                            S20038 00450020
*0930308000-310000                                               A32160 00470020
*0930277000,363000,369000-370000,606000,672000-673000            S20201 00480020
*          RELEASE 21 DELETIONS                                         00500018
*D606000,673100                                                 XM5707  00501001
*0090015000-021000,030000,304000-317000,342000-359000,415000,    M1753  00520021
*0090421000-422000,431000-432000,434000-484000,554000-572000,    M1753  00540021
*0090584000-605000,606000,608000-609000,646000-668000,669000,    M1753  00560021
*0090671700-672400                                               M1753  00580021
*                                                                       00600002
*STATUS CHANGE LEVEL 006                                                01200003
*                                                                       01300018
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE      UT18 01400018
*    IGG01913 AND LOADS I/O APPENDAGES AND AN ASYNCHRONOUS ROUTINE,     01500021
*    AS APPROPRIATE.  THE ENTRY POINTS OF THE LOADED APPENDAGES ARE     01600021
*    PLACED IN THE APPENDAGE VECTOR TABLE.  FOR TRACK OVERFLOW, A       01700021
*    CIRB MACRO IS ISSUED, AND THE ENTRY POINT OF THE ASYNCHRONOUS      01800021
*    ROUTINE IS PLACED IN THE IRB.  ID'S FOR ALL LOADED MODULES ARE     01900021
*    PLACED IN THE SUBROUTINE ID SECTION OF THE DEB.                    02000021
*                                                                       02200018
*ENTRY POINTS - ENTERED ONLY FROM IGG01913 BY USE OF XCTL MACRO    UT18 02300018
*                                                                       02400018
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS)                        02500018
*                                                                       02600018
*OUTPUT: DCB(USERS),IOB(USERS).                                         02700018
*                                                                       02800018
*EXTERNAL ROUTINES: NONE.                                               02900018
*EXITS - NORMAL: XCTL TO IGG01926                                       03000021
*                                                                       03100018
*EXITS-ERROR: NONE.                                                     03200018
*                                                                       03300018
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              03400018
*                                                                       03500018
*      BYTE  0-7  NAME                                                  03600018
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            03700018
*      BYTE 11    CONCATENATION NUMBER                                  03800018
*      BYTE 12    ZERO                                                  03900018
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       04000018
*                        ALIAS INDICATOR 1 BIT                          04100018
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      04200018
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              04300018
*      BYTE 17    ZERO                                                  04400018
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      04500018
*      BYTE 20    TRANSLATION TABLE                                     04600018
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            04700018
*      BYTE 22-23 ATTRIBUTES                                            04800018
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     04900018
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           05000018
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 05100018
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        05200018
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       05300018
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        05400018
*      BYTE 40-   TABLE OF IDTTR'S                                      05500018
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          05600018
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          05700018
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          05800018
*                   NOT USED                         (3 BYTES)          05900018
*                                                                       06000018
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY,   Y02072 06100002
*            RUNS IN SUPERVISOR STATE                            Y02072 06150002
*                                                                       06200018
*NOTES: THIS ROUTINE HAS A LIST OF ALL BSAM, QSAM MODULES SUPPORTED.    06300018
*                                                                       06400018
*********************************************************************** 06510003
         EJECT                                                          06550003
*********************************************************************** 06600003
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                06800018
*********************************************************************** 07000018
*                                                                       07100018
RE       EQU   0         WORK REG5                                      07150002
RF       EQU   1         WORK REG6                                      07160002
R1       EQU   RF                       PARM REGISTER            Y02072 07170002
RDCB     EQU   2         DCB REGISTER                                   07200018
RBASE    EQU   3         BASE REGISTER                                  07300018
RCORE    EQU   4         WORK AREA ADDRESS                              07400018
RPAR     EQU   5         TOP OF PARAMETER LIST                          07500018
RWTG     EQU   6         TOP OF WTG TABLE                               07600018
RPARC    EQU   7         CURRENT PARAMETER                              07700018
RWTGC    EQU   8         CURRENT TRANS LOAD                             07800018
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    07900018
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       08000018
RDEB     EQU   11        DEB ADDRESS                                    08100018
RB       EQU   12        WORK REG1  **                                  08200018
RWK2     EQU   RB                       WORK REGISTER            Y02072 08250002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          08300018
RBRNCH   EQU   RC                       WORK REGISTER            Y02072 08350002
RD       EQU   14        WORK REG3  **                                  08400018
RJ       EQU   15        WORK REG4                                      08500018
RWK1     EQU   RJ                       WORK REGISTER            Y02072 08550002
         SPACE 2                                                        08800003
OUTP     EQU   X'0F'                                                    26400003
TAPEB    EQU   X'80'                                                    26500018
SDINDIC  EQU   X'08'                    SEARCH DIRECT INDICATOR  S20201 26600003
NRECREDY EQU   X'20'                                                    26650003
D6       EQU   6                        DISPLACEMENT OF SIX             26660003
SIX      EQU   6                                                        26670003
ASISVLN  EQU   9                        DW FOR IRB WKA           YM1141 26680003
WAOFF    EQU   32                                                       26700018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           26800018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           26900018
         EJECT                                                          28800003
         BALR  RBASE,0                                                  28900018
         USING *,RBASE                                                  29000003
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 29850002
         DC    C'IGG01919'              MOD NAME                 Y02072 29860002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 29870003
         DC    C'10/24/74'              LAST DATE MODIFIED     @Z30TSCF 29890003
BEGIN    DS    0H                                                Y02072 29892002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 30000018
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   30100018
         USING IHADCB,RDCB                                              30150003
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 30200018
         USING BLDEB,RDEB                                               30250003
         L     RCORE,4(RWTGC)           GET WORK AREA                   30300018
         USING FORCORE,RCORE                                            30350003
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  31800018
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           32000018
         USING AVT,RTIOT                                                32050001
         SR    RUCB,RUCB                CLEAR REG                       32100018
         SR    RF,RF                    CLEAR RER                       32200018
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           32300018
         IC    RF,DEBEXSCL              GET SCALING FACTOR              32400018
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  32500018
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        32600018
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    32700018
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      32800018
*                                                                       32900018
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB AND MUST  UT18 33000018
*  NOW BE INCREMENTED TO POINT BEYOND THE LAST ENTRY.              UT18 33100018
*                                                                  UT18 33200018
SLDAA    CLI   0(RUCB),X'00'            IS RUCB BEYOND LAST ENTRY  UT18 33300018
         BE    SLDAB                    BR IF YES                  UT18 33400018
         LA    RUCB,2(RUCB)             INCREMENT TO NEXT ID FIELD UT18 33500018
         B     SLDAA                    TEST NEXT FIELD            UT18 33600018
*                                                                  UT18 33700018
*  RUCB NOW POINTS TO THE NEXT AVAILABLE SUBROUTINE ID FIELD IN    UT18 33800018
*  THE DEB.                                                        UT18 33900018
*                                                                       34000018
SLDAB    EQU   *                                                        34100018
         TM    DCBDEVT,TAPEB            IS THIS A TAPE DEVICE    S20038 36130020
         BO    SLDAPP14                 YES, BRANCH-IT'S PCI     S20038 36160020
         TM    0(RPARC),OUTP            DCB FOR OUTPUT ONLY             36200003
         BO    LAB001                   YES,BRANCH               S20201 36300020
         TM    DCBRECFM,DCBRECTO        DCB FOR TRACK OVERFLOW          36500003
         BZ    SLDAPP04                 NO,MUST BE PCI                  36600003
         TM    JFCBMASK+D6,SDINDIC      SEARCH DIRECT USED       S20201 36703020
         BNO   NOSDOPT                  BRANCH NO                S20201 36706020
         LA    RB,CEAFP                 GET SEARCH DIRECT CE     S20201 36709020
         BAL   RC,SLDROUT               LOAD ROUTINE             S20201 36712020
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    36715001
         LA    RB,AEOESF                GET END OF EXTENT APPEN  S20201 36727020
         BAL   RC,SLDROUT               LOAD IT IN AND PUT       S20201 36730020
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   36733001
         B     SLDAPP19                 AROUND NEXT              S20201 36739020
LAB001   EQU   *                                                 S20201 36754020
         TM    JFCBMASK+SIX,NRECREDY    IS IT RECORD READY       S20201 36757020
         BO    SLDAPP06                 NO, BRANCH TO PROCESS    S20201 36760020
*                                       OUTPUT                          36763020
         TM    DCBCIND2,DCBCNCHS        IS IT CHAINED SCHEDULING YM5922 36766003
         BO    SLDAPP06                 YES, BRANCH AROUND       S20201 36769002
*                                                                       36779001
*                       DETERMINE CHANNEL END APPENDAGE                 36780001
*                                                                       36781001
         LA    RB,ACEU                  IGG019C0 FOR FORMAT U           36782001
         TM    DCBRECFM,DCBRECU         IS IT FORMAT U?                 36783003
         BC    9,SLDAPP03               YES, LOAD APPENDAGE             36784001
         LA    RB,ACEF                  IGG019CI FOR FIXED              36785001
         TM    DCBRECFM,DCBRECF         TEST FOR FIXED FORMAT           36786003
         BO    SLDAPP03                 BRANCH IF SO                    36787001
         LA    RB,ACEV                  ELSE MUST BE VARIABLE,          36788001
*                                       USE IGG019CJ                    36789001
SLDAPP03 BAL   RC,SLDROUT               GO LOAD MODULE                  36790001
         ST    RE,AVTCE                 PUT ADDRESS IN                  36791001
*                                       APPENDAGE TABLE.                36792001
         B     SLDAPP06                                                 36793001
NOSDOPT  EQU   *                                                        36794001
         LA    RB,TOABNE           GET ID OF TO ABNE APPENDAGE    M3320 36820018
         BAL   RC,SLDROUT               LOAD ROUTINE              M3320 36840003
         ST    RE,AVTABNE               APPENDAGE TABLE ENTRY FOR       36852001
*                                       ABNORMAL END APPENDAGE          36900001
         TM    DCBRECFM,DCBRECU         FORMAT U RCDS            S20201 37020003
         BO    M670                     BRANCH IF YES            S20201 37030020
         LA    RB,ACEF                  GET F LN CHECK APPEND           37200003
         TM    DCBRECFM,DCBRECF+DCBRECBR  FIXED BLOCK RECORDS           37300003
         BO    SLDAPP02                YES,GO LOAD ROUTINE              37400018
         TM    DCBRECFM,DCBRECV        VARIABLE RECORDS                 37600003
         BZ    M670                    NO, BRANCH                 M3320 37700003
         LA    RB,ACEV                 GET V LN CHECK APPENDAGE         37800018
SLDAPP02 EQU   *                                                        38000018
         BAL   RC,SLDROUT              LOAD THE ROUTINE                 38100018
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    38200001
         B     ASY                                                M3320 38250018
M670     EQU   *                                                  M3320 38340018
*                                       ABNORMAL END ENTRY POINT        38430001
         AH    RE,FOUR                  PLUS 4 IS CE ENTRY POINT        38480001
         ST    RE,AVTCE                 CHANNEL END ENTRY, AVT          38530001
ASY      LA    RB,ASYNCH           GET ASYNCH ID                  M3320 38800018
         BAL   RC,SLDROUT              LOAD ROUTINE                     38900018
* WHEN RETURNING FROM 'SLDROUT',REGISTER 0 CONTAINS THE ADDRESS         39000018
*  OF THE ASYNCHRONOUS ERROR ROUTINE                                    39100018
*                                                                       39200018
*        BUILD IRB FOR IGG019C1 - WORKAREA IS USED IN 19C3              39225002
*                                                                       39250002
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE),WKAREA=ASISVLN    YM1141 39300002
*                                                                       39400018
         ST    RF,24(RWTG)             STORE ADDRESS OF IRB TEMPORARY   39500018
         MVC   DEBIRBAD+1(3),25(RWTG)   PUT IRB ADDRESS IN DEB          39600018
         LA    RB,AEOET                GET T. O. EOE ID                 39800018
         B     SLDAPP05                                                 39900018
SLDAPP04 EQU   *                                                        40000018
*                                                                       40100018
*  END OF EXTENT APPENDAGE NEEDED FOR DISK INPUT                        40200018
*                                                                       40300018
         TM    DCBDEVT,X'20'           D.A. DEVICE                      40400018
         BZ    SLDAPP14                NO,BRANCH                        40500018
         LA    RB,AEOEP                GET END OF EXTENT ID FOR PCI     40700018
SLDAPP05 EQU   *                                                        40900018
         BAL   RC,SLDROUT              LOAD ROUTINE                     41000018
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   41100001
SLDAPP06 EQU   *                                                        41300018
         TM    DCBRECFM,DCBRECTO        DCB FOR TRACK OVERFLOW          41400003
         BO    SLDAPP19                BRANCH IF YES; NO MORE    M1753  41500021
*                                      APPENDAGES                       41550021
*                                                                       41600018
SLDAPP14 EQU   *                                                        41700018
*                                                                       41750002
* BEFORE LOADING CHAINED SCHEDULING APPENDAGE, TEST FOR A REAL   Y02072 41800002
* ADDRESS ENVIRONMENT.  IF V=R, LOAD IGG019V6 FROM SVCLIB        Y02072 41850002
* INSTEAD OF IGG019CU FROM LPALIB AND STORE PCI ENTRY POINT.     Y02072 41860002
* IF VIRTUAL, LOAD IGG019CU AND DO NOT STORE PCI ENTRY POINT     Y02072 41870002
* IN THE AVT.                                                    Y02072 41880002
*                                                                       41890002
         LA    RB,ACEO                  GET ID OF PCI/CE & ABNE APPEND  41900018
         LA    RBRNCH,SLDAPP17          RETURN ADDRESS           Y02072 41950002
         L     RWK1,DEBTCBAD            GET TCB ADDRESS          Y02072 42580002
         USING TCB,RWK1                                          Y02072 42590002
         TM    TCBFLGS6,TCBRV           IS TASK VIRT=REAL        Y02072 42592002
         DROP  RWK1                                              Y02072 42592402
         BZ    SLDROUT                  N0, BRANCH               Y02072 42594002
         LA    RWK2,VRPCI               GET V=R PCI APPENDAGE    Y02072 42594402
         BAL   RBRNCH,SLDROUT1          GO GET PROPER APPENDAGE  Y02072 42594802
         ST    RE,AVTPCI                PCI ENTRY IN AVT                42600001
SLDAPP17 AH    RE,SECENTRY              EPA FOR CE OR ABNE       Y02072 42650002
         ST    RE,AVTCE                 CHANNEL END ENTRY,AVT           42700001
         ST    RE,AVTABNE               ABNORMAL END ENTRY,AVT          42750001
SLDAPP19 EQU   *                                                        43300018
         MVC   0(5,RWTGC),NEXTMOD      PUT NEXT EXECUTOR'S ID &  M1753  43400021
*                                      TTR IN WTG TABLE.                45400021
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        48800018
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     48900018
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            49000018
         BCR   8,RBASE                                                  49100018
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    49300018
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             49400003
         LR    RPARC,RPAR                                               49600018
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       49700018
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           49800018
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         49900003
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  50100018
         LA    RPARC,PLOFF(0,RPARC)                                     50200018
         B     ZCHEK                                                    50300003
TCTLRTN  EQU   *                                                        50500018
         USING WTG,RWTG                                                 50550003
         USING WTGENTRY,RWTGC                                           50560003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*50600003
               MODID=WTGENTRY                                  @Z30TSCF 50650003
         DROP  RWTG,RWTGC                                      @Z30TSCF 50700003
*                                                                       51152002
*  COME HERE TO 'LOAD' ROUTINES                                         51154003
*                                                                       51156002
SLDROUT  EQU   *                        DCB ADDR ZERO FOR LOADS  Y02072 51158003
         L     RF,CVTPTR                COMM VECTOR PTR         ZA02510 51158403
         USING CVT,RF                   CVT ADDRESSABILITY      ZA02510 51158803
         L     R1,CVTLINK               GET LINKLIB DCB ADDR    ZA02510 51159203
         B     SLDROUT2                 GO LOAD ROUTINE          Y02072 51160002
*                                                                       51200002
*  COME HERE TO LOAD IGG019V6 FROM SVC LIB                              51250002
*                                                                       51300002
SLDROUT1 EQU   *                                                        51600002
         L     RF,CVTPTR(0,0)           GET COMM VECTOR                 53400018
         USING CVT,RF                   CVT ADDRESSABILITY       Y02072 53450002
         L     RF,CVTSVDCB              GET SVCLIB DCB ADDR      YM1002 53500002
         USING WTG,RWTG                                          Y02072 53550002
SLDROUT2 MVC   WTGMODID,0(RB)           ID TO MODULE NAME        Y02072 53560002
         DROP  RWTG,RF                                           YM1140 53570002
*                                                                       53700018
         LOAD  EPLOC=(RWTG),DCB=(1)     LOAD ACCESS METHOD RTN   Y02072 53800002
*                                                                       54000018
         ST    RE,24(RWTG)              TEMP STORE OF RTN ADDR          54104002
         SR    RD,RD                                                    54200018
         IC    RD,DEBNMSUB              GET NO OF SUBROUTINES LOADED    54300018
         LA    RD,1(RD)                 ADD ONE TO TOTAL                54400018
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF SUBRT LOADED 54500018
         MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB Y02072 54700002
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               54800018
         BR    RC                      RETURN                           54900018
         EJECT                                                          55000003
FOUR     DC    H'4'                                              M4573  57250019
SECENTRY EQU   FOUR                     SECONDARY ENTRY POINT    Y02072 57260002
OPIDCNST DC    C'0S'                                                    57400018
AMIDCNST DC    C'19'                    ID OF THIS MODULE          UT18 57500018
*                                                                       58550001
*        FOLLOWING LIST DEFINES FUNCTION OF MODS IN XCTL TABLE  XM5707  58560001
*                                                                       58570001
*        AEOEP,CZ                       EOE APPENDAGE FOR PCI   XM5707  58580001
*        AEOET,CH                       EOE APPEN NON-SF-INPUT  XM5707  58581001
*        ACEO,CU                        CE, PCI, XCE APP - V=V  Y02072  58582002
*        VRPCI,V6                       CE, PCI, XCE APP - V=R  Y02072  58582402
*        ACEF,CI                        CE APPEN LEN CHK F REC  XM5707  58583001
*        ACEV,CJ                        CE APPEN LEN CK V REC   XM5707  58584001
*        TOABNE,C3                      TRK OVFL XCE APPEN      XM5707  58585001
*        ASYNCH,C1                      TRK OVFL ASY ERROR RTN  XM5707  58586001
*        ACEU,C0                        CE FOR FORMAT U REC     XM5707  58587001
*        CEAFP,FP                       SCH DIRECT CE APPEN     XM5707  58588001
*        AEOESF,C4                      SCH DIR EOE APPEN       XM5707  58590001
*                                                                       58594001
*                                                                       58596002
*  MODULE ID'S                                                          58598002
*                                                                       58598402
NEXTMOD  DC    C'26',VL3(IGG01926)                             @Z30TSCF 58598803
AEOEP    DC    C'CZ'                                             Y02072 58599202
AEOET    DC    C'CH'                                             Y02072 58599602
ACEO     DC    C'CU'                                             Y02072 58599702
ACEF     DC    C'CI'                                             Y02072 58599802
ACEV     DC    C'CJ'                                             Y02072 58599902
TOABNE   DC    C'C3'                                             Y02072 58616602
ASYNCH   DC    C'C1'                                             Y02072 58626602
ACEU     DC    C'C0'                                             Y02072 58628602
CEAFP    DC    C'FP'                                             Y02072 58630602
         DC    C'  '                    FILLER FOR IGG019FN      YM2507 58631002
AEOESF   DC    C'C4'                                             Y02072 58632602
VRPCI    DC    C'V6'                                             Y02072 58633002
         SPACE                                                          58633102
PATCH    DC    25H'0'                   PATCH AREA               Y02072 58647002
END      EQU   *                        END OF MODULE            Y02072 58674902
         EJECT                                                          58688802
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 67550003
         ORG   WTGIDTTR                                          Y02072 67600002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 67650002
         EJECT                                                          67800003
AVT      DSECT                          APPENDAGE VECTOR TABLE          67806001
AVTEOEPG DS    0CL1                     NO.PAGES MODULE REQUIRES        67812001
AVTEOE   DS    A                        ADDR OF END OF EXTENT           67818001
*                                       APPENDAGE                       67824001
AVTSIOPG DS    0CL1                     NO.PAGES MODULE REQUIRES        67830001
AVTSIO   DS    A                        ADDR OF START I/O               67836001
*                                       APPENDAGE                       67842001
AVTPCIPG DS    0CL1                     NO.PAGES MODULE REQUIRES        67848001
AVTPCI   DS    A                        ADDR OF PCI APPENDAGE           67854001
AVTCEPG  DS    0CL1                     NO.PAGES MODULE REQUIRES        67860001
AVTCE    DS    A                        ADDR OF CHANNEL END             67866001
*                                       APPENDAGE                       67872001
AVTABNPG DS    0CL1                     NO.PAGES MODULE REQUIRES        67878001
AVTABNE  DS    A                        ADDR OF ABNORMAL END            67884001
*                                       APPENDAGE                       67890001
         EJECT                                                          67900003
CVT      DSECT                                                          68000018
         CVT                                                            68100018
         EJECT                                                          68300003
BLDEB    DSECT                                                          68400018
DEB      DS    0F                                                       68500018
DEBNMSUB DS    0CL1                                                     68600018
DEBTCBAD DS    CL4                                                      68700018
DEBAMLNG DS    0CL1                                                     68800018
DEBDEBAD DS    CL4                                                      68900018
DEBOGLGS DS    0CL1                                                     69000018
DEBIRBAD DS    CL4                                                      69100018
DEBOPATB DS    0CL1                                                     69200018
DEBSYSPG DS    CL4                                                      69300018
DEBNMEXT DS    0CL1                                                     69400018
DEBUSRPG DS    CL4                                                      69500018
DEBPRIOR DS    0CL1                                                     69600018
DEBECBAD DS    CL4                                                      69700018
DEBPROTG DS    0CL1                                                     69800018
DEBDEBID DS    0CL1                                                     69900018
DEBDCBAD DS    CL4                                                      70000018
DEBEXSCL DS    0CL1                                                     70100018
DEBAPPAD DS    CL4                                                      70200018
DEBDVMOD DS    0CL1                                                     70300018
DEBUCBAD DS    CL4                                                      70400018
DEBBINUM DS    CL2                                                      70500018
DEBSTRCC DS    CL2                                                      70600018
DEBSTRHH DS    CL2                                                      70700018
DEBENDCC DS    CL2                                                      70800018
DEBENDHH DS    CL2                                                      70900018
DEBNMTRK DS    CL2                                                      71000018
         EJECT                                                          71100003
           DCBD  DSORG=PS                                               71200018
         EJECT                                                          71202003
         IKJTCB                                                         71210001
           END                                                          71600018
./  ADD  SSI=70550463,NAME=IGG01923
   TITLE  'IGG01923 -- SECOND HALF OF IGG0191Z -- D/A UPDATE -- RECORD *00050021
               READY CHANNEL PROGRAMS'                                  00100021
IGG01923 CSECT                                                          00150021
*MODULE NAME - IGG01923                                          Y02072 00152002
*                                                                       00154002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00156002
*                                                                       00158002
*COPYRIGHT - NONE                                                Y02072 00158402
*                                                                       00158802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00159202
*                                                                       00160002
*          VS2 RELEASE 2 DELETIONS                               Y02072 00170002
*006000,039000,082500,158500-159000188000-204000204500-212500    Y02072 00180002
*160500,166000,177500,180500                                     Y02072 00182002
*                                                                YM4640 00182102
*                                                                YM7595 00184102
*                                                                       00186103
*          VS2 RELEASE 3 DELETIONS                                      00188103
*                                                              @Z30TSCF 00188503
*C140000,140500 OZ10223 IS SYSROUTE FROM OY13449                ZA10223 00189237
*A140000-140700      ORIGINAL APAR IS OS78123                  @ZA14710 00189637
*                                                                       00190002
*          RELEASE 21 DELETIONS                                         00200021
*A                                                              SA53279 00250021
*                                                                       00450021
*   THIS MODULE CREATED IN RELEASE 21 FROM SPLIT OF IGG0191Z            00500021
*                                                                       00550021
*STATUS CHANGE LEVEL 002                                                00600002
*                                                                       00650021
*FUNCTION/OPERATION - FINISH INITIALIZATION OF IOB'S AND CONSTRUCTION   00700021
*        OF CHANNEL PROGRAMS STARTED IN IGG0191Z                        00750021
*                                                                       00800021
*ENTRY POINT - IGG01923 FROM IGG0191Z                                   00850021
*                                                                       00900021
*INPUT- SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00950021
*                                                                       01000021
*OUTPUT - IOB(USER)- SEE DESCRIPTION OF REGISTERS, DCB(USERS).          01050021
*                                                                       01100021
*EXTERNAL ROUTINES- NONE.                                               01150021
*                                                                       01200021
*EXITS-NORMAL-IGG01915-PRESENCE OF RECORD AREA INDICATOR                01250021
*            -IGG01912-ALL OTHER CONDITIONS                             01300021
*                                                                       01350021
*EXITS-ERROR- NONE.                                                     01400021
*                                                                       01410002
*MACROS : ACTION - MODESET, XCTL, XCTLTABL                       Y02072 01420002
*                                                                       01430002
*MACROS : MAPPING - DCBD,IECDSECS(IOB,WTG),IGGBCB,IHACCW,IHAFCAUD       01440002
*                                                                       01450021
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              01500021
*                                                                       01550021
*      BYTE  0-7  NAME                                                  01600021
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            01650021
*      BYTE 11    CONCATENATION NUMBER                                  01700021
*      BYTE 12    ZERO                                                  01750021
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       01800021
*                        ALIAS INDICATOR 1 BIT                          01850021
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      01900021
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              01950021
*      BYTE 17    ZERO                                                  02000021
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      02050021
*      BYTE 20    TRANSLATION TABLE                                     02100021
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            02150021
*      BYTE 22-23 ATTRIBUTES                                            02200021
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     02250021
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           02300021
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 02350021
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        02400021
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       02450021
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        02500021
*      BYTE 40-   TABLE OF IDTTR'S                                      02550021
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          02600021
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          02650021
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          02700021
*                   NOT USED                         (3 BYTES)          02750021
*                                                                       02800021
*      SEE DEVICETB DSECT                                               02850021
*                                                                       02900021
*ATTRIBUTES- REENTRANT, REUSABLE, SUPERVISOR STATE,              Y02072 02950002
*            RUNS IN USER KEY UNLESS OTHERWISE SPECIFIED.        Y02072 02960002
*                                                                       03000021
*NOTE-OFFSETS TO CCW'S TO BEGIN BUILDING ARE PASSED IN DCB BY IGG0191Z  03050021
*    -BUFFER ADDRESS ARE PASSED IN THE IOB BY IGG0191Z           YM7595 03060002
*                                                                       03100021
*********************************************************************** 03150021
*                                                                       03200021
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                03250021
*                                                                       03300021
*********************************************************************** 03350021
*                                                                       03400021
RDCB     EQU   2         DCB REGISTER                                   03450021
RBASE    EQU   3         BASE REGISTER                                  03500021
RCORE    EQU   4         WORK AREA ADDRESS                              03550021
RPAR     EQU   5         TOP OF PARAMETER LIST                          03600021
RWTG     EQU   6         TOP OF WTG TABLE                               03650021
RPARC    EQU   7         CURRENT PARAMETER                              03700021
RWTGC    EQU   8         CURRENT TRANS LOAD                             03750021
RBUFADR  EQU   9         ADDR OF CURRENT BUFFER                  YM7595 03800002
RUCB     EQU   10        COUNTER IN IOB GENERATION                      03850021
RB       EQU   12        WORK REG1  **                                  03950021
RWK1     EQU   RB                       WORK REGISTER            Y02072 03960002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          04000021
RD       EQU   14        WORK REG3  **                                  04050021
RJ       EQU   15        WORK REG4                                      04100021
RE       EQU   0         WORK REG5                                      04150021
RF       EQU   1         WORK REG6                                      04200021
*                                                                       04250021
* MASKS FOR ACCESS METHODS IN SAM                                       04300021
*                                                                       04350021
QSAMB    EQU   X'01'                                                    04400021
*                                                                       04450021
* DCB OFFSET CONSTANTS                                                  04500021
*                                                                       04550021
WCPL     EQU   4                        NORMAL WRITE CP LENGTH          04600021
*        THE READ CCW OFFSET IN THE DCBOFFSR FIELD IS THE OFFSET        04650021
*        OF THE READ DATA CCW FROM THE BEGINNING OF THE SAM IOB         04700021
*        PREFIX                                                         04750021
OFFSRB   EQU   120                      BSAM READ CCW OFFSET            04800021
WCOSRB   EQU  X'98'                     READ CCW OFFSET FOR WRT  A31983 04850021
*                                          CHK WITH BSAM         A31983 04900021
TOWCOSRB EQU  X'A0'                     READ CCW OFFSET FOR WRT  A31983 04950021
*                                          CHK + TRK OV FOR BSAM A31983 05000021
EIGHT    EQU   8                        EIGHT                           05050021
FORTY4   EQU   44                      CONSTANT OF 44                   05100021
FIFTY5   EQU   55                       FIFTY5                          05150021
FIFTY6   EQU   56                       FIFTY6                          05200021
FOURTY8  EQU   48                       FOURTY8                         05250021
FOURTY9  EQU   49                       FOURTY9                         05300021
RDSECTOR EQU   X'22'                    COMMAND CODE                    05350021
ZERO     EQU   0                        ZERO                            05400021
TWO      EQU   2                                                        05450021
THREE    EQU   3                        THREE                           05500021
SIX      EQU   6                        SIX                             05550021
NINETEEN EQU   19                       CONSTANT OF NINETEEN            05600021
THIRTY2  EQU   32                       THIRTY2                         05650021
THIRTY6  EQU   36                       THIRTY SIX                      05700021
THIRTY9  EQU   39                       THIRTY9                         05750021
SIXTY4   EQU   64                       SIXTY4                          05800021
*                                                                       05850021
* MASKS USED TO TEST OPTION FIELDS IN DCB                               05900021
*                                                                       05950021
WRTCK    EQU   X'80'                                                    06000021
UPDATEB  EQU   X'80'                                                    06050021
TRKOVFLB EQU   X'20'                    TRACK OVERFLOW OPTION           06100021
*                                                                       06150021
* COMMAND BYTES FOR THE 2841 CONTROL UNIT                               06200021
*                                                                       06250021
RDC        EQU   X'92'                                                  06300021
RDD        EQU   X'86'                                                  06350021
RDKD     EQU   X'8E'                                                    06400021
*                                                                       06450021
*   CHANNEL CONTROL WORD FLAGS                                          06500021
*                                                                       06550021
SLI        EQU   X'20'                                                  06600021
CC         EQU   X'40'                                                  06650021
SLICC    EQU   X'60'                                                    06700021
*                                                                       06750021
* MASKS FOR RECORD FORMATS                                              06800021
*                                                                       06850021
FORMATF  EQU   X'40'                    NON FORMAT F MASK               06900021
FSTDX    EQU   X'88'                    FIXED STANDARD FORMAT    M1760  06950021
*                                                                       07000021
* OFFSET FOR PARAMETER TESTS                                            07050021
*                                                                       07100021
ONE      EQU   1                                                        07150021
*                                                                       07200021
* MASKS FOR STATUS BITS TO BE TESTED                                    07250021
*                                                                       07300021
FIRSTIOB   EQU   X'01'                                                  07350021
*                                                                       07400021
* MASKS USED TO LOAD IGG01915 IN SUPPORT OF QSAM LOCATE MODE OF         07450021
* OPERATION WITH LOGICAL RECORD INTERFACE FOR VARIABLE LENGTH           07500021
* SPANNED RECORD                                                        07550021
*                                                                       07600021
FLGOFFST EQU   4                        OFFSET TO FLAG IN BCB    S19015 07650021
RAFLAG   EQU   X'80'                    RECORD AREA PRESENT      S19015 07700021
NULL     EQU   0                        ZERO DISPLACEMENT        S19015 07750021
IDLEN    EQU   5                        LENGTH OF IDTTR          S19015 07800021
*                                                                       07850021
*                                                                       07900021
*                                                                       07950021
         BALR  RBASE,0                  REG 3 IS BASE                   08000021
         USING SOPB,RBASE                                               08050021
         USING IHADCB,RDCB              REG 2 IS DCB                    08100021
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDRESS      08200021
*                                                                       08300021
SOPB     EQU   *                                                        08350021
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 08352002
MODULE   DC    C'IGG01923'              MODULE NAME            @ZA14710 08354037
APAR     DC    C'@ZA14710'              LAST SHIP CODE         @ZA14710 08355037
DATE     DC    C'&SYSDATE'              LAST SHIP DATE         @ZA14710 08356037
BEGIN    DS    0H                       END OF MODULE NAME       YM4640 08358402
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 08360002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 08400021
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   08450021
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESS           08500021
         L     RD,DCBIOBA               ADDR OF FIRST IOB               08550021
         SR    RUCB,RUCB                ZERO REG TO GET NO OF IOB'S     08600021
         IC    RUCB,DCBREAD+ONE            SAVED BY IGG0191Z            08650021
SOPB30   EQU   *                                                        08800021
         LTR   RUCB,RUCB                HAS IOB COUNT BEEN EXHAUSTED    08850021
         BC    7,SOPB31                 NO, BRANCH                      08900021
*                                                                       08950021
         B     SOPBEND                                                  09000021
*                                                                       09050021
*********************************************************************** 09100021
*                                                                       09150021
*    REGISTER USEAGE FOR CHANNEL PROGRAM CONSTRUCTION                   09200021
*       RB - RD/WRT SEQUENCE POINTER                                    09250021
*       RC - FDA POINTER                                                09300021
*       RD - CURRENT IOB POINTER                                        09350021
*       RJ - LINK REG TO INTERNAL SUBROUTINE                            09400021
*       RF - PARAREG FOR INTERNAL SUBROUTINE                            09450021
*       RE - INTERNAL POINTER IN READ SEQUENCE                          09500021
*                                                                       09550021
*********************************************************************** 09600021
*                                                                       09650021
SOPB31   EQU   *                                                        09700021
         SR    RB,RB                    ZERO REG                        09750021
         SR    RC,RC                    ZERO REG                        09800021
         IC    RB,DCBREAD+TWO           GET OFFSETS IN IOB PASSED       09850021
         IC    RC,DCBREAD+THREE            BY IGG0191Z                  09900021
         AR    RB,RD                    GET ADDR IN IOB TO CONTINUE     09950021
         AR    RC,RD                       BUILDING CHAN PROGRAM        10000021
         TM    DCBCIND2,QSAMB           QSAM USED                       10050021
         BC    1,SOPB61                 YES, BRANCH                     10100021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10110002
         MVI   DCBOFFSR,OFFSRB          STORE BSAM RD CCW OFFSET        10150021
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    10200021
         BC    14,SOPB607               NO, BRANCH                      10250021
         MVI  DCBOFFSR,WCOSRB           READ CCW OFFSET FOR BSAM A31983 10300021
*                                          WITH WRT CHK          A31983 10350021
         TM   DCBRECFM,TRKOVFLB         TRK OVFLOW SPECIFIED?    A31983 10400021
         BNO  SOPB607                   NO, DON'T UPDATE OFFSET  A31983 10450021
         MVI  DCBOFFSR,TOWCOSRB         YES, READ CCW OFFSET FOR A31983 10500021
*                                          BSAM WITH WRTCK + TKOVA31983 10550021
SOPB607  EQU   *                                                        10600021
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 10602002
         TM    DCBRECFM,TRKOVFLB        USING TRACK OVERFLOW?     M1760 10650021
         BO    SOPB608                  YES, BRANCH              M1760  10700021
         TM    DCBRECFM,FSTDX           FIXED STANARD FORMAT?    M1760  10750021
         BNO   SOPB635                  NO, BRANCH               M1779  10800021
SOPB608  EQU   *                                                        10850021
         CLI   DCBNCP,ONE               MORE THAN 1 IOB USED            10900021
         B     SOPB62                   BRANCH TO TEST                  10950021
*                                                                       11000021
SOPB61   EQU   *                                                        11050021
         TM    DCBRECFM,TRKOVFLB        USING TRACK OVERFLOW?    M1760  11100021
         BO    SOPB615                  YES, BRANCH              M1760  11150021
         TM    DCBRECFM,FSTDX           FIXED STANDARD FORMAT?   M1760  11200021
         BNO   SOPB635                  NO, BRANCH               M1779  11250021
SOPB615  EQU   *                                                        11300021
         CLI   DCBBUFNO,ONE             MORE THAN 1 IOB USED            11350021
*                                                                       11400021
SOPB62   EQU   *                                                        11450021
         BNH   SOPB64                   NO, BRANCH                      11500021
*                                                                       11550021
*    RC POINTS TO CCHHR OF THIS IOB                                     11600021
*                                                                       11650021
         SR    RF,RF                    CLEAR REG                       11700021
         IC    RF,DCBIOBL               GET IOB LENGTH                  11750021
         SLL   RF,3                     CHANGE TO BYTES                 11800021
         LA    RC,0(RF,RC)              POINT TO NEXT DA ADDR FIELD     11850021
SOPB63   EQU   *                                                        11900021
         ST    RC,32(RB)                STORE IN RD COUNT CCW           11950021
         OI    36(RB),SLICC             SET SILI AND CC FLAGS ON        12000021
         MVI   39(RB),X'05'             STORE COUNT OF 5 IN CCW         12050021
         B     SOPB637                  BRANCH TO CONTINUE              12100021
SOPB635  EQU   *                                                        12150021
         LA    RC,SIXTY4(RB)            ADDR TO READ IN COUNT   SA53279 12200021
         ST    RC,THIRTY2(RB)           COUNT ADDR                      12250021
         OI    THIRTY6(RB),CC           TURN ON COMMAND CHAIN           12300021
         MVI   THIRTY9(RB),EIGHT        EIGHT BYTE LENGTH FOR COUNT     12350021
SOPB637  EQU *                                                          12400021
         MVI   THIRTY2(RB),RDC          MOVE IN COMMAND CODE            12450021
         MVI   40(RB),RDD               STORE READ DATA CMD BYTE        12500021
         OI    FORTY4(RB),CC            TURN ON COMMAND CHAIN           12550021
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  12600021
         BO    SOPB65                   YES, BRANCH                     12650021
*                                                                       12700021
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         12750021
         BC    4,SOPB65A                NO, BRANCH                      12800021
         MVI   40(RB),RDKD              STORE RD DATA & KEY IN CMD BYTE 12850021
         B     SOPB65A                                                  12900021
*                                                                       12950021
SOPB64   EQU   *                                                        13000021
         L     RDCB,DXUDCBAD            GET ADDR OF USERS DCB    Y02072 13010002
         LA    RC,DCBFDAD+3             POINT TO CCHHR IN DCB           13050021
         L     RDCB,0(RPARC)            GET PROTECTED DCB AGAIN  Y02072 13060002
         B     SOPB63                                                   13100021
*                                                                       13150021
SOPB65   EQU   *                                                        13200021
         LA    RF,40(RB)                POINT TO ACTUAL RD DATA CCW     13250021
*                                                                       13300021
*        THE FOLLOWING CODE SETS UP THE CCW'S WITH LENGTH AND BUF ADDR  13350021
*                                                                       13400021
         USING IOBQSAMN,RD                                              13450002
         L     RBUFADR,IOBFLAG3         GET BUFFER ADDR SAVED BY YM7595 13500002
*                                         IGG0191Z                      13550002
         USING CCW,RF                                                   13560002
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 13570002
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 13580002
         SR    RBUFADR,RBUFADR          PREPARE TO CLR IOBLFAG3  YM7595 13582002
         ST    RBUFADR,IOBFLAG3         CLEAR IOBFLAG3           YM7595 13584002
         DROP  RD,RF                                                    13590002
SOPB65A  EQU   *                                                        13600021
         MVC   FOURTY9(THREE,RB),DCBCHECK+ONE SECTOR ADDRESS            13650021
         MVI   FOURTY8(RB),RDSECTOR     MOVE IN COMMAND CODE            13700021
         MVI   FIFTY5(RB),ONE           LENGTH                          13750021
         BCTR  RUCB,0                   DECREMENT COUNTER               13800021
         MVC   FIFTY6(EIGHT,RB),DCBFDAD MOVE DCBFDAD INTO SEEK ADDR     13850021
         MVC   40(8,RD),DCBFDAD         MOVE FDAD TO IOS'S FDA          13900021
*                                                                       13950021
         TM    DCBRECFM,FORMATF         IS FORMAT U OR V USED  @ZA14710 14000037
         BO    SOPB65B                  YES, BRANCH            @ZA14710 14010037
         TM    DCBRECFM,FSTDX           FIXED STANDARD FORMAT?  ZA10223 14020037
         BO    SOPB66                   BRANCH YES              ZA10223 14030037
         TM    DCBRECFM,TRKOVFLB        TRACK OVERFLOW USED    @ZA14710 14040037
         BO    SOPB66                   YES, BRANCH. IF NOT    @ZA14710 14050037
*                                    SET SLI FLAG FOR FIXED    @ZA14710 14060037
SOPB65B  EQU   *                                               @ZA14710 14070037
         OI    44(RB),SLI               SET SLI FLAG IN CCW             14100021
SOPB66   EQU   *                                                        14150021
         TM    DCBRECFM,TRKOVFLB        USING TRACK OVERFLOW?    M1760  14200021
         BO    SOPB665                  YES, BRANCH              M1760  14250021
         TM    DCBRECFM,FSTDX           FIXED STANDARD FORMAT?   M1760  14300021
         BNO   SOPB69                   BRANCH NO                M1779  14350021
SOPB665  EQU   *                                                 M1760  14400021
         CLI   DCBREAD+ONE,ONE          ONE IOB?                        14450021
         BNH   SOPB69                   NO, BRANCH                      14500021
         LTR   RUCB,RUCB                HAVE ALL IOBS BEEN GENERATED    14550021
         BNZ   SOPB69A                  BRANCH NO                       14600021
         L     RC,DCBIOBA               GET FIRST IOB GENERATED         14650021
         SR    RF,RF                    CLEAR REG                       14700021
         IC    RF,DCBOFFSR              OBTAIN READ CCW OFFSET          14750021
         LA    RC,NINETEEN(RC,RF)       GET NEXT SEARCH AADR            14800021
         ST    RC,32(RB)                STORE IN LAST IOBS RD CNT CCW   14850021
         MVI   32(RB),RDC               STORE CMD BYTE                  14900021
         B     SOPBEND                  GET OUT - IOB'S COMPLETED       14950021
SOPB69   EQU   *                                                        15000021
         SR    RJ,RJ                    CLEAR REG               SA53279 15050021
         IC    RJ,DCBIOBL               IOB LENGTH              SA53279 15060021
         SLL   RJ,THREE                 TIMES EIGHT             SA53279 15070021
         LA    RD,0(RJ,RD)              NEXT POSSIBLE IOB       SA53279 15080021
         B     SOPB30                   RETURN FOR NEXT IOB     SA53279 15090021
SOPB69A  EQU   *                                                        15100021
         LA    RD,SIXTY4(RB)            POINT PAST FDAD AND COUNT       15150021
*                                          TO NEXT POSSIBLE IOB LOC.    15200021
         B     SOPB30                   RETURN FOR NEXT IOB             15250021
SOPBEND  EQU   *                                                        15300021
         L     RWK1,DCBIOBA             GET IOB ADDR             Y02072 15310002
         USING IOBQSAMN,RWK1                                     Y02072 15320002
         OI    IOBNFLG1,IOBFIRST        SET FIRST IOB FLAG FOR   Y02072 15330002
*                                         CLOSE EXECUTORS        Y02072 15340002
         DROP  RWK1                                              Y02072 15342002
*        CLEAR AND RESTORE FIELDS IN DCB USED TO PASS INFORMATION       15350021
*        FROM IGG0191Z                                                  15400021
*                                                                       15410002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 15412002
         SPACE                                                          15422002
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 15432002
         XC    DCBREAD+ONE(THREE),DCBREAD+ONE                           15450021
         MVI   DCBREAD+THREE,ONE                                        15500021
         XC    DCBCHECK+ONE(THREE),DCBCHECK+ONE                         15550021
         MVI   DCBCHECK+THREE,ONE                                       15600021
         TM    DCBDSORG,X'02'          DCB FOR PO                       15650021
         BC    8,SOPBENDA              NO, BRANCH                       15700021
         MVI   DCBCNTRL+1,5            PROVIDE N/P FOT PO               15750021
SOPBENDA EQU   *                                                        15800021
         OI    DCBCIND2,UPDATEB         FLAG DCB AS UPDATE MODE FOR     15950021
*                                        LOAD EXECUTOR TESTING IGG01912 16000021
         USING WTGENTRY,RWTGC                                    Y02072 16010002
         MVC   WTGIDTTR,IGG01912      NEXT EXECUTOR FOR UPDATE @Z30TSCF 16020003
* PRESENCE OF RECORD AREA TEST TO DETERMINE NEXT LOAD EXECUTOR. IF      16150021
* YES, GET LOAD EXECUTOR IGG01915.                                      16200021
         TM    DCBBUFCB+3,X'01'         WERE BUFFERS SUPPLIED    A40538 16250021
         BO    RELOOP                   NO BUFFERS, BSAM         A40538 16300021
*                                       BRANCH TO LOAD IGG01912         16350021
         L     RB,DCBBUFCB              BUFFER CONTROL BLOCK     A40538 16400021
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 16402002
         TM    FLGOFFST(RB),RAFLAG      RECORD AREA INDICATOR ON A40538 16450021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 16452002
         BZ    RELOOP                   BRANCH IF NOT TO LOAD    A40538 16500021
*                                       IGG01912                        16550021
         MVC   WTGIDTTR,IGG01915        1915 IF REC AREA INDIC @Z30TSCF 16560003
*                                         NOT ON                 Y02072 16570002
RELOOP   EQU   *                                                        16700021
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        16750021
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     16800021
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            16850021
         BCR   8,RBASE                                                  16900021
*                                                                       16950021
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    17000021
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             17050021
*                                                                       17100021
         LR    RPARC,RPAR                                               17150021
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       17200021
*                                                                       17250021
ZCHEK    EQU   *                                                        17300021
         CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           17350021
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         17400021
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  17450021
         LA    RPARC,PLOFF(0,RPARC)                                     17500021
         BC    15,ZCHEK                                                 17550021
*                                                                       17600021
TCTLRTN  EQU   *                                                        17650021
         USING WTG,RWTG                                                 17700003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*17750003
               MODID=WTGENTRY                                  @Z30TSCF 17800003
         DROP  RWTGC,RWTG                                      @Z30TSCF 17850003
**                                                                      18100021
WAOFF    EQU   32                                                       18350021
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           18400021
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           18450021
*                                                                       18460002
*  MODULE ID'S                                                          18470002
*                                                                       18480002
OPIDCNST DC    C'0S'                                                    18500021
AMIDCNST DC    C'23'                    THIS MODULES ID                 18550021
IGG01912 DC    C'12',VL3(IGG01912)    FOR UPDATE, NOT REC AREA @Z30TSCF 18560003
IGG01915 DC    C'15',VL3(IGG01915)    FOR UPDATE WITH REC AREA @Z30TSCF 18570003
         SPACE 6                                                        18572002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 18580002
END      EQU   *                        END OF MODULE            Y02072 18590002
         EJECT                                                          18590403
CVT      DSECT                                                 @Z30TSCF 18590803
         CVT                                                   @Z30TSCF 18591203
         EJECT                                                          18592002
         DCBD  DSORG=PS                                                 18600002
         EJECT                                                          18620002
         IHACCW  DSECT=YES                                              18670002
         EJECT                                                          18720002
         IGGBCB  TYPE=SAM                                               18770002
         TITLE 'IGG01923 - FORMAT OF GOTTEN CORE'                       20200002
         IECDSECS  (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES    @Z30TSCF 20250003
         ORG   WTGIDTTR                                          Y02072 20300002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 20350002
         EJECT                                                          20400002
FORCORE  DSECT                                                          20410002
         IHAFCAUD ORG=YES                                               20450002
           END                                                          21300021
./  ADD  SSI=43090048,NAME=IGG01926
         TITLE 'IGG01926 - SAM STAGE 3 OPEN EXECUTOR'                   00090021
IGG01926 CSECT                                                          00180021
*MODULE NAME - IGG01926                                          Y02072 00190002
*                                                                       00200002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00210002
*                                                                       00220002
*COPYRIGHT - NONE                                                Y02072 00222002
*                                                                       00224002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00226002
*                                                                       00230002
*        VS2 RELEASE 02 DELETIONS                                Y02072 00240002
*002700,007200,013400,103800,110800152400-152600,136900,151100   Y02072 00250002
*116800-117000,117800,119000-122600,123200                       Y02072 00252002
*                                                                YM1140 00254002
*                                                                       00256003
*        VS2 RELEASE 3 DELETIONS                                        00258003
*                                                              @Z30TSCF 00258403
*                                                                       00260002
*STATUS CHANGE LEVEL 001                                                00270002
*                                                                       00380021
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE      UT18 00400021
*    IGG01919 AND LOADS THE REMAINING I/O MODULES.  WHAT IS TO          00420021
*      BE LOADED IS DETERMINED FROM THE CODES IN THE DCBCNTRL      UT18 00440021
*      FIELD WHICH WAS SET BY PREVIOUS LOADS OF THE OPEN EXECUTORS.UT18 00460021
*      IT WILL PLACE THE ADDRESS OF THE LOADED MODULES IN THE           00480021
*      APPROPRIATE DCB FIELDS, AND THE ID'S IN THE DEB.                 00500021
*      IT WILL BRING IN THE APPROPRIATE END-OF-BLOCK(EOB) ROUTINE       00520021
*                                                                       00560021
*ENTRY POINTS - ENTERED ONLY FROM IGG01919 BY USE OF XCTL MACRO         00580021
*                                                                       00600021
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS)                        00620021
*                                                                       00640021
*OUTPUT: DCB(USERS),IOB(USERS).                                         00660021
*                                                                       00680021
*EXTERNAL ROUTINES: NONE.                                               00700021
*EXITS-NORMAL: XCTL TO IGG01911                                  Y02072 00720002
*                                                                       00740021
*EXITS-ERROR: NONE.                                                     00760021
*                                                                       00770002
*MACROS-MAPPING:IECDSECS(MAIN,WTG), DCBD, CVT                    Y02072 00772002
*                                                                       00780021
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00800021
*                                                                       00820021
*      BYTE  0-7  NAME                                                  00840021
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00860021
*      BYTE 11    CONCATENATION NUMBER                                  00880021
*      BYTE 12    ZERO                                                  00900021
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00920021
*                        ALIAS INDICATOR 1 BIT                          00940021
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00960021
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00980021
*      BYTE 17    ZERO                                                  01000021
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      01020021
*      BYTE 20    TRANSLATION TABLE                                     01040021
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            01060021
*      BYTE 22-23 ATTRIBUTES                                            01080021
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     01100021
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           01120021
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 01140021
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        01160021
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       01180021
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        01200021
*      BYTE 40-   TABLE OF IDTTR'S                                      01220021
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          01240021
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          01260021
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          01280021
*                   NOT USED                         (3 BYTES)          01300021
*                                                                       01320021
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY    Y02072 01340002
*            AND SUPERVISOR STATE                                Y02072 01350002
*                                                                       01360021
*NOTES: THIS ROUTINE HAS A LIST OF ALL BSAM, QSAM MODULES SUPPORTED.    01380021
*                                                                       01400021
*********************************************************************** 01420021
*                                                                       01440021
*                                                                       01460021
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01480021
*                                                                       01500021
*********************************************************************** 01520021
*                                                                       01540021
RE       EQU   0         WORK REG5                                      01550002
RF       EQU   1         WORK REG6                                      01552002
R1       EQU   RF        PARM REG                                YM1140 01554002
RDCB     EQU   2         DCB REGISTER                                   01560021
RBASE    EQU   3         BASE REGISTER                                  01580021
RCORE    EQU   4         WORK AREA ADDRESS                              01600021
RPAR     EQU   5         TOP OF PARAMETER LIST                          01620021
RWTG     EQU   6         TOP OF WTG TABLE                               01640021
RPARC    EQU   7         CURRENT PARAMETER                              01660021
RWTGC    EQU   8         CURRENT TRANS LOAD                             01680021
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01700021
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01720021
RDEB     EQU   11        DEB ADDRESS                                    01740021
RB       EQU   12        WORK REG1  **                                  01760021
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01780021
RD       EQU   14        WORK REG3  **                                  01800021
RJ       EQU   15        WORK REG4                                      01820021
*                                                                       01880021
*                                                                       01900021
PARAR    EQU   RPARC                                                    01920021
*                                                                       01940021
*********************************************************************** 01960021
*                                                                       01980021
*********************************************************************** 02000021
*                                                                       02020021
* MASK'S TO TEST PARAMETER LIST WITH                                    02040021
*                                                                       02060021
*********************************************************************   02080021
INP      EQU   X'0F'                                                    02100021
OUTP       EQU   X'0F'                                                  02120021
UPDATE     EQU   X'04'                                                  02140021
INOUT      EQU   X'03'                                                  02160021
OUTIN      EQU   X'07'                                                  02180021
RDBACK     EQU   X'01'                                                  02200021
INPRDBK  EQU   X'0E'               MASK TO CK INPUT AND RDBACK     UT18 02220021
*                                                                       02240021
*                                                                       02260021
*********************************************************************   02280021
*                                                                       02300021
*                                                                       02320021
* OFFSET FOR PARAMETER TESTS                                            02340021
*                                                                       02360021
ONE        EQU   X'01'                                                  02380021
FRTYATE    EQU   48                                                     02400021
DISPSN     EQU   X'0'                                                   02420021
*                                                                       02440021
*                                                                       02460021
*********************************************************************   02480021
*                                                                       02500021
* OFFSETS FOR DEB REFERENCE                                             02520021
*                                                                       02540021
*                                                                       02560021
BIN      EQU   36                                                       02580021
BEXT     EQU   38                                                       02600021
*                                                                       02620021
*                                                                       02640021
*                                                                       02660021
*********************************************************************   02680021
*                                                                       02700021
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              02720021
*                                                                       02740021
*                                                                       02760021
*                                                                       02780021
DOUBLE     EQU   X'01'                                                  02800021
*                                                                       02820021
*                                                                       02840021
STOWB      EQU   X'80'                                                  02860021
WRTCK      EQU   X'80'                                                  02880021
OVRFLO   EQU   X'20'                                                    02900021
PCI        EQU   X'20'                                                  02920021
MINKEY     EQU   X'01'                                                  02940021
CONCAT     EQU   X'FF'                                                  02960021
UTFMASK  EQU   X'02'                    MASK FOR TOTALING FACILITY UT18 02980021
*                                                                       03000021
*********************************************************************   03020021
*                                                                       03040021
* MASKS FOR ACCESS METHODS IN SAM                                       03060021
*                                                                       03080021
QSAMB      EQU   X'01'                                                  03100021
BSAMBIT    EQU   X'00'                                                  03120021
PAM        EQU   X'02'                                                  03140021
*                                                                       03160021
*                                                                       03180021
* MASKS FOR MACRO'S TO BE USED                                          03200021
*                                                                       03220021
GETB       EQU   X'40'                                                  03240021
PUTB       EQU   X'40'                                                  03260021
READB      EQU   X'20'                                                  03280021
WRITEB     EQU   X'20'                                                  03300021
POINTB     EQU   X'04'                                                  03320021
CNTRLB     EQU   X'02'                                                  03340021
*                                                                       03360021
*                                                                       03380021
*********************************************************************   03400021
*                                                                       03420021
* MASKS FOR DEVICES TO BE SUPPORTED                                     03440021
*                                                                       03460021
*                                                                       03480021
*                                                                       03500021
*********************************************************************   03520021
*                                                                       03540021
*                                                                       03560021
*                                                                       03580021
*                                                                       03600021
*********************************************************************   03620021
*                                                                       03640021
* MASKS FOR STATUS BITS TO BE TESTED                                    03660021
*                                                                       03680021
*                                                                       03700021
EXCPN      EQU   X'30'                                                  03720021
COMPLETE   EQU   X'80'                                                  03740021
FIRSTIOB   EQU   X'01'                                                  03760021
*                                                                       03780021
*                                                                       03800021
*                                                                       03820021
*********************************************************************   03840021
*                                                                       03860021
* MASKS FOR BUFFER TECHNIQUE'S                                          03880021
*                                                                       03900021
EXCHANGB   EQU   X'10'                                                  03920021
SIMPLEB    EQU   X'40'                                                  03940021
*                                                                       03960021
*********************************************************************   03980021
*                                                                       04000021
*                                                                       04020021
* MODES OF OPERATION FOR QSAM                                           04040021
*                                                                       04060021
LOCATEB    EQU   X'08'                                                  04080021
MOVEB      EQU   X'10'                                                  04100021
MOVEXCHB EQU X'14'                                                      04120021
SUBSTUTB   EQU   X'04'                                                  04140021
*                                                                       04160021
*                                                                       04180021
*********************************************************************   04200021
*                                                                       04220021
*                                                                       04240021
* COMMAND BYTES FOR THE 2841                                            04260021
*                                                                       04280021
*       CONTROL UNIT                                                    04300021
*                                                                       04320021
*                                                                       04340021
*                                                                       04360021
SRCHE      EQU   X'31'                                                  04380021
WRTCKD     EQU   X'1D'                                                  04400021
RDC        EQU   X'92'                                                  04420021
RDKD       EQU   X'8E'                                                  04440021
RDD        EQU   X'86'                                                  04460021
TIC        EQU   X'08'                                                  04480021
*                                                                       04500021
*                                                                       04520021
*********************************************************************   04540021
*                                                                       04560021
*                                                                       04580021
* MASKS FOR RECORD FORMATS                                              04600021
*                                                                       04620021
*                                                                       04640021
STANDRDF   EQU   X'08'                                                  04660021
FORMATU    EQU   X'C0'                                                  04680021
FORMATF    EQU   X'80'                                                  04700021
FORMATV    EQU   X'40'                                                  04720021
BLOCKED    EQU   X'10'                                                  04740021
FIXEDBLK   EQU   X'90'                                                  04760021
*                                                                       04780021
*                                                                       04800021
*********************************************************************   04820021
*                                                                       04840021
*                                                                       04860021
*   CHANNEL CONTROL WORD FLAGS                                          04880021
*                                                                       04900021
SKIP       EQU   X'10'                                                  04920021
SLI        EQU   X'20'                                                  04940021
CC         EQU   X'40'                                                  04960021
DATACH     EQU   X'A0'                                                  04980021
SLICC      EQU   X'60'                                                  05000021
SLICCSK    EQU   X'70'                                                  05020021
*                                                                       05040021
*                                                                       05060021
*********************************************************************   05080021
*                                                                       05100021
*                                                                       05120021
KEYS       EQU   X'01'                                                  05140021
QSAM       EQU   X'01'                                                  05160021
*                                                                       05180021
*                                                                       05200021
*********************************************************************   05220021
*                                                                       05240021
*                                                                       05260021
*********************************************************************   05280021
*                                                                       05300021
*                                                                       05320021
**********************************************************************  05340021
ASA        EQU   X'04'                                                  05360021
BKREAD     EQU   X'01'                                                  05380021
URBITS   EQU   X'40'                                                    05400021
TAPEB    EQU   X'80'                                                    05420021
DABIT    EQU   X'20'                                                    05440021
WAOFF    EQU   32                                                       05460021
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           05480021
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           05500021
IDLEN    EQU   2                        LENGTH OF A MODULE ID    Y02072 05510002
*                                                                       05520021
**********************************************************************  05540021
*                                                                       06000021
*                                                                       06020021
*                                                                       06040021
*                                                                       06060021
*                                                                       06080021
*                                                                       06100021
*                                                                       06120021
*                                                                       06140021
*                                                                       06160021
*                                                                       06180021
*                                                                       06200021
*                                                                       06220021
*                                                                       06240021
*                                                                       06260021
         BALR  RBASE,0                                                  06280021
         USING SLDA,RBASE                                               06300021
         USING IHADCB,RDCB                                              06320021
         USING BLDEB,RDEB                                               06340021
         USING FORCORE,RCORE                                            06360021
*                                                                       06400021
*                                                                       06420021
SLDA     EQU   *                                                        06440021
         B     BEGIN                    BR AROUND MODULE ID    @Z30TSCF 06450003
         DC    C'IGG01926'              MODULE NAME            @Z30TSCF 06452003
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 06454003
         DC    C'10/09/74'              LAST SHIP DATE         @Z30TSCF 06456003
BEGIN    DS    0H                                              @Z30TSCF 06458003
*                                                                       06460021
*                                                                       06480021
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 06500021
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   06520021
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 06540021
         L     RCORE,4(RWTGC)           GET WORK AREA                   06560021
*                                                                 OC034 06580021
*   THIS SECTION OF CODE UP TO THE LABEL ENDOVR WILL ENSURE THAT  OC034 06600021
*   THE EOB ROUTINE IGG019CT GETS LOADED FOR ANY OPEN OVERRIDE.   OC034 06620021
         TM    JFCBMASK+6,X'C0'         WAS AN OVERRIDE USED      OC034 06640021
         BNO   ENDOVR                   BR IF NO                 A32160 06660021
         TM    0(RPARC),X'0F'           WAS IT LABEL=(,,,IN)     A32160 06680021
         BZ    INCHNG                   BR IF YES                A32160 06700021
         MVC   DCBCNTRL+2(1),DCBCNTRL+3 SAVE WRITE EOB DISP       OC034 06720021
         MVI   DCBCNTRL+3,X'0B'         SET READ EOB ROUTINE FOR  OC034 06740021
*                                       THE ERROR EOB ROUTINE     OC034 06760021
         B     ENDOVR                   CONTINUE                  OC034 06780021
INCHNG   MVI   DCBCNTRL+2,X'0B'         SET WRITE EOB ROUTINE FOR OC034 06800021
*                                       THE ERROR EOB ROUTINE     OC034 06820021
ENDOVR   EQU   *                        CONTINUE                  OC034 06840021
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  06860021
*                                                                       06880021
         SR    RUCB,RUCB                CLEAR REG                       06920021
         SR    RF,RF                    CLEAR RER                       06940021
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           06960021
         IC    RF,DEBEXSCL              GET SCALING FACTOR              06980021
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  07000021
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        07020021
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    07040021
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      07060021
*                                                                       07080021
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB AND MUST  UT18 07100021
*  NOW BE INCREMENTED TO POINT BEYOND THE LAST ENTRY.              UT18 07120021
*                                                                  UT18 07140021
SLDAA    CLI   0(RUCB),X'00'            IS RUCB BEYOND LAST ENTRY  UT18 07160021
         BE    SLDAB                    BR IF YES                  UT18 07180021
         LA    RUCB,2(RUCB)             INCREMENT TO NEXT ID FIELD UT18 07200021
         B     SLDAA                    TEST NEXT FIELD            UT18 07220021
*                                                                  UT18 07240021
*  RUCB NOW POINTS TO THE NEXT AVAILABLE SUBROUTINE ID FIELD IN    UT18 07260021
*  THE DEB.                                                        UT18 07280021
*                                                                       07300021
SLDAB    EQU   *                                                        07320021
*                                                                  UT18 07340021
*  IF USER TOTALING IS TO BE USED, EOB ROUTINES WHICH CONTAIN THE  UT18 07360021
*  TOTALING LINKAGE MUST BE LOADED INSTEAD OF THE NORMAL EOB RTNS. UT18 07380021
*  THIS IS ACCOMPLISHED BY DOING A TRANSLATE OF THE DCBCNTRL FIELD UT18 07400021
*  TO CONVERT NORMAL EOB DISPLACEMENTS INTO DISPLACEMENTS FOR THE  UT18 07420021
*  UTF EOB ROUTINES.                                               UT18 07440021
*                                                                       07460021
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING OPTION   UT18 07480021
         BZ    SLDAC                    BR IF NOT SPECIFIED        UT18 07500021
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 07520021
         BZ    SLDAC                    IF YES, NO TOTALING REQ'D  UT18 07540021
         TR    DCBCNTRL(4),UTFTBL       CHANGE TO UTF DISPLACEMENT UT18 07560021
SLDAC    EQU   *                                                   UT18 07580021
*                                                                       07600021
*                                                                       07620021
*********************************************************************** 07640021
*      GET THE EOB MODULES NEEDED FOR THIS FILE                         07660021
*********************************************************************   07680021
*                                                                       07700021
         BAL   RF,EOBROUT               GET EOB RT ID                   10260021
*                                                                       10280021
         BAL   RC,SLDROUT               LOAD ROUTINE                    10300021
*                                                                       10320021
         USING WTGENTRY,RWTGC                                    Y02072 10330002
         MVC   WTGIDTTR,SOP9            NEXT EXECUTOR          @Z30TSCF 10332003
         TM    DCBCIND2,QSAMB           QSAM BEING USED                 10340021
         BO    SLDEOB9                 YES,BRANCH                       10360021
*                                                                       10400021
SLDEOB2  EQU   *                                                        10420021
*                                                                       10440021
         MVC   DCBEOBR+1(3),25(RWTG)  LOAD EOB ADDR IN DCB              10460021
*                                                                       10480021
SLDEOB20 EQU   *                                                        10500021
*                                                                       10520021
         MVC   DCBEOBW+1(3),25(RWTG)    LOAD EOB WRITE ADDRESS IN DCB   10540021
*                                                                       10560021
SLDEOB4  EQU   *                                                        10580021
*                                                                       10600021
         BAL   RF,EOBROUT               GET POSSIBLE WRT ROUT (IN/OUT)  10620021
*                                                                       10640021
         LTR   RC,RC                    DCB FOR IN/OUT                  10660021
         BC    8,SLDEOB6                NO BRANCH                       10680021
*                                                                       10700021
         BAL   RC,SLDROUT               LOAD WRT EOB RT.                10720021
*                                                                       10740021
         MVC   DCBEOBW+1(3),25(RWTG)    LOAD EOB WRITE ADDRESS IN DCB   10760021
*                                                                       10780021
SLDEOB6  EQU   *                                                        10800021
*                                                                       10820021
         BAL   RF,EOBROUT               IS NOTE/POINT USED              10840021
*                                                                       10860021
         LTR   RC,RC                    TEST FOR ITS ID                 10880021
         BC    8,SLDEOBC                NO BRANCH                       10900021
*                                                                       10920021
SLDEOB8  EQU   *                                                        10940021
*                                                                       10960021
*                                                                       10980021
         BAL   RC,SLDROUT               LOAD NOTE/POINT ROUTINE         11000021
         MVC   DCBCNTRL+1(3),25(RWTG)   STORE NOTE/POINT ADDRESS        11020021
         B     SLDEOBE                                                  11040021
SLDEOB9  EQU   *                                                        11060021
         MVC   DCBEOB+1(3),25(RWTG)    STORE EOB ROUTINE                11100021
*                                                                       11120021
SLDEOBC  EQU   *                                                        11140021
         XC    DCBCNTRL(4),DCBCNTRL     CLEAR PARA LIST                 11160021
         OI    DCBCNTRL+3,X'01'         SET VECTOR  TO  ONE             11180021
SLDEOBE  EQU   *                        END.                            11200021
         MVC    DCBEROPT(1),DXCCW6      REPLACE QSAM ERROR OPTIONS      11220021
*                                                                       11240021
*                                                                       11260021
*********************************************************************** 11280021
*                                                                       11300021
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        11320021
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     11340021
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            11360021
         BCR   8,RBASE                                                  11380021
*                                                                       11400021
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    11420021
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             11440021
*                                                                       11460021
         LR    RPARC,RPAR                                               11480021
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       11500021
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           11520021
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         11540021
*                                                                       11560021
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  11580021
         LA    RPARC,PLOFF(0,RPARC)                                     11600021
         BC    15,ZCHEK                                                 11620021
*                                                                       11640021
TCTLRTN  EQU   *                                                        11660021
         USING WTG,RWTG                                                 11710003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11760003
               MODID=WTGENTRY                                  @Z30TSCF 11770003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11780003
*                                                                       11800021
*                                                                       11820021
*                                                                       11840021
*                                                                       11860021
SLDROUT  EQU   *                                                        11880021
         USING WTGMODNM,RWTG                                     Y02072 11930002
         MVC   WTGMODID,0(RB)           ID TO MODULE NAME        Y02072 11980002
         DROP  RWTG                                              Y02072 12030002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 12080002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 12130002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 12180002
         DROP  R1                       DROP CVT BASE            YM1140 12230002
*                                                                       12280021
*                                                                       12300021
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 12320002
*                                                                       12340021
*                                                                       12360021
*                                                                       12380021
         SR    RD,RD                                                    12400021
         IC    RD,DEBNMSUB              GET NO OF SUBROUTINES LOADED    12420021
         LA    RD,1(RD)                 ADD ONE TO TOTAL                12440021
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF SUBRT LOADED 12460021
         ST    RE,24(RWTG)              TEMP STORE OF ROUTINE ADDR,     12480021
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        12500021
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               12520021
         BR    RC                      RETURN                           12540021
*                                                                       12560021
*                                                                       12580021
*********************************************************************** 12600021
*                                                                       12620021
*                                                                       12640021
*********************************************************************** 12660021
*                                                                       12680021
EOBROUT  EQU   *                                                        12700021
*                                                                       12720021
         SR    RC,RC                                                    12740021
         LA    RE,EOBTABL               GET TABLE OF NAMES              12760021
         LA    RB,IDLEN                 LEN OF MODULE ID         Y02072 12780002
         IC    RC,DCBCNTRL+3            GET ID NO. DEVICE DEP.          12800021
         L     RJ,DCBCNTRL              SHIFT IDS RIGHT BY ONE BYTE     12820021
         SRL   RJ,8                                                     12840021
         ST    RJ,DCBCNTRL                                              12860021
         MR    RB,RB                    CALCULATE WHERE ID IS           12880021
         LR    RB,RC                    PREPARE TO LOAD  MODULE         12900021
         AR    RB,RE                    POINT TO CORRECT ID             12920021
         BR    RF                       RETURN                          12940021
OPIDCNST DC    C'0S'                                                    13060021
AMIDCNST DC    C'19'                    ID OF THIS MODULE          UT18 13080021
*                                                                       13280021
*      THE FOLLOWING TABLE IS USED WITH A TRANSLATE INSTRUCTION TO UT18 13300021
*      CONVERT DISPLACEMENTS FOR THE EOB TABLE INTO THE ENTRIES    UT18 13320021
*      FOR THE CORRESPONDING UTF EOB ROUTINES.                     UT18 13340021
*                                                                       13360021
UTFTBL   DC    X'00'                    NO CHANGE                  UT18 13380021
         DC    X'0E'                    IGG019CV BECOMES IGG019TV  UT18 13400021
         DC    X'0F'                    IGG019CW BECOMES IGG019TW  UT18 13420021
         DC    X'03'                    NO CHANGE                  UT18 13440021
         DC    X'04'                    NO CHANGE                  UT18 13460021
         DC    X'05'                    NO CHANGE                  UT18 13480021
         DC    X'06'                    NO CHANGE                  UT18 13500021
         DC    X'07'                    NO CHANGE                  UT18 13520021
         DC    X'0D'                    IGG019CC BECOMES IGG019TC  UT18 13540021
         DC    X'10'                    IGG019C2 BECOMES IGG019T2  UT18 13560021
         DC    X'0A'                    NO CHANGE                  UT18 13580021
         DC    X'0B'                    NO CHANGE                  UT18 13600021
SOP9     DC    C'11',VL3(IGG01911)  IGGO1911 OR IECOS90X -QSAM @Z30TSCF 13740003
*                                                                       13800021
*********************************************************************** 14500021
*                                                                       14520021
*        DEVICE DEPENDENT ROUTINES SUPPORTED                            14540021
*                                                                       14560021
EOBTABL  EQU   *                                                        14580021
         DC    C'  '                                                    14600002
EPD2     DC    C'CV'                                                    14620002
EGP2     DC    C'CW'                                                    14640002
DDA2     DC    C'CX'                                                    14660002
DDB2     DC    C'CY'                                                    14680002
NPD2     DC    C'BK'                    NOTE-POINT  DA  WITH PCI        14700002
NPT2     DC    C'BL'                    NOTEPOINT  TAPE  WITH PCI       14720002
NPD3     DC    C'BC'                    NOTE/POINT DISK                 14740002
EGP3     DC    C'CC'                    EOB RT. DISK-TP-RDR INP/OUTP    14760002
EOB2     DC    C'C2'                    EOB USED BY TRACK OVERFLOW      14780002
DUMY     DC    C'AV'                                                    14800002
OVRD     DC    C'CT'                    OPEN OVERRIDE ERROR RTN   OC034 14820002
UTF1     DC    C'TD'                    USER TOTALLING EOB ROUTINE UT18 14840002
UTF2     DC    C'TC'                    USER TOTALLING EOB ROUTINE UT18 14860002
UTF3     DC    C'TV'                    USER TOTALLING EOB ROUTINE UT18 14880002
UTF4     DC    C'TW'                    USER TOTALLING EOB ROUTINE UT18 14900002
UTF5     DC    C'T2'                    USER TOTALLING EOB ROUTINE UT18 14920002
         SPACE                                                          14924002
PATCH    DC    0H'0',XL50'00'           PATCH AREA             @Z30TSCF 14930003
END      EQU   *                        END OF MODULE            Y02072 14932002
         EJECT                                                          14940002
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 15270003
         ORG   WTGIDTTR                                          Y02072 15272002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 15274002
*                                                                       15280021
*                                                                       15300021
CVT      DSECT                                                          15320021
         CVT                                                            15340021
*                                                                       15360021
*                                                                       15380021
BLDEB    DSECT                                                          15400021
DEB      DS    0F                                                       15420021
DEBNMSUB DS    0CL1                                                     15440021
DEBTCBAD DS    CL4                                                      15460021
DEBAMLNG DS    0CL1                                                     15480021
DEBDEBAD DS    CL4                                                      15500021
DEBOGLGS DS    0CL1                                                     15520021
DEBIRBAD DS    CL4                                                      15540021
DEBOPATB DS    0CL1                                                     15560021
DEBSYSPG DS    CL4                                                      15580021
DEBNMEXT DS    0CL1                                                     15600021
DEBUSRPG DS    CL4                                                      15620021
DEBPRIOR DS    0CL1                                                     15640021
DEBECBAD DS    CL4                                                      15660021
DEBPROTG DS    0CL1                                                     15680021
DEBDEBID DS    0CL1                                                     15700021
DEBDCBAD DS    CL4                                                      15720021
DEBEXSCL DS    0CL1                                                     15740021
DEBAPPAD DS    CL4                                                      15760021
DEBDVMOD DS    0CL1                                                     15780021
DEBUCBAD DS    CL4                                                      15800021
DEBBINUM DS    CL2                                                      15820021
DEBSTRCC DS    CL2                                                      15840021
DEBSTRHH DS    CL2                                                      15860021
DEBENDCC DS    CL2                                                      15880021
DEBENDHH DS    CL2                                                      15900021
DEBNMTRK DS    CL2                                                      15920021
*                                                                       15940021
           DCBD  DSORG=PS                                               15960021
*                                                                       15980021
**********************************************************************  16000021
*                                                                       16020021
           END                                                          16040021
./  ADD  SSI=73250635,NAME=IGG0193I
         TITLE '   IGG0193I         EXECUTOR SELECTION  '               00100003
IGG0193I CSECT                                                          00150003
*MODULE NAME - IGG0193I                                                 00200003
*                                                                       00250003
*DESCRIPTIVE NAME - PATH DETERMINER                                     00300003
*                                                                       00350003
*COPYRIGHT - NONE                                                       00400003
*                                                                       00450003
*CHANGE ACTIVITY - AS FOLLOWS:                                          00500003
*                                                                       00550003
*        VS2 RELEASE 04 DELETIONS                                       00600010
*                                                              @Z40MSRB 00650010
*                                                                       00720010
*        VS2 RELEASE 03 DELETIONS                                       00800003
*        THE MODULE WAS RENUMBERED                             @Z30TSMI 00850003
*A860020-862000                                                 ZA04520 00852037
*OZ07043 DELETES 06605020                                               00854037
*                                                                       00856037
*        VS2 RELEASE 02 DELETIONS                                       00860003
*                                                                Y02072 00870003
*        VS2 REL 3 CHANGES                                     @ZA05462 00880037
*A061510,119000,145010,145020,145030,145040,145050             @ZA05462 00882037
*A910100,910200,910300                                         @ZA09379 00884037
*OZ02650 DELETES 13300003                                               00886037
*D861000,862000                                                @ZA09379 00888037
*A090000 TO 0900400                                            @ZA18300 00890037
*C088720,090820                                                @ZA18301 00892037
*          RELEASE 19 DELETIONS                                         00900003
*                                                                S19033 00950003
*                                                                S19017 01000003
*                                                                S19015 01100003
*                                                                M4879  01150003
*                                                                M4899  01200003
*          RELEASE 20 DELETIONS                                         01250003
*                                                                A30808 01300003
*                                                                S20016 01350003
*                                                                M0017  01400003
*                                                                A30962 01450003
*                                                                M5302  01500003
*          RELEASE 21 DELETIONS                                         01550003
*                                                                S21088 01600003
*                                                                S21040 01650003
*                                                               SA53270 01700003
*                                                                       01750003
*STATUS CHANGE LEVEL 005                                                01800003
*                                                                       01850003
*FUNCTION/OPERATION- THIS ROUTINE IS USED TO SELECT THE PROPER          01900003
*      STAGE TWO EXECUTOR FOR THE SEQUENTIAL ACCESS METHODS.            01950003
*      WITH DEVELOPEMENT CODE @Z30TSMI IT WILL NOW DEFAULT TO CHAIN     01960003
*      SCHEDULING BY GOING TO THE CHAIN SCHEDULING EXECUTOR INSTEAD     01970003
*      OF THE NORMAL SCHEDULING EXECUTOR WITH THE FOLLOWING EXCEPTIONS: 01980003
*        1)PRINTERS. CANNOT DEFAULT CHAINED SCHEDULING BECAUSE OF THE   01990003
*            POSSIBILITY OF THE USER USING PRTOV MACRO.                 01992003
*        2)TAPE OR DA FORMAT U RECORDS FOR INPUT. CANNOT DEFAULT        01994003
*            CHAINED SCHEDULING BECAUSE THE USER MAY NEED TO KNOW THE   01996003
*            ACTUAL RECORD LENGTH AND IT IS LOST WITH CHAINED           01998003
*            SCHEDULING.                                                01998403
*                                                                       02000003
*ENTRY POINT-  IGG0193I ENTERED FROM IGG0191I OR IGG0196B               02050003
*                                                                       02100003
*INPUT: SEE DESCRIPTION OF REGISTERS.                                   02150003
*OUTPUT: SEE DESCRIPTION OF REGISTERS.                                  02200003
*EXTERNAL ROUTINES: IFG019RA                                            02250003
*EXIT NORMAL XCTL TO:                                                   02300003
*                      IGG0191D - NORMAL SCHEDULING D. A.               02350010
*                      IGG0191G - NORMAL SCHEDULING TAPE AND U. R.      02400010
*                      IGG0191S - TRACK OVERFLOW                        02450010
*                      IGG0191J - IN/OUT OUT/IN D. A.                   02500010
*                      IGG0191K - CHAINED SCHEDULING INPUT D. A.        02550010
*                      IGG0191L - BSAM LOAD MODE (BDAM CREATE)          02600010
*                      IGG0191P - UPDATE                                02650010
*                      IGG0191Q - CHAINED SCHEDULING TAPE AND U. R.     02700003
*                      IGG0191R - CHAINED SCHEDULING IN/OUT OUT/IN TAPE 02750003
*                      IGG0196S - TIME SHARING TERMINAL                 02800003
*                      IGG0197A - 1285 1287 1288                        02850003
*                      IGG0197C - 1275 1419                             02900003
*                      IGG0191W - CHAINED SCHEDULING OUTPUT D. A.       02950010
*                      IGG0191X - CHAINED SCHEDULING IN/OUT OUT/IN DA   03000010
*                      IGG0197N - 3505 3525                             03050003
*                      IGG0197V - 3890                                  03100003
*                      IGG0196R - 3886                                  03150003
*                                                                       03250003
*                                                                       03300003
*TABLES/WORKAREAS: SEE DSECTS AT THE END OF THE LISTING                 03350003
*                                                                       04700003
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY           04750003
*            RUNS IN SUPERVISOR STATE                                   04800003
*                                                                       04850003
*********************************************************************** 04900003
         EJECT                                                          04910003
*********************************************************************** 04950003
*                                                                       05000003
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                05050003
*                                                                       05100003
*********************************************************************** 05150003
*                                                                       05200003
*                                                                       05250003
RF       EQU   1                       WORK/PARAMETER REGISTER          05300003
RDCB     EQU   2                       ADDR OF USERS DCB                05350003
RBASE    EQU   3                       BASE REGISTER                    05400003
RCORE    EQU   4                       ADDR OF OPEN WORK AREA           05450003
RPAR     EQU   5                       PARAMETER LIST                   05500003
RWTG     EQU   6                       START OF WTG                     05550003
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  05600003
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       05650003
RTIOT    EQU   9                       TIOT ADDR/WORK REGISTER          05700003
RUCB     EQU   10                      UCB ADDR/WORK REGISTER           05750003
RDEB     EQU   11                      DEB ADDRESS                      05800003
*                                                                       05850003
*********************************************************************   05900003
*                                                                       05950003
* MASKS FOR DEVICE TYPES IN DCBDEVT                                     06000003
*                                                                       06050003
DABIT    EQU   X'20'                   DIRECT ACCESS DEVICE             06100003
URBIT    EQU   X'40'                   UNIT RECORD DEVICE               06150003
PTAPE    EQU   X'50'                   PAPER TAPE DEVICE      @ZA05462  06170037
TAPEB    EQU   X'80'                   MAGNETIC TAPE DEVICE             06200003
*                                                                       06250003
*********************************************************************   06300003
         EJECT                                                          06350003
*                                                                       06400003
         BALR  RBASE,0                                                  06450003
         USING START,RBASE                                              06500003
         USING PARML,RPARC                                              06550003
         USING WTGENTRY,RWTGC                                           06600003
         USING WTG,RWTG                                                 06610003
*                                                                       06650003
START    EQU   *                                                        06700003
*                                                                       06750003
         B     BEGIN                   BRANCH AROUND MODID     @Z30TSMI 06800003
         DC    C'IGG0193I'             MODID                   @Z30TSMI 06850003
         DC    C' ZA18301'             LAST SHIP CODE          @ZA09379 06900010
         DC    C'&SYSDATE'             LAST SHIP DATE          @ZA09379 06950010
BEGIN    EQU   *                       END OF MODID            @Z30TSMI 07000003
         L     RDCB,PARDCBAD           GET DCB ADDRESS         @Z30TSMI 07050003
         USING IHADCB,RDCB                                              07100003
         L     RCORE,WTGCORE-1         GET WORK AREA           @Z30TSMI 07150003
         USING FORCORE,RCORE                                            07200003
         L     RDEB,DCBDEBAD           GET DEB ADDRESS                  07250003
         USING DEBBASIC,RDEB                                            07300003
*                                                                       07350003
*                                                                       07400003
         TM    DCBDEVT,DABIT           USING D. A. DEVICE      @Z30TSMI 07450003
         BZ    A0150                   NO - CHECK FOR TAPE     @Z30TSMI 07500003
*                                                                       07550003
*        AT THIS POINT IT IS KNOWN THE DEVICE IS DA                     07600003
*                                                                       07650003
         LA    RF,LOADMODE             BDAM CREATE EXEC                 07700003
         TM    PAROPT,PAROUTPT         DCB USED FOR OUTPUT     @Z30TSMI 07750003
         BNO   A0100                   NO BRANCH                        07800003
*                                                                       07850003
         TM    DCBMACRF+1,DCBMRWRT+DCBMRLDM  BSAM LOAD MODE    @Z30TSMI 07900003
         BO    A0181                   YES - BRANCH                     07950003
*                                                                       08000003
A0100    EQU   *                                                        08050003
         LA    RF,SOPB                 UPDATE EXEC                      08052010
         TM    DEBOPATB,PARUPDAT       UPDATE BIT ON           @Z30TSMI 08092010
         BZ    A0110                   NO,BRANCH                  12608 08132010
         TM    DEBOPATB,PAROUTPT-PARUPDAT  OTHER BITS          @Z30TSMI 08172010
         BZ    A0181                   NO - BRANCH             @Z30TSMI 08212010
*                                                                       08252010
A0110    EQU   *                                                        08292010
         LA    RF,SOP1S                TRACK OVFLO EXEC                 08332010
         TM    DCBRECFM,DCBRECTO       USING OVERFLOW OPTION   @Z30TSMI 08372010
         BO    A0181                   YES - BRANCH                     08412010
*                                                                       08452010
         LA    RF,SOP2                 LOAD FOR 1D              ZA04520 08492010
         TM    PAROPT,PAROUTPT         IS FILE FOR IN OR OUT   @Z30TSMI 08532010
         BNM   A013A                   YES BRANCH              @ZA09379 08572010
*                                      MUST BE FOR IN/OUT OR OUT/IN     08612010
         LA    RF,SOPADX               DISK PCI EXEC 191X               08632010
         TM    DCBOPTCD,DCBOPTC        PCI REQUESTED           @Z30TSMI 08662010
         BO    A0181                   YES - USE IT            @Z30TSMI 08692010
         TM    DCBRECFM,DCBRECU        U LENGTH RECORDS        @Z30TSMI 08722010
         BO    A012A                   YES - DO NOT USE PCI    @ZA18300 08752010
         TM    JFCBFLG2,JFCSDRPS       SEARCH DIRECT?          @ZA18301 08782010
         BO    A012A                   BRANCH IF YES           @ZA18300 08812010
         B     A0181                   XCTL                        DMOR 08842010
A012A    EQU   *                                               @ZA18300 08872010
         LA    RF,SOP8                 CAN NOT DEFAULT PCI     @Z30TSMI 08902010
         B     A0181                   XCTL                        DMOR 08932010
A013A    EQU   *                                               @ZA09379 08962010
         TM    JFCBFLG2,JFCSDRPS       IS THIS SEARCH DIRECT   @ZA18301 08992010
         BO    A0181                   YES,BRANCH              @ZA09379 09022010
*                                                                  DMOR 09052010
A0130    EQU   *                                                        09082010
         LA    RF,SOPOPCI              DA PCI EXEC 191W        @Z30TSMI 09112010
         TM    PAROPT,PAROUTPT         OUTPUT                  @Z30TSMI 09142010
         BO    A0181                   YES - BRANCH            @Z30TSMI 09172010
         LA    RF,SOPA                 INPUT PCI EXEC 191K     @Z30TSMI 09322037
         TM    DCBOPTCD,DCBOPTC        PCI REQUESTED           @Z30TSMI 09332010
         BO    A0181                   YES - USE IT            @Z30TSMI 09372010
         TM    DCBRECFM,DCBRECU        U LENGTH RECORDS        @Z30TSMI 09412010
         BM    A0181                   NO - USE PCI            @Z30TSMI 09452010
         LA    RF,SOP2                 CAN NOT DEFAULT PCI     @Z30TSMI 09492010
         B     A0181                   GO XCTL                 @Z30TSMI 09750003
*                                                                  DMOR 09800003
A0150    EQU   *                                                        09850003
         TM    DCBDEVT,TAPEB           MAG TAPE INDICATED      @Z30TSMI 09900003
         BZ    A0170                   NO - BRANCH U. R.       @Z30TSMI 09950003
*                                                                       10000003
*        AT THIS POINT IT IS KNOWN THE DEVICE IS TAPE                   10050003
*                                                                       10100003
         LA    RF,SOP5                 NORMAL SCHED TAPE EXEC  @Z30TSMI 10150003
         TM    DCBOPTCD,DCBBCKPT       BYPASS DOS CHKPT RCDS   @Z30TSMI 10200003
         BO    A0181                   YES USE NORMAL SCHED    @Z30TSMI 10250003
         TM    PAROPT,PAROUTPT         IS THIS OUTPUT          @Z30TSMI 10300003
         BO    A0155                   YES - CAN USE PCI       @Z30TSMI 10350003
         TM    PAROPT,PARINOUT         IS IT IN/OUT OR OUT/IN  @Z30TSMI 10400003
         BO    A0160                   YES - BRANCH            @Z30TSMI 10450003
         TM    DCBOPTCD,DCBOPTC        PCI REQUESTED           @Z30TSMI 10500003
         BO    A0155                   YES - GO USE IT         @Z30TSMI 10550003
         TM    DCBRECFM,DCBRECU        U LENGTH RECORDS INPUT  @Z30TSMI 10600003
         BNM   A0181                   YES - USE NORMAL SCHED  @Z30TSMI 10650003
A0155    EQU   *                       CAN USE PCI             @Z30TSMI 10700003
         LA    RF,SOPC                 PCI EXEC                @Z30TSMI 10750003
         B     A0181                   GO GET NEXT EXEC        @Z30TSMI 10800003
A0160    EQU   *                                                        10850003
         LA    RF,SOP1R                PCI IN/OUT OUT/IN       @Z30TSMI 10900003
         TM    DCBOPTCD,DCBOPTC        PCI REQUESTED           @Z30TSMI 10950003
         BO    A0181                   YES - GO USE IT         @Z30TSMI 11000003
         TM    DCBRECFM,DCBRECU        U LENGTH                @Z30TSMI 11050003
         BM    A0181                   NO - USE PCI            @Z30TSMI 11100003
         LA    RF,SOP5                 USE NORMAL SCHED        @Z30TSMI 11150003
         B     A0181                   XCTL                        DMOR 11200003
*                                                                  DMOR 11250003
*        AT THIS POINT IT IS KNOWN THE DEVICE IS UNIT RECORD            11300003
*                                                                       11350003
A0170    EQU   *                                                        11400003
         LA    RF,EXEC3890             3890 EXEC                XL03123 11450003
         CLI   DCBDEVT,DCBDVMRS        DEVICE A 3890 ?          XL03123 11500003
         BE    A0181                   YES - BRANCH             XL03123 11550003
         CLI   DCBDEVT,DCBDVPR5        IS DEVICE A 3800        @Z40MSRB 11570010
         BE    A0175                   YES, SET NEXT EXEC      @Z40MSRB 11600010
         CLI   DCBDEVT,DCBDVPR1        LOWEST PRINTER DEVTYP   @Z30TSMI 11630010
         BL    NOTPRT                  NOT A PRINTER           @Z30TSMI 11660010
         CLI   DCBDEVT,DCBDVPR2        HIGHEST PRINTER DEVTYP  @Z30TSMI 11690010
         BH    NOTPRT                  NOT A PRINTER           @Z30TSMI 11720010
A0175    EQU   *                       CHECK PCI               @Z40MSRB 11750010
         LA    RF,SOPC                 PCI TAPE AND U. R.      @Z30TSMI 11800003
         TM    DCBOPTCD,DCBOPTC        PCI REQUESTED           @Z30TSMI 11850003
         BO    A0181                   YES - USE IT            @Z30TSMI 11900003
PAPERTAP EQU   *                       USING PAPER TAPE        @ZA05462 11920037
         LA    RF,SOP5                 NO - USE NORMAL SCHED   @Z30TSMI 11950003
         B     A0181                   GO TO NEXT EXEC         @Z30TSMI 12000003
NOTPRT   EQU   *                       NOT A PRINTER           @Z30TSMI 12050003
         LA    RF,SOP7N                3505 3525 EXEC          @Z30TSMI 12060003
         CLI   DCBDEVT,DCBDVCR2        3505 CARD READER          S21088 12100003
         BE    A0181                   YES BRANCH                S21088 12150003
         CLI   DCBDEVT,DCBDVCP1        3525 CARD PUNCH           S21088 12200003
         BE    A0181                   YES BRANCH                S21088 12250003
         CLI   DCBDEVT,DCBDVORS        IS THIS A 1275            S19033 13000003
         BE    MICR                    YES,BRANCH                S19033 13050003
         CLI   DCBDEVT,DCBDVMR         IS THIS A 1419           XL03123 13100003
         BNE   CHKOCR                  NO,BRANCH                 S19033 13150003
MICR     EQU   *                                                 S19033 13200003
         LA    RF,SOP7C                1275 1419 EXEC            S19033 13250003
         B     A0181                   XCTL                      S19033 13350003
CHKOCR   EQU   *                                                 S19033 13400003
         LA    RF,EXEC3886             3886 EXEC               @Z30TSMI 13450003
         CLI   DCBDEVT,DCBDVOR9        IS DEVICE A 3886        @Z30TSMI 13500003
         BE    A0181                   YES - BRANCH            @Z30TSMI 13550003
         LA    RF,SOP7A                1285 1287 1288 EXEC       S19033 13600003
         CLI   DCBDEVT,DCBDVOR5        CHECK FOR A               S19017 13700003
         BL    A0180                   1285,1287,OR 1288         S19017 13750003
         CLI   DCBDEVT,DCBDVOR8        DCBDEVT IS 5A,5B,OR 5C    S19017 13800003
         BNH   A0181                   YES - BRANCH            @Z30TSMI 13850003
A0180    EQU   *                                                        13900003
*******************************************************************     13950003
*                                                                       14000003
*  TSO MODIFICATION - TO XCTL TO TS EXECUTOR IGG0196S WHEN TASK         14050003
*                     IS TIME SHARING                                   14100003
*                                                                       14150003
*******************************************************************     14200003
*                                                                       14250003
         LA    RF,SOPTS                TIME SHARING EXEC         S20016 14300003
         CLI   DCBDEVT,DCBDVTRM        CHECK FOR TS TASK         S20016 14350003
         BE    A0181                   YES - BRANCH            @Z30TSMI 14400003
*                                                                       14450003
         LA    RF,SOPC                 PCI U. R. EXEC          @Z30TSMI 14500003
*                                      TEST FOR PAPER TAPE     @ZA05462 14508037
*                                      AND DISALLOW            @ZA05462 14516037
*                                      CHAINED SCHEDULING      @ZA05462 14524037
         CLI   DCBDEVT,PTAPE           PAPER TAPE DEVICE ?     @ZA05462 14532037
         BE    PAPERTAP                BRANCH YES              @ZA05462 14540037
A0181    EQU   *                                                 S20016 14550003
         MVC   WTGIDTTR,0(RF)           STORE NEXT MODULES ID  @Z30TSMI 14600003
*                                                                       14650003
*********************************************************************** 14700003
*                                                                       14750003
*********************************************************************** 14800003
*                                                                       14850003
RELOOP   EQU   *                                                        14900003
         LA    RWTGC,WTGEND            INCREMENT CURRENT WTG ENTRY      14950003
         LA    RPARC,L'PARDCBAD(0,RPARC) INCR CURRENT DCB ENTRY PTR     15000003
         CLC   WTGID,AMIDCNST          THIS RT NEEDED AGAIN             15050003
         BER   RBASE                   RETURN TO INIT. ANOTHER DCB      15100003
*                                                                       15150003
         CLC   WTGID,OPIDCNST          END OF TABLE                     15200003
         BNE   RELOOP                  NO, CHECK NEXT ENTRY             15250003
*                                                                       15300003
         LR    RPARC,RPAR                                               15350003
         LA    RWTGC,WTGENTRY-WTG(,RWTG)  REINIT WTG LIST PTR           15400003
ZCHEK    CLI   WTGENTRY,0              IS THIS ENTRY COMPLETE           15450003
         BNE   TCTLRTN                 IF NOT TRANSFER CONTROL          15500003
*                                                                       15550003
         LA    RWTGC,WTGEND            GET NEXT ENTRY                   15600003
         LA    RPARC,L'PARDCBAD(0,RPARC)                                15650003
         B     ZCHEK                                                    15700003
*                                                                       15750003
TCTLRTN  EQU   *                                                        15800003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*15850003
               MODID=WTGENTRY                                  @Z30TSMI 15900003
         DROP  RWTG,RWTGC,RPARC,RBASE,RDCB,RCORE,RDEB                   15950003
         EJECT                                                          15960003
**********************************************************************  16000003
*                                                                       16050003
OPIDCNST DC    C'0S'                   COMMON OPEN RETURN MODULE        16250003
AMIDCNST DC    C'3I'                   THIS ROUTINE ID          SA53270 16300003
SOP2     DC    C'1D',VL3(IGG0191D)     NORMAL SCHEDULING D. A.          16400010
SOP5     DC    C'1G',VL3(IGG0191G)     NORMAL SCHEDULING TAPE U. R.     16440010
SOP1S    DC    C'1S',VL3(IGG0191S)     TRACK OVERFLOW                   16480010
SOP8     DC    C'1J',VL3(IGG0191J)     IN/OUT OUT/IN D. A.              16520010
SOPA     DC    C'1K',VL3(IGG0191K)     INPUT PCI D. A.                  16560010
LOADMODE DC    C'1L',VL3(IGG0191L)     BSAM LOAD MODE (BDAM CREATE)     16600010
SOPB     DC    C'1P',VL3(IGG0191P)     UPDATE                           16640010
SOPC     DC    C'1Q',VL3(IGG0191Q)     PCI TAPE U. R.                   16700003
SOP1R    DC    C'1R',VL3(IGG0191R)     IN/OUT OUT/IN PCI TAPE           16750003
SOPTS    DC    C'6S',VL3(IGG0196S)     TIME SHARING TERMINAL            16800003
SOP7A    DC    C'7A',VL3(IGG0197A)     1285 1287 1288                   16850003
SOP7C    DC    C'7C',VL3(IGG0197C)     1275 1419                        16900003
SOPOPCI  DC    C'1W',VL3(IGG0191W)     OUTPUT PCI D. A.                 17050010
SOPADX   DC    C'1X',VL3(IGG0191X)     IN/OUT OUT/IN PCI D. A.          17100010
SOP7N    DC    C'7N',VL3(IGG0197N)     3505 3525                        17150010
EXEC3890 DC    C'7V',VL3(IGG0197V)     3890                             17200010
EXEC3886 DC    C'6R',VL3(IGG0196R)     3886 OCR DEVICE         @Z30TSMI 17250010
PATCH    DC    0H'0',XL50'00'          PATCH AREA                Y02072 17300003
         EJECT                                                          17350003
CVT      DSECT                                                          17400003
         CVT                                                            17450003
         EJECT                                                          17500003
         DCBD  DSORG=PS                                                 17550003
         EJECT                                                          17600003
         IEZDEB                                                         17650003
         EJECT                                                          17700003
         IECDSECS  (MAIN,(IOB,NO)),WTG,PREFX,EXPAND=YES          Y02072 17750003
         ORG   WTGIDTTR                                                 17800003
WTGID    DS    CL2                     ID PORTION OF WTG                17850003
         EJECT                                                          17900003
         IGGPARML                                                       17950003
         END                                                            18000003
./  ADD  SSI=72980452,NAME=IGG0196A
196A     TITLE 'IGG0196A DEB CONSTRUCTION LOAD 2'                       00010002
IGG0196A CSECT                                                          00020019
*                                                                       00028019
*MODULE NAME - IGG0196A                                          Y02072 00028402
*                                                                       00028802
*DESCRIPTIVE NAME - FINISH DEB CONSTRUCTION                      Y02072 00029202
*                                                                       00029602
*COPYRIGHT - NONE                                                Y02072 00029702
*                                                                       00029802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00029902
*                                                                       00032402
*        VS2 RELEASE 040 CHANGES                                        00032503
* 101670-101972,115380                                         @ZA06110 00032603
*A103718-103722,103927-103933,115452                           @Z40MSRZ 00035004
*                                                                       00039204
*        VS2 RELEASE 03 DELETIONS                                       00041604
*A017720,023571,101619-101649,114500           XA06882/SA72925 @ZA01371 00044004
*A024198-024266,094559-094799,095500,096300,099793-099848,      ZA00742 00046404
*A099870,100100-100188,100300                                   ZA00742 00048804
*D059064,093650                                                 ZA00631 00051204
*A058947-059058,023594-023599                                   ZA00631 00053604
*D059064                                                       @ZM00636 00056004
*A058931                                                       @ZM00636 00058404
*D101703                                                        Z30AAWW 00060804
*A101707-101708,115364-115368                                   Z30AAWW 00063204
*                                                              @Z30TSCF 00065604
*        VS2 RELEASE 02 DELETIONS                                Y02072 00068004
*000120,000680,018400,035820-036020,058400-058820,058863,058927, Y02072 00070404
*115300-115380,056800,058859,103700,109100,113600,114400,        Y02072 00072804
*115700-117400                                                   Y02072 00075204
*                                                                YM3943 00077604
*D96400-96600,96800-98600                                        YM7814 00080004
*          RELEASE 21 DELETIONS                                         00082404
*0420098120                                                      A43728 00084804
*0420004800,017610-017700,035812,035900,036040,114000,114500-    S21042 00087204
*0420114560,116870-117800,135400-135600                          S21042 00089604
*0420                                                            S21092 00092004
*0420                                                            S21088 00094404
*          RELEASE 20 DELETIONS                                         00096804
*1471                                                            S20016 00099204
*1471                                                            A33605 00101604
* 058000                                                          M4878 00104004
*0000017600,101665-101755                                        M3591  00106404
*0000093800-094000                                               A25961 00108804
*1471                                                            S20202 00111204
*                                                                       00113604
*STATUS CHANGE LEVEL 003                                                00116004
* THIS MODULE IS A SPLIT OF IGG0191A FOR RELEASE 19                     00118404
*                                                                       00120804
*                                                                       00123204
*  CHANGES IDENTIFIED BY 'DM0D' IN COLUMNS 68-71 INSERTED          DM0D 00125604
*  IN SUPPORT OF CHECKPOINT/RESTART - RELEASE 17                   DM0D 00128004
*                                                                  DM0D 00130404
*                                                                       00132804
*FUNCTION  THIS EXECUTOR IS ENTERED FOR USERS OF SAM AND EXCP           00135204
*          DURING OPEN FOR THE CONSTRUCTION OF DEBS.                    00137604
*          DEBS ARE BUILT FOR ALL DEVICES SUPPORTED BY THE SEQUENTIAL   00140019
*          ACCESS METHODS OR PARTITIONED ACCESS METHOD.                 00160019
*                                                                       00180019
*ENTRY POINT - IGG0196A                                                 00210019
*              ENTERED FROM IGG0191A VIA XCTL                           00240019
*                                                                       00280019
*INPUT--  DCB ADDRESS                                                   00300019
*          WORK AREA ADDRESS                                            00320019
*          WHERE TO GO TABLE                                            00340019
*          PARAMETER LIST                                               00360019
*          CURRENT ENTRY IN WHERE TO GO TABLE                           00380019
*          CURRENT PARAMETER (DCB)                                      00400019
*                                                                       00420019
*OUTPUT-   AS OUTLINED BELOW :                                          00440019
*                                                                       00460019
*MACROS-ACTION:MODESET, DEBCHK, DMABCOND, XCTL, XCTLTABL         Y02072 00470002
*                                                                       00472002
*EXITS-ERROR: XCTL TO PROBLEM DETERMINATION FOR WTP AND 013 ABEND       00480021
*        BASIC DEB LAYOUT FOR ALL I/O DEVICES SUPPORTED                 00500019
*                                                                       00520019
*        **********************************                             00540019
*   -16  *I/OS* I/O SUPPORT DCB ADDRESS   *                             00560019
*   -12  *    * RESERVED                  *                             00580019
*   -08  *    * DCB MODIF MASK            *                             00600019
*   -04  *DEBL* AM TYPE * DEBTBLOF        *                             00620000
*   +00  *SUBL* TCB ADDRESS               *                             00640019
*   +04  *AML * DEB LINK FIELD            *                             00660019
*   +08  *DPAT* IRB ADDRESS               *                             00680019
*   +12  *FLTP* SYSTEM PUTGE CHAIN        *                             00700019
*   +16  *NEXT* USER PURGE CHAIN          *                             00720019
*   +20  *PRTY* ECB ADDRESS               *                             00740019
*   +24  *KEYD* DCB ADDRESS               *                             00760019
*   +28  *SCAL* APPENDAGE ADDRESS         *                             00780019
*        **********************************                             00800019
*                                                                       00820019
*                                                                       00840019
*        DEVICE DEPENDENT SECTION OF DEB                                00860019
*                                                                       00880019
* TAPE/URE                                                              00900019
*                                                                       00920019
*                                                                       00940019
*        **********************************                             00960019
*   +32  *DMOD*  UCB ADDRESS              *                             00980019
*   +36  *VOL SEQ NO     *NO. OF VOLS.    *                             01000019
*        **********************************                             01020019
*                                                                       01040019
* REMAINDER OF THE DEB IS BUILT IN IGG0191N.                            01050019
*                                                                       01060019
* D.A.SAM DEB.                                                          01080019
*        **********************************                             01100019
*   +32  *FMSK*  UCB ADDRESS              *                             01120019
*   +36  *EXTENT FIELD BBCCHHCCHH         *                             01140019
*   +40  *                                *                             01160019
*   +44  *               *NO.TRACKS ALL.  *                             01180019
*   +48  *VOL SEQ NO     *NO. OF VOLS     *                             01200019
*        **********************************                             01220019
*                                                                       01240019
*                                                                       01260019
* NOTE.+32 - +44 IS REPEATED PER EXTENT                                 01280019
*                                                                       01300019
*                                                                       01320019
* D.A.TO MEMBER FOR OUTPUT                                              01340019
*        **********************************                             01360019
*   +E2  *MEMBER NAME THAT IS OPENING     *                             01380019
*   +56  *MEMBER NAME THAT IS OPENING     *                             01400019
*        **********************************                             01420019
*                                                                       01440019
*                                                                       01460019
* DA BPAM CONCATENATION (INPUT)                                         01480019
*        **********************************                             01500019
*   +48  *DSNO DSNO  DSNO DSNO            *                             01520019
*        *EXTU EXT2  EXT3 EXT4            *                             01540019
*        **********************************                             01560019
*                                                                       01580019
*                                                                       01600019
*NOTE. BPAM DEB SAME AS SAM DEB WITH EXCLUSSION OF FIELD AT +48         01620019
*                                                                       01640019
*        USER LABEL EXTENT IS NOT INCLUDED IN F1 EXTENT COUNT,          01646019
*        AND IS NOT INCLUDED IN DEB EXTENTS.                            01652019
*                                                                       01660019
*        ROUTINE ALSO MERGES CLASS BYTE AND DEVICE BYTE OF UCB/SRT      01680019
*        INTO DCB FIELD (DEVT)                                          01700019
*                                                                       01720019
*EXITS  - NORMAL                                                   UT18 01724019
*       1 IF DEVICE TYPE = DA  XCTL'S TO IGG0191N                  UT18 01728019
*       2 IF DCB IS EXCP AND:                                  @Z40MSRZ 01730004
*            - DEVICE IS A 3800 PRINTER        IGG0196Q        @Z40MSRZ 01730404
*            - DEVICE IS A UCS/FCB PRINTER     IGG0191T        @Z40MSRZ 01730804
*            - DEVICE IS OTHER UR OR TAPE      IGG01911        @Z40MSRZ 01731204
*       3 IF DEVICE TYPE NOT = DA AND USER TOTALING FACILITY NOT   UT18 01732004
*              SPECIFIED (OPTCD NOT EQUAL TO X'02') XCTL'S TO      UT18 01736019
*              IGG0191B                                            UT18 01740019
*       4 IF DEVICE TYPE NOT = DA AND USER TOT. F.  IS SPECIFIED   UT18 01744004
*              XCTL'S TO IGG0191Y                                  UT18 01748019
*                                                                  UT18 01752019
OABD074  EQU   74                                                S21042 01762021
OABD213  EQU   419                                             @ZA01371 01772002
*                                                                       01780019
*TABLES/WORKAREA - SEE DSECTS AT END OF LISTING.                        01800019
*                                                                       01820019
*ATTRIBUTES- RE-ENTRANT- RE-USABLE- RUNS IN DATA MANAGEMENT KEY  Y02072 01840002
*            UNLESS OTHERWISE SPECIFIED, SUPER MODE              Y02072 01850002
*                                                                       01860019
*                                                                       01880019
*                                                                       01900019
*                                                                       01920019
*******************************************************************     01940019
*********************************************************************   01960019
*                                                                       01980019
* MASK'S TO TEST PARAMETER LIST WITH                                    02000019
DESZEM1    EQU   143                                                    02020019
DESZE    EQU   144                                                      02040019
OFFSET   EQU   4                                                        02060019
AB013    EQU   X'013'                   ABEND CODE               M3591  02070019
OPIECAPP EQU   20                                                       02080019
OPMDEBID EQU   X'0F'                                                    02100019
OPPATRUB EQU   0                                                        02120019
OPMEXSCL EQU   4                                                        02140019
OPMINPUT EQU   X'7F'                                                    02160019
OPMDEVT  EQU   X'40'                                                    02180019
DEBBSLNG EQU   80                                                       02200019
COMMUTAB EQU   16                                                       02220019
UCBDTYPE EQU   5                                                        02240019
SRTOUCBA EQU   0                                                        02260019
NEXTCORE EQU   140                                                      02280019
DUALDEN  EQU   X'20'                                                    02300019
READB    EQU   X'20'                                                    02320019
WRITEB   EQU   X'20'                                                    02340019
SUBRNTID EQU   20                       SUBROUTINE ID LENGHT.           02350019
TOTFLAG  EQU   X'02'                    USER TOTALING FLAG         UT18 02350819
ZERO     EQU   0                        PARAMETRIC ZERO            UT18 02351619
FOUR     EQU   4                        PARAMETRIC 4               UT18 02352419
CON8     EQU   8                        PARAMETRIC 8               UT18 02353219
INFLAG   EQU   X'0E'                    FLAG FOR INPUT TEST        UT18 02354019
ULEXTYP  EQU   X'40'  EXTENT TYPE INDICATOR FOR USER LABEL TRACK   UL17 02355019
D1275    EQU   X'1F'                    UCBDEVT CODE FOR 1275    S19033 02356019
D1419    EQU   X'1D'                    UCBDEVT CODE FOR 1419    S19033 02357019
D1419SCU EQU   X'1E'                    UCBDEVT FOR 1419 SCU   @ZA01371 02357102
PRT3211  EQU   X'09'                   DEVICE TYPE FOR 3211      S20202 02357320
*                                       PRINTER                  S20202 02357620
TIOTTERM EQU   X'20'                    DEVICE IS TERMINAL (TSO) S20016 02358020
EXCP     EQU   X'80'                    DCBMACRF EXCP MASK              02358400
DSORGPS  EQU   X'40'                    DCBDSORG PS MASK                02358800
PRT2245  EQU   X'0B'                    MASK FOR 2245 PRINTER    S21092 02359021
TSOAMLNG EQU   X'10'                    TSO HAS ACCESS METHOD   ZA00631 02359402
*                                       LENGTH OF X'10'         ZA00631 02359802
TSONMEXT EQU   X'01'                    TSO HAS ONE EXTENT      ZA00631 02359902
*                                                                       02360019
******************************           ****************************** 02380019
*                                                                       02400019
D3525    EQU   X'0C'                   3525 UCB UNIT TYPE CODE   S21088 02403021
RP       EQU   X'60'                   READ/PUNCH MASK           S21088 02406021
RW       EQU   X'50'                   READ/PRINT MASK           S21088 02409021
PW       EQU   X'30'                   PUNCH/PRINT MASK          S21088 02412021
FUNCOFF  EQU   3                       DCBFUNC OFFSET            S21088 02415021
DEB6250  EQU   X'D3'                    6250 BPI SET MODE         99223 02417002
TST6250  EQU   X'D0'                    MASK FOR 6250 BPI         99223 02419002
DEB1600  EQU   X'C3'                    1600 BPI SET MODE         99223 02419402
EXCPDCB  EQU   X'80'                    EXCP BIT IN DCBMACRF    ZA00742 02419802
FOUNDSEG EQU   X'40'                    FOUNDATION BIT          ZA00742 02419902
TRTCHTST EQU   X'38'                    TAPE RECORDING TECH     ZA00742 02426602
*                                                                       02433302
*                                                                       02440019
*                                                                       02460019
*                                                                       02480019
*REGISTERS ARE REFERENCED SYMBOLICALLY WHERE APPROPRIATE                02500019
*                                                                       02520019
RDCB     EQU   2         DCB REGISTER                                   02540019
RBASE    EQU   3         BASE REGISTER                                  02560019
RCORE    EQU   4         WORK AREA ADDRESS                              02580019
RPAR     EQU   5         TOP OF PARAMETER LIST                          02600019
RWTG     EQU   6         TOP OF WTG TABLE                               02620019
RPARC    EQU   7         CURRENT PARAMETER                              02640019
RWTGC    EQU   8         CURRENT TRANS LOAD                             02660019
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    02680019
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       02700019
RDEB     EQU   11        DEB ADDRESS                                    02720019
RB       EQU   12        WORK REG1  **                                  02740019
R1       EQU   RB                       PARM REGISTER            Y02072 02750002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          02760019
RD       EQU   14        WORK REG3  **                                  02780019
RJ       EQU   15        WORK REG4                                      02800019
RE       EQU   0         WORK REG5                                      02820019
RF       EQU   1         WORK REG6                                      02840019
RWK1     EQU   RF                       WORK REGISTER            Y02072 02842002
CVTREG   EQU   9                   ADDR OF CVT                   M4879  02850019
*                                                                       02860019
*                                                                       02880019
*                                                                       02900019
*********************************************************************** 02920019
*                                                                       02940019
*                                                                       02960019
*                                                                       02980019
*                                                                       03000019
*                                                                       03040019
*31440554-0560                                                     5798 03050019
*41260808,0808                                                     6831 03060019
         BALR  RBASE,0                                                  03080019
         USING PO,RBASE                                                 03100019
         USING IHADCB,RDCB                                              03120019
         USING FORCORE,RCORE                                            03140019
         USING DEB,RDEB                                                 03160019
         USING   TCB,RD                                                 03180019
         USING TIOT,RTIOT                                               03200019
         USING UCBOB,RUCB                                               03220019
*                                                                       03240019
*                                                                       03260019
*                                                                       03280019
*                                                                       03300019
PO       EQU   *                                                        03320019
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 03330002
         DC    C'IGG0196A'              MODULE NAME              YM4640 03332002
         DC    C'@Z40MSRZ'              LAST SHIP CODE         @Z40MSRZ 03334004
         DC    C'09/15/75'              LAST SHIP DATE         @Z40MSRZ 03336004
BEGIN    DS    0H                       END OF MODULE ID         YM4640 03338002
*                                                                       03340019
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 03360019
         L     RCORE,4(RWTGC)           GET WORK AREA                   03380019
         L     RD,COMMUTAB         CALCULATE TCB ADDRESS                03500019
         L     RD,0(0,RD)                                               03520019
         L     RD,4(0,RD)               TCB  ADDR                       03540019
         L     RTIOT,TCBTIO                                             03560019
         AH    RTIOT,DCBTIOT       RESET TIOT POINTER                   03580019
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 03580620
         BO    MAINUNIT                 BRANCH IF YES            S21042 03581321
         L     RUCB,DXUCBADR            GET UCB PTR.             Y02072 03582002
MAINUNIT EQU   *                                                 S21042 03604021
         USING UCBOB,RUCB                                               03607019
         L     RDEB,DCBDEBAD            POINT TO DEB BASIC SECTION      04307019
         LA    RDEB,0(RDEB)            ZERO HIGH ORDER BYTE      A33605 04707020
         LM    RE,RF,DXCCW11            RESTORE LENGTH,ADDRESS    -UT18 05136019
OBPAM160 EQU   *                                                        05500019
*                                                                       05520019
         L     RJ,COMMUTAB                                              05620019
         L     RJ,OPIECAPP(0,RJ)        IOS APP ADDR                    05640019
         MVC   0(20,RF),0(RJ)           FILL IN IOS APP                 05660019
         MVC   DEBPROTG(1),DXUKEY       PROTECTION TAG           Y02072 05680002
         OI    DEBDEBID,X'0F'           ID                              05700019
         MVC   DEBPRIOR(1),TCBDSP       PRIORITY                        05720019
         MVC   DEBOPATB(1),0(RPARC)     OPEN ATTB                       05740019
         NI    DEBOPATB,X'7F'           CLEAR HI ORDER BIT              05760019
         MVI   DEBEXSCL,X'04'           SCALE FACTOR                    05780019
*                                                                       05820019
         L     RWK1,TCBDEB              GET FIRST DEB ON CHAIN   Y02072 05870002
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 05880002
OBPAM165 EQU   *                                                 Y02072 05882002
         STCM  RWK1,B'0111',DEBDEBAB    UPDATE DEB CHAIN POINTER YM3943 05882502
         CS    RWK1,RDEB,TCBDEB         ATTEMPT TO LINK NEW DEB  Y02072 05882802
         BNE   OBPAM165                 BR TO TRY AGAIN IF UNSUC Y02072 05883202
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05884802
         LA    RF,DBCKEXCP              AMTYPE FOR EXCP DEB      Y01021 05885002
         TM    DCBMACRF,EXCP            IS DCB EXCP              Y01021 05885102
         BO    DEBCHK                   BRANCH IF YES            Y01021 05885202
         LA    RF,DBCKSAM               AMTYPE FOR SAM           Y01021 05885302
         TM    DCBDSORG,DSORGPS         IS DCBDSORG PS           Y01021 05885600
         BO    DEBCHK                   BRANCH IF YES            Y01021 05885700
         LA    RF,DBCKBPAM              AMTYPE FOR BPAM DEB      Y01021 05885902
DEBCHK   DEBCHK (RDCB),TYPE=ADD,AM=(0(RF)) ADD DEB TO DEB TABLE  Y02072 05890502
         LR    RDEB,RF                  LOAD VERIFIED DEB ADDR   Y01021 05891602
         LM    RE,RF,DXCCW11            RELOAD  ADDRESS, LENGTH  Y01021 05892702
         TM    TIOELINK,TIOTTERM        IS THIS TSO?           @ZM00636 05893103
         BNO   NOTTSO                   IF NOT TSO, BRANCH AROUNZA00631 05894702
         MVI   DEBAMLNG,TSOAMLNG        PUT ACCESS METHOD LENGTHZA00631 05896702
*                                       OF X'10' INTO TSO DEB   ZA00631 05898702
         MVI   DEBNMEXT,TSONMEXT        PUT X'01' INTO NUMBER   ZA00631 05899102
*                                       OF EXTENT FIELD OF TSO  ZA00631 05899502
*                                       DEB                     ZA00631 05901802
         B     RP350015                 CONTINUE TSO PROCESSING ZA00631 05903802
NOTTSO   EQU   *                                                ZA00631 05905802
         TM    UCBTBYT3,UCB3DACC        OPENING FOR D A DEVICE          05913200
         BC    14,OBPAMTAP              NO BRANCH                       05920019
         MVC   23(5,RF),DXCCW7          CCHHR                           05940019
OBPAM170 EQU   *                                                        06740019
         LA    RF,SOP1N                 SOP1N REQ'D FOR ALL D.A. DEVICE 07540019
         B     COMSTOP                 GO TO COMMON PATH FOR TAPE/UR/DA 08340019
OBPAMTAP EQU   *                                                        09320019
*                                                                       09340019
         ST    RUCB,DEBUCBAD            UCB ADDR                        09360019
         MVI   DEBAMLNG,X'10'           16 BYTE ACCESS METH.     A25961 09370019
*                                       LENGTH                          09380019
         MVI   DEBNMEXT,1                                        A25961 09390019
         CLI   UCBTBYT4,D3525          IS THIS A 3525            S21088 09391021
         BNE   RP350015                BRANCH IF NOT A 3525      S21088 09392021
         TM    DCBMODE+FUNCOFF,RP      READ/PUNCH ASSOCIATED     S21088 09393021
*                                       DATA SET                 S21088 09394021
         BO    RP350010                BRANCH IF READ/PUNCH      S21088 09395021
         TM    DCBMODE+FUNCOFF,RW      REAR/PRINT ASSOCIATED     S21088 09396021
*                                       DATA SET                 S21088 09397021
         BO    RP350010                BRANCH IF READ/PRINT      S21088 09398021
         TM    DCBMODE+FUNCOFF,PW      PUNCH/PRINT ASSOCIATED    S21088 09399021
*                                       DATA SET                 S21088 09400021
         BNO   RP350015                BRANCH IF NOT PUNCH/PRINT S21088 09401021
RP350010 EQU   *                                                 S21088 09402021
         MVI   DEBEXSCL,4              MOVE 4 INTO EXTENT SCALE  S21088 09403021
*                                       FIELD                    S21088 09404021
         B     RP350020                                          S21088 09405021
RP350015 EQU   *                                                 S21088 09406021
         MVI   DEBEXSCL,2                                               09420019
*                                                                       09422002
*                                                                       09431002
RP350020 EQU   *                                                 S21088 09435602
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 09441702
         BO    DEBFINI                  BRANCH IF YES            S20016 09447802
         MVI   DEBDVMOD,3                                               09453902
         TM    DCBMACRF,EXCPDCB         THIS AN EXCP DCB        ZA00742 09455902
         BZ    TAPE0010                 BR - NORMAL DCB         ZA00742 09457902
         TM    DCBMACRF,FOUNDSEG        FOUNDATION PRESENT      ZA00742 09459902
         BO    TAPE0010                 BR-DEVICE SEG ALSO      ZA00742 09466602
*                                       PRESENT                 ZA00742 09468602
         OC    DEBDVMOD(1),JFCTRTCH     USE JFCB FOR TRTCH      ZA00742 09470602
         OC    DEBDVMOD(1),JFCDEN       USE JFCB FOR DENSITY    ZA00742 09472602
         TM    JFCTRTCH,TRTCHTST        TRTCH SPECIFIED IN JFCB ZA00742 09473002
         BNZ   TAPE0030                 BR-SPECIFIED            ZA00742 09473102
         B     TAPE0020                 TRTCH NOT SPECIFIED     ZA00742 09473202
TAPE0010 EQU   *                        *                       ZA00742 09479902
         OC    DEBDVMOD(1),DCBTRTCH     TAPE RECORDING TECH             09486602
         OC    DEBDVMOD(1),DCBDEN       DENSITY                         09493302
         TM    DCBTRTCH,X'38'          HAS TRTCH BEEN SPECIFIED   99223 09500002
         BNZ   TAPE0030                 YES BRANCH                      09520002
*                                                                       09540019
TAPE0020 EQU   *                        *                       ZA00742 09550002
         OI    DEBDVMOD,X'30'                                           09560019
*                                                                       09580019
*      ASSUME TRANSLATE BYTE CONVERT OFF ODD DPARITY LOW DENSITY        09600019
*                                                                       09620019
TAPE0030 EQU   *                        *                       ZA00742 09630002
         SR    RE,RE                                              MC0W  09662019
         SR    RF,RF                                              MC0W  09664019
         IC    RF,JFCBVLCT              GET VOLUME COUNT          MC0W  09666019
         IC    RE,JFCBNVOL             GET NUMBER OF VOLUMES      MC0W  09668019
         CR    RE,RF                                              MC0W  09670019
         STH   RE,DEBTVLNM              IS NO. OF VOLUMES GREATER MC0W  09672019
         BH    OBPAM172                 YES USE NO. OF VOLUMES    MC0W  09674019
         STH   RF,DEBTVLNM              NO USE VOLUME COUNT       MC0W  09676019
OBPAM172 EQU   *                                                  MC0W  09678019
         MVC   DEBTVLSQ,DXVOLSEQ        VOL SEQ TO DEB           YM7814 09678402
*********************************************************************** 09880019
*      DUAL DENSITY SUPPORT HERE                                        09900019
*********************************************************************** 09920019
         TM    UCBTBYT1,X'04'           IS THIS PHASE-ENCODE UNIT 15451 09926019
         BO    PENCODE                  YES,BR TO ASSUME 1600 BPI 15451 09932019
         TM    UCBTBYT2,DUALDEN         DUAL DENSITY UNIT               09940019
         BO    PENCODE                  YES,SET UP 1600 OR 800 BPI99223 09960002
         TM    UCBTBYT1,UCB1FEA6        IS THIS 6250 BPI UNIT     99223 09972002
         BO    HICODE                   YES,ASSUME 6250 BPI       99223 09974002
         TM    UCBTBYT2,UCB2OPT3        6250/1600 BPI FEATURE     99223 09976002
         BZ    DEBFINI                  NO,DENSITY SET            99223 09978002
         SPACE                                                          09978402
HICODE   EQU   *                        6250/1600 BPI LOGIC       99223 09978802
         MVI   DEBDVMOD,DEB6250         SET 6250 BPI              99223 09979202
         TM    DCBMACRF,EXCPDCB         THIS AN EXCP DCB        ZA00742 09979302
         BZ    TAPE0040                 BR - NORMAL DCB         ZA00742 09979402
         TM    DCBMACRF,FOUNDSEG        FOUNDATION PRESENT      ZA00742 09979502
         BO    TAPE0040                 BR-DEVICE SEG ALSO      ZA00742 09982002
         TM    JFCDEN,TST6250           IS 6250 SPECIFIED       ZA00742 09984002
         B     TAPE0050                 GO COMPLETE SETTING     ZA00742 09984402
TAPE0040 EQU   *                        *                       ZA00742 09984802
         TM    DCBDEN,TST6250           IS 6250 SPECIFIED         99223 09985002
TAPE0050 EQU   *                        *                       ZA00742 09987002
         BO    DEBFINI                  YES,CONTINUE PROCESSING   99223 09987502
         MVI   DEBDVMOD,DEB1600         SET 1600 BPI              99223 09990002
         B     DEBFINI                  CONTINUE PROCESSING       99223 09992502
*                                                                       09995002
PENCODE  EQU   *                                                  15451 09997502
         MVI   DEBDVMOD,X'C3'           ASSUME 1600 BPI DENSITY         10000019
         TM    DCBMACRF,EXCPDCB         THIS AN EXCP DCB        ZA00742 10010002
         BZ    TAPE0060                 BR - NORMAL DCB         ZA00742 10012002
         TM    DCBMACRF,FOUNDSEG        FOUNDATION PRESENT      ZA00742 10014002
         BO    TAPE0060                 BR-DEVICE SEG ALSO      ZA00742 10016002
         TM    JFCDEN,X'C0'             IS 1600 SPECIFIED       ZA00742 10018002
         B     TAPE0070                 GO COMPLETE SETTING     ZA00742 10018402
TAPE0060 EQU   *                        *                       ZA00742 10018802
         TM    DCBDEN,X'C0'             IS IT 1600 BPI                  10020019
TAPE0070 EQU   *                        *                       ZA00742 10030002
         BC    9,DEBFINI                YES BRANCH                      10040019
*                                                                       10060019
         MVI   DEBDVMOD,X'CB'           800 BPI DENSITY INDICATED       10080019
DEBFINI  EQU   *                                                        10100019
*                                                                       10120019
         LA    RF,SOP1B                                                 10126019
COMSTOP  EQU   *                                                        10132019
*                                                                       10140019
         L     RDCB,0(RPARC)            RESTORE DCB ADDRESS             10160019
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 10160120
         BO    FINISH                   BRANCH IF YES            S20016 10160220
*                                                                       10160519
         CLI   UCBTBYT4,D1275           IS THIS A 1275           S19033 10161019
         BE    MICR                     YES,BRANCH               S19033 10161519
         LA    RE,OABD213               SET INT ABEND CODE     @ZA01371 10161902
         CLI   UCBTBYT4,D1419SCU        IS IT 1419 SEC UNIT    @ZA01371 10162902
         BE    BADUNIT                  YES ISSUE ABEND        @ZA01371 10164902
         CLI   UCBTBYT4,D1419           IS THIS A 1419          XL03123 10165002
         BNE   TSTEXCP                  NO, BRANCH               S19033 10166002
MICR     EQU   *                                               @ZA06110 10167003
*                                                              @ZA06110 10167803
*        PERFORM A UCB LOOK-UP PROCEDURE TO OBTAIN THE ADDRESS @ZA06110 10168603
*                                                              @ZA06110 10169403
         LA    RE,OABD074               SET CODE FOR NO UCB    @ZA06110 10170203
         L     CVTREG,CVTPTR            LOAD CVT ADDRESS       @ZA06110 10171003
         USING CVT,CVTREG                                      @ZA06110 10171803
         LH    RC,UCBCHAN               GET CHAN AND DEVICE ADD@ZA06110 10172603
         N     RC,ADDRMASK              CLEAR FLAGS            @ZA06110 10173403
         LA    RC,1(RC)                 INCR TO SCU ADDR       @ZA06110 10174203
         L     RJ,CVTILK2               LOAD ADDR OF UCB LIST  @ZA06110 10175003
LOOP     EQU   *                                               @ZA06110 10175803
         LH    RD,0(RJ)                 GET PRT FROM LIST      @ZA06110 10176603
         LTR   RD,RD                    END OF LIST            @ZA06110 10177403
         BZ    ZPTR                     TABLE MAY HAVE HOLES   @ZA06110 10178203
         CH    RD,UCBEND                END OF TABLE           @ZA06110 10179003
         BE    NOUCB                    YES - NO UCB FOR SCU   @ZA06110 10179803
         DROP  RUCB                                            @ZA06110 10180603
         USING UCBOB,RD                                        @ZA06110 10181403
         N     RD,UCBMASK               CLEAR HIGH ORDER       @ZA06110 10182203
         LH    RB,UCBCHAN               GET CHAN AND DEV ADDR  @ZA06110 10183003
         N     RB,ADDRMASK              CLEAR FLAGS            @ZA06110 10183803
         CR    RC,RB                    IT THIS UCB FOR SCU?   @ZA06110 10184603
         BE    UCBFND                   YES, BR                @ZA06110 10185403
ZPTR     EQU   *                                               @ZA06110 10186203
         LA    RJ,2(RJ)                 UPDATE PTR INTO UCB    @ZA06110 10187003
*                                       TABLE                  @ZA06110 10187803
         B     LOOP                     BR,CK NEXT UCB IN LIST @ZA06110 10188603
UCBFND   EQU   *                                               @ZA06110 10189403
         ST    RD,DEBBINUM              PLACE A(SCU UCB IN DEB @ZA06110 10190203
         LA    RB,2                     LOAD NUMBER OF EXTENTS @ZA06110 10191003
         STC   RB,DEBNMEXT              PLACE NUM EXT OM DEB   @ZA06110 10191803
         STC   RB,DEBEXSCL              PLACE EXT SCALE IN DEB @ZA06110 10192603
         MODESET EXTKEY=ZERO            GET IN KEY ZERO        @ZA06110 10193403
         OI    UCBSTAT,UCBALOC          SET SCU ALLOCATED      @ZA06110 10194203
         MODESET EXTKEY=DATAMGT         BACK TO KEY 5          @ZA06110 10195003
         DROP  CVTREG,RD                                       @ZA06110 10195803
         USING UCBOB,RUCB                                               10197203
TSTEXCP  EQU   *                                                 S19033 10198002
*                                                                       10199002
*********************************************************************** 10200019
*                                                                       10220019
*      TEST FOR USER OF EXCP NOT BSAM OR QSAM                           10240019
*                                                                       10260019
*********************************************************************** 10280019
*                                                                       10300019
         TM    DCBMACRF,X'80'           EXCP BIT ON                     10320019
         BC    8,SAMOUT                 NO BRANCH                       10340019
         TM    UCBTBYT3,UCB3DACC        IS DEVICE D.A.                  10350019
         BO    FINISH                   YES, BRANCH.                    10360019
*                                                                       10360319
*********************************************************************** 10360619
*                                                                       10360919
*        TEST FOR PRINTER WITH EXCP DCB                        @Z40MSRZ 10361004
*             IF 3800              IGG0196Q                    @Z40MSRZ 10361104
*             IF UCS/FCB PRINTER   IGG0191T                    @Z40MSRZ 10362204
*                                                                       10364804
*********************************************************************** 10365904
*                                                                       10367004
         CLI   UCBTBYT3,X'08'           TEST IF DEVICE CLASS       DM0B 10368104
*                                       IS U/R                          10369204
         BC    7,EXCPOUT                IF NOT, GO TO LAST EXEC    DM0B 10370304
*                                       SELECTION                       10371404
         CLI   UCBTBYT4,UCB3800         TEST FOR 3800          @Z40MSRZ 10371804
         BE    XCTLGO6Q                 YES, SET FOR 196Q      @Z40MSRZ 10372204
*                                                                       10372304
         CLI   UCBTBYT4,PRT3211         TEST FOR 3211 PRINTER    S20202 10372504
         BE    XCTLGO1T                 YES GO TO PRT MOD        S20202 10373604
*                                                                       10374704
         CLI   UCBTBYT4,PRT2245        TEST FOR 2245             S21092 10375804
         BE    XCTLGO1T                YES, GO TO IGGO191T       S21092 10376904
         CLI   UCBTBYT4,X'08'           TEST IF DEVICE IS 1403     DM0B 10378004
         BC    7,EXCPOUT                IF NOT, GO TO LAST EXEC    DM0B 10379104
*                                       SELECTION                       10380204
*                                                                       10381304
         TM    UCBTBYT2,X'80'           IF 1403 HAS UCS            DM0B 10382404
         BC    14,EXCPOUT               IF NOT, GO TO LAST EXEC    DM0B 10383504
*                                       SELECTION                       10384604
XCTLGO1T EQU   *                                                 S20202 10385704
*                                                                       10386804
*                                                                       10387904
         LA    RF,SOP1T                 IF 1403 WITH UCS, XCTL     DM0B 10389004
*                                       IGG0191T                        10390104
         BC    15,FINISH                GO TO WTG ROUTINE          DM0B 10391204
*                                                                       10392304
XCTLGO6Q EQU   *                        SET FOR IGGO196Q       @Z40MSRZ 10392704
         LA    RF,SOP6Q                   FOR 3800 PRINTER     @Z40MSRZ 10393104
         B     FINISH                   GO TO WTG ROUTINE      @Z40MSRZ 10393204
*                                                                       10393304
*********************************************************************** 10393404
*                                                                       10394504
EXCPOUT  EQU   *                                                   DM0B 10395604
*                                                                       10396704
         LA    RF,SOP11                 EXCP AND NOT D.A., GO    Y02072 10397804
*                                         DO DCB COPY BACK       Y02072 10398904
*                                                                       10400019
SAMOUT   EQU   *                                                        10420019
*                                                                       10440019
*******************************************************************UT18 10450019
*  NOTE - THE FOLLOWING FEW INSTRUCTIONS SETUP FOR AN XCTL TO A NEWUT18 10460019
*        (WITH RELEASE 18 ) MODULE WHICH WILL LOAD THE USER TOTALINUT18 10470019
*        FACILITY SAVE ROUTINE AND DO A GETMAIN FOR A UTF SAVE AREAUT18 10480019
*        FROM THE USER'S SUBPOOL 0 FOR THE SAVING OF HIS TOTALING  UT18 10490019
*        AREA AT END-OF-VOLUME TIME.                               UT18 10500019
*******************************************************************UT18 10510019
*                                                                  UT18 10520019
         TM    ZERO(RPARC),INFLAG       TEST FOR INPUT DATA SET    UT18 10530019
         BZ    SAMOUT1                  BR IF INPUT                UT18 10540019
         TM    DCBMACRF,X'80'           IS IT EXCP                M4116 10543019
         BO    SAMOUT1                  IF YES, BRANCH            M4116 10546019
         TM    DCBOPTCD,TOTFLAG         TEST FOR UTF (OPTCD=T)     UT18 10550019
         BZ    SAMOUT1                  BIF NOT SPECIFIED          UT18 10560019
         TM    UCBTBYT3,UCB3DACC        CHECK IF DA                UT18 10570019
         BO    SAMOUT1                  BR IF DA                   UT18 10580019
*                                                                  UT18 10590019
         LA    RF,SOP1Y                 SETUP FOR XCTL TO IGG0191Y UT18 10600019
*                                                                  UT18 10610019
SAMOUT1  EQU   *                        SYMBOLIC ADDR              UT18 10620019
*                                                                       10640019
FINISH   EQU   *                                                        10880019
*                                                                       10900019
         USING WTGENTRY,RWTGC                                    Y02072 10902002
         MVC   WTGIDTTR,0(RF)           ST NEXT MODS ID        @Z30TSCF 10912003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     UPDATE WHERE TO GO ENTRY        10952003
         LA    RPARC,PLOFF(0,RPARC)     UPDATE PARA LIST ENTRY          11002003
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            11052003
         BCR   8,RBASE                  YES BR BACK TO BEGINNING        11062003
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    11080019
         BC    7,RELOOP                 NO BRANCH                       11100019
*                                                                       11120019
         LR    RPARC,RPAR                                               11140019
         LA    RWTGC,WAOFF(0,RWTG)      RE INIT  WTG LIST               11160019
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           11180019
         BC    7,TCTLRTN                NO XCTL                         11200019
*                                                                       11220019
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  11240019
         LA    RPARC,PLOFF(0,RPARC)                                     11260019
         BC    15,ZCHEK                                                 11280019
*                                                                       11300019
TCTLRTN  EQU   *                                                        11320019
         USING WTG,RWTG                                                 11370003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11420003
               MODID=WTGENTRY                                  @Z30TSCF 11430003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11440003
*                                                                       11442019
*        AN 013 ABEND IS ISSUED WHEN NO SEC CONTROL UNIT (SCU)          11444019
*        UCB IS FOUND FOR 1419 OR IF TRYING TO OPEN THE SCU ONLY.       11446002
BADUNIT  EQU   *                                                        11446402
NOUCB    EQU   *                                                 M3591  11448019
         DMABCOND (RE),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES   @ZA01371X11450002
                                        CALL PROBLEM DETERMINATION      11452021
         B     TCTLRTN                                           S21042 11454021
*                                                                       11458002
*                                                                       11460019
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   11480019
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                11500019
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                11520019
DBCKEXCP DEBCHK AM=EXCP,MF=L            DEB AMTYPE FOR EXCP      Y01021 11532000
DBCKSAM  DEBCHK AM=SAM,MF=L             DEB AMTYPE FOR SAM       Y01021 11534000
DBCKBPAM DEBCHK AM=BPAM,MF=L            DEB AMTYPE FOR BPAM      Y01021 11536000
UCBMASK  DS    0F                       ALIGN                   Z30AAWW 11536403
         DC    X'0000'                  FOR ZEROING HI-ORDER    Z30AAWW 11536503
UCBEND   DC    X'FFFF'                  END OF LOOKUP TABLE     Z30AAWW 11536803
ADDRMASK DC    X'0003FFFF'              TO REMOVE FLAG         @ZA06110 11537403
*                                                                       11538002
*  MODULE ID'S                                                          11538402
*                                                                       11538802
SOP11    DC    C'11',VL3(IGG01911)      LAST EXECUTOR          @Z30TSCF 11539203
SOP1Y    DC    C'1Y',VL3(IGG0191Y)      USET TOTALING          @Z30TSCF 11539603
SOP1B    DC    C'1B',VL3(IGG0191B)      OTHER THAN DA          @Z30TSCF 11539703
SOP1N    DC    C'1N',VL3(IGG0191N)      DA TO FINISH DEB       @Z30TSCF 11539803
SOP1T    DC    C'1T',VL3(IGG0191T)      UCS/FCB EXECUTOR       @Z30TSCF 11539903
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETERMINATION     @Z30TSCF 11543203
SOP6Q    DC    C'6Q',VL3(IGG0196Q)      3800 EXECUTOR          @Z40MSRZ 11545204
OPIDCNST DC    C'0S'                                                    11546702
AMIDCNST DC    C'6A'                                                    11550019
         SPACE                                                          11600002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 11610002
END      EQU   *                        END OF MODULE            Y02072 11700002
         EJECT                                                          11750002
*********************************************************************   11820019
SRT      DSECT                                                          11840019
         IEFUCBOB                                                       11860019
*                                                                       11880019
         EJECT                                                          11900019
           DCBD  DSORG=PS                                               11920019
CVT      DSECT                                                          11940019
         CVT                                                            11960019
*   TASK CONTROL BLOCK                                                  11980019
         CNOP  0,4                                                      12000019
TCB      DSECT                                                          12020019
TCBRBP   DS    F                       PO9NTER TO EXECUTING RB          12040019
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   12060019
TCBDEB   DS    F                       POINTER TO DEB QUEUE             12080019
TCBTIO   DS    F                       POINTER TO TIOT                  12100019
TCBCMP   DS    F                       TASK COMPLETION CODE             12120019
TCBTRN   DS    F                       TESTRAN FIELD                    12140019
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 12160019
TCBPKF   DS    CL1                     RESERVED FOR FUTURE USE          12180019
TCBFLGS  DS    FL5                     FLAG BYTES                       12200019
TCBLMP   DS    CL1                     RESERVED FOR FUTURE USE          12220019
TCBDSP   DS    CL1                     RESERVED FOR FUTURE USE          12240019
TCBLLS   DS    F                       POINTER TO LOAD LIST             12260019
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            12280019
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  12300019
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       12320019
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             12340019
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  12360019
TCBTCB   DS    F                       RESERVED FOR FUTURE USE          12380019
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         12400019
         DS    CL24                                                     12420019
TIOT     DSECT                                                          12440019
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       12460019
TIOESTTA DS    CL1                           STATUS -A-                 12480019
TIOERLOC DS    CL2                           REL. LOC OF POOL           12500019
TIOEDDNM DS    2F                            DDNAME                     12520019
TIOEJFCB DS    1F                            JFCB DISK ADDR             12540019
TIOESTTB DS    0CL1                                                     12560019
TIOEFSRT DS    CL4                                                      12580019
         DS    CL1                                                      12600019
*        TIOT POOL ENTRY                                                12620019
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       12640019
         DS    CL1                                                      12660019
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      12680019
*                                             SLOTS)                    12700019
TIOPPOOL DS    CL8                           POOL NAME                  12720019
TIOPSTTB DS    XL1                           STATUS OF SLOT             12740019
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  12760019
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      12780019
TIOELINK EQU   TIOERLOC+1                                        S20016 12790020
         SPACE 1                                                        12800019
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          12820019
DEB      DSECT                                                          12840019
DEBNMSUB DS    0CL1                                                     12860019
DEBTCBAD DS    CL4                                                      12880019
DEBDEBAD DS    0CL4                                                     12890002
DEBAMLNG DS    CL1                                                      12900002
DEBDEBAB DS    CL3                                                      12910002
DEBOFLGS DS    0CL1                                                     12940019
DEBIRBAD DS    CL4                                                      12960019
DEBOPATB DS    0CL1                                                     12980019
DEBSYSPG DS    CL4                                                      13000019
DEBNMEXT DS    0CL1                                                     13020019
DEBUSRPG DS    CL4                                                      13040019
DEBPRIOR DS    0CL1                                                     13060019
DEBECBAD DS    CL4                                                      13080019
DEBPROTG DS    0CL1                                                     13100019
DEBDEBID DS    0CL1                                                     13120019
DEBDCBAD DS    CL4                                                      13140019
DEBEXSCL DS    0CL1                                                     13160019
DEBAPPAD DS    CL4                                                      13180019
DEBDVMOD DS    0CL1                                                     13200019
DEBUCBAD DS    CL4                                                      13220019
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     13240019
DEBBINUM DS    CL2                                                      13260019
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   13280019
DEBSTRCC DS    CL2                                                      13300019
DEBSTRHH DS    CL2                                                      13320019
DEBENDCC DS    CL2                                                      13340019
DEBENDHH DS    CL2                                                      13360019
DEBNMTRK DS    CL2                                                      13380019
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          13400019
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              13420019
DEBVOLSQ DS    H                                                        13440019
DEBVOLNM DS    H                                                        13460019
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     13480019
DEBSUBID DS    H                                                        13500019
         TITLE 'IGG0196A - FORMAT OF GOTTEN CORE'                       13520002
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 13550003
         ORG   WTGIDTTR                                          Y02072 13560002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 13570002
CCWOFSET EQU   DXCCW12-FORCORE     CCW RELOCATABLE OFF SET FOR DXCCW12  13580019
DCBOFSET EQU   DCBDEBAD-IHADCB     DEB RLCATBL OFFSET IN DCB            13600019
           END                                                          13620019
./  ADD  SSI=60920089,NAME=IGG0196B
         TITLE 'IGG0196B MAIN EXECUTOR LOAD 2'                          00100003
IGG0196B CSECT                                                          00150003
*********************************************************************** 00200003
*                                                                       00250003
*MODULE NAME - IGG0196B                                                 00300003
*                                                                       00350003
*DESCRIPTIVE NAME - PATH DETERMINER                                     00400003
*                                                                       00450003
*COPYRIGHT - NONE                                                       00500003
*                                                                       00550003
*CHANGE ACTIVITY - AS FOLLOWS:                                          00600003
*                                                                       00650003
*        VS1 RELEASE 2 DELETIONS                                        00700003
*                                                               SA61288 00750003
*                                                                       00800003
*        VS2 RELEASE 02 DELETIONS                                       00850003
*                                                                Y02072 01000003
*                                                                YM7889 01050003
*                                                                       01100003
*        VS2 RELEASE 03 DELETIONS                                       01150003
*        THE MODULE WAS RENUMBERED                             @Z30TSMI 01200003
*                                                                       01250003
*        VS2 RELEASE 03 UPDATE                                  ZA03193 01260003
*        VS2 RELEASE 04 DELETIONS                                       01260104
* A 142000                                                              01270003
*                                                              @Z40MSMI 01270104
*                                                                       01280003
*                                                                       01280104
*        VS2 RELEASE 04 CHANGES                                         01290003
* A 107600-107992,108100                                        ZA03763 01292003
*                                                                       01294003
*          RELEASE 20 DELETIONS                                         01300003
*                                                                M5103  01350003
*                                                                S20202 01400003
*                                                                A36344 01450003
*                                                                S20016 01500003
*                                                                M5103  01550003
*                                                                A30962 01610003
*                                                                S20201 01700003
*          RELEASE 21 DELETIONS                                         01750003
*                                                                A48615 01800003
*                                                                S21088 01900003
*                                                                M0099  01950003
*                                                                S21040 02000003
*                                                                S21042 02100003
*                                                                M0040  02150003
*                                                                       02200003
*STATUS CHANGE LEVEL 005                                                02250003
*                                                                       02300003
* THIS MODULE WAS SPLIT IN REL 19 FROM IGG0191B IN SUPPORT OF MICR      02350003
*                                                                       02400003
*FUNCTION/OPERATION: THIS ROUTINE SUPPLEMENTS THE INITIAL OPEN ROUTINE. 02450003
*        FOR QSAM IT WILL DEFAULT BUFNO (BUFNO ZERO ON ENTRY) TO        02850003
*        THE FOLLOWING VALUES:                                          02900003
*         A) THREE FOR PUNCH DEVICES.                                   02910003
*         B) FIVE FOR ALL OTHER DEVICES.                                02920003
*        FOR 3886 IT WILL SET BUFNO TO ONE.                             02922003
*        FOR BSAM IT WILL INSURE THAT BUFNO IS AT LEAST 12 FOR          02930003
*        1275 AND 1419 DEVICES.                                         02940003
*        THE ROUTINE WILL GO TO IGG0191I IF IT IS NECESSARY TO          02942003
*        GET BUFFERS OTHERWISE IT WILL GO TO IGG0193I WITH              02944003
*        THE FOLLOWING EXCEPTIONS:                                      02946003
*         A)IT WILL GO TO IGG0191T FOR PRINTERS WITH UCS OF FCB         02948003
*         B)IT WILL GO TO IGG0197L FOR 3505/3525'S WITH OMR OR RCE      02948403
*         C)IT WILL GO TO IGG0196Q FOR 3800 PRINTERS                    02948804
*                                                                       02950003
*ENTRY POINT - IGG0196B ENTERED FROM IGG0191B BY USE                    03000004
*                                                                       03050003
*INPUT: SEE DESCRIPTION OF REGISTERS.                                   03100003
*OUTPUT: SEE DESCRIPTION OF REGISTERS.                                  03150003
*EXTERNAL ROUTINES: IFG019RA                                            03200003
*EXITS-NORMAL:  GO TO:                                                  03250004
*                        IGG0193I             STAGE 2 SELECTOR          03300003
*                        IGG0191I             BUILD BUFFERS             03350003
*                        IGG0191T             PRINTERS WITH UCS OR FCB  03400003
*                        IGG0196Q             3800                      03410004
*                        IGG0197L             OMR OR RCE                03450003
*EXITS - ERROR  GO TO PROBLEM DETERMINATION FOR WTP AND 013 ABEND       03500004
*                                                                       03550003
*TABLES/WORKAREAS: SEE DSECTS AT THE END OF THIS LISTING.               03600003
*                                                                       04950003
*MACROS-ACTION:MODESET, IECRES, DMABCOND                                05000003
*                                                                       05050003
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY           05100003
*            UNLESS OTHERWISE SPECIFIED, SUPERVISOR STATE               05150003
*********************************************************************** 05200003
         EJECT ,                                                 A26344 05250003
*                                                                       05300003
*********************************************************************** 05350003
*                                                                       05400003
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                05450003
*                                                                       05500003
*********************************************************************** 05550003
*                                                                       05600003
*                                                                       05650003
RE       EQU   0                       WORK/PARAMETER REGISTER          05700003
RF       EQU   1                       WORK/PARAMETER REGISTER          05750003
RDCB     EQU   2                       ADDR OF USERS DCB                05800003
RBASE    EQU   3                       BASE REGISTER                    05850003
RCORE    EQU   4                       ADDR OF OPEN WORK AREA           05900003
RPAR     EQU   5                       PARAMETER LIST                   05950003
RWTG     EQU   6                       START OF WTG                     06000003
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  06050003
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       06100003
RUCB     EQU   10                      UCB ADDR/WORK REGISTER           06150003
RDEB     EQU   11                      DEB ADDRESS                      06200003
RB       EQU   12                      WORK REGISTER                    06250003
*********************************************************************   06300003
*                                                                       06350003
* *** EQUATES USED TO SET OR CHECK DCBBUFNO ***                         06400003
*                                                                       06450003
MICRMIN  EQU   12                      MINIMUM BUFNO FOR 1419 - 1275    06500003
PUNDEF   EQU   3                       DEFAULT BUFNO FOR PUNCHES        06550003
GENDEF   EQU   5                       NORMAL BUFNO DEFAULT             06600003
MICRDEF  EQU   1                       3886 BUFNO DEFAULT               06650003
*                                                                       06700003
* *** GENERAL EQUATES ***                                               06750003
*                                                                       06800003
NOADDR   EQU   1                       BIT 7 IN LOW ORDER BYTE OF       06850003
*                                      AN ADRESS MEANS THE ADDRESS      06900003
*                                      IS NOT PRESENT                   06950003
OABD072  EQU   72                      CAUSES A 013-4C ABEND            07000003
OABD073  EQU   73                      CAUSES A 013-50 ABEND            07050003
*                                                                       07100003
*********************************************************************** 07150003
         EJECT ,                                                 A26344 07200003
         BALR  RBASE,0                                                  07250003
         USING PO,RBASE                                                 07300003
         USING PARML,RPARC                                              07350003
         USING WTGENTRY,RWTGC                                           07400003
         USING WTG,RWTG                                                 07450003
*                                                                       07500003
*                                                                       07550003
*                                                                       07600003
PO       EQU   *                                                        07650003
*                                                                       07700003
         B     BEGIN                   BR AROUND CONSTANTS       Y02072 07750003
         DC    C'IGG0196B'             MODULE NAME               Y02072 07800003
         DC    C'@Z40MSMI'             LAST SHIP CODE          @Z40MSMI 07850004
         DC    C'01/31/75'             LAST SHIP DATE          @Z40MSMI 07900004
BEGIN    DS    0H                                                Y02072 07950003
*                                                                       08000003
         L     RDCB,PARDCBAD           GET DCB ADDRESS                  08050003
         USING IHADCB,RDCB                                              08100003
         L     RCORE,WTGCORE-1         GET WORK AREA           @Z30TSMI 08150003
         USING FORCORE,RCORE                                            08200003
         L     RDEB,DCBDEBAD           GET DEB ADDRESS                  08250003
         USING DEBBASIC,RDEB                                            08300003
*                                                                       08350003
*                                                                       08400003
         SR    RB,RB                   CLEAR REG                        08450003
         IC    RB,DCBBUFNO             GET BUFFER NUMBER                08500003
*                                                                       08550003
         TM    DCBCIND2,DCBCNQSM       USING QSAM              @Z30TSMI 08600003
         BO    TSTQSAM                 YES BRANCH                S19033 08650003
         LA    RF,SOP3I                SELECTOR EXEC           @Z30TSMI 08700003
         CLI   DCBDEVT,DCBDVORS        IS THIS A 1275            S19033 08750003
         BE    MICR                    YES,BRANCH                S19033 08800003
         CLI   DCBDEVT,DCBDVMR         IS THIS A 1419            S19033 08850003
         BNE   TSTOCR                  NO, BRANCH                S19033 08900003
MICR     EQU   *                                                 S19033 08950003
         TM    DCBBUFCB+3,NOADDR       BUFFER CONTROL BLOCK      S19033 09000003
*                                       SPECIFIED                S19033 09050003
         BNO   XCTLGOGO                YES BRANCH                S19033 09100003
         CLI   DCBBUFNO,MICRMIN        TEST NUMBER OF BUFFERS    A48615 09150003
         BNL   ID1I                    12 MIN.                   A48615 09200003
         MVI   DCBBUFNO,MICRMIN        ELSE DEFAULT OR ADJUST    A48615 09250003
         B     ID1I                    GO TO XCTL TO 1I.         A48615 09300003
TSTOCR   EQU   *                       CHECK 1285/1287/1288/3886 S19033 09350003
         CLI   DCBDEVT,DCBDVOR9        IS DEVICE A 3886        @Z30TSMI 09400003
         BE    XCTLGOGO                YES - GO TO 3I          @Z30TSMI 09450003
         CLI   DCBDEVT,DCBDVOR5        CHECK FOR A 1285          S19017 09500003
         BL    TSTBSAM                 NOT OCR - CONTINUE      @Z30TSMI 09550003
         CLI   DCBDEVT,DCBDVOR8        TEST IF DEVT LT/E 5C      S19017 09600003
         BNH   XCTLGOGO                OCR - GO TO 3I          @Z30TSMI 09650003
*                                                                       09700003
TSTBSAM  EQU   *                                                        09750003
         TM    DCBBUFCB+3,NOADDR       BUFFER CONTROL BLOCK SPECIFIED   09800003
         BZ    AMOPI2A                 YES BRANCH                       09850003
*                                                                       09900003
         LTR   RB,RB                   IS BUF NUMBER PRESENT            09950003
         BZ    AMOPI2A                 NO BRANCH                        10000003
ID1I     EQU   *                                                        10050003
         LA    RF,SOP7                 GET ADDR OF BUFFER EXEC     DM0B 10100003
         B     AMOPI2J                                           S20016 10150003
*                                                                       10200003
TSTQSAM  EQU   *                                                        10250003
         CLI   DCBDEVT,DCBDVMRS        DEVICE A 3890 ?          XL03123 10300003
         BNE   TSTBUFNO                NO-BRANCH                XL03123 10350003
         TM    DCBBUFCB+3,NOADDR       BUFFER CONTROL BLOCK ?   XL03123 10400003
         BZ    OLDBUFPL                YES-BRANCH               XL03123 10450003
         MVI   DCBBUFNO,MICRDEF        SUPPLY ONE BUFFER        XL03123 10500003
         B     ID1I                    GET BUFFER POOL          XL03123 10550003
TSTBUFNO EQU   *                                                XL03123 10600003
         LTR   RB,RB                   IS BUFNO PRESENT                 10650003
         BNZ   TSTQSAM2                YES-BRANCH                       10700003
*                                                                       10750003
         TM    DCBBUFCB+3,NOADDR       BUFFER CONTROL BLOCK?    ZA03763 10760003
         BO    SETBUFN1                NO-BRANCH TO SET BUFNO   ZA03763 10770003
         MODESET  KEYADDR=DXUKEY,WORKREG=15  GET INTO USER KEY  ZA03763 10780003
         L     RB,DCBBUFCB                                      ZA03763 10790003
         USING BCBLK,RB                                         ZA03763 10792003
         IC    RB,BCBBUFNO             SAVE BUFNO               ZA03763 10792403
         DROP  RB                                               ZA03763 10793203
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY   ZA03763 10793603
         STC   RB,DCBBUFNO             SUPPLY BUFCB BUFNO       ZA03763 10795603
         CLI   DCBBUFNO,GENDEF         BUFCB BUFNO LT DEFAULT   ZA03763 10796003
         BL    SETBUFN2                YES-USE BUFCB BUFNO      ZA03763 10798803
SETBUFN1 EQU   *                                                ZA03763 10799203
         MVI   DCBBUFNO,GENDEF         SUPPLY 5 BUFFERS        @Z30TSMI 10800003
SETBUFN2 EQU   *                                                ZA03763 10810003
         CLI   DCBDEVT,DCBDVCPR        DEVICE A 2520?            A36344 10850003
         BE    THREEBUF                SKIP 2540 TEST            A36344 10900003
         CLI   DCBDEVT,DCBDVCP0        USING 2540                       10950003
         BNE   TSTQSAM2                NO-BRANCH                        11000003
THREEBUF MVI   DCBBUFNO,PUNDEF         SUPPLY 3 BUFFERS          A36344 11050003
TSTQSAM2 EQU   *                                                        11100003
         TM    DCBBUFCB+3,NOADDR       BUFFER CONTROL BLOCK SPECIFIED   11150003
         BO    ID1I                    NO-BRANCH                        11200003
*                                                                       11250003
*  IF USING AN OLD BUFFER POOL,                                  A26344 11300003
*  ITS BUFL MAY BE TOO SMALL TO HANDLE AN INCREASED BLKSIZE.     A26344 11350003
*  THIS ERROR CAN ONLY BE SAFELY DIAGNOSED FOR QSAM.             A26344 11400003
OLDBUFPL EQU   *                                                XL03123 11450003
         MODESET  KEYADDR=DXUKEY,WORKREG=15  GET INTO USER KEY   Y02072 11500003
         L     RB,DCBBUFCB             TEST IF BUFFER POOL BUFL  A26344 11550003
         USING BCBLK,RB                                                 11600003
         CLC   BCBBUFSZ,DCBBLKSI       IS LESS THAN BLKSIZE      A26344 11650003
         DROP  RB                                                       11700003
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 11750003
         LA    RE,OABD072              013-4C ABEND              S21042 11800003
         BL    DCBERROR                BR IF YES TO CALL PROB    S21042 11850003
*                                      DET                       S21042 11900003
*                                                                       11950003
* IF LOGICAL RECORD INTERFACE IS REQUIRED, NEED TO GO TO IGG0191I       12000003
* TO GETMAIN FOR RECORD AREA                                            12050003
*                                                                       12100003
         TM    DCBBFTEK,DCBBFTA        LOGICAL RECORD INTERFACE  S19015 12150003
         BNO   AMOPI2A                 BRANCH NO                 S19015 12200003
*                                                                       12250003
         L     RF,DCBBUFCB             GET BUFCB                 S19015 12300003
         USING BCBLK,RF                                                 12350003
         MODESET  KEYADDR=DXUKEY,WORKREG=15  GET INTO USER KEY   Y02072 12400003
         TM    BCBFLGS,BCBLRI          IS RECORD AREA PRESENT    S19015 12450003
         DROP  RF                                                       12500003
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 12550003
         BZ    ID1I                    BRANCH NOT TO GO TO 1I    S19015 12600003
*                                                                       12650003
AMOPI2A  EQU   *                       DO NOT NEED BUFFER BUILT         12700003
         LA    RF,SOP3I                ID OF STAGE 2 SELECTOR  @Z30TSMI 12750003
*                                                                       12800003
AMOPI2J  EQU   *                                                 S20016 12850003
         CLI   DCBDEVT,DCBDVCR2        3505                      S21088 12860003
         BE    AMOPI2J0                YES                       S21088 12870003
         CLI   DCBDEVT,DCBDVCP1        3525                      S21088 12880003
         BNE   AMOPI2J2                NO - CONTINUE             S21088 12890003
AMOPI2J0 EQU   *                       3505 OR 3525              S21088 12892003
         TM    DCBMODE,DCBMODEO+DCBMODER  OMR OR RCE             S21088 12894003
         BNZ   AMOPI2J1                YES - GO TO 7L            S21088 12896003
         CLI   DCBFUNC,0               FUNCTION SPECIFIED        S21088 12898003
         BE    AMOPI2J2                NO - CONTINUE             S21088 12898403
         CLI   DCBFUNC,DCBFNCBR        READ ONLY                 S21088 12898803
         BE    AMOPI2J2                YES - CONTINUE            S21088 12899203
         CLI   DCBFUNC,DCBFNCBP        PUNCH ONLY                S21088 12899603
         BE    AMOPI2J2                YES - CONTINUE            S21088 12899703
AMOPI2J1 EQU   *                       NEED 7L                   S21088 12899803
         LA    RF,SOP7L                OMR RCE EXEC              S21088 12899903
         B     XCTLGOGO                XCTL                      S21088 12900003
AMOPI2J2 EQU   *                       CONTINUE                  S21088 12906603
*                                                                  DM0B 12920003
****************************************************************** DM0B 12950003
*                                                                  DM0B 13000003
*    TEST IF THE DEVICE IS A PRINTER AND IF IT IS CAUSE AN 013-50       13020004
*    ABEND IF IT IS NOT OPEN FOR OUTPUT OR OUTIN.                       13040004
*    IF IT IS A PRINTER AND HAS UCS OF FCB IT WILL GO TO IGG0191T.      13060004
*    IF IT IS A 3800 PRINTER IT WILL GO TO IGG0196Q                     13080004
*                                                                  DM0B 13100003
****************************************************************** DM0B 13150003
*                                                                  DM0B 13200003
         CLI   DCBDEVT,DCBDVPR5        3800 PRINTER            @Z40MSMI 13210004
         BE    CHKAB                   SEE IF OPENED CORRECTLY @Z40MSMI 13220004
         CLI   DCBDEVT,DCBDVPR1        IF LESS THAN X'48' NOT   SA61288 13250003
*                                         A PRINTER             SA61288 13300003
         BL    XCTLGOGO                BR IF NOT A PRINTER      SA61288 13350003
         CLI   DCBDEVT,DCBDVPR4        IF HIGHER THAN X'4B'     SA61288 13400003
*                                         NOT A PRINTER         SA61288 13450003
         BH    XCTLGOGO                BR IF NOT A PRINTER      SA61288 13500003
CHKAB    EQU   *                                                        13510004
         LA    RE,OABD073              013-50 ABEND              S21042 13550003
         TM    PAROPT,PAROUTIN         DCB OPENED FOR OUT OR OUTIN12873 13600003
         BNO   DCBERROR                CALL PROBLEM DETERMINATION 12873 13650003
         CLI   DCBDEVT,DCBDVPR5        IS IT 3800              @Z40MSMI 13670004
         BE    XCTLGO6Q                YES - GO TO 196Q        @Z40MSMI 13680004
         CLI   DCBDEVT,DCBDVPR3        IF A 3211, IT HAS UCS    SA61288 13700003
         BE    XCTLGO1T                BYPASS UCS TEST          SA61288 13750004
         CLI   DCBDEVT,DCBDVPR4        IF A 2245, IT DOES NOT   SA61288 13800003
*                                         HAVE UCS BUT IT DOES  SA61288 13850003
*                                         HAVE AN FCB           SA61288 13900003
         BE    XCTLGO1T                BYPASS UCS TEST          SA61288 13950004
         L     RUCB,DEBSUCBA           GET UCB ADDRESS                  14000003
         USING UCBOB,RUCB                                               14050003
         TM    UCBTBYT2,UCB2OPT0       TEST IF PRINTER HAS UCS     DM0B 14100003
         DROP  RUCB                                                     14150003
         BZ    XCTLGOGO                IF NOT,GOTO XCTL ROUTINE    DM0B 14200004
*                                                                       14250003
XCTLGO1T EQU   *                                                 S20202 14300003
*                                                                  DM0B 14350003
         LA    RF,SOPT                 LOAD ADDR OF UCS EXECUTOR   DM0B 14400004
         B     XCTLGOGO                GO TO 1T                @Z40MSMI 14450004
*                                                                       14460004
XCTLGO6Q EQU   *                                                        14470004
         LA    RF,SOP6Q                3800 EXEC               @Z40MSMI 14480004
****************************************************************** DM0B 14500003
*                                                                  DM0B 14550003
XCTLGOGO EQU   *                                                   DM0B 14600003
*                                                                  DM0B 14650003
         MVC   WTGIDTTR,0(RF)          ID TO MOD NAME            Y02072 14700003
RELOOP   EQU   *                                                        14750003
         LA    RWTGC,WTGEND            INCREMENT CURRENT WTG ENTRY      14800003
         LA    RPARC,L'PARDCBAD(0,RPARC) INCR CURRENT DCB ENTRY PTR     14850003
         CLC   WTGID,AMIDCNST          THIS RT NEEDED AGAIN             14900003
         BER   RBASE                   RETURN TO INIT. ANOTHER DCB      14950003
*                                                                       15000003
         CLC   WTGID,OPIDCNST          END OF TABLE                     15050003
         BNE   RELOOP                  NO, CHECK NEXT ENTRY             15100003
*                                                                       15150003
         LR    RPARC,RPAR                                               15200003
         LA    RWTGC,WTGENTRY-WTG(,RWTG)  REINIT WTG LIST PTR           15250003
ZCHEK    CLI   WTGENTRY,X'00'          IS THIS ENTRY COMPLETE           15300003
         BNE   TCTLRTN                 IF NOT TRANSFER CONTROL          15350003
*                                                                       15400003
         LA    RWTGC,WTGEND            GET NEXT ENTRY                   15450003
         LA    RPARC,L'PARDCBAD(0,RPARC)                                15500003
         B     ZCHEK                                                    15550003
*                                                                       15600003
TCTLRTN  EQU   *                                                        15650003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*15700003
               MODID=WTGENTRY                                  @Z30TSMI 15750003
         EJECT                                                          15850003
**********************************************************************  16000003
*                                                                       16050003
*                                                                       16100003
*                                                                       16150003
DCBERROR EQU   *                                                        16200003
*                                                                       16250003
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES      S21042X16300003
                                        CALL PROBLEM DETERMINATION      16350003
         B     TCTLRTN                                           S21042 16400003
         DROP  RWTG,RWTGC,RPARC,RBASE,RDCB,RCORE,RDEB                   16450003
         EJECT                                                          16500003
**********************************************************************  16550003
*                                                                       16600003
*  MODULE ID'S                                                          16850003
*                                                                       16900003
SOP7     DC    C'1I',VL3(IGG0191I)      FOR SYSTEM BUILT BUFFER  Y02072 16950003
*                                         POOLS                  Y02072 17000003
SOP3I    DC    C'3I',VL3(IGG0193I)      STAGE 2 EXEC SELECTOR           17050003
SOPT     DC    C'1T',VL3(IGG0191T)      PRINTERS WITH UCSB/FCB'S Y02072 17100003
SOP6Q    DC    C'6Q',VL3(IGG0196Q)      3800 PRINTERS          @Z40MSMI 17102004
SOP7L    DC    C'7L',VL3(IGG0197L)      3505 OR 3525 WITH OMR OR RCE    17110003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION    Y02072 17150003
OPIDCNST DC    C'0S'                    COMMON OPEN              Y02072 17200003
AMIDCNST DC    C'6B'                    ID OF THIS LOAD                 17250003
         SPACE                                                          17300003
PATCH    DC    25H'0'                   PATCH AREA               Y02072 17350003
         EJECT ,                                                 A26344 17450003
         IGGBCB                                                         17500003
         EJECT                                                          17550003
CVT      DSECT                                                          17600003
         CVT                                                            17650003
         EJECT                                                          17700003
         DCBD  DSORG=PS                                         SA61288 17750003
DCBDVPR4 EQU   X'4B'                    DEVICE ID FOR 2245      SA61288 17800003
**********************TEMPORARY WAITING FOR 3800 DCB UPDATE             17810004
         EJECT                                                          17850003
         IEZDEB                                                         17900003
         EJECT                                                          17950003
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                      Y02072 18000003
         ORG   WTGIDTTR                                                 18050003
WTGID    DS    CL2                      ID PORTION                      18100003
         EJECT                                                          18150003
         IGGPARML                                                       18200003
         EJECT                                                          18250003
SRT      DSECT                                                          18300003
         IEFUCBOB                                                       18350003
         END                                                            18400003
./  ADD  SSI=70530508,NAME=IGG0196I
196I     TITLE  'IGG0196I  --  DEB CONSTRUCTION'                        00100000
IGG0196I CSECT                                                          00200021
*                                                                       00210002
*MODULE NAME - IGG0196I                                          Y02072 00220002
*                                                                       00230002
*DESCRIPTIVE NAME - BEGIN DEB CONSTRUCTION                       Y02072 00240002
*                                                                       00242002
*COPYRIGHT - NONE                                                Y02072 00244002
*                                                                       00246002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00248002
*                                                                       00248402
*        VS1 RELEASE 02 DELETIONS                                       00248802
*D391300-391600                                                  OX1819 00249202
*                                                                       00250002
*        VS 2 RELEASE 02 DELETIONS                                      00300002
*012500,211000-222000,397000,428000,499000,455000,478000,482000, Y02072 00350002
*589000,590000                                                   Y02072 00352002
*                                                                YM4640 00352102
*C404000,421000                                                  YM7574 00362102
*                                                                YM7829 00372102
*                                                                       00382103
*        VS 2 RELEASE 03 DELETIONS                                      00392103
*                                                              @Z30TSCF 00394103
*                                                                       00400002
*        VS2 RELEASE 03 CHANGES/DELETIONS                               00450002
*A135500-136000,430500-430600                                   ZA01540 00500002
*C210600                                                        ZA00631 00510003
*   OZ14711 IS SYSROUTE FROM OY15702                           @ZA14711 00520037
*A346051,346052                                                @ZA14711 00530037
*                                                                       00550002
*          RELEASE 21 DELETIONS                                         00800021
*0000496000-502000                                               M0091  00810021
*0000                                                            M0053  00820021
*1394246130,246672-246676                                        A42897 00850021
*0000444000-445000                                               A46645 00900021
*                                                               SA53194 00902021
*                                                                       00910021
*  THIS MODULE WAS CREATED IN REL 21 BY SPLITTING IGG0191A              00950021
*     ( NEW FLOW - IGG0191A - IGG0196I - IGG0196A )                     01050021
*                                                                       01150021
*                                                                       01700021
*FUNCTION  THIS EXECUTOR IS ENTERED FOR USERS OF SAM AND EXCP           01800021
*          DURING OPEN FOR THE CONSTRUCTION OF DEBS.                    01900021
*          THE AMOUNT OF CORE NEEDED TO BUILD THE DEB IS                01940021
*          CALCULATED AND A GETMAIN IS ISSUED.                          01980021
*          CORE IS CLEARED AFTER GETMAIN                                02020021
*          POINTERS TO TCB & DCB PUT INTO DEB.                          02060021
*          DEBS ARE BUILT FOR ALL DEVICES SUPPORTED BY THE SEQUENTIAL   02100021
*          ACCESS METHODS OR PARTITIONED ACCESS METHOD.                 02200021
*                                                                       02300021
*ENTRY POINT--IGG0196I                                                  02400021
*                                                                       02500021
*          ENTERED FROM IGG0191A BY XCTL                                02600021
*                                                                       02800021
*INPUT--  DCB ADDRESS                                                   02900021
*          WORK AREA ADDRESS                                            03000021
*          WHERE TO GO TABLE                                            03100021
*          PARAMETER LIST                                               03200021
*          CURRENT ENTRY IN WHERE TO GO TABLE                           03300021
*          CURRENT PARAMETER (DCB)                                      03400021
*                                                                       03500021
*OUTPUT-   AS OUTLINED BELOW :                                          03600021
*                                                                       03800021
*        BASIC DEB LAYOUT FOR ALL I/O DEVICES SUPPORTED                 03900021
*                                                                       04000021
*        **********************************                             04100021
*   -16  *I/OS* I/O SUPPORT DCB ADDRESS   *                             04200021
*   -12  *    * RESERVED                  *                             04300021
*   -08  *    * DCB MODIF MASK            *                             04400021
*   -04  *DEBL*                           *                             04500021
*   +00  *SUBL* TCB ADDRESS               *                             04600021
*   +04  *AML * DEB LINK FIELD            *                             04700021
*   +08  *DPAT* IRB ADDRESS               *                             04800021
*   +12  *FLTP* SYSTEM PUTGE CHAIN        *                             04900021
*   +16  *NEXT* USER PURGE CHAIN          *                             05000021
*   +20  *PRTY* ECB ADDRESS               *                             05100021
*   +24  *KEYD* DCB ADDRESS               *                             05200021
*   +28  *SCAL* APPENDAGE ADDRESS         *                             05300021
*        **********************************                             05400021
*                                                                       05600021
*        DEVICE DEPENDENT SECTION OF DEB                                05700021
*                                                                       05800021
* TAPE/URE                                                              05900021
*                                                                       06100021
*        **********************************                             06200021
*   +32  *DMOD*  UCB ADDRESS              *                             06300021
*   +36  *VOL SEQ NO     *NO. OF VOLS.    *                             06400021
*        **********************************                             06500021
*                                                                       06600021
* REMAINDER OF THE DEB IS BUILT IN IGG0191N.                            06700021
*                                                                       06800021
* D.A.SAM DEB.                                                          06900021
*        **********************************                             07000021
*   +32  *FMSK*  UCB ADDRESS              *                             07100021
*   +36  *EXTENT FIELD BBCCHHCCHH         *                             07200021
*   +40  *                                *                             07300021
*   +44  *               *NO.TRACKS ALL.  *                             07400021
*   +48  *VOL SEQ NO     *NO. OF VOLS     *                             07500021
*        **********************************                             07600021
*                                                                       07800021
* NOTE.+32 - +44 IS REPEATED PER EXTENT                                 07900021
*                                                                       08100021
* D.A.TO MEMBER FOR OUTPUT                                              08200021
*        **********************************                             08300021
*   +E2  *MEMBER NAME THAT IS OPENING     *                             08400021
*   +56  *MEMBER NAME THAT IS OPENING     *                             08500021
*        **********************************                             08600021
*                                                                       08800021
* DA BPAM CONCATENATION (INPUT)                                         08900021
*        **********************************                             09000021
*   +48  *DSNO DSNO  DSNO DSNO            *                             09100021
*        *EXTU EXT2  EXT3 EXT4            *                             09200021
*        **********************************                             09300021
*                                                                       09500021
*NOTE. BPAM DEB SAME AS SAM DEB WITH EXCLUSSION OF FIELD AT +48         09600021
*                                                                       09700021
*        USER LABEL EXTENT IS NOT INCLUDED IN F1 EXTENT COUNT,          09800021
*        AND IS NOT INCLUDED IN DEB EXTENTS.                            09900021
*                                                                       10000021
*        ROUTINE ALSO MERGES CLASS BYTE AND DEVICE BYTE OF UCB/SRT      10100021
*        INTO DCB FIELD (DEVT)                                          10200021
*                                                                       10300021
* EXITS - NORMAL XCTL TO IGG0196A TO CONTINUE PROCESSING                10400021
*                                                                       10600021
*TABLES/WORKAREA - SEE DSECTS AT END OF LISTING.                        10700021
*                                                                       10800021
*ATTRIBUTES- RE-ENTRANT- RE-USABLE- RUNS IN DATA MANAGEMENT KEY, Y02072 10900002
*            RUNS IN SUPERVISOR STATE                            Y02072 10950002
*                                                                       11300021
*******************************************************************     11400021
*                                                                       11600021
* MASK'S TO TEST PARAMETER LIST WITH                                    11700021
OPPATRUB EQU   0                                                        12300021
DEBBSLNG EQU   80                                                       12700021
COMMUTAB EQU   16                                                       12800021
NEXTCORE EQU   140                                                      13100021
SUBRNTID EQU   20                       SUBROUTINE ID LENGHT.           13500021
DEBXNTP  EQU   28                       DISP IN DEB PREFIX      ZA01540 13550002
*                                       TO DEB EXTENSION PTR    ZA01540 13600002
ZERO     EQU   0                        PARAMETRIC ZERO            UT18 13700021
INFLAG   EQU   X'0E'                    FLAG FOR INPUT TEST        UT18 14000021
BFTEKR   EQU   X'20'                    DCBBFTEK=R               S19015 14200021
VSBITS   EQU   X'48'                    VS BITS IN DCBRECFM      S19015 14300021
RECFMB   EQU   X'10'                    BLOCKED RECORD FORMAT    S19015 14400021
QSAMB    EQU   X'01'                    QSAM BIT                 S19015 14600021
EXCP     EQU   X'80'               EXCP                          I19119 14800021
TIOTTERM EQU   X'20'                    DEVICE IS TERMINAL (TSO) S20016 15550021
SULEXNT  EQU  X'40'                     TEST IF USER LABEL EXTENTA46645 15600021
SPLTCYL  EQU  X'80'                     TEST IF SPLT CYL ALLOC   A46645 15610021
* * * * * * * * * * * *   3525    CODE      * * * * * * * * * * * * * * 15650021
RP       EQU   X'60'                   READ/PUNCH MASK           M0053  15750021
RW       EQU   X'50'                   READ/PRINT MASK           M0053  15850021
PW       EQU   X'30'                   PUNCH/PRINT MASK          M0053  15950021
D3525    EQU   X'0C'                   3525 UCB UNIT TYPE CODE   M0053  16050021
ASSOCDS  EQU   X'04'                   ASSOC. DATASET--3525     SA53194 16100021
FUNCOFF  EQU   3                       DCBFUNC OFFSET            M0053  16150021
DEBCORE  EQU   230                      SUBPOOL NUMBER FOR DEB   Y02072 16200002
FMTFOUR  EQU   C'4'                     DSCB FORMAT 4 IDENTIFIER Y02072 16250002
*                                                                       16300021
*REGISTERS ARE REFERENCED SYMBOLICALLY WHERE APPROPRIATE                16400021
*                                                                       16500021
RDCB     EQU   2         DCB REGISTER                                   16600021
RBASE    EQU   3         BASE REGISTER                                  16700021
RCORE    EQU   4         WORK AREA ADDRESS                              16800021
RPAR     EQU   5         TOP OF PARAMETER LIST                          16900021
RWTG     EQU   6         TOP OF WTG TABLE                               17000021
RPARC    EQU   7         CURRENT PARAMETER                              17100021
RWTGC    EQU   8         CURRENT TRANS LOAD                             17200021
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    17300021
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       17400021
RDEB     EQU   11        DEB ADDRESS                                    17500021
RB       EQU   12        WORK REG1  **                                  17600021
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          17700021
RD       EQU   14        WORK REG3  **                                  17800021
RJ       EQU   15        WORK REG4                                      17900021
RE       EQU   0         WORK REG5                                      18000021
RWK1     EQU   RE                       WORK REGISTER            Y02072 18050002
RF       EQU   1         WORK REG6                                      18100021
*                                                                       18400021
*********************************************************************** 18500021
*                                                                       18900021
         BALR  RBASE,0                                                  19000021
         USING BEGIN,RBASE                                              19100021
         USING IHADCB,RDCB                                              19200021
         USING FORCORE,RCORE                                            19300021
         USING DEB,RDEB                                                 19400021
         USING   TCB,RD                                                 19500021
         USING TIOT,RTIOT                                               19600021
         USING UCBOB,RUCB                                               19700021
*                                                                       20100021
BEGIN    EQU   *                                                        20200021
         B     START                    BRANCH AROUND MODULE ID  YM4640 20202002
         DC    C'IGG0196I'              MODULE NAME              YM4640 20204002
         DC    C' ZA14711'              LAST SHIP CODE         @ZA14711 20206037
         DC    C'02/16/77'              LAST SHIP DATE         @ZA14711 20208037
START    DS    0H                       END OF MODULE ID         YM4640 20210002
*                                                                       20300021
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 20400021
         L     RCORE,4(RWTGC)           GET WORK AREA                   20500021
         L     RD,COMMUTAB         CALCULATE TCB ADDRESS                20600021
         L     RD,0(0,RD)                                               20700021
         L     RD,4(0,RD)               TCB  ADDR                       20800021
         L     RTIOT,TCBTIO                                             20900021
         AH    RTIOT,DCBTIOT       RESET TIOT POINTER                   21000021
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 21030021
         BO    OBPAM074                                         ZA00631 21060003
         L     RUCB,DXUCBADR            GET UCB PTR              Y02072 21100002
         USING UCBOB,RUCB                                               25200021
         TM    UCBTBYT3,UCB3DACC        OPENING A D A DEVICE            29900021
         BC    14,OBPAM070              NO BRANCH                       30000021
         SR    RB,RB               SET NUMBER OF DS COUNTER TO ZERO     30100021
         SR    RE,RE                                                    30200021
         SR    RC,RC                                                    30300021
         IC    RC,DSCNOEXT              GET NO OF EXT OF FIRST DS       30400021
         LTR   RC,RC                    NO OF EXTENTS = 0               30500021
         BC    7,OBPAM010               NO BRANCH                       30600021
         LA    RC,1                     SUPPLY  ONE DUMMY EXTENT        30800021
         CLI   DSCFMTID,FMTFOUR         FORMAT 4 DSCB            Y02072 30850002
         BE    OBPAM010                 YES, DON'T SET VOL FULL  Y02072 30860002
         TM    DCBMACRF,X'80'           EXCP BIT ON                     30900021
         BC    1,OBPAM010               BRANCH IF EXCP                  31000021
         OI    DCBCIND1,X'20'           SET VOL FULL IND DUMMY EXT      31100021
OBPAM010 EQU   *                                                        31300021
         L     RF,DSCCORE               GET NEXT DSCB ADDR              31500021
OBPAM020 EQU   *                                                        31700021
         LTR   RF,RF                    CK FOR MORE DSCB                31800021
         BC    8,OBPAM080          BRANCH IF NONE LEFT                  31900021
         CLI   44(RF),X'F1'             CK FOR FORMAT 1                 32000021
         BC    7,OBPAM040               BR IF NO                        32100021
*                                                                       32200021
*        THERE WILL BE FORMAT 1 ONLY IF CONCATENATION IS SPECIFIED      32300021
*                                                                       32400021
         IC    RE,59(0,RF)              GET NO OF EXTENT OF NEXT DS     32500021
         LTR   RE,RE                    NO OF EXTENTS = 0               32600021
         BC    7,OBPAM030               NO BRANCH                       32700021
         LA    RE,1                     SUPPLY ONE DUMMY EXTENT         32900021
OBPAM030 EQU   *                                                        33100021
         AR    RC,RE                    FORM TOTAL NO OF EXTENT         33300021
         LA    RB,1(0,RB)               ADD ONE TO NO OF DS             33400021
OBPAM040 EQU   *                                                        33600021
         L     RF,NEXTCORE(0,RF)        GET NEXT DSCB                   33700021
         BC    15,OBPAM020                                              33800021
OBPAM060 EQU   *                                                        34000021
         CLI   JFCBELNM,X'40'           CK FOR MEMBER NAME              34100021
         BC    8,OBPAM100               BR IF NO NAME                   34200021
         LA    RDEB,8(0,RDEB)           ADD 8 BYTES FOR MEMBER NAME     34300021
         BC    15,OBPAM100                                              34400021
OBPAM070 EQU   *                                                        34600021
* * * * * * * * * * * *   3525    CODE      * * * * * * * * * * * * * * 34605021
         TM    UCBTBYT3,UCB3UREC       UNIT RECORD DEVICE?     @ZA14711 34606037
         BNO   OBPAM074                BRANCH IF NO            @ZA14711 34607037
         CLI   UCBTBYT4,D3525          IS THIS A 3525            M0053  34610021
         BNE   OBPAM074                BRANCH IF NOT A 3525      M0053  34615021
         TM    DCBMODE+FUNCOFF,RP      READ/PUNCH ASSOCIATED     M0053  34620021
*                                       DATA SET                 M0053  34625021
         BO    OBPAM072                BRAMCH IF YES             M0053  34630021
         TM    DCBMODE+FUNCOFF,RW      REAR/PRINT ASSOCIATED     M0053  34635021
*                                       DATA SET                 M0053  34640021
         BO    OBPAM072                BRANCH IF YES             M0053  34645021
         TM    DCBMODE+FUNCOFF,PW      PUNCH/PRINT ASSOCIATED    M0053  34650021
*                                       DATA SET                 M0053  34655021
         BNO   OBPAM074                BRANCH IF NOT PUNCH/PRINT M0053  34660021
OBPAM072 EQU   *                                                 M0053  34665021
         OI    DCBQSWS,ASSOCDS         TURN ON BIT              SA53194 34667021
         LA    RDEB,16                 16 BYTE EXTENT FOR AN     M0053. 34670021
*                                       ASSOC D,S                M0053  34675021
         B     OBPAM075                BRANCH TO LOAD AM SECTION M0053  34680021
*                                       SIZE                     M0053  34685021
OBPAM074 EQU   *                                                 M0053  34690021
* * * * * * * * * * *   END OF 3525 CODE   * * * * * * * * * * * * * *  34695021
         LA    RDEB,4                   ONE FOUR BYTE EXTENT FOR TAPE   34700021
OBPAM075 EQU   *                                                 A25961 34800021
         LA    RDEB,16(RDEB)            16 BYTE AM SECTION       A25961 34900021
         B     OBPAM100                                                 35000021
OBPAM080 EQU   *                                                        35200021
         LR    RDEB,RC                  TOTAL NO OF EXTENTS             35300021
         SLL   RDEB,4                   MULT BY 16 EXT SIZE             35400021
         TM    DSCFILTY,X'02'           DSORG PO                 A25961 35500021
         BNO   OBPAM075                 BR IF NO                 A25961 35600021
         TM    OPPATRUB(RPARC),X'0F'    CK FOR OUTPUT                   35700021
         BC    1,OBPAM060               BR IF YES                       35800021
         LA    RDEB,0(RB,RDEB)          ADD NO OF DS FOR INPUT          35900021
OBPAM100 EQU   *                                                        36100021
         LA    RDEB,DEBBSLNG+SUBRNTID(RDEB)  ADD BASIC AND SUBRNT ID.   36200021
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 36330021
         BO    OBPAM101                 BRANCH IF YES            S20016 36360021
         TM    DCBMACRF,EXCP            BR IF EXCP,  DCBOPTCD   OX01819 36370002
         BO    OBPAM115                   DOES NOT EXIST        OX01819 36380002
         TM    UCBTBYT3,UCB3DACC        IS DEVICA DA.                   36400021
         BC    14,OBPAM101              BRANCH IF NOT.                  36500021
         TM    DSCFILTY,X'02'           DCB REFERENCING A PDS           36600021
         BZ    OBPAM101                 BRANCH, IF NOT           A25961 36700021
         NI    DCBOPTCD,X'FD'           IF PO,IGNORE INVALID     A27334 36800021
OBPAM101 EQU   *                                                 S19015 37100021
*     THE NEXT SECTION OF CODE VALIDATES THE 'R' BIT IN THE DCBBFTEK    37300021
*     FIELD, IF IT IS ON.                                               37400021
         TM    DCBCIND2,QSAMB           QSAM BEING USED          S19015 37500021
         BO    OBPAM115                 YES--CONTINUE            S19015 37600021
         TM    DCBBFTEK,BFTEKR          VS SUPPORT NEEDED        S19015 37700021
         BZ    OBPAM115                 N0--CONTINUE             S19015 37800021
         TM    DCBRECFM,VSBITS          TEST FOR VS              S19015 37900021
         BNO   OBPAM112                 NOT VS--GO TURN OFF 'R'  S19015 38000021
*                                       BIT                      S19015 38100021
         TM    DCBRECFM,RECFMB          BLOCKED RECORDS          S19015 38200021
         BO    OBPAM112                 BLOCKED RECORDS NOT      S19015 38300021
*                                       SUPPORTED                S19015 38400021
         TM    ZERO(RPARC),INFLAG       INPUT                    S19015 38500021
         BC    7,OBPAM115               NO--CONTINUE             S19015 38600021
         XC    DCBOPTCD(L'DCBOPTCD),DCBOPTCD  CLEAR DCBOPTDC FIELD      38700021
         CLI   DCBKEYLE,ZERO            ARE THERE KEYS           S19015 38800021
         BNE   OBPAM115                 YES--R BIT WILL BE LEFT  S19015 38900021
*                                       ON                       S19015 39000021
OBPAM112 EQU   *                                                 S19015 39100021
         NI    DCBBFTEK,X'FF'-BFTEKR    TURN OFF BFTEKR BIT      S19015 39200021
OBPAM115 EQU   *                                                 S19015 39500021
         LA    RE,DEBCORE               GET CORE FROM SP 230     Y02072 39700002
         SLL   RE,24                                                    39800021
         OR    RE,RDEB                  SET UP FOR GETMAIN              39900021
         ST    RE,REGSAVE0              SAVE LEN ACROSS GETMAIN  YM7574 39950002
         GETMAIN R,LV=(0)               GET CORE FOR DEB                40000021
*                                                                       40100021
*        CONSTRUCT BASIC SECTION                                        40200021
*                                                                       40300021
         ST    RF,REGSAVE1              SAVE ADDR OF CORE        YM7574 40350002
         LA    RJ,256                   GET CONSTANT OF 256        UT18 40500021
OBPAM140 EQU   *                                                   UT18 40700021
         CR    RDEB,RJ                  IS LENGTH GRTR THAN 256    UT18 40800021
         BNH   OBPAM145                 BR IF NOT GRTR THAN 256    UT18 40900021
         BCTR  RJ,0                     DECR LNGTH TO 255 FOR MOVE UT18 41000021
         EX    RJ,CLEARDEB              EXECUTE MOVE OF 256 BYTES  UT18 41100021
         LA    RJ,1(0,RJ)               RESTORE TO 256             UT18 41200021
         SR    RDEB,RJ                  SUBTRACT 256 FROM LENGTH   UT18 41300021
         AR    RF,RJ                    INCR AREA ADDR BY 256      UT18 41400021
         B     OBPAM140                 BR TO MOVE MORE BYTES      UT18 41500021
OBPAM145 EQU   *                                                   UT18 41700021
         BCTR  RDEB,0                   DECR LNGTH FOR MOVE INSTR  UT18 41800021
         EX    RDEB,CLEARDEB            MOVE LESS THAN 256 BYTES   UT18 41900021
         LM    RE,RF,REGSAVE0           RESTORE LENGTH,ADDRESS   YM7574 42100002
         LR    RJ,RE                    CLEAR HIGH ORDER BYTE      UT18 42200021
         LA    RJ,0(RJ)                 OF LENGTH REGISTER         UT18 42300021
         LA    RDEB,36(0,RF)            DEB ADDR PT TO BASIC SECTION    42400021
         ST    RDEB,DCBDEBAD            DEB ADDR INTO DCB               42500021
         MVC   DCBIFLGS(1),DCBIFLG     RESTORE IFLAGS                   42600021
         NI    DCBDEBAD,X'3F'           TURN OFF IFLAGS                 42700021
         ST    RDCB,DEBDCBAD            DCB ADDR TO DEB          Y02072 42850002
         ST    RD,DEBTCBAD              TCB ADDR INTO DEB               42900021
         ST    RF,DEBAPPAD              APP ADDR                        43000021
         MVC   DEBXNTP(4,RF),DXDEBXAD   CONNECT DEB EXTENSION   ZA01540 43050002
*                                       TO DEB PREFIX           ZA01540 43060002
         STC   RB,DEBAMLNG              NO. OF DATA SETS - 1 IF  A25961 43100021
*                                       PARTITIONED. 0 IF NOT           43200021
         LA    RJ,7(RJ)                 ROUND OFF TO DW                 43300021
         SRL   RJ,3                     LENGTH OF DEB IN DW             43400021
         STC   RJ,32(RF)                                                43500021
         MVI   DEBOFLGS,X'C0'                                           43600021
         NC    DEBOFLGS,JFCBIND2        OPEN NEW OLD MOD INDICATOR      43700021
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 43730021
         BO    FINISH                   BRANCH IF YES            S20016 43760021
         TM    UCBTBYT3,UCB3DACC        OPENING A D.A DEVICE      18987 43800021
         BC    14,OBPAM120              NO BYPASS TEST FOR LAST   18987 43900021
*                                       VOLUME INDICATOR          18987 44000021
         TM    DSCDSIND,X'80'           TEST LAST VOL IND IN DSCB 18987 44100021
         BC    8,OBPAM120               NO DONT SET EOF IND       18987 44200021
         OI    DEBOFLGS,X'20'           SET EOF IN DEBOFLGS       18987 44300021
*                                                                       44600021
*    APAR 46645 RESULTED FROM A USER SPECIFYING BOTH STANDARD    A46645 44610021
*    USER LABELS AND SPLIT CYLINDER ALLOCATION. SPLIT CYLINDER   A46645 44620021
*    ALLOCATION WOULD NOT BE GIVEN TO THE USER UNDER THESE       A46645 44630021
*    CONDITIONS.                                                 A46645 44640021
OBPAM120 EQU  *                                                  A46645 44650021
         CLI  DSCEXTYP,SULEXNT          USER LABEL EXTENT?       A46645 44660021
         BNE  AROUND                    NO, DON'T TEST 2ND EXENT A46645 44670021
         CLI  DSCEXT1,SPLTCYL           SPLIT CYLINDER           A46645 44680021
*                                          ALLOCATION?           A46645 44682021
         BNE  OBPAM160                  NO, DON'T SET SPLT CYL   A46645 44690021
*                                          BIT                   A46645 44690421
         B    SPCYL                     YES, SET SPLT CYL BIT    A46645 44692021
AROUND   EQU  *                                                  A46645 44694021
         CLI  DSCEXTYP,SPLTCYL          SPLIT CYLINDER           A46645 44696021
*                                          ALLOCATION?           A46645 44696421
         BNE  OBPAM160                  NO, DON'T SET BIT        A46645 44698021
SPCYL    EQU  *                                                  A46645 44698421
         OI    DEBOFLGS,X'04'           SET INDICATOR IN DEB            44700021
OBPAM160 EQU   *                                                        44800021
         STC   RC,DEBNMEXT              STORE NO. OF EXTENTS     M4878  45000021
FINISH   EQU   *                                                        45100021
         LA    RF,SOP6A                 SET UP FOR XCTL TO       S19033 45300021
*                                       IGG0196A                 S19033 45400021
         USING WTGENTRY,RWTGC                                    Y02072 45450002
         MVC   WTGIDTTR,0(RF)           ID OF NEXT MODULE      @Z30TSCF 45460003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     UPDATE WHERE TO GO ENTRY        45900021
         LA    RPARC,PLOFF(0,RPARC)     UPDATE PARA LIST ENTRY          46000021
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            46100021
         BCR   8,RBASE                  YES BR BACK TO BEGINNING        46200021
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    46400021
         BC    7,RELOOP                 NO BRANCH                       46500021
         LR    RPARC,RPAR                                               46700021
         LA    RWTGC,WAOFF(0,RWTG)      RE INIT  WTG LIST               46800021
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           46900021
         BC    7,TCTLRTN                NO XCTL                         47000021
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  47200021
         LA    RPARC,PLOFF(0,RPARC)                                     47300021
         BC    15,ZCHEK                                                 47400021
TCTLRTN  EQU   *                                                        47600021
         USING WTG,RWTG                                                 47700003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*47750003
               MODID=WTGENTRY                                  @Z30TSCF 47800003
         DROP  RWTGC,RWTG                                               47850003
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   48400021
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                48500021
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                48600021
OPIDCNST DC    C'0S'                                                    48700021
AMIDCNST DC    C'6I'                                                    48800021
SOP6A    DC    C'6A',VL3(IGG0196A)      IGG0196A - NEXT MODULE @Z30TSCF 48850003
CLEARDEB XC    ZERO(ZERO,RF),ZERO(RF)   CLEAR CORE FOR DEB         UT18 48900021
         SPACE                                                          48950002
PATCH    DC    50X'0'                   PATCH AREA               YM4640 49000002
END      EQU   *                        END OF MODULE            Y02072 49050002
*********************************************************************   50300021
SRT      DSECT                                                          50400021
         IEFUCBOB                                                       50500021
*                                                                       50600021
         EJECT                                                          50700021
           DCBD  DSORG=PS                                               50800021
CVT      DSECT                                                          50900021
         CVT                                                            51000021
*   TASK CONTROL BLOCK                                                  51100021
         CNOP  0,4                                                      51200021
TCB      DSECT                                                          51300021
TCBRBP   DS    F                       PO9NTER TO EXECUTING RB          51400021
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   51500021
TCBDEB   DS    F                       POINTER TO DEB QUEUE             51600021
TCBTIO   DS    F                       POINTER TO TIOT                  51700021
TCBCMP   DS    F                       TASK COMPLETION CODE             51800021
TCBTRN   DS    F                       TESTRAN FIELD                    51900021
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 52000021
TCBPKF   DS    CL1                     RESERVED FOR FUTURE USE          52100021
TCBFLGS  DS    FL5                     FLAG BYTES                       52200021
TCBLMP   DS    CL1                     RESERVED FOR FUTURE USE          52300021
TCBDSP   DS    CL1                     RESERVED FOR FUTURE USE          52400021
TCBLLS   DS    F                       POINTER TO LOAD LIST             52500021
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            52600021
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  52700021
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       52800021
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             52900021
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  53000021
TCBTCB   DS    F                       RESERVED FOR FUTURE USE          53100021
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         53200021
         DS    CL24                                                     53300021
TIOT     DSECT                                                          53400021
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       53500021
TIOESTTA DS    CL1                           STATUS -A-                 53600021
TIOERLOC DS    CL2                           REL. LOC OF POOL           53700021
TIOEDDNM DS    2F                            DDNAME                     53800021
TIOEJFCB DS    1F                            JFCB DISK ADDR             53900021
TIOESTTB DS    0CL1                                                     54000021
TIOEFSRT DS    CL4                                                      54100021
         DS    CL1                                                      54200021
*        TIOT POOL ENTRY                                                54300021
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       54400021
         DS    CL1                                                      54500021
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      54600021
*                                             SLOTS)                    54700021
TIOPPOOL DS    CL8                           POOL NAME                  54800021
TIOPSTTB DS    XL1                           STATUS OF SLOT             54900021
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  55000021
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      55100021
TIOELINK EQU   TIOERLOC+1                                        S20016 55150021
         SPACE 1                                                        55200021
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          55300021
DEB      DSECT                                                          55400021
DEBNMSUB DS    0CL1                                                     55500021
DEBTCBAD DS    CL4                                                      55600021
DEBAMLNG DS    0CL1                                                     55700021
DEBDEBAD DS    CL4                                                      55800021
DEBOFLGS DS    0CL1                                                     55900021
DEBIRBAD DS    CL4                                                      56000021
DEBOPATB DS    0CL1                                                     56100021
DEBSYSPG DS    CL4                                                      56200021
DEBNMEXT DS    0CL1                                                     56300021
DEBUSRPG DS    CL4                                                      56400021
DEBPRIOR DS    0CL1                                                     56500021
DEBECBAD DS    CL4                                                      56600021
DEBPROTG DS    0CL1                                                     56700021
DEBDEBID DS    0CL1                                                     56800021
DEBDCBAD DS    CL4                                                      56900021
DEBEXSCL DS    0CL1                                                     57000021
DEBAPPAD DS    CL4                                                      57100021
DEBDVMOD DS    0CL1                                                     57200021
DEBUCBAD DS    CL4                                                      57300021
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     57400021
DEBBINUM DS    CL2                                                      57500021
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   57600021
DEBSTRCC DS    CL2                                                      57700021
DEBSTRHH DS    CL2                                                      57800021
DEBENDCC DS    CL2                                                      57900021
DEBENDHH DS    CL2                                                      58000021
DEBNMTRK DS    CL2                                                      58100021
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          58200021
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              58300021
DEBVOLSQ DS    H                                                        58400021
DEBVOLNM DS    H                                                        58500021
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     58600021
DEBSUBID DS    H                                                        58700021
         TITLE 'IGG0196I - FORMAT OF GOTTEN CORE'                       58800002
         IECDSECS  (MAIN,(IOB,NO)),WTG,PREFX,EXPAND=YES        @Z30TSCF 58850003
         ORG   WTGIDTTR                                          Y02072 58900002
WTGID    DS    CL2                                               Y02072 58950002
CCWOFSET EQU   DXCCW12-FORCORE     CCW RELOCATABLE OFF SET FOR DXCCW12  59100021
FORCORE  DSECT                                                   YM7829 59110002
REGSAVE0 EQU   DXCCW11                  SAVE AREA FOR REG 0      YM7829 59150002
REGSAVE1 EQU   DXCCW11+4                SAVE AREA FOR REG 1      YM7829 59200002
           END                                                          59300021
./  ADD  SSI=60920092,NAME=IGG0196K
    TITLE  'IGG0196K - OPEN EXECUTOR - STAGE 2 - UNIT RECORD'           00002021
IGG0196K CSECT                                                          00002403
*MODULE NAME - IGG0196K                                          Y02072 00004002
*                                                                       00006002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00008002
*                                                                       00010002
*COPYRIGHT - NONE                                                Y02072 00010402
*                                                                       00010802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00011202
*                                                                       00012002
*          VS 2 RELEASE 2 DELETIONS                                     00022002
*000120,000500,011400,117420,117726-117800,119620,119788-120600  Y02072 00022402
*121620,121720,129000,129800                                     Y02072 00022802
*                                                               YM02508 00023202
*                                                                YM7889 00023602
*                                                                       00023703
*          VS 2 RELEASE 3 DELETIONS                                     00023803
*                                                              @Z30TSMI 00023903
*                                                                       00025203
*          VS 2 RELEASE 4 DELETIONS                                     00025604
*                                                              @Z40MSMI 00026004
*                                                                       00026404
*          RELEASE 21 DELETIONS                                       * 00026503
*0000                                                           A45221  00027803
*0000066300                                                      M0527  00029103
*0000                                                            M0053  00030403
*D92100-92200,92600,94600                                      SA52300  00031703
*0000132400-134200                                               M0091  00033003
*D115400,115600                                                 SA53193 00034303
*                                                               SA67354 00035602
*                                                                       00045602
*STATUS CHANGE LEVEL  002                                               00050002
*                                                                       00070021
*FUNCTION/OPERATION - SETS UP CORE FOR IOB'S. (GETMAIN IN MOD IGG0191G  00090021
*                     GOT CORE - ADDR PASSED IN DCBIOBA).               00110021
*                   - BUILDS CCW'S                                      00130021
*                   - LINK'S IOB'S                                      00150021
*                   - SETS CODES IN DCBCNTRL INDICATING WHAT ROUTINES   00170021
*                     ARE TO BE LOADED BY FOLLOWING OPEN EXECUTORS.     00190021
*                                                                       00210021
*     THIS MODULE CREATED IN RELEASE 21 BY SPLIT OF IGG0191G.           00230021
*                                                                       00250021
*ENTRY POINTS: ENTERED FROM IGG0191G                                    00270004
*                                                                       00290021
*                                                                       00320021
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00340021
*                                                                       00360021
*OUTPUT: SEE DESCRIPTION OF REGISTERS, IOB(USERS), DCB(USERS).          00380021
*                                                                       00400021
*EXTERNAL ROUTINES: IFG019RA.                                           00420004
*                                                                       00440021
*EXITS: NORMAL: IGG01910, IGG01915 TO LOAD                              00450004
*                 ACCESS METHOD ROUTINES                                00460021
*     : ABNORMAL: NONE                                                  00470021
*                                                                       00500021
*MACROS : ACTION : MODESET, IECRES                                      00510004
*                                                                       00520021
*TABLES/WORKAREAS-  SEE DSECTS AT END OF LISTING                        00540004
*                                                                       00560021
*                                                                       01120021
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY           01140004
*            UNLESS OTHERWISE SPECIFIED, SUPERVISOR STATE               01150004
*                                                                       01160021
*NOTES: THIS MODULE DEALS ONLY WITH UNIT RECORD                         01170021
*       USES CONTENTS OF HIGH ORDER BYTE OF DCBIOBA FIELD (NUMBER       01180021
*       OF IOB'S) STORED BY IGG0191G.                                   01190021
*                                                                       01200021
*                                                                       01240021
*********************************************************************** 01260021
*                                                                       01280021
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01300021
*                                                                       01320021
*********************************************************************** 01340021
*                                                                       01360021
RDCB     EQU   2         DCB REGISTER                                   01380021
RBASE    EQU   3         BASE REGISTER                                  01400021
RCORE    EQU   4         WORK AREA ADDRESS                              01420021
RPAR     EQU   5         TOP OF PARAMETER LIST                          01440021
RWTG     EQU   6         TOP OF WTG TABLE                               01460021
RPARC    EQU   7         CURRENT PARAMETER                              01480021
RWTGC    EQU   8         CURRENT TRANS LOAD                             01500021
RWK1     EQU   9         WORK REGISTER                           Y02072 01510002
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01540021
RB       EQU   12        WORK REG1  **                                  01580021
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01600021
RD       EQU   14        WORK REG3  **                                  01620021
RE       EQU   0         WORK REG5                                      01660021
*                                                                       01700021
*                                                                       01720021
*********************************************************************** 01780021
*                                                                       01840021
* MASKS FOR DEVICES TO BE SUPPORTED                                     01860021
*                                                                       01880021
PRINTER  EQU   X'48'                                                    01980021
*                                                                       02000004
*********************************************************************   02020004
*                                                                       02040004
*          CCW COMMAND CODES                                            02060004
*                                                                       02080004
PRTSPC1  EQU   X'09'                    PRINT AND SINGLE SPACE          02100004
STK2     EQU   X'40'                    STACKER 2 MODIFIER              02120004
COLBIN   EQU   X'20'                    COLUMN BINARY MODIFIER          02140004
EJCT     EQU   X'80'                    EJECT MODIFIER                  02160004
NOFD     EQU   X'C0'                    NO FEED MODIFIER                02180004
WRITE    EQU   X'01'                    WRITE COMMAND                   02360004
READ     EQU   X'02'                    READ COMMAND                    02380004
NOP      EQU   X'03'                    NOP COMMAND                     02440004
SCAN     EQU   X'73'                    SCAN CMD FOR 3886       XL03127 02450002
*                                                                       02480021
*******************************************************************     04730002
*   GENERAL EQUATES                                                     04732002
*                                                                       04734002
OCRDATA  EQU   150                      150 BYTE CNT FOR READ   XL03127 04736002
ECBNORM  EQU   X'7F'                    NORMAL POST CODE                04737004
CCWCNT02 EQU   2                        FOR 3886 SCAN CMD       XL03127 04739204
CHPGMLEN EQU   3                        NO. OF DW'S IN CHAN PGM XL03127 04739602
*********************************************************************   04740021
         EJECT                                                          04742002
*                                                                       04762021
*                                                                       04776021
*                                                                       04778021
*                                                                       04800021
         BALR  RBASE,0                  SET BASE                   DM0I 04820004
         USING SOP5,RBASE                                               04840021
         USING WTG,RWTG                                                 04860004
         USING WTGENTRY,RWTGC                                           04880004
         USING PARML,RPARC                                              04900004
SOP5     EQU   *                                                        04940021
*                                                                       04950002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 04952002
         DC    C'IGG0196K'              MODULE NAME              Y02072 04954002
         DC    C'@Z40MSMI'              LAST SHIP CODE         @Z40MSMI 04956004
         DC    C'01/31/75'              LAST DATE MODIFIED     @Z40MSMI 04958004
BEGIN    DS    0H                                                       04958402
*                                                                       04960021
         SR    RC,RC                    FOR CLEARING BUFFER      M0527  04966021
*                                           NUMBER FROM DCBIOBA         04972021
         SR    RUCB,RUCB                INITIALIZE REGISTER             04980004
         L     RDCB,PARDCBAD            GET DCB ADDRESS                 05000004
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   05020021
         USING IHADCB,RDCB                                              05024004
         L     RCORE,WTGCORE-1          GET WRK AREA ADDRESS            05040004
         USING FORCORE,RCORE                                            05060004
         IC    RUCB,DCBIOBA             NUMBER OF IOB'S (FROM    M0527  05340021
*                                       IGG0191G )               M0527  05640021
         STC   RC,DCBIOBA               CLEAR HIGH ORDER BYTE OF M0527  05940021
*                                           DCBIOBA                     06240021
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 06290002
         L     RB,DCBIOBA               GET IOB ADDRESS                 06580021
         LR    RC,RB                    SET UP WORK REGS                06600021
         LR    RD,RB                                                    06620021
IOBLOOP  EQU   *                        START OF IOB LOOP               06622004
         USING IOBQSAMN,RD                                              07005004
         ST    RB,IOBNIOBA              LINK THIS IOB TO LAST           07020004
         LR    RD,RB                    UPDATE WORK REG                 07040021
         LA    RB,IOBNECB               POINT TO ECB                    07060004
         OI    IOBNECB,ECBNORM          SET ECB COMPLETE WITHOUT ERROR  07080004
         ST    RB,IOBECBPT              STORE ECB IN POINTER            07100004
         LA    RB,IOBEXTEN              POINT TO CHANNEL PROGRAM (CP)   07160004
         USING CCW,RB                                                   07162004
         ST    RB,IOBSTART              STORE CP ADDRESS IN IOB         07180004
         L     RWK1,DXUDCBAD            GET USER DCB ADDRESS     Y02072 07190002
         ST    RWK1,IOBDCBPT            DCB ADDR TO IOB          Y02072 07210004
         MVI   IOBINCAM+1,1             STORE INCREMENT AMOUNT          07220004
*                                                                       07240021
*                                                                       07260021
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 07262002
         LR    RC,RB                    UPDATE REG                      07280021
         TM    PAROPT,PAROUTPT          IS DCB FOR OUTPUT               09140004
         BNZ   SOP531                   YES BRANCH                      09160004
         TM    DCBMACF1,DCBMRCRL        IS CNTRL MACRO USED FOR INPUT   09180004
         BZ    SOP532                   NO BRANCH                       09200004
*                                                                       09210002
* PROVIDE AUTOMATIC UNBLOCKING FUNCTION FOR QSAM, UR, OUTPUT            09220004
*                                                                       09230002
SOP531   EQU   *                                                        09240021
         TM    DCBCIND2,DCBCNQSM        QSAM BEING USED          SM5485 09290002
         BZ    SOP531B                  NO, BRANCH AROUND        SM5485 09340002
         TM    DCBRECFM,DCBRECBR        BLOCKED RECORDS         SA67354 09350002
         BZ    SOP531B                  NO, BYPASS UNBLOCKING   SA67354 09360002
         TM    DCBCIND2,DCBCNBFP        DID OPEN BUILD BUFFERS   SM5485 09390002
         BO    SOP531B                  YES, FUNCTION ALREADY    SM5485 09440002
*                                         PROVIDED                      09440402
         TM    DCBRECFM,DCBRECU         UNDEF FORMAT            SA67354 09442002
         BNM   SOP531B                  YES, BYPASS UNBLOCKING  SA67354 09444002
         TM    DCBRECFM,DCBRECV         VARIABLE FORMAT          SM5485 09450002
         BO    SOP531A                  YES, DON'T CHANGE BLKSZ  SM5485 09470002
         MVC   DCBBLKSI,DCBLRECL        ADJ BLKSZ TO LRECL       SM5485 09472002
SOP531A  NI    DCBRECFM,X'FF'-DCBRECBR  TURN OFF BLOCKED REC BIT SM5485 09474002
         OI    DCBCIND1,DCBCNBRM        INDICATE TO CLOSE EXECS  SM5485 09478002
*                                         THAT IT MUST RESTORE   SM5485 09478402
*                                         BLK'D REC BIT          SM5485 09478802
SOP531B  EQU   *                        NO ADJUSTMENTS NECESSARY SM5485 09479202
         TM    DCBRECFM,DCBRECCA        ASA CHARACTERS USED             09480004
         BZ    NOTASA                   NO,BRANCH                       09500004
         MVI   DCBRTN4,RTN4             MOVE ID                    DM0I 09510004
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 09510402
         B     AROUND                   AROUND                     DM0I 09520021
NOTASA   MVI   DCBRTN4,RTN3             MOVE ID                    DM0I 09530004
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 09532002
AROUND   OI    IOBFLAG1,IOBCMDCH        SET CC FLAG IN IOB              09580004
*                                                                       09600021
***********         A CNTRL(NOP) CCW IS NEEDED     ***********          09620021
*                                                                       09640021
         MVI   CCWCOMCD,NOP             STORE NOP CMD BYTE              09680004
         OI    CCWFLGS,CCWCC            SET CMD CHAIN ON                09700004
         MVI   CCWBYTE+1,1              STORE COUNT OF ONE              09720004
         LA    RB,CCW+L'CCW             POINT TO NEXT CCW               09740004
*                                                                       09760021
*                                                                       09780021
         MODESET  EXTKEY=DATAMGT       BACK TO DATA MANAG KEY    Y02072 09782002
SOP532   EQU   *                                                        09800021
         MVI   DCBWCPO,IOBEXTEN-IOBQSAMN  OFFSET TO CHANNEL PROGRAM     09820004
         MVC   DCBWCPL(3),DCBWCPO                                       09840021
         MVI   DCBWCPL,X'02'            CHAN PROG IN DOUBLE WORDS       09860021
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 09862002
         MVI   IOBINCAM+1,0             CLEAR INCREMENT AMOUNT          09880004
         CLI   DCBDEVT,DCBDVCP1         IS THIS A 3525            M0053 09886004
         BE    SOP533                   YES, BRANCH               M0053 09892004
         TM    DCBDEVT,PRINTER          DCB USING PRINTER               09900021
         BO    SOP560                   YES BRANCH                      09920004
         CLI   DCBDEVT,DCBDVOR9         IS DEVICE A 3886        XL03127 09930004
         BE    SOP570                   YES,BUILD 3886 CH PGM   XL03127 09932002
*                                                                       09940021
SOP533   EQU   *                                                 M0053  09960021
         TM    DCBMODE,DCBMODEC         COLUMN BINARY USED RDR/PUN      09980004
         BZ    SOP534                   NO BRANCH                       10000004
*                                                                       10020021
         OI    CCWCOMCD,COLBIN          SET MODE2 MODIFIER IN CMD BYTE  10040004
SOP534   EQU   *                                                        10060021
         TM    PAROPT,PAROUTPT          DCB FOR OUTPUT                  10080004
         BZ    SOP535                   NO BRANCH                       10100004
*                                                                       10120021
         OI    CCWCOMCD,WRITE           SET WRT CMD BIT IN CCW          10140004
         OI    CCWFLGS,CCWSLI           SET SLI FLAG ON                 10160004
*                                                                       10180021
         CLI   DCBDEVT,DCBDVCRP         1442 USED                       10200004
         BNE   SOP537                   NO BRANCH                       10220004
*                                                                       10240021
         OI    CCWCOMCD,EJCT            SET EJECT BIT ON                10260004
         B     SOP537                   GO ON                      DM0I 10280021
*                                                                       10300021
SOP535   EQU   *                                                        10320021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10322004
         MVI   DCBRTN4,RTN2             EGP2 ID NUMBER                  10340004
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 10342002
         OI    CCWCOMCD,READ            SET RD CMD BIT IN CCW           10360004
         TM    DCBMACF1,DCBMRCRL        IS CNTRL MACRO USED             10380004
         BZ    SOP537                   NO BRANCH                       10400004
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 10402004
         MVI   DCBOFFSR,IOBEXTEN-IOBQSAMN+L'CCW SET RD CCW OFFSET       10420004
         MVI   DCBRTN1,RTN7             CARD RDR CNTRL ID               10440004
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 10442002
*                                                                       10460021
*                                                                       10480021
         CLI   DCBDEVT,DCBDVCRP         1442 USED                       10520004
         BE    SOP538                   YES BRANCH                      10540004
*                                                                       10560021
         OI    CCWCOMCD,NOFD            SET NO FEED MODIFIERS           10580004
         B     SOP538                   GO ON                      DM0I 10600021
*                                                                       10620021
SOP537   EQU   *                                                        10640021
         TM    DCBSTACK,DCBSTCK2        STACKER 2 NEEDED                10660004
         BZ    SOP538                   NO BRANCH                       10680004
*                                                                       10700021
         OI    CCWCOMCD,STK2            SET STACKER 2 MODIFIER ON       10720004
*                                                                       10740021
SOP538   EQU   *                                                        10760021
*                                                                       10780021
         OI    CCWFLGS,CCWSLI           SET SLI FLAG IN RD CCW          10800004
*                                                                       10820021
         TM    DCBCIND2,DCBCNQSM        DCB USING QSAM                  10860004
         BO    IOBEND                   YES BRANCH                      10880004
*                                                                       10900021
         TM    PAROPT,PAROUTIN          DCB FOR OUTPUT-INPUT-OUT/IN     10980004
         BNM   IOBEND                   YES BRANCH                      11000004
*                                                                       11020021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11022004
         MVC   DCBRTN3,DCBRTN4          MOVE WRT EOB RT ID OVER         11040004
         MVI   DCBRTN4,RTN2             STORE EGP2 ID IN RD EOB SLOT    11060004
         MVI   DCBOFFSR,IOBEXTEN-IOBQSAMN+2*L'CCW SET UP READ OFFSET    11060404
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 11062002
         MVC   CCWCOMCD+L'CCW,CCWCOMCD  STORE MODIFIERS                 11080004
         OI    CCWCOMCD+L'CCW,READ      SET RD BIT IN CMD BYTE          11100004
         NI    CCWCOMCD+L'CCW,X'FF'-WRITE TURN OFF WRT BIT              11120004
         OI    CCWFLGS+L'CCW,CCWSLI     SET SLI FLAG IN WRT CCW         11140004
         NI    CCWCOMCD,X'FF'-EJCT      TURN OFF EJECT BIT IN WRT CCW   11160004
         LA    RB,CCW+L'CCW             UPDATE CP BY 1 CCW              11300004
         B     IOBEND                   GO BUILD NEXT IOB               11320004
*                                                                       11400021
*                                                                       11420021
*                                                                       11422004
**********************************************************************  11424004
*                                                                       11426004
*        WHEN A 3800 PRINTER HAS OPTCD=J SPECIFIED AN EXTRA NOP MUST    11428004
*        BE BUILT.  IT IS USED TO SELECT THE TRANSLATE TABLES BY        11430004
*        THE END OF BLOCK MODULES.                                      11432004
*                                                                       11434004
SOP560   EQU   *                                                        11436004
         CLI   DCBDEVT,DCBDVPR5         IS THIS A 3800         @Z40MSMI 11438004
         BNE   SOP565                   NO - CONTINUE          @Z40MSMI 11440004
         TM    DCBOPTCD,DCBOPTJ         IS OPTCD=J SPECIFIED   @Z40MSMI 11442004
         BZ    SOP565                   NO - CONTINUE          @Z40MSMI 11444004
*        AN EXTRA NOP MUST BE BUILT                                     11446004
         MVI   CCWCOMCD,NOP             SET COMMAND CODE       @Z40MSMI 11448004
         MVI   CCWFLGS,CCWCC            TURN ON CHAIN COMMAND  @Z40MSMI 11450004
         MVI   CCWBYTE+1,1              SET COUNT TO ONE       @Z40MSMI 11452004
*        SET DCB FIELDS RELEVANT TO OPTCD=J                             11454004
         MODESET EXTKEY=DATAMGT         GET IN DM KEY          @Z40MSMI 11456004
         NI    DCBPRBYT,X'FF'-DCBTRCID  ZERO ID BYTE           @Z40MSMI 11458004
         MVI   DCBWCPL,3*L'CCW/L'CCW    LENGTH OF CP           @Z40MSMI 11460004
         MVI   DCBOFFSW,IOBEXTEN-IOBQSAMN         OFFSET TO CP @Z40MSMI 11462004
         MODESET KEYADDR=DXUKEY,WORKREG=9 BACK TO CALLER KEY   @Z40MSMI 11464004
         LA    RB,CCW+L'CCW             UPDATE POINTER         @Z40MSMI 11466004
SOP565   EQU   *                                               @Z40MSMI 11468004
         MVC   CCWCOMCD,DCBPRTSP        STORE PRINTER MODIFIERS         11500004
         TM    DCBRECFM,DCBRECCA        ASA CHARACTERS USED             11520004
         BZ    AA                       BRANCH IF NO            SA53193 11540021
*                                                                       11542021
*              FOR A 2245, USE THE '09' CMD, NOT THE '01'       SA53193 11544021
*                                                                       11546021
         CLI   DCBDEVT,DCBDVPR4         DEVICE A 2245?          SA53193 11550004
         BE    AA1                      YES, GO USE 09 CMD      SA53193 11552021
         MVI   CCWCOMCD,WRITE           ASSUME SUPPRESSION AFTER PRINT  11560004
AA       EQU   *                        COME HERE                  DM0I 11570021
         CLI   CCWCOMCD,0               HAVE THEY BEEN SPECIFIED        11580004
         BNE   AB                       YES,BRANCH                 DM0I 11600021
AA1      EQU   *                                                SA53193 11610021
         MVI   CCWCOMCD,PRTSPC1         ASSUME 1 SPACE AFTER PRINT      11620004
AB       EQU   *                        COME HERE                  DM0I 11630021
         OI    CCWFLGS,CCWSLI           SET SLI FLAG IN CCW             11640004
         TM    DCBMACF2,DCBMRCTL        PRINTER CNTRL NEEDED            11660004
         BZ    AC                       NO,BRANCH                  DM0I 11680021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11682004
         MVI   DCBRTN1,RTN8             CNTRL ID NUMBER                 11700004
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 11700402
AC       EQU   *                        COME HERE                  DM0I 11710021
         B     IOBEND                   BACK                       DM0I 11720004
*                                                                       11740021
SOP570   EQU   *              BUILD CH PGM FOR OCR 3886         XL03127 11750002
*                             (NOP,SCAN,READ);IOB/BUFR CONTIG.  XL03127 11752002
         L     RC,DXUDCBAD              ADDR OF USER'S DCB      YM02508 11752102
         LA    RC,DCBLNNUM-IHADCB(,RC)  ADDR OF LINE NO. IN DCB YM02508 11752402
         ST    RC,CCWADDRA              STORE INTO SCAN CMD     XL03127 11752802
         MVI   CCWCOMCD,SCAN            SCAN CMD OP             XL03127 11754002
         OI    CCWFLGS,CCWCC            CMD CHAIN               XL03127 11756002
         MVI   CCWBYTE+1,CCWCNT02       2 BYTE COUNT            XL03127 11758004
*                                                               XL03127 11758402
         LA    RB,CCW+L'CCW             POINT TO NEXT CCW       XL03127 11758804
         LA    RC,CCW+L'CCW             PT TO CONTIG BUFR       XL03127 11759204
         ST    RC,CCWADDRA              BUFR ADDR INTO READ CCW XL03127 11759602
         MVI   CCWCOMCD,READ            READ CMD OP             XL03127 11759702
         OI    CCWFLGS,CCWSLI           FLAGS                   XL03127 11759802
         MVI   CCWBYTE+1,OCRDATA        BYTE COUNT 150          XL03127 11759904
*                                                                       11766602
         LA    RB,OCRDATA+2(RB)         ADD BUFR LEN TO PTR     XL03127 11768602
IOBEND   EQU   *                        END OF IOB LOOP                 11768704
         LA    RB,CCW+L'CCW             ADDRESS OF NEXT IOB             11769004
         BCT   RUCB,IOBLOOP             GO BUILD MORE IOBS IF NEEDED    11769404
         DROP  RB                                                       11769804
         L     RB,DCBIOBA               GET FIRST IOB ADDR              11770604
         ST    RB,IOBNIOBA              LINK FIRST IOB TO LAST          11772604
         DROP  RD                                                       11774604
         USING IOBQSAMN,RB                                              11776604
         OI    IOBNFLG1,IOBFIRST        SET INDICATOR                   11778604
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11780604
         TM    JFCBTSDM,JFCSDS          SYSIN OR SYSOUT                 11782604
         BZ    SOP5190                  NO BRANCH                Y02072 11784604
         CLI   DCBRTN1,RTN9             CONTROL SPECIFIED               11786604
         BNE   SOP5190                  NO BRANCH                Y02072 11788604
*                                                                       11790604
         MVI   DCBRTN2,RTN10            STORE DUMMY ID                  11792604
SOP5190  EQU   *                        SET UP NEXT EXEC ID    @Z30TSMI 11960003
         CLI   DCBDEVT,DCBDVOR9         IS DEVICE A 3886        XL03127 11970004
         BNE   NEXT                     NO, BRANCH AROUND       XL03127 11972002
         MVI   DCBRTN1,RTN25            YES,SET CNTRL RTNE INDX XL03127 11974004
         MVI   DCBRTN4,RTN2             SET EOB RTNE INDX       XL03127 11976004
         MVI   DCBWCPL,CHPGMLEN         CH PGM LEN IN DW'S      XL03127 11978002
         MVI   DCBOFFSR,IOBEXTEN-IOBQSAMN+2*L'CCW OFF TO RD CCW XL03127 11978404
NEXT     MVC   WTGIDTTR,SOPSLDFT        XCTL TO LAOD 1910      @Z30TSMI 12028403
         TM    DCBRECFM,DCBRECF         FIX FORMAT                 DM0I 12164004
         BO    RELOOP                   YES, BRANCH                DM0I 12166004
         TM    DCBRECFM,DCBRECV+DCBRECD V OR D FORMAT RECORDS    S20038 12168004
         BZ    RELOOP                   NO, BRANCH                 DM0I 12170004
         MVC   WTGIDTTR,SOPSLDVT        XCTL TO LAOD 1915      @Z30TSMI 12170404
RELOOP   LA    RWTGC,WTGEND             INCREMENT CURR WTG ENTRY        12520004
         LA    RPARC,L'PARDCBAD(0,RPARC) INCR CURRENT DCB ENTRY PRTR    12540004
         CLC   WTGID,AMIDCNST           THIS RT NEEDED AGAIN            12560004
         BER   RBASE                    BACK TO OPEN CONTROL ROUTINDM0I 12580004
*                                                                       12600021
         CLC   WTGID,OPIDCNST           END OF TABLE                    12620004
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             12640004
*                                                                       12660021
         LR    RPARC,RPAR                                               12680021
         DROP  RWTGC                                                    12685004
         LA    RWTGC,WTGENTRY           REINITIALIZE WTG LIST PTR       12700004
         USING WTGENTRY,RWTGC                                           12705004
ZCHEK    CLI   WTGENTRY,0               ENTRY COMPLETE             DM0I 12720004
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         12740004
*                                                                       12760021
         LA    RWTGC,WTGEND             GET NEXT ENTRY                  12780004
         LA    RPARC,L'PARDCBAD(0,RPARC) GET NEXT PARM                  12800004
         B     ZCHEK                    ZERO CHECK                 DM0I 12820021
*                                                                       12840021
TCTLRTN  EQU   *                                                        12860021
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*12930003
               MODID=WTGENTRY           GO TO NEXT ROUTINE     @Z30TSMI 12980003
**                                                                      13000021
*                                                                       13020021
*********************************************************************   13040021
*                                                                       13060021
OPIDCNST DC    C'0S'                    ID                         DM0I 13140021
AMIDCNST DC    C'6K'                   THIS MODULE                      13160021
SOPSLDFT DC    C'10',VL3(IGG01910)      FOR FIXED FORMAT       @Z30TSMI 13210003
SOPSLDVT DC    C'15',VL3(IGG01915)      FOR VARIABLE FORMAT    @Z30TSMI 13260003
PATCH    DC    25H'0'                   PATCH AREA               Y02072 13360002
END      EQU   *                        END OF MODULE            Y02072 13410002
         EJECT                                                          13415004
CVT      DSECT                                                          13420003
         CVT                                                            13430003
         EJECT                                                          13435004
         DCBD    DSORG=PS                                               13440003
*                                                                       13441004
*        THIS TABLE IS USED IN STAGE 3 EXECUTORS TO LOAD FRONT END      13442004
*        ROUTINES.  THEY MUST CORRESPOND TO OFFSETS IN THE ACTUAL       13443004
*        TABLE ASSEMBLED INTO TO THE STAGE 3 EXECUTORS.                 13444004
*                                                                       13444204
         ORG   DCBCNTRL                                                 13445004
DCBRTN1  DS    X                        ROUTINE 1 AREA                  13450004
DCBRTN2  DS    X                        ROUTINE 2 AREA                  13455004
DCBRTN3  DS    X                        ROUTINE 3 AREA                  13460004
DCBRTN4  DS    X                        ROUTINE 4 AREA                  13465004
RTN1     EQU   1                        ROUTINE 1 ID                    13470004
RTN2     EQU   2                        ROUTINE 2 ID                    13475004
RTN3     EQU   3                        ROUTINE 3 ID                    13480004
RTN4     EQU   4                        ROUTINE 4 ID                    13485004
RTN5     EQU   5                        ROUTINE 5 ID                    13490004
RTN6     EQU   6                        ROUTINE 6 ID                    13495004
RTN7     EQU   7                        ROUTINE 7 ID                    13500004
RTN8     EQU   8                        ROUTINE 8 ID                    13505004
RTN9     EQU   9                        ROUTINE 9 ID                    13510004
RTN10    EQU   10                       ROUTINE 10 ID                   13515004
RTN25    EQU   25                       ROUTINE 25 ID                   13515404
DCBDVPR4 EQU   X'4B'                    2245 DEVICE TYPE IN DCBDEVT     13516604
         EJECT                                                          13520004
         IECDSECS  (MAIN,(IOB=NO)),IOB,WTG,PREFX,EXPAND=YES             13530004
         ORG   WTGIDTTR                                          Y02072 13540002
WTGID    DS    CL2                      ID OF NEXT MOD           Y02072 13550002
         EJECT                                                          13560002
         IHACCW                                                         13570002
         EJECT                                                          13575004
         IGGPARML                                                       13576004
         END                                                            13580002
./  ADD  SSI=43090056,NAME=IGG0196L
  TITLE  'IGG0196L - OPEN EXECUTOR - STAGE 2 - FINISH IOB''S FROM 191J' 00025021
IGG0196L CSECT                                                          00025103
*MODULE NAME - IGG0196L                                          Y02072 00025402
*                                                                       00025802
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00026202
*                                                                       00026602
*COPYRIGHT - NONE                                                Y02072 00026702
*                                                                       00026802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00026902
*                                                                       00029802
*          VS2 RELEASE 2 DELETIONS                               Y02072 00032902
*050430,050490,050550,050820-050940,078880,058600,059000,062800, Y02072 00035802
*063800                                                          Y02072 00037802
*D51150-51364                                                    YA3136 00038202
*                                                                       00038603
*          VS2 RELEASE 3 DELETIONS                                      00042003
*                                                              @Z30TSCF 00044003
*          RELEASE 21 DELETIONS                                       * 00045403
*0000058400                                                      M0466  00048803
*0000084800-085800                                               M0091  00052203
*                                                                       00055603
*   STATUS CHANGE LEVEL 001                                             00059002
*                                                                       00079021
*  THIS MODULE CREATED IN RELEASE 21 BY SPLIT OF IGG0191J               00099021
*                                                                       00119021
*FUNCTION/OPERATION: THIS ROUTINE CONTINUES CONSTRUCTING THE IOB'S      00139021
*      'GETMAINED' IN IGG0191J.                                         00159021
*                                                                       00179021
*ENTRY POINTS: ENTERED FROM IGG0191J BY USE OF XCTL MACRO.              00199021
*                                                                       00260021
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00280021
*                                                                       00300021
*OUTPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS), IOB(USERS).          00320021
*                                                                       00340021
*EXTERNAL ROUTINES : NONE                                               00360021
*                                                                       00380021
*EXITS-NORMAL: XCTL TO IGG01910 OR IGG01915 TO LOAD ROUTINES            00400021
*                                                                       00420021
*EXITS-ERROR: NONE                                                      00440021
*                                                                       00450002
*MACROS : ACTION - MODESET, XCTL, XCTLTABL                       Y02072 00452002
*                                                                       00460021
*TABLES/WORKAREAS: DUPE WTG TABLE************************************** 00480021
*      SEE DEVICETB DSECT.                                              00500021
*                                                                       00520021
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN USER KEY UNLESS        Y02072 00540002
*            OTHERWISE SPECIFIED, SUPER STATE                    Y02072 00550002
*                                                                       00560021
* NOTES- THIS EXECUTOR DEALS WITH DIRECT ACCESS FOR IN/OUT - OUT/IN.    00580021
*                                                                       00600021
         SPACE 1                                                        00620021
*                                                                       00640021
*                                                                     * 00660021
*    2841  OP  CODES                                                  * 00680021
*                                                                     * 00700021
WRCNKEDA EQU   X'1D'                   WRITE COUNT KEY AND DATA         00720021
TIC      EQU   X'08'          TIC OP CODE                               00740021
WRTCK    EQU   X'80'                                                    00760021
SRCHE    EQU   X'31'          SEARCH OP CODE                            00780021
READKEDA EQU   X'8E'                    READ KEY AND DATA OP CODE       00840021
RDCOUNT  EQU   X'92'                    READ COUNT CMND CODE     Y02072 00860002
SETSC    EQU   X'23'                    SET SECTOR COMMAND       S20201 00885021
RDSC     EQU   X'22'                    READ SECTOR COMMAND      S20201 00890021
*                                                                     * 00900021
*********************************************************************** 00920021
*                                                                     * 00940021
*    CCW  CONSTRUCTION  EQUATES                                       * 00960021
*                                                                     * 00980021
DATASILI EQU   X'A0'                   DATA CHAIN AND SILI FLAG         01000021
SILI     EQU   X'20'                   SILI FLAG                        01020021
COMSILI  EQU   X'60'         COMMAND AND SILI                           01060021
COMCHAIN EQU   X'40'          COMMAND CHAIN BIT                         01120021
DATACHAN EQU   X'80'          DATA  CHAIN  BIT                          01140021
SKIPSILI EQU   X'30'                   SKIP AND SILI                    01160021
SECNDTIC EQU   0                        OFFSET TO SECOND TIC CCW Y02072 01162002
ONE      EQU   1                                                        01180021
FIVE     EQU   5                                                        01220021
RDKDCCW  EQU   8                        OFFSET TO READ DATA CCW  Y02072 01222002
ATE8     EQU   8                                                        01260021
RDCNTCCW EQU   16                       OFFSET TO READ COUNT CCW Y02072 01262002
CNTFLD2  EQU   32                       OFFSET TO SECOND COUNT   Y02072 01264002
*                                       FIELD FOR SEARCH DIRECT  Y02072 01266002
CC       EQU   X'40'                    COMMAND CHAIN            S20201 01280021
*********************************************************************** 01300021
*                                                                     * 01320021
*    MISC  EQUATES                                                    * 01340021
*                                                                     * 01360021
FORMATV  EQU   X'40'                    FIXED RECORD FORMAT        DM0I 01420021
FIRSTIOB EQU   1                                                        01560021
NONCARN  EQU   X'20'                    NO DISCONNECT USED       S20201 01612021
SDOPT    EQU   X'08'                    SEARCH DIRECT OPTION     S20201 01614021
*                                       BYTE                     S20201 01616021
SDTIC    EQU   X'40'                    SEARCH DIR TIC PREFIX    S20201 01618021
RPSOFSET EQU   6                       OFFSET IN JFCB FOR RPS BIT       01618221
RPSTIC   EQU   8                       TO BE ADDED TO IOB POINTER FOR   01618421
*                                         RPS DEVICES BECAUSE OF X'23'  01618621
*                                         OP CODE                       01618821
NTRPSTIC EQU   X'58'                   OFF SET TO NON-RPS TIC           01619021
UNRELFLG EQU   X'02'                                                    01619221
*********************************************************************** 01620021
*                                                                       01621021
* DISPLACEMENTS AS EQUATES                                              01622021
*                                                                       01623021
D0       EQU   0                        DISPLACEMENT OF ZERO     S20201 01624021
D1       EQU   1                        DISPLACEMENT OF ONE      S20201 01625021
D4       EQU   4                        DISPLACEMENT OF FULLWORD S20201 01628021
D5       EQU   5                        DISPLACEMENT OF FIVE     S20201 01629021
D6       EQU   6                        DISPLACEMENT OF SIX      S20201 01630021
D7       EQU   7                        DISPLACEMENT OF SEVEN    S20201 01631021
D8       EQU   8                        DISPLACEMENT OF DW       S20201 01632021
D12      EQU   12                       DISPLACEMENT OF THREE    S20201 01633021
*                                       WORDS                    S20201 01634021
D16      EQU   16                       DISPLACEMENT OF 16       S20201 01636021
D23      EQU   23                       DISPLACEMENT OF 23       S20201 01637021
D24      EQU   24                       DISPLACEMENT OF SIX      S20201 01638021
*                                       WORDS                    S20201 01639021
D43      EQU   43                       DISPLACEMENT OF CCHHR    S20201 01642021
*                                       IOB                      S20201 01643021
FLAGOFF  EQU   4                        CCW FLAG OFFSET          S20201 01645021
CNTOFF   EQU   7                        CCW COUNT OFFSET         S20201 01646021
*********************************************************************** 01660021
*********************************************************************** 01680021
*                                                                       01700021
*                                                                       01750021
* REGISTER CONVENTIONS USED THROUGHOUT ALL OPEN PASSES                  01800021
*                                                                       01850021
*                                                                       01900021
*********************************************************************** 01920021
*                                                                       01940021
RE       EQU   0                                                        01960021
RF       EQU   1                        WORK REG ONE             S20201 01963021
RDCB     EQU   2                        DCB REGISTER             S20201 01966021
RBASE    EQU   3                        BASE REGISTER            S20201 01969021
RCORE    EQU   4                        WORK AREA ADDR           S20201 01972021
RWTG     EQU   6                                                        01980021
RPARC    EQU   7                        CURRENT PARAMETER        S20201 01990021
*                                                                       02000021
RWTGC    EQU   8                                                        02020021
RUCB     EQU   10                       ADDRESS OF UCB           S20201 02100021
RDEB     EQU   11                       ADDRESS OF DEB           S20201 02140021
RB       EQU   12 2                                                     02180021
RC       EQU   13 3                                                     02200021
RD       EQU   14 4                                                     02220021
RJ       EQU   15 5                                                     02240021
*                                                                       02260021
*                                                                       02280021
*********************************************************************** 02300021
*                                                                       02320021
*********************************************************************** 02340021
*                                                                       02360021
*                                                                       02380021
         USING SOP810,RBASE                                      S20201 02410021
         USING IHADCB,RDCB              REG 2 IS DCB             S20201 02420021
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR  S20201 02430021
         BALR  RBASE,RE                 REG 3 IS BASE   RE=0     S20201 02440021
*                                                                       02450021
SOP810   EQU   *                                                 S20201 02460021
*                                                                       02462002
         B     BEGIN                                             Y02072 02464002
         DC    C'IGG0196L'              MOD NAME                 Y02072 02466002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 02468003
         DC    C'10/22/74'              LAST DATE MODIFIED     @Z30TSCF 02468403
BEGIN    DS    0H                                                       02468802
*                                                                       02470021
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 02472002
         L     RDCB,D0(RPARC)           GET DCB ADDR             S20201 02480021
         LA    RDCB,D0(RDCB)            CLEAR HI BYTE            S20201 02490021
         L     RCORE,D4(RWTGC)          GET WORK AREA ADDR       S20201 02500021
*                                                                       02560021
         SR    RUCB,RUCB                CLEAR REG                S20201 03330021
         IC    RUCB,DCBNCP              GET NO. OF CHPS          S20201 03340021
         LTR   RUCB,RUCB                BEEN SPECIFIED           S20201 03350021
         BNZ   SOP817                   BRANCH IF SPECIFIED      S20201 03360021
         LA    RUCB,ONE                 FURNISH ONE IF NOT       S20201 03370021
SOP817   EQU   *                                                 S20201 03380021
         SR    RE,RE                   GET IOB LENGTH  --  STORED BY    03460021
         IC    RE,DCBIOBL                  IGG0191J                     03540021
         SLL   RE,3(0)                 IOB LNG IN BYTES                 03620021
         LA    RDEB,ATE8               CONSTANT OF EIGHT                03700021
*   THE ADDRESS OF THE FIRST IOB IS IN THE DCBIOBA FIELD.  IT WAS       03780021
*   STORED THERE AFTER GETMAIN IN IGG0191J.                             03860021
         L     RB,DCBIOBA              ADDR OF FIRST IOB                03940021
SOP829   EQU   *                                                        04020021
         LR    RF,RB                   SAVE IOB ADDR                    04100021
*    MUST ADD TO FIRST IOB ADDRESS TO POSITION AT FIRST TIC CCW --      04180021
*    THIS IS WHERE WE WERE IN IGG0191J --                               04260021
*       X'60' FOR RPS DEVICES  (3330,  2305)  --                        04340021
*       X'58' FOR NON RPS DEVICES --                                    04420021
         LA    RB,NTRPSTIC(RB)         GET TO FIRST TIC                 04500021
         TM    JFCBMASK+RPSOFSET,NONCARN   DEVICE NOT RPS?              04580021
         BO    NONRPS                  YES, NOT RPS DEVICE              04660021
         LA    RB,RPSTIC(RB)            NO, RPS DEVICE USE X'60'        04740021
NONRPS   EQU   *                                                        04820021
         TM    JFCBMASK+D6,SDOPT        SEARCH DIRECT SPECIFIED  S20201 05022021
         BZ    SOP833A                  BRANCH IF NO             S20201 05025021
*                                       SD                       S20201 05028021
         SH    RB,CON32                 BACK UP TO FIRST TIC     S20201 05031021
         OI    D0(RB),SDTIC             INDICATE A SCH DIR C. P. S20201 05034021
         AR    RB,RDEB                  INCREMENT                S20201 05037021
         LA    RC,RDKDCCW(,RB)          POINT TO READ DATA CCW   Y02072 05040002
         ST    RC,SECNDTIC(,RB)         SET UP TIC ADDRESS       Y02072 05046002
         MVI   SECNDTIC(RB),TIC         MOVE IN TIC COMMAND      Y02072 05052002
         LA    RC,CNTFLD2(,RB)          PT TO SECOND COUNT FIELD Y02072 05052502
         TM    JFCBMASK+6,JFCNRPS       IF RPS IS NOT SPECIFIED  Y02072 05052902
         BO    NOTRPS                   THEN DON'T INCREMENT     Y02072 05053302
         AR    RC,RDEB                  ELSE INCR BEYOND THE RD  Y02072 05053702
*                                       SECTOR CCW               Y02072 05054102
NOTRPS   EQU   *                                                 Y02072 05054502
         C     RF,DCBIOBA               IS THIS THE FIRST IOB    Y02072 05054902
         BNE   NOTFIRST                 BRANCH IF NOT            Y02072 05055302
         ST    RC,SECNDTIC(,RB)         SET UP RD CNT DATA ADDR  Y02072 05055702
         MVI   SECNDTIC(RB),RDCOUNT     MOVE IN READ COUNT CMND  Y02072 05056102
*                                                                       05056502
NOTFIRST EQU   *                                                 Y02072 05056902
         MVI   D4(RB),COMSILI           SILI AND CMND CHAIN      S20201 05058021
         MVI   D7(RB),ATE8              BYTE CNT EQS EIGHT       S20201 05064021
*                                       SD                       S20201 05067021
         MVC   D8(ATE8,RB),D16(RB)      MOVE UP RD DATA CCW      S20201 05070021
*                                       SD                       S20201 05073021
         OI    D12(RB),COMSILI          SET COMMAND CHAINING     S20201 05076021
*                                       &SLI                     S20201 05079021
         SR    RC,RDEB                  PT TO FIRST COUNT FIELD  Y02072 05089002
         ST    RC,D16(RB)               PUT IN CCW ADDR          S20201 05097021
*                                       SD                       S20201 05100021
         MVI   RDCNTCCW(RB),RDCOUNT     PUT IN MT RD CNT CMND    Y02072 05103002
         MVI   D23(RB),ATE8             SET BYTE CNT TO EIGHT    S20201 05109021
*                                       SD                       S20201 05112021
         AH    RB,CON24                 RESTORE POINTER          S20201 05139021
SOP833A  EQU   *                                                 S20201 05142021
*                                       SD                       S20201 05145021
*                                                                       05148021
* UPON RETURN CHECK FOR DISCONNECT FEATURE                              05151021
*                                                                       05154021
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 05157021
*                                       DISCONNECT               S20201 05160021
         BO    SOP835                   BRANCH IF YES            S20201 05163021
         BAL   RD,SOP8RTA               OTHERWISE GO BUILD RD    S20201 05166021
*                                       THETA                    S20201 05169021
         AR    RB,RDEB                  INCREMENT POINTER        S20201 05172021
SOP835   EQU   *                                                 S20201 05175021
*                                                                       05178021
* SET UP FOR WRITE CHP                                                  05181021
*                                                                       05184021
         TM    JFCBMASK+D6,SDOPT        FOR SEARCH DIRECT, IT IS S20201 05187021
         BNO   SOP835A                  IS NECESSARY TO HAVE TWO S20201 05190021
         AR    RB,RDEB                  DOUBLEWORDS BETWEEN THE  S20201 05193021
         AR    RB,RDEB                  INPUT C.P. AND THE       S20201 05196021
*                                       OUTPUT                   S20201 05199021
*                                        CHANNEL PROGRAM                05202021
SOP835A  EQU   *                                                 S20201 05205021
         SR    RB,RF                    GET WRITE CHP OFFSET     S20201 05208021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05208402
         STC   RB,DCBWCPO               PUT IN DCB               S20201 05211021
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 05211402
         AR    RB,RF                    RESTORE PTR              S20201 05214021
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O RCD      S20201 05217021
*                                       READY                    S20201 05220021
         BO    SOP836                   BRANCH IF YES            S20201 05223021
         BAL   RD,SOP8STA               GO BUILD SET SECTOR CCW  S20201 05226021
SOP836   EQU   *                                                 S20201 05229021
         LA    RC,D43(RF)               PT TO CCHHR FIELD        S20201 05232021
         BAL   RD,SOP8SRTC              GO BUILD SEARCH AND TIC  S20201 05235021
*                                                                       05238021
* UPON RETURN INCREMENT PTR, OBTAIN WRITE CCW OFFSET                    05241021
*                                                                       05244021
         AR    RB,RDEB                  INCREMENT PTR            S20201 05247021
         AR    RB,RDEB                                           S20201 05250021
*                                                                       05253021
* CONSTRUCT REMAINING WRITE CHANNEL PROGRAM                             05256021
*                                                                       05259021
         LR    RC,RF                    GET IOB PTR              S20201 05262021
         AR    RC,RE                    INCREMENT TO NEXT IOB    S20201 05265021
*                                       DM                       S20201 05268021
         SR    RC,RDEB                  BACK UP ONE DW           S20201 05271021
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 05274021
*                                       DISCONNECT               S20201 05277021
         BO    SOP837                   BRANCH IF YES            S20201 05280021
         SR    RC,RDEB                  BACK UP POINTER ONE MORE S20201 05283021
*                                       DW                       S20201 05286021
SOP837   EQU   *                                                 S20201 05289021
         MVI   CNTOFF(RB),ATE8          SET BYTE CNT TO 8        S20201 05292021
         OI    FLAGOFF(RB),DATASILI     DATA CHAIN AND SILI      S20201 05295021
         ST    RC,D0(RB)                PUT IN ADDR              S20201 05298021
         MVI   D0(RB),WRCNKEDA          WRITE CNT, KEY, DATA     S20201 05301021
*                                       CMND                     S20201 05304021
         AR    RB,RDEB                  INCREMENT POINTER        S20201 05307021
         SR    RB,RF                    OBTAIN WRITE CCW OFF SET S20201 05310021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05310402
         STC   RB,DCBOFFSW              PUT IN DCB               S20201 05313021
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 05313402
         AR    RB,RF                    RESTORE PTR              S20201 05316021
         OI    FLAGOFF(RB),SILI         SET SILI FLAG            S20201 05319021
         AR    RB,RDEB                  INCREMENT POINTER        S20201 05322021
*                                                                       05328021
* CHECK FOR WRITE CHK SPECIFIED AND BUILD COMMAND                       05331021
*                                                                       05334021
         TM    DCBOPTCD,WRTCK           WRITE CHK USED           S20201 05337021
         BNO   SOP874                   IF NOT BRANCH            S20201 05340021
         SR    RB,RDEB                  BACK UP PTR TO PRE CCW   S20201 05343021
         OI    FLAGOFF(RB),CC           CMND CHAIN               S20201 05346021
         AR    RB,RDEB                  RESTORE PTR              S20201 05349021
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O          S20201 05352021
*                                       DISCONNECT               S20201 05355021
         BO    SOP851                   BRANCH IF YES            S20201 05358021
         BAL   RD,SOP8RTA               GO BUILD READ SECTOR     S20201 05361021
         OI    FLAGOFF(RB),CC           COMMAND CHAIN CCW        S20201 05364021
         AR    RB,RDEB                  INCR POINTER             S20201 05367021
         BAL   RD,SOP8STA               OTHERWISE GO BUILD SET   S20201 05370021
*                                       THET                     S20201 05373021
*                                                                       05376021
* MUST OBTAIN SEARCH ADDR FOR SEARCH SUBROUTINE                         05379021
*                                                                       05382021
         LR    RC,RF                    GET ICB POINTER          S20201 05385021
         AR    RC,RE                    POINT TO NEXT IOB        S20201 05388021
         SR    RC,RDEB                  BACKUP A DW              S20201 05391021
         SR    RC,RDEB                  SINCE RCD READY ONE MORE S20201 05394021
*                                       DW                       S20201 05397021
SOP851   EQU   *                                                 S20201 05400021
*                                                                       05403021
* GO BUILD  SEARCH AND TIC COMMAND FOR WRT CHK                          05406021
*                                                                       05409021
         BAL   RD,SOP8SRTC              CONSTRUCT SEARCH AND TIC        05440021
         MVI   16(RB),READKEDA          READ KEY AND DATA CCW           05460021
         MVI   20(RB),SKIPSILI          SKIP AND SILI                   05480021
         LA    RB,24(0,RB)              POINT TO NEXT CCW               05500021
*******                                                                 05520021
         B     SOP877                   GO FINISH IO             S20201 05526021
SOP874   EQU   *                                                 S20201 05532021
*                                                                       05538021
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O RCD      S20201 05544021
*                                       READY                    S20201 05550021
         BO    SOP877                   BRANCH IF YES            S20201 05556021
         BAL   RD,SOP8RTA               GO BUILD READ SECTOR     S20201 05562021
         AR    RB,RDEB                  INCR PTR                 S20201 05568021
*                                                                       05574021
SOP877   EQU   *                                                 S20201 05580021
         MVC   D5(D1,RB),DCBKEYL        MOVE KEY LEN TO          S20201 05586021
*                                       CCHHRDDLL                S20201 05592021
*                                                                       05600021
*   HAVE ALL IOBS BEEN CONSTRUCTED                                      05620021
*                                                                       05640021
         AR    RB,RDEB                  INCR PTR FOR SRCH ARGU   S20201 05650021
         TM    JFCBMASK+D6,NONCARN      ANY DEVICES W/O RCD      S20201 05655021
*                                       READY                    S20201 05660021
         BO    SOP888                   BRANCH IF YES            S20201 05665021
         AR    RB,RDEB                  INCR PTR FOR ADD SRCH    S20201 05670021
*                                       ARGU                     S20201 05675021
SOP888   EQU   *                                                 S20201 05680021
         BCT   RUCB,SOP829              IF ALL IOBS NOT FINISHED S20201 05685021
*                                       BR                       S20201 05690021
         L     RC,DCBIOBA               IF FINISHED GET PTR TO   S20201 05695021
*                                       FRST                     S20201 05700021
         ST    RC,D0(RF)                LINK LAST TO FIRST       S20201 05705021
*                                                                       05720021
         L     RB,DCBIOBA               GET IOB ADDRESS                 05740021
         OI    0(RB),FIRSTIOB           TURN ON FIRST IOB BIT           05760021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05762002
         TM    DCBRECFM,FORMATV         FIXED RECORD FORMAT        DM0I 05780021
         BC    8,SOP8ENDD               BRANCH, IF FIXED FORMAT    DM0I 05800021
         TM    DCBRECFM,DATACHAN        UNDEFINED RECORD FORMAT    DM0I 05820021
         BO    SOP8ENDD                 BRANCH IF UNDEFINED      M0466  05840021
         USING WTGENTRY,RWTGC                                    Y02072 05850002
         MVC   WTGIDTTR,SOPSLDVT        VAR, GET 1915          @Z30TSCF 05852003
         B     NEXT                     BACK TO LOADING            DM0I 05880021
SOP8ENDD MVC   WTGIDTTR,SOPSLDA         GET SLDA               @Z30TSCF 05890003
NEXT     EQU   *                        VARIABLE FORMAT, COME TO HEDM0I 05910021
         LR    RSTART,RBASE             RESTORE BASE REG         S20201 05920021
*                                                                       05940021
RELOOP   LA    RCWG,WGOFF(0,RCWG)      INCREMENT CURR WTG ENTRY         05960021
         LA    RCPL,PLOFF(0,RCPL)      INCR CURRENT DCB ENTRY POINTER   05980021
         CLC   0(2,RCWG),AMIDCNST      THIS RT NEEDED AGAIN             06000021
         BCR   EGHT,RSTART              BACK TO OPEN AGAIN         DM0I 06020021
         CLC   0(2,RCWG),OPIDCNST      END OF WTG TABLE                 06040021
         BC    7,RELOOP                NO,CHECK NEXT ENTRY              06060021
         LR    RCPL,RPL                                                 06080021
         LA    RCWG,WAOFF(0,RWG)       REINITIALIZE WTG LIST PTR        06100021
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           06120021
         BC    7,TCTLRTN               IF NOT TRANSFER CONTROL          06140021
         LA    RCWG,WGOFF(0,RCWG)      GET NEXT ENTRY                   06160021
         LA    RCPL,PLOFF(0,RCPL)                                       06180021
         B     ZCHEK                    ZERO CHECK                 DM0I 06200021
**                                                                      06220021
TCTLRTN  EQU   *                                                        06240021
         USING WTG,RWTG                                                 06290003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*06340003
               MODID=WTGENTRY                                  @Z30TSCF 06390003
         DROP  RWTGC,RWTG                                      @Z30TSCF 06392003
**                                                                      06400021
RPL      EQU   5                                                        06520021
RWG      EQU   6                                                        06540021
RCPL     EQU   7                                                        06560021
RCWG     EQU   8                                                        06580021
RSTART   EQU   11                                                       06600021
WAOFF    EQU   32                                                       06620021
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES      DM0I 06640021
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            06660021
*                                                                       06670002
*  MOD ID'S                                                             06680002
*                                                                       06690002
OPIDCNST DC    C'0S'                    ID                         DM0I 06700021
AMIDCNST DC    C'6L'                   ID THIS MODULE                   06720021
SOPSLDA  DC    C'10',VL3(IGG01910)      FIXED, UNDEFINED       @Z30TSCF 06730003
SOPSLDVT DC    C'15',VL3(IGG01915)      VAR RECS               @Z30TSCF 06732003
*                                                                       06740021
*                                                                       07440021
*********************************************************************** 07460021
*                                                                       07480021
*    THIS SECTION OF CODE BUILDS A SEARCH AND TIC CCW                 * 07500021
*                                                                       07520021
*                                                                       07540021
*    RC POINTS TO SEARCH ADDRESS-- RB POINTS TO NEXT CCW ON ENTRY     * 07560021
*   RB IS NOT CHANGED IN ROUTINE.-- RD  IS  RETURN--                  * 07580021
*                                                                     * 07600021
*********************************************************************** 07620021
SOP8SRTC ST    RC,0(0,RB)              SEARCH ADDRESS                   07640021
         MVI   0(RB),SRCHE             SEARCH OP CODE                   07660021
         MVI   7(RB),FIVE              COUNT                            07680021
         MVI   4(RB),COMCHAIN          COMMAND CHAIN                    07700021
*                                                                       07720021
*    TIC                                                                07740021
*                                                                       07760021
         LA    RC,5(0,RC)              SEARCH ADDRESS                   07780021
         ST    RB,8(0,RB)              TIC TO SEARCH                    07800021
         MVI   8(RB),TIC               TIC OP CODE                      07820021
         BR    RD                       EXIT                       DM0I 07840021
*********************************************************************** 07860021
*                                                                       07861021
* THIS RTN BUILDS SET THETA COMMANDS, RB POINTS TO CCW                  07862021
*                                                                       07863021
SOP8STA  EQU   *                                                 S20201 07864021
         L     RC,DXCCW11               GET SET THETA ADDR       S20201 07865021
         ST    RC,D0(RB)                PUT IN CCW               S20201 07866021
         OI    FLAGOFF(RB),CC           TURN ON COMMAND CHAIN    S20201 07867021
*                                       FLAG                     S20201 07868021
         MVI   CNTOFF(RB),ONE           SET COUNT TO ONE         S20201 07869021
         MVI   D0(RB),SETSC             PUT IN COMMAND           S20201 07870021
         AR    RB,RDEB                  INCREMENT PTR            S20201 07871021
         BR    RD                       RETURN                   S20201 07872021
*********************************************************************** 07880021
*                                                                       07881021
* THIS RTN BUILDS READ THETA COMMANDS, RB POINTS TO CCW                 07882021
SOP8RTA  EQU   *                                                 S20201 07883021
         SR    RB,RDEB                  BACK UP CCW PTR          S20201 07884021
         OI    FLAGOFF(RB),COMSILI      SET CC AND SIL IN PREV   S20201 07885021
*                                       CCW                      S20201 07886021
         AR    RB,RDEB                  RESTORE PTR              S20201 07887021
         L     RC,DXCCW11               GET RD THETA ADDR        Y02072 07888002
         ST    RC,D0(RB)                PUT IN CCW               S20201 07889021
         MVI   CNTOFF(RB),ONE           SET BYTE COUNT TO ONE    S20201 07891021
         MVI   D0(RB),RDSC              PUT IN COMMAND           S20201 07892021
         BR    RD                       RETURN                   S20201 07893021
*                                                                       07894021
*******************************************************************     07895021
***                                                                     07896021
CON24    DC    H'24'                    24 BYTE DISPLACEMENT     S20201 07897021
CON32    DC    H'32'                    32 BYTE DISPLACEMENT     S20201 07898021
EGHT     EQU   8                                                   DM0I 08380021
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 08390002
***                                                                     08420021
*********************************************************************** 08440021
*****                                                                   08460021
         DCBD  DSORG=PS                                                 08600021
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 08614003
         ORG   WTGIDTTR                                          Y02072 08616002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 08618002
         EJECT                                                          08618403
CVT      DSECT                                                 @Z30TSCF 08618803
         CVT                                                   @Z30TSCF 08619203
DCBKEYL  EQU   DCBKEYLE                                                 08620021
*                                                                       08640021
*                                                                       08660021
*                                                                       08680021
*    DEB                                                                08700021
*                                                                       08720021
DEBDEF   DSECT                                                          08740021
         DS    9F                       SPACE RESERVED             DM0I 08760021
DEBSTRBB DS    H                        START BIN NO.              DM0I 08780021
DEBSTRCC DS    CL4                      START CYCL.                DM0I 08800021
*                                                                       08820021
PARMDEF  DSECT                                                          08840021
PARMDEF1 DS    3F                       PARAMETER                  DM0I 08860021
*                                                                       08880021
*                                                                       08900021
         SPACE  2                                                       08920021
         SPACE 3                                                        08940021
DEVICETB DSECT                                                          08960021
DEVCONST DC    X'04000000'              DEVICE CONSTANT            DM0I 08980021
DEVCYLST DC    X'00'                    LIST                       DM0I 09000021
DEVCYLEN DC    X'CA'                    END CYLINDER                    09020021
DEVTRKST DC    X'00'                    START TRACK                     09040021
DEVTRKEN DC    X'09'                    TRACK END                       09060021
DEVTKLEN DC    FL2'3649'                TRACK LENGTH - R0               09080021
DEVOVHI  DC    FL1'82'                  NORMAL OVERHEAD                 09100021
DEVOVHL  DC    FL1'55'                  LAST RECORD OVERHEAD            09120021
DEVOVHK  DC    FL1'20'                 KEY ID OVERHEAD                  09140021
DEVFLAG  DC    FL1'1'                   FLAG                            09160021
DEVTOLR  DC    FL2'269'                 TOLERANCE                       09180021
         SPACE 3                                                        09200021
         END                                                            09220021
./  ADD  SSI=43090057,NAME=IGG0196P
         TITLE 'IGG0196P (D/A UPDATE)'                                  00007020
IGG0196P CSECT                                                          00014020
*MODULE NAME - IGG0196P                                          Y02072 00016002
*                                                                       00018002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00020002
*                                                                       00022002
*COPYRIGHT - NONE                                                Y02072 00022402
*                                                                       00022802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00023202
*                                                                       00023602
*          VS2 RELEASE 2 DELETIONS                               Y02072 00024002
*000090,034000,035300,035500,035700-035740,053060,053080,053100, Y02072 00024402
*058600,108400-110400,111000-112000,112110,112400,128800-129090, Y02072 00024802
*129100,129110-129170,112100,112200,116800-1174000,118000        Y02072 00024902
*14400,34400,35400                                               YM1393 00026902
*                                                                YM4640 00027002
*C24200,70880,81800                                              YM5362 00029002
*D122600-128000                                                  YM5362 00031002
*                                                                YM7595 00031402
*                                                                       00031803
*          VS2 RELEASE 3 DELETIONS                                      00032203
*                                                              @Z30TSCF 00032303
*                                                                       00032402
*          RELEASE 21 DELETIONS                                         00034702
*0340120500-121600                                               A37507 00037002
*0340                                                            A40538 00039302
*0340019460,019520,019900,020000,020100,020700-020900,           A31983 00041602
*0340070100-070400,070500,070800,080400-080600,087600-087800     A31983 00043902
*0340105400                                                       M0950 00046202
*                                                                       00048502
*STATUS CHANGE LEVEL 003                                                00057702
*                                                                       00059702
*FUNCTION/OPERATION- THIS ROUTINE WILL SET UP A CODE IN THE DCBCNTRL    00060020
*      FIELD FOR IGG01912.  IGG01912 (LOAD EXECUTOR) WILL DETERMINE     00080020
*      FROM THIS CODE WHICH ROUTINES WILL BE BROUGHT INTO CORE AT       00100020
*      OPEN TIME.                                                       00120002
*      IT WILL LINK THE IOB'S AND INITIALIZE THEM.                      00160020
*      IT WILL CONSTRUCT THE CHANNEL PROGRAMS NEEDED FOR PROPER EXECUT. 00180020
*      IT WILL SET UP THE NUMBER OF EXTENTS NEEDED AND PLACE THE        00200020
*      ADDRESSES IN THE DCB AND IOB'S.                                  00220020
*                                                                       00240020
*ENTRY POINTS- ENTERED FROM IGG0191P BY USE OF THE XCTL MACRO.          00260002
*                                                                       00280020
*INPUT- SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00300020
*                                                                       00320020
*OUTPUT & IOB(USER)- SEE DESCRIPTION OF REGISTERS, DCB(USERS).          00340020
*                                                                       00360020
*EXTERNAL ROUTINES- NONE.                                               00380020
*                                                                       00400020
*EXITS-NORMAL-XCTL TO IGG01912, IGG01915 TO LOAD ROUTINES               00420002
*                                                                       00440020
*EXITS-ERROR- NONE.                                                     00460020
*                                                                       00470002
*MACROS : ACTION - MODESET, XCTL, XCTLTABL                       Y02072 00472002
*                                                                       00474002
*MACROS : MAPPING - IHACCW, DCBD, IECDSECS, IGGBCB, IEZDEB, IHAFCAUD    00476002
*                                                                       00480020
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00500020
*                                                                       00520020
*      BYTE  0-7  NAME                                                  00540020
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00560020
*      BYTE 11    CONCATENATION NUMBER                                  00580020
*      BYTE 12    ZERO                                                  00600020
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00620020
*                        ALIAS INDICATOR 1 BIT                          00640020
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00660020
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00680020
*      BYTE 17    ZERO                                                  00700020
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00720020
*      BYTE 20    TRANSLATION TABLE                                     00740020
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00760020
*      BYTE 22-23 ATTRIBUTES                                            00780020
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00800020
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00820020
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00840020
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00860020
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       00880020
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        00900020
*      BYTE 40-   TABLE OF IDTTR'S                                      00920020
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          00940020
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          00960020
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          00980020
*                   NOT USED                         (3 BYTES)          01000020
*                                                                       01020020
*      SEE DEVICETB DSECT                                               01040020
*                                                                       01060020
*ATTRIBUTES- REENTRANT,REUSABLE,RUNS IN USER KEY UNLESS          Y02072 01080002
*            OTHERWISE SPECIFIED,SUPER STATE                     Y02072 01090002
*                                                                       01100020
*                                                                       01120020
*********************************************************************** 01140020
*                                                                       01160020
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01180020
*                                                                       01200020
*********************************************************************** 01220020
*                                                                       01240020
RDCB     EQU   2         DCB REGISTER                                   01260020
RBASE    EQU   3         BASE REGISTER                                  01280020
RCORE    EQU   4         WORK AREA ADDRESS                              01300020
RPAR     EQU   5         TOP OF PARAMETER LIST                          01320020
RWTG     EQU   6         TOP OF WTG TABLE                               01340020
RPARC    EQU   7         CURRENT PARAMETER                              01360020
RWTGC    EQU   8         CURRENT TRANS LOAD                             01380020
RDEB     EQU   9         DEB REGISTER                            YM5362 01390002
RUCB     EQU   10        COUNTER IN IOB GENERATION                      01420020
RBUFADR  EQU   11        ADDR OF NEXT AVAIL BUFFER               YM7595 01430002
RB       EQU   12        WORK REG1  **                                  01460020
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01480020
RD       EQU   14        WORK REG3  **                                  01500020
RWK3     EQU   15        WORK REGISTER                           YM5362 01530002
RBRNCH   EQU   RWK3      USED TO BRANCH TO SUBROUTINES           YM5362 01532002
RE       EQU   0         WORK REG5                                      01540020
RWK1     EQU   RE        WORK REGISTER                           YM7595 01552002
RF       EQU   1         WORK REG6                                      01560020
RWK2     EQU   RF        WORK REGISTER                           YM5362 01570002
*                                                                       01580020
*********************************************************************** 01600020
*                                                                       01620020
* MASKS FOR ACCESS METHODS IN SAM                                       01640020
*                                                                       01660020
QSAMB    EQU   X'01'                                                    01680020
*                                                                       01700020
*                                                                       01720020
*********************************************************************** 01740020
*                                                                       01760020
* MASKS FOR MACRO'S TO BE USED                                          01780020
*                                                                       01800020
POINTB   EQU   X'04'                                                    01820020
*                                                                       01840020
*********************************************************************** 01860020
*                                                                       01880020
* DCB OFFSET CONSTANTS                                                  01900020
*                                                                       01920020
WCPO     EQU   48                                                       01940020
WCWCPL   EQU   6                        WRITE CHAN PGM LEN WITH  A31983 01950021
*                                          WRT CHK               A31983 01952021
WCTOWCPL EQU   7                        WRITE CHAN PGM LEN WITH  A31983 01954021
*                                          WRT CHK + TRK OVFLOW  A31983 01956021
THREECCW EQU   24                       LEN OF 3 CCW'S           A31983 01958021
WCPL     EQU   3                                                        01960020
OFFSR    EQU   112                                                      01980020
WCOSRQ   EQU   X'88'                    READ CP OFFSET WITH WRT  A31983 01990021
*                                          CHK FOR QSAM          A31983 02000021
TOWCOSRQ EQU   X'90'                    READ CP OFFSET WITH WRT  A31983 02010021
*                                          CHK + TRK OVFLOW FOR  A31983 02012021
*                                          QSAM                  A31983 02014021
WCOSRB   EQU   X'80'                    WRITE CP OFFSET WITH WRT A31983 02016021
*                                          CHK FOR BSAM          A31983 02018021
TOWCOSRB EQU   X'88'                    WRITE CP OFFSET WITH WRT A31983 02018421
*                                          CHK + TRK OVFLOW FOR  A31983 02018821
*                                          BSAM                  A31983 02019221
OFFSW    EQU   64                                                       02020020
OFFSRB   EQU   104                                                      02040020
WRTCKL   EQU   32             LENGTH OF WRITE CHECK SECTION OF    18445 02050020
*                             WRITE CHANNEL PROGRAM               18445 02060020
WRTCKCCW EQU   X'1E'          OFFSET TO WRT CHK CCW               M0950 02070021
*                                                                       02100020
*********************************************************************** 02120020
*                                                                       02140020
* MASKS USED TO TEST OPTION FIELDS IN DCB                               02160020
*                                                                       02180020
DOUBLE   EQU   X'01'                                                    02200020
WRTCK    EQU   X'80'                                                    02220020
UPDATEB  EQU   X'80'                                                    02240020
TRKOVFLB EQU   X'20'                    TRACK OVERFLOW OPTION           02260020
*                                                                       02280020
*********************************************************************** 02300020
*                                                                       02320020
* COMMAND BYTES FOR THE 2841                                            02340020
*                                                                       02360020
*       CONTROL UNIT                                                    02380020
*                                                                       02400020
SEEK     EQU   X'1B'                    SEEK HEAD OP CODE        YM5362 02420002
NOP      EQU   X'03'                    NOP OP CODE              YM5362 02430002
SRCHE      EQU   X'31'                                                  02440020
RDC        EQU   X'92'                                                  02460020
RDD        EQU   X'86'                                                  02480020
RDDX     EQU   X'06'                                                    02500020
TIC        EQU   X'08'                                                  02520020
WRTD       EQU   X'05'                                                  02540020
WRTKD    EQU   X'0D'                                                    02560020
RDKD     EQU   X'8E'                                                    02580020
*                                                                       02600020
*********************************************************************** 02620020
*                                                                       02640020
*   CHANNEL CONTROL WORD FLAGS                                          02660020
*                                                                       02680020
SLI        EQU   X'20'                                                  02700020
CC         EQU   X'40'                                                  02720020
SLICC    EQU   X'60'                                                    02740020
CCSK     EQU   X'50'                                                    02760020
SLICCSK  EQU   X'70'                                                    02780020
*                                                                       02800020
*********************************************************************** 02820020
*                                                                       02840020
* MASKS FOR RECORD FORMATS                                              02860020
*                                                                       02880020
FORMATU    EQU   X'C0'                                                  02900020
*                                                                       02920020
*********************************************************************** 02940020
*                                                                       02960020
* OFFSET FOR PARAMETER TESTS                                            02980020
*                                                                       03000020
ONE      EQU   1                                                        03020020
TWO      EQU   2                        CONSTANT OF 2            M0950  03030021
NOT      EQU   X'FF'                                                    03040020
*                                                                       03060020
*********************************************************************** 03080020
*                                                                       03100020
* MASKS FOR STATUS BITS TO BE TESTED                                    03120020
*                                                                       03140020
FIRSTIOB   EQU   X'01'                                                  03160020
READONLY EQU   X'20'                    IOB READ ONLY INDICATOR         03180020
UNRELFLG EQU   X'02'                   IOB UNRELATED FLAG        A37507 03190021
SEEKCYHD EQU   X'18'                    IF BOTH ON IN FILE MASK, YM5362 03192002
*                                         INHIBIT ALL SEEKS      YM5362 03194002
*                                                                       03200020
*********************************************************************** 03220020
*                                                                       03240020
ZERO     EQU   0                        CONSTANT OF 0                   03240620
FOUR     EQU   4                        CONSTANT OF 4                   03241220
* MASKS USED TO LOAD IGG01915 IN SUPPORT OF QSAM LOCATE MODE OF         03242020
* OPERATION WITH LOGICAL RECORD INTERFACE FOR VARIABLE LENGTH           03244020
* SPANNED RECORD                                                        03246020
*                                                                       03248020
FLGOFFST EQU   4                        OFFSET TO FLAG IN BCB    S19015 03250020
RAFLAG   EQU   X'80'                    RECORD AREA PRESENT      S19015 03252020
NULL     EQU   0                        ZERO DISPLACEMENT        S19015 03254020
IDLEN    EQU   5                        LENGTH OF IDTTR          S19015 03256020
*                                                                       03260020
*                                                                       03282020
*                                                                       03284020
*                                                                       03286020
*                                                                       03288020
*                                                                       03290020
*                                                                       03292020
*                                                                       03294020
*                                                                       03296020
*                                                                       03298020
*                                                                       03300020
*                                                                       03320020
         BALR  RBASE,0                  REG 3 IS BASE                   03340020
         USING SOPB,RBASE                                               03360020
         USING IHADCB,RDCB              REG 2 IS DCB                    03380020
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDRESS      03420020
         USING DEBBASIC,RDEB                                     YM5362 03430002
*                                                                       03460020
SOPB     EQU   *                                                        03480020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 03485002
         DC    C'IGG0196P'              MODULE NAME              YM4640 03486002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 03487003
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 03488003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 03489002
         MODESET  KEYADDR=DXUKEY,WORKREG=9 GET INTO USER KEY     Y02072 03490002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 03500020
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   03520020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          YM5362 03530002
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESS           03560020
*                                                                       03580020
         L     RB,DCBIOBA               GET ADDR OF GETMAIN             03780020
         LR    RD,RB                    GET ADDR OF GETMAIN AREA        03980020
         L     RUCB,ZERO(RB)            GET THE IOB COUNT               04180020
         XC    ZERO(FOUR,RB),ZERO(RB)    ZERO OUT FIRST 4 BYTES OF      04380020
*                                       GETMAIN AREA (USED TO           04580020
*                                       PASS INFO FROM IGG0191P)        04780020
         CH    RUCB,ONEIOB             ONE IOB?                  A37507 05302021
         BNE   NTONEIOB                NO - BRANCH               A37507 05304021
         USING IOBQSAMN,RB             ADDRESSABILITY FOR DSECT  Y02072 05306002
         OI    IOBFLAG1,IOBUNREL       YES - SET UNRELATED FLAG  Y02072 05308002
         DROP  RB                                                Y02072 05310002
NTONEIOB EQU   *                                                 A37507 05312021
SOPB30   EQU   *                                                        05320020
         LTR   RUCB,RUCB                HAS IOB COUNT BEEN EXHAUSTED    05340020
         BC    7,SOPB31                 NO, BRANCH                      05360020
*                                                                       05380020
         L     RB,DCBIOBA               GET FIRST IOB GENERATED         05400020
         ST    RB,0(RD)                 LINK FIRST IOB TO LAST          05420020
         OI    0(RD),READONLY           IOB FOR READ ONLY         22484 05430020
         B     SOPBEND                                                  05440020
*                                                                       05460020
*********************************************************************** 05480020
*                                                                       05500020
*    REGISTER USEAGE FOR CHANNEL PROGRAM CONSTRUCTION                   05520020
*       RB - RD/WRT SEQUENCE POINTER                                    05540020
*       RC - FDA POINTER                                                05560020
*       RD - CURRENT IOB POINTER                                        05580020
*       RJ - LINK REG TO INTERNAL SUBROUTINE                            05600020
*       RF - PARAREG FOR INTERNAL SUBROUTINE                            05620020
*       RE - INTERNAL POINTER IN READ SEQUENCE                          05640020
*                                                                       05660020
*********************************************************************** 05680020
*                                                                       05700020
SOPB31   EQU   *                                                        05720020
         ST    RB,0(RD)                 LINK NEW IOB TO LAST ONE BUILT  05740020
         OI    0(RD),READONLY           IOB FOR READ ONLY         22484 05750020
         LR    RD,RB                    UPDATE CURRENT IOB POINTER      05760020
         OI    8(RD),CC                 INDICATE COMMAND CHAINING 21282 05790020
         LA    RB,4(RB)                 POINT TO ECB SLOT               05800020
         OI    0(RB),X'7F'              SET ECB COMPLETE WITHOUT ERROR  05820020
         ST    RB,12(RD)                STORE ECB ADDR IN IOB           05840020
         L     RWK3,DXUDCBAD            GET USERS DCB ADDR       Y02072 05850002
         USING IOBQSAMN,RD                                       Y02072 05860002
         ST    RWK3,IOBDCBPT            DCB ADDR TO IOB          Y02072 05870002
         DROP  RD                                                Y02072 05872002
*                                                                       05880020
*********************************************************************** 05900020
*                                                                       05920020
*     CONSTRUCTION OF CHANNEL PROGRAM FOLLOWS                           05940020
*                                                                       05960020
*********************************************************************** 05980020
*                                                                       06000020
SOPB40   EQU   *                                                        06020020
         LA    RB,48(RD)                UPDATE TO WRITE SEQUENCE        06040020
         LA    RC,43(RD)                POINT TO CCHHR FIELD IN IOB     06060020
         ST    RC,0(RB)                 STORE ADDR IN SRCH CCW          06080020
         MVI   0(RB),SRCHE              STORE CMD BYTE                  06100020
         MVI   7(RB),X'05'              STORE COUNT OF 5 IN CCW         06120020
         OI    4(RB),CC                 SET CMD CHAIN FLAG ON           06140020
         ST    RB,8(RB)                 STORE IN TIC CCW                06160020
         MVI   8(RB),TIC                STORE TIC CMD BYTE              06180020
*                                                                       06200020
*********************************************************************** 06220020
*                                                                       06240020
*     SRCH AND TIC CCWS HAVE BEEN GENERATED AT THIS POINT               06260020
*                                                                       06280020
*********************************************************************** 06300020
*                                                                       06320020
*     CONSTRUCTION OF WRITE CHANNEL PROGRAMS FOLLOW                     06340020
*                                                                       06360020
*********************************************************************** 06380020
*                                                                       06400020
*                                                                       06420020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06430002
         MVI   DCBWCPO,WCPO             WRITE CHANNEL PROGRAM OFFSET    06440020
         MVI   DCBWCPL,WCPL             STORE NORMAL WRT CP LEN.        06460020
         MVI   DCBOFFSW,OFFSW           WRITE CCW OFFSET                06480020
         MODESET  KEYADDR=DXUKEY,WORKREG=1 GET INTO USER KEY     Y02072 06482002
*                                                                       06500020
         TM    DCBRECFM,FORMATU         U RECORDS USED                  06520020
         BM    SOPB50                   NO, BRANCH                      06540020
         OI    20(RB),SLI               SET SILI FLAG ON                06560020
*                                                                       06580020
SOPB50   EQU   *                                                        06600020
         OI    20(RB),CC                SET COMMAND CHAIN FLAG ON       06620020
*                                                                       06640020
         MVI   16(RB),WRTD              STORE WRITE DATA CMD OP         06660020
*                                                                       06680020
         TM    DCBCIND2,QSAMB           IS QSAM USED                    06700020
         BO    SOPB51                   YES, BRANCH                     06720020
*                                                                       06740020
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         06760020
         BC    4,SOPB52                 NO, BRANCH                      06780020
*                                                                       06800020
         MVI   16(RB),WRTKD             STORE WRT KEY & DATA CMD BYTE   06820020
         B     SOPB52                                                   06840020
*                                                                       06860020
SOPB51   EQU   *                                                        06880020
         LA    RF,16(RB)                POINT TO ACTUAL WRT CCW         06900020
         BAL   RBRNCH,SOPB70            GO FILL IN CCW ATTRIBUTES       06920002
*                                                                       06940020
SOPB52   EQU   *                                                        06960020
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    06980020
         BC    14,SOPB53               NO. BRANCH                       07000020
         LA    RB,THREECCW(RB)          POSITION AT WRT CHK CP   A31983 07050021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07050402
         MVI   DCBWCPL,WCWCPL           CHAN PGM LEN, WRT CHK    A31983 07060021
         TM    DCBRECFM,TRKOVFLB        TRK OVFLOW SPECIFIED?    A31983 07070021
         BNO   NOTRKOV1                 NO, DON'T UPDATE WRT     A31983 07080021
*                                          CHAN PGM LEN          A31983 07080421
         MVI   DCBWCPL,WCTOWCPL         CHAN PGM LEN, WRT CHK    A31983 07080821
*                                          WITH TRK OVFLOW       A31983 07081221
         MODESET  KEYADDR=DXUKEY,WORKREG=1 GET INTO USER KEY     Y02072 07081302
         LA    RF,41(RD)                POINT TO BBCCHHR IN       18445 07082020
*                                       IOBSEEK FIELD             18445 07084020
         ST    RF,0(RB)                 STORE SEEK ADDRESS        18445 07086020
         BAL   RBRNCH,SOPB80            GO GET PROPER OP CODE    YM5362 07088002
         MVI   4(RB),CC                 SET COMMAND CHAIN FLAG ON 18445 07090020
         MVI   7(RB),X'06'              STORE COUNT OF 6 IN CCW   18445 07092020
         LA    RB,8(RB)                 UPDATE RB TO NEXT CCW     18445 07094020
         B     SOPB520                  BR AROUND MODESET        Y02072 07094402
NOTRKOV1 EQU   *                                                 A31983 07096021
         MODESET  KEYADDR=DXUKEY,WORKREG=1 GET INTO USER KEY     Y02072 07096402
SOPB520  TM    DCBRECFM,FORMATU         U RECORDS USED           Y02072 07100002
         BC    14,SOPB52A               NO, BRANCH                      07120020
         OI    20(RB),SLICCSK           SET SILI AND CC FLAGS ON        07140020
         B     SOPB52B                                                  07160020
*                                                                       07180020
SOPB52A  EQU   *                                                        07200020
         OI    20(RB),CCSK              SET CC FLG ON IN READ AND WRT   07220020
SOPB52B  EQU   *                                                        07240020
         ST    RC,0(RB)                 SAVE ADDRESS IN SRCH CCW        07260020
         MVI   0(RB),SRCHE              STORE SRCHE CMD BYTE            07280020
         OI    4(RB),CC                 SET CMD CHAIN FLAG ON           07300020
         MVI   7(RB),X'05'              STORE COUNT OF 5 IN CCW         07320020
         ST    RB,8(RB)                 SRCH ADDR IN TIC CCW            07340020
         MVI   8(RB),TIC                STORE TIC CMD BYTE              07360020
         MVI   16(RB),RDD               STORE READ DATA CMD OP          07380020
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  07400020
         BO    SOPB55                   YES, BRANCH                     07420020
*                                                                       07440020
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         07460020
         BC    4,SOPB53                 NO, BRANCH                      07480020
*                                                                       07500020
         MVI   16(RB),RDKD              STORE RD KEY & DATA CMD BYTE    07520020
*                                                                       07540020
SOPB53   EQU   *                                                        07560020
         TM    DCBCIND2,QSAMB           QSAM USED                       07580020
         BC    1,SOPB55                 YES, BRANCH                     07600020
         NI    20(RB),NOT-CC            CLEAR COMMAND CHAIN FOR BSAM    07620020
*                                                                       07640020
         LA    RB,16(RB)                POINT TO BSAM OFFSET            07660020
         B     SOPB56                                                   07680020
*                                                                       07700020
SOPB55   EQU   *                                                        07720020
         LA    RB,24(RB)                POINT TO READ SEQ.              07740020
*                                                                       07760020
*********************************************************************** 07780020
*                                                                       07800020
*    THIS SECTION GENERATES READ CHANNEL PROGRAMS                       07820020
*                                                                       07840020
*********************************************************************** 07860020
*                                                                       07880020
SOPB56   EQU   *                                                        07900020
*                                                                       07920020
         LA    RC,8(RB)                 POINT TO SRCH CCW OF RD SEQ     07940020
         ST    RC,24(RD)                STORE CP STARTAD IN IOB         07960020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07962002
         MVI   DCBOFFSR,OFFSR           STORE NORMAL RD CCW OFFSET      07980020
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    08000020
         BC    14,SOPB60                NO, BRANCH                      08020020
         MVI   DCBOFFSR,WCOSRQ          QSAM READ CCW OFFSET     A31983 08070021
*                                          WITH WRT CHK          A31983 08074021
         TM    DCBRECFM,TRKOVFLB        TRK OVFLOW SPECIFIED?    A31983 08076021
         BNO   SOPB60                   NO, DON'T UPDATE READ    A31983 08078021
*                                          OFFSET                A31983 08078421
         MVI   DCBOFFSR,TOWCOSRQ        QSAM READ CCW OFFSET     A31983 08078821
*                                          WITH WRT CK + TRK OV  A31983 08079221
SOPB60   EQU   *                                                        08080020
         MODESET  KEYADDR=DXUKEY,WORKREG=1 GET INTO USER KEY     Y02072 08082002
         LA    RC,49(RB)                POINT TO BBCCHH FIELD           08100020
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  08120020
         BZ    SOPB601                  NO. BRANCH                      08140020
         ST    RC,0(RB)                 STORE ADDR IN SEEK CCW          08160020
         BAL   RBRNCH,SOPB80            GO GET PROPER OP CODE    YM5362 08180002
         MVI   7(RB),X'06'              STORE COUNT OF 6 IN CCW         08200020
         OI    4(RB),CC                 SET COMMAND CHAIN FLAG ON       08220020
SOPB601  EQU   *                                                        08240020
         LA    RC,2(RC)                 POINT TO CCHH FIELD             08260020
         ST    RC,8(RB)                 STORE ADDR IN SRCH CCW          08280020
         MVI   8(RB),SRCHE              STORE SEARCH COMMAND BYTE       08300020
         MVI   15(RB),X'05'             STORE COUNT OF 5 IN CCW         08320020
         OI    12(RB),CC                SET COMMAND CHAIN FLAG ON       08340020
         LA    RE,8(RB)                 GET ADDRESS OF SEARCH CCW       08360020
         ST    RE,16(RB)                STORE IN TIC CCW                08380020
         MVI   16(RB),TIC               STORE TIC COMMAND BYTE          08400020
         LA    RE,32(RB)                GET ADDR OF RD COUNT CCW        08420020
         ST    RE,24(RB)                STORE IN TIC CCW                08440020
         MVI   24(RB),TIC               STORE TIC COMMAND BYTE          08460020
         TM    DCBRECFM,TRKOVFLB        TRACK OVERFLOW SPECIFIED        08480020
         BZ    SOPB605                  NO, BRANCH                      08500020
*                                       YES, CHANGE TIC CCW TO RD DATA  08520020
         MVI   24(RB),RDDX              READ DATA CMD OP FOR T/O        08540020
         MVI   28(RB),SLICCSK           SKIP, SILI, CC FLAGS            08560020
         MVI   31(RB),50                NON-ZERO LENGTH                 08580020
*                                                                       08600020
SOPB605  EQU   *                                                        08620020
*                                                                       08640020
         TM    DCBCIND2,QSAMB           QSAM USED                       08660020
         BC    1,SOPB61                 YES, BRANCH                     08680020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08682002
         MVI   DCBOFFSR,OFFSRB          STORE BSAM RD CCW OFFSET        08700020
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    08720020
         BC    14,SOPB607               NO, BRANCH                      08740020
         MVI   DCBOFFSR,WCOSRB          BSAM READ CCW OFFSET     A31983 08790021
*                                          WITH WRT CHK          A31983 08792021
         TM    DCBRECFM,TRKOVFLB        TRK OVFLOW SPECIFIED     A31983 08794021
         BNO   SOPB607                  NO, DON'T UPDATE READ    A31983 08796021
*                                          CCW OFFSET            A31983 08798021
         MVI   DCBOFFSR,TOWCOSRB        BSAM READ CCW OFFSET     A31983 08798421
*                                          WITH WRT CHK + TRK OV A31983 08798821
SOPB607  EQU   *                                                        08800020
         MODESET  KEYADDR=DXUKEY,WORKREG=1                       Y02072 08810002
         CLI   DCBNCP,ONE               MORE THAN 1 IOB USED            08820020
         B     SOPB62                   BRANCH TO TEST                  08840020
*                                                                       08860020
SOPB61   EQU   *                                                        08880020
         CLI   DCBBUFNO,ONE             MORE THAN 1 IOB USED            08900020
*                                                                       08920020
SOPB62   EQU   *                                                        08940020
         BNH   SOPB64                   NO, BRANCH                      08960020
*                                                                       08980020
*    RC POINTS TO CCHHR OF THIS IOB                                     09000020
*                                                                       09020020
         SR    RF,RF                    CLEAR REG                       09040020
         IC    RF,DCBIOBL               GET IOB LENGTH                  09060020
         SLL   RF,3                     CHANGE TO BYTES                 09080020
         LA    RC,0(RF,RC)              POINT TO NEXT DA ADDR FIELD     09100020
SOPB63   EQU   *                                                        09120020
         ST    RC,32(RB)                STORE IN RD COUNT CCW           09140020
         MVI   32(RB),RDC               STORE RD CNT CMD BYTE           09160020
         OI    36(RB),SLICC             SET SILI AND CC FLAGS ON        09180020
         MVI   39(RB),X'05'             STORE COUNT OF 5 IN CCW         09200020
         MVI   40(RB),RDD               STORE READ DATA CMD BYTE        09220020
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  09240020
         BO    SOPB65                   YES, BRANCH                     09260020
*                                                                       09280020
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         09300020
         BC    4,SOPB65A                NO, BRANCH                      09320020
         MVI   40(RB),RDKD              STORE RD DATA & KEY IN CMD BYTE 09340020
         B     SOPB65A                                                  09360020
*                                                                       09380020
SOPB64   EQU   *                                                        09400020
         L     RDCB,DXUDCBAD            GET USERS DCB ADDR       Y02072 09410002
         LA    RC,DCBFDAD+3             POINT TO CCHHR IN DCB           09420020
         L     RDCB,0(RPARC)            GET PROTECTED COPY BACK  Y02072 09430002
         B     SOPB63                                                   09440020
*                                                                       09460020
SOPB65   EQU   *                                                        09480020
         LA    RF,40(RB)                POINT TO ACTUAL RD DATA CCW     09500020
         BAL   RWK1,SOPB72              GO FILL IN QSAM ATTR     YM7595 09520002
SOPB65A  EQU   *                                                        09600020
         BCTR  RUCB,0                   DECREMENT COUNTER               09620020
         MVC   48(8,RB),DCBFDAD         MOVE FDAD TO SPECIAL FDA        09640020
         MVC   40(8,RD),DCBFDAD         MOVE FDAD TO IOS'S FDA          09660020
*                                                                       09680020
         TM    DCBRECFM,FORMATU         U RECORDS USED                  09700020
         BM    SOPB66                   NO, BRANCH                      09720020
*                                                                       09740020
         OI    44(RB),SLI               SET SLI FLAG IN CCW             09760020
*                                                                       09780020
SOPB66   EQU   *                                                        09800020
         TM    DCBCIND2,QSAMB           QSAM USED                       09820020
         BC    1,SOPB67                 YES BRANCH                      09840020
*                                                                       09860020
         CLI   DCBNCP,ONE               MORE THAN 1 IOB USED            09880020
         B     SOPB68                   BRANCH TO TEST                  09900020
*                                                                       09920020
SOPB67   EQU   *                                                        09940020
         CLI   DCBBUFNO,ONE             MORE THAN 1 IOB USED            09960020
*                                                                       09980020
SOPB68   EQU   *                                                        10000020
         BNH   SOPB69                   NO, BRANCH                      10020020
*                                                                       10040020
         LTR   RUCB,RUCB                HAVE ALL IOBS BEEN GENERATED    10060020
         BC    7,SOPB69                 NO, BRANCH                      10080020
*                                                                       10100020
         L     RC,DCBIOBA               GET FIRST IOB GENERATED         10120020
         SR    RF,RF                    CLEAR REG                       10140020
         IC    RF,DCBOFFSR              OBTAIN READ CCW OFFSET          10160020
         LA    RC,11(RF,RC)             POINT TO NEXT DA ADDR FIELD     10180020
         ST    RC,32(RB)                STORE IN LAST IOBS RD CNT CCW   10200020
         MVI   32(RB),RDC               STORE CMD BYTE                  10220020
*                                                                       10240020
SOPB69   EQU   *                                                        10260020
         LA    RB,56(RB)                POINT TO NEXT POSSIBLE IOB LOC. 10280020
         B     SOPB30                   RETURN FOR NEXT IOB             10300020
*                                                                       10320020
*********************************************************************** 10340020
*                                                                       10360020
*  THE FOLLOWING CODE SETS UP THE CCW WITH LENGTH AND BUF ADDR.         10380020
*                                                                       10400020
*********************************************************************** 10420020
*                                                                       10440020
*                                                                       10460020
SOPB70   EQU   *                                                        10480020
         TM    DCBOPTCD,WRTCK           WRITE CHECK USED                10500020
         BC    14,SOPB71                NO, BRANCH                      10520020
         MVC   WRTCKCCW(TWO,RF),DCBBLKSI                         M0950  10540021
*                                                                       10560020
SOPB71   EQU   *                                                        10580020
         LR    RWK1,RBRNCH              SAVE RETURN ADDR         YM7595 10582002
         L     RWK3,DCBBUFCB            BUFCB ADDR               YM7595 10590002
         USING BCBLK,RWK3                                               10592002
         L     RBUFADR,BCBBUFPT         ADDR NEXT AVAIL BUFFER   YM7595 10594002
         USING BUFFER,RBUFADR                                           10598402
         MVC   BCBBUFAD,BUFNXPTB        UPDATE TO NEXT AVAIL BUF YM7595 10598802
SOPB72   EQU   *                                                 YM1393 10600002
         USING CCW,RF                                            Y02072 10630002
         STCM  RBUFADR,B'0111',CCWADDRB  ADDR OF BUFFER TO CCW   Y02072 10680002
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM1393 10690002
         DROP  RF,RWK3,RBUFADR                                   Y02072 10730002
         LR    RBRNCH,RWK1              RESTORE RETURN ADDR      YM7595 10732002
         BR    RBRNCH                   RETURN                          10740002
         SPACE 3                                                        10750002
*                                                                       10760020
* THE FOLLOWING WILL SET UP THE NEXT CCW AS A SEEK HEAD OR A NOP YM5362 10770002
* DEPENDING ON THE DEB FILE MASK FOR PERFORMANCE REASONS. IF THE YM5362 10780002
* FILE MASK INDICATES ALLOCATION IN CYLINDERS, SET CCW OP CODE   YM5362 10790002
* TO A SEEK HEAD. IF ALLOCATION IS BY TRACKS, SET AS A NOP. THIS YM5362 10792002
* WILL PREVENT FILE MASK VIOLATIONS DURING I/O OPERATIONS AND    YM5362 10794002
* THUS LESS ERROR PROCESSING BY APPENDAGES, EXCP, AND THE ERP.   YM5362 10796002
*                                                                       10800020
SOPB80   EQU   *                                                 YM5362 10810002
         USING DEBDASD,RWK2                                      YM5362 10812002
         LA    RWK2,DEBBASND            ADDR OF DA SECT OF DEB   YM5362 10814002
         USING CCW,RB                                            YM5362 10814402
         MVI   CCWCOMCD,SEEK            ASUME CYL BOUNDRY        YM5462 10814802
         TM    DEBDVMOD,SEEKCYHD        ALLOC IN CYLINDERS       YM5362 10816002
         BNOR  RBRNCH                   YES, OP CODE OK          YM5362 10818002
         MVI   CCWCOMCD,NOP             NO, CHANGE OP CD TO NOP  YM5362 10818402
         BR    RBRNCH                   RETURN MAINLINE          YM5362 10818802
         DROP  RWK2,RB                                           YM5362 10818902
         SPACE 3                                                        10819202
SOPBEND  EQU   *                                                        10820020
         L     RB,DCBIOBA               GET FIRST IOB                   11060020
         OI    0(RB),FIRSTIOB           SET INDICATOR ON FOR CLOSE      11080020
*                                                                       11201020
* PRESENCE OF RECORD AREA TEST TO DETERMINE NEXT LOAD EXECUTOR. IF      11202020
* YES, GET LOAD EXECUTOR IGG01915.                                      11203020
*                                                                       11204020
         TM    DCBBUFCB+3,X'01'         HAVE BUFFERS BEEN        A40538 11204221
*                                       SUPPLIED                 A40538 11204421
         BO    SOPBENDB                 BRANCH IF NO BUFFERS TO  A40538 11204621
*                                       LOAD IGG01912                   11204821
         L     RB,DCBBUFCB              GET BUFCB ADDR           S19015 11205020
         LA    RB,NULL(RB)              CLEAR HIGH ORDER BYTE    S19015 11206020
         TM    FLGOFFST(RB),RAFLAG      RECORD AREA INDICATOR ON S19015 11207020
         BZ    SOPBENDB                 BRANCH IF NOT TO LOAD    S19015 11208020
*                                            IGG01912                   11209020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11209102
         USING WTGENTRY,RWTGC                                    Y02072 11209502
         MVC   WTGIDTTR,IGG01915        NEXT MOD               @Z30TSCF 11209903
         B     SOPBENDC                 BRANCH TO PROCESS NEXT   Y02072 11211002
*                                            ENTRY                      11212020
SOPBENDB EQU   *                                                 S19015 11213020
*                                                                       11214020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11214402
         MVC   WTGIDTTR,IGG01912        NEXT MOD               @Z30TSCF 11216403
SOPBENDC EQU   *                                                        11228402
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 11238402
         OI    DCBCIND2,UPDATEB         FLAG DCB AS UPDATE       Y02072 11242002
         TM    DCBDSORG,DCBDSGPO       DCB FOR PO                Y02072 11250002
         BZ    RELOOP                  NO, BRANCH                Y02072 11252002
*                                                                Y02072 11254002
         MVI   NTPTINDX+1,5            PROVIDE N/P FOT PO        Y02072 11256002
RELOOP   EQU   *                                                        11260020
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        11280020
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     11300020
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            11320020
         BCR   8,RBASE                                                  11340020
*                                                                       11360020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    11380020
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             11400020
*                                                                       11420020
         LR    RPARC,RPAR                                               11440020
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       11460020
*                                                                       11480020
ZCHEK    EQU   *                                                        11500020
         CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           11520020
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         11540020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  11560020
         LA    RPARC,PLOFF(0,RPARC)                                     11580020
         BC    15,ZCHEK                                                 11600020
*                                                                       11620020
TCTLRTN  EQU   *                                                        11640020
         USING WTG,RWTG                                                 11690003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11740003
               MODID=WTGENTRY                                  @Z30TSCF 11790003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11800003
**                                                                      11820020
WAOFF    EQU   32                                                       11920020
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           11940020
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           11960020
*                                                                       11970002
*  MODULE ID'S                                                          11972002
*                                                                       11974002
OPIDCNST DC    C'0S'                                                    11980020
AMIDCNST DC    C'6P'                    ID OF THIS MODULE               12000020
IGG01912 DC    C'12',VL3(IGG01912)      NOT REC AREA           @Z30TSCF 12002003
IGG01915 DC    C'15',VL3(IGG01915)      YES, REC AREA INDIC    @Z30TSCF 12004003
*                                                                       12004402
*  OTHER CONSTANTS                                                      12004802
*                                                                       12005202
ONEIOB   DC    H'1'                    FOR IOB UNRELATED TEST    A37507 12010021
PATCH    DC    25H'0'                   PATCH AREA               YM4640 12122002
END      EQU   *                        END OF MODULE            Y02072 12130002
         EJECT                                                          12140002
         IGGBCB  TYPE=SAM                                               12150002
         EJECT                                                          12160002
           DCBD  DSORG=PS                                               12180020
NTPTINDX EQU   DCBCNTRL                 NOTE/POINT INDEX         Y02072 12190002
         EJECT                                                          12260002
         IEZDEB                                                         12460002
         TITLE 'IGG0196P - FORMAT OF GOTTEN CORE'                       12820002
*                                                                       12840020
*                                                                       12860020
         IECDSECS  (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES    @Z30TSCF 12910003
         ORG   WTGIDTTR                                          Y02072 12912002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 12914002
         EJECT                                                          12914403
CVT      DSECT                                                 @Z30TSCF 12914803
         CVT                                                   @Z30TSCF 12915203
         EJECT                                                          12916002
FORCORE  DSECT                                                          12916402
         IHAFCAUD ORG=YES                                               12918002
         EJECT                                                          12918402
         IHACCW  DSECT=YES                                              12918802
           END                                                          12920020
./  ADD  SSI=71510298,NAME=IGG0196Q
         TITLE 'IGG0196Q- DEVICE DEPENDENT EXECUTOR FOR 3800 PRINTER   *00001000
                        '                                               00002000
IGG0196Q CSECT ,                                                   0001 00003000
@MAINENT BALR  @15,0                                               0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(24)                                             0001 00007000
         DC    C'IGG0196Q04/01/75@Z40MSMI'                         0001 00008000
         DROP  @15                                                      00009000
@PROLOG  BALR  @03,0                                               0001 00010000
@PSTART  DS    0H                                                  0001 00011000
         USING @PSTART,@03                                         0001 00012000
*START:                             /* BEGINING OF CODE FOR RELOOP   */ 00013000
*   DCBPTR=USERPRML;                /* ADDRESS OF THE DCB            */ 00014000
START    L     DCBPTR,USERPRML(,RPARC)                             0096 00015000
*   RCORE=WTGCORE;                  /* ADDRESS OF WORK AREA          */ 00016000
         L     RCORE,WTGCORE-1(,RWTGC)                             0097 00017000
         LA    RCORE,0(,RCORE)                                     0097 00018000
*   RFY                                                            0098 00019000
*    (GPR15F) RSTD;                                                0098 00020000
*   GPR15F=WTGPREFX;                /* POINTER TO PREFIX FOR IECRES  */ 00021000
         L     GPR15F,WTGPREFX(,RWTG)                              0099 00022000
*/********************************************************************/ 00023000
*/*      GETMAIN 48 BYTES IN KEY 5 SUBPOOL 230                       */ 00024000
*/*      THE AREA IS CLEARED BY IFG019RA                             */ 00025000
*/********************************************************************/ 00026000
*                                                                  0100 00027000
*   GEN REFS(IECREGSV,CVTDMSR,CVT);                                0100 00028000
    IECRES GET,LV=48,PREFIX=YES,ID=SPPL,STM=(2,15,IECREGSV(GPR15F))     00029000
*   RFY                                                            0101 00030000
*    (GPR15F) UNRSTD;                                              0101 00031000
*   RFY                                                            0102 00032000
*    (GPR01F) RSTD;                                                0102 00033000
*   RFY                                                            0103 00034000
*     SPPARM                        /* ADDRESSABILITY TO SPP         */ 00035000
*         BASED(SPPPTR);                                           0103 00036000
*   SPPPTR=GPR01F;                  /* ADDRESS OF AREA TO BLD SPP    */ 00037000
         LR    SPPPTR,GPR01F                                       0104 00038000
*   RFY                                                            0105 00039000
*    (GPR01F) UNRSTD;                                              0105 00040000
*                                                                  0105 00041000
*/********************************************************************/ 00042000
*/*                    3800 ERP WORK AREA                            */ 00043000
*/********************************************************************/ 00044000
*                                                                  0106 00045000
*   IF UCBMDRBA=0                   /* IF A WK AREA PTR ISNT THERE   */ 00046000
*     THEN                                                         0106 00047000
         L     @12,DCBDEBA+39(,DCBPTR)                             0106 00048000
         L     @12,DEBSUCBA(,@12)                                  0106 00049000
         L     @12,UCBXTADR(,@12)                                  0106 00050000
         L     @12,UCBMDRBA-1(,@12)                                0106 00051000
         LA    @12,0(,@12)                                         0106 00052000
         LTR   @12,@12                                             0106 00053000
         BNZ   @RF00106                                            0106 00054000
*     DO;                           /* THEN GETMAIN ONE              */ 00055000
*       DO;                         /* MODESET EXTKEY(ZERO)          */ 00056000
*         SPKA(0);                  /* SET PSW KEY                   */ 00057000
         SLR   @12,@12                                             0109 00058000
         SPKA  0(@12)                                              0109 00059000
*       END;                        /* MODESET EXTKEY(ZERO) GO TO KEY   00060000
*                                      ZERO TO CHANGE UCB            */ 00061000
*/********************************************************************/ 00062000
*/*      GETMAIN 164 BYTES IN KEY 0 SUBPOOL 245                      */ 00063000
*/********************************************************************/ 00064000
*                                                                  0111 00065000
*       DO;                         /* GETMAIN (R) LV(164)SP(245)    */ 00066000
*         RESPECIFY                                                0112 00067000
*          (GPR01F,                                                0112 00068000
*           GPR00F) RESTRICTED;                                    0112 00069000
*         GPR00F=164;               /* LENGTH REQUESTED              */ 00070000
         LA    GPR00F,164                                          0113 00071000
*         GPR01F=245;               /* SP IN REG 1                   */ 00072000
         LA    GPR01F,245                                          0114 00073000
*         GEN(SLL   GPR01F,24)                                     0115 00074000
*         NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;             0115 00075000
         SLL   GPR01F,24                                                00076000
*         GPR00F=GPR00F|GPR01F;     /* SP IN HIGH BYTE               */ 00077000
         OR    GPR00F,GPR01F                                       0116 00078000
*         GPR01F=-1;                /* INDICATE A GETMAIN REQUEST    */ 00079000
         SLR   GPR01F,GPR01F                                       0117 00080000
         BCTR  GPR01F,0                                            0117 00081000
*         SVC(10);                  /* R-FORM OF GETMAIN             */ 00082000
         SVC   10                                                  0118 00083000
*         RESPECIFY                                                0119 00084000
*          (GPR01F,                                                0119 00085000
*           GPR00F) UNRESTRICTED;                                  0119 00086000
*       END;                        /* GETMAIN (R) LV(164)SP(245)  0120 00087000
*                                      GETMAIN ERP WORKAREA          */ 00088000
*       RFY                                                        0121 00089000
*        (GPR01F) RSTD;                                            0121 00090000
*       UCBMDRBA=GPR01F;            /* PUT IN ADDRESS                */ 00091000
         L     @12,DCBDEBA+39(,DCBPTR)                             0122 00092000
         L     @12,DEBSUCBA(,@12)                                  0122 00093000
         L     @12,UCBXTADR(,@12)                                  0122 00094000
         STCM  GPR01F,7,UCBMDRBA(@12)                              0122 00095000
*       RFY                                                        0123 00096000
*        (GPR01F) UNRSTD;                                          0123 00097000
*       DO;                         /* MODESET EXTKEY(DATAMGT)       */ 00098000
*         SPKA(80);                 /* SET PSW KEY                   */ 00099000
         LA    @12,80                                              0125 00100000
         SPKA  0(@12)                                              0125 00101000
*       END;                        /* MODESET EXTKEY(DATAMGT) BACK     00102000
*                                      TO KEY FIVE                   */ 00103000
*     END;                                                         0127 00104000
*                                                                  0128 00105000
*/********************************************************************/ 00106000
*/*      *****    CONSTRUCT SETPRT PARAMETER LIST   (SPP)  *****     */ 00107000
*/********************************************************************/ 00108000
*/*      IF THERE IS NO JFCBE PRESENT, AN ESSENTIALLY ZEROED-OUT     */ 00109000
*/*      PARAM LIST WILL BE SENT TO SETPRT (ONLY THE EODS REQUEST BIT*/ 00110000
*/*      WILL BE ON). WHEN A JFCBE IS PRESENT, EACH FIELD THAT MAY   */ 00111000
*/*      CONTAIN A VALUE IS TESTED TO SEE IF A SPECICATION IS        */ 00112000
*/*      PRESENT BEFORE THAT FIELD IS MOVED INTO THE SETPRT LIST.    */ 00113000
*/*      JFCBE FIELD WHICH MAY CONTAIN ALPHABETIC VALUES CONTAIN     */ 00114000
*/*      BLANKS WHEN THE FIELD HAS NO VALUE SPECIFIED. SIMILARLY,    */ 00115000
*/*      FIELDS WHICH MAY CONTAIN NUMERIC VALUES ARE SET TO ZERO     */ 00116000
*/*      WHEN NOTHING HAS BEEN SPECIFIED.                            */ 00117000
*/*      THIS RELATIONSHIP DOES NOT HOLD FOR THE SETPRT LIST, AS ANY */ 00118000
*/*      FIELD WHICH HAS NO VALUE SPECIFIED FOR IT REMAINS ZERO.     */ 00119000
*/*                                                                  */ 00120000
*/********************************************************************/ 00121000
*                                                                  0128 00122000
*   IF JFCBEXTP=ON                  /* IS THERE A JFCBE              */ 00123000
*     THEN                                                         0128 00124000
@RF00106 LA    @12,100                                             0128 00125000
         ALR   @12,RCORE                                           0128 00126000
         TM    JFCBEXTP(@12),B'10000000'                           0128 00127000
         BNO   @RF00128                                            0128 00128000
*     DO;                           /* YES, BUILD SPP ACCORDINGLY    */ 00129000
*       JFCBEPTR=JFCBEXAD+16;       /* SET BASE FOR JFCB EXT PLUS 16    00130000
*                                      FOR SWA PREFIX                */ 00131000
         L     @10,JFCBEXAD-1(,@12)                                0130 00132000
         LA    @10,16(,@10)                                        0130 00133000
         LR    JFCBEPTR,@10                                        0130 00134000
*/********************************************************************/ 00135000
*/*           GENERAL FLAG BYTES                                     */ 00136000
*/********************************************************************/ 00137000
*/*           DATA CHECK ALLOWED OR NOT (FROM JFCB)                  */ 00138000
*                                                                  0131 00139000
*       IF JFCALLOW=ON              /* IS ALLOW CHECK INDICATED      */ 00140000
*         THEN                      /* YES, SET IN SPP ALSO          */ 00141000
         TM    JFCALLOW(@12),B'01000000'                           0131 00142000
         BNO   @RF00131                                            0131 00143000
*         SPPFBLK=ON;                                              0132 00144000
*                                                                  0132 00145000
         OI    SPPFBLK(SPPPTR),B'10000000'                         0132 00146000
*/********************************************************************/ 00147000
*/*           STACKING MODE:  BURST OR CONTINUOUS                    */ 00148000
*/********************************************************************/ 00149000
*                                                                  0133 00150000
*       IF JFCBBST=ON               /* IS BURST MODE INDICATED       */ 00151000
*         THEN                      /* YES, SET BURST BIT IN SPP     */ 00152000
@RF00131 TM    JFCBBST(JFCBEPTR),B'00000010'                       0133 00153000
         BNO   @RF00133                                            0133 00154000
*         SPPBURST=ON;                                             0134 00155000
*                                                                  0134 00156000
         OI    SPPBURST(SPPPTR),B'10000000'                        0134 00157000
*       /*************************************************************/ 00158000
*       /*                                                           */ 00159000
*       /* NUMBER OF COPIES TO BE PRINTED NOTE- THE JFCBE CONTAINS   */ 00160000
*       /* 0-8 SUB-N COUNT FIELDS FOR COPIES GROUPINGS. ONLY THE 1ST,*/ 00161000
*       /* IF PRESENT, IS USABLE AT OPEN TIME. FOR THE DIRECT USER IS*/ 00162000
*       /* THE USER'S RESPONSIBILTY, AND FOR SYSOUT THE JES SUBSYTEM */ 00163000
*       /* HAS GROUPING INFORMATION.                                 */ 00164000
*       /*                                                           */ 00165000
*       /*************************************************************/ 00166000
*                                                                  0135 00167000
*       IF JFCGRP1=0                /* IF 1ST SUB-N NOT SPECIFIED    */ 00168000
*         THEN                      /* THEN SUPPLY DEFAULT VALUE     */ 00169000
@RF00133 CLI   JFCGRP1(JFCBEPTR),0                                 0135 00170000
         BNE   @RF00135                                            0135 00171000
*         SPPCPYNR=1;               /* DEFAULT OF 1 COPY IN SPP      */ 00172000
         MVI   SPPCPYNR(SPPPTR),X'01'                              0136 00173000
*       ELSE                        /* VALUE IS SPECIFIED BY USER    */ 00174000
*         SPPCPYNR=JFCGRP1;         /* USE THE SPECIFIED COUNT       */ 00175000
         B     @RC00135                                            0137 00176000
@RF00135 IC    @12,JFCGRP1(,JFCBEPTR)                              0137 00177000
         STC   @12,SPPCPYNR(,SPPPTR)                               0137 00178000
*/********************************************************************/ 00179000
*/*           FORMS FLASHING INFORMATION                             */ 00180000
*/********************************************************************/ 00181000
*/*           SPPIMAGE IS A 4 CHAR FLASH CARTRIDGE ID                */ 00182000
*                                                                  0138 00183000
*       IF JFCBMAGT(1:1)=BLANK     /* IS AN ID PRESENT              */ 00184000
*         THEN                                                     0138 00185000
@RC00135 CLI   JFCBMAGT(JFCBEPTR),C' '                             0138 00186000
         BE    @RF00138                                            0138 00187000
*         DO;                       /* YES                           */ 00188000
*           SPPIMAGE=JFCBMAGT;      /* MOVE IN CART. ID              */ 00189000
         MVC   SPPIMAGE(4,SPPPTR),JFCBMAGT(JFCBEPTR)               0140 00190000
*           IF JFCIMTOT=0          /* IS THERE A COUNT FOR FLASHNG  */ 00191000
*             THEN                  /* YES (DEFAULT IS 1)            */ 00192000
         CLI   JFCIMTOT(JFCBEPTR),0                                0141 00193000
         BE    @RF00141                                            0141 00194000
*             SPPFRMNR=JFCIMTOT;    /* SET FLASH COUNT IN SPP        */ 00195000
         IC    @12,JFCIMTOT(,JFCBEPTR)                             0142 00196000
         STC   @12,SPPFRMNR(,SPPPTR)                               0142 00197000
*         END;                                                     0143 00198000
*                                                                  0143 00199000
@RF00141 DS    0H                                                  0144 00200000
*/********************************************************************/ 00201000
*/*           COPY MODIFICATION INFORMATION                          */ 00202000
*/********************************************************************/ 00203000
*/*           SPPMODPT IS THE COPY MODIF DATA ID ON IMAGELIB         */ 00204000
*                                                                  0144 00205000
*       IF JFCMODIF(1:1)=BLANK     /* IS AN ID PRESENT              */ 00206000
*         THEN                                                     0144 00207000
@RF00138 CLI   JFCMODIF(JFCBEPTR),C' '                             0144 00208000
         BE    @RF00144                                            0144 00209000
*         DO;                       /* YES                           */ 00210000
*           SPPMODPT=JFCMODIF;      /* PUT ID INTO SPP               */ 00211000
*                                                                  0146 00212000
         L     @12,JFCMODIF(,JFCBEPTR)                             0146 00213000
         ST    @12,SPPMODPT(,SPPPTR)                               0146 00214000
*           /*********************************************************/ 00215000
*           /*                                                       */ 00216000
*           /* SPPTRC IS THE TRC TO WHICH COPY MOD IS TO APPLY       */ 00217000
*           /*                                                       */ 00218000
*           /*********************************************************/ 00219000
*                                                                  0147 00220000
*           IF JFCIDTRC=0          /* IS A TRC SPECIFIED            */ 00221000
*             THEN                  /* YES, MOVE IT INTO SPP         */ 00222000
         CLI   JFCIDTRC(JFCBEPTR),0                                0147 00223000
         BE    @RF00147                                            0147 00224000
*             SPPTRC=JFCIDTRC;      /* DEFAULT IS TRC 0              */ 00225000
         MVC   SPPTRC(1,SPPPTR),JFCIDTRC(JFCBEPTR)                 0148 00226000
*         END;                                                     0149 00227000
*                                                                  0149 00228000
@RF00147 DS    0H                                                  0150 00229000
*/********************************************************************/ 00230000
*/*           TRANSLATE TABLES- 0 TO 4 4-CHAR ID'S                   */ 00231000
*/********************************************************************/ 00232000
*/*      THE FIRST ID THAT STARTS WITH A BLANK SIGNIFIES THE END OF  */ 00233000
*/*      THE LIST. IF THE FIRST ID IS BLANK THERE ARE NO ID'S TO MOVE*/ 00234000
*                                                                  0150 00235000
*       IF JFCBTRS1(1:1)=BLANK THEN                                0150 00236000
@RF00144 CLI   JFCBTRS1(JFCBEPTR),C' '                             0150 00237000
         BE    @RT00150                                            0150 00238000
*         ;                         /* NO ID'S TO MOVE               */ 00239000
*       ELSE                                                       0152 00240000
*         IF JFCBTRS2(1:1)=BLANK THEN/* MOVE ONE ID                  */ 00241000
         CLI   JFCBTRS2(JFCBEPTR),C' '                             0152 00242000
         BNE   @RF00152                                            0152 00243000
*           SPPXLT1A=JFCBTRS1;                                     0153 00244000
         MVC   SPPXLT1A(4,SPPPTR),JFCBTRS1(JFCBEPTR)               0153 00245000
*         ELSE                                                     0154 00246000
*           IF JFCBTRS3(1:1)=BLANK THEN/* MOVE TWO ID'S              */ 00247000
         B     @RC00152                                            0154 00248000
@RF00152 CLI   JFCBTRS3(JFCBEPTR),C' '                             0154 00249000
         BNE   @RF00154                                            0154 00250000
*             SPPXLT1A(1:2*LENGTH(SPPXLT1A))=JFCBTRS1(1:2*LENGTH(  0155 00251000
*                 JFCBTRS1));                                      0155 00252000
         MVC   SPPXLT1A(8,SPPPTR),JFCBTRS1(JFCBEPTR)               0155 00253000
*           ELSE                                                   0156 00254000
*             IF JFCBTRS4(1:1)=BLANK THEN/* MOVE THREE ID'S          */ 00255000
         B     @RC00154                                            0156 00256000
@RF00154 CLI   JFCBTRS4(JFCBEPTR),C' '                             0156 00257000
         BNE   @RF00156                                            0156 00258000
*               SPPXLT1A(1:3*LENGTH(SPPXLT1A))=JFCBTRS1(1:3*LENGTH(     00259000
*                   JFCBTRS1));                                    0157 00260000
         MVC   SPPXLT1A(12,SPPPTR),JFCBTRS1(JFCBEPTR)              0157 00261000
*             ELSE                  /* MOVE FOUR ID'S                */ 00262000
*               SPPXLT1A(1:4*LENGTH(SPPXLT1A))=JFCBTRS1(1:4*LENGTH(     00263000
*                   JFCBTRS1));                                    0158 00264000
         B     @RC00156                                            0158 00265000
@RF00156 MVC   SPPXLT1A(16,SPPPTR),JFCBTRS1(JFCBEPTR)              0158 00266000
*     END;                          /* END OF DO GROUP FOR JFCBE   0159 00267000
*                                      EXISTS                        */ 00268000
@RC00156 DS    0H                                                  0159 00269000
@RC00154 DS    0H                                                  0159 00270000
@RC00152 DS    0H                                                  0159 00271000
@RT00150 DS    0H                                                  0160 00272000
*/********************************************************************/ 00273000
*                                                                  0160 00274000
*                                                                  0160 00275000
*/********************************************************************/ 00276000
*/*       MINIMUM SPP  IRRESPECTIVE OF JFCBE EXISTANCE OR NOT        */ 00277000
*/********************************************************************/ 00278000
*/********************************************************************/ 00279000
*/*           FCB INFORMATION   (FROM MAIN JFCB)                     */ 00280000
*/********************************************************************/ 00281000
*                                                                  0160 00282000
*   IF JFCFCBID(1:1)=BLANK         /* IS AN ID SPECIFIED            */ 00283000
*     THEN                                                         0160 00284000
@RF00128 LA    @12,100                                             0160 00285000
         ALR   @12,RCORE                                           0160 00286000
         CLI   JFCFCBID(@12),C' '                                  0160 00287000
         BE    @RF00160                                            0160 00288000
*     DO;                           /* YES, GET ID                   */ 00289000
*       SPPFCB=JFCFCBID;                                           0162 00290000
         MVC   SPPFCB(4,SPPPTR),JFCFCBID(@12)                      0162 00291000
*       IF JFCFCBVR=ON              /* IS FCB VERIFY SPECIFIED       */ 00292000
*         THEN                      /* YES, INDICATE IN SPP          */ 00293000
         TM    JFCFCBVR(@12),B'00000100'                           0163 00294000
         BNO   @RF00163                                            0163 00295000
*         SPPVERIF=ON;                                             0164 00296000
         OI    SPPVERIF(SPPPTR),B'10000000'                        0164 00297000
*     END;                                                         0165 00298000
*                                                                  0165 00299000
@RF00163 DS    0H                                                  0166 00300000
*   /*****************************************************************/ 00301000
*   /*                                                               */ 00302000
*   /* SET NUMBER OF COPIES                                          */ 00303000
*   /*                                                               */ 00304000
*   /*****************************************************************/ 00305000
*                                                                  0166 00306000
*   IF SPPCPYNR=0                   /* WAS COPIES NOT SET ABOVE      */ 00307000
*     THEN                          /* YES, SO SET IT NOW            */ 00308000
@RF00160 CLI   SPPCPYNR(SPPPTR),0                                  0166 00309000
         BNE   @RF00166                                            0166 00310000
*     SPPCPYNR=1;                   /* NO JFCBE, SO DEFAULT = 1      */ 00311000
         MVI   SPPCPYNR(SPPPTR),X'01'                              0167 00312000
*   ELSE                                                           0168 00313000
*     ;                             /* FIELD HAS VALUE, SO WAS SET   */ 00314000
@RF00166 DS    0H                                                  0169 00315000
*   SPPSTCNR=1;                     /* START COPY NO. MUST BE 1      */ 00316000
         MVI   SPPSTCNR(SPPPTR),X'01'                              0169 00317000
*/********************************************************************/ 00318000
*/*           EODS BIT  (END-OF-DATA-SET. CAUSE DEVICE RESET         */ 00319000
*/*                    BEFORE SETUP FOR THIS USER REQUIREMENTS       */ 00320000
*/********************************************************************/ 00321000
*                                                                  0170 00322000
*   SPPINIT=ON;                     /* TURN ON INIT INDICATOR BIT    */ 00323000
         OI    SPPINIT(SPPPTR),B'00100000'                         0170 00324000
*   SPPEXTL=ON;                     /* INDICATE EXTENDED SPP LIST    */ 00325000
         OI    SPPEXTL(SPPPTR),B'00000001'                         0171 00326000
*/********************************************************************/ 00327000
*/*              SETPRT PARM LIST BUILD COMPLETE                     */ 00328000
*/********************************************************************/ 00329000
*                                                                  0172 00330000
*                                                                  0172 00331000
*/********************************************************************/ 00332000
*/*            INVOKE SETPRT AND ANALYZE RETURN CODE                 */ 00333000
*/********************************************************************/ 00334000
*                                                                  0172 00335000
*   GEN(SETPRT  (DCBPTR),MF=(E,(SPPPTR)));                         0172 00336000
         SETPRT  (DCBPTR),MF=(E,(SPPPTR))                               00337000
*   RFY                                                            0173 00338000
*    (GPR00F,                                                      0173 00339000
*     GPR15F) RSTD;                                                0173 00340000
*   IF GPR15F=0                    /* IF RETURN SHOWS UNSUCCESSFUL  */ 00341000
*       &GPR15F='3C'X              /* BURST NOT AVAIL ACCEPTABLE    */ 00342000
*     THEN                                                         0174 00343000
         LTR   GPR15F,GPR15F                                       0174 00344000
         BZ    @RF00174                                            0174 00345000
         C     GPR15F,@CF02937                                     0174 00346000
         BE    @RF00174                                            0174 00347000
*     DO;                           /* THEN ABEND OUT                */ 00348000
*       CALL ABENDXIT;              /* ISSUE MESSAGE AND SET FOR PD  */ 00349000
         BAL   @14,ABENDXIT                                        0176 00350000
*       GO TO TCTLRTN;              /* GO ISSUE ABEND                */ 00351000
         B     TCTLRTN                                             0177 00352000
*     END;                                                         0178 00353000
*   ELSE                                                           0179 00354000
*     ;                                                            0179 00355000
@RF00174 DS    0H                                                  0180 00356000
*   RFY                                                            0180 00357000
*    (GPR00F) UNRSTD;                                              0180 00358000
*   GPR15F=WTGPREFX;                /* NEEDED FOR IECRES MACRO       */ 00359000
         L     GPR15F,WTGPREFX(,RWTG)                              0181 00360000
*/********************************************************************/ 00361000
*/* FREE THE SETPRT PARAMETER LIST. IFG019RA FINDS THE LENGTH, KEY   */ 00362000
*/* AND SUBPOOL FROM THE PREFIX IT BUILT A GET TIME.                 */ 00363000
*/********************************************************************/ 00364000
*                                                                  0182 00365000
*   GEN REFS(IECREGSV,CVTDMSR,CVT);                                0182 00366000
*                                      /*FREE SETPRT PARM LIST       */ 00367000
   IECRES FREE,PREFIX=YES,A=(SPPPTR),STM=(2,15,IECREGSV(GPR15F))        00368000
*   RFY                                                            0183 00369000
*    (GPR15F) UNRSTD;                                              0183 00370000
*                                                                  0183 00371000
*/********************************************************************/ 00372000
*/*  PROCESSING FOR THIS EXECUTOR NOW COMPLETE. GO TO NEXT EXEC      */ 00373000
*/********************************************************************/ 00374000
*                                                                  0184 00375000
*                                                                  0184 00376000
*/********************************************************************/ 00377000
*/********************************************************************/ 00378000
*/*                          EXIT     OUT                            */ 00379000
*/********************************************************************/ 00380000
*/********************************************************************/ 00381000
*/********************************************************************/ 00382000
*/*                     SET EXCP EXECUTOR                            */ 00383000
*/********************************************************************/ 00384000
*                                                                  0184 00385000
*   WTGIDTTR=SOP1911;               /* EXCP EXEC IS IGG01911         */ 00386000
         MVC   WTGIDTTR(5,RWTGC),SOP1911                           0184 00387000
*/********************************************************************/ 00388000
*/*                 TEST FOR AN EXCP DCB                             */ 00389000
*/********************************************************************/ 00390000
*                                                                  0185 00391000
*   IF DCBMFECP=ON                  /* IS EXCP BIT IN DCBMACRF ON    */ 00392000
*     THEN                          /* YES, TAKE EXCP PATH           */ 00393000
         TM    DCBMFECP+40(DCBPTR),B'10000000'                     0185 00394000
         BO    @RT00185                                            0185 00395000
*     GO TO RELOOP;                                                0186 00396000
*                                                                  0186 00397000
*/********************************************************************/ 00398000
*/*                 SET BUFFER BUILD EXECUTOR                        */ 00399000
*/********************************************************************/ 00400000
*                                                                  0187 00401000
*   WTGIDTTR=SOP191I;               /* BFR BLD EXEC IS IGG0191I      */ 00402000
         MVC   WTGIDTTR(5,RWTGC),SOP191I                           0187 00403000
*/********************************************************************/ 00404000
*/*             TEST IF SYSTEM TO GET BUFFERS:                       */ 00405000
*/*                IF QSAM: BUFCA=1  (LO BIT)                        */ 00406000
*/*                IF BSAM: BUFCA=1 & BUFNO =0                      */ 00407000
*/********************************************************************/ 00408000
*                                                                  0188 00409000
*   IF DCBCNQSM=ON                  /* IS QSAM BIT IN DCBCIND2 ON    */ 00410000
*     THEN                          /* YES, IT IS QSAM               */ 00411000
         TM    DCBCNQSM+52(DCBPTR),B'00000001'                     0188 00412000
         BNO   @RF00188                                            0188 00413000
*     IF BUFCABIT=ON                /* IS LO BIT IN DCBBUFCA ON      */ 00414000
*       THEN                        /* YES, SET FOR 191I             */ 00415000
         TM    BUFCABIT+16(DCBPTR),B'00000001'                     0189 00416000
         BO    @RT00189                                            0189 00417000
*       GO TO RELOOP;                                              0190 00418000
*     ELSE                                                         0191 00419000
*       ;                                                          0191 00420000
*   ELSE                            /* NO, IT IS BSAM                */ 00421000
*     IF DCBBUFNO=0                /* IF BUFNO IS NOT SET TO 0      */ 00422000
*         &BUFCABIT=ON              /* AND THE BIT IN BUFCA IS ON    */ 00423000
*       THEN                        /* THEN SET FOR BUFFER EXEC      */ 00424000
         B     @RC00188                                            0192 00425000
@RF00188 LA    @12,16                                              0192 00426000
         ALR   @12,DCBPTR                                          0192 00427000
         CLI   DCBBUFNO(@12),0                                     0192 00428000
         BE    @RF00192                                            0192 00429000
         TM    BUFCABIT(@12),B'00000001'                           0192 00430000
         BO    @RT00192                                            0192 00431000
*       GO TO RELOOP;                                              0193 00432000
*                                                                  0193 00433000
*/********************************************************************/ 00434000
*/*                SET CHAINED SCHED EXECUTOR                        */ 00435000
*/********************************************************************/ 00436000
*                                                                  0194 00437000
*   WTGIDTTR=SOP191Q;               /* CHAINED SCHED EXEC IS 191Q    */ 00438000
@RF00192 DS    0H                                                  0194 00439000
@RC00188 MVC   WTGIDTTR(5,RWTGC),SOP191Q                           0194 00440000
*/********************************************************************/ 00441000
*/*                TEST FOR CHAINED SCHED DCB                        */ 00442000
*/********************************************************************/ 00443000
*                                                                  0195 00444000
*   IF DCBOPTC=ON                   /* IS CHAIN BIT IN DCBOPTCD ON   */ 00445000
*     THEN                          /* YES, TAKE CHAINED SCHED PATH  */ 00446000
         TM    DCBOPTC+52(DCBPTR),B'00100000'                      0195 00447000
         BO    @RT00195                                            0195 00448000
*     GO TO RELOOP;                                                0196 00449000
*                                                                  0196 00450000
*/********************************************************************/ 00451000
*/*                 SET UNIT RECORD EXECUTOR                         */ 00452000
*/********************************************************************/ 00453000
*                                                                  0197 00454000
*   WTGIDTTR=SOP191G;               /* MUST BE NORMAL SCHED          */ 00455000
         MVC   WTGIDTTR(5,RWTGC),SOP191G                           0197 00456000
*                                                                  0198 00457000
*/********************************************************************/ 00458000
*/*              SEE IF THIS EXEC NEEDED AGAIN                       */ 00459000
*/********************************************************************/ 00460000
*                                                                  0198 00461000
*RELOOP:                                                           0198 00462000
*   RPARC=RPARC+LENGTH(USERPRML);   /* UPDATE PARM POINTER           */ 00463000
RELOOP   LA    RPARC,4(,RPARC)                                     0198 00464000
*   RWTGC=RWTGC+LENGTH(WTGENTRY);   /* UPDATE CURRENT PTR            */ 00465000
         LA    RWTGC,8(,RWTGC)                                     0199 00466000
*   IF WTGEID=AMIDCNST              /* THIS ROUTINE ID               */ 00467000
*     THEN                                                         0200 00468000
         CLC   WTGEID(2,RWTGC),AMIDCNST                            0200 00469000
         BE    @RT00200                                            0200 00470000
*     GO TO START;                  /* THIS ROUTINE IS NEEDED AGAIN  */ 00471000
*   IF WTGEID=OPIDCNST             /* COMMON OPEN RETURN ID         */ 00472000
*     THEN                                                         0202 00473000
         CLC   WTGEID(2,RWTGC),OPIDCNST                            0202 00474000
         BNE   @RT00202                                            0202 00475000
*     GO TO RELOOP;                 /* MORE ROUTINES TO CHECK        */ 00476000
*   RPARC=RPAR;                     /* REINITIALIZE PARAMETER PTR    */ 00477000
         LR    RPARC,RPAR                                          0204 00478000
*   RWTGC=RWTG+LENGTH(WTG);         /* REINIT WTGENTRY PTR           */ 00479000
         LA    RWTGC,32(,RWTG)                                     0205 00480000
*/********************************************************************/ 00481000
*/*     IT HAS NOW BEEN DETERMINED THAT THIS EXEC IS NOT IN ANOTHER  */ 00482000
*/*     ENTRY IN THIS STRING.  WE WILL GIVE CONTROL TO THE FIRST NON */ 00483000
*/*     ZERO ENTRY IN THE STRING.                                    */ 00484000
*/********************************************************************/ 00485000
*                                                                  0206 00486000
*ZCHECK:                                                           0206 00487000
*   IF WTGEID(1:1)=0 THEN                                         0206 00488000
ZCHECK   CLI   WTGEID(RWTGC),0                                     0206 00489000
         BNE   @RT00206                                            0206 00490000
*     GO TO TCTLRTN;                /* ENTRY NOT ZERO GO TO IT       */ 00491000
*   RWTGC=RWTGC+LENGTH(WTGENTRY);   /* UPDATE WTG PTR                */ 00492000
         LA    RWTGC,8(,RWTGC)                                     0208 00493000
*   RPARC=RPARC+LENGTH(USERPRML);   /* UPDATE PARM PTR               */ 00494000
         LA    RPARC,4(,RPARC)                                     0209 00495000
*   GO TO ZCHECK;                   /* CHECK NEXT ENTRY              */ 00496000
         B     ZCHECK                                              0210 00497000
*/********************************************************************/ 00498000
*/*   AT THIS POINT RWTGC POINTS TO THE NEXT ENTRY IN THE WTGTABLE.  */ 00499000
*/*   IECRES WILL BE USED TO GIVE CONTROL TO THE NEXT EXECUTOR.      */ 00500000
*/********************************************************************/ 00501000
*                                                                  0211 00502000
*TCTLRTN:                                                          0211 00503000
*   WTGMODID=WTGEID;                /* ID OF NEXT MODULE             */ 00504000
TCTLRTN  MVC   WTGMODID(2,RWTG),WTGEID(RWTGC)                      0211 00505000
*   WTGMODEP=WTGEADDR;              /* ADDRESS OF NEXT MOD           */ 00506000
         SLR   @12,@12                                             0212 00507000
         ICM   @12,7,WTGEADDR(RWTGC)                               0212 00508000
         ST    @12,WTGMODEP(,RWTG)                                 0212 00509000
*   GEN REFS(WTGPREFX,IECREGSV,WTGMODNM,CVTDMSR,CVT);              0213 00510000
         USING WTGMODNM,RWTG           BASE FOR IECRES                  00511000
         IECRES LOAD,PREFIX=WTGPREFX(,RWTG),BRANCH=DIRECT               00512000
         DROP  RWTG                                                     00513000
*                                                                  0214 00514000
*/********************************************************************/ 00515000
*/*      SUBROUTINE          ABENDXIT                                */ 00516000
*/********************************************************************/ 00517000
*/*  1.  UNSUCCESSFUL RETURN FROM SETPRT RESULTS IN THE ISSUANCE     */ 00518000
*/*      OF TWO MESSAGES, THE 1ST,ROUTED TO BOTH OPERATOR AND        */ 00519000
*/*      PROGRAMMER, IS IEC162I TO FACILITATE SUPPLYING THE R15      */ 00520000
*/*      AND R0 RETURN/REASON CODES. THE 2ND IS IEC141I ISSUED       */ 00521000
*/*      BY PROBLEM DETERMINATION TO SIGNIFY A 013-CC  ABEND.        */ 00522000
*/*                                                                  */ 00523000
*/********************************************************************/ 00524000
*                                                                  0214 00525000
*ABENDXIT:                                                         0214 00526000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0214 00527000
ABENDXIT DS    0H                                                  0215 00528000
*   RFY                                                            0215 00529000
*    (GPR00F,                                                      0215 00530000
*     GPR14F,                                                      0215 00531000
*     GPR15F) RSTD;                                                0215 00532000
*                                                                  0215 00533000
*/********************************************************************/ 00534000
*/*      USE IECRES LOAD TO GET THE ADDRESS OF THE MESSAGE CSECT     */ 00535000
*/********************************************************************/ 00536000
*                                                                  0216 00537000
*   SPPRTNCD=GPR15F;                /* PRESERVE R15 RTN CODE         */ 00538000
         LR    SPPRTNCD,GPR15F                                     0216 00539000
*   WTGMODNM='IGGMSG01';            /* NAME FOR MSG CSECT            */ 00540000
         MVC   WTGMODNM(8,RWTG),@CC02948                           0217 00541000
*   WTGMODEP=0;                     /* CLEAR ADDRESS AREA            */ 00542000
         SLR   @12,@12                                             0218 00543000
         ST    @12,WTGMODEP(,RWTG)                                 0218 00544000
*   GEN;                                                           0219 00545000
*        IECRES LOAD,PREFIX=WTGPREFX(RWTG),BRANCH=NO                    00546000
         L     15,WTGPREFX(,RWTG)     GET POINTER TO A PREFIX           00547000
         STM   0,14,IECREGSV-IECPREFX(15) SAVE REGISTERS                00548000
         LA    6,WTGMODNM-WTG(RWTG)    LOAD PTR TO WTG MODULE NAME      00549000
         L     5,CVTPTR(,0)            LOAD ADDRESS OF CVT              00550000
         L     5,CVTDMSR-CVT(,5)       LOAD ADDRESS OF IFG019RA         00551000
         BAL   14,24(,5)               LOAD AND RETURN                  00552000
         LM    0,14,IECREGSV-IECPREFX(15) RESTORE REGISTERS             00553000
*   GPR15F=SPPRTNCD;                /* RESTORE R15 RTN CODE          */ 00554000
         LR    GPR15F,SPPRTNCD                                     0220 00555000
*   MSGPTR=WTGMODEP;                /* ADDRESS OF MSG CSECT          */ 00556000
         L     MSGPTR,WTGMODEP(,RWTG)                              0221 00557000
*   WTGMODNM=MODID;                 /* RESET MOD NAME PREFIX         */ 00558000
         MVC   WTGMODNM(8,RWTG),MODID                              0222 00559000
*   WTGMODEP=0;                     /* CLEAR MODEP                   */ 00560000
         SLR   @12,@12                                             0223 00561000
         ST    @12,WTGMODEP(,RWTG)                                 0223 00562000
*   RFY                                                            0224 00563000
*     MSGINDEX BASED(MSGPTR);                                      0224 00564000
*   MSGAREA=MSGTXT(1:MSGLNG+1);     /* MOVE MSG INTO OPEN WRK AREA   */ 00565000
         MVI   MSGAREA+1(RCORE),C' '                               0225 00566000
         MVC   MSGAREA+2(98,RCORE),MSGAREA+1(RCORE)                0225 00567000
         LR    @12,MSGPTR                                          0225 00568000
         AH    @12,MSGINDOF+50(,MSGPTR)                            0225 00569000
         SLR   @10,@10                                             0225 00570000
         IC    @10,MSGLNG(,@12)                                    0225 00571000
         SLR   @09,@09                                             0225 00572000
         IC    @09,MSGOFF(,@12)                                    0225 00573000
         ALR   @09,@12                                             0225 00574000
         EX    @10,@SM02959                                        0225 00575000
*   RFY                                                            0226 00576000
*     MSGTXTD BASED(RCORE);                                        0226 00577000
*                                                                  0226 00578000
*/********************************************************************/ 00579000
*/*        PUT UNIT ADDR INTO THE MESSAGE                            */ 00580000
*/********************************************************************/ 00581000
*                                                                  0227 00582000
*   MSGTXT(MSGOFF1+1:MSGOFF1+3)=UCBNAME;/* MOVE UNIT TO MSG          */ 00583000
         SLR   @01,@01                                             0227 00584000
         IC    @01,MSGOFF1(,@12)                                   0227 00585000
         ALR   @01,RCORE                                           0227 00586000
         L     @10,DCBDEBA+39(,DCBPTR)                             0227 00587000
         L     @10,DEBSUCBA(,@10)                                  0227 00588000
         MVC   MSGTXT(3,@01),UCBNAME(@10)                          0227 00589000
*/********************************************************************/ 00590000
*/*        PUT REG 15 RETURN CODE (THREE BYTES) INTO THE MSG         */ 00591000
*/********************************************************************/ 00592000
*                                                                  0228 00593000
*   UNPKAREA(1:3)=GPR15F;           /* R15 INTO AREA FOR UNPACK      */ 00594000
         LA    @10,384                                             0228 00595000
         ALR   @10,RCORE                                           0228 00596000
         STCM  GPR15F,7,UNPKAREA(@10)                              0228 00597000
*   UNPK(UNPKAREA(1:7),UNPKAREA(1:4));/* UNPACK THREE (+1) HEX BYTES */ 00598000
         UNPK  UNPKAREA(7,@10),UNPKAREA(4,@10)                     0229 00599000
*   TR(UNPKAREA(1:6),TRTBL);        /* TRANSLATE TO PRINTABLE        */ 00600000
         LA    @09,TABLE                                           0230 00601000
         SL    @09,@CF00087                                        0230 00602000
         TR    UNPKAREA(6,@10),TRTBL(@09)                          0230 00603000
*   MSGTXT(MSGOFF2+1:MSGOFF2+6)=UNPKAREA(1:6);/* PLACE IN MSG        */ 00604000
*                                                                  0231 00605000
         SLR   @01,@01                                             0231 00606000
         IC    @01,MSGOFF2(,@12)                                   0231 00607000
         ALR   @01,RCORE                                           0231 00608000
         MVC   MSGTXT(6,@01),UNPKAREA(@10)                         0231 00609000
*   /*****************************************************************/ 00610000
*   /*                                                               */ 00611000
*   /* PUT REG 0 REASON CODE (1 BYTE) INTO MSG                       */ 00612000
*   /*                                                               */ 00613000
*   /*****************************************************************/ 00614000
*                                                                  0232 00615000
*   UNPKAREA(1:1)=GPR00F;           /* MOVE REASON CODE INTO WKAREA  */ 00616000
         STC   GPR00F,UNPKAREA(,@10)                               0232 00617000
*   UNPK(UNPKAREA(1:3),UNPKAREA(1:2));/* UNPK ONE (+1) HEX BYTE      */ 00618000
         UNPK  UNPKAREA(3,@10),UNPKAREA(2,@10)                     0233 00619000
*   TR(UNPKAREA(1:2),TRTBL);        /* TRANS TO PRINTABLE            */ 00620000
         TR    UNPKAREA(2,@10),TRTBL(@09)                          0234 00621000
*   MSGTXT(MSGOFF3+1:MSGOFF3+2)=UNPKAREA(1:2);/* PLACE IN MSG        */ 00622000
         SLR   @01,@01                                             0235 00623000
         IC    @01,MSGOFF3(,@12)                                   0235 00624000
         ALR   @01,RCORE                                           0235 00625000
         MVC   MSGTXT(2,@01),UNPKAREA(@10)                         0235 00626000
*/********************************************************************/ 00627000
*/*                 ISSUE  WTO  SVC                                  */ 00628000
*/********************************************************************/ 00629000
*                                                                  0236 00630000
*   GEN(WTO MF=(E,(RCORE)));        /* ISSUE WTO                     */ 00631000
         WTO MF=(E,(RCORE))                                             00632000
*/********************************************************************/ 00633000
*/*             SET UP FOR CALL TO PROBLEM DETERMINATION             */ 00634000
*/********************************************************************/ 00635000
*                                                                  0237 00636000
*   STM(GPR09F,GPR14F,DXREGSAV);    /* SAVE REGS                     */ 00637000
         STM   GPR09F,GPR14F,DXREGSAV(RCORE)                       0237 00638000
*   DXCALLID=WTGMODID;              /* SAVE THIS MOD ID              */ 00639000
         MVC   DXCALLID(2,RCORE),WTGMODID(RWTG)                    0238 00640000
*   GPR00F=OABD0118;                /* INTERNAL ABEND CODE           */ 00641000
         LA    GPR00F,118                                          0239 00642000
*   WTGIDTTR=PDLOAD;                /* ID AND ADDR OF PROB DETER     */ 00643000
         MVC   WTGIDTTR(5,RWTGC),PDLOAD                            0240 00644000
*   RETURN;                                                        0241 00645000
@EL00002 DS    0H                                                  0241 00646000
@EF00002 DS    0H                                                  0241 00647000
@ER00002 BR    @14                                                 0241 00648000
*   RFY                                                            0242 00649000
*    (GPR00F,                                                      0242 00650000
*     GPR14F,                                                      0242 00651000
*     GPR15F) UNRSTD;                                              0242 00652000
*   END ABENDXIT;                                                  0243 00653000
*   END IGG0196Q                    /* END OF MODULE                 */ 00654000
*                                                                  0244 00655000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00656000
*/*%INCLUDE SYSLIB  (CVT     )                                       */ 00657000
*/*%INCLUDE SYSLIB  (IHADCBDF)                                       */ 00658000
*/*%INCLUDE SYSLIB  (IHADCB  )                                       */ 00659000
*/*%INCLUDE SYSLIB  (IEZDEB  )                                       */ 00660000
*/*%INCLUDE SYSLIB  (IEFJFCBN)                                       */ 00661000
*/*%INCLUDE SYSLIB  (IEFJFCBE)                                       */ 00662000
*/*%INCLUDE SYSLIB  (IGGMSG  )                                       */ 00663000
*/*%INCLUDE SYSLIB  (IECDSECT)                                       */ 00664000
*/*%INCLUDE SYSLIB  (IHASPP  )                                       */ 00665000
*/*%INCLUDE SYSLIB  (IKJTCB  )                                       */ 00666000
*/*%INCLUDE SYSLIB  (IEFUCBOB)                                       */ 00667000
*/*%INCLUDE SYSLIB  (IECDSECS)                                       */ 00668000
*                                                                  0244 00669000
*       ;                                                          0244 00670000
@DATA    DS    0H                                                       00671000
@SM02959 MVC   MSGAREA(0,RCORE),MSGTXT(@09)                             00672000
@DATD    DSECT                                                          00673000
         DS    0F                                                       00674000
IGG0196Q CSECT                                                          00675000
         DS    0F                                                       00676000
@CF00087 DC    F'240'                                                   00677000
@CF02937 DC    XL4'3C'                                                  00678000
@DATD    DSECT                                                          00679000
         DS    0D                                                       00680000
@ENDDATD EQU   *                                                        00681000
IGG0196Q CSECT                                                          00682000
         NOPR  ((@ENDDATD-@DATD)*16)                                    00683000
         DS    0F                                                       00684000
@SIZDATD DC    AL1(0)                                                   00685000
         DC    AL3(@ENDDATD-@DATD)                                      00686000
@CV00105 DC    V(IGG0191G)                                              00687000
@CV00110 DC    V(IGG0191Q)                                              00688000
@CV00115 DC    V(IGG0191I)                                              00689000
@CV00120 DC    V(IGG01911)                                              00690000
@CV00125 DC    V(IGG0196M)                                              00691000
         DS    0D                                                       00692000
@CC02948 DC    C'IGGMSG01'                                              00693000
TABLE    DC    CL16'0123456789ABCDEF'                                   00694000
XCTLTBL  DS    CL25                                                     00695000
         ORG   XCTLTBL                                                  00696000
SOP191G  DS    CL5                                                      00697000
         ORG   SOP191G                                                  00698000
@NM00003 DC    CL2'1G'                                                  00699000
@NM00004 DC    VL3(IGG0191G)                                            00700000
         ORG   XCTLTBL+5                                                00701000
SOP191Q  DS    CL5                                                      00702000
         ORG   SOP191Q                                                  00703000
@NM00005 DC    CL2'1Q'                                                  00704000
@NM00006 DC    VL3(IGG0191Q)                                            00705000
         ORG   XCTLTBL+10                                               00706000
SOP191I  DS    CL5                                                      00707000
         ORG   SOP191I                                                  00708000
@NM00007 DC    CL2'1I'                                                  00709000
@NM00008 DC    VL3(IGG0191I)                                            00710000
         ORG   XCTLTBL+15                                               00711000
SOP1911  DS    CL5                                                      00712000
         ORG   SOP1911                                                  00713000
@NM00009 DC    CL2'11'                                                  00714000
@NM00010 DC    VL3(IGG01911)                                            00715000
         ORG   XCTLTBL+20                                               00716000
PDLOAD   DS    CL5                                                      00717000
         ORG   PDLOAD                                                   00718000
@NM00011 DC    CL2'6M'                                                  00719000
@NM00012 DC    VL3(IGG0196M)                                            00720000
         ORG   XCTLTBL+25                                               00721000
OPIDCNST DC    CL2'0S'                                                  00722000
MODID    DS    CL8                                                      00723000
         ORG   MODID                                                    00724000
@NM00013 DC    CL6'IGG019'                                              00725000
AMIDCNST DC    CL2'6Q'                                                  00726000
         ORG   MODID+8                                                  00727000
         DS    CL1                                                      00728000
PATCH    DC    CL50' '                                                  00729000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00730000
@01      EQU   01                                                       00731000
@02      EQU   02                                                       00732000
@03      EQU   03                                                       00733000
@04      EQU   04                                                       00734000
@05      EQU   05                                                       00735000
@06      EQU   06                                                       00736000
@07      EQU   07                                                       00737000
@08      EQU   08                                                       00738000
@09      EQU   09                                                       00739000
@10      EQU   10                                                       00740000
@11      EQU   11                                                       00741000
@12      EQU   12                                                       00742000
@13      EQU   13                                                       00743000
@14      EQU   14                                                       00744000
@15      EQU   15                                                       00745000
SPPRTNCD EQU   @11                                                      00746000
JFCBEPTR EQU   @09                                                      00747000
SPPPTR   EQU   @11                                                      00748000
MSGPTR   EQU   @11                                                      00749000
GPR00F   EQU   @00                                                      00750000
GPR01F   EQU   @01                                                      00751000
GPR14F   EQU   @14                                                      00752000
GPR15F   EQU   @15                                                      00753000
DCBPTR   EQU   @02                                                      00754000
RBASE    EQU   @03                                                      00755000
RCORE    EQU   @04                                                      00756000
RPAR     EQU   @05                                                      00757000
RWTG     EQU   @06                                                      00758000
RPARC    EQU   @07                                                      00759000
RWTGC    EQU   @08                                                      00760000
GPR09F   EQU   @09                                                      00761000
DEBDAPTR EQU   @00                                                      00762000
DEBEXPTR EQU   @00                                                      00763000
DEBSBPTR EQU   @00                                                      00764000
GPR00P   EQU   @00                                                      00765000
GPR01P   EQU   @01                                                      00766000
GPR14P   EQU   @14                                                      00767000
GPR15P   EQU   @15                                                      00768000
UCBDCPTR EQU   @00                                                      00769000
CVTPTR   EQU   16                                                       00770000
TRTBL    EQU   0                                                        00771000
UNPKAREA EQU   0                                                        00772000
MSGAREA  EQU   0                                                        00773000
CVTMAP   EQU   0                                                        00774000
CVT      EQU   CVTMAP                                                   00775000
CVTDAR   EQU   CVTMAP+72                                                00776000
CVTFLGS1 EQU   CVTDAR                                                   00777000
CVTDCB   EQU   CVTMAP+116                                               00778000
CVTIERLC EQU   CVTMAP+144                                               00779000
CVTOPTA  EQU   CVTMAP+182                                               00780000
CVTOPTB  EQU   CVTMAP+183                                               00781000
CVTGTF   EQU   CVTMAP+236                                               00782000
CVTGTFST EQU   CVTGTF                                                   00783000
CVTGTFS  EQU   CVTGTFST                                                 00784000
CVTSTATE EQU   CVTGTFST                                                 00785000
CVTTMODE EQU   CVTGTFST                                                 00786000
CVTFORM  EQU   CVTGTFST                                                 00787000
CVTAQAVT EQU   CVTMAP+240                                               00788000
CVTTCMFG EQU   CVTAQAVT                                                 00789000
CVTVOLM2 EQU   CVTMAP+244                                               00790000
CVTTATA  EQU   CVTVOLM2                                                 00791000
CVTTSKS  EQU   CVTTATA                                                  00792000
CVTVOLF2 EQU   CVTTSKS                                                  00793000
CVTTAT   EQU   CVTTATA+1                                                00794000
CVTATER  EQU   CVTMAP+248                                               00795000
CVTEXT1  EQU   CVTMAP+252                                               00796000
CVTPURG  EQU   CVTMAP+260                                               00797000
CVTQMSG  EQU   CVTMAP+268                                               00798000
CVTDMSR  EQU   CVTMAP+272                                               00799000
CVTRSV37 EQU   CVTDMSR                                                  00800000
CVTDMSRF EQU   CVTRSV37                                                 00801000
CVTERPV  EQU   CVTMAP+316                                               00802000
CVTINTLA EQU   CVTMAP+320                                               00803000
CVTAPF   EQU   CVTMAP+324                                               00804000
CVTEXT2  EQU   CVTMAP+328                                               00805000
CVTHJES  EQU   CVTMAP+332                                               00806000
CVTPGSIA EQU   CVTMAP+348                                               00807000
CVTA1F1  EQU   CVTMAP+356                                               00808000
CVTSYSK  EQU   CVTMAP+357                                               00809000
CVTVOLM1 EQU   CVTMAP+380                                               00810000
CVTVOLF1 EQU   CVTVOLM1                                                 00811000
CVTATMCT EQU   CVTMAP+388                                               00812000
CVTXTNT1 EQU   0                                                        00813000
CVTXTNT2 EQU   0                                                        00814000
CVTDSSV  EQU   CVTXTNT2                                                 00815000
CVTFLGBT EQU   CVTXTNT2+5                                               00816000
CVTQID   EQU   CVTXTNT2+24                                              00817000
CVTRV400 EQU   CVTXTNT2+52                                              00818000
CVTRV409 EQU   CVTXTNT2+53                                              00819000
CVTATCVT EQU   CVTXTNT2+64                                              00820000
CVTRV429 EQU   CVTXTNT2+84                                              00821000
CVTRV438 EQU   CVTXTNT2+85                                              00822000
CVTRV457 EQU   CVTXTNT2+112                                             00823000
CVTRV466 EQU   CVTXTNT2+113                                             00824000
CVTFIX   EQU   0                                                        00825000
CVTRELNO EQU   CVTFIX+252                                               00826000
IHADCB   EQU   0                                                        00827000
IHADCS04 EQU   0                                                        00828000
DCBPRBYT EQU   IHADCS04+3                                               00829000
IHADCS11 EQU   0                                                        00830000
DCBRELB  EQU   IHADCS11                                                 00831000
DCBREL   EQU   DCBRELB+1                                                00832000
DCBBUFCB EQU   IHADCS11+4                                               00833000
DCBBUFNO EQU   DCBBUFCB                                                 00834000
DCBBUFCA EQU   DCBBUFCB+1                                               00835000
DCBDSORG EQU   IHADCS11+10                                              00836000
DCBDSRG1 EQU   DCBDSORG                                                 00837000
DCBDSRG2 EQU   DCBDSORG+1                                               00838000
DCBIOBAD EQU   IHADCS11+12                                              00839000
DCBODEB  EQU   DCBIOBAD                                                 00840000
DCBLNP   EQU   DCBODEB                                                  00841000
DCBQSLM  EQU   DCBLNP                                                   00842000
DCBIOBAA EQU   DCBODEB+1                                                00843000
IHADCS50 EQU   0                                                        00844000
DCBSVCXL EQU   IHADCS50                                                 00845000
DCBEODAD EQU   IHADCS50+4                                               00846000
DCBBFALN EQU   DCBEODAD                                                 00847000
DCBHIARC EQU   DCBBFALN                                                 00848000
DCBBFTEK EQU   DCBHIARC                                                 00849000
DCBBFT   EQU   DCBBFTEK                                                 00850000
DCBEXLST EQU   IHADCS50+8                                               00851000
DCBRECFM EQU   DCBEXLST                                                 00852000
DCBRECLA EQU   DCBRECFM                                                 00853000
IHADCS24 EQU   0                                                        00854000
DCBOFLGS EQU   IHADCS24+8                                               00855000
DCBOFLWR EQU   DCBOFLGS                                                 00856000
DCBIFLG  EQU   IHADCS24+9                                               00857000
DCBIBPCT EQU   DCBIFLG                                                  00858000
DCBMACR  EQU   IHADCS24+10                                              00859000
DCBMACR1 EQU   DCBMACR                                                  00860000
DCBMRFE  EQU   DCBMACR1                                                 00861000
DCBMRGET EQU   DCBMRFE                                                  00862000
DCBMRAPG EQU   DCBMACR1                                                 00863000
DCBMRRD  EQU   DCBMRAPG                                                 00864000
DCBMRCI  EQU   DCBMACR1                                                 00865000
DCBMRMVG EQU   DCBMRCI                                                  00866000
DCBMRLCG EQU   DCBMACR1                                                 00867000
DCBMRABC EQU   DCBMACR1                                                 00868000
DCBMRPT1 EQU   DCBMRABC                                                 00869000
DCBMRSBG EQU   DCBMRPT1                                                 00870000
DCBMRCRL EQU   DCBMACR1                                                 00871000
DCBMRCHK EQU   DCBMRCRL                                                 00872000
DCBMRRDX EQU   DCBMRCHK                                                 00873000
DCBMRDMG EQU   DCBMACR1                                                 00874000
DCBMACR2 EQU   DCBMACR+1                                                00875000
DCBMRPUT EQU   DCBMACR2                                                 00876000
DCBMRWRT EQU   DCBMACR2                                                 00877000
DCBMRMVP EQU   DCBMACR2                                                 00878000
DCBMR5WD EQU   DCBMACR2                                                 00879000
DCBMRLDM EQU   DCBMR5WD                                                 00880000
DCBMRLCP EQU   DCBMRLDM                                                 00881000
DCBMR4WD EQU   DCBMACR2                                                 00882000
DCBMRPT2 EQU   DCBMR4WD                                                 00883000
DCBMRTMD EQU   DCBMRPT2                                                 00884000
DCBMR3WD EQU   DCBMACR2                                                 00885000
DCBMRCTL EQU   DCBMR3WD                                                 00886000
DCBMRSTK EQU   DCBMRCTL                                                 00887000
DCBMR1WD EQU   DCBMACR2                                                 00888000
DCBMRSWA EQU   DCBMR1WD                                                 00889000
DCBMRDMD EQU   DCBMRSWA                                                 00890000
IHADCS25 EQU   0                                                        00891000
DCBMACRF EQU   IHADCS25+2                                               00892000
DCBMACF1 EQU   DCBMACRF                                                 00893000
DCBMFECP EQU   DCBMACF1                                                 00894000
DCBMFFE  EQU   DCBMACF1                                                 00895000
DCBMFGET EQU   DCBMFFE                                                  00896000
DCBMFAPG EQU   DCBMACF1                                                 00897000
DCBMFRD  EQU   DCBMFAPG                                                 00898000
DCBMFCI  EQU   DCBMACF1                                                 00899000
DCBMFMVG EQU   DCBMFCI                                                  00900000
DCBMFLCG EQU   DCBMACF1                                                 00901000
DCBMFABC EQU   DCBMACF1                                                 00902000
DCBMFPT1 EQU   DCBMFABC                                                 00903000
DCBMFSBG EQU   DCBMFPT1                                                 00904000
DCBMFCRL EQU   DCBMACF1                                                 00905000
DCBMFCHK EQU   DCBMFCRL                                                 00906000
DCBMFDMG EQU   DCBMACF1                                                 00907000
DCBMACF2 EQU   DCBMACRF+1                                               00908000
DCBMFPUT EQU   DCBMACF2                                                 00909000
DCBMFWRT EQU   DCBMACF2                                                 00910000
DCBMFMVP EQU   DCBMACF2                                                 00911000
DCBMF5WD EQU   DCBMACF2                                                 00912000
DCBMFLDM EQU   DCBMF5WD                                                 00913000
DCBMFLCP EQU   DCBMFLDM                                                 00914000
DCBMF4WD EQU   DCBMACF2                                                 00915000
DCBMFPT2 EQU   DCBMF4WD                                                 00916000
DCBMFTMD EQU   DCBMFPT2                                                 00917000
DCBMF3WD EQU   DCBMACF2                                                 00918000
DCBMFCTL EQU   DCBMF3WD                                                 00919000
DCBMFSTK EQU   DCBMFCTL                                                 00920000
DCBMF1WD EQU   DCBMACF2                                                 00921000
DCBMFSWA EQU   DCBMF1WD                                                 00922000
DCBMFDMD EQU   DCBMFSWA                                                 00923000
DCBDEBAD EQU   IHADCS25+4                                               00924000
DCBIFLGS EQU   DCBDEBAD                                                 00925000
DCBIFPCT EQU   DCBIFLGS                                                 00926000
DCBDEBA  EQU   DCBDEBAD+1                                               00927000
IHADCS26 EQU   0                                                        00928000
DCBWRITE EQU   IHADCS26                                                 00929000
DCBREAD  EQU   DCBWRITE                                                 00930000
DCBWRITA EQU   DCBREAD+1                                                00931000
IHADCS27 EQU   0                                                        00932000
DCBGET   EQU   IHADCS27                                                 00933000
DCBPUT   EQU   DCBGET                                                   00934000
DCBGETA  EQU   DCBPUT+1                                                 00935000
IHADCS36 EQU   0                                                        00936000
DCBGERR  EQU   IHADCS36                                                 00937000
DCBPERR  EQU   DCBGERR                                                  00938000
DCBCHECK EQU   DCBPERR                                                  00939000
DCBOPTCD EQU   DCBCHECK                                                 00940000
DCBOPTC  EQU   DCBOPTCD                                                 00941000
DCBOPTH  EQU   DCBOPTCD                                                 00942000
DCBOPTO  EQU   DCBOPTH                                                  00943000
DCBOPTZ  EQU   DCBOPTCD                                                 00944000
DCBGERRA EQU   DCBCHECK+1                                               00945000
DCBPERRA EQU   DCBGERRA                                                 00946000
DCBSYNAD EQU   IHADCS36+4                                               00947000
DCBCIND1 EQU   IHADCS36+8                                               00948000
DCBCIND2 EQU   IHADCS36+9                                               00949000
DCBCNQSM EQU   DCBCIND2                                                 00950000
DCBIOBA  EQU   IHADCS36+16                                              00951000
DCBCICB  EQU   DCBIOBA                                                  00952000
IHADCS52 EQU   0                                                        00953000
DCBDIRCT EQU   IHADCS52                                                 00954000
DCBQSWS  EQU   DCBDIRCT                                                 00955000
DCBUSASI EQU   DCBQSWS                                                  00956000
DCBQADFS EQU   DCBUSASI                                                 00957000
DCBBUFOF EQU   DCBDIRCT+1                                               00958000
IHADCS37 EQU   0                                                        00959000
DCBFLAG1 EQU   IHADCS37                                                 00960000
IHADCS38 EQU   0                                                        00961000
DCBEOBR  EQU   IHADCS38                                                 00962000
DCBPOINT EQU   IHADCS38+12                                              00963000
DCBCNTRL EQU   DCBPOINT                                                 00964000
IHADCS40 EQU   0                                                        00965000
DCBEOBAD EQU   IHADCS40                                                 00966000
DCBCCCW  EQU   IHADCS40+4                                               00967000
DCBRECAD EQU   DCBCCCW                                                  00968000
DCBRECBT EQU   DCBRECAD                                                 00969000
DCBRCREL EQU   DCBRECBT                                                 00970000
@NM00040 EQU   IHADCS40+12                                              00971000
DCBEROPT EQU   @NM00040                                                 00972000
DEBBASIC EQU   0                                                        00973000
DEBTCBAD EQU   DEBBASIC                                                 00974000
DEBTCBB  EQU   DEBTCBAD+1                                               00975000
DEBDEBAD EQU   DEBBASIC+4                                               00976000
DEBIRBAD EQU   DEBBASIC+8                                               00977000
DEBOFLGS EQU   DEBIRBAD                                                 00978000
DEBOPATB EQU   DEBBASIC+12                                              00979000
DEBFLGS1 EQU   DEBBASIC+14                                              00980000
DEBUSRPG EQU   DEBBASIC+16                                              00981000
DEBRRQ   EQU   DEBBASIC+20                                              00982000
DEBECBAD EQU   DEBRRQ                                                   00983000
DEBDCBAD EQU   DEBBASIC+24                                              00984000
DEBPROTG EQU   DEBDCBAD                                                 00985000
DEBAPPAD EQU   DEBBASIC+28                                              00986000
DEBBASND EQU   DEBBASIC+32                                              00987000
DEBDASD  EQU   0                                                        00988000
DEBUCBAD EQU   DEBDASD                                                  00989000
DEBACSMD EQU   0                                                        00990000
DEBVOLSQ EQU   DEBACSMD                                                 00991000
DEBVOLBT EQU   DEBVOLSQ                                                 00992000
DEBDSNM  EQU   DEBACSMD+4                                               00993000
DEBUTSAA EQU   DEBDSNM                                                  00994000
DEBACS01 EQU   0                                                        00995000
DEBDSNAM EQU   DEBACS01                                                 00996000
DEBACS02 EQU   0                                                        00997000
DEBDBLK  EQU   DEBACS02                                                 00998000
DEBACS03 EQU   0                                                        00999000
DEBACS04 EQU   0                                                        01000000
DEBTBFRA EQU   DEBACS04                                                 01001000
DEBTCCWA EQU   DEBACS04+4                                               01002000
DEBACS05 EQU   0                                                        01003000
DEBFUCBA EQU   DEBACS05                                                 01004000
DEBLUCBA EQU   DEBACS05+4                                               01005000
DEBACS06 EQU   0                                                        01006000
DEBACS07 EQU   0                                                        01007000
DEBACS08 EQU   0                                                        01008000
DEBSUBNM EQU   0                                                        01009000
DEB      EQU   0                                                        01010000
DEBAVT   EQU   DEB                                                      01011000
DEBEOEA  EQU   DEBAVT                                                   01012000
DEBEOEAB EQU   DEBEOEA                                                  01013000
DEBSIOA  EQU   DEBAVT+4                                                 01014000
DEBSIOAB EQU   DEBSIOA                                                  01015000
DEBPCIA  EQU   DEBAVT+8                                                 01016000
DEBPCIAB EQU   DEBPCIA                                                  01017000
DEBCEA   EQU   DEBAVT+12                                                01018000
DEBCEAB  EQU   DEBCEA                                                   01019000
DEBXCEA  EQU   DEBAVT+16                                                01020000
DEBXCEAB EQU   DEBXCEA                                                  01021000
DEBPREFX EQU   DEB+20                                                   01022000
DEBXTNP  EQU   DEBPREFX+8                                               01023000
DEBXTN   EQU   0                                                        01024000
DEBXFLG1 EQU   DEBXTN+2                                                 01025000
INFMJFCB EQU   0                                                        01026000
JFCBDSNM EQU   INFMJFCB                                                 01027000
JFCBELNM EQU   INFMJFCB+44                                              01028000
JFCBTSDM EQU   INFMJFCB+52                                              01029000
JFCFCBID EQU   INFMJFCB+56                                              01030000
JFCBFRID EQU   JFCFCBID                                                 01031000
JFCBLTYP EQU   INFMJFCB+66                                              01032000
JFCBOTTR EQU   INFMJFCB+67                                              01033000
JFCBUFOF EQU   JFCBOTTR                                                 01034000
JFCBFLSQ EQU   JFCBOTTR+1                                               01035000
JFCFUNC  EQU   JFCBFLSQ                                                 01036000
JFCBMASK EQU   INFMJFCB+72                                              01037000
JFCBFLG1 EQU   JFCBMASK+5                                               01038000
JFCOPEN  EQU   JFCBFLG1                                                 01039000
JFCBFLG2 EQU   JFCBMASK+6                                               01040000
JFCDEFER EQU   JFCBFLG2                                                 01041000
JFCBIND1 EQU   INFMJFCB+86                                              01042000
JFCBIND2 EQU   INFMJFCB+87                                              01043000
JFCAMPTR EQU   INFMJFCB+88                                              01044000
JFCBUFRQ EQU   JFCAMPTR                                                 01045000
JFCBUFNO EQU   JFCBUFRQ                                                 01046000
JFCBGNCP EQU   JFCAMPTR+1                                               01047000
JFCBHIAR EQU   JFCBGNCP                                                 01048000
JFCBFALN EQU   JFCBHIAR                                                 01049000
JFCBFTEK EQU   JFCBFALN                                                 01050000
JFCBBFTA EQU   JFCBFTEK                                                 01051000
JFCEROPT EQU   INFMJFCB+92                                              01052000
JFCTRTCH EQU   INFMJFCB+93                                              01053000
JFCBE    EQU   0                                                        01054000
JFCBFLAG EQU   JFCBE+4                                                  01055000
JFCBBST  EQU   JFCBFLAG                                                 01056000
JFCIDTRC EQU   JFCBE+5                                                  01057000
JFCIMTOT EQU   JFCBE+7                                                  01058000
JFCBMAGT EQU   JFCBE+8                                                  01059000
JFCMODIF EQU   JFCBE+12                                                 01060000
JFCBTRS1 EQU   JFCBE+20                                                 01061000
JFCBTRS2 EQU   JFCBE+24                                                 01062000
JFCBTRS3 EQU   JFCBE+28                                                 01063000
JFCBTRS4 EQU   JFCBE+32                                                 01064000
JFCGROUP EQU   JFCBE+36                                                 01065000
JFCGRP1  EQU   JFCGROUP                                                 01066000
MSGINDEX EQU   0                                                        01067000
MSGINDOF EQU   MSGINDEX+2                                               01068000
MSGENTRY EQU   0                                                        01069000
MSGOFF   EQU   MSGENTRY                                                 01070000
MSGLNG   EQU   MSGENTRY+1                                               01071000
MSGOFF1  EQU   MSGENTRY+2                                               01072000
MSGOFF2  EQU   MSGENTRY+3                                               01073000
MSGOFF3  EQU   MSGENTRY+4                                               01074000
MSGTXTD  EQU   0                                                        01075000
MSGTXT   EQU   MSGTXTD                                                  01076000
MSGTXTFD EQU   0                                                        01077000
FORCORE  EQU   0                                                        01078000
DXDSCB   EQU   FORCORE                                                  01079000
DXJBF    EQU   FORCORE+100                                              01080000
DXDAADDR EQU   FORCORE+312                                              01081000
DXDCB    EQU   FORCORE+320                                              01082000
DXCCW    EQU   FORCORE+368                                              01083000
DXCCW3   EQU   DXCCW+16                                                 01084000
DXCCW5   EQU   DXCCW+32                                                 01085000
DXCCW8   EQU   DXCCW+56                                                 01086000
DXCCW12  EQU   DXCCW+88                                                 01087000
DXXCTL   EQU   FORCORE+472                                              01088000
DXVOLSR  EQU   FORCORE+500                                              01089000
DXVOLSR1 EQU   DXVOLSR                                                  01090000
DXVOLSR2 EQU   DXVOLSR+6                                                01091000
DXVOLSR3 EQU   DXVOLSR+12                                               01092000
DXRESSW  EQU   FORCORE+524                                              01093000
DXUCBSAV EQU   FORCORE+564                                              01094000
DXUDCBAD EQU   FORCORE+568                                              01095000
DXPDCBAD EQU   FORCORE+572                                              01096000
DXATCOM1 EQU   FORCORE+588                                              01097000
DXATGENS EQU   DXATCOM1                                                 01098000
DXATVGIV EQU   DXATGENS                                                 01099000
DXATOUTA EQU   DXATCOM1+2                                               01100000
DXATDACC EQU   DXATCOM1+3                                               01101000
DXATCOM2 EQU   FORCORE+592                                              01102000
DXATEOV  EQU   DXATCOM2                                                 01103000
DXATOPEN EQU   DXATCOM2+1                                               01104000
DXATALL  EQU   DXATCOM2+2                                               01105000
DXATEXC1 EQU   FORCORE+604                                              01106000
DXATEXB1 EQU   DXATEXC1                                                 01107000
DXATEXC2 EQU   FORCORE+608                                              01108000
DSECTSIZ EQU   FORCORE+612                                              01109000
SPPARM   EQU   0                                                        01110000
SPPDCBA  EQU   SPPARM                                                   01111000
SPPFDUNF EQU   SPPARM+10                                                01112000
SPPFBLK  EQU   SPPFDUNF                                                 01113000
SPPEXTL  EQU   SPPFDUNF                                                 01114000
SPPFCBAD EQU   SPPARM+11                                                01115000
SPPFCB   EQU   SPPFCBAD                                                 01116000
SPPVERAL EQU   SPPARM+15                                                01117000
SPPVERIF EQU   SPPVERAL                                                 01118000
SPPFLAG1 EQU   SPPARM+16                                                01119000
SPPBURST EQU   SPPFLAG1                                                 01120000
SPPINIT  EQU   SPPFLAG1                                                 01121000
SPPFLAG2 EQU   SPPARM+17                                                01122000
SPPCPYNR EQU   SPPARM+18                                                01123000
SPPSTCNR EQU   SPPARM+19                                                01124000
SPPFRMNR EQU   SPPARM+22                                                01125000
SPPTRC   EQU   SPPARM+23                                                01126000
SPPMODPT EQU   SPPARM+24                                                01127000
SPPMDPTA EQU   SPPMODPT                                                 01128000
SPPIMAGE EQU   SPPARM+28                                                01129000
SPPXLAT1 EQU   SPPARM+32                                                01130000
SPPXLT1A EQU   SPPXLAT1                                                 01131000
SPPXLAT2 EQU   SPPARM+36                                                01132000
SPPXLT2A EQU   SPPXLAT2                                                 01133000
SPPXLAT3 EQU   SPPARM+40                                                01134000
SPPXLT3A EQU   SPPXLAT3                                                 01135000
SPPXLAT4 EQU   SPPARM+44                                                01136000
SPPXLT4A EQU   SPPXLAT4                                                 01137000
TCBFIX   EQU   0                                                        01138000
TCBFRS   EQU   TCBFIX                                                   01139000
TCB      EQU   0                                                        01140000
TCBPIE   EQU   TCB+4                                                    01141000
TCBPMASK EQU   TCBPIE                                                   01142000
TCBCMP   EQU   TCB+16                                                   01143000
TCBCMPF  EQU   TCBCMP                                                   01144000
TCBCPP   EQU   TCBCMPF                                                  01145000
TCBSTCC  EQU   TCBCMPF                                                  01146000
TCBCDBL  EQU   TCBCMPF                                                  01147000
TCBCWTO  EQU   TCBCMPF                                                  01148000
TCBCIND  EQU   TCBCMPF                                                  01149000
TCBCMSG  EQU   TCBCMPF                                                  01150000
TCBTRN   EQU   TCB+20                                                   01151000
TCBABF   EQU   TCBTRN                                                   01152000
TCBMSS   EQU   TCB+24                                                   01153000
TCBPKF   EQU   TCB+28                                                   01154000
TCBFLGS  EQU   TCB+29                                                   01155000
TCBFLGS1 EQU   TCBFLGS                                                  01156000
TCBFLGS2 EQU   TCBFLGS+1                                                01157000
TCBFLGS3 EQU   TCBFLGS+2                                                01158000
TCBFLGS4 EQU   TCBFLGS+3                                                01159000
TCBFLGS5 EQU   TCBFLGS+4                                                01160000
TCBABWF  EQU   TCBFLGS5                                                 01161000
TCBJPQ   EQU   TCB+44                                                   01162000
TCBPURGE EQU   TCBJPQ                                                   01163000
TCBGRS   EQU   TCB+48                                                   01164000
TCBFSA   EQU   TCB+112                                                  01165000
TCBTME   EQU   TCB+120                                                  01166000
TCBJSTCB EQU   TCB+124                                                  01167000
TCBTSFLG EQU   TCB+148                                                  01168000
TCBTSTSK EQU   TCBTSFLG                                                 01169000
TCBSTAB  EQU   TCB+160                                                  01170000
TCBNSTAE EQU   TCBSTAB                                                  01171000
TCBTCT   EQU   TCB+164                                                  01172000
TCBTCTGF EQU   TCBTCT                                                   01173000
TCBSCNDY EQU   TCB+172                                                  01174000
TCBNDSP  EQU   TCBSCNDY                                                 01175000
TCBNDSP1 EQU   TCBNDSP+1                                                01176000
TCBNDSP2 EQU   TCBNDSP+2                                                01177000
TCBNDSP3 EQU   TCBNDSP+3                                                01178000
TCBJSCB  EQU   TCB+180                                                  01179000
TCBRECDE EQU   TCBJSCB                                                  01180000
TCBEXT1  EQU   TCB+196                                                  01181000
TCBBITS  EQU   TCB+200                                                  01182000
TCBNDSP4 EQU   TCBBITS                                                  01183000
TCBNDSP5 EQU   TCBBITS+1                                                01184000
TCBFLGS6 EQU   TCBBITS+2                                                01185000
TCBFLGS7 EQU   TCBBITS+3                                                01186000
TCBDAR   EQU   TCB+204                                                  01187000
TCBDARC  EQU   TCBDAR                                                   01188000
TCBEXT2  EQU   TCB+208                                                  01189000
TCBFOE   EQU   TCB+244                                                  01190000
TCBESTAE EQU   TCB+264                                                  01191000
TCBESTRM EQU   TCBESTAE+1                                               01192000
TCBFBYT1 EQU   TCB+276                                                  01193000
TCBFBYT2 EQU   TCB+277                                                  01194000
TCBRV124 EQU   TCB+278                                                  01195000
TCBRV133 EQU   TCB+279                                                  01196000
TCBXTNT2 EQU   0                                                        01197000
TCBGTF   EQU   TCBXTNT2                                                 01198000
TCBTFLG  EQU   TCBGTF                                                   01199000
TCBRV146 EQU   TCBXTNT2+28                                              01200000
TCBRV155 EQU   TCBXTNT2+29                                              01201000
TCBRV164 EQU   TCBXTNT2+30                                              01202000
TCBRV173 EQU   TCBXTNT2+31                                              01203000
UCB      EQU   0                                                        01204000
UCBOB    EQU   0                                                        01205000
UCBJBNR  EQU   UCBOB                                                    01206000
UCBFL5   EQU   UCBOB+1                                                  01207000
UCBAF    EQU   UCBFL5                                                   01208000
UCBSTAT  EQU   UCBOB+3                                                  01209000
UCBCHAN  EQU   UCBOB+4                                                  01210000
UCBSFLS  EQU   UCBOB+6                                                  01211000
UCBFLA   EQU   UCBSFLS                                                  01212000
UCBFL1   EQU   UCBFLA                                                   01213000
UCBBSY   EQU   UCBFL1                                                   01214000
UCBNRY   EQU   UCBFL1                                                   01215000
UCBPST   EQU   UCBFL1                                                   01216000
UCBCUB   EQU   UCBFL1                                                   01217000
UCBFLB   EQU   UCBSFLS+1                                                01218000
UCBCHM   EQU   UCBOB+8                                                  01219000
UCBCHM1  EQU   UCBCHM                                                   01220000
UCBPTH0  EQU   UCBCHM1                                                  01221000
UCBPTH1  EQU   UCBCHM1                                                  01222000
UCBWGT   EQU   UCBOB+12                                                 01223000
UCBNAME  EQU   UCBOB+13                                                 01224000
UCBTYP   EQU   UCBOB+16                                                 01225000
UCBTBYT1 EQU   UCBTYP                                                   01226000
UCB1FEA5 EQU   UCBTBYT1                                                 01227000
UCB1FEA6 EQU   UCBTBYT1                                                 01228000
UCBTBYT2 EQU   UCBTYP+1                                                 01229000
UCB2OPT2 EQU   UCBTBYT2                                                 01230000
UCBDUDN1 EQU   UCB2OPT2                                                 01231000
UCB2OPT3 EQU   UCBTBYT2                                                 01232000
UCBDUDN2 EQU   UCB2OPT3                                                 01233000
UCB2OPT4 EQU   UCBTBYT2                                                 01234000
UCBRWTAU EQU   UCB2OPT4                                                 01235000
UCB2OPT6 EQU   UCBTBYT2                                                 01236000
UCB2OPT7 EQU   UCBTBYT2                                                 01237000
UCBTBYT3 EQU   UCBTYP+2                                                 01238000
UCBDVCLS EQU   UCBTBYT3                                                 01239000
UCBTBYT4 EQU   UCBTYP+3                                                 01240000
UCBEXTPT EQU   UCBOB+20                                                 01241000
UCBFLC   EQU   UCBEXTPT                                                 01242000
UCBDEV   EQU   UCBOB+24                                                 01243000
UCBCMEXT EQU   0                                                        01244000
UCBATI   EQU   UCBCMEXT+3                                               01245000
@NM00083 EQU   UCBATI                                                   01246000
UCBFLP1  EQU   UCBCMEXT+5                                               01247000
UCBMT    EQU   0                                                        01248000
UCBOCR   EQU   0                                                        01249000
UCB3540X EQU   0                                                        01250000
UCBDKBYT EQU   UCB3540X+6                                               01251000
UCB3800X EQU   0                                                        01252000
UCBOPTNS EQU   UCB3800X                                                 01253000
UCBACTIV EQU   UCB3800X+3                                               01254000
UCBMDRBF EQU   UCB3800X+36                                              01255000
UCBMDRBA EQU   UCBMDRBF+1                                               01256000
UCBUCS   EQU   0                                                        01257000
UCBUCSOP EQU   UCBUCS+4                                                 01258000
UCBFCBOP EQU   UCBUCS+5                                                 01259000
IECPREFX EQU   0                                                        01260000
IECEXTPR EQU   IECPREFX+32                                              01261000
IECREGSV EQU   IECEXTPR                                                 01262000
IECUPRML EQU   IECEXTPR+80                                              01263000
IECRESWA EQU   IECEXTPR+84                                              01264000
RWARESWA EQU   0                                                        01265000
RWAPREFX EQU   RWARESWA                                                 01266000
USERPRML EQU   0                                                        01267000
IECRRPL  EQU   0                                                        01268000
RRPLIST  EQU   IECRRPL                                                  01269000
RRFUNCTN EQU   RRPLIST                                                  01270000
RRFLAGS1 EQU   RRPLIST+1                                                01271000
RRFLAGS2 EQU   RRPLIST+2                                                01272000
RRFLAGS3 EQU   RRPLIST+3                                                01273000
RRXRETRY EQU   RRPLIST+12                                               01274000
DSMADTRL EQU   0                                                        01275000
DSMADTW1 EQU   DSMADTRL                                                 01276000
DSMADTB1 EQU   DSMADTW1                                                 01277000
DSMADTB2 EQU   DSMADTW1+1                                               01278000
WTGTABLE EQU   0                                                        01279000
WTGWTOPR EQU   WTGTABLE                                                 01280000
WTG      EQU   0                                                        01281000
WTGAREA  EQU   WTG                                                      01282000
WTGMODNM EQU   WTGAREA                                                  01283000
WTGMODID EQU   WTGMODNM+6                                               01284000
WTGMODEP EQU   WTGAREA+8                                                01285000
WTGPREFX EQU   WTGAREA+16                                               01286000
WTGPATHS EQU   WTG+30                                                   01287000
WTGENTRY EQU   0                                                        01288000
WTGIDTTR EQU   WTGENTRY                                                 01289000
WTGEID   EQU   WTGIDTTR                                                 01290000
WTGETTR  EQU   WTGIDTTR+2                                               01291000
WTGCORE  EQU   WTGENTRY+5                                               01292000
APPNMTBL EQU   0                                                        01293000
APPENTRY EQU   APPNMTBL+4                                               01294000
IKEBC    EQU   0                                                        01295000
IKEBF15  EQU   0                                                        01296000
IKEBF31  EQU   0                                                        01297000
IKEBP15  EQU   0                                                        01298000
IKEBP31  EQU   0                                                        01299000
IKEBP8   EQU   0                                                        01300000
SPPXLAT  EQU   0                                                        01301000
UCBBGN   EQU   0                                                        01302000
WTGEADDR EQU   WTGETTR                                                  01303000
@NM00001 EQU   DCBBUFCA                                                 01304000
BUFCABIT EQU   @NM00001+2                                               01305000
CVTS01   EQU   CVTPGSIA                                                 01306000
CVTLPDIA EQU   CVTS01+12                                                01307000
CVTDIRST EQU   CVTLPDIA                                                 01308000
CVTSLIDA EQU   CVTS01+24                                                01309000
CVTCTLFG EQU   CVTS01+50                                                01310000
CVTRV210 EQU   CVTS01+424                                               01311000
CVTRV219 EQU   CVTS01+425                                               01312000
CVTRV228 EQU   CVTS01+426                                               01313000
CVTRV237 EQU   CVTS01+427                                               01314000
CVTMFRTR EQU   CVTS01+452                                               01315000
CVTRV262 EQU   CVTS01+468                                               01316000
CVTRV271 EQU   CVTS01+469                                               01317000
CVTRV280 EQU   CVTS01+470                                               01318000
CVTRV289 EQU   CVTS01+471                                               01319000
CVTGSDA  EQU   CVTS01+600                                               01320000
DEBBAS02 EQU   DEBBASND                                                 01321000
DEBDDS1  EQU   DEBBAS02                                                 01322000
DEBSUCBA EQU   DEBDDS1                                                  01323000
DEBDEVED EQU   DEBDDS1+4                                                01324000
DEBRDCB  EQU   DEBDDS1+4                                                01325000
DEBPDCB  EQU   DEBDDS1+8                                                01326000
DEBWDCB  EQU   DEBDDS1+12                                               01327000
DEBACS09 EQU   DEBDEVED                                                 01328000
DEBASC09 EQU   DEBACS09                                                 01329000
DEBEAMFG EQU   DEBASC09+3                                               01330000
DEBDSID  EQU   DEBASC09+4                                               01331000
DEBEOD   EQU   DEBASC09+12                                              01332000
DEBBOE   EQU   DEBEOD                                                   01333000
DEBEODRV EQU   DEBBOE                                                   01334000
DEBEODTT EQU   DEBBOE+1                                                 01335000
DEBEOD0  EQU   DEBBOE+2                                                 01336000
DEBEODSS EQU   DEBBOE+3                                                 01337000
DEBBAS01 EQU   DEBBASND                                                 01338000
DEBISAM  EQU   DEBBAS01                                                 01339000
DEBFIEAD EQU   DEBISAM                                                  01340000
DEBFPEAD EQU   DEBISAM+4                                                01341000
DEBFOEAD EQU   DEBISAM+8                                                01342000
DEBEXPT  EQU   DEBISAM+12                                               01343000
DEBRPSID EQU   DEBEXPT                                                  01344000
JFCKEYLE EQU   JFCTRTCH                                                 01345000
JFCCODE  EQU   JFCKEYLE                                                 01346000
JFCSTACK EQU   JFCTRTCH                                                 01347000
JFCMODE  EQU   JFCSTACK                                                 01348000
JFCSPPRT EQU   JFCTRTCH                                                 01349000
JFCBABFS EQU   JFCSPPRT+2                                               01350000
JFCLIMCT EQU   JFCBABFS                                                 01351000
JFCDSORG EQU   JFCSPPRT+5                                               01352000
JFCDSRG1 EQU   JFCDSORG                                                 01353000
JFCDSRG2 EQU   JFCDSORG+1                                               01354000
JFCRECFM EQU   JFCSPPRT+7                                               01355000
JFCRCFM  EQU   JFCRECFM                                                 01356000
JFCOPTCD EQU   JFCSPPRT+8                                               01357000
JFCWVCSP EQU   JFCOPTCD                                                 01358000
JFCWVCIS EQU   JFCWVCSP                                                 01359000
JFCWVCBD EQU   JFCWVCIS                                                 01360000
JFCALLOW EQU   JFCOPTCD                                                 01361000
JFCRSV17 EQU   JFCALLOW                                                 01362000
JFCOVER  EQU   JFCRSV17                                                 01363000
JFCPCIBT EQU   JFCOPTCD                                                 01364000
JFCMAST  EQU   JFCPCIBT                                                 01365000
JFCEXT   EQU   JFCMAST                                                  01366000
JFCBCKPT EQU   JFCOPTCD                                                 01367000
JFCIND   EQU   JFCBCKPT                                                 01368000
JFCRSV18 EQU   JFCOPTCD                                                 01369000
JFCCYL   EQU   JFCRSV18                                                 01370000
JFCACT   EQU   JFCCYL                                                   01371000
JFCREDUC EQU   JFCOPTCD                                                 01372000
JFCRSV19 EQU   JFCREDUC                                                 01373000
JFCRSV20 EQU   JFCRSV19                                                 01374000
JFCRSV21 EQU   JFCOPTCD                                                 01375000
JFCDEL   EQU   JFCRSV21                                                 01376000
JFCOPTJ  EQU   JFCOPTCD                                                 01377000
JFCREORG EQU   JFCOPTJ                                                  01378000
JFCBLKSI EQU   JFCSPPRT+9                                               01379000
JFCBUFSI EQU   JFCBLKSI                                                 01380000
JFCAMSYN EQU   JFCSPPRT+11                                              01381000
JFCNCP   EQU   JFCAMSYN+2                                               01382000
JFCNTM   EQU   JFCAMSYN+3                                               01383000
JFCBFSEQ EQU   JFCNTM                                                   01384000
JFCPCI   EQU   JFCBFSEQ                                                 01385000
JFCRESRV EQU   JFCAMSYN+4                                               01386000
JFCUCSEG EQU   JFCRESRV                                                 01387000
JFCUCSOP EQU   JFCUCSEG+4                                               01388000
JFCBEXTP EQU   JFCUCSOP                                                 01389000
JFCFCBVR EQU   JFCUCSOP                                                 01390000
JFCOUTLI EQU   JFCUCSEG+5                                               01391000
JFCTHRSH EQU   JFCOUTLI                                                 01392000
JFCCPRI  EQU   JFCTHRSH                                                 01393000
JFCBVOLS EQU   JFCUCSEG+10                                              01394000
JFCBS001 EQU   JFCBVOLS                                                 01395000
JFCBEXAD EQU   JFCBS001+31                                              01396000
JFCBPQTY EQU   JFCBS001+34                                              01397000
JFCBCTRI EQU   JFCBS001+37                                              01398000
JFCBSQTY EQU   JFCBS001+38                                              01399000
JFCFLGS1 EQU   JFCBS001+41                                              01400000
JFCBSPNM EQU   JFCBS001+45                                              01401000
JFCBFLG3 EQU   JFCBSPNM                                                 01402000
UCBOBS01 EQU   UCBDEV                                                   01403000
UCBSTAB  EQU   UCBOBS01+10                                              01404000
UCBBSVL  EQU   UCBSTAB                                                  01405000
UCBPRSRS EQU   UCBSTAB                                                  01406000
UCBDMCT  EQU   UCBOBS01+11                                              01407000
UCBFL4   EQU   UCBOBS01+13                                              01408000
UCBOBS02 EQU   UCBDEV                                                   01409000
UCBTFL1  EQU   UCBOBS02+19                                              01410000
UCBXTN   EQU   UCBOBS02+20                                              01411000
UCBVOPT  EQU   UCBXTN                                                   01412000
UCBOBS03 EQU   UCBDEV                                                   01413000
UCBXTADR EQU   UCBOBS03                                                 01414000
UCBOBS04 EQU   UCBDEV                                                   01415000
UCBBTA   EQU   UCBOBS04+12                                              01416000
UCBOBS06 EQU   UCBDEV                                                   01417000
UCBAOF   EQU   UCBOBS06                                                 01418000
UCBAOF1  EQU   UCBAOF                                                   01419000
UCBAOF2  EQU   UCBAOF+1                                                 01420000
@NM00082 EQU   UCBOBS06+3                                               01421000
UCBIRB   EQU   UCBOBS06+4                                               01422000
UCBGRAF  EQU   UCBIRB                                                   01423000
UCBLDNCA EQU   UCBOBS06+8                                               01424000
UCBRDYQ  EQU   UCBLDNCA                                                 01425000
UCBIRLN  EQU   UCBRDYQ                                                  01426000
UCBLDNCB EQU   UCBRDYQ+1                                                01427000
UCBCTLNK EQU   UCBOBS06+12                                              01428000
UCBOBS07 EQU   UCBDEV                                                   01429000
UCBOBS08 EQU   UCBDEV                                                   01430000
UCBCTCAD EQU   UCBOBS08                                                 01431000
UCBCTCF1 EQU   UCBOBS08+4                                               01432000
UCBOBS09 EQU   UCBDEV                                                   01433000
DXXWTG   EQU   DSECTSIZ                                                 01434000
DXXAREA  EQU   DSECTSIZ+4                                               01435000
DXXMODNM EQU   DXXAREA                                                  01436000
DXXLNG   EQU   DXXAREA+29                                               01437000
DXXENTRY EQU   DXXAREA+32                                               01438000
DXXIDTTR EQU   DXXENTRY                                                 01439000
DXREGSAV EQU   DXCCW8                                                   01440000
DXREG1   EQU   DXREGSAV+28                                              01441000
DXIDENT  EQU   DXCCW12                                                  01442000
DXCALLID EQU   DXIDENT                                                  01443000
DXRETMOD EQU   DXIDENT+2                                                01444000
@NM00101 EQU   DXXCTL                                                   01445000
DXSAVMOD EQU   @NM00101+2                                               01446000
@NM00102 EQU   DXRESSW                                                  01447000
DXBTAMX  EQU   DXREG1                                                   01448000
DXDSNAME EQU   DXCCW5                                                   01449000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    01450000
DXRESIND EQU   @NM00102                                                 01451000
DXSAVOFF EQU   @NM00101+7                                               01452000
DXSAVADR EQU   DXSAVMOD+2                                               01453000
DXSAVID  EQU   DXSAVMOD                                                 01454000
DXABCODE EQU   @NM00101                                                 01455000
DXRETCOD EQU   DXIDENT+7                                                01456000
DXRETTTR EQU   DXRETMOD+2                                               01457000
DXRETID  EQU   DXRETMOD                                                 01458000
DXREG0   EQU   DXREGSAV+24                                              01459000
DXREGE   EQU   DXREGSAV+20                                              01460000
DXREGD   EQU   DXREGSAV+16                                              01461000
DXREGC   EQU   DXREGSAV+12                                              01462000
DXREGB   EQU   DXREGSAV+8                                               01463000
DXREGA   EQU   DXREGSAV+4                                               01464000
DXREG9   EQU   DXREGSAV                                                 01465000
DXXEND   EQU   DXXAREA+48                                               01466000
DXXLAST  EQU   DXXAREA+40                                               01467000
DXXCORE  EQU   DXXENTRY+5                                               01468000
DXETTR   EQU   DXXIDTTR+2                                               01469000
DXEID    EQU   DXXIDTTR                                                 01470000
DXXPATHS EQU   DXXAREA+30                                               01471000
DXOPCLSW EQU   DXXLNG                                                   01472000
DXXTXTLN EQU   DXXAREA+27                                               01473000
DXXMODSZ EQU   DXXAREA+24                                               01474000
DXXATTRB EQU   DXXAREA+22                                               01475000
@NM00086 EQU   DXXAREA+20                                               01476000
DXXPREFX EQU   DXXAREA+16                                               01477000
@NM00085 EQU   DXXAREA+12                                               01478000
DXXMODEP EQU   DXXAREA+8                                                01479000
DXXMODID EQU   DXXMODNM+6                                               01480000
@NM00084 EQU   DXXMODNM                                                 01481000
DXXWTOPR EQU   DXXWTG                                                   01482000
UCBRV066 EQU   UCBOBS09+4                                               01483000
UCBIOSBA EQU   UCBOBS09                                                 01484000
UCBRV042 EQU   UCBOBS08+5                                               01485000
UCBRV082 EQU   UCBCTCF1                                                 01486000
UCBRV081 EQU   UCBCTCF1                                                 01487000
UCBRV080 EQU   UCBCTCF1                                                 01488000
UCBRV079 EQU   UCBCTCF1                                                 01489000
UCBRV078 EQU   UCBCTCF1                                                 01490000
UCBRV077 EQU   UCBCTCF1                                                 01491000
UCBRV076 EQU   UCBCTCF1                                                 01492000
UCBCTC80 EQU   UCBCTCF1                                                 01493000
UCBCTCAL EQU   UCBCTCAD                                                 01494000
UCBICNCB EQU   UCBOBS07+4                                               01495000
UCBRV040 EQU   UCBOBS07                                                 01496000
UCBCTLNA EQU   UCBCTLNK+1                                               01497000
UCBRLN   EQU   UCBCTLNK                                                 01498000
UCBRDYQA EQU   UCBLDNCB                                                 01499000
UCBINRLN EQU   UCBIRLN                                                  01500000
UCBIRBA  EQU   UCBIRB+1                                                 01501000
UCBRV039 EQU   UCBGRAF                                                  01502000
UCBDWNR  EQU   UCBGRAF                                                  01503000
UCBRPND  EQU   UCBGRAF                                                  01504000
UCBUPM   EQU   UCBGRAF                                                  01505000
UCBBTAM  EQU   UCBGRAF                                                  01506000
UCBDRNO  EQU   UCBGRAF                                                  01507000
UCBDRO   EQU   UCBGRAF                                                  01508000
UCBOIP   EQU   UCBGRAF                                                  01509000
UCBATRCD EQU   @NM00082                                                 01510000
UCBSKPFG EQU   @NM00082                                                 01511000
UCBRIPND EQU   @NM00082                                                 01512000
UCBRTIAC EQU   @NM00082                                                 01513000
UCBRSV79 EQU   @NM00082                                                 01514000
UCBRSV78 EQU   @NM00082                                                 01515000
UCBRSV77 EQU   @NM00082                                                 01516000
UCBOLTEP EQU   @NM00082                                                 01517000
UCBATNCT EQU   UCBOBS06+2                                               01518000
UCBRSV76 EQU   UCBAOF2                                                  01519000
UCBRSV75 EQU   UCBAOF2                                                  01520000
UCBRSV74 EQU   UCBAOF2                                                  01521000
UCBRSV73 EQU   UCBAOF2                                                  01522000
UCBRSV72 EQU   UCBAOF2                                                  01523000
UCBRSV71 EQU   UCBAOF2                                                  01524000
UCBRSV70 EQU   UCBAOF2                                                  01525000
UCBRSV69 EQU   UCBAOF2                                                  01526000
UCBRSV68 EQU   UCBAOF1                                                  01527000
UCBRSV67 EQU   UCBAOF1                                                  01528000
UCBRSV66 EQU   UCBAOF1                                                  01529000
UCBRSV65 EQU   UCBAOF1                                                  01530000
UCBRSV64 EQU   UCBAOF1                                                  01531000
UCBOFNL  EQU   UCBAOF1                                                  01532000
UCBOFSP  EQU   UCBAOF1                                                  01533000
UCBOFMCR EQU   UCBAOF1                                                  01534000
UCBBTB   EQU   UCBBTA+1                                                 01535000
UCBDI    EQU   UCBBTA                                                   01536000
UCBSNS   EQU   UCBOBS04+8                                               01537000
UCBTEB   EQU   UCBOBS04+4                                               01538000
UCBGCB   EQU   UCBOBS04+3                                               01539000
UCBOPEN  EQU   UCBOBS04+2                                               01540000
UCBSTART EQU   UCBOBS04                                                 01541000
UCBXTNB  EQU   UCBXTN+1                                                 01542000
UCBRSV22 EQU   UCBVOPT                                                  01543000
UCBRSV21 EQU   UCBVOPT                                                  01544000
UCBRSV20 EQU   UCBVOPT                                                  01545000
UCBESVE  EQU   UCBVOPT                                                  01546000
UCBERPC  EQU   UCBVOPT                                                  01547000
UCBESVC  EQU   UCBVOPT                                                  01548000
UCBEVA   EQU   UCBVOPT                                                  01549000
UCBESV   EQU   UCBVOPT                                                  01550000
UCBRV009 EQU   UCBTFL1                                                  01551000
UCBRV008 EQU   UCBTFL1                                                  01552000
UCBRV007 EQU   UCBTFL1                                                  01553000
UCBRV006 EQU   UCBTFL1                                                  01554000
UCBRV005 EQU   UCBTFL1                                                  01555000
UCBDQDSP EQU   UCBTFL1                                                  01556000
UCBNSLTP EQU   UCBTFL1                                                  01557000
UCBNLTP  EQU   UCBTFL1                                                  01558000
UCBRES1B EQU   UCBOBS02+18                                              01559000
UCBFSER  EQU   UCBOBS02+12                                              01560000
@NM00081 EQU   UCBOBS02+4                                               01561000
UCBFSEQ  EQU   UCBOBS02+2                                               01562000
UCBFSCT  EQU   UCBOBS02                                                 01563000
UCBNEXP  EQU   UCBOBS01+20                                              01564000
UCBBASE  EQU   UCBOBS01+16                                              01565000
UCBRES1A EQU   UCBOBS01+15                                              01566000
UCBUSER  EQU   UCBOBS01+14                                              01567000
UCBFL47  EQU   UCBFL4                                                   01568000
UCBFL46  EQU   UCBFL4                                                   01569000
UCBFL45  EQU   UCBFL4                                                   01570000
UCBRV065 EQU   UCBFL4                                                   01571000
UCBDSS   EQU   UCBFL4                                                   01572000
UCBRESVP EQU   UCBFL4                                                   01573000
UCBWDAV  EQU   UCBFL4                                                   01574000
UCBDAVV  EQU   UCBFL4                                                   01575000
UCBSQC   EQU   UCBOBS01+12                                              01576000
UCBDATP  EQU   UCBOBS01+12                                              01577000
UCBDMC   EQU   UCBDMCT                                                  01578000
UCBMOUNT EQU   UCBDMCT                                                  01579000
UCBBNUL  EQU   UCBSTAB                                                  01580000
UCBSHAR  EQU   UCBSTAB                                                  01581000
UCBBSTR  EQU   UCBSTAB                                                  01582000
UCBBPUB  EQU   UCBSTAB                                                  01583000
UCBBPRV  EQU   UCBSTAB                                                  01584000
UCBBALB  EQU   UCBPRSRS                                                 01585000
UCBPGFL  EQU   UCBSTAB                                                  01586000
UCBDVSHR EQU   UCBBSVL                                                  01587000
UCBVOLI  EQU   UCBOBS01+4                                               01588000
UCBVTOC  EQU   UCBOBS01                                                 01589000
JFCBEND  EQU   JFCBS001+58                                              01590000
JFCBSPTN EQU   JFCBS001+57                                              01591000
JFCBVLCT EQU   JFCBS001+56                                              01592000
JFCBDRLH EQU   JFCBS001+53                                              01593000
JFCBSBNM EQU   JFCBS001+50                                              01594000
JFCBABST EQU   JFCBS001+48                                              01595000
JFCBRV08 EQU   JFCBSPNM+1                                               01596000
JFCBRV07 EQU   JFCBFLG3                                                 01597000
JFCBRV06 EQU   JFCBFLG3                                                 01598000
JFCBRV05 EQU   JFCBFLG3                                                 01599000
JFCBRV04 EQU   JFCBFLG3                                                 01600000
JFCBRV03 EQU   JFCBFLG3                                                 01601000
JFCBRV02 EQU   JFCBFLG3                                                 01602000
JFCBRV01 EQU   JFCBFLG3                                                 01603000
JFCDQDSP EQU   JFCBFLG3                                                 01604000
JFCBDQTY EQU   JFCBS001+42                                              01605000
JFCBUAFF EQU   JFCFLGS1                                                 01606000
JFCRSV45 EQU   JFCFLGS1                                                 01607000
JFCVRDS  EQU   JFCFLGS1                                                 01608000
JFCBCEOV EQU   JFCFLGS1                                                 01609000
JFCRSV42 EQU   JFCFLGS1                                                 01610000
JFCBADSP EQU   JFCFLGS1                                                 01611000
JFCTOPEN EQU   JFCFLGS1                                                 01612000
JFCBDLET EQU   JFCFLGS1                                                 01613000
JFCRQID  EQU   JFCBSQTY                                                 01614000
JFCROUND EQU   JFCBCTRI                                                 01615000
JFCALX   EQU   JFCBCTRI                                                 01616000
JFCMIXG  EQU   JFCBCTRI                                                 01617000
JFCONTIG EQU   JFCBCTRI                                                 01618000
JFCRSV29 EQU   JFCBCTRI                                                 01619000
JFCBMSGP EQU   JFCBCTRI                                                 01620000
JFCBSPAC EQU   JFCBCTRI                                                 01621000
JFCRUNIT EQU   JFCBPQTY                                                 01622000
JFCBEXTL EQU   JFCBS001+30                                              01623000
JFCMSVGP EQU   JFCBS001+22                                              01624000
@NM00051 EQU   JFCBS001                                                 01625000
JFCAVOLS EQU   JFCBVOLS                                                 01626000
JFCBNVOL EQU   JFCUCSEG+9                                               01627000
JFCBNTCS EQU   JFCUCSEG+8                                               01628000
JFCSOWA  EQU   JFCOUTLI+1                                               01629000
JFCSEND  EQU   JFCCPRI                                                  01630000
JFCEQUAL EQU   JFCCPRI                                                  01631000
JFCRECV  EQU   JFCCPRI                                                  01632000
JFCRSV34 EQU   JFCCPRI                                                  01633000
JFCRSV33 EQU   JFCCPRI                                                  01634000
JFCRSV55 EQU   JFCCPRI                                                  01635000
JFCRSV54 EQU   JFCCPRI                                                  01636000
JFCRSV53 EQU   JFCCPRI                                                  01637000
JFCRSV27 EQU   JFCUCSOP                                                 01638000
JFCRSV26 EQU   JFCUCSOP                                                 01639000
JFCFCBAL EQU   JFCUCSOP                                                 01640000
JFCVER   EQU   JFCUCSOP                                                 01641000
JFCRSV25 EQU   JFCUCSOP                                                 01642000
JFCFOLD  EQU   JFCUCSOP                                                 01643000
JFCUCSID EQU   JFCUCSEG                                                 01644000
JFCINTVL EQU   JFCSPPRT+19                                              01645000
JFCDBUFN EQU   JFCRESRV+3                                               01646000
JFCCYLOF EQU   JFCRESRV+2                                               01647000
JFCRKP   EQU   JFCRESRV                                                 01648000
JFCPCIR2 EQU   JFCPCI                                                   01649000
JFCPCIR1 EQU   JFCPCI                                                   01650000
JFCPCIN2 EQU   JFCPCI                                                   01651000
JFCPCIN1 EQU   JFCPCI                                                   01652000
JFCPCIA2 EQU   JFCPCI                                                   01653000
JFCPCIA1 EQU   JFCPCI                                                   01654000
JFCPCIX2 EQU   JFCPCI                                                   01655000
JFCPCIX1 EQU   JFCPCI                                                   01656000
JFCBUFMX EQU   JFCNCP                                                   01657000
JFCLRECL EQU   JFCAMSYN                                                 01658000
JFCBAXBF EQU   JFCBUFSI                                                 01659000
JFCREL   EQU   JFCREORG                                                 01660000
JFCRSV22 EQU   JFCDEL                                                   01661000
JFCSRCHD EQU   JFCRSV20                                                 01662000
JFCOPTQ  EQU   JFCACT                                                   01663000
JFCFEED  EQU   JFCIND                                                   01664000
JFCCBWU  EQU   JFCEXT                                                   01665000
JFCWUMSG EQU   JFCOVER                                                  01666000
JFCSDNAM EQU   JFCWVCBD                                                 01667000
@NM00050 EQU   JFCRECFM                                                 01668000
JFCCHAR  EQU   JFCRECFM                                                 01669000
JFCRFS   EQU   JFCRECFM                                                 01670000
JFCRFB   EQU   JFCRECFM                                                 01671000
JFCRFO   EQU   JFCRCFM                                                  01672000
JFCFMREC EQU   JFCRCFM                                                  01673000
JFCRSV16 EQU   JFCDSRG2                                                 01674000
JFCRSV15 EQU   JFCDSRG2                                                 01675000
JFCORGTR EQU   JFCDSRG2                                                 01676000
JFCORGAM EQU   JFCDSRG2                                                 01677000
JFCRSV13 EQU   JFCDSRG2                                                 01678000
JFCORGTQ EQU   JFCDSRG2                                                 01679000
JFCORGTX EQU   JFCDSRG2                                                 01680000
JFCORGGS EQU   JFCDSRG2                                                 01681000
JFCORGU  EQU   JFCDSRG1                                                 01682000
JFCORGPO EQU   JFCDSRG1                                                 01683000
JFCORGMQ EQU   JFCDSRG1                                                 01684000
JFCORGCQ EQU   JFCDSRG1                                                 01685000
JFCORGCX EQU   JFCDSRG1                                                 01686000
JFCORGDA EQU   JFCDSRG1                                                 01687000
JFCORGPS EQU   JFCDSRG1                                                 01688000
JFCORGIS EQU   JFCDSRG1                                                 01689000
JFCTRKBL EQU   JFCLIMCT+1                                               01690000
@NM00049 EQU   JFCLIMCT                                                 01691000
JFCDEN   EQU   JFCSPPRT+1                                               01692000
JFCPRTSP EQU   JFCSPPRT                                                 01693000
JFCONE   EQU   JFCMODE                                                  01694000
JFCTWO   EQU   JFCMODE                                                  01695000
JFCRSV07 EQU   JFCMODE                                                  01696000
JFCRSV06 EQU   JFCMODE                                                  01697000
JFCMODER EQU   JFCMODE                                                  01698000
JFCMODEO EQU   JFCMODE                                                  01699000
JFCEBCD  EQU   JFCMODE                                                  01700000
JFCBIN   EQU   JFCMODE                                                  01701000
JFCRSV32 EQU   JFCCODE                                                  01702000
JFCTTY   EQU   JFCCODE                                                  01703000
JFCASCII EQU   JFCCODE                                                  01704000
JFCNCR   EQU   JFCCODE                                                  01705000
JFCBUR   EQU   JFCCODE                                                  01706000
JFCFRI   EQU   JFCCODE                                                  01707000
JFCBCD   EQU   JFCCODE                                                  01708000
JFCNOCON EQU   JFCCODE                                                  01709000
DEBEXPTA EQU   DEBEXPT+1                                                01710000
DEBRSV12 EQU   DEBRPSID                                                 01711000
DEBRSV11 EQU   DEBRPSID                                                 01712000
DEBRSV10 EQU   DEBRPSID                                                 01713000
DEBRSV09 EQU   DEBRPSID                                                 01714000
DEBRPSAP EQU   DEBRPSID                                                 01715000
DEBRPSO  EQU   DEBRPSID                                                 01716000
DEBRPSI  EQU   DEBRPSID                                                 01717000
DEBRPSP  EQU   DEBRPSID                                                 01718000
DEBFOEB  EQU   DEBFOEAD+1                                               01719000
DEBNOEE  EQU   DEBFOEAD                                                 01720000
DEBFPEB  EQU   DEBFPEAD+1                                               01721000
DEBNPEE  EQU   DEBFPEAD                                                 01722000
DEBFIEB  EQU   DEBFIEAD+1                                               01723000
DEBNIEE  EQU   DEBFIEAD                                                 01724000
DEBBOESS EQU   DEBEODSS                                                 01725000
DEBBOE0  EQU   DEBEOD0                                                  01726000
DEBBOETT EQU   DEBEODTT                                                 01727000
DEBBOERV EQU   DEBEODRV                                                 01728000
DEBRV008 EQU   DEBDSID+7                                                01729000
DEBWTPTI EQU   DEBDSID+6                                                01730000
DEBEXDTE EQU   DEBDSID                                                  01731000
DEBRV007 EQU   DEBEAMFG                                                 01732000
DEBRV006 EQU   DEBEAMFG                                                 01733000
DEBRV005 EQU   DEBEAMFG                                                 01734000
DEBRV004 EQU   DEBEAMFG                                                 01735000
DEBSECVL EQU   DEBEAMFG                                                 01736000
DEBVAMSG EQU   DEBEAMFG                                                 01737000
DEBDSOPN EQU   DEBEAMFG                                                 01738000
DEBMULTI EQU   DEBEAMFG                                                 01739000
DEBVSEQU EQU   DEBASC09+2                                               01740000
DEBDSSQL EQU   DEBASC09+1                                               01741000
DEBVOLAC EQU   DEBASC09                                                 01742000
DEBWDCBA EQU   DEBWDCB+1                                                01743000
DEBRSV08 EQU   DEBWDCB                                                  01744000
DEBPDCBA EQU   DEBPDCB+1                                                01745000
DEBRSV07 EQU   DEBPDCB                                                  01746000
DEBRDCBA EQU   DEBRDCB+1                                                01747000
DEBRSV06 EQU   DEBRDCB                                                  01748000
DEBSUCBB EQU   DEBSUCBA+1                                               01749000
DEBSDVM  EQU   DEBSUCBA                                                 01750000
CVTRV628 EQU   CVTS01+728                                               01751000
CVTRV627 EQU   CVTS01+724                                               01752000
CVTRV626 EQU   CVTS01+720                                               01753000
CVTRV625 EQU   CVTS01+716                                               01754000
CVTRV624 EQU   CVTS01+712                                               01755000
CVTRV623 EQU   CVTS01+708                                               01756000
CVTRV622 EQU   CVTS01+704                                               01757000
CVTRV621 EQU   CVTS01+700                                               01758000
CVTIHASU EQU   CVTS01+696                                               01759000
CVTRV619 EQU   CVTS01+692                                               01760000
CVTRV618 EQU   CVTS01+688                                               01761000
CVTRV617 EQU   CVTS01+684                                               01762000
CVTRV616 EQU   CVTS01+680                                               01763000
CVTRV615 EQU   CVTS01+676                                               01764000
CVTRV614 EQU   CVTS01+672                                               01765000
CVTRV613 EQU   CVTS01+668                                               01766000
CVTTCASP EQU   CVTS01+664                                               01767000
CVT0PT03 EQU   CVTS01+660                                               01768000
CVT0PT0E EQU   CVTS01+656                                               01769000
CVTRV609 EQU   CVTS01+652                                               01770000
CVTCGK   EQU   CVTS01+648                                               01771000
CVTRAC   EQU   CVTS01+644                                               01772000
CVTRV606 EQU   CVTS01+640                                               01773000
CVTRV605 EQU   CVTS01+636                                               01774000
CVTRV604 EQU   CVTS01+632                                               01775000
CVTEFF02 EQU   CVTS01+628                                               01776000
CVTCBBR  EQU   CVTS01+624                                               01777000
CVTSSCR  EQU   CVTS01+620                                               01778000
CVTEVENT EQU   CVTS01+616                                               01779000
CVTCRCA  EQU   CVTS01+612                                               01780000
CVTTPIO  EQU   CVTS01+608                                               01781000
CVTADV   EQU   CVTS01+604                                               01782000
CVTGSDAB EQU   CVTGSDA                                                  01783000
CVTQV3   EQU   CVTS01+596                                               01784000
CVTQV2   EQU   CVTS01+592                                               01785000
CVTQV1   EQU   CVTS01+588                                               01786000
CVTRPT   EQU   CVTS01+584                                               01787000
CVTSSRB  EQU   CVTS01+580                                               01788000
CVTCSDRL EQU   CVTS01+576                                               01789000
CVTEXP1  EQU   CVTS01+572                                               01790000
CVTRMPMT EQU   CVTS01+568                                               01791000
CVTRMPTT EQU   CVTS01+564                                               01792000
CVTVPSA  EQU   CVTS01+560                                               01793000
CVTVSTOP EQU   CVTS01+556                                               01794000
CVTGTFR8 EQU   CVTS01+552                                               01795000
CVTQUIT  EQU   CVTS01+548                                               01796000
CVTVACR  EQU   CVTS01+544                                               01797000
CVTWTCB  EQU   CVTS01+540                                               01798000
CVTSTPRS EQU   CVTS01+536                                               01799000
CVT0PT02 EQU   CVTS01+532                                               01800000
CVTDARCM EQU   CVTS01+528                                               01801000
CVTIRECM EQU   CVTS01+524                                               01802000
CVTJRECM EQU   CVTS01+520                                               01803000
CVTVEMS0 EQU   CVTS01+516                                               01804000
CVTSPFRR EQU   CVTS01+512                                               01805000
CVTRLSTG EQU   CVTS01+508                                               01806000
CVT0TC0A EQU   CVTS01+504                                               01807000
CVTGMBR  EQU   CVTS01+500                                               01808000
CVTLFRM  EQU   CVTS01+496                                               01809000
CVTRMBR  EQU   CVTS01+492                                               01810000
CVTVIOP  EQU   CVTS01+488                                               01811000
CVTRV307 EQU   CVTS01+486                                               01812000
CVTRV306 EQU   CVTS01+484                                               01813000
CVTRV305 EQU   CVTS01+482                                               01814000
CVTRV304 EQU   CVTS01+480                                               01815000
CVTRV303 EQU   CVTS01+478                                               01816000
CVTRV302 EQU   CVTS01+476                                               01817000
CVTTRCA  EQU   CVTS01+472                                               01818000
CVTRV297 EQU   CVTRV289                                                 01819000
CVTRV296 EQU   CVTRV289                                                 01820000
CVTRV295 EQU   CVTRV289                                                 01821000
CVTRV294 EQU   CVTRV289                                                 01822000
CVTRV293 EQU   CVTRV289                                                 01823000
CVTRV292 EQU   CVTRV289                                                 01824000
CVTRV291 EQU   CVTRV289                                                 01825000
CVTRV290 EQU   CVTRV289                                                 01826000
CVTRV288 EQU   CVTRV280                                                 01827000
CVTRV287 EQU   CVTRV280                                                 01828000
CVTRV286 EQU   CVTRV280                                                 01829000
CVTRV285 EQU   CVTRV280                                                 01830000
CVTRV284 EQU   CVTRV280                                                 01831000
CVTRV283 EQU   CVTRV280                                                 01832000
CVTRV282 EQU   CVTRV280                                                 01833000
CVTRV281 EQU   CVTRV280                                                 01834000
CVTRV279 EQU   CVTRV271                                                 01835000
CVTRV278 EQU   CVTRV271                                                 01836000
CVTRV277 EQU   CVTRV271                                                 01837000
CVTRV276 EQU   CVTRV271                                                 01838000
CVTRV275 EQU   CVTRV271                                                 01839000
CVTRV274 EQU   CVTRV271                                                 01840000
CVTRV273 EQU   CVTRV271                                                 01841000
CVTRV272 EQU   CVTRV271                                                 01842000
CVTRV270 EQU   CVTRV262                                                 01843000
CVTRV269 EQU   CVTRV262                                                 01844000
CVTRV268 EQU   CVTRV262                                                 01845000
CVTRV267 EQU   CVTRV262                                                 01846000
CVTRV266 EQU   CVTRV262                                                 01847000
CVTRV265 EQU   CVTRV262                                                 01848000
CVTRV264 EQU   CVTRV262                                                 01849000
CVTRV263 EQU   CVTRV262                                                 01850000
CVTVFP   EQU   CVTS01+464                                               01851000
CVTVSI   EQU   CVTS01+460                                               01852000
CVTVPSIB EQU   CVTS01+456                                               01853000
CVTMFACT EQU   CVTMFRTR                                                 01854000
CVTMFCTL EQU   CVTS01+448                                               01855000
CVTPVBP  EQU   CVTS01+444                                               01856000
CVTPWI   EQU   CVTS01+440                                               01857000
CVTRV254 EQU   CVTS01+438                                               01858000
CVTRV253 EQU   CVTS01+436                                               01859000
CVTRV252 EQU   CVTS01+434                                               01860000
CVTRV251 EQU   CVTS01+433                                               01861000
CVTRV250 EQU   CVTS01+432                                               01862000
CVTRV249 EQU   CVTS01+431                                               01863000
CVTRV248 EQU   CVTS01+430                                               01864000
CVTRV247 EQU   CVTS01+429                                               01865000
CVTRV246 EQU   CVTS01+428                                               01866000
CVTRV245 EQU   CVTRV237                                                 01867000
CVTRV244 EQU   CVTRV237                                                 01868000
CVTRV243 EQU   CVTRV237                                                 01869000
CVTRV242 EQU   CVTRV237                                                 01870000
CVTRV241 EQU   CVTRV237                                                 01871000
CVTRV240 EQU   CVTRV237                                                 01872000
CVTRV239 EQU   CVTRV237                                                 01873000
CVTRV238 EQU   CVTRV237                                                 01874000
CVTRV236 EQU   CVTRV228                                                 01875000
CVTRV235 EQU   CVTRV228                                                 01876000
CVTRV234 EQU   CVTRV228                                                 01877000
CVTRV233 EQU   CVTRV228                                                 01878000
CVTRV232 EQU   CVTRV228                                                 01879000
CVTRV231 EQU   CVTRV228                                                 01880000
CVTRV230 EQU   CVTRV228                                                 01881000
CVTRV229 EQU   CVTRV228                                                 01882000
CVTRV227 EQU   CVTRV219                                                 01883000
CVTRV226 EQU   CVTRV219                                                 01884000
CVTRV225 EQU   CVTRV219                                                 01885000
CVTRV224 EQU   CVTRV219                                                 01886000
CVTRV223 EQU   CVTRV219                                                 01887000
CVTRV222 EQU   CVTRV219                                                 01888000
CVTRV221 EQU   CVTRV219                                                 01889000
CVTRV220 EQU   CVTRV219                                                 01890000
CVTRV218 EQU   CVTRV210                                                 01891000
CVTRV217 EQU   CVTRV210                                                 01892000
CVTRV216 EQU   CVTRV210                                                 01893000
CVTRV215 EQU   CVTRV210                                                 01894000
CVTRV214 EQU   CVTRV210                                                 01895000
CVTRV213 EQU   CVTRV210                                                 01896000
CVTRV212 EQU   CVTRV210                                                 01897000
CVTRV211 EQU   CVTRV210                                                 01898000
CVTLCCAT EQU   CVTS01+420                                               01899000
CVTPCCAT EQU   CVTS01+416                                               01900000
CVTIPCRP EQU   CVTS01+412                                               01901000
CVTIPCRI EQU   CVTS01+408                                               01902000
CVTIPCDS EQU   CVTS01+404                                               01903000
CVTAIDVT EQU   CVTS01+400                                               01904000
CVTSSAP  EQU   CVTS01+396                                               01905000
CVTEHCIR EQU   CVTS01+392                                               01906000
CVTEHDEF EQU   CVTS01+388                                               01907000
CVTDAIR  EQU   CVTS01+384                                               01908000
CVTPERFM EQU   CVTS01+380                                               01909000
CVT044R2 EQU   CVTS01+376                                               01910000
CVTFETCH EQU   CVTS01+372                                               01911000
CVTRSTWD EQU   CVTS01+368                                               01912000
CVTSPOST EQU   CVTS01+364                                               01913000
CVTIOBP  EQU   CVTS01+360                                               01914000
CVTASMVT EQU   CVTS01+356                                               01915000
CVTRECRQ EQU   CVTS01+352                                               01916000
CVTWSAC  EQU   CVTS01+348                                               01917000
CVTRV149 EQU   CVTS01+344                                               01918000
CVTWSAL  EQU   CVTS01+340                                               01919000
CVTSPSA  EQU   CVTS01+336                                               01920000
CVTGLMN  EQU   CVTS01+332                                               01921000
CVTVEAC0 EQU   CVTS01+328                                               01922000
CVT062R1 EQU   CVTS01+324                                               01923000
CVTRPOST EQU   CVTS01+320                                               01924000
CVTDQIQE EQU   CVTS01+316                                               01925000
CVTCSD   EQU   CVTS01+312                                               01926000
CVTLKRMA EQU   CVTS01+308                                               01927000
CVTRSPIE EQU   CVTS01+304                                               01928000
CVTRENQ  EQU   CVTS01+300                                               01929000
CVTLQCB  EQU   CVTS01+296                                               01930000
CVTFQCB  EQU   CVTS01+292                                               01931000
CVTQCS01 EQU   CVTS01+288                                               01932000
CVTAPFT  EQU   CVTS01+284                                               01933000
CVTPARRL EQU   CVTS01+280                                               01934000
CVTVWAIT EQU   CVTS01+276                                               01935000
CVTGSPL  EQU   CVTS01+272                                               01936000
CVTLSMQ  EQU   CVTS01+268                                               01937000
CVTGSMQ  EQU   CVTS01+264                                               01938000
CVTEXPRO EQU   CVTS01+260                                               01939000
CVTOPCTP EQU   CVTS01+256                                               01940000
CVTSIC   EQU   CVTS01+252                                               01941000
CVTTPIOS EQU   CVTS01+248                                               01942000
CVTRTMS  EQU   CVTS01+244                                               01943000
CVTSDBF  EQU   CVTS01+240                                               01944000
CVTSCBP  EQU   CVTS01+236                                               01945000
CVTSDMP  EQU   CVTS01+232                                               01946000
CVTSV60  EQU   CVTS01+228                                               01947000
CVTRTMCT EQU   CVTS01+224                                               01948000
CVTASCBL EQU   CVTS01+220                                               01949000
CVTASCBH EQU   CVTS01+216                                               01950000
CVTGDA   EQU   CVTS01+212                                               01951000
CVTASVT  EQU   CVTS01+208                                               01952000
CVTVVMDI EQU   CVTS01+204                                               01953000
CVTAQTOP EQU   CVTS01+200                                               01954000
CVTIOSCS EQU   CVTS01+196                                               01955000
CVTSDRM  EQU   CVTS01+192                                               01956000
CVTOPTE  EQU   CVTS01+188                                               01957000
CVTSTXU  EQU   CVTS01+184                                               01958000
CVTQUIS  EQU   CVTS01+180                                               01959000
CVTPARS  EQU   CVTS01+176                                               01960000
CVTS1EE  EQU   CVTS01+172                                               01961000
CVTFRAS  EQU   CVTS01+168                                               01962000
CVTQSAS  EQU   CVTS01+164                                               01963000
CVTCRAS  EQU   CVTS01+160                                               01964000
CVTCRMN  EQU   CVTS01+156                                               01965000
CVTDELCP EQU   CVTS01+152                                               01966000
CVTFRECL EQU   CVTS01+148                                               01967000
CVTGETCL EQU   CVTS01+144                                               01968000
CVTBLDCP EQU   CVTS01+140                                               01969000
CVTAUTHL EQU   CVTS01+136                                               01970000
CVTSCAN  EQU   CVTS01+132                                               01971000
CVTRV144 EQU   CVTS01+130                                               01972000
CVTMAXMP EQU   CVTS01+128                                               01973000
CVTSTCK  EQU   CVTS01+124                                               01974000
CVTRV139 EQU   CVTS01+123                                               01975000
CVTDSSAC EQU   CVTS01+122                                               01976000
CVTRV513 EQU   CVTS01+121                                               01977000
CVTIOSPL EQU   CVTS01+120                                               01978000
CVTPTGT  EQU   CVTS01+116                                               01979000
CVTCSPIE EQU   CVTS01+112                                               01980000
CVTSMFEX EQU   CVTS01+108                                               01981000
CVTOLT0A EQU   CVTS01+104                                               01982000
CVTSRBRT EQU   CVTS01+100                                               01983000
CVTPUTL  EQU   CVTS01+96                                                01984000
CVTASCRL EQU   CVTS01+92                                                01985000
CVTASCRF EQU   CVTS01+88                                                01986000
CVTRV326 EQU   CVTS01+84                                                01987000
CVTRV325 EQU   CVTS01+80                                                01988000
CVTRV324 EQU   CVTS01+76                                                01989000
CVT0VL01 EQU   CVTS01+72                                                01990000
CVTSHRVM EQU   CVTS01+68                                                01991000
CVTRV332 EQU   CVTS01+64                                                01992000
CVTTAS   EQU   CVTS01+60                                                01993000
CVTRSCN  EQU   CVTS01+56                                                01994000
CVTTRAC2 EQU   CVTS01+54                                                01995000
CVTTRACE EQU   CVTS01+52                                                01996000
CVTAPG   EQU   CVTS01+51                                                01997000
CVTSDTRC EQU   CVTCTLFG                                                 01998000
CVTGTRCE EQU   CVTCTLFG                                                 01999000
CVTNOMP  EQU   CVTCTLFG                                                 02000000
CVTRSV79 EQU   CVTCTLFG                                                 02001000
CVTDSTAT EQU   CVTCTLFG                                                 02002000
CVTRSV78 EQU   CVTCTLFG                                                 02003000
CVTRV333 EQU   CVTCTLFG                                                 02004000
CVTRV323 EQU   CVTCTLFG                                                 02005000
CVTSPVLK EQU   CVTS01+49                                                02006000
CVTRSV77 EQU   CVTS01+48                                                02007000
CVTRV331 EQU   CVTS01+44                                                02008000
CVTRV330 EQU   CVTS01+40                                                02009000
CVTRV329 EQU   CVTS01+36                                                02010000
CVTRV328 EQU   CVTS01+32                                                02011000
CVTRV322 EQU   CVTS01+28                                                02012000
CVTSLID  EQU   CVTSLIDA+1                                               02013000
CVTSYLK  EQU   CVTSLIDA                                                 02014000
CVTRV321 EQU   CVTS01+20                                                02015000
CVTRV320 EQU   CVTS01+16                                                02016000
CVTLPDIR EQU   CVTLPDIA+1                                               02017000
CVTRSV69 EQU   CVTDIRST                                                 02018000
CVTRSV68 EQU   CVTDIRST                                                 02019000
CVTRSV67 EQU   CVTDIRST                                                 02020000
CVTRSV66 EQU   CVTDIRST                                                 02021000
CVTRSV65 EQU   CVTDIRST                                                 02022000
CVTRSV64 EQU   CVTDIRST                                                 02023000
CVTRSV63 EQU   CVTDIRST                                                 02024000
CVTDICOM EQU   CVTDIRST                                                 02025000
CVTPVTP  EQU   CVTS01+8                                                 02026000
CVTLPDSR EQU   CVTS01+4                                                 02027000
CVTGETL  EQU   CVTS01                                                   02028000
@NM00002 EQU   @NM00001                                                 02029000
APPNAMID EQU   APPNMTBL+24                                              02030000
APPOFFST EQU   APPENTRY+2                                               02031000
APPCOUNT EQU   APPENTRY                                                 02032000
APPSIZE  EQU   APPNMTBL+2                                               02033000
APPBAL   EQU   APPNMTBL                                                 02034000
WTGOPD   EQU   WTGPATHS+1                                               02035000
WTGRECHK EQU   WTGPATHS+1                                               02036000
WTGTSENQ EQU   WTGPATHS+1                                               02037000
@NM00100 EQU   WTGPATHS+1                                               02038000
WTGTRACE EQU   WTGPATHS+1                                               02039000
@NM00099 EQU   WTGPATHS                                                 02040000
WTGJFCBW EQU   WTGPATHS                                                 02041000
WTGSMF   EQU   WTGPATHS                                                 02042000
WTGTCOS  EQU   WTGPATHS                                                 02043000
WTGNSL   EQU   WTGPATHS                                                 02044000
WTGPRLSE EQU   WTGPATHS                                                 02045000
WTGLNG   EQU   WTG+29                                                   02046000
WTGTXTLN EQU   WTGAREA+27                                               02047000
WTGMODSZ EQU   WTGAREA+24                                               02048000
WTGATTRB EQU   WTGAREA+22                                               02049000
@NM00098 EQU   WTGAREA+20                                               02050000
@NM00097 EQU   WTGAREA+12                                               02051000
@NM00096 EQU   WTGMODNM                                                 02052000
DSMADTW6 EQU   DSMADTRL+20                                              02053000
DSMADTW5 EQU   DSMADTRL+16                                              02054000
DSMADTW4 EQU   DSMADTRL+12                                              02055000
DSMADTW3 EQU   DSMADTRL+8                                               02056000
DSMADTW2 EQU   DSMADTRL+4                                               02057000
DSMADTB4 EQU   DSMADTW1+3                                               02058000
DSMADTB3 EQU   DSMADTW1+2                                               02059000
@NM00095 EQU   DSMADTB2                                                 02060000
DSMDSNE  EQU   DSMADTB2                                                 02061000
DSMTIOTE EQU   DSMADTB2                                                 02062000
DSMSMCE  EQU   DSMADTB2                                                 02063000
DSMVTOCR EQU   DSMADTB2                                                 02064000
DSMASWAP EQU   DSMADTB1                                                 02065000
DSMUCBAL EQU   DSMADTB1                                                 02066000
DSMRPSAP EQU   DSMADTB1                                                 02067000
DSMLOCK  EQU   DSMADTB1                                                 02068000
@NM00094 EQU   DSMADTB1                                                 02069000
DSMVIO   EQU   DSMADTB1                                                 02070000
DSMISAM  EQU   DSMADTB1                                                 02071000
RRFWORK  EQU   RRPLIST+20                                               02072000
RRMLRTRY EQU   RRPLIST+16                                               02073000
RRUCBPTR EQU   RRXRETRY                                                 02074000
RR1RETRY EQU   RRPLIST+8                                                02075000
RR1WRKAR EQU   RRPLIST+4                                                02076000
@NM00093 EQU   RRFLAGS3                                                 02077000
RRFTERM  EQU   RRFLAGS3                                                 02078000
RRFFCEXC EQU   RRFLAGS3                                                 02079000
RRFFINFC EQU   RRFLAGS3                                                 02080000
RRFNRTCA EQU   RRFLAGS3                                                 02081000
@NM00092 EQU   RRFLAGS3                                                 02082000
RRFENQUL EQU   RRFLAGS2                                                 02083000
RRFPRDET EQU   RRFLAGS2                                                 02084000
@NM00091 EQU   RRFLAGS2                                                 02085000
RRFQMNGR EQU   RRFLAGS2                                                 02086000
RRFENQPW EQU   RRFLAGS2                                                 02087000
@NM00090 EQU   RRFLAGS2                                                 02088000
RRFFIN1  EQU   RRFLAGS2                                                 02089000
RRFTRACE EQU   RRFLAGS1                                                 02090000
RRFSMF   EQU   RRFLAGS1                                                 02091000
RRFNSL   EQU   RRFLAGS1                                                 02092000
RRFAMSTR EQU   RRFLAGS1                                                 02093000
RRFAMEXR EQU   RRFLAGS1                                                 02094000
RRFAMEXG EQU   RRFLAGS1                                                 02095000
RRFUSREX EQU   RRFLAGS1                                                 02096000
@NM00089 EQU   RRFLAGS1                                                 02097000
RRFRJFCB EQU   RRFUNCTN                                                 02098000
RRFDADSM EQU   RRFUNCTN                                                 02099000
DXDCBLST EQU   USERPRML                                                 02100000
RWALIST  EQU   RWARESWA+12                                              02101000
RWAPARM  EQU   RWAPREFX+8                                               02102000
RWATRBUF EQU   RWAPREFX+4                                               02103000
RWATRACE EQU   RWAPREFX                                                 02104000
IECQMNGR EQU   IECEXTPR+92                                              02105000
IECMSGQA EQU   IECEXTPR+88                                              02106000
IECDCBNO EQU   IECUPRML                                                 02107000
IECRRPRM EQU   IECEXTPR+76                                              02108000
IECWTGTB EQU   IECEXTPR+72                                              02109000
IECCORP2 EQU   IECPREFX+28                                              02110000
IECCORP1 EQU   IECPREFX+24                                              02111000
IECCORPS EQU   IECPREFX+20                                              02112000
IECCORSP EQU   IECPREFX+19                                              02113000
@NM00088 EQU   IECPREFX+17                                              02114000
IECCORKY EQU   IECPREFX+16                                              02115000
IECCORAD EQU   IECPREFX+12                                              02116000
IECCORLN EQU   IECPREFX+8                                               02117000
@NM00087 EQU   IECPREFX+4                                               02118000
IECCORID EQU   IECPREFX                                                 02119000
UCBERADR EQU   UCBUCS+12                                                02120000
UCBFCBID EQU   UCBUCS+8                                                 02121000
UCBERCNT EQU   UCBUCS+7                                                 02122000
UCBRSV51 EQU   UCBUCS+6                                                 02123000
UCBRSV50 EQU   UCBFCBOP                                                 02124000
UCBRSV49 EQU   UCBFCBOP                                                 02125000
UCBRSV48 EQU   UCBFCBOP                                                 02126000
UCBRSV47 EQU   UCBFCBOP                                                 02127000
UCBRSV46 EQU   UCBFCBOP                                                 02128000
UCBRSV45 EQU   UCBFCBOP                                                 02129000
UCBRSV44 EQU   UCBFCBOP                                                 02130000
UCBFCBO1 EQU   UCBFCBOP                                                 02131000
UCBUCSPE EQU   UCBUCSOP                                                 02132000
UCBRSV43 EQU   UCBUCSOP                                                 02133000
UCBRSV42 EQU   UCBUCSOP                                                 02134000
UCBRSV41 EQU   UCBUCSOP                                                 02135000
UCBRSV40 EQU   UCBUCSOP                                                 02136000
UCBRSV39 EQU   UCBUCSOP                                                 02137000
UCBUCSO2 EQU   UCBUCSOP                                                 02138000
UCBUCSO1 EQU   UCBUCSOP                                                 02139000
UCBUCSID EQU   UCBUCS                                                   02140000
UCBRV075 EQU   UCBMDRBF                                                 02141000
UCBRV074 EQU   UCB3800X+32                                              02142000
UCBIMAGE EQU   UCB3800X+28                                              02143000
UCBFCBNM EQU   UCB3800X+24                                              02144000
UCBCHAR4 EQU   UCB3800X+20                                              02145000
UCBCHAR3 EQU   UCB3800X+16                                              02146000
UCBCHAR2 EQU   UCB3800X+12                                              02147000
UCBCHAR1 EQU   UCB3800X+8                                               02148000
UCBCGMID EQU   UCB3800X+4                                               02149000
UCBBRSTA EQU   UCBACTIV                                                 02150000
UCBRV063 EQU   UCBACTIV                                                 02151000
UCBRV062 EQU   UCBACTIV                                                 02152000
UCBRV061 EQU   UCBACTIV                                                 02153000
UCBRV060 EQU   UCBACTIV                                                 02154000
UCBRV059 EQU   UCBACTIV                                                 02155000
UCBRV058 EQU   UCBACTIV                                                 02156000
UCBRV057 EQU   UCBACTIV                                                 02157000
UCBRV050 EQU   UCB3800X+2                                               02158000
UCBCGMNO EQU   UCB3800X+1                                               02159000
UCBRV083 EQU   UCBOPTNS                                                 02160000
UCBBRSTR EQU   UCBOPTNS                                                 02161000
UCBRV056 EQU   UCBOPTNS                                                 02162000
UCBRV055 EQU   UCBOPTNS                                                 02163000
UCBRV054 EQU   UCBOPTNS                                                 02164000
UCBRV053 EQU   UCBOPTNS                                                 02165000
UCBRV052 EQU   UCBOPTNS                                                 02166000
UCBRV051 EQU   UCBOPTNS                                                 02167000
UCBRV073 EQU   UCB3540X+7                                               02168000
UCBRV072 EQU   UCBDKBYT                                                 02169000
UCBRV071 EQU   UCBDKBYT                                                 02170000
UCBRV070 EQU   UCBDKBYT                                                 02171000
UCBRV069 EQU   UCBDKBYT                                                 02172000
UCBRV068 EQU   UCBDKBYT                                                 02173000
UCBRV067 EQU   UCBDKBYT                                                 02174000
UCBVLVER EQU   UCBDKBYT                                                 02175000
UCBDKAMX EQU   UCBDKBYT                                                 02176000
UCBVLSER EQU   UCB3540X                                                 02177000
UCBRDATA EQU   UCBOCR+4                                                 02178000
UCBFRID  EQU   UCBOCR                                                   02179000
UCBCLN   EQU   UCBMT+14                                                 02180000
UCBERG   EQU   UCBMT+12                                                 02181000
UCBMS    EQU   UCBMT+11                                                 02182000
UCBNB    EQU   UCBMT+10                                                 02183000
UCBPW    EQU   UCBMT+9                                                  02184000
UCBPR    EQU   UCBMT+8                                                  02185000
UCBSIO   EQU   UCBMT+6                                                  02186000
UCBTW    EQU   UCBMT+5                                                  02187000
UCBTR    EQU   UCBMT+4                                                  02188000
UCBTWT   EQU   UCBMT+3                                                  02189000
UCBTRT   EQU   UCBMT+2                                                  02190000
UCBCTD   EQU   UCBMT                                                    02191000
UCBWTOID EQU   UCBCMEXT+17                                              02192000
UCBRV043 EQU   UCBCMEXT+16                                              02193000
UCBASID  EQU   UCBCMEXT+14                                              02194000
UCBMFCNT EQU   UCBCMEXT+12                                              02195000
UCBPMSK  EQU   UCBCMEXT+10                                              02196000
UCBCCWOF EQU   UCBCMEXT+8                                               02197000
UCBRV041 EQU   UCBCMEXT+6                                               02198000
UCBRV036 EQU   UCBFLP1                                                  02199000
UCBRV035 EQU   UCBFLP1                                                  02200000
UCBERLOG EQU   UCBFLP1                                                  02201000
UCBRV033 EQU   UCBFLP1                                                  02202000
UCBINHIO EQU   UCBFLP1                                                  02203000
UCBNSWAP EQU   UCBFLP1                                                  02204000
UCBSHRUP EQU   UCBFLP1                                                  02205000
UCBNSRCH EQU   UCBFLP1                                                  02206000
UCBSNSCT EQU   UCBCMEXT+4                                               02207000
UCBHPDV  EQU   @NM00083                                                 02208000
UCBHALI  EQU   @NM00083                                                 02209000
UCBRSV09 EQU   @NM00083                                                 02210000
UCBRSV08 EQU   @NM00083                                                 02211000
UCBRSV07 EQU   @NM00083                                                 02212000
UCBRSV06 EQU   @NM00083                                                 02213000
UCBRSV05 EQU   @NM00083                                                 02214000
UCBRSV04 EQU   @NM00083                                                 02215000
UCBDTI   EQU   UCBCMEXT+2                                               02216000
UCBSTI   EQU   UCBCMEXT+1                                               02217000
UCBETI   EQU   UCBCMEXT                                                 02218000
UCBEXTP  EQU   UCBEXTPT+1                                               02219000
UCBDDRSW EQU   UCBFLC                                                   02220000
UCBTICBT EQU   UCBFLC                                                   02221000
UCBIVRR  EQU   UCBFLC                                                   02222000
UCBIVRS  EQU   UCBFLC                                                   02223000
UCBITF   EQU   UCBFLC                                                   02224000
UCBUDE   EQU   UCBFLC                                                   02225000
UCBWAA   EQU   UCBFLC                                                   02226000
UCBATTP  EQU   UCBFLC                                                   02227000
UCBUNTYP EQU   UCBTBYT4                                                 02228000
UCBRSV11 EQU   UCBDVCLS                                                 02229000
UCBRSV10 EQU   UCBDVCLS                                                 02230000
UCB3CHAR EQU   UCBDVCLS                                                 02231000
UCB3UREC EQU   UCBDVCLS                                                 02232000
UCB3DISP EQU   UCBDVCLS                                                 02233000
UCB3DACC EQU   UCBDVCLS                                                 02234000
UCB3COMM EQU   UCBDVCLS                                                 02235000
UCB3TAPE EQU   UCBDVCLS                                                 02236000
UCBDVPWR EQU   UCB2OPT7                                                 02237000
UCBVLPWR EQU   UCB2OPT6                                                 02238000
UCB2OPT5 EQU   UCBTBYT2                                                 02239000
UCBRVDEV EQU   UCBRWTAU                                                 02240000
UCBRPS   EQU   UCBDUDN2                                                 02241000
UCBRR    EQU   UCBDUDN1                                                 02242000
UCB2OPT1 EQU   UCBTBYT2                                                 02243000
UCB2OPT0 EQU   UCBTBYT2                                                 02244000
UCB1FEA7 EQU   UCBTBYT1                                                 02245000
UCBD6250 EQU   UCB1FEA6                                                 02246000
UCBD1600 EQU   UCB1FEA5                                                 02247000
UCB1FEA4 EQU   UCBTBYT1                                                 02248000
UCB1FEA3 EQU   UCBTBYT1                                                 02249000
UCB1FEA2 EQU   UCBTBYT1                                                 02250000
UCB1FEA1 EQU   UCBTBYT1                                                 02251000
UCB1FEA0 EQU   UCBTBYT1                                                 02252000
UCBRV029 EQU   UCBWGT                                                   02253000
UCBVHRSN EQU   UCBWGT                                                   02254000
UCBVORSN EQU   UCBWGT                                                   02255000
UCBMTPXP EQU   UCBWGT                                                   02256000
UCBREW   EQU   UCBWGT                                                   02257000
UCBPUB   EQU   UCBWGT                                                   02258000
UCBOUT   EQU   UCBWGT                                                   02259000
UCBIN    EQU   UCBWGT                                                   02260000
UCBCPU   EQU   UCBOB+11                                                 02261000
UCBLCI   EQU   UCBOB+10                                                 02262000
UCBCNT   EQU   UCBOB+9                                                  02263000
UCBRV017 EQU   UCBCHM1                                                  02264000
UCBRV016 EQU   UCBCHM1                                                  02265000
UCBRV015 EQU   UCBCHM1                                                  02266000
UCBRV014 EQU   UCBCHM1                                                  02267000
UCBSPB   EQU   UCBPTH1                                                  02268000
UCBPPB   EQU   UCBPTH1                                                  02269000
UCBSPA   EQU   UCBPTH0                                                  02270000
UCBPPA   EQU   UCBPTH0                                                  02271000
UCBSIGP  EQU   UCBFLB                                                   02272000
UCBVALPH EQU   UCBFLB                                                   02273000
UCBCRHSN EQU   UCBFLB                                                   02274000
UCBCRHRV EQU   UCBFLB                                                   02275000
UCBRESVH EQU   UCBFLB                                                   02276000
UCBSPST  EQU   UCBFLB                                                   02277000
UCBASNS  EQU   UCBFLB                                                   02278000
UCBIORST EQU   UCBFLB                                                   02279000
UCBQISCE EQU   UCBFL1                                                   02280000
UCBACTV  EQU   UCBFL1                                                   02281000
UCBSAP   EQU   UCBFL1                                                   02282000
UCBNOTRC EQU   UCBCUB                                                   02283000
UCBPSNS  EQU   UCBFL1                                                   02284000
UCBUSING EQU   UCBPST                                                   02285000
UCBNOTRD EQU   UCBNRY                                                   02286000
UCBBUSYD EQU   UCBBSY                                                   02287000
UCBUA    EQU   UCBCHAN+1                                                02288000
UCBCHA   EQU   UCBCHAN                                                  02289000
UCBDADI  EQU   UCBSTAT                                                  02290000
UCBSYSR  EQU   UCBSTAT                                                  02291000
UCBPRES  EQU   UCBSTAT                                                  02292000
UCBALOC  EQU   UCBSTAT                                                  02293000
UCBUNLD  EQU   UCBSTAT                                                  02294000
UCBRESV  EQU   UCBSTAT                                                  02295000
UCBCHGS  EQU   UCBSTAT                                                  02296000
UCBONLI  EQU   UCBSTAT                                                  02297000
UCBID    EQU   UCBOB+2                                                  02298000
UCBALTPH EQU   UCBFL5                                                   02299000
UCBALTCU EQU   UCBFL5                                                   02300000
UCBNALOC EQU   UCBFL5                                                   02301000
UCBENVRD EQU   UCBFL5                                                   02302000
UCBVSDR  EQU   UCBFL5                                                   02303000
UCBSASK  EQU   UCBFL5                                                   02304000
UCBAMV   EQU   UCBAF                                                    02305000
UCBDCC   EQU   UCBFL5                                                   02306000
UCBMONT  EQU   UCBJBNR                                                  02307000
UCBRV011 EQU   UCBJBNR                                                  02308000
UCBMMSGP EQU   UCBJBNR                                                  02309000
UCBOLDSM EQU   UCBJBNR                                                  02310000
UCBRV003 EQU   UCBJBNR                                                  02311000
UCBDUC   EQU   UCBJBNR                                                  02312000
UCBJES3  EQU   UCBJBNR                                                  02313000
UCBVRDEV EQU   UCBJBNR                                                  02314000
UCBCMSEG EQU   UCBOB                                                    02315000
UCBPFXND EQU   UCB+512                                                  02316000
UCBIOQ   EQU   UCB+508                                                  02317000
UCBLOCK  EQU   UCB+504                                                  02318000
UCBPXST  EQU   UCB+504                                                  02319000
@NM00080 EQU   UCB                                                      02320000
@NM00079 EQU   TCBXTNT2+32                                              02321000
TCBRV181 EQU   TCBRV173                                                 02322000
TCBRV180 EQU   TCBRV173                                                 02323000
TCBRV179 EQU   TCBRV173                                                 02324000
TCBRV178 EQU   TCBRV173                                                 02325000
TCBRV177 EQU   TCBRV173                                                 02326000
TCBRV176 EQU   TCBRV173                                                 02327000
TCBRV175 EQU   TCBRV173                                                 02328000
TCBRV174 EQU   TCBRV173                                                 02329000
TCBRV172 EQU   TCBRV164                                                 02330000
TCBRV171 EQU   TCBRV164                                                 02331000
TCBRV170 EQU   TCBRV164                                                 02332000
TCBRV169 EQU   TCBRV164                                                 02333000
TCBRV168 EQU   TCBRV164                                                 02334000
TCBRV167 EQU   TCBRV164                                                 02335000
TCBRV166 EQU   TCBRV164                                                 02336000
TCBRV165 EQU   TCBRV164                                                 02337000
TCBRV163 EQU   TCBRV155                                                 02338000
TCBRV162 EQU   TCBRV155                                                 02339000
TCBRV161 EQU   TCBRV155                                                 02340000
TCBRV160 EQU   TCBRV155                                                 02341000
TCBRV159 EQU   TCBRV155                                                 02342000
TCBRV158 EQU   TCBRV155                                                 02343000
TCBRV157 EQU   TCBRV155                                                 02344000
TCBRV156 EQU   TCBRV155                                                 02345000
TCBRV154 EQU   TCBRV146                                                 02346000
TCBRV153 EQU   TCBRV146                                                 02347000
TCBRV152 EQU   TCBRV146                                                 02348000
TCBRV151 EQU   TCBRV146                                                 02349000
TCBRV150 EQU   TCBRV146                                                 02350000
TCBRV149 EQU   TCBRV146                                                 02351000
TCBRV148 EQU   TCBRV146                                                 02352000
TCBRV147 EQU   TCBRV146                                                 02353000
TCBRV145 EQU   TCBXTNT2+26                                              02354000
TCBRV144 EQU   TCBXTNT2+24                                              02355000
TCBRV143 EQU   TCBXTNT2+20                                              02356000
TCBRV142 EQU   TCBXTNT2+16                                              02357000
TCBRSV49 EQU   TCBXTNT2+12                                              02358000
TCBEVENT EQU   TCBXTNT2+8                                               02359000
TCBRCMP  EQU   TCBXTNT2+5                                               02360000
TCBRSVAB EQU   TCBXTNT2+4                                               02361000
TCBGTFA  EQU   TCBGTF+1                                                 02362000
TCBRSV47 EQU   TCBTFLG                                                  02363000
TCBRSV46 EQU   TCBTFLG                                                  02364000
TCBRSV45 EQU   TCBTFLG                                                  02365000
TCBRSV44 EQU   TCBTFLG                                                  02366000
TCBRSV43 EQU   TCBTFLG                                                  02367000
TCBDSPIT EQU   TCBTFLG                                                  02368000
TCBERRTN EQU   TCBTFLG                                                  02369000
TCBASYNC EQU   TCBTFLG                                                  02370000
@NM00078 EQU   TCB+296                                                  02371000
TCBSVCA2 EQU   TCB+292                                                  02372000
TCBSWASA EQU   TCB+288                                                  02373000
TCBDBTB  EQU   TCB+284                                                  02374000
TCBRPT   EQU   TCB+280                                                  02375000
TCBRV141 EQU   TCBRV133                                                 02376000
TCBRV140 EQU   TCBRV133                                                 02377000
TCBRV139 EQU   TCBRV133                                                 02378000
TCBRV138 EQU   TCBRV133                                                 02379000
TCBRV137 EQU   TCBRV133                                                 02380000
TCBRV136 EQU   TCBRV133                                                 02381000
TCBRV135 EQU   TCBRV133                                                 02382000
TCBRV134 EQU   TCBRV133                                                 02383000
TCBRV132 EQU   TCBRV124                                                 02384000
TCBRV131 EQU   TCBRV124                                                 02385000
TCBRV130 EQU   TCBRV124                                                 02386000
TCBRV129 EQU   TCBRV124                                                 02387000
TCBRV128 EQU   TCBRV124                                                 02388000
TCBRV127 EQU   TCBRV124                                                 02389000
TCBRV126 EQU   TCBRV124                                                 02390000
TCBRV125 EQU   TCBRV124                                                 02391000
TCBRV123 EQU   TCBFBYT2                                                 02392000
TCBRV122 EQU   TCBFBYT2                                                 02393000
TCBECBNV EQU   TCBFBYT2                                                 02394000
TCBSSSYN EQU   TCBFBYT2                                                 02395000
TCBFPRAP EQU   TCBFBYT2                                                 02396000
TCBFDW   EQU   TCBFBYT2                                                 02397000
TCBFMW   EQU   TCBFBYT2                                                 02398000
TCBCNCB  EQU   TCBFBYT2                                                 02399000
TCBLLH   EQU   TCBFBYT1                                                 02400000
TCBRV113 EQU   TCBFBYT1                                                 02401000
TCBEOT   EQU   TCBFBYT1                                                 02402000
TCBRTM2  EQU   TCBFBYT1                                                 02403000
TCBPGNLY EQU   TCBFBYT1                                                 02404000
TCBNDIOS EQU   TCBFBYT1                                                 02405000
TCBACTIV EQU   TCBFBYT1                                                 02406000
TCBEOTFM EQU   TCBFBYT1                                                 02407000
TCBAFFN  EQU   TCB+274                                                  02408000
TCBCCPVI EQU   TCB+272                                                  02409000
TCBUKYSP EQU   TCB+268                                                  02410000
TCBMODE  EQU   TCBESTAE+3                                               02411000
TCBERTYP EQU   TCBESTAE+2                                               02412000
TCBRV314 EQU   TCBESTRM                                                 02413000
TCBRV313 EQU   TCBESTRM                                                 02414000
TCBRV312 EQU   TCBESTRM                                                 02415000
TCBRV311 EQU   TCBESTRM                                                 02416000
TCBRV310 EQU   TCBESTRM                                                 02417000
TCBRV309 EQU   TCBESTRM                                                 02418000
TCBRV308 EQU   TCBESTRM                                                 02419000
TCBETERM EQU   TCBESTRM                                                 02420000
TCBSCBKY EQU   TCBESTAE                                                 02421000
TCBRTM12 EQU   TCB+260                                                  02422000
TCBTCBID EQU   TCB+256                                                  02423000
TCBRSV96 EQU   TCB+252                                                  02424000
TCBSWA   EQU   TCB+248                                                  02425000
TCBFOEA  EQU   TCBFOE+1                                                 02426000
TCBRSV42 EQU   TCBFOE                                                   02427000
TCBRV306 EQU   TCB+240                                                  02428000
TCBRSV41 EQU   TCB+239                                                  02429000
TCBTID   EQU   TCB+238                                                  02430000
TCBRSVAA EQU   TCB+237                                                  02431000
TCBABCUR EQU   TCB+236                                                  02432000
TCBTMSAV EQU   TCB+232                                                  02433000
TCBIOTIM EQU   TCB+228                                                  02434000
TCBRTWA  EQU   TCB+224                                                  02435000
TCBBACK  EQU   TCB+220                                                  02436000
TCBTIRB  EQU   TCB+216                                                  02437000
TCBAECB  EQU   TCB+212                                                  02438000
TCBEXT2A EQU   TCBEXT2+1                                                02439000
TCBRSV39 EQU   TCBEXT2                                                  02440000
TCBSTMCT EQU   TCB+207                                                  02441000
TCBSYSCT EQU   TCB+206                                                  02442000
TCBRSV37 EQU   TCB+205                                                  02443000
TCBEXSVC EQU   TCBDAR                                                   02444000
TCBDARMS EQU   TCBDAR                                                   02445000
TCBDARWT EQU   TCBDAR                                                   02446000
TCBDARO  EQU   TCBDAR                                                   02447000
TCBDARMC EQU   TCBDARC                                                  02448000
TCBDARD  EQU   TCBDAR                                                   02449000
TCBDARS  EQU   TCBDAR                                                   02450000
TCBDARP  EQU   TCBDAR                                                   02451000
TCBGTOFM EQU   TCBFLGS7                                                 02452000
TCBADMP  EQU   TCBFLGS7                                                 02453000
TCBRSTSK EQU   TCBFLGS7                                                 02454000
TCBSVCS  EQU   TCBFLGS7                                                 02455000
TCBSTACK EQU   TCBFLGS7                                                 02456000
TCBRSV34 EQU   TCBFLGS7                                                 02457000
TCBRSV33 EQU   TCBFLGS7                                                 02458000
TCBGPECB EQU   TCBFLGS7                                                 02459000
TCBNTJS  EQU   TCBFLGS6                                                 02460000
TCBAPG   EQU   TCBFLGS6                                                 02461000
TCBMIGR  EQU   TCBFLGS6                                                 02462000
TCBRV303 EQU   TCBFLGS6                                                 02463000
TCBSPVLK EQU   TCBFLGS6                                                 02464000
TCBCPU   EQU   TCBFLGS6                                                 02465000
TCBPIE17 EQU   TCBFLGS6                                                 02466000
TCBRV    EQU   TCBFLGS6                                                 02467000
TCBRSV79 EQU   TCBNDSP5                                                 02468000
TCBRSV78 EQU   TCBNDSP5                                                 02469000
TCBRSV77 EQU   TCBNDSP5                                                 02470000
TCBRSV76 EQU   TCBNDSP5                                                 02471000
TCBRSV75 EQU   TCBNDSP5                                                 02472000
TCBRSV74 EQU   TCBNDSP5                                                 02473000
TCBRSV95 EQU   TCBNDSP5                                                 02474000
TCBRSV94 EQU   TCBNDSP5                                                 02475000
TCBRSV93 EQU   TCBNDSP4                                                 02476000
TCBRSV92 EQU   TCBNDSP4                                                 02477000
TCBRSV91 EQU   TCBNDSP4                                                 02478000
TCBRSV90 EQU   TCBNDSP4                                                 02479000
TCBRSV89 EQU   TCBNDSP4                                                 02480000
TCBRSV88 EQU   TCBNDSP4                                                 02481000
TCBRSV87 EQU   TCBNDSP4                                                 02482000
TCBRSV86 EQU   TCBNDSP4                                                 02483000
TCBEXT1A EQU   TCBEXT1+1                                                02484000
TCBRSV32 EQU   TCBEXT1                                                  02485000
TCBEXCPD EQU   TCB+192                                                  02486000
TCBIOBRC EQU   TCB+188                                                  02487000
TCBDDWTC EQU   TCB+186                                                  02488000
TCBDDEXC EQU   TCB+184                                                  02489000
TCBJSCBB EQU   TCBJSCB+1                                                02490000
@NM00077 EQU   TCBRECDE                                                 02491000
TCBREC   EQU   TCBRECDE                                                 02492000
TCBMDIDS EQU   TCB+176                                                  02493000
TCBNDINT EQU   TCBNDSP3                                                 02494000
TCBRSV27 EQU   TCBNDSP3                                                 02495000
TCBRSV26 EQU   TCBNDSP3                                                 02496000
TCBRSV25 EQU   TCBNDSP3                                                 02497000
TCBRSV24 EQU   TCBNDSP3                                                 02498000
TCBSRBND EQU   TCBNDSP3                                                 02499000
TCBRV302 EQU   TCBNDSP3                                                 02500000
TCBLJSND EQU   TCBNDSP3                                                 02501000
TCBABE   EQU   TCBNDSP2                                                 02502000
TCBDSS   EQU   TCBNDSP2                                                 02503000
TCBOWAIT EQU   TCBNDSP2                                                 02504000
TCBIWAIT EQU   TCBNDSP2                                                 02505000
TCBNDTS  EQU   TCBNDSP2                                                 02506000
TCBNDSVC EQU   TCBNDSP2                                                 02507000
TCBSTPP  EQU   TCBNDSP2                                                 02508000
TCBABD   EQU   TCBNDSP2                                                 02509000
TCBRSV22 EQU   TCBNDSP1                                                 02510000
TCBPIEND EQU   TCBNDSP1                                                 02511000
TCBTPSP  EQU   TCBNDSP1                                                 02512000
TCBDDRND EQU   TCBNDSP1                                                 02513000
TCBRSPND EQU   TCBNDSP1                                                 02514000
TCBRSTND EQU   TCBNDSP1                                                 02515000
TCBDARPN EQU   TCBNDSP1                                                 02516000
TCBDARTN EQU   TCBNDSP1                                                 02517000
TCBNDSP0 EQU   TCBNDSP                                                  02518000
TCBUSER  EQU   TCB+168                                                  02519000
TCBTCTB  EQU   TCBTCT+1                                                 02520000
TCBRSV9C EQU   TCBTCTGF                                                 02521000
TCBRSV9B EQU   TCBTCTGF                                                 02522000
TCBRSV9A EQU   TCBTCTGF                                                 02523000
TCBRSV99 EQU   TCBTCTGF                                                 02524000
TCBRSV98 EQU   TCBTCTGF                                                 02525000
TCBRSV97 EQU   TCBTCTGF                                                 02526000
TCBRSV20 EQU   TCBTCTGF                                                 02527000
TCBSMFGF EQU   TCBTCTGF                                                 02528000
TCBSTABB EQU   TCBSTAB+1                                                02529000
TCBSTCUR EQU   TCBNSTAE                                                 02530000
TCBRV301 EQU   TCBNSTAE                                                 02531000
TCBSYNCH EQU   TCBNSTAE                                                 02532000
TCBHALT  EQU   TCBNSTAE                                                 02533000
TCBPPSUP EQU   TCBNSTAE                                                 02534000
TCB33E   EQU   TCBNSTAE                                                 02535000
TCBQUIES EQU   TCBNSTAE                                                 02536000
TCBSTABE EQU   TCBNSTAE                                                 02537000
TCBAQE   EQU   TCB+156                                                  02538000
TCBPQE   EQU   TCB+152                                                  02539000
TCBTSDP  EQU   TCB+151                                                  02540000
TCBTSLP  EQU   TCB+150                                                  02541000
TCBSTPCT EQU   TCB+149                                                  02542000
TCBCPUBN EQU   TCBTSFLG                                                 02543000
TCBDYDSP EQU   TCBTSFLG                                                 02544000
TCBRSV18 EQU   TCBTSFLG                                                 02545000
TCBRSV17 EQU   TCBTSFLG                                                 02546000
TCBTIOTG EQU   TCBTSFLG                                                 02547000
TCBATT   EQU   TCBTSFLG                                                 02548000
TCBSTPPR EQU   TCBTSFLG                                                 02549000
TCBRV300 EQU   TCBTSTSK                                                 02550000
TCBECB   EQU   TCB+144                                                  02551000
TCBIQE   EQU   TCB+140                                                  02552000
TCBLTC   EQU   TCB+136                                                  02553000
TCBOTC   EQU   TCB+132                                                  02554000
TCBNTC   EQU   TCB+128                                                  02555000
TCBJSTCA EQU   TCBJSTCB+1                                               02556000
TCBRSV16 EQU   TCBJSTCB                                                 02557000
TCBTQET  EQU   TCBTME                                                   02558000
TCBTCB   EQU   TCB+116                                                  02559000
TCBFSAB  EQU   TCBFSA+1                                                 02560000
TCBQEL   EQU   TCBFSA                                                   02561000
TCBGRS15 EQU   TCBGRS+60                                                02562000
TCBGRS14 EQU   TCBGRS+56                                                02563000
TCBGRS13 EQU   TCBGRS+52                                                02564000
TCBGRS12 EQU   TCBGRS+48                                                02565000
TCBGRS11 EQU   TCBGRS+44                                                02566000
TCBGRS10 EQU   TCBGRS+40                                                02567000
TCBGRS9  EQU   TCBGRS+36                                                02568000
TCBGRS8  EQU   TCBGRS+32                                                02569000
TCBGRS7  EQU   TCBGRS+28                                                02570000
TCBGRS6  EQU   TCBGRS+24                                                02571000
TCBGRS5  EQU   TCBGRS+20                                                02572000
TCBGRS4  EQU   TCBGRS+16                                                02573000
TCBGRS3  EQU   TCBGRS+12                                                02574000
TCBGRS2  EQU   TCBGRS+8                                                 02575000
TCBGRS1  EQU   TCBGRS+4                                                 02576000
TCBGRS0  EQU   TCBGRS                                                   02577000
TCBJPQB  EQU   TCBJPQ+1                                                 02578000
TCBRSV15 EQU   TCBPURGE                                                 02579000
TCBRSV14 EQU   TCBPURGE                                                 02580000
TCBRSV13 EQU   TCBPURGE                                                 02581000
TCBRSV12 EQU   TCBPURGE                                                 02582000
TCBRSV11 EQU   TCBPURGE                                                 02583000
TCBRSV10 EQU   TCBPURGE                                                 02584000
TCBRSV09 EQU   TCBPURGE                                                 02585000
TCBJPQF  EQU   TCBPURGE                                                 02586000
TCBJLB   EQU   TCB+40                                                   02587000
TCBLLS   EQU   TCB+36                                                   02588000
TCBDSP   EQU   TCB+35                                                   02589000
TCBLMP   EQU   TCB+34                                                   02590000
TCBPNDSP EQU   TCBFLGS5                                                 02591000
TCBFCD1  EQU   TCBFLGS5                                                 02592000
TCBSTP   EQU   TCBFLGS5                                                 02593000
TCBSYS   EQU   TCBFLGS5                                                 02594000
TCBANDSP EQU   TCBFLGS5                                                 02595000
TCBPAGE  EQU   TCBFLGS5                                                 02596000
TCBUXNDF EQU   TCBABWF                                                  02597000
TCBFC    EQU   TCBFLGS5                                                 02598000
TCBONDSP EQU   TCBFLGS4                                                 02599000
TCBMPCND EQU   TCBFLGS4                                                 02600000
TCBMPCVQ EQU   TCBFLGS4                                                 02601000
TCBUXNDV EQU   TCBFLGS4                                                 02602000
TCBHNDSP EQU   TCBFLGS4                                                 02603000
TCBRQENA EQU   TCBFLGS4                                                 02604000
TCBSER   EQU   TCBFLGS4                                                 02605000
TCBNDUMP EQU   TCBFLGS4                                                 02606000
TCBDWSTA EQU   TCBFLGS3                                                 02607000
TCBRSV08 EQU   TCBFLGS3                                                 02608000
TCBRSV07 EQU   TCBFLGS3                                                 02609000
TCBRSV06 EQU   TCBFLGS3                                                 02610000
TCBABGM  EQU   TCBFLGS3                                                 02611000
TCBABTRM EQU   TCBFLGS3                                                 02612000
TCBADINP EQU   TCBFLGS3                                                 02613000
TCBFSM   EQU   TCBFLGS3                                                 02614000
TCBFTS   EQU   TCBFLGS2                                                 02615000
TCBFETXR EQU   TCBFLGS2                                                 02616000
TCBFDSOP EQU   TCBFLGS2                                                 02617000
TCBFJMC  EQU   TCBFLGS2                                                 02618000
TCBFSMC  EQU   TCBFLGS2                                                 02619000
TCBFABOP EQU   TCBFLGS2                                                 02620000
TCBFSTI  EQU   TCBFLGS2                                                 02621000
TCBFOINP EQU   TCBFLGS2                                                 02622000
TCBFX    EQU   TCBFLGS1                                                 02623000
TCBFS    EQU   TCBFLGS1                                                 02624000
TCBFT    EQU   TCBFLGS1                                                 02625000
TCBPDUMP EQU   TCBFLGS1                                                 02626000
TCBNONPR EQU   TCBFLGS1                                                 02627000
TCBFERA  EQU   TCBFLGS1                                                 02628000
TCBFE    EQU   TCBFLGS1                                                 02629000
TCBFA    EQU   TCBFLGS1                                                 02630000
TCBZERO  EQU   TCBPKF                                                   02631000
TCBFLAG  EQU   TCBPKF                                                   02632000
TCBMSSB  EQU   TCBMSS+1                                                 02633000
TCBRSV03 EQU   TCBMSS                                                   02634000
TCBTRNB  EQU   TCBTRN+1                                                 02635000
TCBRSV02 EQU   TCBABF                                                   02636000
TCBOLTEP EQU   TCBABF                                                   02637000
TCBTCP   EQU   TCBABF                                                   02638000
TCBTCPP  EQU   TCBABF                                                   02639000
TCBRSV01 EQU   TCBABF                                                   02640000
TCBGRPH  EQU   TCBABF                                                   02641000
TCBNOCHK EQU   TCBABF                                                   02642000
TCBMOD91 EQU   TCBABF                                                   02643000
TCBCMPC  EQU   TCBCMP+1                                                 02644000
TCBRV318 EQU   TCBCMSG                                                  02645000
TCBRV317 EQU   TCBCIND                                                  02646000
TCBRV316 EQU   TCBCWTO                                                  02647000
TCBCASID EQU   TCBCDBL                                                  02648000
TCBNOCC  EQU   TCBSTCC                                                  02649000
TCBDMPO  EQU   TCBCPP                                                   02650000
TCBCSTEP EQU   TCBCMPF                                                  02651000
TCBCREQ  EQU   TCBCMPF                                                  02652000
TCBTIO   EQU   TCB+12                                                   02653000
TCBDEB   EQU   TCB+8                                                    02654000
TCBPIEA  EQU   TCBPIE+1                                                 02655000
TCBPM    EQU   TCBPMASK                                                 02656000
@NM00076 EQU   TCBPMASK                                                 02657000
TCBRBP   EQU   TCB                                                      02658000
TCBFRS6  EQU   TCBFRS+24                                                02659000
TCBFRS4  EQU   TCBFRS+16                                                02660000
TCBFRS2  EQU   TCBFRS+8                                                 02661000
TCBFRS0  EQU   TCBFRS                                                   02662000
SPPXLT4B EQU   SPPXLT4A+1                                               02663000
@NM00075 EQU   SPPXLT4A                                                 02664000
SPPXLT3B EQU   SPPXLT3A+1                                               02665000
@NM00074 EQU   SPPXLT3A                                                 02666000
SPPXLT2B EQU   SPPXLT2A+1                                               02667000
@NM00073 EQU   SPPXLT2A                                                 02668000
SPPXLT1B EQU   SPPXLT1A+1                                               02669000
@NM00072 EQU   SPPXLT1A                                                 02670000
SPPMDPTB EQU   SPPMDPTA+1                                               02671000
@NM00071 EQU   SPPMDPTA                                                 02672000
@NM00070 EQU   SPPARM+20                                                02673000
@NM00069 EQU   SPPFLAG2                                                 02674000
SPPADFCB EQU   SPPFLAG2                                                 02675000
SPPXLT40 EQU   SPPFLAG2                                                 02676000
SPPXLT30 EQU   SPPFLAG2                                                 02677000
SPPXLT20 EQU   SPPFLAG2                                                 02678000
SPPXLT10 EQU   SPPFLAG2                                                 02679000
SPPMODI  EQU   SPPFLAG2                                                 02680000
@NM00068 EQU   SPPFLAG1                                                 02681000
SPPBTREQ EQU   SPPFLAG1                                                 02682000
SPPBFREQ EQU   SPPFLAG1                                                 02683000
@NM00067 EQU   SPPFLAG1                                                 02684000
SPPREX   EQU   SPPFLAG1                                                 02685000
SPPFCBB  EQU   SPPFCB+1                                                 02686000
@NM00066 EQU   SPPFCB                                                   02687000
@NM00065 EQU   SPPFDUNF                                                 02688000
SPPFOLD  EQU   SPPFDUNF                                                 02689000
SPPUNFLD EQU   SPPFDUNF                                                 02690000
@NM00064 EQU   SPPFDUNF                                                 02691000
SPPFUBLK EQU   SPPFDUNF                                                 02692000
SPPVERFY EQU   SPPARM+9                                                 02693000
SPPLDMOD EQU   SPPARM+8                                                 02694000
SPPUCS   EQU   SPPARM+4                                                 02695000
SPPDCBB  EQU   SPPDCBA+1                                                02696000
@NM00063 EQU   SPPDCBA                                                  02697000
DXATEXB2 EQU   DXATEXC2                                                 02698000
DXEXHASP EQU   DXATEXB1                                                 02699000
DXATCOM4 EQU   FORCORE+600                                              02700000
DXATCOM3 EQU   FORCORE+596                                              02701000
@NM00062 EQU   DXATCOM2+3                                               02702000
@NM00061 EQU   DXATALL                                                  02703000
DXATSWAP EQU   DXATALL                                                  02704000
DXATFC   EQU   DXATALL                                                  02705000
@NM00060 EQU   DXATOPEN                                                 02706000
DXATDFIN EQU   DXATOPEN                                                 02707000
DXATDSIN EQU   DXATOPEN                                                 02708000
DXATMODM EQU   DXATOPEN                                                 02709000
DXATMODE EQU   DXATOPEN                                                 02710000
DXATMODS EQU   DXATOPEN                                                 02711000
DXATIGN  EQU   DXATOPEN                                                 02712000
DXATVCAT EQU   DXATEOV                                                  02713000
DXATDADM EQU   DXATEOV                                                  02714000
DXATREMT EQU   DXATEOV                                                  02715000
DXATDNEW EQU   DXATEOV                                                  02716000
DXATDFRE EQU   DXATEOV                                                  02717000
DXATDCHN EQU   DXATEOV                                                  02718000
DXATNVOL EQU   DXATEOV                                                  02719000
DXATCCAT EQU   DXATEOV                                                  02720000
DXATRDDB EQU   DXATDACC                                                 02721000
DXATEOF  EQU   DXATDACC                                                 02722000
@NM00059 EQU   DXATDACC                                                 02723000
DXATSMF  EQU   DXATDACC                                                 02724000
DXATUPDB EQU   DXATDACC                                                 02725000
DXATDRCT EQU   DXATDACC                                                 02726000
DXATTRAK EQU   DXATDACC                                                 02727000
DXATF1CE EQU   DXATDACC                                                 02728000
DXATNSL  EQU   DXATOUTA                                                 02729000
DXATTTM2 EQU   DXATOUTA                                                 02730000
DXATTTM1 EQU   DXATOUTA                                                 02731000
DXATTRL2 EQU   DXATOUTA                                                 02732000
DXATTRL1 EQU   DXATOUTA                                                 02733000
DXATDATM EQU   DXATOUTA                                                 02734000
DXATHDTM EQU   DXATOUTA                                                 02735000
DXATVLHD EQU   DXATOUTA                                                 02736000
DXATCLOS EQU   DXATCOM1+1                                               02737000
DXATSRET EQU   DXATGENS                                                 02738000
DXATVCIG EQU   DXATVGIV                                                 02739000
DXATVTMG EQU   DXATVGIV                                                 02740000
DXATVSMG EQU   DXATVGIV                                                 02741000
DXATJFCB EQU   DXATGENS                                                 02742000
DXATDISP EQU   DXATGENS                                                 02743000
DXATREFR EQU   DXATGENS                                                 02744000
DXATDMCT EQU   DXATGENS                                                 02745000
DXMSGADR EQU   FORCORE+584                                              02746000
DXPRPARC EQU   FORCORE+580                                              02747000
DXUDCBML EQU   FORCORE+578                                              02748000
DXUDCBPL EQU   FORCORE+576                                              02749000
DXPACBAD EQU   DXPDCBAD+1                                               02750000
@NM00058 EQU   DXPDCBAD                                                 02751000
DXUACBAD EQU   DXUDCBAD+1                                               02752000
@NM00057 EQU   DXUDCBAD                                                 02753000
DXUCBSVV EQU   DXUCBSAV+1                                               02754000
@NM00056 EQU   DXUCBSAV                                                 02755000
DXUCBADR EQU   FORCORE+560                                              02756000
DXTIOTAD EQU   FORCORE+556                                              02757000
DXDEBXAD EQU   FORCORE+552                                              02758000
DXDSAB   EQU   FORCORE+548                                              02759000
DXDSABAD EQU   FORCORE+544                                              02760000
DXDSABQD EQU   FORCORE+540                                              02761000
DXJSCBAD EQU   FORCORE+536                                              02762000
DXTCBADR EQU   FORCORE+532                                              02763000
DXASCBAD EQU   FORCORE+528                                              02764000
DXEXTSW  EQU   FORCORE+527                                              02765000
DXUKEY   EQU   FORCORE+526                                              02766000
DXWKEYSV EQU   FORCORE+525                                              02767000
DXUNITOF EQU   FORCORE+522                                              02768000
DXNOUNIT EQU   FORCORE+520                                              02769000
DXVOLSEQ EQU   FORCORE+518                                              02770000
DXVOLMT3 EQU   DXVOLSR3                                                 02771000
DXVOLMT2 EQU   DXVOLSR2                                                 02772000
DXVOLMT1 EQU   DXVOLSR1                                                 02773000
DXWORK4  EQU   FORCORE+496                                              02774000
DXWORK3  EQU   FORCORE+492                                              02775000
DXWORK2  EQU   FORCORE+488                                              02776000
DXWORK1  EQU   FORCORE+484                                              02777000
DXWORK   EQU   FORCORE+480                                              02778000
@NM00055 EQU   FORCORE+464                                              02779000
DXCCW11  EQU   DXCCW+80                                                 02780000
DXCCW10  EQU   DXCCW+72                                                 02781000
DXCCW9   EQU   DXCCW+64                                                 02782000
DXCCW7   EQU   DXCCW+48                                                 02783000
DXCCW6   EQU   DXCCW+40                                                 02784000
DXCCW4   EQU   DXCCW+24                                                 02785000
DXCCW2   EQU   DXCCW+8                                                  02786000
DXCCW1   EQU   DXCCW                                                    02787000
DXDCBDEB EQU   DXDCB+44                                                 02788000
@NM00054 EQU   DXDCB+24                                                 02789000
DXDEBDCB EQU   DXDCB+20                                                 02790000
@NM00053 EQU   DXDCB                                                    02791000
DXDEB    EQU   DXDAADDR+4                                               02792000
@NM00052 EQU   DXDAADDR                                                 02793000
DXIOB    EQU   FORCORE+280                                              02794000
DXECB    EQU   FORCORE+276                                              02795000
DSCCORE  EQU   FORCORE+96                                               02796000
DXLBL    EQU   DXDSCB                                                   02797000
MSGTXTF  EQU   MSGTXTFD+1                                               02798000
MSGLNGF  EQU   MSGTXTFD                                                 02799000
MSGOFF7  EQU   MSGENTRY+8                                               02800000
MSGOFF6  EQU   MSGENTRY+7                                               02801000
MSGOFF5  EQU   MSGENTRY+6                                               02802000
MSGOFF4  EQU   MSGENTRY+5                                               02803000
MSGINDLN EQU   MSGINDEX                                                 02804000
JFCBE010 EQU   JFCBE+44                                                 02805000
JFCGRP8  EQU   JFCGROUP+7                                               02806000
JFCGRP7  EQU   JFCGROUP+6                                               02807000
JFCGRP6  EQU   JFCGROUP+5                                               02808000
JFCGRP5  EQU   JFCGROUP+4                                               02809000
JFCGRP4  EQU   JFCGROUP+3                                               02810000
JFCGRP3  EQU   JFCGROUP+2                                               02811000
JFCGRP2  EQU   JFCGROUP+1                                               02812000
JFCBE009 EQU   JFCBE+16                                                 02813000
JFCBE008 EQU   JFCBE+6                                                  02814000
JFCBE007 EQU   JFCBFLAG                                                 02815000
JFCBCFS  EQU   JFCBFLAG                                                 02816000
JFCBE006 EQU   JFCBFLAG                                                 02817000
JFCBE005 EQU   JFCBFLAG                                                 02818000
JFCBE004 EQU   JFCBFLAG                                                 02819000
JFCBE003 EQU   JFCBFLAG                                                 02820000
JFCBEOPN EQU   JFCBFLAG                                                 02821000
JFCBE001 EQU   JFCBE+3                                                  02822000
JFCBEXTR EQU   JFCBE                                                    02823000
JFCRSV05 EQU   JFCEROPT                                                 02824000
JFCRSV04 EQU   JFCEROPT                                                 02825000
JFCRSV03 EQU   JFCEROPT                                                 02826000
JFCRSV02 EQU   JFCEROPT                                                 02827000
JFCTOPT  EQU   JFCEROPT                                                 02828000
JFCABN   EQU   JFCEROPT                                                 02829000
JFCSKP   EQU   JFCEROPT                                                 02830000
JFCACC   EQU   JFCEROPT                                                 02831000
JFCBUFL  EQU   JFCAMPTR+2                                               02832000
JFCFWORD EQU   JFCBFTEK                                                 02833000
JFCDWORD EQU   JFCBFTEK                                                 02834000
JFCHIER1 EQU   JFCBFTEK                                                 02835000
JFCDYN   EQU   JFCBFTEK                                                 02836000
JFCEXC   EQU   JFCBFTEK                                                 02837000
JFCBBFTR EQU   JFCBBFTA                                                 02838000
JFCSIM   EQU   JFCBBFTA                                                 02839000
JFCHIER  EQU   JFCBFTEK                                                 02840000
JFCBFOUT EQU   JFCBUFNO                                                 02841000
JFCBUFIN EQU   JFCBUFNO                                                 02842000
JFCTEMP  EQU   JFCBIND2                                                 02843000
JFCREQ   EQU   JFCBIND2                                                 02844000
JFCENT   EQU   JFCBIND2                                                 02845000
JFCSHARE EQU   JFCBIND2                                                 02846000
JFCSECUR EQU   JFCBIND2                                                 02847000
JFCDISP  EQU   JFCBIND2                                                 02848000
JFCPDS   EQU   JFCBIND1                                                 02849000
JFCGDG   EQU   JFCBIND1                                                 02850000
JFCADDED EQU   JFCBIND1                                                 02851000
JFCLOC   EQU   JFCBIND1                                                 02852000
JFCRLSE  EQU   JFCBIND1                                                 02853000
JFCBXPDT EQU   INFMJFCB+83                                              02854000
JFCBCRDT EQU   INFMJFCB+80                                              02855000
JFCBOPS2 EQU   JFCBMASK+7                                               02856000
JFCRCTLG EQU   JFCBFLG2                                                 02857000
JFCBBUFF EQU   JFCBFLG2                                                 02858000
JFCTRACE EQU   JFCBFLG2                                                 02859000
JFCSDRPS EQU   JFCBFLG2                                                 02860000
JFCMODNW EQU   JFCBFLG2                                                 02861000
JFCNRPS  EQU   JFCDEFER                                                 02862000
JFCOUTOP EQU   JFCBFLG2                                                 02863000
JFCINOP  EQU   JFCBFLG2                                                 02864000
JFCBPWBP EQU   JFCOPEN                                                  02865000
@NM00048 EQU   JFCOPEN                                                  02866000
JFCDUAL  EQU   JFCBFLG1                                                 02867000
JFCSLDES EQU   JFCBFLG1                                                 02868000
JFCSLCRE EQU   JFCBFLG1                                                 02869000
JFCSTAND EQU   JFCBFLG1                                                 02870000
JFCBOPS1 EQU   JFCBMASK                                                 02871000
JFCBVLSQ EQU   INFMJFCB+70                                              02872000
JFCRSV31 EQU   JFCFUNC                                                  02873000
JFCFNCBT EQU   JFCFUNC                                                  02874000
JFCFNCBX EQU   JFCFUNC                                                  02875000
JFCFNCBD EQU   JFCFUNC                                                  02876000
JFCFNCBW EQU   JFCFUNC                                                  02877000
JFCFNCBP EQU   JFCFUNC                                                  02878000
JFCFNCBR EQU   JFCFUNC                                                  02879000
JFCFNCBI EQU   JFCFUNC                                                  02880000
JFCBFOFL EQU   JFCBUFOF                                                 02881000
JFCNL    EQU   JFCBLTYP                                                 02882000
JFCSL    EQU   JFCBLTYP                                                 02883000
JFCNSL   EQU   JFCBLTYP                                                 02884000
JFCSUL   EQU   JFCBLTYP                                                 02885000
JFCBLP   EQU   JFCBLTYP                                                 02886000
JFCBLTM  EQU   JFCBLTYP                                                 02887000
JFCBAL   EQU   JFCBLTYP                                                 02888000
JFCRSV38 EQU   JFCBLTYP                                                 02889000
JFCVINDX EQU   INFMJFCB+64                                              02890000
JFCNLREC EQU   INFMJFCB+62                                              02891000
JFCBADBF EQU   INFMJFCB+60                                              02892000
JFCAMSTR EQU   JFCBFRID+2                                               02893000
JFCAMCRO EQU   JFCBFRID                                                 02894000
JFCBDSCB EQU   INFMJFCB+53                                              02895000
JFCPAT   EQU   JFCBTSDM                                                 02896000
JFCNDCB  EQU   JFCBTSDM                                                 02897000
JFCNDSCB EQU   JFCBTSDM                                                 02898000
JFCNWRIT EQU   JFCBTSDM                                                 02899000
JFCTTR   EQU   JFCBTSDM                                                 02900000
JFCSDS   EQU   JFCBTSDM                                                 02901000
JFCVSL   EQU   JFCBTSDM                                                 02902000
JFCCAT   EQU   JFCBTSDM                                                 02903000
JFCIPLTX EQU   JFCBELNM                                                 02904000
JFCBQNAM EQU   JFCBDSNM                                                 02905000
DEBXSAMB EQU   DEBXTN+28                                                02906000
DEBXOPNJ EQU   DEBXTN+24                                                02907000
DEBXXARG EQU   DEBXTN+20                                                02908000
DEBXMCF2 EQU   DEBXTN+19                                                02909000
DEBXMCF1 EQU   DEBXTN+18                                                02910000
DEBXDSO2 EQU   DEBXTN+17                                                02911000
DEBXDSO1 EQU   DEBXTN+16                                                02912000
DEBXDBPR EQU   DEBXTN+12                                                02913000
DEBXDCBM EQU   DEBXTN+8                                                 02914000
DEBXDSAB EQU   DEBXTN+4                                                 02915000
DEBXRV48 EQU   DEBXTN+3                                                 02916000
DEBXRV47 EQU   DEBXFLG1                                                 02917000
DEBXRV46 EQU   DEBXFLG1                                                 02918000
DEBXRV45 EQU   DEBXFLG1                                                 02919000
DEBXRV44 EQU   DEBXFLG1                                                 02920000
DEBXRV43 EQU   DEBXFLG1                                                 02921000
DEBXDSSI EQU   DEBXFLG1                                                 02922000
DEBXTSKC EQU   DEBXFLG1                                                 02923000
DEBXCDCB EQU   DEBXFLG1                                                 02924000
DEBXLNGH EQU   DEBXTN                                                   02925000
DEBTBLOF EQU   DEBPREFX+14                                              02926000
DEBAMTYP EQU   DEBPREFX+13                                              02927000
DEBLNGTH EQU   DEBPREFX+12                                              02928000
DEBDCBMK EQU   DEBXTNP                                                  02929000
DEBDSCBA EQU   DEBPREFX+1                                               02930000
DEBWKARA EQU   DEBPREFX                                                 02931000
DEBXCEAD EQU   DEBXCEA+1                                                02932000
DEBXCENP EQU   DEBXCEAB                                                 02933000
DEBRSV35 EQU   DEBXCEAB                                                 02934000
DEBRSV34 EQU   DEBXCEAB                                                 02935000
DEBRSV33 EQU   DEBXCEAB                                                 02936000
DEBRSV32 EQU   DEBXCEAB                                                 02937000
DEBCEAD  EQU   DEBCEA+1                                                 02938000
DEBCENP  EQU   DEBCEAB                                                  02939000
DEBRSV31 EQU   DEBCEAB                                                  02940000
DEBRSV30 EQU   DEBCEAB                                                  02941000
DEBRSV29 EQU   DEBCEAB                                                  02942000
DEBRSV28 EQU   DEBCEAB                                                  02943000
DEBPCIAD EQU   DEBPCIA+1                                                02944000
DEBPCINP EQU   DEBPCIAB                                                 02945000
DEBRSV27 EQU   DEBPCIAB                                                 02946000
DEBRSV26 EQU   DEBPCIAB                                                 02947000
DEBRSV25 EQU   DEBPCIAB                                                 02948000
DEBRSV24 EQU   DEBPCIAB                                                 02949000
DEBSIOAD EQU   DEBSIOA+1                                                02950000
DEBSIONP EQU   DEBSIOAB                                                 02951000
DEBFIX   EQU   DEBSIOAB                                                 02952000
DEBIOVR  EQU   DEBSIOAB                                                 02953000
DEBSIOX  EQU   DEBSIOAB                                                 02954000
DEBPGFX  EQU   DEBSIOAB                                                 02955000
DEBEOEAD EQU   DEBEOEA+1                                                02956000
DEBEOENP EQU   DEBEOEAB                                                 02957000
DEBRSV22 EQU   DEBEOEAB                                                 02958000
DEBRSV21 EQU   DEBEOEAB                                                 02959000
DEBRSV20 EQU   DEBEOEAB                                                 02960000
DEBESMVR EQU   DEBEOEAB                                                 02961000
DEBSUBID EQU   DEBSUBNM                                                 02962000
DEBSIOA2 EQU   DEBACS08+24                                              02963000
DEBRPSIO EQU   DEBACS08+20                                              02964000
DEBFREED EQU   DEBACS08+16                                              02965000
@NM00047 EQU   DEBACS08+12                                              02966000
@NM00046 EQU   DEBACS08+8                                               02967000
DEBDISAD EQU   DEBACS08+4                                               02968000
@NM00045 EQU   DEBACS08                                                 02969000
DEBRPSST EQU   DEBACS07+64                                              02970000
DEBARECK EQU   DEBACS07+60                                              02971000
DEBAREWT EQU   DEBACS07+56                                              02972000
DEBACHK  EQU   DEBACS07+52                                              02973000
DEBAWRIT EQU   DEBACS07+48                                              02974000
DEBASETL EQU   DEBACS07+44                                              02975000
DEBAREAD EQU   DEBACS07+40                                              02976000
DEBCRECK EQU   DEBACS07+36                                              02977000
DEBCREWT EQU   DEBACS07+32                                              02978000
DEBCCHK  EQU   DEBACS07+28                                              02979000
DEBCWRIT EQU   DEBACS07+24                                              02980000
DEBCSETL EQU   DEBACS07+20                                              02981000
DEBCREAD EQU   DEBACS07+16                                              02982000
DEBWKPT5 EQU   DEBACS07+12                                              02983000
DEBWKPT4 EQU   DEBACS07+8                                               02984000
DEBGET   EQU   DEBACS07+4                                               02985000
@NM00044 EQU   DEBACS07                                                 02986000
DEBPUT   EQU   DEBACS06+4                                               02987000
DEBDCBFA EQU   DEBACS06                                                 02988000
DEBLUCBB EQU   DEBLUCBA+1                                               02989000
DEBRSV18 EQU   DEBLUCBA                                                 02990000
DEBFUCBB EQU   DEBFUCBA+1                                               02991000
DEBRSV17 EQU   DEBFUCBA                                                 02992000
DEBTCCWB EQU   DEBTCCWA+1                                               02993000
DEBRSV16 EQU   DEBTCCWA                                                 02994000
DEBTBFRB EQU   DEBTBFRA+1                                               02995000
DEBRSV15 EQU   DEBTBFRA                                                 02996000
DEBDBPEF EQU   DEBACS03+8                                               02997000
DEBDBPP  EQU   DEBACS03+4                                               02998000
DEBDTPP  EQU   DEBACS03                                                 02999000
DEBDBPE  EQU   DEBDBLK+1                                                03000000
DEBDBPT  EQU   DEBDBLK                                                  03001000
DEBEXTNM EQU   DEBDSNAM                                                 03002000
DEBLRECL EQU   DEBACSMD+14                                              03003000
DEBBLKSI EQU   DEBACSMD+12                                              03004000
DEBRSV14 EQU   DEBDSNM+4                                                03005000
DEBUTSAB EQU   DEBUTSAA+1                                               03006000
DEBRSV13 EQU   DEBUTSAA                                                 03007000
DEBVOLNM EQU   DEBACSMD+2                                               03008000
DEBVLSEQ EQU   DEBVOLSQ+1                                               03009000
DEBRSV42 EQU   DEBVOLBT                                                 03010000
DEBRSV41 EQU   DEBVOLBT                                                 03011000
DEBRSV40 EQU   DEBVOLBT                                                 03012000
DEBRSV39 EQU   DEBVOLBT                                                 03013000
DEBRSV38 EQU   DEBVOLBT                                                 03014000
DEBRSV37 EQU   DEBVOLBT                                                 03015000
DEBRSV36 EQU   DEBVOLBT                                                 03016000
DEBEXFUL EQU   DEBVOLBT                                                 03017000
DEBNMTRK EQU   DEBDASD+14                                               03018000
DEBENDHH EQU   DEBDASD+12                                               03019000
DEBENDCC EQU   DEBDASD+10                                               03020000
DEBSTRHH EQU   DEBDASD+8                                                03021000
DEBSTRCC EQU   DEBDASD+6                                                03022000
DEBBINUM EQU   DEBDASD+4                                                03023000
DEBUCBA  EQU   DEBUCBAD+1                                               03024000
DEBDVMOD EQU   DEBUCBAD                                                 03025000
DEBAPPB  EQU   DEBAPPAD+1                                               03026000
DEBEXSCL EQU   DEBAPPAD                                                 03027000
DEBDCBB  EQU   DEBDCBAD+1                                               03028000
DEBDEBID EQU   DEBPROTG                                                 03029000
DEBECBB  EQU   DEBECBAD+1                                               03030000
DEBPRIOR EQU   DEBECBAD                                                 03031000
DEBUSRPB EQU   DEBUSRPG+1                                               03032000
DEBNMEXT EQU   DEBUSRPG                                                 03033000
DEBRSV05 EQU   DEBBASIC+15                                              03034000
DEBXTNIN EQU   DEBFLGS1                                                 03035000
DEBAPFIN EQU   DEBFLGS1                                                 03036000
DEBF1CEV EQU   DEBFLGS1                                                 03037000
DEBCINDI EQU   DEBFLGS1                                                 03038000
DEBRSV02 EQU   DEBFLGS1                                                 03039000
DEBRSIOA EQU   DEBFLGS1                                                 03040000
DEBEOFDF EQU   DEBFLGS1                                                 03041000
DEBPWCKD EQU   DEBFLGS1                                                 03042000
DEBQSCNT EQU   DEBBASIC+13                                              03043000
DEBACCS  EQU   DEBOPATB                                                 03044000
DEBPOSIT EQU   DEBOPATB                                                 03045000
DEBZERO  EQU   DEBOPATB                                                 03046000
DEBABEND EQU   DEBOPATB                                                 03047000
DEBIRBB  EQU   DEBIRBAD+1                                               03048000
DEBRERR  EQU   DEBOFLGS                                                 03049000
DEBLABEL EQU   DEBOFLGS                                                 03050000
DEBSPLIT EQU   DEBOFLGS                                                 03051000
DEBDCB   EQU   DEBOFLGS                                                 03052000
DEBRLSE  EQU   DEBOFLGS                                                 03053000
DEBEOF   EQU   DEBOFLGS                                                 03054000
DEBDISP  EQU   DEBOFLGS                                                 03055000
DEBDEBB  EQU   DEBDEBAD+1                                               03056000
DEBAMLNG EQU   DEBDEBAD                                                 03057000
DEBNMSUB EQU   DEBTCBAD                                                 03058000
DCBEOB   EQU   IHADCS40+20                                              03059000
DCBPRECL EQU   IHADCS40+18                                              03060000
@NM00043 EQU   IHADCS40+16                                              03061000
@NM00042 EQU   @NM00040+1                                               03062000
@NM00041 EQU   DCBEROPT                                                 03063000
DCBERABE EQU   DCBEROPT                                                 03064000
DCBERSKP EQU   DCBEROPT                                                 03065000
DCBERACC EQU   DCBEROPT                                                 03066000
@NM00039 EQU   IHADCS40+10                                              03067000
@NM00038 EQU   IHADCS40+9                                               03068000
@NM00037 EQU   IHADCS40+8                                               03069000
DCBRECA  EQU   DCBRECAD+1                                               03070000
@NM00036 EQU   DCBRECBT                                                 03071000
DCBRCFGT EQU   DCBRCREL                                                 03072000
DCBRCTRU EQU   DCBRCREL                                                 03073000
DCBLCCW  EQU   DCBEOBAD                                                 03074000
DCBNOTE  EQU   DCBCNTRL                                                 03075000
DCBLRECL EQU   IHADCS38+10                                              03076000
@NM00035 EQU   IHADCS38+8                                               03077000
DCBEOBW  EQU   IHADCS38+4                                               03078000
DCBEOBRA EQU   DCBEOBR+1                                                03079000
DCBNCP   EQU   DCBEOBR                                                  03080000
@NM00034 EQU   DCBFLAG1                                                 03081000
DCBSTFLS EQU   DCBFLAG1                                                 03082000
DCBSTQCK EQU   DCBFLAG1                                                 03083000
DCBDIRCQ EQU   DCBBUFOF                                                 03084000
DCBQSTRU EQU   DCBUSASI                                                 03085000
@NM00033 EQU   DCBUSASI                                                 03086000
DCBQADF3 EQU   DCBQADFS                                                 03087000
DCBQADF2 EQU   DCBQADFS                                                 03088000
DCBQADF1 EQU   DCBQADFS                                                 03089000
DCBBLBP  EQU   DCBUSASI                                                 03090000
@NM00032 EQU   DCBUSASI                                                 03091000
DCBCICBA EQU   DCBCICB+1                                                03092000
@NM00031 EQU   DCBCICB                                                  03093000
DCBOFFSW EQU   IHADCS36+15                                              03094000
DCBOFFSR EQU   IHADCS36+14                                              03095000
DCBWCPL  EQU   IHADCS36+13                                              03096000
DCBWCPO  EQU   IHADCS36+12                                              03097000
DCBBLKSI EQU   IHADCS36+10                                              03098000
DCBCNFEO EQU   DCBCIND2                                                 03099000
DCBCNCHS EQU   DCBCIND2                                                 03100000
DCBCNBFP EQU   DCBCIND2                                                 03101000
DCBCNIOE EQU   DCBCIND2                                                 03102000
DCBCNCLO EQU   DCBCIND2                                                 03103000
DCBCNWRO EQU   DCBCIND2                                                 03104000
DCBCNSTO EQU   DCBCIND2                                                 03105000
DCBCNEXB EQU   DCBCIND1                                                 03106000
@NM00030 EQU   DCBCIND1                                                 03107000
DCBCNBRM EQU   DCBCIND1                                                 03108000
@NM00029 EQU   DCBCIND1                                                 03109000
DCBCNEVA EQU   DCBCIND1                                                 03110000
DCBCNEVB EQU   DCBCIND1                                                 03111000
DCBCNSRD EQU   DCBCIND1                                                 03112000
DCBCNTOV EQU   DCBCIND1                                                 03113000
DCBSYNA  EQU   DCBSYNAD+1                                               03114000
DCBIOBL  EQU   DCBSYNAD                                                 03115000
DCBCHCKA EQU   DCBPERRA                                                 03116000
DCBOPTJ  EQU   DCBOPTCD                                                 03117000
DCBOPTT  EQU   DCBOPTCD                                                 03118000
DCBSRCHD EQU   DCBOPTZ                                                  03119000
DCBOPTQ  EQU   DCBOPTCD                                                 03120000
DCBBCKPT EQU   DCBOPTO                                                  03121000
DCBOPTU  EQU   DCBOPTCD                                                 03122000
DCBOPTW  EQU   DCBOPTCD                                                 03123000
DCBPUTA  EQU   DCBGETA                                                  03124000
@NM00028 EQU   DCBPUT                                                   03125000
DCBREADA EQU   DCBWRITA                                                 03126000
@NM00027 EQU   DCBREAD                                                  03127000
@NM00026 EQU   DCBIFLGS                                                 03128000
DCBIFIOE EQU   DCBIFLGS                                                 03129000
DCBCH12  EQU   DCBIFPCT                                                 03130000
DCBCH9   EQU   DCBIFPCT                                                 03131000
DCBIFEC  EQU   DCBIFLGS                                                 03132000
DCBMFSTI EQU   DCBMFDMD                                                 03133000
DCBMFAWR EQU   DCBMFSTK                                                 03134000
DCBMFUIP EQU   DCBMFTMD                                                 03135000
DCBMFIDW EQU   DCBMFLCP                                                 03136000
DCBMFWRK EQU   DCBMFMVP                                                 03137000
DCBMFRDQ EQU   DCBMFWRT                                                 03138000
DCBMFGTQ EQU   DCBMFPUT                                                 03139000
DCBMFSTL EQU   DCBMACF2                                                 03140000
DCBMFCK  EQU   DCBMFDMG                                                 03141000
DCBMFRDX EQU   DCBMFCHK                                                 03142000
DCBMFDBF EQU   DCBMFSBG                                                 03143000
DCBMFRDI EQU   DCBMFLCG                                                 03144000
DCBMFRDK EQU   DCBMFMVG                                                 03145000
DCBMFWRQ EQU   DCBMFRD                                                  03146000
DCBMFPTQ EQU   DCBMFGET                                                 03147000
DCBTIOT  EQU   IHADCS25                                                 03148000
DCBMRSTI EQU   DCBMRDMD                                                 03149000
DCBMRAWR EQU   DCBMRSTK                                                 03150000
DCBMRUIP EQU   DCBMRTMD                                                 03151000
DCBMRIDW EQU   DCBMRLCP                                                 03152000
DCBMRWRK EQU   DCBMRMVP                                                 03153000
DCBMRRDQ EQU   DCBMRWRT                                                 03154000
DCBMRGTQ EQU   DCBMRPUT                                                 03155000
DCBMRSTL EQU   DCBMACR2                                                 03156000
DCBMRCK  EQU   DCBMRDMG                                                 03157000
DCBPGFXA EQU   DCBMRRDX                                                 03158000
DCBMRDBF EQU   DCBMRSBG                                                 03159000
DCBMRRDI EQU   DCBMRLCG                                                 03160000
DCBMRRDK EQU   DCBMRMVG                                                 03161000
DCBMRWRQ EQU   DCBMRRD                                                  03162000
DCBMRPTQ EQU   DCBMRGET                                                 03163000
DCBMRECP EQU   DCBMACR1                                                 03164000
@NM00025 EQU   DCBIFLG                                                  03165000
DCBIBIOE EQU   DCBIFLG                                                  03166000
DCBICH12 EQU   DCBIBPCT                                                 03167000
DCBICH9  EQU   DCBIBPCT                                                 03168000
DCBIBEC  EQU   DCBIFLG                                                  03169000
DCBOFIOF EQU   DCBOFLGS                                                 03170000
DCBOFUEX EQU   DCBOFLGS                                                 03171000
DCBOFTM  EQU   DCBOFLGS                                                 03172000
DCBOFPPC EQU   DCBOFLGS                                                 03173000
DCBOFOPN EQU   DCBOFLGS                                                 03174000
DCBOFEOV EQU   DCBOFLGS                                                 03175000
DCBOFLRB EQU   DCBOFLGS                                                 03176000
DCBOFIOD EQU   DCBOFLWR                                                 03177000
DCBDDNAM EQU   IHADCS24                                                 03178000
DCBEXLSA EQU   DCBEXLST+1                                               03179000
DCBRECKL EQU   DCBRECFM                                                 03180000
DCBRECCC EQU   DCBRECFM                                                 03181000
DCBRECSB EQU   DCBRECFM                                                 03182000
DCBRECBR EQU   DCBRECFM                                                 03183000
DCBRECTO EQU   DCBRECLA                                                 03184000
DCBRECL  EQU   DCBRECLA                                                 03185000
DCBEODA  EQU   DCBEODAD+1                                               03186000
DCBBFA   EQU   DCBBFTEK                                                 03187000
DCBH0    EQU   DCBBFTEK                                                 03188000
DCBBFTKD EQU   DCBBFTEK                                                 03189000
DCBBFTE  EQU   DCBBFT                                                   03190000
DCBBFTKR EQU   DCBBFT                                                   03191000
DCBBFTS  EQU   DCBBFT                                                   03192000
DCBH1    EQU   DCBBFTEK                                                 03193000
DCBSVCXA EQU   DCBSVCXL+1                                               03194000
@NM00024 EQU   DCBSVCXL                                                 03195000
DCBODEBA EQU   DCBIOBAA                                                 03196000
@NM00023 EQU   DCBQSLM                                                  03197000
DCBUPDBT EQU   DCBQSLM                                                  03198000
DCBUPDCM EQU   DCBQSLM                                                  03199000
DCB1DVDS EQU   DCBQSLM                                                  03200000
@NM00022 EQU   DCBDSRG2                                                 03201000
DCBDSGTR EQU   DCBDSRG2                                                 03202000
DCBACBM  EQU   DCBDSRG2                                                 03203000
@NM00021 EQU   DCBDSRG2                                                 03204000
DCBDSGTQ EQU   DCBDSRG2                                                 03205000
DCBDSGTX EQU   DCBDSRG2                                                 03206000
DCBDSGGS EQU   DCBDSRG2                                                 03207000
DCBDSGU  EQU   DCBDSRG1                                                 03208000
DCBDSGPO EQU   DCBDSRG1                                                 03209000
@NM00020 EQU   DCBDSRG1                                                 03210000
@NM00019 EQU   DCBDSRG1                                                 03211000
DCBDSGCX EQU   DCBDSRG1                                                 03212000
DCBDSGDA EQU   DCBDSRG1                                                 03213000
DCBDSGPS EQU   DCBDSRG1                                                 03214000
DCBDSGIS EQU   DCBDSRG1                                                 03215000
DCBBUFL  EQU   IHADCS11+8                                               03216000
DCBDEVT  EQU   DCBREL                                                   03217000
DCBKEYLE EQU   DCBRELB                                                  03218000
DCBTRCID EQU   DCBPRBYT                                                 03219000
@NM00018 EQU   DCBPRBYT                                                 03220000
DCBPRTOV EQU   IHADCS04+2                                               03221000
@NM00017 EQU   IHADCS04+1                                               03222000
DCBPRTSP EQU   IHADCS04                                                 03223000
@NM00016 EQU   IHADCB                                                   03224000
CVTLEVL  EQU   CVTRELNO+2                                               03225000
CVTNUMB  EQU   CVTRELNO                                                 03226000
CVTMDL   EQU   CVTFIX+250                                               03227000
@NM00015 EQU   CVTFIX+248                                               03228000
@NM00014 EQU   CVTFIX                                                   03229000
CVTRV482 EQU   CVTXTNT2+128                                             03230000
CVTRV481 EQU   CVTXTNT2+124                                             03231000
CVTRV480 EQU   CVTXTNT2+120                                             03232000
CVTRV479 EQU   CVTXTNT2+118                                             03233000
CVTRV478 EQU   CVTXTNT2+117                                             03234000
CVTRV477 EQU   CVTXTNT2+116                                             03235000
CVTRV476 EQU   CVTXTNT2+115                                             03236000
CVTRV475 EQU   CVTXTNT2+114                                             03237000
CVTRV474 EQU   CVTRV466                                                 03238000
CVTRV473 EQU   CVTRV466                                                 03239000
CVTRV472 EQU   CVTRV466                                                 03240000
CVTRV471 EQU   CVTRV466                                                 03241000
CVTRV470 EQU   CVTRV466                                                 03242000
CVTRV469 EQU   CVTRV466                                                 03243000
CVTRV468 EQU   CVTRV466                                                 03244000
CVTRV467 EQU   CVTRV466                                                 03245000
CVTRV465 EQU   CVTRV457                                                 03246000
CVTRV464 EQU   CVTRV457                                                 03247000
CVTRV463 EQU   CVTRV457                                                 03248000
CVTRV462 EQU   CVTRV457                                                 03249000
CVTRV461 EQU   CVTRV457                                                 03250000
CVTRV460 EQU   CVTRV457                                                 03251000
CVTRV459 EQU   CVTRV457                                                 03252000
CVTRV458 EQU   CVTRV457                                                 03253000
CVTRV456 EQU   CVTXTNT2+108                                             03254000
CVTRV455 EQU   CVTXTNT2+104                                             03255000
CVTRV454 EQU   CVTXTNT2+100                                             03256000
CVTRV453 EQU   CVTXTNT2+96                                              03257000
CVTRV452 EQU   CVTXTNT2+94                                              03258000
CVTRV451 EQU   CVTXTNT2+92                                              03259000
CVTRV450 EQU   CVTXTNT2+90                                              03260000
CVTRV449 EQU   CVTXTNT2+88                                              03261000
CVTRV448 EQU   CVTXTNT2+87                                              03262000
CVTRV447 EQU   CVTXTNT2+86                                              03263000
CVTRV446 EQU   CVTRV438                                                 03264000
CVTRV445 EQU   CVTRV438                                                 03265000
CVTRV444 EQU   CVTRV438                                                 03266000
CVTRV443 EQU   CVTRV438                                                 03267000
CVTRV442 EQU   CVTRV438                                                 03268000
CVTRV441 EQU   CVTRV438                                                 03269000
CVTRV440 EQU   CVTRV438                                                 03270000
CVTRV439 EQU   CVTRV438                                                 03271000
CVTRV437 EQU   CVTRV429                                                 03272000
CVTRV436 EQU   CVTRV429                                                 03273000
CVTRV435 EQU   CVTRV429                                                 03274000
CVTRV434 EQU   CVTRV429                                                 03275000
CVTRV433 EQU   CVTRV429                                                 03276000
CVTRV432 EQU   CVTRV429                                                 03277000
CVTRV431 EQU   CVTRV429                                                 03278000
CVTRV430 EQU   CVTRV429                                                 03279000
CVTRV428 EQU   CVTXTNT2+80                                              03280000
CVTRV427 EQU   CVTXTNT2+76                                              03281000
CVTRV426 EQU   CVTXTNT2+72                                              03282000
CVTRV425 EQU   CVTXTNT2+68                                              03283000
CVTATACT EQU   CVTATCVT                                                 03284000
CVTRV423 EQU   CVTXTNT2+62                                              03285000
CVTRV422 EQU   CVTXTNT2+60                                              03286000
CVTRV421 EQU   CVTXTNT2+58                                              03287000
CVTRV420 EQU   CVTXTNT2+56                                              03288000
CVTRV419 EQU   CVTXTNT2+55                                              03289000
CVTRV418 EQU   CVTXTNT2+54                                              03290000
CVTRV417 EQU   CVTRV409                                                 03291000
CVTRV416 EQU   CVTRV409                                                 03292000
CVTRV415 EQU   CVTRV409                                                 03293000
CVTRV414 EQU   CVTRV409                                                 03294000
CVTRV413 EQU   CVTRV409                                                 03295000
CVTRV412 EQU   CVTRV409                                                 03296000
CVTRV411 EQU   CVTRV409                                                 03297000
CVTRV410 EQU   CVTRV409                                                 03298000
CVTRV408 EQU   CVTRV400                                                 03299000
CVTRV407 EQU   CVTRV400                                                 03300000
CVTRV406 EQU   CVTRV400                                                 03301000
CVTRV405 EQU   CVTRV400                                                 03302000
CVTRV404 EQU   CVTRV400                                                 03303000
CVTRV403 EQU   CVTRV400                                                 03304000
CVTRV402 EQU   CVTRV400                                                 03305000
CVTRV401 EQU   CVTRV400                                                 03306000
CVTICB   EQU   CVTXTNT2+48                                              03307000
CVTSKTA  EQU   CVTXTNT2+44                                              03308000
CVTRSV99 EQU   CVTXTNT2+40                                              03309000
CVTRSV98 EQU   CVTXTNT2+36                                              03310000
CVTRSV97 EQU   CVTXTNT2+34                                              03311000
CVTRSV96 EQU   CVTXTNT2+32                                              03312000
CVTOLTEP EQU   CVTXTNT2+28                                              03313000
CVTQIDA  EQU   CVTQID+1                                                 03314000
CVTRSV95 EQU   CVTQID                                                   03315000
CVTRSV94 EQU   CVTXTNT2+20                                              03316000
CVTRSV93 EQU   CVTXTNT2+16                                              03317000
CVTRSV92 EQU   CVTXTNT2+12                                              03318000
CVTDEBVR EQU   CVTXTNT2+8                                               03319000
CVTRSV91 EQU   CVTXTNT2+6                                               03320000
CVTRSV9H EQU   CVTFLGBT                                                 03321000
CVTRSV9G EQU   CVTFLGBT                                                 03322000
CVTRSV9F EQU   CVTFLGBT                                                 03323000
CVTRSV9E EQU   CVTFLGBT                                                 03324000
CVTRSV9D EQU   CVTFLGBT                                                 03325000
CVTRSV9C EQU   CVTFLGBT                                                 03326000
CVTVME   EQU   CVTFLGBT                                                 03327000
CVTNPE   EQU   CVTFLGBT                                                 03328000
CVTNUCLS EQU   CVTXTNT2+4                                               03329000
CVTDSSVA EQU   CVTDSSV+1                                                03330000
CVTRSV89 EQU   CVTDSSV                                                  03331000
CVTRSV88 EQU   CVTXTNT1+8                                               03332000
CVTRSV87 EQU   CVTXTNT1+4                                               03333000
CVTFACHN EQU   CVTXTNT1                                                 03334000
CVTRV488 EQU   CVTMAP+412                                               03335000
CVTRV487 EQU   CVTMAP+408                                               03336000
CVTRV486 EQU   CVTMAP+404                                               03337000
CVTRV485 EQU   CVTMAP+400                                               03338000
CVTACTAP EQU   CVTMAP+396                                               03339000
CVTAUTH  EQU   CVTMAP+392                                               03340000
CVTATMCA EQU   CVTATMCT+1                                               03341000
CVTATMST EQU   CVTATMCT                                                 03342000
CVTRSV61 EQU   CVTMAP+384                                               03343000
CVTVOLT1 EQU   CVTVOLM1+1                                               03344000
CVTVOLI1 EQU   CVTVOLF1                                                 03345000
CVTSTOA  EQU   CVTMAP+376                                               03346000
CVTRSV58 EQU   CVTMAP+374                                               03347000
CVTRSV57 EQU   CVTMAP+372                                               03348000
CVTDDCE  EQU   CVTMAP+368                                               03349000
CVTPNWFR EQU   CVTMAP+364                                               03350000
CVTSMF   EQU   CVTMAP+360                                               03351000
CVTSULK  EQU   CVTMAP+358                                               03352000
CVTSLKO  EQU   CVTSYSK                                                  03353000
CVTSLKP  EQU   CVTSYSK                                                  03354000
CVTSLKQ  EQU   CVTSYSK                                                  03355000
CVTSLKR  EQU   CVTSYSK                                                  03356000
CVTRSV56 EQU   CVTSYSK                                                  03357000
CVTRSV55 EQU   CVTSYSK                                                  03358000
CVTRSV54 EQU   CVTSYSK                                                  03359000
CVTRSV53 EQU   CVTSYSK                                                  03360000
CVTRSV52 EQU   CVTA1F1                                                  03361000
CVTRSV51 EQU   CVTA1F1                                                  03362000
CVTRSV50 EQU   CVTA1F1                                                  03363000
CVTRSV49 EQU   CVTA1F1                                                  03364000
CVTRSV48 EQU   CVTA1F1                                                  03365000
CVTRSV47 EQU   CVTA1F1                                                  03366000
CVTSRSW  EQU   CVTA1F1                                                  03367000
CVTPFSW  EQU   CVTA1F1                                                  03368000
CVTPCVT  EQU   CVTMAP+352                                               03369000
CVTRSV46 EQU   CVTMAP+344                                               03370000
CVTRSV45 EQU   CVTMAP+340                                               03371000
CVTRSV44 EQU   CVTMAP+338                                               03372000
CVTRSV43 EQU   CVTMAP+336                                               03373000
CVTHJESA EQU   CVTHJES+1                                                03374000
CVTRSV42 EQU   CVTHJES                                                  03375000
CVTEXT2A EQU   CVTEXT2+1                                                03376000
CVTRSV41 EQU   CVTEXT2                                                  03377000
CVTAPFA  EQU   CVTAPF+1                                                 03378000
CVTRSV40 EQU   CVTAPF                                                   03379000
CVTRV518 EQU   CVTINTLA                                                 03380000
CVTRV517 EQU   CVTERPV                                                  03381000
CVTEORM  EQU   CVTMAP+312                                               03382000
CVTMCHPR EQU   CVTMAP+308                                               03383000
CVTTZ    EQU   CVTMAP+304                                               03384000
CVTJEPS  EQU   CVTMAP+300                                               03385000
CVTJESCT EQU   CVTMAP+296                                               03386000
CVTMODE  EQU   CVTMAP+292                                               03387000
CVTPTRV  EQU   CVTMAP+288                                               03388000
CVTREAL  EQU   CVTMAP+284                                               03389000
CVTRSV39 EQU   CVTMAP+280                                               03390000
CVTRSV38 EQU   CVTMAP+276                                               03391000
CVTDMSRA EQU   CVTDMSR+1                                                03392000
CVTRV634 EQU   CVTDMSRF                                                 03393000
CVTRV633 EQU   CVTDMSRF                                                 03394000
CVTRV632 EQU   CVTDMSRF                                                 03395000
CVTRV631 EQU   CVTDMSRF                                                 03396000
CVTRV630 EQU   CVTDMSRF                                                 03397000
CVTRV629 EQU   CVTDMSRF                                                 03398000
CVTUDUMP EQU   CVTDMSRF                                                 03399000
CVTSDUMP EQU   CVTDMSRF                                                 03400000
CVTQMSGA EQU   CVTQMSG+1                                                03401000
CVTRSV36 EQU   CVTQMSG                                                  03402000
CVTAMFF  EQU   CVTMAP+264                                               03403000
CVTPURGA EQU   CVTPURG+1                                                03404000
CVTRSV35 EQU   CVTPURG                                                  03405000
CVTCBSP  EQU   CVTMAP+256                                               03406000
CVTATERA EQU   CVTATER+1                                                03407000
CVTSYST  EQU   CVTATER                                                  03408000
CVTVOLT2 EQU   CVTTAT                                                   03409000
CVTVOLI2 EQU   CVTVOLF2                                                 03410000
CVTAQAVB EQU   CVTAQAVT+1                                               03411000
CVTRSV34 EQU   CVTTCMFG                                                 03412000
CVTRSV33 EQU   CVTTCMFG                                                 03413000
CVTRSV32 EQU   CVTTCMFG                                                 03414000
CVTRSV31 EQU   CVTTCMFG                                                 03415000
CVTRSV30 EQU   CVTTCMFG                                                 03416000
CVTRSV29 EQU   CVTTCMFG                                                 03417000
CVTRSV28 EQU   CVTTCMFG                                                 03418000
CVTTCRDY EQU   CVTTCMFG                                                 03419000
CVTGTFA  EQU   CVTGTF+1                                                 03420000
CVTRSV27 EQU   CVTGTFST                                                 03421000
CVTRNIO  EQU   CVTGTFST                                                 03422000
CVTUSR   EQU   CVTGTFST                                                 03423000
CVTRV318 EQU   CVTFORM                                                  03424000
CVTRV317 EQU   CVTTMODE                                                 03425000
CVTRV316 EQU   CVTSTATE                                                 03426000
CVTRV315 EQU   CVTGTFS                                                  03427000
CVTGTFAV EQU   CVTGTFS                                                  03428000
CVT0SCR1 EQU   CVTMAP+232                                               03429000
CVTRV515 EQU   CVTMAP+228                                               03430000
CVTRMS   EQU   CVTMAP+224                                               03431000
CVTPATCH EQU   CVTMAP+220                                               03432000
CVTTSCE  EQU   CVTMAP+216                                               03433000
CVTLNKSC EQU   CVTMAP+214                                               03434000
CVTQABST EQU   CVTMAP+212                                               03435000
CVTMDLDS EQU   CVTMAP+208                                               03436000
CVTUSER  EQU   CVTMAP+204                                               03437000
CVTABEND EQU   CVTMAP+200                                               03438000
CVTSMCA  EQU   CVTMAP+196                                               03439000
CVTRSV18 EQU   CVTMAP+192                                               03440000
CVTQLPAQ EQU   CVTMAP+188                                               03441000
CVTQCDSR EQU   CVTMAP+184                                               03442000
CVTRSV17 EQU   CVTOPTB                                                  03443000
CVTRSV16 EQU   CVTOPTB                                                  03444000
CVTFP    EQU   CVTOPTB                                                  03445000
CVTAPTHR EQU   CVTOPTB                                                  03446000
CVTNLOG  EQU   CVTOPTB                                                  03447000
CVTTOD   EQU   CVTOPTB                                                  03448000
CVTCTIMS EQU   CVTOPTB                                                  03449000
CVTPROT  EQU   CVTOPTB                                                  03450000
CVTXPFP  EQU   CVTOPTA                                                  03451000
CVTASCII EQU   CVTOPTA                                                  03452000
CVTRSV13 EQU   CVTOPTA                                                  03453000
CVTRSV12 EQU   CVTOPTA                                                  03454000
CVTNIP   EQU   CVTOPTA                                                  03455000
CVTDDR   EQU   CVTOPTA                                                  03456000
CVTAPR   EQU   CVTOPTA                                                  03457000
CVTCCH   EQU   CVTOPTA                                                  03458000
CVTSNCTR EQU   CVTMAP+180                                               03459000
CVTQMWR  EQU   CVTMAP+176                                               03460000
CVTQOCR  EQU   CVTMAP+172                                               03461000
CVT1EF00 EQU   CVTMAP+168                                               03462000
CVTMZ00  EQU   CVTMAP+164                                               03463000
CVTHEAD  EQU   CVTMAP+160                                               03464000
CVTRSV11 EQU   CVTMAP+156                                               03465000
CVT0PT01 EQU   CVTMAP+152                                               03466000
CVTMSER  EQU   CVTMAP+148                                               03467000
CVTRV516 EQU   CVTIERLC                                                 03468000
CVTILCH  EQU   CVTMAP+140                                               03469000
CVT0DS   EQU   CVTMAP+136                                               03470000
CVTFBOSV EQU   CVTMAP+132                                               03471000
CVTNUCB  EQU   CVTMAP+128                                               03472000
CVTIXAVL EQU   CVTMAP+124                                               03473000
CVTIOQET EQU   CVTMAP+120                                               03474000
CVTDCBA  EQU   CVTMAP+117                                               03475000
CVTMVS2  EQU   CVTDCB                                                   03476000
CVT6DAT  EQU   CVTDCB                                                   03477000
CVT4MPS  EQU   CVTDCB                                                   03478000
CVTRSV09 EQU   CVTDCB                                                   03479000
CVT4MS1  EQU   CVTDCB                                                   03480000
CVT2SPS  EQU   CVTDCB                                                   03481000
CVT1SSS  EQU   CVTDCB                                                   03482000
CVTRSV08 EQU   CVTDCB                                                   03483000
CVTSTB   EQU   CVTMAP+112                                               03484000
CVTQTD00 EQU   CVTMAP+108                                               03485000
CVTQTE00 EQU   CVTMAP+104                                               03486000
CVTCUCB  EQU   CVTMAP+100                                               03487000
CVTSJQ   EQU   CVTMAP+96                                                03488000
CVTPBLDL EQU   CVTMAP+92                                                03489000
CVTTPC   EQU   CVTMAP+88                                                03490000
CVTSVDCB EQU   CVTMAP+84                                                03491000
CVTBRET  EQU   CVTMAP+82                                                03492000
CVTEXIT  EQU   CVTMAP+80                                                03493000
CVT0FN00 EQU   CVTMAP+76                                                03494000
CVTDARA  EQU   CVTDAR+1                                                 03495000
CVTRSV07 EQU   CVTFLGS1                                                 03496000
CVTRSV06 EQU   CVTFLGS1                                                 03497000
CVTRSV05 EQU   CVTFLGS1                                                 03498000
CVTRSV04 EQU   CVTFLGS1                                                 03499000
CVTRSV03 EQU   CVTFLGS1                                                 03500000
CVTRSV02 EQU   CVTFLGS1                                                 03501000
CVTRSV01 EQU   CVTFLGS1                                                 03502000
CVTDMPLK EQU   CVTFLGS1                                                 03503000
CVTXITP  EQU   CVTMAP+68                                                03504000
CVTZDTAB EQU   CVTMAP+64                                                03505000
CVTMSLT  EQU   CVTMAP+60                                                03506000
CVTDATE  EQU   CVTMAP+56                                                03507000
CVTBTERM EQU   CVTMAP+52                                                03508000
CVTSYSAD EQU   CVTMAP+48                                                03509000
CVTXTLER EQU   CVTMAP+44                                                03510000
CVTILK2  EQU   CVTMAP+40                                                03511000
CVTILK1  EQU   CVTMAP+36                                                03512000
CVTPRLTV EQU   CVTMAP+32                                                03513000
CVTPCNVT EQU   CVTMAP+28                                                03514000
CVT0VL00 EQU   CVTMAP+24                                                03515000
CVTXAPG  EQU   CVTMAP+20                                                03516000
CVTBUF   EQU   CVTMAP+16                                                03517000
CVTJOB   EQU   CVTMAP+12                                                03518000
CVTLINK  EQU   CVTMAP+8                                                 03519000
CVT0EF00 EQU   CVTMAP+4                                                 03520000
CVTTCBP  EQU   CVTMAP                                                   03521000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      03522000
@RT00185 EQU   RELOOP                                                   03523000
@RT00189 EQU   RELOOP                                                   03524000
@RT00192 EQU   RELOOP                                                   03525000
@RT00195 EQU   RELOOP                                                   03526000
@RT00200 EQU   START                                                    03527000
@RT00202 EQU   RELOOP                                                   03528000
@RT00206 EQU   TCTLRTN                                                  03529000
@ENDDATA EQU   *                                                        03530000
         END   IGG0196Q,(C'PLS2157',0701,77151)                         03531000
./  ADD  SSI=81310275,NAME=IGG0197E
197E TITLE  'IGG0197E - LOADS FCB, ANALYZES MESSAGES '                  00060037
IGG0197E CSECT                                                          00070021
*MODULE NAME - IGG0197E                                          Y02072 00072002
*                                                                       00074002
*DESCRIPTIVE NAME - FCB LOAD AND MESSAGE ANALYSIS                Y02072 00076002
*                                                                       00078002
*COPYRIGHT - NONE                                                Y02072 00078402
*                                                                       00078802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00079202
*                                                                M0099  00080021
*0981409000-410000                                               M0084  00120021
*0981                                                            S21092 00150021
*0981001000,645000-655000                                        M0092  00170021
*136800,235240,669200-669600                                     M0191  00180021
*        VS1 RELEASE 01 DELETIONS                                       00182002
*120000,128000,323000,324000,325000                              YM3213 00184001
*                                                                       00200020
*        VS2 RELEASE 02 DELETIONS                                Y02072 00202002
*000620,001820,001860,002500,053000,075000,146000,162000,202500, Y02072 00204002
*204600,308000,329000-331000,357000-362000,445000-447000,        Y02072 00206002
*618000-627600,650000,032000-039000,571000,601000-602000,        Y02072 00208002
*606000,617000,650000                                            Y02072 00208402
*                                                                YM4697 00208802
*                                                                       00209203
*        VS2 RELEASE 3 DELETIONS                                        00209603
*                                                              @Z30TSCF 00209703
*C495100                                                       @ZA12979 00209837
*D498000-506100                                                @ZA12979 00209937
*C157700-157760                                                @ZA20901 00210037
*A279500-282500                                                @ZA20901 00210137
*C157700,157760                                                @ZA25670 00210237
*A297700,297800                                                @ZA25670 00220237
*C157700-157760                                                @ZA28402 00225237
*A282500,283100                                                @ZA28402 00226237
*A293500                                                       @ZA32079 00230237
*C635500-636000                                                @ZA01357 00240237
*                                                                       00250237
*FUNCTION/OPERATION - ISSUE WAIT FOR OPERATOR REPLY TO MESSAGE   Y02072 00310002
*                     IEC129 IF REQUIRED                         Y02072 00360002
*                   - DETERMINE IF FCB IMAGE IS SPECIFIED IN     Y02072 00410002
*                     DCB EXIT LIST:                             Y02072 00460002
*                     A) IF YES, USE IT                          Y02072 00510002
*                     B) IF NO, ISSUE BLDL TO LOCATE IMAGE IN    Y02072 00560002
*                        SYS1.IMAGELIB                           Y02072 00610037
*                        ISSUE LOAD TO READ IMAGE INTO MAIN STG  Y02072 00660002
*                        SET AN AUDIT TRAIL BIT INDICATING TO    YM4697 00710002
*                        FORCE CLOSE THAT AN FCB IMAGE HAS BEEN  YM4697 00760002
*                        LOADED                                  YM4697 00770002
*                   - WHEN FCB IMAGE IS NOT FOUND IN SYS1.IMAGELIB      00800037
*                     ISSUE MESSAGE TO REQUEST AN OPERATOR TO SPECIFY   00900020
*                     AN ALTERNATE FCB IMAGE                            01000020
*                   - ANALYZE REPLY FROM OPERATOR                Y02072 01100037
*                   - LOAD FCB IMAGE INTO FCB                           01350002
*                   - DETERMINE NEXT EXECUTOR TO XCTL TO.               01400020
*                                                                       01450002
*ENTRY POINT - ENTRY IS FROM IGG0191T,IGG0191V, OR IGG0197U BY   Y02072 01500002
*              USE OF XCTL MACRO                                        01600020
*                                                                       01700020
*INPUT - DCB ADDRESS                                                    01800020
*      - OPEN WORK AREA ADDRESS                                         01900020
*      - WHERE-TO-GO TABLE                                              02000020
*      - PARAMETER LIST                                                 02100020
*      - CURRENT ENTRY IN WTG TABLE                                     02200020
*      - CURRENT PARAMETER (DCB)                                        02300020
*      - REPLY IN OPEN WORK AREA                                        02400020
*                                                                       02500020
*OUTPUT - THE ADDRESS OF FCB RETRIEVED FROM SYS1.IMAGELIB               02600037
*       - A REQUEST TO AN OPERATOR TO SPECIFY ALTERNATE FCB IMAGE       02700020
*         'IEC127D XXX,IMAGE ID,FCB IMAGE NOT FOUND'                    02800037
*                                                                       02900020
*EXTERNAL REFERENCES - MESSAGE CSECT                             Y02072 03000002
*                                                                       03100020
*EXIT - NORMAL - IGG0197F FOR ALL CONDITIONS                     Y02072 03200002
*                                                                       04000020
*EXIT - ERROR - XCTL TO IGG0197F FOR THE FOLLOWING CONDITIONS    Y02072 04050002
*               TO GET A DMABCOND ISSUED:                        Y02072 04100002
*               1- PERMANENT I/O ERROR FROM BLDL                 Y02072 04150002
*               2- OPERATOR REPLIED CANCEL TO MESSAGES IEC129    Y02072 04200002
*                  OR IEC127                                     Y02072 04250002
*                                                                       04900020
*TABLES/WORK AREAS- OPEN WORK AREA     (SEE IECDSECTS)                  05000020
*                 - WHERE-TO-GO TABLE  (SEE LISTING OF IGG0191B)        05100020
*                                                                       05150002
*MACROS-ACTION:MODESET, BLDL, LOAD, EXCP, WAIT, DELETE, XCTL,    Y02072 05160002
*              XCTLTABL                                          Y02072 05170002
*                                                                       05172002
*MACROS-MAPPING:IGGMSG, DCBD, IECDSECT, IEFUCBOB, CVT, IGGSCW,   Y02072 05180002
*               IHAFCAUD                                         YM4697 05190002
*                                                                       05200020
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 05300002
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 05350002
*                                                                       05400020
*NOTES - USES BLDL MACRO TO LOCATE FCB IMAGE IN SYS1.IMAGELIB           05480037
*      - USES LOAD MACRO TO LOAD FCB IMAGE FROM SYS1.IMAGELIB           05560037
*     -  USES EXCP/WAIT MACRO TO LOAD IMAGE IN TO BUFFER                05650002
*      - USES WTO/WTOR SVC TO REQUEST OPERATOR REPLYS                   05700020
*      - USES DELETE MACRO TO DELETE FCB IMAGE IF NOT USEABLE           05800020
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 05860002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 05870002
*                                                                       05900020
         EJECT                                                          05950002
*********************************************************************** 06000020
*                                                                       06100020
*   REGESTER CONVENTIONS USED THRUOUT ALL OPEN PASSES                   06200037
*                                                                       06300020
*********************************************************************** 06400020
*                                                                       06500020
RE       EQU   0                        WORK/PARAMETER REGISTER         06600020
RWK1     EQU   RE                       WORK REGISTER            Y02072 06650002
RF       EQU   1                        WORK/PARAMETER REGISTER         06700020
RWK2     EQU   RF                       WORK REGISTER            Y02072 06750002
RDCB     EQU   2                        ADDRESS OF USER'S DCB           06800020
RBASE    EQU   3                        BASE REGISTER                   06900020
RCORE    EQU   4                        ADDRESS OF OPEN WORK AREA       07000020
RPAR     EQU   5                        PARAMETER LIST                  07100020
RWTG     EQU   6                        START OF WTG TABLE              07200020
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 07300020
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      07400020
RWK3     EQU   9                        WORK REGISTER            Y02072 07500002
RUCB     EQU   10                       UCB ADDRESS/WORK REGISTER       07600020
RDEB     EQU   11                       DEB ADDRESS                     07700020
RWK5     EQU   RDEB                     WORK REGISTER            Y02072 07750002
RB       EQU   12                       WORK REGISTER/BREG FOR DSECT    07800020
RC       EQU   13                       WORK REGISTER                   07900020
RWK6     EQU   RC                       WORK REGISTER            Y02072 07950002
RD       EQU   14                       WORK/PARAMETER REGISTER         08000020
RJ       EQU   15                       WORK/PARAMETER REGISTER         08100020
RWK7     EQU   RJ                       WORK REGISTER            Y02072 08150002
*                                                                       08200020
*********************************************************************** 08300020
*                                                                       08400020
*   EQUATE WTG OFSET                                                    08500020
*                                                                       08600020
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   08700020
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   08800020
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TAB  08900020
FCBOPTNS EQU   X'05'                    FCB OPTION DISPLACEMENT         09000020
*                                                                       09100020
**********************************************************************  09200020
*                                                                       09300020
*   GENERAL EQUATES                                                     09400020
*                                                                       09500020
*********************************************************************** 09600020
*                                                                       09700020
FOUR     EQU   X'04'                                                    10100020
TWO      EQU   2                        CONSTANT                        10150020
BLANK    EQU   X'40'                                                    10300020
NULL     EQU   X'00'                                                    10400020
NOREPETS EQU   X'05'                                                    10600020
COMMA    EQU   C','                                                     10700020
VERFYCN2 EQU   C'V'                                                     10900020
ALIGNCN2 EQU   C'A'                                                     11000020
ALIGNMSK EQU   X'80'                                                    11200020
VERFYMSK EQU   X'40'                                                    11300020
EXCPMASK EQU   X'80'                                                    11700020
BUFCNTRL EQU   X'01'                                                    11800020
PCIMASK  EQU   X'20'                                                    11900020
CORTRANS EQU   X'40'                    MASK FOR CORE TRANSFER   Y02072 12100002
EXLSTEND EQU   X'80'                    END OF EXIT LIST FLAG           12200020
FCBMASK  EQU   X'10'                    MASK FOR FCB ENTRY DCBXLST      12300020
FCBENDMK EQU   X'90'                    FCB AT END OF DCB EXLIST        12400020
UCBFCBOF EQU   X'08'                    FCB OFFSET IN UCB WORK AREA     12600020
ABEND    EQU   X'FF'                   ABEND SWITCH                     12700020
LNIEC124 EQU   X'34'                    LENGTH OF IEC124 MESS1G5        12900020
SUCCFLCC EQU   X'7F'                    SUCCESSFUL COMPLETION CODE      13000020
SILION   EQU   X'20'                    SET SILI BIT           @ZAXXXXX 13050037
FCBLDCC  EQU   X'63'                    COMMAND CODE=LOAD FCB           13100020
FCBLTHOS EQU   X'01'                    FCB IMAGE LENGTH OFFSET         13200020
BSTFCBIM EQU   X'02'                    BYTES TO START OF FCB IMAGE     13300020
UNRLBMSK EQU   X'42'                    UNRELATED BIT MASK              13500020
NRETRYS  EQU   X'02'                    NUMBER OF TIMES TRY TO LOAD FCB 13600020
STGETWO  EQU   X'C7'                    ENTRY FLAG FOR 197F      Y02072 13630002
TWENTY6  EQU   26                       CONSTANT                        13660020
PRT2245  EQU   X'0B'                    MASK FOR 2245 PRINTER    S21092 13670021
F2245ID  EQU   C'K'                    CONSTANT FOR 2245 ID'S     M0191 13680021
IEC129RQ EQU   X'80'                    191T, 191V, OR 197U      Y02072 13686602
*                                         ISSUED MSG IEC129;     Y02072 13688602
*                                         MUST WAIT ON OPER REP  Y02072 13690602
*                                                                       13714202
*  THE FOLLOWING MESSAGE NUMBERS ARE EQUAL TO THEIR POSITION     Y02072 13720802
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 13727402
*  OF AN INDEX).                                                 Y02072 13734002
*                                                                       13740602
MSG124   EQU   11*2                     MESSAGE NO IN MSG CSECT  Y02072 13747202
MSG125   EQU   9*2                      MESSAGE NO IN MSG CSECT  Y02072 13753802
MSG127   EQU   12*2                     MESSAGE NO IN MSG CSECT  Y02072 13760402
FCBIMLNG EQU   4                        LENGTH OF FCB IMAGE NAME Y02072 13767002
OABD101  EQU   101                      PROB DETERMINE CODE      YM3213 13773602
OABD102  EQU   102                      PROB DETERMINE CODE      YM3213 13780202
OABD103  EQU   103                      PROB DETERMINE CODE      YM3213 13786802
*                                                                       13793402
         EJECT                                                          13800002
         BALR  RBASE,0                  INITIALIZE BASE REGISTER        14000020
         USING *,RBASE                                                  14100037
         USING FORCORE,RCORE                                            14200020
         USING UCBOB,RUCB                                               14300020
         USING IHADCB,RDCB                                              14400020
         USING DEB,RDEB                                                 14500020
*                                                                       14700020
*                                                                       15100020
*********************************************************************** 15200020
*                                                                       15300020
*   INITIALIZE REGISTERS                                                15400020
*                                                                       15500020
*********************************************************************** 15600020
*                                                                       15700020
         B     AROUND                   BR AROUND CONSTANTS      Y02072 15750002
         DC    C'IGG0197E'              MODULE NAME              Y02072 15760002
         DC    C'@ZA32079'              LAST SHIP CODE         @ZA32079 15770037
         DC    C'04/26/78'              LAST DATE MODIFIED     @ZA32079 15776037
AROUND   DC    0H'0'                                             Y02072 15790037
*                                                                       15792002
         L     RDCB,0(RPARC)            LOAD  CURRENT DCB ADDRESS       15800020
         L     RCORE,4(RWTGC)           LOAD  CURRENT WORK AREA ADDRESS 15900020
         L     RDEB,DCBDEBAD            LOAD  DEB ADDRESS FROM DCB      16000020
         L     RUCB,DEBUCBAD            LOAD UCB ADDRESS FROM DEB       16100020
         DROP  RDEB                                              Y02072 16200002
*                                                                       16220020
*                                                                       16300020
*********************************************************************** 16400020
*                                                                       16500020
*   TEST THE ENTRY SWITCH TO DETERMINE REQUIRED OPERATION               16600020
*    (DXFCBSW1)       X'02' ENTRY FROM WTOR                             16900002
*                                                                       17000020
*********************************************************************** 17100020
*                                                                       17200020
         TM    DXFCBSW1,IEC129RQ        WAS MSG IEC129 ISSUED BY Y02072 17250002
*                                         AN EARLIER LOAD        Y02072 17300002
         BO    FCB1100                  YES, GO WAIT ON REPLY    Y02072 17350002
*                                                                       17400002
**********************************************************************  17800020
*                                                                       17900020
*   CORE TRANSFER ROUTINE FOR FCB IMAGES                                18000020
*   * CK IF THE FCB IMAGE TO BE LOADED IS SPECIFIED IN THE DCBEXLST     18100020
*     YES-GO LOAD THE FCB IMAGE FROM THE DCBEXLST ADDRESS               18200020
*     NO -GO TO BLDL ROUTINE TO LOCATE IMAGE IN SYS1.IMAGELIB           18300020
*                                                                       18400020
**********************************************************************  18500020
*                                                                       18600020
FCB1030  EQU   *                                                        18700020
*                                                                       18800020
         L     RB,DCBRECFM              GET ADDR OF DCBEXLST            18900020
         LA    RB,NULL(RB)              CLEAR ZERO BYTE                 19000020
         LTR   RB,RB                    TEST IF DCBEXLST PRESENT        19100020
         BZ    FCB1060                  NO GO TO BLDL ROUTINE           19200020
         MODESET  KEYADDR=DXUKEY,WORKREG=15  GET INTO USER KEY   Y02072 19250002
*                                                                       19300020
*   YES CHECK IF FCB ENTRY IN DCB EXIT LIST                             19400020
*                                                                       19500020
FCB1040  EQU   *                                                        19600020
*                                                                       19700020
         CLI   NULL(RB),FCBMASK         CK IF ENTRY SPECIFIES FCB ADDR  19800020
         BE    FCB1050                  YES CK IF FCB IMAGE ID=FCB IM   19900020
*                                       SPECIFIED IN DD STATEMENT       20000020
         CLI   NULL(RB),FCBENDMK        FCB MASK AT END OF DCB EXLST    20050020
         BE    FCB1050                  IF SO GO CK IF IM=IMIN DD STS   20100020
*                                                                       20150020
         TM    NULL(RB),EXLSTEND        CK FOR END OF DCB EXLIST        20200020
         BO    FCB1055                  IF SO GO TO BLDL ROUTINE Y02072 20250002
*                                                                       20300020
FCB1045  EQU   *                                                        20400020
*                                                                       20420020
         TM    NULL(RB),EXLSTEND        CK FOR END OF DCB EXIT LIST     20440020
         BO    FCB1055                 IF SO GO TO BLDL ROUTINE  Y02072 20460002
*                                                                       20500020
         LA    RB,FOUR(RB)              INCREMENT TO NEXT EXLST ENTRY   20600020
         B     FCB1040                  GO CK NXT EXLST ENTRY           20700020
*                                                                       20800020
*   CK IF FCB SPECIFIED IN DD STATEMENT CORRESPONDS TO IMAGE IN CORE    20900020
*                                                                       21000020
FCB1050  EQU   *                                                        21100020
*                                                                       21200020
         L     RD,NULL(RB)              GET FCB IMAGE ADDR FROM EXLST   21300020
         LA    RD,NULL(RD)              CLEAR HIGH ORDER BYTE           21400020
         CLC   DXFCBID,0(RD)            CK IF FCB ID'S ARE EQ    Y02072 21450002
         BNE   FCB1045                  NO GO BACK TO EXLST             21600020
         LA    RB,FOUR(RD)              YES PUT ADDR OF FCB IMAGE IN    21700020
*                                         REGISTER                      21702002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 21710002
         SPACE                                                          21720002
         OI    DXFCBSW1,CORTRANS        INDIC USER SUPPLIED IM   Y02072 21730002
         B     FCB1070                  GO LOAD IMAGE INTO FCB BUFFER   21900020
*********************************************************************** 22000020
*                                                                       22100020
*   BLDL ROUTINE TO LOCATE FCB IMAGE IN SYS1.IMAGELIB                   22150037
*                                                                       22200020
*********************************************************************** 22250020
*                                                                       22300020
FCB1055  EQU   *                       GET INTO DATA MANAG KEY   Y02072 22350002
         MODESET  EXTKEY=DATAMGT                                 Y02072 22360002
FCB1060  EQU   *                                                        22400020
*                                                                       22500020
         MVC   DXBLDL,BLDLCNST          MOVE BLDL LEN TO LIST    Y02072 23350002
         MVC   DXBLDLIM,FCBCONST        MOVE 'FCB2' INTO NAME    Y02072 23360002
         CLI   UCBTBYT4,PRT2245        CHECK FOR 2245 PRINTER    S21092 23508021
         BNE   FCB1067                 NO, SKIP NEXT INSTRUCTION S21092 23516021
         MVI   DXBLDLIM+3,F2245ID       MOVE 'K' IN 4TH BYTE OF  Y02072 23518002
*                                      IMAGE ID (FCBK)           M0191  23532021
*                                                                       23540021
*********************************************************************** 23548021
*                                                                       23556021
FCB1067  EQU   *                                                 S21092 23564021
*                                                                       23572021
*********************************************************************** 23580021
*                                                                       23588021
         MVC   DXIMGNAM,DXFCBID         MOVE FCB NAME FROM JFCB  Y02072 23598002
*                                         TO BLDL LIST           Y02072 23598402
*                                                                       23700020
*   GET ADDRESS OF SYS1.IMAGELIB AND LOAD IT INTO REGISTER 1            23800037
*                                                                       23900020
         L     RF,DXIMGDCB              GET ADDR OF IMGLIB DCB   Y02072 23950002
         LA    RE,DXBLDL                GET ADDR OF BLDL LIST    Y02072 23960002
*                                                                       24200020
         BLDL  (1),(0)                  BLDL THE FCB DATA INTO CORE     24300020
*                                                                       24400020
*    TEST RETURN CODES FROM THE BLDL WHICH ARE FOUND IN REG.15 (RJ)     24500020
*        X'00' - IMAGE FOUND                                            24600020
*        X'04' - IMAGE NOT FOUND                                        24700020
*        X'08' - PERMANENT I/O ERROR                                    24800020
*                                                                       24900020
         LA    RD,FOUR                  SET  X'04' TO TEST RETURN CODE  25000020
         CLR   RD,RJ                    TEST RETURN CODE                25100020
         BE    FCB1080                  IMAGE NOT FOUND GO ISSUE IEC127 25200020
         BL    FCB1230                  PERMANENT I/O ERROR GO TO ABEND 25300020
*                                       IMAGE FOUND LOAD FCB IMAGE      25400020
*                                                                       25500020
*********************************************************************** 25600020
*                                                                       25700020
*   LOAD FCB IMAGE FROM SYS1.IMAGELIB                                   25800037
*                                                                       25900020
*********************************************************************** 26000020
*                                                                       26100020
         LA    RE,DXBLDLIM              LOAD ADDR OF BLDL LIST   Y02072 26150002
         L     RF,DXIMGDCB              GET ADDR OF IMAGELIB DCB Y02072 26160037
*                                                                       26400020
         LOAD  DE=(0),DCB=(1)           LOAD FCB FROM SYS1.IMAGELIB     26500020
*                                                                       26600020
         LR    RB,RE                    SAVE ADDRESS OF FCB IMAGE       26700020
         MVC   DXSAVFCB,DXBLDLIM        SAVE FCB ID FOR DELETE   Y02072 26750002
         OI    FCAOPEN2,FCAOFCBL        INDIC FCB IMAGE LOADED   YM4697 26752002
*                                                                       27100020
*********************************************************************** 27200020
*                                                                       27300020
*   ISSUE EXCP TO LOAD BUFFER                                           27400002
*                                                                       27500020
*********************************************************************** 27600020
*                                                                       27700020
FCB1070  EQU   *                                                        27800020
*                                                                       27900020
         L     RC,UCBXTADR             LOAD UCB EXTEN ADDRESS  @ZAXXXXX 27950037
         TM    5(RC),X'01'             FCB PARITY ERROR        @ZA20901 28000037
         BO    FCB1071                 YES- RELOAD FCB IMAGE   @ZA20901 28050037
         USING UCBUCS,RWK6                                     @ZA20901 28100037
         CLC   DXFCBID,UCBFCBID        FCBIMAGE ALREADY LOADED @ZA20901 28110037
         DROP  RWK6                                            @ZA20901 28120037
         BE    FCB1191                 YES-GO TEST FOR VERIFY  @ZA20901 28150037
FCB1071  EQU   *                                               @ZA20901 28200037
         MODESET EXTKEY=SUPR           GET INTO SUPERVISOR KEY @ZA28402 28250037
         NI    5(RC),X'FE'             TURN OFF FCB PARITY ERR @ZA20901 28280037
         MODESET EXTKEY=DATAMGT        BACK TO DATA MGT KEY 5  @ZA28402 28310037
         LA    RC,NRETRYS               SET TO RETRY FCB LOAD ONCE      28400020
         XC    DXCCW1(8),DXCCW1         RESET CCW TO ZEROS              28700037
         MVI   IOBFLAG1,UNRLBMSK        SET IOB FLAG UNRELATED BIT ON   28800020
         LA    RE,BSTFCBIM(RB)          GET ADDRESS OF FCB IMAGE TO LD  28900020
         ST    RE,DXCCW1                STORE ADDR OF FCB IMAGE IN CCW  29000020
*                                                                       29002002
*  GET INTO KEY 0 AS WE COULD BE MOVING FROM USER KEY TO DATA    Y02072 29012002
*  MANAGEMENT KEY                                                Y02072 29014002
*                                                                       29030002
         MODESET  EXTKEY=SUPR                                    Y02072 29050002
         MVC   DXCCW1+7(1),FCBLTHOS(RB) STORE LNGTH OF FCB IMAGE IN CCW 29100020
         MVI   DXCCW1,FCBLDCC           MOVE COMMAND CODE=LOAD FCB INTO 29200020
*                                       CCW                             29300020
         MVI   DXCCW1+4,SILION          SET SILI ON            @ZA32079 29350037
*                                                                       29400020
*   ISSUE EXCP AND WAIT FOR COMPLETION OF FCB LOAD                      29500020
*                                                                       29600020
FCB1073  EQU   *                                                        29700020
         L     RF,UCBXTADR              LOAD UCB EXTENSION ADDR  M0092  29720021
         MVC   8(4,RF),DXFCBID          PUT FCB IMAGE ID INTO    Y02072 29730002
*                                       UCB EXTENSION AREA            * 29760021
         MVC   5(1,RF),0(RB)            PUT FCB OPT INTO UCB   @ZA25670 29770037
*                                       EXTENSION              @ZA25670 29780037
         MVI   DXECB,NULL               CLEAR REPLY ECB                 29800020
         LA    RF,DXIOB                 LOAD IOB ADDRESS IN REGISTER 1  29900020
*                                                                       30000020
         EXCP  (1)                      ISSUE EXCP                      30100020
*                                                                       30200020
         LA    RF,DXECB                 LOAD ECB ADDRESS IN REG 1       30300020
*                                                                       30400020
         WAIT  ECB=(1)                  ISSUE WAIT                      30500020
*                                                                       30600020
         CLI   DXECB,SUCCFLCC           CK IF FCB LOAD SUCCESSFUL       30700020
         BE    FCB1191                  YES GO CK OPTION BITS    Y02072 30800002
*                                       NO ERROR CONDITION EXIST        30900020
*                                                                       31000020
*********************************************************************** 31100020
*                                                                       31200020
*   IF ERROR CONDITIONS EXIST, RETRY FCB LOAD ONE TIME                  31300002
*                                                                       31400020
*********************************************************************** 31500020
*                                                                       31600020
         BCT   RC,FCB1073               GO RETRY EXCP ONCE              31700020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 31750002
*                                                                       31800020
*********************************************************************** 31900020
*                                                                       32000020
*   IF A PERMANENT I/O ERROR OCCURED DURING AN FCB LOAD THE UCB IS      32100020
*   UP DATED WITH X'00' TO SHOW FCB NOT USABLE.                         32200020
*                                                                       32600020
*                                                                       32700020
*********************************************************************** 32800020
         LA    RWK5,MSG124              MESSAGE NO FOR MSG RTN   Y02072 32850002
         BAL   RWK6,GETMSG              GET MESSAGE              Y02072 32900002
         USING MSGENTRY,RWK2                                     Y02072 32950002
         IC    RWK7,MSGOFF1             OFFSET TO FIRST VAR FLD  Y02072 33000002
         LA    RWK3,8(RWK7,RCORE)       ADDRESS OF VAR FLD       Y02072 33050002
         MVC   0(L'UCBNAME,RWK3),UCBNAME  DEV NAME TO MSG        Y02072 33100002
         DROP  RWK2                                              Y02072 33150002
         LA    RF,MSGLSTSZ              LOAD ADDRESS FOR WTO            33400020
*                                                                       33500020
         SVC   35                       ISSUE WTO SVC                   33600020
*                                                                       33700020
         MVI   DXFCBOPT,OABD102         INTERNAL CODE 102        Y02072 33750002
*                                                                       33900020
FCB1075  EQU   *                                                        34000020
*                                                                       34100020
         MVI   DXSTAGE2,ABEND           SET ABEND SW             Y02072 34150002
         B     FCB1198                  GO LOAD ADDR IGG0197F           34400020
*                                                                       34500020
FCB1080  EQU   *                                                        34600020
*********************************************************************** 34700020
*                                                                       34800020
*   WTOR SEQUENCE FOR FCB IMAGE NOT FOUND REQUESTING OPERATOR REPLY     34900020
*   'IEC127D XXX,IMAGE ID FCB IMAGE NOT FOUND'                          35000020
*   OPERATOR REPLYS:                                                    35100020
*   'REPLY XX,'TEXT'' WHERE THIS IS AN ALTERNATIVE FCB IMAGE ID         35200020
*   'REPLY XX,'U'     USE CURRENT FCB IMAGE                             35300020
*   'REPLY XX,'C'     CANCEL.                                           35400020
*                                                                       35500020
*********************************************************************** 35600020
         LA    RWK5,MSG127              MESSAGE NO FOR MSG RTN   Y02072 35610002
         BAL   RWK6,GETMSG              GO GET MSG               Y02072 35620002
         USING MSGENTRY,RWK2                                     Y02072 35670002
WTO127   EQU   *                                                 Y02072 36282002
         IC    RWK7,MSGOFF1             OFFSET TO FIRST VAR FLD  Y02072 36286002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF FIRST VAR FLD Y02072 36288402
         MVC   0(L'UCBNAME,RWK3),UCBNAME  MOVE DEV NAME TO MSG   Y02072 36288802
         IC    RWK7,MSGOFF2             OFFSET TO SECOND VAR FLD Y02072 36289202
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF SEC VAR FLD   Y02072 36289602
         MVC   0(FCBIMLNG,RWK3),DXCCW10+4  FCB IMAGE TO MSG      Y02072 36289702
         DROP  RWK2                                              Y02072 36290002
*********************************************************************** 36300020
*                                                                       36400020
*   WTOR ROUTINE                                                        36500020
*                                                                       36600020
***                                                                   * 36700020
*                                                                       36800020
FCB1090  EQU   *                                                        36900020
*                                                                       37000020
         XC    RPLY(24),RPLY            ZERO OUT REPLY AREA AND ECB     37200020
*                                                                       37400020
         LA    RF,REPLYLTH              LOAD WTOR ADDRESS FOR SVC.      37500020
         SVC   35                       ISSUE WTOR SVC                  37600020
FCB1100  EQU   *                                                        37700020
         LA    RF,RPLYECB               GET ADDRESS OF REPLY ECB        37800020
*                                                                       37900020
         WAIT  ECB=(1),LONG=YES         WAIT ON REPLY            Y02072 38000002
*                                                                       38100020
*********************************************************************** 38200020
*                                                                       38300020
*   REPLY ANALYSIS                                                      38400020
*   (1) 'U' - USE CURRENT FCB IMAGE                                     38500020
*   (2) 'CANCEL'/'C' - FCB IMAGE NOT AVAILABLE                          38600037
*   (3) 'FCB ID' - FCB ID WITH OPTIONS                                  38700020
*                                                                       38800020
*********************************************************************** 38900020
         OC    RPLY(8),LOMASK           OR TO ALLOW LOWER CASE REPLY    39000020
         CLC   RPLY(2),RPLYEQU          CK IF REPLY = 'U '              39100020
         BE    FCB1125                  GO SET UP FOR LOAD       Y02072 39400002
         CLC   RPLY(4),REPLYUSE         OPERATOR REPLIED 'USE '         39430020
         BE    FCB1125                  GO SET UP FOR LOAD       Y02072 39460002
         CLC   RPLY(6),RPYEQCAN         CHECK IF REPLY V'CANCEL '       39530020
         BE    FCB1120                  GO SET CANCEL RET CODE & ABEND  39600020
         CLC   RPLY(2),RPLYEQC          CK IF REPLY = 'C '              39700020
         BNE   FCB1130                  GO TEST FCB PARAMETERS          39800020
*                                                                       39900020
FCB1120  EQU   *                                                        40000020
*                                                                       40100020
*********************************************************************** 40200020
*                                                                       40300020
*   SPECIFIED FCB IMAGE NOT FOUND IN SYS1.IMAGELIB,JOB STEP CANCELED    40400020
*   BY OPERATOR.                                                        40500001
*                                                                       40600020
*********************************************************************** 40700020
*                                                                       40800020
         MVI   DXFCBOPT,OABD103         INTERNAL CODE 103        Y02072 40850002
         B     FCB1075                  GO TO SETUP ABEND        M0084  41000021
*                                                                       41050002
*********************************************************************** 41060002
*                                                                       41060402
*   OPERATOR REPLIED 'U' TO MESSAGE IEC127 - GET IMAGE ID        Y02072 41062002
*   FROM THE UCB AND SET UP TO RELOAD FCB                        Y02072 41064002
*                                                                       41066002
*********************************************************************** 41070002
*                                                                       41080002
FCB1125  EQU   *                                                 Y02072 41082002
         L     RWK7,UCBXTADR            ADDR OF UCB UCS/FCB SECT Y02072 41090002
         USING UCBUCS,RWK7                                       Y02072 41092002
         MVC   DXFCBID,UCBFCBID         FCB ID TO WORKAREA       Y02072 41094002
         MVI   DXFCBOPT,0               CLEAR USER OPTIONS       Y02072 41096002
         DROP  RWK7                                              Y02072 41098002
         B     FCB1030                  GO FIND FCB IMAGE        Y02072 41098402
*                                                                       41100020
*********************************************************************** 41200020
*                                                                       41300020
*   ANALYZE FCB PARAMETERS IN OPERATOR'S REPLY                          41400020
*                                                                       41500020
*********************************************************************** 41600020
*                                                                       41700020
FCB1130  EQU   *                                                        41800020
*                                                                       41900020
         LA    RD,RPLY                  GET ADDRESS OF REPLY AREA       42000020
         LA    RJ,NOREPETS              LOAD NUMBER OF REPITIONS        42100020
         CLI   0(RD),COMMA              CK IF 1ST CHARACTER IS A COMMA  42200020
         BE    FCB1150                  YES GO TO ERROR ROUTINE         42300020
         CLI   0(RD),BLANK              CK IF 1ST CHARACTER IS A BLANK  42400020
         BE    FCB1150                  YES GO TO ERROR ROUTINE         42500020
*                                                                       42600020
         MVC   UCSID(4),LOMASK         BLANK OUT UCS ID BYTE            42630020
         MVI   MCSMASK,NULL             ZERO OUT LOAD MODE BYTE         42660020
FCB1140  EQU   *                                                        42700020
*                                                                       42800020
         CLI   0(RD),BLANK              CK IF THIS CHARACTER IS A BLANK 42900020
         BE    FCB1190                  GO SET UP TO FIND IMAGE  Y02072 43000002
         CLI   0(RD),COMMA              CK IF CHARACTER IS A COMMA      43100020
         BE    FCB1160                  GO CK FOR FCB OPTIONS           43200020
         MVC   UCSID-RPLY(1,RD),NULL(RD) MOVE IN ONE BYTE OF FCB ID IMG 43300020
         LA    RD,1(RD)                 INCREMENT PTR TO NXT CHAR IN    43400020
*                                       REPLY                           43500020
         BCT   RJ,FCB1140               GO EXAMINE NEXT CHAR OF REPLY   43600020
*                                                                       43700020
*********************************************************************** 43800020
*                                                                       43900020
*   ERROR ROUTINE FOR INCORRECT OPERATOR REPLY                          44000020
*                                                                       44100020
*********************************************************************** 44200020
*                                                                       44300020
FCB1150  EQU   *                                                        44400020
         LA    RWK5,MSG125              MESSAGE NO FOR MSG CSECT Y02072 44450002
         LA    RWK6,FCB1090             RETURN ADDRESS           Y02072 44500002
         B     GETMSG                   GO GET MSG               Y02072 44550002
*********************************************************************** 44800020
*                                                                       44900020
*   CHECK FCB OPTIONS MUST BE EITHER 'VERIFY'/'V' OR 'ALIGN'/'A'        45000020
*                                                                       45100020
*********************************************************************** 45200020
*                                                                       45300020
FCB1160  EQU   *                                                        45400020
*                                                                       45500020
         XC    DXFCBP,DXFCBP            CLEAR FCB PARM WORK AREA Y02072 45550002
         CLC   1(6,RD),VERFYCN1         CK IF FCB VERIFY SPECIFIED      45700020
         BE    FCB1180                  GO SET OPTION BITS FOR VERIFY   45800020
         CLI   1(RD),VERFYCN2           CK IF FCB VERIFY SPECIFIED      45900020
         BE    FCB1180                  GO SET OPTION BITS FOR VERIFY   46000020
         CLC   1(4,RD),ALIGNCN1         CK IF ALIGN FORMS SPECIFIED     46100020
         BE    FCB1170                  GO SET OPTION BITS FOR ALIGN    46200020
         CLI   1(RD),ALIGNCN2           CK IF ALIGN FORMS SPECIFIED     46300020
         BNE   FCB1150                  NO GO TO REPEAT REPLY ROUTINE   46400020
*                                       YES FALL THROUGH TO SET ALIGN   46500020
*                                                                       46600020
FCB1170  EQU   *                                                        46700020
         MVI   MCSMASK,ALIGNMSK         SET OPTION BIT TO ALIGN FORMS   46800020
         B     FCB1190                  GO CK FCB NAME                  46900020
*                                                                       47000020
FCB1180  EQU   *                                                        47100020
         MVI   MCSMASK,VERFYMSK         SET OPTION BIT FOR VERIFY       47200020
*                                       GO CK FCB NAME                  47300020
FCB1190  EQU   *                                                        47400020
*                                                                       47500020
         MVC   DXFCBOPT,MCSMASK         MOVE REPLY FCB OPTION    Y02072 47550002
         MVC   DXFCBID,UCSID            MOVE REPLY FCB ID TO     Y02072 47560002
*                                         WORKAREA               Y02072 47570002
         B     FCB1030                  GO FIND FCB IMAGE        Y02072 47620002
FCB1191  EQU   *                        BACK TO DATA MANAG KEY   Y02072 49350002
         MODESET  EXTKEY=DATAMGT                                 Y02072 49360002
FCB1192  EQU   *                                                        49400020
         CLI   DXFCBOPT,VERFYMSK        CK IF VERIFY SPEC        Y02072 49450002
         BNE   FCB1194                  NO, CHECK ALIGN OPTION @ZA12979 49510037
*                                                                       49520020
*                                                                       49530020
*   SET UP TRANSLATION TABLE FOR USE BY IGG0197F TO VERIFY FCB IMAGE    49540020
*                                                                       49550020
*                                                                       49560020
         MVC   DXCCW3(TWENTY6),TRANSTAB MOVE IN TRANSLATION TABLE       49570020
*                                                                       49570102
*  GET INTO KEY 0 AS WE ARE MOVING FROM USER KEY TO DATA MANAG   Y02072 49570402
*  KEY.                                                          Y02072 49570802
*                                                                       49571202
         MODESET  EXTKEY=SUPR                                    Y02072 49572002
         MVC   DXCCW7+4(1),TWO(RB)      MOVE IN LINE/INCH INDICATOR     49575020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 49577002
*                                                                       49580020
*                                                                       49590020
         B     FCB1198                  GO LOAD ADDRESS OF MODULE 7F    49600020
*                                                                       49610020
*                                                                       49700020
*********************************************************************** 50700020
*                                                                       50800020
FCB1194  EQU  *                                                         50900020
         CLI   DXFCBOPT,ALIGNMSK        ALIGN SPEC FOR THIS FCB  Y02072 50950002
         BNE   FCB1250                IF NOT GOTONEXT EXECUTOR          51100020
FCB1198  EQU   *                                                        51300020
         LA    RF,MODNM7F             LOAD ADDRESS OF MODULE IGG0197F   51400020
         B     FCB1290                GO XCTL TO IGG0197F               51500020
FCB1230  EQU   *                                                        51600020
         MVI   DXFCBOPT,OABD101         INTERNAL CODE 101        Y02072 51850002
         B     FCB1075                 GO SET ABEND SWITCH              52000020
FCB1250  EQU   *                                                        54500020
         MVI   DXSTAGE2,STGETWO         SET SW FOR 197F          Y02072 54850002
         LA    RF,MODNM7F               GET ADDRESS OF IGG0197F         55400020
*                                                                       56200020
*********************************************************************** 56300020
*                                                                       56400020
*   MOVE IDTTR TO XCTL WTG TABLE                                        56500020
*                                                                       56600020
*********************************************************************** 56700020
*                                                                       56800020
FCB1290  EQU   *                                                        56900003
*                                                                       57000020
         USING WTGENTRY,RWTGC                                    Y02072 57050002
         MVC   WTGIDTTR,0(RF)           ID TO WTG TABLE        @Z30TSCF 57060003
*                                                                       57200020
*********************************************************************** 57300020
*                                                                       57400020
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            57500020
*                                                                       57600020
*********************************************************************** 57700020
*                                                                       57800020
FCB1300  EQU   *                                                        57900020
*                                                                       58000020
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     58100020
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ADDRESS   58200020
         CLC   0(2,RWTGC),AMIDCNST      IS ROUTINE NEEDED AGAIN         58300020
         BCR   8,RBASE                  IF YES,RETURN TO PROCESS        58400020
*                                                                       58500020
         CLC   0(2,RWTGC),OPIDCNST      TEST END OF WTG TABLE           58600020
         BNE   FCB1300                  NO GO CK NEXT ENTRY             58700020
*                                                                       58800020
         LR    RPARC,RPAR               RESET REG TO '0'                58900020
         LA    RWTGC,WAOFF(0,RWTG)      RESET WTG REG TO PT WTG +32     59000020
FCB1310  CLI   0(RWTGC),NULL            CK IF THIS ENTRY COMPLETE       59100020
         BNE   FCB1320                  IF NOT GO XCTL                  59200020
*                                                                       59300020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY OF WTG TABLE     59400020
         LA    RPARC,PLOFF(0,RPARC)     GET NEXT ENTRY OF DCB           59500020
         B     FCB1310                  GO TO TEST COMPLETION           59600020
*                                                                       59700020
FCB1320  EQU   *                                                        59800020
*                                                                       59900020
         USING WTG,RWTG                                                 59950003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*60000003
               MODID=WTGENTRY                                  @Z30TSCF 60050003
         DROP  RWTGC,RWTG                                      @Z30TSCF 60100003
*                                                                       60700020
*********************************************************************** 60800020
*                                                                       60900020
*   CONSTANTS                                                           61000020
*                                                                       61100020
*********************************************************************** 61200020
*                                                                       61300020
*   FOR WTG TABLE                                                       61400020
OPIDCNST DC    C'0S'                                                    61500020
AMIDCNST DC    C'7E'                                                    61600020
MODNM7F  DC    C'7F',VL3(IGG0197F)      NEXT MOD'S ID          @Z30TSCF 61650003
*                                                                       62800020
*   MISC CONSTANTS                                                      62900020
*                                                                       63000020
TRANSTAB DC    C'00010203040506070809101112' CHANNEL CODE TABLE         63010020
*   USED BY IGG0197F TO VERIFY AN FCB IMAGE                             63020037
*                                                                       63030020
REPLYUSE DC    C'USE '                  REPLY = USE CURRENT FCB IMAGE   63060020
RPLYEQU  DC    C'U '                    REPLY='U',USE CURRENT IMAGE     63120020
RPYEQCAN DC    C'CANCEL'                REPLY='CANCEL' FOR FCB LOAD     63200020
RPLYEQC  DC    C'C '                    REPLY='C',CANCEL FCB LOAD       63300020
VERFYCN1 DC    C'VERIFY'                                                63400020
ALIGNCN1 DC    C'ALIGN'                                                 63500020
*   THE FIRST TWO BYTES OF A BLDL PARAMETER LIST IS THE NUMBER OF       63550037
*   ENTRIES THAT FOLLOW AND THE NEXT TWO BYTES SHOW THE LENGTH OF       63560037
*   EACH ENTRY.   IT MUST BE LONG ENOUGH FOR A 'LOAD' MACRO,  BUT       63570037
*   NOT LONG ENOUGH TO OVERLAY OUR IMAGELIB DCB ADDRESS.                63580037
BLDLCNST DC    0CL4' ',YL2(1),YL2(DXIMGDCB-(DXBLDL+4))         @ZA01357 63600037
FCBCONST DC    C'FCB2'                  PREFIX FOR FCB IMAGE NAMES      63700020
         EJECT                                                          63750002
*********************************************************************** 63760002
*  'GETMSG' SUBROUTINE                                           Y02072 63770002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 63780002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 63790002
*                                                                       63792002
*    INPUT TO THIS ROUTINE:                                      Y02072 63794002
*      REG 11 - MESSAGE NUMBER IN MSG CSECT                      Y02072 63796002
*      REG 13 - RETURN ADDRESS                                   Y02072 63798002
*                                                                       63798402
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 63798802
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 63799202
*      REG 1 - POINTER TO MESSAGE ENTRY IN THE MESSAGE CSECT     Y02072 63799602
*********************************************************************** 63799702
GETMSG   DS    0H                       ENTRY POINT, MSG ROUTINE Y02072 63799802
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 63799902
         LH    RWK2,0(RWK7,RWK5)        GET INDEX TO MESSAGE     Y02072 63833202
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 63843202
         USING MSGENTRY,RWK2                                     Y02072 63853202
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 63863202
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 63865202
*                                         ENTRY                  Y02072 63865602
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 63866002
         SR    RWK7,RWK7                PREPARE REGISTER FOR RET Y02072 63866402
         USING MSGTXTD,RWK3                                      Y02072 63866502
         IC    RWK7,MSGLNG              GET LEN OF MSG - 1       Y02072 63866602
         EX    RWK7,MVCINST             MOVE MESSAGE             Y02072 63877702
         BR    RWK6                     RETURN                   Y02072 63887702
MVCINST  MVC   MSGAREA(0),MSGTXT        EXECUTED BY EX INST      Y02072 63888102
         SPACE                                                          63898102
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 63900102
END      EQU   *                        END OF THIS MODULE       Y02072 64088102
*********************************************************************** 65600020
*                                                                       65700020
*   DSECT                                                               65800020
*                                                                       65900020
*********************************************************************** 66000020
*                                                                       66100020
         EJECT                                                          66150002
         IGGMSG                                                  Y02072 66160002
         EJECT                                                          66170002
         DCBD  DSORG=PS                                                 66200020
*                                                                       66300020
*********************************************************************** 66600020
*                                                                       66700020
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 66750003
         ORG   WTGIDTTR                                          Y02072 66800002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 66850002
FORCORE  DSECT                                                   Y02072 66900002
         ORG   REPLYLTH+52                                       S21092 66910021
RPLY     DS    20C                      MSG REPLY AREA           M0191  66920021
RPLYECB  DS    F                        ECB FOR WTOR EXCP        M0191  66930021
MCSMASK  DS    H                        MASK FOR MCS             M0191  66940021
LOMASK   DS    8C                       MASK FOR LOWER CASE RPLY M0191  66950021
UCSID    DS    4C                       ID OF UCS IMAGE          M0191  66960021
         ORG   MSGLSTSZ                                          Y02072 66970002
MSGAREA  DS    0CL64                    AREA TO MOVE 64 BYTES    Y02072 66980002
*                                         TO FOR WTO/WTOR'S      Y02072 66990002
         IGGSCW                                                  Y02072 66992002
         EJECT                                                          66994002
         IHAFCAUD  ORG=YES                                       YM4697 66996002
         EJECT                                                          66998002
*                                                                       67000020
*********************************************************************** 67100020
*                                                                       67200020
SRT      DSECT                                                          67300020
         IEFUCBOB                                                       67400020
*                                                                       67500020
*********************************************************************** 67600020
*                                                                       67700020
CVT      DSECT                                                          67800020
         CVT                                                            67900020
*                                                                       68000020
***                                                                     68100020
*                                                                       68200020
*   DSECT FOR DEB                                                       68204020
*                                                                       68208020
*********************************************************************** 68212020
*                                                                       68216020
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          68220020
DEB      DSECT                                                          68224020
DEBNMSUB DS    0CL1                                                     68228020
DEBTCBAD DS    CL4                                                      68232020
DEBAMLNG DS    0CL1                                                     68236020
DEBDEBAD DS    CL4                                                      68240020
DEBOFLGS DS    0CL1                                                     68244020
DEBIRBAD DS    CL4                                                      68248020
DEBOPATB DS    0CL1                                                     68252020
DEBSYSPG DS    CL4                                                      68256020
DEBNMEXT DS    0CL1                                                     68260020
DEBUSRPG DS    CL4                                                      68264020
DEBPRIOR DS    0CL1                                                     68268020
DEBECBAD DS    CL4                                                      68272020
DEBPROTG DS    0CL1                                                     68276020
DEBDEBID DS    0CL1                                                     68280020
DEBDCBAD DS    CL4                                                      68284020
DEBEXSCL DS    0CL1                                                     68288020
DEBAPPAD DS    CL4                                                      68292020
DEBDVMOD DS    0CL1                                                     68296020
DEBUCBAD DS    CL4                                                      68300020
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     68304020
DEBBINUM DS    CL2                                                      68308020
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   68312020
DEBSTRCC DS    CL2                                                      68316020
DEBSTRHH DS    CL2                                                      68320020
DEBENDCC DS    CL2                                                      68324020
DEBENDHH DS    CL2                                                      68328020
DEBNMTRK DS    CL2                                                      68332020
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          68336020
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              68340020
DEBVOLSQ DS    H                                                        68344020
DEBVOLNM DS    H                                                        68348020
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     68352020
DEBSUBID DS    H                                                        68356020
*                                                                       68360020
         END                                                            68364020
*                                                                       68400020
DEB      DSECT                                                          68500020
DEBUCBAD DS    CL4                      ONLY PARAMETER NED FROM DEB     68600020
         END                                                            68700020
./  ADD  SSI=80230281,NAME=IGG0197F
         TITLE   'IGG0197F - FCB EXECUTOR, VERIFIES FCB '        M0099  00030021
IGG0197F CSECT                                                          00060021
*MODULE NAME - IGG0197F                                          Y02072 00070002
*                                                                       00072002
*DESCRIPTIVE NAME - VERIFY FCB                                   Y02072 00074002
*                                                                       00076002
*COPYRIGHT - NONE                                                Y02072 00078002
*                                                                       00078402
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00078802
*                                                                       00079202
*                 RELEASE 21 DELETIONS                                  00080021
*1060157200,110500,186300,460350,46084-481000,632800             M1803  00082021
*                                                                M0099  00090021
*1060463000                                                      S21092 00150021
*1060662200-662600                                               M0191  00160021
*                                                                       00160402
*                 VS1 RELEASE 2 DELETIONS                               00160802
*                                                                XM2963 00161202
*                                                                       00162002
*                 VS2 RELEASE 2 DELETIONS                               00164002
*000500,001800,029000,047000,093200-093600,176500,242600,        Y02072 00166002
*243500-244400,265400,278600,279800,280400,281000,282800,285200, Y02072 00168002
*291200,295400,296000,300200,303200,304400,309800,312800,319400, Y02072 00168402
*380000,381000,386000-388000,419000-421000,499000,526050-526800, Y02072 00168802
*542070-542840,579000,613000-626000,642000,644000,593000,597000  Y02072 00169202
*500000,612000                                                   Y02072 00169602
*                                                                YM2424 00169702
*                                                                YM4697 00169802
*                                                                YM5708 00169902
*                                                                YM5923 00173202
*                                                                       00175203
*                 VS2 RELEASE 3 DELETIONS                               00175603
*                                                              @Z30TSCF 00176003
*A245000,405610,405620,407410,407420                           @AZ07594 00176137
*C304560,405000,406200,406800,408000                           @AZ07594 00176237
*D315200-320600                                                @AZ07594 00176337
*C229000                                                       @ZA09661 00176437
*A277410                                                       @ZA10220 00176537
*C186400,441600,441960                                         @ZA12979 00177237
*A190010,190020,440601,440602                                  @ZA12979 00177937
*D441300,441400                                                @ZA12979 00178637
*C174500,174560,205000                                         @ZA25668 00178837
*A205100                                                       @ZA25668 00178937
*A281570,281590                                                @ZA25088 00179337
*C174500,174560,281580                                         @ZA25088 00179537
*C174500,174560                                                @ZA29359 00179737
*A190040-190160                                                @ZA29359 00179837
*STATUS CHANGE LEVEL 002                                                00180002
*                                                                       00190001
*FUNCTION/OPERATION - TO CONSTRUCT AND EXECUTE A CHANNEL PROGRAM WHICH  00200020
*                     LOADS THE FCB.                                    00300020
*                   - PRINT OUT FCB IMAGE FOR VISUAL VERIFICATION AND   00400020
*                     ISSUE MESSAGE IEC128D VERIFY FORMS ALIGNMENT:AND  00500020
*                     ANALIZE OPERATOR REPLY WHEN REQUIRED              00600020
*                   - ISSUE IEC128 MESSAGE WITH OUT VERIFYING FCB IMAGE 00700020
*                     WHEN REQUIRED                                     00800020
*                   - DELETE ANY FCB IMAGE LOADED                       00850002
*                   - CLOSE SYS1.IMAGELIB                               00860002
*                   - RESET AUDIT TRAIL BITS INDICATING FCB      YM4697 00870002
*                     IMAGE LOADED AND SYS1.IMAGELIB OPENED      YM4697 00880002
*                   - UPDATE UCB WITH CURRENT FCB ID AND OPTIONS        00900020
*                   - XCTL TO NEXT OPEN EXECUTOR                        01000020
*                                                                       01100020
*ENTRY POINTS - ENTERED FROM IGG0197E                                   01200002
*                                                                       01400020
*INPUTS - DCB ADDRESS                                                   01500020
*       - OPEN WORK AREA ADDRESS                                        01600020
*       - WHERE TO GO TABLE                                             01700020
*       - PARAMETER LIST                                                01800020
*       - CURRENT ENTRY IN WTG TABLE                                    01900020
*       - CURRENT PARAMETER (DCB)                                       02000020
*       - ADDRESS OF FCB IMAGE RETRIVED IN IGG0197E                     02130020
*       - ADDRESS OF SYS1.IMGLIB DCB IN OPEN WORKAREA(DXCCW8)           02160002
*                                                                       02200020
*OUTPUTS - FCB BUFFER LOAD                                              02300020
*        - PRINT OUT OF FCB IMAGE FOR VISUAL VERIFICATION               02400020
*        - MESSAGE TO OPERATOR TO VERIFY FORMS ALIGNMENT                02500002
*           'IEC128D V XXX,VERIFY FORMS ALIGNMENT'                      02600020
*        - UPDATED UCB WITH NEW FCB ID                                  02700020
*                                                                       02800020
*EXTERNAL REFERENCES - MESSAGE CSECT                             Y02072 02900002
*                                                                       03000020
*EXITS - NORMAL - XCTL TO ONE OF THE FOLLOWING OPEN EXECUTORS           03100020
*                 - IGG01911 IF DCB IS FOR EXCP                  Y02072 03150002
*                 - IGG0191I IF BUFFER CNTRL BLOCK IS SPECIFIED         03200020
*                 - IGG0191G IF NORMAL SCHEDULING IS SPECIFIED          03300020
*                 - IGG0191Q IF CHAINED SCHEDULING IS SPECIFIED         03400020
*                                                                       03500020
*EXITS - ERROR - ISSUE DMABCOND MACRO FOR ONE OF THE FOLLOWING   Y02072 03650002
*              - PERMANENT I/O ERROR OCCURED DURING FCB LOAD.           03700002
*              - OPERATOR CANCELED BECAUSE OF AN INCORRECT FCB IMAGE    03900002
*                OR UNABLE TO ALIGN FORMS.                              04000002
*              - IGG0197E SET ABEND FLAG FOR THIS EXECUTOR              04050002
*                                                                       04300020
*TABLES/WORK ARES - WHERE-TO-GO TABLE (SEE LISTING EXECUTOR IGG0191B)   04400020
*                 - OPEN WORK AREAS (IECDSECT)                          04500020
*                                                                       04600020
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 04700002
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 04750002
*                                                                       04760002
*MACROS-ACTION:MODESET, DMABCOND, EXCP, WAIT, DELETE, XCTL       Y02072 04770002
*                                                                       04790002
*MACROS-MAPPING:IGGMSG,IECDSECS(MAIN,WTG), DCBD, IEFUCBOB,IKJTCB Y02072 04792002
*               IHAFCAUD                                                04794002
*                                                                       04800020
*NOTES - EXCP/WAIT MACROS USED TO LOAD FCB                              04900020
*      - DELETE MACRO USED TO DELETE FCB IMAGE FROM CORE                05000020
*      - SVC 35 USED FOR WTOR (WRITE TO OPERATOR TO REQUEST REPLY)      05100020
*      - OPEN WORK AREA USED FOR IOB/ECB                                05200020
*      - LOWER CASE OPERATOR REPLYS ALLOWED                             05300020
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 05360002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 05370002
*                                                                       05400020
*********************************************************************** 05500020
*                                                                       05600020
*   REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN MODULES              05700020
*                                                                       05800020
*********************************************************************** 05900020
*                                                                       06000020
RE       EQU   0                        WORK/PARAMETER REGISTER         06100020
RWK1     EQU   RE                       WORK REGISTER            Y02072 06150002
RF       EQU   1                        WORK/PARAMETER REGISTER         06200020
RWK2     EQU   RF                       WORK REGISTER            Y02072 06250002
RDCB     EQU   2                        ADDRESS OF USER'S DCB           06300020
RBASE    EQU   3                        BASE REGISTER                   06400020
RCORE    EQU   4                        ADDRESS OF OPEN WORK AREA       06500020
RPAR     EQU   5                        PARAMETER LIST                  06600020
RBRNCH   EQU   RPAR                     BRANCHING REGISTER       Y02072 06650002
RWTG     EQU   6                        START OF WTG TABLE              06700020
RWK8     EQU   RWTG                     WORK REGISTER            Y02072 06750002
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 06800020
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      06900020
RTIOT    EQU   9                        TIOT ADDRESS/WORK REGISTER      07000020
RUCB     EQU   10                       UCB ADDRESS/WORK REGISTER       07100020
RDEB     EQU   11                       DEB ADDRESS                     07200020
RWK3     EQU   RDEB                     WORK REGISTER            Y02072 07250002
RB       EQU   12                       WORK REGISTER/BASE R FOR DSECT  07300020
RWK7     EQU   RB                       WORK REGISTER            Y02072 07350002
RC       EQU   13                       WORK REGISTER                   07400020
RD       EQU   14                       WORK/PARAMETER REGISTER         07500020
RJ       EQU   15                       WORK/PARAMETER REGISTER         07600020
RWK6     EQU   RJ                       WORK REGISTER            Y02072 07650002
*                                                                       07700020
*********************************************************************** 07800020
*                                                                       07900020
*   WTG OFFSET EQUATES                                                  08000020
*                                                                       08100020
*********************************************************************** 08200020
*                                                                       08300020
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   08400020
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   08500020
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TAB  08600020
*                                                                       08700020
*********************************************************************** 08800020
*                                                                       08900020
*   GENERAL EQUATES                                                     09000020
*                                                                       09100020
*********************************************************************** 09200020
*                                                                       09300020
VERFYSWT EQU   X'01'                    ENTRY IS FOR VERIFY ONLY SWITCH 09400020
ABEND    EQU   X'FF'                   ABEND RETURN CODE SWITCH         09500020
ALIGNSWT EQU   X'04'                    ENTRY IS FOR ALIGN FORMS SWITCH 09600020
NRETRYS  EQU   X'01'                    NUMBER OF TIMES TRY TO LOAD FCB 09700020
FCBLDCC  EQU   X'63'                    COMMAND CODE=LOAD FCB           09800020
UNRLMASK EQU   X'02'                    IOB IS UNRELATED                09900020
BSTFCBIM EQU   X'02'                    BYTES TO START OF FCB IMAGE     10000020
FCBLTHOS EQU   X'01'                    FCB IMAGE LENGTH OFFSET         10100020
SUCCFLCC EQU   X'7F'                    SUCCESSFUL COMPLETION CODE      10200020
LNIEC124 EQU   X'30'                    LENGTH OF IEC124 MESSAGE        10300020
PERMIOER EQU   X'0C'                    RETURN CODE=PERMANENT I/O ERROR 10400020
ABENDBIT EQU   X'80'                    ABEND IN PROCESS MASK           10500020
ABCDB13  EQU   X'B13'                   COMPLETION CODE=B13 (OPEN-1403) 10600020
VERFYMSK EQU   X'40'                    FCB OPTION BITS = VERIFY        10700020
ALIGNMSK EQU   X'80'                    FCB OPTION BITS = ALIGN FORMS   10800020
SILICCMK EQU   X'60'                    MASK TO SET SILI + C.C.FLAGS    10900020
SKIPCH1  EQU   X'8B'                    COMMAND CODE=SKIP TO CHANNEL 1  11000020
STGETWO  EQU   X'C7'                    ENTRY FLAG                M1803 11050021
WTSKP2   EQU   X'11'                    COMMAND CODE=WRITE + SPACE 2    11100020
WTSKP1   EQU   X'09'                    COMMAND CODE=WRITE + SPACE 1    11200020
HDLENGTH EQU   X'34'                    HEADING LENGTH                  11300020
SILIMASK EQU   X'20'                    MASK TO SET SILI FLAG           11400020
LPIEQ8   EQU   X'10'                    8 LINES/INCH SPACEING           11500020
UBLKDCMK EQU   X'40'                    UNBLOCK DATA CHECK MASK         11600020
UNRLBMSK EQU   X'42'                    UNRELATED BIT MASK              11700020
PRTLNLTH EQU   X'84'                    LENGTH OF VERIFICATION LINE     11800020
NUMBMASK EQU   X'F0'                    MASK TO CONVERT TO NUMERIC      11900020
ENDMARK  EQU   X'10'                    END OF FCB IMAGE INDICATOR      12100020
BLDLLOAD EQU   X'D3'                    FLAG FOR FCB LOADED INTO CORE   12200020
DELENDMK EQU   X'0F'                    DELETE END MARKER MASK          12300020
UCBUCSOF EQU   X'00'                    UCS OFFSET IN UCB WORK AREA     12400020
UCSOPOFS EQU   X'04'                    UCS OPTIONS OFFSET              12500020
UCBFCBOF EQU   X'08'                    FCB OFFSET IN UCB WORK AREA     12600020
FCBOPTNS EQU   X'05'                    FCB OPTIONS OFFSET              12700020
CMDRTYMK EQU   X'80'                    COMMAND RETRY MASK              12800020
BUFPARMK EQU   X'04'                    BUFFER PARITY MASK              12900020
BUFPARER EQU   X'01'                    UCS OPTIONS BUFFER PARITY ER    13000020
SKPCH0CD EQU   X'83'                    SKIP TO CH 0 COMMAND CODE       13100020
EXCPMASK EQU   X'80'                    OPTCD = EXCP                    13200020
PCIMASK EQU    X'20'                    OPTCD=PCI                       13300020
BFCNTRL  EQU   X'01'                    BUFFER CONTRL BLOCK FLAG        13400020
LNTH1STL EQU   X'2D'                    LENGTH OF VERIFICATION HEADING  13450020
IOERROR  EQU   X'10'                    I/O ERROR DURING FCB VERFIFCATN 13500020
IMCLOSED EQU   X'FF'                    FLAG SET FOR IMAGELIB NOT OPEN  13550020
SIX      EQU   C'6'                                                     13600020
NULL     EQU   X'00'                                                    13700020
BLANK    EQU   X'40'                                                    13800020
ONEMASK  EQU   X'01'                                                    13900020
THREE    EQU   X'03'                                                    14000020
FOURMASK EQU   X'04'                                                    14100020
TWO      EQU   X'02'                                                    14200020
FIVE     EQU   X'05'                                                    14300020
K27      EQU   X'1B'                                                    14400020
K20      EQU   X'14'                    LENGTH PRT LINE                 14500020
K23      EQU   X'17'                    LENGTH LAST VERIF LINE          14600020
K1       EQU   1                                                        14660020
K41      EQU   X'28'                                                    14730020
SIXC     EQU   X'06'                                                    14800020
EIGHT    EQU   C'8'                                                     14900020
SEVENMSK EQU   X'07'                                                    15000020
EIGHTMSK EQU   X'08'                                                    15100020
NINEMASK EQU   X'09'                                                    15200020
TENMASK  EQU   X'0A'                    VERIFICATION FLAG               15300020
FOURTNMK EQU   X'14'                    CONSTANT OF X'14'               15400020
DISP159  EQU   X'9F'                    CONSTANT OF 159                 15500020
ENDI     EQU   X'C5'                                                    15560020
VFYLNTH2 EQU   X'13'                                                    15590020
K17      EQU   X'11'                    CHANNEL CODE DISPLACEMENT       15620020
*                                       IN FCB VERIFY LINE              15650020
PRT2245  EQU   X'0B'                    MASK FOR 2245 PRINTER    S21092 15680021
OABD089  EQU   89                                                M0099  15690021
OABD090  EQU   90                                                M0099  15700021
IOBUNCHK EQU   X'02'                    TO TEST UNIT CHK IN CSW  Y02072 15750002
CLEARBYT EQU   X'00'                    TO CLEAR A BYTE          Y02072 15760002
LNCHCODE EQU   2                        LENGTH OF A CHAN CODE    Y02072 15770002
LNGNUM   EQU   3                        LENGTH OF 3 DIGIT NUMBER Y02072 15780002
LPI8     EQU   C'8'                     EIGHT LINES/INCH         Y02072 15790002
LPI6     EQU   C'6'                     SIX LINES/INCH           Y02072 15792002
FCBIMLNG EQU   4                        LENGTH OF FCB IMAGE NAME Y02072 15794002
*                                                                       15794402
*  THE FOLLOWING MESSAGES NUMBERS ARE EQUAL TO THEIR POSITION    Y02072 15794802
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 15795202
*  OF AN INDEX).                                                 Y02072 15795602
*                                                                       15795702
HEADING  EQU   16*2                     MESSAGE NO IN MSG CSECT  Y02072 15796002
MSG128   EQU   15*2                     MESSAGE NO IN MSG CSECT  Y02072 15798002
MSG125   EQU   9*2                      MESSAGE NO IN MSG CSECT  Y02072 15798402
INSERT1  EQU   18*2                     MESSAGE NO IN MSG CSECT  Y02072 15799602
INSERT2  EQU   20*2                     MESSAGE NO IN MSG CSECT  Y02072 15849802
         EJECT                                                          15859802
*                                                                       15874902
*********************************************************************** 15900020
*                                                                       16000020
*   INITIALIZE REGISTERS                                                16100020
*                                                                       16200020
*********************************************************************** 16300020
*                                                                       16400020
         BALR  RBASE,0                  SET UP BASE REGISTER            16500020
         USING FCB2010,RBASE                                            16600020
         USING IHADCB,RDCB                                              16700020
         USING FORCORE,RCORE                                            16800020
         USING DEB,RDEB                                                 16900020
         USING UCBOB,RUCB                                               17000020
*                                                                       17100020
FCB2010  EQU   *                                                        17200020
*                                                                       17300020
         B     AROUND                   BR AROUND CONSTANTS      Y02072 17350002
         DC    C'IGG0197F'              MODULE NAME              Y02072 17400002
         DC    C'@ZA29359'              LAST SHIP CODE         @ZA29359 17450037
         DC    C'01/20/78'              LAST DATE MODIFIED     @ZA29359 17456037
AROUND   DS    0H                                                Y02072 17470002
*                                                                       17480002
         L     RDCB,0(RPARC)            LOAD CURRENT DCB ADDRESS        17500020
         L     RCORE,4(RWTGC)           LOAD CURRENT WORK AREA ADDRESS  17600020
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS                17700020
         L     RUCB,DEBUCBAD            LOAD UCB ADDRESS                17800020
         DROP  RDEB                                              Y02072 17850002
         STM   RBRNCH,RWK8,DXREGSV2     SAVE REGS                Y02072 17870002
*                                                                       17900020
*********************************************************************** 18000020
*                                                                       18100020
*   CK FCB OPTION BITS FOR VERIFY OR ALIGN FORMS                        18200020
*                                                                       18300020
*********************************************************************** 18400020
*                                                                       18500020
FCB2060  EQU   *                                                        18600020
*                                                                       18610020
         MVI   ENDINDIC,CLEARBYT        INITIALIZE SWITCH        Y02072 18612002
         CLI   DXSTAGE2,STGETWO         ENTRY TO FIND SECOND     Y02072 18622002
*                                          STAGE EXECUTOR?       M1803  18632021
         BE    FCB2215                  YES, DELETE FCB IMAGE  @ZA12979 18640037
         CLI   DXFCBOPT,VERFYMSK        CK IF FCB IMAGE IS TO    Y02072 18650002
*                                         BE VERIFIED            Y02072 18660002
         BE    FCB2070                  YES GO PRINT OUT VERIFICATION   18760020
*                                       AND ISSUE ALIGN FORMS MESSAGE   18840020
         CLI   DXFCBOPT,ALIGNMSK        CK IF FCB OPT = ALIGN    Y02072 18890002
         BE    FCB2180                  YES GO ALIGN FORMS              19000020
*                                                                       19002037
         LA    RDEB,FCB2061             LOAD RETURN ADDRESS    @ZA29359 19004037
         SR    RC,RC                    CLEAR REG              @ZA29359 19006037
         L     RC,UCBXTADR              LOAD UCB EXTENSION     @ZA29359 19008037
         CLC   8(4,RC),DXCCW10+4        LOADED FCB = REQST FCB @ZA29359 19010037
         BE    FCB2072                  YES-GO SKIP TO CHAN 1  @ZA29359 19012037
*                                                                       19014037
FCB2061  EQU   *                                               @ZA29359 19016037
         CLI   DXSTAGE2,ABEND           B13 ABEND REQUESTED?   @ZA12979 19020037
         BNE   FCB2210                  NO - BRANCH            @ZA12979 19040037
*                                                                       19080020
FCB2065  EQU   *                                                        19400020
*                                                                       19500020
*********************************************************************** 19600020
*                                                                       19700020
*   UP DATE UCB FIELDS FOR FCB ID AND FCB OPTIONS TO SHOW FCB NOT       19800020
*   USABLE  AND DELETE FCB IMAGE LOADED BY IGG0197E                     19900020
*                                                                       20000020
*********************************************************************** 20100020
*                                                                       20200020
*                                                                       20300020
         L     RJ,UCBXTADR              LOAD ADDRESS OF UCB EXTENTION   20400020
         MODESET  EXTKEY=SUPR           KEY 0 TO STORE IN UCB    Y02072 20450002
         XC    UCBFCBOF(4,RJ),UCBFCBOF(RJ) ZERO OUT FCB ID     @ZA25668 20500037
         XC    FCBOPTNS(1,RJ),FCBOPTNS(RJ) ZERO FCB OPTIONS    @ZA25668 20510037
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 20550002
         SPACE                                                          20560002
         TM    FCAOPEN2,FCAOFCBL        CK IF 197E LOADED FCB    YM4697 20570002
*                                       IMAGE                           20700020
         BZ    FCB2066                  NO FCB LOADED GO ABEND   YM4697 20800002
*                                       YES FALL THROUGH TO DELETE      20900020
*                                       FCB IMAGE LOADED                21000020
         LA    RE,DXSAVFCB              GET ADDR OF FCB IMAGE ID Y02072 21050002
*                                                                       21200020
         DELETE EPLOC=(0)               ISSUE DELETE MACRO              21300020
         NI    FCAOPEN2,X'FF'-FCAOFCBL  INDIC FCB IMAGE DELETED  YM4697 21350002
*                                                                       21400020
*********************************************************************** 21500020
*                                                                       21600020
*   ABEND ROUTINE. SET COMPLETION CODE=B13. PUT RETURN CODE IN REG.15   21700020
*                                                                       21800020
*********************************************************************** 21900020
*                                                                       22000020
FCB2066  EQU   *                                                        22100020
*                                                                       22200020
         TM    DXNABEND,ABENDBIT        CK IF ABEND IN PROCESS   Y02072 22250002
         BO    FCB2220                  YES GO TO NEXT EXECUTOR         22400020
         LM    RPAR,RWTG,DXREGSV2       RELOAD REGS FOR PROB DET YM2424 22450002
         SR    RE,RE                    ZERO REG 0               M0099  22500021
         IC    RE,DXFCBOPT              PUT INTERNAL CODE INTO   Y02072 22550002
*                                       REG 0                    M0099  22700021
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,                 M0099 X22800021
               REGSAVE=NO               CALL PROBLEM           @ZA09661 22900037
*                                       DETERMINATION            M0099  23000021
         B     FCB2300                                           M0099  23100021
*                                                                       23300020
*                                                                       23400020
*********************************************************************** 23500020
*                                                                       23600020
*   PRINT OUT HEADING AND VERIFICATION LINES FOR FCB IMAGE              23700020
*                                                                       23800020
*********************************************************************** 23900020
FCB2070  EQU   *                                                        23960020
*                                                                       24020020
*********************************************************************** 24030021
*                                                                       24040021
         CLI   UCBTBYT4,PRT2245        CHECK FOR 2245 PRINTER    S21092 24050021
         BE    FCB2180                 YES, GO TO ALIGN FORMS    S21092 24060021
         USING FCBIMBEG,RWK7                                     XM2963 24110002
*                                                                       24120002
*  MUST BE IN KEY 0 BECAUSE FCB IMAGE COULD BE IN EITHER USER    YM5708 24130002
*  KEY OR KEY 0.                                                 YM5708 24140002
*                                                                       24150002
         SPACE                                                          24160002
         MODESET  EXTKEY=SUPR           GET INTO KEY 0           YM5708 24170002
         SPACE                                                          24180002
         LA    RD,FCBLNPIN              SET FCB IM PTR TO START  XM2963 24200002
*                                         OF IMAGE               XM2963 24210002
         TM    FCBINDEX,FCBRGTIN+FCBLFTIN  IS INDEXING BEING     XM2963 24220002
*                                            USED                XM2963 24230002
         BZ    FCB2071                  NO, RD HAS CORRECT ADDR  XM2963 24240002
         LA    RD,FCBLNPN1              YES, REINIT RD           XM2963 24242002
FCB2071  EQU   *                                                 XM2963 24244002
         SPACE                                                          24244402
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MAN KEY     YM5708 24244802
         SPACE                                                          24245202
         DROP  RWK7                                              XM2963 24246002
         ST    RWK7,DXREGSV1            SAVE IMAGE ADDRESS       Y02072 24250002
         LA    RBRNCH,FCB2078           GET ADDRESS OF INIT      Y02072 24260002
*                                       ROUTINE FOR FCB VERIFICATION    24320020
         B     FCB2078                                         @AZ07594 24500037
FCB2072  EQU   *                                                        24560020
*                                                                       24620020
         MVC   DXCCW1(EIGHTMSK),SKIP0CCW SET UP SKIP TO CHANNEL 1 CCW   24680020
         MVI   DXCCW1,SKIPCH1           SET COMMAND CODE=SKIP CH 1      24740020
*                                                                       24800020
*                                                                       24860020
FCB2073  EQU   *                                                        24920020
*                                                                       24980020
*                                                                       25040020
         LA    RF,DXIOB                 GET ADDR IOB IN REG 1           25160020
*                                                                       25220020
         EXCP  (1)                      ISSUE SKIP TO CH 1              25280020
*                                                                       25340020
         WAIT  ECB=DXECB                WAIT ON I/O              M0099  25440021
*                                                                       25580020
*                                                                       25640020
FCB2074  EQU   *                                                        25700020
*                                                                       25760020
         LTR   RD,RD                   CK IF REG 14 = 0                 25820001
         BZR   RBRNCH                  IF SO GO TO ADD IN REG 11 Y02072 26020002
         CLI   DXECB,SUCCFLCC           CK FOR SUCCESSFUL COMPLETION    26300020
         BNE   FCB2114                  NO GO SET CODE FOR PERM ERROR   26360020
*                                       DURING VERIFICATION             26420020
*                                                                       26480020
         BR    RBRNCH                   GO TO ADDRESS IN REG 11  Y02072 26540002
*                                                                       26600020
*                                                                       26660020
*                                                                       26720020
FCB2078  EQU   *                                                        26780020
*                                                                       26840020
*                                                                       26900020
*                                                                       26960020
*   INITIALIZE REGISTERS FOR VERIFICATION                               27020020
*   -RB  CONTAINS ADDRESS FCB IMAGE                                     27080020
*   -RTIOT CONTAINS LINE NUMBER                                         27140020
*   -RD    CONTAINS POINTER TO ENTRY IN FCB IMAGE                       27200020
*                                                                       27260020
         LA    RTIOT,ONEMASK            SET LINE COUNTER                27320020
*                                                                       27380020
*   FORM CCW TO PRINT LINES OF VERIFICATION                             27440020
*                                                                       27500020
         LA    RJ,MSGLSTSZ              GET ADDRESS OF PRINT LINE       27620020
         ST    RJ,DXCCW1                STORE ADD OF PRT LINE IN CCW    27680020
         MVI   DXCCW1,WTSKP1            SET COMMAND CODE TO PRT+SPACE 1 27740020
         MVI   DXCCW1+FOURMASK,SILIMASK SET THE SILI BIT       @ZA10220 27770037
*                                                                       27800020
* EXTRACT FCB VERIFICATION HEADING FROM THE MESSAGE CSECT        Y02072 27860002
*                                                                       27920020
         LA    RWK3,HEADING             MESSAGE NO FOR MSG RTN   Y02072 27970002
         BAL   RWK6,GETMSG              GO GET MSG TEXT          Y02072 28020002
FCB2079  EQU   *                                                 Y02072 28120002
         USING MSGTXTD,RWK3                                      Y02072 28122002
         USING MSGENTRY,RWK2                                     Y02072 28122402
         IC    RWK7,MSGLNG              LEN OF LINE - 1          Y02072 28122802
         EX    RWK7,MOVELINE            MOVE LINE TO BUFFER      Y02072 28122902
         LA    RWK7,1(RWK7)             TOTAL NUM OF BYT TO PRNT Y02072 28123202
         STC   RWK7,DXCCW1+7            LEN TO CCW               Y02072 28123602
         LR    RWK8,RWK2                SAVE ADDR OF HEADING TXT Y02072 28126002
*                                         IN MSG CSECT           Y02072 28128002
*                                                                       28128402
* FILL IN VARIABLE FIELDS OF THE HEADING                         Y02072 28128802
*                                                                       28129202
         IC    RWK7,MSGOFF5             OFFSET TO VAR FLD FIVE   Y02072 28130002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD FIVE  Y02072 28140002
         MVC   0(FCBIMLNG,RWK3),DXFCBID  FCB IMAGE TO MSG        Y02072 28142002
         IC    RWK7,MSGOFF6             OFFSET TO VAR MSG SIX    Y02072 28152002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD SIX   Y02072 28154002
         MVI   0(RWK3),LPI6             ASSUME 6 LINES/INCH      Y02072 28156002
         MODESET  EXTKEY=SUPR           GET INTO KEY ZERO      @ZA25088 28160037
         TM    0(RD),X'10'              TEST IF SPACING= 8 LPI @ZA25088 28170037
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MGT KEY   @ZA25088 28180037
         BNO   FCB2090                  IF NOT GO TRASLATE       Y02072 28220002
*                                         CHANNEL CODE           Y02072 28230002
         MVI   0(RWK3),LPI8             IMAGE 8 LINES/INCH       Y02072 28270002
         DROP  RWK3                                              Y02072 28330002
*                                                                       28640020
*    CONVERT LINE NUMBER AND INSERT INTO PRINT LINE                     28700020
*                                                                       28760020
FCB2090  EQU   *                                                        28820020
*                                                                       28880020
         CVD   RTIOT,DXCCW2             CONVERT LINE # TO DECIMAL       28940020
         UNPK  DXCCW2(FOURMASK),DXCCW2+SIXC(TWO) UNPACK LINE NUMBER     29000020
         OI    DXCCW2+THREE,NUMBMASK    MASK OUT SIGN                   29060020
         IC    RWK7,MSGOFF1             OFFSET TO VAR FLD ONE    Y02072 29160002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD ONE   Y02072 29172002
         MVC   0(LNGNUM,RWK3),NUMNXTLN  NUMBER OF THE NEXT PRINT Y02072 29174002
*                                         LINE                   Y02072 29176002
*                                                                       29180020
*    TRANSLATE CHANNEL CODE TO CHARACTER FORM AND ADD TO PRINT LINE     29240020
*    GET INTO KEY 0 AS IMAGE COULD BE IN USER KEY OR KEY 0.      Y02072 29290002
*                                                                       29300020
         MODESET  EXTKEY=SUPR                                    Y02072 29350002
*                                                                       29352002
*                                                                       29354002
         IC    RC,NULL(RD)              GET CHANNEL CODE                29360020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 29362002
         SPACE                                                          29364002
         N     RC,LFTHFOFF              TURN LEFT HALF OF BYTE   Y02072 29370002
*                                         OFF                    Y02072 29380002
         BNZ   FCB2095                  GO TRANSLATE CHAN CODE   Y02072 29480002
*                                         IF NOT ZERO            Y02072 29490002
*                                                                       29530002
* MUST BLANK OUT THE CHANNEL FIELD                               Y02072 29540002
*                                                                       29550002
         IC    RWK7,MSGOFF2             OFFSET TO VAR FLD TWO    Y02072 29580002
         LA    RWK3,MSGAREA(RWK7)       ADDR OF VAR FLD TWO      Y02072 29630002
*                                                                       29630402
* GET THE LENGTH OF THE CHANNEL FIELD BY GETTING THE LENGTH      Y02072 29630802
* OF INSERT 2 AND ADDING THE LENGTH OF THE CHANNEL CODE TO IT.   Y02072 29630902
* (THIS INSERT IS USED IN THE CHANNEL FIELD WHEN A CHANNEL CODE  Y02072 29631002
* IS PRESENT).                                                   Y02072 29631102
*                                                                       29631202
         LR    RWK1,RWK3                SAVE ADD OF FLD TO BLANK Y02072 29632002
         LA    RWK3,INSERT2             MSG NUM OF FLD TO BLANK  Y02072 29634002
         BAL   RWK6,GETMSG              GET MSG TO GET LENGTH    Y02072 29636002
         IC    RWK7,MSGLNG              LENTH OF INSERT - 1      Y02072 29638002
         LA    RWK7,LNCHCODE(RWK7)      LNG OF FIELD TO CLEAR    Y02072 29638402
         LR    RWK2,RWK1                RESTORE ADDR OF VAR FLD  Y02072 29638802
         MVI   0(RWK2),BLANK            BEGIN TO CLEAR FIELD     Y02072 29640002
         EX    RWK7,MVBLANK             CLEAR FIELD              Y02072 29650002
         B     FCB2100                  GO PRT A LINE OF VERIFICATION   29660020
MVBLANK  MVC   1(0,RWK2),0(RWK2)        INST TO PROP A BYTE      Y02072 29710002
         USING MSGTXTD,RWK3                                      Y02072 29710402
MOVELINE MVC   MSGAREA(0),MSGTXT        MOVE LINE TO BUFFER      Y02072 29712002
         DROP  RWK3                                                     29714002
*                                                                       29720020
FCB2095  EQU   *                                                        29780020
*                                                                       29840020
* PUT THE CHANNEL CODE IN THE PRINT LINE                         Y02072 29890002
*                                                                       29892002
         SLL   RC,ONEMASK               MUTIPLY CHANNEL CODE BY 2       29900020
         LA    RJ,DXCCW3(RC)            GET ADDRESS OF CHANNEL CODE     29960020
         IC    RWK7,MSGOFF3             OFFSET TO VAR FLD THREE  Y02072 30060002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD THREE Y02072 30070002
         MVC   0(LNCHCODE,RWK3),0(RJ)   CHAN CODE TO MESSAGE     Y02072 30072002
*                                                                       30080020
FCB2100  EQU   *                                                        30140020
*                                                                       30200020
*                                                                       30260020
         BAL   RBRNCH,FCB2073           GO ISSUE EXCP AND WAIT   Y02072 30320002
*                                                                       30380020
*                                                                       30432002
* TEST FOR THE LAST PRINT LINE                                   Y02072 30434002
*                                                                       30436002
         TM    ENDINDIC,ENDMARK         TEST FOR LAST LINE       Y02072 30446002
         BO    FCB2180                  GO TO MSG 'IEC128D'    @AZ07594 30456037
         USING MSGENTRY,RWK8                                     Y02072 30470002
*                                                                       30470402
* USE OFFSET TO VAR FLD 4 AS LENGTH OF LINE TO PRINT. LENGTH     Y02072 30470802
* WILL BE 1 BYTE TOO MANY.                                       Y02072 30471202
*                                                                       30471602
         IC    RWK7,MSGOFF4             OFFSET TO VAR FLD FOUR   Y02072 30472002
         BCTR  RWK7,0                   DECREMENT COUNT          Y02072 30522002
         STC   RWK7,DXCCW1+7            BYTE COUNT TO CCW        Y02072 30532002
*                                                                       30560020
*   SET REGISTERS TO PRINT NEXT LINE OF VERIFICATION                    30620020
*                                                                       30680020
         LA    RTIOT,ONEMASK(RTIOT)     INCREMENT LINE COUNTER          30740020
         LA    RD,ONEMASK(RD)           INCREMENT LINE POINTER TO       30860020
*                                       NEXT POSITION OF FCB IMAGE      30920020
*                                                                       30930002
* FILL IN THE CHANNEL FIELD                                      Y02072 30940002
*                                                                       30950002
         IC    RWK7,MSGOFF2             OFFSET TO VAR FLD TWO    Y02072 30970002
         LA    RWK1,MSGAREA(RWK7)       ADDR OF VAR FLD TWO      Y02072 30972002
         DROP  RWK8                                              Y02072 30974002
         LA    RWK3,INSERT2             MSG NUM IN MSG CSECT     Y02072 30976002
         BAL   RWK6,GETMSG              GET INSERT FOR HEADING   Y02072 31026002
         USING MSGENTRY,RWK2                                     Y02072 31028002
         IC    RWK7,MSGLNG              LNG OF INSERT - 1        Y02072 31028402
         LR    RWK6,RWK1                ADDR OF VAR FIELD        Y02072 31030002
         EX    RWK7,MVCINST             MOVE IN INSERT           Y02072 31030402
         LR    RWK2,RWK8                ADDR OF MSG IN CSECT     Y02072 31032402
         SPACE                                                          31034402
         MODESET  EXTKEY=SUPR                                    YM5923 31036402
         SPACE                                                          31038402
         TM    0(RD),ENDMARK            CK FOR END OF FCB IMAGE FLAG    31040002
         BNO   FCB2090                  NO GO TO FORM NEXT PRINT LINE   31090002
*                                       YES SET FOR LAST LINE OF VFY    31140002
         SPACE                                                          31190002
         MODESET  EXTKEY=DATAMGT                                 YM5923 31240002
         SPACE                                                          31250002
*  SET LENGTH FOR LAST LINE                                      Y02072 31270002
*  THE LENGTH OF THE LAST LINE IS CALCULATED BY ADDING LENGTH    Y02072 31280002
*  OF THE END INDICATOR TO VAR OFFSET 4.                         Y02072 31290002
*                                                                       31320002
         LA    RWK3,INSERT1             INDEX TO END INDICATOR   Y02072 31370002
         BAL   RWK6,GETMSG              GO GET THE END INDICATOR Y02072 31380002
         IC    RWK7,MSGLNG              LEN - 1 OF END INDIC     Y02072 31382002
         LA    RWK1,1(RWK7)             SAVE TOT LEN, END INDIC  Y02072 31384002
         USING MSGENTRY,RWK8                                     Y02072 31390002
         IC    RWK7,MSGOFF4             OFFSET TO VAR FLD        Y02072 31392002
         AR    RWK1,RWK7                TOTAL LEN OF LAST LINE   Y02072 31392402
         STH   RWK1,DXCCW1+6            BYTE COUNT TO CCW        Y02072 31392802
         LA    RWK6,MSGAREA(RWK7)       ADDR OF VAR FIELD        Y02072 31394002
         DROP  RWK8                                              Y02072 31398402
*                                                                       31398502
*  MOVE END INDICATOR TO THE LAST PRINT LINE                     Y02072 31398602
*                                                                       31398702
         USING MSGENTRY,RWK2                                     Y02072 31398802
         IC    RWK7,MSGLNG              LENGTH OF INSERT - 1     Y02072 31399202
         EX    RWK7,MVCINST             INSERT TO PRINT LINE     Y02072 31399602
         OI    ENDINDIC,ENDMARK         SET LAST LINE TO PRINT   Y02072 31399702
         LR    RWK2,RWK8                FOR ADDRESSABILITY TO    Y02072 31399802
*                                         VAR FIELDS IN HEADING  Y02072 31399902
         B     FCB2090                  GO CONVERT LINE NO       Y02072 31400002
MVCINST  MVC   0(0,RWK6),0(RWK3)        TO MOVE INSERT INTO MSG  Y02072 31410002
*                                                                       31460020
*                                                                       32120020
*                                                                       33000020
*   ERROR ROUTINE FOR PRINTER FAILURES DURING VERIFICATION              33100020
*                                                                       33200020
FCB2114  EQU   *                                                        33220020
*                                                                       33240020
*                                                                       33260020
         TM    IOBSTAT0,IOBUNCHK        UNIT CHECK CONDITION     Y02072 33280002
         BZ    FCB2130                  NO, BR AROUND SENSE TEST Y02072 33290002
         TM    IOBSENS1,CMDRTYMK        TEST IF ERROR RETRYABLE         33300020
         BNO   FCB2130                  NO GO SET RETURN CODE=X'10'     33400020
         TM    IOBSENS0,BUFPARMK        TEST FOR UCS BUFFER PARITY ERR  33500020
         BO    FCB2120                  YES GO ISSUE SKIP TO CH 0       33600020
FCB2115  EQU   *                                                        33700020
*                                                                       33800020
         LA    RF,ONEMASK               SET MASK TO CLEAR BITS 0-30     33900020
         NR    RC,RF                    CLEAR BITS 0-30                 34000020
         LTR   RC,RC                    IF RC=0 GO RETRY PRINT LINE     34100020
         BNZ   FCB2130                  NO GO SET PERM ERR +SKP CH 0    34200020
         LA    RC,ONEMASK(RC)           SET FLAG FOR FIRST RETRY        34300020
         B     FCB2100                  GO RETRY PRINT LINE             34400020
*                                                                       34500020
FCB2120  EQU   *                                                        34600020
*                                                                       34700020
         MVC   DXCCW1(EIGHTMSK),SKIP0CCW SET UP SKIP TO CH 0 CCW        35000020
         LA    RF,DXIOB                 GET IOB ADDR                    35300020
*                                                                       35400020
         EXCP  (1)                      ISSUE EXCP TO RESET PRINTER     35500020
*                                                                       35600020
*   SET RETURN CODE OF X'10' FOR PERM I/O ERROR DURING VERIFICATION     35700020
*                                                                       35800020
FCB2130  EQU   *                                                        35900020
*                                                                       36000020
         MVI   DXFCBOPT,OABD089         MOVE INTERNAL CODE TO    Y02072 36050002
*                                       WKAREA                   M0099  36120021
         B     FCB2066                  GO TO DELETE FCB IMAGE AND      36200020
*                                       FLAG INVALID                    36300020
*                                                                       36900020
*********************************************************************** 37000020
*                                                                       37100020
*   ALIGNMENT OF FORMS ROUTINE                                          37200020
*   (1) ISSUE MESSAGE'IEC128D XXX,VERIFY FORMS ALIGNMENT'               37300020
*   (2) ANALIZE REPLY                                                   37400020
*                                                                       37500020
*********************************************************************** 37600020
*                                                                       37700020
FCB2180  EQU   *                                                        37800020
*                                                                       37900020
         LA    RWK3,MSG128              MESSAGE NO FOR MSG RTN   Y02072 37950002
         BAL   RWK6,GETMSG              GO GET MSEEAGE           Y02072 38000002
         USING MSGTXTD,RWK3                                      Y02072 38010002
         IC    RWK7,MSGLNG              LEN - 1 TO MOVE          Y02072 38030002
         EX    RWK7,MOVELINE            MOVE LINE TO BUFFER      Y02072 38040002
         IC    RWK7,MSGOFF1             OFFSET TO VAR FLD ONE    Y02072 38050002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD ONE   Y02072 38100002
         MVC   0(L'UCBNAME,RWK3),UCBNAME  DEV NAME TO MSG        Y02072 38150002
         B     FCB2195                  BR AROUND MOVE INST      Y02072 38200002
FCB2190  EQU   *                                                        38850020
*                                                                       38900020
         MVC   MSGAREA,MSGTXT           MV 64 BYTES TO WTOR AREA Y02072 38950002
         DROP  RWK3                                              Y02072 38960002
FCB2195  EQU   *                                                 Y02072 38970002
*                                                                       38980002
*   CLEAR REPLY AREA                                                    39000020
*                                                                       39050002
         LA    RF,REPLYLTH              GET ADDRESS OF PARM LIST        39060020
         XC    RPLY(24),RPLY            ZERO OUT REPLY AREA AND ECB     39120020
*                                                                       39180020
*                                                                       39300020
         SVC   35                                                       39360020
*                                                                       39420020
         LA    RF,RPLYECB               GET ECB ADDRESS                 39480020
*                                                                       39540020
         WAIT  ECB=(1),LONG=YES                                  Y02072 39600002
*                                                                       39780020
*   REPLY ANALYSIS                                                      39840020
*                                                                       39960020
         L     RWK7,DXREGSV1            REINIT REG IN CASE       Y02072 40010002
*                                         RE-VERIFICATION IS     Y02072 40012002
*                                         NECESSARY              Y02072 40014002
         OC    RPLY(8),LOMASK           ALLOW LOWER CASE ALPHA          40020020
         CLC   RPLY(2),RETRY0           RE-VERIFICATION OF FCB NEEDED   40080020
         BE    FCB2060                  GO RE_VERIFY IF NEEDED          40140020
*                                                                       40200020
         CLC   RPLY(6),RETRY1           RE-VERIFICATION OF FCB NEEDED   40260020
         BE    FCB2060                  GO RE_VERIFY IF NEEDED          40320020
*                                                                       40380020
         CLC   RPLY(2),VERFYC2          OPERATOR VERIFIED FCB IMAGE     40440020
         BNE   FCB2191                  GO TRY NEXT REPLY      @AZ07594 40500037
         LA    RBRNCH,FCB2210           ADDR TO CLEAN UP FCB I @AZ07594 40540037
         B     FCB2072                  GO ISSUE SKIP CHANN 1  @AZ07594 40580037
FCB2191  CLC   RPLY(8),VERFYC1          OPER VERIFIED FCB IMAG @AZ07594 40620037
         BNE   FCB2192                  GO TRY NEXT REPLY      @AZ07594 40660037
         LA    RBRNCH,FCB2210           ADDR TO CLEAN UP FCB I @AZ07594 40700037
         B     FCB2072                  GO ISSUE SKIP CHANN 1  @AZ07594 40740037
FCB2192  CLC   RPLY(7),CANCELC1         CK IF OPERATOR CANCEL  @AZ07594 40780037
         BE    FCB2200                  YES GO SET RETURN CODE = X'14'  40860020
         CLC   RPLY(2),CANCEL2          CK IF OPERATOR CANCELED FCB VER 40920020
*                                       FCB VERIFICATION                40980020
         BE    FCB2200                  YES GO SET RETURN CODE=X'14'    41300020
*                                                                       41400020
*   INVALID OPERATOR RESPONSE ISSUE MESSAGE TO REPEAT REPLY             41500020
*   'IEC125 ERROR - REPEAT REPLY'                                       41600020
*                                                                       41700020
         LA    RWK3,MSG125              MESSAGE NO FOR MSG RTN   Y02072 41750002
         LA    RWK6,FCB2190             RETURN ADDRESS           Y02072 41800002
         B     GETMSG                   GO GET MSESAGE           Y02072 41850002
*                                                                       42300020
FCB2200  EQU   *                                                        42400020
*                                                                       42500020
         MVI   DXFCBOPT,OABD090         MOVE INTERNAL CODE TO    Y02072 42550002
*                                       WKAREA                   M0099  42620021
         B     FCB2065                  GO DELETE FCB AND ABEND         42700020
*                                                                       42800020
*   HAVE FINISHED WITH FCB LOADING SO CLEAN UP                          42900020
*                                                                       43000020
FCB2210  EQU   *                                                        43100020
*                                                                       43200020
*                                                                       43700020
*   UP DATE UCB FIELDS WITH FCB ID AND FCB OPTIONS.  IF THE FCB ID      43800037
*   IN THE UCB EXTENSION IS THE SAME AS THE ONE REQUESTED BY THIS       43820037
*   USER, THEN EITHER THE FCB IMAGE WAS NOT LOCATED BY THE PREVIOUS     43840037
*   MODULE AND WE DO NOT WANT TO UPDATE THE UCB EXTENSION OR IT WAS     43860037
*   ONLY LOADED TO VERIFY IT.                                           43880037
*                                                                       43900020
         L     RC,UCBXTADR              GET POINTER TO UCB EXTENTION    44000020
         MODESET  EXTKEY=SUPR           KEY 0 TO STORE IN UCB    Y02072 44050002
         SPACE                                                          44060002
         CLC   UCBFCBOF(4,RC),DXFCBID   UCB ALREADY UPDATED?   @ZA12979 44070037
         BE    FCB2215                  YES, FCB IMAGE OK      @ZA12979 44080037
         MVC   UCBFCBOF(4,RC),DXFCBID   MOVE FCB ID INTO UCB     Y02072 44090037
         MVC   FCBOPTNS(1,RC),NULL(RB)  MOVE FCB OPTIONS TO UCB@ZA12979 44100037
*                                       IF ANY                          44110037
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 44120037
         SPACE                                                          44130037
FCB2215  TM    FCAOPEN2,FCAOFCBL        CK IF FCB LOADED INTO  @ZA12979 44140037
*                                         MAIN STG               Y02072 44198002
         BZ    FCB2220                  NO GO MOVE EROPT FOR DCB YM4697 44210002
         LA    RE,DXSAVFCB              GET ADDR OF FCB IMAGE ID Y02072 44220002
         DELETE EPLOC=(0)                                               44250020
         NI    FCAOPEN2,X'FF'-FCAOFCBL  INDIC FCB IMAGE DELETED  YM4697 44260002
*                                                                       44300020
*********************************************************************** 44400020
*                                                                       44500020
*   DETERMINE NEXT STAGE 2 EXECUTOR                                     44600020
*                                                                       44700020
*********************************************************************** 44800020
*                                                                       44900020
FCB2220  EQU   *                                                        45000020
*                                                                       45100020
*********************************************************************** 45200020
*                                                                       45300020
*   RESTORE DCB EROPT                                                   45400020
*                                                                       45500020
*********************************************************************** 45600020
*                                                                       45700020
         MVC   DXCCW6(1),DXEROPT        MVOE IN DCB EROPT        Y02072 45750002
*                                                                       45900020
*********************************************************************** 46000020
*   SEE IF SYS1.IMAGELIB HAS BEEN OPENED IF YES CLOSE IT                46007020
*                                                                       46014020
*                                                                       46021020
         CLI   DXIMGDCB,IMCLOSED        CK IF IMGLIB CLOSED      Y02072 46023002
         BE    FCB2230                  YES, GO TEST NEXT EXECUTORM1803 46035021
         L     RF,DXIMGDCB              GET ADDR OF IMGLIB DCB   Y02072 46037002
*                                                                       46049020
*   ISSUE SVC TO CLOSE IMAGELIB                                         46056020
*                                                                       46063020
         SVC   105                      ISSUE SVC TO CLOSE SYS1.IMAGELI 46070020
         NI    FCAOPEN2,X'FF'-FCAOIMGL  INDIC IMAGELIB CLOSED    YM4697 46072002
*                                                                       46077020
**********************************************************************  48200020
*                                                                       48300020
*   DETERMINE THE NEXT STAGE 2 EXECUTOR TO BE XCTLED                    48400020
*                                                                       48500020
*********************************************************************** 48600020
*                                                                       48700020
FCB2230  EQU   *                                                        48800020
*                                                                       48900020
*********************************************************************** 49000020
*                                                                       49100020
*   TEST IF EXCP IS SPECIFIED.IF YES,XCTL TO THE LAST OPEN EXECUTOR     49200020
*                                                                       49300020
*********************************************************************** 49400020
*                                                                       49500020
         TM    DCBMACRF,EXCPMASK        TEST IF EXCP IS SPECIFIED       49600020
         BC    14,FCB2240               IF NOT,GOTO BUFFER CNTRL BLK    49700020
*                                                                       49800020
         LA    RF,MODNM11               GO DO DCB COPY BACK      Y02072 49810002
         BC    15,FCB2270               GOTO WTG TABLE UPDATE    Y02072 50000002
*                                                                       50100020
*********************************************************************** 50200020
*                                                                       50300020
FCB2240  EQU   *                                                        50400020
*                                                                       50500020
*********************************************************************** 50600020
*                                                                       50700020
*   TEST IS BUFFER CONTROL BLOCK IS SPECIFIED.IF YES,XCTL TO IGG0911I   50800020
*                                                                       50900020
*********************************************************************** 51000020
*                                                                       51100020
         TM    DCBBUFNO+3,BFCNTRL       BUFFER CONTROL BLOCK SPECIFIED  51200020
         BC    14,FCB2250               IF YES,GOTO TEST PCI ROUTINE    51300020
*                                                                       51400020
         SR    RE,RE                    RESET REGISTER                  51500020
         IC    RE,DCBBUFNO              GET THE NO OF BUFFER SPECIFIED  51600020
         LTR   RE,RE                    TEST IF DCBBUFNO='0'            51700020
         BC    8,FCB2250                IF YES,GOTO TEST PCI            51800020
*                                                                       51900020
         LA    RF,MODNM1I               LOAD ADDR OF IDTTR OF IGG0191I  52000020
         BC    15,FCB2270               GOTO MOVE IDTTR ROUTINE         52100020
*                                                                       52200020
*********************************************************************** 52300020
*                                                                       52400020
FCB2250  EQU   *                                                        52500020
*                                                                       52600020
*********************************************************************** 52700020
*                                                                       52800020
*   TEST IF PCI IS SPECIFIED.IF YES,XCTL TO IGG0191Q                    52900020
*                                                                       53000020
*********************************************************************** 53100020
*                                                                       53200020
         TM    DCBOPTCD,PCIMASK         TEST IF PCI SPECIFIED           53300020
         BC    14,FCB2260               IF NOT,GOTO BSAM/QSAM ROUTINEED 53400020
*                                                                       53500020
         LA    RF,MODNM1Q               LOAD ADDR OF IDTTR OF IGG0191Q  53600020
         BC    15,FCB2270               GOTO MOVE IDTTR ROUTINE         53700020
*                                                                       53800020
*********************************************************************** 53900020
*                                                                       54000020
FCB2260  EQU   *                                                        54100020
*                                                                       54200020
*********************************************************************** 54300020
*                                                                       54400020
*   BSAM/QSAM EXIT.XCTL TO IGG0191G                                     54500020
*                                                                       54600020
*********************************************************************** 54700020
*                                                                       54800020
         LA    RF,MODNM1G               LOAD ADDR OF IDTTR IF IGG0191G  54900020
*                                                                       55000020
*********************************************************************** 55100020
*                                                                       55200020
FCB2270  EQU   *                                                        55300020
*                                                                       55400020
*********************************************************************** 55500020
*                                                                       55600020
*   MOVE IDTTR TO XCTL WTG TABLE                                        55700020
*                                                                       55800020
*********************************************************************** 55900020
*                                                                       56000020
         USING WTGENTRY,RWTGC                                    Y02072 56050002
         MVC   WTGIDTTR,0(RF)           ST NEXT MOD ID IN WTG  @Z30TSCF 56060003
*                                                                       56200020
*********************************************************************** 56300020
*                                                                       56400020
FCB2280  EQU   *                                                        56500020
         LM    RPAR,RWTG,DXREGSV2       RESTORE REGISTERS        Y02072 56550002
FCB2285  EQU   *                        UPDATE WTG TABLE         Y02072 56560002
*                                                                       56600020
*********************************************************************** 56700020
*                                                                       56800020
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            56900020
*                                                                       57000020
*********************************************************************** 57100020
*                                                                       57200020
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     57300020
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY     57400020
         CLC   0(2,RWTGC),AMIDCNST      IS THE RTN NEEDED AGAIN         57500020
         BCR   8,RBASE                  IF YES,RETURN TO PROCESS        57600020
*                                                                       57700020
         CLC   0(2,RWTGC),OPIDCNST      TEST END OF WTG TABLE           57800020
         BC    7,FCB2285                IF NOT,CHECK NEXT ENTRY  Y02072 57900002
*                                                                       58000020
         LR    RPARC,RPAR               RESET REG TO '0'                58100020
         LA    RWTGC,WAOFF(0,RWTG)      RESET WTG REG TO POINT +32(WTG) 58200020
FCB2290  CLI   0(RWTGC),X'00'           TEST IF THIS ENTRY COMPLETE     58300020
         BNE   FCB2300                  IF NOT XCTL                     58400020
*                                                                       58500020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY OF WTG TABLE     58600020
         LA    RPARC,PLOFF(0,RPARC)     GET NEXT ENTRY OF DCB           58700020
         BC    15,FCB2290               GOTO TEST COMPLETION            58800020
*                                                                       58900020
FCB2300  EQU   *                                                        59000020
*                                                                       59100020
         USING WTG,RWTG                                                 59150003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*59200003
               MODID=WTGENTRY                                  @Z30TSCF 59250003
         DROP  RWTGC,RWTG                                      @Z30TSCF 59300003
*                                                                       59800020
*********************************************************************** 59900020
*                                                                       60000020
*                                                                       60100020
**********************************************************************  60200020
*                                                                       60300020
*   CONSTANTS                                                           60400020
*                                                                       60500020
*********************************************************************   60600020
*                                                                       60970002
*  MODULE ID'S                                                          60980002
*                                                                       60990002
MODNM1G  DC    C'1G',VL3(IGG0191G)                             @Z30TSCF 60992003
MODNM1I  DC    C'1I',VL3(IGG0191I)                             @Z30TSCF 60994003
MODNM1Q  DC    C'1Q',VL3(IGG0191Q)                             @Z30TSCF 60996003
PDLOAD   DC    C'6M',VL3(IGG0196M)                             @Z30TSCF 60998003
MODNM11  DC    C'11',VL3(IGG01911)                             @Z30TSCF 60998403
OPIDCNST DC    C'0S'                    END OF WTG TABLE                61000020
AMIDCNST DC    C'7F'                    RTN CODE                        61100020
*                                                                       61150002
*  OTHER CONSTANTS                                                      61200002
*                                                                       61250002
LFTHFOFF DC    0F'0',X'0000000F'        TO CLEAR THE LEFT HALF   Y02072 61300002
*                                         OF A BYTE              Y02072 61350002
VERFYC1  DC    C'VERIFIED'                                              63000020
RETRY0   DC    C'R '                    RETRY FCB VERIFICATION          63030020
RETRY1   DC    C'RETRY '                RETRY FCB VERIFICATION          63060020
VERFYC2  DC    C'V '                    FCB IMAGE VERIFIED CODE         63090020
CANCELC1 DC    C'CANCEL '               CANCEL FCV VERIFICATION CODE    63120020
CANCEL2  DC    C'C '                    CANCEL FCV VERIFICATION CODE    63150020
SKIP0CCW DC    X'8300000020000001' SKIP TO CHANNEL 0 CCW                63260020
         EJECT                                                          63282002
*********************************************************************** 63290002
*  'GETMSG' SUBROUTINE                                           Y02072 63292002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 63294002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 63296002
*                                                                       63298002
*    INPUT TO THIS ROUTINE:                                      Y02072 63298402
*      REG 11 - MESSAGE NUMBER IN CSECT                          Y02072 63298802
*      REG 15 - RETURN ADDRESS                                   Y02072 63299202
*                                                                       63299602
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 63299702
*      REG 1 - POINTER TO MESSAGE ENTRY IN THE MESSAGE CSECT     Y02072 63299802
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 63299902
*********************************************************************** 63333202
GETMSG   DS    0H                       ENTRY POINT, MSG RTN     Y02072 63343202
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 63353202
         LH    RWK2,0(RWK7,RWK3)        GET INDEX TO MESSAGE     Y02072 63363202
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 63365202
         USING MSGENTRY,RWK2                                     Y02072 63365602
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 63366002
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 63366402
*                                         ENTRY                  Y02072 63366502
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 63366602
         SR    RWK7,RWK7                PREPARE REG FOR RETURN   Y02072 63387702
         BR    RWK6                     RETURN                   Y02072 63388602
         SPACE                                                          63388702
PATCH    DC    0H'0',54X'00'            PATCH AREA               Y02072 63412002
END      EQU   *                        END OF THIS MODULE       Y02072 63458802
         EJECT                                                          63488802
         IHAFCBIM                                                XM2963 63538802
         EJECT                                                          63588802
CVT      DSECT                                                 @Z30TSCF 63638803
         CVT                                                   @Z30TSCF 63688803
         EJECT                                                          63738803
         DCBD  DSORG=PS                                                 65700020
         EJECT                                                          66050002
         IGGMSG                                                  Y02072 66060002
         EJECT                                                          66070002
         IECDSECS  WTG,PREFX,EXPAND=YES                        @Z30TSCF 66080003
         ORG   WTGIDTTR                                          Y02072 66082002
WTGID    DS    CL2                      ID NEXT MOD              Y02072 66084002
         EJECT                                                          66090002
         IECDSECS MAIN,EXPAND=YES                                M0099  66100021
         ORG   REPLYLTH+52                                       S21092 66210021
RPLY     DS    20C                      MSG REPLY AREA           M0191  66220021
RPLYECB  DS    F                        ECB FOR WTOR EXCP        M0191  66230021
MCSMASK  DS    H                        MASK FOR MCS             M0191  66240021
LOMASK   DS    8C                       MASK FOR LOWER CASE RPLY M0191  66250021
UCSID    DS    4C                       ID OF UCS IMAGE          M0191  66260021
         ORG   MSGLSTSZ                                          Y02072 66270002
MSGAREA  DS    0CL64                    AREA TO MOVE 64 BYTES    Y02072 66280002
*                                         TO FOR WTO/WTOR'S      Y02072 66290002
DXREGSV1 EQU   DXXCTL                   WORD TO SAVE REG         Y02072 66292002
DXREGSV2 EQU   DXCCW12                  WORDS TO SAVE REGS       Y02072 66294002
NUMNXTLN EQU   DXCCW2+1                 NUMBER OF PRINT LINES    Y02072 66296002
ENDINDIC EQU   DXXCTL+4                 IF X'00', NOT THE LAST   Y02072 66298002
*                                         LINE TO BE VERIFIED    Y02072 66298402
         EJECT                                                          66298802
         IGGSCW                                                  Y02072 66299202
         EJECT                                                          66299602
         IHAFCAUD  ORG=YES                                       YM4697 66299702
         EJECT                                                          66299802
*                                                                       66300020
*********************************************************************** 66400020
*                                                                       66500020
SRT      DSECT                                                          66600020
         IEFUCBOB                                                       66700020
*                                                                       66800020
*********************************************************************** 66900020
*                                                                       67000020
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          67100020
DEB      DSECT                                                          67200020
DEBNMSUB DS    0CL1                                                     67300020
DEBTCBAD DS    CL4                                                      67400020
DEBAMLNG DS    0CL1                                                     67500020
DEBDEBAD DS    CL4                                                      67600020
DEBOFLGS DS    0CL1                                                     67700020
DEBIRBAD DS    CL4                                                      67800020
DEBOPATB DS    0CL1                                                     67900020
DEBSYSPG DS    CL4                                                      68000020
DEBNMEXT DS    0CL1                                                     68100020
DEBUSRPG DS    CL4                                                      68200020
DEBPRIOR DS    0CL1                                                     68300020
DEBECBAD DS    CL4                                                      68400020
DEBPROTG DS    0CL1                                                     68500020
DEBDEBID DS    0CL1                                                     68600020
DEBDCBAD DS    CL4                                                      68700020
DEBEXSCL DS    0CL1                                                     68800020
DEBAPPAD DS    CL4                                                      68900020
DEBDVMOD DS    0CL1                                                     69000020
DEBUCBAD DS    CL4                                                      69100020
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     69200020
DEBBINUM DS    CL2                                                      69300020
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   69400020
DEBSTRCC DS    CL2                                                      69500020
DEBSTRHH DS    CL2                                                      69600020
DEBENDCC DS    CL2                                                      69700020
DEBENDHH DS    CL2                                                      69800020
DEBNMTRK DS    CL2                                                      69900020
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          70000020
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              70100020
DEBVOLSQ DS    H                                                        70200020
DEBVOLNM DS    H                                                        70300020
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     70400020
DEBSUBID DS    H                                                        70500020
         END                                                            70900020
./  ADD  SSI=20740035,NAME=IGG0197J
FCB2STD1 CSECT                                                          03000020
         DC    X'80'          DEFAULT                                   06000020
         DC    AL1(48)        FCB IMAGE LENGTH = 48                     09000020
         DC    X'000000'      LINE 1,2,3                                12000020
         DC    X'01'          LINE 4   CHANNEL 1                        15000020
         DC    X'000000'      LINE 5,6,7                                18000020
         DC    X'02'          LINE 8   CHANNEL 2                        21000020
         DC    X'000000'      LINE 9,10,11                              24000020
         DC    X'03'          LINE 12  CHANNEL 3                        27000020
         DC    X'000000'      LINE 13,14,15                             30000020
         DC    X'04'          LINE 16  CHANNEL 4                        33000020
         DC    X'000000'      LINE 17,18,19                             36000020
         DC    X'05'          LINE 20  CHANNEL 5                        39000020
         DC    X'000000'      LINE 21,22,23                             42000020
         DC    X'06'          LINE 24  CHANNEL 6                        45000020
         DC    X'000000'      LINE 25,26,27                             48000020
         DC    X'07'          LINE 28  CHANNEL 7                        51000020
         DC    X'000000'      LINE 29,30,31                             54000020
         DC    X'08'          LINE 32  CHANNEL 8                        57000020
         DC    X'000000'      LINE 33,34,35                             60000020
         DC    X'0A'          LINE 36  CHANNEL 10                       63000020
         DC    X'000000'      LINE 37,38,39                             66000020
         DC    X'0B'          LINE 40  CHANNEL 11                       69000020
         DC    X'000000'      LINE 41,42,43                             72000020
         DC    X'0C'          LINE 44  CHANNEL 12                       75000020
         DC    X'000000'      LINE 45,46,47                             78000020
         DC    X'19'          LINE 48  CHANNEL 9  - END OF FCB IMAGE    81000020
         END                                                            84000020
./  ADD  SSI=20740018,NAME=IGG0197K
FCB2STD2 CSECT                                                          03000020
         DC    X'80'          DEFAULT IMAGE                             06000020
         DC    AL1(66)        FCB IMAGE LENGTH = 66                     09000020
         DC    X'000000'      LINES 1,2,3                               12000020
         DC    X'01'          LINE 4   CHANNEL 1                        15000020
         DC    X'0000000000'  LINE 5,6,7,8,9                            18000020
         DC    X'02'          LINE 10  CHANNEL 2                        21000020
         DC    X'0000000000'  LINE 11,12,13,14,15                       24000020
         DC    X'03'          LINE 16  CHANNEL 3                        27000020
         DC    X'0000000000'  LINE 17,18,19,20,21                       30000020
         DC    X'04'          LINE 22  CHANNEL 4                        33000020
         DC    X'0000000000'  LINE 23,24,25,26,27                       36000020
         DC    X'05'          LINE 28  CHANNEL 5                        39000020
         DC    X'0000000000'  LINE 29,30,31,32,33                       42000020
         DC    X'06'          LINE 34  CHANNEL 6                        45000020
         DC    X'0000000000'  LINE 35,36,37,38,39                       48000020
         DC    X'07'          LINE 40  CHANNEL 7                        51000020
         DC    X'0000000000'  LINE 41,42,43,44,45                       54000020
         DC    X'08'          LINE 46  CHANNEL 8                        57000020
         DC    X'0000000000'  LINE 47,48,49,50,51                       60000020
         DC    X'0A'          LINE 52  CHANNEL 10                       63000020
         DC    X'0000000000'  LINE 53,54,55,56,57                       66000020
         DC    X'0B'          LINE 58  CHANNEL 11                       69000020
         DC    X'0000000000'  LINE 59,60,61,62,63                       72000020
         DC    X'0C'          LINE 64  CHANNEL 12                       75000020
         DC    X'00'          LINE 65                                   78000020
         DC    X'19'          LINE 66  CHANNEL 9  -END OF FORM          81000020
         END                                                            84000020
./  ADD  SSI=52470072,NAME=IGG0197U
197U   TITLE 'IGG0197U - CONTINUATION OF IGG0191V, VERIFY UCS IMAGE'    00100003
IGG0197U CSECT                                                          00200020
*                                                                       00210002
*MODULE NAME - IGG0197U                                          Y02072 00220002
*                                                                       00222002
*DESCRIPTIVE NAME - VERIFY UCSB IMAGE                            Y02072 00224002
*                                                                       00226002
*COPYRIGHT - NONE                                                Y02072 00228002
*                                                                       00228402
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00228802
*                                                                       00229202
*0000365000-366000,370000,375000-377000,379000,383000,386000,    M5143  00230020
*0000389000,392000,593000-595000                                 M5143  00260020
*          RELEASE 21 DELETIONS                                         00300020
*0791115000,607000,621000                                        M1803  00310021
*0791106000-107000,451000,466000,521000-525000,747000,795000-    M0099  00330021
*0791804000,820000-821000                                        M0099  00360021
*                                                                       00370002
*        VS 2 RELEASE 02 DELETIONS                                      00380002
*001000-001800,008000,037000,042000,058000,108200-108600,        Y02072 00390002
*172000-177000,201500,202500-202800,218000-219000,221000,        Y02072 00392002
*226000-227000,253000-254000,262000,318000,348000-362000,        Y02072 00394002
*406000-409000,422000-424000,426000,591000,592000,592800-593600, Y02072 00396002
*648000,675050-777000,794500-802000,245000-246000,251000-252000, Y02072 00398002
*003984-007000,242000,710000,745000,749000,649000,761500-761940, Y02072 00398102
*762000                                                          Y02072 00448102
*                                                                YM2424 00498102
*                                                                YM4697 00548102
*                                                                       00598103
*        VS2 RELEASE 3 ADDITIONS                                        00648103
*                                                              @Z30TSCF 00698103
*        VS2 RELEASE 4.0 CHANGES                                        00698403
*A217500,319500                 ABEND 0C4 IF UCS NOT REENTRANT @ZA02191 00698603
*A520500-522000                        ABEND 0C4 IN IMGLIB SVC @ZA05553 00698803
*                                                                       00750002
*STATUS - SEE BEGINNING OF OBJECT CODE                                  00800003
*                                                                       00850002
*FUNCTION/OPERATION - WHEN VERIFICATION IS REQUIRED DISPLAY THE IMAGE   00900020
*                     RETRIEVED FOR VISUAL VERIFICATION                 01000020
*                   - DISPLAY MESSAGE IEC121 TO REQUEST OPERATOR VERIFY 01100020
*                     THE IMAGE PRINTED                                 01200020
*                   - ANALIZE REPLY MADE BY AN OPERATOR                 01300020
*                   - UPDATE UCB TO REFLECT THE STATUS OF UCS IMAGE IN  01400002
*                     THE BUFFER.                                       01500020
*                   - CLOSE SYS1.IMAGELIB DCB IF PRINTER IS 1403        01600003
*                   - RESET AUDIT TRAIL BITS INDICATING TO FORCE YM4697 01650002
*                     CLOSE THAT UCS IMAGE HAS BEEN DELETED AND  YM4697 01660002
*                     THAT SYS1.IMAGELIB HAS BEEN CLOSED         YM4697 01670002
*                   - DETERMINE NEXT OPEN EXECUTOR TO XCTL TO AND       01700020
*                     IF NECESSARY ISSUE IEC129 MESSAGE TO OPERATOR     01800020
*                                                                       01900020
*ENTRY POINT -ENTERED FROM IGG0191V BY USE OF XCTL MACRO                02000020
*                                                                       02100020
*INPUT - DCB ADDRESS                                                    02200020
*      - OPEN WORK AREA ADDRESS                                         02300020
*      - WHERE-TO-GO TABLE                                              02400020
*      - PARAMETER LIST                                                 02500020
*      - CURRENT ENTRY IN W-T-G TABLE                                   02600020
*      - CURRENT PARAMETER(DCB)                                         02700020
*      - THE ADDRESS OF UCS IMAGE RETRIEVED                             02800020
*                                                                       02900020
*OUTPUT - PRINT OUT UCS IMAGE WHEN VERIFY IS SPECIFIED                  03000020
*       - TO REQUEST AN OPERATOR VERIFY THE IMAGE ,                     03100020
*         'IEC121D V XXX,YYYY' MESSAGE IS DISPLAYED                     03200020
*       - UPDATED UCB TO REFRECT THE STATUS OF UCS BUFFER               03300020
*       - ISSUE REQUEST FOR OPERATOR TO SPECIFY FCB IMAGE               03400020
*         'IEC129D XXX,SPECIFY FCB PARAMETERS' MESSAGE                  03500020
*       - ISSUE MESSAGE 'IEC125I - ERROR - REPEAT REPLY' WHEN    Y02072 03550002
*         OPERATOR REPLY IS INVALID                              Y02072 03560002
*                                                                       03600020
*EXTERNAL REFERENCS - MESSAGE CSECT                              Y02072 03700002
*                                                                       03800020
*EXIT - NORMAL - XCTL TO ONE OF THE FOLLOWING:                          03900002
*               *IGG0197E TO LOAD AN FCB IMAGE                   Y02072 04000002
*               *IGG01911 IF THE DCB IS EXCP.                    Y02072 04200002
*               *IGG0191I IF BUFFER CNTRL BLOCK IS SPECIFIED.           04300020
*               *IGG0191G IF NORMAL SCHEDULING IS SPECIFIED.            04400020
*               *IGG0191Q IF CHAINED SCHEDULING IS SPECIFIED.           04500020
*                                                                       04600020
*EXIT - ERROR - XCTL TO PROBLEM DETERMINATION FOR THE FOLLOWING  Y02072 04650002
*              *PERMANENT I/O ERROR OCCURED DURING VERIFICATION         04900020
*              *OPERATOR ISSUED CANCEL FOR MESSAGE IEC121.              05100020
*                                                                       05300020
*TABLES/WORK AREAS - WHERE-TO-GO TABLE (SEE LISTING OF EXECUTOR         05400020
*                                       IGG0191B)                       05500020
*                  - OPEN WORK AREA (SEE IECDSECT IN THIS LISTING)      05600020
*                                                                       05650002
*MACROS-ACTION:MODESET, EXCP, WAIT, DELETE, DMABCOND, XCTL,      Y02072 05660002
*              XCTLTABL                                          Y02072 05670002
*                                                                       05680002
*MACROS-MAPPING:IGGMSG,IECDSECS(MAIN,WTG),IKJTCB,IEFUCBOB,DCBD,  Y02072 05690002
*               IGGSCW, IHAFCAUD                                 Y02072 05700002
*                                                                       05750002
*ATTRIBUTES - REENTRANT, REFRESHABLE, RUNS IN DATA MANAGEMENT KEYY02072 05800003
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 05850002
*                                                                       05900020
*NOTES - EXCP/WAIT SVCS ARE USED TO WRITE IMAGES ON PRINTER FOR VERFY   06000020
*      - DELETE SVC IS USED TO DELETE THE RETRIEVED IMAGE.              06100020
*      - WTOR SVC IS USED TO REQUEST OPERATOR REPLY                     06200020
*      - IOB/ECB IN OPEN WORK AREA IS USED FOR EXCP                     06300020
*      - THE REPLY IS ORED TO ALLOW LOWER CASE ALPHA                    06400020
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 06460002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 06470002
*                                                                       06500020
*********************************************************************** 06600020
*                                                                       06700020
         EJECT                                                          06800020
*                                                                       06900020
*********************************************************************** 07000020
*                                                                       07100020
*   REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES               07200020
*                                                                       07300020
*********************************************************************** 07400020
*                                                                       07500020
*                                                                       07600020
RE       EQU   0                        WORK/PARAMETER REGISTER         07700020
RF       EQU   1                        WORK/PARAMETER REGISTER         07800020
RWK2     EQU   RF                       WORK REGISTER            Y02072 07850002
RDCB     EQU   2                        ADDR OF USER'S DCB              07900020
RBASE    EQU   3                        BASE REGISTER                   08000020
RCORE    EQU   4                        ADDR OF OPEN WORK AREA          08100020
RPAR     EQU   5                        PARAMETER LIST                  08200020
RWTG     EQU   6                        START OF WTG                    08300020
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 08400020
RWK1     EQU   RPARC                    WORK REGISTER            Y02072 08450002
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      08500020
RTIOT    EQU   9                        TIOT ADDR/WORK REGISTER         08600020
RWK3     EQU   RTIOT                    WORK REGISTER            Y02072 08650002
RUCB     EQU   10                       UCB ADDR/WORK REGISTER          08700020
RDEB     EQU   11                       DEB ADDR                        08800020
RB       EQU   12                       WORK REGISTER/BREG FOR DSECT    08900020
RWK6     EQU   RB                       WORK REGISTER            Y02072 08950002
RC       EQU   13                       WORK REGISTER                   09000020
RD       EQU   14                       WORK/PARAMETER REGISTER         09100020
RJ       EQU   15                       WORK/PARAMETER REGISTER         09200020
RWK7     EQU   RJ                       WORK REGISTER            Y02072 09250002
*                                                                       09300020
*********************************************************************** 09400020
*                                                                       09500020
*                                                                       09600020
*   EQUATE WTG OFFSET                                                   09700020
*                                                                       09800020
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   09900020
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   10000020
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TBL  10100020
*                                                                       10200020
*   EQUATE ABEND CODE AND RETURN CODE                                   10300020
*                                                                       10400020
OABD067  EQU   67                       OPEN INTERNAL CODE 67    M0099  10600021
OABD068  EQU   68                       OPEN INTERNAL CODE 68    M0099  10700021
BFCNTRL  EQU   X'01'                    BUFFER CNTRL BLOCK SPECIFIED    11000020
EXCPMASK EQU   X'80'                   OPEN FOR EXCP MASK               11100020
NULL     EQU   X'00'                    X'00'                           11200020
SILIMASK EQU   X'60'                    C.C. AND SILI ON                11300020
ONEMASK  EQU   X'01'                    X'01'                           11400020
PRTM3211 EQU   X'09'                    MASK FOR 3211 PRINTER           11600020
IEC129RQ EQU   X'80'                    IF ON, MUST WAIT FOR     Y02072 11650002
*                                         OPER REPLY TO IEC129   Y02072 11660002
UCSOPOFS EQU   X'04'                    UCS OPTIONS OFFSET              11900020
RETRYMSK EQU   X'80'                   MASK FOR COMMAND RETRY ON        12200020
BUFPARMK EQU   X'04'                    BUFFER PARITY ERROR MASK        12300020
BUFPARER EQU   X'01'                    UCS OPTION BIT FOR PARITY ERR   12600020
CMDSKP0  EQU   X'83'                    SKIP TO CH 0 COMMAND CODE       12700020
TWOMASK  EQU   X'02'                    X'02'                           12800020
FOLDMASK EQU   X'40'                    LOAD MODE = FOLD                12900020
RESETMSK EQU   X'CF'                    RESET VERIFY                    13000020
SKIPCCW  EQU   X'8B'                    CCW = SKIP TO CH 1              13100020
SILLCCW  EQU   X'20'                    SILI BIT ON                     13300020
WRITECCW EQU   X'11'                    CCW = WRITE 2 SPACE             13400020
UNRLBMSK EQU   X'02'                    IOB IS UNRELATED                13500020
ABENDBIT EQU   X'80'                    ABEND ROUTINE IN PROCESS        14000020
IMCLOSED EQU   X'FF'                    FLAG SET FOR IMAGELIB NOT OPEN  14100020
*                                                                  DM0Q 14200020
*    EQUATES FOR CONSTANTS                                         DM0Q 14300020
*                                                                  DM0Q 14400020
X7F      EQU   X'7F'                    COMPLETION CODE FLAG            14500020
K0       EQU   0                        CONSTANT EQUATED TO 0           14600020
K2       EQU   2                        CONSTANT EQUATED TO 2           14800020
K4       EQU   4                        CONSTANT EQUATED TO 4           15000020
K7       EQU   7                        CONSTANT EQUATED TO 7           15300020
K8       EQU   8                        CONSTANT EQUATED TO 8           15400020
IOBUNCHK EQU   X'02'                    UNIT CHECK CONDITION     Y02072 17150002
*  THE FOLLOWING MESSAGE NUMBERS ARE EQUAL TO THEIR POSITION     Y02072 17160002
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 17170002
*  OF AN INDEX).                                                 Y02072 17180002
HEADING1 EQU   14*2                     MESSAGE NO IN MSG CSECT  Y02072 17200002
HEADING2 EQU   19*2                     MESSAGE NO IN MSG CSECT  Y02072 17250002
MSG125   EQU   9*2                      MESSAGE NO IM MSG CSECT  Y02072 17260002
MSG121D1 EQU   13*2                     MESSAGE NO IN MSG CSECT  Y02072 17300002
MSG121D2 EQU   17*2                     MESSAGE NO IN MSG CSECT  Y02072 17350002
MSG129   EQU   3*2                      MESSAGE NO IN MSG CSECT  Y02072 17400002
UCSIMLNG EQU   4                        LENGTH OF UCS IMAGE NAME Y02072 17450002
*                                                                       17800020
*   HOUSE KEEPING                                                       17900020
*                                                                       18000020
*********************************************************************** 18100020
*                                                                       18200020
         BALR  RBASE,0                  SET UP BASE REGISTER            18300003
         USING *,RBASE                                                  18400003
         USING IHADCB,RDCB                                              18500020
         USING FORCORE,RCORE                                            18600020
         USING DEB,RDEB                                                 18700020
         USING UCBOB,RUCB                                               18800020
*                                                                       18900020
*                                                                       19300020
*********************************************************************** 19400020
*                                                                       19500020
*   INITIALIZE REGISTERS                                                19600020
*                                                                       19700020
*********************************************************************** 19800020
*                                                                       19900020
         B     AROUND                   BR AROUND CONSTANTS      Y02072 19950002
         DC    C'IGG0197U'              MODULE NAME              Y02072 19960002
         DC    C' ZA02191'              LAST SHIP CODE                  19970003
         DC    C' 7/29/75'              LAST DATE MODIFIED              19980003
AROUND   DS    0H                                                Y02072 19990002
*                                                                       19992002
         L     RDCB,0(RPARC)            LOAD CURRENT DCB ADDR           20000003
         L     RCORE,4(RWTGC)           LOAD CURRENT WORK AREA ADDR     20100003
         L     RDEB,DCBDEBAD            LOAD DEB ADDR                   20200020
         L     RUCB,DEBUCBAD            LOAD UCB ADDR                   20300020
         ST    RWK1,DXREGSV+4           SAVE REGISTER            Y02072 20350002
*                                                                       20400020
*                                                                       20500020
*                                                                       20600020
*                                                                       20700020
*********************************************************************** 20800020
*                                                                       20900020
VRFYUCS  EQU   *                                                        21000020
*                                                                       21100020
*********************************************************************** 21200020
*                                                                       21300020
*      INITIALIZE REGISTERS FOR VERIFICATION.  WE MUST GET INTO         21400003
* PROTECTION KEY ZERO WHENEVER THE UCS IMAGE IS REFERENCED, BECAUSE     21450003
* IT MAY HAVE BEEN LINK EDITED WITHOUT THE RENT ATTRIBUTE, CAUSING      21460003
* IT TO BE LOADED INTO FETCH-PROTECTED USER-KEY STORAGE.  THE IBM-      21470003
* DISTRIBUTED UCS IMAGES ARE LINK EDITED REENTRANT.                     21480003
*                                                                       21500020
*********************************************************************** 21600020
*                                                                       21700020
         MODESET EXTKEY=SUPR            GET INTO KEY ZERO      @ZA02191 21750003
         SR    RWK1,RWK1                RESET REGISTER           Y02072 21800002
         IC    RWK1,1(RB)               INSERT NO. OF LINES      Y02072 21900002
*                                                                       22000020
         LTR   RWK1,RWK1                TEST IF NO VERIFICATION  Y02072 22100002
         BC    K8,UPDTUCB               IF NOT,GOTO UPDATE UCB ROUTINE  22200020
*                                                                       22300020
         LA    RC,TWOMASK(RB)           OBTAIN 1ST NO. OF CHAR/LINE     22400020
         ST    RB,DXREGSV               SAVE IMAGE ADDR          Y02072 22450002
         LR    RD,RC                    OBTAIN UCS IMAGE ADDR           22500020
         AR    RD,RWK1                  ADD NO. OF LINES TO GET  Y02072 22600002
*                                          IMAGE                 Y02072 22700002
*********************************************************************** 22800020
*                                                                       22900020
*   EXCP TO DISPLAY HEADING 'UCS IMAGE VERIFICATION - YYYY'             23000020
*                                                                       23100020
*********************************************************************** 23200020
*                                                                       23300020
*   CONSTRUCT CCW  TO SKIP TO NEW LINE                                  23400020
*                                                                       23500020
         MVI   DXCCW1+K7,ONEMASK        MOVE LENGTH=1                   23600020
         MVI   DXCCW1+K4,SILIMASK       SET SILI AND CC ON              23700020
         MVI   DXCCW1,SKIPCCW           SET COMMAND CODE=SKIP TO CH 1   23800020
*                                                                       23900020
*   CONSTRUCT CCW TO PRINT HEADING                                      24000020
*                                                                       24100020
         MVI   DXCCW2+K4,SILLCCW        SET SILI FLAG ON                24300020
*                                                                       24400020
         LA    RWK6,MSGAREA             LOAD PRINT AREA ADDR     Y02072 24500002
         ST    RWK6,DXCCW2              STORE DATA ADDR=MESSAGE  Y02072 24600002
         MVI   DXCCW2,WRITECCW          PRINT A LINE - 2 SPACES AFTER   24700020
*                                                                       24800020
*   MOVE UCS NAME TO BE PRINTED                                         24900020
*                                                                       25000020
         LA    RWK6,FILLINHD            RETURN ADDRESS           Y02072 25202002
         LA    RWK3,HEADING2            MESSAGE NO FOR MSG RTN   Y02072 25210002
         TM    DXUCSOPT,FOLDMASK        FOLD SPECIFIED           Y02072 25212002
         BO    GETMSG                   YES, GO GET HEADING      Y02072 25222002
         LA    RWK3,HEADING1            NO, GET OTHER HEADING    Y02072 25224002
         B     GETMSG                   GO GET HEADING           Y02072 25226002
         USING MSGENTRY,RWK2                                     Y02072 25276002
FILLINHD EQU   *                        FILL IN HEADING          Y02072 25499302
         IC    RWK7,MSGOFF1             OFFSET TO FIRST VAR FLD  Y02072 25499402
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF FIRST VAR FLD Y02072 25499502
         MVC   0(UCSIMLNG,RWK3),DXUCSID  UCS IMAGE ID TO MSG     Y02072 25503702
         IC    RWK7,MSGLNG              LENGTH OF MESSAGE - 1    Y02072 25512202
         LA    RWK7,1(RWK7)             GET TRUE LENGTH OF MSG   Y02072 25522202
         STC   RWK7,DXCCW2+7            LENGTH TO CCW BYTE CNT   Y02072 25524202
         DROP  RWK2                                              Y02072 25524802
         LA    RDEB,PRTEXCP1            GET ADDRESS OF PRTEXCP1         25537402
         DROP  RDEB                                                     25550001
*                                                                       26300020
*                                                                       26400020
WRITEGO  EQU   *                                                        26500020
*                                                                       26600020
*                                                                       26700020
*   EXCP/WAIT                                                           26800020
*                                                                       26900020
         LA    RF,DXIOB                 LOAD IOB ADDR                   27000020
         EXCP  (1)                      EXCP ON PRINT HEADING           27100020
*                                                                       27200020
         WAIT  ECB=DXECB                WAIT ON ABOVE EXCP              27400003
*                                                                       27500020
*   TEST COMP.CODE.IF THERE IS I/O ERROR GOTO ABEND.                    27600020
*                                                                       27700020
         TM    DXECB,X7F                TEST IF COMP.CODE=X7F           27800020
         BNO   CKRTYERR                 IF NOT GO CK FOR RETRYABLE ERR  27900020
*                                                                       28000020
*                                                                       28100020
         BR    RDEB                     BRANCH TO ADDRESS IN REG 11     28200020
*                                                                       28300020
*********************************************************************** 28400020
*                                                                       28500020
PRTEXCP1 EQU   *                                                        28600020
*                                                                       28700020
*********************************************************************** 28800020
*                                                                       28900020
*   EXCP ON PRINTER TO PRINT UCS SET                                    29000020
*                                                                       29100020
*********************************************************************** 29200020
*                                                                       29300020
*   CONSTRUCT CCW TO EXCP                                               29400020
*                                                                       29500020
         MVI   IOBFLAG1,UNRLBMSK        SET UNRELATED BIT ON            29600020
         SR    RDEB,RDEB                ZERO OUT REG 11                 29700020
         IC    RDEB,NULL(RC)            INSERT # CHARACTER PER LINE     29800020
*                                                                       29900020
WRITEUCS EQU   *                                                        30000020
*                                                                       30100020
         ST    RD,DXCCW1                STORE UCS WORK AREA ADDR IN CCW 30200020
         ST    RDEB,DXCCW1+K4           STORE RECORD LENGTH IN CCW      30300020
         MVI   DXCCW1+K4,SILLCCW        SET SILI ON                     30400020
         MVI   DXCCW1,WRITECCW          SET COMMAND CODE=PRINT/2 SPACE  30500020
*                                                                       30600020
*   GO ISSUE EXCP TO WRITE A LINE                                       30700020
*                                                                       30800020
         BAL   RDEB,WRITEGO             GO ISSUE EXCP                   30900020
*                                                                       31000020
         SR    RDEB,RDEB               ZERO OUT REG FOR CHARS THIS LINE 31100003
         IC    RDEB,NULL(RC)            INSERT = CHARACTERS/LINE        31200020
*                                                                       31300020
         AR    RD,RDEB                  MODIFY UCSWORK AREA             31400020
         LA    RC,ONEMASK(RC)           INCREMENT REG. BY 1             31500020
         IC    RDEB,NULL(RC)            INSERT NO. OF CHAR/LINE         31600020
*                                                                       31700020
         BCT   RWK1,WRITEUCS            REPEAT N=RWK1  TIMES.    Y02072 31800002
*                                                                       31900020
         MODESET EXTKEY=DATAMGT         GET BACK IN OUR KEY    @ZA02191 31950003
*                                                                       32000020
*********************************************************************** 32100020
*                                                                       32200020
*   SKIP TO NEW PAGE                                                    32300020
*                                                                       32400020
*********************************************************************** 32500020
*                                                                       32600020
         MVI   DXCCW1+K7,ONEMASK        MOVE LENGTH = 1                 32700020
         MVI   DXCCW1,SKIPCCW           SET COMMAND CODE  = SKIP        32800020
*                                                                       32900020
*   GO ISSUE EXCP TO SKIP TO CHANNEL 1                                  33000020
*                                                                       33100020
         BAL   RDEB,WRITEGO             GO ISSUE SKIP TO CH 1 CCW       33200020
*                                                                       33300020
*********************************************************************** 33900020
*                                                                       34100020
*   WTOR 'IEC121D V XXX,YYYY' TO REQUEST OPERATOR REPLY                 34200020
*                                                                       34300020
*********************************************************************** 34400020
*                                                                       34500020
*                                                                       34600020
*                                                                       34700020
         LA    RWK6,MSG121              RETURN ADDRESS           Y02072 34750002
         TM    DXUCSOPT,FOLDMASK        TEST IF LOAD MODE FOLD   Y02072 34800002
         LA    RWK3,MSG121D2            MESSAGE NO FOR MSG RTN   Y02072 35250002
         BNO   GETMSG                   YES, GO GET MESSAGE      Y02072 35300002
         LA    RWK3,MSG121D1            MESSAGE NO FOR MSG RTN   Y02072 35350002
         B     GETMSG                   NO, GO GET MESSAGE       Y02072 35400002
MSG121   EQU   *                        FILL IN VARIABLE FIELDS  Y02072 35450002
         USING MSGENTRY,RWK2                                     Y02072 35460002
         IC    RWK7,MSGOFF1             OFFSET TO VAR FLD ONE    Y02072 35500002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD ONE   Y02072 35550002
         MVC   0(L'UCBNAME,RWK3),UCBNAME DEV NAME TO MESSAGE     Y02072 35600002
         IC    RWK7,MSGOFF2             OFFSET TO VAR FLD TWO    Y02072 35650002
         DROP  RWK2                                              Y02072 35660002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD TWO   Y02072 35700002
         MVC   0(UCSIMLNG,RWK3),DXUCSID  UCS IMAGE TO MSG        Y02072 35710002
MESSAGO  EQU   *                                                   DM0Q 36300020
         XC    RPLY(24),RPLY            CLEAR REPLY AREA AND ECB M5143  36500020
*                                                                       36700020
         WTOR  MF=(E,REPLYLTH)          ISSUE WTOR SVC                  36800003
*                                                                       36900020
         WAIT  ECB=RPLYECB,LONG=YES         WAIT FOR WTOR        Y02072 37100003
*                                                                       37200020
*   REPLY ANALYSIS                                                      37300020
*                                                                       37400020
         OC    RPLY(K8),LOMASK          OR TO ALLOW LOWER CASE   M5143  37500020
*                                       ALPHA                    M5143  37600020
         L     RB,DXREGSV               REINIT POINTER TO IMAGE  Y02072 37650002
*                                         IN CASE WE MUST RETRY  Y02072 37660002
         CLC   RPLY(L'RETRYCN),RETRYCN  TEST IF REPLY='RETRY'    M5143  37700003
         BC    K8,VRFYUCS               IF YES GO BACK TO RE-VERIFY     37800020
         CLC   RPLY(L'CANCELCN),CANCELCN  TEST IF REPLY='CANCEL' M5143  37900003
         BC    K8,ABEND04               IF YES,GO ABEND                 38000020
*                                                                       38100020
*                                                                       38200020
         CLC   RPLY(L'OKCN),OKCN        TEST IF REPLY='VERIFIED' M5143  38260003
         BC    K8,UPDTUCB               IF YES GO UPDATE UCB            38400020
*                                                                       38500020
         CLC   RPLY(K2),RBLANK          TEST IF REPLY='R '       M5143  38600020
         BC    K8,VRFYUCS               IF YES GO VERIFY UCS IMAGE      38700020
*                                                                       38800020
         CLC   RPLY(K2),CBLANK          TEST IF REPLY='C '       M5143  38900020
         BC    K8,ABEND04               IF YES GOTO ABEND ROUTINE       39000020
*                                                                       39100020
         CLC   RPLY(K2),VBLANK          TEST IF REPLY='V '       M5143  39200020
         BC    K8,UPDTUCB               IF YES GO UPDATE UCB            39300020
*                                                                       39400020
*********************************************************************** 40000020
*                                                                       40100020
*   WTO 'IEC125I ERROR - REPEAT REPLY'                                  40200002
*                                                                       40300020
*********************************************************************** 40400020
*                                                                       40500020
         LA    RWK6,MESSAGO             RETURN ADDRESS           Y02072 40550002
         LA    RWK3,MSG125              MESSAGE NO FOR MSG CSECT Y02072 40600002
         B     GETMSG                   GO GET MESSAGE           Y02072 40650002
*                                                                       41000020
*********************************************************************   41100020
*                                                                       41200020
*   ROUTINE TO CHECK FOR RETRYABLE ERROR AND SKIP TO 0 TO RESET         41300020
*   THE CONTROL UNIT 2811                                               41400020
*                                                                       41500020
*********************************************************************   41600020
*                                                                       41700020
CKRTYERR EQU   *                                                        41800020
*                                                                       41900020
         CLI   UCBTBYT4,PRTM3211        CK IF DCB BEING OPENED FOR 3211 42000020
         BNE   ABEND10                  NO GO SET RC=10 AND ABEND       42100020
         TM    IOBCSW+4,IOBUNCHK        UNIT CHECK CONDITION     Y02072 42150002
         BZ    ABEND10                  NO, DON'T TEST SENSE     Y02072 42170002
         TM    IOBSENS1,RETRYMSK        CK FOR RETRYABLE ERROR   Y02072 42180002
         BNO   ABEND10                  NO GO SET RC=10 AND ABEND       42500020
         TM    IOBSENS0,BUFPARMK        CK FOR BUFFER PARITY ERR Y02072 42550002
         BNO   SKIPCH0                  NO GO SKIP CH 0                 42700020
         L     RJ,UCBXTADR              YES GET ADDR OF UCB EXTENTION   42800020
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 42850002
         OI    UCSOPOFS(RJ),BUFPARER    SET UCS BUF PARITY ERR BIT      42900020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 42950002
*                                                                       43000020
SKIPCH0 EQU    *                                                        43100020
*                                                                       43200020
         MVI   DXCCW1+K7,ONEMASK        SET LENGTH FIELD TO 1           43300020
         MVI   DXCCW1+K4,SILLCCW        SET SILI                        43400020
         MVI   DXCCW1,CMDSKP0           MOVE IN SKIP TO 0 COMMAND CODE  43500020
         LA    RF,DXIOB                 GET ADDR FOR EXCP               43600020
         EXCP  (1)                      ISSUE EXCP TO SKIP TO CH 0      43700020
*                                                                       43800020
*********************************************************************** 43900020
*                                                                       44000020
ABEND10  EQU   *                                                        44100020
*                                                                       44200020
*********************************************************************** 44300020
*                                                                       44400020
*   PERMANENT I/O ERROR DURING PRINTING VERIFICATION LINES.             44500020
*   RETURN CODE = X'10' IN REG. 15                                      44600020
*   IF THE I/O ERROR PERSISTS,RUN C.E. DIAGNOSTICS ON THE PRINTER       44700020
*                                                                       44800020
*********************************************************************** 44900020
*                                                                       45000020
         LA    RB,OABD067               LOAD INTERNAL CODE 67    M0099  45100021
         B     UPUCBEND                 GO TO UPDATE UCB AND EXIT       45200003
*                                                                       45300020
*********************************************************************** 45400020
*                                                                       45500020
ABEND04  EQU   *                                                        45600020
*                                                                       45700020
*********************************************************************** 45800020
*                                                                       45900020
*   REQUESTED CHAIN SET WAS NOT AVAILABLE. JOB STEP WAS CANCELLED BY    46000020
*   AN OPERATOR. RETURN CODE = X'14' IN REG.15                          46100020
*   RERUN THE JOB WITH THE CORRECT CHAIN/TRAIN                          46200020
*                                                                       46300020
*********************************************************************** 46400020
*                                                                       46500020
         LA    RB,OABD068               LOAD INTERNAL CODE 68    M0099  46600021
*                                                                       46700020
*********************************************************************** 46800020
*                                                                       46900020
UPUCBEND EQU   *                                                        47000020
*                                                                       47100020
*********************************************************************** 47200020
*                                                                       47300020
*   UPDATE THE UCB WITH X'00' TO INDICATE THAT THE IMAGE IN THE BUFFER  47400020
*   IS NOT USABLE                                                       47500020
*                                                                       47600020
*********************************************************************** 47700020
*                                                                       47800020
         L     RJ,UCBXTADR              GET ADDRESS OF UCB EXTENTION    47900020
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 47950002
         SPACE                                                          47960003
         XC    0(L'UCBUCSID+L'UCBUCSOP,RJ),0(RJ)  RESET UCS ID/OPT      48000003
         SPACE                                                          48010003
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 48050002
         SPACE                                                          48100002
*                                                                       49800020
*********************************************************************** 49900020
*                                                                       50000020
*   DELETE THE UCS IMAGE LOADED                                         50100020
*                                                                       50200020
*********************************************************************** 50300020
*                                                                       50400020
         LA    RE,DXSAVUCS              LOAD ADDR OF IMAGE ID    Y02072 50450002
*                                         LOADED                 Y02072 50460002
         DELETE EPLOC=(0)                                               50600020
         NI    FCAOPEN2,X'FF'-FCAOUCSL  INDIC UCS IMAGE DELETED  YM4697 50650002
*                                                                       51100020
*********************************************************************** 51200020
*                                                                       51300020
*   ABEND ROUTINE.COMPLETION CODE=B13.RETURN CODE IS IN REG15.          51400020
*                                                                       51500020
*********************************************************************** 51600020
*                                                                       51700020
         TM    DXCCW11+K2,ABENDBIT      TEST IF ABEND IS IN PROCESS     51800020
         BO    UCSEXIT                  IF YES,GOTO EXIT ROUTINE        51900003
         L     RPARC,DXREGSV+4          RELOAD REG FOR PROB DET  YM2424 51950002
*                                                                       52000020
*   WE DO NOT WANT TO SAVE REGISTER 9 AT DXREG9, WHERE PROBLEM          52050003
*   DETERMINATION ROUTINES ARE EXPECTING IT, BECAUSE THE ADDRESS        52100003
*   OF THE SYS1.IMAGELIB DCB IS ALREADY THERE.                          52150003
         STM   RUCB,RD,DXREGA           SAVE REGS 10 TO 14     @ZA05553 52160003
*                                                                       52170003
         DMABCOND (RB),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=NO    @ZA05553 52200003
         B     TCTLRTN                                           M0099  52400021
*                                                                       52600020
*********************************************************************** 52700020
*                                                                       52800020
*********************************************************************** 52900020
*                                                                       53000020
UPDTUCB  EQU   *                                                        53100020
*                                                                       53200020
*********************************************************************** 53300020
*                                                                       53400020
*   UPDATE UCB - UCS FIELDS                                             53500020
*                                                                       53600020
*********************************************************************** 53700020
*                                                                       53800020
         L     RWK7,UCBXTADR            GET ADDRESS OF UCB EXT   Y02072 53900002
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 53950002
         SPACE                                                          53960002
         USING UCBUCS,RWK7                                       Y02072 53962002
         MVC   UCBUCSID,DXUCSID         MOVE UCS IM ID TO UCB    Y02072 53964002
         MVC   UCBUCSOP,DXUCSOPT        MOVE UCS OPT BITS TO UCB Y02072 53966002
         OC    UCBUCSOP,0(RB)           SET DEBAULT BIT IF ANY   Y02072 53968002
         NI    UCBUCSOP,RESETMSK        RESET VERIFY IF ANY      Y02072 53968402
         DROP  RWK7                                              Y02072 54018402
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 54350002
         SPACE                                                          54400002
*                                                                       55800020
*********************************************************************** 55900020
*                                                                       56000020
*   DELETE UCS IMAGE                                                    56100020
*                                                                       56200020
*********************************************************************** 56300020
*                                                                       56400020
         LA    RE,DXSAVUCS              LOAD ADDR OF ENTRY PT    Y02072 56550002
*                                                                       56600020
         DELETE EPLOC=(0)               DELETE UCS IMAGE                56700020
         NI    FCAOPEN2,X'FF'-FCAOUCSL  INDIC UCS IMAGE DELETED  YM4697 56750002
*                                                                       56800020
*********************************************************************** 56900020
*                                                                       57000020
*********************************************************************** 57100020
*                                                                       57200020
UCSEXIT  EQU   *                                                        57300020
*                                                                       57400020
         CLI   UCBTBYT4,PRTM3211        IF 1403, NO FCB          Y02072 57450002
         BNE   RESTERPT                 EXIT FOR 1403            Y02072 57500002
         TM    DXFCBSW1,IEC129RQ        CK IF IEC129 MSG REQ     Y02072 57650002
         BZ    XCTL197E                 NO GO LOAD FCB IN 197E   Y02072 58100002
*                                                                       58200020
**********************************************************************  58300020
*                                                                       58400020
*        ISSUE MESSAGE IEC129 AND XCTL TO IGG0197E                      58500002
*                                                                       58600020
**********************************************************************  58700020
*                                                                       59000020
         LA    RWK3,MSG129              MESSAGE NO FOR MSG RTN   Y02072 59050002
         BAL   RWK6,GETMSG              GO GET MESSAGE           Y02072 59060002
         USING MSGENTRY,RWK2                                     Y02072 59070002
         IC    RWK7,MSGOFF1             OFFSET TO VAR FLD ONE    Y02072 59110002
         DROP  RWK2                                              Y02072 59120002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD ONE   Y02072 59160002
         MVC   0(L'UCBNAME,RWK3),UCBNAME DEV NAME TO MSG         Y02072 59210002
         XC    RPLY(24),RPLY            ZERO OUT REPLY AREA AND  M5143  59440020
*                                       ECB                      M5143  59520020
         WTOR  MF=(E,REPLYLTH)          GET ADDR FOR WTOR               59600003
*                                                                       59800020
XCTL197E EQU   *                                                        59900020
*                                                                       60000020
         LA    RF,MODNM7E               GET IDTTR ADDR OF IGG3197E      60100020
         B     MVEIDTTR                 GO TO WTG SEQ                   60200020
*********************************************************************** 61200020
*                                                                       61300020
*   RESTORE DCB EROPT                                                   61400020
*                                                                       61500020
*********************************************************************** 61600020
*                                                                       61700020
RESTERPT EQU   *                                                        61800020
*                                                                       61900020
         MVC   DXCCW6(1),DXEROPT        RESTORE EROPT            Y02072 62150002
*                                                                       62300020
*   SEE IF SYS1.IMAGELIB HAS BEEN OPENED IF YES CLOSE IT                62400020
*                                                                       62450002
         CLI   DXIMGDCB,IMCLOSED        CK IF IMGLIB CLOSED      Y02072 62460002
         BE    TSTEXCP                  IF NOT GO TEST IF EXCP SPECIFED 62600020
         L     RF,DXIMGDCB              GET ADDR OF IMGLIB DCB   Y02072 62650002
         SVC   105                      ISSUE SVC TO CLOSE SYS1.IMAGELI 62800020
*                                                                       62900020
         NI    FCAOPEN2,X'FF'-FCAOIMGL  INDIC IMAGELIB CLOSED    YM4697 62950002
*                                                                       63000020
*********************************************************************** 63100020
*                                                                       63200020
*   DETERMINE THE NEXT STAGE 2 EXECUTOR TO BE XCTLED                    63300020
*                                                                       63400020
*********************************************************************** 63500020
*                                                                       63600020
TSTEXCP  EQU   *                                                        63700020
*                                                                       63800020
*********************************************************************** 63900020
*                                                                       64000020
*   TEST IF EXCP IS SPECIFIED.IF YES,XCTL TO THE LAST OPEN EXECUTOR     64100020
*                                                                       64200020
*********************************************************************** 64300020
*                                                                       64400020
         LA    RF,MODNM11               GO DO DCB COPY BACK      Y02072 64450003
         TM    DCBMACRF,EXCPMASK        TEST IF EXCP IS SPECIFIED       64500020
         BO    MVEIDTTR                 GOTO WTG TABLE UPDATE   Y02072  64900003
*                                                                       65400020
*********************************************************************** 65500020
*                                                                       65600020
*   TEST IS BUFFER CONTROL BLOCK IS SPECIFIED.IF YES,XCTL TO IGG0911I   65700020
*                                                                       65800020
*********************************************************************** 65900020
*                                                                       66000020
         TM    DCBBUFNO+3,BFCNTRL       BUFFER CONTROL BLOCK SPECIFIED  66100003
         BZ    TSTCHAIN                 IF YES,GOTO TEST PCI ROUTINE    66200003
*                                                                       66300020
         CLI   DCBBUFNO,0               SEE IF BUFFERS REQUESTED        66500003
         BE    TSTCHAIN                 IF YES, GO TEST CHAINED SCHED.  66700003
*                                                                       66800020
         LA    RF,MODNM1I               LOAD ADDR OF IDTTR OF IGG0191I  66900020
         B     MVEIDTTR                 GO TO MOVE IDTTR ROUTINE        67000003
*                                                                       67100020
*********************************************************************** 67200020
*                                                                       67300020
TSTCHAIN EQU   *                                                        67400003
*                                                                       67500020
*********************************************************************** 67600020
*                                                                       67700020
*   TEST IF CHAINED SCHEDULING IS REQUESTED.  IF YES, XCTL TO IGG0191Q. 67800003
*                                                                       67900020
*********************************************************************** 68000020
*                                                                       68100020
         LA    RF,MODNM1Q               LOAD ADDR OF IDTTR OF IGG0191Q  68150003
         TM    DCBOPTCD,DCBOPTC         TEST IF CHAINED SCHED REQUESTED 68200003
         BO    MVEIDTTR                 GO TO MOVE IDTTR ROUTINE        68600003
*                                                                       69100020
*********************************************************************** 69200020
*                                                                       69300020
*   BSAM/QSAM EXIT.XCTL TO IGG0191G                                     69400020
*                                                                       69500020
*********************************************************************** 69600020
*                                                                       69700020
         LA    RF,MODNM1G               LOAD ADDR OF IDTTR IF IGG0191G  69800020
*                                                                       69900020
*********************************************************************** 70000020
*                                                                       70100020
MVEIDTTR EQU   *                                                        70200020
*                                                                       70300020
*********************************************************************** 70400020
*                                                                       70500020
*   MOVE IDTTR TO XCTL WTG TABLE                                        70600020
*                                                                       70700020
*********************************************************************** 70800020
*                                                                       70900020
         USING WTGENTRY,RWTGC                                    Y02072 70950002
         MVC   WTGIDTTR,0(RF)           ST NEXT MOD ID IN WTG  @Z30TSCF 70960003
         L     RWK1,DXREGSV+4           RESTORE REGISTER         Y02072 71050002
*                                                                       71100020
*********************************************************************** 71200020
*                                                                       71300020
RELOOP   EQU   *                                                        71400020
*                                                                       71500020
*********************************************************************** 71600020
*                                                                       71700020
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            71800020
*                                                                       71900020
*********************************************************************** 72000020
*                                                                       72100020
         LA    RWTGC,WGOFF(K0,RWTGC)    INCREMENT CURRENT WTG ENTRY     72200020
         LA    RPARC,PLOFF(K0,RPARC)    INCREMENT CURRENT DCB ENTRY     72300020
         CLC   K0(K2,RWTGC),AMIDCNST    IS THE RTN NEEDED AGAIN         72400020
         BCR   K8,RBASE                 IF YES,RETURN TO PROCESS        72500020
*                                                                       72600020
         CLC   K0(K2,RWTGC),OPIDCNST    TEST END OF WTG TABLE           72700020
         BC    K7,RELOOP                IF NOT,CHECK NEXT ENTRY         72800020
*                                                                       72900020
         LR    RPARC,RPAR               RESET REG TO '0'                73000020
         LA    RWTGC,WAOFF(K0,RWTG)     RESET WTG REG TO POINT +32(WTG) 73100020
*                                                                       73200020
ZCHECK   EQU   *                                                        73300020
*                                                                       73400020
         CLI   K0(RWTGC),K0             TEST IF THIS ENTRY COMPLETE     73500020
         BC    K7,TCTLRTN               IF NOT,XCTL                     73600020
*                                                                       73700020
         LA    RWTGC,WGOFF(K0,RWTGC)    GET NEXT ENTRY OF WTG TABLE     73800020
         LA    RPARC,PLOFF(K0,RPARC)    GET NEXT ENTRY OF DCB           73900020
         B     ZCHECK                   GO TO TEST COMPLETION           74000003
*                                                                       74100020
TCTLRTN  EQU   *                                                        74200020
*                                                                       74300020
         USING WTG,RWTG                                                 74350003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*74400003
               MODID=WTGENTRY                                  @Z30TSCF 74450003
         DROP  RWTGC,RWTG                                      @Z30TSCF 74500003
         EJECT                                                          74950002
*********************************************************************** 74960002
*  'GETMSG' SUBROUTINE                                           Y02072 74970002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 74980002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 74990002
*                                                                       74992002
*    INPUT TO THIS ROUTINE:                                      Y02072 74994002
*      REG 9 - MESSAGE NUMBER IN CSECT                           Y02072 74996002
*      REG 12 - RETURN ADDRESS                                   Y02072 74998002
*                                                                       74998402
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 74998802
*      REG 1 - POINTER TO MESSAGE ENTRY IN THE MESSAGE CSECT     Y02072 74999202
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 74999602
*********************************************************************** 74999702
GETMSG   EQU   *                        ENTRY POINT, MSG RTN     Y02072 74999802
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 74999902
         LH    RWK2,0(RWK7,RWK3)        GET INDEX TO MESSAGE     Y02072 75033202
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 75043202
         USING MSGENTRY,RWK2                                     Y02072 75053202
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 75063202
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 75065202
*                                         ENTRY                  Y02072 75065602
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 75066002
         USING MSGTXTD,RWK3                                      Y02072 75066402
         SR    RWK7,RWK7                PREPARE REG FOR RETURN   Y02072 75066502
         IC    RWK7,MSGLNG              LEN OF MSG - 1           Y02072 75066602
         EX    RWK7,MVCINST             MOVE MESSAGE TO AREA     Y02072 75077702
         BR    RWK6                     RETURN                   Y02072 75087702
MVCINST  MVC   MSGAREA(0),MSGTXT        EXECUTED BY A EX INST    Y02072 75088102
         EJECT                                                          75088502
*                                                                       75088902
*********************************************************************** 75100020
*                                                                       75200020
*********************************************************************** 75300020
*                                                                       75400020
*   CONSTANTS                                                           75500020
*                                                                       75600020
*********************************************************************** 75700020
*                                                                       75800020
*   FOR WTG TABLE                                                       75900020
*                                                                       76000020
OPIDCNST DC    C'0S'                    END OF WTG TABLE ID             76100020
AMIDCNST DC    C'7U'                    MODUE ID                        76200020
*                                                                       77800020
*   REPLY CONSTANT                                                      77900020
*                                                                       78000020
RETRYCN  DC    C'RETRY'                REPLY = 'RETRY'                  78100003
CANCELCN DC    C'CANCEL'               REPLY = 'CANCEL'                 78200003
OKCN     DC    C'VERIFIED'             REPLY = 'VERIFIED'               78300003
CBLANK   DC    C'C '                    REPLY = 'C'                     78400020
RBLANK   DC    C'R '                    REPLY = 'R'                     78500020
VBLANK   DC    C'V '                    REPLY = 'V'                     78600020
*                                                                       78800020
*********************************************************************** 78900020
*                                                                       79000020
*   XCTL TABLE                                                          79100020
*                                                                       79200020
*********************************************************************** 79300020
*                                                                       79400020
MODNM11  DC    C'11',VL3(IGG01911)      MODULE IGG01911        @Z30TSCF 79402003
MODNM1G  DC    C'1G',VL3(IGG0191G)      MODULE IGG0191G        @Z30TSCF 79404003
MODNM1I  DC    C'1I',VL3(IGG0191I)      MODULE IGG0191I        @Z30TSCF 79406003
MODNM1Q  DC    C'1Q',VL3(IGG0191Q)      MODULE IGG0191Q        @Z30TSCF 79408003
MODNM7E  DC    C'7E',VL3(IGG0197E)      MODULE IGG0197E        @Z30TSCF 79408403
PDLOAD   DC    C'6M',VL3(IGG0196M)      MODULE IGG0196M        @Z30TSCF 79409203
         SPACE                                                          79409602
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 79459602
END      EQU   *                        END OF THIS MODULE       Y02072 79559602
*                                                                       81000020
*   DSECTS                                                              81100003
*                                                                       81200020
*********************************************************************** 81300020
*                                                                       81400020
*                                                                       81500020
         DCBD  DSORG=PS,DEVD=PR                                         81600003
*                                                                       81700020
*********************************************************************** 81800020
*                                                                       81900020
         EJECT                                                          81950002
         IGGMSG                                                  Y02072 81960002
         EJECT                                                          81970002
CVT      DSECT                                                 @Z30TSCF 81972003
         CVT                                                   @Z30TSCF 81974003
         EJECT                                                          81976003
         IECDSECS  WTG,PREFX,EXPAND=YES                        @Z30TSCF 81980003
         ORG   WTGIDTTR                                          Y02072 81982002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 81984002
         EJECT                                                          81990002
         IECDSECS MAIN,EXPAND=YES                                M0099  82000021
         ORG   REPLYLTH+52                                       M5143  82110020
RPLY     DS    20C                                               M5143  82120020
RPLYECB  DS    F                                                 M5143  82130020
MCSMASK  DS    H                                                 M5143  82140020
LOMASK   DS    8C                                                M5143  82150020
UCSID    DS    4C                                                M5143  82160020
         ORG   MSGLSTSZ                                          Y02072 82170002
MSGAREA  DS    0CL64                    AREA TO MOVE 64 BYTES    Y02072 82180002
*                                         TO FOR WTO/WTOR'S      Y02072 82190002
DXREGSV  EQU   DXXCTL                   WORD TO SAVE REGISTER    Y02072 82192002
         EJECT                                                          82194002
         IGGSCW                                                  Y02072 82196002
         EJECT                                                          82198002
         IHAFCAUD  ORG=YES                                       YM4697 82198402
         EJECT                                                          82198802
*                                                                       82200020
*********************************************************************** 82300020
*                                                                       82400020
SRT      DSECT                                                          82500020
         IEFUCBOB                                                       82600020
*                                                                       82700020
*********************************************************************** 82800020
*                                                                       82900020
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          83000020
DEB      DSECT                                                          83100020
DEBNMSUB DS    0CL1                                                     83200020
DEBTCBAD DS    CL4                                                      83300020
DEBAMLNG DS    0CL1                                                     83400020
DEBDEBAD DS    CL4                                                      83500020
DEBOFLGS DS    0CL1                                                     83600020
DEBIRBAD DS    CL4                                                      83700020
DEBOPATB DS    0CL1                                                     83800020
DEBSYSPG DS    CL4                                                      83900020
DEBNMEXT DS    0CL1                                                     84000020
DEBUSRPG DS    CL4                                                      84100020
DEBPRIOR DS    0CL1                                                     84200020
DEBECBAD DS    CL4                                                      84300020
DEBPROTG DS    0CL1                                                     84400020
DEBDEBID DS    0CL1                                                     84500020
DEBDCBAD DS    CL4                                                      84600020
DEBEXSCL DS    0CL1                                                     84700020
DEBAPPAD DS    CL4                                                      84800020
DEBDVMOD DS    0CL1                                                     84900020
DEBUCBAD DS    CL4                                                      85000020
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     85100020
DEBBINUM DS    CL2                                                      85200020
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   85300020
DEBSTRCC DS    CL2                                                      85400020
DEBSTRHH DS    CL2                                                      85500020
DEBENDCC DS    CL2                                                      85600020
DEBENDHH DS    CL2                                                      85700020
DEBNMTRK DS    CL2                                                      85800020
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          85900020
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              86000020
DEBVOLSQ DS    H                                                        86100020
DEBVOLNM DS    H                                                        86200020
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     86300020
DEBSUBID DS    H                                                        86400020
*                                                                       86500020
*********************************************************************** 86600020
*                                                                       86700020
         END                                                            86800020
./  ADD  SSI=43090081,NAME=IGG0199K
         TITLE 'IGG0199K  DA, SEARCH DIRECT AND TRK OVFLOW EXEC'        00010002
         MACRO                                                          00020020
&NAME    IF    &A,&IS=,&ISNOT=,&GOTO=                                   00040020
         LCLB  &NOERR                                                   00060020
&NOERR   SETB  1                                                        00080020
         AIF   ('&A' NE '').SKIP                                        00100020
         MNOTE 'TEST  ADDRESS NOT SPECIFIED.'                           00120020
&NOERR   SETB  0                                                        00140020
.SKIP    AIF   ('&GOTO' NE '').SKIP2                                    00160020
         MNOTE 'BRANCH ADDRESS MISSING.'                                00180020
&NOERR   SETB  0                                                        00200020
.SKIP2   AIF   ('&IS' NE '' OR '&ISNOT' NE '').SKIP3                    00220020
         MNOTE 'TEST CONDITION NOT SPECIFIED.'                          00240020
&NOERR   SETB  0                                                        00260020
.SKIP3   AIF   (&NOERR).SKIP4                                           00280020
         MEXIT                                                          00300020
.SKIP4   AIF   ('&IS' EQ '').NOIS                                       00320020
***                                                                     00340020
&NAME    TM    &A,&IS                                                   00360020
         BO    &GOTO                                                    00380020
***                                                                     00400020
         MEXIT                                                          00420020
.NOIS    ANOP                                                           00440021
***                                                                     00460020
&NAME    TM    &A,&ISNOT                                                00480020
         BZ    &GOTO                                                    00500020
***                                                                     00520020
         MEND                                                           00540020
IGG0199K CSECT                                                          00560020
*                                                                       00580020
*MODULE NAME - IGG0199K                                          Y02072 00610002
*                                                                       00620002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00620402
*                                                                       00620802
*COPYRIGHT - NONE                                                Y02072 00621202
*                                                                       00621602
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00621702
*                                                                       00622002
*          VS2 RELEASE 1.6 DELETIONS                                  * 00622502
*105200-105400,105800-106000                                    SA51532 00623002
*                                                                     * 00623502
*          VS2 RELEASE 2 DELETIONS                               Y02072 00624002
*006360,060090-060120,062800,075700,110340,126040,060020-060060, Y02072 00624402
*060150,099450,102700,106200-106600,107000,133500,136100-136200, Y02072 00624802
*137700,120200,120350,124400-124800,125400,126600-127200,        Y02072 00625202
*128200-128400                                                   Y02072 00625602
*                                                                YM1378 00625702
*                                                                YM1158 00625802
*                                                                YM3176 00625902
*                                                                YM2424 00628702
*                                                                YM4640 00628802
*                                                                YM7595 00630802
*                                                                       00631203
*          VS2 RELEASE 3 DELETIONS                                      00631603
*                                                              @Z30TSCF 00631703
*                                                                       00632002
*          RELEASE 20 DELETIONS                                       * 00634802
*                                                                S20201 00637602
*          RELEASE 21 DELETIONS                                       * 00640402
*0340043000,075680,110330,120000,125000,127600-128000,132900-    S21042 00643202
*0340134000,158400-158600                                        S21042 00646002
*0000127600                                                      M1821  00648802
*                                                                       00651602
*STATUS CHANGE LEVEL 002                                                00654402
*                                                                       00657202
*                                                                       00660020
* THIS EXECUTOR RUNS IN TANDEM WITH IGG0191S, WHICH COMPLETES DCB       00680020
* FIELDS THAT ARE KNOWN PRIOR TO GETTING CORE FOR THE IOB/CP'S.         00700020
*                                                                       00720020
* THE MAJOR FUNCTIONS OF THIS EXEC ARE-                                 00740020
*                                                                       00760020
* 1. STRUCTURE EACH IOB/CP WITH THE ADDRESSES AND FLAGS THAT ARE        00820002
*    KNOWN AT OPEN TIME.                                                00840020
* 2. COMPLETE THE RELATED DCB FIELDS.                                   00860002
* 3. REPEAT FOR EACH DCB BEING OPENED.                                  00880002
*                                                                       00900020
* ENTRY POINTS- FROM IGG0191S BY XCTL.                                  00920020
* EXITS- TO IGG01913 BY XCTL.                                           00940020
*                                                                       00960020
*MACROS : ACTION - MODESET, XCTL, XCTLTABL, DMABCOND             Y02072 00970002
*                                                                       00972002
*MACROS : MAPPING - IHACCW,DCBD,IGGBCB,IECDSECS(WTG),IHAFCAUD    Y02072 00974002
*                                                                       00980020
*INPUT-REGISTERS WITH THE ADDRESSES OF THE FOLLOWING-                   01000020
*   THE PARAMETER LIST  (POINTERS TO TOP AND CURRENT ENTRY).            01020020
*   THE WHERE-TO-GO TABLE (WTG) (POINTERS TO TOP AND CURRENT).          01040020
* EXTERNAL ROUTINES- NONE.                                              01060020
* ATTRIBUTES- REENTRANT, REUSABLE, SUPERVISOR STATE, RUNS IN     Y02072 01070002
*             USER KEY UNLESS OTHERWISE SPECIFIED                Y02072 01080002
* TABLES/WORKAREAS-                                                     01100020
*                                                                       01120020
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              01140020
*      BYTE  0-7  NAME                                                  01160020
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            01180020
*      BYTE 11    CONCATENATION NUMBER                                  01200020
*      BYTE 12    ZERO                                                  01220020
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       01240020
*                        ALIAS INDICATOR 1 BIT                          01260020
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      01280020
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              01300020
*      BYTE 17    ZERO                                                  01320020
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      01340020
*      BYTE 20    TRANSLATION TABLE                                     01360020
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            01380020
*      BYTE 22-23 ATTRIBUTES                                            01400020
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     01420020
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           01440020
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 01460020
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        01480020
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       01500020
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        01520020
*      BYTE 36-39 TABLE OF IDTTR'S                                      01540020
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          01560020
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          01580020
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01600020
*                   NOT USED                         (1 BYTE)           01620020
*                                                                       01640020
*    WORKAREA- SEE 'FORCORE DSECT' (IECDSECT) IN THIS LISTING           01660020
*                                                                       01680020
*TABLES/WORKAREAS- PARAMETER LIST                                       01700020
*                                                                       01720020
*WORD ZERO                                                              01740020
*      BYTE  0    OPEN ATTRIBUTE  (INPUT, OUTPUT, UPDATE, IN/OUT,       01760020
*                                  OUT/IN, READ BACKWD, LEAVE , REREAD) 01780020
*      BYTES 1-3  DCB ADDRESS FOR FIRST DCB BEING OPENED.               01800020
*                                                                       01820020
*THE PARAMETER LIST HAS A ONE WORD ENTRY FOR EACH DCB BEING OPENED. THE 01840020
*FORMAT IS THE SAME AS WORD ZERO.                                       01860020
*END PARAMETER LIST.                                                    01880020
*                                                                       01900020
* REGISTER CONVENTIONS USED IN ALL OF OPEN-                             01920020
*                                                                       01940020
RDCB     EQU   2                        DCB REGISTER                    01960020
RBASE    EQU   3                        BASE REGISTER                   01980020
RCORE    EQU   4                        I/O SUPPORT WORK AREA           02000020
RPAR     EQU   5                        TOP OF PARAMETER LIST           02100020
RBUFADR  EQU   RPAR                     MAINTAINS ADDR OF NEXT   Y02072 02110002
*                                         AVAILABLE BUFFER       Y02072 02112002
RWTG     EQU   6                        TOP OF WTG TABLE                02120020
RPARC    EQU   7                        CURRENT PARAMETER               02140020
RWTGC    EQU   8                        CURRENT LOAD IN TRANSIENT AREA  02160020
RTIOT    EQU   9                        USED AS A WORK REG              02180020
RIOB     EQU   RTIOT                    USED AS IOB BASE REG WITH THE   02200020
*                                       IOB OVERLAY FROM FORECORE.      02220020
RUCB     EQU   10                       USED AS A WORK REG              02240020
RCPSIZE  EQU   RUCB                     USED TO CALCULATE AND HOLD THE  02260020
*                                       CHANNEL PGM SIZE.               02280020
RDEB     EQU   11                       DEB BASE REG.                   02300020
RB       EQU   12                       WORK REG.                       02320020
RCPBASE  EQU   RB                       CHANNEL PGM BASE REG USED WITH  02340020
*                                       'CPSEGMAP' DUMMY SECTION.       02360020
RWK1     EQU   RB                       WORK REGISTER            Y02072 02370002
RC       EQU   13                       WORK REG.                       02380020
RSTEPPER EQU   RC                       POINTS TO THE CURRENT SEARCH    02400020
*                                       ADDRESS OR COUNT FIELD BEING    02420020
*                                       USED FOR CP CONSTRUCTION. WHEN  02440020
*                                       POINTING TO A COUNT FLD THE     02460020
*                                       'COUNTFLD' DUMMY SECTION IS     02480020
*                                       USED BASED ON THIS REG.         02500020
*                                                                       02520020
RE       EQU   0                        WORK REG. VOLATILE ACCROSS SVC. 02540020
RF       EQU   1                        WORK REG. VOLATILE ACCROSS SVC. 02560020
RWK2     EQU   RF                       WORK REGISTER            YM1378 02560402
RD       EQU   14                       WORK REG. VOLATILE ACCROSS SVC. 02580020
RWK3     EQU   RD                       WORK REG                 YM7595 02590002
RJ       EQU   15                       WORK REG. VOLATILE ACCROSS SVC. 02600020
RA       EQU   RJ                       USED AS WORK REG                02605020
RVALCHK  EQU   RA                       VALIDITY CHK CP BASEREG,        02610020
*                                       USES 'VCMAP' DSECT.             02615020
*                                                                       02620020
*                                                                       02640020
* MASK CONFIGURATIONS FOR TESTING THE HI ORDER BYTE OF EACH PARAMETER   02660020
* LIST ENTRY. SIGNIFICANCE IS THE SAME AS THE DEB OPEN ATTRIBUTE FIELD. 02680020
*                                                                       02700020
INPUT    EQU   X'0F'                    TEST MASKED BITS FOR ZEROS.     02720020
OUTPUT   EQU   X'0F'                    TEST MASKED BITS FOR ONES.      02740020
INOUT    EQU   X'03'                                                    02760020
OUTIN    EQU   X'07'                                                    02780020
RDBACK   EQU   X'01'                                                    02800020
UPDAT    EQU   X'04'                                                    02820020
LEAVE    EQU   X'10'                                                    02840020
REREAD   EQU   X'30'                                                    02860020
*                                                                       02880020
* COMMAND CODES FOR THE 2841 CONTROL UNIT.                              02900020
*                                                                       02920020
SRCHEQ   EQU   X'31'                    SEARCH EQUAL ID.                02940020
SRCHEQMT EQU   X'B1'                    SEARCH EQUAL ID IN MULTI-TRACK. 02960020
TIC      EQU   X'08'                    TRANSFER IN CHANNEL.            02980020
WCKD     EQU   X'1D'                    WRITE COUNT, KEY, AND DATA.     03000020
WSCKD    EQU   X'01'                    WRITE SPECIAL, COUNT,KEY,DATA.  03020020
SEEKCYL  EQU   X'0B'                    SEEK CYLINDER.                  03040020
READDATA EQU   X'06'                    READ DATA SINGLE TRACK.         03060020
RDDATAMT EQU   86                       MULTI-TRACK READ DATA.          03080020
READKD   EQU   14                       READ KEY AND DATA.              03100020
READCT   EQU   X'92'                    READ COUNT M/T MODE.            03120020
RDSC     EQU   X'22'                    SET THETA CCW COMMAND           03125020
SETSC    EQU   X'23'                    READ THETA CCW COMMAND          03130020
SDTIC    EQU   X'40'                    SCH DIR TIC                     03135020
*                                                                       03140020
* CHANNEL COMMAND WORD FLAGS.                                           03160020
*                                                                       03180020
SKIP     EQU   X'10'                    SKIP FLAG.                      03200020
SILI     EQU   X'20'                    SUPPRESS INCORRECT LENGTH IND.  03220020
CC       EQU   X'40'                    COMMAND CHAIN.                  03240020
DC       EQU   X'80'                    DATA CHAIN.                     03260020
SILICC   EQU   X'60'                    SILI AND CC TOGETHER            03280020
SILICCSK EQU   X'70'                    SILI, CC, AND SKIP.             03300020
* END CCW FLAGS.                                                        03320020
*                                                                       03340020
* DISPLACEMENTS  AS EQUATES                                             03341020
*                                                                       03342020
D0       EQU   0                        DISPLACEMENT OF ZERO            03343020
D1       EQU   1                        DISPLACEMENT OF ONE             03344020
D2       EQU   2                        DISPLACEMENT OF TWO             03345020
D4       EQU   4                        DISPLACEMENT OF FOUR            03346020
D6       EQU   6                        DISPLACEMENT OF SIX             03347020
D8       EQU   8                        DISPLACEMENT OF EIGHT           03348020
D12      EQU   12                       DISPLACEMENT OF TWELVE          03349020
D15      EQU   15                       DISPLACEMENT OF FIFTEEN         03350020
D16      EQU   16                  DISPLACEMENT OF 16                   03351020
CNTOFF   EQU   7                        CCW COUNT FIELD OFFSET          03352020
SXTN     EQU   16                       ADDITIONAL CHP LENGTH FOR       03353020
*                                       RECORD READY FEATURE            03354020
*                                                                       03360020
* MISCELLANEOUS ITEMS.                                                  03380020
*                                                                       03400020
COMPNOER EQU   X'7F'                   USED TO INIT. ECB.               03420020
DCANDCC  EQU   X'C0'                    USED TO SET IOBFLAG1.           03440020
IDLENGTH EQU   X'05'                    NMBR OF BYTES IN A 'CCHHR'.     03460020
POINT    EQU   X'04'                    DCBMACRF IF NOTE/POINT USED.    03480020
QSAM     EQU   X'01'                    QSAM BIT IN DCBIND2.            03500020
*                                                                       03520020
NPD2     EQU   5                        NOTE/POINT FOR PCI,UPD,T.O.     03540020
EPDT     EQU   9                        EOB FOR T.O.                    03560020
EGP2     EQU   8                        EOB FOR D.A. INPUT.             03580020
*                                                                       03600020
*                                                                       03620020
VALCHK   EQU   X'80'                    MASK TO DETERMINE IF WRITE      03640020
*                                       VALIDITY CHECK OPTION CALLED.   03660020
IOBSIZE  EQU   48                       LENGTH OF A STANDARD IOB WITH   03680020
*                                       BSAM/QSAM/BPAM EXTENSION.       03700020
IOBDBLWD EQU   6                        NMBR OF DBL WDS IN IOB.         03720020
OFFSW    EQU   24                       OFFSET OF CCW THAT WRITES DATA. 03740020
OFFSR    EQU   32                       OFFSET OF THE READ CCW THAT     03760020
*                                       RECEIVES THE BLOCK LENGTH TO    03780020
*                                       BE READ.                        03800020
CPSEGLEN EQU   32                       LENGTH OF ONE CP SEGMENT.       03820020
NOTZERO  EQU   7                        CONDITION MASK USED AFTER       03840020
*                                       ARITHMETIC INSTRUCTIONS FOR THE 03860020
*                                       NOT-ZERO TEST.                  03880020
BBCCHH   EQU   6                        MIN. SEEK LENGTH.               03900020
*                                                                       03920020
ZERO     EQU   X'00'                    AN IMMEDIATE BYTE OF ZERO'S.    03940020
B1       EQU   1                        BYTE COUNT OF ONE               03941020
ONE      EQU   1                        CONSTANT OF ONE                 03942020
TWO      EQU   2                        CONSTANT OF TWO                 03943020
B5       EQU   5                        BYTE COUNT OF FIVE              03944020
*                                                                       03945020
NORCDRY  EQU   X'20'                    NO RECORD READY MASK            03946020
RCDRYSL  EQU   48                       SEG LENGTH WHEN USING RCD       03947020
*                                       READY FEATURE                   03948020
*                                                                       03949020
*                                                                       03950020
*                                                                       03951020
VRCDS    EQU   X'40'                    V TYPE RCD MSK                  03952020
*                                                                       03953020
*                                                                       03954020
EIGHT    EQU   8                        LENGTH OF A COUNT FIELD.        03960020
ANYZERO  EQU   14                       MASK FOR MIXED OR ZEROS.        03980020
FIRST    EQU   X'01'                    USED TO SET IOB FLAG IN FIRST   04000020
*                                       IOB AND INIT. 'R'.              04020020
READCPL  EQU   40                       NMBR OF BYTES IN READ CP.       04040020
RCPDBLWD EQU   5                        NMBR OF DBL WDS IN RCP.         04060020
REMNANT  EQU   READCPL-OFFSR            OFFSR+REMNANT=READCPL.          04080020
OPCODE   EQU   0                        OFFSET OF CCW OPCODE(IN CCW).   04100020
ADDRESS  EQU   0                        OFFSET OF ADDRESS IN CCW        04120020
*                                       (IMPLIES THAT THE ADDRESS MUST  04140020
*                                       BE PUT IN BEFORE THE OP CODE)   04160020
FLAGS    EQU   4                        CCW FLAG BYTE.                  04180020
LENFLD   EQU   6                        START OF LENGTH FLD IN CCW.     04200020
U        EQU   X'C0'                    CODE FOR DCBRECFM=U             04220020
OABD062  EQU   62                                                S21042 04230021
ONEIOB   EQU   1                        USED TO CHECK FOR 1 IOB  YM1158 04230402
*                                                                       04240020
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY.       04260020
         USING SOP6,RBASE                                               04280020
         USING FORCORE,RCORE            OPEN WKAREA              S21042 04300021
         USING IHADCB,RDCB              DCB ADDRESSABILITY.             04320020
*                                                                       04340020
*                                                                       04360020
SOP6     EQU   *                                                        04380020
*                                                                       04400020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 04400102
         DC    C'IGG0199K'              MODULE NAME              YM4640 04400202
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 04400303
         DC    C'10/18/74'              LAST SHIP DATE         @Z30TSCF 04400403
BEGIN    DS    0H                       END OF MODULE ID         YM4640 04400502
         L     RDCB,0(RPARC)            GET DCB ADDRESS FROM PARM. LIST 04420020
         L     RDEB,DCBDEBAD            DEB ADDRESSABILITY.             04440020
         L     RCORE,D4(RWTGC)          GET WORK AREA ADDR              04450020
         LA    RDCB,0(RDCB)             HOUSEKEEP HI BYTE.              04480020
         ST    RPAR,DXREGSAV            SAVE REG SO IT CAN BE    Y02072 04530002
*                                         AS RBUFADR             Y02072 04580002
         SR    RUCB,RUCB                CLEAR REG                       04680020
         IC    RUCB,DCBNCP              GET NO. OF IOBS REQUIRED        04880020
         IF    DCBCIND2,ISNOT=QSAM,GOTO=SOP6L12                         05080020
         IC    RUCB,DCBBUFNO            IF QSAM USE BUFNO               05280020
SOP6L12  EQU   *                                                        05480020
         L     RIOB,DCBIOBA             GET FIRST IOB ADDRESS.          06000020
         MODESET  KEYADDR=DXUKEY,WORKREG=12 GET INTO USER KEY    Y02072 06006402
         USING SAMSIOB,RIOB            IOB ADDRESSABILITY READY.        06020020
         MVI   FLAG,FIRST               FLAG FIRST IOB             DM0I 06030020
*                                                                       06040020
BUILDIOB EQU   *                                                        06060020
*                                                                       06080020
* RIOB POINTS TO START OF AN IOB. USING THIS AS A BASE, GET THE CP      06100020
* START ADDRESS AND THE ADDRESS OF THE COUNT FIELDS AND S.A.'S.         06120020
*                                                                       06140020
*                                                                       06160020
         MVI   ECB,COMPNOER            INIT. ECB FOR QSAM.              06180020
         LA    RF,ECB                   INITIALIZE THE                  06200020
         ST    RF,IOBECBPT              ECB POINTER.                    06220020
*                                                                       06240020
         OI    IOBFLAG1,DCANDCC         INDICATE COMMAND AND DATA CHAIN 06260020
         DROP  RIOB                                              Y02072 06262002
         L     RWK1,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 06270002
         USING SAMSIOB,RIOB                                      Y02072 06272002
         ST    RWK1,IOBDCBPT-1          INIT DCB PT IN IOB.      Y02072 06280002
         MVC   IOBSEEK(8),DCBFDAD       INIT. ALL IOB FDAD'S. SUPPORTS  06286020
*                                       EVERYBODY                Y02072 06292002
         LA    RCPBASE,CHANPGM          GET CHP ADDR                    06296020
         ST    RCPBASE,IOBSTART-D1      PUT IN IOB                      06300020
*                                                                       06304020
* TEST FOR INPUT ONLY                                                   06308020
*                                                                       06312020
         USING DEB,RDEB                 DEB ADDRESSABILITY              06316020
         IF    DEBOPATB,ISNOT=OUTPUT,GOTO=RCPREQD                       06320020
         DROP  RDEB                                                     06330020
BUILDWCP EQU   *                                                        06340020
         SR    RCPBASE,RCPBASE         NEEDED ON 2ND PASS.              06360020
         IC    RCPBASE,DCBWCPO          NEED OFFSET TO BUILD            06380020
         AR    RCPBASE,RIOB             WRITE CP BASE ADDRESS.          06400020
         USING WCPMAP,RCPBASE                                           06440020
         SR    RSTEPPER,RSTEPPER       NEEDED ON 2ND PASS.              06460020
         IC    RSTEPPER,DCBWCPL         BUILD ADDRESS OF COUNT FIELDS   06480020
         SLL   RSTEPPER,3               APPENDED TO WCP.                06500020
         AR    RSTEPPER,RCPBASE         ADDRESS OF FIRST COUNT FIELD.   06520020
*                                                                       06530020
         USING COUNTFLD,RSTEPPER                                        06540020
*                                                                       06560020
*   RIOB = IOB ADDRESS.                                                 06580020
*   RCPBASE = CHANNEL PROGRAM ADDRESS.                                  06600020
*   RSTEPPER = COUNT FIELD AND S.A. ADDRESS.                            06620020
*                                                                       06640020
* IOB INITIALIZED EXCEPT FOR LINK FIELD.                                06660020
*                                                                       06680020
* BUILD WRITE CHANNEL PROGRAMS.  THE CORRECT NUMBER OF CP SEGMENTS IS   06700020
* THAT WHICH CAN BE BUILT UP TO THE FIRST COUNT FIELD APPENDED TO THIS  06720020
* IOB.                                                                  06740020
*                                                                       06760020
*                                                                       06770020
* CHECK FOR RCD READY FEATURE AND SET UP SET THETA COMMAND IF           06780020
* THE FEATURE IS ON ALL THE DATA SETS DEVICES                           06790020
*                                                                       06800020
*                                                                       06805020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       06810020
         BO    NOFET3                   BRANCH IF YES                   06815020
         BAL   RD,SOP6STA               GO BUILD SET SECTOR CCW         06820020
         AH    RCPBASE,DBLWDLEN         INCR BASE FOR SET SECTOR        06825020
NOFET3   EQU   *                                                        06830020
CCW1     EQU   *                                                        06840020
         LA    RD,IOBSEEK+3             GET ADDRESS OF CCHHR IN IOB.    06860020
         ST    RD,SRCHADDR              PUT IN FIRST SEARCH COMMAND.    06880020
         MVI   SRCHOPCD,SRCHEQ          SET OP CODE = SEARCH.           06900020
*                                                                       06940020
* BUILD  FIRST  TIC CCW.                                                06960020
*                                                                       06980020
CCW2     EQU   *                                                        07000020
         ST    RCPBASE,TICADDR          STORE ADDRESS OF PREVIOUS SRCH. 07020020
         MVC   SRCHFLAG(B5),FLAGLEN     FLAGS, LEN, TIC OP CODE         07040020
*                                                                       07060020
*                                                                       07080020
         LR    RVALCHK,RSTEPPER         COPY PTR TO BEGINNING OF COUNTS 07100020
*                                       AND S.A.'S. WILL BE USED FOR    07120020
*                                       VAL CHK CP ADDRESSABILITY (IF   07140020
*                                       NEEDED) AND TO FLAG THE LAST    07160020
*                                       CCW OF THE WRITE SEGMENTS.      07180020
*                                                                       07200020
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=FLAGLAST                      07220020
*                                                                       07240020
* VALIDITY CHECK IS CALLED. BUILD THE VAL CHK CP SEGMENT WHILE ADDR-    07260020
* ESSABILITY IS AVAILABLE. CCW'S TO BE BUILT ARE A SEEK (CCW7), SEARCH  07280020
* (CCW8), TIC (CCW9) AND READ DATA (CCW10).                             07300020
*                                                                       07320020
         SH    RVALCHK,VALCKLEN         BACK UP TO BEGINNING OF VAL CHK 07340020
*                                       CP.                             07360020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       07362020
         BO    FEAT7                    BRANCH IF YES                   07364020
         SH    RVALCHK,DBLWDLEN         DECREMENT ADDITIONAL CCW        07366020
*                                       SINCE FEATURES WRITE CHK        07368020
*                                       CHP LARGER                      07370020
FEAT7    EQU   *                                                        07372020
         USING VCMAP,RVALCHK            VAL CHK SEGMENT ADDRESSABILITY. 07380020
*                                                                       07400020
CCW7     EQU   *                        BUILD SEEK COMMAND. SEEK        07420020
*                                       ADDRESS SAME AS CCHH IN FIRST   07440020
*                                       COUNT FIELD.                    07460020
         LA    RD,IOBSEEK+1             POINTS TO IOB SEEK ADDR.        07480020
         ST    RD,SEEKADDR                                              07500020
         MVI   SEEKOPCD,SEEKCYL                                         07520020
         MVI   SEEKFLAG,CC              COMMAND CHAIN.                  07540020
         MVI   SEEKLEN,BBCCHH           LENGTH OF A 'BBCCHH'.           07560020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       07562020
         BO    NOFET9                   BRANCH IF YES                   07564020
         DROP  RIOB                                                     07566020
         USING FORCORE,RCORE            OPEN WKAREA              S21042 07568021
         L     RD,DXCCW11               GET SECTOR ADDR          Y02072 07570002
         USING SAMSIOB,RIOB                                             07572020
         ST    RD,D8(RVALCHK)           PUT IN CCW                      07574020
         OI    D12(RVALCHK),CC          TURN ON COMMAND CHAIN           07576020
         MVI  D15(RVALCHK),B1           SET BYTE COUNT TO ONE           07578020
         MVI   D8(RVALCHK),SETSC        PUT IN CCW CMND                 07580020
         AH    RVALCHK,DBLWDLEN         INCREMENT RVALCHK BASE REG      07582020
*                                       TO ELIMINATE SET SECTOR         07584020
*                                       OFFSETS IN DSECT                07586020
NOFET9   EQU   *                                                        07588020
CCW8     EQU   *                        BUILD SEARCH ID EQUAL WITH SAME 07600020
*                                       CCHH AS THE SEEK.               07620020
         ST    RSTEPPER,VCSRCHAD        ADDRESS OF FIRST COUNT FIELD.   07640020
         MVI   VCSRCHOP,SRCHEQ          OP CODE.                        07660020
*                                                                       07700020
CCW9     EQU   *                        BUILD A TIC BACK TO CCW8.       07720020
         LA    RD,VCSRCH                ADDRESS OF SEARCH.              07740020
         ST    RD,VCTICAD               PUT IN TIC ADDRESS.             07760020
         MVC   VCSRCHFL(B5),FLAGLEN     FLAGS, LEN, TIC OP CODE         07780020
* TIC COMPLETE. NO FLAGS REQ'D.                                         07800020
*                                                                       07820020
CCW10    EQU   *                        BUILD READ DATA WITH SKIP.      07840020
         MVI   VCRDOP,READKD            TO READ DATA + KEYS (IF ANY).   07860020
         MVI   VCRDFLAG,SKIP            SKIP FLAG.                      07880020
* SKIP ON MAKES ADDRESS IMMATERIAL, LENGTH WILL BE SET AT EOB TIME.     07900020
*                                                                       07920020
* VALIDITY CHECK CP IS BUILT.                                           07940020
*                                                                       07944020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       07948020
         BO    FEATL17                  BRANCH IF YES                   07952020
         SH    RVALCHK,DBLWDLEN         IF YES RVALCHK WAS INCR         07956020
*                                       TO WRT CHK PGM PLUS  8  TO      07960020
*                                       ELIMINATE SET SECTOR OFF-       07964020
*                                       SETS AND NOW MUST BE RE-        07968020
*                                       STORED                          07972020
FEATL17  EQU   *                                                        07976020
         ST    RVALCHK,PARASITE         PUT VAL CHK CP ADDRESS IN       07980020
*                                       R.H. OF CCW2.                   08000020
         MVI   PARASITE,TIC             PUT IN TIC OP CODE, OK BECAUSE  08020020
*                                       BITS 37-39=0.                   08040020
*                                                                       08060020
* PARASITE TIC IN CCW2 WILL BE USED TO TRANSFER-IN-CHANNEL AROUND ANY   08080020
* UNUSED CP SEGMENTS WHEN WRITE CHECK IS CALLED.                        08100020
*                                                                       08120020
         DROP  RVALCHK                  RELINQUISH VC CP ADDRESS.       08140020
*                                                                       08160020
FLAGLAST EQU   *                                                        08180020
*                                                                       08200020
         SH    RVALCHK,DBLWDLEN         THE CCW BEFOR THE VAL CHK CP    08220020
*                                       (OR THE S.A.'S AND COUNT FLDS)  08240020
*                                       IS THE END OF THE WRITE SEGMENT 08260020
*                                       CP'S. POINT TO IT.              08280020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       08282020
         BO    NOFETFLG                 BRANCH IF YES                   08284020
         ST    RVALCHK,PARASITE         PUT RD SECT ADDR IN PARASIT     08286020
         MVI   PARASITE,TIC             PUT IN TIC CMND                 08288020
         SH    RVALCHK,DBLWDLEN         BACK UP TO NULL OP CD           08290020
NOFETFLG EQU   *                                                        08292020
         MVI   0(RVALCHK),WSCKD         FLAG LAST CCW4 OP CODE BYTE     08300020
*                                       WITH A NON-ZERO VALUE.          08320020
*                                                                       08340020
         LA    RF,NULLOPCD              ADDRESS OF CCW WHICH RECEIVES   08360020
         BAL   RE,GETBUFAD              BUFFER ADDRESS.                 08380020
*                                                                       08400020
         MVC   KEYLENTH(1),DCBKEYLE     KEY WILL BE WRITTEN ON FIRST    08420020
*                                       RECORD SEGMENT ONLY.            08440020
*                                                                       08460020
CCW3     EQU   *                        ALL FIRST TIME LOGIC IS DONE.   08480020
*                                       BEGIN HERE WITH A LOOP TO BUILD 08500020
*                                       THE REST OF CP SEG 1 (CCW'S 3   08520020
*                                       AND 4) AND ALL REMAINING SEG-   08540020
*                                       MENTS (MADE UP OF CCW'S 5,6,3,4 08560020
*                                       IN THAT ORDER.)                 08580020
*                                                                       08600020
         ST    RSTEPPER,COUNTADR        FILL IN COUNT FIELD ADDRESS.    08620020
         MVI   COUNTLEN,EIGHT           LENGTH OF A COUNT FIELD.        08640020
         MVI   WRTFLAG,DC               DATA CHAIN TO NEXT CCW.         08660020
*                                                                       08680020
CCW4     EQU   *                        THIS IS THE CCW THAT WRITES THE 08700020
*                                       DATA. NOTHING IS KNOWN AT OPEN  08720020
*                                       TIME EXCEPT THAT IT IS COMMAND  08740020
*                                       CHAINED, AND THE FIRST CCW4     08760020
*                                       WILL HAVE THE BUFFER ADDRESS IF 08780020
*                                       QSAM IS USED                    08800020
*                                       IF IT IS THE LAST CCW4, THE OP  08820020
*                                       CODE BYTE HAS BEEN SET TO NON-  08840020
*                                       ZERO.                           08860020
*                                                                       08880020
         MVI   RECORD,FIRST             INIT. 'R' TO 1.                 08900020
         CLI   NULLOPCD,ZERO            IS THIS THE LAST CP SEGMENT?    08940020
         BNE   THRULOOP                 YES. BRANCH TO DO FINAL LOGIC.  08960020
*                                                                       08980020
* PREPARE TO BUILD NEXT CP SEGMENT. ADVANCE THE CP ADDR REG TO NEXT CP, 09000020
* AND MOVE THE COUNT FIELD AND S.A. POINTER TO NEXT S.A.                09020020
*                                                                       09040020
         LA    RCPBASE,CPSEGLEN(RCPBASE)   POINT TO NEXT SEGMENT.       09060020
         LA    R13,EIGHT(R13)           POINT TO NEXT S.A.         DM0I 09070020
R13      EQU   13                       13                         DM0I 09080020
*                                       THE COUNT FIELD OVERLAY IS NOT  09100020
*                                       VALID UNTIL RSTEPPER IS BUMPED  09120020
*                                       8 MORE.                         09140020
*                                                                       09160020
CCW5     EQU   *                        SEARCH                          09180020
*                                                                       09200020
         ST    RSTEPPER,SRCHADDR        PUT IN POINTER TO SEARCH ADDR.  09220020
*                                                                       09260020
CCW6     EQU   *                        TIC                             09280020
*                                                                       09300020
         ST    RCPBASE,TICADDR          STORE ADDRESS OF CCW5.          09320020
         MVC   SRCHFLAG(B5),FLAGLEN     FLAGS, LEN, AND TIC OP CODE     09340020
*                                                                       09360020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       09366020
         BNO   FEATAX                   BRANCH IF NO                    09372020
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=PTRUPBY8                      09380020
*                                                                       09400020
* VAL CHK CALLED. NEED A PARASITE SEARCH ADDRESS IN CCW6 (TIC) TO BE    09420020
* USED FOR RECONSTRUCTION OF CCW5 AT EOB TIME.                          09440020
FEATAX   EQU   *                                                        09450020
*                                                                       09460020
         ST    RSTEPPER,PARASITE        PUT IN SEARCH ADDRESS.          09480020
*                                       SEARCH OP CODE IS IMPLIED, AND  09500020
*                                       FILLED IN AT EOB.               09520020
*                                                                       09540020
PTRUPBY8 EQU   *                                                        09560020
         LA    R13,EIGHT(R13)           POINT TO NEXT COUNT FIELD  DM0I 09580020
*                                       OVERLAY NOW APPLIES.            09600020
*                                                                       09620020
         B     CCW3                     CLOSE THE LOOP FOR BUILDING     09640020
*                                       CCW'S.                          09660020
*                                                                       09680020
THRULOOP EQU   *                        CCW'S ARE BUILT. FINAL LOGIC TO 09700020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       09706020
         BO    NOFET19                  BRANCH IF YES                   09712020
         BAL   RD,SOP6RTA               GO BUILD READ SECTOR CCW        09718020
NOFET19  EQU   *                                                        09724020
         USING DEB,RDEB                                                 09730020
*                                                                       09740020
*                                                                       09760020
*                                                                       09780020
         IF    DEBOPATB,IS=OUTPUT,GOTO=NEXTIOB                          09800020
*  MUST DROP RDEB BECAUSE  THE FORECORE DSECT LAYOUT PRODUCES A         09820020
* SMALLER OFFSET WITH RDEB FOR 'CHANPGM'. RIOB IS THE DESIRED REG.      09840020
         DROP  RDEB                                                     09860020
         B     BUILDRCP                 TO BUILD  RECORD READ CHAN.DM0I 09880020
RCPREQD  EQU   *                                                        09900020
         USING RCPOVLAY,RCPBASE                                         09940020
         LA    RSTEPPER,CNTFLD2         POINT TO SECOND SEARCH   Y02072 09945002
*                                       DIRECT COUNT FIELD       Y02072 09947002
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READY       09950020
         BO    NOFET25                  BRANCH IF YES                   09955020
         LA    RSTEPPER,D16(RSTEPPER)   INCR OVER RPS COMMANDS          09960020
*                                       IF RPS IS SPECIFIED             09965020
NOFET25  EQU   *                                                        09970020
BUILDRCP EQU   *                                                        09980020
         LA    RCPBASE,CHANPGM          READ CP CONTIG. TO IOB.         10000020
         USING RCPOVLAY,RCPBASE                                         10020020
         USING DEB,RDEB                                                 10040020
         ST    RCPBASE,IOBSTART-1                                       10060020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICESW/O RCD READY        10063020
         BO    NOTRR2A                  BRANCH IF YES                   10066020
         BAL   RD,SOP6STA               GO BUILD SET SECTOR CCW         10069020
         AH    RCPBASE,DBLWDLEN         INCR BASE FOR SET SECTOR        10072020
NOTRR2A  EQU   *                                                        10075020
CCWA     EQU   *                                                        10080020
         LA    RD,IOBSEEK+3             SEARCH ON IOB FDAD.             10100020
         ST    RD,SRCHCCW+ADDRESS       FILL IN SEARCH ADDRESS.         10120020
         MVI   SRCHCCW+OPCODE,SRCHEQ    SEARCH OP CODE .                10140020
CCWB     EQU   *                                                        10200020
         LA    RD,SRCHCCW               GET SEARCH CCW ADDR             10210020
         ST    RD,TICCCW+ADDRESS        PUT IN TIC CCW                  10220020
         MVC   SRCHCCW+FLAGS(B5),FLAGLEN FLAGS,LEN TIC OP CODE          10230020
         OI    TICCCW,SDTIC             TURN SRCH DIR FLAG              10240020
CCWC     EQU   *                                                        10260020
         LA    RD,RKDCCW                POINT TO READ DATA CCW   Y02072 10310002
         ST    RD,SECNDTIC              SET UP TIC ADDRESS       Y02072 10320002
         MVI   SECNDTIC,TIC             MOVE IN TIC COMMAND      Y02072 10330002
         MVI   SECNDTIC+FLAGS,CC        COMAND CHAIN TO NEXT CCW Y02072 10332002
         MVI   SECNDTIC+CNTOFF,EIGHT    AND MOVE IN COUNT               10334002
         LA    RD,CNTFLD2               PT TO SECOND COUNT FIELD Y02072 10334402
         TM    JFCBMASK+6,JFCNRPS       ANY NON RPS DEVICES      Y02072 10334802
         BO    NOTRPS                   BRANCH IF YES            Y02072 10335202
         LA    RD,L'RRRDSEC(,RD)        INCR PAST RD SECTOR CCW  Y02072 10335602
*                                                                       10336002
*  IF THIS IS THE SECOND PHYSICAL IOB (FIRST LOGICAL IOB), THE   YM3176 10336402
*  CHANNEL PROGRAM ASSOCIATED WITH IT MUST BE ALTERED SO THAT    YM3176 10336502
*  THE SECOND TIC IS A READ COUNT TO KEEP THE CHANNEL PROGRAM    YM3176 10337502
*  FROM READING R0. THE FIRST I/O REQUEST FOR SEARCH DIRECT      YM3176 10339502
*  WOULD THEN OPERATE AS A SEARCH PREVIOUS REQUEST.              YM3176 10339902
*  IF ONLY ONE IOB IS BEING USED, ITS CHANNEL PROGRAM WILL BE    YM3176 10340302
*  ALTERED. THE CHAN PROG WILL BE RESET BY THE CHAN END APP.     YM3176 10340402
*                                                                       10341602
NOTRPS   EQU   *                                                 Y02072 10344302
         SR    RWK2,RWK2                PREPARE FOR IC INST      YM3176 10344702
         IC    RWK2,DCBNCP              NUM OF IOBS, ASSUME BSAM YM3176 10345102
         TM    DCBCIND2,DCBCNQSM        IS THIS QSAM             YM3176 10345502
         BZ    NUMCPOK                  NO, RWK2 CORRECT         YM3176 10345902
         IC    RWK2,DCBBUFNO            GET NUM IOBS, QSAM       YM3176 10346202
NUMCPOK  EQU   *                                                 YM3176 10346602
         CH    RWK2,ONEBUFER            IS THERE ONLY ONE IOB    YM3176 10346702
         BE    BLDRDCNT                 YES, BUILD READ COUNT    YM3176 10346802
         L     RWK2,DCBIOBA             GET ADDR OF FIRST IOB    YM1378 10347002
         LA    RWK2,0(RWK2)             CLEAR HI-BYTE FOR COMP   YM3176 10349002
         LA    RIOB,0(RIOB)             CLEAR HI-BYTE FOR COMP   YM3176 10351002
         CR    RIOB,RWK2                IS CURRENT IOB THE FIRST YM1158 10354502
         BE    BUILDTIC                 DON'T BLD RD COUNT IF SO YM1158 10356202
         L     RWK2,0(,RWK2)            GET ADDR OF SECOND IOB   YM1378 10357902
         LA    RWK2,0(,RWK2)            CLEAR HI-ORDER BYTE      YM1378 10363002
         CR    RIOB,RWK2                IS THIS IOB FOR RECORD 0 YM1378 10364702
         BNE   BUILDTIC                 BRANCH IF NOT            YM1378 10366402
*                                                                       10368102
BLDRDCNT EQU   *                                                 YM1158 10369802
         ST    RD,SECNDTIC              SET UP RD CNT DATA ADDR  Y02072 10371502
         MVI   SECNDTIC,READCT          MOVE IN RD COUNT COMMAND Y02072 10373202
*                                                                       10374902
BUILDTIC EQU   *                                                 YM1378 10376602
         IF    DCBCIND2,IS=QSAM,GOTO=TESTBUF                            10378302
         MVI   RKDCCW+OPCODE,READKD     CCWE, USING THE QSAM DECISION.  10380020
         B     IOBAREQD                 GO AROUND NEXT                  10410020
TESTBUF  MVI   RDCCW+OPCODE,READDATA    CCWE, USING THE QSAM DECISION.  10440020
*                                                                       10460020
IOBAREQD EQU   *                                                        10480020
*                                                                       10500020
         OI    RDCCW+FLAGS,SILI         SET SILI FLAG           SA51532 10560002
         SH    RD,DBLWDLEN              BACK UP TO 1ST COUNT FLD Y02072 10680002
         ST    RD,RDCTCCW               PUT ADDR IN CCW                 10720020
         MVI   RDCTCCW,READCT           READ COUNT                      10740020
         MVI   RDCTCNT,EIGHT            BYTE COUNT EQS EIGHT            10760020
*                                                                       10780020
*                                                                       10800020
         CLI   DCBKEYLE,ZERO                                            10840020
         BNE   OPCODEOK                 OP CODE OK                 DM0I 10860020
         MVI   RDCCW+OPCODE,READDATA                                    10880020
OPCODEOK EQU   *                                                        10900020
*                                                                       10920020
*                                                                       10940020
*                                                                       10960020
         LA    RF,RDCCW                 POINT TO CCW WHICH RECEIVES     11000020
         BAL   RE,GETBUFAD              BUFFER ADDRESS.                 11020020
*                                                                       11021020
* IF RCD READY FEATURE USED BUILD A READ SECTOR COMMAND                 11022020
*                                                                       11023020
         OI    RDCCW+FLAGS,CC           TURN ON COMMAND CHAIN           11024020
NOSILIX  EQU   *                                                        11025020
*                                                                       11026020
* MUST DROP RIOB AND RDEB TO USE RCORE                                  11027020
         DROP  RIOB                                                     11028020
         DROP  RDEB                                                     11029020
*                                                                       11030020
         TM    JFCBMASK+D6,NORCDRY      DONT BUILD A RD SECT COM        11031020
         BO    NOFET29                   IF RPS IS NOT FEATURED         11032020
         USING FORCORE,RCORE            OPEN WKAREA              S21042 11033021
         L     RD,DXCCW11               GET THETA ADDR           Y02072 11034002
         ST    RD,RRRDSEC               PUT IN CCW                      11035020
         OI    RDCTFLGS,CC              CMND CHAIN                      11036020
         MVI   RRRDSCNT,ONE             SET BYTE COUNT TO ONE           11037020
         MVI   RRRDSEC,RDSC             PUT IN CCW CMND                 11038020
         DROP  RCORE                                                    11039020
NOFET29  EQU   *                                                        11040020
         USING SAMSIOB,RIOB                                             11041020
NEXTIOB  EQU   *                        TEST FOR ANOTHER IOB TO BE      11060020
*                                       BUILT.                          11080020
         BCTR  RUCB,RE                  DECR IOB COUNT                  11090020
         LTR   RUCB,RUCB                HAVE ALL IOBS BEEN BUILT        11100020
*                                       FLAGGED.                        11120020
         BNP   ALLBUILT                 YES BRANCH TO CLOSE IOB         11150020
*                                      CHAIN AND THEN DO WTG LOGIC.     11180020
* MORE IOB'S TO BE BUILT.                                               11200020
         LA    RD,EIGHT(RSTEPPER)       NEXT IOB STARTS AFTER LAST      11220020
*                                       COUNT FLD OF THE PREVIOUS.      11240020
         O     RD,LINK                  FORWARD CHAIN TO NEXT IOB.      11260020
*                                       OR'ING PRESERVES THE FLAG.      11280020
         ST    RD,LINK                  STORE THE PREPARED LINK FIELD.  11300020
*                                                                       11320020
         LR    RIOB,RD                  NOW HAVE ADDRESSABILITY FOR THE 11340020
*                                       NEXT IOB.                       11360020
*                                                                       11380020
         B     BUILDIOB                 GO BACK AND BUILD IT.           11400020
*                                                                       11420020
ALLBUILT EQU   *                                                        11440020
         MVC   LINK+1(3),DCBIOBA+1      LINK LAST IOB TO THE FIRST.     11460020
*                                                                       11700020
*                                                                       11860020
         DROP  RIOB                                                     11880020
*******************  WTG LOGIC GOES HERE. **********************        11900020
*                                                                       11920020
STOPSOP6 EQU   *                                                        11940020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 11950002
         SPACE                                                          11960002
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESSABILITY.   11980020
         USING FORCORE,RCORE            OPEN WKAREA              S21042 12000021
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 12000402
         L     RPAR,DXREGSAV            RESTORE REG CONTENTS     Y02072 12002002
         USING WTGENTRY,RWTGC                                    Y02072 12010002
         MVC   WTGIDTTR,LOADEXEC        GET LOAD EXEC ID       @Z30TSCF 12012003
         TM    DCBRECFM,X'80'           VARIABLE RECORD FORMAT    22688 12025020
         BO    RELOOP                   NO,BRANCH                 22688 12030020
         MVC   WTGIDTTR,OPENVREC        YES LAOD IGG01916      @Z30TSCF 12032003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY.    12060020
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY PTR 12080020
         CLC   0(2,RWTGC),AMIDCNST      IS THIS RTN NEEDED AGAIN?       12100020
         BCR   EGP2,RBASE               RETURN TO OPEN             DM0I 12120020
*                                                                       12140020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE?                   12160020
         BC    7,RELOOP                 NO, CHECK NEXT ENTRY.           12180020
*                                                                       12200020
         LR    RPARC,RPAR                                               12220020
         LA    RWTGC,WAOFF(0,RWTG)      REINIT. WTG LIST PTR.           12240020
ZCHEK    CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETE?         12260020
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL.        12280020
*                                                                       12300020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY.                 12320020
         LA    RPARC,PLOFF(0,RPARC)                                     12340020
         B     ZCHEK                    ZERO CHECK                 DM0I 12360020
*                                                                       12380020
TCTLRTN  EQU   *                                                        12400020
         USING WTG,RWTG                                                 12450003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*12500003
               MODID=WTGENTRY                                  @Z30TSCF 12510003
         DROP  RWTGC,RWTG                                      @Z30TSCF 12520003
*                                                                       12544020
* END WTG LOGIC                                                         12548020
*                                                                       12552020
* SET SECTOR BUILD RTN                                                  12556020
*                                                                       12560020
SOP6STA  EQU   *                                                        12564020
*                                                                       12568020
         L     RE,DXCCW11               GET THETA ADDR                  12572020
         ST    RE,D0(RCPBASE)           PUT IN CCW                      12576020
         OI    FLAGS(RCPBASE),CC        TURN ON CMND CHAIN              12580020
         MVI   CNTOFF(RCPBASE),B1       SET BYTE COUNT TO ONE           12584020
         MVI   D0(RCPBASE),SETSC        PUT IN SET SECT CMND            12588020
         BR    RD                       RETURN                          12592020
*                                                                       12594020
* READ SECTOR BUILD ROUTINE                                             12596020
*                                                                       12598020
         USING WCPMAP,RCPBASE                                           12600020
SOP6RTA  EQU   *                                                        12602020
         L     RE,DXCCW11               GET THETA ADDR           Y02072 12604002
         ST    RE,WRSADDR               PUT IN CCW                      12606020
*                                                                       12608020
         OI    NULLFLAG,CC              TURN ON PREVIOUS CCW CMND       12610020
*                                       CHAIN                           12612020
         MVI   WRSCNT,B1                SET BYTE COUNT TO ONE           12614020
         MVI   WRSCMND,RDSC             PUT IN CCW CMND                 12616020
         BR    RD                       RETURN                          12618020
         DROP  RCPBASE                                                  12620020
*                                                                       12622020
GETBUFAD EQU   *                                                        12624020
         IF    DCBCIND2,ISNOT=QSAM,GOTO=RETURN                          12640020
         L     RWK3,DCBBUFCB            ADDR OF BUF CNTRL BLK    YM7595 12690002
         USING BCBLK,RWK3                                               12692002
         L     RBUFADR,BCBBUFPT         ADDR OF NEXT AVAIL BUF   YM7595 12694002
         LTR   RBUFADR,RBUFADR          IS THERE AN ADDRESS      Y02072 12700002
         BC    NOTZERO,AVAIL            BRANCH IF BUFF AD NOT 0.        12740020
         L     RPAR,DXREGSAV            RELOAD REG FOR PROB DET  YM2424 12742002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12744002
         SPACE                                                          12746002
         DMABCOND OABD062,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  S21042X12750021
                                        CALL PROBLEM DETERMINATION     X12770021
                                        TO ISSUE 013 ABEND              12780021
         B     TCTLRTN                  GO XCTL                  S21042 12790021
         USING CCW,RF                                            Y02072 12800002
AVAIL    STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      Y02072 12810002
         MVC   CCWBYTE,DCBBLKSI         INIT CCW LENGTH                 12860002
         USING BUFFER,RBUFADR                                           12862002
         MVC   BCBBUFAD,BUFNXPTB        UPDATE TO NEXT ABAIL BUF YM7595 12864002
         DROP  RF,RWK3,RBUFADR                                   Y02072 12870002
RETURN   LR    RF,RE                                                    12880020
         BR    RF                       EXIT                       DM0I 12900020
*                                                                       12920020
ONEBUFER DC    H'1'                     TO TEST NUM OF BUFFERS   YM3176 12940002
DBLWDLEN DC    H'8'                     LENGTH OF A DOUBLE WORD.        12960020
VALCKLEN DC    H'32'                    VALIDITY CHK CP LENGTH.         12980020
FLAGLEN  DC    X'40'                    COMMAND CHAIN FLAG.             13000020
         DC    X'00'                    SPACER                          13020020
         DC    H'5'                     LENGTH OF A 'CCHHR'.            13040020
         DC    X'08'                    TIC COMMAND CODE                13050020
*                                                                       13060020
*                                                                       13080020
* WTG CONSTANTS AND EQUATES.                                            13100020
*                                                                       13120020
WAOFF    EQU   32                                                       13140020
PLOFF    EQU   4                                                        13160020
WGOFF    EQU   8                                                        13180020
OPIDCNST DC    C'0S'                    ID                         DM0I 13200020
AMIDCNST DC    C'9K'                    THIS ID                         13220020
LOADEXEC DC    C'13',VL3(IGG01913)    TO LOAD ACCESS METH RTNS @Z30TSCF 13230003
OPENVREC DC    C'16',VL3(IGG01916)      FOR VAR RECS           @Z30TSCF 13232003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETERMINATION     @Z30TSCF 13234003
*                                                                       13240020
* END WTG CONSTANTS.                                                    13260020
*                                                                       13280020
         DS    0H                       ALIGN PATCH AREA TO H.W. Y02072 13280402
PATCH    DC    50X'0'                   PATCH AREA               YM4640 13330002
END      EQU   *                        END OF MODULE            Y02072 13340002
         EJECT                                                          13342003
CVT      DSECT                                                 @Z30TSCF 13344003
         CVT                                                   @Z30TSCF 13346003
         EJECT                                                          13350002
         IGGBCB TYPE=SAM                                                13360002
         EJECT                                                          13380002
         IHACCW  DSECT=YES                                       Y02072 13390002
         EJECT                                                          13400002
*                                                                       13420020
* READ CHANNEL PROGRAM OVERLAY.  CCW FIELDS ARE ACCESSED BY ABSOLUTE    13440020
* OFFSETS FROM THE CCW NAME.                                            13460020
*                                                                       13480020
RCPOVLAY DSECT                                                          13500020
SRCHCCW  DS    D                        SEARCH CCW                 DM0I 13540020
*        TIC    (CCWB)                                                  13560020
TICCCW   DS    D                        TIC                        DM0I 13580020
*        READ DATA WITH SKIP  (CCWC)                                    13590002
SECNDTIC DS    D                        CCWD                            13600002
*        SECOND TIC CCW                                                 13610002
RDCCW    DS    D                        READ CCW                        13630020
*        READ KEY AND DATA CCW                                          13640020
RKDCCW   EQU   RDCCW                    (ALTERNATE ADDR)                13650020
*                                                                       13660020
RDCTCCW  DS    F                        FIRST WORD OF RD CNT            13670020
RDCTFLGS DS    XL1                      FLAG FIELD                      13680020
         DS    CL2                      FILLER                          13690020
RDCTCNT  DS    XL1                      BYTE CNT                        13700020
*                                                                       13710020
CNTFLD1  DS    0D                       FIRST COUNT FIELD        Y02072 13712002
RRRDSEC  DS    0D,F                     READ SECTOR CCW          Y02072 13720002
RRRDSFLG DS    XL1                      FLAG FIELD                      13730020
         DS    CL2                      FILLER                          13740020
RRRDSCNT DS    XL1                      COUNT FIELD                     13750020
*                                                                       13760020
CNTFLD2  DS    D                        SECOND COUNT FIELD       Y02072 13770002
* FOLLOWING IS A MAP OF A WRITE CHANNEL PROGRAM (WCP) SEGMENT.          13780020
*                                                                       13800020
WCPMAP   DSECT                                                          13820020
*                                                                       13840020
*        SEARCH  (CCW1 OR 5)                                            13860020
*                                                                       13880020
SRCHADDR DS    F                        SEARCH                     DM0I 13900020
SRCHOPCD EQU   SRCHADDR                 OP CODE IS HI ORDER BYTE.       13920020
SRCHFLAG DS    XL1                      SEARCH FLAG                DM0I 13940020
         DS    CL2                      FLAG                       DM0I 13960020
SRCHLEN  DS    XL1                      LENGTHS NORMALLY FIT IN 1 BYTE. 13980020
*                                                                       14000020
*        TIC   (CCW2 OR 6)                                              14020020
*                                                                       14040020
TICADDR  DS    F                        TIC                        DM0I 14060020
TICOPCD  EQU   TICADDR                  TIC  OP                    DM0I 14080020
UNUSED   DS    F                        ONLY REQUIRES BITS 37-39 = 0.   14100020
PARASITE EQU   UNUSED                   MAY BE USED TO STORE AN ADDRESS 14120020
*                                       BUT THE ABOVE RESTRICTION       14140020
*                                       LIMITS THE OP CODES THAT MAY    14160020
*                                       BE STORED IN THE HI BYTE.       14180020
*                                                                       14200020
*        WRITE  (CCW3)                                                  14220020
*                                                                       14240020
COUNTADR DS    F                        COUNT FIELD ADDRESS.            14260020
WRTOPCD  EQU   COUNTADR                                                 14280020
WRTFLAG  DS    XL1                      FLAG FIELD.                     14300020
         DS    CL2                      SPACER.                         14320020
COUNTLEN DS    XL1                      COUNT FIELD LENGTH (NORMALLY 8) 14340020
*                                                                       14360020
*        NULL OP CODE  (CCW4)           OP PROPAGATED FROM WRITE CCW.   14380020
*                                                                       14400020
DATAADDR DS    F                        ADDRESS OF BLOCK OF DATA TO BE  14420020
*                                       WRITTEN.                        14440020
NULLOPCD EQU   DATAADDR                 USED AS A FLAG TO SIGNAL LAST   14460020
*                                       SEGMENT.                        14480020
NULLFLAG DS    XL1                      NULL FLAG                  DM0I 14500020
         DS    XL1                      SPACER.                         14520020
DATALEN  DS    H                        2 BYTES HOLDS DATA LENGTH.      14540020
*                                                                       14544020
* READ SECTOR COMMAND IF NEEDED                                         14548020
*                                                                       14552020
WRSCMND  DS    F                        READ SECTOR COMMAND             14556020
WRSADDR  EQU   WRSCMND                  SECTOR ADDR                     14560020
WRSFLAG  DS    XL1                      FLAG BYTE                       14564020
FILLER   DS    CL2                      FILLER                          14568020
WRSCNT   DS    XL1                      COUNT FIELD                     14572020
*                                                                       14576020
*                                                                       14580020
* FOLLOWING IS THE VALIDITY CHECK CHANNEL PROGRAM OVERLAY.              14600020
*                                                                       14620020
VCMAP    DSECT                                                          14640020
*        SEEK  (CCW7)                                                   14660020
SEEKADDR DS    F                        SEEK ADDRESS               DM0I 14680020
SEEKOPCD EQU   SEEKADDR                                                 14700020
SEEKFLAG DS    XL1                      FLAG                       DM0I 14720020
         DS    CL2                      COUNT                      DM0I 14740020
SEEKLEN  DS    XL1                      SEEK LENGTH                DM0I 14760020
*                                                                       14780020
*        SEARCH (CCW8)                  LABELS PREFIXED BY 'VC' (VAL    14800020
VCSRCH   EQU   *                        CHECK).                         14820020
VCSRCHAD DS    F                        SEARCH ADDRESS             DM0I 14840020
VCSRCHOP EQU   VCSRCHAD                 SEARCH OP                  DM0I 14860020
VCSRCHFL DS    XL1                      FLAGS.                          14880020
         DS    CL2                      COUNT                      DM0I 14900020
VCSRCHLE DS    XL1                      LENGTH.                         14920020
*                                                                       14940020
*        TIC   (CCW9)                                                   14960020
VCTICAD  DS    F                        TIC                        DM0I 14980020
VCTICOP  EQU   VCTICAD                  TIC ADDRESS                DM0I 15000020
NOTUSED  DS    F                        NOT USED                   DM0I 15020020
*                                                                       15040020
*        READ DATA (CCW10)                                              15060020
VCRDAD   DS    F                        RECORD ADDRESS             DM0I 15080020
VCRDOP   EQU   VCRDAD                   RECORD ADDR.               DM0I 15100020
VCRDFLAG DS    XL1                      NORMALLY SKIP.                  15120020
VCRDLEN  DS    FL3                      RECORD LENGTH              DM0I 15140020
*                                                                       15160020
* FOLLOWING IS AN OVERLAY OF THE COUNT FIELD.                           15180020
*                                                                       15200020
COUNTFLD DSECT                                                          15220020
*                                                                       15240020
CYLINDER DS    H                        CYLINDER ADDRESS (CC).          15260020
HEAD     DS    H                        HEAD ADDRESS     (HH).          15280020
RECORD   DS    XL1                      RECORD NUMBER    (R).           15300020
KEYLENTH DS    XL1                      KEY LENGTH       (KL).          15320020
DLDL     DS    H                        DATA LENGTH      (DLDL).        15340020
*                                                                       15360020
* END COUNT FIELD. (CCHHRKDD)                                           15380020
*                                                                       15400020
*                                                                       15420020
* DIRECT ACCESS DEVICE TABLE OVERLAY                                    15440020
*                                                                       15460020
DEVTAB   DSECT                                                          15480020
DEVSIZE  DS    F                       MAX SIZ FOR DEVICE.              15500020
TRKCAP   DS    H                       TRACK CAPACITY.                  15520020
OVERI    DS    XL1                     OVERHEAD FOR NOT-LAST RECORD.    15540020
OVERL    DS    XL1                     OVERHEAD FOR LAST RECORD.        15560020
OVERK    DS    XL1                     OVERHEAD REDUCTION FOR NON-KEY   15580020
*                                      RECORDS.                         15600020
DEVFLAG  DS    XL1                      DEVICE FLAG                DM0I 15620020
TOLER    DS    H                       TOLERANCE/512 USED FOR VARIABLE  15640020
*                                       GAP LENGTH CALCULATIONS.        15660020
* END DEVTAB OVERLAY.                                                   15680020
*                                                                       15700020
*                                                                       15720020
         DCBD  DSORG=PS                                                 15740020
*                                                                       15760020
*                                                                       15780020
*                                                                       15800020
*                                                                       15820020
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 15850003
         ORG   WTGIDTTR                                          Y02072 15860002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 15870002
*                                                                       15880020
* IOB OVERLAY                                                           15900020
* THE FORECORE DSECT IOB OVERLAY IS USED WITH THE FOLOWING ADDITIONS-   15920020
*                                                                       15940020
* BSAM/BPAM/QSAM IOB EXTENSION-                                         15960020
SAMSIOB  EQU   DXIOB-8                  START OF SAM'S IOB.             15980020
LINK     EQU   SAMSIOB                  FORWARD CHAIN FIELD (TO NEXT    16000020
*                                       IOB).                           16020020
FLAG     EQU   LINK                     HI BYTE OF LINK USED AS FLAG.   16040020
ECB      EQU   DXIOB-4                  ECB                        DM0I 16060020
* END EXTENSION DEFINITIONS                                             16080020
*                                                                       16100020
IOBSEEK  EQU   DXDAADDR                 SEEK ADDRESS               DM0I 16120020
CHANPGM  EQU   DXDAADDR+8               START OF CHANNEL PROGRAM.       16140020
*                                       LENGTH MAY VARY.                16160020
* END IOB DEFINITIONS.                                                  16180020
*                                                                       16200020
DEB      EQU   DXDEB                                                    16220020
DEBOPATB EQU   DXDEBSYS                 DEB ADDRESS                DM0I 16240020
         EJECT                                                          16250002
FORCORE  DSECT                                                          16250402
         IHAFCAUD ORG=YES                                               16252002
         END                                                            16260020
./  ADD  SSI=43090082,NAME=IGG0199O
         TITLE 'IGG0199O - BSAM/QSAM SEARCH DIRECT ON DA EXEC'          00050002
IGG0199O CSECT                                                          00090020
*MODULE NAME - IGG0199O                                          Y02072 00092002
*                                                                       00094002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00096002
*                                                                       00098002
*COPYRIGHT - NONE                                                Y02072 00098402
*                                                                       00098802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00099202
*                                                                       00099602
*          VS2 RELEASE 1.6 DELETIONS                                  * 00099702
*426000-426400,427600-428400                                    SA51532 00099802
*                                                                     * 00099902
*          VS2 RELEASE 2 DELETIONS                               Y02072 00100002
*019800,093000,232000,275000,276300,280000-280010,307600-307800, Y02072 00110002
*312000,337000,369000-375000,378000,408000,458800,466000-530000, Y02072 00120002
*537000,540000,561000-565000,568000,602000,624000-628000,        Y02072 00130002
*632000-637000,645000-649000,689000,92000,294000,313000,         Y02072 00132002
*575000-583000,604000-612000                                     Y02072 00134002
*                                                                YM1378 00134402
*                                                                YM1158 00134802
*                                                                YM3176 00136802
*                                                                YM4640 00136902
*                                                                YM7595 00138902
*          VS2 RELEASE 03 DELETIONS                                     00139302
*                                                                       00139403
*                                                              @Z30TSCF 00139503
*D302500                                                        ZA01496 00139702
*A305500                                                        ZA01496 00139802
*A305500                                                        ZA01496 00140003
*                                                                       00140103
*          RELEASE 20 DELETIONS                                       * 01500020
*                                                                S20201 01550020
*          RELEASE 21 DELETIONS                                       * 01600020
*0335042000,566000,589000-591000,613000-619000,689000-690000     S21042 01650021
*                                                                       01950020
*STATUS CHANGE LEVEL 002                                                01980002
*                                                                       02010020
* FUNCTION/OPERATION--FOR DCBS BEING OPENED FOR INPUT WITH SEARCH DIR.  02310020
*      IT WILL LINK THE IOB'S AND INITIALIZE THEM.                      02700020
*      IT WILL CONSTRUCT CHANNEL PROGRAMS NEEDED FOR PROPER EXECUTION.  02800020
*      IT WILL SET UP THE NUMBER OF EXTENTS NEEDED AND PLACE THE        02900020
*      ADDRESSES IN THE DCB AND IOB'S.                                  03000020
*                                                                       03100020
*      THIS MODULE WAS CREATED NEW WITH BASE IGG0191O IN RLSE 20        03110020
*                                                                       03120020
*ENTRY POINTS--ENTERED FROM IGG0191D BY USE OF THE XCTL MACRO.          03200020
*                                                                       03300020
*INPUT--SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       03400020
*OUTPUT--IOB(USER), SEE DESCRIPTION OF THE REGISTERS, DCB(USERS)        03500020
*                                                                       03600020
*                                                                       03700020
*EXTERNAL ROUTINES--NONE.                                               03800020
*                                                                       03900020
*EXITS-NORMAL--XCTL TO IGG01915 TO LOAD ROUTINES                        04000020
*                                                                       04100020
*EXITS-ERROR--XCTL TO PROBLEM DETERMINATION FOR WTP AND 013 ABEND       04160021
*            INSUFFICIENT BUFFERS AVAILABLE IN                          04220021
*            BUFFER POOL TO SATISFY DCB BUFFER REQUIREMENTS       M1552 04300020
*                                                                       04350002
*MACROS-ACTION--MODESET, XCTL, XCTLTABL, DMABCOND                Y02072 04360002
*                                                                       04370002
*MACROS-MAPPING--IHACCW,DCBD,IECDSECS(IOB,WTG),IGGBCB,IHAFCAUD          04380002
*                                                                       04400020
*TABLES/WORKAREAS-- WHERE TO GO TABLE  (WTG)                            04500020
*                                                                       04600020
*   BYTE 0-7   NAME                                                     04700020
*   BYTE 8-10  RELATIVE DISK ADDRESS (TTR) OF FIRST RECORD              04800020
*   BYTE 11    CONCATENATION NUMBER                                     04900020
*   BYTE 12    ZERO                                                     05000020
*   BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR           05100020
*              ALIAS INDICATOR 1 BIT                                    05200020
*              NUMBER OF TTRS IN USERS DATA FIELD  2 BITS               05300020
*   BYTE 14-16 TTR OF FIRST TEXT RECORD                                 05400020
*   BYTE 17    ZERO                                                     05500020
*   BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                         05600020
*   BYTE 20    TRANSLATION TABLE                                        05700020
*   BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST               05800020
*   BYTE 22-23 ATTRIBUTES                                               05900020
*   BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE        06000020
*   BYTE 27-28 LENGTH OF FIRST TEXT RECORD                              06100020
*   BYTE 29    LENGTH OF WTG TABLE  (IN DOUBLE WORDS)                   06200020
*   BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                           06300020
*   BYTE 32-34 IDTTR OF EXECUTOR FOR 1ST DCB                            06400020
*   BYTE 35    WORKAREA ADDRESS FOR 1ST DCB                             06500020
*   BYTE 36-39 TABLE OF IDTTR'S                                         06600020
*                                                                       06700020
*        32+N(8)   IDTTR OF EXECUTOR FOR NTH DCB      (3 BYTES)         06800020
*                  WORKAREA ADDRESS FOR NTH DCB       (1 BYTE)          06900020
*                  IDTTR OF LAST ROUTINE  LOAD        (3 BYTES)         07000020
*                  NOT USED                           (1 BYTE)          07100020
*                                                                       07200020
*                                                                       07300020
*********************************************************************** 07400020
*ATTRIBUTES--REENTRANT,REUSABLE, RUNS IN SUPERVISOR STATE,       Y02072 07500002
*            RUNS IN USER KEY UNLESS OTHERWISE SPECIFIED.        Y02072 07550002
*                                                                       07600020
*                                                                       07700020
*********************************************************************** 07800020
*                                                                       07900020
*                                                                       08000020
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                08100020
*                                                                       08200020
*********************************************************************** 08300020
*                                                                       08400020
RDCB     EQU   2                        DCB REGISTER                    08500020
RBASE    EQU   3                        BASE REGISTER                   08600020
RCORE    EQU   4                        WORK AREA ADDRESS               08700020
RPAR     EQU   5                        TOP OF PARAMETER LIST           08800020
RWTG     EQU   6                        TOP OF WTG TABLE                08900020
RPARC    EQU   7                        CURRENT PARAMETER               09000020
RWTGC    EQU   8                        CURRENT TRANS LOAD              09100020
RBUFADR  EQU   9                        MAINTAINS ADDR OF NEXT   Y02072 09150002
*                                         AVAILABLE BUFFER       Y02072 09160002
RWK1     EQU   10                       WORK REGISTER            Y02072 09300002
RDEB     EQU   11                       DEB ADDRESS                     09400020
RB       EQU   12                       WORK REG1  **                   09500020
RC       EQU   13                       WORK REG2  **  IOB GENERATION   09600020
RWK2     EQU   RC                       WORK REGISTER            Y02072 09650002
RD       EQU   14                       WORK REG3  **                   09700020
RJ       EQU   15                       WORK REG4                       09800020
RWK3     EQU   RJ                       WORK REG                 YM7595 09850002
CPR      EQU   RJ                       ADDR OF CHANNEL PROG            09900020
RE       EQU   0                        WORK REG5                       10000020
RF       EQU   1                        WORK REG6                       10100020
RCCWAD   EQU   RF                       PTR TO COUNT FIELD FOR   Y02072 10110002
*                                       SEARCH DIRECT            Y02072 10200002
*                                                                       10300020
PARAR    EQU   RPARC                                                    10400020
*                                                                       10500020
*********************************************************************** 10600020
*                                                                       10610020
* DISPLACEMENTS AS EQUATES                                              10620020
*                                                                       10630020
D0       EQU   0                        DISPLACEMENT OF ZERO            10640020
D1       EQU   1                        DISPLACEMENT OF ONE             10650020
D4       EQU   4                        DISPLACEMENT OF FOUR            10660020
D6       EQU   6                        DISPLACEMENT OF SIX             10670020
D7       EQU   7                        DISPLACEMENT OF SEVEN           10680020
D8       EQU   8                        DISPLACEMENT OF EIGHT           10690020
D16      EQU   16                       DISPLACEMENT OF SIXTEEN    DMOR 10700020
D24      EQU   24                       DISPLACEMENT OF 24              10710020
D28      EQU   28                       DISPLACEMENT OF TWENTYEIGHT     10720020
D31      EQU   31                       DISPLACEMENT OF THIRTYONE       10730020
D36      EQU   36                       DISPLACEMENT OF THIRTYSIX       10740020
D40      EQU   40                       DISPLACEMENT OF FORTY           10750020
D44      EQU   44                       DISPLACEMENT OF FORTYFOUR       10760020
D47      EQU   47                       DISPLACEMENT OF FORTYSEVEN      10770020
D48      EQU   48                       DISPLACEMENT OF 48              10780020
D64      EQU   64                       DISPLACEMENT OF 64              10790020
*                                                                       10800020
* BYTE COUNTS AS EQUATES                                                10810020
*                                                                       10820020
B0       EQU   0                        BYTE COUNT OF ZERO              10830020
B1       EQU   1                        BYTE COUNT OF ONE               10840020
B8       EQU   8                        BYTE COUNT OF EIGHT             10850020
*                                                                       10860020
*********************************************************************   11000020
* MASK'S TO TEST PARAMETER LIST WITH                                    11100020
INP      EQU   X'0F'                                                    11200020
OUTP       EQU   X'0F'                                                  11300020
UPDATE     EQU   X'04'                                                  11400020
INOUT      EQU   X'03'                                                  11500020
OUTIN      EQU   X'07'                                                  11600020
RDBACK     EQU   X'01'                                                  11700020
*                                                                       11800020
*                                                                       11900020
*********************************************************************   12000020
*                                                                       12100020
*                                                                       12200020
* OFFSET FOR PARAMETER TESTS                                            12300020
*                                                                       12400020
ONE        EQU   X'01'                                                  12500020
FRTYATE    EQU   48                                                     12600020
DISPSN     EQU   X'0'                                                   12700020
*                                                                       12800020
*                                                                       12900020
*********************************************************************   13000020
*                                                                       13100020
* OFFSETS FOR DEB REFERENCE                                             13200020
*                                                                       13300020
*                                                                       13400020
BIN        EQU   36                     BIN NOS.                   DM0I 13500020
BEXT       EQU   38                     BIN EXTENT                 DM0I 13600020
*                                                                       13700020
*                                                                       13800020
*                                                                       13900020
*********************************************************************   14000020
*                                                                       14100020
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              14200020
*                                                                       14300020
*                                                                       14400020
*                                                                       14500020
DOUBLE     EQU   X'01'                                                  14600020
*                                                                       14700020
*                                                                       14800020
STOWB      EQU   X'80'                                                  14900020
WRTCK      EQU   X'80'                  WRITE CHECK                DM0I 15000020
OVRFLO     EQU   X'20'                                                  15100020
PCI        EQU   X'20'                                                  15200020
MINKEY     EQU   X'01'                                                  15300020
CONCAT     EQU   X'FF'                                                  15400020
*                                                                       15500020
*********************************************************************   15600020
*                                                                       15700020
* MASKS FOR ACCESS METHODS IN SAM                                       15800020
*                                                                       15900020
QSAMB      EQU   X'01'                                                  16000020
BSAMBIT    EQU   X'00'                                                  16100020
PAM        EQU   X'02'                                                  16200020
*                                                                       16300020
*                                                                       16400020
* MASKS FOR MACRO'S TO BE USED                                          16500020
*                                                                       16600020
GETB       EQU   X'40'                                                  16700020
PUTB       EQU   X'40'                                                  16800020
READB      EQU   X'20'                                                  16900020
WRITEB     EQU   X'20'                                                  17000020
POINTB     EQU   X'04'                                                  17100020
CNTRLB     EQU   X'02'                                                  17200020
*                                                                       17300020
*                                                                       17400020
*********************************************************************   17500020
*                                                                       17600020
* MASKS FOR DEVICES TO BE SUPPORTED                                     17700020
*                                                                       17800020
SRCHDRK  EQU   X'40'                    SRCH DIRECT MASK                17830020
NOTSILI  EQU   X'DF'                    NOT SIL BIT MASK                17860020
NORCDRY  EQU   X'20'                    NO RCD READY FOR ENTIRE         17890020
*                                       DATA SET MASK                   17920020
TICSD    EQU   X'48'                    SEARCH DIRECT TIC               17950020
*                                                                       18000020
*********************************************************************   18100020
*                                                                       18200020
*                                                                       18300020
COFFSR   EQU   80                       OFFSET OF RD CCW IF             18310020
*                                       RPS USED                        18320020
SDOFFSR  EQU   72                       SD OFFSET TO RD DATA            18330020
CSTOFFSR EQU   72                       OFFSET OF RDCCW IF RCD          18340020
*                                       READY AND F-STD RCDS            18350020
SRCHD    EQU   X'40'                    SEARCH DIRECT MASK         DMOR 18360020
*                                                                  DMOR 18370020
*                                                                       18400020
*                                                                       18500020
*********************************************************************   18600020
*                                                                       18700020
* MASKS FOR STATUS BITS TO BE TESTED                                    18800020
*                                                                       18900020
*                                                                       19000020
EXCPN      EQU   X'30'                                                  19100020
COMPLETE   EQU   X'60'                  COMPLETE MASK              DM0I 19200020
FIRSTIOB   EQU   X'01'                                                  19300020
*                                                                       19400020
*                                                                       19500020
*                                                                       19600020
*********************************************************************   19700020
*                                                                       19800020
* MASKS FOR BUFFER TECHNIQUE'S                                          19900020
*                                                                       20000020
BFTEKR     EQU   X'20'                  BDAM VS                         20100020
VSBITS     EQU   X'48'                  VS BITS IN DCBRECFM             20200020
CYCLICB    EQU   X'20'                                                  20300020
EXCHANGB   EQU   X'10'                                                  20400020
SIMPLEB    EQU   X'40'                                                  20500020
EXCHCYCL   EQU   X'30'                                                  20600020
*                                                                       20700020
*********************************************************************   20800020
*                                                                       20900020
*                                                                       21000020
* MODES OF OPERATION FOR QSAM                                           21100020
*                                                                       21200020
LOCATEB    EQU   X'08'                                                  21300020
MOVEB      EQU   X'10'                                                  21400020
SUBSTUTB   EQU   X'04'                                                  21500020
*                                                                       21600020
*                                                                       21700020
*********************************************************************   21800020
*                                                                       21900020
*                                                                       22000020
* COMMAND BYTES FOR THE 2841                                            22100020
*                                                                       22200020
*       CONTROL UNIT                                                    22300020
*                                                                       22400020
*                                                                       22500020
*                                                                       22600020
SRCHE      EQU   X'31'                                                  22700020
WRTCKD     EQU   X'1D'                                                  22800020
RDC        EQU   X'92'                                                  22900020
RDKD       EQU   X'8E'                                                  23000020
RDD        EQU   X'86'                                                  23100020
MTRCT    EQU   X'92'                    M/T RD CNT CCW CMND             23230020
SETSC    EQU   X'23'                    SET SECTOR CCW CMND             23260020
RDSC     EQU   X'22'                    READ SECTOR CCW CMND            23290020
NOTFIXED EQU   X'40'                    V OR U FORMAT MASK              23320020
*                                                                       23350020
*                                                                       23400020
*********************************************************************   23500020
*                                                                       23600020
*                                                                       23700020
* MASKS FOR RECORD FORMATS                                              23800020
*                                                                       23900020
*                                                                       24000020
STANDRDF   EQU   X'88'                  STANDARD FORMORT           DM0I 24100020
FORMATU    EQU   X'C0'                                                  24200020
FORMATF    EQU   X'80'                                                  24300020
FORMATV    EQU   X'40'                                                  24400020
BLOCKED    EQU   X'10'                                                  24500020
*                                                                       24600020
*                                                                       24700020
*********************************************************************   24800020
*                                                                       24900020
*                                                                       25000020
*   CHANNEL CONTROL WORD FLAGS                                          25100020
*                                                                       25200020
SKIP       EQU   X'10'                                                  25300020
SLI        EQU   X'20'                                                  25400020
SLIBIT     EQU   X'DF'                  TO TURN OFF SLI BIT             25500020
CCWNOP     EQU   X'03'                  NOP                             25600020
CC         EQU   X'40'                                                  25700020
DATACH     EQU   X'A0'                                                  25800020
SLICC      EQU   X'60'                                                  25900020
SLICCSK    EQU   X'70'                                                  26000020
*                                                                       26100020
*                                                                       26200020
*********************************************************************   26300020
*                                                                       26400020
*                                                                       26500020
KEYS       EQU   X'01'                                                  26600020
QSAM       EQU   X'01'                                                  26700020
*                                                                       26800020
*                                                                       26900020
*********************************************************************   27000020
*                                                                       27100020
GETMAIN    EQU   4                                                      27200020
QSAMZ      EQU   X'05'                  MASK                       DM0I 27300020
NRMLEND    EQU   X'7F'                  NORMAL END CODE FOR ECB         27310020
SRCHDRCT   EQU   X'40'                  SEARCH DIRECT--DCBCIND1         27320020
POBIT      EQU   X'02'                  PARTITIONED ORGANIZATION        27330020
ABCODE     EQU   X'013'                  ABEND CODE                     27340020
COMMTABL   EQU   16                     MASK                       DM0I 27400020
NULL       EQU   0                      CONSTANT 0                      27410020
K2         EQU   2                      CONSTANT 2                      27510020
K3         EQU   3                      CONSTANT 3                      27520020
WORD       EQU   4                      LENGTH OF A FULL WORD           27530020
K5         EQU   5                      CONSTANT 5                      27540020
K6         EQU   6                      CONSTANT 6                      27550020
K7         EQU   7                      CONSTANT 7                      27551020
K8         EQU   8                      CONSTANT 8                      27560020
L1CCW      EQU   8                      LENGTH OF 1 CCW                 27600020
K12        EQU   12                     CONSTANT 12                     27610020
K14        EQU   14                     CONSTANT 14                     27620020
L2CCW      EQU   16                     LENGTH OF 2 CCW'S               27700020
K19        EQU   19                     CONSTANT 19                     27710020
K20        EQU   20                     CONSTANT 20                     27720020
K23        EQU   23                     CONSTANT 23                     27730020
L3CCW      EQU   24                     LENGTH OF 3 CCW'S               27800020
K24        EQU   24                     CONSTANT 24                     27810020
K28        EQU   28                     CONSTANT 28                     27820020
K31        EQU   31                     CONSTANT 31                     27830020
K32        EQU   32                     CONSTANT 32                     27840020
K36        EQU   36                     CONSTANT 36                     27850020
K39      EQU   39                       CONSTANT OF 39                  27870020
L5CCW      EQU   40                     LENGTH OF 5 CCW'S               27900020
K40        EQU   40                     CONSTANT 40                     27910020
K43        EQU   43                     CONSTANT 43                     27920020
CPLNGTH  EQU   56                       NON RCD READY CHP LNGTH         28010020
K64        EQU   64                     CONSTANT 64                     28020020
K80        EQU   80                     CONSTANT 80                     28030020
K83        EQU   83                     CONSTANT 83                     28040020
K104       EQU   104                    CONSTANT 104                    28050020
OABD064  EQU   64                                                S21042 28070021
ONEIOB   EQU   1                        USED TO CHECK FOR 1 IOB  YM1158 28070402
*********************************************************************   28100020
*                                                                       28200020
*                                                                       28300020
*                                                                       28400020
*                                                                       28500020
*                                                                       28600020
*                                                                       28800020
*                                                                       28900020
*                                                                       29000020
         BALR  RBASE,NULL               REG 3 IS BASE                   29100020
         USING SOP2,RBASE                                               29200020
         USING IHADCB,RDCB              REG 2 IS DCB                    29300020
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR         29500020
SOP2     EQU   *                                                        30100020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 30101002
         DC    C'IGG0199O'              MODULE NAME              YM4640 30102002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 30103003
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 30104003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 30105002
*                                                                       30200020
         L     RDCB,NULL(RPARC)         GET DCB ADDRESS                 30300020
         LA    RDCB,NULL(RDCB)          CLEAR HI BYTE                   30400020
         L     RCORE,WORD(RWTGC)        GET WORK AREA ADDRESS           30500020
         MODESET  KEYADDR=DXUKEY,WORKREG=10 GET INTO USER KEY   ZA01496 30550002
*                                                                       30600020
         L     RB,DCBIOBA               GET FIRST IOB ADDR              30700020
         LR    RC,RB                    SET UP WORK REG                 30800020
         LR    RD,RB                    SET UP WORK REG                 30900020
         SR    RF,RF                    CLEAR FOR IC                    31000020
         TM    DCBCIND2,QSAMB           QSAM USED                       31050020
         IC    RF,DCBNCP                GET NO OF IOB'S                 31100020
         BNO   SOP230                   BRANCH IF NO                    31130020
         IC    RF,DCBBUFNO              USE BUFFER NO FOR IOB CNT       31160020
SOP230   EQU   *                                                        31400020
         LR    RDEB,RF                  PUT CNT IN DECR REG             31500020
SOPSTART EQU   *                                                        31600020
*                                                                       31700020
* START OF IOB BUILD ROUTINE                                            31800020
*                                                                       31900020
         SPACE 2                                                        32300020
*                                                                       32400020
SOP242   EQU   *                                                        32500020
*                                                                       32600020
         ST    RB,NULL(RD)              LINK NEW IOB TO LAST ONE BUILT  32700020
         LR    RD,RB                    UPDATE CURRENT IOB POINTER      32800020
         LA    RB,WORD(RB)              POINT TO ECB SLOT               32900020
         OI    NULL(RB),NRMLEND         SET ECB COMPLETE WITHOUT ERROR  33000020
         ST    RB,K12(RD)               STORE ECB ADDR IN IOB           33100020
         LA    RB,K20(RB)               POINT TO CP POINTER SLOT        33200020
         LR    RC,RB                    SAVE ADDR                       33300020
         LA    RB,K24(RB)               POINT TO CP START ADDR          33400020
SOP243   EQU   *                                                        33500020
         ST    RB,NULL(RC)              STORE CP STARTAD IN IOB         33600020
         L     RWK1,DXUDCBAD            GET ADDR OF USERS DCB    Y02072 33700002
         USING IOBSIOCC,RWK2                                     Y02072 33750002
         ST    RWK1,IOBDCBPT            DCB ADDR TO IOB          Y02072 33760002
         DROP  RWK2                                              Y02072 33770002
         MVC   K40(L'DCBFDAD,RD),DCBFDAD  INITIALIZE IOBFDAD.           33800020
*                                                                       33900020
*********************************************************************** 34000020
*                                                                       34100020
*    CONSTRUCTION OF READ CHANNEL PROGRAM FOLLOWS                       34200020
*                                                                       34300020
*********************************************************************** 34400020
*                                                                       34500020
SOP255   EQU   *                                                        34600020
*                                                                       34700020
         LA    RC,K19(RC)               POINT TO CCHHR FIELD IN IOB     34800020
         TM    JFCBMASK+D6,NORCDRY      ANY NON RPS DEVICES             34820020
         BO    SOP2NC1                  BRANCH IF YES                   34840020
         BAL   RJ,SOP2STA               IF NOT GO BUILD SET SECTOR      34860020
SOP2NC1  EQU   *                                                        34880020
         ST    RC,NULL(RB)              STORE ADDR IN SRCH CCW          34900020
         MVI   NULL(RB),SRCHE           STORE CMD BYTE                  35000020
         MVI   K7(RB),K5                STORE COUNT OF 5 IN CCW         35100020
         OI    WORD(RB),CC              SET CMD CHAIN FLAG ON           35200020
         ST    RB,D8(RB)                PUT SEARCH ADDR IN TIC CCW DMOR 35300020
         LR    RC,RB                    UPDATE PTR                      35400020
         MVI   K8(RB),TICSD             PUT IN SEARCH DIRECT TIC        35500020
         SR    RE,RE                                              17363 35600020
         IC    RE,DCBKEYLE              OBTAIN KL                 17363 35700020
         AH    RE,DCBBLKSI              ADD DL                    17363 35800020
*     KL+DL TO RH OF TIC FOR USE BY EOB ROUT                      17363 35810020
         STH   RE,K14(RB)                                         17363 35900020
SOP255B  EQU   *                                                  17363 36000020
*                                                                       36100020
*                                                                       36200020
*     SRCH AND TIC CCWS HAVE BEEN GENERATED AT THIS POINT               36300020
*                                                                       36400020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 36410002
         MVI       DCBOFFSR,SDOFFSR     PUT OFFSET IN DCB               36500020
         TM    DCBMACRF,POINTB          POINT MACRO USED ON INPUT       36600020
         BZ    SOP255A0                 NO BRANCH                       36700020
         MVI   DCBCNTRZ,QSAMZ           MOVE ID                    DM0I 36800020
SOP255A0 EQU   *                                                 Y02072 36850002
         MODESET  KEYADDR=DXUKEY,WORKREG=10 GET INTO USER KEY    Y02072 36860002
         USING CPDEF,RB                 EST CHANNEL PGM BASE REG Y02072 36910002
         LA    RCCWAD,CPRDKD            POINT TO READ DATA CCW   Y02072 37600002
         ICM   RCCWAD,B'1000',TICCMD    INIT NEXT CCW TO A TIC   Y02072 37602002
*                                                                       37602402
*  IF THIS IS THE SECOND PHYSICAL IOB (FIRST LOGICAL IOB), THE   YM3176 37602502
*  CHANNEL PROGRAM ASSOCIATED WITH IT MUST BE ALTERED SO THAT    YM3176 37602602
*  THE SECOND TIC IS A READ COUNT TO KEEP THE CHANNEL PROGRAM    YM3176 37606202
*  FROM READING R0. THE FIRST I/O REQUEST FOR SEARCH DIRECT      YM3176 37608202
*  WOULD THEN OPERATE AS A SEARCH PREVIOUS REQUEST.              YM3176 37608602
*  IF ONLY ONE IOB IS BEING USED, ITS CHANNEL PROGRAM WILL BE    YM3176 37608702
*  ALTERED. THE CHAN PROG WILL BE RESET BY THE CHAN END APP      YM3176 37608802
*                                                                       37608902
         SR    RWK1,RWK1                PREPARE FOR IC INST      YM3176 37609602
         IC    RWK1,DCBNCP              NUM OF IOBS, ASSUME BSAM YM3176 37610002
         TM    DCBCIND2,DCBCNQSM        IS THIS QSAM             YM3176 37610402
         BZ    NUMCPOK                  NO, RWK1 CORRECT         YM3176 37610802
         IC    RWK1,DCBBUFNO            GET NUM IOBS, QSAM       YM3176 37611202
NUMCPOK  EQU   *                                                 YM3176 37611702
         CH    RWK1,CONONE              ONLY ONE IOB BEING USED  YM3176 37612102
         BE    BLDRDCNT                 YES, BUILD READ COUNT    YM3176 37612502
         L     RWK1,DCBIOBA             GET ADDR OF FIRST IOB    YM1378 37613502
         USING IOBQSAMN,RWK1            ESTABLISH IOB BASE REG   YM1378 37614002
         LA    RWK1,0(RWK1)             CLEAR HI-BYTE FOR COMP   YM3176 37624002
         LA    RD,0(RD)                 CLEAR HI-BYTE FOR COMP   YM3176 37626002
         CR    RD,RWK1                  IS CURRENT IOB THE FIRST YM1158 37631602
         BE    BUILDTIC                 DON'T BLD RD COUNT IF SO YM1158 37635202
         L     RWK1,IOBNIOBA            GET ADDR OF SECOND IOB   YM1378 37638802
         LA    RWK1,0(RWK1)             CLEAR HI-BYTE FOR COMP   YM3176 37640802
         DROP  RWK1                     DROP IOB BASE REGISTER   YM1378 37642402
         CR    RD,RWK1                  IS THIS IOB FOR RECORD 0 YM1378 37653202
         BNE   BUILDTIC                 BRANCH IF NOT            YM1378 37656802
*                                                                       37660402
BLDRDCNT EQU   *                                                 YM1158 37664002
         LA    RCCWAD,CPCOUNT2          PT TO SECOND COUNT FIELD Y02072 37667602
         TM    JFCBMASK+6,JFCNRPS       ANY DEVICES W/O RCD RDY  Y02072 37671202
         BO    NOTRPS                   BRANCH IF YES            Y02072 37674802
         LA    RCCWAD,L'CPRDSEC(,RCCWAD) INCR PAST RD SECTOR CCW Y02072 37678402
*                                                                       37682002
NOTRPS   EQU   *                                                 Y02072 37685602
         ICM   RCCWAD,B'1000',RDCNTCMD  CHANGE CCW TO READ COUNT Y02072 37689202
*                                                                       37692802
BUILDTIC EQU   *                                                 YM1378 37696402
         ST    RCCWAD,CPTIC2            SET UP CMND & DATA ADDR  Y02072 37700002
         DROP  RB                       DROP CHANNEL PGM BASE    Y02072 37702002
         MVI   K23(RB),K8               BYTE COUNT EQUALS EIGHT         37900002
         OI    K20(RB),CC               CMND CHAIN CCW                  38000020
*                                                                       40700020
         TM    DCBCIND2,QSAMB           QSAM USED                       40900020
         BO    SOP259                   YES BRANCH                      41000020
*                                                                       41100020
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         41200020
         BL    SOP259A                  NO BRANCH                       41300020
*                                                                       41400020
         MVI   K24(RB),RDKD             CCW CMND                        41500020
         B     SOP259C                  GO ATOUND                       41600020
*                                                                       41700020
SOP259   EQU   *                                                        41800020
         LA    RF,K24(RB)               ADDR OF CCW                     41900020
*                                                                       41950002
* FILL IN BUFFER ADDRESS AND BYTE COUNT                                 42000002
*                                                                       42050002
         L     RWK3,DCBBUFCB            BUFFER CNTRL BLK ADDR    YM7595 42100002
         USING BCBLK,RWK3                                               42150002
         L     RBUFADR,BCBBUFPT         ADDR OF NEXT AVAIL BUF   YM7595 42160002
         LTR   RBUFADR,RBUFADR          IS BUFFER AVAILABLE      YM7595 42170002
         BZ    BUFERR                   NO, ISSUE DMABCOND       YM7595 42180002
         USING CCW,RF                                                   42190002
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 42192002
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 42194002
         USING BUFFER,RBUFADR                                           42196002
         MVC   BCBBUFAD,BUFNXPTB        UPDATE BUF CNTRL BLOCK   YM7595 42198002
         DROP  RWK3,RBUFADR,RF                                          42198402
SOP259A  EQU   *                                                        42200020
         MVI   K24(RB),RDD              CCW COMMAND                     42300020
*                                                                       42400020
*                                                                       42440020
SOP259C  EQU   *                                                        42480020
*                                                                       42520020
         OI    D28(RB),CC               SET THE COMMAND CHAIN FLG       42560020
         TM    DCBRECFM,STANDRDF        IS IT F STANDARD                42680020
         BO    SOP259XB                 YES, BR AROUND SILI SETTING     42720020
         OI    D28(RB),SLI              SET SILI FLAG                   42880020
SOP259XB EQU   *                                                        42920020
         LA    RF,K40(RB)               CCHHR ADDR                      42960020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READ        43000020
         BO    SOP2NST                  BRANCH IF YES                   43040020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 43042002
         MVI   DCBOFFSR,COFFSR          PUT IN OFFSET TO RD CCW         43080020
*                                       IF RPS IS FEATURED              43120020
         MODESET  KEYADDR=DXUKEY,WORKREG=10 GET INTO USER KEY    Y02072 43140002
         LA    RF,K8(RF)                INCR ADDR BY EIGHT              43160020
SOP2NST  EQU   *                                                        43200020
*                                                                       43240020
         ST    RF,K32(RB)               ADDR TO CCW                     43280020
         MVI   K32(RB),MTRCT            CCW COMMAND                     43320020
*                                                                       43360020
         MVI   K39(RB),K8               BYTE COUNT EQS EIGHT            43400020
*                                                                       43440020
*                                                                       43480020
         TM    JFCBMASK+D6,NORCDRY      NOT STND F, BUT WITH RCD        43520020
*                                       READY                           43560020
         BO    SOP2NRR                  BRANCH IF NO                    43600020
         BAL   RJ,SOP2RTA               GO BUILD RD SECTOR CCW          43640020
SOP2NRR  EQU   *                                                        43680020
*                                                                       43720020
*******************************************************************DMOR 43760020
SOP259D  EQU   *                                                        43900020
         LA    RB,CPLNGTH(RB)           PT TO NEXT POSS IOB             43990020
SOP240   EQU   *                                                        44080020
         SH    RDEB,CONONE              DECR IOB COUNT             DMOR 44170020
         BP    SOPSTART                 IF MOR IOBS BRANCH              44260020
         L     RB,DCBIOBA               IF NOT LINK LAST TO FIRST  DMOR 44350020
         ST    RB,D0(RD)                PUT FIRST ADDR IN LAST     DMOR 44440020
         B     OFFSETRD                 GO AROUND INTERNAL SUBROUT DMOR 44530020
*                                                                       44620020
* SET SECTOR CCW BUILD RTN                                              44710020
*                                                                       44800020
SOP2STA  EQU   *                                                        44890020
         L     RE,DXCCW11               GET SET SECTOR ADDR             44980020
         ST    RE,D0(RB)                PUT IN CCW                      45070020
         MVI   D0(RB),SETSC             PUT IN CCW CMND                 45160020
         MVI   D7(RB),B1                SET BYTE CNT TO ONE             45250020
         OI    D4(RB),CC                TURN ON CMND CHAIN              45340020
         B     CMNDFIN                  GO TO FINISH DETAILS            45430020
*                                                                       45520020
* READ SECTOR CCW BUILD RTN                                             45610020
*                                                                       45700020
SOP2RTA  EQU   *                                                        45790020
         L     RE,DXCCW11               GET READ SECTOR ADDR     Y02072 45880002
         ST    RE,D40(RB)               PUT IN CCW                      45970020
         MVI   D40(RB),RDSC             PUT IN RD SECT CMND             46060020
         OI    D36(RB),CC               CMND CHAIN PREVIOUS CCW         46150020
         MVI   D47(RB),B1               SET BYTE CNT TO ONE             46240020
CMNDFIN  EQU   *                                                        46330020
         LA    RB,B8(RB)                INCR PTR                        46420020
         BR    RJ                       RETURN                          46510020
*                                                                       46560002
OFFSETRD EQU   *                                                 Y02072 46610002
*                                                                       46660002
         OI    NULL(RB),FIRSTIOB        SET INDICATOR ON FOR CLOSE      53100020
         LR    RC,RB                    SAVE ADDR FOR QSAM USE          53200020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 53210002
         SPACE                                                          53220002
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 53230002
         TM    DCBDSORG,DCBDSGPO        DCB FOR PO               Y02072 53260002
         BZ    SOP2ENDA                 NO, BRANCH               Y02072 53270002
         MVI   DCBCNTRZ,QSAMZ           FOR EXECS TO LOAD PAM RT Y02072 53280002
SOP2ENDA EQU   *                                                 Y02072 53290002
         TM    DCBRECFM,FORMATV         VARIABLE FORMAT            DM0I 53300020
         BZ    SOP2STOP                 BRANCH NOT V FORMAT        DM0I 53400020
         TM    DCBRECFM,FORMATF         FIXED FORMAT               DM0I 53500020
         BO    SOP2STOP                 YES, BRANCH                DM0I 53600020
         USING WTGENTRY,RWTGC                                    Y02072 53750002
         MVC   WTGIDTTR,SOPSLDVT        VAR, GET 1915          @Z30TSCF 53760003
         B     RELOOP                   BACK TO MAIN LINE          DM0I 53800020
SOP2STOP EQU   *                                                        53900020
         MVC   WTGIDTTR,SOPSLDFT        FIXED, GET 1910        @Z30TSCF 53950003
RELOOP   LA    RWTGC,WGOFF(RE,RWTGC)    INCREMENT CURR WTG ENTRY        54200020
         LA    RPARC,PLOFF(NULL,RPARC)  INCR CURRENT DCB ENTRY PRTR     54210020
         CLC   NULL(L'AMIDCNST,RWTGC),AMIDCNST  THIS RT NEEDED AGAIN    54400020
         BCR   RWTGC,RBASE              BACK TO OPEN CONTROL ROUTINDM0I 54500020
*                                                                       54600020
         CLC   NULL(L'OPIDCNST,RWTGC),OPIDCNST  END OF TABLE            54700020
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             54800020
*                                                                       54900020
         LR    RPARC,RPAR                                               55000020
         LA    RWTGC,WAOFF(NULL,RWTG)   REINITIALIZE WTG LIST PTR       55100020
ZCHEK    CLI   NULL(RWTGC),NULL         IS THIS ENTRY COMPLETE          55200020
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         55300020
*                                                                       55400020
         LA    RWTGC,WGOFF(NULL,RWTGC)  GET NEXT ENTRY                  55500020
         LA    RPARC,PLOFF(NULL,RPARC)                                  55600020
         B     ZCHEK                    TO ZERO CHECK              DM0I 55700020
*                                                                       55800020
TCTLRTN  EQU   *                                                        55900020
         USING WTG,RWTG                                                 55950003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*56000003
               MODID=WTGENTRY                                  @Z30TSCF 56050003
         DROP  RWTGC,RWTG                                      @Z30TSCF 56100003
*                                                                       58500020
**********************************************************************  58600020
*                                                                    *  58700020
BUFERR   EQU   *                                                  M1552 58800020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 58810002
         DMABCOND OABD064,PDLOAD,RES=NO,REGSAVE=YES              S21042X58880021
                                        CALL PROBLEM DETERMINATION     X58960021
                                        TO ISSUE 013 ABEND              59040021
         B     TCTLRTN                  GO XCTL                  S21042 59120021
WAOFF    EQU   32                                                       59200020
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           59300020
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           59400020
OPIDCNST DC    C'0S'                    ID                         DM0I 59500020
AMIDCNST DC    C'9O'                    THIS ID                         59600020
*                                                                       59700020
*********************************************************************** 59800020
*      CONSTANTS AND RESERVED STORAGE.                                  59900020
*                                                                       60000020
*                                                                       60100020
CONONE   DC    H'1'                     CONSTANT OF ONE                 60300020
TICCMD   DC    X'08'                    COMMAND CODE FOR A TIC   Y02072 60302002
RDCNTCMD DC    X'92'                    CMND CODE FOR READ COUNT Y02072 60304002
SOPSLDFT DC    C'10',VL3(IGG01910)      FIXED LEN RECORDS      @Z30TSCF 60350003
SOPSLDVT DC    C'15',VL3(IGG01915)      VARIABLE LEN RECORDS   @Z30TSCF 60400003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION  @Z30TSCF 60450003
         SPACE 2                                                        60500002
         DS    0H                       ALIGN PATCH AREA TO H.W. Y02072 60500402
PATCH    DC    50X'0'                   PATCH AREA               YM4640 60550002
END      EQU   *                        END OF MODULE            Y02072 60600002
         EJECT                                                          60610003
CVT      DSECT                                                 @Z30TSCF 60620003
         CVT                                                   @Z30TSCF 60630003
         EJECT                                                          60650002
         IHACCW  DSECT=YES                                       Y02072 60700002
         EJECT                                                          60750002
         IGGBCB  TYPE=SAM                                               60800002
         EJECT                                                          61600002
CPDEF    DSECT                          OFFSET READ CHANNEL PROG        62200020
CPSETSEC DS    0D                       SET SECTOR CCW           Y02072 62300002
CPSCH    DS    D                        SEARCH ID EQUAL                 62900020
CPTIC1   DS    D                        TIC TO SEARCH                   63000020
CPTIC2   DS    D                        TIC TO READ COUNT               63100020
CPRDKD   DS    0D                       READ (KEY) DATA                 63800020
RKDCC    DS    0X                       COMMAND CODE                    63900020
RKDDATAD DS    A                        DATA ADDR                       64000020
RKDFLAGS DS    BL1                      FLAGS                           64100020
         DS    1X                       NOT USED                        64200020
RKDBYTCT DS    2X                       BYTE COUNT                      64300020
CPRDCNT  DS    D                        READ COUNT CCW           Y02072 64302002
CPRDSEC  DS    0D                       READ SECTOR CCW          Y02072 64400002
CPCOUNT1 DS    D                        FIRST COUNT FIELD        Y02072 65000002
CPCOUNT2 DS    D                        SECOND COUNT FIELD       Y02072 65002002
           DCBD  DSORG=PS                                               65100020
DCBCNTRZ EQU   DCBCNTRL+1                                          DM0I 65200020
DCBCNTRX EQU   DCBCNTRL+3                                          DM0I 65300020
         EJECT                                                          65400002
         TITLE 'IGG0199O--FORMAT OF GOTTEN CORE'                        68600002
*                                                                       68700020
*                                                                       68800020
         IECDSECS (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES     @Z30TSCF 68900003
         ORG   WTGIDTTR                                          Y02072 68950002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 69000002
         EJECT                                                          69050002
FORCORE  DSECT                                                          69052002
         IHAFCAUD ORG=YES                                               69060002
           END                                                          69100020
./  ADD  SSI=81860268,NAME=IGG01991
 TITLE 'IGG01991 - SAM STG 3 OPEN EXEC FOR VARIABLE LNGTH/SPANNED RECS' 00100018
IGG01991 CSECT                                                          00200018
*MODULE NAME - IGG01991                                          Y02072 00250002
*                                                                       00300002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00350002
*                                                                       00360002
*COPYRIGHT - NONE                                                Y02072 00370002
*                                                                       00380002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00390002
*          RELEASE 20 DELETIONS                                       * 00500018
*1262351400                                                      M5860  00520020
*1262                                                            S20038 00550020
*1262134600,192300-192420                                        A32160 00570020
*1262112000,321000,323000,330000,347000,353780,374000-434000,    S20201 00580020
*1262436500,533000,535000,623000,625600                          S20201 00590020
*1262506000-525000,604000-622700                                 M4028  00595020
*          RELEASE 21 DELETIONS                                       * 00600018
*1202134200-134800,192060-192840,258000-306000,348000-353000,    S21040 00630021
*1202357000,528380-530460,533000,592000,625600-626200            S21040 00660021
*1202346300                                                      A49371 00670021
*                                                                       00680002
*        VS 2 RELEASE 02 DELETIONS                                      00690002
*001500,011500,013600,014100,175600-175900,190600,191500-192600, Y02072 00692002
*320300-320440,320950-321090,331530-331980,347000,355000,        Y02072 00694002
*371800-371920,501050-501900,606880-615880,623300,403000,463000  Y02072 00696002
*458000-459000,485000-497000,528160-528300                       Y02072 00696402
*                                                                YM1141 00696602
*                                                                YM1140 00697002
*                                                                YM5922 00697402
*                                                                       00697803
*          VS2 RELEASE 3 DELETIONS                                      00697903
*                                                              @Z30TSCF 00714603
*                                                                       00731303
*          VS2037 CHANGES                                               00736337
*C187700,187800,346000-346360                                  @ZA28034 00741337
*STATUS CHANGE LEVEL 005                                                00748002
*                                                                       00798002
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE           01210018
*    IGG01915 AND LOADS THE END-OF-BLOCK ROUTINES AND ANY SIO           01220018
*    APPENDAGES REQUIRED.  WHICH SUBROUTINES ARE LOADED WAS             01230018
*    DETERMINED BY PREVIOUS OPEN EXECUTORS.  THE ADDRESSES OF THE       01240018
*    LOADED MODULES ARE PLACED IN THE DCB AND THE ID IN THE             01250018
*    SUBROUTINE ID SECTION OF THE DEB.                                  01260018
*                                                                       01270018
*ENTRY POINTS - THE MODULE IS ENTERED BY MEANS OF AN XCTL FROM          01280018
*    IGG01915.                                                          01290018
*                                                                       01300018
*INPUT - SEE DESCRIPTION OF REGISTER CONTENTS.                          01310018
*                                                                       01320018
*OUTPUT - SUBROUTINES LOADED, ADDRESSES IN DCB, ID'S IN DEB             01330018
*                                                                       01340018
*EXTERNAL ROUTINES - NONE                                               01350018
*EXITS - NORMAL - XCTL TO IGG01911                               Y02072 01360002
*      - ERROR - NONE                                                   01370018
*                                                                       01380018
*TABLES/WORKAREAS - DESCRIBED BY DSECTS AT END OF MODULE LISTING        01390018
*                                                                       01400018
*ATTRIBUTES - REENTRANT, REUSABLE, SUPERVISOR STATE,             Y02072 01410002
*             RUNS IN DATA MANAGEMENT KEY                        Y02072 01412002
*                                                                       01420018
*                                                                       01430018
*                                                                       01440018
* REGISTER CONVENTIONS                                                  01450018
*                                                                       01460018
RE       EQU   0                        WORK REG5                       01510002
RWK1     EQU   RE                       WORK REGISTER            Y02072 01560002
RF       EQU   1                        WORK REG6                       01610002
R1       EQU   RF                       PARM REG                 YM1140 01660002
RDCB     EQU   2                        DCB                             01700018
RBASE    EQU   3                        BASE                            01800018
RCORE    EQU   4                        WORE AREA                       01900018
RPAR     EQU   5                        TOP OF PARAMETER                02000018
RWTG     EQU   6                        TOP OF WTG TABLE                02100018
RPARC    EQU   7                        CURRENT PARAMETER               02200018
RWTGC    EQU   8                        CURRENT TRANS LOAD              02300018
RTIOT    EQU   9                        TIOT                            02400018
RUCB     EQU   10                       UCB                             02500018
RDEB     EQU   11                       DEB                             02600018
RB       EQU   12                       WORK REG1                       02700018
RC       EQU   13                       WORK REG2                       02800018
RBRANCH  EQU   RC                       BRANCH REGISTER          Y02072 02850002
RD       EQU   14                       WORK REG3                       02900018
RJ       EQU   15                       WORK REG4                       03000018
*                                                                       03300018
*                                                                       03400018
PARAR    EQU   RPARC                                                    03500018
*                                                                       03600018
*********************************************************************** 03700018
*                                                                       03800018
*********************************************************************** 03900018
*                                                                       04000018
* MASK'S TO TEST PARAMETER LIST WITH                                    04100018
*                                                                       04200018
*********************************************************************   04300018
INP      EQU   X'0F'                    MASK                            04400018
OUTP     EQU   X'0F'                    MASK                            04500018
UPDATE   EQU   X'04'                    MASK                            04600018
INOUT    EQU   X'03'                    MASK                            04700018
OUTIN    EQU   X'07'                    MASK                            04800018
RDBACK   EQU   X'01'                    MASK                            04900018
INPRDBK  EQU   X'0E'               MASK TO CK INPUT OR RDBACK      UT18 04950018
*                                                                       05000018
*                                                                       05100018
*********************************************************************   05200018
*                                                                       05300018
*                                                                       05400018
* OFFSET FOR PARAMETER TESTS                                            05500018
*                                                                       05600018
FRTYATE  EQU   48                       MASK                            05700018
DISPSN   EQU   X'0'                     MASK                            05800018
*                                                                       05900018
RCDRYOF  EQU   6                        OFFSET IN JFCBMASK TO    S20201 05905020
*                                       RCD                      S20201 05910020
*                                       READY MASK                      05915020
THREE    EQU   3                        CONSTANT OF THREE        S20201 05920020
FIVE     EQU   5                        FIVE BYTE QUANTITY       S20201 05925020
D0       EQU   0                        DISPLACEMENT OF 0        S20201 05930020
D1       EQU   1                        DISPLACEMENT OF 1        S20201 05935020
D5       EQU   5                        DISPLACEMENT OF 5        S20201 05940020
D6       EQU   6                        DISPLACEMENT OF 6        S20201 05945020
D12      EQU   12                       DISPLACEMENT OF TWELVE   S20201 05950020
D13      EQU   13                       DISPLACEMENT OF 13       S20201 05955020
D17      EQU   17                       DISPLACEMENT OF 17       S20201 05960020
D25      EQU   25                       DISPLACEMENT OF 25       S20201 05965020
*                                                                       05970020
*                                                                       05975020
*                                                                       05980020
*                                                                       06000018
*********************************************************************   06100018
*                                                                       06200018
* OFFSETS FOR DEB REFERENCE                                             06300018
*                                                                       06400018
*                                                                       06500018
BIN      EQU   36                                                       06600018
BEXT     EQU   38                                                       06700018
*                                                                       06800018
*                                                                       06900018
*                                                                       07000018
*********************************************************************   07100018
*                                                                       07200018
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              07300018
*                                                                       07400018
*                                                                       07500018
*                                                                       07600018
DOUBLE   EQU   X'01'                    MASK                            07700018
*                                                                       07800018
*                                                                       07900018
STOWB    EQU   X'80'                    MASK                            08000018
WRTCK    EQU   X'80'                    MASK                            08100018
OVRFLO   EQU   X'20'                    MASK                            08200018
PCI      EQU   X'20'                    MASK                            08300018
MINKEY   EQU   X'01'                    MASK                            08400018
CONCAT   EQU   X'FF'                    MASK                            08500018
UTFMASK  EQU   X'02'               MASK FOR TOTALING FACILITY      UT18 08550018
UPDATEB  EQU   X'80'                    MASK                     S19015 08570019
BYPASS   EQU   X'10'               BYPASS DOS EMBEDDED CHKPT     S21040 08580021
*                                  RCDS IN TAPE DATA SETS               08590021
*                                                                       08600018
*********************************************************************   08700018
*                                                                       08800018
* MASKS FOR ACCESS METHODS IN SAM                                       08900018
*                                                                       09000018
QSAMB    EQU   X'01'                    MASK                            09100018
BSAMBIT  EQU   X'00'                    MASK                            09200018
PAM      EQU   X'02'                    MASK                            09300018
*                                                                       09400018
******************************************************************      09406019
ASISVLN  EQU   9                        DBLWRDS FOR IRB WKA      YM1141 09456002
ADLEN    EQU   3                        LENGTH OF AN ADDR        S19015 09466019
TWOBYTES EQU   16                       NO OF BITS IN 2 BYTES    S19015 09472019
NOID     EQU   X'00'                    INDICATE NO MORE MODULES S19015 09478019
BFTEKR   EQU   X'20'                    BDAM VS                  S19015 09484019
*                                                                       09490019
*                                                                       09500018
* MASKS FOR MACRO'S TO BE USED                                          09600018
*                                                                       09700018
GETB     EQU   X'40'                    MASK                            09800018
PUTB     EQU   X'40'                    MASK                            09900018
READB    EQU   X'20'                    MASK                            10000018
WRITEB   EQU   X'20'                    MASK                            10100018
POINTB   EQU   X'04'                    MASK                            10200018
CNTRLB   EQU   X'02'                    MASK                            10300018
*                                                                       10400018
*                                                                       10500018
*********************************************************************   10600018
* MASKS FOR DEVICES TO BE SUPPORTED                                     10700018
*                                                                       10800018
*                                                                       10900018
*********************************************************************   11000018
*                                                                       11100018
NORCDRY  EQU   X'20'                    RCD READY MASK           S20201 11150020
SDINDIC  EQU   X'08'                    SEARCH DIRECT INDICATOR  S20201 11200020
TRKOVFL  EQU   X'20'                    TRK OVERFLOW MASK        S20201 11250020
*                                                                       11300018
*                                                                       11400018
*********************************************************************   11500018
*                                                                       11600018
* MASKS FOR STATUS BITS TO BE TESTED                                    11700018
*                                                                       11800018
*                                                                       11900018
EXCPN    EQU   X'30'                    MASK                            12000018
COMPLETE EQU   X'80'                    MASK                            12100018
FIRSTIOB EQU   X'01'                    MASK                            12200018
*                                                                       12300018
*                                                                       12400018
*                                                                       12500018
*********************************************************************   12600018
*                                                                       12700018
* MASKS FOR BUFFER TECHNIQUE'S                                          12800018
*                                                                       12900018
CYCLICB  EQU   X'20'                                                    13000018
EXCHANGB EQU   X'10'                                                    13100018
SIMPLEB  EQU   X'40'                                                    13200018
EXCHCYCL EQU   X'30'                                                    13300018
*                                                                       13400018
*                                                                       13500018
* MODES  OPERATION FOR QSAM                                             13600018
LOCATEB  EQU   X'08'                                                    13700018
MOVEB    EQU   X'10'                                                    13800018
SUBSTUTB EQU   X'04'                                                    13900018
DATAMODE EQU   X'01'                                                    14000018
* COMMAN YTES FOR THE 2841                                              14100018
SRCHE    EQU   X'31'                                                    14200018
WRTCKD   EQU   X'1D'                                                    14300018
RDC      EQU   X'92'                                                    14400018
RDKD     EQU   X'8E'                                                    14500018
RDD      EQU   X'86'                                                    14600018
TIC      EQU   X'08'                                                    14700018
* MASKS   RECORD FORMATS                                                14800018
STANDRDF EQU   X'08'                                                    14900018
FORMATU  EQU   X'C0'                                                    15000018
FORMATF  EQU   X'80'                                                    15100018
FORMATV  EQU   X'40'                                                    15200018
FORMATD  EQU   X'20'                    D FORMAT RECORDS         S20038 15250020
SPANNED  EQU   X'08'                                                    15300018
BLOCKED  EQU   X'10'                                                    15400018
FIXEDBLK EQU   X'90'                                                    15500018
*   CHAN  CONTROL WORD FLAGS                                            15600018
SKIP     EQU   X'10'                                                    15700018
SLI      EQU   X'20'                                                    15800018
CC       EQU   X'40'                                                    15900018
DATACH   EQU   X'A0'                                                    16000018
SLICC    EQU   X'60'                                                    16100018
SLICCSK  EQU   X'70'                                                    16200018
KEYS     EQU   X'01'                                                    16300018
QSAM     EQU   X'01'                                                    16400018
ASA      EQU   X'04'                                                    16800018
BKREAD   EQU   X'01'                                                    16900018
URBITS   EQU   X'40'                                                    17000018
TAPEB    EQU   X'80'                                                    17100018
DABIT    EQU   X'20'                                                    17200018
R25      EQU   25                       CONSTANT                        17300018
R3       EQU   3                        CONSTANT                        17400018
R5       EQU   5                        CONSTANT                        17500018
OFF      EQU   X'7F'                    MASK TO TURN OFF UPDATE  S19015 17510019
*                                           BIT                         17520019
BYTE     EQU   1                        ONE CONSTANT             S19015 17530019
ABENDISP EQU   17                       ABEND DISPLACEMENT              17540001
IRBDISP  EQU   24                       IRB DISPLACEMENT         S19015 17550019
ADDISP   EQU   25                       ADDRESS DISPLACEMENT     S19015 17560019
*                                                                       17600018
*                                                                       17700018
         BALR  RBASE,RE                 SET BASE                        17800018
         USING SLDA,RBASE                                               17900018
         USING IHADCB,RDCB                                              18000018
         USING BLDEB,RDEB                                               18100018
         USING FORCORE,RCORE                                            18200018
*                                                                       18400018
*                                                                       18500018
SLDA     EQU   *                                                        18600018
*                                                                       18700018
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 18750002
         DC    C'IGG01991'              MODULE NAME              Y02072 18760002
         DC    C'@ZA28034'              LAST SHIP CODE         @ZA28034 18770037
         DC    C'02/02/78'              LAST DATE MODIFIED     @ZA28034 18776037
BEGIN    DS    0H                                                Y02072 18790002
*                                                                       18800018
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 18900018
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   19000018
         L     RCORE,4(RWTGC)           GET WORK AREA                   19050000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 19100018
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  19300018
*                                                                       19400018
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           19500018
         USING AVT,RTIOT                                                19550001
         SR    RUCB,RUCB                CLEAR REG                       19600018
         SR    RF,RF                    CLEAR RER                       19700018
         SR    RD,RD                                                    19800018
         IC    RD,DEBNMSUB              GET NBR OF MODULES LOADED       19850018
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           19900018
         IC    RF,DEBEXSCL              GET SCALING FACTOR              20000018
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  20100018
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        20200018
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    20300018
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      20400018
*                                                                       20500018
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB                20600018
*  BUT MUST BE INCREMENTED TO POINT BEYOND THE LAST ENTRY          UT18 21000018
*                                                                       21400018
SLDAA    EQU   *                                                   UT18 21800018
         CLI   0(RUCB),X'00'            IS RUCB BEYOND LAST ENTRY  UT18 22200018
         BE    SLDAB                    BR IF YES                  UT18 22600018
         LA    RUCB,2(RUCB)             INCREMENT TO NEXT ID FIELD UT18 23000018
         B     SLDAA                    TEST NEXT FIELD            UT18 23400018
*                                                                       23800018
*                                                                       24200018
*  RUCB NOW POINTS TO NEXT AVAILABLE SUBROUTINE ID FIELD IN THE    UT18 24600018
*  DEB.                                                            UT18 25000018
*                                                                       25400018
SLDAB    EQU   *                                                 S21040 28400021
*                                                                       31700018
*      GET THE EOB MODULES NEEDED FOR THIS FILE                         31800018
*                                                                       31900018
SLDAPP00 EQU   *                                                        32000018
         TM    JFCBMASK+D6,SDINDIC      SEARCH DIRECT USED       S20201 32005020
         BNO   NOSDOPT                  BRANCH NO                S20201 32010020
         LA    RB,CEAFP                 GET SEARCH DIRECT CE     S20201 32015020
         BAL   RC,SLDROUT               LOAD ROUTINE             S20201 32020020
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    32025001
         LA    RB,AEOESF                GET END FO EXTENT APPEN  S20201 32045020
         BAL   RC,SLDROUT               LOAD IT IN AND PUT       S20201 32050020
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   32055001
         B     SLDAPP19                 GET READY TO XCTL        S20201 32065020
*                                                                       32070020
NOSDOPT  EQU   *                                                 S20201 32075020
         TM    JFCBMASK+RCDRYOF,NORCDRY ANY DEVICES W/O RCD      S20201 32080020
*                                       READY                    S20201 32085020
         BO    LAB001                  NO,BRANCH                 S20201 32090020
         LA    RB,AEOESF                GET READY TO LOAD IN     S20201 32110020
*                                        END OF EXT APPEN.              32115020
*                                         IGG019C4                      32120020
LAB001   EQU   *                                                 S20201 32125020
         TM    DCBCIND2,UPDATEB         IS IT UPDATE             S19015 32130019
         BO    SLDAPP02                 YES, BRANCH              S19015 32160019
         TM    0(RPARC),OUTP            DCB FOR OUTPUT ONLY             32200018
         BO    SLDAPP10                 YES, BRANCH              S20201 32300020
*                                                                       32400018
*  END OF EXTENT  APPENDAGE NEEDED FOR DISK INPUT                       32500018
*                                                                       32600018
         TM    DCBDEVT,X'20'           D.A. DEVICE                      32700018
         BZ    SLDAPP10                NO BRANCH                 Y02072 32800002
         TM    DCBCIND1,X'40'          SEARCH DIRECT INPUT              32900018
         BNO   LAB01                    NO, LOAD CH              S20201 32960020
         B     SLDAPP03                 BRANCH                   S20201 33020020
*                                                                       33100018
LAB01    EQU   *                                                 S20201 33150020
         LA    RB,AEOE                 GET END OF EXTENT ID             33200018
         B     SLDAPP03                 LOAD                     S19015 33210019
*                                                                       33220019
SLDAPP02 EQU   *                                                 S19015 33230019
*                                                                       33240019
         LA    RB,QUEOE                 GET END-OF-EXTENT ID     S19015 33250019
*                                                                       33260019
SLDAPP03 EQU   *                                                 S19015 33270019
*                                                                       33280019
         BAL   RC,SLDROUT              LOAD ROUTINE                     33300018
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   33400001
*                                                                       33500018
*        LENGTH CHECKING IS REQUIRED FOR DCB                            33600018
*                                                                       33700018
SLDAPP10 EQU   *                                                        34600018
         TM    0(RPARC),OUTP            DCB FOR OUTPUT ONLY?  @ZA28034  34610037
         BO    SLDAPP14                 YES-NO LENGTH CHECK   @ZA28034  34614037
*                                       APPEN NEEDED.         @ZA28034  34618037
         TM    JFCBMASK+RCDRYOF,NORCDRY ANY DEVICES W/O RCD      S20201 34622037
*                                       READY                    S20201 34626037
         BZ    LAB002                   BRANCH IF NO             A49371 34630037
         B     AROUND                   ELSE CHECK FOR C.E. APD  A49371 34638021
LAB002   EQU   *                                                 S20201 34640020
         TM    DCBRECFM,FORMATU         U FORMAT W/RCD READY     S20201 34650020
         BM    AROUND                   NO BRANCH                Y02072 34660002
         TM    DCBRECFM,TRKOVFL         TRACK OVERFLOW USED      S20201 34670020
         BO    AROUND                   BRANCH IF YES            S20201 34680020
         LA    RB,ACEU                  GET RCD READY U FORM CE  S20201 34690020
         B     SLDAPP08                 GO LOAD ROUTINE          Y02072 34700002
AROUND   EQU   *                                                 S20201 34740020
*                                                                       34750020
*                                                                       34760020
         TM    DCBOPTCD,BYPASS          BYPASS DOS CHKPT RCD     S21040 34860021
         BO    SLDAPP11                 BRANCH IF YES            S21040 34960021
SALADS   EQU   *                                                 S20038 35303020
         TM    DCBCIND2,QSAMB           QSAM BEING USED          S19015 35306019
         BO    SLDAPP06                 YES--BRANCH              S19015 35312019
         TM    DCBBFTEK,BFTEKR          VS BDAM SUPPORT NEEDED   S19015 35318019
         BZ    SLDAPP06                 NO--CONTINUE             S19015 35324019
         LA    RB,CEAOFRD               OFFSET READ CHANNEL END  S19015 35330019
         BAL   RC,SLDROUT               GO LOAD ROUTINE          S19015 35336019
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    35342001
         ST    RE,AVTABNE               APPENDAGE TABLE ENTRY FOR       35348001
*                                       ABNORMAL END APPENDAGE          35354001
         L     RJ,DCBCNTRL              NO EOB MODULES NEEDED    S19015 35360019
         SRL   RJ,TWOBYTES              SHIFT OUT EOB ID BYTES   S19015 35366019
         ST    RJ,DCBCNTRL                                       S19015 35372019
         B     SLDAPP19                 GET READY TO XCTL        S20201 35378020
*                                                                       35384019
SLDAPP06 EQU   *                                                 S19015 35390019
         LA    RB,ACEV                  GET V LN CKNG APPN.             35400018
SLDAPP08 EQU   *                                                 Y02072 35450002
*                                                                       35458002
         BAL   RBRANCH,SLDROUT          GO LOAD ROUTINE          Y02072 35460002
         ST    RWK1,AVTCE               ST CE APPENDAGE          Y02072 35470002
         TM    DCBDEVT,DABIT            IS THIS DA               YM5922 35480002
         BZ    SLDAPP14                 NO, BYPASS ABN END APP   Y02072 35490002
         TM    DCBRECFM,DCBRECTO        TRACK OVERFLO            Y02072 35492002
         BO    SLDAPP17                 YES, GO GET 19C3         Y02072 35494002
         AH    RWK1,SECENTRY            ABN END ENTRY PT ADDR    Y02072 35496002
         ST    RWK1,AVTABNE             ST ADDRESS               Y02072 35498002
         B     SLDAPP17                 GO AROUND                Y02072 35498402
SLDAPP11 EQU   *                                                        35600018
         LA    RB,DACEV                 GET V APPEND. FOR BYPASS S21040 35660021
*                                       DOS EMBEDDED CHKPT RCDS         35720021
SLDAPP12 BAL   RC,SLDROUT               LOAD ROUTINE                    35800018
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    35900001
         MVC   ABENDISP(ADLEN,RTIOT),ADDISP(RWTG) APPENDAGE ADDR S21040 35960021
*                                    TO ABNORMAL END FIELD IN DEB       35980021
SLDAPP14 EQU   *                                                        36000018
         TM    DCBDEVT,X'48'            PRINTER USED                    36100018
         BC    14,SLDAPP17              NO BRANCH                       36200018
         LA    RB,PSIO                  GET SIO APPNDAGE                36300018
*                                                                       36320019
SLDAPP15 EQU   *                                                 S19015 36340019
*                                                                       36360019
         BAL   RC,SLDROUT               LOAD ROUTINE                    36400018
         ST    RE,AVTSIO                APPENDAGE TABLE ENTRY FOR SIO   36500001
         B     SLDAPP19                 SKIP TO NEXT                    36600018
*                                                                       36700018
SLDAPP17 EQU   *                                                        36800018
*                                                                       36803019
         TM    DCBCIND2,UPDATEB         IS IT UPDATE             S19015 36806019
         BNO   SLDAPP19                 NO BRANCH                S19015 36809019
*                                                                       36812019
         NI    DCBCIND2,OFF             TURN OFF UPDATE BIT      S19015 36815019
*                                                                       36818019
         TM    DCBRECFM,OVRFLO          ARE TRACK OVERFLOW       S19015 36821019
*                                       MODULES                  S19015 36824019
*                                           REQUIRED                    36827019
         BZ    SLDAPP18                 NO BRANCH                S19015 36830019
*                                                                       36833019
         LA    RB,TOABNE                GET ADDRESS OF ABNORMAL  S19015 36836019
*                                           END APPEND. FOR TRACK       36839019
*                                            OVERFLOW INPUT             36842019
         BAL   RC,SLDROUT               LOAD ROUTINE             S19015 36845019
         ST    RE,AVTABNE               APPENDAGE TABLE ENTRY FOR       36846401
*                                       ABNORMAL END APPENDAGE          36848401
*                                                                       36854019
         LA    RB,ASYNCH                GET ID OF ASYNCHRONOUS   S19015 36857019
*                                       RTN                      S19015 36860019
         BAL   RC,SLDROUT               LOAD ROUTINE             S19015 36863019
*                                                                       36866019
******************************************************************      36869019
*                                                                       36872019
*        BUILD IRB FOR IGG019C1 - WORKAREA IS USED IN 19C3              36873002
*                                                                       36874002
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE),WKAREA=ASISVLN    YM1141 36875002
*                                                                       36878019
         ST    RF,IRBDISP(RWTG)         STORE ADDRESS OF IRB     S19015 36881019
         MVC   DEBIRBAD+BYTE(ADLEN),ADDISP(RWTG) PUT IRB ADDR    S19015 36884019
*                                           IN DEB                      36887019
*                                                                       36900018
SLDAPP18 EQU   *                                                        37000018
*                                                                       37100018
         LA    RB,USIO                  GET SIO APPENDAGE ID     S19015 37130019
         BAL   RC,SLDROUT               GO LOAD MODULE                  37160001
         ST    RE,AVTSIO                APPENDAGE TABLE ENTRY FOR SIO   37170001
*                                                                       37200018
SLDAPP19 EQU   *                                                        37300018
         USING WTGENTRY,RWTGC                                    Y02072 37350002
         MVC   WTGIDTTR,SOP9            ID OF NEXT EXEC        @Z30TSCF 37400003
*                                                                       43500018
         STC   RD,DEBNMSUB              STORE NO. SUB RTS LOADED        43600018
*                                                                       43700018
*********************************************************************** 43800018
*                                                                       43900018
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        44000018
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     44100018
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            44200018
         BCR   8,RBASE                  BACK TO OPEN CONTROL            44300018
*                                                                       44400018
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    44500018
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             44600018
*                                                                       44700018
         LR    RPARC,RPAR                                               44800018
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       44900018
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           45000018
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         45100018
*                                                                       45200018
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  45300018
         LA    RPARC,PLOFF(0,RPARC)                                     45400018
         B     ZCHEK                    COMPLETE                        45500018
*                                                                       45600018
TCTLRTN  EQU   *                                                        45700018
         USING WTG,RWTG                                                 45750003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*45800003
               MODID=WTGENTRY                                  @Z30TSCF 45850003
         DROP  RWTGC,RWTG                                      @Z30TSCF 45950003
*                                                                       46400018
*                                                                       46500018
*                                                                       46600018
SLDROUT  EQU   *                                                        48400018
         USING WTGMODNM,RWTG                                     Y02072 48450002
         MVC   WTGMODID,0(RB)           ID TO MOD NAME           Y02072 48500002
         DROP  RWTG                                              Y02072 48550002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 48600002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 48650002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 48700002
         DROP  R1                       DROP CVT BASE            YM1140 48750002
*                                                                       48800002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 49700002
*                                                                       49800018
*                                                                       49900018
*                                                                       50000018
         ST    RE,24(RWTG)             TEMP STORE OF ROUTINE ADDR,      50100018
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        50200018
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               50300018
         LA    RD,1(RD)                 ONE MORE SUB RT LOADED          50400018
         BR    RC                      RETURN                           50500018
*                                                                       52600018
*********************************************************************** 52700018
*                                                                       52800018
*                                                                       52802018
*                                                                       52804018
*                                                                       52806018
WAOFF    EQU   32                                                       52808018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           52810018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           52812018
FOUR     DC    H'4'                     4                        M4567  52813019
SECENTRY EQU   FOUR                     ADDITIONAL ENTRY POINT   Y02072 52813402
*                                         IN APPENDAGE           Y02072 52813802
OPIDCNST DC    C'0S'                    ID                              52814018
AMIDCNST DC    C'91'                    MODULE ID                  UT18 52832018
SOP9     DC    C'93',VL3(IGG01993)      NEXT EXEC              @Z30TSCF 52832503
*                                                                       53700018
*        BELOW ARE THE SHARABLE ROUTINES USED BY BSAM / QSAM            58200018
*                                                                       58500018
*        APPENDAGES USED BY BSAM AND QSAM   ---------------------       58600018
*                                                                       58800018
AEOE     DC    C'CH'                    END OF EXTENT APPNDG NON-SF-INP 58900018
QUEOE    DC    C'AW'                    END OF EXTENT FOR UPDATE S19015 59120019
DACEV    DC    C'EJ'                    CHAN/ABNORM END APPNDG   S21040 59200021
*                                       FOR BYPASS OF DOS CHKPT RCDS    59240021
ACEV     DC    C'CJ'                    CHANNEL END APPNDG LEN CHK VREC 59500018
CEAOFRD  DC    C'BV'                    OFFSET READ CEA          S19015 59740019
PSIO     DC    C'CL'                    APPENDAGE FOR PRINTERS SIO      60100018
USIO     DC    C'CG'                    SIO FOR UPDATE           S19015 60308019
TOABNE   DC    C'C3'                    ABNORMAL END APPENDAGE   S19015 60332019
*                                       FOR OVERFLOW             S19015 60340002
ASYNCH   DC    C'C1'                    T.O. ASYNCHRONOUS ERR    S19015 60364019
ACEU     DC    C'C0'                    RCD READY U FORMT CHAN   S20201 62280002
*                                       END                      S20201 62290020
AEOESF   DC    C'C4'                    S.D.END OF EXT APPEN     S20201 62300002
CEAFP    DC    C'FP'                    SEARCH DIRECT CHANNEL    S20201 62310002
         SPACE                                                          62320002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 62330002
END      EQU   *                        END OF MODULE            Y02072 62700002
 TITLE 'IGG01991 - FORMAT OF GOTTEN COrE'                               62800018
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 62850003
         ORG   WTGIDTTR                                          Y02072 62900002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 62950002
*                                                                       63100018
AVT      DSECT                          APPENDAGE VECTOR TABLE          63106001
AVTEOEPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63112001
AVTEOE   DS    A                        ADDR OF END OF EXTENT           63118001
*                                       APPENDAGE                       63124001
AVTSIOPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63130001
AVTSIO   DS    A                        ADDR OF START I/O               63136001
*                                       APPENDAGE                       63142001
AVTPCIPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63148001
AVTPCI   DS    A                        ADDR OF PCI APPENDAGE           63154001
AVTCEPG  DS    0CL1                     NO.PAGES MODULE REQUIRES        63160001
AVTCE    DS    A                        ADDR OF CHANNEL END             63166001
*                                       APPENDAGE                       63172001
AVTABNPG DS    0CL1                     NO.PAGES MODULE REQUIRES        63178001
AVTABNE  DS    A                        ADDR OF ABNORMAL END            63184001
*                                       APPENDAGE                       63194001
*                                                                       63200018
CVT      DSECT                                                          63300018
         CVT                                                            63400018
*                                                                       63500018
*                                                                       63600018
BLDEB    DSECT                                                          63700018
DEB      DS    0F                       ALIGN                           63800018
DEBNMSUB DS    0CL1                     NO. OF SUB.                     63900018
DEBTCBAD DS    CL4                      TCB ADDR.                       64000018
DEBAMLNG DS    0CL1                     ACCESS METHOD LEN.              64100018
DEBDEBAD DS    CL4                      DEB ADDR.                       64200018
DEBOGLGS DS    0CL1                     OPTION                          64300018
DEBIRBAD DS    CL4                      IRB ADDRESS                     64400018
DEBOPATB DS    0CL1                     OPTION                          64500018
DEBSYSPG DS    CL4                      SYS ABEND                       64600018
DEBNMEXT DS    0CL1                     NO. OF EXTENT                   64700018
DEBUSRPG DS    CL4                      USER PROG.                      64800018
DEBPRIOR DS    0CL1                     PRIORITY                        64900018
DEBECBAD DS    CL4                      ECB ADDRESS.                    65000018
DEBPROTG DS    0CL1                     PROTECTION KEY                  65100018
DEBDEBID DS    0CL1                     DEB ID                          65200018
DEBDCBAD DS    CL4                      DCB ADDRESS                     65300018
DEBEXSCL DS    0CL1                     EXCEPTION                       65400018
DEBAPPAD DS    CL4                      APPENDAGE ADDRESS               65500018
DEBDVMOD DS    0CL1                     DEVICE                          65600018
DEBUCBAD DS    CL4                      UCB ADDRESS                     65700018
DEBBINUM DS    CL2                      BIN NUMBER                      65800018
DEBSTRCC DS    CL2                      START CYC.                      65900018
DEBSTRHH DS    CL2                      START TRACK                     66000018
DEBENDCC DS    CL2                      END CYCLINDER                   66100018
DEBENDHH DS    CL2                      END TRACK                       66200018
DEBNMTRK DS    CL2                      NO. OF TRACKS                   66300018
*                                                                       66400018
           DCBD  DSORG=PS                                               66500018
DCBECC   EQU   DCBCHECK+1               DCB FIELD                       66600018
         IKJTCB                                                         66610001
         END                                                            66700018
./  ADD  SSI=52840121,NAME=IGG01992
1992 TITLE 'IGG01992-SAM STAGE 3 OPEN EXEC FOR FORMAT-V/CHAINED SCHEDULX00200003
               ING/USER TOTALING'                                       00250003
IGG01992 CSECT                                                     UT18 00400018
*********************************************************************** 00450003
*                                                                       00500003
*MODULE NAME - IGG01992                                          Y02072 00800002
*                                                                       00850002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00900002
*                                                                       00950002
*COPYRIGHT - NONE                                                Y02072 00960002
*                                                                       00970002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00980002
*                                                                       00990002
*          RELEASE 20 DELETIONS                                       * 01000018
*1273161200,240500-240700                                        A32160 01100020
*1273392000,422000-430000,691800,815000,820000-822000            S20201 01150020
*          RELEASE 21 DELETIONS                                       * 01200018
*0084024600-025800,027900,028800,240100-241400,302000-338000,    M1753  01250021
*0084346000-388000,492000-548000,664000-684800,687600,688200,    M1753  01300021
*0084690000-691432,691900-694000,790000-814700,819000-820000     M1753  01350021
*                                                                       01360002
*        VS 2 RELEASE 02 DELETIONS                                      01370002
*002500,023600,237000,238500-240000,396180-396280,396720-396820, Y02072 01380002
*440100-441300,646180-647890,815000,815400-815700,396960-396990  Y02072 01390002
*480000,614000,618000-640000,646000,492000,578000-580000,        Y02072 01392002
*586000,616000,824000-826000                                     Y02072 01394002
*                                                                YM1141 01394202
*                                                                YM1140 01396202
*                                                                YM2507 01398202
*C396660                                                         YM5922 01398602
*                                                                YM1002 01398702
*                                                                       01399103
*          VS2 RELEASE 3 DELETIONS                                      01399503
*                                                              @Z30TSCF 01399903
*                                                                       01400002
*        VS 2 RELEASE 03                                                01450003
*593100                                                         ZA02510 01500003
*C467996                                                        ZA05244 01510003
*                                                                       01550003
*STATUS CHANGE LEVEL 006                                                02360003
*                                                                       02410002
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE           02430018
*    IGG01916 AND LOADS I/O APPENDAGES AND AN ASYNCHRONOUS ROUTINE,     02460021
*    AS APPROPRIATE.  THE ENTRY POINTS OF THE LOADED APPENDAGES ARE     02480021
*    PLACED IN THE APPENDAGE VECTOR TABLE.  FOR TRACK OVERFLOW, A       02500021
*    CIRB MACRO IS ISSUED, AND THE ENTRY POINT OF THE ASYNCHRONOUS      02520021
*    ROUTINE IS PLACED IN THE IRB.  ID'S FOR ALL LOADED MODULES ARE     02540021
*    PLACED IN THE SUBROUTINE ID SECTION OF THE DEB.                    02560021
*                                                                       02610018
*ENTRY POINTS - THE MODULE IS ENTERED BY MEANS OF AN XCTL FROM          02640018
*    IGG01916.                                                          02670018
*                                                                       02700018
*INPUT - SEE DESCRIPTION OF REGISTER CONTENTS.                          02730018
*                                                                       02760018
*OUTPUT - SUBROUTINES LOADED, ENTRY POINT ADDRESSES, ID'S IN DEB.       02790021
*                                                                       02820018
*EXTERNAL ROUTINES - NONE                                               02850018
*EXITS - NORMAL - XCTL TO IGG01994                                      02880021
*      - ERROR - NONE                                                   02910018
*                                                                       02940018
*TABLES/WORKAREAS - DESCRIBED BY DSECTS AT END OF MODULE LISTING        02970018
*                                                                       03000018
*ATTRIBULES - REENTRANT, RUNS IN DATA MANAGEMENT KEY,            Y02072 03030002
*             RUNS IN SUPERVISOR STATE                           Y02072 03040002
*                                                                       03060018
*                                                                       03090018
*********************************************************************** 03100003
         EJECT                                                          03110003
*                                                                       03120018
* REGISTER CONVENTIONS                                                  03150018
*                                                                       03180018
*                                                                       03400018
RE       EQU   0                        WORK REG5                       03600018
RF       EQU   1                        WORK REG6                       03800018
R1       EQU   RF                       PARM REGISTER            Y02072 03850002
RDCB     EQU   2                        DCB                             04000018
RBASE    EQU   3                        BASE                            04200018
RCORE    EQU   4                        WORE AREA                       04400018
RPAR     EQU   5                        TOP OF PARAMETER                04600018
RWTG     EQU   6                        TOP OF WTG TABLE                04800018
RPARC    EQU   7                        CURRENT PARAMETER               05000018
RWTGC    EQU   8                        CURRENT TRANS LOAD              05200018
RTIOT    EQU   9                        TIOT                            05400018
RUCB     EQU   10                       UCB                             05600018
RDEB     EQU   11                       DEB                             05800018
RB       EQU   12                       WORK REG1                       06000018
RC       EQU   13                       WORK REG2                       06200018
RBRNCH   EQU   RC                       BRANCH REGISTER          Y02072 06250002
RD       EQU   14                       WORK REG3                       06400018
RJ       EQU   15                       WORK REG4                       06600018
RWK2     EQU   RJ                       WORK REGISTER            Y02072 06650002
         SPACE 2                                                        06700003
T3       EQU   3                                                        06800018
T25      EQU   25                       25                              07000018
OUTP     EQU   X'0F'                    MASK                            07800018
ASISVLN  EQU   9                        DBLWORDS FOR IRB WKA     YM1141 21800202
SIX      EQU   6                        CONST OF SIX             S20201 21832020
NRECREDY EQU   X'20'                    *                        S20201 21904020
SDINDIC  EQU   X'08'                    SEARCH DIR MASK          S20201 21920020
ZERO     EQU   0                        DISPLACEMENT OF 0        S20201 21952020
         EJECT                                                          21960003
         BALR  RBASE,RE                 SET BASE                        22000018
         USING *,RBASE                                                  22200003
         SPACE                                                          23250002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 23300002
         DC    C'IGG01992'              MODULE NAME              Y02072 23350002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 23360003
         DC    C'10/24/74'              LAST DATE MODIFIED     @Z30TSCF 23370003
BEGIN    DS    0H                                                Y02072 23380002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 23400018
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   23600018
         USING IHADCB,RDCB                                              23610003
         L     RCORE,4(RWTGC)           GET WORK AREA                   23650000
         USING FORCORE,RCORE                                            23700003
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 23800018
         USING BLDEB,RDEB                                               23850003
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  24200018
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           24400018
         USING AVT,RTIOT                                                24410001
         SR    RUCB,RUCB                CLEAR REG                       24600018
         SR    RF,RF                    CLEAR RER                       24800018
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           25000018
         IC    RF,DEBEXSCL              GET SCALING FACTOR              25200018
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  25400018
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        25600018
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    25800018
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      26000018
*                                                                       26200018
*  RUCB NOW POINTS TO SUBROUTINE ID SECTION OF THE DEB,            UT18 26600018
*  BUT MUST BE INCREMENTED TO POINT BEYOND THE LAST ENTRY          UT18 27000018
*                                                                       27400018
SLDAA    EQU   *                                                   UT18 27800018
         CLI   0(RUCB),X'00'            IS RUCB BEYOND LAST ENTRY  UT18 28200018
         BE    SLDAB                    BR IF YES                  UT18 28600018
         LA    RUCB,2(RUCB)             INCREMENT TO NEXT ID FIELD UT18 29000018
         B     SLDAA                    TEST NEXT FIELD            UT18 29400018
SLDAB    EQU   *                                                   UT18 34200018
         TM    0(RPARC),OUTP           DCB FOR OUTPUT ONLY              39000018
         BO    LAB001                   YES,BRANCH               S20201 39200020
         TM    DCBRECFM,DCBRECTO        DCB FOR TRACK OVERFLOW          39400003
         BZ    SLDAPP04                 NO,MUST BE CHAINED SCHEDULING   39600003
         TM    JFCBMASK+SIX,SDINDIC     IS SEARCH DIR SPECIFIED  S20201 39603020
         BNO   NOSDIR                   IF NOT LOAD REGULAR      S20201 39606020
*                                           ROUTINES                    39609020
         LA    RB,CEAFP                 SD CHANNEL END APPENDAGE        39612001
         BAL   RC,SLDROUT               LOAD THE ROUTINE                39614001
         ST    RE,AVTCE                 STORE ADDR AS AVT ENTRY         39616001
         LA    RB,AEOESF                SD END OF EXTENT APPEND         39630001
         BAL   RC,SLDROUT               LOAD THE ROUTINE                39632001
         ST    RE,AVTEOE                STORE ADDR AS AVT ENTRY         39634001
         B     SLDAPP19                   LOADING ANYTHING ELSE  S20201 39642020
LAB001   EQU   *                                                 S20201 39654020
         TM    JFCBMASK+SIX,NRECREDY    IS IT RECORD READY       S20201 39657020
         BO    SLDAPP06                 NO, BRANCH TO PROCESS    S20201 39660020
*                                       OUTPUT                          39663020
         TM    DCBCIND2,DCBCNCHS        IS IT CHAINED SCHEDULING YM5922 39666003
         BO    SLDAPP04                 YES, BR AROUND           S20201 39669020
         B     LAB004                   CHECK FOR CE APPENDAGE          39683001
NOSDIR   EQU   *                                                        39684001
         LA    RB,TOABNE                GET ID OF T.O. ABNE      S20201 39687020
*                                       APPENDAGE                S20201 39690020
         BAL   RC,SLDROUT               LOAD ROUTINE             S20201 39693020
         ST    RE,AVTABNE               STORE ADDR AS AVT ENTRY         39702001
         TM    JFCBMASK+SIX,NRECREDY    IS IT RECORD READY       S20201 39714020
         BO    LAB01                    NO BRANCH AROUND         S20201 39717020
LAB004   EQU   *                                                        39718001
         TM    DCBRECFM,DCBRECU         RECORD READY WITH FORMAT S20201 39720003
*                                       U                        S20201 39723020
         BM    LABNOTU                  BRANCH IF NO             S20201 39726020
         TM    DCBRECFM,DCBRECTO        WITH TRK OVERFLOW ALSO   S20201 39729003
         BO    LAB01                    THEN BRANCH              S20201 39732020
         LA    RB,ACEU                  GET FORMATU RCD RDY CE   S20201 39735020
         B     SLDAPP02                 GO LOAD IT               S20201 39738020
LABNOTU  EQU   *                                                 S20201 39741020
         TM    DCBRECFM,DCBRECF         FIXED LINGTH RECORDS     S20201 39744003
         BZ    LAB01                    NO BRANCH AROUND LOAD OF S20201 39747020
*                                       CI                       S20201 39750020
         LA    RB,ACEF                  LOAD CI                  S20201 39753020
         B     SLDAPP02                 BRANCH TO LOAD CI        S20201 39756020
LAB01    EQU   *                                                 S20201 39759020
         TM    DCBRECFM,DCBRECU         U RECORDS                       39800003
         BO    SLDAPP03                 YES,NO LENGTH CHECK APPENDAGE   40000018
         LA    RB,ACEF                 GET F LN CHECK APPEND            40200018
         TM    DCBRECFM,DCBRECF+DCBRECBR  FIXED BLOCK RECORDS           40400003
         BO    SLDAPP02                YES,GO LOAD ROUTINE              40600018
         TM    DCBRECFM,DCBRECV         VARIABLE RECORDS                40800003
         BZ    SLDAPP03                 NO,NO LENGTH CHECK APPENDAGE    41000018
         LA    RB,ACEV                 GET V LN CHECK APPENDAGE         41200018
SLDAPP02 EQU   *                                                        41400018
         BAL   RC,SLDROUT              LOAD THE ROUTINE                 41600018
         ST    RE,AVTCE                 APPENDAGE TABLE ENTRY FOR CE    41800001
         TM    ZERO(RPARC),OUTP         DCB FOR OUTPUT ONLY      S20201 41860020
         BO    SLDAPP06                 YES, BRANCH              S20201 41920020
SLDAPP03 EQU   *                                                        42000018
         LA    RB,ASYNCH               GET ID OF ASYNCHRONOUS ROUTINE   43200018
         BAL   RC,SLDROUT              LOAD ROUTINE                     43400018
*                                                                       43415002
*        BUILD IRB FOR 1GG019C1 - WORKAREA IS USED IN 19C3              43430002
*                                                                       43445002
         CIRB  EP=(0),KEY=PP,MODE=PP,STAB=(RE),WKAREA=ASISVLN           43600002
         ST    RF,24(RWTG)             STORE ADDRESS OF IRB TEMPORARY   43800018
         MVC   DEBIRBAZ(T3),T25(RWTG)   INSERT IRB ADDR.                44000018
         LA    RB,AEOET                GET T. O. EOE ID                 44200018
         B     SLDAPP05                 BRANCH                          44400018
SLDAPP04 EQU   *                                                        44600018
         TM    DCBDEVT,X'20'           D.A. DEVICE                      44800018
         BZ    SLDAPP14                NO,BRANCH                        45000018
         LA    RB,AEOEP                GET END OF EXTENT ID FOR PCI     45400018
SLDAPP05 EQU   *                                                        45600018
         BAL   RC,SLDROUT              LOAD ROUTINE                     45800018
         ST    RE,AVTEOE                APPENDAGE TABLE ENTRY FOR EOE   46000001
SLDAPP06 EQU   *                                                        46200018
         TM    DCBRECFM,DCBRECTO        DCB FOR TRACK OVERFLOW          46400003
         BO    SLDAPP19                YES,PROCEED TO EOB               46600018
SLDAPP14 EQU   *                                                        46610002
*                                                                       46650002
* BEFORE LOADING CHAINED SCHEDULING APPENDAGE, TEST FOR A REAL   Y02072 46700002
* ADDRESS ENVIRONMENT.  IF V=R, LOAD IGG019V6 FROM SVCLIB        Y02072 46750002
* INSTEAD OF IGG019CU FROM LPALIB AND STORE PCI ENTRY POINT.     Y02072 46760002
* IF VIRTUAL, LOAD IGG019CU AND DO NOT STORE PCI ENTRY POINT     Y02072 46770002
* IN THE AVT.                                                    Y02072 46780002
*                                                                       46790002
         LA    RB,ACEO                  GET ID OF PCI/CE & ABNE APPEND  46792002
         LA    RBRNCH,SLDAPP17          RETURN ADDRESS           Y02072 46794002
         L     RWK2,DEBTCBAD            GET TCB ADDRESS          Y02072 46796002
         USING TCB,RWK2                                          Y02072 46798002
         TM    TCBFLGS6,TCBRV           IS TASK VIRT=REAL        Y02072 46798402
         DROP  RWK2                                              Y02072 46798802
         BZ    SLDROUT                  N0, BRANCH               Y02072 46799202
         LA    RB,VRPCI              GET V=R PCI APPENDAGE      OZ05244 46799603
         BAL   RBRNCH,SLDROUT1          GO GET PROPER APPENDAGE  Y02072 46799702
         ST    RE,AVTPCI                PCI ENTRY IN AVT         Y02072 46799802
SLDAPP17 LR    RF,RE                                             Y02072 47800002
         LA    RF,4(RF)                 PLUS 4 IS ENTRY POINT    Y02072 48000002
         ST    RF,AVTCE                 STORE EPA AS AVT ENTRY          48200001
*                                       FOR CHANNEL END APPENDAGE       48400001
         ST    RF,AVTABNE               STORE EPA AS AVT ENTRY          48600001
*                                       FOR ABNORMAL END                48800001
SLDAPP19 EQU   *                                                        49000018
         USING WTGENTRY,RWTGC                                    Y02072 49050002
         MVC   WTGIDTTR,NEXTMOD         ID OF NEXT EXECUTOR    @Z30TSCF 49100003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        55000018
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     55200018
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            55400018
         BCR   RWTGC,RBASE              RETURN                          55600018
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    55800018
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             56000003
         LR    RPARC,RPAR                                               56200018
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       56400018
ZCHEK    CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETE          56600003
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         56800003
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  57000018
         LA    RPARC,PLOFF(0,RPARC)                                     57200018
         B     ZCHEK                    TO ZERO CHECK                   57400018
TCTLRTN  EQU   *                                                        57600018
         USING WTG,RWTG                                                 57650003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*57700003
               MODID=WTGENTRY                                  @Z30TSCF 57750003
         DROP  RWTGC,RWTG                                      @Z30TSCF 57800003
*                                                                       59200018
*  COME HERE TO 'LOAD' MODULES                                   Y02072 59250003
*                                                                       59260002
SLDROUT  EQU   *                        DCB ADDR FOR LOADS      ZA02510 59310003
         L     R1,CVTPTR                GET COMM VECTOR         ZA02510 59360003
         USING CVT,R1                   CVT ADDRESSABILITY      ZA02510 59410003
         L     R1,CVTLINK               GET LINKLIB DCB ADDRESS ZA02510 59420003
         B     SLDROUT2                 GO LOAD ROUTINE          Y02072 59450002
*                                                                       59800018
*  COME HERE FOR LOAD OF IGG019V6 FROM SVCLIB                    Y02072 59850002
*                                                                       60400018
SLDROUT1 L     R1,CVTPTR                GET COMM VECTOR          Y02072 64200002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 64250002
         L     R1,CVTSVDCB              GET SVCLIB DCB ADDRESS   YM1002 64300002
         USING WTG,RWTG                                          Y02072 64450002
SLDROUT2 MVC   WTGMODID,0(RB)           ID TO MODULE NAME        Y02072 64500002
         DROP  RWTG,R1                                           YM1140 64550002
         LOAD  EPLOC=(RWTG),DCB=(1)     LOAD ACCESS METHOD RTN   YM1140 64600002
         ST    RE,24(RWTG)              TEMP STORE RTN ADDR             64609002
         SR    RD,RD                                                    64800018
         IC    RD,DEBNMSUB              GET NO OF SUBROUTINES LOADED    65000018
         LA    RD,1(RD)                 ADD ONE TO TOTAL                65200018
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF SUBRT LOADED 65400018
         MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB Y02072 65800002
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               66000018
         BR    RC                      RETURN                           66200018
         EJECT                                                          68560002
WAOFF    EQU   32                                                       68840018
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           68880018
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           68920018
OPIDCNST DC    C'0S'                     ID                             68960018
AMIDCNST DC    C'92'                    ID OF THIS MODULE          UT18 68992018
         SPACE 2                                                        71190002
NEXTMOD  DC    C'94',VL3(IGG01994)    NEXT EXECUTOR - IGG01994 @Z30TSCF 73190003
*        APPENDAGES USED BY BSAM AND QSAM   ---------------------       75600018
AEOEP    DC    C'CZ'                   EOE ID FOR PCI                   75800018
AEOET    DC    C'CH'                   EOE APPENDAGE NON-SF-INPUT       76200018
ACEO     DC    C'CU'                    ID                              76600018
ACES     DC    C'CK'                    CHANNEL END APPNDG SYSIN DELIM  77000018
ACEF     DC    C'CI'                   CHANNEL END APPNDG LEN CHK FREC  77400018
ACEV     DC    C'CJ'                   CHANNEL END APPNDG LEN CHK VREC  77800018
TOABNE   DC    C'C3'                   TRACK OVERFLOW ABNE APPNDG       78200018
ASYNCH   DC    C'C1'                   T.O. ASYNCHRONOUS ERROR ROUTINE  78600018
ACEU     DC    C'C0'                    CHANNEL END FOR FORMAT U S20201 81480020
         DC    C'  '                    FILLER FOR IGG019FN      YM2507 81490002
CEAFP    DC    C'FP'                    SEARCH DIR CHAN END      S20201 81510002
*                                       APPEN                    S20201 81520020
AEOESF   DC    C'C4'                     SCH DIR EOE APPEN       S20201 81530002
VRPCI    DC    C'V6'                    V=R PCI APPENDAGE        Y02072 81580002
         SPACE                                                          81582002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 81582402
END      EQU   *                        END OF MODULE            Y02072 81590002
         EJECT                                                          81600002
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 82150003
         ORG   WTGIDTTR                                          Y02072 82200002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 82250002
         EJECT                                                          82300003
AVT      DSECT                          APPENDAGE VECTOR TABLE          82610001
AVTEOEPG DS    0CL1                     NO.PAGES MODULE REQUIRES        82620001
AVTEOE   DS    A                        ADDR OF END OF EXTENT           82630001
*                                       APPENDAGE                       82640001
AVTSIOPG DS    0CL1                     NO.PAGES MODULE REQUIRES        82650001
AVTSIO   DS    A                        ADDR OF START I/O               82660001
*                                       APPENDAGE                       82670001
AVTPCIPG DS    0CL1                     NO.PAGES MODULE REQUIRES        82680001
AVTPCI   DS    A                        ADDR OF PCI APPENDAGE           82690001
AVTCEPG  DS    0CL1                     NO.PAGES MODULE REQUIRES        82700001
AVTCE    DS    A                        ADDR OF CHANNEL END             82710001
*                                       APPENDAGE                       82720001
AVTABNPG DS    0CL1                     NO.PAGES MODULE REQUIRES        82730001
AVTABNE  DS    A                        ADDR OF ABNORMAL END            82740001
*                                       APPENDAGE                       82750001
         EJECT                                                          82760003
CVT      DSECT                                                          82800018
         CVT                                                            83000018
         EJECT                                                          83050003
BLDEB    DSECT                                                          83200018
DEB      DS    0F                       ALIGN                           83400018
DEBNMSUB DS    0CL1                     NO. OF SUB.                     83600018
DEBTCBAD DS    CL4                      TCB ADDR.                       83800018
DEBAMLNG DS    0CL1                     ACCESS METHOD LEN.              84000018
DEBDEBAD DS    CL4                      DEB ADDR.                       84200018
DEBOGLGS DS    0CL1                     OPTION                          84400018
DEBIRBAD DS    CL4                      IRB ADDRESS                     84600018
DEBOPATB DS    0CL1                     OPTION                          84800018
DEBSYSPG DS    CL4                      SYS ABEND                       85000018
DEBNMEXT DS    0CL1                     NO. OF EXTENT                   85200018
DEBUSRPG DS    CL4                      USER PROG.                      85400018
DEBPRIOR DS    0CL1                     PRIORITY                        85600018
DEBECBAD DS    CL4                      ECB ADDRESS.                    85800018
DEBPROTG DS    0CL1                     PROTECTION KEY                  86000018
DEBDEBID DS    0CL1                     DEB ID                          86200018
DEBDCBAD DS    CL4                      DCB ADDRESS                     86400018
DEBEXSCL DS    0CL1                     EXCEPTION                       86600018
DEBAPPAD DS    CL4                      APPENDAGE ADDRESS               86800018
DEBDVMOD DS    0CL1                     DEVICE                          87000018
DEBUCBAD DS    CL4                      UCB ADDRESS                     87200018
DEBBINUM DS    CL2                      BIN NUMBER                      87400018
DEBSTRCC DS    CL2                      START CYC.                      87600018
DEBSTRHH DS    CL2                      START TRACK                     87800018
DEBENDCC DS    CL2                      END CYCLINDER                   88000018
DEBENDHH DS    CL2                      END TRACK                       88200018
DEBNMTRK DS    CL2                      NO. OF TRACKS                   88400018
DEBIRBAZ EQU   DEBIRBAD+1                                               88600018
*                                                                       88800018
         EJECT                                                          88850003
           DCBD  DSORG=PS                                               89000018
DCBEOBZ  EQU   DCBEOB+1                                                 89200018
DCBCNTZZ EQU   DCBCNTRL+3                                               89400018
DCBEOBWZ EQU   DCBEOBW+1                                                89600018
DCBCNTRZ EQU   DCBCNTRL+1                                               89800018
DCBEOBRZ EQU   DCBEOBR+1                                                90000018
DCBSYZ   EQU   DCBSYNAD+2                                               90200018
DCBSYX   EQU   DCBSYNAD+3                                               90400018
DCBGETZ  EQU   DCBGET+1                                                 90600018
DCBMACRZ EQU   DCBMACRF+1                                               90800018
DCBPERZ  EQU   DCBPERR+1                                                91000018
DCBCHECZ EQU   DCBCHECK+1                                               91200018
         EJECT                                                          91250003
         IKJTCB                                                         91300001
           END                                                          91400018
./  ADD  SSI=43090085,NAME=IGG01993
         TITLE 'IGG01993 - 2ND HALF OF IGG01991'                        00100020
IGG01993 CSECT                                                          00200020
*MODULE NAME - IGG01993                                          Y02072 00210002
*                                                                       00220002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00230002
*                                                                       00240002
*COPYRIGHT - NONE                                                Y02072 00242002
*                                                                       00244002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00246002
*                                                                       00250002
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00300002
*001500,011500,013600,014100,190600,191500-194000,383500,413500, Y02072 00350002
*629000-630000,624600,458000-459000,463000,485000-479000,        Y02072 00360002
*528160-528300                                                   Y02072 00410002
*                                                                YM1140 00460002
*                                                                YM4640 00460102
*                                                                YM6834 00470102
*                                                                       00480103
*          VS2 RELEASE 3 DELETIONS                                      00490103
*                                                              @Z30TSCF 00492103
*          RELEASE 20 DELETIONS                                       * 00500020
*1262                                                            S20038 00550020
*1262134600,192300-192420                                        A32160 00570020
*0000528360-531000,537000-603800,624300,625600-626200            M4028  00580020
*          RELEASE 21 DELETIONS                                       * 00600020
*                                                                       00700002
*STATUS CHANGE LEVEL 005                                                01150002
*                                                                       01200002
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE           01210020
*    IGG01991 AND LOADS  THE END-OF BLOCK RTNS AND PLACES THEIR         01220020
*    ADDRESSES IN THE DCB.                                              01230020
*                                                                       01240020
*    THIS MODULE WAS SPLIT FROM IGG01991 IN RLSE 20.                    01250020
*                                                                       01270020
*ENTRY POINTS - THE MODULE IS ENTERED BY MEANS OF AN XCTL FROM          01280020
*    IGG01991.                                                          01290020
*                                                                       01300020
*INPUT - SEE DESCRIPTION OF REGISTER CONTENTS.                          01310020
*                                                                       01320020
*OUTPUT - SUBROUTINES LOADED, ADDRESSES IN DCB, ID'S IN DEB             01330020
*                                                                       01340020
*EXTERNAL ROUTINES - NONE                                               01350020
*EXITS - NORMAL - XCTL TO IGG01911                               Y02072 01360002
*      - ERROR - NONE                                                   01370020
*                                                                       01380020
*MACROS - ACTION - XCTL, LOAD, IECDSECS(MAIN,WTG), DCBD, CVT     Y02072 01382002
*                                                                       01384002
*TABLES/WORKAREAS - DESCRIBED BY DSECTS AT END OF MODULE LISTING        01390020
*                                                                       01400020
*ATTRIBUTES - REENTRANT, REUSABLE, SUPERVISOR STATE,             Y02072 01410002
*             RUNS IN DATA MANAGEMENT KEY.                       Y02072 01412002
*                                                                       01420020
*                                                                       01430020
*                                                                       01440020
* REGISTER CONVENTIONS                                                  01450020
*                                                                       01460020
RE       EQU   0                        WORK REG5                       01510002
RF       EQU   1                        WORK REG6                       01560002
R1       EQU   RF                       PARM REG                 YM1140 01610002
RDCB     EQU   2                        DCB                             01700020
RBASE    EQU   3                        BASE                            01800020
RCORE    EQU   4                        WORE AREA                       01900020
RPAR     EQU   5                        TOP OF PARAMETER                02000020
RWTG     EQU   6                        TOP OF WTG TABLE                02100020
RPARC    EQU   7                        CURRENT PARAMETER               02200020
RWTGC    EQU   8                        CURRENT TRANS LOAD              02300020
RTIOT    EQU   9                        TIOT                            02400020
RUCB     EQU   10                       UCB                             02500020
RDEB     EQU   11                       DEB                             02600020
RB       EQU   12                       WORK REG1                       02700020
RC       EQU   13                       WORK REG2                       02800020
RD       EQU   14                       WORK REG3                       02900020
RJ       EQU   15                       WORK REG4                       03000020
*                                                                       03300020
*                                                                       03400020
PARAR    EQU   RPARC                                                    03500020
*                                                                       03600020
*********************************************************************** 03700020
*                                                                       03800020
*********************************************************************** 03900020
*                                                                       04000020
* MASK'S TO TEST PARAMETER LIST WITH                                    04100020
*                                                                       04200020
*********************************************************************   04300020
INP      EQU   X'0F'                    MASK                            04400020
OUTP     EQU   X'0F'                    MASK                            04500020
UPDATE   EQU   X'04'                    MASK                            04600020
INOUT    EQU   X'03'                    MASK                            04700020
OUTIN    EQU   X'07'                    MASK                            04800020
RDBACK   EQU   X'01'                    MASK                            04900020
INPRDBK  EQU   X'0E'               MASK TO CK INPUT OR RDBACK      UT18 04950020
*                                                                       05000020
*                                                                       05100020
*********************************************************************   05200020
*                                                                       05300020
*                                                                       05400020
* OFFSET FOR PARAMETER TESTS                                            05500020
*                                                                       05600020
FRTYATE  EQU   48                       MASK                            05700020
DISPSN   EQU   X'0'                     MASK                            05800020
*                                                                       05900020
*                                                                       06000020
*********************************************************************   06100020
*                                                                       06200020
* OFFSETS FOR DEB REFERENCE                                             06300020
*                                                                       06400020
*                                                                       06500020
BIN      EQU   36                                                       06600020
BEXT     EQU   38                                                       06700020
*                                                                       06800020
*                                                                       06900020
*                                                                       07000020
*********************************************************************   07100020
*                                                                       07200020
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              07300020
*                                                                       07400020
*                                                                       07500020
*                                                                       07600020
DOUBLE   EQU   X'01'                    MASK                            07700020
*                                                                       07800020
*                                                                       07900020
STOWB    EQU   X'80'                    MASK                            08000020
WRTCK    EQU   X'80'                    MASK                            08100020
OVRFLO   EQU   X'20'                    MASK                            08200020
PCI      EQU   X'20'                    MASK                            08300020
MINKEY   EQU   X'01'                    MASK                            08400020
CONCAT   EQU   X'FF'                    MASK                            08500020
UTFMASK  EQU   X'02'               MASK FOR TOTALING FACILITY      UT18 08550020
UPDATEB  EQU   X'80'                    MASK                     S19015 08570020
*                                                                       08600020
*********************************************************************   08700020
*                                                                       08800020
* MASKS FOR ACCESS METHODS IN SAM                                       08900020
*                                                                       09000020
QSAMB    EQU   X'01'                    MASK                            09100020
BSAMBIT  EQU   X'00'                    MASK                            09200020
PAM      EQU   X'02'                    MASK                            09300020
*                                                                       09400020
******************************************************************      09406020
*                                                                       09412020
*  EQUATES FOR OFFSET READ FUNCTION                                     09418020
*                                                                       09424020
AVTCEAPP EQU   13                       OFFSET TO CEA PTR IN AVT S19015 09430020
AVTABCEA EQU   17                       OFFSET TO ABNORMAL CEA   S19015 09436020
*                                       PTR                      S19015 09442020
CEAOFFST EQU   25                       OFFSET TO CEA PTR        S19015 09448020
ABOFFSET EQU   5                        OFFSET TO ABNORMAL CEA   S19015 09454020
*                                       PTR                      S19015 09460020
ADLEN    EQU   3                        LENGTH OF AN ADDR        S19015 09466020
TWOBYTES EQU   16                       NO OF BITS IN 2 BYTES    S19015 09472020
NOID     EQU   X'00'                    INDICATE NO MORE MODULES S19015 09478020
BFTEKR   EQU   X'20'                    BDAM VS                  S19015 09484020
*                                                                       09490020
*                                                                       09500020
* MASKS FOR MACRO'S TO BE USED                                          09600020
*                                                                       09700020
GETB     EQU   X'40'                    MASK                            09800020
PUTB     EQU   X'40'                    MASK                            09900020
READB    EQU   X'20'                    MASK                            10000020
WRITEB   EQU   X'20'                    MASK                            10100020
POINTB   EQU   X'04'                    MASK                            10200020
CNTRLB   EQU   X'02'                    MASK                            10300020
*                                                                       10400020
*                                                                       10500020
*********************************************************************   10600020
* MASKS FOR DEVICES TO BE SUPPORTED                                     10700020
*                                                                       10800020
*                                                                       10900020
*********************************************************************   11000020
*                                                                       11100020
*                                                                       11200020
*                                                                       11300020
*                                                                       11400020
*********************************************************************   11500020
*                                                                       11600020
* MASKS FOR STATUS BITS TO BE TESTED                                    11700020
*                                                                       11800020
*                                                                       11900020
EXCPN    EQU   X'30'                    MASK                            12000020
COMPLETE EQU   X'80'                    MASK                            12100020
FIRSTIOB EQU   X'01'                    MASK                            12200020
*                                                                       12300020
*                                                                       12400020
*                                                                       12500020
*********************************************************************   12600020
*                                                                       12700020
* MASKS FOR BUFFER TECHNIQUE'S                                          12800020
*                                                                       12900020
CYCLICB  EQU   X'20'                                                    13000020
EXCHANGB EQU   X'10'                                                    13100020
SIMPLEB  EQU   X'40'                                                    13200020
EXCHCYCL EQU   X'30'                                                    13300020
*                                                                       13400020
* MASKS FOR OPEN OVERRIDE OPTIONS                                       13420020
OVRDMSK  EQU   X'C0'                    INDICATES OPEN OVERRIDE         13440020
CTDISP   EQU   X'10'                    DISPLACEMENT OF CT IN TBL       13480020
*                                                                       13500020
* MODES  OPERATION FOR QSAM                                             13600020
LOCATEB  EQU   X'08'                                                    13700020
MOVEB    EQU   X'10'                                                    13800020
SUBSTUTB EQU   X'04'                                                    13900020
DATAMODE EQU   X'01'                                                    14000020
* COMMAN YTES FOR THE 2841                                              14100020
SRCHE    EQU   X'31'                                                    14200020
WRTCKD   EQU   X'1D'                                                    14300020
RDC      EQU   X'92'                                                    14400020
RDKD     EQU   X'8E'                                                    14500020
RDD      EQU   X'86'                                                    14600020
TIC      EQU   X'08'                                                    14700020
* MASKS   RECORD FORMATS                                                14800020
STANDRDF EQU   X'08'                                                    14900020
FORMATU  EQU   X'C0'                                                    15000020
FORMATF  EQU   X'80'                                                    15100020
FORMATV  EQU   X'40'                                                    15200020
FORMATD  EQU   X'20'                    D FORMAT RECORDS         S20038 15250020
SPANNED  EQU   X'08'                                                    15300020
BLOCKED  EQU   X'10'                                                    15400020
FIXEDBLK EQU   X'90'                                                    15500020
*   CHAN  CONTROL WORD FLAGS                                            15600020
SKIP     EQU   X'10'                                                    15700020
SLI      EQU   X'20'                                                    15800020
CC       EQU   X'40'                                                    15900020
DATACH   EQU   X'A0'                                                    16000020
SLICC    EQU   X'60'                                                    16100020
SLICCSK  EQU   X'70'                                                    16200020
KEYS     EQU   X'01'                                                    16300020
QSAM     EQU   X'01'                                                    16400020
GETMAIN  EQU   4                                                        16500020
XCTL     EQU   7                                                        16600020
LOAD     EQU   8                                                        16700020
ASA      EQU   X'04'                                                    16800020
BKREAD   EQU   X'01'                                                    16900020
URBITS   EQU   X'40'                                                    17000020
TAPEB    EQU   X'80'                                                    17100020
DABIT    EQU   X'20'                                                    17200020
R25      EQU   25                       CONSTANT                        17300020
R3       EQU   3                        CONSTANT                        17400020
R5       EQU   5                        CONSTANT                        17500020
OFF      EQU   X'7F'                    MASK TO TURN OFF UPDATE  S19015 17510020
*                                           BIT                         17520020
BYTE     EQU   1                        ONE CONSTANT             S19015 17530020
ABENDISP EQU   17                       ABEND DISPLACEMENT       S19015 17540020
IRBDISP  EQU   24                       IRB DISPLACEMENT         S19015 17550020
ADDISP   EQU   25                       ADDRESS DISPLACEMENT     S19015 17560020
IDLEN    EQU   2                        LENGTH OF A MODULE ID    Y02072 17570002
*                                                                       17600020
*                                                                       17700020
         BALR  RBASE,RE                 SET BASE                        17800020
         USING SLDA,RBASE                                               17900020
         USING IHADCB,RDCB                                              18000020
         USING BLDEB,RDEB                                               18100020
         USING FORCORE,RCORE                                            18200020
*                                                                       18400020
*                                                                       18500020
SLDA     EQU   *                                                        18600020
*                                                                       18700020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 18705002
         DC    C'IGG01993'              MODULE NAME              YM4640 18710002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 18715003
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 18720003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 18725002
*                                                                       18800020
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 18900020
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   19000020
         L     RCORE,4(RWTGC)           GET WORK AREA                   19050000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 19100020
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           19500020
         SR    RUCB,RUCB                CLEAR REG                       19600020
         SR    RF,RF                    CLEAR RER                       19700020
         SR    RD,RD                                                    19800020
         IC    RD,DEBNMSUB              GET NBR OF MODULES LOADED       19850020
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           19900020
         IC    RF,DEBEXSCL              GET SCALING FACTOR              20000020
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  20100020
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        20200020
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    20300020
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      20400020
*                                                                       20500020
*  RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB                20600020
*  BUT MUST BE INCREMENTED TO POINT BEYOND THE LAST ENTRY          UT18 21000020
*                                                                       21400020
SLDAA    EQU   *                                                   UT18 21800020
         CLI   0(RUCB),X'00'            IS RUCB BEYOND LAST ENTRY  UT18 22200020
         BE    SLDAB                    BR IF YES                  UT18 22600020
         LA    RUCB,2(RUCB)             INCREMENT TO NEXT ID FIELD UT18 23000020
         B     SLDAA                    TEST NEXT FIELD            UT18 23400020
*                                                                       23800020
SLDAB    EQU   *                                                        25800020
         USING WTGENTRY,RWTGC                                    YM6834 25850002
         MVC   WTGIDTTR,SOP9            ID OF NEXT MODULE      @Z30TSCF 25900003
         TM    DCBCIND2,QSAMB          QSAM BEING USED           M4028  26400020
         BO    SLDAPP19                YES,BRANCH                M4028  27000020
         TM    DCBBFTEK,BFTEKR          VS BDAM SUPPORT NEEDED          27800020
         BO    SLDEOB6                  YES, BRANCH                     29800020
*                                                                       31800020
*                                                                       33800020
SLDAPP19 EQU   *                                                        37300020
*                                                                       37400020
*                                                                       37500020
         BAL   RF,EOBROUT               GET EOB RT ID                   37600020
*                                                                       37700020
         BAL   RC,SLDROUT               LOAD ROUTINE                    37800020
*                                                                       38000020
         TM    DCBCIND2,QSAMB           QSAM BEING USED                 38100020
         BC    8,SLDEOB2                NO BRANCH                       38200020
*                                                                       38300020
         MVC   DCBEOB+1(3),25(RWTG)    STORE EOB ROUTINE                38400020
         MVC   DCBCNTRL+3(1),DCBCNTRL+1  SETUP FOR QSAM CNTRL TEST      38500020
         TM    DCBDEVT,X'80'           DCB FOR TAPE                     38600020
         BZ    SLDEOB8                 NO BRANCH                        38700020
         B     SLDEOBC                 YES BRANCH                       38800020
*                                                                       38900020
*                                                                       39000020
SLDEOB2  EQU   *                                                        39100020
*                                                                       39200020
         MVC   DCBEOBR+1(3),25(RWTG)                                    39300020
*                                                                       39400020
SLDEOB20 EQU   *                                                        39500020
*                                                                       39600020
         MVC   DCBEOBW+1(3),25(RWTG)                                    39700020
*                                                                       39800020
*                                                                       39900020
SLDEOB4  EQU   *                                                        40000020
*                                                                       40100020
         BAL   RF,EOBROUT               GET POSSIBLE WRT ROUT (IN/OUT)  40200020
*                                                                       40300020
*                                                                       40400020
         LTR   RC,RC                    DCB FOR IN/OUT                  40500020
         BC    8,SLDEOB6                NO BRANCH                       40600020
*                                                                       40700020
         BAL   RC,SLDROUT               LOAD WRT EOB RT.                40800020
*                                                                       40900020
         MVC   DCBEOBW+1(3),25(RWTG)                                    41000020
*                                                                       41100020
*                                                                       41200020
SLDEOB6  EQU   *                                                        41300020
*                                                                       41400020
         BAL   RF,EOBROUT               IS NOTE/POINT USED              41500020
*                                                                       41600020
         LTR   RC,RC                    TEST FOR ITS ID                 41700020
         BP    SLDEOB9                  YES BRANCH                      41800020
*                                                                       41900020
SLDEOB8  EQU   *                                                        42000020
*                                                                       42100020
         BAL   RF,EOBROUT               GET POSSIBLE CNTRL RT ID        42200020
         LTR   RC,RC                    IS THERE A CNTRL ID             42300020
         BC    8,SLDEOBC                NO BRANCH                       42400020
*                                                                       42500020
SLDEOB9  BAL   RC,SLDROUT               LOAD NOTE POINT ROUTINE         42600020
         MVC   DCBCNTRL+1(3),25(RWTG)                                   42700020
         B     SLDEOBE                  END                             42800020
*                                                                       42900020
SLDEOBC  EQU   *                                                        43000020
         XC    DCBCNTRL(4),DCBCNTRL     CLEAR PARA LIST                 43100020
         OI    DCBCNTRL+3,X'01'         SET VECTOR  TO  ONE             43200020
*                                                                       43300020
SLDEOBE  EQU   *                        END.                            43400020
*                                                                       43500020
         STC   RD,DEBNMSUB              STORE NO. SUB RTS LOADED        43600020
         MVC   DCBEROPT(1),DXCCW6       RESTORE EROPT FIELD       24346 43650020
*                                                                       43700020
*********************************************************************** 43800020
*                                                                       43900020
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        44000020
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     44100020
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            44200020
         BCR   8,RBASE                  BACK TO OPEN CONTROL            44300020
*                                                                       44400020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    44500020
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             44600020
*                                                                       44700020
         LR    RPARC,RPAR                                               44800020
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       44900020
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           45000020
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         45100020
*                                                                       45200020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  45300020
         LA    RPARC,PLOFF(0,RPARC)                                     45400020
         B     ZCHEK                    COMPLETE                        45500020
*                                                                       45600020
TCTLRTN  EQU   *                                                        45700020
         USING WTG,RWTG                                                 45750003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*45800003
               MODID=WTGENTRY                                  @Z30TSCF 45850003
         DROP  RWTGC,RWTG                                      @Z30TSCF 45900003
*                                                                       46400020
*                                                                       46500020
*                                                                       46600020
SLDROUT  EQU   *                                                        48400020
         USING WTGMODNM,RWTG                                     Y02072 48450002
         MVC   WTGMODID,0(RB)           MOVE 2 BYTE ID TO NAME   Y02072 48500002
         DROP  RWTG                                              Y02072 48550002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 48600002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 48650002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 48700002
         DROP  R1                       DROP CVT BASE            YM1140 48750002
*                                                                       48800002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 49700002
*                                                                       49800020
*                                                                       49900020
*                                                                       50000020
         ST    RE,24(RWTG)             TEMP STORE OF ROUTINE ADDR,      50100020
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        50200020
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               50300020
         LA    RD,1(RD)                 ONE MORE SUB RT LOADED          50400020
         BR    RC                      RETURN                           50500020
*                                                                       50600020
*                                                                       50700020
*********************************************************************** 50800020
*                                                                       50900020
*                                                                       51000020
*********************************************************************** 51100020
*                                                                       51200020
EOBROUT  EQU   *                                                        51300020
*                                                                       51400020
         SR    RC,RC                                                    51500020
         LA    RE,EOBTABL               GET TABLE OF NAMES              51600020
         LA    RB,IDLEN                 LEN OF MODULE ID         Y02072 51700002
         IC    RC,DCBCNTRL+3            GET ID NO. DEVICE DEP.          51800020
         L     RJ,DCBCNTRL              SHIFT IDS RIGHT BY ONE BYTE     51900020
         SRL   RJ,8                                                     52000020
         ST    RJ,DCBCNTRL                                              52100020
         MR    RB,RB                    CALCULATE WHERE ID IS           52200020
         LR    RB,RC                    PREPARE TO LOAD  MODULE         52300020
         AR    RB,RE                    POINT TO CORRECT ID             52400020
         BR    RF                       RETURN                          52500020
*                                                                       52600020
*********************************************************************** 52700020
*                                                                       52800020
*                                                                       52802020
*                                                                       52804020
*                                                                       52806020
WAOFF    EQU   32                                                       52808020
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           52810020
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           52812020
FOUR     DC    H'4'                     4                        M4567  52813020
OPIDCNST DC    C'0S'                    ID                              52814020
AMIDCNST DC    C'93'                    THIS MODULE ID                  52832020
SOP9     DC    C'11',VL3(IGG01911)      IGG01911 OR IECOS90X   @Z30TSCF 52832403
*                                                                       52834020
*                                                                       60700020
*        DEVICE DEPENDENT ROUTINES SUPPORTED                            60800020
*                                                                       60900020
EOBTABL  EQU   *                                                        61000020
         DC    C'  '                    BLANKS                          61100002
EPD2     DC    C'CD'                    EOB RT DISK-OUTP/STANDRF INP    61300002
EGP2     DC    C'CC'                    EOB RT. DISK-TP-RDR. INP/OUTP.  61400002
DDA2     DC    C'CE'                    EOB RT. PRNTR/PUNCH NORMAL      61500002
DDB2     DC    C'CF'                    EOB RT. PRNTR/PUNCH ASA         61600002
NPD2     DC    C'BC'                    NOTE-POINT DISK                 61700002
NPT2     DC    C'BD'                    NOTE-POINT TAPE                 61800002
CNT1     DC    C'CA'                    CNTRL RT READER                 61900002
CNT2     DC    C'CB'                    CNTRL RT. PRINTER               62000002
CNT3     DC    C'BE'                    CNTRL RT. TAPE                  62100002
DUMY     DC    C'AV'                    DUMMY PUT/NOP ROUTINE           62200002
UTF1     DC    C'TD'                    USER TOTALING EOB ROUTINE  UT18 62210002
UTF2     DC    C'TC'                    USER TOTALING EOB ROUTINE  UT18 62220002
UTF3     DC    C'TV'                    USER TOTALING EOB ROUTINE  UT18 62230002
UTF4     DC    C'TW'                    USER TOTALING EOB ROUTINE  UT18 62240002
UTF5     DC    C'T2'                    USER TOTALING EOB ROUTINE  UT18 62250002
OVRD     DC    C'CT'                    OPEN OVERRIDE ERROR RTN         62270002
         SPACE                                                          62300002
PATCH    DC    50X'0'                   PATCH AREA               YM4640 62450002
END      EQU   *                        END OF MODULE            Y02072 62700002
         TITLE 'IGG01993 - FORMAT OF GOTTEN CORE'                       62800002
*                                                                       63100020
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 63150003
         ORG   WTGIDTTR                                          Y02072 63160002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 63170002
*                                                                       63200020
CVT      DSECT                                                          63300020
         CVT                                                            63400020
*                                                                       63500020
*                                                                       63600020
BLDEB    DSECT                                                          63700020
DEB      DS    0F                       ALIGN                           63800020
DEBNMSUB DS    0CL1                     NO. OF SUB.                     63900020
DEBTCBAD DS    CL4                      TCB ADDR.                       64000020
DEBAMLNG DS    0CL1                     ACCESS METHOD LEN.              64100020
DEBDEBAD DS    CL4                      DEB ADDR.                       64200020
DEBOGLGS DS    0CL1                     OPTION                          64300020
DEBIRBAD DS    CL4                      IRB ADDRESS                     64400020
DEBOPATB DS    0CL1                     OPTION                          64500020
DEBSYSPG DS    CL4                      SYS ABEND                       64600020
DEBNMEXT DS    0CL1                     NO. OF EXTENT                   64700020
DEBUSRPG DS    CL4                      USER PROG.                      64800020
DEBPRIOR DS    0CL1                     PRIORITY                        64900020
DEBECBAD DS    CL4                      ECB ADDRESS.                    65000020
DEBPROTG DS    0CL1                     PROTECTION KEY                  65100020
DEBDEBID DS    0CL1                     DEB ID                          65200020
DEBDCBAD DS    CL4                      DCB ADDRESS                     65300020
DEBEXSCL DS    0CL1                     EXCEPTION                       65400020
DEBAPPAD DS    CL4                      APPENDAGE ADDRESS               65500020
DEBDVMOD DS    0CL1                     DEVICE                          65600020
DEBUCBAD DS    CL4                      UCB ADDRESS                     65700020
DEBBINUM DS    CL2                      BIN NUMBER                      65800020
DEBSTRCC DS    CL2                      START CYC.                      65900020
DEBSTRHH DS    CL2                      START TRACK                     66000020
DEBENDCC DS    CL2                      END CYCLINDER                   66100020
DEBENDHH DS    CL2                      END TRACK                       66200020
DEBNMTRK DS    CL2                      NO. OF TRACKS                   66300020
*                                                                       66400020
           DCBD  DSORG=PS                                               66500020
DCBECC   EQU   DCBCHECK+1               DCB FIELD                       66600020
         END                                                            66700020
./  ADD  SSI=43090086,NAME=IGG01994
         TITLE 'IGG01994 - SAM STAGE 3 OPEN EXECUTOR'                   00050021
IGG01994 CSECT                                                          00100021
*MODULE NAME - IGG01994                                          Y02072 00110002
*                                                                       00120002
*DESCRIPTIVE NAME - LOAD ACCESS METHOD ROUTINES                  Y02072 00130002
*                                                                       00140002
*COPYRIGHT - NONE                                                Y02072 00142002
*                                                                       00144002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00146002
*                                                                       00148002
*        VS2 RELEASE 02 DELETIONS                                Y02072 00150002
*000600,003000,007200,034100,0343000-034360,066600,070600,       Y02072 00152002
*103200-103400,092800,1022006200,74800-75000,75600,76600-79800   Y02072 00154002
*                                                                YM1140 00156002
*                                                                       00158003
*          VS2 RELEASE 3 DELETIONS                                      00158403
*                                                              @Z30TSCF 00158803
*          RELEASE 21 DELETIONS                                       * 00160021
*                                                                       00180002
*STATUS CHANGE LEVEL 002                                                00300002
*                                                                       00310002
*FUNCTION/OPERATION - THIS MODULE IS A CONTINUATION OF MODULE           00320021
*    IGG01992 AND LOADS END-OF-BLOCK AND CONTROL ROUTINES.              00340021
*    THE CHOICE OF ROUTINES IS                                          00360021
*    DETERMINED BY PREVIOUS OPEN EXECUTORS.  THE ADDRESSES OF THE       00380021
*    LOADED MODULES ARE PLACED IN THE DCB AND THE ID IN THE             00400021
*    SUBROUTINE ID SECTION OF THE DEB.                                  00420021
*                                                                       00440021
*ENTRY POINTS - THE MODULE IS ENTERED BY MEANS OF AN XCTL FROM          00460021
*    IGG01992.                                                          00480021
*                                                                       00500021
*INPUT - SEE DESCRIPTION OF REGISTER CONTENTS.                          00520021
*                                                                       00540021
*OUTPUT - SUBROUTINES LOADED, ADDRESSES IN DCB, ID'S IN DEB             00560021
*                                                                       00580021
*EXTERNAL ROUTINES - NONE                                               00600021
*EXITS  - NORMAL / XCTL TO IGG01911                              Y02072 00620002
*      - ERROR - NONE                                                   00640021
*                                                                       00660021
*TABLES/WORKAREAS - DESCRIBED BY DSECTS AT END OF MODULE LISTING        00680021
*                                                                       00700021
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 00720002
*             AND SUPERVISOR STATE                               Y02072 00730002
*                                                                       00780021
*MACROS-MAPPING:IECDSECS(MAIN,WTG), DCBD, CVT                    Y02072 00790002
*                                                                       00792002
* REGISTER CONVENTIONS                                                  00800021
*                                                                       00820021
*                                                                       00840021
RE       EQU   0                        WORK REG5                       00860021
RF       EQU   1                        WORK REG6                       00880021
R1       EQU   RF                       PARM REG                 YM1140 00890002
RDCB     EQU   2                        DCB                             00900021
RBASE    EQU   3                        BASE                            00920021
RCORE    EQU   4                        WORE AREA                       00940021
RPAR     EQU   5                        TOP OF PARAMETER                00960021
RWTG     EQU   6                        TOP OF WTG TABLE                00980021
RPARC    EQU   7                        CURRENT PARAMETER               01000021
RWTGC    EQU   8                        CURRENT TRANS LOAD              01020021
RTIOT    EQU   9                        TIOT                            01040021
RUCB     EQU   10                       UCB                             01060021
RDEB     EQU   11                       DEB                             01080021
RB       EQU   12                       WORK REG1                       01100021
RC       EQU   13                       WORK REG2                       01120021
RD       EQU   14                       WORK REG3                       01140021
RJ       EQU   15                       WORK REG4                       01160021
T3       EQU   3                                                        01180021
T25      EQU   25                       25                              01200021
PARAR    EQU   RPARC                                                    01220021
* MASK'S TO TEST PARAMETER LIST WITH                                    01240021
INP      EQU   X'0F'                    MASK                            01260021
OUTP     EQU   X'0F'                    MASK                            01280021
INOUT    EQU   X'03'                    MASK                            01300021
OUTIN    EQU   X'07'                    MASK                            01320021
RDBACK   EQU   X'01'                    MASK                            01340021
INPRDBK  EQU   X'0E'               MASK TO CK INPUT OR RDBACK      UT18 01360021
* OFFSET FOR PARAMETER TESTS                                            01380021
FRTYATE  EQU   48                       MASK                            01400021
ONE      EQU   X'01'                                                    01420021
DISPSN   EQU   X'0'                                                     01440021
* OFFSETS FOR DEB REFERENCE                                             01460021
BIN      EQU   36                                                       01480021
BEXT     EQU   38                                                       01500021
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              01520021
DOUBLE   EQU   X'01'                                                    01540021
STOWB    EQU   X'80'                                                    01560021
WRTCK    EQU   X'80'                                                    01580021
OVRFLO   EQU   X'20'                                                    01600021
CONCAT   EQU   X'FF'                                                    01620021
MINKEY   EQU   X'01'                                                    01640021
PCI      EQU   X'20'                                                    01660021
UTFMASK  EQU   X'02'               MASK FOR TOTALING FACILITY      UT18 01680021
* MASKS FOR ACCESS METHODS IN SAM                                       01700021
QSAMB    EQU   X'01'                    MASK                            01720021
BSAMBIT  EQU   X'00'                    MASK                            01740021
PAM      EQU   X'02'                    MASK                            01760021
* MASKS FOR MACRO'S TO BE USED                                          01780021
GETB     EQU   X'40'                    MASK                            01800021
PUTB     EQU   X'40'                    MASK                            01820021
READB    EQU   X'20'                    MASK                            01840021
WRITEB   EQU   X'20'                    MASK                            01860021
POINTB   EQU   X'04'                    MASK                            01880021
CNTRLB   EQU   X'02'                                                    01900021
* MASKS FOR STATUS BITS TO BE TESTED                                    01920021
EXCPN    EQU   X'30'                    MASK                            01940021
COMPLETE EQU   X'80'                                                    01960021
FIRSTIOB EQU   X'01'                    MASK                            01980021
* MASKS FOR BUFFER TECHNIQUE'S                                          02000021
EXCHANGB EQU   X'10'                                                    02020021
SIMPLEB  EQU   X'40'                                                    02040021
* MODES  OPERATION FOR QSAM                                             02060021
LOCATEB  EQU   X'08'                                                    02080021
MOVEB    EQU   X'10'                                                    02100021
MOVEXCHB EQU X'14'                                                      02120021
SUBSTUTB EQU   X'04'                                                    02140021
* MASKS FOR OPEN OVERRIDE OPTIONS                                       02160021
OVRDMSK  EQU   X'C0'                    INDICATES OPEN OVERRIDE         02180021
CTDISP   EQU   X'10'                    DISPLACEMENT OF CT IN TBL       02200021
* COMMAN YTES FOR THE 2841                                              02220021
SRCHE    EQU   X'31'                                                    02240021
WRTCKD   EQU   X'1D'                                                    02260021
RDC      EQU   X'92'                                                    02280021
RDKD     EQU   X'8E'                                                    02300021
RDD      EQU   X'86'                                                    02320021
TIC      EQU   X'08'                                                    02340021
* MASKS   RECORD FORMATS                                                02360021
STANDRDF EQU   X'08'                                                    02380021
FORMATU  EQU   X'C0'                                                    02400021
FORMATF  EQU   X'80'                                                    02420021
FORMATV  EQU   X'40'                                                    02440021
SPANNED  EQU   X'08'                                                    02460021
BLOCKED  EQU   X'10'                                                    02480021
FIXEDBLK EQU   X'90'                                                    02500021
*   CHAN  CONTROL WORD FLAGS                                            02520021
SKIP     EQU   X'10'                                                    02540021
SLI      EQU   X'20'                                                    02560021
DATACH   EQU   X'A0'                                                    02580021
CC       EQU   X'40'                                                    02600021
SLICC    EQU   X'60'                                                    02620021
SLICCSK  EQU   X'70'                                                    02640021
KEYS     EQU   X'01'                                                    02660021
QSAM     EQU   X'01'                                                    02680021
ASA      EQU   X'04'                                                    02700021
BKREAD   EQU   X'01'                                                    02720021
URBITS   EQU   X'40'                                                    02740021
TAPEB    EQU   X'80'                                                    02760021
IDLEN    EQU   2                        LENGTH OF A MODULE ID    Y02072 02810002
         BALR  RBASE,RE                 SET BASE                        03240021
         USING SLDA,RBASE                                               03260021
         USING IHADCB,RDCB                                              03280021
         USING BLDEB,RDEB                                               03300021
         USING FORCORE,RCORE                                            03320021
SLDA     EQU   *                                                        03360021
         B     BEGIN                    BR AROUND CONSTANTS    @Z30TSCF 03370003
         DC    C'IGG01994'              MODULE NAME            @Z30TSCF 03372003
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 03374003
         DC    C'10/24/74'              LAST SHIP DATE         @Z30TSCF 03376003
BEGIN    DS    0H                                                       03378003
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 03380021
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   03400021
         L     RCORE,4(RWTGC)           GET WORK AREA                   03402000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 03420021
*                                                                       03460021
*   THIS SECTION OF CODE UP TO THE LABEL ENDOVR WILL ENSURE THAT        03480021
*   THE EOB ROUTINE IGG019CT GETS LOADED FOR ANY OPEN OVERRIDE.         03500021
         TM    JFCBMASK+6,OVRDMSK       WAS AN OVERRIDE USED            03520021
         BNO   ENDOVR                   BR IF NO                 A32160 03540021
         TM    0(RPARC),X'0F'           WAS IT LABEL=(,,,IN)     A32160 03560021
         BZ    INCHNG                   BR IF YES                A32160 03580021
         MVC   DCBCNTRL+2(1),DCBCNTRL+3 SAVE WRITE EOB DISP             03600021
         MVI   DCBCNTRL+3,CTDISP        SET READ EOB ROUTINE FOR        03620021
*                                       THE ERROR EOB ROUTINE           03640021
         B     ENDOVR                   CONTINUE                        03660021
INCHNG   MVI   DCBCNTRL+2,CTDISP        SET WRITE EOB ROUTINE FOR       03680021
*                                       THE ERROR EOB ROUTINE           03700021
ENDOVR   EQU   *                                                        03720021
         MVI   22(RWTG),X'CB'          CHANGE DE ATTR.TO ONLY LOADABLE  03740021
         L     RTIOT,DEBAPPAD           GET APPENDAGE ADDRESS           03760021
         SR    RUCB,RUCB                CLEAR REG                       03780021
         SR    RF,RF                    CLEAR RER                       03800021
         IC    RUCB,DEBNMEXT            GET NUMBER OF EXTENTS           03820021
         IC    RF,DEBEXSCL              GET SCALING FACTOR              03840021
         SLL   RUCB,0(RF)               SHIFT ACCORDING TO EXTENT SIZE  03860021
         IC    RF,DEBAMLNG              GET ACCESS METHOD LENGTH        03880021
         LA    RUCB,0(RF,RUCB)          ADD TO POINT TO SUBRT ID FLD    03900021
         LA    RUCB,32(RUCB,RDEB)       ADD BASIC DEB SZ TO DEB AD      03920021
*                                                                       03940021
*  RUCB NOW POINTS TO SUBROUTINE ID SECTION OF THE DEB,            UT18 03960021
*  BUT MUST BE INCREMENTED TO POINT BEYOND THE LAST ENTRY          UT18 03980021
*                                                                       04000021
SLDAA    EQU   *                                                   UT18 04020021
         CLI   0(RUCB),X'00'            IS RUCB BEYOND LAST ENTRY  UT18 04040021
         BE    SLDAB                    BR IF YES                  UT18 04060021
         LA    RUCB,2(RUCB)             INCREMENT TO NEXT ID FIELD UT18 04080021
         B     SLDAA                    TEST NEXT FIELD            UT18 04100021
*                                                                       04120021
*                                                                       04140021
*  RUCB NOW POINTS TO NEXT AVAILABLE SUBROUTINE ID FIELD IN THE    UT18 04160021
*  DEB.                                                            UT18 04180021
*                                                                       04200021
*  IF USER TOTALING HAS BEEN SPECIFIED, EOB ROUTINES CONTAINING    UT18 04220021
*  LINKAGE TO THE TOTALING SAVE ROUTINES MUST BE LOADED INSTEAD OF UT18 04240021
*  THE NORMAL EOB ROUTINES.  THIS IS ACCOMPLISHED BY DOING A       UT18 04260021
*  TRANSLATE OF THE DCBCNTRL FIELD TO CONVERT NORMAL EOB DISPLACE- UT18 04280021
*  MENTS INTO DISPLACEMENTS FOR THE UTF EOB ROUTINES.              UT18 04300021
*                                                                  UT18 04320021
SLDAB    EQU   *                                                   UT18 04340021
         TM    DCBOPTCD,UTFMASK         TEST FOR TOTALING OPTION   UT18 04360021
         BZ    SLDAC                    BR IF NOT SPECIFIED        UT18 04380021
         TM    0(RPARC),INPRDBK         IS OPEN FOR INPUT/RDBACK   UT18 04400021
         BZ    SLDAC                    IF YES NO TOTALING REQ'RD  UT18 04420021
         TR    DCBCNTRL(4),UTFTBL       CHANGE TO UTF DISPLACEMENT UT18 04440021
SLDAC    EQU   *                                                   UT18 04460021
*                                                                  UT18 04480021
*  LOAD NECESSARY EOB ROUTINES                                     UT18 04500021
*                                                                  UT18 04520021
*                                                                       04540021
         BAL   RF,EOBROUT               GET EOB RT ID                   06580021
         BAL   RC,SLDROUT               LOAD ROUTINE                    06600021
         USING WTGENTRY,RWTGC                                    Y02072 06610002
         MVC   WTGIDTTR,SOP9            NEXT EXECUTOR          @Z30TSCF 06612003
         TM    DCBCIND2,QSAMB           QSAM BEING USED                 06620021
         BO    SLDEOB9                 YES,BRANCH                       06640021
SLDEOB2  EQU   *                                                        06680021
         MVC   DCBEOBRZ(T3),T25(RWTG)    INSERT EOB ADDR.               06700021
SLDEOB20 EQU   *                                                        06720021
         MVC   DCBEOBWZ(T3),T25(RWTG)   LOAD EOB WRITE ADDRESS.         06740021
SLDEOB4  EQU   *                                                        06760021
         BAL   RF,EOBROUT               GET POSSIBLE WRT ROUT (IN/OUT)  06780021
         LTR   RC,RC                    DCB FOR IN/OUT                  06800021
         BC    8,SLDEOB6                NO BRANCH                       06820021
         BAL   RC,SLDROUT               LOAD WRT EOB RT.                06840021
         MVC   DCBEOBWZ(T3),T25(RWTG)    LOAD EOB WRITE ADDRESS         06860021
SLDEOB6  EQU   *                                                        06880021
         BAL   RF,EOBROUT               IS NOTE/POINT USED              06900021
         LTR   RC,RC                    TEST FOR ITS ID                 06920021
         BC    8,SLDEOBC                NO BRANCH                       06940021
SLDEOB8  EQU   *                                                        06960021
         BAL   RC,SLDROUT               LOAD NOTE/POINT ROUTINE         06980021
         MVC   DCBCNTRZ(T3),T25(RWTG)                                   07000021
         B     SLDEOBE                  BRANCH                          07020021
SLDEOB9  EQU   *                                                        07040021
         MVC   DCBEOBZ(T3),T25(RWTG)                                    07080021
SLDEOBC  EQU   *                                                        07100021
         XC    DCBCNTRL(4),DCBCNTRL     CLEAR PARA LIST                 07120021
         OI    DCBCNTZZ,QSAM            GET VECTOR TO ONE               07140021
SLDEOBE  EQU   *                        END.                            07160021
         MVC   DCBEROPT(RF),DXCCW6      QSAM ERROR OPTION               07180021
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        07200021
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     07220021
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            07240021
         BCR   RWTGC,RBASE              RETURN                          07260021
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    07280021
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             07300021
         LR    RPARC,RPAR                                               07320021
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       07340021
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           07360021
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         07380021
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  07400021
         LA    RPARC,PLOFF(0,RPARC)                                     07420021
         B     ZCHEK                    TO ZERO CHECK                   07440021
TCTLRTN  EQU   *                                                        07460021
         USING WTG,RWTG                                                 07510003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*07560003
               MODID=WTGENTRY                                  @Z30TSCF 07570003
         DROP  RWTGC,RWTG                                      @Z30TSCF 07572003
*                                                                       07580021
*                                                                       07600021
*                                                                       07620021
SLDROUT  EQU   *                                                        07640021
         USING WTGMODNM,RWTG                                     Y02072 07650002
         MVC   WTGMODID,0(RB)           ID TO MODULE NAME        Y02072 07660002
         DROP  RWTG                                              Y02072 07670002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1140 07720002
         USING CVT,R1                   CVT ADDRESSABILITY       YM1140 07770002
         L     R1,CVTLINK               GET LPALIB DCB ADDRESS   YM1140 07820002
         DROP  R1                       DROP CVT BASE            YM1140 07870002
*                                                                       07920002
         LOAD  EPLOC=(RWTG),DCB=(1)                              YM1140 07980002
         SR    RD,RD                                                    08000021
         IC    RD,DEBNMSUB              GET NO OF SUBROUTINES LOADED    08020021
         LA    RD,1(RD)                 ADD ONE TO TOTAL                08040021
         STC   RD,DEBNMSUB              STORE NEW TOTAL OF SUBRT LOADED 08060021
         ST    RE,24(RWTG)              TEMP STORE OF ROUTINE ADDR,     08080021
SLDROUT1 MVC   0(2,RUCB),0(RB)          STORE ROUTINES ID IN DEB        08100021
         LA    RUCB,2(RUCB)             UPDATE SUBRT PNTR               08120021
         BR    RC                      RETURN                           08140021
EOBROUT  EQU   *                                                        08160021
         SR    RC,RC                                                    08180021
         LA    RE,EOBTABL               GET TABLE OF NAMES              08200021
         LA    RB,IDLEN                 LENGTH OF A MODULE ID    Y02072 08220002
         IC    RC,DCBCNTZZ              DEVICE DEP.                     08240021
         L     RJ,DCBCNTRL              SHIFT IDS RIGHT BY ONE BYTE     08260021
         SRL   RJ,8                                                     08280021
         ST    RJ,DCBCNTRL                                              08300021
         MR    RB,RB                    CALCULATE WHERE ID IS           08320021
         LR    RB,RC                    PREPARE TO LOAD  MODULE         08340021
         AR    RB,RE                    POINT TO CORRECT ID             08360021
         BR    RF                       RETURN                     UT18 08380021
         EJECT                                                          08400002
WAOFF    EQU   32                                                       08520021
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           08540021
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           08560021
OPIDCNST DC    C'0S'                     ID                             08580021
AMIDCNST DC    C'92'                    ID OF THIS MODULE          UT18 08660021
*                                                                       08680021
*******************************************************************UT18 08700021
*                                                                       08720021
*  THE FOLLOWING TABLE IS USED WITH A TRANSLATE INSTRUCTION TO     UT18 08740021
*  CONVERT DISPLACEMENTS FOR THE EOB TABLE INTO THOSE FOR THE      UT18 08760021
*  ENTRIES FOR THE CORRESPONDING UTF ROUTINES.                     UT18 08780021
*                                                                       08800021
UTFTBL   DC    X'00'                    NO CHANGE                  UT18 08820021
         DC    X'0D'                    IGG019CV BECOMES IGG019TV  UT18 08840021
         DC    X'0E'                    IGG019CW BECOMES IGG019TW  UT18 08860021
         DC    X'03'                    NO CHANGE                  UT18 08880021
         DC    X'04'                    NO CHANGE                  UT18 08900021
         DC    X'05'                    NO CHANGE                  UT18 08920021
         DC    X'06'                    NO CHANGE                  UT18 08940021
         DC    X'07'                    NO CHANGE                  UT18 08960021
         DC    X'0C'                    IGG019CC BECOMES IGG019TC  UT18 08980021
         DC    X'0F'                    IGG019C2 BECOMES IGG019T2  UT18 09000021
         DC    X'0A'                    NO CHANGE                  UT18 09020021
         DC    X'0B'                    NO CHANGE                       09040021
         DC    X'0C'                    NO CHANGE                       09060021
         DC    X'0D'                    NO CHANGE                       09080021
         DC    X'0E'                    NO CHANGE                       09100021
         DC    X'0F'                    NO CHANGE                       09120021
         DC    X'10'                    NO CHANGE                       09140021
*                                                                       09160021
*  NOTE, THERE MUST BE AN ENTRY IN THIS TRANSLATE TABLE FOR EACH        09180021
*        ENTRY IN THE EOB TABLE.                                        09200021
*                                                                  UT18 09220021
*******************************************************************UT18 09240021
*                                                                  UT18 09260021
SOP9     DC    C'11',VL3(IGG01911)     IGGO1911 OR IECOS90X    @Z30TSCF 09340003
EOBTABL  EQU   *                                                        09720021
         DC    C'  '                    BLANKS                          09740002
EPD2     DC    C'CV'                    ID                              09760002
EGP2     DC    C'CW'                    ID                              09780002
DDA2     DC    C'CX'                    ID                              09800002
DDB2     DC    C'CY'                    ID                              09820002
NPD2     DC    C'BK'                    NOTE-POINT  DA  WITH PCI        09840002
NPT2     DC    C'BL'                    NOTEPOINT  TAPE  WITH PCI       09860002
NPD3     DC    C'BC'                    NOTE/POINT DISK                 09880002
EGP3     DC    C'CC'                    EOB RT. DISK-TP-RDR INP/OUTP    09900002
EOB2     DC    C'C2'                    EOB USED BY TRACK OVERFLOW      09920002
DUMY     DC    C'AV'                    ID                              09940002
UTF1     DC    C'TD'                    USER TOTALING EOB ROUTINE  UT18 09960002
UTF2     DC    C'TC'                    USER TOTALING EOB ROUTINE  UT18 09980002
UTF3     DC    C'TV'                    USER TOTALING EOB ROUTINE  UT18 10000002
UTF4     DC    C'TW'                    USER TOTALING EOB ROUTINE  UT18 10020002
UTF5     DC    C'T2'                    USER TOTALING EOB ROUTINE  UT18 10040002
OVRD     DC    C'CT'                    OPEN OVERRIDE ERROR RTN         10060002
         SPACE                                                          10070002
PATCH    DC    0H'0',XL50'00'           PATCH AREA             @Z30TSCF 10110003
END      EQU   *                        END OF MODULE            Y02072 10160002
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 10350003
         ORG   WTGIDTTR                                          Y02072 10352002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 10354002
CVT      DSECT                                                          10360021
         CVT                                                            10380021
BLDEB    DSECT                                                          10400021
DEB      DS    0F                       ALIGN                           10420021
DEBNMSUB DS    0CL1                     NO. OF SUB.                     10440021
DEBTCBAD DS    CL4                      TCB ADDR.                       10460021
DEBAMLNG DS    0CL1                     ACCESS METHOD LEN.              10480021
DEBDEBAD DS    CL4                      DEB ADDR.                       10500021
DEBOGLGS DS    0CL1                     OPTION                          10520021
DEBIRBAD DS    CL4                      IRB ADDRESS                     10540021
DEBOPATB DS    0CL1                     OPTION                          10560021
DEBSYSPG DS    CL4                      SYS ABEND                       10580021
DEBNMEXT DS    0CL1                     NO. OF EXTENT                   10600021
DEBUSRPG DS    CL4                      USER PROG.                      10620021
DEBPRIOR DS    0CL1                     PRIORITY                        10640021
DEBECBAD DS    CL4                      ECB ADDRESS.                    10660021
DEBPROTG DS    0CL1                     PROTECTION KEY                  10680021
DEBDEBID DS    0CL1                     DEB ID                          10700021
DEBDCBAD DS    CL4                      DCB ADDRESS                     10720021
DEBEXSCL DS    0CL1                     EXCEPTION                       10740021
DEBAPPAD DS    CL4                      APPENDAGE ADDRESS               10760021
DEBDVMOD DS    0CL1                     DEVICE                          10780021
DEBUCBAD DS    CL4                      UCB ADDRESS                     10800021
DEBBINUM DS    CL2                      BIN NUMBER                      10820021
DEBSTRCC DS    CL2                      START CYC.                      10840021
DEBSTRHH DS    CL2                      START TRACK                     10860021
DEBENDCC DS    CL2                      END CYCLINDER                   10880021
DEBENDHH DS    CL2                      END TRACK                       10900021
DEBNMTRK DS    CL2                      NO. OF TRACKS                   10920021
DEBIRBAZ EQU   DEBIRBAD+1                                               10940021
*                                                                       10960021
           DCBD  DSORG=PS                                               10980021
DCBEOBZ  EQU   DCBEOB+1                                                 11000021
DCBCNTZZ EQU   DCBCNTRL+3                                               11020021
DCBEOBWZ EQU   DCBEOBW+1                                                11040021
DCBCNTRZ EQU   DCBCNTRL+1                                               11060021
DCBEOBRZ EQU   DCBEOBR+1                                                11080021
DCBSYZ   EQU   DCBSYNAD+2                                               11100021
DCBSYX   EQU   DCBSYNAD+3                                               11120021
DCBGETZ  EQU   DCBGET+1                                                 11140021
DCBMACRZ EQU   DCBMACRF+1                                               11160021
DCBPERZ  EQU   DCBPERR+1                                                11180021
DCBCHECZ EQU   DCBCHECK+1                                               11200021
           END                                                          11220021
./  ADD  SSI=71180738,NAME=IGG020T1
         TITLE 'IGG020T1 - SAM/PAM/DAM FORCE CLOSE EXECUTOR            *00001000
                        '                                               00002000
IGG020T1 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(25)                                             0001 00007000
         DC    C'IGG020T1 ZA00415 11/04/74'                        0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @03,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@03                                         0001 00013000
*     */                                                           0123 00014000
*/********************************************************************* 00015000
*/* INITIALIZATION                                                    * 00016000
*/********************************************************************* 00017000
*                                                                  0124 00018000
* WRKSAV13 = GPR13P;                    /*SAVE REG SAVE AREA ADDR     * 00019000
*                                                                  0124 00020000
         ST    GPR13P,WRKSAV13(,RRECWKAR)                          0124 00021000
* RFY PARMLPTR RSTD;                                               0125 00022000
* RFY IECRRPL BASED(PARMLPTR);          /*ADDRESS TO RR PARM LIST     * 00023000
*/********************************************************************* 00024000
*/*MUST DETERMINE 2 THINGS:                                           * 00025000
*/*  1. IF FORCE CLOSE SHOULD BE EXECUTED-                            * 00026000
*/*     THE ONLY YES CONDITIONS ARE IF THE ERROR OCCURED DURING A     * 00027000
*/*     STANDARD OPEN OR AN OPEN TYPE = J. IF NOT, RETURN TO COMMON   * 00028000
*/*     CLOSES TRR.                                                   * 00029000
*/*  2. IF ABOVE CONDITIONS ARE MET THEN IT IS NECESSARY TO KNOW      * 00030000
*/*     IF THE USERS COPY OF THE DCB HAS BEEN REFRESHED. IF NOT,      * 00031000
*/*     EXECUTE THIS ROUTINE. IF YES, XCTL TO NORMAL CLOSE EXECUTORS. * 00032000
*/********************************************************************* 00033000
*                                                                  0127 00034000
*              /******************************************************* 00035000
*              /*MAKE TESTS OF RECOVERY ROUTINE PARAMETER LIST FOR    * 00036000
*              /*AN OPEN SVC (SET UP BY O/C/E AT THE TIME THE ESTAE   * 00037000
*              /*WAS ISSUED) TO DETERMINE IF THIS IS A FORCE CLOSE    * 00038000
*              /*SITUATION THAT CAN BE HANDLED BY THE ACCESS METHODS. * 00039000
*              /*IF NO PROCESSING IS TO BE DONE, GO TO THE EXIT       * 00040000
*              /*ROUTINE.                                             * 00041000
*              /******************************************************* 00042000
*                                                                  0127 00043000
* IF RRFUNCTN = RRFOPENJ               /*IF SVC IS NOT EQUAL TO 22   * 00044000
*   & RRFUNCTN = RRFOPEN THEN          /* OR IF SVC IS NOT EQUAL 19  * 00045000
         CLI   RRFUNCTN(PARMLPTR),X'16'                            0127 00046000
         BE    @RF00127                                            0127 00047000
         CLI   RRFUNCTN(PARMLPTR),X'13'                            0127 00048000
         BNE   @RT00127                                            0127 00049000
*   GOTO EXITRTN;                       /* EXIT THIS ROUTINE          * 00050000
* ELSE;                                 /*TEST FURTHER                * 00051000
*                                                                  0129 00052000
@RF00127 DS    0H                                                  0130 00053000
*              /******************************************************* 00054000
*              /*THE SECOND WORD OF THE AUDIT TRAIL IS USED AS  YM4697* 00055000
*              /*A COMMUNICATIONS AREA BETWEEN THE OPEN EXECS   YM4697* 00056000
*              /*AND THIS FORCE CLOSE EXEC. THE 2ND STAGE EXECS YM4697* 00057000
*              /*SAVE THE AMOUNT OF CORE GETMAINED FOR THE      YM4697* 00058000
*              /*IOB'S/ICB'S AND IGG01911 SAVES THE ADDRESS OF  YM4697* 00059000
*              /*THE WORKAREA PASSED TO THE ACCESS METHOD RTNS  YM4697* 00060000
*              /*WHEN PRIMEING BUFFERS.                         YM4697* 00061000
*              /******************************************************* 00062000
*                                                                  0130 00063000
* WRKAUDSV = DXATEXC2;                  /*SAVE INFO PASSED BY   YM4697  00064000
*                                          OPEN EXECUTORS       YM4697* 00065000
         MVC   WRKAUDSV(4,RRECWKAR),DXATEXC2(RCORE)                0130 00066000
* DXATEXC2 = 0;                         /*CLEAR AUDIT TRAIL     YM4697* 00067000
*                                                                  0131 00068000
         SLR   @12,@12                                             0131 00069000
         ST    @12,DXATEXC2(,RCORE)                                0131 00070000
*              /******************************************************* 00071000
*              /*ERROR DID OCCUR DURING OPEN THEREFOR IT IS           * 00072000
*              /*NECESSARY TO TEST AUDIT TRAIL BITS SET BY OPEN       * 00073000
*              /*EXECUTORS TO SEE IF DCB HAS BEEN REFRESHED.          * 00074000
*              /******************************************************* 00075000
*                                                                  0132 00076000
*  IF FCAOCOPY = SWON THEN              /*DCB HAS BEEN REFRESHED,     * 00077000
         TM    FCAOCOPY(RCORE),B'10000000'                         0132 00078000
         BO    @RT00132                                            0132 00079000
*    GOTO XCTLRTN;                      /*   GO TO NORMAL CLOSE EXECS * 00080000
*  ELSE;                                /*DCB HAS NOT BEEN REFRESHED,   00081000
*                                           PROCESS IN THIS ROUTINE   * 00082000
*  RFY PARMLPTR UNRSTD;                                            0135 00083000
*                                                                  0135 00084000
*              /******************************************************* 00085000
*              /*TEST FOR BDAM. IF YES, GO TO BDAM SECTION AS         * 00086000
*              /*PROCESSING WILL BE DIFFERENT THAN FOR SAM/PAM.       * 00087000
*              /******************************************************* 00088000
*                                                                  0136 00089000
*    DO; /*MODESET  KEYADDR(DXUKEY)*/                              0136 00090000
*      SPKA (DXUKEY); /*SET PSW KEY*/                              0137 00091000
         SLR   @12,@12                                             0137 00092000
         IC    @12,DXUKEY(,RCORE)                                  0137 00093000
         SPKA  0(@12)                                              0137 00094000
*    END; /*MODESET  KEYADDR(DXUKEY)*/         /*USER KEY TO FREE USER  00095000
*ORE  */                                                           0138 00096000
*                                                                  0138 00097000
* IF DCBDSGDA = SWON THEN               /*TEST FOR SAM/PAM VS DAM     * 00098000
         TM    DCBDSGDA+16(DCBPTR),B'00100000'                     0139 00099000
         BO    @RT00139                                            0139 00100000
*   GOTO BDAMRTN;                       /*GO PROCESS BDAM DATA SETS   * 00101000
* ELSE;                                 /*IF SAM/PAM, FALL THROUGH    * 00102000
*/********************************************************************* 00103000
*/*PROCESS SAM/PAM DATA SETS IN THIS ROUTINE. RESOURCES TO BE FREED   * 00104000
*/*OR RESTORED ARE:                                                   * 00105000
*/*   1. RECORD AREA                                                  * 00106000
*/*   2. BUFFER POOL CONTROL BLOCK AND BUFFER POOL                    * 00107000
*/*   3. IOB'S/ICB'S                                                  * 00108000
*/*   4. SEGMENT WORKAREA                                             * 00109000
*/*   5. DELETE IGGMSG01 (MESSAGE CSECT) IF LOADED.                   * 00110000
*/*   6. DELETE ANY UCSB/FCB IMAGES LOADED AND NOT DELETED.     YM4697* 00111000
*/*   7. ISSUE CLOSE FOR SYS1.IMAGELIB IF OPENED BUT NOT CLOSED.YM4697* 00112000
*/********************************************************************* 00113000
*                                                                  0142 00114000
* IF DCBCNQSM = SWOFF THEN              /*IF NOT QSAM GO FREE IOBS    * 00115000
         TM    DCBCNQSM+52(DCBPTR),B'00000001'                     0142 00116000
         BZ    @RT00142                                            0142 00117000
*   GOTO SAMIOB;                                                   0143 00118000
* ELSE                                                             0144 00119000
*   IF DCBCNEXB = SWON THEN             /*IF EXCHANGE BUFFERING YM7595* 00120000
         TM    DCBCNEXB+52(DCBPTR),B'00000001'                     0144 00121000
         BO    @RT00144                                            0144 00122000
*     GOTO SAMIOB;                      /* BYPASS BUFF LOGIC    YM7595* 00123000
*   ELSE;                                                          0146 00124000
*                                                                  0146 00125000
*              /******************************************************* 00126000
*              /*THE FIRST CHECK WILL BE FOR A LOGICAL RECORD AREA.   * 00127000
*              /*IF PRESENT, IT MUST BE FREEMAINED.                   * 00128000
*              /******************************************************* 00129000
*                                                                  0147 00130000
* RFY BCBPTR RSTD;                                                 0147 00131000
* RFY BCBLK BASED(BCBPTR);                                         0148 00132000
* BCBPTR = DCBBUFCA;                    /*ADDR OF BUFFER C.B.  ZA00415* 00133000
*                                                                  0149 00134000
         SLR   BCBPTR,BCBPTR                                       0149 00135000
         ICM   BCBPTR,7,DCBBUFCA+16(DCBPTR)                        0149 00136000
* IF FCAORECA = SWON THEN               /*TEST TO SEE IF REC AREA  0150 00137000
*                                             GOTTEN BY OPEN EXECS    * 00138000
         TM    FCAORECA(RCORE),B'00000010'                         0150 00139000
         BNO   @RF00150                                            0150 00140000
*   DO;                                 /*IF YES, FREEMAIN AREA       * 00141000
*   RFY LRIAREA BASED(RECARPTR);                                   0152 00142000
*   RFY RECARPTR RSTD;                                             0153 00143000
*   RECARPTR = BCBLRIAD;                /*ADDR OF RECORD AREA  ZA00415* 00144000
*                                                                  0154 00145000
         SLR   RECARPTR,RECARPTR                                   0154 00146000
         ICM   RECARPTR,7,BCBLRIAD(BCBPTR)                         0154 00147000
*                                       /*ISSUE FREEMAIN              * 00148000
*    DO; /*FREEMAIN(R) LV(LRILNGTH)SP(0)A(LRIAREA)*/               0155 00149000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0156 00150000
*    GPR00F = LRILNGTH; /* LENGTH REQUESTED*/                      0157 00151000
         SLR   GPR00F,GPR00F                                       0157 00152000
         ICM   GPR00F,7,LRILNGTH(RECARPTR)                         0157 00153000
*    GPR01F = 0; /* SP IN REG 1 */                                 0158 00154000
         SLR   GPR01F,GPR01F                                       0158 00155000
*    GEN   (SLL   GPR01F,24)                                       0159 00156000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0159 00157000
         SLL   GPR01F,24                                                00158000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0160 00159000
         OR    GPR00F,GPR01F                                       0160 00160000
*    GPR01F=ADDR(LRIAREA); /*SET REGISTER ONE*/                    0161 00161000
         LR    GPR01F,RECARPTR                                     0161 00162000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0162 00163000
         SVC   10                                                  0162 00164000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0163 00165000
*    END; /*FREEMAIN(R) LV(LRILNGTH)SP(0)A(LRIAREA)*/              0164 00166000
*                                                                  0164 00167000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0165 00168000
*      SPKA (80); /*SET PSW KEY*/                                  0166 00169000
         LA    @01,80                                              0166 00170000
         SPKA  0(@01)                                              0166 00171000
*    END; /*MODESET  EXTKEY(DATAMGT)*/          /*AUDIT TRAIL IN KEY 5  00172000
*      */                                                          0167 00173000
*                                                                  0167 00174000
*   FCACRECA = SWON;                    /*INDICATE RECORD AREA FREED  * 00175000
*                                                                  0168 00176000
         OI    FCACRECA(RCORE),B'01000000'                         0168 00177000
*    DO; /*MODESET  KEYADDR(DXUKEY)*/                              0169 00178000
*      SPKA (DXUKEY); /*SET PSW KEY*/                              0170 00179000
         SLR   @01,@01                                             0170 00180000
         IC    @01,DXUKEY(,RCORE)                                  0170 00181000
         SPKA  0(@01)                                              0170 00182000
*    END; /*MODESET  KEYADDR(DXUKEY)*/                             0171 00183000
*                                                                  0171 00184000
*   RFY RECARPTR UNRSTD;                                           0172 00185000
*   END;                                                           0173 00186000
* ELSE;                                                            0174 00187000
*                                                                  0174 00188000
@RF00150 DS    0H                                                  0175 00189000
*              /******************************************************* 00190000
*              /*THE NEXT CHECK IS TO SEE IF THE OPEN EXECUTORS       * 00191000
*              /*GETMAINED BUFFERS. IF YES, AND THE USER SPECIFIED    * 00192000
*              /*CONCATINATION OF UNLIKE ATTRIBUTES, THEY MUST BE     * 00193000
*              /*FREEMAINED.                                          * 00194000
*              /******************************************************* 00195000
*                                                                  0175 00196000
* IF DCBOFEOV = SWOFF |                 /*TEST FOR CONCAT UNLIK YM7595* 00197000
*    FCAOBUF = SWOFF THEN               /*WAS A BUF POOL GOTTEN YM7595* 00198000
         TM    DCBOFEOV+40(DCBPTR),B'00100000'                     0175 00199000
         BZ    @RT00175                                            0175 00200000
         TM    FCAOBUF(RCORE),B'00100000'                          0175 00201000
         BZ    @RT00175                                            0175 00202000
*                                       /*  FOR THIS OPEN       YM7595* 00203000
*    GOTO SAMBUFLN;                     /*NO, GO RELINK BUFS    YM7595* 00204000
* ELSE;                                                            0177 00205000
*                                                                  0177 00206000
*SAMBUFFR:;                                                        0178 00207000
*                                                                  0178 00208000
SAMBUFFR DS    0H                                                  0179 00209000
*              /******************************************************* 00210000
*              /*THE AMOUNT TO FREEMAIN IS BUFFER LENGTH TIMES THE    * 00211000
*              /*NUMBER OF BUFFERS PLUS THE BUFFER CONTROL BLOCK LEN  * 00212000
*              /*(8 IF NOT EXTENDED, 16 IF EXTENDED)                  * 00213000
*              /******************************************************* 00214000
*                                                                  0179 00215000
* RFY RWORK2 RSTD;                                                 0179 00216000
* RWORK2 = BCBBUFNO * BCBBUFSZ + 8;     /*LEN TO FREE IF NOT EXTENDED * 00217000
*                                                                  0180 00218000
         SLR   @01,@01                                             0180 00219000
         ICM   @01,3,BCBBUFSZ(BCBPTR)                              0180 00220000
         SLR   RWORK2,RWORK2                                       0180 00221000
         IC    RWORK2,BCBBUFNO(,BCBPTR)                            0180 00222000
         MR    @00,RWORK2                                          0180 00223000
         AH    @01,@CH00040                                        0180 00224000
         LR    RWORK2,@01                                          0180 00225000
* IF FCAOXTND = SWON THEN               /*LENGTH TO FREEMAIN          * 00226000
         TM    FCAOXTND(RCORE),B'00000001'                         0181 00227000
         BNO   @RF00181                                            0181 00228000
*   RWORK2 = RWORK2 + 8;                /*  IF EXTENDED BCB           * 00229000
         AH    RWORK2,@CH00040                                     0182 00230000
* ELSE;                                 /*ISSUE FREEMAIN              * 00231000
*                                                                  0183 00232000
@RF00181 DS    0H                                                  0184 00233000
*    DO; /*FREEMAIN(R) LV(RWORK2)SP(0)A(BCBLK)*/                   0184 00234000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0185 00235000
*    GPR00F = RWORK2; /* LENGTH REQUESTED*/                        0186 00236000
         LR    GPR00F,RWORK2                                       0186 00237000
*    GPR01F = 0; /* SP IN REG 1 */                                 0187 00238000
         SLR   GPR01F,GPR01F                                       0187 00239000
*    GEN   (SLL   GPR01F,24)                                       0188 00240000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0188 00241000
         SLL   GPR01F,24                                                00242000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0189 00243000
         OR    GPR00F,GPR01F                                       0189 00244000
*    GPR01F=ADDR(BCBLK); /*SET REGISTER ONE*/                      0190 00245000
         LR    GPR01F,BCBPTR                                       0190 00246000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0191 00247000
         SVC   10                                                  0191 00248000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0192 00249000
*    END; /*FREEMAIN(R) LV(RWORK2)SP(0)A(BCBLK)*/                  0193 00250000
*                                                                  0193 00251000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0194 00252000
*      SPKA (80); /*SET PSW KEY*/                                  0195 00253000
         LA    @01,80                                              0195 00254000
         SPKA  0(@01)                                              0195 00255000
*    END; /*MODESET  EXTKEY(DATAMGT)*/         /*AUDIT TRAIL IN KEY 5   00256000
*     */                                                           0196 00257000
*                                                                  0196 00258000
* FCACBUFC = SWON;                      /*INDIC BUFFERS FREED         * 00259000
*                                                                  0197 00260000
         OI    FCACBUFC(RCORE),B'00100000'                         0197 00261000
*    DO; /*MODESET  KEYADDR(DXUKEY)*/                              0198 00262000
*      SPKA (DXUKEY); /*SET PSW KEY*/                              0199 00263000
         SLR   @01,@01                                             0199 00264000
         IC    @01,DXUKEY(,RCORE)                                  0199 00265000
         SPKA  0(@01)                                              0199 00266000
*    END; /*MODESET  KEYADDR(DXUKEY)*/                             0200 00267000
*                                                                  0200 00268000
* GOTO SAMIOB;                          /*BYPASS RELINKING UBFS YM7595* 00269000
*                                                                  0201 00270000
         B     SAMIOB                                              0201 00271000
*              /******************************************************* 00272000
*              /*BEFORE RELINKING BUFFERS IT MUST BE KNOWN IF IT CAN  * 00273000
*              /*BE DONE SAFELY. OPEN COULD HAVE BEEN IN THE PROCESS  * 00274000
*              /*OF UNCHAINING BUFFERS FOR CCW WHEN THE ERROR OCCURED.* 00275000
*              /*IF THIS IS THE CASE, THE STATE OF THE BUFFER POOL    * 00276000
*              /*IS NOT KNOWN AND THEREFORE IT WOULD BE RISKY TO TRY  * 00277000
*              /*TO RECHAIN. IF THIS IS THE CASE THE BUFFER POOL      * 00278000
*              /*SHOULD BE FREEMAINED BECAUSE IT IS UNUSABLE.         * 00279000
*              /******************************************************* 00280000
*                                                                  0202 00281000
*SAMBUFLN:;                                                        0202 00282000
*                                                                  0202 00283000
SAMBUFLN DS    0H                                                  0203 00284000
* IF FCAOIOBC = SWON THEN               /*IOB BUILDING PROCESS  YM7595* 00285000
         TM    FCAOIOBC(RCORE),B'00010000'                         0203 00286000
         BO    @RT00203                                            0203 00287000
*   GOTO SAMBUFL2;                      /*  MUST HAVE FINISHED  YM7595* 00288000
*                                       /*  OR BUFFERS HAVE NOT YM7595* 00289000
*                                       /*  BEEN UNCHAINED      YM7595* 00290000
* ELSE                                                             0205 00291000
*   IF FCAOBUF = SWON THEN              /*DID OPEN GET BUFFERS  YM7595* 00292000
         TM    FCAOBUF(RCORE),B'00100000'                          0205 00293000
         BO    @RT00205                                            0205 00294000
*                                       /*  THIS TIME           YM7595* 00295000
*     GOTO SAMBUFFR;                    /*YES, FREE BUFFERS     YM7595* 00296000
*   ELSE                                                           0207 00297000
*     GOTO SAMIOB;                      /*NO, CANNOT FREE BUFS  YM7595* 00298000
         B     SAMIOB                                              0207 00299000
*                                       /*  THEY MIGHT BE IN A  YM7595* 00300000
*                                       /*  SHARED POOL         YM7595* 00301000
*                                                                  0208 00302000
*SAMBUFL2:;                                                        0208 00303000
*                                                                  0208 00304000
SAMBUFL2 DS    0H                                                  0209 00305000
* RWORK2 = DCBOFFSR;                    /*ASSUME INPUT          YM7595* 00306000
         SLR   RWORK2,RWORK2                                       0209 00307000
         IC    RWORK2,DCBOFFSR+52(,DCBPTR)                         0209 00308000
* IF DEBACCS = '1111'B THEN             /*TEST FOR OUTPUT       YM7595* 00309000
         TM    DEBACCS(DEBPTR),B'00001111'                         0210 00310000
         BNO   @RF00210                                            0210 00311000
*   RWORK2 = DCBOFFSW;                  /*GET OUTPUT OFFSET     YM7595* 00312000
         SLR   RWORK2,RWORK2                                       0211 00313000
         IC    RWORK2,DCBOFFSW+52(,DCBPTR)                         0211 00314000
* ELSE;                                                            0212 00315000
*                                                                  0212 00316000
@RF00210 DS    0H                                                  0213 00317000
* RFY IOBPTR RSTD;                                                 0213 00318000
* IOBPTR = DCBIOBAB;                    /*GET ADDR AND CLEAR    YM7595* 00319000
         SLR   IOBPTR,IOBPTR                                       0214 00320000
         ICM   IOBPTR,7,DCBIOBAB+52(DCBPTR)                        0214 00321000
*                                       /*  HI BYTE             YM7595* 00322000
* RFY (RWORK3,RWORK4,RWORK5) RSTD;                                 0215 00323000
*                                                                  0215 00324000
* DO RWORK4 = 1 TO DCBBUFNO;            /*MAX NUM OF IOBS       YM7595* 00325000
         LA    RWORK4,1                                            0216 00326000
         B     @DE00216                                            0216 00327000
@DL00216 DS    0H                                                  0217 00328000
*   RWORK3 = RWORK2 + IOBPTR;           /*ADDRESS OF R/W CCW    YM7595* 00329000
         LR    RWORK3,RWORK2                                       0217 00330000
         ALR   RWORK3,IOBPTR                                       0217 00331000
*   RFY CCW BASED(RWORK3);                                         0218 00332000
*   RWORK3 = CCWADDRB;                  /*BUFFER ADDRESS        YM7595* 00333000
*                                                                  0219 00334000
         SLR   @08,@08                                             0219 00335000
         ICM   @08,7,CCWADDRB(RWORK3)                              0219 00336000
         LR    RWORK3,@08                                          0219 00337000
*   IF DEBACCS = '0001'B THEN           /*IF READ BACK, CCW     YM7595* 00338000
         TM    DEBACCS(DEBPTR),B'00000001'                         0220 00339000
         BNO   @RF00220                                            0220 00340000
         TM    DEBACCS(DEBPTR),B'00001110'                         0220 00341000
         BNZ   @RF00220                                            0220 00342000
*     DO;                               /* BUFFER ADDR POINTS   YM7595* 00343000
*     RWORK5 = DCBBLKSI;                /* TO THE END OF THE    YM7595* 00344000
         LH    RWORK5,DCBBLKSI+52(,DCBPTR)                         0222 00345000
*     RWORK3 = RWORK3 - RWORK5 - 1;     /* BUFFER               YM7595* 00346000
         LR    @08,RWORK3                                          0223 00347000
         SLR   @08,RWORK5                                          0223 00348000
         BCTR  @08,0                                               0223 00349000
         LR    RWORK3,@08                                          0223 00350000
*     END;                                                         0224 00351000
*   ELSE                                                           0225 00352000
*     IF DCBDEVT < '5A'X &             /*TEST FOR 1285, 1287   YM7595* 00353000
*        DCBDEVT > '5C'X THEN          /* OR A 1288            YM7595* 00354000
         B     @RC00220                                            0225 00355000
@RF00220 CLI   DCBDEVT+16(DCBPTR),X'5A'                            0225 00356000
         BL    @RF00225                                            0225 00357000
         CLI   DCBDEVT+16(DCBPTR),X'5C'                            0225 00358000
         BH    @RF00225                                            0225 00359000
*                                       /*YES, GET BUFFER ADDR  YM7595* 00360000
*                                       /* FROM 2ND CCW         YM7595* 00361000
*       DO;                                                        0226 00362000
*       RWORK5 = IOBPTR + CCW2;         /*ADDR OF 2ND CCW       YM7595* 00363000
         LA    RWORK5,48                                           0227 00364000
         ALR   RWORK5,IOBPTR                                       0227 00365000
*       RFY CCW BASED(RWORK5);                                     0228 00366000
*       RWORK5 = CCWBYTE;               /*BYTE COUNT FROM 2ND   YM7595  00367000
*                                          CCW                  YM7595* 00368000
         SLR   @08,@08                                             0229 00369000
         ICM   @08,3,CCWBYTE(RWORK5)                               0229 00370000
         LR    RWORK5,@08                                          0229 00371000
*       RWORK3 = RWORK3 - RWORK5;       /*BUFFER ADDR FOR       YM7595  00372000
*                                           NON-VAR LEN RECDS   YM7595* 00373000
         SLR   RWORK3,RWORK5                                       0230 00374000
*       IF DCBRECFF = SWON THEN        /*FIXED OR UNDEFINED    YM7595* 00375000
         TM    DCBRECFF+28(DCBPTR),B'10000000'                     0231 00376000
         BO    @RF00231                                            0231 00377000
*         RWORK3 = RWORK3 + RDWLEN;     /*ADD RDW LEN           YM7595* 00378000
         AH    RWORK3,@CH00060                                     0232 00379000
*       ELSE;                                                      0233 00380000
@RF00231 DS    0H                                                  0234 00381000
*       END;                                                       0234 00382000
*     ELSE;                                                        0235 00383000
*                                                                  0235 00384000
@RF00225 DS    0H                                                  0236 00385000
*   RFY BUFFER BASED(RWORK3);                                      0236 00386000
@RC00220 DS    0H                                                  0237 00387000
*   BUFNXPTB = BCBBUFAD;                /*UPDATE BUF LINK FIELD YM7595* 00388000
         MVC   BUFNXPTB(3,RWORK3),BCBBUFAD(BCBPTR)                 0237 00389000
*   BCBBUFPT = RWORK3;                  /*UPDATE BUF CNTRL BLK  YM7595* 00390000
         ST    RWORK3,BCBBUFPT(,BCBPTR)                            0238 00391000
*   IOBPTR = IOBNIOBB;                  /*NEXT IOB              YM7595* 00392000
*                                                                  0239 00393000
         SLR   @08,@08                                             0239 00394000
         ICM   @08,7,IOBNIOBB-8(IOBPTR)                            0239 00395000
         LR    IOBPTR,@08                                          0239 00396000
* END;                                  /*RWORK4 = DCBBUFNO     YM7595* 00397000
*                                                                  0240 00398000
         AH    RWORK4,@CH00045                                     0240 00399000
@DE00216 SLR   @08,@08                                             0240 00400000
         IC    @08,DCBBUFNO+16(,DCBPTR)                            0240 00401000
         CR    RWORK4,@08                                          0240 00402000
         BNH   @DL00216                                            0240 00403000
*      DO; /*MODESET  EXTKEY(DATAMGT)*/                            0241 00404000
*        SPKA (80); /*SET PSW KEY*/                                0242 00405000
         LA    @08,80                                              0242 00406000
         SPKA  0(@08)                                              0242 00407000
*      END; /*MODESET  EXTKEY(DATAMGT)*/                           0243 00408000
*                                                                  0243 00409000
* FCACBUFP = SWON;                      /*BUFFER POOL REUSABLE  YM7595* 00410000
*                                                                  0244 00411000
         OI    FCACBUFP(RCORE),B'00010000'                         0244 00412000
*    DO; /*MODESET  KEYADDR(DXUKEY)*/                              0245 00413000
*      SPKA (DXUKEY); /*SET PSW KEY*/                              0246 00414000
         SLR   @08,@08                                             0246 00415000
         IC    @08,DXUKEY(,RCORE)                                  0246 00416000
         SPKA  0(@08)                                              0246 00417000
*    END; /*MODESET  KEYADDR(DXUKEY)*/                             0247 00418000
* RFY (BCBPTR,RWORK3,RWORK4,RWORK5) UNRSTD;                        0248 00419000
*                                                                  0248 00420000
*              /******************************************************* 00421000
*              /*THE NEXT CHECK IS TO SEE IF OPEN HAS GETMAINED IOBS. * 00422000
*              /*IF YES, THEY MUST BE FREEMAINED.                     * 00423000
*              /******************************************************* 00424000
*                                                                  0249 00425000
*SAMIOB:;                                                          0249 00426000
*                                                                  0249 00427000
SAMIOB   DS    0H                                                  0250 00428000
* IF FCAOIOB = SWON THEN               /*IF IOBS WERE GETMAINED       * 00429000
         TM    FCAOIOB(RCORE),B'00000100'                          0250 00430000
         BNO   @RF00250                                            0250 00431000
*   DO;                                 /* THEY MUST BE FREEMAINED    * 00432000
*                                                                  0251 00433000
*              /******************************************************* 00434000
*              /*GET THE NUMBER OF BYTES TO FREE                YM4697* 00435000
*              /******************************************************* 00436000
*                                                                  0252 00437000
*   RWORK2 = WRKAUDSV;                  /*LEN TO FREEMAIN       YM4697* 00438000
*                                                                  0252 00439000
         L     RWORK2,WRKAUDSV(,RRECWKAR)                          0252 00440000
*              /******************************************************* 00441000
*              /*GET BEGINNING ADDR OF AREA TO FREEMAIN.        YM4697* 00442000
*              /******************************************************* 00443000
*                                                                  0253 00444000
*   IF DCBCNCHS = SWON THEN             /*GET ADDR OF MIOB IF CH SCH  * 00445000
         TM    DCBCNCHS+52(DCBPTR),B'00000100'                     0253 00446000
         BNO   @RF00253                                            0253 00447000
*     IOBPTR = DCBIOBAA;                /*ADDR OF MIOB         ZA00415* 00448000
*                                                                  0254 00449000
         SLR   IOBPTR,IOBPTR                                       0254 00450000
         ICM   IOBPTR,7,DCBIOBAA+16(DCBPTR)                        0254 00451000
*   ELSE                                /*NON-CHAIN SCHEDULING        * 00452000
*     IOBPTR = DCBIOBAB;                /*ADDR OF IST PHYSICAL ZA00415* 00453000
         B     @RC00253                                            0255 00454000
@RF00253 SLR   IOBPTR,IOBPTR                                       0255 00455000
         ICM   IOBPTR,7,DCBIOBAB+52(DCBPTR)                        0255 00456000
*                                       /* IOB                 ZA00415* 00457000
*                                                                  0256 00458000
*    DO; /*FREEMAIN(R) LV(RWORK2)SP(0)A(IOBORG01)*/                0256 00459000
@RC00253 DS    0H                                                  0257 00460000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0257 00461000
*    GPR00F = RWORK2; /* LENGTH REQUESTED*/                        0258 00462000
         LR    GPR00F,RWORK2                                       0258 00463000
*    GPR01F = 0; /* SP IN REG 1 */                                 0259 00464000
         SLR   GPR01F,GPR01F                                       0259 00465000
*    GEN   (SLL   GPR01F,24)                                       0260 00466000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0260 00467000
         SLL   GPR01F,24                                                00468000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0261 00469000
         OR    GPR00F,GPR01F                                       0261 00470000
*    GPR01F=ADDR(IOBORG01); /*SET REGISTER ONE*/                   0262 00471000
         LR    GPR01F,IOBPTR                                       0262 00472000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0263 00473000
         SVC   10                                                  0263 00474000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0264 00475000
*    END; /*FREEMAIN(R) LV(RWORK2)SP(0)A(IOBORG01)*/               0265 00476000
*                                                                  0265 00477000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0266 00478000
*      SPKA (80); /*SET PSW KEY*/                                  0267 00479000
         LA    @10,80                                              0267 00480000
         SPKA  0(@10)                                              0267 00481000
*    END; /*MODESET  EXTKEY(DATAMGT)*/         /*AUDIT TRAIL IN KEY 5   00482000
*     */                                                           0268 00483000
*                                                                  0268 00484000
*   FCACIOB = SWON;                     /*INDICATE IOB''S FREED       * 00485000
*                                                                  0269 00486000
         OI    FCACIOB(RCORE),B'00001000'                          0269 00487000
*    DO; /*MODESET  KEYADDR(DXUKEY)*/                              0270 00488000
*      SPKA (DXUKEY); /*SET PSW KEY*/                              0271 00489000
         SLR   @10,@10                                             0271 00490000
         IC    @10,DXUKEY(,RCORE)                                  0271 00491000
         SPKA  0(@10)                                              0271 00492000
*    END; /*MODESET  KEYADDR(DXUKEY)*/                             0272 00493000
*                                                                  0272 00494000
*   END;                                                           0273 00495000
* ELSE;                                 /*IOBS NOT GETMAINED          * 00496000
*                                                                  0274 00497000
@RF00250 DS    0H                                                  0275 00498000
* RFY IOBPTR UNRSTD;                                               0275 00499000
*                                                                  0275 00500000
*              /******************************************************* 00501000
*              /*NEXT CHECK TO SEE IF A SEGMENT WORKAREA NEEDS TO     * 00502000
*              /*FREED.                                               * 00503000
*              /******************************************************* 00504000
*                                                                  0276 00505000
*SAMSWA:;                                                          0276 00506000
*                                                                  0276 00507000
SAMSWA   DS    0H                                                  0277 00508000
* IF FCAOSWA = SWON THEN                /*TEST TO SEE IF SWA NEEDS    * 00509000
         TM    FCAOSWA(RCORE),B'00001000'                          0277 00510000
         BNO   @RF00277                                            0277 00511000
*   DO;                                 /* TO BE FREEMAINED           * 00512000
*   RFY SWAPTR RSTD;                                               0279 00513000
*                                                                  0279 00514000
*   SWAPTR = DCBEOBW;                   /*ADDR OF SWA                 * 00515000
         L     SWAPTR,DCBEOBW+72(,DCBPTR)                          0280 00516000
*   RFY SWACB BASED(SWAPTR);                                       0281 00517000
*   RWORK2 = SWACBNO * SWACBLNG + SWALNG; /*AMT TO FREE, NUMBER TIMES   00518000
*                                          LEN PLUS CNTRL BLK LEN     * 00519000
*                                                                  0282 00520000
         SLR   @01,@01                                             0282 00521000
         ICM   @01,3,SWACBLNG(SWAPTR)                              0282 00522000
         SLR   RWORK2,RWORK2                                       0282 00523000
         ICM   RWORK2,3,SWACBNO(SWAPTR)                            0282 00524000
         MR    @00,RWORK2                                          0282 00525000
         AH    @01,@CH00856                                        0282 00526000
         LR    RWORK2,@01                                          0282 00527000
*    DO; /*FREEMAIN(R) LV(RWORK2)SP(0)A(SWACB)*/                   0283 00528000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0284 00529000
*    GPR00F = RWORK2; /* LENGTH REQUESTED*/                        0285 00530000
         LR    GPR00F,RWORK2                                       0285 00531000
*    GPR01F = 0; /* SP IN REG 1 */                                 0286 00532000
         SLR   GPR01F,GPR01F                                       0286 00533000
*    GEN   (SLL   GPR01F,24)                                       0287 00534000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0287 00535000
         SLL   GPR01F,24                                                00536000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0288 00537000
         OR    GPR00F,GPR01F                                       0288 00538000
*    GPR01F=ADDR(SWACB); /*SET REGISTER ONE*/                      0289 00539000
         LR    GPR01F,SWAPTR                                       0289 00540000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0290 00541000
         SVC   10                                                  0290 00542000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0291 00543000
*    END; /*FREEMAIN(R) LV(RWORK2)SP(0)A(SWACB)*/                  0292 00544000
*                                                                  0292 00545000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0293 00546000
*      SPKA (80); /*SET PSW KEY*/                                  0294 00547000
         LA    @01,80                                              0294 00548000
         SPKA  0(@01)                                              0294 00549000
*    END; /*MODESET  EXTKEY(DATAMGT)*/          /*AUDIT TRAIL IN KEY 5  00550000
*      */                                                          0295 00551000
*                                                                  0295 00552000
*   FCACSWA = SWON;                     /*INDICATE SWA FREEMAINED     * 00553000
         OI    FCACSWA(RCORE),B'00000100'                          0296 00554000
*   END;                                                           0297 00555000
* ELSE;                                                            0298 00556000
@RF00277 DS    0H                                                  0299 00557000
* RFY (SWAPTR,RWORK2) UNRSTD;                                      0299 00558000
*                                                                  0299 00559000
*              /******************************************************* 00560000
*              /*NEXT DETERMINE IF THE MESSAGE CSECT MUST BE DELETED. * 00561000
*              /******************************************************* 00562000
*                                                                  0300 00563000
*SAMMSG:;                                                          0300 00564000
*                                                                  0300 00565000
SAMMSG   DS    0H                                                  0301 00566000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0301 00567000
*      SPKA (80); /*SET PSW KEY*/                                  0302 00568000
         LA    @12,80                                              0302 00569000
         SPKA  0(@12)                                              0302 00570000
*    END; /*MODESET  EXTKEY(DATAMGT)*/         /*AUDIT TRAIL IN KEY 5   00571000
*     */                                                           0303 00572000
*                                                                  0303 00573000
* IF DXMSGADR = 0 THEN                 /*TEST TO SEE IF MSG CSECT 0304 00574000
*                                          HAS BEEN DELETED           * 00575000
         ICM   @12,15,DXMSGADR(RCORE)                              0304 00576000
         BZ    @RF00304                                            0304 00577000
*   DO;                                 /*NO, MUST DELETE MSG CSECT   * 00578000
*                                                                  0305 00579000
*    DO;/* DELETE EP('IGGMSG01')*/                                 0306 00580000
*    RESPECIFY (GPR00P)RESTRICTED;                                 0307 00581000
*    GPR00P = ADDR('IGGMSG01');/* ->ENTRY NAME*/                   0308 00582000
         LA    GPR00P,@CC02030                                     0308 00583000
*    SVC    (9);/* DELETE SVC*/                                    0309 00584000
         SVC   9                                                   0309 00585000
*    RESPECIFY (GPR00P)UNRESTRICTED;                               0310 00586000
*    END;/* DELETE EP('IGGMSG01')*/            /*ISSUE DELETE MACRO     00587000
*     */                                                           0311 00588000
*                                                                  0311 00589000
*   FCACDELE = SWON;                    /*INDICATE MSG CSECT DELETED  * 00590000
*                                                                  0312 00591000
         OI    FCACDELE(RCORE),B'00010000'                         0312 00592000
*   END;                                                           0313 00593000
* ELSE;                                                            0314 00594000
*                                                                  0314 00595000
@RF00304 DS    0H                                                  0315 00596000
*              /******************************************************* 00597000
*              /*NEXT DETERMINE IF A UCSB/FCB IMAGE MUST BE DELETED.  * 00598000
*              /******************************************************* 00599000
*                                                                  0315 00600000
*SAMUCSFC:;                                                        0315 00601000
*                                                                  0315 00602000
SAMUCSFC DS    0H                                                  0316 00603000
* IF FCAOUCSL = SWON | FCAOFCBL = SWON THEN  /*MUST AN IMAGE BE YM4697* 00604000
         TM    FCAOUCSL(RCORE),B'01100000'                         0316 00605000
         BZ    @RF00316                                            0316 00606000
*                                       /*  DELETED             YM4697* 00607000
*   IF FCAOUCSL = SWON THEN             /*IS IT A UCS IMAGE     YM4697* 00608000
*                                                                  0317 00609000
         TM    FCAOUCSL(RCORE),B'01000000'                         0317 00610000
         BNO   @RF00317                                            0317 00611000
*       DO;/* DELETE EP(DXSAVUCS)*/                                0318 00612000
*       RESPECIFY (GPR00P)RESTRICTED;                              0319 00613000
*       GPR00P = ADDR(DXSAVUCS);/* ->ENTRY NAME*/                  0320 00614000
         LA    GPR00P,DXSAVUCS(,RCORE)                             0320 00615000
*       SVC    (9);/* DELETE SVC*/                                 0321 00616000
         SVC   9                                                   0321 00617000
*       RESPECIFY (GPR00P)UNRESTRICTED;                            0322 00618000
*       END;/* DELETE EP(DXSAVUCS)*/            /*ISSUE SVC DELETE 0323 00619000
*YM4697*/                                                          0323 00620000
*                                                                  0323 00621000
*                                                                  0323 00622000
*   ELSE                                /*NOT UCS, MUST BE FCB  YM4697* 00623000
*                                                                  0324 00624000
*       DO;/* DELETE EP(DXSAVFCB)*/                                0324 00625000
         B     @RC00317                                            0324 00626000
@RF00317 DS    0H                                                  0325 00627000
*       RESPECIFY (GPR00P)RESTRICTED;                              0325 00628000
*       GPR00P = ADDR(DXSAVFCB);/* ->ENTRY NAME*/                  0326 00629000
         LA    GPR00P,DXSAVFCB(,RCORE)                             0326 00630000
*       SVC    (9);/* DELETE SVC*/                                 0327 00631000
         SVC   9                                                   0327 00632000
*       RESPECIFY (GPR00P)UNRESTRICTED;                            0328 00633000
*       END;/* DELETE EP(DXSAVFCB)*/            /*ISSUE SVC DELETE 0329 00634000
*YM4697*/                                                          0329 00635000
*                                                                  0329 00636000
* ELSE;                                                            0330 00637000
*                                                                  0330 00638000
@RF00316 DS    0H                                                  0331 00639000
*              /******************************************************* 00640000
*              /*NEXT CHECK TO SEE IF SYS1.IMAGELIB IS OPEN.          * 00641000
*              /******************************************************* 00642000
*                                                                  0331 00643000
*SAMIMLIB:;                                                        0331 00644000
*                                                                  0331 00645000
@RC00316 DS    0H                                                  0331 00646000
SAMIMLIB DS    0H                                                  0332 00647000
* RFY GPR01P RSTD;                                                 0332 00648000
* IF FCAOIMGL = SWON THEN               /*WAS IMAGE LIB OPENED  YM4697* 00649000
         TM    FCAOIMGL(RCORE),B'10000000'                         0333 00650000
         BNO   @RF00333                                            0333 00651000
*   DO;                                 /*YES, MUST ISSUE CLOSE YM4697* 00652000
*   GPR01P = DXIMGDCB;                  /*ADDR OF IMAGELIB DCB  YM4697* 00653000
         L     GPR01P,DXIMGDCB(,RCORE)                             0335 00654000
*   GEN REFS(GPR01P) (IMGLIB CLOSE,(GPR01P));  /*CLOSE IMAGLIB  YM4697* 00655000
         IMGLIB CLOSE,(GPR01P)                                          00656000
*   END;                                                           0337 00657000
* ELSE;                                                            0338 00658000
*                                                                  0338 00659000
@RF00333 DS    0H                                                  0339 00660000
* RFY GPR01P UNRSTD;                                               0339 00661000
* RFY GPR15F RSTD;                                                 0340 00662000
* GPR15F = 0;                           /*GOOD RETURN CODE            * 00663000
         SLR   GPR15F,GPR15F                                       0341 00664000
* GOTO EXIT200;                         /*GO TO EXIT ROUTINE          * 00665000
         B     EXIT200                                             0342 00666000
*/********************************************************************* 00667000
*/*PROCESS BDAM DATA SETS IN THIS ROUTINE. RESOURCES TO BE FREED      * 00668000
*/*ARE:                                                               * 00669000
*/*   1. READX LIST                                                   * 00670000
*/*   2. BUFFER POOL AND BUFFER POOL CONTROL BLOCK                    * 00671000
*/*   3. USL LIST                                                     * 00672000
*/*   4. SWA POOL                                                     * 00673000
*/********************************************************************* 00674000
*                                                                  0343 00675000
*BDAMRTN:;                                                         0343 00676000
*                                                                  0343 00677000
BDAMRTN  DS    0H                                                  0344 00678000
*              /******************************************************* 00679000
*              /*THE FIRST CHECK FOR BDAM IS FOR A BUFFER POOL        * 00680000
*              /*GOTTEN BY OPEN. IF PRESENT, THE BUFFER POOL CONTROL  * 00681000
*              /*BLOCK AND BUFFER POOL MUST BE FREEMAINED.            * 00682000
*              /******************************************************* 00683000
*                                                                  0344 00684000
* IF FCAOBUF = SWON THEN                /*TEST TO SEE IF BUFFERS NEED   00685000
*                                          TO BE FREED                * 00686000
         TM    FCAOBUF(RCORE),B'00100000'                          0344 00687000
         BNO   @RF00344                                            0344 00688000
*   DO;                                 /*IF ON, PREPARE TO FREEMAIN  * 00689000
*                                                                  0345 00690000
*   RFY BCBPTR RSTD;                                               0346 00691000
*   BCBPTR = DCBBUFCA;                  /*ADDR OF BUF C.B.     ZA00415* 00692000
         SLR   BCBPTR,BCBPTR                                       0347 00693000
         ICM   BCBPTR,7,DCBBUFCA+16(DCBPTR)                        0347 00694000
*   RFY BCBDEFV BASED(BCBPTR);                                     0348 00695000
*                                                                  0348 00696000
*    DO; /*FREEMAIN(R) LV(BCBTBRS1)SP(0)A(BCBDEFV)*/               0349 00697000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0350 00698000
*    GPR00F = BCBTBRS1; /* LENGTH REQUESTED*/                      0351 00699000
         L     GPR00F,BCBTBRS1(,BCBPTR)                            0351 00700000
*    GPR01F = 0; /* SP IN REG 1 */                                 0352 00701000
         SLR   GPR01F,GPR01F                                       0352 00702000
*    GEN   (SLL   GPR01F,24)                                       0353 00703000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0353 00704000
         SLL   GPR01F,24                                                00705000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0354 00706000
         OR    GPR00F,GPR01F                                       0354 00707000
*    GPR01F=ADDR(BCBDEFV); /*SET REGISTER ONE*/                    0355 00708000
         LR    GPR01F,BCBPTR                                       0355 00709000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0356 00710000
         SVC   10                                                  0356 00711000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0357 00712000
*    END; /*FREEMAIN(R) LV(BCBTBRS1)SP(0)A(BCBDEFV)*/              0358 00713000
*                                                                  0358 00714000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0359 00715000
*      SPKA (80); /*SET PSW KEY*/                                  0360 00716000
         LA    @14,80                                              0360 00717000
         SPKA  0(@14)                                              0360 00718000
*    END; /*MODESET  EXTKEY(DATAMGT)*/         /*AUDIT TRAIL IN KEY 5   00719000
*     */                                                           0361 00720000
*                                                                  0361 00721000
*   FCACBUF = SWON;                     /*INDICATE BUFFERS FREED      * 00722000
*                                                                  0362 00723000
         OI    FCACBUF(RCORE),B'00100000'                          0362 00724000
*    DO; /*MODESET  KEYADDR(DXUKEY)*/                              0363 00725000
*      SPKA (DXUKEY); /*SET PSW KEY*/                              0364 00726000
         SLR   @14,@14                                             0364 00727000
         IC    @14,DXUKEY(,RCORE)                                  0364 00728000
         SPKA  0(@14)                                              0364 00729000
*    END; /*MODESET  KEYADDR(DXUKEY)*/         /*BACK TO USER KEY  0365 00730000
*     */                                                           0365 00731000
*   END;                                                           0366 00732000
* ELSE;                                                            0367 00733000
@RF00344 DS    0H                                                  0368 00734000
* RFY BCBPTR UNRSTD;                                               0368 00735000
*                                                                  0368 00736000
*              /******************************************************* 00737000
*              /*THE NEXT CHECK IS TO SEE IF A USL LIST HAS BEEN      * 00738000
*              /*GETMAINED BY OPEN. IF YES, IT MUST BE FREED.         * 00739000
*              /******************************************************* 00740000
*                                                                  0369 00741000
*DAMUSL:;                                                          0369 00742000
*                                                                  0369 00743000
DAMUSL   DS    0H                                                  0370 00744000
* IF FCAOUSL = SWON THEN                /*TEST TO SEE IF USL MUST  0370 00745000
*                                          BE FREEMAINED              * 00746000
         TM    FCAOUSL(RCORE),B'00010000'                          0370 00747000
         BNO   @RF00370                                            0370 00748000
*   DO;                                 /*ISSUE FREEMAIN              * 00749000
*   RFY USL BASED(DCBDYNB);                                        0372 00750000
*                                                                  0372 00751000
*    DO; /*FREEMAIN(R) LV(USLSZFST)SP(0)A(USL)*/                   0373 00752000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0374 00753000
*    GPR00F = USLSZFST; /* LENGTH REQUESTED*/                      0375 00754000
         LA    GPR00F,64                                           0375 00755000
*    GPR01F = 0; /* SP IN REG 1 */                                 0376 00756000
         SLR   GPR01F,GPR01F                                       0376 00757000
*    GEN   (SLL   GPR01F,24)                                       0377 00758000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0377 00759000
         SLL   GPR01F,24                                                00760000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0378 00761000
         OR    GPR00F,GPR01F                                       0378 00762000
*    GPR01F=ADDR(USL); /*SET REGISTER ONE*/                        0379 00763000
         L     GPR01F,DCBDYNB+52(,DCBPTR)                          0379 00764000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0380 00765000
         SVC   10                                                  0380 00766000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0381 00767000
*    END; /*FREEMAIN(R) LV(USLSZFST)SP(0)A(USL)*/                  0382 00768000
*                                                                  0382 00769000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0383 00770000
*      SPKA (80); /*SET PSW KEY*/                                  0384 00771000
         LA    @14,80                                              0384 00772000
         SPKA  0(@14)                                              0384 00773000
*    END; /*MODESET  EXTKEY(DATAMGT)*/         /*AUDIT TRAIL IN KEY 5   00774000
*     */                                                           0385 00775000
*                                                                  0385 00776000
*   FCACUSL = SWON;                     /*INDICATE USL FREED          * 00777000
*                                                                  0386 00778000
         OI    FCACUSL(RCORE),B'00001000'                          0386 00779000
*    DO; /*MODESET  KEYADDR(DXUKEY)*/                              0387 00780000
*      SPKA (DXUKEY); /*SET PSW KEY*/                              0388 00781000
         SLR   @14,@14                                             0388 00782000
         IC    @14,DXUKEY(,RCORE)                                  0388 00783000
         SPKA  0(@14)                                              0388 00784000
*    END; /*MODESET  KEYADDR(DXUKEY)*/         /*BACK TO USER KEY  0389 00785000
*     */                                                           0389 00786000
*   END;                                                           0390 00787000
* ELSE;                                                            0391 00788000
*                                                                  0391 00789000
@RF00370 DS    0H                                                  0392 00790000
*              /******************************************************* 00791000
*              /*THE NEXT CHECK IF FOR A SEGMENT WORKAREA. IF GOTTEN  * 00792000
*              /*BY OPEN, IT MUST BE FREEMAINED.                      * 00793000
*              /******************************************************* 00794000
*                                                                  0392 00795000
*DAMSWA:;                                                          0392 00796000
*                                                                  0392 00797000
DAMSWA   DS    0H                                                  0393 00798000
* IF FCAOSWA = SWON THEN                /*TEST TO SEE IF SWA MUST 0393 00799000
*                                          BE FREEMAINED              * 00800000
         TM    FCAOSWA(RCORE),B'00001000'                          0393 00801000
         BO    @RF00393                                            0393 00802000
*   DO;                                 /*IF NOT, GET INTO KEY 5      * 00803000
*     DO; /*MODESET  EXTKEY(DATAMGT)*/                             0395 00804000
*       SPKA (80); /*SET PSW KEY*/                                 0396 00805000
         LA    @14,80                                              0396 00806000
         SPKA  0(@14)                                              0396 00807000
*     END; /*MODESET  EXTKEY(DATAMGT)*/         /*READX LIST IN KEY 5   00808000
*      */                                                          0397 00809000
*     GOTO DAMREADX;                    /*BYPASS SWA CODE             * 00810000
         B     DAMREADX                                            0398 00811000
*   END;                                                           0399 00812000
* ELSE                                  /*IF SWA MUST BE FREED        * 00813000
*   DO;                                 /*PREPARE TO FREEMAIN SWA     * 00814000
@RF00393 DS    0H                                                  0401 00815000
*   RFY (SWAPTR,RWORK2) RSTD;                                      0401 00816000
*   SWAPTR = DCBDYNB;                   /*ADDR OF SWA CONTROL BLK     * 00817000
         L     SWAPTR,DCBDYNB+52(,DCBPTR)                          0402 00818000
*   RFY BCBDEFS BASED(SWAPTR);                                     0403 00819000
*                                                                  0403 00820000
*              /******************************************************* 00821000
*              /*THE AMOUNT TO FREEMAIN IS THE NUMBER OF BUFFERS      * 00822000
*              /*TIMES THE LENGTH OF EACH BUFFER PLUS THE LENGTH OF   * 00823000
*              /*THE BUFFER CONTROL BLOCK.                            * 00824000
*              /******************************************************* 00825000
*                                                                  0404 00826000
*   RWORK2 = BCBBFNUM * BCBBFLG + LENGTH(BCBDEFS);  /*LENGTH TO FREE  * 00827000
*                                                                  0404 00828000
         SLR   @01,@01                                             0404 00829000
         ICM   @01,3,BCBBFLG(SWAPTR)                               0404 00830000
         SLR   RWORK2,RWORK2                                       0404 00831000
         ICM   RWORK2,3,BCBBFNUM(SWAPTR)                           0404 00832000
         MR    @00,RWORK2                                          0404 00833000
         AH    @01,@CH00040                                        0404 00834000
         LR    RWORK2,@01                                          0404 00835000
*    DO; /*FREEMAIN(R) LV(RWORK2)SP(0)A(BCBDEFS)*/                 0405 00836000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0406 00837000
*    GPR00F = RWORK2; /* LENGTH REQUESTED*/                        0407 00838000
         LR    GPR00F,RWORK2                                       0407 00839000
*    GPR01F = 0; /* SP IN REG 1 */                                 0408 00840000
         SLR   GPR01F,GPR01F                                       0408 00841000
*    GEN   (SLL   GPR01F,24)                                       0409 00842000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0409 00843000
         SLL   GPR01F,24                                                00844000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0410 00845000
         OR    GPR00F,GPR01F                                       0410 00846000
*    GPR01F=ADDR(BCBDEFS); /*SET REGISTER ONE*/                    0411 00847000
         LR    GPR01F,SWAPTR                                       0411 00848000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0412 00849000
         SVC   10                                                  0412 00850000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0413 00851000
*    END; /*FREEMAIN(R) LV(RWORK2)SP(0)A(BCBDEFS)*/                0414 00852000
*                                                                  0414 00853000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0415 00854000
*      SPKA (80); /*SET PSW KEY*/                                  0416 00855000
         LA    @14,80                                              0416 00856000
         SPKA  0(@14)                                              0416 00857000
*    END; /*MODESET  EXTKEY(DATAMGT)*/          /*AUDIT TRAIL IN KEY 5  00858000
*      */                                                          0417 00859000
*                                                                  0417 00860000
*   FCACSWA = SWON;                     /*INDICATE SWA HAS BEEN FREED * 00861000
         OI    FCACSWA(RCORE),B'00000100'                          0418 00862000
*   END;                                                           0419 00863000
* RFY (SWAPTR,RWORK2) UNRSTD;                                      0420 00864000
*                                                                  0420 00865000
*              /******************************************************* 00866000
*              /*THE NEXT CHECK IS FOR A READX LIST. IF GETMAINED BY  * 00867000
*              /*OPEN, IT MUST BE FREEMAINED.                         * 00868000
*              /******************************************************* 00869000
*                                                                  0421 00870000
*DAMREADX:;                                                        0421 00871000
*                                                                  0421 00872000
DAMREADX DS    0H                                                  0422 00873000
* IF FCAORDX = SWON THEN               /*TEST TO SEE IF READX LIST 0422 00874000
*                                          MUST BE FREEMAINED         * 00875000
         TM    FCAORDX(RCORE),B'01000000'                          0422 00876000
         BNO   @RF00422                                            0422 00877000
*   DO;                                 /*PREPARE TO FREE READX LIST  * 00878000
*                                                                  0423 00879000
*   RFY DEBXTN BASED(DXDEBXAD);                                    0424 00880000
*   RFY RDXLIST BASED(DEBXXARG);                                   0425 00881000
*                                                                  0425 00882000
*    DO; /*FREEMAIN(R) LV(RDXLSTLG)SP(230)A(RDXLIST)*/             0426 00883000
*    RESPECIFY (GPR01F,GPR00F) RESTRICTED;                         0427 00884000
*    GPR00F = RDXLSTLG; /* LENGTH REQUESTED*/                      0428 00885000
         LA    GPR00F,152                                          0428 00886000
*    GPR01F = 230; /* SP IN REG 1 */                               0429 00887000
         LA    GPR01F,230                                          0429 00888000
*    GEN   (SLL   GPR01F,24)                                       0430 00889000
*    NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;                  0430 00890000
         SLL   GPR01F,24                                                00891000
*    GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */                 0431 00892000
         OR    GPR00F,GPR01F                                       0431 00893000
*    GPR01F=ADDR(RDXLIST); /*SET REGISTER ONE*/                    0432 00894000
         L     @14,DXDEBXAD(,RCORE)                                0432 00895000
         L     GPR01F,DEBXXARG(,@14)                               0432 00896000
*    SVC(10); /* R-FORM OF GETMAIN*/                               0433 00897000
         SVC   10                                                  0433 00898000
*    RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                       0434 00899000
*    END; /*FREEMAIN(R) LV(RDXLSTLG)SP(230)A(RDXLIST)*/            0435 00900000
*                                                                  0435 00901000
*   FCACRDX = SWON;                     /*INDICATE READX LIST FREED   * 00902000
         OI    FCACRDX(RCORE),B'00000100'                          0436 00903000
*   END;                                                           0437 00904000
*                                                                  0437 00905000
* ELSE;                                                            0438 00906000
@RF00422 DS    0H                                                  0439 00907000
* RFY GPR15F RSTD;                                                 0439 00908000
* GPR15F = 0;                           /*GOOD RETURN CODE            * 00909000
         SLR   GPR15F,GPR15F                                       0440 00910000
* GOTO EXIT200;                         /*GO TO EXIT ROUTINE          * 00911000
         B     EXIT200                                             0441 00912000
* RFY GPR15F UNRSTD;                                               0442 00913000
*/********************************************************************* 00914000
*/*THIS ROUTINE IS USED TO RETURN TO COMMON CLOSES TRR FOR 4          * 00915000
*/*CONDITIONS:                                                        * 00916000
*/*   1. THE FORCE CLOSE EXECUTOR WAS ENTERED FOR A FAILING FUNCTION  * 00917000
*/*      OTHER THAN OPEN. (RETURN CODE = 8)                           * 00918000
*/*   2. CLOSES SECOND LEVEL ESTAE GOT CONTROL BECAUSE THE NORMAL     * 00919000
*/*      CLOSE EXECUTOR STRING FAILED AFTER BEING GIVEN CONTROL       * 00920000
*/*      FROM THIS MODULE. (RETURN CODE = 8)                          * 00921000
*/*   3. NORMAL ENTRY TO THIS ROUTINE BY CLEANUP ROUTINE AFTER        * 00922000
*/*       SUCCESSFULLY CLEANING UP RESOURCES. (RETURN CODE = 0)       * 00923000
*/*   4. RETURN TO THIS ROUTINE FROM NORMAL CLOSE EXECUTORS AFTER     * 00924000
*/*      SUCCESSFULLY CLEANING UP RESOURCES. (RETURN CODE = 0)        * 00925000
*/********************************************************************* 00926000
*                                                                  0443 00927000
*EXITRTN:;                                                         0443 00928000
*                                                                  0443 00929000
EXITRTN  DS    0H                                                  0444 00930000
* RFY GPR15F RSTD;                                                 0444 00931000
* GPR15F = ERRCODE;                     /*ERROR RETURN CODE           * 00932000
*                                                                  0445 00933000
         LA    GPR15F,8                                            0445 00934000
*EXIT100:;                                                         0446 00935000
*                                                                  0446 00936000
EXIT100  DS    0H                                                  0447 00937000
* BASEREG = WRKBASRG;                   /*RESTORE ADDRESSABILITY      * 00938000
         L     BASEREG,WRKBASRG(,RRECWKAR)                         0447 00939000
*              /******************************************************* 00940000
*              /*MUST MOVE THE FORCE CLOSE AUDIT TRAIL INTO THE CRSA  * 00941000
*              /*SO IF THE USER HAS A STAE ROUTINE HE CAN DETERMINE   * 00942000
*              /*WHAT RESOURCES WERE CLEANED UP FOR HIM. THE CRSA     * 00943000
*              /*IS PASSED TO THE USERS STAE ROUTINE FROM COMMON      * 00944000
*              /*CLOSES ESTAE VIA THE SDWA.                           * 00945000
*              /******************************************************* 00946000
*                                                                  0448 00947000
*EXIT200:;                                                         0448 00948000
*                                                                  0448 00949000
EXIT200  DS    0H                                                  0449 00950000
*    DO; /*MODESET  EXTKEY(SUPR)*/                                 0449 00951000
*      SPKA (0); /*SET PSW KEY*/                                   0450 00952000
         SLR   @14,@14                                             0450 00953000
         SPKA  0(@14)                                              0450 00954000
*    END; /*MODESET  EXTKEY(SUPR)*/            /*KEY TO RETURN TO CLOSE 00955000
*IN   */                                                           0451 00956000
*                                                                  0451 00957000
* IF DXATCOM4 = 0 THEN                 /*VERIFY CRSA EXISTS          * 00958000
         ICM   @14,15,DXATCOM4(RCORE)                              0452 00959000
         BZ    @RF00452                                            0452 00960000
*    DXATCOM4 -> CRSFCXAT = DXATEXC2;   /*AUDIT TRAIL FOR USER        * 00961000
*                                                                  0453 00962000
         L     @14,DXATCOM4(,RCORE)                                0453 00963000
         MVC   CRSFCXAT(4,@14),DXATEXC2(RCORE)                     0453 00964000
* RFY (GPR00P,GPR12P,GPR13P,GPR14P) RSTD;                          0454 00965000
@RF00452 DS    0H                                                  0455 00966000
* GPR13P = WRKSAV13;                    /*ADDR REG SAVE AREA    YM3887* 00967000
         L     GPR13P,WRKSAV13(,RRECWKAR)                          0455 00968000
* LM (GPR00P,GPR12P,REG00T12);          /*LOAD TRRS REGS 0-12   YM3887* 00969000
         LM    GPR00P,GPR12P,REG00T12(GPR13P)                      0456 00970000
* GPR14P = REGSAV14;                    /*LOAD RETURN ADDR      YM3887* 00971000
*                                                                  0457 00972000
         L     GPR14P,REGSAV14(,GPR13P)                            0457 00973000
* BC (15,GPR14P);                       /*RETURN TO CLOSES TRR        * 00974000
         BCR   15,GPR14P                                           0458 00975000
* RFY (GPR12P,GPR13P,GPR14P) UNRSTD;                               0459 00976000
*/********************************************************************* 00977000
*/*THIS ROUTINE IS ENTERED WHEN IT IS FOUND THAT THE USERS DCB HAS    * 00978000
*/*ALREADY BEEN REFRESHED BY THE OPEN EXECUTORS. IT WILL SET UP AN    * 00979000
*/*ERROR ROUTINE RETURN ADDRESS FOR CLOSES SECOND LEVEL ESTAE AND     * 00980000
*/*THEN GIVE THE NORMAL CLOSE EXECUTORS CONTROL TO TRY TO DO NORMAL   * 00981000
*/*CLEAN UP FOR THE DATA SET.                                         * 00982000
*/********************************************************************* 00983000
*                                                                  0460 00984000
*XCTLRTN:;                                                         0460 00985000
*                                                                  0460 00986000
XCTLRTN  DS    0H                                                  0461 00987000
*              /******************************************************* 00988000
*              /*MUST FREEMAIN WORKAREA GOTTEN BY IGG01911      YM4697* 00989000
*              /*IF NOT FREEMAINED.                             YM4697* 00990000
*              /******************************************************* 00991000
*                                                                  0461 00992000
* IF WRKAUDSV = 0 THEN                 /*TEST TO SEE IF CORE   YM4697* 00993000
         ICM   @14,15,WRKAUDSV(RRECWKAR)                           0461 00994000
         BZ    @RF00461                                            0461 00995000
*   DO;                                 /* ALREADY FREEMIANED   YM4697* 00996000
*                                                                  0462 00997000
*        DO; /*MODESET  KEYADDR(DXUKEY)*/                          0463 00998000
*          SPKA (DXUKEY); /*SET PSW KEY*/                          0464 00999000
         SLR   @01,@01                                             0464 01000000
         IC    @01,DXUKEY(,RCORE)                                  0464 01001000
         SPKA  0(@01)                                              0464 01002000
*        END; /*MODESET  KEYADDR(DXUKEY)*/      /*USER KEY FOR FREEMAIN 01003000
*YM4697*/                                                          0465 01004000
*                                                                  0465 01005000
*        DO; /*FREEMAIN(R) LV(LENGTH(OPEXWRKA))SP(230)A(OPEXWRKA)*/     01006000
*        RESPECIFY (GPR01F,GPR00F) RESTRICTED;                     0467 01007000
*        GPR00F = LENGTH(OPEXWRKA); /* LENGTH REQUESTED*/          0468 01008000
         LA    GPR00F,72                                           0468 01009000
*        GPR01F = 230; /* SP IN REG 1 */                           0469 01010000
         LA    GPR01F,230                                          0469 01011000
*        GEN   (SLL   GPR01F,24)                                   0470 01012000
*        NODEFS NOREFS NOSETS NOEXIT NOFLOWS SEQFLOW;              0470 01013000
         SLL   GPR01F,24                                                01014000
*        GPR00F = GPR00F | GPR01F; /* SP IN HI BYTE */             0471 01015000
         OR    GPR00F,GPR01F                                       0471 01016000
*        GPR01F=ADDR(OPEXWRKA); /*SET REGISTER ONE*/               0472 01017000
         L     GPR01F,WRKAUDSV(,RRECWKAR)                          0472 01018000
*        SVC(10); /* R-FORM OF GETMAIN*/                           0473 01019000
         SVC   10                                                  0473 01020000
*        RESPECIFY (GPR01F,GPR00F) UNRESTRICTED;                   0474 01021000
*        END; /*FREEMAIN(R) LV(LENGTH(OPEXWRKA))SP(230)A(OPEXWRKA)*/    01022000
*                                                                  0475 01023000
*   END;                                                           0476 01024000
*                                                                  0476 01025000
*              /******************************************************* 01026000
*              /*THE ADDRESS OF THIS FORCE CLOSE EXECUTORS EXIT RTN   * 01027000
*              /*IS STORED IN THE PARAMETER LIST (PASSED BY COMMON    * 01028000
*              /*CLOSES TRR). IN THE CASE WHERE THE SAM/PAM/DAM CLOSE * 01029000
*              /*EXECUTORS FAIL, COMMON CLOSES SECOND LEVEL ESTAE     * 01030000
*              /*WILL GIVE THE EXIT ROUTINE CONTROL AS A RETRY RTN.   * 01031000
*              /******************************************************* 01032000
*                                                                  0477 01033000
* RFY (RWTG,RPARC,RWTGC,PARMLPTR) RSTD;                            0477 01034000
*                                                                  0477 01035000
@RF00461 DS    0H                                                  0478 01036000
*    DO; /*MODESET  EXTKEY(DATAMGT)*/                              0478 01037000
*      SPKA (80); /*SET PSW KEY*/                                  0479 01038000
         LA    @01,80                                              0479 01039000
         SPKA  0(@01)                                              0479 01040000
*    END; /*MODESET  EXTKEY(DATAMGT)*/           /*ENTER CLOSE EXECS IN 01041000
*KEY 5  */                                                         0480 01042000
*                                                                  0480 01043000
* RRXRETRY = ADDR(EXITRTN);             /*SET UP RETRY ADDRESS FOR 0481 01044000
*                                           CLOSES SECOND LEVEL ESTAE * 01045000
         LA    @14,EXITRTN                                         0481 01046000
         ST    @14,RRXRETRY(,PARMLPTR)                             0481 01047000
* FCACFORC = SWON;                      /*INDIC TO NORMAL CLOSE EXECS   01048000
*                                           THIS IS FORCE CLOSE    0482 01049000
*                                           SITUATION                 * 01050000
         OI    FCACFORC(RCORE),B'10000000'                         0482 01051000
* RWTG = WRKSAV13->REGSAV6;             /*REAL WTG TABLE       OZ05202* 01052000
         L     @01,WRKSAV13(,RRECWKAR)                             0483 01053000
         L     RWTG,REGSAV6(,@01)                                  0483 01054000
* RPARC = ADDR(WRKDCBPT);               /*PARM LIST                   * 01055000
         LA    RPARC,WRKDCBPT(,RRECWKAR)                           0484 01056000
* RWTGC = ADDR(WRKPARML);               /*TO GIVE WORK AREA ADDR      * 01057000
*                                                                  0485 01058000
         LA    RWTGC,WRKPARML(,RRECWKAR)                           0485 01059000
* WRKDCBPT = DXPDCBAD;                  /*BDAM NEEDS PROT DCB ADDR    * 01060000
         MVC   WRKDCBPT(4,RRECWKAR),DXPDCBAD(RCORE)                0486 01061000
*                                       /*SAM GETS DCB ADDR FROM OPEN   01062000
*                                          WORKAREA  (PTR IN REG 4)   * 01063000
* WRKWORKA = RCORE;                     /*ADDR OF OPEN WORKAREA       * 01064000
         ST    RCORE,WRKWORKA(,RRECWKAR)                           0487 01065000
* WRKRETRN = ADDR(EXIT100);             /*CLOSE EXECS RETURN HERE IF    01066000
*                                          THEY ARE SUCCESSFUL        * 01067000
         LA    @14,EXIT100                                         0488 01068000
         ST    @14,WRKRETRN(,RRECWKAR)                             0488 01069000
* WRKBASRG = BASEREG;                   /*SAVE BASE REG FOR RETURN 0489 01070000
*                                          FROM EXECUTOR STRING       * 01071000
*                                                                  0489 01072000
         ST    BASEREG,WRKBASRG(,RRECWKAR)                         0489 01073000
*              /******************************************************* 01074000
*              /*DETERMINE CLOSE EXECUTOR TO XCTL TO:           YM6249* 01075000
*              /*  BDAM - ALWAYS IGG0203A                       YM6249* 01076000
*              /*  QSAM INPUT - DA : IGG0201Z TO DO PURGE FOR   YM6249* 01077000
*              /*                    I/O STARTED BY OPEN EXECS  YM6249* 01078000
*              /*           NON-DA : IGG0201A TO DO PURGE       YM6249* 01079000
*              /*  ALL OTHER  - DA : IGG0201Y FOR CLEAN UP      YM6249* 01080000
*              /*           NON-DA : IGG0201X FOR CLEAN UP      YM6249* 01081000
*              /******************************************************* 01082000
*                                                                  0490 01083000
* WTGMODNM = SAMNTDA2;                  /*ASSUME SAM, NON-DA,   YM6249* 01084000
         MVC   WTGMODNM(8,RWTG),SAMNTDA2                           0490 01085000
*                                       /*  OUTPUT              YM6249* 01086000
* IF DCBDSGDA = SWON THEN               /*IF BDAM, THEN SET UP FOR    * 01087000
         TM    DCBDSGDA+16(DCBPTR),B'00100000'                     0491 01088000
         BNO   @RF00491                                            0491 01089000
*   WTGMODID = DAMEXEC;                 /* IGG0203A                   * 01090000
         MVC   WTGMODID(2,RWTG),DAMEXEC                            0492 01091000
* ELSE                                                             0493 01092000
*   IF DCBDEVDA = SWON THEN            /*IF NON-DA AND         YM6249* 01093000
         B     @RC00491                                            0493 01094000
@RF00491 TM    DCBDEVDA+16(DCBPTR),B'00100000'                     0493 01095000
         BO    @RF00493                                            0493 01096000
*      IF DCBCNQSM = SWON &             /*IF QSAM AND           YM6249* 01097000
*         DEBACCS = '0000'B THEN        /*IF INPUT, I/O WAS     YM6249* 01098000
         TM    DCBCNQSM+52(DCBPTR),B'00000001'                     0494 01099000
         BNO   @RF00494                                            0494 01100000
         TM    DEBACCS(DEBPTR),B'00001111'                         0494 01101000
         BNZ   @RF00494                                            0494 01102000
*         WTGMODID = SAMNTDA1;          /*STARTED BY OPEN EXECS YM6249* 01103000
         MVC   WTGMODID(2,RWTG),SAMNTDA1                           0495 01104000
*      ELSE;                            /*ALREADY SET UP        YM6249* 01105000
@RF00494 DS    0H                                                  0497 01106000
*   ELSE                                                           0497 01107000
*      IF DCBCNQSM = SWON &             /*IF DA, QSAM AND       YM6249* 01108000
*         DEBACCS = '0000'B THEN        /*IF INPUT, I/O WAS     YM6249* 01109000
         B     @RC00493                                            0497 01110000
@RF00493 TM    DCBCNQSM+52(DCBPTR),B'00000001'                     0497 01111000
         BNO   @RF00497                                            0497 01112000
         TM    DEBACCS(DEBPTR),B'00001111'                         0497 01113000
         BNZ   @RF00497                                            0497 01114000
*         WTGMODID = SAMDIRA1;          /*STARTED BY OPEN EXECS YM6249* 01115000
         MVC   WTGMODID(2,RWTG),SAMDIRA1                           0498 01116000
*      ELSE                                                        0499 01117000
*         WTGMODID = SAMDIRA2;          /*ONLY CLEAN UP NEEDED  YM6249* 01118000
*                                                                  0499 01119000
         B     @RC00497                                            0499 01120000
@RF00497 MVC   WTGMODID(2,RWTG),SAMDIRA2                           0499 01121000
*    DO;  /* XCTL MF(E,XCTLPL,COMPLETE) EP(WTGMODNM) DCB(0) */     0500 01122000
@RC00497 DS    0H                                                  0500 01123000
@RC00493 DS    0H                                                  0500 01124000
@RC00491 DS    0H                                                  0501 01125000
*      XCTLPL =XCTLPL&& XCTLPL; /*INITIALIZE LIST*/                0501 01126000
         XC    XCTLPL(8,RCORE),XCTLPL(RCORE)                       0501 01127000
*      XCTLPL01='00'X; /*EP/DE FLAG*/                              0502 01128000
         MVI   XCTLPL01(RCORE),X'00'                               0502 01129000
*      XCTLPL02=ADDR(WTGMODNM); /*EP/DE NAME*/                     0503 01130000
         STCM  RWTG,7,XCTLPL02(RCORE)                              0503 01131000
*      XCTLPL03='00'X;/*FLAG BYTE*/                                0504 01132000
         MVI   XCTLPL03(RCORE),X'00'                               0504 01133000
*      XCTLPL04= 0; /*JOBLIB/STEPLIB DCB*/                         0505 01134000
         SLR   @14,@14                                             0505 01135000
         STCM  @14,7,XCTLPL04(RCORE)                               0505 01136000
*      RESPECIFY (GPR15P) RESTRICTED;                              0506 01137000
*      GPR15P=ADDR(XCTLPL); /*XCTL PARAMETER LIST*/                0507 01138000
         LA    GPR15P,XCTLPL(,RCORE)                               0507 01139000
*      SVC (7);/*ISSUE XCTL SVC*/                                  0508 01140000
         SVC   7                                                   0508 01141000
*      RESPECIFY (GPR15P) UNRESTRICTED;                            0509 01142000
*    END;  /* XCTL MF(E,XCTLPL,COMPLETE) EP(WTGMODNM) DCB(0) */  /*XCTL 01143000
*                                                    TO NORMAL CLOSE EX 01144000
*CS      */                                                        0510 01145000
*                                                                  0510 01146000
* RFY (RWTG,RPARC,RWTGC,PARMLPTR) UNRSTD;                          0511 01147000
*END IGG020T1                                                      0512 01148000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 01149000
*/*%INCLUDE SYSLIB  (IHACCW  )                                        * 01150000
*/*%INCLUDE SYSLIB  (IHADCBDF)                                        * 01151000
*/*%INCLUDE SYSLIB  (IHADCB  )                                        * 01152000
*/*%INCLUDE SYSLIB  (IEZDEB  )                                        * 01153000
*/*%INCLUDE SYSLIB  (IGGBCB  )                                        * 01154000
*/*%INCLUDE SYSLIB  (IGGUSL  )                                        * 01155000
*/*%INCLUDE SYSLIB  (IECDSECS)                                        * 01156000
*/*%INCLUDE SYSLIB  (IECDSECT)                                        * 01157000
*/*%INCLUDE SYSLIB  (IEZIOB  )                                        * 01158000
*/*%INCLUDE SYSLIB  (IGGRDX  )                                        * 01159000
*/*%INCLUDE SYSLIB  (IHAFCAUD)                                        * 01160000
*/*%INCLUDE SYSLIB  (IGGSWA  )                                        * 01161000
*/*%INCLUDE SYSLIB  (IECCRSA )                                        * 01162000
*/*%INCLUDE SYSLIB  (IHASDWA )                                        * 01163000
*;                                                                 0512 01164000
@DATA    DS    0H                                                       01165000
@CH00045 DC    H'1'                                                     01166000
@CH00060 DC    H'4'                                                     01167000
@CH00040 DC    H'8'                                                     01168000
@CH00856 DC    H'12'                                                    01169000
@DATD    DSECT                                                          01170000
         DS    0F                                                       01171000
IGG020T1 CSECT                                                          01172000
         DS    0F                                                       01173000
@DATD    DSECT                                                          01174000
         DS    0D                                                       01175000
SDWAPTR  DS    A                                                        01176000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                01177000
@ENDDATD EQU   *                                                        01178000
IGG020T1 CSECT                                                          01179000
         DS    0F                                                       01180000
@SIZDATD DC    AL1(0)                                                   01181000
         DC    AL3(@ENDDATD-@DATD)                                      01182000
         DS    0D                                                       01183000
@CC02030 DC    C'IGGMSG01'                                              01184000
PATCH    DS    CL50                                                     01185000
         ORG   PATCH                                                    01186000
@NM00162 DC    XL1'0'                                                   01187000
         DC    XL1'0'                                                   01188000
         DC    XL1'0'                                                   01189000
         DC    XL1'0'                                                   01190000
         DC    XL1'0'                                                   01191000
         DC    XL1'0'                                                   01192000
         DC    XL1'0'                                                   01193000
         DC    XL1'0'                                                   01194000
         DC    XL1'0'                                                   01195000
         DC    XL1'0'                                                   01196000
         DC    XL1'0'                                                   01197000
         DC    XL1'0'                                                   01198000
         DC    XL1'0'                                                   01199000
         DC    XL1'0'                                                   01200000
         DC    XL1'0'                                                   01201000
         DC    XL1'0'                                                   01202000
         DC    XL1'0'                                                   01203000
         DC    XL1'0'                                                   01204000
         DC    XL1'0'                                                   01205000
         DC    XL1'0'                                                   01206000
         DC    XL1'0'                                                   01207000
         DC    XL1'0'                                                   01208000
         DC    XL1'0'                                                   01209000
         DC    XL1'0'                                                   01210000
         DC    XL1'0'                                                   01211000
         DC    XL1'0'                                                   01212000
         DC    XL1'0'                                                   01213000
         DC    XL1'0'                                                   01214000
         DC    XL1'0'                                                   01215000
         DC    XL1'0'                                                   01216000
         DC    XL1'0'                                                   01217000
         DC    XL1'0'                                                   01218000
         DC    XL1'0'                                                   01219000
         DC    XL1'0'                                                   01220000
         DC    XL1'0'                                                   01221000
         DC    XL1'0'                                                   01222000
         DC    XL1'0'                                                   01223000
         DC    XL1'0'                                                   01224000
         DC    XL1'0'                                                   01225000
         DC    XL1'0'                                                   01226000
         DC    XL1'0'                                                   01227000
         DC    XL1'0'                                                   01228000
         DC    XL1'0'                                                   01229000
         DC    XL1'0'                                                   01230000
         DC    XL1'0'                                                   01231000
         DC    XL1'0'                                                   01232000
         DC    XL1'0'                                                   01233000
         DC    XL1'0'                                                   01234000
         DC    XL1'0'                                                   01235000
         DC    XL1'0'                                                   01236000
         ORG   PATCH+50                                                 01237000
SAMNTDA2 DC    CL8'IGG0201X'                                            01238000
SAMNTDA1 DC    CL2'1A'                                                  01239000
SAMDIRA1 DC    CL2'1Z'                                                  01240000
SAMDIRA2 DC    CL2'1Y'                                                  01241000
DAMEXEC  DC    CL2'3A'                                                  01242000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       01243000
@01      EQU   01                                                       01244000
@02      EQU   02                                                       01245000
@03      EQU   03                                                       01246000
@04      EQU   04                                                       01247000
@05      EQU   05                                                       01248000
@06      EQU   06                                                       01249000
@07      EQU   07                                                       01250000
@08      EQU   08                                                       01251000
@09      EQU   09                                                       01252000
@10      EQU   10                                                       01253000
@11      EQU   11                                                       01254000
@12      EQU   12                                                       01255000
@13      EQU   13                                                       01256000
@14      EQU   14                                                       01257000
@15      EQU   15                                                       01258000
DCBPTR   EQU   @02                                                      01259000
DEBPTR   EQU   @11                                                      01260000
RWTG     EQU   @06                                                      01261000
RWTGC    EQU   @08                                                      01262000
RCORE    EQU   @04                                                      01263000
IOBPTR   EQU   @09                                                      01264000
GPR00F   EQU   @00                                                      01265000
GPR01F   EQU   @01                                                      01266000
GPR15F   EQU   @15                                                      01267000
GPR00P   EQU   @00                                                      01268000
GPR01P   EQU   @01                                                      01269000
GPR14P   EQU   @14                                                      01270000
GPR15P   EQU   @15                                                      01271000
BASEREG  EQU   @03                                                      01272000
RRECWKAR EQU   @05                                                      01273000
RWORK5   EQU   @06                                                      01274000
RPARC    EQU   @07                                                      01275000
PARMLPTR EQU   @08                                                      01276000
SWAPTR   EQU   @10                                                      01277000
BCBPTR   EQU   @10                                                      01278000
GPR12P   EQU   @12                                                      01279000
RECARPTR EQU   @12                                                      01280000
RWORK2   EQU   @12                                                      01281000
GPR13P   EQU   @13                                                      01282000
RWORK3   EQU   @14                                                      01283000
RWORK4   EQU   @15                                                      01284000
GPR14F   EQU   @14                                                      01285000
RWORK1   EQU   @00                                                      01286000
CCW      EQU   0                                                        01287000
CCWADDRA EQU   CCW                                                      01288000
CCWADDRB EQU   CCWADDRA+1                                               01289000
CCWFLGS  EQU   CCW+4                                                    01290000
CCWBYTE  EQU   CCW+6                                                    01291000
IHADCB   EQU   0                                                        01292000
IHADCS00 EQU   0                                                        01293000
DCBFDAD  EQU   IHADCS00+5                                               01294000
IHADCS01 EQU   0                                                        01295000
DCBDVTBL EQU   IHADCS01                                                 01296000
IHADCS07 EQU   0                                                        01297000
DCBWTOID EQU   IHADCS07                                                 01298000
IHADCS08 EQU   0                                                        01299000
DCBERRCN EQU   IHADCS08                                                 01300000
DCBERRCA EQU   DCBERRCN+1                                               01301000
DCBORFLG EQU   DCBERRCA+1                                               01302000
DCBDSPLY EQU   IHADCS08+4                                               01303000
DCBFRID  EQU   DCBDSPLY                                                 01304000
DCBRESCN EQU   IHADCS08+8                                               01305000
DCBRDLNE EQU   DCBRESCN                                                 01306000
DCBFRTBA EQU   DCBRDLNE                                                 01307000
DCBORBYT EQU   IHADCS08+12                                              01308000
DCBEIB   EQU   IHADCS08+14                                              01309000
IHADCS11 EQU   0                                                        01310000
DCBRELB  EQU   IHADCS11                                                 01311000
DCBREL   EQU   DCBRELB+1                                                01312000
DCBDEVT  EQU   DCBREL                                                   01313000
DCBBUFCB EQU   IHADCS11+4                                               01314000
DCBBUFNO EQU   DCBBUFCB                                                 01315000
DCBBUFCA EQU   DCBBUFCB+1                                               01316000
DCBDSORG EQU   IHADCS11+10                                              01317000
DCBDSRG1 EQU   DCBDSORG                                                 01318000
DCBDSGDA EQU   DCBDSRG1                                                 01319000
DCBDSRG2 EQU   DCBDSORG+1                                               01320000
DCBIOBAD EQU   IHADCS11+12                                              01321000
DCBODEB  EQU   DCBIOBAD                                                 01322000
DCBLNP   EQU   DCBODEB                                                  01323000
DCBQSLM  EQU   DCBLNP                                                   01324000
DCBIOBAA EQU   DCBODEB+1                                                01325000
IHADCS50 EQU   0                                                        01326000
DCBSVCXL EQU   IHADCS50                                                 01327000
DCBEODAD EQU   IHADCS50+4                                               01328000
DCBBFALN EQU   DCBEODAD                                                 01329000
DCBHIARC EQU   DCBBFALN                                                 01330000
DCBBFTEK EQU   DCBHIARC                                                 01331000
DCBBFT   EQU   DCBBFTEK                                                 01332000
DCBEXLST EQU   IHADCS50+8                                               01333000
DCBRECFM EQU   DCBEXLST                                                 01334000
DCBRECLA EQU   DCBRECFM                                                 01335000
IHADCS24 EQU   0                                                        01336000
DCBOFLGS EQU   IHADCS24+8                                               01337000
DCBOFLWR EQU   DCBOFLGS                                                 01338000
DCBOFEOV EQU   DCBOFLGS                                                 01339000
DCBIFLG  EQU   IHADCS24+9                                               01340000
DCBIBPCT EQU   DCBIFLG                                                  01341000
DCBMACR  EQU   IHADCS24+10                                              01342000
DCBMACR1 EQU   DCBMACR                                                  01343000
DCBMRFE  EQU   DCBMACR1                                                 01344000
DCBMRGET EQU   DCBMRFE                                                  01345000
DCBMRAPG EQU   DCBMACR1                                                 01346000
DCBMRRD  EQU   DCBMRAPG                                                 01347000
DCBMRCI  EQU   DCBMACR1                                                 01348000
DCBMRMVG EQU   DCBMRCI                                                  01349000
DCBMRLCG EQU   DCBMACR1                                                 01350000
DCBMRABC EQU   DCBMACR1                                                 01351000
DCBMRPT1 EQU   DCBMRABC                                                 01352000
DCBMRSBG EQU   DCBMRPT1                                                 01353000
DCBMRCRL EQU   DCBMACR1                                                 01354000
DCBMRCHK EQU   DCBMRCRL                                                 01355000
DCBMRRDX EQU   DCBMRCHK                                                 01356000
DCBMRDMG EQU   DCBMACR1                                                 01357000
DCBMACR2 EQU   DCBMACR+1                                                01358000
DCBMRPUT EQU   DCBMACR2                                                 01359000
DCBMRWRT EQU   DCBMACR2                                                 01360000
DCBMRMVP EQU   DCBMACR2                                                 01361000
DCBMR5WD EQU   DCBMACR2                                                 01362000
DCBMRLDM EQU   DCBMR5WD                                                 01363000
DCBMRLCP EQU   DCBMRLDM                                                 01364000
DCBMR4WD EQU   DCBMACR2                                                 01365000
DCBMRPT2 EQU   DCBMR4WD                                                 01366000
DCBMRTMD EQU   DCBMRPT2                                                 01367000
DCBMR3WD EQU   DCBMACR2                                                 01368000
DCBMRCTL EQU   DCBMR3WD                                                 01369000
DCBMRSTK EQU   DCBMRCTL                                                 01370000
DCBMR1WD EQU   DCBMACR2                                                 01371000
DCBMRSWA EQU   DCBMR1WD                                                 01372000
DCBMRDMD EQU   DCBMRSWA                                                 01373000
IHADCS25 EQU   0                                                        01374000
DCBMACRF EQU   IHADCS25+2                                               01375000
DCBMACF1 EQU   DCBMACRF                                                 01376000
DCBMFFE  EQU   DCBMACF1                                                 01377000
DCBMFGET EQU   DCBMFFE                                                  01378000
DCBMFAPG EQU   DCBMACF1                                                 01379000
DCBMFRD  EQU   DCBMFAPG                                                 01380000
DCBMFCI  EQU   DCBMACF1                                                 01381000
DCBMFMVG EQU   DCBMFCI                                                  01382000
DCBMFLCG EQU   DCBMACF1                                                 01383000
DCBMFABC EQU   DCBMACF1                                                 01384000
DCBMFPT1 EQU   DCBMFABC                                                 01385000
DCBMFSBG EQU   DCBMFPT1                                                 01386000
DCBMFCRL EQU   DCBMACF1                                                 01387000
DCBMFCHK EQU   DCBMFCRL                                                 01388000
DCBMFDMG EQU   DCBMACF1                                                 01389000
DCBMACF2 EQU   DCBMACRF+1                                               01390000
DCBMFPUT EQU   DCBMACF2                                                 01391000
DCBMFWRT EQU   DCBMACF2                                                 01392000
DCBMFMVP EQU   DCBMACF2                                                 01393000
DCBMF5WD EQU   DCBMACF2                                                 01394000
DCBMFLDM EQU   DCBMF5WD                                                 01395000
DCBMFLCP EQU   DCBMFLDM                                                 01396000
DCBMF4WD EQU   DCBMACF2                                                 01397000
DCBMFPT2 EQU   DCBMF4WD                                                 01398000
DCBMFTMD EQU   DCBMFPT2                                                 01399000
DCBMF3WD EQU   DCBMACF2                                                 01400000
DCBMFCTL EQU   DCBMF3WD                                                 01401000
DCBMFSTK EQU   DCBMFCTL                                                 01402000
DCBMF1WD EQU   DCBMACF2                                                 01403000
DCBMFSWA EQU   DCBMF1WD                                                 01404000
DCBMFDMD EQU   DCBMFSWA                                                 01405000
DCBDEBAD EQU   IHADCS25+4                                               01406000
DCBIFLGS EQU   DCBDEBAD                                                 01407000
DCBIFPCT EQU   DCBIFLGS                                                 01408000
IHADCS26 EQU   0                                                        01409000
DCBWRITE EQU   IHADCS26                                                 01410000
DCBREAD  EQU   DCBWRITE                                                 01411000
DCBWRITA EQU   DCBREAD+1                                                01412000
IHADCS27 EQU   0                                                        01413000
DCBGET   EQU   IHADCS27                                                 01414000
DCBPUT   EQU   DCBGET                                                   01415000
DCBGETA  EQU   DCBPUT+1                                                 01416000
IHADCS30 EQU   0                                                        01417000
DCBCHECK EQU   IHADCS30                                                 01418000
DCBOPTCD EQU   DCBCHECK                                                 01419000
DCBBLKSI EQU   IHADCS30+10                                              01420000
DCBXARG  EQU   IHADCS30+32                                              01421000
DCBDRDX  EQU   IHADCS30+36                                              01422000
DCBDYNB  EQU   IHADCS30+48                                              01423000
IHADCS36 EQU   0                                                        01424000
@NM00028 EQU   IHADCS36                                                 01425000
@NM00029 EQU   @NM00028                                                 01426000
DCBOPTH  EQU   @NM00029                                                 01427000
DCBOPTO  EQU   DCBOPTH                                                  01428000
DCBOPTZ  EQU   @NM00029                                                 01429000
@NM00031 EQU   IHADCS36+4                                               01430000
DCBCIND1 EQU   IHADCS36+8                                               01431000
DCBCNEXB EQU   DCBCIND1                                                 01432000
DCBCIND2 EQU   IHADCS36+9                                               01433000
DCBCNCHS EQU   DCBCIND2                                                 01434000
DCBCNQSM EQU   DCBCIND2                                                 01435000
DCBOFFSR EQU   IHADCS36+14                                              01436000
DCBOFFSW EQU   IHADCS36+15                                              01437000
DCBIOBA  EQU   IHADCS36+16                                              01438000
DCBCICB  EQU   DCBIOBA                                                  01439000
DCBCICBA EQU   DCBCICB+1                                                01440000
IHADCS52 EQU   0                                                        01441000
DCBDIRCT EQU   IHADCS52                                                 01442000
DCBQSWS  EQU   DCBDIRCT                                                 01443000
DCBUSASI EQU   DCBQSWS                                                  01444000
DCBQADFS EQU   DCBUSASI                                                 01445000
DCBBUFOF EQU   DCBDIRCT+1                                               01446000
IHADCS37 EQU   0                                                        01447000
DCBFLAG1 EQU   IHADCS37                                                 01448000
IHADCS38 EQU   0                                                        01449000
DCBEOBR  EQU   IHADCS38                                                 01450000
DCBEOBW  EQU   IHADCS38+4                                               01451000
DCBPOINT EQU   IHADCS38+12                                              01452000
DCBCNTRL EQU   DCBPOINT                                                 01453000
IHADCS39 EQU   0                                                        01454000
DCBGERR  EQU   IHADCS39                                                 01455000
DCBPERR  EQU   DCBGERR                                                  01456000
DCBGERRA EQU   DCBPERR+1                                                01457000
IHADCS40 EQU   0                                                        01458000
DCBEOBAD EQU   IHADCS40                                                 01459000
DCBCCCW  EQU   IHADCS40+4                                               01460000
DCBRECAD EQU   DCBCCCW                                                  01461000
DCBRECBT EQU   DCBRECAD                                                 01462000
DCBRCREL EQU   DCBRECBT                                                 01463000
@NM00046 EQU   IHADCS40+12                                              01464000
DCBEROPT EQU   @NM00046                                                 01465000
NOBASE   EQU   0                                                        01466000
DEBBASIC EQU   0                                                        01467000
DEBTCBAD EQU   DEBBASIC                                                 01468000
DEBDEBAD EQU   DEBBASIC+4                                               01469000
DEBIRBAD EQU   DEBBASIC+8                                               01470000
DEBOFLGS EQU   DEBIRBAD                                                 01471000
DEBOPATB EQU   DEBBASIC+12                                              01472000
DEBACCS  EQU   DEBOPATB                                                 01473000
DEBFLGS1 EQU   DEBBASIC+14                                              01474000
DEBUSRPG EQU   DEBBASIC+16                                              01475000
DEBRRQ   EQU   DEBBASIC+20                                              01476000
DEBECBAD EQU   DEBRRQ                                                   01477000
DEBDCBAD EQU   DEBBASIC+24                                              01478000
DEBPROTG EQU   DEBDCBAD                                                 01479000
DEBAPPAD EQU   DEBBASIC+28                                              01480000
DEBBASND EQU   DEBBASIC+32                                              01481000
DEBDASD  EQU   0                                                        01482000
DEBUCBAD EQU   DEBDASD                                                  01483000
DEBACSMD EQU   0                                                        01484000
DEBVOLSQ EQU   DEBACSMD                                                 01485000
DEBVOLBT EQU   DEBVOLSQ                                                 01486000
DEBDSNM  EQU   DEBACSMD+4                                               01487000
DEBUTSAA EQU   DEBDSNM                                                  01488000
DEBACS01 EQU   0                                                        01489000
DEBDSNAM EQU   DEBACS01                                                 01490000
DEBACS02 EQU   0                                                        01491000
DEBDBLK  EQU   DEBACS02                                                 01492000
DEBACS03 EQU   0                                                        01493000
DEBACS04 EQU   0                                                        01494000
DEBTBFRA EQU   DEBACS04                                                 01495000
DEBTCCWA EQU   DEBACS04+4                                               01496000
DEBACS05 EQU   0                                                        01497000
DEBFUCBA EQU   DEBACS05                                                 01498000
DEBLUCBA EQU   DEBACS05+4                                               01499000
DEBACS06 EQU   0                                                        01500000
DEBACS07 EQU   0                                                        01501000
DEBACS08 EQU   0                                                        01502000
DEBSUBNM EQU   0                                                        01503000
DEB      EQU   0                                                        01504000
DEBAVT   EQU   DEB                                                      01505000
DEBEOEA  EQU   DEBAVT                                                   01506000
DEBEOEAB EQU   DEBEOEA                                                  01507000
DEBSIOA  EQU   DEBAVT+4                                                 01508000
DEBSIOAB EQU   DEBSIOA                                                  01509000
DEBPCIA  EQU   DEBAVT+8                                                 01510000
DEBPCIAB EQU   DEBPCIA                                                  01511000
DEBCEA   EQU   DEBAVT+12                                                01512000
DEBCEAB  EQU   DEBCEA                                                   01513000
DEBXCEA  EQU   DEBAVT+16                                                01514000
DEBXCEAB EQU   DEBXCEA                                                  01515000
DEBPREFX EQU   DEB+20                                                   01516000
DEBXTNP  EQU   DEBPREFX+8                                               01517000
DEBXTN   EQU   0                                                        01518000
DEBXFLG1 EQU   DEBXTN+2                                                 01519000
DEBXXARG EQU   DEBXTN+20                                                01520000
BCBLK    EQU   0                                                        01521000
BCBBUFPT EQU   BCBLK                                                    01522000
BCBBUFAD EQU   BCBBUFPT+1                                               01523000
BCBFLGS  EQU   BCBLK+4                                                  01524000
BCBBUFNO EQU   BCBLK+5                                                  01525000
BCBBUFSZ EQU   BCBLK+6                                                  01526000
BCBLRIAR EQU   BCBLK+8                                                  01527000
BCBLRIAD EQU   BCBLRIAR+1                                               01528000
LRIAREA  EQU   0                                                        01529000
LRILOC   EQU   LRIAREA                                                  01530000
LRILGTH  EQU   LRILOC                                                   01531000
LRIFLG1  EQU   LRILGTH                                                  01532000
LRILNGTH EQU   LRILGTH+1                                                01533000
LRIFLG2  EQU   LRILOC+4                                                 01534000
LRITRKAD EQU   LRIAREA+8                                                01535000
LRINIOB  EQU   LRIAREA+16                                               01536000
LRIALIGN EQU   0                                                        01537000
BUFFER   EQU   0                                                        01538000
BCBDEFV  EQU   0                                                        01539000
BCBTBRS1 EQU   BCBDEFV+12                                               01540000
BCBDEFR  EQU   0                                                        01541000
BCBIOBS  EQU   BCBDEFR                                                  01542000
BCBDEFS  EQU   0                                                        01543000
BCBBFNUM EQU   BCBDEFS+4                                                01544000
BCBBFLG  EQU   BCBDEFS+6                                                01545000
USL      EQU   0                                                        01546000
USLBFRQT EQU   USL+4                                                    01547000
USLBFRQB EQU   USL+8                                                    01548000
IECPREFX EQU   0                                                        01549000
IECEXTPR EQU   IECPREFX+32                                              01550000
IECUPRML EQU   IECEXTPR+80                                              01551000
IECRESWA EQU   IECEXTPR+84                                              01552000
RWARESWA EQU   0                                                        01553000
RWAPREFX EQU   RWARESWA                                                 01554000
USERPRML EQU   0                                                        01555000
IECRRPL  EQU   0                                                        01556000
RRPLIST  EQU   IECRRPL                                                  01557000
RRFUNCTN EQU   RRPLIST                                                  01558000
RRFLAGS1 EQU   RRPLIST+1                                                01559000
RRFLAGS2 EQU   RRPLIST+2                                                01560000
RRFLAGS3 EQU   RRPLIST+3                                                01561000
RRXRETRY EQU   RRPLIST+12                                               01562000
DSMADTRL EQU   0                                                        01563000
DSMADTW1 EQU   DSMADTRL                                                 01564000
DSMADTB1 EQU   DSMADTW1                                                 01565000
DSMADTB2 EQU   DSMADTW1+1                                               01566000
WTGTABLE EQU   0                                                        01567000
WTGWTOPR EQU   WTGTABLE                                                 01568000
WTG      EQU   0                                                        01569000
WTGAREA  EQU   WTG                                                      01570000
WTGMODNM EQU   WTGAREA                                                  01571000
WTGMODID EQU   WTGMODNM+6                                               01572000
WTGPREFX EQU   WTGAREA+16                                               01573000
WTGPATHS EQU   WTG+30                                                   01574000
WTGENTRY EQU   0                                                        01575000
WTGIDTTR EQU   WTGENTRY                                                 01576000
APPNMTBL EQU   0                                                        01577000
APPENTRY EQU   APPNMTBL+4                                               01578000
FORCORE  EQU   0                                                        01579000
DXDSCB   EQU   FORCORE                                                  01580000
DXDAADDR EQU   FORCORE+312                                              01581000
DXDCB    EQU   FORCORE+320                                              01582000
DXCCW    EQU   FORCORE+368                                              01583000
DXCCW1   EQU   DXCCW                                                    01584000
DXCCW5   EQU   DXCCW+32                                                 01585000
DXCCW8   EQU   DXCCW+56                                                 01586000
DXCCW12  EQU   DXCCW+88                                                 01587000
DXXCTL   EQU   FORCORE+472                                              01588000
DXVOLSR  EQU   FORCORE+500                                              01589000
DXVOLSR1 EQU   DXVOLSR                                                  01590000
DXVOLSR2 EQU   DXVOLSR+6                                                01591000
DXVOLSR3 EQU   DXVOLSR+12                                               01592000
DXRESSW  EQU   FORCORE+524                                              01593000
DXUKEY   EQU   FORCORE+526                                              01594000
DXDEBXAD EQU   FORCORE+552                                              01595000
DXUCBSAV EQU   FORCORE+564                                              01596000
DXUDCBAD EQU   FORCORE+568                                              01597000
DXPDCBAD EQU   FORCORE+572                                              01598000
DXMSGADR EQU   FORCORE+584                                              01599000
DXATCOM1 EQU   FORCORE+588                                              01600000
DXATGENS EQU   DXATCOM1                                                 01601000
DXATVGIV EQU   DXATGENS                                                 01602000
DXATOUTA EQU   DXATCOM1+2                                               01603000
DXATDACC EQU   DXATCOM1+3                                               01604000
DXATCOM2 EQU   FORCORE+592                                              01605000
DXATEOV  EQU   DXATCOM2                                                 01606000
DXATOPEN EQU   DXATCOM2+1                                               01607000
DXATALL  EQU   DXATCOM2+2                                               01608000
DXATCOM4 EQU   FORCORE+600                                              01609000
DXATEXC1 EQU   FORCORE+604                                              01610000
DXATEXB1 EQU   DXATEXC1                                                 01611000
DXATEXC2 EQU   FORCORE+608                                              01612000
DSECTSIZ EQU   FORCORE+612                                              01613000
IOBPREFX EQU   0                                                        01614000
IOBCFLG1 EQU   IOBPREFX                                                 01615000
IOBSTDRD EQU   0                                                        01616000
IOBFLAG1 EQU   IOBSTDRD                                                 01617000
IOBCYCCK EQU   IOBFLAG1                                                 01618000
IOBRSTRT EQU   IOBFLAG1                                                 01619000
IOBFLAG2 EQU   IOBSTDRD+1                                               01620000
IOBPURGE EQU   IOBFLAG2                                                 01621000
IOBRDHA0 EQU   IOBFLAG2                                                 01622000
IOBSENS0 EQU   IOBSTDRD+2                                               01623000
IOBS0B7  EQU   IOBSENS0                                                 01624000
IOBSENS1 EQU   IOBSTDRD+3                                               01625000
IOBECBPT EQU   IOBSTDRD+4                                               01626000
IOBFLAG3 EQU   IOBSTDRD+8                                               01627000
IOBFL3   EQU   IOBFLAG3                                                 01628000
IOBCNC   EQU   IOBFL3                                                   01629000
IOBICL   EQU   IOBFL3                                                   01630000
IOBCSW   EQU   IOBSTDRD+9                                               01631000
IOBIOCSW EQU   IOBCSW                                                   01632000
IOBSTBYT EQU   IOBIOCSW+3                                               01633000
IOBUSTAT EQU   IOBSTBYT                                                 01634000
IOBCSTAT EQU   IOBSTBYT+1                                               01635000
IOBSTART EQU   IOBSTDRD+16                                              01636000
IOBDCBPT EQU   IOBSTDRD+20                                              01637000
IOBFLAG4 EQU   IOBDCBPT                                                 01638000
IOBRESTR EQU   IOBSTDRD+24                                              01639000
IOBINCAM EQU   IOBSTDRD+28                                              01640000
IOBBTAMF EQU   IOBINCAM                                                 01641000
RDXLIST  EQU   0                                                        01642000
RDXENTRY EQU   0                                                        01643000
SWACB    EQU   0                                                        01644000
SWACBNO  EQU   SWACB+4                                                  01645000
SWACBLNG EQU   SWACB+6                                                  01646000
IECCRSA  EQU   0                                                        01647000
CRSIECHD EQU   IECCRSA                                                  01648000
CRSIECBS EQU   IECCRSA+16                                               01649000
CRSIECNT EQU   0                                                        01650000
CRSIECFC EQU   CRSIECNT                                                 01651000
CRSIECTP EQU   CRSIECNT+1                                               01652000
CRSIECDA EQU   CRSIECNT+2                                               01653000
CRSFCXAT EQU   CRSIECNT+4                                               01654000
SDWA     EQU   0                                                        01655000
SDWAFIOB EQU   SDWA+4                                                   01656000
SDWAABCC EQU   SDWAFIOB                                                 01657000
SDWACMPF EQU   SDWAABCC                                                 01658000
SDWACTL1 EQU   SDWA+8                                                   01659000
SDWACMKA EQU   SDWACTL1                                                 01660000
SDWAMWPA EQU   SDWACTL1+1                                               01661000
SDWAPMKA EQU   SDWACTL1+4                                               01662000
SDWACTL2 EQU   SDWA+16                                                  01663000
SDWACMKP EQU   SDWACTL2                                                 01664000
SDWAMWPP EQU   SDWACTL2+1                                               01665000
SDWAPMKP EQU   SDWACTL2+4                                               01666000
SDWAGRSV EQU   SDWA+24                                                  01667000
SDWANAME EQU   SDWA+88                                                  01668000
SDWAEC1  EQU   SDWA+104                                                 01669000
SDWAEMK1 EQU   SDWAEC1                                                  01670000
SDWAMWP1 EQU   SDWAEC1+1                                                01671000
SDWAINT1 EQU   SDWAEC1+2                                                01672000
SDWANXT1 EQU   SDWAEC1+4                                                01673000
SDWAAEC1 EQU   SDWA+112                                                 01674000
SDWAILC1 EQU   SDWAAEC1+1                                               01675000
SDWAINC1 EQU   SDWAAEC1+2                                               01676000
SDWAICD1 EQU   SDWAINC1+1                                               01677000
SDWAEC2  EQU   SDWA+120                                                 01678000
SDWAEMK2 EQU   SDWAEC2                                                  01679000
SDWAMWP2 EQU   SDWAEC2+1                                                01680000
SDWAINT2 EQU   SDWAEC2+2                                                01681000
SDWANXT2 EQU   SDWAEC2+4                                                01682000
SDWAAEC2 EQU   SDWA+128                                                 01683000
SDWAILC2 EQU   SDWAAEC2+1                                               01684000
SDWAINC2 EQU   SDWAAEC2+2                                               01685000
SDWAICD2 EQU   SDWAINC2+1                                               01686000
SDWASRSV EQU   SDWA+136                                                 01687000
SDWAIDNT EQU   SDWA+200                                                 01688000
SDWAMCH  EQU   SDWA+204                                                 01689000
SDWASTCK EQU   SDWAMCH                                                  01690000
SDWAMCHI EQU   SDWAMCH+8                                                01691000
SDWAMCHS EQU   SDWAMCHI                                                 01692000
SDWAMCHD EQU   SDWAMCHI+1                                               01693000
SDWARSR1 EQU   SDWAMCH+12                                               01694000
SDWARSR2 EQU   SDWAMCH+13                                               01695000
SDWAFLGS EQU   SDWA+232                                                 01696000
SDWAERRA EQU   SDWAFLGS                                                 01697000
SDWAERRB EQU   SDWAFLGS+1                                               01698000
SDWAERRC EQU   SDWAFLGS+2                                               01699000
SDWAERRD EQU   SDWAFLGS+3                                               01700000
SDWAIOFS EQU   SDWA+238                                                 01701000
SDWACPUA EQU   SDWA+248                                                 01702000
SDWAPARQ EQU   SDWA+252                                                 01703000
SDWAACF2 EQU   SDWAPARQ+1                                               01704000
SDWAACF3 EQU   SDWAPARQ+2                                               01705000
SDWAACF4 EQU   SDWAPARQ+3                                               01706000
SDWALKWA EQU   SDWA+256                                                 01707000
SDWALKWS EQU   SDWALKWA                                                 01708000
SDWARECP EQU   SDWA+292                                                 01709000
SDWASNPA EQU   SDWA+320                                                 01710000
SDWADUMP EQU   SDWASNPA                                                 01711000
SDWADPFS EQU   SDWADUMP+1                                               01712000
SDWADDAT EQU   SDWASNPA+4                                               01713000
SDWASDAT EQU   SDWADDAT                                                 01714000
SDWAPDAT EQU   SDWADDAT+2                                               01715000
SDWADPSA EQU   SDWA+328                                                 01716000
SDWADPSL EQU   SDWADPSA                                                 01717000
SDWACOMP EQU   SDWA+392                                                 01718000
SDWARA   EQU   SDWA+400                                                 01719000
SDWADPVA EQU   SDWARA+2                                                 01720000
WRKAREA  EQU   0                                                        01721000
WRKSAV13 EQU   WRKAREA                                                  01722000
WRKPARML EQU   WRKAREA+4                                                01723000
WRKWORKA EQU   WRKPARML+4                                               01724000
WRKDCBPT EQU   WRKAREA+12                                               01725000
WRKRETRN EQU   WRKAREA+24                                               01726000
WRKAUDSV EQU   WRKAREA+28                                               01727000
WRKBASRG EQU   WRKAREA+32                                               01728000
REGSAVAR EQU   0                                                        01729000
REG14T12 EQU   REGSAVAR+12                                              01730000
REGSAV14 EQU   REG14T12                                                 01731000
REG00T12 EQU   REG14T12+8                                               01732000
REGSAV6  EQU   REG00T12+24                                              01733000
OPEXWRKA EQU   0                                                        01734000
IKEBC    EQU   0                                                        01735000
IKEBF15  EQU   0                                                        01736000
IKEBF31  EQU   0                                                        01737000
IKEBP15  EQU   0                                                        01738000
IKEBP31  EQU   0                                                        01739000
IKEBP8   EQU   0                                                        01740000
DEBBAS02 EQU   DEBBASND                                                 01741000
DEBDDS1  EQU   DEBBAS02                                                 01742000
DEBSUCBA EQU   DEBDDS1                                                  01743000
DEBDEVED EQU   DEBDDS1+4                                                01744000
DEBRDCB  EQU   DEBDDS1+4                                                01745000
DEBPDCB  EQU   DEBDDS1+8                                                01746000
DEBWDCB  EQU   DEBDDS1+12                                               01747000
DEBACS09 EQU   DEBDEVED                                                 01748000
DEBASC09 EQU   DEBACS09                                                 01749000
DEBEAMFG EQU   DEBASC09+3                                               01750000
DEBDSID  EQU   DEBASC09+4                                               01751000
DEBEOD   EQU   DEBASC09+12                                              01752000
DEBBOE   EQU   DEBEOD                                                   01753000
DEBEODRV EQU   DEBBOE                                                   01754000
DEBEODTT EQU   DEBBOE+1                                                 01755000
DEBEOD0  EQU   DEBBOE+2                                                 01756000
DEBEODSS EQU   DEBBOE+3                                                 01757000
DEBBAS01 EQU   DEBBASND                                                 01758000
DEBISAM  EQU   DEBBAS01                                                 01759000
DEBFIEAD EQU   DEBISAM                                                  01760000
DEBFPEAD EQU   DEBISAM+4                                                01761000
DEBFOEAD EQU   DEBISAM+8                                                01762000
DEBEXPT  EQU   DEBISAM+12                                               01763000
DEBRPSID EQU   DEBEXPT                                                  01764000
BUFNXPTA EQU   BUFFER                                                   01765000
BUFNXPTB EQU   BUFNXPTA+1                                               01766000
DXXWTG   EQU   DSECTSIZ                                                 01767000
DXXAREA  EQU   DSECTSIZ+4                                               01768000
DXXMODNM EQU   DXXAREA                                                  01769000
DXXLNG   EQU   DXXAREA+29                                               01770000
DXXENTRY EQU   DXXAREA+32                                               01771000
DXXIDTTR EQU   DXXENTRY                                                 01772000
DXREGSAV EQU   DXCCW8                                                   01773000
DXREG1   EQU   DXREGSAV+28                                              01774000
DXIDENT  EQU   DXCCW12                                                  01775000
DXRETMOD EQU   DXIDENT+2                                                01776000
@NM00083 EQU   DXXCTL                                                   01777000
DXSAVMOD EQU   @NM00083+2                                               01778000
@NM00084 EQU   DXRESSW                                                  01779000
IOBORG01 EQU   IOBPREFX+8                                               01780000
IOBNIOBA EQU   IOBORG01                                                 01781000
IOBNFLG1 EQU   IOBNIOBA                                                 01782000
IOBPRTOV EQU   IOBNFLG1                                                 01783000
IOBNIOBB EQU   IOBNIOBA+1                                               01784000
IOBORG02 EQU   IOBPREFX+8                                               01785000
IOBDQADA EQU   IOBORG02                                                 01786000
IOBDEQIN EQU   IOBDQADA                                                 01787000
IOBORG03 EQU   IOBPREFX+12                                              01788000
IOBORG04 EQU   IOBINCAM                                                 01789000
IOBORG12 EQU   IOBINCAM                                                 01790000
IOBFL4   EQU   IOBORG12                                                 01791000
IOBEXTEN EQU   IOBSTDRD+32                                              01792000
IOBSEEK  EQU   IOBEXTEN                                                 01793000
IOBBB    EQU   IOBSEEK+1                                                01794000
IOBCC    EQU   IOBSEEK+3                                                01795000
IOBHH    EQU   IOBSEEK+5                                                01796000
IOBORG05 EQU   IOBEXTEN                                                 01797000
IOBORG06 EQU   IOBEXTEN                                                 01798000
IOBNXTPT EQU   IOBORG06+4                                               01799000
IOBSTATA EQU   IOBNXTPT                                                 01800000
IOBORG07 EQU   IOBEXTEN+8                                               01801000
W1IEXTEN EQU   IOBORG07                                                 01802000
IOBORG08 EQU   IOBEXTEN+8                                               01803000
IOBINDCT EQU   IOBORG08+4                                               01804000
IOBUNSQR EQU   IOBORG08+5                                               01805000
IOBFCHAD EQU   IOBORG08+8                                               01806000
IOBORG09 EQU   IOBEXTEN+8                                               01807000
IOBDPLAD EQU   IOBORG09+4                                               01808000
IOBDTYPE EQU   IOBORG09+8                                               01809000
IOBDTYP2 EQU   IOBORG09+9                                               01810000
IOBDSTAT EQU   IOBORG09+10                                              01811000
IOBSTAT1 EQU   IOBDSTAT                                                 01812000
IOBORG10 EQU   IOBEXTEN+8                                               01813000
IOBSEEK2 EQU   IOBORG10                                                 01814000
IOBORG11 EQU   IOBEXTEN                                                 01815000
IOBERCT  EQU   IOBORG11                                                 01816000
IOBUCBXV EQU   IOBERCT                                                  01817000
IOBNAME  EQU   IOBORG11+4                                               01818000
IOBORG13 EQU   IOBEXTEN                                                 01819000
IOBSKADR EQU   IOBORG13                                                 01820000
FCAOPEN  EQU   DXATEXC1                                                 01821000
FCAOPEN1 EQU   FCAOPEN                                                  01822000
FCAOCOPY EQU   FCAOPEN1                                                 01823000
FCAORDX  EQU   FCAOPEN1                                                 01824000
FCAOBUF  EQU   FCAOPEN1                                                 01825000
FCAOUSL  EQU   FCAOPEN1                                                 01826000
FCAOSWA  EQU   FCAOPEN1                                                 01827000
FCAOIOB  EQU   FCAOPEN1                                                 01828000
FCAORECA EQU   FCAOPEN1                                                 01829000
FCAOXTND EQU   FCAOPEN1                                                 01830000
FCAOPEN2 EQU   FCAOPEN+1                                                01831000
FCAOIMGL EQU   FCAOPEN2                                                 01832000
FCAOUCSL EQU   FCAOPEN2                                                 01833000
FCAOFCBL EQU   FCAOPEN2                                                 01834000
FCAOIOBC EQU   FCAOPEN2                                                 01835000
FCACLOSE EQU   DXATEXC2                                                 01836000
FCACLOS1 EQU   FCACLOSE                                                 01837000
FCACFORC EQU   FCACLOS1                                                 01838000
FCACRECA EQU   FCACLOS1                                                 01839000
FCACBUFC EQU   FCACLOS1                                                 01840000
FCACBUF  EQU   FCACBUFC                                                 01841000
FCACBUFP EQU   FCACLOS1                                                 01842000
FCACIOB  EQU   FCACLOS1                                                 01843000
FCACSWA  EQU   FCACLOS1                                                 01844000
FCACLOS2 EQU   FCACLOSE+1                                               01845000
FCACLOS3 EQU   FCACLOSE+2                                               01846000
FCACDELE EQU   FCACLOS3                                                 01847000
FCACUSL  EQU   FCACLOS3                                                 01848000
FCACRDX  EQU   FCACLOS3                                                 01849000
DCBDEVIC EQU   DCBDEVT                                                  01850000
DCBDEVDA EQU   DCBDEVIC                                                 01851000
DCBRECFO EQU   DCBRECFM                                                 01852000
DCBRECFF EQU   DCBRECFO                                                 01853000
OPENWRKA EQU   DXCCW                                                    01854000
DXSAVUCS EQU   OPENWRKA+40                                              01855000
DXIMGDCB EQU   OPENWRKA+56                                              01856000
DXSAVFCB EQU   OPENWRKA+64                                              01857000
DCBIOBAB EQU   DCBCICBA                                                 01858000
XCTLPL   EQU   DXCCW1                                                   01859000
XCTLPL01 EQU   XCTLPL                                                   01860000
XCTLPL02 EQU   XCTLPL+1                                                 01861000
XCTLPL03 EQU   XCTLPL+4                                                 01862000
XCTLPL04 EQU   XCTLPL+5                                                 01863000
DXBTAMX  EQU   DXREG1                                                   01864000
DXDSNAME EQU   DXCCW5                                                   01865000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    01866000
@NM00158 EQU   OPENWRKA+60                                              01867000
@NM00157 EQU   OPENWRKA+48                                              01868000
@NM00156 EQU   OPENWRKA                                                 01869000
@NM00155 EQU   DCBDEVIC                                                 01870000
@NM00101 EQU   FCACLOS3                                                 01871000
@NM00100 EQU   FCACLOS3                                                 01872000
@NM00099 EQU   FCACLOS3                                                 01873000
FCACIOBB EQU   FCACLOS2                                                 01874000
FCACIOBU EQU   FCACLOS2                                                 01875000
FCACIOBX EQU   FCACLOS2                                                 01876000
FCACIOBP EQU   FCACLOS2                                                 01877000
FCACDEQ  EQU   FCACLOS2                                                 01878000
FCACPURG EQU   FCACLOS2                                                 01879000
@NM00098 EQU   FCACLOS2                                                 01880000
@NM00097 EQU   FCACLOS2                                                 01881000
@NM00096 EQU   FCACLOS1                                                 01882000
FCACFCR  EQU   FCACLOS1                                                 01883000
IOBSKSS  EQU   IOBSKADR+3                                               01884000
IOBSK0   EQU   IOBSKADR+2                                               01885000
IOBSKTT  EQU   IOBSKADR+1                                               01886000
IOBSKRV  EQU   IOBSKADR                                                 01887000
IOBCSWSV EQU   IOBORG11+17                                              01888000
IOBSENSV EQU   IOBORG11+16                                              01889000
IOBRCD   EQU   IOBORG11+12                                              01890000
IOBMDREC EQU   IOBORG11+8                                               01891000
IOBNAMEA EQU   IOBNAME+1                                                01892000
IOBNAMSZ EQU   IOBNAME                                                  01893000
IOBERCTA EQU   IOBERCT+1                                                01894000
IOBRTYPE EQU   IOBUCBXV                                                 01895000
IOBRDCHP EQU   IOBORG10+20                                              01896000
IOBNEXTA EQU   IOBORG10+16                                              01897000
IOBREADA EQU   IOBORG10+12                                              01898000
IOBBUFC  EQU   IOBORG10+8                                               01899000
IOBSK2R  EQU   IOBSEEK2+7                                               01900000
IOBSK2HH EQU   IOBSEEK2+5                                               01901000
IOBSK2CC EQU   IOBSEEK2+3                                               01902000
IOBSK2BB EQU   IOBSEEK2+1                                               01903000
IOBSK2M  EQU   IOBSEEK2                                                 01904000
IOBCHNPR EQU   IOBORG09+40                                              01905000
IOBDNCRF EQU   IOBORG09+32                                              01906000
IOBRSV35 EQU   IOBORG09+24                                              01907000
IOBDQPTR EQU   IOBORG09+20                                              01908000
IOBRSV34 EQU   IOBORG09+18                                              01909000
IOBDBYTN EQU   IOBORG09+16                                              01910000
IOBDCPND EQU   IOBORG09+12                                              01911000
IOBSTAT2 EQU   IOBDSTAT+1                                               01912000
IOBSIORT EQU   IOBSTAT1                                                 01913000
IOBADDVU EQU   IOBSTAT1                                                 01914000
IOBBUFF  EQU   IOBSTAT1                                                 01915000
IOBENQUE EQU   IOBSTAT1                                                 01916000
IOBPASS2 EQU   IOBSTAT1                                                 01917000
IOBSYNCH EQU   IOBSTAT1                                                 01918000
IOBNEWVL EQU   IOBSTAT1                                                 01919000
IOBABNRM EQU   IOBSTAT1                                                 01920000
IOBRELEX EQU   IOBDTYP2                                                 01921000
IOBADDTY EQU   IOBDTYP2                                                 01922000
IOBTYPE  EQU   IOBDTYP2                                                 01923000
IOBRQUST EQU   IOBDTYP2                                                 01924000
IOBSUFFX EQU   IOBDTYP2                                                 01925000
IOBSBLKL EQU   IOBDTYP2                                                 01926000
IOBSKEY  EQU   IOBDTYP2                                                 01927000
IOBRELBL EQU   IOBDTYPE                                                 01928000
IOBRDEXC EQU   IOBDTYPE                                                 01929000
IOBDYNBF EQU   IOBDTYPE                                                 01930000
IOBACTAD EQU   IOBDTYPE                                                 01931000
IOBFDBCK EQU   IOBDTYPE                                                 01932000
IOBEXTSC EQU   IOBDTYPE                                                 01933000
IOBOVFLO EQU   IOBDTYPE                                                 01934000
IOBVERFY EQU   IOBDTYPE                                                 01935000
IOBDPLB  EQU   IOBDPLAD+1                                               01936000
IOBDAYLI EQU   IOBDPLAD                                                 01937000
IOBDIOBS EQU   IOBORG09+2                                               01938000
IOBDBYTR EQU   IOBORG09                                                 01939000
IOBBCHAD EQU   IOBORG08+12                                              01940000
IOBFCHNB EQU   IOBFCHAD+1                                               01941000
IOBCOUNT EQU   IOBFCHAD                                                 01942000
IOBASYN  EQU   IOBORG08+7                                               01943000
IOBAPP   EQU   IOBORG08+6                                               01944000
IOBRSV32 EQU   IOBUNSQR                                                 01945000
IOBRSV31 EQU   IOBUNSQR                                                 01946000
IOBRSV30 EQU   IOBUNSQR                                                 01947000
IOBKNRWR EQU   IOBUNSQR                                                 01948000
IOBKNWR  EQU   IOBUNSQR                                                 01949000
IOBNTAV2 EQU   IOBUNSQR                                                 01950000
IOBNTAV1 EQU   IOBUNSQR                                                 01951000
IOBCPBSY EQU   IOBUNSQR                                                 01952000
IOBCHNNL EQU   IOBINDCT                                                 01953000
IOBRSV29 EQU   IOBINDCT                                                 01954000
IOBRSV28 EQU   IOBINDCT                                                 01955000
IOBRSV27 EQU   IOBINDCT                                                 01956000
IOBKEYAD EQU   IOBINDCT                                                 01957000
IOBOVPTR EQU   IOBINDCT                                                 01958000
IOBUNSCH EQU   IOBINDCT                                                 01959000
IOBDEQCP EQU   IOBINDCT                                                 01960000
IOBCCWAD EQU   IOBORG08                                                 01961000
W1OEXTEN EQU   W1IEXTEN                                                 01962000
IOBCCW   EQU   IOBORG06+8                                               01963000
IOBNXTPB EQU   IOBNXTPT+1                                               01964000
IOBRSV26 EQU   IOBSTATA                                                 01965000
IOBRSV25 EQU   IOBSTATA                                                 01966000
IOBRSV24 EQU   IOBSTATA                                                 01967000
IOBRSV23 EQU   IOBSTATA                                                 01968000
IOBRSV22 EQU   IOBSTATA                                                 01969000
IOBRSV21 EQU   IOBSTATA                                                 01970000
IOBRSV20 EQU   IOBSTATA                                                 01971000
IOBAVLFL EQU   IOBSTATA                                                 01972000
IOBRSV37 EQU   IOBORG06+1                                               01973000
IOBUCBXG EQU   IOBORG06                                                 01974000
IOBCPA   EQU   IOBORG05+32                                              01975000
IOBERINF EQU   IOBORG05+16                                              01976000
IOBERCCW EQU   IOBORG05+8                                               01977000
IOBSNDPT EQU   IOBORG05+7                                               01978000
IOBRCVPT EQU   IOBORG05+6                                               01979000
IOBWORK  EQU   IOBORG05+1                                               01980000
IOBUCBX  EQU   IOBORG05                                                 01981000
IOBR     EQU   IOBSEEK+7                                                01982000
IOBHH2   EQU   IOBHH+1                                                  01983000
IOBHH1   EQU   IOBHH                                                    01984000
IOBCC2   EQU   IOBCC+1                                                  01985000
IOBCC1   EQU   IOBCC                                                    01986000
IOBBB2   EQU   IOBBB+1                                                  01987000
IOBBB1   EQU   IOBBB                                                    01988000
IOBM     EQU   IOBSEEK                                                  01989000
IOBRSV46 EQU   IOBFL4                                                   01990000
IOBRSV47 EQU   IOBFL4                                                   01991000
IOBENT   EQU   IOBFL4                                                   01992000
IOBEQP   EQU   IOBFL4                                                   01993000
IOBBUS   EQU   IOBFL4                                                   01994000
IOBDCK   EQU   IOBFL4                                                   01995000
IOBREJ   EQU   IOBFL4                                                   01996000
IOBOVR   EQU   IOBFL4                                                   01997000
IOBCRILC EQU   IOBORG04+1                                               01998000
IOBCRDCC EQU   IOBORG04                                                 01999000
IOBGQECB EQU   IOBORG03                                                 02000000
IOBSWAP  EQU   IOBORG02+4                                               02001000
IOBDQADB EQU   IOBDQADA+1                                               02002000
IOBRSV13 EQU   IOBDEQIN                                                 02003000
IOBRSV12 EQU   IOBDEQIN                                                 02004000
IOBRSV11 EQU   IOBDEQIN                                                 02005000
IOBRSV10 EQU   IOBDEQIN                                                 02006000
IOBRSV09 EQU   IOBDEQIN                                                 02007000
IOBRSV08 EQU   IOBDEQIN                                                 02008000
IOBRSV07 EQU   IOBDEQIN                                                 02009000
IOBDEQ   EQU   IOBDEQIN                                                 02010000
IOBNECB  EQU   IOBORG01+4                                               02011000
IOBFIRST EQU   IOBNFLG1                                                 02012000
IOBUPERR EQU   IOBNFLG1                                                 02013000
IOBSPAN  EQU   IOBNFLG1                                                 02014000
IOBBKSPC EQU   IOBNFLG1                                                 02015000
IOBUPDAT EQU   IOBNFLG1                                                 02016000
IOBREAD  EQU   IOBNFLG1                                                 02017000
IOBWRITE EQU   IOBNFLG1                                                 02018000
IOBSEGMT EQU   IOBPRTOV                                                 02019000
DXRESIND EQU   @NM00084                                                 02020000
DXSAVOFF EQU   @NM00083+7                                               02021000
DXSAVADR EQU   DXSAVMOD+2                                               02022000
DXSAVID  EQU   DXSAVMOD                                                 02023000
DXABCODE EQU   @NM00083                                                 02024000
DXRETCOD EQU   DXIDENT+7                                                02025000
DXRETTTR EQU   DXRETMOD+2                                               02026000
DXRETID  EQU   DXRETMOD                                                 02027000
DXCALLID EQU   DXIDENT                                                  02028000
DXREG0   EQU   DXREGSAV+24                                              02029000
DXREGE   EQU   DXREGSAV+20                                              02030000
DXREGD   EQU   DXREGSAV+16                                              02031000
DXREGC   EQU   DXREGSAV+12                                              02032000
DXREGB   EQU   DXREGSAV+8                                               02033000
DXREGA   EQU   DXREGSAV+4                                               02034000
DXREG9   EQU   DXREGSAV                                                 02035000
DXXEND   EQU   DXXAREA+48                                               02036000
DXXLAST  EQU   DXXAREA+40                                               02037000
DXXCORE  EQU   DXXENTRY+5                                               02038000
DXETTR   EQU   DXXIDTTR+2                                               02039000
DXEID    EQU   DXXIDTTR                                                 02040000
DXXPATHS EQU   DXXAREA+30                                               02041000
DXOPCLSW EQU   DXXLNG                                                   02042000
DXXTXTLN EQU   DXXAREA+27                                               02043000
DXXMODSZ EQU   DXXAREA+24                                               02044000
DXXATTRB EQU   DXXAREA+22                                               02045000
@NM00068 EQU   DXXAREA+20                                               02046000
DXXPREFX EQU   DXXAREA+16                                               02047000
@NM00067 EQU   DXXAREA+12                                               02048000
DXXMODEP EQU   DXXAREA+8                                                02049000
DXXMODID EQU   DXXMODNM+6                                               02050000
@NM00066 EQU   DXXMODNM                                                 02051000
DXXWTOPR EQU   DXXWTG                                                   02052000
@NM00062 EQU   BUFNXPTA                                                 02053000
DEBEXPTA EQU   DEBEXPT+1                                                02054000
DEBRSV12 EQU   DEBRPSID                                                 02055000
DEBRSV11 EQU   DEBRPSID                                                 02056000
DEBRSV10 EQU   DEBRPSID                                                 02057000
DEBRSV09 EQU   DEBRPSID                                                 02058000
DEBRPSAP EQU   DEBRPSID                                                 02059000
DEBRPSO  EQU   DEBRPSID                                                 02060000
DEBRPSI  EQU   DEBRPSID                                                 02061000
DEBRPSP  EQU   DEBRPSID                                                 02062000
DEBFOEB  EQU   DEBFOEAD+1                                               02063000
DEBNOEE  EQU   DEBFOEAD                                                 02064000
DEBFPEB  EQU   DEBFPEAD+1                                               02065000
DEBNPEE  EQU   DEBFPEAD                                                 02066000
DEBFIEB  EQU   DEBFIEAD+1                                               02067000
DEBNIEE  EQU   DEBFIEAD                                                 02068000
DEBBOESS EQU   DEBEODSS                                                 02069000
DEBBOE0  EQU   DEBEOD0                                                  02070000
DEBBOETT EQU   DEBEODTT                                                 02071000
DEBBOERV EQU   DEBEODRV                                                 02072000
DEBRV008 EQU   DEBDSID+7                                                02073000
DEBWTPTI EQU   DEBDSID+6                                                02074000
DEBEXDTE EQU   DEBDSID                                                  02075000
DEBRV007 EQU   DEBEAMFG                                                 02076000
DEBRV006 EQU   DEBEAMFG                                                 02077000
DEBRV005 EQU   DEBEAMFG                                                 02078000
DEBRV004 EQU   DEBEAMFG                                                 02079000
DEBSECVL EQU   DEBEAMFG                                                 02080000
DEBVAMSG EQU   DEBEAMFG                                                 02081000
DEBDSOPN EQU   DEBEAMFG                                                 02082000
DEBMULTI EQU   DEBEAMFG                                                 02083000
DEBVSEQU EQU   DEBASC09+2                                               02084000
DEBDSSQL EQU   DEBASC09+1                                               02085000
DEBVOLAC EQU   DEBASC09                                                 02086000
DEBWDCBA EQU   DEBWDCB+1                                                02087000
DEBRSV08 EQU   DEBWDCB                                                  02088000
DEBPDCBA EQU   DEBPDCB+1                                                02089000
DEBRSV07 EQU   DEBPDCB                                                  02090000
DEBRDCBA EQU   DEBRDCB+1                                                02091000
DEBRSV06 EQU   DEBRDCB                                                  02092000
DEBSUCBB EQU   DEBSUCBA+1                                               02093000
DEBSDVM  EQU   DEBSUCBA                                                 02094000
@NM00161 EQU   REG00T12                                                 02095000
REGSAV15 EQU   REG14T12+4                                               02096000
@NM00160 EQU   REGSAVAR                                                 02097000
WRKWTGT  EQU   WRKAREA+16                                               02098000
@NM00159 EQU   WRKPARML+2                                               02099000
WRKMODID EQU   WRKPARML                                                 02100000
@NM00154 EQU   SDWA+512                                                 02101000
SDWAVRA  EQU   SDWARA+4                                                 02102000
SDWAURAL EQU   SDWARA+3                                                 02103000
@NM00153 EQU   SDWADPVA                                                 02104000
SDWAEBC  EQU   SDWADPVA                                                 02105000
SDWAHEX  EQU   SDWADPVA                                                 02106000
SDWAVRAL EQU   SDWARA                                                   02107000
@NM00152 EQU   SDWA+396                                                 02108000
SDWARCPL EQU   SDWA+364                                                 02109000
@NM00151 EQU   SDWADPSA+32                                              02110000
SDWATO4  EQU   SDWADPSL+28                                              02111000
SDWAFRM4 EQU   SDWADPSL+24                                              02112000
SDWATO3  EQU   SDWADPSL+20                                              02113000
SDWAFRM3 EQU   SDWADPSL+16                                              02114000
SDWATO2  EQU   SDWADPSL+12                                              02115000
SDWAFRM2 EQU   SDWADPSL+8                                               02116000
SDWATO1  EQU   SDWADPSL+4                                               02117000
SDWAFRM1 EQU   SDWADPSL                                                 02118000
@NM00150 EQU   SDWADDAT+3                                               02119000
@NM00149 EQU   SDWAPDAT                                                 02120000
SDWAUSPL EQU   SDWAPDAT                                                 02121000
SDWADPSW EQU   SDWAPDAT                                                 02122000
SDWATJPA EQU   SDWAPDAT                                                 02123000
SDWATLPA EQU   SDWAPDAT                                                 02124000
SDWADREG EQU   SDWAPDAT                                                 02125000
SDWADSAH EQU   SDWAPDAT                                                 02126000
SDWADSAS EQU   SDWAPDAT                                                 02127000
@NM00148 EQU   SDWADDAT+1                                               02128000
@NM00147 EQU   SDWASDAT                                                 02129000
SDWAQQS  EQU   SDWASDAT                                                 02130000
SDWACBS  EQU   SDWASDAT                                                 02131000
SDWAGTF  EQU   SDWASDAT                                                 02132000
SDWASWA  EQU   SDWASDAT                                                 02133000
SDWALSQA EQU   SDWASDAT                                                 02134000
SDWASQA  EQU   SDWASDAT                                                 02135000
SDWANUC  EQU   SDWASDAT                                                 02136000
@NM00146 EQU   SDWADUMP+2                                               02137000
@NM00145 EQU   SDWADPFS                                                 02138000
SDWASLST EQU   SDWADPFS                                                 02139000
@NM00144 EQU   SDWADPFS                                                 02140000
SDWADLST EQU   SDWADPFS                                                 02141000
SDWADPT  EQU   SDWADPFS                                                 02142000
SDWADPID EQU   SDWADUMP                                                 02143000
SDWADPLA EQU   SDWA+316                                                 02144000
SDWAREXN EQU   SDWARECP+16                                              02145000
SDWACSCT EQU   SDWARECP+8                                               02146000
SDWAMODN EQU   SDWARECP                                                 02147000
@NM00143 EQU   SDWALKWA+32                                              02148000
SDWATALW EQU   SDWALKWS+28                                              02149000
SDWATDLW EQU   SDWALKWS+24                                              02150000
SDWATNLW EQU   SDWALKWS+20                                              02151000
SDWAAPLW EQU   SDWALKWS+16                                              02152000
SDWAIPLW EQU   SDWALKWS+12                                              02153000
SDWAILLW EQU   SDWALKWS+8                                               02154000
SDWAIULW EQU   SDWALKWS+4                                               02155000
SDWAICLW EQU   SDWALKWS                                                 02156000
SDWAFLLK EQU   SDWAACF4                                                 02157000
SDWACMS  EQU   SDWAACF4                                                 02158000
SDWAOPTM EQU   SDWAACF4                                                 02159000
SDWATADB EQU   SDWAACF4                                                 02160000
SDWATDNB EQU   SDWAACF4                                                 02161000
SDWATNCB EQU   SDWAACF4                                                 02162000
SDWAILCH EQU   SDWAACF4                                                 02163000
SDWAIUCB EQU   SDWAACF4                                                 02164000
SDWAICAT EQU   SDWAACF3                                                 02165000
SDWAIPRG EQU   SDWAACF3                                                 02166000
SDWASALL EQU   SDWAACF3                                                 02167000
SDWAASMP EQU   SDWAACF3                                                 02168000
SDWADISP EQU   SDWAACF3                                                 02169000
@NM00142 EQU   SDWAACF3                                                 02170000
@NM00141 EQU   SDWAACF2                                                 02171000
SDWAFREE EQU   SDWAACF2                                                 02172000
SDWAUPRG EQU   SDWAACF2                                                 02173000
@NM00140 EQU   SDWAACF2                                                 02174000
SDWASPIN EQU   SDWAACF2                                                 02175000
@NM00139 EQU   SDWAACF2                                                 02176000
SDWARCRD EQU   SDWAACF2                                                 02177000
SDWARCDE EQU   SDWAPARQ                                                 02178000
SDWALCPU EQU   SDWACPUA+2                                               02179000
@NM00138 EQU   SDWACPUA                                                 02180000
SDWARECA EQU   SDWA+244                                                 02181000
SDWARTYA EQU   SDWA+240                                                 02182000
@NM00137 EQU   SDWA+239                                                 02183000
@NM00136 EQU   SDWAIOFS                                                 02184000
SDWANIOP EQU   SDWAIOFS                                                 02185000
SDWANOIO EQU   SDWAIOFS                                                 02186000
SDWAIOHT EQU   SDWAIOFS                                                 02187000
SDWAIOQR EQU   SDWAIOFS                                                 02188000
SDWAFMID EQU   SDWA+236                                                 02189000
@NM00135 EQU   SDWAERRD                                                 02190000
SDWAMCIV EQU   SDWAERRD                                                 02191000
SDWARPIV EQU   SDWAERRD                                                 02192000
SDWAMABD EQU   SDWAERRD                                                 02193000
SDWACTS  EQU   SDWAERRD                                                 02194000
SDWASTAE EQU   SDWAERRD                                                 02195000
SDWANRBE EQU   SDWAERRD                                                 02196000
SDWACLUP EQU   SDWAERRD                                                 02197000
@NM00134 EQU   SDWAERRC                                                 02198000
SDWAEAS  EQU   SDWAERRC                                                 02199000
SDWAPERC EQU   SDWAERRC                                                 02200000
SDWAIRB  EQU   SDWAERRC                                                 02201000
SDWASTAI EQU   SDWAERRC                                                 02202000
SDWASTAF EQU   SDWAERRC                                                 02203000
SDWASRBM EQU   SDWAERRB                                                 02204000
SDWALDIS EQU   SDWAERRB                                                 02205000
SDWAENRB EQU   SDWAERRB                                                 02206000
SDWATYP1 EQU   SDWAERRB                                                 02207000
@NM00133 EQU   SDWAERRB                                                 02208000
SDWAPGIO EQU   SDWAERRA                                                 02209000
SDWATEXC EQU   SDWAERRA                                                 02210000
SDWASVCE EQU   SDWAERRA                                                 02211000
SDWAABTM EQU   SDWAERRA                                                 02212000
SDWASVCD EQU   SDWAERRA                                                 02213000
SDWARKEY EQU   SDWAERRA                                                 02214000
SDWAPCHK EQU   SDWAERRA                                                 02215000
SDWAMCHK EQU   SDWAERRA                                                 02216000
SDWATIME EQU   SDWAMCH+20                                               02217000
SDWARFSA EQU   SDWAMCH+16                                               02218000
@NM00132 EQU   SDWAMCH+14                                               02219000
SDWAVEQR EQU   SDWARSR2                                                 02220000
SDWAPGFX EQU   SDWARSR2                                                 02221000
SDWAFLSQ EQU   SDWARSR2                                                 02222000
SDWAFSQA EQU   SDWARSR2                                                 02223000
SDWANUCL EQU   SDWARSR2                                                 02224000
SDWASPER EQU   SDWARSR2                                                 02225000
SDWAINTC EQU   SDWARSR2                                                 02226000
SDWAOFLN EQU   SDWARSR2                                                 02227000
SDWACHNG EQU   SDWARSR1                                                 02228000
SDWAMSER EQU   SDWARSR1                                                 02229000
@NM00131 EQU   SDWARSR1                                                 02230000
SDWACPID EQU   SDWAMCH+10                                               02231000
SDWATERR EQU   SDWAMCHD                                                 02232000
SDWAFPRX EQU   SDWAMCHD                                                 02233000
SDWAINSF EQU   SDWAMCHD                                                 02234000
SDWAACR  EQU   SDWAMCHD                                                 02235000
SDWASCK  EQU   SDWAMCHD                                                 02236000
SDWAPSWU EQU   SDWAMCHD                                                 02237000
SDWAREGU EQU   SDWAMCHD                                                 02238000
SDWASKYF EQU   SDWAMCHD                                                 02239000
@NM00130 EQU   SDWAMCHS                                                 02240000
SDWARSRF EQU   SDWAMCHS                                                 02241000
SDWARSRC EQU   SDWAMCHS                                                 02242000
SDWAINVP EQU   SDWAMCHS                                                 02243000
SDWATSVL EQU   SDWAMCHS                                                 02244000
SDWARCDF EQU   SDWAMCHS                                                 02245000
SDWASRVL EQU   SDWAMCHS                                                 02246000
SDWASCKE EQU   SDWASTCK+4                                               02247000
SDWASCKB EQU   SDWASTCK                                                 02248000
SDWALNTH EQU   SDWAIDNT+1                                               02249000
SDWASPID EQU   SDWAIDNT                                                 02250000
SDWASR15 EQU   SDWASRSV+60                                              02251000
SDWASR14 EQU   SDWASRSV+56                                              02252000
SDWASR13 EQU   SDWASRSV+52                                              02253000
SDWASR12 EQU   SDWASRSV+48                                              02254000
SDWASR11 EQU   SDWASRSV+44                                              02255000
SDWASR10 EQU   SDWASRSV+40                                              02256000
SDWASR09 EQU   SDWASRSV+36                                              02257000
SDWASR08 EQU   SDWASRSV+32                                              02258000
SDWASR07 EQU   SDWASRSV+28                                              02259000
SDWASR06 EQU   SDWASRSV+24                                              02260000
SDWASR05 EQU   SDWASRSV+20                                              02261000
SDWASR04 EQU   SDWASRSV+16                                              02262000
SDWASR03 EQU   SDWASRSV+12                                              02263000
SDWASR02 EQU   SDWASRSV+8                                               02264000
SDWASR01 EQU   SDWASRSV+4                                               02265000
SDWASR00 EQU   SDWASRSV                                                 02266000
SDWATRN2 EQU   SDWAAEC2+4                                               02267000
SDWAIPC2 EQU   SDWAICD2                                                 02268000
SDWAIMC2 EQU   SDWAICD2                                                 02269000
SDWAIPR2 EQU   SDWAICD2                                                 02270000
@NM00129 EQU   SDWAINC2                                                 02271000
@NM00128 EQU   SDWAILC2                                                 02272000
SDWAIL2  EQU   SDWAILC2                                                 02273000
@NM00127 EQU   SDWAILC2                                                 02274000
@NM00126 EQU   SDWAAEC2                                                 02275000
SDWAADD2 EQU   SDWANXT2+1                                               02276000
@NM00125 EQU   SDWANXT2                                                 02277000
@NM00124 EQU   SDWAEC2+3                                                02278000
SDWASGN2 EQU   SDWAINT2                                                 02279000
SDWAEXP2 EQU   SDWAINT2                                                 02280000
SDWADEC2 EQU   SDWAINT2                                                 02281000
SDWAFPO2 EQU   SDWAINT2                                                 02282000
SDWACC2  EQU   SDWAINT2                                                 02283000
@NM00123 EQU   SDWAINT2                                                 02284000
SDWAPGM2 EQU   SDWAMWP2                                                 02285000
SDWAWAT2 EQU   SDWAMWP2                                                 02286000
SDWAMCK2 EQU   SDWAMWP2                                                 02287000
SDWAECT2 EQU   SDWAMWP2                                                 02288000
SDWAKEY2 EQU   SDWAMWP2                                                 02289000
SDWAEXT2 EQU   SDWAEMK2                                                 02290000
SDWAIO2  EQU   SDWAEMK2                                                 02291000
SDWATRM2 EQU   SDWAEMK2                                                 02292000
@NM00122 EQU   SDWAEMK2                                                 02293000
SDWAPER2 EQU   SDWAEMK2                                                 02294000
@NM00121 EQU   SDWAEMK2                                                 02295000
SDWATRAN EQU   SDWAAEC1+4                                               02296000
SDWAIPC1 EQU   SDWAICD1                                                 02297000
SDWAIMC1 EQU   SDWAICD1                                                 02298000
SDWAIPR1 EQU   SDWAICD1                                                 02299000
@NM00120 EQU   SDWAINC1                                                 02300000
@NM00119 EQU   SDWAILC1                                                 02301000
SDWAIL1  EQU   SDWAILC1                                                 02302000
@NM00118 EQU   SDWAILC1                                                 02303000
@NM00117 EQU   SDWAAEC1                                                 02304000
SDWAADD1 EQU   SDWANXT1+1                                               02305000
@NM00116 EQU   SDWANXT1                                                 02306000
@NM00115 EQU   SDWAEC1+3                                                02307000
SDWASGN1 EQU   SDWAINT1                                                 02308000
SDWAEXP1 EQU   SDWAINT1                                                 02309000
SDWADEC1 EQU   SDWAINT1                                                 02310000
SDWAFPO1 EQU   SDWAINT1                                                 02311000
SDWACC1  EQU   SDWAINT1                                                 02312000
@NM00114 EQU   SDWAINT1                                                 02313000
SDWAPGM1 EQU   SDWAMWP1                                                 02314000
SDWAWAT1 EQU   SDWAMWP1                                                 02315000
SDWAMCK1 EQU   SDWAMWP1                                                 02316000
SDWAECT1 EQU   SDWAMWP1                                                 02317000
SDWAKEY1 EQU   SDWAMWP1                                                 02318000
SDWAEXT1 EQU   SDWAEMK1                                                 02319000
SDWAIO1  EQU   SDWAEMK1                                                 02320000
SDWATRM1 EQU   SDWAEMK1                                                 02321000
@NM00113 EQU   SDWAEMK1                                                 02322000
SDWAPER1 EQU   SDWAEMK1                                                 02323000
@NM00112 EQU   SDWAEMK1                                                 02324000
SDWAIOBR EQU   SDWA+100                                                 02325000
SDWAEPA  EQU   SDWA+96                                                  02326000
@NM00111 EQU   SDWANAME+4                                               02327000
SDWARBAD EQU   SDWANAME                                                 02328000
SDWAGR15 EQU   SDWAGRSV+60                                              02329000
SDWAGR14 EQU   SDWAGRSV+56                                              02330000
SDWAGR13 EQU   SDWAGRSV+52                                              02331000
SDWAGR12 EQU   SDWAGRSV+48                                              02332000
SDWAGR11 EQU   SDWAGRSV+44                                              02333000
SDWAGR10 EQU   SDWAGRSV+40                                              02334000
SDWAGR09 EQU   SDWAGRSV+36                                              02335000
SDWAGR08 EQU   SDWAGRSV+32                                              02336000
SDWAGR07 EQU   SDWAGRSV+28                                              02337000
SDWAGR06 EQU   SDWAGRSV+24                                              02338000
SDWAGR05 EQU   SDWAGRSV+20                                              02339000
SDWAGR04 EQU   SDWAGRSV+16                                              02340000
SDWAGR03 EQU   SDWAGRSV+12                                              02341000
SDWAGR02 EQU   SDWAGRSV+8                                               02342000
SDWAGR01 EQU   SDWAGRSV+4                                               02343000
SDWAGR00 EQU   SDWAGRSV                                                 02344000
SDWANXTP EQU   SDWACTL2+5                                               02345000
SDWASGP  EQU   SDWAPMKP                                                 02346000
SDWAEUP  EQU   SDWAPMKP                                                 02347000
SDWADOP  EQU   SDWAPMKP                                                 02348000
SDWAFPP  EQU   SDWAPMKP                                                 02349000
SDWACCP  EQU   SDWAPMKP                                                 02350000
SDWAILP  EQU   SDWAPMKP                                                 02351000
SDWAINTP EQU   SDWACTL2+2                                               02352000
SDWASPVP EQU   SDWAMWPP                                                 02353000
SDWAWATP EQU   SDWAMWPP                                                 02354000
SDWAMCKP EQU   SDWAMWPP                                                 02355000
@NM00110 EQU   SDWAMWPP                                                 02356000
SDWAKEYP EQU   SDWAMWPP                                                 02357000
SDWAEXTP EQU   SDWACMKP                                                 02358000
SDWAIOP  EQU   SDWACMKP                                                 02359000
SDWANXTA EQU   SDWACTL1+5                                               02360000
SDWASGA  EQU   SDWAPMKA                                                 02361000
SDWAEUA  EQU   SDWAPMKA                                                 02362000
SDWADOA  EQU   SDWAPMKA                                                 02363000
SDWAFPA  EQU   SDWAPMKA                                                 02364000
SDWACCA  EQU   SDWAPMKA                                                 02365000
SDWAILA  EQU   SDWAPMKA                                                 02366000
SDWAINTA EQU   SDWACTL1+2                                               02367000
SDWASPVA EQU   SDWAMWPA                                                 02368000
SDWAWATA EQU   SDWAMWPA                                                 02369000
SDWAMCKA EQU   SDWAMWPA                                                 02370000
@NM00109 EQU   SDWAMWPA                                                 02371000
SDWAKEYA EQU   SDWAMWPA                                                 02372000
SDWAEXTA EQU   SDWACMKA                                                 02373000
SDWAIOA  EQU   SDWACMKA                                                 02374000
SDWACMPC EQU   SDWAABCC+1                                               02375000
@NM00108 EQU   SDWACMPF                                                 02376000
SDWASTCC EQU   SDWACMPF                                                 02377000
@NM00107 EQU   SDWACMPF                                                 02378000
SDWASTEP EQU   SDWACMPF                                                 02379000
SDWAREQ  EQU   SDWACMPF                                                 02380000
SDWAPARM EQU   SDWA                                                     02381000
@NM00106 EQU   CRSIECNT+8                                               02382000
CRSFCXRC EQU   CRSIECNT+3                                               02383000
@NM00105 EQU   CRSIECDA                                                 02384000
CRSEOFM  EQU   CRSIECDA                                                 02385000
CRSDSCB  EQU   CRSIECDA                                                 02386000
CRSNSL   EQU   CRSIECTP                                                 02387000
CRSDISP  EQU   CRSIECTP                                                 02388000
CRSEOF2T EQU   CRSIECTP                                                 02389000
CRSEOF1T EQU   CRSIECTP                                                 02390000
CRSEOF2  EQU   CRSIECTP                                                 02391000
CRSEOF1  EQU   CRSIECTP                                                 02392000
CRSTM2AD EQU   CRSIECTP                                                 02393000
CRSTMAD  EQU   CRSIECTP                                                 02394000
CRSREOPN EQU   CRSIECFC                                                 02395000
@NM00104 EQU   CRSIECFC                                                 02396000
CRSFCCOM EQU   CRSIECFC                                                 02397000
CRSFCINC EQU   CRSIECFC                                                 02398000
CRSOPMOD EQU   CRSIECFC                                                 02399000
CRSFCAT  EQU   CRSIECFC                                                 02400000
CRSLAST  EQU   CRSIECFC                                                 02401000
@NM00103 EQU   CRSIECBS+1                                               02402000
CRSIECFN EQU   CRSIECBS                                                 02403000
@NM00102 EQU   CRSIECHD+8                                               02404000
CRSIECKY EQU   CRSIECHD+7                                               02405000
CRSIECSP EQU   CRSIECHD+6                                               02406000
CRSIECLN EQU   CRSIECHD+4                                               02407000
CRSIECMM EQU   CRSIECHD+3                                               02408000
CRSIECID EQU   CRSIECHD                                                 02409000
SWATTR   EQU   SWACB+8                                                  02410000
SWACBPTR EQU   SWACB                                                    02411000
RDXUQND  EQU   RDXENTRY+12                                              02412000
RDXIOBUQ EQU   RDXENTRY+8                                               02413000
RDXNQARG EQU   RDXENTRY                                                 02414000
RDXENT   EQU   RDXLIST+8                                                02415000
RDXNEXT  EQU   RDXLIST+4                                                02416000
RDXRSV01 EQU   RDXLIST                                                  02417000
IOBERRCT EQU   IOBSTDRD+30                                              02418000
IOBRSV19 EQU   IOBINCAM+1                                               02419000
IOBOLTST EQU   IOBBTAMF                                                 02420000
IOBRFTMG EQU   IOBBTAMF                                                 02421000
IOBRSV17 EQU   IOBBTAMF                                                 02422000
IOBRSV16 EQU   IOBBTAMF                                                 02423000
IOBRSV15 EQU   IOBBTAMF                                                 02424000
IOBRSV14 EQU   IOBBTAMF                                                 02425000
IOBINUSE EQU   IOBBTAMF                                                 02426000
IOBPRMER EQU   IOBBTAMF                                                 02427000
IOBRSTRB EQU   IOBRESTR+1                                               02428000
IOBREPOS EQU   IOBRESTR                                                 02429000
IOBDCBPB EQU   IOBDCBPT+1                                               02430000
IOBRSV44 EQU   IOBFLAG4                                                 02431000
IOBJES3I EQU   IOBFLAG4                                                 02432000
IOBRSV42 EQU   IOBFLAG4                                                 02433000
IOBRSV41 EQU   IOBFLAG4                                                 02434000
IOBRSV40 EQU   IOBFLAG4                                                 02435000
IOBPMERR EQU   IOBFLAG4                                                 02436000
IOBCC3WE EQU   IOBFLAG4                                                 02437000
IOBGDPOL EQU   IOBFLAG4                                                 02438000
IOBSTRTB EQU   IOBSTART+1                                               02439000
IOBSIOCC EQU   IOBSTART                                                 02440000
IOBCSB7  EQU   IOBCSTAT                                                 02441000
IOBCSB6  EQU   IOBCSTAT                                                 02442000
IOBCSB5  EQU   IOBCSTAT                                                 02443000
IOBCSB4  EQU   IOBCSTAT                                                 02444000
IOBCSB3  EQU   IOBCSTAT                                                 02445000
IOBCSB2  EQU   IOBCSTAT                                                 02446000
IOBCSB1  EQU   IOBCSTAT                                                 02447000
IOBCSB0  EQU   IOBCSTAT                                                 02448000
IOBUSB7  EQU   IOBUSTAT                                                 02449000
IOBUSB6  EQU   IOBUSTAT                                                 02450000
IOBUSB5  EQU   IOBUSTAT                                                 02451000
IOBUSB4  EQU   IOBUSTAT                                                 02452000
IOBUSB3  EQU   IOBUSTAT                                                 02453000
IOBUSB2  EQU   IOBUSTAT                                                 02454000
IOBUSB1  EQU   IOBUSTAT                                                 02455000
IOBUSB0  EQU   IOBUSTAT                                                 02456000
IOBCMDA  EQU   IOBIOCSW                                                 02457000
IOBLOG   EQU   IOBFL3                                                   02458000
IOBJAM   EQU   IOBICL                                                   02459000
IOBMSG   EQU   IOBFL3                                                   02460000
IOBSDR   EQU   IOBCNC                                                   02461000
IOBACU   EQU   IOBFL3                                                   02462000
IOBCDC   EQU   IOBFL3                                                   02463000
IOBICC   EQU   IOBFL3                                                   02464000
IOBCCC   EQU   IOBFL3                                                   02465000
IOBECBPB EQU   IOBECBPT+1                                               02466000
IOBECBCC EQU   IOBECBPT                                                 02467000
IOBS1B7  EQU   IOBSENS1                                                 02468000
IOBS1B6  EQU   IOBSENS1                                                 02469000
IOBS1B5  EQU   IOBSENS1                                                 02470000
IOBS1B4  EQU   IOBSENS1                                                 02471000
IOBS1B3  EQU   IOBSENS1                                                 02472000
IOBS1B2  EQU   IOBSENS1                                                 02473000
IOBS1B1  EQU   IOBSENS1                                                 02474000
IOBS1B0  EQU   IOBSENS1                                                 02475000
IOBSNSC9 EQU   IOBS0B7                                                  02476000
IOBS0B6  EQU   IOBSENS0                                                 02477000
IOBS0B5  EQU   IOBSENS0                                                 02478000
IOBS0B4  EQU   IOBSENS0                                                 02479000
IOBS0B3  EQU   IOBSENS0                                                 02480000
IOBS0B2  EQU   IOBSENS0                                                 02481000
IOBS0B1  EQU   IOBSENS0                                                 02482000
IOBS0B0  EQU   IOBSENS0                                                 02483000
IOBPNCH  EQU   IOBFLAG2                                                 02484000
IOBSTATO EQU   IOBFLAG2                                                 02485000
IOBSKUPD EQU   IOBFLAG2                                                 02486000
IOBALTTR EQU   IOBFLAG2                                                 02487000
IOBRRT2  EQU   IOBRDHA0                                                 02488000
IOBRRT3  EQU   IOBPURGE                                                 02489000
IOBSENSE EQU   IOBFLAG2                                                 02490000
IOBHALT  EQU   IOBFLAG2                                                 02491000
IOBSPSVC EQU   IOBRSTRT                                                 02492000
IOBUNREL EQU   IOBFLAG1                                                 02493000
IOBIOERR EQU   IOBFLAG1                                                 02494000
IOBFCREX EQU   IOBCYCCK                                                 02495000
IOBRPSTN EQU   IOBFLAG1                                                 02496000
IOBERRTN EQU   IOBFLAG1                                                 02497000
IOBCMDCH EQU   IOBFLAG1                                                 02498000
IOBDATCH EQU   IOBFLAG1                                                 02499000
IOBCNOPA EQU   IOBPREFX+12                                              02500000
IOBCICB  EQU   IOBPREFX+8                                               02501000
IOBCECB  EQU   IOBPREFX+4                                               02502000
IOBCONOP EQU   IOBPREFX+3                                               02503000
IOBCINOP EQU   IOBPREFX+2                                               02504000
IOBRSV05 EQU   IOBPREFX+1                                               02505000
IOBPCI   EQU   IOBCFLG1                                                 02506000
IOBRSTCH EQU   IOBCFLG1                                                 02507000
IOBABAPP EQU   IOBCFLG1                                                 02508000
IOBPTST  EQU   IOBCFLG1                                                 02509000
IOBRSV04 EQU   IOBCFLG1                                                 02510000
IOBRSV03 EQU   IOBCFLG1                                                 02511000
IOBRSV02 EQU   IOBCFLG1                                                 02512000
IOBRSV01 EQU   IOBCFLG1                                                 02513000
DXATEXB2 EQU   DXATEXC2                                                 02514000
DXEXHASP EQU   DXATEXB1                                                 02515000
DXATCOM3 EQU   FORCORE+596                                              02516000
@NM00095 EQU   DXATCOM2+3                                               02517000
@NM00094 EQU   DXATALL                                                  02518000
DXATSWAP EQU   DXATALL                                                  02519000
DXATFC   EQU   DXATALL                                                  02520000
@NM00093 EQU   DXATOPEN                                                 02521000
DXATDFIN EQU   DXATOPEN                                                 02522000
DXATDSIN EQU   DXATOPEN                                                 02523000
DXATMODM EQU   DXATOPEN                                                 02524000
DXATMODE EQU   DXATOPEN                                                 02525000
DXATMODS EQU   DXATOPEN                                                 02526000
DXATIGN  EQU   DXATOPEN                                                 02527000
DXATVCAT EQU   DXATEOV                                                  02528000
DXATDADM EQU   DXATEOV                                                  02529000
DXATREMT EQU   DXATEOV                                                  02530000
DXATDNEW EQU   DXATEOV                                                  02531000
DXATDFRE EQU   DXATEOV                                                  02532000
DXATDCHN EQU   DXATEOV                                                  02533000
DXATNVOL EQU   DXATEOV                                                  02534000
DXATCCAT EQU   DXATEOV                                                  02535000
DXATRDDB EQU   DXATDACC                                                 02536000
DXATEOF  EQU   DXATDACC                                                 02537000
@NM00092 EQU   DXATDACC                                                 02538000
DXATSMF  EQU   DXATDACC                                                 02539000
DXATUPDB EQU   DXATDACC                                                 02540000
DXATDRCT EQU   DXATDACC                                                 02541000
DXATTRAK EQU   DXATDACC                                                 02542000
DXATF1CE EQU   DXATDACC                                                 02543000
DXATNSL  EQU   DXATOUTA                                                 02544000
DXATTTM2 EQU   DXATOUTA                                                 02545000
DXATTTM1 EQU   DXATOUTA                                                 02546000
DXATTRL2 EQU   DXATOUTA                                                 02547000
DXATTRL1 EQU   DXATOUTA                                                 02548000
DXATDATM EQU   DXATOUTA                                                 02549000
DXATHDTM EQU   DXATOUTA                                                 02550000
DXATVLHD EQU   DXATOUTA                                                 02551000
DXATCLOS EQU   DXATCOM1+1                                               02552000
DXATSRET EQU   DXATGENS                                                 02553000
DXATVCIG EQU   DXATVGIV                                                 02554000
DXATVTMG EQU   DXATVGIV                                                 02555000
DXATVSMG EQU   DXATVGIV                                                 02556000
DXATJFCB EQU   DXATGENS                                                 02557000
DXATDISP EQU   DXATGENS                                                 02558000
DXATREFR EQU   DXATGENS                                                 02559000
DXATDMCT EQU   DXATGENS                                                 02560000
DXPRPARC EQU   FORCORE+580                                              02561000
DXUDCBML EQU   FORCORE+578                                              02562000
DXUDCBPL EQU   FORCORE+576                                              02563000
DXPACBAD EQU   DXPDCBAD+1                                               02564000
@NM00091 EQU   DXPDCBAD                                                 02565000
DXUACBAD EQU   DXUDCBAD+1                                               02566000
@NM00090 EQU   DXUDCBAD                                                 02567000
DXUCBSVV EQU   DXUCBSAV+1                                               02568000
@NM00089 EQU   DXUCBSAV                                                 02569000
DXUCBADR EQU   FORCORE+560                                              02570000
DXTIOTAD EQU   FORCORE+556                                              02571000
DXDSAB   EQU   FORCORE+548                                              02572000
DXDSABAD EQU   FORCORE+544                                              02573000
DXDSABQD EQU   FORCORE+540                                              02574000
DXJSCBAD EQU   FORCORE+536                                              02575000
DXTCBADR EQU   FORCORE+532                                              02576000
DXASCBAD EQU   FORCORE+528                                              02577000
DXEXTSW  EQU   FORCORE+527                                              02578000
DXWKEYSV EQU   FORCORE+525                                              02579000
DXUNITOF EQU   FORCORE+522                                              02580000
DXNOUNIT EQU   FORCORE+520                                              02581000
DXVOLSEQ EQU   FORCORE+518                                              02582000
DXVOLMT3 EQU   DXVOLSR3                                                 02583000
DXVOLMT2 EQU   DXVOLSR2                                                 02584000
DXVOLMT1 EQU   DXVOLSR1                                                 02585000
DXWORK4  EQU   FORCORE+496                                              02586000
DXWORK3  EQU   FORCORE+492                                              02587000
DXWORK2  EQU   FORCORE+488                                              02588000
DXWORK1  EQU   FORCORE+484                                              02589000
DXWORK   EQU   FORCORE+480                                              02590000
@NM00088 EQU   FORCORE+464                                              02591000
DXCCW11  EQU   DXCCW+80                                                 02592000
DXCCW10  EQU   DXCCW+72                                                 02593000
DXCCW9   EQU   DXCCW+64                                                 02594000
DXCCW7   EQU   DXCCW+48                                                 02595000
DXCCW6   EQU   DXCCW+40                                                 02596000
DXCCW4   EQU   DXCCW+24                                                 02597000
DXCCW3   EQU   DXCCW+16                                                 02598000
DXCCW2   EQU   DXCCW+8                                                  02599000
DXDCBDEB EQU   DXDCB+44                                                 02600000
@NM00087 EQU   DXDCB+24                                                 02601000
DXDEBDCB EQU   DXDCB+20                                                 02602000
@NM00086 EQU   DXDCB                                                    02603000
DXDEB    EQU   DXDAADDR+4                                               02604000
@NM00085 EQU   DXDAADDR                                                 02605000
DXIOB    EQU   FORCORE+280                                              02606000
DXECB    EQU   FORCORE+276                                              02607000
DXJBF    EQU   FORCORE+100                                              02608000
DSCCORE  EQU   FORCORE+96                                               02609000
DXLBL    EQU   DXDSCB                                                   02610000
APPNAMID EQU   APPNMTBL+24                                              02611000
APPOFFST EQU   APPENTRY+2                                               02612000
APPCOUNT EQU   APPENTRY                                                 02613000
APPSIZE  EQU   APPNMTBL+2                                               02614000
APPBAL   EQU   APPNMTBL                                                 02615000
WTGCORE  EQU   WTGENTRY+5                                               02616000
WTGETTR  EQU   WTGIDTTR+2                                               02617000
WTGEID   EQU   WTGIDTTR                                                 02618000
WTGOPD   EQU   WTGPATHS+1                                               02619000
WTGRECHK EQU   WTGPATHS+1                                               02620000
WTGTSENQ EQU   WTGPATHS+1                                               02621000
@NM00082 EQU   WTGPATHS+1                                               02622000
WTGTRACE EQU   WTGPATHS+1                                               02623000
@NM00081 EQU   WTGPATHS                                                 02624000
WTGJFCBW EQU   WTGPATHS                                                 02625000
WTGSMF   EQU   WTGPATHS                                                 02626000
WTGTCOS  EQU   WTGPATHS                                                 02627000
WTGNSL   EQU   WTGPATHS                                                 02628000
WTGPRLSE EQU   WTGPATHS                                                 02629000
WTGLNG   EQU   WTG+29                                                   02630000
WTGTXTLN EQU   WTGAREA+27                                               02631000
WTGMODSZ EQU   WTGAREA+24                                               02632000
WTGATTRB EQU   WTGAREA+22                                               02633000
@NM00080 EQU   WTGAREA+20                                               02634000
@NM00079 EQU   WTGAREA+12                                               02635000
WTGMODEP EQU   WTGAREA+8                                                02636000
@NM00078 EQU   WTGMODNM                                                 02637000
DSMADTW6 EQU   DSMADTRL+20                                              02638000
DSMADTW5 EQU   DSMADTRL+16                                              02639000
DSMADTW4 EQU   DSMADTRL+12                                              02640000
DSMADTW3 EQU   DSMADTRL+8                                               02641000
DSMADTW2 EQU   DSMADTRL+4                                               02642000
DSMADTB4 EQU   DSMADTW1+3                                               02643000
DSMADTB3 EQU   DSMADTW1+2                                               02644000
@NM00077 EQU   DSMADTB2                                                 02645000
DSMDSNE  EQU   DSMADTB2                                                 02646000
DSMTIOTE EQU   DSMADTB2                                                 02647000
DSMSMCE  EQU   DSMADTB2                                                 02648000
DSMVTOCR EQU   DSMADTB2                                                 02649000
DSMASWAP EQU   DSMADTB1                                                 02650000
DSMUCBAL EQU   DSMADTB1                                                 02651000
DSMRPSAP EQU   DSMADTB1                                                 02652000
DSMLOCK  EQU   DSMADTB1                                                 02653000
@NM00076 EQU   DSMADTB1                                                 02654000
DSMVIO   EQU   DSMADTB1                                                 02655000
DSMISAM  EQU   DSMADTB1                                                 02656000
RRFWORK  EQU   RRPLIST+20                                               02657000
RRMLRTRY EQU   RRPLIST+16                                               02658000
RRUCBPTR EQU   RRXRETRY                                                 02659000
RR1RETRY EQU   RRPLIST+8                                                02660000
RR1WRKAR EQU   RRPLIST+4                                                02661000
@NM00075 EQU   RRFLAGS3                                                 02662000
RRFTERM  EQU   RRFLAGS3                                                 02663000
RRFFCEXC EQU   RRFLAGS3                                                 02664000
RRFFINFC EQU   RRFLAGS3                                                 02665000
RRFNRTCA EQU   RRFLAGS3                                                 02666000
@NM00074 EQU   RRFLAGS3                                                 02667000
RRFENQUL EQU   RRFLAGS2                                                 02668000
RRFPRDET EQU   RRFLAGS2                                                 02669000
@NM00073 EQU   RRFLAGS2                                                 02670000
RRFQMNGR EQU   RRFLAGS2                                                 02671000
RRFENQPW EQU   RRFLAGS2                                                 02672000
@NM00072 EQU   RRFLAGS2                                                 02673000
RRFFIN1  EQU   RRFLAGS2                                                 02674000
RRFTRACE EQU   RRFLAGS1                                                 02675000
RRFSMF   EQU   RRFLAGS1                                                 02676000
RRFNSL   EQU   RRFLAGS1                                                 02677000
RRFAMSTR EQU   RRFLAGS1                                                 02678000
RRFAMEXR EQU   RRFLAGS1                                                 02679000
RRFAMEXG EQU   RRFLAGS1                                                 02680000
RRFUSREX EQU   RRFLAGS1                                                 02681000
@NM00071 EQU   RRFLAGS1                                                 02682000
RRFRJFCB EQU   RRFUNCTN                                                 02683000
RRFDADSM EQU   RRFUNCTN                                                 02684000
DXDCBLST EQU   USERPRML                                                 02685000
RWALIST  EQU   RWARESWA+12                                              02686000
RWAPARM  EQU   RWAPREFX+8                                               02687000
RWATRBUF EQU   RWAPREFX+4                                               02688000
RWATRACE EQU   RWAPREFX                                                 02689000
IECQMNGR EQU   IECEXTPR+92                                              02690000
IECMSGQA EQU   IECEXTPR+88                                              02691000
IECDCBNO EQU   IECUPRML                                                 02692000
IECRRPRM EQU   IECEXTPR+76                                              02693000
IECWTGTB EQU   IECEXTPR+72                                              02694000
IECREGSV EQU   IECEXTPR                                                 02695000
IECCORP2 EQU   IECPREFX+28                                              02696000
IECCORP1 EQU   IECPREFX+24                                              02697000
IECCORPS EQU   IECPREFX+20                                              02698000
IECCORSP EQU   IECPREFX+19                                              02699000
@NM00070 EQU   IECPREFX+17                                              02700000
IECCORKY EQU   IECPREFX+16                                              02701000
IECCORAD EQU   IECPREFX+12                                              02702000
IECCORLN EQU   IECPREFX+8                                               02703000
@NM00069 EQU   IECPREFX+4                                               02704000
IECCORID EQU   IECPREFX                                                 02705000
@NM00065 EQU   USL+20                                                   02706000
USLSLOT1 EQU   USL+16                                                   02707000
USLCHAIN EQU   USL+12                                                   02708000
USLIOB2  EQU   USLBFRQB+1                                               02709000
@NM00064 EQU   USLBFRQB                                                 02710000
USLIOB1  EQU   USLBFRQT+1                                               02711000
USLFLAGS EQU   USLBFRQT                                                 02712000
@NM00063 EQU   USL+2                                                    02713000
USLSIZE  EQU   USL                                                      02714000
BCBNXBUF EQU   BCBDEFS                                                  02715000
BCBTBRS  EQU   BCBDEFR+12                                               02716000
BCBNABFR EQU   BCBDEFR+8                                                02717000
BCBFRQB  EQU   BCBIOBS+4                                                02718000
BCBFRQT  EQU   BCBIOBS                                                  02719000
BCBRAOFS EQU   BCBDEFV+9                                                02720000
BCBBFAVL EQU   BCBDEFV+8                                                02721000
BCBBUFL  EQU   BCBDEFV+4                                                02722000
BCBBUF1  EQU   BCBDEFV                                                  02723000
LRIDATA  EQU   LRIALIGN                                                 02724000
@NM00061 EQU   LRIAREA+22                                               02725000
LRICOUNT EQU   LRIAREA+20                                               02726000
LRINXIOB EQU   LRINIOB+1                                                02727000
@NM00060 EQU   LRINIOB                                                  02728000
LRIRECAD EQU   LRITRKAD+5                                               02729000
LRIMBBCC EQU   LRITRKAD                                                 02730000
LRIPOS   EQU   LRILOC+6                                                 02731000
LRIINDEX EQU   LRILOC+5                                                 02732000
LRIASSEM EQU   LRIFLG2                                                  02733000
@NM00059 EQU   LRIFLG2                                                  02734000
LRINTSPN EQU   LRIFLG2                                                  02735000
@NM00058 EQU   LRIFLG2                                                  02736000
LRISEG   EQU   LRIFLG2                                                  02737000
@NM00057 EQU   LRIFLG2                                                  02738000
LRIRELSE EQU   LRIFLG2                                                  02739000
@NM00056 EQU   LRIFLG2                                                  02740000
LRIEOB   EQU   LRIFLG1                                                  02741000
LRICOD   EQU   LRIFLG1                                                  02742000
LRIEOD   EQU   LRIFLG1                                                  02743000
BCBPAD   EQU   BCBLK+12                                                 02744000
@NM00055 EQU   BCBLRIAR                                                 02745000
BCBEXTND EQU   BCBFLGS                                                  02746000
BCBLRI   EQU   BCBFLGS                                                  02747000
@NM00054 EQU   BCBBUFPT                                                 02748000
DEBXRV40 EQU   DEBXTN+28                                                02749000
DEBXOPNJ EQU   DEBXTN+24                                                02750000
DEBXMCF2 EQU   DEBXTN+19                                                02751000
DEBXMCF1 EQU   DEBXTN+18                                                02752000
DEBXDSO2 EQU   DEBXTN+17                                                02753000
DEBXDSO1 EQU   DEBXTN+16                                                02754000
DEBXDBPR EQU   DEBXTN+12                                                02755000
DEBXDCBM EQU   DEBXTN+8                                                 02756000
DEBXDSAB EQU   DEBXTN+4                                                 02757000
DEBXRV48 EQU   DEBXTN+3                                                 02758000
DEBXRV47 EQU   DEBXFLG1                                                 02759000
DEBXRV46 EQU   DEBXFLG1                                                 02760000
DEBXRV45 EQU   DEBXFLG1                                                 02761000
DEBXRV44 EQU   DEBXFLG1                                                 02762000
DEBXRV43 EQU   DEBXFLG1                                                 02763000
DEBXDSSI EQU   DEBXFLG1                                                 02764000
DEBXTSKC EQU   DEBXFLG1                                                 02765000
DEBXCDCB EQU   DEBXFLG1                                                 02766000
DEBXLNGH EQU   DEBXTN                                                   02767000
DEBTBLOF EQU   DEBPREFX+14                                              02768000
DEBAMTYP EQU   DEBPREFX+13                                              02769000
DEBLNGTH EQU   DEBPREFX+12                                              02770000
DEBDCBMK EQU   DEBXTNP                                                  02771000
DEBDSCBA EQU   DEBPREFX+1                                               02772000
DEBWKARA EQU   DEBPREFX                                                 02773000
DEBXCEAD EQU   DEBXCEA+1                                                02774000
DEBXCENP EQU   DEBXCEAB                                                 02775000
DEBRSV35 EQU   DEBXCEAB                                                 02776000
DEBRSV34 EQU   DEBXCEAB                                                 02777000
DEBRSV33 EQU   DEBXCEAB                                                 02778000
DEBRSV32 EQU   DEBXCEAB                                                 02779000
DEBCEAD  EQU   DEBCEA+1                                                 02780000
DEBCENP  EQU   DEBCEAB                                                  02781000
DEBRSV31 EQU   DEBCEAB                                                  02782000
DEBRSV30 EQU   DEBCEAB                                                  02783000
DEBRSV29 EQU   DEBCEAB                                                  02784000
DEBRSV28 EQU   DEBCEAB                                                  02785000
DEBPCIAD EQU   DEBPCIA+1                                                02786000
DEBPCINP EQU   DEBPCIAB                                                 02787000
DEBRSV27 EQU   DEBPCIAB                                                 02788000
DEBRSV26 EQU   DEBPCIAB                                                 02789000
DEBRSV25 EQU   DEBPCIAB                                                 02790000
DEBRSV24 EQU   DEBPCIAB                                                 02791000
DEBSIOAD EQU   DEBSIOA+1                                                02792000
DEBSIONP EQU   DEBSIOAB                                                 02793000
DEBFIX   EQU   DEBSIOAB                                                 02794000
DEBIOVR  EQU   DEBSIOAB                                                 02795000
DEBSIOX  EQU   DEBSIOAB                                                 02796000
DEBPGFX  EQU   DEBSIOAB                                                 02797000
DEBEOEAD EQU   DEBEOEA+1                                                02798000
DEBEOENP EQU   DEBEOEAB                                                 02799000
DEBRSV22 EQU   DEBEOEAB                                                 02800000
DEBRSV21 EQU   DEBEOEAB                                                 02801000
DEBRSV20 EQU   DEBEOEAB                                                 02802000
DEBRSV19 EQU   DEBEOEAB                                                 02803000
DEBSUBID EQU   DEBSUBNM                                                 02804000
DEBSIOA2 EQU   DEBACS08+24                                              02805000
DEBRPSIO EQU   DEBACS08+20                                              02806000
DEBFREED EQU   DEBACS08+16                                              02807000
@NM00053 EQU   DEBACS08+12                                              02808000
@NM00052 EQU   DEBACS08+8                                               02809000
DEBDISAD EQU   DEBACS08+4                                               02810000
@NM00051 EQU   DEBACS08                                                 02811000
DEBRPSST EQU   DEBACS07+64                                              02812000
DEBARECK EQU   DEBACS07+60                                              02813000
DEBAREWT EQU   DEBACS07+56                                              02814000
DEBACHK  EQU   DEBACS07+52                                              02815000
DEBAWRIT EQU   DEBACS07+48                                              02816000
DEBASETL EQU   DEBACS07+44                                              02817000
DEBAREAD EQU   DEBACS07+40                                              02818000
DEBCRECK EQU   DEBACS07+36                                              02819000
DEBCREWT EQU   DEBACS07+32                                              02820000
DEBCCHK  EQU   DEBACS07+28                                              02821000
DEBCWRIT EQU   DEBACS07+24                                              02822000
DEBCSETL EQU   DEBACS07+20                                              02823000
DEBCREAD EQU   DEBACS07+16                                              02824000
DEBWKPT5 EQU   DEBACS07+12                                              02825000
DEBWKPT4 EQU   DEBACS07+8                                               02826000
DEBGET   EQU   DEBACS07+4                                               02827000
@NM00050 EQU   DEBACS07                                                 02828000
DEBPUT   EQU   DEBACS06+4                                               02829000
DEBDCBFA EQU   DEBACS06                                                 02830000
DEBLUCBB EQU   DEBLUCBA+1                                               02831000
DEBRSV18 EQU   DEBLUCBA                                                 02832000
DEBFUCBB EQU   DEBFUCBA+1                                               02833000
DEBRSV17 EQU   DEBFUCBA                                                 02834000
DEBTCCWB EQU   DEBTCCWA+1                                               02835000
DEBRSV16 EQU   DEBTCCWA                                                 02836000
DEBTBFRB EQU   DEBTBFRA+1                                               02837000
DEBRSV15 EQU   DEBTBFRA                                                 02838000
DEBDBPEF EQU   DEBACS03+8                                               02839000
DEBDBPP  EQU   DEBACS03+4                                               02840000
DEBDTPP  EQU   DEBACS03                                                 02841000
DEBDBPE  EQU   DEBDBLK+1                                                02842000
DEBDBPT  EQU   DEBDBLK                                                  02843000
DEBEXTNM EQU   DEBDSNAM                                                 02844000
DEBLRECL EQU   DEBACSMD+14                                              02845000
DEBBLKSI EQU   DEBACSMD+12                                              02846000
DEBRSV14 EQU   DEBDSNM+4                                                02847000
DEBUTSAB EQU   DEBUTSAA+1                                               02848000
DEBRSV13 EQU   DEBUTSAA                                                 02849000
DEBVOLNM EQU   DEBACSMD+2                                               02850000
DEBVLSEQ EQU   DEBVOLSQ+1                                               02851000
DEBRSV42 EQU   DEBVOLBT                                                 02852000
DEBRSV41 EQU   DEBVOLBT                                                 02853000
DEBRSV40 EQU   DEBVOLBT                                                 02854000
DEBRSV39 EQU   DEBVOLBT                                                 02855000
DEBRSV38 EQU   DEBVOLBT                                                 02856000
DEBRSV37 EQU   DEBVOLBT                                                 02857000
DEBRSV36 EQU   DEBVOLBT                                                 02858000
DEBEXFUL EQU   DEBVOLBT                                                 02859000
DEBNMTRK EQU   DEBDASD+14                                               02860000
DEBENDHH EQU   DEBDASD+12                                               02861000
DEBENDCC EQU   DEBDASD+10                                               02862000
DEBSTRHH EQU   DEBDASD+8                                                02863000
DEBSTRCC EQU   DEBDASD+6                                                02864000
DEBBINUM EQU   DEBDASD+4                                                02865000
DEBUCBA  EQU   DEBUCBAD+1                                               02866000
DEBDVMOD EQU   DEBUCBAD                                                 02867000
DEBAPPB  EQU   DEBAPPAD+1                                               02868000
DEBEXSCL EQU   DEBAPPAD                                                 02869000
DEBDCBB  EQU   DEBDCBAD+1                                               02870000
DEBDEBID EQU   DEBPROTG                                                 02871000
DEBECBB  EQU   DEBECBAD+1                                               02872000
DEBPRIOR EQU   DEBECBAD                                                 02873000
DEBUSRPB EQU   DEBUSRPG+1                                               02874000
DEBNMEXT EQU   DEBUSRPG                                                 02875000
DEBRSV05 EQU   DEBBASIC+15                                              02876000
DEBXTNIN EQU   DEBFLGS1                                                 02877000
DEBAPFIN EQU   DEBFLGS1                                                 02878000
DEBF1CEV EQU   DEBFLGS1                                                 02879000
DEBCINDI EQU   DEBFLGS1                                                 02880000
DEBRSV02 EQU   DEBFLGS1                                                 02881000
DEBRSIOA EQU   DEBFLGS1                                                 02882000
DEBEOFDF EQU   DEBFLGS1                                                 02883000
DEBPWCKD EQU   DEBFLGS1                                                 02884000
DEBQSCNT EQU   DEBBASIC+13                                              02885000
DEBPOSIT EQU   DEBOPATB                                                 02886000
DEBZERO  EQU   DEBOPATB                                                 02887000
DEBABEND EQU   DEBOPATB                                                 02888000
DEBIRBB  EQU   DEBIRBAD+1                                               02889000
DEBRERR  EQU   DEBOFLGS                                                 02890000
DEBLABEL EQU   DEBOFLGS                                                 02891000
DEBSPLIT EQU   DEBOFLGS                                                 02892000
DEBDCB   EQU   DEBOFLGS                                                 02893000
DEBRLSE  EQU   DEBOFLGS                                                 02894000
DEBEOF   EQU   DEBOFLGS                                                 02895000
DEBDISP  EQU   DEBOFLGS                                                 02896000
DEBDEBB  EQU   DEBDEBAD+1                                               02897000
DEBAMLNG EQU   DEBDEBAD                                                 02898000
DEBTCBB  EQU   DEBTCBAD+1                                               02899000
DEBNMSUB EQU   DEBTCBAD                                                 02900000
DCBEOB   EQU   IHADCS40+20                                              02901000
DCBPRECL EQU   IHADCS40+18                                              02902000
@NM00049 EQU   IHADCS40+16                                              02903000
@NM00048 EQU   @NM00046+1                                               02904000
@NM00047 EQU   DCBEROPT                                                 02905000
DCBERABE EQU   DCBEROPT                                                 02906000
DCBERSKP EQU   DCBEROPT                                                 02907000
DCBERACC EQU   DCBEROPT                                                 02908000
@NM00045 EQU   IHADCS40+10                                              02909000
@NM00044 EQU   IHADCS40+9                                               02910000
@NM00043 EQU   IHADCS40+8                                               02911000
DCBRECA  EQU   DCBRECAD+1                                               02912000
@NM00042 EQU   DCBRECBT                                                 02913000
DCBRCFGT EQU   DCBRCREL                                                 02914000
DCBRCTRU EQU   DCBRCREL                                                 02915000
DCBLCCW  EQU   DCBEOBAD                                                 02916000
DCBPERRA EQU   DCBGERRA                                                 02917000
@NM00041 EQU   DCBPERR                                                  02918000
DCBNOTE  EQU   DCBCNTRL                                                 02919000
DCBLRECL EQU   IHADCS38+10                                              02920000
@NM00040 EQU   IHADCS38+8                                               02921000
DCBEOBRA EQU   DCBEOBR+1                                                02922000
DCBNCP   EQU   DCBEOBR                                                  02923000
@NM00039 EQU   DCBFLAG1                                                 02924000
DCBSTFLS EQU   DCBFLAG1                                                 02925000
DCBSTQCK EQU   DCBFLAG1                                                 02926000
DCBDIRCQ EQU   DCBBUFOF                                                 02927000
DCBQSTRU EQU   DCBUSASI                                                 02928000
@NM00038 EQU   DCBUSASI                                                 02929000
DCBQADF3 EQU   DCBQADFS                                                 02930000
DCBQADF2 EQU   DCBQADFS                                                 02931000
DCBQADF1 EQU   DCBQADFS                                                 02932000
DCBBLBP  EQU   DCBUSASI                                                 02933000
@NM00037 EQU   DCBUSASI                                                 02934000
@NM00036 EQU   DCBCICB                                                  02935000
DCBWCPL  EQU   IHADCS36+13                                              02936000
DCBWCPO  EQU   IHADCS36+12                                              02937000
@NM00035 EQU   IHADCS36+10                                              02938000
DCBCNFEO EQU   DCBCIND2                                                 02939000
DCBCNBFP EQU   DCBCIND2                                                 02940000
DCBCNIOE EQU   DCBCIND2                                                 02941000
DCBCNCLO EQU   DCBCIND2                                                 02942000
DCBCNWRO EQU   DCBCIND2                                                 02943000
DCBCNSTO EQU   DCBCIND2                                                 02944000
@NM00034 EQU   DCBCIND1                                                 02945000
DCBCNBRM EQU   DCBCIND1                                                 02946000
@NM00033 EQU   DCBCIND1                                                 02947000
DCBCNEVA EQU   DCBCIND1                                                 02948000
DCBCNEVB EQU   DCBCIND1                                                 02949000
DCBCNSRD EQU   DCBCIND1                                                 02950000
DCBCNTOV EQU   DCBCIND1                                                 02951000
@NM00032 EQU   @NM00031+1                                               02952000
DCBIOBL  EQU   @NM00031                                                 02953000
@NM00030 EQU   @NM00028+1                                               02954000
DCBOPTJ  EQU   @NM00029                                                 02955000
DCBOPTT  EQU   @NM00029                                                 02956000
DCBSRCHD EQU   DCBOPTZ                                                  02957000
DCBOPTQ  EQU   @NM00029                                                 02958000
DCBBCKPT EQU   DCBOPTO                                                  02959000
DCBOPTC  EQU   @NM00029                                                 02960000
DCBOPTU  EQU   @NM00029                                                 02961000
DCBOPTW  EQU   @NM00029                                                 02962000
DCBDFBK  EQU   IHADCS30+44                                              02963000
DCBDFOR  EQU   IHADCS30+40                                              02964000
DCBDRDXA EQU   DCBDRDX+1                                                02965000
DCBMVXNO EQU   DCBDRDX                                                  02966000
DCBXARGA EQU   DCBXARG+1                                                02967000
DCBXCNT  EQU   DCBXARG                                                  02968000
DCBLIMCT EQU   IHADCS30+29                                              02969000
@NM00027 EQU   IHADCS30+28                                              02970000
DCBUQND  EQU   IHADCS30+24                                              02971000
DCBIOBUQ EQU   IHADCS30+20                                              02972000
DCBSQND  EQU   IHADCS30+16                                              02973000
DCBIOBSQ EQU   IHADCS30+12                                              02974000
@NM00026 EQU   IHADCS30+8                                               02975000
DCBSYNAD EQU   IHADCS30+4                                               02976000
DCBCHCKA EQU   DCBCHECK+1                                               02977000
DCBOPTRB EQU   DCBOPTCD                                                 02978000
DCBOPTRE EQU   DCBOPTCD                                                 02979000
DCBOPTDB EQU   DCBOPTCD                                                 02980000
DCBOPTA  EQU   DCBOPTCD                                                 02981000
DCBOPTF  EQU   DCBOPTCD                                                 02982000
DCBOPTE  EQU   DCBOPTCD                                                 02983000
DCBOPTTO EQU   DCBOPTCD                                                 02984000
@NM00025 EQU   DCBOPTCD                                                 02985000
DCBPUTA  EQU   DCBGETA                                                  02986000
@NM00024 EQU   DCBPUT                                                   02987000
DCBREADA EQU   DCBWRITA                                                 02988000
@NM00023 EQU   DCBREAD                                                  02989000
DCBDEBA  EQU   DCBDEBAD+1                                               02990000
@NM00022 EQU   DCBIFLGS                                                 02991000
DCBIFIOE EQU   DCBIFLGS                                                 02992000
DCBCH12  EQU   DCBIFPCT                                                 02993000
DCBCH9   EQU   DCBIFPCT                                                 02994000
DCBIFEC  EQU   DCBIFLGS                                                 02995000
DCBMFSTI EQU   DCBMFDMD                                                 02996000
DCBMFAWR EQU   DCBMFSTK                                                 02997000
DCBMFUIP EQU   DCBMFTMD                                                 02998000
DCBMFIDW EQU   DCBMFLCP                                                 02999000
DCBMFWRK EQU   DCBMFMVP                                                 03000000
DCBMFRDQ EQU   DCBMFWRT                                                 03001000
DCBMFGTQ EQU   DCBMFPUT                                                 03002000
DCBMFSTL EQU   DCBMACF2                                                 03003000
DCBMFCK  EQU   DCBMFDMG                                                 03004000
DCBMFRDX EQU   DCBMFCHK                                                 03005000
DCBMFDBF EQU   DCBMFSBG                                                 03006000
DCBMFRDI EQU   DCBMFLCG                                                 03007000
DCBMFRDK EQU   DCBMFMVG                                                 03008000
DCBMFWRQ EQU   DCBMFRD                                                  03009000
DCBMFPTQ EQU   DCBMFGET                                                 03010000
DCBMFECP EQU   DCBMACF1                                                 03011000
DCBTIOT  EQU   IHADCS25                                                 03012000
DCBMRSTI EQU   DCBMRDMD                                                 03013000
DCBMRAWR EQU   DCBMRSTK                                                 03014000
DCBMRUIP EQU   DCBMRTMD                                                 03015000
DCBMRIDW EQU   DCBMRLCP                                                 03016000
DCBMRWRK EQU   DCBMRMVP                                                 03017000
DCBMRRDQ EQU   DCBMRWRT                                                 03018000
DCBMRGTQ EQU   DCBMRPUT                                                 03019000
DCBMRSTL EQU   DCBMACR2                                                 03020000
DCBMRCK  EQU   DCBMRDMG                                                 03021000
DCBPGFXA EQU   DCBMRRDX                                                 03022000
DCBMRDBF EQU   DCBMRSBG                                                 03023000
DCBMRRDI EQU   DCBMRLCG                                                 03024000
DCBMRRDK EQU   DCBMRMVG                                                 03025000
DCBMRWRQ EQU   DCBMRRD                                                  03026000
DCBMRPTQ EQU   DCBMRGET                                                 03027000
DCBMRECP EQU   DCBMACR1                                                 03028000
@NM00021 EQU   DCBIFLG                                                  03029000
DCBIBIOE EQU   DCBIFLG                                                  03030000
DCBICH12 EQU   DCBIBPCT                                                 03031000
DCBICH9  EQU   DCBIBPCT                                                 03032000
DCBIBEC  EQU   DCBIFLG                                                  03033000
DCBOFIOF EQU   DCBOFLGS                                                 03034000
DCBOFUEX EQU   DCBOFLGS                                                 03035000
DCBOFTM  EQU   DCBOFLGS                                                 03036000
DCBOFPPC EQU   DCBOFLGS                                                 03037000
DCBOFOPN EQU   DCBOFLGS                                                 03038000
DCBOFLRB EQU   DCBOFLGS                                                 03039000
DCBOFIOD EQU   DCBOFLWR                                                 03040000
DCBDDNAM EQU   IHADCS24                                                 03041000
DCBEXLSA EQU   DCBEXLST+1                                               03042000
DCBRECKL EQU   DCBRECFM                                                 03043000
DCBRECCC EQU   DCBRECFM                                                 03044000
DCBRECSB EQU   DCBRECFM                                                 03045000
DCBRECBR EQU   DCBRECFM                                                 03046000
DCBRECTO EQU   DCBRECLA                                                 03047000
DCBRECL  EQU   DCBRECLA                                                 03048000
DCBEODA  EQU   DCBEODAD+1                                               03049000
DCBBFA   EQU   DCBBFTEK                                                 03050000
DCBH0    EQU   DCBBFTEK                                                 03051000
DCBBFTKD EQU   DCBBFTEK                                                 03052000
DCBBFTE  EQU   DCBBFT                                                   03053000
DCBBFTKR EQU   DCBBFT                                                   03054000
DCBBFTS  EQU   DCBBFT                                                   03055000
DCBH1    EQU   DCBBFTEK                                                 03056000
DCBSVCXA EQU   DCBSVCXL+1                                               03057000
@NM00020 EQU   DCBSVCXL                                                 03058000
DCBODEBA EQU   DCBIOBAA                                                 03059000
@NM00019 EQU   DCBQSLM                                                  03060000
DCBUPDBT EQU   DCBQSLM                                                  03061000
DCBUPDCM EQU   DCBQSLM                                                  03062000
DCB1DVDS EQU   DCBQSLM                                                  03063000
@NM00018 EQU   DCBDSRG2                                                 03064000
DCBDSGTR EQU   DCBDSRG2                                                 03065000
DCBACBM  EQU   DCBDSRG2                                                 03066000
@NM00017 EQU   DCBDSRG2                                                 03067000
DCBDSGTQ EQU   DCBDSRG2                                                 03068000
DCBDSGTX EQU   DCBDSRG2                                                 03069000
DCBDSGGS EQU   DCBDSRG2                                                 03070000
DCBDSGU  EQU   DCBDSRG1                                                 03071000
DCBDSGPO EQU   DCBDSRG1                                                 03072000
@NM00016 EQU   DCBDSRG1                                                 03073000
@NM00015 EQU   DCBDSRG1                                                 03074000
DCBDSGCX EQU   DCBDSRG1                                                 03075000
DCBDSGPS EQU   DCBDSRG1                                                 03076000
DCBDSGIS EQU   DCBDSRG1                                                 03077000
DCBBUFL  EQU   IHADCS11+8                                               03078000
DCBKEYLE EQU   DCBRELB                                                  03079000
@NM00014 EQU   IHADCS08+15                                              03080000
DCBORDCK EQU   DCBEIB                                                   03081000
DCBORHPR EQU   DCBEIB                                                   03082000
DCBORWLR EQU   DCBEIB                                                   03083000
DCBORECK EQU   DCBEIB                                                   03084000
DCBORERR EQU   DCBEIB                                                   03085000
DCBORREJ EQU   DCBEIB                                                   03086000
DCBORNRM EQU   DCBEIB                                                   03087000
@NM00013 EQU   DCBEIB                                                   03088000
@NM00012 EQU   IHADCS08+13                                              03089000
@NM00011 EQU   DCBORBYT                                                 03090000
DCBORBFP EQU   DCBORBYT                                                 03091000
DCBOREOF EQU   DCBORBYT                                                 03092000
DCBORSYN EQU   DCBORBYT                                                 03093000
DCBRDLNA EQU   DCBFRTBA+5                                               03094000
DCBRESCA EQU   DCBFRTBA+1                                               03095000
@NM00010 EQU   DCBFRTBA                                                 03096000
DCBDSPLA EQU   DCBFRID+1                                                03097000
@NM00009 EQU   DCBFRID                                                  03098000
@NM00008 EQU   DCBERRCA+2                                               03099000
@NM00007 EQU   DCBORFLG                                                 03100000
DCBEOPFG EQU   DCBORFLG                                                 03101000
DCBLFMAT EQU   DCBERRCA                                                 03102000
DCBLNNUM EQU   DCBERRCN                                                 03103000
DCBWTOIA EQU   DCBWTOID+1                                               03104000
@NM00006 EQU   DCBWTOID                                                 03105000
DCBTRBAL EQU   IHADCS01+6                                               03106000
@NM00005 EQU   IHADCS01+5                                               03107000
@NM00004 EQU   IHADCS01+4                                               03108000
DCBDVTBA EQU   DCBDVTBL+1                                               03109000
@NM00003 EQU   DCBDVTBL                                                 03110000
DCBKEYCN EQU   IHADCS00+4                                               03111000
DCBRELAD EQU   IHADCS00                                                 03112000
@NM00002 EQU   IHADCB                                                   03113000
@NM00001 EQU   CCW+5                                                    03114000
CCWPCI   EQU   CCWFLGS                                                  03115000
CCWSKIP  EQU   CCWFLGS                                                  03116000
CCWSLI   EQU   CCWFLGS                                                  03117000
CCWCC    EQU   CCWFLGS                                                  03118000
CCWCD    EQU   CCWFLGS                                                  03119000
CCWCOMCD EQU   CCWADDRA                                                 03120000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      03121000
@RT00127 EQU   EXITRTN                                                  03122000
@RT00132 EQU   XCTLRTN                                                  03123000
@RT00139 EQU   BDAMRTN                                                  03124000
@RT00142 EQU   SAMIOB                                                   03125000
@RT00144 EQU   SAMIOB                                                   03126000
@RT00175 EQU   SAMBUFLN                                                 03127000
@RT00203 EQU   SAMBUFL2                                                 03128000
@RT00205 EQU   SAMBUFFR                                                 03129000
@RF00205 EQU   SAMIOB                                                   03130000
@RC00317 EQU   @RC00316                                                 03131000
@ENDDATA EQU   *                                                        03132000
         END   IGG020T1,(C'PLS0136',0701,76154)                         03133000
./  ADD  SSI=81240080,NAME=IGG0201A
201A     TITLE 'IGG0201A -- SAM CLOSE EXECUTOR, NON-DIRECT ACCESS'      00010003
IGG0201A CSECT                                                          00012002
*                                                                       00014002
*MODULE NAME - IGG0201A                                                 00020002
*                                                                       00022002
*DESCRIPTIVE NAME - CLOSE EXECUTOR FOR NON-DA DEVICES                   00022402
*                                                                       00022802
*COPYRIGHT - NONE                                                       00023202
*                                                                       00095502
*FUNCTION - THE FOLLOWING FUNCTIONS WILL BE PERFORMED BY THIS           00097002
*           CLOSE EXECUTOR FOR BSAM/QSAM DATA SETS NON-DIRECT ACCESS:   00098502
*         - 3505 CARD READERS WITHOUT OMR OR RCE AND 3525 CARD   XA2032 00100502
*           PUNCHES WITHOUT ASSOCIATED DATA SETS ARE PROCESSED   XA2032 00102502
*           BY THIS ROUTINE.                                     XA2032 00104502
*         - A GETMAIN IS ISSUED IN THE BEGINNING OF THE MODULE          00108502
*           TO PROVIDE THE ACCESS METHOD ROUTINES WITH A REGISTER       00118502
*           SAVEAREA IN USER KEY, SP230.                         Y02072 00128502
*         - FOR QSAM INPUT AND BSAM, A PURGE IS ISSUED FOR ANY   YM3838 00130502
*           OUTSTANDING I/O                                      YM3838 00132502
*         - FOR 2540 DEVICES AND QSAM, THE LAST CARD READ WILL          00138502
*           BE FLUSHED FROM THE PRESTACK STATION.                       00140502
*         - FOR QSAM, PUT LOCATE AND TSO, THE PUT ROUTINE IS ENTERED    00142502
*           TO SCHEDULE THE LAST I/O.                                   00144502
*         - FOR ALL OTHER QSAM OUTPUT DATA SETS, THE TRUNCATE ROUTINE   00146502
*           IS ENTERED TO SET UP AN END OF BLOCK CONDITION AND THEN THE 00146902
*           PUT ROUTINE (LOCATE MODE ONLY) IS ENTERED TO SCHEDULE THE   00147102
*           LAST I/O.                                                   00147202
*         - FOR 2520/2540 DEVICES, EXCP'S ARE ISSUED TO PUNCH 2         00147702
*           BLANK CARDS TO ALLOW THE ERP'S TO GAIN CONTROL IF THERE     00148102
*           WAS AN ERROR ON EITHER OF THE LAST 2 CARDS PUNCHED.         00148202
*         - FOR QSAM OUTPUT, ALL I/O IS QUIESCED.                       00189302
*         - FOR PRINTERS, AN EXCP IS ISSUED TO DO A WRITE        YM1479 00230702
*           NO-SPACE TO CLEAR THE PRINT LINE BUFFER (PLB).              00271802
*         - FOR THE 3800 PRINTER ISSUES A SKIP TO CHANNEL 1    @Z40MSRZ 00281810
*         - SETS AN AUDIT TRAIL BIT IN THE O/C/E WORKAREA        Y02072 00321802
*           (INDICATING PURGE SUCCESSFUL), IN CASE THE USERS     Y02072 00331802
*           STAE ROUTINE SHOULD GET CONTROL DURING A FORCE       Y02072 00341802
*           CLOSE SITUATION. (THIS BIT, ALTHOUGH SET DURING      Y02072 00351802
*           NORMAL CLOSE, HAS NO MEANING).                       Y02072 00353802
*                                                                       00360000
*ENTRY POINTS: IGG0201A- NORMAL- XCTL FROM IFG0200W (NORMAL CLOSE)      00370002
*                        ABNORMAL- XCTL FROM IGG020T1 (FORCE            00372002
*                                  CLOSE EXECUTOR)                      00374002
*                                                                       00400000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS), IOB(USERS).           00420000
*                                                                       00440000
*OUTPUT: NONE                                                           00460000
*                                                                       00480000
*MACROS - ACTION : GETMAIN, EXCP, WAIT, FREEMAIN, IECRES, SYNCH,        00490003
*                  MODESET                                              00492003
*MACROS - MAPPING : IHACCW, IECDSECT, IECDSECS, IEZIOB, IEZDEB, CVT,    00494002
*                   DCBD, IKJRB, IKJTCB, IHAECB, IHACSW, IECDPPL,       00496002
*                   IGGPARML                                            00496402
*                                                                       00498002
*EXTERNAL ROUTINES: DCBPUT (TO OUTPUT LAST BUFFER),                     00500002
*                   DCBTRUNC (TO FORCE END OF BUFFER)                   00520002
*                                                                       00530002
*EXITS - NORMAL- TO IGG0201P FOR 3525, 3505 WITH OMR OR RCE MODES       00540003
*                TO IGG0201X FOR ALL OTHER DATA SETS                    00560003
*                                                                       00570002
*EXITS-ERROR - FOR QSAM OUTPUT TAPE DATA SETS, IF AN ABNORMAL    YM3079 00580002
*              ECB POST CODE WITH UNIT EXCEPTION ON IN THE CSW   YM3079 00580402
*              IS FOUND DURING QUIESCENCE, GO TO IGG0201B TO     YM3079 00580803
*              GET A NEW VOLUME MOUNTED.                         YM3079 00581202
*                                                                       00590002
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN USER KEY UNLESS       Y02072 00600002
*             OTHERWISE SPECIFIED, SUPERVISOR STATE              Y02072 00610002
*                                                                       00612002
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00620000
*                                                                       00640000
*      BYTE  0-7  NAME                                                  00660000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00680000
*      BYTE 11    CONCATENATION NUMBER                                  00700000
*      BYTE 12    ZERO                                                  00720000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00740000
*                        ALIAS INDICATOR 1 BIT                          00760000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00780000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00800000
*      BYTE 17    ZERO                                                  00820000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00840000
*      BYTE 20    TRANSLATION TABLE                                     00860000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00880000
*      BYTE 22-23 ATTRIBUTES                                            00900000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00920000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00940000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00960000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00980000
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       01000000
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        01020000
*      BYTE 40-   TABLE OF IDTTR'S                                      01040000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          01060000
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          01080000
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          01100000
*                   NOT USED                         (3 BYTES)          01120000
*                                                                       01140000
*      CLOSE WORKAREA                                                   01160002
*                                                                       01180000
*                                                                       01220000
*NOTES: ALL REGISTER EQUATES BEGIN WITH THE CHARACTER R.                01240002
*       THIS MODULE WAS SPLIT AT RELEASE 17 INTO IGG0201Z AND AT        01250002
*       RELEASE 20 INTO IGG0201X.                                       01260002
*       THE ADDRESS OF THE DEB MUST BE GOTTEN FROM THE PROTECTED Y02072 01262002
*       COPY OF THE DCB FOR INTEGRITY REASONS.                   Y02072 01264002
*                                                                       01270002
*CHANGE ACTIVITY - AS FOLLOWS:                                          01280002
*                                                                       01282002
*          VS2 RELEASE 04 CHANGES/DELETIONS                             01282437
*C063000-063200                                                 ZA01365 01282837
*D030400-036360                                                 ZA02245 01282937
*C030300-030320                                                 ZA02245 01283037
*        REFER ALSO TO SUPPORT CODE @Z40MSRZ; 3800 PRINTER     @Z40MSRZ 01283110
*000004496102                                                  @ZA03670 01283237
*000004842102-04842302                                         @ZA03670 01283437
*000002309612                                                  @ZA03670 01283637
*000004843003,04843513-04844002                                @ZA08249 01283837
*000002460603-02460803,13055702                                @ZA08249 01284337
*C130563,D134400                                               @ZA10605 01284837
*D071443-071451                                                @ZA11562 01285010
*          VS2 RELEASE 2 DELETIONS                                      01285337
*000200,000710,001800,001900,002600,002620,004920,022750,024800, Y02072 01286002
*025200,025204,025300-025304,025324-025344,025680,025740,        Y02072 01288002
*056906-056958,056964-056968,062500,062700-062760,065500-065829, Y02072 01288402
*079400,129842,129844,129847,129851-129852,129864,129917-130019, Y02072 01288802
*130850-131250,131350,133400-133600,26400,79000,128600-129800,   Y02072 01289202
*005800,22992,36400,57056-57060,57068,57092,57104,70980-71020,   Y02072 01289602
*71060-71140,71180-71220,78200-79900,127800,130110-130122,       Y02072 01289702
*44300-48200,57012-57104,61700-62300,64620-65400                 Y02072 01289802
*                                                                YM1125 01289902
*                                                                YM1460 01291802
*D111904-111960,130580                                           YM1479 01293802
*                                                                YM3079 01295802
*                                                                YM3838 01297802
*                                                                YM4640 01297902
*                                                                YM6249 01299902
*                                                                YM7064 01301802
*D68300-71159,74100                                              YM7362 01303802
*                                                                YM7889 01305802
*                                                                       01306402
*          VS2 RELEASE 3 DELETIONS                                      01306803
*                                                                       01307237
*                                                                       01307337
*                                                              @Z30TSMI 01307437
*C024060-024607,063000-0631000                                 @ZA24748 01307537
*C022777                                                       @ZA24897 01307637
*A111904-111916                                                @ZA24897 01307737
*C111904-111908                                                @ZA27591 01307837
*A940003-940004                                                @ZA27943 01307910
*                                                                       01308010
*C024604-024608                                                @ZA30121 01308110
*A048425-048472,0488190-0488590                                @ZA30121 01308237
*C073000                                                       @ZA29884 01308537
*A048432-0484420                                               @ZA30121 01309037
*                                                                       01309637
*          VS 1 RELEASE 3 DELETIONS/CHANGES                             01309937
*                                                                XA2032 01310202
*          RELEASE 19 DELETIONS                                       * 01312102
*1890                                                            S19017 01314002
*1890070070,071100                                               A28192 01315902
*          RELEASE 20 DELETIONS                                       * 01317802
*0485065860                                                      A36344 01319702
*0485125000                                                      S20202 01321602
*0485056922-056930                                               M3504  01323502
*0485098800-101200,102800,103600-106000,109200-112400,114000-    M5149  01325402
*0485114800,117200                                               M5149  01327302
*0485000280-000356,000640,001800-003400,005400-005800,018400,    S20016 01329202
*0485058200-061000                                               M6099  01331102
*0485019400-019800,021000-021600,022140,022320,022650-022770,    S20016 01333002
*0485078900,095800-124960,127200-129400,131800-133000            S20016 01334902
*0485022780,123300                                               M5150  01336802
*0485030220-030340                                               M0006  01338702
*0485                                                            M0017  01340602
*0485                                                            TS2495 01342502
*0485123900                                                      M5148  01344402
*          RELEASE 21 DELETIONS                                       * 01346302
*1394129844                                                      M1813  01348202
*1394                                                            M1789  01350102
*1394022750-022770,121800-124200,130140-130210                   M1798  01352002
*1394129832-129888,129904-129936                                 M0044  01353902
*1394                                                            S21088 01355802
*1394056950-056970,061400,062000-062200,064800-065200,126200,    S21045 01357702
*1394126600                                                      S21045 01359602
*1394001800,002600-003000,022791,129808-129916,129944            M0153  01361502
*1394022700-022710,065913,102000                                 M1759  01363402
*1394025720,056945,056965,061850,062200,064700,065200,121600,    M1301  01365302
*1394129830,129836,129850,129864,129912-129914,129918            M1301  01367202
*1394032000                                                      M0916  01369102
*1394001800,002700,002900,129810-129812,129844-129846            M1044  01371002
*  REFER TO CODE FLAGGED XA2032                                 SA63742 01372902
         EJECT                                                          01374802
*                                                                       01376702
* REGISTER USAGE                                                        01378602
*                                                                       01380502
RWK1     EQU   0                        WORK REGISTER                   01382402
R1       EQU   1                        WORK REGISTER                   01384302
RWK2     EQU   R1                       WORK REGISTER                   01386202
RDCB     EQU   2                        ADDR OF USERS DCB               01388102
R2       EQU   RDCB                     INPUT REG TO USER        Y02072 01390002
RBASE    EQU   3                        BASE REGISTER                   01400002
RCORE    EQU   4                        ADDR OF CLOSE WORK AREA         01420002
RPAR     EQU   5                        PARAMETER LIST                  01440002
RWTG     EQU   6                        START OF WTG                    01460002
RPARC    EQU   7                        CURRENT ENTRY IN PARM LIST      01480002
RWTGC    EQU   8                        CURRENT INTRY IN WTG TABLE      01500002
RCOUNT   EQU   9                        REG FOR LOOP CONTROL            01510002
RWK6     EQU   RCOUNT                   WORK REGISTER                   01520002
RWK4     EQU   10                       WORK REGISTER                   01552002
RCCW     EQU   RWK4                     ADDRESSABILITY TO CHAN PGM      01556002
RCVT     EQU   RWK4                     CVT REGISTER                    01558002
RDEB     EQU   11                       DEB ADDRESS                     01560002
R12      EQU   12                       INPUT REG TO USER        Y02072 01570002
RIOB     EQU   R12                      IOB REGISTER                    01580002
RWK5     EQU   RIOB                     WORK REGISTER                   01590002
R13      EQU   13                       REG SAVE AREA FOR AM RTNS       01600002
RRETRN   EQU   14                       RETURN ADDRESS REG              01620002
RTCB     EQU   RRETRN                   TCB ADDRESS                     01620402
RWK3     EQU   RRETRN                   WORK REGISTER                   01630002
RRB      EQU   RRETRN                   REQUEST BLOCK REG               01632002
R15      EQU   15                       INPUT TO SYNCH ROUTINE   Y02072 01634002
RBRNCH   EQU   R15                      BRANCH REG                      01640002
         EJECT                                                          01716002
*                                                                       01718002
* EQUATES FOR CONSTANTS                                                 01718402
*                                                                       01718802
DCBDVPR4 EQU   X'4B'                    TO TEST FOR 2245 IN DCB  YM1479 01768802
LOOPCNT  EQU   2                        NO OF TIMES THROUGH LOOP        01770002
OUTINOUT EQU   X'07'                    OPEN OPTION, OUT OR OUTIN       01790002
MINNOBUF EQU   3                        MINIMUM NUMBER OF BUFFERS       01792802
NONZERO  EQU   1                        NON ZERO COUNT FOR CCW          01793202
TAPE     EQU   X'80'                    TO TEST FOR TAPE DEVICE         01796002
NOADDR   EQU   X'01'                    INDICATES NO ADDRESS     TS2495 01841020
BLANK    EQU   X'40'                    BLANK                     OC022 02166002
KEYMASK  EQU   X'80'                    MASK TO DISTINGUISH SYS  Y02072 02275002
*                                         KEY FROM PROB PROG KEY Y02072 02277002
SAVELG   EQU   74                       LENGTH OF SAVE AREA    @ZA24897 02277737
WRNOSPAC EQU   X'01'                    WRITE/NO-SPACE CCW OP CODE      02289202
SKPTO1   EQU   X'8B'                    SKIP TO CHAN 1 COMMAND @Z40MSRZ 02291210
DCBTRUNC EQU   8                        OFFSET INTO PUT RTN OF   Y02072 02299202
*                                         TRUNCATE ROUTINE       Y02072 02309202
PPLLENTH EQU   12                       LENGTH OF PURGE PARM LST YM3838 02309602
PPLQIESE EQU   X'40'                    QUIESCE MASK           @ZA03670 02309837
         EJECT                                                          02310002
*                                                                       02320002
* ADDRESSABILITY FOR DSECTS                                             02330002
*                                                                       02332002
         USING PSA,0                                             Y02072 02392002
         USING WTGENTRY,RWTGC                                           02430002
         USING WTG,RWTG                                                 02432002
         BALR  RBASE,0                                                  02440000
         USING AMCL1,RBASE                                              02442002
*                                                                       02450002
* INITIALIZE REGISTERS                                                  02452002
*                                                                       02454002
AMCL1    EQU   *                                                        02460000
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 02460202
         DC    C'IGG0201A'              MODULE NAME              YM4640 02460402
         DC    C'@ZA30121'              LAST SHIP CODE         @ZA30121 02460610
         DC    CL8'&SYSDATE'            LAST SHIP DATE         @ZA30121 02460710
BEGIN    DS    0H                       END OF MODULE ID         YM4640 02461002
         L     RCORE,WTGDCBWA           GET DCB'S WORK AREA      Y02072 02462002
         USING FORCORE,RCORE                                     Y02072 02464002
         L     RDCB,DXPDCBAD            GET PROTECTED DCB ADDR   Y02072 02464402
         USING IHADCB,RDCB                                              02464802
         CLI   DCBDEVT,DCBDVCR2         3505 CD RDR BEING USED   S21088 02466402
         BE    AMCLA                    YES, BRANCH              S21088 02466802
         CLI   DCBDEVT,DCBDVCP1         3525 CD PCH BEING USED   S21088 02468002
         BNE   AMCLC                    NO, BRANCH               S21088 02470002
         TM    DCBFUNC,X'FE'-DCBFNCBP   TEST FOR PUNCH ONLY      XA2032 02470402
*                                         FUNCTION               XA2032 02470802
         BZ    AMCLC                    YES, PROCESS HERE IF NOT XA3032 02471202
*                                         AN ASSOCIATED DATA SET XA3032 02471602
         B     AMCLB                    BRANCH TO SET ID         S21088 02472002
AMCLA    EQU   *                                                 S21088 02474002
         TM    DCBMODE,DCBMODEO+DCBMODER  OMR OR RCE SPECIFIED   S21088 02474402
         BZ    AMCLC                    NO, BRANCH               S21088 02474802
AMCLB    EQU   *                                                 S21088 02475202
         MVC   WTGIDTTR,LOAD201P        ID OF NEXT EXEC        @Z30TSMI 02475703
         B     TSTFCLOS                 GO XCTL TO 201P          YM3079 02475902
AMCLC    EQU   *                                                 S21088 02476002
         SPACE                                                          02526002
         MODESET  KEYADDR=DXUKEY,WORKREG=13  USER KEY            Y02072 02542002
         SPACE                                                          02552002
*                                                                       02654002
* THE FOLLOWING GETMAIN WILL RETURN CORE FROM SP230 IN USER KEY  Y02072 02656002
* NON-FETCH PROTECTED.                                           Y02072 02658002
*                                                                       02658402
         GETMAIN R,LV=SAVELG,SP=230                              Y02072 02658802
         SPACE                                                          02658902
         MODESET  EXTKEY=DATAMGT                                 Y02072 02659202
         SPACE                                                          02659302
         ST    R1,SCWGETMA              SAVE AREA ADDRESS        M1301  02659602
         SPACE                                                          02659702
         MODESET  KEYADDR=DXUKEY,WORKREG=13                      Y02072 02659802
         SPACE                                                          02669802
         SR    RCOUNT,RCOUNT            ASSUME NO BLANK CARDS TO PUNCH  02679902
         L     RDEB,DCBDEBAD            GET DCB'S DEB ADDRESS           02689902
         L     RDCB,DXUDCBAD            GET USERS DCB ADDR       Y02072 02699902
         L     RIOB,DCBIOBA             GET CURR IOB ADDRESS            02709902
         LA    RIOB,0(RIOB)             CLEAR HIGH ORDER BYTE           02719902
         USING IOBQSAMN,RIOB                                            02729902
*                                                                       02740002
* SET INDICATOR SO ENTRY TO SYNAD FROM CLOSE WILL NOT OCCUR AND SO EOV  02780002
* WILL MOVE DSCB FROM ITS WORK AREA TO CLOSE'S WORK AREA.               02800002
*                                                                       02840000
         OI    DCBCIND2,DCBCNCLO        TURN ON CLOSE FLAG.             02860002
         USING DEBACSMD+(DEBBASIC-DEBBASND-L'DEBSUCBA),RDEB             02862002
         MVC   DCBLRECL,DEBLRECL        RESTORE DCBLRECL          M0006 02866002
*                                         SAVED IN DEB BY OPEN          02872002
*                                                                       02872402
* TEST FOR FORCE CLOSE IN CONTROL. IF SO, ALL THAT CAN BE DONE   YM6249 02872802
* IS A PURGE. (THIS ROUTINE WILL ONLY BE ENTERED FOR QSAM INPUT  YM6249 02873202
* DATA SETS DURING FORCE CLOSE PROCESSING).                      YM6249 02873602
*                                                                       02873702
         TM    FCACLOS1,FCACFORC        IS THIS FORCE CLOSE      YM6249 02873802
         BO    AMCL1015                 YES, GO ISSUE PURGE      YM6249 02873902
         DROP  RDEB                                                     02874002
         USING DEBBASIC,RDEB                                            02876002
         TM    DEBOPATB,OUTINOUT        DCB OPENED FOR OUT OR OUTIN     02880002
         BNO   AMCL1010                 YES, GO TEST TO SEE IF  ZA02245 03030037
*                                        LAST I/O MUST BE DONE  ZA02245 03032037
AMCL1000 EQU   *                                                        04000000
         TM    DCBCIND2,DCBCNQSM        DCB USING QSAM TO PROCESS       04040002
         BO    TRUNCATE                 YES, BYPASS PURGE        YM3838 04140002
AMCL1010 EQU   *                                                        04380000
         CLI   DCBDEVT,DCBDVTRM         TSO TERMINAL             S20016 04386002
         BE    FRWKAREA                 YES, BRANCH              Y02072 04392002
*                                                                       04442002
* MUST ISSUE A PURGE SVC FOR BSAM AND QSAM INPUT DATA SETS.      YM3838 04492002
* OPTIONS ARE:                                                   YM3838 04494002
*   X'80' (ON) - PURGE BY DEB                                    YM3838 04496002
*   X'40' (ON) - QUIESCE                                       @ZA03670 04497037
*   X'20' (ON) - HALT I/O                                        YM3838 04498002
*   X'10' (OFF) - ALL ASSOCIATED REQUESTS                        YM3838 04500002
*                                                                       04542002
AMCL1015 DS    0H                                                YM6249 04552002
         L     RWK4,SCWGETMA            USE USER KEY WORKAREA    YM3838 04592002
*                                         FOR PARAMETER LIST     YM3838 04642002
         USING PPLDSID,RWK4                                      YM3838 04692002
         XC    PPLDSID(PPLLENTH),PPLDSID  CLEAR LIST             YM3838 04742002
         ST    RDEB,PPLDSID             ADDR OF DEB TO LIST      YM3838 04792002
         MVI   PPLDSID,PPLDS+PPLHIO     OPTIONS TO LIST          YM3838 04842002
         TM    DCBDEVT,TAPE             IS IT TAPE             @ZA03670 04842537
         BZ    PURGIT                   NO                     @ZA08249 04843037
         TM    DCBCIND2,DCBCNQSM        IS THIS QSAM ?         @ZA30121 04843237
         BO    CHECKCHN                 YES QSAM DO NOT PURGE  @ZA30121 04843437
         MVI   PPLDSID,PPLDS+PPLQIESE   SET PURGE TO QUIESCE   @ZA30121 04843637
         OC    PPLPIRLA,PIRLQIES        PUT PIRL ADDR IN PPL   @ZA30121 04843837
         B     PURGIT                   BSAM THEN PURGE        @ZA30121 04844037
CHECKCHN EQU   *                                               @ZA30121 04844237
         TM    DCBCIND2,DCBCNCHS        CHAINED SCHEDULING     @ZA30121 04845037
         BNO   NOCHAIN                  NOT CHAIN SCH          @ZA30121 04845137
         USING IOBQSAMC,RIOB                                   @ZA30121 04845237
         L     RIOB,DCBIOBAD            CHAINED SCH IOB        @ZA30121 04845337
         L     R1,IOBECBPT              ECB CHAINED SCH        @ZA30121 04845437
         TM    0(R1),ECBPOST            IOB POSTED             @ZA30121 04845537
         BO    FRCE1                    YES - CONTINUE         @ZA30121 04845637
         WAIT  ECB=(1)                  WAIT                   @ZA30121 04845737
FRCE1    B     FORCLS                   DO NOT ISSUE PURGE     @ZA30121 04845837
NOCHAIN  EQU   *                                               @ZA30121 04845937
         USING IOBQSAMN,RIOB                                   @ZA30121 04846037
         L     RIOB,DCBIOBA             GET NORMAL IOB         @ZA30121 04846137
         LA    RIOB,0(RIOB)             CLEAR HI-BYTE          @ZA30121 04846237
         LR    RWK4,RIOB                SAVE IOB ADDR FOR COMP @ZA30121 04846337
TESTCOMP L     R1,IOBECBPT              GET ECB ADDR           @ZA30121 04846437
         TM    0(R1),ECBPOST            IOB POSTED             @ZA30121 04846537
         BO    LAST                     YES - CONTINUE         @ZA30121 04846637
         WAIT  ECB=(1)                  WAIT FOR POST          @ZA30121 04846737
LAST     L     RIOB,IOBNIOBA            GET NEXT IOB ADDR      @ZA30121 04846837
         LA    RIOB,0(RIOB)             CLEAR HI-BYTE          @ZA30121 04846937
         CR    RIOB,RWK4                LAST IOB               @ZA30121 04847037
         BE    FORCLS                   YES, GO ON             @ZA30121 04847137
         B     TESTCOMP                 TEST FOR COMPLETION    @ZA30121 04847237
PURGIT   LR    R1,RWK4                  INPUT TO PURGE         @ZA08249 04849037
         PURGE (1)                      ISSUE PURGE              YM3838 04852002
         LA    R1,PPLCC                 ECB TO BE POSTED         YM3838 04854002
         WAIT  ECB=(1)                  WAIT FOR COMPLETION      YM3838 04856002
         DROP  RWK4                                              YM3838 04858002
         MODESET  EXTKEY=DATAMGT        KEY OF AUDIT TRAIL       YM3838 04858402
         SPACE                                                          04858802
         OI    FCACLOS2,FCACPURG        INDICATE PURGE COMPLETED YM3838 04859202
         MODESET  KEYADDR=DXUKEY,WORKREG=10  RESUME USER KEY     YM3838 04859602
         SPACE                                                          04859702
*                                                                       04859802
* TEST FOR FORCE CLOSE. IF SO, EXIT TO IGG0201X FOR CLEAN UP.    YM6249 04859902
*                                                                       04879902
FORCLS   EQU   *                                               @ZA30121 04881937
         L     RIOB,DCBIOBA             GET CURRENT IOB ADDR   @ZA30121 04882937
         LA    RIOB,0(RIOB)             CLEAR HI-BYTE          @ZA30121 04883937
         USING IOBQSAMN,RIOB                                   @ZA30121 04884937
         TM    FCACLOS1,FCACFORC        FORCE CLOSE IN CONTROL   YM6249 04889902
         BO    FRWKAREA                 YES, GO FREE WORKAREA    YM6249 04899902
*                                                                       04900002
* TEST IF A TAPE MARK WAS SENSED WHEN READING DATA SET FOR BSAM OR      04920002
* QSAM INPUT.                                                           04970002
*                                                                       04980000
         TM    DCBDEVT,TAPE             DCB USING TAPE                  05000002
         BZ    AMCL2000                 NO BRANCH                 OC022 05020000
         LR    RWK1,RIOB                SAVE CURR IOB TO LOOP ON        05060002
AMCL1020 EQU   *                        START OF LOOP                   05100002
         L     RIOB,IOBNIOBA            LINK TO NEXT IOB IN CHAIN       05140002
         LA    RIOB,0(RIOB)             CLEAR HIGH BYTE IN REG.         05160002
         TM    CSWSTAT1,CSWUNEXP        TM INDICATOR ON IN CSW          05200002
         BZ    AMCL1030                 NO, TEST MORE            Y02072 05250002
         OI    DCBOFLGS,DCBOFTM         SET TM FLAGS FOR         Y02072 05252002
*                                         COMMON CLOSE           Y02072 05256002
         B     FRWKAREA                 EXIT THIS MODULE         Y02072 05258002
AMCL1030 EQU   *                                                 Y02072 05258402
         CR    RWK1,RIOB                TESTED ALL IOBS IN CHAIN        05260002
         BE    FRWKAREA                 YES BRANCH               Y02072 05280002
         B     AMCL1020                 NO BRANCH                       05320000
TRUNCATE EQU   *                                                        05680000
*                                                                       05689302
* ISSUE A TRUNC MACRO FOR LAST QSAM OUTPUT BUFFER                       05690002
*                                                                       05690202
         CLI   DCBDEVT,DCBDVTRM         TSO TERMINAL             S20016 05692402
         BNE   TSEX010                  NO, BRANCH               S20016 05694602
*                                                                       05696802
* TSO MODIFICATION                                                      05699002
* 1)  FOR MACRF=(PL), THE ROUTINE WILL ISSUE ONE MORE PUT               05701202
*                                                                       05703402
         TM    DCBMACF2,DCBMRPUT+DCBMRLCP  TEST IF MACRF=(PL)    S20016 05705602
         BNO   FRWKAREA                 BRANCH IF NOT            Y02072 05707802
         LR    R1,RDCB                  SET UP FOR PARM REG      S20016 05710002
         L     R15,DCBPUT               GET PUT RTN ADDR         Y02072 05712202
         BAL   RWK4,SYNCHRTN            GO TO SYNCH ROUTINE      Y02072 05714402
         XC    DCBRECA(2),DCBRECA       ZERO OUT DCBRECAD FIELD   M3504 05716602
         MVI   DCBRECAD+3,NOADDR        RESTORE DCBRECAD TO       M3504 05719202
*                                        PRE-OPEN STATUS                05721802
         XC    DCBEOBAD+1(2),DCBEOBAD+1 ZERO OUT DCBEOBAD FIELD   M3504 05724402
         MVI   DCBEOBAD+3,NOADDR        RESTORE DCBEOBAD TO       M3504 05727002
*                                         PRE-OPEN STATUS               05729602
         B     FRWKAREA                 GO FINISH PROCESSING     Y02072 05741602
*                                                                       05743602
* MUST GO TO TRUNCATE ROUTINE TO SET UP END OF BLOCK CONDITION.         05745602
*                                                                       05746002
TSEX010  EQU   *                                                 S20016 05746202
         TM    DCBCIND2,DCBCNIOE        HAS EOV BEEN ENTERED BEFORE.    05750802
*                                        IF SO. MUST HAVE CLOSED IN     05755402
*                                        SYNAD.                         05760000
         BO    AMCL2000                 TIPTOE LIGHTLY OUT.       OC022 05780002
         LR    R1,RDCB                  SET UP REGISTER LINKAGE         06160002
         LA    R15,LOADPUT              ADDR OF INST TO GO TO    Y02072 06170002
*                                         TRUNCATE ROUTINE       Y02072 06180002
         BAL   RWK4,SYNCHRTN            GO TO SYNCH ROUTINE      Y02072 06210002
         TM    DCBMACF2,DCBMRPUT+DCBMRLCG DCB USING LOCATE MODE@ZA24748 06300037
         BNO   AMCLAD00                   NO BRANCH            @ZA24748 06310037
*                                                                       06340000
* MUST ISSUE A PUT IF IN LOCATE MODE TO FLUSH BUFFER AFTER TRUNC        06400002
*                                                                       06440000
         LR    R1,RDCB                  SET UP PARAMETER REGISTERS      06460002
         L     R15,DCBPUT               GET PUT RTN ADDR         Y02072 06470002
         BAL   RWK4,SYNCHRTN            GO TO SYNCH ROUTINE      Y02072 06500002
AMCLAD00 EQU   *                                                        06588002
*                                                                       06590002
* THE FOLLOWING SETS UP REGISTER RCOUNT WITH A 2 TO PUNCH BLANK CARDS   06590402
* IF REQUIRED                                                           06590802
*                                                                       06591202
         CLI   DCBDEVT,DCBDVCP1         3525 PUNCH               XA2032 06591602
         BE    AMCLAE01                 YES, TEST TO SEE IF      XA2032 06591702
*                                         BLANK CARDS TO BE PUNC XA2032 06591802
         CLI   DCBDEVT,DCBDVCPR         DEVICE A 2520            A36344 06592002
         BE    AMCLAE01                 SKIP 2540 TEST           A36344 06594000
         CLI   DCBDEVT,DCBDVCP0         TEST OUTPUT DEV IN USE    OC022 06596002
         BNE   AMCLAD02                 BRANCH IF NOT A 2540      OC022 06598000
AMCLAE01 TM    DCBCIND1,DCBCNTOV        TEST CONDITION OF DCB    A36344 06600002
         BO    AMCLAD02                 BRANCH IF DCB WAS OPENED  OC022 06602000
*                                         BUT NEVER USED          OC022 06604002
         CLI   DCBBUFNO,MINNOBUF        FIND OUT HOW MANY BUFFERS OC022 06606002
         BL    AMCLAD02                 BRANCH IF LESS THAN 3     OC022 06608000
         TM    DCBCIND2,DCBCNCHS        CHAIN SCHEDULING?         M1759 06610002
         BO    AMCLAD02                 YES? DONT PUNCH CARDS      MC1C 06612002
         LA    RCOUNT,LOOPCNT           LOAD A COUNTER TO GO TWICEOC022 06616002
*                                                                       06760000
* MUST NOW WAIT FOR QSAM OUTPUT QUIESENCE                         OC022 06780002
*                                                                       06800000
AMCLAD02 EQU   *                        QUIESCE OUTPUT            OC022 06810000
         L     RIOB,DCBIOBA             IOB PAST LAST ONE SCHED  YM7362 06820002
         LA    RWK4,0(RIOB)             SAVE ADDR FOR COMPARE    YM7362 06820402
*                                                                       06822002
* MUST LOOP THROUGH ICB'S LOOKING FOR THE 1ST NON-ZERO ECB FOR   YM7362 06822402
* CHAINED SCHEDULING BECAUSE THE ABNORMAL END APPENDAGE DOES NOT YM7362 06822802
* POST ICB'S PAST THE ONE IN ERROR.                              YM7362 06823202
*                                                                       06824002
         TM    DCBCIND2,DCBCNCHS        IS THIS CHAINED SCHEDUL  YM7362 06826002
         BZ    AMCLAD03                 NO, BYPASS LOOP          YM7362 06828002
AMCLAD2A EQU   *                                                 YM7362 06828102
         L     RIOB,IOBNIOBA            START WITH NEXT          YM7362 06828202
         TM    IOBNECB,ECBPOST          ECB NON-ZERO             YM7362 06828402
         BO    AMCLAD04                 YES, BR OUT OF LOOP      YM7362 06828802
         LA    RWK4,0(RIOB)             SAME ENDING ADDR FOR     YM7362 06829202
*                                         LOOP                   YM7362 06829302
         B     AMCLAD2A                 GO TEST NEXT ICB         YM7362 06829602
AMCLAD03 EQU   *                        IOB LOOP                  OC022 06850000
         L     RIOB,IOBNIOBA            GET NEXT IOB              11387 06880002
AMCLAD04 EQU   *                                                        06910002
         TM    IOBNECB,ECBNORM          DID IOB COMPLETE NORMAL  YM7362 06960002
         BM    AMCLAD60                 NO, GO TEST FOR TAPE     YM7362 06962002
         BO    AMCLAD05                 YES, TEST FOR LAST       YM7362 06964002
         WAIT  ECB=IOBNECB              WAIT ON IOB COMPLETION    11387 06970002
         B     AMCLAD04                 GO TEST COMPLETION       YM7362 06980002
AMCLAD05 EQU   *                                                        06990002
         LA    RIOB,0(RIOB)             CLEAR HI-BYTE FOR COMP   YM7362 07040002
         CR    RIOB,RWK4                LAST IOB                 YM7362 07090002
         BNE   AMCLAD03                 NO, GO TEST NEXT         YM7362 07100002
         LTR   RCOUNT,RCOUNT            YES, SEE IF CARDS MUST   YM7362 07110002
*                                         BE PUNCHED             YM7362 07112002
         BNZ   AMCLAD06                 GO PUNCH BLANK CARDS     YM7362 07114002
         B     AMCL2000                 GO CLEAR PLB IF PRINTER  YM7362 07114402
AMCLAD60 EQU   *                                                 YM3079 07115702
*                                                                       07125902
* TEST FOR TAPE. IF YES, GO TO IGG0201B TO GET NEW VOLUME        YM3079 07127902
*                                                                       07129902
         TM    DCBDEVT,TAPE             IS THIS A TAPE DEVICE    YM3079 07133902
         BZ    AMCL2000                 NO, DO NOT GO TO 201B    YM3079 07143902
         MODESET  EXTKEY=DATAMGT        SAME KEY AS WTG TABLE    YM3079 07149902
         SPACE                                                          07151902
         MVC   WTGIDTTR,LOAD201B        MOD TO HANDLE ERRORS   @Z30TSMI 07157903
         B     RELOOP                   GO TO 201B               YM3079 07159902
*                                                                 18147 07182802
* PUNCH TWO BLANK CARDS TO ALLOW ERROR RECOVERY ROUTINES TO GAIN  18147 07186402
* CONTROL IF THERE IS AN ERROR IN EITHER OF THE LAST TWO CARDS    18147 07190002
*                                                                 OC022 07220000
AMCLAD06 EQU   *                        MOD CHAN PROG AND PUNCH   OC022 07230000
         LA    RWK2,NONZERO             GENERATE A CONSTANT OF ONEOC022 07250002
         STH   RWK2,URECCW2C            LOAD CCW TO PUNCH ONE CHAROC022 07260002
         MVI   URECCW2F,CCWSLI          SET SILI ON, CC OFF       OC022 07280002
AMCLAD07 EQU   *                        SET UP TO PUNCH A BLANK   OC022 07295000
         L     RWK2,URECCW2A            GET THE DATA ADDRESS   @ZA29884 07300037
         LA    RWK2,0(RWK2)             CLEAR HIGH ORDER BITS     OC022 07310002
         LTR   RWK2,RWK2                TEST IF ANY ADDR IN CCW   OC022 07311002
         BNZ   AMCLAD08                 BRANCH IF ADDRESS EXISTS  OC022 07312000
         MVC   URECCW2B,URECCW1B        ADDR FROM 1ST CCW         OC022 07313002
         B     AMCLAD07                 BRANCH TO TRY AGA&N       OC022 07314000
AMCLAD08 EQU   *                        MOVE IN THE BLANK         OC022 07316000
         MVI   0(RWK2),BLANK            PUT BLANK IN DATA FIELD   OC022 07320002
         LA    RWK2,URECCW2A            ADDR OF CHANNEL PROGRAM  Y02072 07330002
         ST    RWK2,IOBSTART            ST CHAN PROG ADDR IN IOB  OC022 07372002
AMCLAD09 EQU   *                                                 YM7362 07382002
         EXCP  IOBSTDRD                 SCHEDULE IOB              OC022 07390002
         WAIT  ECB=IOBNECB              WAIT FOR I/O             YM7362 07400002
         TM    IOBNECB,ECBNORM          I/O COMPLETE WITHOUT ERR YM7362 07410002
         BM    FRWKAREA                 NO, GO FREE WORKAREA     YM7362 07420002
         BCT   RCOUNT,AMCLAD09          BR IF ANTHR BLANK REQ'D  YM7362 07430002
         B     FRWKAREA                 GO FREEMAIN WORKAREA     YM7362 07450002
         EJECT                                                          07500002
*                                                                       07550002
* THE FOLLOWING CODE WILL DO AN EXCP TO CLEAR THE PLB  OF ANY USER      07600002
* DATA FOR INTEGRITY REASONS                                            07650002
* IF THE DEVICE IS A 3800 PRINTER, A SKIP TO CHANNEL 1 CCW IS  @Z40MSRZ 07660010
* BUILT TO ENSURE CLEARING OF THE PAGE BUFFER IN THE DEVICE    @Z40MSRZ 07670010
*                                                                       07700002
AMCL2000 EQU   *                                                        09540000
         CLI   DCBDEVT,DCBDVPR5         TEST FOR DEVICE A PRIN @Z40MSRZ 09590010
         BH    FRWKAREA                 IF HIGHER, NOT A PRINTER YM1479 09840002
         CLI   DCBDEVT,DCBDVPR1         TEST FOR DEVICE A PRINTR YM1479 09890002
         BL    FRWKAREA                 IF LOWER, NOT A PRINTER  YM1479 09940002
         CLI   DCBDEVT,DCBDVCP1         3525 ?????             @ZA27943 09990010
         BE    FRWKAREA                 YES BRANCH             @ZA27943 10040010
         TM    DCBCIND2,DCBCNCHS        CK IF CHAINED SCHED USED M1759  10200002
         BNO   NOTPCI                   NO USE THIS IOB ADDR    SA53794 10250002
         DROP  RIOB                                                     10300002
         USING IOBQSAMC,RIOB                                    SA53794 10350002
         L     RIOB,DCBIOBAD            CHAINED SCHEDULING IOB  SA53794 10400002
         LA    RWK4,IOBCECB             ECB, CHAINED SCHEDULING SA53794 10450002
         LA    RIOB,IOBQSAMN-IOBQSAMC(RIOB)  ADDRESSABILITY     SA53794 10500002
         B     AMCLAD70                 GO AROUND NON-PCI CALC  SA53794 10550002
NOTPCI   EQU   *                                                SA53794 10600002
         USING IOBQSAMN,RIOB            NORMAL SCHEDULING IOB   SA53794 10650002
         LA    RWK4,IOBNECB             ECB, NORMAL SCHEDULING  SA53794 10700002
AMCLAD70 EQU   *                        BUILD CCW                S20202 10760020
*                                                                       10770002
* MUST SET TWO FLAGS IN THE IOB:                                 Y02072 10780002
*  1. FLAG FOR IOB UNRELATED REQUEST                             Y02072 10800002
*  2. FLAG INDICATING APPENDAGES SHOULD NOT PROCESS THIS I/O     Y02072 10802002
*     REQUEST                                                    Y02072 10804002
*                                                                       10806002
         OI    IOBFLAG1,IOBUNREL+IOBSPSVC  SET FLAGS             Y02072 10810002
         ST    RWK4,IOBECBPT            SET NEW ECB PT IN CASE  SA53794 10910002
*                                         ACCESS METHOD IS BSAM SA53794 10960002
         L     RCCW,SCWGETMA            USE USER KEY WORK AREA   YM1479 10970002
*                                         FOR CCW TO KEEP FROM   YM1479 10980002
*                                         DESTROYING BUFFER ADDR YM1479 10990002
         ST    RCCW,IOBSTART            CHAN PGM STARTING ADDR   YM1479 11010002
*                                                                       11060002
* SET UP WRITE, NO-SPACE CCW                                    SA53794 11110002
*                                                                       11160002
         USING CCW,RCCW                                                 11190002
         MVC   CCW,PRINTCCW             WR-NOSPACE CCW TO CP     YM1479 11190102
         L     RWK3,SCWGETMA            LOAD ADDR OF GETMAINED @ZA27591 11190437
*                                       SAVEAREA               @ZA27591 11190637
         LA    RWK3,72(RWK3)            BUMP PAST REGS         @ZA24897 11191237
         MVI   0(RWK3),X'40'            MOVE IN A X'40'        @ZA24897 11191637
         STCM  RWK3,B'0111',CCWADDRB    BUFFER ADDR TO CCW       YM1479 11192402
         CLI   DCBDEVT,DCBDVPR5         IS DEVICE 3800 PRINTER @Z40MSRZ 11194410
         BNE   AMCLAD80                 NO, LEAVE WRNOSP OP    @Z40MSRZ 11196410
         MVI   CCW,SKPTO1               YES,USE SKIP TO 1      @Z40MSRZ 11196810
         DROP  RCCW                                               M1789 11198010
AMCLAD80 EXCP  IOBSTDRD                                        @Z40MSRZ 11320010
         L     R1,IOBECBPT              GET ECB ADDRESS         SA53794 11370002
         DROP  RIOB                                                     11420002
         WAIT  ECB=(1)                                           S20202 11560002
         EJECT                                                          11610002
FRWKAREA EQU   *                                                 Y02072 12164102
         L     R1,SCWGETMA              OBTAIN SAVE AREA ADDRESS M1301  12164402
         FREEMAIN R,LV=SAVELG,A=(1),SP=230                       Y02072 12165002
         MODESET  EXTKEY=DATAMGT                                 Y02072 12165402
         SPACE                                                          12165502
         MVC   WTGIDTTR,LOAD201X        ALL OK, GO CLEAN UP    @Z30TSMI 12165603
TSTFCLOS EQU   *                                                 Y02072 12165702
         TM    FCACLOS1,FCACFORC        IS FORCE CLOSE IN CNTROL Y02072 12165802
         BO    XCTL                     YES, BYPASS RELOOP FUNCT Y02072 12166202
RELOOP   EQU   *                                                 Y02072 12175002
         LA    RWTGC,L'WTGENTRY(0,RWTGC)  STEP TO NEXT ENTRY            12520002
         LA    RPARC,L'PARDCBAD(0,RPARC)  STEP TO NEXT ENTRY            12540002
         CLC   WTGIDNX,AMIDCNST         THIS RTN NEEDED AGAIN           12560002
         BCR   8,RBASE                  YES, RECURSE THRU MODULE        12580002
         CLC   WTGIDNX,CLLDB            IS THIS THE END OF THE TABLE    12600002
         BL    RELOOP                   NO BRANCH                Y02072 12620002
         CLC   WTGIDNX,CLLDG            IS THIS THE END OF THE TABLE    12640002
         BH    RELOOP                   NO BRANCH                Y02072 12660002
         LR    RPARC,RPAR               INITIALIZATION                  12680000
         DROP  RWTGC                                                    12690002
         LA    RWTGC,WTGENTRY           GET FIRST ENTRY IN WTG TABLE    12700002
         USING WTGENTRY,RWTGC                                           12750002
RELOOP1  EQU   *                                                 YM3079 12800002
         CLI   WTGIDTTR,0               CLOSE EXECS FINISHED     YM3079 12850002
*                                         FOR THIS DCB           YM3079 12900002
         BNE   XCTL                     NO, GO XCTL              YM3079 12950002
         LA    RWTGC,L'WTGENTRY(RWTGC)  YES, GET NEXT ENTRY      YM3079 12960002
         LA    RPARC,L'PARDCBAD(RPARC)  NEXT DCB ADDR            YM3079 12970002
         B     RELOOP1                  GO CHECK IF PROCESSING   YM3079 12972002
*                                         TO BE DONE ON THIS DCB YM3079 12974002
XCTL     EQU   *                                                 YM3079 12976002
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*12978003
               MODID=WTGENTRY           GO TO NEXT ROUTINE     @Z30TSMI 12980003
         EJECT                                                          12980202
*                                                                       12980602
* THIS ROUTINE TESTS THE CALLERS KEY TO DETERMINE WHETHER TO     Y02072 12982602
* BALR (IF KEY IS LT 8) OR SYNCH (IF KEY IS GT 7) TO THE ACCESS  Y02072 12984602
* METHOD ROUTINES. CLOSES REGS ARE SAVED IN THE SVRB SAVEAREA    Y02072 12986602
* AND THE USERS REGISTERS ARE LOADED AND PASSED TO THE ACCESS    Y02072 12988602
* METHOD ROUTINES (FOR THE CASE AN EOV CONDITION ARISES AND A    Y02072 12988702
* USER EOV EXIT IS TAKEN). THE SAVEAREA GOTTEN FROM SP230 IS     Y02072 12989202
* PASSED IN R13 TO THE ACCESS METHOD ROUTINES. THE SYNCH IS      Y02072 12991202
* TAKEN TO THE INSTRUCTIONS SET UP AT THE END OF THIS ROUTINE    Y02072 12991602
* (WHEN ISSUING A TRUNC) WHICH WILL CAUSE A BALR TO THE ACCESS   Y02072 12992002
* METHODS. WHEN ISSUING A PUT OR WRITE, THE SYNCH GOES DIRECTLY  Y02072 12992402
* TO THE PUT OR WRITE MODULE.                                    Y02072 12992502
*                                                                       12992802
SYNCHRTN EQU   *                                                 M0153  12993002
         L     RTCB,PSATOLD             GET CURRENT TCB ADDR     Y02072 12993402
         USING TCB,RTCB                                          Y02072 12993802
         L     RRB,TCBRBP               GET RB ADDR              Y02072 12994202
         USING RBSECT,RRB               R14 IS BASE FOR SVRB     M0153  12995002
         MODESET  EXTKEY=SUPR                                    Y02072 12995502
         SPACE 2                                                        12995902
         STM   RDCB,RIOB,RBEXSAVE       SAVE CLOSE REG IN SVRB   M1301  12996002
         MODESET  KEYADDR=DXUKEY,WORKREG=13                      Y02072 12996502
         SPACE                                                          12996902
         L     R13,SCWGETMA             GET REG SAVE AREA ADDR   Y02072 12997302
         TM    DXUKEY,KEYMASK           IS CALLERS KEY 8 OR      Y02072 12998902
*                                         HIGHER                 Y02072 13000902
         BO    PRB                      SYNCH IF GT OR EQ TO 8   Y02072 13001002
         LM    R2,R12,RBGRS2            GET USERS REGS           Y02072 13001402
         DROP  RRB                                                      13002502
         BALR  RRETRN,RBRNCH            BR TO WRITE OUT LAST BLK M0153  13003002
         USING *,RRETRN                                          Y02072 13003402
         B     RELOAD                   GO LOAD REGISTERS AND    M0153  13003502
*                                         RETURN                 M0153  13004002
         DROP  RRETRN                                            Y02072 13004402
PRB      EQU   *                                                 M0153  13004502
         USING RBSECT,RRB                                               13005002
         LM    R2,R12,RBGRS2            GET USERS REGS           Y02072 13005402
         DROP  RRB                                               M0153  13006002
         SYNCH  (15)                    BR TO PUT IN PROB PGM    M0153  13006502
*                                         STATE                  M0153  13007002
RELOAD   EQU   *                                                 Y02072 13007402
         L     RTCB,PSATOLD             CURRENT TCB ADDR         Y02072 13012802
         USING TCB,RTCB                                                 13014002
         L     RRB,TCBRBP               LOAD PTR TO SVRB         M0153  13014602
         DROP  RTCB                                                     13015202
         USING RBSECT,RRB                                        Y02072 13015602
         LM    RDCB,RIOB,RBEXSAVE       RESTORE CLOSES REGS      Y02072 13015702
         DROP  RRB                                               Y02072 13017902
*                                                                       13019902
* MUST VERIFY DEB ADDR. A NEW DEB MAY HAVE BEEN GOTTEN IF PUT OR Y02072 13021902
* TRUNC CAUSED AN END-OF-VOLUME.                                 Y02072 13023902
*                                                                       13025902
CHECKDEB EQU   *                                                 Y02072 13027902
         DEBCHK  (RDCB)                 VERIFY DEB               Y02072 13037902
         LR    RDEB,R1                  RELOAD VALID DEB ADDR    YM3838 13038002
         L     RDCB,DXPDCBAD            GET PROTECTED DCB ADDR   Y02072 13038102
         MODESET  EXTKEY=DATAMGT        KEY OF PROTECTED DCB     Y02072 13039402
         SPACE                                                          13039802
         ST    RDEB,DCBDEBAD            VALID DEB ADDR TO DCB    Y02072 13040202
         MODESET  KEYADDR=DXUKEY,WORKREG=2  RESUME USER KEY      Y02072 13040602
         SPACE                                                          13041002
         L     RDCB,DXUDCBAD            GET USERS DCB ADDR       Y02072 13041102
         BR    RWK4                     RETURN TO MAIN ROUTINE   Y02072 13041402
*                                                                       13042702
* INSTRUCTIONS USED TO GO TO THE ACCESS METHOD ROUTINES          Y02072 13044002
*                                                                       13045302
         DROP  RDCB                                              Y02072 13046602
         USING IHADCB,R1                                         Y02072 13047902
LOADPUT  L     R15,DCBPUT               INST TO LOAD PUT RTN ADD Y02072 13049202
         B     DCBTRUNC(R15)            BR TO TRUNCATE ROUTINE   Y02072 13050502
         EJECT                                                          13051802
*                                                                       13053102
* CONSTANTS                                                             13054402
*                                                                       13055702
PIRLQIES DC    X'FFFFFF'                NULL PIRL ADDRESS      @ZA10605 13056337
PRINTCCW CCW   WRNOSPAC,0,CCWSLI,NONZERO  CCW TO CLEAR PLB       YM1479 13057002
BLANKS   DC    C' '                     BUFF FOR EXCP TO CLEAR  SA53794 13060002
*                                         PLB ON PRINTERS        YM1479 13062002
*                                                                       13064002
* MODULE ID'S                                                           13066002
*                                                                       13068002
AMIDCNST DC    C'1A'                                                    13072002
CLLDB    DC    C'0B'                    ID OF IGG0200B           S20016 13075020
CLLDG    DC    C'0G'                    ID OF IGG0200G           S20016 13080020
LOAD201X DC    C'1X',VL3(IGG0201X)      ADDR OF IGG0201X       @Z30TSMI 13090003
LOAD201P DC    C'1P',VL3(IGG0201P)      ADDR OF IGG0201P       @Z30TSMI 13100003
LOAD201B DC    C'1B',VL3(IGG0201B)      ADDR OF IGG0201B       @Z30TSMI 13102003
         SPACE 2                                                        13110002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 13120002
END      EQU   *                        END OF MODULE            Y02072 13122002
         TITLE 'IGG0201A - CLOSE PARAMETER LIST'                        13124002
         IGGPARML                                                       13126002
         TITLE 'IGG0201A - DSECT FOR PSA'                               13128002
         IHAPSA                                                  Y02072 13128402
         TITLE 'IGG0201A - CCW DSECT'                                   13145002
         IHACCW                                                         13147002
         TITLE 'IGG0201A - FORMAT OF GOTTEN CORE'                       13210002
         IECDSECS  (MAIN,(IOB,NO)),EXPAND=YES                    Y02072 13340002
FORCORE  DSECT                                                   Y02072 13350002
         IGGSCW                                                         13360402
         TITLE 'IGG0201A - DSECT FOR AUDIT TRAIL'                       13360802
FORCORE  DSECT                                                   Y02072 13362202
         IHAFCAUD  ORG=YES                                       Y02072 13365002
         TITLE 'IGG0201A - IOB DSECT'                                   13366402
         IEZIOB                                                         13367802
         ORG   IOBEXTEN                                                 13370002
URECCW1A DS    0D                       CCW ONE                         13372002
         DS    X                        FILLER                          13374002
URECCW1B DS    AL3                      DATA ADDRESS CCW ONE            13374402
URECCW1F DS    H                        FLAG BYTE                       13374802
URECCW1C DS    H                        BYTE COUNT                      13376202
URECCW2A DS    0D                       CCW TWO                         13377602
         DS    X                        FILLER                          13379002
URECCW2B DS    AL3                      DATA ADDRESS CCW TWO            13380402
URECCW2F DS    H                        FLAG BYTE                       13381802
URECCW2C DS    H                        BYTE COUNT                      13383202
         ORG   IOBCSW-1                                                 13384602
         IHACSW DSECT=NO                                                13386002
         TITLE 'IGG0201A - DEB DSECT'                                   13422002
         IEZDEB                                                         13430002
         TITLE 'IGG0201A - CVT DSECT'                                   13530002
         CVT   DSECT=YES,LIST=YES                                       13940002
         TITLE 'IGG0201A - DCB DSECT'                                   14010002
         DCBD  DSORG=PS                                                 14080000
         TITLE 'IGG0201A - RB DSECT'                                    14092002
         IKJRB                                                          14100021
         TITLE 'IGG0201A - WTG TABLE DSECT'                             14113202
         IECDSECS  WTG,PREFX,EXPAND=YES                                 14114003
         ORG   WTGIDTTR                                                 14116002
WTGIDNX  DS    CL2                      ID NEXT MODULE                  14116102
WTGTTRNX DS    CL3                      TTR NEXT MODULE                 14116202
         ORG   WTGIDTTR+4                                               14116302
WTGDCBWA DS    A                        ADDR OF WORK AREA FOR DCB       14166302
         TITLE 'IGG0201A - ECB DSECT'                                   14216302
         IHAECB                                                         14266302
         TITLE 'IGG0201A - TCB DSECT'                                   14316302
         IKJTCB                                                         14366302
         TITLE 'IGG0201A - PURGE PARAMETER LIST DSECT'           YM3838 14376302
         IECDPPL  DSECT=YES                                      YM3838 14386302
         END                                                            14436310
./  ADD  SSI=71670006,NAME=IGG0201B
201B TITLE 'IGG0201B - SAM OUTPUT CLOSE EXECUTOR, ERROR HANDLING'       00020003
IGG0201B CSECT                                                          00024000
*                                                                       00026002
*MODULE NAME - IGG0201B                                                 00028002
*                                                                       00030002
*DESCRIPTIVE NAME - CLOSE EXECUTOR ERROR HANDLING ROUTINE               00032002
*                                                                       00032402
*COPYRIGHT - NONE                                                       00032802
*                                                                       00069202
*STATUS CHANGE LEVEL - SEE THE BEGINNING OF THE OBJECT CODE             00078803
*                                                                       00080802
*FUNCTION- THIS EXECUTOR IS ENTERED IF END-OF-VOLUME OR A PERMANENT     00084102
*          ERROR WAS ENCOUNTERED WHILE FLUSHING QSAM OUTPUT BUFFERS     00089403
*          OR IF IT IS BSAM ON A DASD  AND THE USER ISSUED CLOSE IN     00090003
*          THE SYNAD ROUTINE AND THE LAST OPERATION WAS A WRITE.        00100003
*        - FOR END-OF-VOLUME CONDITIONS:                                00139402
*           IT FINDS THE FIRST IOB POSTED IN ERROR AND ISSUES AN EOV    00149402
*           SVC FOR THIS IOB TO GET THE REMAINING BUFFERS RESCHEDULED.  00159402
*           ON RETURN FROM EOV IT WILL ISSUE A STOW FOR THE DATA SET    00159802
*           IF NECESSARY.                                               00159902
*        - FOR PERMANENT ERRORS:                                        00193202
*           FOR PAM DATA SETS IT WILL GO TO THE CONVERT ROUTINE         00203202
*           TO GET THE LAST TTR CONVERTED TO A MBBCCHHR.  THIS TTR      00213203
*           IS THE BEGINNING OF THE LAST OR ONLY MEMBER.                00215003
*           FOR DA OUTPUT DATA SETS IT WILL ISSUE A TRK BALANCE SVC     00225702
*           TO ERASE EVERYTHING ON A TRACK(S) FROM A SPECIFIED          00225802
*           BLOCK (MBBCCHHR) TO THE END OF THE TRACK(S). (THE PORTION   00225902
*           OF THE TRACK(S) ERASED WILL BE THE BAD RECORD).  DCBFDAD    00232703
*           AND DCBTRBAL ARE SET SO THAT COMMON CLOSE WILL BE ABLE TO   00234003
*           WRITE THE CORRECT 'LAST BLOCK TTR' AND TRACK BALANCE IN     00235003
*           THE DSCB.                                                   00236003
*        - BEFORE EXITING THIS MODULE, THE USER KEY SAVEAREA GOTTEN     00239602
*          BY IGG0201Z OR IGG0201A IS FREEMAINED.                       00246402
*                                                                       00253202
*ENTRY POINTS - IGG0201B FROM IGG0201Z OR IGG0201A                      00260003
*                                                                       00400000
*INPUT - SEE DESCRIPTION OF REGISTERS, DCB (USER'S), IOB (USER'S).      00420002
*                                                                       00440000
*OUTPUT - NONE.                                                         00460000
*                                                                       00470002
*MACROS - ACTION : STOW, EOV, WAIT, DMABCOND, IECRES,                   00472003
*                  MODESET, FREEMAIN, TRKBAL                            00472403
*                                                                       00474002
*MACROS - MAPPING : IECDSECS, IECDSECT, IEZIOB, CVT, IKJTCB, DCBD       00476002
*                   IEZDEB, IHAECB, IHAICB, IHAPSA, IGGPARML     Y02072 00478002
*                                                                       00480000
*EXTERNAL ROUTINES - CONVERT ROUTINE, TRACK BALANCE ROUTINE             00500002
*                                                                       00520000
*EXITS - NORMAL : TO IGG0201Y FOR DIRECT ACCESS                         00540003
*                 TO IGG0201X FOR TAPE                                  00550003
*                                                                       00560000
*EXITS - ERROR : ERROR ON CLOSE 'STOW'                                  00570002
*                CALL PROBLEM DETERMINATION (IGG0206M) FOR B14 ABEND    00580002
*                AND WTP                                                00600002
*              : ERROR ON LAST BLOCK OUTPUT BY IGG0201A FOR TAPE        00602037
*                ISSUE EOV FOR 001 ABEND AND WTP MESSAGE                00604037
*                                                                       00606037
*                                                                       00610002
*TABLES/WORKAREAS - WHERE TO GO TABLE (WTG)                             00620002
*                                                                       00640000
*      BYTE  0-7  NAME                                                  00660000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00680000
*      BYTE 11    CONCATENATION NUMBER                                  00700000
*      BYTE 12    ZERO                                                  00720000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00740000
*                        ALIAS INDICATOR 1 BIT                          00760000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00780000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00800000
*      BYTE 17    ZERO                                                  00820000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00840000
*      BYTE 20    TRANSLATION TABLE                                     00860000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00880000
*      BYTE 22-23 ATTRIBUTES                                            00900000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00920000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00940000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00960000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00980000
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       01000000
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        01020000
*      BYTE 40-   TABLE OF IDTTR'S                                      01040000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          01060000
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          01080000
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          01100000
*                   NOT USED                         (3 BYTES)          01120000
*                                                                       01140000
*      CLOSE WORK AREA                                                  01160002
*                                                                       01180000
*ATTRIBUTES - REENTRANT, REFRESHABLE, RUNS IN USER KEY UNLESS    Y02072 01200003
*             OTHERWISE SPECIFIED, SUPERVISOR STATE              Y02072 01210002
*                                                                       01220000
*NOTES - ALL REGISTER EQUATES BEGIN WITH AN R                           01240002
*        THE ADDR OF THE DEB MUST BE GOTTEN FROM THE PROTECTED   Y02072 01242002
*        COPY OF THE DCB FOR INTEGRITY REASONS.                  Y02072 01244002
*                                                                       01250002
*CHANGE ACTIVITY - AS FOLLOWS:                                          01252002
*                                                                       01254002
*          VS2 RELEASE 3.0 CHANGES                                      01255003
*A030410-030470,057485-057710,058636-058665                    @ZA00648 01255203
*C058768-058931,063718                                         @ZA00648 01255403
*D030200,033300,105160-105660                                  @ZA00648 01255603
*          VS2 RELEASE 2 DELETIONS                                      01256002
*000220,000788,004720,012000,024300,024600,024620,025000-025020, Y02072 01258002
*025120-025180,038700,039600-039992,040192,047600-047800,050800, Y02072 01258402
*052800,059376,059490-059661,97400-977000,12100,56980-57280,     Y02072 01258802
*65218,92580-92664,93200,95500,48000-48600,50800,52800,53400,    Y02072 01259202
*56600,57280,58614-58621,65218,92580-92664,93200,95500,          Y02072 01259302
*55600-56000,92400                                               Y02072 01259402
*38100                                                           YM1091 01259602
*                                                                YM1457 01262202
*C34000                                                          YM1477 01264202
*                                                                YM3079 01264602
*                                                                YM4640 01264702
*                                                                YM7362 01264802
*                                                                       01265002
*          VS2 RELEASE 2 DELETIONS                                      01267003
*                                                              @Z30TSMI 01267403
*                                                                       01267503
*          RELEASE 20 DELETIONS                                       * 01267602
*1273027400-030000                                               M6099  01270202
*1273                                                            M6176  01272802
*1273092500-092600                                               A35776 01275402
*1273                                                            A38803 01278002
*1273058656                                                      M5904  01280602
*1273058860                                                      M5902  01283202
*          RELEASE 21 DELETIONS                                       * 01285802
*1394058642                                                      A41680 01288402
*1394035900,036000,039600                                        M0042  01291002
*1394005800,054200,057000-057200,093200,094800-096200,096600-    S21042 01293602
*1394096800                                                      S21042 01296202
*1394025800,035800,039200-039600,089600,090000                   S21045 01298802
*1394001430-001550,005000,022392-022398,025040-025160,025800-    M0153  01301402
*1394027200,031600,034000-034200,035200-036400,037800-039700,    M0153  01304002
*1394041600,088400-088520                                        M0153  01306602
*1394                                                            M0182  01309202
*1394016600,035000                                               M1755  01311802
*1394057800-057848,058603,058643                                 M1761  01314402
*                                                               SA63266 01316402
*                                                                       01317002
          EJECT                                                         01319602
*                                                                       01322202
* REGISTER USAGE                                                        01324802
*                                                                       01327402
R0       EQU   0                        INPUT TO PROB DET AND EOV       01330002
RWK1     EQU   R0                       WORK REGISTER                   01340002
R1       EQU   1                        PARAMETER REGISTER              01360002
RWK2     EQU   R1                       WORK REGISTER                   01370002
RDCB     EQU   2                        ADDR OF USERS DCB               01380002
R2       EQU   RDCB                     INPUT TO THE CONVERT ROUTINE    01390002
RBASE    EQU   3                        BASE REGISTER                   01400002
RCORE    EQU   4                        ADDR OF CLOSE WORK AREA         01420002
RPAR     EQU   5                        PARAMETER LIST                  01440002
RWTG     EQU   6                        START OF WTG                    01460002
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 01480002
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      01500002
RCVT     EQU   9                        CVT REGISTER                    01510002
RWK3     EQU   RCVT                     WORK REGISTER            Y02072 01520002
RWK5     EQU   10                       WORK REGISTER                   01540002
RTCB     EQU   RWK5                     TCB REGISTER                    01552002
RDEB     EQU   11                       DEB ADDRESS                     01560002
RIOB     EQU   12                       IOB REGISTER                    01580002
R13      EQU   13                       SAVE AREA REG  (INPUT TO EOV)   01600002
RRETRN   EQU   14                       RETURN ADDRESS REGISTER         01620002
RWK4     EQU   RRETRN                   WORK REGISTER                   01630002
RRETCODE EQU   15                       RETURN CODE REGISTER            01640002
RBRNCH   EQU   RRETCODE                 BRANCH REGISTER                 01650402
         SPACE 5                                                        01658803
*                                                                       01659202
* EQUATES FOR CONSTANTS                                                 01659602
*                                                                       01659702
DEBUPDAT EQU   X'04'                    FOR TESTING UPDATE IN DEB M1755 01660002
UNITEXCP EQU   X'01'                    USED TO TEST CSW                02070002
INTRNLCD EQU   120                      INTERNAL CODE FOR PD     S21042 02239102
DEBDSMOD EQU   X'80'                    DEB DISP EQUAL TO MODIFY        02239502
DADEVICE EQU   X'20'                    DIRECT ACCESS DEVICES           02239902
CLEARFLG EQU   X'00'                    FOR CLEARING DCBIFLGS           02250602
DIVIDBY4 EQU   2                        FOR SHIFT LOGICAL INST          02252602
CLOSEFIN EQU   X'00'                    CLOSE FINISHED THIS DCB         02254602
NOMEMNM  EQU   X'00'                    NO MEMBER NAME IN DEB           02256602
LENUSERA EQU   0                        NO USER AREA FOR STOW           02259802
PODATAST EQU   X'02'                    FOR TESTING DSCB DSORG          02260202
TRKBAL   EQU   25                       TRACK BALANCE SVC NUMBER        02260302
SAVELG   EQU   X'48'                    LENGTH OF AREA TO FREE   Y02072 02260402
DIRACC   EQU   X'20'                    DEVICE TYPE = DIRECT AC  YM3079 02260502
         EJECT                                                          02260602
*                                                                       02262602
* ADDRESSABILITY FOR DSECTS                                             02264602
*                                                                       02266602
         USING PSA,0                                             Y02072 02276602
         USING WTG,RWTG                                                 02310002
         USING WTGENTRY,RWTGC                                           02312002
         BALR  RBASE,0                                                  02400000
         USING AMCL1,RBASE                                              02402002
*                                                                       02410002
* INITIALIZE REGISTERS                                                  02412002
*                                                                       02414002
AMCL1    EQU   *                                                        02420000
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 02420202
         DC    C'IGG0201B'              MODULE NAME              YM4640 02420402
         DC    C'@Z30TSMI'              LAST SHIP CODE         @Z30TSMI 02420603
         DC    C'10/15/74'              LAST SHIP DATE         @Z30TSMI 02420803
BEGIN    DC    0H'0'                    END OF MODULE ID       @ZA00648 02421003
         L     RCORE,WTGDCBWA           GET DCB'S WORK AREA      Y02072 02422002
         USING FORCORE,RCORE                                     Y02072 02424002
         MVC   WTGIDTTR,CLL1Y           ASSUME DA DEVICE       @Z30TSMI 02426003
         USING IHADCB,RDCB                                              02470002
         L     RDCB,DXPDCBAD            GET DATA MGT KEY DCB     YM3079 02472002
         TM    DCBDEVT,DIRACC           IS THIS A DA DEVICE      YM3079 02480002
         BO    AMCL1020                 YES, GET DEB ADDR        YM3079 02490002
         MVC   WTGIDTTR,CLL1X           SET UP FOR TAPE        @Z30TSMI 02504003
AMCL1020 EQU   *                                                 YM3079 02504402
         L     RDEB,DCBDEBAD            GET VALID DEB ADDR       YM3079 02504802
         MODESET  KEYADDR=DXUKEY,WORKREG=13                      YM3079 02506002
         SPACE                                                          02508002
         L     RDCB,DXUDCBAD            GET GET USER KEY DCB     Y02072 02508402
         USING DEBBASIC,RDEB                                            02518402
         L     RIOB,DCBIOBA             GET CURR IOB ADDRESS            02520002
         LA    RIOB,0(RIOB)             CLEAR HIGH ORDER BYTE           02540002
         LR    RWK4,RIOB                COPY ADDRESS OF CURRENT IOB     03040002
*                                                                       03041003
* FOR BSAM, THIS MODULE IS ENTERED ONLY WHEN IT IS FOR DASD, THE        03042003
* USER ISSUED CLOSE IN THE SYNAD ROUTINE AND THE LAST OPERATION         03043003
* WAS A WRITE FOR OUTPUT.                                               03044003
*                                                                       03045003
         TM    DCBCIND2,DCBCNQSM        TEST FOR QSAM          @ZA00648 03046003
         BZ    AMCL1084                 BR IF BSAM, NOT QSAM   @ZA00648 03047003
         USING IOBQSAMN,RWK4                                            03050002
*                                                                       03060000
* THE FOLLOWING CODE WILL FIND THE FIRST IOB WHICH INDICATES AN ERROR.  03120002
* IF THE ERROR IS END-OF-VOLUME, IT WILL  ISSUE AN EOV SVC TO GET THE   03140002
* PENDING IOBS RESCHEDULED AFTER A VOLUME SWITCH HAS BEEN DONE.         03160002
*                                                                       03240000
AMCL1022 EQU   *                                                        03260000
         L     RWK4,IOBNIOBA            LINK TO NEXT IOB.               03320002
         TM    IOBNECB,ECBNORM          IOB COMPLETE NORMALLY    YM7362 03380002
         BO    AMCL1022                 GO CHK NEXT IOB IF OK    YM1477 03430002
*                                                                       03440002
* NOTE - ON ENTRY TO THIS MODULE, ALL I/O WILL BE COMPLETE              03450002
*                                                                       03452002
AMCL1025 EQU   *                                                 YM1477 03454002
         TM    CSWFLGS,UNITEXCP         ERROR COND DUE TO UNIT EXCEPT.  03460002
         BZ    AMCL1090                 IF NOT, BRANCH                  03480002
*                                                                       03482002
* MUST TEST FOR UPDATE PROCESSING. IF YES CANNOT ISSUE EOV BUT   M1755  03490002
* MUST CLEAN UP LIKE PERR.                                       M1755  03500002
*                                                                       03510002
         TM    DEBOPATB,DEBACCS-DEBUPDAT BITS OTHER THAN UPDAT   M1755  03530002
         BNZ   NOTUPD                   YES, ISSUE EOV           M1755  03580002
         NI    DCBIFLGS,X'FF'-DCBIFEC   TURN OFF ERROR FLAGS     M1755  03630002
         OI    DCBCIND2,DCBCNWR0        TURN ON EOV FLAG         M1755  03640002
         MVI   IOBNECB,ECBNORM          SET ECB COMPLETE WITHOUT M1755  03650002
*                                          ERROR                 M1755  03652021
         ST    RWK4,DCBIOBA             UPDATE IOB POINTER       M1755  03654002
         B     AMCL2000                 NO EOV FOR UPDATE        YM7362 03656002
NOTUPD   EQU   *                                                 M1755  03658021
*                                                                       03658102
* AT THIS POINT THE ERROR IOB ADDRESS IS IN RWK4. MUST NOW       YM7362 03658502
* FIND THE LAST IOB IN THE RESTART CHAIN AND STORE ITS ADDRESS   YM7362 03658902
* IN DCBIOBA. (EOV WILL RESCHEDULE EVERTHING FROM THE IOB ADDR   YM7362 03659302
* IN R0 TO THE IOB ADDRESS IN DCBIOBA.)                          YM7362 03659403
*                                                                       03659602
         LR    R0,RWK4                  INPUT TO EOV             YM7362 03659702
AMCL1026 EQU   *                                                        03659802
         LR    RWK3,RWK4                SAVE IOB ADDR            YM7362 03659902
         L     RWK4,IOBNIOBA            GET NEXT IOB TO TEST     YM7362 03663202
         LA    RWK4,0(RWK4)             CLEAR HI BYTE            YM7362 03663602
         TM    IOBNECB,ECBNORM          IS THIS IOB TO BE RESCH  YM7362 03665202
         BO    AMCL1028                 NO, GO SET UP FOR EOV    YM7362 03665602
         CR    RWK4,RIOB                IS THIS THE LAST IOB     YM7362 03666002
         BNE   AMCL1026                 NO, GO TEST NEXT         YM7362 03666402
         LR    RWK3,RWK4                RESTART ALL IOB'S        YM7362 03667102
AMCL1028 EQU   *                                                        03668602
         ST    RWK3,DCBIOBA             ST AS LAST IOB IN RE-    YM7362 03669302
*                                         START CHAIN            YM7362 03670002
         LA    R1,0(RDCB)               ADDR OF DCB IN REG 1 AND YM1091 03710002
*                                         CLEAR HI BYTE          YM1091 03760002
         L     R13,SCWGETMA             LOAD WORKAREA PTR IN     Y02072 03870002
*                                         R13 TO GIVE EOV A SAVEAREA    03880002
         EOV   (1)                      GO TO EOV FOR NEW EXTENT  M0153 03910002
         SPACE                                                          03960002
*                                                                       03970002
* MUST VERIFY DEB ADDRESS. EOV MAY HAVE GOTTEN A NEW ONE.        YM1106 03980002
*                                                                       03990002
         BAL   RWK5,CHECKDEB            GO ISSUE DEBCHK          YM1106 04000002
*                                                                       04009202
* AFTER RETURN FROM EOV CHECK COMPLETION CODE OF ECB. IF IN ERROR       04019202
* GO BACK TO ISSUE EOV FOR DATA SET AGAIN.                              04029202
*                                                                       04039202
         LR    RWK4,RIOB                BEGIN LOOP WITH ORIG IOB YM7362 04198002
AMCL1035 EQU   *                                                        04200002
         L     RWK4,IOBNIOBA            LOOP UNTIL ALL IOBS ARE  YM7362 04202002
*                                         COMPLETE OR AN ERROR   YM7362 04204002
*                                         IOB IS FOUND           YM7362 04206002
         LA    RWK4,0(RWK4)             CLEAR HI BYTE            YM7362 04216002
AMCL1040 EQU   *                                                        04232402
         TM    IOBNECB,ECBNORM          THIS IOB COMPLETE OK     YM7362 04234002
         BM    AMCL1025                 NO, GO ISSUE EOV         YM7362 04234402
         BO    AMCL1045                 YES, GO TEST FOR LAST    YM7362 04236002
         WAIT  ECB=IOBNECB              WAIT IF NOT COMPLETE     YM7362 04238402
         B     AMCL1040                                                 04260002
AMCL1045 EQU   *                                                        04270002
         CR    RWK4,RIOB                MORE IOB'S TO TEST       YM7362 04280002
         BNE   AMCL1035                 YES, GET NEXT            YM7362 04290002
*                                       NO, ALL MUST HAVE COMP   YM7362 04300002
*                                         OK                     YM7362 04302002
         DROP  RWK4                                                     04304002
         SPACE 5                                                        04310003
         TM    DCBDEVT,DIRACC           IS THIS A DA DEVICE      YM3079 04311902
         BZ    AMCL2000                 NO, GO FREE WORKAREA     YM3079 04321902
*                                                                       04334002
* THE FOLLOWING SECTION OF THIS MODULE WILL ISSUE A STOW IF             04345002
* NECESSARY.                                                            04356002
*                                                                       04367002
         TM    DCBOPTCD,DCBOPTT         TEST FOR TOTALING          UT18 04378002
         BO    AMCL2000                 BR IF TOTALING SPECIFIED   UT18 04389002
         TM    DCBCIND2,DCBCNSTO        HAS STOW BEEN ACCOMPLISHED YET  04400002
         BO    AMCL2000                 YES BRANCH                      04420002
*                                                                       04460000
* PREPARE TO ISSUE A STOW ON USER MEMBERNAME IF MEMBERNAME IN DEB.      04480002
*                                                                       04500000
         SR    RWK2,RWK2                                                04520002
         SR    RWK5,RWK5                                                04540002
         IC    RWK5,DEBNMEXT            GET NUMBER OF EXTENTS           04560002
         IC    RWK2,DEBEXSCL            GET SCALING FACTOR  FOR EXTENT  04580002
         SLL   RWK5,0(RWK2)             EXTENT SIZE X EXTENT NUMBER     04600002
         LA    RWK5,DEBBASND(RWK5)      EXTENTS+DEB+BASE                04620002
         USING DEBACSMD,RWK5                                            04630002
         TM    DCBDSORG,DCBDSGPO        DCB FOR  PO DATA SET            04640002
         BO    AMCL1060                 YES BRANCH                      04660002
         LA    RWK5,DEBDSNM             ADD SAM LEN TO DEB SIZE         04700002
AMCL1060 EQU   *                                                        04720000
         DROP  RDEB                                                     04730002
         CLI   DEBDSNAM,NOMEMNM         IS MEMBERNAME IN DEB     A25961 04746002
         BE    AMCL2000                 BRANCH IF NO             A25961 04752019
*                                                                       04752402
* STOW PARM LIST MUST BE IN THE SAME KEY AS THE STOW IS ISSUED   Y02072 04752802
* IN TO KEEP STOW FROM PROGRAM CHECKING.                         Y02072 04753202
*                                                                       04753602
         L     RWK3,SCWGETMA            WORK AREA FOR PARM LIST  Y02072 04754002
         USING STOW,RWK3                                         Y02072 04756002
         MVC   STONAME,DEBDSNAM         STORE MEMBERNAME IN      Y02072 04766002
*                                         PARM LIST              Y02072 04768002
         DROP  RWK5                                                     04770002
         MVI   STOCTTRN,LENUSERA        INDIC NOT AN ALIAS AND   Y02072 04780002
*                                         LEN OF USER DATA ZERO  Y02072 04830002
         LA    RDCB,0(RDCB)             CLEAR HI BYTE            YM1457 04840002
         USING DEBBASIC,RDEB                                            04870002
         TM    DEBOFLGS,DEBDISP         THIS MEMBERNAME NEW, DISP=NEW   04900002
         BO    AMCL1070                 YES BRANCH                      04920002
         TM    DEBOFLGS,DEBDSMOD        MEMBER BEING MODIFIED, DISP=MOD 04940002
         BO    AMCL1070                 YES BRANCH                      04960002
*                                                                       04980000
* MEMBER IS BEING REPLACED IN PARTITIONED DATA SET                      05000002
*                                                                       05060000
         STOW  (RDCB),(RWK3),R          REPLACE MEMBER IN PDS    Y02072 05080002
*                                                                       05100000
         LR    RWK3,RRETCODE            SAVE STOW RETURN CODE    Y02072 05110002
         BAL   RWK5,CHECKDEB            GO VERIFY DEB ADDR       Y02027 05112002
         CH    RWK3,ERRCODE             NO ROOM AVAIL FOR FM,I/O ERROR  05120002
         BH    ABEND                    YES BRANCH - ABEND B14          05140002
         B     AMCL2000                 GO FREE WORKAREA         Y02072 05160002
AMCL1070 EQU   *                                                        05200000
*                                                                       05220000
* MEMBERNAME IS BEING ADDED TO DIRECTORY OF DATA SET                    05240002
*                                                                       05260000
         STOW  (RDCB),(RWK3),A          ADD MEMBER NAME TO DIR.  Y02072 05280002
*                                                                       05300000
         LR    RWK3,RRETCODE            SAVE STOW RETURN CODE    Y02072 05310002
         BAL   RWK5,CHECKDEB            GO VERIFY DEB ADDR       Y02072 05312002
         LTR   RWK3,RWK3                WERE THERE ANY ERRORS           05320002
         BNE   ABEND                    YES, BRANCH              Y02072 05340402
         DROP  RWK3                                              Y02072 05350002
         B     AMCL2000                 GO FREE WORKAREA         Y02072 05360002
ABEND    EQU   *                                                        05380000
*                                                                       05390002
* REG 9 WILL HAVE A RETURN CODE FROM STOW. THE RETURN CODE WILL         05401002
* RESULT IN THE  GENERATION OF THE FOLLOWING INTERNAL CODES FOR A       05402002
* B14 ABEND 04 - 121                                                    05403002
*           08 - 122                                                    05408002
*           0C - 123                                                    05409002
*           10 - 124                                                    05410002
*           14 - 125                                            SA63266 05410402
*           18 - 126                                            SA63266 05410802
* THE FOLLOWING ROUTINE WILL INITIALIZE THE INTERNAL CODE TO 120,       05412002
* DIVIDE THE RETURN CODE IN REG 9 BY 4 AND ADD THAT TO 120 TO           05414002
* CALCULATE THE INTERNAL CODE.                                          05416002
*                                                                       05418021
         LA    R0,INTRNLCD              CODE 120                 S21042 05419002
         SRL   RWK3,DIVIDBY4            DIVIDE RETURN CODE BY 4  S21042 05420002
         AR    R0,RWK3                  CALCULATE INTERNAL CODE  S21042 05421002
         L     RTCB,PSATOLD             GET CURRENT TCB          Y02072 05431002
         USING TCB,RTCB                                                 05460002
         TM    TCBFLGS1,TCBFA           IS THIS ENTRY TO CLOSE FROM     05620002
*                                         ABEND                         05640002
         BO    AMCL2000                 IF SO, BRANCH--WE MUST NOT      05650002
*                                         ABEND AGAIN.                  05680002
         MODESET  EXTKEY=DATAMGT                                 Y02072 05682002
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES      S21042 05686002
         STC   R0,SCWSAVCD              SAVE PROB DET CODE       Y02072 05688002
*                                         ACROSS FREEMAIN        Y02072 05690002
         SPACE                                                          05690402
         MODESET  KEYADDR=DXUKEY,WORKREG=1                       Y02072 05690802
         SPACE                                                          05691202
         B     AMCL2000                 GO FREE WORKAREA         Y02072 05691602
         DROP  RTCB                                                     05738002
         EJECT                                                          05748002
*********************************************************************** 05748503
*      AT THIS POINT, WE KNOW IT IS BSAM AND THE USER ISSUED A CLOSE    05749003
* AFTER HAVING GONE TO HIS SYNAD ROUTINE FOR AN OUTPUT WRITE OPERATION. 05749503
* CURRENTLY, DCBFDAD POINTS TO THE BLOCK BEFORE THE ONE FOR WHICH THE   05750003
* LAST WRITE MACRO WAS ISSUED, BUT WE WANT IT TO POINT TO THE BLOCK     05750503
* BEFORE THE ONE WITH THE ERROR.                                        05751003
*********************************************************************** 05751503
AMCL1084 EQU   *                                               @ZA00648 05752003
* FOR CHAINED SCHEDULING, WE USE IOBSEEK FROM THE IOB, NOT AN ICB.      05752503
         TM    DCBCIND2,DCBCNCHS        TEST FOR CHAINED SCHED @ZA00648 05753003
         BO    AMCL1090                 BR IF CHAINED SCHED    @ZA00648 05753503
*                                                                       05753803
* IT IS NOT CHAINED SCHEDULING.  WE MUST SEARCH FOR THE IOB THAT        05754003
* CAUSED ENTRY TO SYNAD.  WE START WITH THE ONE AFTER THE IOB POINTED   05754203
* TO BY DCBIOBA AND SEARCH FOR THE LAST ONE THAT WAS NOT POSTED WITH    05754403
* 00, 48 OR 7F.  WE CANNOT LOOK AT THE ECB BECAUSE IT IS IN THE USER'S  05754603
* DECB AND MAY HAVE BEEN FREED OR OVERLAID, SO WE LOOK AT IOBECBCC,     05754803
* WHICH IS WHAT IOS USED TO POST THE ECB.  00 MEANS THE IOB HAS NEVER   05755003
* BEEN USED.  48 MEANS IT WAS PURGED DUE TO AN ERROR IN A DIFFERENT     05755203
* IOB.  7F MEANS IT COMPLETED SUCCESSFULLY.  WE MUST LOOK FOR THE LAST  05755403
* SUCH POSTING BECAUSE THE USER MAY HAVE GONE TO SYNAD MORE THAN ONCE   05755603
* AND IGNORED ALL EXCEPT THE LAST ERROR.                                05755803
*                                                                       05756203
         LR    RWK2,RIOB                SAVE LOOP STOPPER      @ZA00648 05756603
AMCL1086 EQU   *                        LOOP TO SEARCH IOBS    @ZA00648 05757003
         USING IOBBSAMN,RIOB                                   @ZA00648 05757403
         L     RIOB,IOBNIOBA            POINT TO NEXT IOB      @ZA00648 05757803
         LA    RIOB,0(,RIOB)            CLEAR HI-ORDER BYTE    @ZA00648 05757903
         TM    IOBECBCC,ECBNORM-ECBREPRG  TEST COMPLETION      @ZA00648 05758003
         BNM   AMCL1088                 BR IF 00, 48 OR 7F     @ZA00648 05758103
         LR    RWK4,RIOB                SAVE IOB THAT IS BAD   @ZA00648 05758203
AMCL1088 EQU   *                                               @ZA00648 05758303
         CR    RIOB,RWK2                TEST FOR END OF LOOP   @ZA00648 05758403
         BNE   AMCL1086                 LOOP IF MORE IOBS      @ZA00648 05758503
* THE TRKBAL SVC WILL TEST THIS IOB FOR WRITE STATUS.                   05758603
         ST    RIOB,DCBIOBA             SAVE LAST BAD IOB      @ZA00648 05758703
* THE TRKBAL SVC USES THE ECB POINTED TO BY THE IOB.  SINCE IT NOW      05758803
* POINTS TO THE USERS DECB, WHICH CANNOT BE USED HERE, WE MUST USE      05759003
* THE IOB PREFIX AS AN ECB.                                             05759103
         LA    RWK2,IOBNECB             PT TO SAM'S WORK ECB   @ZA00648 05759203
         ST    RWK2,IOBECBPT            SHOW ECB TO TRKBAL     @ZA00648 05759303
         DROP  RIOB                                            @ZA00648 05759703
*                                                                       05759803
AMCL1090 EQU   *                        QSAM OUTPUT ENTERS HERE         05760003
*                                                                       05761003
*********************************************************************** 05762003
*      THERE HAS BEEN AN OUTPUT ERROR OTHER THAN END-OF-VOLUME.  IT IS  05763003
*  ONE OF THE FOLLOWING SITUATIONS.                                     05764003
*      1. BSAM, AND THE USER HAS ISSUED CLOSE AFTER HAVING ENTERED      05765003
*         THE SYNAD ROUTINE FOR A NON-UPDATE WRITE AND THE USER HAS     05766003
*         NOT MODIFIED THE DCB TO ATTEMPT TO CONTINUE USING IT.         05767003
*      2. QSAM, AND AN ERROR OCCURED.  THE USER MAY HAVE CLOSED IN THE  05768003
*         SYNAD ROUTINE OR THE ERROR MAY HAVE BEEN ENCOUNTERED DURING   05769003
*         CLOSE'S FLUSHING OF BUFFERS.                                  05770003
*********************************************************************** 05771003
*                                                                       05818437
         TM    DCBOFLGS,DCBOFLWR        LAST OPERATION A WRITE     8383 05821437
         BZ    AMCL2000                 NO, BRANCH                 8383 05824437
         TM    DCBCIND2,DCBCNQSM        TEST FOR QSAM          @ZA11562 05827437
         BZ    AMCL1091                 BRANCH IF BSAM         @ZA11562 05830437
         LR    RWK2,RDCB                GET DCB ADDR FOR EOV   @ZA11562 05833437
         LA    RWK2,0(0,RWK2)           CLR HI ORDER FOR EOV   @ZA11562 05836437
*                                       R1 HI ORDRER BIT ON    @ZA11562 05839437
*                                       MEANS R0 = ABEND CODE  @ZA11562 05842437
         LR    R0,RWK4                  LOAD IOB ADDR FOR EOV  @ZA11562 05845437
         L     R13,SCWGETMA             GIVE EOV A SAVE AREA   @ZA11562 05848437
         EOV   (1)                      ISSUE EOV FOR 001 ABEND@ZA11562 05851437
*                                                                       05854437
*********************************************************************** 05863603
*      IF IT IS A SEQUENTIAL DATA SET, WE WANT TO SET DCBFDAD TO POINT  05863803
* TO THE BLOCK BEFORE THE BLOCK THAT WAS ATTEMPTED TO BE WRITTEN.  IT   05863903
* NOW POINTS TO WHERE THE USER'S LAST BLOCK WOULD HAVE BEEN WRITTEN IF  05864003
* A PREVIOUS ONE HAD NOT GOTTEN AN ERROR.  THESE ARE PROBABLY DIFFERENT 05864103
* BLOCKS.                                                               05864303
*      IF IT IS A PARTITIONED DATA SET, WE WANT TO POINT DCBFDAD TO     05864403
* THE BEGINNING OF THE MEMBER BEING WRITTEN SO THAT THERE WILL NOT BE   05864503
* UNUSED SPACE IN THE PDS AND SO THAT SOME FUTURE USER OF THE DATA SET  05864603
* WILL NOT RUN INTO THE BAD TRACK WHILE IN THE MIDDLE OF COMPRESSING    05865003
* THE DATA SET.                                                         05865103
*      WHETHER SEQUENTIAL OR PARTITIONED, IT IS POSSIBLE THAT THE       05865203
* CURRENT ERROR WAS CAUSED BY A USER-PROGRAM ERROR AND NOT BY A BAD     05865303
* TRACK OR, IF IT IS A BAD TRACK, THE DATA MAY BE RECOVERED WITH THE    05865403
* ATLAS MACRO OR THE IEHATLAS UTILITY.  WE WISH TO MAXIMIZE THE         05865503
* CHANCES THAT THE NEXT USER OF THIS DATA SET CAN EXTEND IT BY USING    05865603
* DISP=MOD ON THE DD STATEMENT.  THIS REQUIRES A CORRECT VALUE HERE     05865703
* FOR DCBFDAD, A CORRECT VALUE FOR DCBTRBAL AND THAT THE BAD PLACE      05865803
* ON THE TRACK BE ERASED.  DATA WILL NOT NECESSARILY BE ADDED ON THIS   05865903
* TRACK.                                                                05866203
*********************************************************************** 05866503
*                                                                       05866837
AMCL1091 EQU   *                                               @ZA11562 05866937
         TM    DCBDEVT,DIRACC           IS THIS A DA DEVICE?   @ZA11562 05867037
         BZ    AMCL2000                 NO, GO FREE WORKAREA   @ZA11562 05867137
         TM    DSCFILTY,PODATAST        PARTITIONED ORGANIZATION  M1761 05867237
         BO    AMCL1097                 YES, BRANCH                8383 05867337
*                                                                       05867402
* MUST UPDATE DCBFDAD BEFORE GOING TO TRACK BALANCE ROUTINE.            05869402
* TEST FOR CHAINED SCHEDULING BEFORE MOVING IOBSEEK FIELD.        M5904 05871802
*                                                                       05873802
         TM    DCBCIND2,DCBCNCHS        CHAINED SCHEDULING USED   M5904 05874302
         BZ    NOTCHAIN                 NO, BR AROUND             M5904 05876803
*                                                                       05878902
* FOR NORMAL SCHEDULING, RWK4 HAS THE ADDRESS OF THE IOB.  FOR CHAINED  05879003
* SCHEDULING, WE NOW POINT RWK4 TO BEFORE THE IOB (NOT ICB) SO THAT IT  05879103
* LOOKS LIKE A NORMAL SCHEDULING IOB SO ITS SEEK FIELD CAN BE COPIED.   05879503
*                                                                       05881102
         USING IOBBSAMC,RWK4                                            05883103
         L     RWK4,DCBIOBAD            PT TO CHAIN SCHED IOB  @ZA00648 05885103
         LA    RWK4,IOBQSAMN            ADJUST AS IF NORM SCHED@ZA00648 05889103
*                                                                       05891103
NOTCHAIN EQU   *                                                  M5904 05893103
         USING IOBQSAMN,RWK4                                            05895102
         MVC   DCBFDAD,IOBSEEK          MOVE FROM X'28' OFFSET    M5904 05897102
         B     AMCL1098                                            8383 05899102
         DROP  RWK4                                                     05899502
*                                                                       05901102
* MUST CONVERT FULL DISK ADDRESS BEFORE GOING TO TRACK BALANCE ROUTINE  05903102
* FOR PAM DATA SETS.                                                    05903502
*                                                                       05905102
AMCL1097 EQU   *                                                   8383 05907102
         MODESET  EXTKEY=DATAMGT                                 Y02072 05907502
         STM   RWK1,RRETCODE,SCWRALL    SAVE ALL REGISTERS         8383 05909102
         MODESET  KEYADDR=DXUKEY,WORKREG=13                      Y02072 05911102
         L     RWK1,DCBRELAD            GET TTR TO BE CONVERTED    8383 05914802
         SRL   RWK1,8                   SHIFT OUT R VALUE          8383 05920502
         BCTR  RWK1,0                   SUBTRACT 1                 8383 05926202
         SLL   RWK1,8                   SHIFT BACK                 8383 05931902
         LR    R1,RDEB                  GET DEB ADDR             Y02072 05941902
         LA    R2,DCBFDAD               POINT TO FULL DISK ADDRESS 8383 05971802
         DROP  RDCB                                                     05981802
         L     RCVT,CVTPTR              ADDRESS AF CVT             8383 06021802
         USING CVT,RCVT                                          Y02072 06031802
         L     RBRNCH,CVTPCNVT          CONVERT ROUTINE ADDRESS    8383 06071802
         BALR  RRETRN,RBRNCH            BRANCH TO CONVERT ROUTINE  8383 06121802
         LM    RWK1,RBRNCH,SCWRALL      RESTORE REGISTERS          8383 06171802
AMCL1098 EQU   *                                                   8383 06221800
         USING IHADCB,RDCB                                              06231802
         LA    R1,0(RDCB)               LOAD DCB ADDRESS          M3940 06271802
         USING IOBQSAMN,RIOB                                            06291802
         OI    IOBNFLG1,IOBWRITE        TURN ON WRITE BIT          8383 06321802
         NI    DCBIFLGS,X'FF'-DCBIFEC   TURN OFF ERROR FLAGS   @ZA00648 06371803
         SVC   TRKBAL                   DETERMINE TRACK BALANCE    8383 06421802
         EJECT                                                          06428202
*                                                                       06441802
* FREEMAIN USER KEY WORKAREA AND XCTL TO NEXT MODULE                    06451802
*                                                                       06461802
AMCL2000 EQU   *                                                        06471800
         L     R1,SCWGETMA              ADD OF WORK AREA TO FREE Y02072 06475802
         FREEMAIN  R,LV=SAVELG,A=(1),SP=230                      Y02072 06480602
         SPACE 2                                                        06481002
         MODESET  EXTKEY=DATAMGT        XCTL IN DATA MGT KEY     Y02072 06481402
         SPACE 2                                                        06481502
         SR    R0,R0                    PREPARE REG FOR PD CODE  Y02072 06491502
         IC    R0,SCWSAVCD              ASSUME NEXT MODULE IS PD Y02072 06501502
*                                         (NO HARM DONE IF NOT)  Y02072 06503502
         CLC   WTGIDNX,PDLOAD           IS NEXT MODULE PD        Y02072 06511502
         BE    AMCL5019                 YES, DO NOT RELOOP       Y02072 06521502
         EJECT                                                          06621802
*                                                                       06671802
* LOOP THROUGH WTG TABLE ENTRIES TO SEE IF THIS ROUTINE IS NEEDED AGAIN 06721802
*                                                                       06771802
RELOOP1  EQU   *                                                 S21045 08855021
         LA    RWTGC,L'WTGENTRY(0,RWTGC)  STEP TO NEXT ENTRY            08860002
         LA    RPARC,L'PARDCBAD(0,RPARC)  STEP TO NEXT ENTRY            08880002
         CLC   WTGIDNX,AMIDCNST         THIS RTN NEEDED AGAIN           08900002
         BCR   8,RBASE                  YES, ECURSE THRU MODULE         08920002
         CLC   WTGIDNX,CLLDB            IS THIS THE END OF THE TABLE?   08940002
         BL    RELOOP1                  NO BRANCH                S21045 08960021
         CLC   WTGIDNX,CLLDG            IS THIS THE END OF THE TABLE?   08980002
         BH    RELOOP1                  NO BRANCH                S21045 09000021
         LR    RPARC,RPAR               INITIALIZATION                  09020000
         DROP  RWTGC                                                    09030002
         LA    RWTGC,WTGENTRY           GET FIRST ENTRY IN WTG TABLE    09040002
         USING WTGENTRY,RWTGC                                           09050002
AMCL5011 EQU   *                                                        09060000
         CLI   WTGIDTTR,CLOSEFIN        IS THIS ENTRY FINISHED          09080002
         BNE   AMCL5019                 NO BRANCH                       09100002
         LA    RWTGC,L'WTGENTRY(0,RWTGC) STEP TO NEXT ENTRY             09120002
         LA    RPARC,L'PARDCBAD(0,RPARC) STEP TO NEXT ENTRY             09140002
         B     AMCL5011                 CHECK NEXT ENTRY                09160002
AMCL5019 EQU   *                                                        09200000
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*09250003
               MODID=WTGENTRY          GO TO NEXT ROUTINE      @Z30TSMI 09300003
         EJECT                                                          09330002
*                                                                       09330402
* THIS ROUTINE WILL VERIFY THE DEB ADDRESS AND THEN UPDATE THE   Y02072 09330802
* PROTECTED COPY OF THE DCB AND THIS MODULES DEB REGISTER.       Y02072 09331202
*                                                                       09331602
CHECKDEB EQU   *                                                 Y02072 09331702
         DEBCHK  (RDCB)                 VERIFY DEB ADDRESS       Y02072 09331802
         LR    RDEB,R1                  GET VALID DEB ADDRESS    Y02072 09331902
         L     RDCB,DXPDCBAD            GET PROTECTED DCB ADDR   Y02072 09340602
         MODESET  EXTKEY=DATAMGT        KEY OF PROTECTED DCB     Y02072 09342602
         SPACE                                                          09344602
         ST    RDEB,DCBDEBAD            UPDATE PROTECTED DCB     Y02072 09346602
         MODESET  KEYADDR=DXUKEY,WORKREG=2  RESUME USER KEY      Y02072 09348602
         SPACE                                                          09349002
         L     RDCB,DXUDCBAD            GET USERS DCB ADDR       Y02072 09349402
         BR    RWK5                     RETURN                   Y02072 09349502
         EJECT                                                          09349602
*                                                                       09349802
* CONSTANTS                                                             09358502
*                                                                       09367202
AMIDCNST DC    C'1B'                                                    09375902
CLLDB    DC    C'0B'                    FOR TEST END OF WTG TAB  S19015 09384602
CLLDG    DC    C'0G'                    FOR TEST END OF WTG TAB  S19015 09393302
CLL1Y    DC    C'1Y',VL3(IGG0201Y)      NEXT EXEC FOR DA       @Z30TSMI 09402003
CLL1X    DC    C'1X',VL3(IGG0201X)      NEXT MOD FOR TAPE      @Z30TSMI 09404003
PDLOAD   DC    C'6M',VL3(IGG0206M)      PROB DETERMINATION     @Z30TSMI 09412003
ERRCODE  DC    H'8'                     IF STOW RETURN CODE IS HIGHER,  09420002
*                                         GO TO PROBLEM DETER           09430002
         SPACE                                                          09480002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 09490002
END      EQU   *                        END OF THIS MODULE       Y02072 09584002
         TITLE 'IGG0201B - DSECT FOR PSA'                               09590002
         IHAPSA                                                  Y02072 09592002
         TITLE 'IGG0201B - DSECT FOR STOW PARAMETER LIST'               09600002
         IHASTOW                                                        09610002
         TITLE 'IGG0201B - WTG TABLE DSECT'                             09650002
         IECDSECS WTG,PREFX,EXPAND=YES                                  09670003
         ORG   WTG+8                                             Y02072 09720102
WRKRETRN DS    A                        RETURN ADDR TO FORCE     Y02072 09720202
*                                         CLOSE EXECUTOR         Y02072 09720302
         ORG   WTGIDTTR                                                 09726402
WTGIDNX  DS    CL2                      ID NEXT MODULE                  09728402
         ORG   WTGIDTTR+4                                               09732402
WTGDCBWA DS    A                        ADDR OF WORK AREA FOR DCB       09734402
         TITLE 'IGG0201B - FORMAT OF GOTTEN CORE'                       09735502
         IECDSECS  (MAIN,(IOB,NO)),EXPAND=YES                    Y02072 09740002
         TITLE 'IGG0201B - DSECT FOR FORCE CLOSE AUDIT TRAIL'           09750002
FORCORE  DSECT                                                   Y02072 09790002
         IHAFCAUD  ORG=YES                                       Y02072 09800002
         IGGSCW                                                         09820002
         TITLE 'IGG0201B - IOB DSECT'                                   09854502
         IEZIOB                                                         09855702
         ORG   IOBCSW                                                   09860002
         DS    3X                                                       09870002
CSWFLGS  DS    2B                                                       09920002
         TITLE 'IGG0201B - CVT DSECT'                                   10230002
         CVT   DSECT=YES                                                10260002
         TITLE 'IGG0201B - TCB DSECT'                                   10290002
         IKJTCB                                                         10330002
         TITLE 'IGG0201B - DCB DSECT'                                   10390002
         DCBD  DSORG=PS                                                 10400000
         TITLE 'IGG0201B - DEB DSECT'                                   10410402
         IEZDEB                                                         10412002
         TITLE 'IGG0201B - ECB DSECT'                                   10414402
         IHAECB                                                         10416002
         TITLE 'IGG0201B - CLOSE PARAMETER LIST DSECT'                  10616002
         IGGPARML                                                       10666002
         END                                                            50420000
./  ADD  SSI=71180740,NAME=IGG0201X
 TITLE 'IGG0201X - SAM CLOSE EXECUTOR, NON-DIRECT ACCESS - LOAD 2'      00006002
IGG0201X CSECT                                                          00012020
*                                                                       00014002
*MODULE NAME - IGG0201X                                                 00016002
*                                                                       00016402
*DESCRIPTIVE NAME - RESTORE RESOURCES AND CLEAN UP FOR NON-DA           00016802
*                                                                       00017202
*COPYRIGHT - NONE                                                       00017602
*                                                                       00017702
*STATUS CHANGE LEVEL 003                                                00048002
*                                                                       00054020
*FUNCTION - THE FOLLOWING WILL BE PERFORMED BY THIS CLOSE EXECUTOR FOR  00068002
*           BSAM/QSAM DATA SETS NON-DIRECT ACCESS:                      00078002
*         - IT WILL FREEMAIN THE RECORD AREA IF GOTTEN BY OPEN.         00128002
*         - IT WILL FREEMAIN ANY BUFFERS GOTTEN BY OPEN IF              00180002
*           CONCATENATION WITH UNLIKE ATTRIBUTES.                       00200002
*           FOR ALL OTHER CONDITIONS BUFFERS WILL BE RETURNED TO        00240002
*           THE POOL.                                                   00250002
*         - IT FREEMAINS THE IOBS/ICBS GOTTEN BY OPEN.                  00260002
*         - IT FREEMAINS THE FCR TABLE FOR 3886 OCR DEVICES.            00270002
*         - CLEAR FIELDS IN THE DCB SO THAT IT CAN'T BE USED UNLESS     00280002
*           IT IS OPENED AGAIN.                                         00300002
*         - SETS APPROPRIATE AUDIT TRAIL BITS IN THE O/C/E       Y02072 00342002
*           WORKAREA IN CASE THE USERS STAE ROUTINE SHOULD GET   Y02072 00344002
*           CONTROL DURING A FORCE CLOSE SITUATION. (THESE       Y02072 00346002
*           BITS, ALTHOUGH SET DURING NORMAL CLOSE, HAVE NO      Y02072 00348002
*           MEANING).                                            Y02072 00348402
*                                                                       00360020
*ENTRY POINT - IGG0201X FROM IGG0201A OR IGG0201B                       00380003
*                                                                       00400020
*INPUT - SEE DESCRIPTION OF REGISTERS, DCB(USERS), IOB(USERS).          00420002
*                                                                       00440020
*OUTPUT - NONE                                                          00460002
*                                                                       00480020
*MACROS - ACTION : FREEMAIN, IECRES, MODESET                            00490003
*                                                                       00492002
*MACROS - MAPPING : IECDSECT, IECDSECS, DCBD, IGGBCB, IHACCW, IEZDEB,   00494002
*                   IEZIOB, IGGPARML, IGGSCW, IHAFCAUD                  00496002
*                                                                       00498002
*EXTERNAL ROUTINES - NONE                                               00500002
*                                                                       00520020
*EXITS - NORMAL : TO IGG0200B, IGG0200G                                 00540003
*                                                                       00560020
*EXITS - ABNORMAL : BR 14 TO FORCE CLOSE EXEC IF FORCE CLOSE IN  Y02072 00570002
*                   CONTROL                                      Y02072 00580002
*                                                                       00582002
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN USER KEY UNLESS       Y02072 00584002
*             OTHERWISE SPECIFIED, SUPERVISOR STATE              Y02072 00586002
*                                                                       00590002
*TABLES/WORKAREAS - WHERE TO GO TABLE (WTG)                             00620002
*                                                                       00640020
*      BYTE  0-7  NAME                                                  00660020
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00680020
*      BYTE 11    CONCATENATION NUMBER                                  00700020
*      BYTE 12    ZERO                                                  00720020
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00740020
*                        ALIAS INDICATOR 1 BIT                          00760020
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00780020
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00800020
*      BYTE 17    ZERO                                                  00820020
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00840020
*      BYTE 20    TRANSLATION TABLE                                     00860020
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00880020
*      BYTE 22-23 ATTRIBUTES                                            00900020
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00920020
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00940020
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00960020
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00980020
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       01000020
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        01020020
*      BYTE 40-   TABLE OF IDTTR'S                                      01040020
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          01060020
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          01080020
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          01100020
*                   NOT USED                         (3 BYTES)          01120020
*                                                                       01140020
*      CLOSE WORK AREA                                                  01150002
*                                                                       01220020
*NOTES - ALL REGISTER EQUATES BEGIN WITH THE CHARACTER R.               01240002
*        THE DEB ADDRESS IS GOTTEN FROM THE PROTECTED DCB FOR    Y02072 01240102
*        INTEGRITY REASONS.                                      Y02072 01240202
*                                                                       01240402
*CHANGE ACTIVITY - AS FOLLOWS:                                          01242002
*                                                                       01244002
*          VS2 RELEASE 01 DELETIONS/CHANGES                             01246002
*D097000-097200                                                  YM0928 01248002
*                                                                       01248402
*          VS2 RELEASE 02 DELETIONS/CHANGES                             01248802
*000080,000200,000340,000480,004900,024900,025200,025204,        Y02072 01249202
*025300-025324,025500-025720,097762,100600,103700-103960,115800, Y02072 01249602
*115900,116200-116300,117720,117880,124480,133400,133600,        Y02072 01249702
*124700-124968,129800,132700,100200,100340,115400,117600,117720, Y02072 01249802
*120000-120400,121000                                            Y02072 01249902
*24620-24640                                                     YM3079 01253402
*                                                                YM4640 01253502
*                                                                YM7595 01255502
*                                                                YM6889 01257502
*C125000                                                       @AZ09146 01262537
*          VS2 RELEASE 03 DELETIONS/CHANGES                             01267503
*                                                              @Z30TSMI 01267903
*          RELEASE 21 DELETIONS/CHANGES                                 01268502
*                                                                A48163 01272002
*                                                                A45221 01275502
*                                                                M0008  01279002
* 123400                                                         A40495 01282502
*                                                                A45280 01286002
*                                                               SA67354 01288002
*                                                                       01289502
         EJECT                                                          01293002
*                                                                       01296502
* REGISTER USAGE                                                        01300002
*                                                                       01320020
RWK1     EQU   0                        WORK REGISTER                   01340002
R1       EQU   1                        PARAMETER REGISTER              01360002
RWK2     EQU   R1                       WORK REGISTER                   01370002
RDCB     EQU   2                        ADDR OF USERS DCB               01380002
RBASE    EQU   3                        BASE REGISTER                   01400002
RCORE    EQU   4                        ADDR OF CLOSE WORK AREA         01420002
RPAR     EQU   5                        PARAMETER LIST                  01440002
RWTG     EQU   6                        START OF WTG                    01460002
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 01480002
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      01500002
RWK7     EQU   9                        WORK REGISTER                   01520002
RWK4     EQU   10                       WORK REGISTER                   01530002
RDEB     EQU   11                       DEB ADDRESS                     01560002
RIOB     EQU   12                       IOB REGISTER                    01590002
RWK3     EQU   RIOB                     WORK REGISTER                   01600002
RWK5     EQU   14                       WORK REGISTER                   01620002
RBRNCH   EQU   RWK5                     RETURN REGISTER          Y02072 01630002
R15      EQU   15                       PARAMETER REGISTER       Y02072 01632002
RWK6     EQU   R15                      WORK REGISTER                   01640002
         EJECT                                                          01650002
*                                                                       01660020
* EQUATES FOR CONSTANTS                                                 01662002
*                                                                       01664002
RDBACKB  EQU   X'03'                    TEST FOR READ BACKWARD    OC022 02100002
OUTINOUT EQU   X'07'                    TEST FOR OUTPUT OR OUTIN  OC022 02232002
OCR3886  EQU   X'57'                    DCBDEVT FOR 3886 OCR    XL03127 02273002
FCRTBLSZ EQU   2048                     3886 FCR TABLE SIZE     XL03127 02275002
DEFLTCP  EQU   1                        DEFAULT NO OF CHAN PGMS         02332402
CLOSEFIN EQU   0                        CLOSE FINISHED THIS DCB         02332802
MIOBSIZE EQU   48                       SIZE OF MAIN IOB IN CHAIN SCHED 02333202
INVALADD EQU   X'01'                    USED TO INVALIDATE       Y02072 02333602
*                                         ADDRESS VECTORS        Y02072 02333802
CLEARIND EQU   0                        FOR CLEARING ONE BYTE INDIC'S   02334002
DCBLNFMT EQU   X'FF'                    FOR CLEARING LINE FORMAT        02343702
*                                         NUMBER ON 3886 OCR DEVICES    02353702
         EJECT                                                          02359602
*                                                                       02372202
* ADDRESSABILITY FOR DSECTS                                             02384802
*                                                                       02397402
         USING WTG,RWTG                                                 02410002
         USING WTGENTRY,RWTGC                                           02420002
         BALR  RBASE,0                                                  02440020
         USING AMCL1,RBASE                                              02450002
AMCL1    EQU   *                                                        02460020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 02462002
         DC    C'IGG0201X'              MODULE NAME              YM4640 02464002
         DC    C'@AZ09146'              LAST SHIP CODE         @AZ09146 02466037
         DC    C'03/10/76'              LAST SHIP DATE         @AZ09146 02467037
BEGIN    DS    0H                       END OF MODULE ID         YM4640 02468402
         L     RCORE,WTGDCBWA           GET DCB'S WORK AREA      Y02072 02470002
         USING FORCORE,RCORE                                     Y02072 02472002
         L     RDCB,DXPDCBAD            GET PROTECTED DCB ADDR   Y02072 02472402
         USING IHADCB,RDCB                                       Y02072 02472802
         L     RDEB,DCBDEBAD            GET VALID DEB ADDR       Y02072 02473202
         USING DEBBASIC,RDEB                                            02473602
         MODESET  KEYADDR=DXUKEY,WORKREG=13                      Y02072 02474002
         SR    RWK7,RWK7                PREPARE FOR IC INST             02480002
         L     RDCB,DXUDCBAD            GET DCB BEING CLOSED     Y02072 02520002
         L     RIOB,DCBIOBA             GET CURR IOB ADDRESS            02580002
         LA    RIOB,0(RIOB)             CLEAR HIGH ORDER BYTE           02600002
         USING IOBQSAMN,RIOB                                            02650002
         CLI   DCBDEVT,DCBDVTRM         TSO TERMINAL                    05660002
         BE    AMCL5000                 YES, BRANCH                     06660020
         TM    DCBCIND2,DCBCNQSM        DCB USING QSAM                  09580002
         BZ    AMCL3000                 NO BRANCH                       09600002
         TM    DCBCIND1,DCBCNEXB        EXCHANGE BUFFERING USED         09640002
         BO    AMCL3000                 YES BRANCH                      09660002
         L     RWK5,DCBBUFCB            GET BUFFER POOL CNTRL BLK       09740002
*                                                                       09750021
* IF A RECORD AREA WAS ACQUIRED BY OPEN, IT SHOULD BE RETURNED TO       09752021
* THE SUPERVISOR.                                                       09754021
*                                                                       09756021
         LA    RWK5,0(RWK5)             CLEAR HIGH ORDER BYTE    A48163 09758002
         USING BCBLK,RWK5                                               09758102
         TM    BCBFLGS,BCBLRI           RECORD AREA INDICATOR ON A48163 09758402
         BZ    AMCL2010                 BRANCH NO TO CHECK OFLGS A48163 09758821
         TM    DCBCIND2,DCBCNBFP        DID OPEN ACQUIRE POOL    A48163 09759002
         BZ    AMCL2010                 BRANCH NO TO CHECK OFLGS A48163 09759121
         L     R1,BCBLRIAR              GET RECORD AREA ADDR     A48163 09766002
         USING LRIAREA,R1                                               09768002
         L     RWK4,LRILGTH             GET LENGTH OF RECORD AREA       09769402
         LA    RWK4,0(RWK4)             CLR HI BYT FOR OR INST   YM6889 09771402
         FREEMAIN R,LV=(RWK4),A=(1),SP=0  FREE RECORD AREA       Y02072 09776202
         SPACE 2                                                        09778202
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 09778602
         SPACE 2                                                        09779002
         OI    FCACLOS1,FCACRECA        REC AREA FREED           Y02072 09779402
         SPACE 2                                                        09779502
         MODESET  KEYADDR=DXUKEY,WORKREG=13  BACK TO USER KEY    Y02072 09785502
         SPACE 2                                                        09787502
         NI    BCBFLGS,X'FF'-BCBLRI     TURN OFF RECORD AREA FLAG       09792002
         XC    BCBLRIAR,BCBLRIAR        CLEAR RECORD AREA ADDR          09798002
AMCL2010 EQU   *                                                        09804002
         SR    RWK6,RWK6                CLEAR REGISTER           YM0928 09810002
         IC    RWK6,DCBBUFNO            GET NUMBER OF BUFFERS    YM0928 09816002
*                                        TO FREE                        09822002
         TM    DCBOFLGS,DCBOFEOV        CONCATENATION UNLIKE ATTRIBUTES 09828002
         BZ    AMCL2030                 NO BRANCH TO FREE BUFFERS       09834002
         TM    DCBCIND2,DCBCNBFP        DID OPEN ACQUIRE POOL           09840002
         BZ    AMCL2030                 NO BRANCH TO RETURN BUFFERS     09860002
*                                         TO THE POOL                   09870002
*                                                                       09900020
* FREE BUFFER POOL  OPEN WILL ACQUIRE A NEW ONE LATER                   09920002
*                                                                       09940020
AMCL2020 EQU   *                                                        09950002
         LR    R1,RWK5                  SAV CNTRL BLK ADDR FOR FREEMAIN 09960002
         DROP  RWK5                                                     09970002
         USING BCBLK,RWK2                                               09972002
         LH    RWK5,BCBBUFSZ            GET BUFFER SIZE                 09980002
         MR    RWK5,RWK5                TOTAL AMT REQUIRED FOR BUFFERS  10000002
         LA    RWK4,BCBNLN(RWK6)        ADD EIGHT FOR CNTRL BLK  Y02072 10020002
         TM    BCBFLGS,BCBEXTND         IS BUFCB LENGTH 16 BYTES A48163 10030002
         BNO   FREE                     NO, GO FREE POOL                10032021
         LA    RWK4,BCBEXLN(RWK4)       YES, ADD 8 BYTES MORE    Y02072 10034002
FREE     EQU   *                                                 A48163 10036021
*                                                                       10040020
         FREEMAIN R,LV=(RWK4),A=(1),SP=0  FREE BUFFER POOL       Y02072 10060002
         SPACE 2                                                        10110002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 10112002
         SPACE 2                                                        10114002
         OI    FCACLOS1,FCACBUFC        BUFFERS FREED            Y02072 10116002
         SPACE 2                                                        10118002
         MODESET  KEYADDR=DXUKEY,WORKREG=13  BACK TO USER KEY    Y02072 10118402
         SPACE 2                                                        10118802
         XC    DCBBUFCA,DCBBUFCA        CLEAR ADDRESS IN DCB            10120002
         OI    DCBBUFCB+3,INVALADD      SET INVALID ADDRESS             10140002
         B     AMCL3000                                                 10160020
*                                                                       10210002
* BEFORE RELINKING BUFFERS IT MUST BE KNOWN IF IT CAN BE DONE    YM7595 10260002
* SAFELY. IF THIS IS A FORCE CLOSE SITUATION, OPEN COULD HAVE    YM7595 10270002
* BEEN IN THE PROCESS OF UNCHAINING BUFFERS FOR CCW BUFFER       YM7595 10272002
* ADDRESSES WHEN THE ERROR OCURRED. IF THIS IS THE CASE, THE     YM7595 10274002
* STATE OF THE BUFFER POOL IS NOT KNOWN AND THEREFORE IT WOULD   YM7595 10276002
* BE RISKY TO TRY TO RECHAIN. IF THIS IS THE CASE THE BUFFER     YM7595 10278002
* POOL SHOULD BE FREEMAINED BECAUSE IT IS UNUSABLE.              YM7595 10278402
*                                                                       10278802
AMCL2030 EQU   *                                                        10280020
         TM    FCACLOS1,FCACFORC        FORCE CLOSE IN CONTROL   YM7595 10282002
         BZ    AMCL2035                 NO, GO RELINK BUFFERS    YM7595 10284002
         TM    FCAOPEN2,FCAOIOBC        WAS IOB CONSTRUCTION     YM7595 10286002
*                                         COMPLETED              YM7595 10288002
         BO    AMCL2035                 YES, OK TO RELINK BUFS   YM7595 10288402
         TM    DCBCIND2,DCBCNBFP        DID OPEN BUILD BUFFERS   YM7595 10288802
         BO    AMCL2020                 YES, GO FREEMAIN BUF     YM7595 10289202
*                                         POOL                   YM7595 10289602
         BZ    AMCL3000                 NO, CANNOT FREE USER     YM7595 10289702
*                                         GOTTEN BUFFERS         YM7595 10289802
*                                                                       10289902
* SIMULATE THE FREE BUFFER MACRO TO RETURN BUFFERS TO POOL              10293902
*                                                                       10295902
AMCL2035 EQU   *                                                        10297902
         USING BCBLK,RWK5                                               10298002
         IC    RWK7,DCBOFFSW            GET WRITE CCW OFFSET      OC022 10302002
         TM    DEBOPATB,OUTINOUT        TEST TYPE OF I/O          OC022 10304002
         BO    AMCL2040                 BRANCH IF OUTPUT          OC022 10306020
         IC    RWK7,DCBOFFSR            GET READ CCW OFFSET       OC022 10310002
AMCL2040 EQU   *                        BUFFER CLEARING LOOP      OC022 10314020
         LA    RWK4,0(RWK7,RIOB)        GET TO RD/WRT CCW ADDR          10320002
         USING CCW,RWK4                                                 10330002
         L     RWK4,CCWADDRA            GET BUFFER ADDRESS              10340002
         DROP  RWK4                                                     10350002
         LA    RWK4,0(RWK4)             HIGH BYTE CLEARED               10360002
         TM    DEBOPATB,RDBACKB         IS DCB OPENED FOR READ BACKWARD 10400002
         BNM   AMCL2070                 IF NOT, BRANCH.                 10420002
         LH    RWK1,DCBBLKSI            GET SIZE OF ONE BUFFER AND      10440002
         BCTR  RWK1,0                   DECREMENT BY ONE.               10460002
         SR    RWK4,RWK1                POINT TO BEGINNING OF BUFFER.   10480002
         B     AMCL2080                 CONT PROC READ BACKWARD  S19017 10490002
AMCL2070 EQU   *                                                        10520020
         CLI   DCBDEVT,DCBDVOR5         CHECK FOR A              S19017 10521002
         BL    AMCL2080                 1285, 1287, OR 1288      S19017 10522020
         CLI   DCBDEVT,DCBDVOR8         DCBDEVT IS 5A,5B,OR 5C   S19017 10523002
         BH    AMCL2080                 IF NOT, CONT PROCESSING  S19017 10524002
         DROP  RIOB                                                     10524402
         USING CCW+(IOBQSAMN-IOBEXTEN-L'CCW),RWK3  ADDRESSABILITY TO    10524802
*                                                    SECOND CCW IN C.P. 10524902
         LH    RWK1,CCWBYTE             OTHERWISE, LOAD COUNT    S19017 10525002
         DROP  RWK3                                                     10525402
         USING IOBQSAMN,RIOB                                            10525802
         TM    DCBRECFM,DCBRECF         F OR U FORMAT RECORDS           10526002
         BO    AMCL2075                 YES, BRANCH                     10527020
         AH    RWK1,RDWLEN              ADD 4 TO COUNT FOR       S19017 10530002
AMCL2075 EQU   *                           VAR RECS              S19017 10531002
         BCTR  RWK1,0                   DECREMENT BY 1 TO        S19017 10532002
*                                         ACCT FOR RD                   10532402
         SR    RWK4,RWK1                POINT TO BEGIN OF BUFFER S19017 10533002
AMCL2080 EQU   *                                                 S19017 10535020
         USING BUFFER,RWK4                                              10545002
         MVC   BUFNXPTB,BCBBUFAD        UPDATE LAST BUF WITH NEW ONE    10560002
         ST    RWK4,BCBBUFPT            UPDATE BUFFER POOL CNRL BLK     10580002
         L     RIOB,IOBNIOBA            GET NEXT IOB IN CHAIN           10600002
         BCT   RWK6,AMCL2040            IF MORE IOB'S FREE BUF'S  OC022 10620002
         SPACE 2                                                        10670002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 10672002
         SPACE 2                                                        10674002
         OI    FCACLOS1,FCACBUFP        BUFFERS RET TO POOL      Y02072 10676002
         SPACE 2                                                        10678002
         MODESET  KEYADDR=DXUKEY,WORKREG=13  BACK TO USER KEY    Y02072 10678402
         SPACE 2                                                        10678802
*                                                                       10680020
* PREPARE TO FREE SPACE REQUIRED FOR IOB/ICB S                          10700002
*                                                                       10720020
AMCL3000 EQU   *                                                        10740020
         SR    RWK5,RWK5                INITIALIZE REGISTERS            10760002
         SR    RWK1,RWK1                                                10780002
         SR    RWK2,RWK2                                                10800002
         IC    RWK1,DCBIOBL             GET LEN OF IOB/ICB (DBL WRDS)   10820002
         SLL   RWK1,3                   GET LEN IN BYTES                10840002
         IC    RWK2,DCBNCP              GET NUMBER OF BSAM CP.S         10860002
         TM    DCBCIND2,DCBCNQSM        IS QSAM BEING USED              10880002
         BZ    AMCL3010                 NO BRANCH                       10900002
         IC    RWK2,DCBBUFNO            GET NUMBER OF QSAM CP.S         10940002
AMCL3010 EQU   *                                                        10980020
         TM    DCBCIND2,DCBCNCHS        WAS DCB USING PCI SCHEDULING    11020002
         BO    AMCL3050                 YES BRANCH                      11040002
AMCL3020 EQU   *                                                        11080020
         TM    IOBNFLG1,IOBFIRST        THIS THE FIRST IOB IN CHAIN     11120002
         BO    AMCL3060                 YES BRANCH                      11140002
         L     RIOB,IOBNIOBA            GET NEXT IOB                    11160002
         B     AMCL3020                 CONTINUE TO LOOP                11180020
AMCL3050 EQU   *                                                        11240020
         L     RIOB,DCBIOBAD            GET MAIN IOB ADDRESS            11260002
         LA    RIOB,0(RIOB)             CLEAR HIGH BYTE                 11280002
         LA    RWK5,MIOBSIZE            CNST OF 48 FOR MIOB             11300002
AMCL3060 EQU   *                                                        11400020
         LTR   RWK2,RWK2                WERE NO. OF CP SPECIFIED        11420002
         BP    AMCL3065                 YES, BRANCH                     11440002
         LA    RWK2,DEFLTCP             NO, PROVIDE ONE                 11460002
AMCL3065 EQU   *                                                        11480020
         MR    RWK1,RWK1                NUMBER OF CP'S X IOB/ICB SIZE   11500002
         LA    RWK4,0(RWK2,RWK5)        ADD ANY PCI CNSTS REQ    Y02072 11540002
*                                                                       11560020
         FREEMAIN R,LV=(RWK4),A=(RIOB),SP=0  FREE IOB/ICB SPACE  Y02072 11580002
         SPACE 2                                                        11590002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 11600002
         SPACE 2                                                        11602002
         OI    FCACLOS1,FCACIOB         IOBS FREED               Y02072 11604002
         SPACE 2                                                        11606002
         MODESET  KEYADDR=DXUKEY,WORKREG=13  BACK TO USER KEY    Y02072 11608002
         SPACE 2                                                        11608402
*                                                                       11610002
* THE FOLLOWING CODE FREES UP THE 2K SPACE FOR THE FCR TABLE    XL03127 11620002
* USED BY THE 3886 OCR DEVICE                                   XL03127 11630002
*                                                                       11640002
         CLI   DCBDEVT,OCR3886          IS DEVICE A 3886 OCR    XL03127 11650002
         BNE   AMCL5000                 NO,BRANCH AROUND        XL03127 11700002
         L     RIOB,DCBFRTBA            GET FCR TABLE PTR       XL03127 11750002
         LA    RWK4,FCRTBLSZ            TABLE SIZE 2048 BYTES    Y02072 11760002
         XC    DCBFRTBA,DCBFRTBA        CLEAR OUT PTR FIELD     XL03127 11770002
         FREEMAIN R,LV=(RWK4),A=(RIOB),SP=0   FREE FCR TABLE     Y02072 11772002
         SPACE 2                                                        11774002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 11774402
         SPACE 2                                                        11774802
         OI    FCACLOS1,FCACFCR         FCR FREED                Y02072 11775202
         SPACE 2                                                        11775602
         MODESET  KEYADDR=DXUKEY,WORKREG=13  BACK TO USER KEY    Y02072 11775702
         SPACE 2                                                        11775802
         MVI   DCBLNNUM,0               CLEAR FIELD             XL03127 11788002
         MVI   DCBLFMAT,DCBLNFMT        RESET FIELD             XL03127 11798002
         EJECT                                                          11798402
*                                                                       11800020
* THIS SECTION OF CODE CLEARS BSAM/QSAM VECTORS IN DCB                  11820002
*                                                                       11880020
AMCL5000 EQU   *                                                        11900020
         SR    RWK2,RWK2                CLEAR REGISTER           A45280 11930002
         SR    RWK6,RWK6                                                11940002
         IC    RWK6,DEBNMEXT            NUMBER OF EXTENTS        A45280 11950002
         IC    RWK2,DEBEXSCL            OBTAIN SCALING FACTOR    A45280 11952002
         SLL   RWK6,0(RWK2)             LNGTH OF DEB EXTENT AREA A45280 11954002
         LA    RWK6,DEBBASND-DEBBASIC(RWK6,RDEB)  POINT TO       A45280 11956002
*                                         ACCESS METHOD SECTION         11956402
         USING DEBACSMD,RWK6                                            11956802
         MVC   DCBLRECL,DEBLRECL        RESTORE LRECL            A45280 11958002
         DROP  RWK6                                                     11958102
         SR    RWK6,RWK6                CLEAR REGISTER           A45280 11958402
         ST    RWK6,DCBWCPO             CLEAR OFFSET FIELDS             11960002
         LA    RWK6,INVALADD            TO SET AN INVALID ADDR   Y02072 11970002
         ST    RWK6,DCBIOBA             IOB VECTOR CLEARED              11980002
         ST    RWK6,DCBIOBAD            IOB FOR PCI CLEARED    @Z30TSMI 11982003
         ST    RWK6,DCBEOBW             WRITE EOB VECTOR CLEARED Y02072 11990002
         STCM  RWK6,B'0111',DCBCNTRL+1  CNTRL MOD VECTOR CLEARED Y02072 11992002
         STCM  RWK6,B'0111',DCBEOBRA    READ EOB VECTOR CLEARED  Y02072 11994002
         STCM  RWK6,B'0111',DCBREAD+1   READ MOD VECTOR CLEARED  Y02072 11996002
         TM    DCBOFLGS,DCBOFEOV        CONCATENATION UNLIKE ATTRIBUTES 12060002
         BO    AMCL5005                 YES BRANCH                      12080002
         STCM  RWK6,B'0111',DCBPERRA    ERR RTN VECTOR CLEARED   Y02072 12090002
AMCL5005 EQU   *                                                        12180020
         TM    DCBCIND2,DCBCNQSM        WAS QSAM USED                   12200002
         BZ    AMCL5006                 NO BRANCH                       12220002
         ST    RWK6,DCBEOB              CLEAR VECTOR                    12260002
AMCL5006 EQU   *                                                        12300021
         TM    DCBCIND1,DCBCNBRM        WAS BLK REC BIT TURNED   A45221 12322021
*                                         OFF DURING OPEN?       A45221 12324021
         BZ    AMCL5008                 NO, BR AROUND            A45221 12326021
         OI    DCBRECFM,DCBRECBR        YES, RESTORE BIT         A45221 12328002
         NI    DCBCIND1,X'FF'-DCBCNBRM  RESET BIT               SA67354 12328102
AMCL5008 EQU   *                                                 A45221 12328421
         NI    DCBCIND1,CLEARIND        CLEAR SAM INDICATOR      A40495 12330002
         NI    DCBCIND2,DCBCNFEO        RESET ALL BUT FEOV INDIC A40495 12340002
         CLI   DCBDEVT,DCBDVOR5         CHECK FOR A              S19017 12384002
         BL    AMCL5010                  1285, 1287, OR 1288     S19017 12386020
         CLI   DCBDEVT,DCBDVOR8         DCBDEVT IS 5A,5B,OR 5C   S19017 12388002
         BH    AMCL5010                 IF NOT, CONTINUE         S19017 12390002
         XC    DCBDSPLA,DCBDSPLA        CLEAR DCBDSPLY (+13)     S19017 12392002
         XC    DCBRESCA,DCBRESCA        CLEAR DCBRESCN (+17)     S19017 12394002
         EJECT                                                          12396002
AMCL5010 EQU   *                                                 S19017 12398020
         SPACE 2                                                        12408002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 12448002
         SPACE 2                                                        12498002
         TM    FCACLOS1,FCACFORC        FORCE CLOSE IN CONTROL   Y02072 12498102
         BNO   XCTL                     NO, CONTINUE NORMAL PATH Y02072 12498202
         SR    R15,R15                  RET CD FOR FC EXEC TO    Y02072 12498302
*                                         PASS TO CLOSES TRR     Y02072 12498802
         L     RBRNCH,24(RPAR)          GET RETURN ADDR        @AZ09146 12500037
         BR    RBRNCH                   RETURN TO FORCE CLO EXEC Y02072 12503702
XCTL     EQU   *                        NON-FORCE CLOSE PATH     Y02072 12505702
         MVI   WTGENTRY,0               CLEAR WTG ENTRY          Y02072 12507702
RELOOP   EQU   *                                                        12514602
         LA    RWTGC,L'WTGENTRY(,RWTGC)  STEP TO NEXT ENTRY             12520002
         LA    RPARC,L'PARDCBAD(,RPARC)  STEP TO NEXT ENTRY             12540002
         CLC   WTGIDNX,AMIDCNST         THIS ROUTINE NEEDED AGAIN       12560002
         BCR   8,RBASE                  RECURSE THRU MODULE             12580020
         CLC   WTGIDNX,CLLDB            IS THIS THE END OF THE TABLE    12600002
         BL    RELOOP                   NO BRANCH                       12620002
         CLC   WTGIDNX,CLLDG            IS THIS THE END OF THE TABLE    12640002
         BH    RELOOP                   NO BRANCH                       12660002
         LR    RPARC,RPAR               INITIALIZATION                  12680020
         DROP  RWTGC                                                    12690002
         LA    RWTGC,WTGENTRY                                           12700002
         USING WTGENTRY,RWTGC                                           12710002
AMCL5011 EQU   *                                                        12720020
         CLI   WTGIDTTR,CLOSEFIN        IS THIS ENTRY = ZERO?           12740002
         BNE   AMCL5019                 NO BRANCH                       12760002
         LA    RWTGC,L'WTGENTRY(,RWTGC) NEXT ENTRY IN WTG TAB           12780002
         LA    RPARC,L'PARDCBAD(,RPARC) NEXT DCB ADDRESS                12800002
         B     AMCL5011                                                 12820020
AMCL5019 EQU   *                                                        12860020
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*12920003
               MODID=WTGENTRY           GO TO NEXT ROUTINE     @Z30TSMI 12970003
         EJECT                                                          12990002
*                                                                       12992002
*CONSTANTS                                                              12994002
*                                                                       12996002
AMIDCNST DC    C'1X'                                                    13000002
RDWLEN   DC    H'4'                     USED AS A CONST OF 4     S19017 13070002
*                                         IN A AH INST                  13120002
CLLDB    DC    C'0B'                    MOD ID                   Y02072 13200002
CLLDG    DC    C'0G'                    MOD ID                   Y02072 13220002
         SPACE                                                          13260002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 13270002
END      EQU   *                        END OF MODULE            Y02072 13280002
         TITLE 'IGG0201X - FORECORE DSECT'                              13330002
         IECDSECS  (MAIN,(IOB,NO)),EXPAND=YES                    Y02072 13340002
         EJECT                                                          13410002
         IGGSCW                                                         13420002
         TITLE 'IGG0201X - DSECT FOR AUDIT TRAIL'                       13430002
         IHAFCAUD  ORG=YES                                       Y02072 13440002
         TITLE 'IGG0201X - DCB DSECT'                                   14060002
         DCBD  DSORG=PS                                                 14080020
         TITLE 'IGG0201X - BUFFER CONTROL BLOCK DSECT'                  14100002
         IGGBCB                                                         14110002
         TITLE 'IGG0201X - CCW DSECT'                                   14114002
         IHACCW DSECT=YES                                               14116002
         TITLE 'IGG0201X - CVT DSECT'                                   14118003
CVT      DSECT                                                          14118103
         CVT                                                            14118203
         TITLE 'IGG0201X - IOB DSECT'                                   14118402
         IEZIOB                                                         14118802
         TITLE 'IGG0201X - WHERE TO GO TABLE DSECT'                     14119902
         IECDSECS WTG,PREFX,EXPAND=YES                                  14169903
         ORG   WTG+8                                             Y02072 14171902
WRKRETRN DS    F                        FORCE CLOSE RET ADDR     Y02072 14173902
         ORG   WTGIDTTR                                                 14179902
WTGIDNX  DS    CL2                      ID NEXT MODULE                  14181902
WTGTTRNX DS    CL3                      TTR NEXT MODULE                 14183902
         ORG   WTGIDTTR+4                                               14185902
WTGDCBWA DS    A                        WORK AREA ADDRESS CURRENT DCB   14187902
         TITLE 'IGG0201X - CLOSE PARAMETER LIST DSECT'                  14188302
         IGGPARML                                                       14188702
         TITLE 'IGG0201X - DEB DSECT'                                   14189902
         IEZDEB                                                         14199902
         END                                                            14209937
./  ADD  SSI=72630642,NAME=IGG0201Y
     TITLE 'IGG0201Y - SAM/PAM CLOSE EXECUTOR, DIRECT ACCESS - LOAD 2'  00060002
IGG0201Y CSECT                                                          00120019
*                                                                       00122002
*MODULE NAME - IGG0201Y                                                 00124002
*                                                                       00126002
*DESCRIPTIVE NAME - RESTORE RESOURCES AND CLEAN UP FOR DA               00128002
*                                                                       00128402
*STATUS CHANGE LEVEL 006                                                01160002
*                                                                     * 01210019
*FUNCTION - THE FOLLOWING FUNCTIONS WILL BE PERFORMED BY THIS  CLOSE    01400002
*           EXECUTOR FOR BSAM, QSAM AND BPAM DATA SETS-DIR. ACC. DEV.   01500002
*           * FREES SEGMENT WORK AREA FOR DCB'S WHICH SPECIFY BFTEK=R,  01600002
*             RECFM=VS,MACRF=WL                                         01700002
*           * IT WILL RETURN ALL BUFFERS TO THE BUFFER POOL IF GOTTEN   01750002
*             BY OPEN AND SIMPLE BUFFERING                              01800002
*           * IF WILL FREEMAIN ALL BUFFERS FOR DATA SETS WITH CONCAT-   01850002
*             ENATION OF UNLIKE ATTRIBUTES                              01900002
*           * IT WILL FREE THE RECORD AREA IF OPEN HAD ACQUIRED IT      02300002
*           * CLEAR FIELDS IN THE DCB SO THAT IT CAN'T BE USED UNLESS   02400002
*             IT IS OPENED AGAIN                                        02500002
*           * FREEMAIN THE AREA GOTTEN FOR THE CONSTRUCTION OF IOB'S    02600002
*           * SETS APPROPRIATE AUDIT TRAIL BITS IN THE O/C/E     Y02072 02650002
*             WORKAREA IN CASE THE USERS STAE ROUTINE SHOULD GET Y02072 02700002
*             CONTROL DURING A FORCE CLOSE SITUATION. (THESE     Y02072 02750002
*             BITS, ALTHOUGH SET DURING NORMAL CLOSE, HAVE NO    Y02072 02850002
*             MEANING).                                          Y02072 02860002
*                                                                       02900019
*ENTRY POINT - FROM IGG0201Z OR IGG0201B                                03000003
*                                                                       03100019
*INPUT - SEE DESCRIPTION OF REGISTERS, DCB(USERS), IOB(USERS).          03200002
*                                                                       03300019
*OUTPUT - NONE                                                          03400002
*                                                                       03500019
*EXTERNAL ROUTINES - NONE                                               03600002
*                                                                       03700019
*MACROS : MAPPING - IECDSECT, IECDSECS, DCBD, IGGBCB, IHACCW, IHAFCAUD, 03750002
*                   IEZIOB, IGGPARML, IGGSWA, IEZDEB, IGGSCW            03760002
*                                                                       03770002
*MACROS : ACTION - FREEMAIN, IECRES, MODESET                            03780003
*                                                                       03790002
*EXITS-NORMAL - TO IGG0200B, IGG0200G                                   03800003
*                                                                       03900019
*EXITS-ABNORMAL - BR 14 TO RETURN TO THE FORCE CLOSE EXECUTOR    Y02072 03910002
*                                                                       04100019
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              04200019
*                                                                       04300019
*      BYTE  0-7  NAME                                                  04400019
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            04500019
*      BYTE 11    CONCATENATION NUMBER                                  04600019
*      BYTE 12    ZERO                                                  04700019
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       04800019
*                        ALIAS INDICATOR 1 BIT                          04900019
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      05000019
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              05100019
*      BYTE 17    ZERO                                                  05200019
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      05300019
*      BYTE 20    TRANSLATION TABLE                                     05400019
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            05500019
*      BYTE 22-23 ATTRIBUTES                                            05600019
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     05700019
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           05800019
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 05900019
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        06000019
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       06100019
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        06200019
*      BYTE 40-   TABLE OF IDTTR'S                                      06300019
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          06400019
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          06500019
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          06600019
*                   NOT USED                         (3 BYTES)          06700019
*                                                                       06800019
*      CLOSE WORK AREA                                                  06900002
*                                                                       07000019
*ATTRIBUTES- REENTRANT, REUSABLE, RUNS IN USER KEY UNLESS        Y02072 07100002
*            OTHERWISE SPECIFIED, SUPERVISOR STATE               Y02072 07150002
*                                                                       07200019
*NOTES - ALL REGISTER EQUATES BEGIN WITH THE CHARACTER R.               07250002
*      - THIS MODULE CREATED AT RELEASE 19 BY SPLIT OF IGG0201Z         07300002
*      - THE DEB ADDRESS IS GOTTEN FROM THE PROTECTED DCB FOR    Y02072 07300402
*        INTEGRITY REASONS.                                      Y02072 07300802
*                                                                       07302002
*CHANGE ACTIVITY - AS FOLLOWS:                                          07310002
*                                                                     * 07320002
*          VS2 RELEASE 01 DELETIONS                                     07330002
*D173000-174000                                                YM0928   07340002
*                                                                       07342002
*          VS2 RELEASE 02 DELETIONS                                     07344002
*001100,001800,001984,011600,037800,071000,146500-147020,147620, Y02072 07346002
*148500-149600,190000,210000,226500-228600,311000,343500,343700, Y02072 07348002
*452000-453000,389500-393100,71500,430000-432000,444000,87000,   Y02072 07348402
*188000,208800,222080,222240,248000-259500,309810                Y02072 07348802
*436000-450000,123900,291300-291600,305160-305240,               Y02072 07348902
*                                                                YM4640 07349002
*                                                                YM2852 07349102
*                                                                YM5782 07351602
*                                                                YM6889 07353602
*                                                                       07354102
*          VS2 RELEASE 03 DELETIONS                                     07356103
*                                                              @Z30TSMI 07356503
*000039150002                                                  @ZA09146 07359337
*          VS1 RELEASE 01 DELETIONS                                     07362603
*                                                                       07365403
*          RELEASE 20 DELETIONS                                       * 07368203
*3575222200                                                      A36765 07371003
*3575292000-293000,306000                                        S20201 07373803
*3575282000                                                      M2526  07376602
*          RELEASE 21 DELETIONS                                       * 07378602
*0932                                                            A48163 07380602
*0932282200                                                      A42903 07382602
*0932                                                            A45280 07383002
* 387000                                                         A40495 07383102
*D281400,282200-282600                                          SA52447 07383202
*                                                               SA51596 07388802
*                                                               SA53272 07390802
         EJECT                                                          07394402
*                                                                       07400019
* REGISTER USAGE                                                        07500002
*                                                                       07600019
RWK1     EQU   0                        WORK REGISTER                   07700002
R1       EQU   1                        PARAMETER REGISTER              07750002
RWK2     EQU   R1                       WORK REGISTER                   07800002
RDCB     EQU   2                        ADDR OF USERS DCB               07900019
RBASE    EQU   3                        BASE REGISTER                   08000019
RCORE    EQU   4                        ADDR OF CLOSE WORK AREA         08100019
RPAR     EQU   5                        PARAMETER LIST                  08200019
RWTG     EQU   6                        START OF WTG                    08300019
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 08400019
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      08500019
RWK3     EQU   9                        WORK REGISTER                   08600002
RWK8     EQU   10                       WORK REGISTER            Y02072 08700002
RDEB     EQU   11                       DEB ADDRESS                     08800019
RIOB     EQU   12                       IOB REGISTER                    08900002
RWK4     EQU   13                       WORK REGISTER                   09000002
RWK5     EQU   14                       WORK REGISTER                   09100002
RBRNCH   EQU   RWK5                     RETURN REG TO CLOSES TRR Y02072 09150002
R15      EQU   15                       PARAMETER REGISTER              09200002
RWK6     EQU   R15                      WORK REGISTER                   09250002
         EJECT                                                          09260002
*                                                                       09300019
* EQUATES FOR CONSTANTS                                                 09350002
*                                                                       09360002
RDBACKB  EQU   X'03'                    USED TO TEST OPEN ATTRIBUTES    10000019
UPDATE   EQU   X'04'                    OPEN ATTRIBUTE = UPDAT          11900019
OUTINOUT EQU   X'07'                    OPEN ATTR, OUT/OUTIN            12000002
SETSC    EQU   X'23'                    SET SECTOR CCW CMND      S20201 12101420
DA       EQU   X'20'                    DIRECT ACCESS MASK       S20201 12103520
MIOBLEN  EQU   48                       LENGTH OF IOB                   12190002
CLOSEFIN EQU   X'00'                    CLOSE EXEC PROCESSING COMPLETED 12240002
DEFBUFNO EQU   1                        BUFNO NOT SPECIFIED, DEFAULT 1  12290002
ROUNDCNT EQU   8                        FOR ROUNDING             Y02072 12390002
INVALADD EQU   1                        USED TO INVALIDATE       Y02072 12400002
*                                         ADDRESS VECTORS        Y02072 12410002
CPOFSETN EQU   X'30'                    OFFSET TO CP IN NORMAL   Y02072 12420002
*                                         SCHEDULING IOB         Y02072 12430002
CPOFSETC EQU   X'38'                    OFFSET TO CP IN CHAINED  Y02072 12432002
*                                         SCHEDULING IOB         Y02072 12434002
         EJECT                                                          12440002
*                                                                       12490002
* ADDRESSABILITY                                                        12540002
*                                                                       12590002
         USING WTG,RWTG                                                 14360002
         USING WTGENTRY,RWTGC                                           14370002
         BALR  RBASE,0                  ESTABLISH BASE                  14380002
         USING AMCL,RBASE               ESTABLISH ADDRESSIBILITY        14390002
*                                                                       14400019
AMCL     EQU   *                                                        14500019
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 14502002
         DC    C'IGG0201Y'              MODULE NAME              YM4640 14504002
         DC    C'@Z30TSMI'              LAST SHIP CODE         @Z30TSMI 14506003
         DC    C'10/15/74'              LAST DATE MODIFIED     @Z30TSMI 14508003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 14510002
*                                                                       14600019
         L     RCORE,WTGDCBWA           GET DCB'S WORK AREA      Y02072 14650002
         USING FORCORE,RCORE            ESTABLISH ADDRESSIBILITY Y02072 14660002
         L     RDCB,DXPDCBAD            GET PROTECTED DCB ADDR   Y02072 14662002
         USING IHADCB,RDCB                                       Y02072 14664002
         L     RDEB,DCBDEBAD            GET VALID DEB ADDR       Y02072 14666002
         USING DEBBASIC,RDEB                                            14668002
         MODESET  KEYADDR=DXUKEY,WORKREG=10                      Y02072 14670002
         SPACE                                                          14680002
         L     RDCB,DXUDCBAD            GET DCB BEING CLOSED     Y02072 14700002
         L     RIOB,DCBIOBA             GET CURR IOB/ICB ADDRESS        15000002
         LA    RIOB,0(RIOB)             CLEAR HIGH ORDER BYTE           15100002
         SR    RWK3,RWK3                CLEAR WORK REG                  15300002
         IC    RWK3,DCBOFFSW            GET WRITE CCW OFFSET            15400002
         TM    DEBOPATB,OUTINOUT        TEST IF OUTPUT/OUTIN            15600002
         BO    SKIPGO                   YES, RWK3 HAS WRITE OFFSET      15700002
         TM    DEBOPATB,UPDATE          TEST IF UPDATE                  15900019
         BO    SKIPGO                   YES, RWK3 HAS WRITE OFFSET      16000002
         IC    RWK3,DCBOFFSR            GET READ  CCW OFFSET            16200002
SKIPGO   EQU   *                                                        16400019
         TM    DCBCIND2,DCBCNQSM        DCB USING QSAM                  16700002
         BZ    AMCL3000                 NO BRANCH                       16800019
         TM    DCBCIND1,DCBCNEXB        EXCHANGE BUFFERING USED         17000002
         BO    AMCL3000                 YES BRANCH                      17100019
         L     RWK5,DCBBUFCB            GET BUFFER POOL CNTRL BLK       17500002
*                                                                       17600019
* IF A RECORD AREA WAS ACQUIRED BY OPEN, IT SHOULD BE RETURNED TO       17700019
* THE SUPERVISOR.                                                       17800019
*                                                                       17900019
         LA    RWK5,0(RWK5)             CLEAR HIGH ORDER BYTE           18000002
         USING BCBLK,RWK5                                               18050002
         TM    BCBFLGS,BCBLRI           RECORD AREA INDICATOR ON        18100002
         BZ    AMCL2010                 BRANCH NO TO CHECK OFLGS        18200019
         TM    DCBCIND2,DCBCNBFP        DID OPEN ACQUIRE POOL           18400002
         BZ    AMCL2010                 BRANCH NO TO CHECK OFLGS        18500019
         L     R1,BCBLRIAR              GET RECORD AREA ADDRESS         18700002
         USING LRILOC,R1                                                18750002
         L     RWK8,LRILGTH             GET LEN OF RECORD AREA   Y02072 18800002
         LA    RWK8,0(RWK8)             CLR HI BYT FOR OR INST   YM6889 18810002
         DROP  R1                                                       18850002
         SPACE 2                                                        18900002
         FREEMAIN R,LV=(RWK8),A=(1),SP=0  FREE RECORD AREA       Y02072 19000002
         SPACE 2                                                        19110002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 19150002
         SPACE 2                                                        19152002
         OI    FCACLOS1,FCACRECA        INDIC REC AREA FREED     Y02072 19160002
         SPACE 2                                                        19162002
         MODESET  KEYADDR=DXUKEY,WORKREG=10  BACK TO USER KEY    Y02072 19170002
         SPACE 2                                                        19180002
         NI    BCBFLGS,X'FF'-BCBLRI     TURN OFF RECORD AREA FLAG       19200002
         XC    BCBLRIAR,BCBLRIAR        CLEAR RECORD AREA  ADDRESS      19300002
AMCL2010 EQU   *                                                        19500019
         TM    DCBOFLGS,DCBOFEOV        CONCATENATION UNLIKE ATTRIBUTES 19700002
         BZ    AMCL2040                 NO BRANCH TO FREE BUFFERS       19800019
         TM    DCBCIND2,DCBCNBFP        DID OPEN ACQUIRE POOL           20000002
         BZ    AMCL2040                 NO BRANCH AROUND FREEMAIN       20100002
*                                                                       20200019
* FREE BUFFER POOL  OPEN WILL ACQUIRE A NEW ONE LATER                   20300002
*                                                                       20400019
         SR    RWK6,RWK6                CLEAR REGISTER           YM0928 20450002
         IC    RWK6,DCBBUFNO            GET NUMBER OF BUFFERS    YM0928 20460002
*                                        TO BE FREED                    20470002
         LA    R1,BCBLK                 GET CNTRL BLK ADDRESS TO FREE   20500002
         LH    RWK5,BCBBUFSZ            GET BUFFER SIZE                 20600002
         DROP  RWK5                                                     20650002
         USING BCBLK,RWK2                                               20660002
         MR    RWK5,RWK5                TOTAL AMT REQUIRED FOR BUFFERS  20700002
         LA    RWK8,BCBNLN(RWK6)        ADD EIGHT FOR CNTRL BLK  Y02072 20800002
         TM    BCBFLGS,BCBEXTND         BUFCB 16 BYTES           A48163 20850002
         BZ    FREEPOOL                 NO,BUFCB IS 8 BYTES      A48163 20870021
         LA    RWK8,BCBEXLN(RWK8)       ADD EIGHT FOR EXTENDED   Y02072 20880002
*                                         CONTROL BLOCK                 20890002
         DROP  RWK2                                                     20890402
FREEPOOL EQU   *                                                        20892021
         SPACE 2                                                        20900002
         FREEMAIN R,LV=(RWK8),A=(1),SP=0    FREE BUFFER POOL     Y02072 21000002
         SPACE 2                                                        21100002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 21150002
         SPACE 2                                                        21160002
         OI    FCACLOS1,FCACBUFC        INDIC BUF POOL FREED     Y02072 21170002
         SPACE 2                                                        21180002
         MODESET  KEYADDR=DXUKEY,WORKREG=10  BACK TO USER KEY    Y02072 21190002
         SPACE 2                                                        21192002
         XC    DCBBUFCA,DCBBUFCA        CLEAR ADDRESS IN DCB            21200002
         OI    DCBBUFCB+3,1             SET INVALID ADDRESS             21300002
         B     AMCL3000                 BRANCH TO FREE IOB              21400019
*                                                                       21900019
* SIMULATE THE FREE BUFFER MACRO TO RETURN BUFFERS TO POOL              22000002
*                                                                       22100019
AMCL2040 EQU   *                                                        22200019
         CLI   DCBBUFNO,0               TEST IF BUFNO PRESENT    A36765 22218002
         BE    AMCL3000                 BRANCH IF NO BUFFERS     A36765 22224002
         SR    RWK6,RWK6                CLEAR REG                       22240002
         IC    RWK6,DCBBUFNO            GET NUMBER OF BUFFERS TO FREE   22260002
         L     RWK5,DCBBUFCB            GET BUFFER POOL CNTRL BLK       22280002
         USING BCBLK,RWK5                                               22290002
AMCL2050 EQU   *                                                        22320019
         LA    RWK4,0(RWK3,RIOB)        GET TO RD/WRT CCW ADDR          22400002
         USING CCW,RWK4                                                 22450002
         L     RWK4,CCWADDRA            GET BUFFER ADDRESS              22500002
         LA    RWK4,0(RWK4)             HIGH BYTE CLEARED               22600002
         TM    DEBOPATB,RDBACKB         IS DCB OPENED FOR READ BACKWARD 22900002
         BNM   AMCL2070                 IF NOT, BRANCH.                 23000019
         LH    RWK1,DCBBLKSI            GET SIZE OF ONE BUFFER AND      23100002
         BCTR  RWK1,0                   DECREMENT BY ONE.               23200002
         SR    RWK4,RWK1                POINT TO BEGINNING OF BUFFER.   23300002
AMCL2070 EQU   *                                                        23500019
         USING BUFFER,RWK4                                              23550002
         MVC   BUFNXPTB,BCBBUFAD        UPDATE LAST BUF WITH NEW ONE    23700002
         ST    RWK4,BCBBUFPT            UPDATE BUFFER POOL CNRL BLK     23800002
         USING IOBQSAMN,RIOB                                            23850002
         L     RIOB,IOBNIOBA            GET NEXT IOB/ICB IN CHAIN       23900002
         BCT   RWK6,AMCL2050            IF MORE IOBS/ICBS, LINK BUFFERS 24000002
         SPACE 2                                                        24050002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 24100002
         SPACE 2                                                        24150002
         OI    FCACLOS1,FCACBUFP        INDIC BUF RET TO POOL    Y02072 24200002
         SPACE 2                                                        24250002
         MODESET  KEYADDR=DXUKEY,WORKREG=10  BACK TO USER KEY    Y02072 24260002
         SPACE 2                                                        24270002
*                                                                       24300019
* PREPARE TO FREE SPACE REQUIRED FOR IOB'S/ICB'S                        24400002
*                                                                       24500019
AMCL3000 EQU   *                                                        24600019
         SR    RWK5,RWK5                CLEAR REG                       26100002
         SR    RWK1,RWK1                CLEAR REG                       26200002
         SR    RWK2,RWK2                CLEAR REG                       26300002
         IC    RWK1,DCBIOBL             GET LEN OF IOB/ICB (DBL WRDS)   26400002
         SLL   RWK1,3                   GET LEN IN BYTES                26500002
         IC    RWK2,DCBNCP              GET NUMBER OF BSAM CP.S         26600002
         TM    DCBCIND2,DCBCNQSM        IS QSAM BEING USED              26700002
         BZ    AMCL3010                 NO BRANCH                       26800019
         IC    RWK2,DCBBUFNO            GET NUMBER OF QSAM CP.S         27000002
AMCL3010 EQU   *                                                        27200019
         TM    DCBCIND2,DCBCNCHS        WAS DCB USING PCI SCHEDULING    27400002
         BO    AMCL3050                 YES BRANCH                      27500019
AMCL3020 EQU   *                                                        27700019
         USING IOBQSAMN,RIOB                                            27750002
         TM    IOBNFLG1,IOBFIRST        THIS THE FIRST IOB IN CHAIN     27900002
         BO    AMCL3060                 YES BRANCH                      28000019
         L     RIOB,IOBNIOBA            GET NEXT IOB             M2526  28180002
         B     AMCL3020                 CONTINUE TO LOOP                28300019
         DROP  RIOB                                                     28350002
AMCL3050 EQU   *                                                        28700019
         L     RIOB,DCBIOBAD            GET MAIN IOB ADDRESS            28900002
         LA    RIOB,0(RIOB)             CLEAR HIGH BYTE                 29000002
         LA    RWK5,MIOBLEN             CNST OF 48 FOR MIOB             29100002
         USING CCW-CPOFSETC,RIOB        LOC OF 1ST CCW IN CP     Y02072 29150002
         CLI   CCWCOMCD,SETSC           RCD READY USED           S20201 29190002
         DROP  RIOB                                              Y02072 29200002
         BNE   AMCL3055                 BRANCH IF NO             S20201 29220020
         LA    RWK5,2*L'CCW(RWK5)       INCREMENT BY SIXTEEN FOR Y02072 29250002
*                                         SET SECTOR IN MIOB            29280002
AMCL3055 EQU   *                                                 S20201 29310020
         LA    RWK5,3*L'CCW+L'IOBSEEK(RWK5) TOTAL LENGTH OF MIOB FOR DA 29500002
         NI    DCBIFLGS,X'FF'-DCBIBIOE  TURN OFF 'NO RETRY'       14140 29600002
AMCL3060 EQU   *                                                        29800019
         LTR   RWK2,RWK2                WERE NO. OF CP SPECIFIED        30000002
         BP    AMCL3065                 YES, BRANCH                     30100019
         LA    RWK2,DEFBUFNO            NO, PROVIDE ONE                 30300002
AMCL3065 EQU   *                                                        30500019
         LR    RWK6,RWK2                SAVE NO. OF IOBS/ICBS    S20201 30532002
         TM    DCBMACF2,DCBMRWRT+DCBMRLDM  TEST BDAM CREATE     SA51596 30533002
         BNO   AMCL3067                 NO, BR AROUND TEST      SA51596 30534002
         USING IOBQSAMN,RIOB                                            30534102
         L     RWK3,IOBSTART            GET BEGIN OF CHAN PGM    YM5782 30534402
         DROP  RIOB                                                     30534502
         USING CCW,RWK3                                          YM5782 30534602
         CLI   CCWCOMCD,SETSC           IS RPS DEVICE USED       YM5782 30534802
         DROP  RWK3                                                     30535202
         BNE   AMCL3080                 NO, BRANCH OUT          SA51596 30536002
         B     AMCL3068                 ELSE ADD 8 TO IOB CORE  SA51596 30537002
AMCL3067 EQU   *                                                SA51596 30538021
         USING CCW-CPOFSETN,RIOB                                        30538402
         CLI   CCWCOMCD,SETSC           RCD READY USED           S20201 30540002
         DROP  RIOB                                                     30542002
         BNE   AMCL3080                 BRANCH NO                S20201 30548020
AMCL3068 EQU   *                                                SA51596 30552021
         TM    DEBOPATB,DEBACCS-UPDATE  ANY BITS OTHER THAN      S20201 30556002
*                                         UPDATE                 S20201 30564002
         BNZ   AMCL3070                 BRANCH IF YES            S20201 30572020
         TM    DEBOPATB,UPDATE          UPDATE BIT ON            S20201 30580002
         BNO   AMCL3070                 BRANCH IF NO             S20201 30588020
         LA    RWK6,ROUNDCNT(RWK6)      FOR UPDATE, ROUND UP     S20201 30596002
         SRL   RWK6,3                     NUMBER OF CHAN PGMS+1  Y02072 30612002
         SLL   RWK6,3                     TO GET NUM OF SECTORS  Y02072 30620002
         B     AMCL3075                 GO AROUND NEXT           S20201 30628020
AMCL3070 EQU   *                                                 S20201 30636020
         LA    RWK6,L'CCW               ONE DW                   S20201 30644002
AMCL3075 EQU   *                                                 S20201 30652020
         AR    RWK5,RWK6                INCREMENT CLEAR CORE     S20201 30660002
*                                         FOR SECTOR AREAS IN IOBS      30668002
AMCL3080 EQU   *                                                 S20201 30676020
         MR    RWK1,RWK1                NUMBER OF CP'S X IOB/ICB SIZE   30700002
         LA    RWK8,0(RWK2,RWK5)        ADD ANY CNSTS REQUIRED   Y02072 30900002
         TM    DCBMACF2,DCBMRWRT+DCBMRLDM TEST BDAM CREATE      SA53272 30909002
         BNO   AMCL3090                 NO, BRANCH OUT          SA53272 30918002
         TM    DCBRECFM,DCBRECTO        IS RECFM OVERFLOW       SA53272 30927002
         BNO   AMCL3090                 NO BRANCH OUT           SA53272 30936002
         LA    RWK8,10*L'CCW(,RWK8)     INCREMENT CORE TO        Y02072 30945002
*                                         INCLUDE ERASE CCWS    SA53272 30954002
         USING IOBQSAMN,RIOB                                            30954102
         L     RWK3,IOBSTART            GET BEGIN OF CHAN PGM    YM5782 30954402
         DROP  RIOB                                                     30954502
         USING CCW,RWK3                                                 30954602
         CLI   CCWCOMCD,SETSC           IS RPS DEVICE USED       YM5782 30954802
         DROP  RWK3                                                     30954902
         BNE   AMCL3090                 NO, BRANCH OUT           YM5782 30955202
         LA    RWK8,3*L'CCW(,RWK8)     ADD FOR RPS OVERFLOW      Y02072 30981002
AMCL3090 EQU   *                                                SA53272 30990000
         SPACE 2                                                        31000002
         FREEMAIN R,LV=(RWK8),A=(RIOB),SP=0  FREE IOB/ICB SPACE  Y02072 31100002
         SPACE 2                                                        31150002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 31200002
         SPACE 2                                                        31250002
         OI    FCACLOS1,FCACIOB         INDIC IOBS FREED         Y02072 31300002
         SPACE 2                                                        31350002
         MODESET  KEYADDR=DXUKEY,WORKREG=10  BACK TO USER KEY    Y02072 31360002
         SPACE 2                                                        31370002
*                                                                       31400019
* THIS ROUTINE FREES SEGMENT WORK AREA FOR THE DCB WHICH SPECIFIES      31500002
* BFTEK=R,RECFM=VS,MACRF=WL                                             31600002
*                                                                       31900019
         TM    DCBMACF2,DCBMRWRT+DCBMRLDM  TEST IF MACRF=WL             32000002
         BNO   SKIPVRE                  NO, SKIP VRE ROUTINE            32100019
         TM    DCBBFTEK,DCBBFTR         TEST IF BFTEK=R IS SPECIFIED    32300002
         BNO   SKIPVRE                  NO,SKIP VRE ROUTINE             32400019
         TM    DCBRECFM,DCBRECF         TEST IF RECFM=U OR F            32600002
         BO    SKIPVRE                  YES,SKIP VRE ROUTINE            32700019
         TM    DCBRECFM,DCBRECSB        TEST IF RECFM=VS                32900002
         BNO   SKIPVRE                  NO,SKIP VRE ROUTINE             33000019
         TM    DCBMACF2,DCBMRSWA        TEST IF COBOL HAS BILT SWA      33200002
         BO    SKIPVRE                  YES,SKIP VRE PROCESSING         33300019
*                                                                       33400019
* THE POINTER TO THE SEGMENT WORK AREA IS IN DCBEOBW.                   33500002
*                                                                       33600019
         L     R1,DCBEOBW               LOAD ADDR OF SEG WORK AREA C.B. 33700002
         XC    DCBEOBW,DCBEOBW          CLEAR SWA PTR IN DCB            33900002
         USING SWACB,RWK2               ESTABLISH BASE                  34300002
         LH    RWK6,SWACBNO             LOAD NO. OF SEG. WORK AREAS     34320002
         MH    RWK6,SWACBLNG            MULTIPLY NO. * LENGTH           34330002
         LA    RWK8,SWALNG(RWK6)        ADD CONTROL BLOCK LENGTH Y02072 34350002
         DROP  RWK2                                                     34352002
         SPACE 2                                                        34360002
         FREEMAIN R,LV=(RWK8),A=(1),SP=0  FREE SEGMENT WORK AREA Y02072 34370002
         SPACE 2                                                        34420002
         MODESET  EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5     Y02072 34470002
         SPACE 2                                                        34472002
         OI    FCACLOS1,FCACSWA         INDIC SWA FREED          Y02072 34474002
         SPACE 2                                                        34476002
         MODESET  KEYADDR=DXUKEY,WORKREG=10  BACK TO USER KEY    Y02072 34478002
         SPACE 2                                                        34478402
*                                                                       34480019
* THIS SECTION OF CODE CLEARS BSAM/QSAM/BPAM VECTORS IN DCB             34490002
*                                                                       34510019
SKIPVRE  EQU   *                                                        34520002
         TM    DCBDSORG,DCBDSGPO        IS THIS BPAM            SA59359 34520102
         BO    AMCL5001                 YES, DEB LRECL FIELD    SA59359 34520202
*                                         DOES NOT EXIST        SA59359 34520302
         SR    RWK6,RWK6               CLEAR REGISTER            A45280 34520402
         SR    RWK4,RWK4               CLEAR REGISTER            A45280 34520802
         IC    RWK4,DEBNMEXT           NUMBER OF EXTENTS         A45280 34521202
         IC    RWK6,DEBEXSCL           OBTAIN SCALING FACTOR     A45280 34521602
         SLL   RWK4,0(RWK6)            LENGTH OF DEB EXTENT AREA A45280 34621602
         LA    RWK4,DEBBASND(RWK4)     ACC METHOD SECT           A45280 34671602
         DROP  RDEB                                                     34673602
         USING DEBACSMD,RWK4                                            34681602
         MVC   DCBLRECL,DEBLRECL        RESTORE LRECL            A45280 34721602
         DROP  RWK4                                                     34771602
AMCL5001 SR    RWK6,RWK6                CLEAR REG                       36510002
         ST    RWK6,DCBWCPO             CLEAR OFFSET FIELDS             36600002
         LA    RWK6,INVALADD            TO SET AN INVALID ADDR   Y02072 36650002
         ST    RWK6,DCBIOBA             IOB VECTOR CLEARED              36700002
         ST    RWK6,DCBIOBAD            IOB FOR PCI CLEARED    @Z30TSMI 36710003
         ST    RWK6,DCBEOBW             CLEAR WRITE EOB VECTOR   Y02072 36750002
         TM    DCBCIND2,X'01'           TEST FOR QSAM            Z02260 36752037
         BNO   CLRFLDS                  BR IF NOT QSAM           Z02260 36754037
         STCM  RWK6,B'1100',DCBPRECL    CLEAR DCBPRECL           Z02260 36756037
CLRFLDS  STCM  RWK6,B'0111',DCBCNTRL+1  CLEAR CNTRL MOD ADDR     Y02072 36760037
         STCM  RWK6,B'0111',DCBEOBRA    CLEAR READ EOB VECTOR    Y02072 36770002
         STCM  RWK6,B'0111',DCBREAD+1   CLEAR READ RTN VECTOR    Y02072 36780002
         TM    DCBOFLGS,DCBOFEOV        CONCATENATION UNLIKE ATTRIBUTES 37100002
         BO    AMCL5005                 YES BRANCH                      37200019
         STCM  RWK6,B'0111',DCBPERRA    CLEAR ERR ROUTINE VECTOR Y02072 37250002
AMCL5005 EQU   *                                                        37800019
         TM    DCBCIND2,DCBCNQSM        WAS QSAM USED                   38000002
         BZ    AMCL5009                 NO BRANCH                       38100019
         ST    RWK6,DCBEOB              CLEAR VECTOR                    38300002
AMCL5009 EQU   *                                                        38500019
         XC    DCBCIND1,DCBCIND1        CLEAR SAM INDICATOR      A40495 38650002
         NI    DCBCIND2,DCBCNFEO        CLEAR ALL BUT FEOV INDIC A40495 38700002
         MODESET  EXTKEY=DATAMGT        DATA MANAG KEY FOR STORE Y02072 38950002
         SPACE 2                                                        39000002
         TM    FCACLOS1,FCACFORC        FORCE CLOSE IN CONTROL   Y02072 39050002
         BNO   XCTL                     NO, CONTINUE NORMAL PATH Y02072 39100002
         SR    R15,R15                  RET CD FOR FC EXEC TO    Y02072 39110002
*                                         PASS TO CLOSES TRR     Y02072 39120002
         L     RBRNCH,24(RPAR)          RET ADDR TO FC EXEC    @ZA09146 39150037
         BR    RBRNCH                   RETURN TO FORCE CL EXEC  Y02072 39250002
XCTL     EQU   *                        NORMAL PATH              Y02072 39300002
         MVI   WTGIDTTR,0               CLEAR WTG ENTRY          Y02072 39370002
RELOOP   EQU   *                                                        39450002
         LA    RWTGC,L'WTGENTRY(,RWTGC) STEP TO NEXT ENTRY              39500002
         LA    RPARC,L'PARDCBAD(,RPARC) STEP TO NEXT ENTRY              39550002
         CLC   WTGIDNX,AMIDCNST         IS THIS MODULE NEEDED           39600002
         BCR   8,RBASE                  YES, RECURSE THRU MODULE        39650002
         CLC   WTGIDNX,CLLDB            IS THIS THE END OF THE TABLE    39700002
         BL    RELOOP                   NO, BRANCH                      39750002
         CLC   WTGIDNX,CLLDG            IS THIS THE END OF THE TABLE    39800002
         BH    RELOOP                   NO, BRANCH                      39850002
         LR    RPARC,RPAR               INITIALIZATION                  41200019
         DROP  RWTGC                                                    41250002
         LA    RWTGC,WTGENTRY           POINT TO NEXT WTG ENTRY         41300002
         USING WTGENTRY,RWTGC                                           41350002
AMCL5011 EQU   *                                                        41500019
         CLI   WTGIDTTR,CLOSEFIN        IS THIS ENTRY = ZERO            41700002
         BNE   AMCL5019                 NO BRANCH                       41800019
         LA    RWTGC,L'WTGENTRY(,RWTGC)  POINT TO NEXT WTG ENTRY        42000002
         LA    RPARC,L'PARDCBAD(,RPARC)  POINT TO NEXT PARM ENTRY       42100002
         B     AMCL5011                 BRANCH TO TEST AGAIN            42200019
AMCL5019 EQU   *                                                        42600019
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*42900003
               MODID=WTGENTRY           GO TO NEXT ROUTINE     @Z30TSMI 42950003
*                                                                       43300019
         EJECT                                                          43350002
*                                                                       43400002
* CONSTANTS                                                             43450002
*                                                                       43500002
AMIDCNST DC    C'1Y'                    CURRENT MODULE ID        Y02072 43900002
CLLDB    DC    C'0B'                    ID                       Y02072 44500002
CLLDG    DC    C'0G'                    ID                       Y02072 44600002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 44850002
END      EQU   *                        END OF MODULE            Y02072 44900002
         TITLE 'IGG0201Y - IECDSECS DSECT'                              45100002
         IECDSECS  (MAIN,(IOB,NO)),EXPAND=YES                    Y02072 45200002
         EJECT                                                          45210002
FORCORE  DSECT                                                   Y02072 45250002
         IGGSCW                                                         45310002
         TITLE 'IGG0201Y - DSECT FOR AUDIT TRAIL'                       45320002
         IHAFCAUD  ORG=YES                                       Y02072 45330002
         TITLE 'IGG0201Y - WTG TABLE DSECT'                             45350002
         IECDSECS WTG,PREFX,EXPAND=YES                                  45400003
         ORG   WTG+8                                             Y02072 45402002
WRKRETRN DS    A                        RETURN ADDR TO FORCE     Y02072 45404002
*                                         CLOSE EXECUTOR         Y02072 45406002
         ORG   WTGMODID+2                                               45410002
WTGTTRA  DS    CL3                      TTR                             45420002
WTGKZ    DS    0CL2                     KZ                              45430002
WTGK     DS    C                        K                               45440002
WTGZ     DS    C                        Z                               45442002
WTGC     DS    C                        C                               45444002
         ORG   WTGMODNM                                                 45446002
WTGMOD   DS    CL6                      FIRST 6 CHARS OF MOD NAMEY02072 45448002
         ORG   WTGIDTTR                                                 45448402
WTGIDNX  DS    CL2                      ID NEXT MODULE                  45448802
WTGTTRNX DS    CL3                      TTR NEXT MODULE                 45449202
         ORG   WTGIDTTR+4                                               45449602
WTGDCBWA DS    AL4                      ADDR OF WORK AREA FOR DCB       45449702
         TITLE 'IGG0201Y - CCW DSECT'                                   45450002
         IHACCW  DSECT=YES                                              45500002
         TITLE 'IGG0201Y - CVT DSECT'                                   45510003
CVT      DSECT                                                          45520003
         CVT                                                            45530003
         TITLE 'IGG0201Y - BUFFER CONTROL BLOCK DSECT'                  45550002
         IGGBCB  TYPE=SAM                                               45600002
         TITLE 'IGG0201Y - DEB DSECT'                                   45650002
         IEZDEB                                                         45700002
         TITLE 'IGG0201Y - IOB DSECT'                                   45750002
         IEZIOB                                                         45800002
         TITLE 'IGG0201Y - CLOSE PARAMETER LIST DSECT'                  46050002
         IGGPARML                                                       46100002
         TITLE 'IGG0201Y - SEGMENT WORK AREA DSECT'                     46150002
         IGGSWA                                                         46200002
         TITLE 'IGG0201Y - DCB DSECT'                                   48750002
         DCBD  DSORG=PS                                                 49400019
         END                                                            51000019
./  ADD  SSI=72210554,NAME=IGG0201Z
201Z TITLE 'IGG0201Z -- SAM/PAM CLOSE EXECUTOR, DIRECT-ACCESS'          00100002
IGG0201Z CSECT                                                    7M142 00200000
*                                                                       00250002
*MODULE NAME - IGG0201Z                                                 00300002
*                                                                       00350002
*DESCRIPTIVE NAME - CLOSE EXECUTOR FOR DA DEVICES                       00400002
*                                                                       00450002
*COPYRIGHT - NONE                                                       00460002
*                                                                       00844002
*STATUS CHANGE LEVEL - SEE BEGINNING OF OBJECT CODE                     01200002
*                                                                       01250002
*FUNCTION - THE FOLLOWING FUNCTIONS WILL BE PERFORMED BY THIS CLOSE     01400002
*           EXECUTOR FOR BSAM, QSAM AND BPAM DATA SETS-DIR. ACC. DEV.   01500002
*           * A GETMAIN IS ISSUED IN THE BEGINNING OF THE MODULE TO     02460002
*             PROVIDE THE AM ROUTINES WITH A SAVEAREA IN SP 230. Y02072 02520002
*             THIS AREA IS ALSO USED AS A PARMETER LIST FOR STOW Y02072 02530002
*             IF NECESSARY.                                      Y02072 02540002
*             IT IS FREED BEFORE NORMAL EXIT OF THIS MODULE.     Y02072 02570002
*           * FOR QSAM INPUT AND BSAM, A PURGE IS ISSUED FOR ALL YM3838 02580002
*             OUTSTANDING I/O.                                   YM3838 02590002
*           * IF QSAM OUTPUT IN LOCATE MODE, THE USERS BUFFERS          02620002
*             WILL BE FLUSHED BY GOING TO THE PUT ROUTINE.              02670002
*           * IF QSAM UPDATE, THE USERS BUFFERS WILL BE FLUSHED         02720002
*             BY GOING TO THE TRUNC ROUTINE AND THEN GOING TO           02770002
*             THE PUT ROUTINE.                                          02820002
*           * IF BDAM CREATE, THE CAPACITY RECORD (R0) WILL BE          02870002
*             UPDATED.                                                  02880002
*           * IF BPAM, A STOW IS ISSUED FOR THE USER MEMBERNAME.        02890002
*           * SETS AN AUDIT TRAIL BIT IN THE O/C/E WORKAREA      Y02072 02892002
*             (INDICATING PURGE SUCCESSFUL), IN CASE THE USERS   Y02072 02894002
*             STAE ROUTINE SHOULD GET CONTROL DURING A FORCE     Y02072 02896002
*             CLOSE SITUATION. (THIS BIT, ALTHOUGH SET DURING    Y02072 02898002
*             NORMAL CLOSE, HAS NO MEANING).                     Y02072 02898402
*                                                                       02900000
*ENTRY POINT - NORMAL: IGG0201Z, XCTL FROM IGG0200W               7M142 03000002
*                      (COMMON CLOSE)                            Y02072 03050002
*              ABNORMAL: IGG0201Z, FROM IGG020T1                        03100003
*                        (FORCE CLOSE EXECUTOR)                         03150003
*                                                                       03160002
*INPUT - SEE DESCRIPTION OF REGISTERS, DCB(USERS), IOB(USERS).          03200002
*                                                                       03300000
*OUTPUT - NONE                                                          03400002
*                                                                       03500000
*EXTERNAL ROUTINES - WRITE ROUTINE FOR BDAM CREATE (TO UPDATE R0)       03700002
*                  - PUT ROUTINE FOR QSAM (TO OUTPUT LAST BUFFER)       03760002
*                                                                       03770002
*EXITS : NORMAL - TO IGG0201Y                                           03800003
*                                                                       03900000
*EXITS : ERROR - ERROR ON CLOSE 'STOW'                                  03960002
*                  CALL PROBLEM DETERMINATION (IGG0206M) FOR B14 ABEND  04020002
*                  AND ISSUE WRITE TO PROGRAMMER                        04100002
*                                                                       04150002
*              - IOB POSTED OTHER THAN NORMAL COMPLETION                04152002
*                  TO IGG0201B (QSAM ONLY)                              04154003
*                                                                       04156002
*MACROS : MAPPING - IEZIOB, IHAECB, IHADECB, IEZDEB, IHADCB, IKJTCB,    04160002
*                   IECDSECT, IECDSECS, IHARB, IHACCW, IHAPSA,   Y02072 04170002
*                   IGGPARML, IGGSCW, IHASTOW, IECDPPL                  04172002
*                                                                       04180002
*MACROS : ACTION - GETMAIN, WAIT, STOW, DMABCOND,                       04190003
*                  FREEMAIN, IECRES, SYNCH, MODESET                     04192003
*                                                                       04194002
*TABLES/WORKAREAS - WHERE TO GO TABLE (WTG)                             04200002
*                                                                       04300000
*      BYTE  0-7  NAME                                                  04400000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            04500000
*      BYTE 11    CONCATENATION NUMBER                                  04600000
*      BYTE 12    ZERO                                                  04700000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       04800000
*                        ALIAS INDICATOR 1 BIT                          04900000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      05000000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              05100000
*      BYTE 17    ZERO                                                  05200000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      05300000
*      BYTE 20    TRANSLATION TABLE                                     05400000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            05500000
*      BYTE 22-23 ATTRIBUTES                                            05600000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     05700000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           05800000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 05900000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        06000000
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       06100000
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        06200000
*      BYTE 40-   TABLE OF IDTTR'S                                      06300000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          06400000
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          06500000
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          06600000
*                   NOT USED                         (3 BYTES)          06700000
*                                                                       06800000
*      CLOSE WORKAREA                                                   06900002
*                                                                       07000000
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN USER KEY UNLESS       Y02072 07100002
*             OTHERWISE SPECIFIED, SUPERVISOR STATE              Y02072 07150002
*                                                                       07200000
*NOTES - ALL REGISTER EQUATES BEGIN WITH THE CHARACTER R                07300002
*        THE ADDRESS OF THE DEB IS GOTTEN FROM THE PROTECTED     Y02072 07310002
*        COPY OF THE DCB FOR INTEGRITY REASONS.                  Y02072 07320002
*                                                                       07340402
*CHANGE ACTIVITY - AS FOLLOWS:                                          07342002
*                                                                       07344002
*          RELEASE 20 DELETIONS                                       * 07346002
*1380131000-131880,305200-305500,315500                          M6099  07348002
*1380                                                            A36895 07348402
*          RELEASE 21 DELETIONS                                       * 07348802
*1394                                                            YM0829 07349202
*1394544740                                                      M1813  07349602
*1394021000,025000-027000,109014-109021,196500-197000,209200-    M0153  07349702
*1394210600,292660-292690,545040-545580,545640,563000            M0153  07349802
*1394210300,545760                                               M0077  07349902
*1394208900-209600,545080-545360,545440-545600                   M0043  07399902
*1394040000,273000,285000-287000,545000,555000-561000,563000-    S21042 07409902
*1394564000                                                      S21042 07419902
*1394193000,196000-197000,209000-211000,292720-292750,521000,    S21045 07429902
*1394524000                                                      S21045 07439902
*1394021000,025800,027000,544550-544560,544740-544750            M1044  07441902
*1394122600,197100-197200,197700,209700-210200,211500,292655,    M1301  07443902
*1394292750,513200,544660-544670,544700,544770,544830,545070-    M1301  07445902
*1394545080,545100                                               M1301  07447902
*D544840                                                        SA52446 07448302
*A                                                              SA52320 07448702
*                                                               SA63266 07448802
*                                                                       07449102
*          VS2 RELEASE 2 DELETIONS                                      07449502
*001500,012000,021000-028200,041920,071000,109021,118000,118500, Y02072 07449602
*120000-120520,120600,121500-122100,122400,194000,198500-199800, Y02072 07449702
*212500-214900,258000,266000-267920,343000-344000,356000,        Y02072 07449802
*414000-513300,544550-544600,544730,544738,544740,544744,544750, Y02072 07466502
*544770,544830,545094-545102,558500,71500,256000,513400,         Y02072 07476502
*543000-544500,556000,132000-133000,156000-157000,195500-197500, Y02072 07478502
*208700-211500,215000-220000,228000-238000,291000,292908-293363, Y02072 07478902
*293545,293727-315000,345000-348000,544640-544680,544710-544720, Y02072 07479302
*544880-545110,361568-361600,543000-544500,556000,276000-280000, Y02072 07479702
*548300-548600                                                   Y02072 07480102
*                                                                YM1125 07480202
*                                                                YM1457 07480302
*292831                                                          YM3077 07480402
*                                                                YM3838 07485302
*                                                                YM4640 07485402
*                                                                YM2892 07487402
*                                                                YM6249 07489402
*                                                                YM7064 07489802
*C235000,236000,244000,245000                                    YM7362 07489902
*D229000-230000,234000,239100-241000,247000-251800,251920-252000 YM7362 07490002
*                                                                YM7889 07490102
*                                                                YM8298 07512002
*          VS2 RELEASE 3   CHANGES                                      07512537
*C201000-202000                                                @ZA01365 07513002
*A252000-252193                                                @ZA01366 07513502
*D227200-227420,227440-227496                                  @ZA01366 07514002
*A289500-291500                                                @ZA00648 07514202
*A207501-207507                                                @ZA10582 07516237
*C207600                                                       @ZA10582 07518237
*          VS2 RELEASE 3 DELETIONS                                      07522003
*                                                              @Z30TSMI 07534303
         EJECT                                                          07556202
*                                                                       07578102
* REGISTER USAGE                                                        07600002
*                                                                       07700000
R0       EQU   0                        INPUT TO PROB DETERMINATION     07750002
R1       EQU   1                        PARAMETER REGISTER              07900002
RWK2     EQU   R1                       WORK REGISTER                   07950002
R2       EQU   2                        USERS REG 2 FOR AM RTNS  Y02072 07960002
RDCB     EQU   R2                       DCB REGISTER             Y02072 08000002
RBASE    EQU   3                        BASE REGISTER                   08100002
RCORE    EQU   4                        ADDR OF CLOSE WORK AREA         08200002
RPAR     EQU   5                        PARAMETER LIST                  08300002
RWTG     EQU   6                        START OF WTG                    08400002
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 08500002
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      08600002
RWK3     EQU   9                        WORK REGISTER                   08700002
RWK4     EQU   10                       WORK REGISTER                   08800002
RC       EQU   10                       WORK REGISTER          @ZA10582 08850037
RDEB     EQU   11                       DEB ADDRESS                     08900002
R12      EQU   12                       USERS REG 12 FOR AM RTNS Y02072 08950002
RIOB     EQU   R12                      IOB REGISTER             Y02072 09000002
R13      EQU   13                       REG USED TO PASS SAVE    Y02072 09050002
*                                         AREA TO ACC METH RTNS  Y02072 09100002
R14      EQU   14                       RETURN REG FROM AM RTNS         09150002
RWK7     EQU   R14                      WORK REGISTER                   09200002
R15      EQU   15                       RETURN CODE REGISTER AND Y02072 09250002
*                                         FOR BALR INSTRUCTION   Y02072 09260002
RWK8     EQU   R15                      WORK REGISTER                   09300002
         SPACE 3                                                        09350002
*                                                                       09400000
* EQUATES                                                               09450002
*                                                                       09460002
SAVELG   EQU   72                       LENGTH OF SAVE AREA      S21045 10900702
KEYMASK  EQU   X'80'                    MASK TO DISTINGUISH SYS  Y02072 10902102
*                                         KEY FROM USER KEY      Y02072 10952102
CLOSEFIN EQU   0                        CLOSE FINISHED THIS DCB         11030002
DEBDSMOD EQU   X'80'                    DEB DISP=MOD                    11080002
CHARPRES EQU   X'00'                    USED TO TEST DEB TO SEE IF      11130002
*                                         MEMBER NAME PRESENT           11180002
OUTINOUT EQU   X'07'                    DEB TYPE I/O - OUT, OUTIN       11190002
UPDATE   EQU   X'04'                    DEB TYPE I/O - UPDATE           11192002
OUTPUT   EQU   X'0F'                    DEB TYPE I/O - OUTPUT           11194002
INTRNLCD EQU   120                      INTERNAL CODE FOR PD            11194802
DCBTRUNC EQU   8                        TRUNCATE OFFSET IN PUT RTN      11195202
PPLLENTH EQU   12                       LENGTH OF PURGE PARM LST YM3838 11195602
         EJECT                                                          11196002
         USING PSA,0                                             Y02072 11206002
         USING WTG,RWTG                                                 11246002
         USING WTGENTRY,RWTGC                                           11296002
         BALR  RBASE,0                                                  11600000
         USING AMCL,RBASE                                               11650002
AMCL     EQU   *                                                        11800000
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 11801002
         DC    C'IGG0201Z'              MODULE NAME              YM4640 11801202
         DC    C'@ZA10582'              LAST SHIP CODE         @Z30TSMI 11801437
         DC    C'09/21/76'              LAST SHIP DATE         @Z30TSMI 11801637
BEGIN    DS    0H                       END OF MODULE ID         YM4640 11801802
         L     RCORE,WTGDCBWA           GET DCB'S WORK AREA      Y02072 11802002
         USING FORCORE,RCORE                                     Y02072 11804002
         L     RDCB,DXPDCBAD            GET PROTECTED DCB ADDR   Y02072 11806002
         USING IHADCB,RDCB                                              11808002
         L     RDEB,DCBDEBAD            GET VALID DEB ADDR              11808402
         MODESET  KEYADDR=DXUKEY,WORKREG=13 USER KEY FOR GETMAIN Y02072 11810002
         L     RDCB,DXUDCBAD            GET DCB BEING CLOSED     Y02072 12000002
*                                                                       12150002
* THE FOLLOWING GETMAIN WILL RETURN CORE IN USER KEY,            Y02072 12200002
* NON-FETCH PROTECTED. THE AREA IS USED AS A REG SAVE AREA WHEN  Y02072 12210002
* GOING TO QSAM AND BDAM CREATE ROUTINES; AND ALSO FOR           Y02072 12220002
* BUILDING A STOW PARAMETER LIST WHEN NECESSARY.                 Y02072 12230002
*                                                                       12232002
         GETMAIN R,LV=SAVELG,SP=230                              Y02072 12240002
         SPACE 2                                                        12242002
         MODESET  EXTKEY=DATAMGT                                 Y02072 12250002
         SPACE 2                                                        12252002
         ST    R1,SCWGETMA              SAVE AREA ADDRESS        M1301  12260002
         EJECT                                                          12262002
*                                                                       12264002
* THE FOLLOWING WILL GET ALL NECESSARY I/O COMPLETED                    12266002
*                                                                       12268002
         MODESET  KEYADDR=DXUKEY,WORKREG=13                      Y02072 12270002
         SPACE 2                                                        12280002
         L     RIOB,DCBIOBA             GET CURR IOB ADDRESS            12300002
         LA    RIOB,0(RIOB)             CLEAR HIGH ORDER BYTE           12400002
*                                                                       12500000
* SET INDICATOR SO ENTRY TO SYNAD FROM CLOSE WILL NOT OCCUR             12600002
*                                                                       12900000
         OI    DCBCIND2,DCBCNCLO        TURN ON CLOSE FLAG.             13000002
*                                                                       13050002
* TEST FOR FORCE CLOSE IN CONTROL. IF SO, ALL THAT CAN BE DONE   YM6249 13100002
* IS A PURGE. (THIS ROUTINE WILL ONLY BE ENTERED FOR QSAM INPUT  YM6249 13150002
* DATA SETS DURING FORCE CLOSE PROCESSING).                      YM6249 13200002
*                                                                       13250002
         TM    FCACLOS1,FCACFORC        FORCE CLOSE IN CONTROL   YM6249 13300002
         BO    AMCL1025                 YES, GO ISSUE PURGE      YM6249 13310002
         USING DEBBASIC,RDEB                                            13350002
         TM    DEBOPATB,OUTINOUT        DCB OPENED FOR OUT OR OUTIN     13400002
         BO    AMCL1000                 YES BRANCH                      13500002
         TM    DEBOPATB,UPDATE          DCB OPENED FOR UPDATE           13700002
         BZ    AMCL1025                 NO BRANCH                YM3838 13800002
         OI    DCBCIND2,DCBCNSTO        IF THIS IS A MEMBER, NO STOW    14200002
*                                         IS NECESSARY SINCE WE ARE     14300000
*                                         UPDATING IN PLACE.            14400000
         TM    DCBCIND2,DCBCNWR0        HAVE BUFFERS ALREADY BEEN       14500002
*                                         FLUSHED BECAUSE OF END OF VOL 14600000
         BO    AMCL2000                 YES, BRANCH AROUND FLUSHING     14700000
AMCL1000 EQU   *                                                        14900000
         TM    DCBCIND2,DCBCNQSM        DCB USING QSAM TO PROCESS       15100002
         BZ    AMCL1020                 NO BRANCH                Y02072 15200002
         TM    DEBOPATB,OUTPUT          IS DCB OUTPUTTING.              15488902
         BNO   UPTRUNC                  BRANCH IF NO                    15500000
*                                                                       15550002
* MUST ISSUE A TRUNC MACRO FOR LAST QSAM OUTPUT BUFFER                  16100002
*                                                                       16400000
         TM    DCBCIND2,DCBCNIOE         HAS EOV BEEN ENTERED           16500002
*                                          IF SO, MUST HAVE CLOSED IN   16600002
*                                          SYNAD                        16700002
         BO    AMCL1050                  TIPTOE LIGHTLY OUT             16800002
*                                                                       18300000
* FOR UPDATE QSAM - MUST ISSUE A TRUNC ON LAST BUFFER REFERENCED        18400002
* WHICH WILL DETERMINE IF A PUTX WAS ISSUED.  IF SO, LAST BUFFER WILL   18500002
* BE OUTPUT.                                                            18600002
*                                                                       18700000
UPTRUNC  EQU   *                                                        18800000
         TM    DCBCIND2,DCBCNIOE        CLOSE FROM SYNAD           8830 19000002
         BO    AMCL2000                 YES,GO CLEAN UP            8830 19100002
         LR    R1,RDCB                  SET UP REGISTER LINKAGE         19400002
         LA    R15,LOADPUT              INST NEEDED BY SYNCH     Y02072 19450002
*                                         ROUTINE                Y02072 19500002
         BAL   RWK3,SYNCHRTN            GO TO SYNCH RTN          Y02072 19750002
         L     RDEB,DCBDEBAD            RELOAD DEB REG AS TRUNC COULD   19800002
*                                         CAUSE AN EOV CONDITION        19850002
         TM    DEBOPATB,DEBACCS-UPDATE  ANY BITS OTHER THAN      A26014 20010002
*                                         UPDATE                 A26014 20020002
         BNZ   AMCL1005                 BRANCH IF YES            A26014 20030002
         TM    DEBOPATB,UPDATE          UPDATE MODE              A26014 20050002
         BO    PUTLOC                   BRANCH,YES               A26014 20060002
AMCL1005 EQU   *                                                 A26014 20080019
         CLI   DCBMACF2,DCBMRPUT+DCBMRLCG DCB USING LOCATE MODE@ZA01365 20100002
         BNE   TRUNC001                 NO BRANCH              @ZA01365 20200002
*                                                                       20500000
* MUST ISSUE A WAIT ON ALL OUTSTANDING IOBS BEFORE ISSUING PUT @ZA10582 20600037
*                                                                       20610037
PUTLOC   EQU   *                                                        20620037
         L     RC,DCBIOBA        GET PREVIOUS IOB                       20630037
LOOP     TM    4(RC),X'C0'       POSTED OR WAITING             @ZA10582 20640037
         BM    NEXT              YES, BRANCH                   @ZA10582 20650037
         WAIT  ECB=4(RC)         WAIT FOR IOB TO COMPLETE      @ZA10582 20660037
NEXT     CLC   DCBIOBA+1(3),1(RC) ALL IOBS BEEN WAITED ON      @ZA10582 20670037
         BE    POSTED1           YES, BRANCH                   @ZA10582 20680037
         L     RC,0(RC)          GET NXT IOB                   @ZA10582 20690037
         B     LOOP              GO CHECK NEXT IOB             @ZA10582 20700037
*                                                                       20710037
* MUST ISSUE A PUT IF IN LOCATE MODE TO FLUSH BUFFER AFTER TRUNC        20720037
*                                                                       20730037
POSTED1  LR    R1,RDCB                  SET UP PARAMETER       @ZA10582 20740037
*                                         REGISTERS              A26014 20820002
         L     R15,DCBPUT               PUT ROUTINE ADDR         Y02072 20870002
         BAL   RWK3,SYNCHRTN            GO TO SYNCH RTN          Y02072 21100002
         L     RDEB,DCBDEBAD            RELOAD DEB REG AS PUT COULD     21150002
*                                         CAUSE AN EOV CONDITION        21200002
*********************************************************************** 21210002
*                                                                       22100000
*      MUST NOW WAIT ON QSAM I/O BEFORE POSSIBLY ATTEMPTING A STOW.     22200002
*********************************************************************** 22300002
TRUNC001 EQU   *                                                        22400000
         L     RIOB,DCBIOBA             GET ADDR OF IOB PAST THE LAST   22600002
*                                         ONE SCHEDULED                 22700002
         LA    RWK7,0(RIOB)             SAVE ADDR FOR COMPARE    YM7362 22702002
*                                                                       22710002
         USING IOBQSAMN,RIOB                                     YM7362 22742402
TRUNC002 EQU   *                                                  18147 23200000
         L     RIOB,IOBNIOBA            GET NEXT IOB             YM7362 23500002
AMCL1010 EQU   *                                                 YM7362 23550002
         TM    IOBNECB,ECBNORM          IOB COMPLETE NORMALLY    YM7362 23600002
         BO    TRUNC003                 YES, SEE IF LAST          18147 23700002
         BM    AMCL2020                 NO, GO TO ERROR HANDING  YM7362 23750002
*                                         ROUTINE                YM7362 23800002
         WAIT  ECB=IOBNECB              WAIT FOR COMPLETION      Y02072 23900002
         B     AMCL1010                 GO TEST COMPLETION CODE  YM7362 23950002
TRUNC003 EQU   *                                                  18147 24200000
         LA    RIOB,0(RIOB)             CLEAR HI BYTE            YM7362 24400002
         CR    RWK7,RIOB                HAVE ALL IOBS BEEN CHKD  YM7362 24500002
         BNE   TRUNC002                 NO, GO CHECK NEXT IOB     18147 24600002
         B     AMCL1050                 YES, CONTINUE            Y02072 25190002
         SPACE                                                          25200002
*      UNDER NORMAL CIRCUMSTANCES THE ABOVE-ISSUED PUT LOCATE ADVANCED  25205002
* DCBIOBA TO THE NEXT IOB OR ICB.  THE NEXT MODULE OF CLOSE WILL ISSUE  25206002
* EOV, WHICH EXPECTS DCBIOBA TO POINT TO THE LAST IOB/ICB TO BE         25207002
* RESTARTED.  THE ABNORMAL CIRCUMSTANCE THAT WE MUST SUPPORT IS         25208002
* COBOL PROGRAMS, WHICH ISSUE PUT LOCATE AND THEN CHANGE THEIR MIND     25209002
* JUST BEFORE CLOSE AND RETRACT THE LAST PUT BY REDUCING QSAM'S         25209202
* INTERNAL FIELD, DCBRECAD.  THIS MAY PRODUCE A ZERO-LENGTH RECORD      25209402
* AND THE PUT ROUTINE DOES NOT ADVANCE THE IOB POINTER IN THAT CASE.    25209602
*      FOR DA DEVICES USING CHAINED SCHEDULING, THE ICBS AFTER          25209802
* THE ICB IN ERROR MAY HAVE BEEN POSTED WITH X'40' TO INDICATE          25209902
* OUT-OF-EXTENT, BUT IF THERE HAS BEEN A REAL I/O ERROR, THE LATER      25214902
* ICBS HAVE NOT AND WILL NEVER BE POSTED.  WE CANNOT WAIT ON THEM.      25215902
*      FOR DA DEVICES NOT USING CHAINED SCHEDULING, THE IOBS AFTER      25216902
* THE IOB IN ERROR HAVE BEEN OR SOON WILL BE POSTED WITH X'48' TO       25217902
* INDICATE THAT THEY HAVE BEEN PURGED.                                  25218902
*      IGG0201B WILL DO ANY ADJUSTMENT IN DCBIOBA NECESSARY FOR EOV.    25219302
         DROP  RIOB                                              YM7362 25240002
AMCL2020 EQU   *                                                        25400000
         SPACE                                                          25410002
         MODESET  EXTKEY=DATAMGT                                 Y02072 25450002
         SPACE                                                          25500002
         MVC   WTGIDTTR,ERRMOD          SET UP FOR NEXT EXEC   @Z30TSMI 25600003
         B     AMCL2035                 GO CALL IT IN, DO NOT    Y02072 25800002
*                                         FREEMAIN WORKAREA      Y02072 25810002
AMCL1020 EQU   *                                                        28900002
*      AT THIS POINT WE KNOW IT IS BSAM OUTPUT OR OUTIN, INCLUDING      28950002
* POSSIBLY BDAM CREATE.                                                 28952002
*      IF CLOSE WAS ISSUED IN THE SYNAD ROUTINE, WE WANT TO SET         28960002
* DCBFDAD TO THE MBBCCHHR OF THE BLOCK THAT HAD THE ERROR AND TO        28970002
* REESTABLISH A VALID TRACK BALANCE.  THIS IS SO THAT COMMON CLOSE      28980002
* WILL WRITE THE 'LAST BLOCK TTR' AND TRACK BALANCE CORRECTLY IN THE    28990002
* DSCB AND WRITE THE FILE MARK CORRECTLY.  THE USER MAY WANT TO USE     29000002
* DISP=MOD TO CONTINUE WRITING THE DATA SET WHETHER IT IS SEQUENTIAL    29010002
* OR PARTITIONED.                                                       29020002
         TM    DCBCIND2,DCBCNIOE        WAS CLOSE FROM SYNAD   @ZA00648 29030002
         BNO   AMCL1022                 BR IF NOT FROM SYNAD   @ZA00648 29040002
*            WE NOW KNOW THE SYNAD ROUTINE WAS ENTERED AND NOT EXITED,  29050002
*        BUT THE USER MAY HAVE TURNED OFF DCBIFLGS TO MAKE THE DCB      29060002
*        USABLE TO IOS AND DONE SOME MESSING AROUND, PERHAPS TO SET     29070002
*        DCBFDAD AND DCBTRKBL LIKE WE ARE ABOUT TO DO.                  29080002
         TM    DCBIFLGS,DCBIFEC         DCB STILL SHOW ERROR   @ZA00648 29090002
         BNO   AMCL1022                 BR IF ERROR CLEANED UP @ZA00648 29100002
*            IF THE LAST OPERATION WAS NOT A WRITE, CLOSE WILL NOT      29110002
*        WRITE A FILE MARK.                                             29120002
         TM    DCBOFLGS,DCBOFLWR  SEE IF LAST OPER WAS WRITE   @ZA00648 29130002
         BO    AMCL2020           GO TO 201B IF WRITE WAS LAST @ZA00648 29140002
AMCL1022 EQU   *                  DCBFDAD WILL NOT BE RESET    @ZA00648 29150002
*                                                                       29209002
* IF THE REQUEST IS FOR CREATE BDAM AND THE RECFM IS FIXED FORMAT,      29212002
* THIS ROUTINE DETERMINES IF IT IS NECESSARY TO UPDATE THE CAPACITY     29215002
* RECORD ON THE LAST TRACK OF THE DATA SET. IF REQUIRED, THE ROUTINE    29218002
* DOES A BALR TO THE WRITE MODULE AND UPDATES THE CAPACITY RECORD (R0)  29221002
*                                                                       29233019
         CLI   DCBMACF2,DCBMRWRT+DCBMRLDM  IS THIS CREATE BDAM  SA52320 29239002
         BNE   AMCL1025                 NO, MUST BE BSAM         Y02072 29242002
         TM    DCBRECFM,DCBRECV         IF RECFM IS NOT FIXED    A27066 29245002
         BO    AMCL1030                 BR TO CONTINUE           Y02072 29248002
         TM    DCBCIND2,DCBCNWR0        WAS R0 WRITTEN           A27066 29251002
         BO    AMCL1030                 YES-BR TO CONTINUE       Y02072 29254002
         L     RWK8,DCBIOBA             GET IOB ADDRESS          A27066 29257002
         USING IOBBSAMN,RWK8                                            29259002
         L     R1,IOBECBPT              GET DECB ADR FOR WRITE   A27066 29260002
*                                         MODULE                 A27066 29263002
         LTR   R1,R1                    WAS ANY I/O ISSUED       A36895 29264002
         BZ    AMCL1030                 NO, DON'T WRITE CAP REC  Y02072 29265002
*                                                                       29265102
* SINCE THE USER'S DECB MAY HAVE BEEN FREED BY NOW, A NEW DECB WILL     29265402
* BE BUILT, 3 FULLWORDS LONG, STARTING IN THE 2ND WORD OF THE CHANNEL   29268521
* PGM, THAT PART OF THE CHAN PGM NOT NOW BEING USED                     29270502
*                                                                       29270902
         USING DECB,R1                                                  29271002
         LA    R1,IOBCPDEC+L'CCWADDRA   START OF NEW DECB        A48228 29271302
         ST    R1,IOBECBPT              UPDATE IOB'S ECB PTR     A48228 29271702
         ST    RDCB,DECDCBAD            SET DCB PTR IN NEW DECB  A48228 29271802
         XC    DECSDECB,DECSDECB        ZERO OUT ECB             A48228 29271902
         DROP  R1,RWK8                                                  29272002
         L     R15,DCBWRITE             GET WRITE RTN ADDR       Y02072 29291102
         BAL   RWK3,SYNCHRTN            GO SYNCH                 Y02072 29318102
         L     RWK2,DCBIOBA             GET IOB ADDR             YM0829 29345402
         USING IOBBSAMN,RWK2                                            29347402
         L     RWK2,IOBECBPT            LOAD ECB ADDR            YM8298 29357402
         DROP  RWK2                                              YM8298 29359402
         WAIT  ECB=(RWK2)               WAIT ON R0 I/O           YM8298 29363602
         B     AMCL1030                 BYPASS PURGE             YM3838 29418702
*                                                                       29419102
* MUST ISSUE PURGE SVC FOR BSAM AND QSAM INPUT DATA SETS.        YM3838 29419502
* OPTIONS ARE:                                                   YM3838 29419602
*   X'80' (ON) - PURGE BY DEB                                    YM3838 29419902
*   X'20' (ON) - HALT I/O                                        YM3838 29420302
*   X'10' (OFF) - ALL ASSOCIATED REQUESTS                        YM3838 29420602
*                                                                       29422002
AMCL1025 EQU   *                                                 YM3838 29422302
         L     RWK4,SCWGETMA            USER KEY WORKAREA FOR    YM3838 29422702
*                                         PARAMETER LIST         YM3838 29423102
         USING PPLDSID,RWK4                                      YM3838 29423502
         XC    PPLDSID(PPLLENTH),PPLDSID  CLEAR LIST             YM3838 29423902
         ST    RDEB,PPLDSID             PURGE BY DEB             YM3838 29424302
         MVI   PPLOPT1,PPLDS+PPLHIO     OPTIONS TO LIST          YM3838 29424402
         LR    R1,RWK4                  INPUT TO PURGE           YM3838 29424502
         PURGE (1)                      ISSUE PURGE              YM3838 29424702
         LA    R1,PPLCC                 ECB TO BE POSTED         YM3838 29474602
         WAIT  ECB=(1)                  WAIT FOR COMPLETION      YM3838 29484602
         DROP  RWK4                                              YM3838 29494602
         MODESET  EXTKEY=DATAMGT        KEY OF AUDIT TRAIL       YM3838 29504602
         SPACE                                                          29514602
         OI    FCACLOS2,FCACPURG        INDIC PURGE COMPLETED    YM3838 29516602
         MODESET  KEYADDR=DXUKEY,WORKREG=10  RESUME USER KEY     YM3838 29518602
         SPACE                                                          29520602
*                                                                       29522602
* TEST FOR FORCE CLOSE. IF SO, XCTL TO IGG0201Y FOR CLEAN UP.    YM6249 29523002
*                                                                       29523402
         TM    FCACLOS1,FCACFORC        FORCE CLOSE IN CONTROL   YM6249 29523802
         BO    AMCL2030                 YES, GO FREE WORKAREA    YM6249 29524202
AMCL1030 EQU   *                                                 Y02072 29524602
         TM    DEBOPATB,OUTINOUT        OPENED FOR OUT OR OUT/IN        31700002
         BNO   AMCL2000                 NO BRANCH                       31800002
AMCL1050 EQU   *                                                        32000000
         TM    DCBOPTCD,DCBOPTT         TEST FOR TOTALING          UT18 32020002
         BO    AMCL2000                 BR IF TOTALING SPECIFIED   UT18 32040018
         TM    DCBCIND2,DCBCNSTO        HAS STOW BEEN ACCOMPLISHED YET  32500002
         BO    AMCL2000                 YES BRANCH                      32600002
         EJECT                                                          32650002
*                                                                       32700000
* PREPARE TO ISSUE A STOW ON USER MEMBERNAME                            32800002
*                                                                       32900000
         SR    RWK2,RWK2                                                33000002
         SR    RWK4,RWK4                                                33100002
         IC    RWK4,DEBNMEXT            GET NUMBER OF EXTENTS           33200002
         IC    RWK2,DEBEXSCL            GET SCALING FACTOR  FOR EXTENT  33300002
         SLL   RWK4,0(RWK2)             EXTENT SIZE X EXTENT NUMBER     33400002
         LA    RWK4,DEBBASND(RWK4)      EXTENTS+DEB+BASE                33500002
         USING DEBACSMD,RWK4                                            33550002
         TM    DCBDSORG,DCBDSGPO        DCB FOR  PO DATA SET            33600002
         BO    AMCL1060                 YES BRANCH                      33700002
         LA    RWK4,DEBDSNM             ADD SAM LEN TO DEB SIZE         33900002
AMCL1060 EQU   *                                                        34100000
         CLI   DEBAMLNG,L'DEBDSNM       ACCESS METHOD DEPENDENT   M3945 34130002
*                                         SECTION PRESENT               34140002
         BL    AMCL2000                 BRANCH IF NO             M3945  34160019
         DROP  RDEB                                                     34170002
         USING DEBDSNM,RWK4                                             34220002
         CLI   DEBDSNM,CHARPRES         IS MEMBERNAME IN DEB     A25961 34230002
         BE    AMCL2000                 BR IF NO                 A25961 34260019
*                                                                       34270002
* STOW PARM LIST MUST BE IN SAME KEY AS STOW IS ISSUED IN TO     Y02072 34272002
* KEEP STOW FROM PROGRAM CHECKING.                               Y02072 34274002
*                                                                       34276002
         L     RWK3,SCWGETMA            USE USER KEY WORKAREA    Y02072 34280002
*                                         FOR PARM LIST          Y02072 34282002
         USING STOW,RWK3                                         Y02072 34292002
         MVC   STONAME,DEBDSNM          STORE MEMBERNAME IN PARM Y02072 34300002
*                                         LIST                   Y02072 34350002
         MVI   STOCTTRN,0               INDICATE NOT AN ALIAS    Y02072 34400002
*                                         AND LEN OF USER FIELD  Y02072 34410002
*                                         EQUALS ZERO            Y02072 34420002
         DROP  RWK4                                                     34850002
         LA    RDCB,0(RDCB)             ZERO HI BYTE             YM1457 34852002
         USING DEBBASIC,RDEB                                            34860002
         TM    DEBOFLGS,DEBDSMOD        MEMBER BEING ADDED       Y02072 34900002
*                                         (DISP=MOD OR NEW)      Y02072 34950002
         BO    AMCL1080                 YES BRANCH               Y02072 35000002
*                                                                       35100000
* MEMBER IS BEING REPLACED IN PARTITIONED DATA SET (DISP=OLD)           35200002
*                                                                       35500000
         STOW  (RDCB),(RWK3),R          REPLACE MEMBER IN PDS    Y02072 35600002
*                                                                       35700000
         LR    RWK4,R15                 SAVE STOW RETURN CODE    Y02072 35750002
         BAL   RWK3,CHECKDEB            GO VERIFY DEB ADDR SINCE Y02072 35760002
*                                         AN EOV COULD OCCUR IN  Y02072 35770002
*                                         STOW                   Y02072 35780002
         CH    RWK4,ERRCODE             ROOM AVAIL FOR FM               35800002
         BH    ABEND                    YES BRANCH - ABEND B14          35900002
         B     AMCL2000                 NO, CONTINUE             Y02072 35910002
AMCL1080 EQU   *                                                 Y02072 35950002
*                                                                       36000002
* MEMBERNAME IS BEING ADDED TO DIRECTORY OF DATA SET                    36050002
*                                                                       36060002
         STOW  (RDCB),(RWK3),A          ADD MEMBER NAME TO DIR.  Y02072 36070002
*                                                                       36080002
         LR    RWK4,R15                 SAVE STOW RETURN CODE    Y02072 36080402
         BAL   RWK3,CHECKDEB            GO VERIFY DEB ADDR SINCE Y02072 36080802
*                                         AN EOV COULD OCCUR IN  Y02072 36081202
*                                         STOW                   Y02072 36081602
         DROP  RWK3                                                     36082002
         LTR   RWK4,RWK4                WERE THERE ANY ERRORS           36090002
         BNZ   ABEND                    YES, BRANCH              Y02072 36090402
         B     AMCL2000                 CONTINUE                 Y02072 36093802
ABEND    EQU   *                                                        36094002
*                                                                       36096002
* REG 10 WILL HAVE A RETURN CODE FROM STOW. THE RETURN CODE             36098002
* WILL RESULT IN THE FOLLOWING INTERNAL CODES FOR A                     36098402
* B14 ABEND:  4 - 121                                                   36098802
*             8 - 122                                                   36098902
*             C - 123                                                   36099002
*            10 - 124                                                   36099102
*            14 - 125                                           SA63266 36101602
*            18 - 126                                           SA63266 36103602
* THE FOLLOWING ROUTINE WILL INITIALIZE THE INTERNAL CODE TO 120,       36104102
* DIVIDE THE RETURN CODE IN REG 10 BY 4, AND ADD THAT TO 120 TO         36106602
* CALCULATE THE INTERNAL CODE NEEDED                                    36109102
*                                                                       36111602
         LA    R0,INTRNLCD              PUT CODE IN REG          S21042 36114102
         SRL   RWK4,2                   DIVIDE RETURN CODE BY 4  S21042 36116602
         AR    R0,RWK4                  CALCULATE INTERNAL CODE  S21042 36126602
         L     RWK4,PSATOLD             GET CURRENT TCB          Y02072 36127002
         USING TCB,RWK4                                                 36128602
         TM    TCBFLGS1,TCBFA           IS THIS ENTRY TO CLOSE FROM     36133202
*                                         ABEND                         36138802
         BO    AMCL2000                 IF SO, BRANCH--WE MUST   Y02072 36140802
*                                         NOT ABEND AGAIN        Y02072 36142802
         MODESET  EXTKEY=DATAMGT                                 Y02072 36143202
         SPACE 2                                                        36143302
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES      S21042 36143602
         STC   R0,SCWSAVCD              SAVE CD ACROSS FREEMAIN  Y02072 36143702
         SPACE 2                                                        36144002
         MODESET KEYADDR=DXUKEY,WORKREG=10  USER KEY FOR FREEMAN Y02072 36147202
         SPACE 2                                                        36149202
         B     AMCL2030                 GO FREEMAIN SAVE AREA    Y02072 36150402
         EJECT                                                          36152402
AMCL2000 EQU   *                                                        36153602
*                                                                       36155602
* TEST FOR QSAM ERRORS AND XCTL TO 201B IF NECESSARY.                   36156002
*                                                                       36156402
         TM    DCBCIND2,DCBCNQSM        QSAM                    SA52320 36170002
         BZ    AMCL2030                 NO - DO NOT CHECK       SA52320 36180021
         TM    DCBIFLGS,DCBIFEC         I/O ERROR                  8383 36300002
         BZ    AMCL2030                 NO,BRANCH                  8383 36400000
         TM    DCBOFLGS,DCBOFLWR        LAST OP A WRITE            8383 36600002
         BZ    AMCL2030                 NO,BRANCH                  8383 36700000
         OI    DCBCIND2,DCBCNIOE        TURN ERROR BIT ON          8383 36900002
         B     AMCL2020                 SETUP FOR 201B             8383 37000000
AMCL2030 EQU   *                                                        37400000
         L     R1,SCWGETMA              OBTAIN SAVE AREA ADDRESS M1301  51320002
         FREEMAIN R,LV=SAVELG,A=(1),SP=230                       Y02072 51330002
         SPACE 2                                                        51330402
         MODESET  EXTKEY=DATAMGT                                 Y02072 51332002
         EJECT                                                          51332402
*                                                                       51332802
* FIND THE NEXT MODULE TO PROCESS.                                      51333202
*                                                                       51333602
         SR    R0,R0                    PREPARE TO LOAD REGISTER Y02072 51333702
         IC    R0,SCWSAVCD              ASSUME PROB DET NEXT LD  Y02072 51333802
*                                         (NO HARM DONE IF NOT)  Y02072 51333902
         CLC   WTGIDNX,PDLOAD           ARE WE GOING TO PROB DET Y02072 51334002
         BE    AMCL5019                 YES, BR AROUND RELOOP    Y02072 51336002
         MVC   WTGIDTTR,CLL1Y           SET UP ID FOR NEXT     @Z30TSMI 51340003
*                                         EXECUTOR               Y02072 51342002
AMCL2035 EQU   *                                                 Y02072 51344002
         TM    FCACLOS1,FCACFORC        IS FORCE CLOSE IN CNTRL  Y02072 51346002
         BO    AMCL5019                 YES, BYPASS RELOOP CODE  Y02072 51348002
RELOOP1  EQU   *                                                 S21045 51350021
         LA    RWTGC,L'WTGENTRY(,RWTGC)  STEP TO NEXT ENTRY             51500002
         LA    RPARC,L'PARDCBAD(,RPARC)  STEP TO NEXT ENTRY             51600002
         CLC   WTGIDNX,AMIDCNST         THIS RTN NEEDED AGAIN           51700002
         BCR   8,RBASE                  RECURSE THRU MODULE             51800000
         CLC   WTGIDNX,CLLDB            IS THIS THE END OF THE TABLE    52000002
         BL    RELOOP1                  NO BRANCH                S21045 52100021
         CLC   WTGIDNX,CLLDG            IS THIS THE END OF THE TABLE    52300002
         BH    RELOOP1                  NO BRANCH                S21045 52400021
         LR    RPARC,RPAR               INITIALIZATION                  52600000
         DROP  RWTGC                                                    52650002
         LA    RWTGC,WTGENTRY                                           52700002
         USING WTGENTRY,RWTGC                                           52800002
AMCL5011 EQU   *                                                        52900000
         CLI   WTGIDTTR,CLOSEFIN        IS THIS ENTRY = ZERO            53100002
         BNE   AMCL5019                 NO BRANCH                       53200002
         LA    RWTGC,L'WTGENTRY(,RWTGC)  STEP TO NEXT ENTRY             53400002
         LA    RPARC,L'PARDCBAD(,RPARC)  STEP TO NEXT ENTRY             53500002
         B     AMCL5011                                                 53600000
AMCL5019 EQU   *                                                        54000000
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*54200003
               MODID=WTGENTRY           GO TO NEXT ROUTINE     @Z30TSMI 54250003
         EJECT                                                          54452002
*                                                                       54453002
* THIS ROUTINE TESTS THE CALLERS KEY TO DETERMINE WHETHER TO     Y02072 54461702
* BALR (IF KEY IS LT 8) OR SYNCH (IF KEY IS GT 7) TO THE ACCESS  Y02072 54461802
* METHOD ROUTINES. CLOSES REGS ARE SAVED IN THE SVRB SAVEAREA    Y02072 54461902
* AND THE USERS REGISTERS ARE LOADED AND PASSED TO THE ACCESS    Y02072 54463602
* METHOD ROUTINES (FOR THE CASE AN EOV CONDITION ARISES AND A    Y02072 54465602
* USER EOV EXIT IS TAKEN). THE SAVEAREA GOTTEN FROM SP230 IS     Y02072 54467602
* PASSED IN R13 TO THE ACCESS METHOD ROUTINES. THE SYNCH IS      Y02072 54467702
* TAKEN TO THE INSTRUCTIONS SET UP AT THE END OF THIS ROUTINE    Y02072 54467902
* (WHEN ISSUING A TRUNC) WHICH WILL CAUSE A BALR TO THE ACCESS   Y02072 54468302
* METHOD ROUTINES. WHEN ISSUING A PUT OR WRITE, THE SYNCH GOES   Y02072 54468702
* DIRECTLY TO THE PUT OR WRITE MODULE.                           Y02072 54468802
*                                                                       54469002
SYNCHRTN EQU   *                                                 M0153  54469402
         L     RWK7,PSATOLD             GET CURRENT TCB ADDR     Y02072 54471402
         USING TCB,RWK7                                          Y02072 54473402
         L     RWK7,TCBRBP              GET RB ADDR              Y02072 54475402
         DROP  RWK7                                              Y02072 54475802
         USING RBSECT,RWK7              R14 IS BASE FOR SVRB     M0153  54476202
         SPACE 2                                                        54476602
         MODESET  EXTKEY=SUPR                                    Y02072 54477902
         SPACE 2                                                        54478302
         STM   RDCB,RIOB,RBEXSAVE       SAVE CLOSE REG IN SVRB   M1301  54479602
         MODESET  KEYADDR=DXUKEY,WORKREG=13                      Y02072 54481302
         SPACE                                                          54491302
         L     R13,SCWGETMA             GET REG SAVE AREA ADDR   Y02072 54491702
         TM    DXUKEY,KEYMASK           IS CALLERS KEY 8 OR      Y02072 54493202
*                                         OR HIGHER              Y02072 54494902
         BO    PRB                      SYNCH IF GT OR EQ TO 8   Y02072 54498302
         LM    R2,R12,RBGRS2            RESTORE USERS REG 2-12   Y02072 54499402
         DROP  RWK7                                              Y02072 54499802
         BALR  R14,R15                  BR TO DO LAST I/O        M0153  54500002
         USING *,R14                                             Y02072 54502102
         B     RELOAD                   GO LOAD REGISTERS AND    M0153  54503402
*                                         RETURN                 M0153  54505102
         DROP  R14                                               Y02072 54505502
PRB      EQU   *                                                 M0153  54506802
         USING RBSECT,RWK7                                       Y02072 54508802
         LM    R2,R12,RBGRS2            GET USERS REGISTERS      Y02072 54510802
         DROP  RWK7                                              Y02072 54512802
*                                                                       54514802
* GO TO THE ACCESS METHOD ROUTINES IN PROBLEM PROGRAM STATE TO          54515202
* DO THE LAST I/O                                                       54518502
*                                                                       54520502
         SYNCH  (15)                                             M0153  54522102
RELOAD   EQU   *                                                        54528702
         L     RWK7,PSATOLD             GET CURRENT TCB          Y02072 54532002
         USING TCB,RWK7                                          Y02072 54535302
         L     RWK7,TCBRBP              GET RB ADDRESS           Y02072 54545302
         DROP  RWK7                                              702072 54555302
         USING RBSECT,RWK7                                       Y02072 54557302
         LM    RDCB,RIOB,RBEXSAVE       RESTORE CLOSES REGS      Y02072 54559302
         DROP  RWK7                                              Y02072 54559402
*                                                                       54585402
* MUST VERIFY DEB ADDRESS AS PUT OR TRUNC COULD CAUSE AN EOV.    Y02072 54595402
*                                                                       54605402
CHECKDEB EQU   *                                                 Y02072 54607402
         DEBCHK  (RDCB)                 VERIFY DEB ADDR          Y02072 54609402
         LR    RDEB,R1                  VALID DEB ADDR           Y02072 54611402
         L     RDCB,DXPDCBAD            GET PROTECTED DCB ADDR   Y02072 54611802
         MODESET  EXTKEY=DATAMGT        KEY OF PROTECTED DCB     Y02072 54611902
         SPACE                                                          54620602
         ST    RDEB,DCBDEBAD            UPDATE PROTECTED DCB     Y02072 54622602
         MODESET  KEYADDR=DXUKEY,WORKREG=2  RESUME USER KEY      Y02072 54624602
         SPACE                                                          54626602
         L     RDCB,DXUDCBAD            RELOAD WITH USERS DCB    Y02072 54628602
         BR    RWK3                     RETURN TO MAIN ROUTINE   M0153  54629302
*                                                                       54638002
* INSTRUCTIONS USED TO GO TO THE ACCESS METHOD ROUTINES          Y02072 54664002
*                                                                       54690002
         DROP  RDCB                                              Y02072 54716002
         USING IHADCB,R1                                         Y02072 54742002
LOADPUT  DS    0H                       FOR QSAM                 Y02072 54768002
         L     R15,DCBPUT               INST TO LOAD PUT RTN ADD Y02072 54794002
BRTRUNC  B     DCBTRUNC(R15)            BR TO TRUNC ROUTINE      Y02072 54820002
         EJECT                                                          54846002
*                                                                       54872002
* CONSTANTS                                                             54898002
*                                                                       54924002
AMIDCNST DC    C'1Z'                    ID OF THIS MODULE        S19015 54950019
CLLDB    DC    C'0B'                    FOR TEST END OF WTG TAB  S19015 55000002
CLLDG    DC    C'0G'                    FOR TEST END OF WTG TAB  S19015 55050002
CLL1Y    DC    C'1Y',VL3(IGG0201Y)      MODULE IGG0201Y        @Z30TSMI 55060003
ERRMOD   DC    C'1B',VL3(IGG0201B)      MODULE IGG0201B        @Z30TSMI 55070003
PDLOAD   DC    C'6M',VL3(IGG0206M)      MODULE IGG0206M        @Z30TSMI 55080003
ERRCODE  DC    H'8'                     IF STOW RETURN CODE IS          55100002
*                                         HIGHER, GO TO PROBLEM DET     55150002
         SPACE 3                                                        55200002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 55250002
END      EQU   *                                                 Y02072 55300002
*                                                                       55400000
         TITLE 'IGG0201Z - CLOSE PARAMETER LIST DSECT'                  55450002
         IGGPARML                                                       55500002
         TITLE 'IGG0201Z - DSECT FOR STOW PARAMETER LIST'               55860002
         IHASTOW                                                 Y02072 55910002
         TITLE 'IGG0201Z - WHERE TO GO TABLE DSECT'                     56200002
         IECDSECS  WTG,PREFX,EXPAND=YES                                 56300003
         ORG   WTGIDTTR                                                 56308502
WTGIDNX  DS    CL2                      ID NEXT MODULE                  56310502
         ORG   WTGIDTTR+4                                               56311302
WTGDCBWA DS    A                        ADDR OF WORK AREA FOR DCB       56311402
         TITLE 'IGG0201Z - CLOSE WORK AREA DSECT'                       56311602
         IECDSECS  (MAIN,(IOB,NO)),EXPAND=YES                    Y02072 56313602
FORCORE  DSECT                                                   Y02072 56315602
         IHAFCAUD  ORG=YES                                       Y02072 56317602
         EJECT                                                          56319602
         IGGSCW                                                         56320802
         TITLE 'IGG0201Z - IOB DSECT'                                   56325402
         IEZIOB                                                         56330002
         ORG   IOBRSV35                                                 56330402
IOBCPDEC DS    F                        BEGINNING OF THE DECB BUILT     56332002
*                                         DURING CLOSE IN THE CP        56334002
         TITLE 'IGG0201Z - ECB DSECT'                                   56340002
         IHAECB                                                         56342002
         TITLE 'IGG0201Z - DECB DSECT'                                  56344002
         IHADECB                                                        56346002
         TITLE 'IGG0201Z - DEB DSECT'                                   56348002
         IEZDEB                                                         56348402
         TITLE 'IGG0201Z - DCB DSECT'                                   56348802
         IHADCB  DSORG=PS                                               56349202
         TITLE 'IGG0201Z - TCB DSECT'                                   56349602
         IKJTCB                                                         56349702
         TITLE 'IGG0201Z - REQUEST BLOCK DSECT'                         56349802
         IHARB                                                          56349902
         TITLE 'IGG0201Z - PSA DSECT'                                   56369902
         IHAPSA                                                  Y02072 56379902
         TITLE 'IGG0201Z - CCW DSECT'                                   56389902
         IHACCW  DSECT=YES                                              56399902
         TITLE 'IGG0201Z - CVT DSECT'                                   56401903
CVT      DSECT                                                          56403903
         CVT                                                            56405903
         TITLE 'IGG0201Z - PURGE PARAMETER LIST DSECT'                  56409902
         IECDPPL  DSECT=YES                                      YM3838 56419902
         END                                                            56420002
./  ADD  SSI=82120091,NAME=IGG08101
         TITLE 'IGG08101 - SETPRT LOAD 2 - UCS IMAGE RETRIEVAL'         00100002
IGG08101 CSECT                                                          00200018
* /*  START OF SPECIFICATIONS****                             @Z40MSAP  00202048
*01*  PROCESSOR = ASSEMXF:                                              00204048
**** END OF SPECIFICATIONS **                                @Z40MSAP*/ 00204448
*********************************************************************** 00205002
*                                                                       00250002
* MODULE-NAME = IGG08101                                                00300002
*                                                                       00350002
* DESCRIPTIVE-NAME = SETPRT UCS IMAGE RETRIEVAL                         00400002
*                                                                       00405002
* COPYRIGHT = NONE                                                      00415002
*                                                                       00800021
* STATUS = VS2-4, LEVEL 1                                               01200048
*                                                                       01250021
* FUNCTION = USE BLDL MACRO TO LOCATE THE UCS IMAGE IN SYS1.IMAGELIB    01300002
*            USE LOAD MACRO TO RETRIEVE THE UCS IMAGE FROM IMAGELIB     01500002
*            WHEN IMAGE IS FOUND,ISSUE WTOR IEC120 TO REQUEST           01766702
*                     AN OPERATOR MOUNT CHAIN/TRAIN.                    01800018
*            WHEN IMAGE IS NOT FOUND,ISSUE WTOR AND IEC122 TO           01900002
*                    REQUEST AN OPERATOR SPECIFY AN ALTERNATE CHAIN.    02000018
*            ANALYZE OPERATOR REPLY                                     02100002
*                                                                       02105002
* NOTES =                                                               02110002
*    DEPENDENCIES = BLANK AND COMMA ARE USED--CORRECTABLE BY            02115002
*        REASSEMBLY.  THE FOLLOWING CHARACTER STRINGS ARE USED IN       02120002
*        TESTING OPERATOR REPLIES:                                      02125002
*        'F', 'V', 'U', 'C', 'FOLD', 'VERIFY', 'CANCEL'                 02130002
*        THESE STRINGS ARE CONSIDERED TO BE OPERATING SYSTEM KEYWORDS   02135002
*        RATHER THAN LANGUAGE DEPENDENT PHRASES.                        02140002
*                                                                       02145002
*        BLANKS ARE OR'ED TO ALL REPLIES TO CONVERT THEM TO UPPER CASE  02150002
*                                                                       02151002
*    RESTRICTIONS = NONE                                                02155002
*                                                                       02156002
*    REGISTER-CONVENTIONS = ALL REGISTER NAMES BEGIN WITH R             02160002
*        SEE EQUATES IMMEDIATELY FOLLOWING PROLOG                       02165002
*                                                                       02170002
*    PATCH-LABEL = PATCH, AN AREA ASSEMBLED AS BINARY 0                 02175002
*                                                                       02180002
* MODULE-TYPE =                                                         02185002
*    PROCESSOR = OS/VS ASSEMBLER                                        02190002
*                                                                       02192002
*    MODULE-SIZE = 900 DECIMAL BYTES                                    02194002
*                                                                       02195002
*    ATTRIBUTES = REENTRANT, ENABLED, PRIVELEGED,                       02196002
*        EXECUTES IN SETPRT INVOKER KEY                                 02196402
*        CODE AT ENTRY POINT WTOR IS NON-PRIVELEGED                     02197002
*                                                                       02200018
* ENTRY POINT = IGG08101                                                02300002
*    PURPOSE = SEE FUNCTION                                             02350002
*                                                                       02360002
*    LINKAGE = BRANCH FROM IGC0008A                                     02370048
*                                                                       02380002
*    INPUT =                                                            02430002
*        REGISTER 4(RSPW) = WORK AREA ADDRESS                           02500002
*        REGISTER 5(RPAR) = PARAMETER LIST ADDR                         02600002
*        REGISTER 6(RSVR) = SVRB EXTENDED SAVE AREA ADDRESS             02650002
*        REGISTER 9(RIOB) = ADDRESS OF IOB                              02800002
*                                                                       02900018
*    OUTPUT =                                                           02950002
*      REGISTERS = TO INVOKER                                           02960002
*        R0 = UNDEFINED                                                 02962002
*        R1 = UNDEFINED                                                 02964002
*        R2-R14 = UNCHANGED                                             02970002
*        R15 = RETURN CODE (SEE EXIT-ERROR)                             02980002
*                                                                       02982002
*      REGISTERS = TO IGG08102                                          02990002
*        R0-R3 = UNDEFINED                                              02990402
*        R4-R6 = AS FOR INPUT                                           02992002
*        R7 = UNDEFINED                                                 02992102
*        R8 (RIMAG) = ADDR OF IMAGE TO BE LOADED                        02992402
*        R9 = AS FOR INPUT                                              02994002
*        R10-R14 = UNDEFINED                                            02996048
*        R15 = RESERVED FOR BRANCH INTERFACE                            02998048
*                                                                       02998402
*      REGISTERS = TO IGG08103                                          02998802
*        R0-R3 = UNDEFINED                                              02999202
*        R4-R6 = AS FOR INPUT                                           02999602
*        R7-R8 = UNDEFINED                                              02999702
*        R9 = AS FOR INPUT                                              02999902
*        R10-R11 = UNDEFINED                                            03033202
*        R12 = UCS RETURN CODE                                          03035202
*        R13-R14 = UNDEFINED                                            03037248
*        R15 = RESERVED FOR BRANCH INTERFACE                            03043248
*                                                                       03053202
*      MESSAGES = RETRIEVED FROM IGGMSG01                               03066702
*        'IEC120A M XXX,YYYY(,FOLD)(,VERIFY)'                           03300002
*        'IEC122D XXX,YYYY UCS IMAGE NOT FOUND'                         03400002
*        'IEC125A ERROR - REPEAT REPLY'                                 03550002
*                                                                       03600018
*    EXIT-NORMAL = WHEN THE IMAGE IS TO BE LOADED, BRANCH TO IGG08102   03900048
*        IF AN FCB IMAGE IS TO BE LOADED, BRANCH TO IGG08103,           04200048
*        OTHERWISE RETURN TO SETPRT INVOKER                             04250002
*                                                                       04400018
*    EXIT-ERROR = WHEN AN OPERATOR ISSUED CANCEL FOR IEC120/IEC122,     04500002
*        SET RETURN CODE=04.                                            04700002
*              WHEN PERMANENT I/O ERROR OCCURED DURING BLDL,            04800002
*        SET RETURN CODE=08.                                            05000002
*              IF AN FCB IMAGE IS TO BE LOADED, SAVE THE RETURN CODE    05200002
*        AND BRANCH TO SETPRT LOAD IGG08103, OTHERWISE RETURN TO USER   05205048
*                                                                       05215002
* ENTRY-POINT = WTOR (INTERNAL ENTRY)                                   05217002
*    PURPOSE = ISSUE WTOR SVC IN PROBLEM STATE TO AVOID INTEGRITY       05219002
*        EXPOSURE FROM NON-PROTECTED MESSAGE                            05219402
*                                                                       05219802
*    LINKAGE = SYNCH FROM WITHIN THIS MODULE                            05219902
*                                                                       05225402
*    INPUT =                                                            05225802
*        REGISTER 4(RSPW) = WORK AREA ADDRESS                           05225902
*        REGISTER 14(R14) = RETURN ADDRESS                              05226002
*                                                                       05226102
*    OUTPUT =                                                           05237402
*      REGISTERS = TO INVOKER                                           05237802
*        R0 = UNDEFINED                                                 05238202
*        R1 = UNDEFINED                                                 05238602
*        R2-R14 = UNCHANGED                                             05238702
*        R15 = UNDEFINED                                                05238802
*                                                                       05238902
* EXTERNAL REFERENCES =                                                 05239002
*   ROUTINES = BLDL    (SVC 18)                                         05245002
*              DELETE  (SVC  9)                                         05251202
*              FREEMAIN(SVC 10)                                         05257402
*              IGG08102(SETPRT LOAD 3)                                  05263602
*              IGG08103(SETPRT LOAD 4)                                  05269802
*              IMGLIB  (SVC105)                                         05276002
*              LOAD    (SVC  8)                                         05282202
*              SYNCH   (SVC 12)                                         05288402
*              WAIT    (SVC  1)                                         05294602
*              WTOR    (SVC 35)                                         05300802
*                                                                       05313202
*   DATA-AREAS = SPP -- SETPRT PARAMETER LIST                           05319402
*              SPW5 -- BLDL PARAMETER LIST                     @Z40MSAP 05321448
*              SPW -- SETPRT WORK AREA                                  05325602
*              SPRBXSV -- RB EXTENDED SAVE AREA                         05331802
*              MSG -- MESSAGE CSECT                                     05338002
*   CONTROL-BLOCKS =                                                    05344202
*              DCB -- DATA CONTROL BLOCK                                05350402
*              DEB -- DATA EXTENT BLOCK                                 05356602
*              ECB -- EVENT CONTROL BLOCK                               05362802
*              IOB -- INPUT/OUTPUT BLOCK                                05369002
*              UCB -- UNIT CONTROL BLOCK                                05375202
*                                                                       05381402
* MACROS = BLDL,DELETE,FREEMAIN,IMGLIB,LOAD,SYNCH,WAIT,WTOR,            05387648
*              DCBD, IEFUCBOB, IEZDEB, IEZIOB, IGGMSG, IGGSPW,          05393802
*              IHAECB, IHASPP                                           05400002
*                                                                       06300018
* CHANGE ACTIVITY = AS FOLLOWS                                          06310002
*                                                                       06312002
* NOTE = THIS MODULE WAS BROUGHT UP TO STANDARDS FOR VS2-2              06320002
*        WHICH CAUSED ALL PREVIOUS RELEASE SEQUENCE NUMBER DELETIONS TO 06330002
*        BECOME INVALID.                                                06340002
*                                                                       06342002
*          RELEASE 19 DELETIONS                                         06350002
*THE FOLLOWING PTM WAS FIXED IN THIS RELEASE - M2923                    06352002
*                                                                       06362002
*          RELEASE 20 DELETIONS                                         06370002
*THE FOLLOWING PTMS WERE FIXED IN THIS RELEASE - 5881, 5149, 5143       06380002
*THE FOLLOWING APARS WERE FIXED IN THIS RELEASE - 34011, 33699          06390002
*THE FOLLOWING DEVELOPMENT CODE WAS FOR 3211 SUPPORT - S20202           06392002
*                                                                       06394002
*          RELEASE 21 DELETIONS                                         06399702
*THE FOLLOWING PTM WAS FIXED IN THIS RELEASE - 1759                     06401702
*THE FOLLOWING APAR WAS FIXED IN THIS RELEASE - 50699                   06403702
*                                                                       06404102
*          VS2 RELEASE 2 DELETIONS                                      06404902
*THE FOLLOWING DEVELOPMENT CODE WAS FOR VS2 RELEASE 2 - Y02072          06406902
*                                                                YM5703 06408902
*          VS2 RELEASE 3.7 CHANGES                                      06409348
*                                                                       06429348
*C165500-165800                                                @ZA25004 06449348
*A348000,655673-655679                                         @ZA25004 06469348
*A169507-169584                                                @ZA32077 06479348
*                                                                       06489348
*          VS2 RELEASE 4 DELETIONS                                      06509348
*                                                              @Z40MSMI 06529348
*********************************************************************** 06549348
         EJECT                                                          06600018
*********************************************************************** 06800018
*                                                                       06900018
*   REGISTER CONVENTIONS USED THROUGH OUT ALL SETPRT MODULES            07000002
*                                                                       07100018
*********************************************************************** 07200018
*                                                                       07300018
RWRK1    EQU   0                        WORK/PARAMETER REG.             07400002
R0       EQU   0                        INPUT REGISTER                  07450002
RWRK2    EQU   1                        WORK/PARAMETER REG.             07500002
R1       EQU   1                        INPUT REGISTER                  07550002
RDCB     EQU   2                        ADDR OF USER'S DCB              07600018
RBASE    EQU   3                        BASE REG.                       07700018
RSPW     EQU   4                        ADDR OF MESSAGE/WORK AREA       07800002
RPAR     EQU   5                        PARAMETER LIST ADDR             07900018
RSVR     EQU   6                        SVRB EXTENDED SAVE AREA         08000002
RRET     EQU   7                        SUBROUTINE RETURN REG    Y02072 08050002
RIMAG    EQU   8                        ADDR OF UCS IMAGE LOADED        08250002
RIOB     EQU   9                        ADDR OF LAST IOB USED           08300018
RUCB     EQU   10                       UCB ADDR                        08400018
RDEB     EQU   11                       DEB ADDR                        08500018
RBLDL    EQU   RDEB                     BLDL PARM LIST REG       YM5703 08550002
RWRK5    EQU   12                       WORK REG.                       08600002
RWRK6    EQU   13                       WORK REG.                       08700002
R14      EQU   14                       LINK REGISTER                   08750002
RWRK7    EQU   14                       WORK/PARAMETER REG.             08800002
R15      EQU   15                       LINK/RETURN CODE REGISTER       08850002
RWRK8    EQU   15                       WORK/PARAMETER REG.             08900002
*                                                                       09000018
*                                                                       09100018
*********************************************************************** 09200018
*                                                                       09300018
*   RETURN CODES                                                        10800002
*                                                                       10900018
RCNORM   EQU   X'00'                    NORMAL RETURN                   11000002
RCOPIMG  EQU   X'04'                    OPERATOR CANCEL--INVAL IMAGE    11100002
RCBLDIO  EQU   X'08'                    I/O ERROR IN BLDL               11200002
*                                                                       11300018
*********************************************************************** 11350002
*              MESSAGE NUMBERS IN IGGMSG01                              11400002
*        ALL MESSAGE NUMBERS HAVE BEEN DOUBLED IN THESE EQUATES         11410002
*        TO PROVIDE OFFSETS INTO THE MESSAGE CSECT.                     11420002
*        THIS IS DEPENDENT ON L'MSGINDOF BEING 2.                       11430002
*                                                                       11450002
MSG120   EQU   3*2                      IEC120A, NO FOLD,VERIFY  Y02072 11500002
MSG120F  EQU   6*2                      IEC120A, FOLD ONLY       Y02072 11550002
MSG120FV EQU   5*2                      IEC120A, FOLD&VERIFY     Y02072 11600002
MSG120V  EQU   4*2                      IEC120A, VERIFY ONLY     Y02072 11650002
MSG122   EQU   7*2                      IEC122D                  Y02072 11700002
MSG125   EQU   8*2                      IEC125A                  Y02072 11750002
*                                                                       11800002
*********************************************************************** 11850002
*              OTHER EQUATES                                            11900002
*                                                                       11950002
MAXRPLN  EQU   5                        USED FOR LOOP CONTROL IN        12050002
*                                       ANALYZING THE REPLY             12100002
UCB43211 EQU   X'09'                    MASK FOR 3211 PRINTER     M5149 12120002
UCB41403 EQU   X'08'                    MASK FOR 1403 PRINTER    Y02072 12170002
         EJECT                                                          13250002
         USING SPW,RSPW                                                 13300002
         USING SPPARM,RPAR                                              13350002
         USING SPRBXSV,RSVR                                             13400002
         USING IOBQSAMN,RIOB                                            13450002
*                                                                       14700018
*********************************************************************** 14800018
*                                                                       14900018
*   INITIALIZE REGISTERS                                                15000018
*                                                                       15100018
*********************************************************************** 15200018
*                                                                       15300018
         BALR  RBASE,0                  ESTABLISH BASE FOR CODE         15400002
START    EQU   *                                                        16300018
         USING START,RBASE                                              16350002
         SPACE                                                          16400002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 16450002
         DC    C'IGG08101'              MODULE NAME              Y02072 16500002
         DC    C'@ZA32077'              LAST SHIP CODE         @ZA32077 16550048
         DC    C'07/28/78'              LAST DATE MODIFIED     @ZA32077 16580048
BEGIN    DS    0H                                                Y02072 16660002
         SPACE                                                          16670002
         L     RDCB,SPPDCBA             LOAD DCB ADDR                   16700002
         USING IHADCB,RDCB                                              16750002
         L     RDEB,DCBDEBAD            LOAD DEB ADDR                   16800018
         USING DEBDASD-(DEBBASND-DEBBASIC),RDEB                         16850002
         L     RUCB,DEBUCBAD            LOAD UCB ADDR                   16900018
         DROP  RDEB                                                     16910002
         USING UCBOB,RUCB                                               16950002
         L     RDEB,UCBXTADR            LOAD UCB EXTENSION    @ZA32077  16950748
         TM    4(RDEB),X'01'            PARITY ERROR          @ZA32077  16951448
         BO    MOVEID                   YES-LOAD UCS          @ZA32077  16952148
         CLC   SPPUCS,0(RDEB)           SPECIF UCS=LOADED UCS @ZA32077  16952848
         BNE   MOVEID                   NO-LOAD UCS           @ZA32077  16953548
         TM    SPWPARM1,SPWVERIF        VERIFY                @ZA32077  16954248
         BO    MOVEID                   YES-LOAD UCS          @ZA32077  16954948
         TM    SPWFLG1,SPWRPVER         OPER REQUEST VERIFY   @ZA32077  16955648
         BO    MOVEID                   YES-LOAD UCS          @ZA32077  16956348
         LA    RDEB,RCNORM              LOAD RETURN CODE      @ZA32077  16957048
         B     CKFORFCB                 RETURN TO PROB PROG   @ZA32077  16957748
MOVEID   EQU   *                                              @ZA32077  16958448
         L     RBLDL,SPRBLDLA           GET BLDL PARM LIST ADDR  YM5703 16960002
         USING SPW5,RBLDL                                      @Z40MSAP 16970048
*                                                                       17000018
*********************************************************************** 17100018
*                                                                       17200018
*   SET UP REQUESTED UCS IMAGE ID                                       17300002
*                                                                       17400018
*********************************************************************** 17500018
*                                                                       17600018
         L     RWRK6,SPWBLUCS           GET UCS IMAGE ID         Y02072 17650002
         ST    RWRK6,SPWREPID           MAKE IT CURRENT ID       Y02072 17800002
*                                                                       18000018
BLDLRTN  EQU   *                                                        18100018
*                                                                       18200018
*********************************************************************** 18300018
*                                                                       18400018
*   BLDL TO LOCATE UCS IMAGE IN SYS1.IMAGELIB                           18500020
*                                                                       18600018
*********************************************************************** 18700018
*                                                                       18800018
         MODESET  EXTKEY=DATAMGT        KEY 5 FOR BLDL LIST      YM5703 18850002
         SPACE                                                          18860002
         MVC   SPWBLDLC,BLDLCNST        MOVE BLDL LIST TO BLDL AREA     18900002
         MVC   SPWUCSMB,UCSCONST        MOVE UCS IMAGE MEMBER NAME      19000002
         CLI   UCBTBYT4,UCB43211        CK FOR 3211 DCB           M5149 19010002
*                                       PRINTER                  S20202 19020020
         BNE   CONTBLDL                 NO, CONTINUE W/ BLDL      M5881 19030002
         MVI   SPWUCS2,SPWUCS2C         UCS PREFIX=UCS2          S20202 19040002
*                                                                       19050020
CONTBLDL EQU   *                                                 S20202 19060020
         SPACE                                                          19062002
         MODESET  KEYADDR=SPRKEY,WORKREG=1  RESUME USER KEY      YM5703 19064002
         SPACE                                                          19066002
         MVC   SPWUCSIM(L'SPWUCSMB),SPWUCSMB  SAVE FOR LATER     Y02072 19070002
*                                             LOAD AND WTOR             19080002
         MODESET  EXTKEY=DATAMGT        KEY OF BLDL LIST         YM5703 19090002
         SPACE                                                          19092002
*                                                                       19100018
*   GET ADDRESS OF SYS1.IMAGELIB DCB                                    19200002
*                                                                       19300020
         L     R1,SPRIDCBA              GET SYS1.IMAGELIB DCB    Y02072 19400002
*                                       ADDRESS                  S20202 19500020
         BLDL  (1),SPWBLDLC             BLDL TO LOCATE THE IMAGE        20000002
         SPACE                                                          20050002
         MODESET  KEYADDR=SPRKEY,WORKREG=1                       YM5703 20060002
         SPACE                                                          20070002
*                                                                       20100018
*   TEST RETURN CODE FROM BLDL                                          20200018
*       X'00' - FOUND                                                   20300018
*       X'04' - NOT FOUND                                               20400018
*       X'08' - PERMANENT I/O ERROR                                     20500018
*                                                                       20600018
         B     BLDLRET(R15)             TEST RETURN CODE         Y02072 20800002
BLDLRET  EQU   *                                                 Y02072 20900002
         B     LOADUCS                  0 - GOTO LOAD IMAGE RTN  Y02072 21000002
         B     WTOR122                  4 - NOT FOUND MSG RTN    Y02072 21100002
*                                       8 - I/O ERROR            Y02072 21200002
*                                                                       21600018
*********************************************************************** 21700018
*                                                                       21800018
*   PERMANENT I/O ERROR DURING BLDL - GIVE CONTROL BACK TO ENTRY POINT  21900018
*   RETURN CODE = X'08' IN REG.15                                       22000018
*   IF I/O ERROR PERSISTS,RUN C.E. DIAGNOSTICS FOR SYSTEM RESIDENT      22100018
*   DASD.                                                               22200018
*                                                                       22300018
*********************************************************************** 22400018
*                                                                       22500018
         LA    RWRK5,RCBLDIO            LOAD RETURN CODE                22600002
         B     CKFORFCB                 GO TO CK IF FCB          S20202 22650020
*                                       SPECIFIED IN             S20202 22700020
*                                       SETPRT PARAMETER LIST           22750020
         EJECT                                                          22800002
LOADUCS  EQU   *                                                        23100018
*                                                                       23200018
*********************************************************************** 23300018
*                                                                       23400018
*   WHEN UCS IMAGE IS FOUND IN SYS1.IMAGELIB LOAD THE UCS IMAGE         23500020
*                                                                       23600018
*********************************************************************** 23700018
*                                                                       23800018
         TM    SPWFLG3,SPW120RQ         TEST IF IEC120 IS REQUIRED      24100002
         BO    WTOR120                  IF YES, GOTO DISPLAY MSG Y02072 24200002
*                                       BEFORE LOADING IMAGE            24250002
         BAL   RRET,LOAD                IF NO, GO AHEAD & LOAD   Y02072 24260002
         B     XCTLRTN                  THEN BRANCH TO NEXT MODULE      24270048
         SPACE 3                                                        24300002
LOAD    EQU   *                                                         24400018
*********************************************************************** 24450002
*        THIS SUBROUTINE LOADS THE IMAGE (ID IN SPWREPID) FROM IMAGELIB 24460002
*        IT RETURNS ON REGISTER RRET, WITH THE IMAGE ADDRESS IN RIMAG   24470002
*********************************************************************** 24480002
*                                                                       24500018
         MVC   SPWUCS2H,SPWREPID        SET UP PARM FOR LOAD     Y02072 24550002
         L     R1,SPRIDCBA              GET SYS1.IMAGELIB DCB    Y02072 24660002
*                                       ADDRESS                  S20202 24720020
*                                                                       24800018
         MODESET  EXTKEY=DATAMGT                                 YM5703 24850002
         SPACE                                                          24860002
         LOAD  DE=SPWUCSMB,DCB=(1)      LOAD THE IMAGE           YM5703 24900002
         SPACE                                                          24950002
         MODESET  KEYADDR=SPRKEY,WORKREG=8                       YM5703 24960002
         SPACE                                                          24970002
         LR    RIMAG,R0                 RETAIN ADDR OF IMAGE LOADED     25000002
         BR    RRET                     RETURN TO SUBR CALLER    Y02072 25100002
         SPACE 3                                                        26100002
WTOR122  EQU   *                                                        26500018
*                                                                       26600018
*********************************************************************** 26700018
*                                                                       26800018
*   WTOR 'IEC122D XXX,YYYY UCS IMAGE NOT FOUND' TO REQUEST AN           26900020
*   ALTERNATE USC IMAGE TO BE USED.                                     27000020
*                                                                       27100018
*********************************************************************** 27200018
*                                                                       27300018
         LA    RWRK2,MSG122             SPECIFY INDEX TO MESSAGE Y02072 27450002
         BAL   RRET,GETMSG              GO GET THE MESSAGE       Y02072 27500002
         BAL   RRET,FILLFLDS            THEN FILL IN UNIT, ID    Y02072 27550002
         SR    RWRK6,RWRK6              CLEAR REG                S20202 27800002
         SR    RIMAG,RIMAG              INDICATE NO IMAGE LOADED        27900002
MESSAGO  EQU   *                                                        28000002
         TM    SPRKEY,SPRUSKEY          IF CALLED AS SYS FUNCT   Y02072 28010002
         BZ    MESSAGO2                 DO NOT SYNCH TO WTOR     Y02072 28020002
         SYNCH WTOR                     ISSUE WTOR IN PROB STATE Y02072 28050002
         B     WAIT                     THEN WAIT FOR COMPLETION Y02072 28100002
MESSAGO2 EQU   *                        SYS WTOR                 Y02072 28110002
         BAL   R14,WTOR                 ISSUE WTOR IN SUP STATE  Y02072 28120002
         B     WAIT                     THEN WAIT FOR COMPLETION Y02072 28130002
         SPACE 3                                                        28150002
WTOR120  EQU   *                                                        28400018
*                                                                       28500018
*********************************************************************** 28600018
*                                                                       28700018
*   BEFORE UCS IMAGE IS RETRIEVED,WTOR THE FOLLOWING MESSAGE            28800002
*       'IEC120I M XXX,YYYY,FOLD,VERIFY'                                28900002
*        THEN RETRIEVE THE IMAGE BEFORE WAITING FOR REPLY.              28950002
*                                                                       29000018
*********************************************************************** 29100018
*                                                                       29800018
         LA    RWRK2,MSG120FV           ASSUME FOLD&VERIFY MSG   Y02072 29850002
         TM    SPWPARM1,SPWFOLD+SPWRPVER  IF FOLD AND VERIFY     Y02072 29900002
         BO    GET120                   GO SELECT MSG120FV       Y02072 30000002
         LA    RWRK2,MSG120             ASSUME NEITHER           Y02072 30100002
         BZ    GET120                   IF NEITHER GET MESSAGE   Y02072 30150002
         LA    RWRK2,MSG120V            ASSUME VERIFY MSG        Y02072 30200002
         TM    SPWPARM1,SPWVERIF        TEST IF VERIFY IS SPECIFIED     31700002
         BO    GET120                   IF SO, GO GET MESSAGE    Y02072 31800002
         LA    RWRK2,MSG120F            SELECT FOLD MESSAGE      Y02072 32000002
*                                                                       32150002
GET120   EQU   *                                                 Y02072 32160002
         BAL   RRET,GETMSG              GET WHICHEVER MSG RQSTD  Y02072 32170002
         BAL   RRET,FILLFLDS            FILL IN UNIT AND ID      Y02072 32190002
         TM    SPRKEY,SPRUSKEY          IF CALLED AS SYS FUNCT   Y02072 32192002
         BZ    GET120A                  DO NOT SYNCH TO WTOR     Y02072 32194002
*                                                                       32200018
         SYNCH WTOR                     ISSUE WTOR IN PROB STATE Y02072 33900002
         BAL   RRET,LOAD                LOAD IMAGE WHILE WAITING Y02072 34200002
         B     WAIT                     THEN WAIT FOR COMPLETION Y02072 34250002
GET120A  EQU   *                        SYS WTOR                 Y02072 34260002
         BAL   R14,WTOR                 ISSUE WTOR IN SUP STATE  Y02072 34270002
         BAL   RRET,LOAD                LOAD IMAGE WHILE WAITING Y02072 34280002
*                                                                       34300018
WAIT     EQU   *                                                        34400002
*                                                                       34500018
         WAIT  ECB=SPWRPECB,LONG=YES    WAIT ON REPLY            Y02072 34700002
         NI    SPWFLG3,X'FF'-SPW120RQ   SET NO IEC120 REQ'D      Y02072 34750002
         XC    SPWMSGID(4),SPWMSGID     CLEAR MSG ID           @ZA25004 34800048
*                                                                       35300018
*********************************************************************** 35400018
*                                                                       35500018
*   AFTER DISPLAYING MESSAGES,TEST REPLY.                               35600018
*       'U' - GO CHECK FOR FCB PARAMETERS                               35700020
*       'CANCEL' - GOTO CANCEL ROUTINE AND EXIT TO ENTRY POINT          35800018
*       'YYYY' - GOTO LOAD UCS BUFFER ROUTINE (IGG08102)                35900018
*       'ZZZZ' - GOTO BLDL AND LOAD ROUTINE                             36000018
*                                                                       36100018
*********************************************************************** 36200018
*                                                                       36300018
         OC    SPWREPLY,LOWER           OR TO ALLOW LOWER CASE REPLY    36400002
*                                                                       36600018
         LA    RWRK5,RCNORM             LOAD NORMAL RETURN CODE         36700002
         CLC   SPWREPLY(L'UBLANK),UBLANK       TEST IF REPLY = 'U'      36800002
         BE    RPLYUSE                  IF YES,GOTO EXIT ROUTINE Y02072 36900002
*                                                                       37000018
         CLC   SPWREPLY(L'CANCELCN),CANCELCN   TEST IF REPLY='CANCEL'   37100002
         BE    CANCELGO                 IF YES,GOTO CANCEL RTN          37200002
*                                                                       37300018
         CLC   SPWREPLY(L'CBLANK),CBLANK   TEST IF REPLY = 'C'          37400002
         BNE   TSTUCSID                 IF NOT,GOTO UCS ID TEST         37500002
*                                                                       37800018
CANCELGO EQU   *                                                        37900018
*                                                                       38000018
*********************************************************************** 38100018
*                                                                       38200018
*   AN OPERATOR CANCELLED THE JOB STEP BECAUSE THE SPECIFIED CHAIN IS   38300018
*   NOT AVAILABLE. RETURN CODE = X'04' IN REG.15                        38400018
*   CHECK IF THE IMAGE-ID WAS SPECIFIED CORRECTLY,OR ADD THE IMAGE      38500018
*   TO SYS1.IMAGELIB                                                    38600020
*                                                                       38700018
*********************************************************************** 38800018
*                                                                       38900018
         LA    RWRK5,RCOPIMG            LOAD RETURN CODE                39000002
         B     EXITRTN                  GOTO EXIT ROUTINE               39100002
*                                                                       39110002
*********************************************************************** 39150002
*                                                                       39160002
*   OPERATOR REPLIED 'U'. SET UP PARM LIST WITH UCB UCS ID       Y02072 39170002
*   AND THEN BO BLDL.                                            Y02072 39172002
*                                                                       39180002
*********************************************************************** 39190002
*                                                                       39192002
RPLYUSE  EQU   *                                                 Y02072 39242002
         L     RWRK6,UCBXTADR           GET UCB UCS EXTENSION    Y02072 39292002
         USING UCBUCS,RWRK6                                      Y02072 39342002
         L     RWRK6,UCBUCSID           UCS ID TO LOAD           Y02072 39392002
         DROP  RWRK6                                             Y02072 39442002
         SPACE                                                          39452002
         MODESET  EXTKEY=DATAMGT                                 YM5703 39462002
         SPACE                                                          39472002
         ST    RWRK6,SPWBLUCS           UCS ID TO BLDL PARM LST  Y02072 39492002
         SPACE                                                          39492402
         MODESET  KEYADDR=SPRKEY,WORKREG=8                       YM5703 39492802
         SPACE                                                          39493202
         ST    RWRK6,SPWREPID           SAVE UCS ID FOR COMPARE  Y02072 39494002
         B     ISSUEDEL                 GO DELETE IMAGE LOADED   Y02072 39494402
         SPACE 2                                                        39498002
*                                                                       39600018
*********************************************************************** 39700018
*                                                                       39800018
*   REPLY ANALYSIS ROUTINE                                              39900018
*                                                                       40000018
*********************************************************************** 40100018
*                                                                       40200018
TSTUCSID EQU   *                                                        40210002
         L     RWRK6,SPWREPID           SAVE PREVIOUS ID         Y02072 40250002
         MVC   SPWREPID,BLANKS          BLANK FIELD FOR NEW ID   Y02072 40260002
         LA    RWRK7,SPWREPLY           LOAD REPLY ADDR                 40300002
         USING CHAR,RWRK7                                               40350002
         MVI   SPWRPECB,BLANK           ENSURE BLANK AFTER REPLY Y02072 40362002
*                                                                       40370002
         LA    RWRK8,L'SPWREPID+1       SET LIMIT ON ID SCAN     Y02072 40400002
         BAL   RRET,SCAN                GET LENGTH OF ID FIELD   Y02072 40450002
         BZ    REPNULL                  NULL REPLY IF ZERO       Y02072 40500002
         EX    RWRK8,MVCREP             MOVE ID TO SPWREPID      Y02072 40550002
*                                                                       40600002
*   PROCESS FOLD OPTION                                                 40610002
*                                                                       40620002
         BAL   RRET,DELIM               CHECK FOR COMMA AFTER ID Y02072 40650002
*                                       IF COMMA PRESENT,               40652002
*                                       OPERATOR HAS SET OPTIONS        40654002
         MVI   SPWFLG1,0                RESET USER OPTIONS       Y02072 40660002
         LA    RWRK8,L'FOLDCN+1         SET LIMIT ON 'FOLD' SCAN Y02072 40700002
         BAL   RRET,SCAN                GET LENGTH OF FOLD OPT   Y02072 40750002
         BZ    VTEST                    OMITTED--TEST FOR VERIFY Y02072 40800002
         EX    RWRK8,CLCFOLD            CHECK CONTENTS OF OPTION Y02072 40850002
         BNE   ERRORTN                  ERROR IF NO MATCH        Y02072 40900002
         OI    SPWFLG1,SPWFOLD          TURN ON FOLD OPTION      Y02072 40950002
*                                                                       41000002
*   PROCESS VERIFY OPTION                                               41050002
*                                                                       41100002
VTEST    EQU   *                                                 Y02072 41150002
         BAL   RRET,DELIM               COMMA AFTER FOLD?        Y02072 41200002
         LA    RWRK8,L'VERIFYCN+1       SET 'VERIFY' SCAN LIMIT  Y02072 41250002
         BAL   RRET,SCAN                GET LENGTH OF OPTION     Y02072 41300002
         BZ    ERRORTN                  ERROR IF FIELD OMITTED   Y02072 41350002
         EX    RWRK8,CLCVER             VERIFY CONTENTS OF OPT   Y02072 41400002
         BNE   ERRORTN                  ERROR IF NO MATCH        Y02072 41450002
         OI    SPWFLG1,SPWVERIF         TURN ON VERIFY OPTION    Y02072 41460002
*                                                                       41500002
*   BE SURE NO MORE FIELDS ARE PRESENT                                  41550002
*                                                                       41600002
         BAL   RRET,DELIM               NORM WILL NOT RETURN     Y02072 41650002
         B     ERRORTN                  IS AN ERROR IF DOES      Y02072 41700002
*                                                                       41800002
*   EXECUTED INSTRUCTIONS DURING SCAN                                   41850002
*                                                                       41900002
MVCREP   MVC   SPWREPID(0),CHAR         MOVE ID                  Y02072 41950002
CLCFOLD  CLC   FOLDCN(0),CHAR           VERIFY FOLD OPTION       Y02072 42000002
CLCVER   CLC   VERIFYCN(0),CHAR         CHECK VERIFY OPTION      Y02072 42050002
CLCBLNK  CLC   CHAR1(0),CHAR2           CHECK FOR ALL BLANK      Y02072 42060002
*                                                                       42100002
*   SUBROUTINES USED DURING SCAN                                        42150002
*                                                                       42200002
SCAN     EQU   *                                                 Y02072 42250002
*********************************************************************** 42300002
*        INPUT IS MAX DATA LENGTH+1 IN RWRK8 AND POSITION IN RWRK7      42350002
*        NORMAL OUTPUT IS DATALENGTH-1 IN RWRK8                         42400002
*        IF DATALENGTH IS ZERO, RETURNS WITH CONDITION CODE ZERO        42450002
*        IF LIMIT EXCEEDED, GOES TO ERRORTN                             42500002
*        THIS SUBROUTINE USES RWRK1 AND RWRK2, AND RETURNS ON RRET      42550002
*********************************************************************** 42600002
         LR    RWRK2,RWRK8              SAVE LIMIT LENGTH        Y02072 42650002
SCAN2    CLI   CHAR1,COMMA              IF A COMMA IS FOUND      Y02072 42700002
         BE    SCAN4                    STOP THE SCAN            Y02072 42750002
         CLI   CHAR1,BLANK              OR A BLANK IS FOUND      Y02072 42800002
         BE    SCAN4                    STOP THE SCAN            Y02072 42850002
         LA    RWRK7,1(RWRK7)           ELSE SCAN TO NEXT BYTE   Y02072 42900002
         BCT   RWRK8,SCAN2              LOOP IF LIMIT OK         Y02072 42950002
         B     ERRORTN                  OTHERWISE IS AN ERROR    Y02072 43000002
SCAN4    SR    RWRK2,RWRK8              DATA LENGTH              Y02072 43050002
         SR    RWRK7,RWRK2              RESET TO FIELD START     Y02072 43060002
         LTR   RWRK8,RWRK2              PUT LENGTH IN PASSBACK   Y02072 43070002
*                                       IF NO DATA, SETS CC=0           43100002
*                                       ELSE SETS CC=2 (POSITIVE)       43110002
         BCTR  RWRK8,0                  DECREMENT TO LEN-1       Y02072 43150002
         BR    RRET                     AND RETURN WITH CONDCODE Y02072 43200002
*                                                                       43250002
DELIM    EQU   *                                                 Y02072 43300002
*********************************************************************** 43350002
*        INPUT IS PREV DATA LENGTH-1 IN RWRK8, DATA POS IN RWRK7        43400002
*        NORMAL OUTPUT IS NEXT DATA FIELD POS IN RWRK7                  43450002
*        (IF NEXT FIELD IS OMITTED, WILL POINT TO ITS DELIMITER)        43500002
*        IF DELIMITER FOR PREVIOUS FIELD IS BLANK,ROUTINE DOES          43550002
*        NOT RETURN, BUT VERIFIES THAT REMAINDER OF REPLY AREA IS       43600002
*        BLANK, THEN CONTINUES WITH NEXT FUNCTION.                      43650002
*        IF INVALID DELIMITOR SITUATION IS FOUND, GOES TO ERRORTN       43700002
*        THIS SUBROUTINE USES RWRK2 AND RETURNS ON RRET                 43750002
*********************************************************************** 43800002
         LA    RWRK7,1(RWRK7,RWRK8)     INCR PAST DATA FIELD     Y02072 43850002
         CLI   CHAR1,BLANK              IF BLANK DELIMITER       Y02072 43900002
         BE    SWEEP                    THEN GO CHECK REMAIN     Y02072 43950002
         LA    RWRK7,CHAR2              POINT PAST DELIMITER     Y02072 44000002
         CLI   CHAR1,BLANK              CHECK FOR COMMA-BLANK    Y02072 44050002
         BE    ERRORTN                  WHICH IS AN ERROR        Y02072 44100002
         BR    RRET                     OTHERWISE RETURN         Y02072 44150002
*                                                                       44160002
*   CLEAN UP AFTER SCAN                                                 44170002
*                                                                       44180002
*        IF OPERATOR REPLIED WITH A NULL MESSAGE, TREAT IT AS IF        44182002
*        HE REPLIED WITH THE PREVIOUS UCS ID                            44184002
*                                                                       44186002
REPNULL  ST    RWRK6,SPWREPID           KEEP PREVIOUS ID         Y02072 44190002
*                                                                       44192002
SWEEP    LA    RWRK2,SPWREPLY+L'SPWREPLY-1  FIND END OF AREA     Y02072 44200002
         SR    RWRK2,RWRK7              LENGTH-1 OF AREA LEFT    Y02072 44250002
         BNH   TSTNAME                  END OF AREA--IS OK       Y02072 44300002
         BCTR  RWRK2,0                  DECR TO BLANKS-2         Y02072 44350002
         EX    RWRK2,CLCBLNK            IF FIRST N-1 BYTES DON'T Y02072 44400002
*                                       MATCH LAST N-1 BYTES     Y02072 44450002
         BNE   ERRORTN                  THEN SOME BYTE NON-BLANK Y02072 44500002
*                                       ELSE CONTINUE            Y02072 44550002
         DROP  RWRK7                                                    47650002
*                                                                       47900018
TSTNAME  EQU   *                                                        48000018
*                                                                       48100018
*********************************************************************** 48200018
*                                                                       48300018
*   TEST REPLY ID = SPECIFIED ID                                        48400018
*       NO - GO BACK REPEAT BLDL/LOAD TO LOAD REPLIED IMAGE             48500018
*       YES - BRANCH TO MODULE IGG08102                                 48600048
*                                                                       48700018
*********************************************************************** 48800018
*                                                                       48900018
         C     RWRK6,SPWREPID           TEST IF SAME AS PREV. ID Y02072 49100002
         BE    XCTLRTN                  IF YES,GOTO NEXT MODULE         49200002
*                                                                       49500018
FINDUCS  EQU   *                                                        49600018
*                                                                       49700018
*********************************************************************** 49800018
*                                                                       49900018
*   WHEN AN ALTERNATE IMAGE IS SPECIFIED.                               50000018
*   TEST IF THE REPLIED UCS IMAGE IS TO BE LOADED.                      50100018
*                                                                       50200018
*********************************************************************** 50300018
*                                                                       50400018
         L     RWRK6,SPWREPID           LOAD REPLIED UCS ID      Y02072 50450002
         SPACE                                                          50500002
         MODESET  EXTKEY=DATAMGT                                 YM5703 50550002
         SPACE                                                          50560002
         ST    RWRK6,SPWBLUCS           STORE IT FOR BLDL        Y02072 50600002
         SPACE                                                          50650002
         MODESET  KEYADDR=SPRKEY,WORKREG=12                      YM5703 50660002
         SPACE                                                          50670002
         MVC   SPWPARM1,SPWFLG1         MOVE REPLIED OPTION      Y02072 50700002
*                                                                       50800018
         L     RWRK5,UCBXTADR           GET ADDR OF UCB PTR EXT  S20202 50850002
         USING UCBUCS,RWRK5                                             50860002
         C     RWRK6,UCBUCSID           ARE UCS ID'S EQUAL?      S20202 50900002
         BNE   DELETE                   IF NOT,GOTO DELETE ROUTINE      51000002
         NI    SPWFLG3,X'FF'-SPW120RQ   SET NO IEC120 REQ'D      Y02072 51050002
*                                                                       51100018
*   WHEN IDS ARE EQUAL,TEST LOAD MODES ARE EQUAL                        51200018
*                                                                       51300018
         MVC   SPWFLG8,UCBUCSOP         MOVE UCS OPT BITS FROM   S20202 51360002
*                                       UCB                      S20202 51420020
         XC    SPWFLG8,SPWPARM1         XLUSIVE OR THE REPLY BITS       51500002
*                                                                       51600018
         TM    SPWFLG8,SPWFOLD          TEST IF LOAD MODES ARE SAME     51700002
         BO    DELETE                   IF NOT,GOTO DLETE ROUTINE       51800002
*                                                                       52300018
*********************************************************************** 52400018
*                                                                       52500018
*   TEST IF VERIFY IS SPECIFIED.                                        52600018
*       YES - SET SWITCH AND GO DELETE                           Y02072 52700002
*       NO  - GO DELETE                                          Y02072 52800002
*                                                                       52900018
*********************************************************************** 53000018
*                                                                       53100018
         TM    SPWPARM1,SPWVERIF        TEST IF VERIFY IS SPECIFIED     53200002
         DROP  RWRK5                                                    53250002
         BNO   DELETE                   IF NOT, DELETE PREVIOUS  Y02072 53400002
*                                         IMAGE                  Y02072 53450002
         OI    SPWFLG2,SPWENTVR         SET SWITCH FOR VERIFY    Y02072 53600002
*                                                                       53900018
DELETE   EQU   *                                                        54000018
*                                                                       54100018
*********************************************************************** 54200018
*                                                                       54300018
*   TEST IF THE IMAGE HAS BEEN LOADED                                   54400018
*                                                                       54500018
*********************************************************************** 54600018
*                                                                       54700018
         LTR   RIMAG,RIMAG              TEST IF THE IMAGE BEEN LOADED   54800002
         BZ    BLDLRTN                  IF NOT GOTO BLDL ROUTINE Y02072 54900002
*                                                                       55000018
*********************************************************************** 55100018
*                                                                       55200018
*   DELETE THE IMAGE LOADED AND GO BACK TO BLDL ROUTINE TO LOCATE       55300018
*   NEW IMAGE                                                           55400018
*                                                                       55500018
*********************************************************************** 55600018
*                                                                       55700018
ISSUEDEL EQU   *                                                 Y02072 55750002
         DELETE EPLOC=SPWUCSIM          DELETE THE LOADED IMAGE         56100002
         SR    RIMAG,RIMAG              INDICATE NOTHING LOADED  Y02072 56150002
         ST    RIMAG,SPWUCS2H                                    Y02072 56160002
         B     BLDLRTN                  GOTO BLDL ROUTINE               56600002
         SPACE 3                                                        56700002
ERRORTN  EQU   *                                                        57300018
*                                                                       57400018
*********************************************************************** 57500018
*                                                                       57600018
*   WTO 'IEC125 ERROR - REPEAT REPLY' AND GO BACK TO REPLY ANALYSIS     57700018
*                                                                       57800018
*********************************************************************** 57900018
*                                                                       58000018
         LA    RWRK2,MSG125             SPECIFY ERROR MESSAGE    Y02072 58050002
         BAL   RRET,GETMSG              GO GET MESSAGE           Y02072 58100002
         B     MESSAGO                  GO TO ISSUE MSG ROUTINE    DM0Q 58300018
         EJECT                                                          58400002
EXITRTN  EQU   *                                                        58700018
*                                                                       58800018
*********************************************************************** 58900018
*                                                                       59000018
*   DELETE IMAGE IF IT HAS BEEN LOADED                                  59100002
*                                                                       59200018
*********************************************************************** 59300018
*                                                                       59400018
         LTR   RIMAG,RIMAG              TEST IF IMAGE BEEN LOADED       59500002
         BE    CKFORFCB                 IF NOT GO CK FOR FCB     S20202 59560020
*                                       PARAMETER                S20202 59620020
*                                                                       60500018
         DELETE EPLOC=SPWUCSIM          DELETE THE IMAGE LOADED  Y02072 60900002
*                                                                       60900402
         SR    RIMAG,RIMAG              INDICATE NOTHING LOADED  Y02072 60902002
         ST    RIMAG,SPWUCS2H                                    Y02072 60904002
*                                                                       60906020
CKFORFCB EQU   *                                                 S20202 60912020
*                                                                       60912402
*********************************************************************** 60914002
*        IF DEVICE HAS AN FCB, BRANCH TO ROUTINE TO PROCESS IT          60916048
*        OTHERWISE GO CLEAN UP AND EXIT                                 60916402
*********************************************************************** 60916802
*                                                                       60918020
         CLI   UCBTBYT4,UCB41403        CK IF DEVICE IS A 1403   Y02072 60920002
         BE    FREEMAIN                 YES GO FREE MESSAGE/WORK Y02072 60930002
*                                       AREA                     S20202 60936020
*                                                                       60942020
*   GO BRANCH TO IGG08103 TO LOAD FCB                                   60948048
*                                                                       60954020
         L     R15,ID3                  ADDR. OF IGG08103      @Z40MSMI 60960048
         BR    R15                      BRANCH TO MODULE       @Z40MSMI 60970048
*                                                                       61000018
FREEMAIN EQU   *                                                        61100018
*                                                                       61150002
*********************************************************************** 61160002
*                                                                       61170002
*   EXIT ROUTINE - (1) CLOSE IMAGELIB DCB                               61180002
*                  (2) DELETE MESSAGE CSECT                             61190002
*                  (3) FREEMAIN MESSAGE/WORK AREA                       61192002
*                  (4) FREEMAIN BLDL PARAMETER LIST              YM5703 61192402
*                  (5) RESTORE IOB AND EXIT TO ENTRY POINT              61194002
*                                                                       61196002
*********************************************************************** 61198002
*                                                                       61200018
         L     RWRK1,SPRIDCBA           GET SYS1.IMAGELIB DCB    Y02072 61230002
*                                       ADDRESS                  S20202 61260020
         MODESET EXTKEY=ZERO            SWITCH TO SVRB KEY       Y02072 61292002
*                                                                       61292402
         SR    RWRK6,RWRK6              INDICATE NO IMAGELIB DCB Y02072 61294002
         ST    RWRK6,SPRIDCBA                                    Y02072 61296002
*                                                                       61298102
         IMGLIB CLOSE,(RWRK1)           CLOSE IMAGELIB DCB       S20202 61298402
*                                                                       61352002
         ST    RWRK6,SPRMSG             NO LONGER LOADED         Y02072 61370002
*                                                                       61370402
         DELETE EP=IGGMSG01             DELETE MESSAGE CSECT     Y02072 61372002
*                                                                       61374002
         ST    RWRK6,SPRIOBSV           INDICATE IOB RESTORED    Y02027 61570402
         MODESET KEYADDR=SPRKEY,WORKREG=1                        Y02072 61580002
*                                                                       61590002
* RESTORE IOB TO ORIGIONAL STATUS                                Y02072 61590102
*                                                                       61590202
         MVC   IOBFLAG1(4),SPWFLGSV     RESTORE FLAGS            Y02072 61590402
         MVC   IOBSTART,SPWSTRSV        RESTORE IOB START        Y02072 61590802
*                                                                       61591202
*  ISSUE FREEMAINS FOR SETPRT WORK AREA AND BLDL PARM LIST       YM5703 61591602
*                                                                       61591702
         FREEMAIN R,LV=SPWLNGTH,A=(RSPW),SP=SPWPOOL            @Z40MSAP 61592048
*                                                                       61600018
         SPACE                                                          61650002
         MODESET  EXTKEY=DATAMGT        KEY OF BLDL PARM LIST    YM5703 61700002
         SPACE                                                          61750002
         ST    RWRK6,SPWWKADR           INDIC WORK AREA FREED    YM5703 61800002
         FREEMAIN  R,LV=SPW5LNTH,A=(RBLDL),SP=SPW5POOL           YM5703 61850048
         SPACE                                                          61950002
         MODESET  EXTKEY=SUPR                                    YM5703 62000002
         SPACE                                                          62050002
         ST    RWRK6,SPRBLDLA           INDIC BLDL LIST FREED    YM5703 62100002
         LR    R15,RWRK5                LOAD RETURN CODE                64100002
         L     R14,SPREXIT              GET EXIT PROLOG ADDR     Y02072 64200002
         BR    R14                      EXIT                     Y02072 64250002
*                                                                       64700018
*********************************************************************** 64800018
*                                                                       64900018
*   BRANCH TO IGG08102                                                  65000048
*                                                                       65100018
*********************************************************************** 65200018
*                                                                       65300018
XCTLRTN  EQU   *                                                        65350002
         L     R15,ID2                  ADDR. OF IGG08102      @Z40MSMI 65500048
         BR    R15                      BRANCH TO MODULE       @Z40MSMI 65510048
         EJECT                                                          65550048
WTOR     EQU   *                                                 Y02072 65552002
*********************************************************************** 65554002
*                                                                       65556002
*   CLEAR REPLY AREA AND REPLY UCS ID SAVE AREA                         65558002
*   THEN ISSUE WTOR IN PROBLEM STATE                                    65558402
*                                                                       65558802
*********************************************************************** 65559202
*                                                                       65559602
         MVC   SPWREPLY,BLANKS          CLEAR REPLY AREA                65559702
         MVI   SPWRPECB,0               RESET REPLY ECB                 65559902
*                                                                       65563202
         WTOR  MF=(E,SPWRPLYA)          ISSUE WTOR IN PROB STATE Y02072 65566702
         ST    R1,SPWMSGID              SAVE MSG ID FOR DOM    @ZA25004 65567348
         OI    SPWMSGID,X'80'           SET FLAG FOR ONE MSG   @ZA25004 65567948
*                                                                       65568702
         BR    R14                      RETURN TO SYNCH          Y02072 65570002
         SPACE 3                                                        65580002
*********************************************************************** 65600002
*        THIS SUBROUTINE FINDS A MESSAGE IN THE MESSAGE CSECT           65650002
*        AND MOVES IT INTO THE SETPRINT WORK AREA                       65700002
*        INPUT: RWRK2 CONTAINS AN INDEX OFFSET (MSG NUMBER * 2)         65750002
*               SPRMSG CONTAINS THE ADDRESS OF THE MESSAGE CSECT        65800002
*        ADDRESSIBILITY REQUIRED:                                       65810002
*               SVRB EXTENDED SAVE AREA                                 65820002
*               SETPRT WORK AREA                                        65830002
*        OUTPUT:RWRK2 POINTS TO MESSAGE TEXT IN MSG CSECT               65850002
*               RWRK8 POINTS TO THE MSG ENTRY IN MSG CSECT              65900002
*               SPWMSGTX CONTAINS A COPY OF THE MESSAGE TEXT            65950002
*        THIS ROUTINE RETURNS ON REGISTER RRET                          66000002
*        ALL REGISTERS EXCEPT RWRK2 AND RWRK8 ARE TRANSPARENT           66010002
*********************************************************************** 66020002
GETMSG   L     RWRK8,SPRMSG             PICK UP MSG CSECT ADDR   Y02072 66050002
         USING MSGINDEX,RWRK8                                    Y02072 66100002
         AH    RWRK8,MSGINDOF(RWRK2)    ADD ENTRY OFFSET         Y02072 66150002
         USING MSGENTRY,RWRK8                                    Y02072 66200002
         SR    RWRK2,RWRK2                                       Y02072 66250002
         IC    RWRK2,MSGOFF             PICK UP TEXT OFFSET      Y02072 66300002
         AR    RWRK2,RWRK8              GET PTR TO TEXT          Y02072 66350002
         USING MSGTXT,RWRK2                                      Y02072 66360002
         MVC   SPWMSGTX,MSGTXT          MOVE IT INTO WORK AREA   Y02072 66370002
         BR    RRET                     RETURN TO CALLER         Y02072 66380002
         DROP  RWRK2,RWRK8                                       Y02072 66390002
         SPACE 2                                                        66392002
*********************************************************************** 66400018
*        THIS ROUTINE FILLS IN THE UNIT NAME AND IMAGE ID               66500002
*        IN MESSAGES WHICH HAVE ALREADY BEEN MOVED TO THE WORK AREA     66550002
*        INPUT: RWRK8 POINTS TO THE MESSAGE ENTRY IN MSG CSECT          66560002
*               SPWREPID CONTAINS THE IMAGE ID TO FILL IN               66570002
*        ADDRESSIBILITY REQUIRED:                                       66580002
*               UCB                                                     66582002
*               SETPRT WORK AREA                                        66584002
*        OUTPUT:SPWREPID AND UCBNAME HAVE MEEN MOVED TO THE             66590002
*               APPROPRIATE OFFSETS FROM SPWMSGTX                       66592002
*               RWRK8 IS UNCHANGED FROM INPUT                           66592402
*        THIS ROUTINE RETURNS ON REGISTER RRET                          66593202
*        ALL REGISTERS EXCEPT RWRK2 ARE TRANSPARENT                     66593602
*********************************************************************** 66594002
FILLFLDS EQU   *                                                 Y02072 66596002
         USING MSGENTRY,RWRK8                                    Y02072 66598002
         SR    RWRK2,RWRK2                                       Y02072 66598402
         IC    RWRK2,MSGOFF1            PICK UP FIRST OFFSET     Y02072 66598802
         LA    RWRK2,SPWMSGTX(RWRK2)    POINT TO VAR IN WORKAREA Y02072 66599202
         MVC   0(L'UCBNAME,RWRK2),UCBNAME  MOVE IN UCBNAME       Y02072 66599602
         SR    RWRK2,RWRK2                                       Y02072 66649602
         IC    RWRK2,MSGOFF2            PICK UP SECOND OFFSET    Y02072 66699602
         LA    RWRK2,SPWMSGTX(RWRK2)    POINT TO VAR IN WORKAREA Y02072 66699702
         MVC   0(L'SPWREPID,RWRK2),SPWREPID  MOVE IN IMAGE ID    Y02072 66699802
         BR    RRET                                              Y02072 66699902
         DROP  RWRK8                                             Y02072 66733202
         EJECT                                                          66766702
*********************************************************************** 66800018
*              CONSTANTS                                                66850002
*********************************************************************** 66860002
*                                                                       66900018
FULLWORD DS    0F                      FORCE TO FULLWORD         M5143  66920020
*                                       BOUNDARY                 M5143  66940020
BLDLCNST DC    AL2(1,SPWBLDLN)          BLDL LIST HEADER         Y02072 67000002
UCSCONST DC    C'UCS1'                  UCS IMAGE MEMBER NAME           67100018
FOLDCN   DC    C'FOLD'                  MESSAGE 'FOLD'                  67200018
VERIFYCN DC    C'VERIFY'                MESSAGE 'VERIFY'                67300018
CANCELCN DC    C'CANCEL'                MESSAGE 'CANCEL'                67400018
UBLANK   DC    C'U '                    REPLY = 'U'                     67500018
CBLANK   DC    C'C '                    REPLY = 'C'                     67600018
VBLANK   DC    C'V '                    REPLY = 'V'                     67700018
BLANKS   DC    CL16' '                  CONSTANT =BLANKS         S20202 67850002
LOWER    EQU   BLANKS                   MASK TO ALLOW LOWER CASE ALPHAS 67860002
*                                                                       67900018
*   BRANCH TABLE                                                        70200048
*                                                                       70300018
ID2      DC    V(IGG08102)              UCS IMAGE LOAD         @Z40MSMI 70350048
ID3      DC    V(IGG08103)              FCB IMAGE LOAD         @Z40MSMI 70400048
*                                                                       70450002
*        PATCH AREA                                                     70500002
*                                                                       70550002
PATCH    DC    25H'0'                   PATCH AREA               YM5703 70552002
END      EQU   *                        END OF MODULE            Y02072 70610002
         TITLE 'IGG08101 - SETPRT LOAD 2 - DSECTS'                      70650002
         DCBD  DSORG=PS                                                 74300018
         EJECT                                                          74400002
SRT      DSECT                                                          75200018
*                                                                       75300018
         IEFUCBOB                                                       75400018
         EJECT                                                          75750002
         IEZDEB                                                         75800002
         EJECT                                                          75850002
         IEZIOB                                                         75900002
         EJECT                                                          75950002
         IHAECB                                                         76000002
         EJECT                                                          76050002
         IGGSPW                                                         76100002
         EJECT                                                          76102002
CHAR     DSECT                                                          76104002
*                                                                       76106002
*********************************************************************** 76108002
*                                                                       76110002
*        THIS DSECT IS USED TO SCAN THE REPLY FROM THE OPERATOR         76112002
*        IT REDEFINES SPWREPLY AND SPWREPID                             76112402
*                                                                       76114002
*********************************************************************** 76116002
*                                                                       76118002
CHAR1    DS    C                        FIRST CHARACTER                 76120002
CHAR2    DS    C                        SECOND CHARACTER                76122002
CHAR3    DS    C                        THIRD CHARACTER                 76124002
         ORG   CHAR1+(SPWREPID-SPWREPLY)                         Y02072 76126002
CHARSAV  DS    C                        USED TO SAVE REPLY              76128002
*                                       IN SPWREPID                     76130002
*        THE FOLLOWING EQUATES ARE USED IN THE SCAN                     76132002
BLANK    EQU   C' '                     A BLANK                         76134002
COMMA    EQU   C','                     A COMMA                         76136002
ALPHAV   EQU   C'V'                     V                               76138002
ALPHAF   EQU   C'F'                     F                               76140002
ALPHA    EQU   X'C0'                    USED TO CHECK IF CHAR ALPHA     76142002
         EJECT                                                          76150002
         IHASPP                                                         76200002
         EJECT                                                          76250002
         IGGMSG                                                  Y02072 76300002
         END                                                            80200018
./  ADD  SSI=73490010,NAME=IGG08102
8102     TITLE 'IGG08102 - SETPRT LOAD 3 - UCS BUFFER LOAD AND VERIFY'  00100000
IGG08102 CSECT                                                          00300000
* /*  START OF SPECIFICATIONS****                             @Z40MSAP  00310048
*01*  PROCESSOR = ASSEMXF:                                              00320048
**** END OF SPECIFICATIONS **                                @Z40MSAP*/ 00330048
*********************************************************************** 00350002
*                                                                       00400002
* MODULE-NAME = IGG08102                                                00450002
*                                                                       00500002
* DESCRIPTIVE-NAME = SETPRT UCS BUFFER LOAD AND VERIFY                  00510002
*                                                                       00512002
* COPYRIGHT = NONE                                                      00514002
*                                                                       00516002
* STATUS = LEVEL 001                                                    00518003
*                                                                       00520021
* FUNCTION = LOAD UCS BUFFER                                            00700003
*        WHEN VERIFICATION OF IMAGE IS SPECIFIED, PRINT THE IMAGE       00800002
*          FOR VISUAL VERIFICATION                                      00900002
*        UPDATE UCB TO INDICATE THE STATUS OF UCS BUFFER                00950002
*        DELETE UCS IMAGE                                               01000002
*        REQUEST OPERATOR VERIFICATION AND ANALYZE REPLY                01050002
*                                                                       01300000
*                                                                       01350002
* NOTES =                                                               01400002
*    DEPENDENCIES = BLANK IS USED--CORRECTABLE BY REASSEMBLY.           01450002
*        THE FOLLOWING CHARACTER STRINGS ARE USED IN                    01500002
*        TESTING OPERATOR REPLIES:                                      01550002
*        'V', 'R', 'C', 'RETRY', 'VERIFY', 'CANCEL'                     01600002
*        THESE STRINGS ARE CONSIDERED TO BE OPERATING SYSTEM KEYWORDS   01650002
*        RATHER THAN LANGUAGE DEPENDENT PHRASES.                        01700002
*                                                                       01750002
*        BLANKS ARE OR'ED TO ALL REPLIES TO CONVERT THEM TO UPPER CASE  01800002
*                                                                       01850002
*    RESTRICTIONS = NONE                                                01900002
*                                                                       01950002
*    REGISTER-CONVENTIONS = ALL REGISTER NAMES BEGIN WITH R             02000002
*        SEE EQUATES IMMEDIATELY FOLLOWING PROLOG                       02050002
*                                                                       02060002
*    PATCH-LABEL = PATCH, AN AREA ASSEMBLED AS BINARY 0                 02070002
*                                                                       02080002
* MODULE-TYPE =                                                         02090002
*    PROCESSOR = OS/VS ASSEMBLER                                        02092002
*                                                                       02092402
*    MODULE-SIZE = 1066 DECIMAL BYTES                                   02092802
*                                                                       02094002
*    ATTRIBUTES = REENTRANT, ENABLED, PRIVELEGED,                       02096002
*        EXECUTES IN SETPRT INVOKER KEY                                 02098002
*        CODE AT ENTRY POINT WTOR IS NON-PRIVELEGED                     02098402
*                                                                       02098802
* ENTRY POINT = IGG08102                                                02099202
*    PURPOSE = SEE FUNCTION                                             02099602
*                                                                       02099702
*    LINKAGE = BRANCH FROM IGG08101                                     02099848
*                                                                       02099902
* INPUT = REGISTER 4(RSPW) = WORK AREA ADDRESS                          02166002
*         REGISTER 5(RPAR) = PARAMETER LIST ADDR                        02166402
*         REGISTER 6(RSVR) = SVRB EXTENDED SAVE AREA ADDRESS            02166502
*         REGISTER 8(RIMAG) = ADDR OF IMAGE TO BE LOADED                02166602
*         REGISTER 9(RIOB) = ADDRESS OF IOB                             02166702
*                                                                       02177702
* OUTPUT =                                                              02187702
*    REGISTERS = TO INVOKER                                             02188102
*        R0 = UNDEFINED                                                 02188502
*        R1 = UNDEFINED                                                 02188602
*        R2-R14 = UNCHANGED                                             02188702
*        R15 = RETURN CODE (SEE EXIT-ERROR)                             02188802
*                                                                       02242102
*    REGISTERS = TO IGG08103                                            02244102
*        R0-R3 = UNDEFINED                                              02246102
*        R4-R6 = AS FOR INPUT                                           02248102
*        R7-R8 = UNDEFINED                                              02256702
*        R9 = AS FOR INPUT                                              02258702
*        R10-R14 = UNDEFINED                                            02260748
*        R15 = RESERVED FOR BRANCH INTERFACE                            02262748
*                                                                       02264702
*    MESSAGES = RETRIEVED FROM IGGMSG01                                 02265102
*        'IEC121D V XXX,YYYY(,FOLD)'                                    02265202
*        'IEC125A ERROR - REPEAT REPLY'                                 02265402
*                                                                       02265502
*    UCB = IMAGE ID AND OPTIONS                                         02274102
*    PRINTER = UCS BUFFER IS LOADED                                     02300002
*         LISTING OF THE IMAGE WHEN VERIFICATION SPECIFIED              02400002
*                                                                       02900000
* EXIT-NORMAL = WHEN AN FCB IMAGE IS TO BE LOADED, BRANCH TO SETPRT     02960048
*               MODULE IGG08103                                         03020002
*             - WHEN NO FCB IMAGE IS TO BE LOADED,                      03080002
*               EXIT TO THE PROBLEM PROGRAM. RETURN CODE=00             03140002
*                                                                       03200000
* EXIT-ERROR =  WHEN PERMANENT I/O ERROR OCCURED DURING UCS LOAD,       03300002
*               SET RETURN CODE=0C                                      03400002
*             - WHEN PERMANENT I/O ERROR OCCURED DURING VERIFICATION,   03600000
*               SET RETURN CODE=10                                      03800002
*             - WHEN AN OPERATOR ISSUED CANCEL FOR IEC121,              03900002
*               SET RETURN CODE=14                                      04100002
*             - IF AN FCB IMAGE IS TO BE LOADED THE RETURN CODE IS      04120020
*               SAVED AND BRANCH IS MADE TO SETPRT MODULE IGG08103,     04140048
*               OTHERWISE RETURN TO THE SETPRT INVOKER.                 04160002
*             - IF DEB IS NOT VALIDLY ASSOCIATED WITH USER'S DCB,       04170002
*               EXIT TO SETPRT INVOKER WITH RETURN CODE=18              04180002
*                                                                       04182002
* ENTRY-POINT = WTOR (INTERNAL ENTRY)                                   04184002
*    PURPOSE = ISSUE WTOR SVC IN PROBLEM STATE TO AVOID INTEGRITY       04186002
*        EXPOSURE FROM NON-PROTECTED MESSAGE                            04188002
*                                                                       04188402
*    LINKAGE = SYNCH FROM WITHIN THIS MODULE                            04188802
*                                                                       04189202
*    INPUT =                                                            04189602
*        REGISTER 4(RSPW) = WORK AREA ADDRESS                           04189702
*        REGISTER 14(R14) = RETURN ADDRESS                              04189802
*                                                                       04189902
*    OUTPUT =                                                           04191802
*      REGISTERS = TO INVOKER                                           04192202
*        R0 = UNDEFINED                                                 04192602
*        R1 = UNDEFINED                                                 04193002
*        R2-R14 = UNCHANGED                                             04193402
*        R15 = UNDEFINED                                                04193502
*                                                                       04193602
* EXTERNAL REFERENCES =                                                 04193802
*   ROUTINES = DEBCHK  (BRANCH ENTRY)                                   04195702
*              DELETE  (SVC  9)                                         04197602
*              EXCP    (SVC  0)                                         04199502
*              FREEMAIN(SVC 10)                                         04201402
*              IGG08103(SETPRT LOAD 4)                                  04203302
*              IMGLIB  (SVC105)                                         04205202
*              SETLOCK (BRANCH ENTRY)                                   04207102
*              SYNCH   (SVC 12)                                         04209002
*              WAIT    (SVC  1)                                         04210902
*              WTOR    (SVC 35)                                         04212802
*                                                                       04216602
*   DATA-AREAS = SPP -- SETPRT PARAMETER LIST                           04226602
*              SPW -- SETPRT WORK AREA                                  04228602
*              SPRBXSV -- RB EXTENDED SAVE AREA                         04230602
*              MSG -- MESSAGE CSECT                                     04232602
*   CONTROL-BLOCKS =                                                    04233002
*              CVT -- COMMUNICATIONS VECTOR TABLE                       04233102
*              DCB -- DATA CONTROL BLOCK                                04233202
*              DEB -- DATA EXTENT BLOCK                                 04233302
*              ECB -- EVENT CONTROL BLOCK                               04238802
*              IOB -- INPUT/OUTPUT BLOCK                                04240802
*              PSA -- PREFIXED SAVE AREA                                04241202
*              UCB -- UNIT CONTROL BLOCK                                04242802
*                                                                       04243202
*   MACROS = DELETE, EXCP, FREEMAIN, IMGLIB, MODESET, SETLOCK,          04243602
*              SYNCH, WAIT, WTOR,                                       04243748
*              CVT, DCBD, IEFUCBOB, IEZDEB, IEZIOB, IGGMSG, IGGSPW,     04244002
*              IHAECB, IHAPSA, IHASPP                                   04244102
*                                                                       04244402
* CHANGE-ACTIVITY = AS FOLLOWS                                          04246402
*                                                                       04246502
* NOTE = THIS MODULE WAS BROUGHT UP TO STANDARDS FOR VS2-2              04246802
*        WHICH CAUSED ALL PREVIOUS RELEASE SEQUENCE NUMBER DELETIONS TO 04247202
*        BECOME INVALID.                                                04247602
*                                                                       04248402
*          RELEASE 20 DELETIONS                                         04270002
*THE FOLLOWING PTMS WERE FIXED IN THIS RELEASE - 5149, 5143             04280002
*THE FOLLOWING APAR WAS FIXED IN THIS RELEASE - 34950                   04290002
*THE FOLLOWING DEVELOPMENT CODE WAS FOR 3211 SUPPORT - S20202           04292002
*                                                                       04294002
*          RELEASE 21 DELETIONS                                         04298802
*THE FOLLOWING PTMS WERE FIXED IN THIS RELEASE - 0092, 1759             04299202
*THE FOLLOWING APAR WAS FIXED IN THIS RELEASE - 50699                   04299602
*                                                                       04299702
*          VS2 RELEASE 2 DELETIONS                                      04299803
*THE FOLLOWING DEVELOPMENT CODE WAS FOR VS2-2 - Y02072                  04349802
*                                                                YM3920 04449802
*                                                                YM5703 04499802
*                                                                YM5919 04549802
*                                                                       04599803
*          VS2 RELEASE 3 CHANGES                                        04649803
*A199700-199800,203500,619078-619098,619283                     ZA02199 04699803
*                                                                       04749848
*          VS2 RELEASE 3.7 CHANGES                                      04757848
*                                                                       04765848
*C146000-146300                                                @ZA25004 04773848
*A459500,618758-618761                                         @ZA25004 04781848
*                                                                       04789848
*          VS2 RELEASE 4 CHANGES                                        04799848
*                                                              @Z40MSMI 04849848
*                                                                       04899848
*                                                                       05300000
*********************************************************************** 05400000
         EJECT                                                          05600000
*********************************************************************** 05800000
*                                                                       05900000
*   REGISTER CONVENTIONS USED THROUGH OUT ALL SETPRT MODULES            06000002
*                                                                       06100000
*********************************************************************** 06200000
*                                                                       06300000
R0       EQU   0                        PARAMETER REG                   06400002
RWRK1    EQU   0                        WORK REGISTER                   06450002
R1       EQU   1                        PARAMETER REG                   06500002
RWRK2    EQU   1                        WORK REGISTER                   06550002
RDCB     EQU   2                        ADDR OF USER'S DCB              06600000
RWRK9    EQU   2                        WORK REGISTER                   06650002
RBASE    EQU   3                        BASE REG.                       06700000
RSPW     EQU   4                        ADDR OF MESSAGE/WORKAREA        06800002
RPAR     EQU   5                        PARM LIST ADDR                  06900000
RSVR     EQU   6                        SVRB EXTENDED SAVE AREA         07000002
RRET     EQU   7                        SUBROUTINE RETURN               07100002
RIMAG    EQU   8                        ADDRESS OF IMAGE LOADED         07250002
RIOB     EQU   9                        ADDR OF LAST IOB USED           07300000
R10      EQU   10                       LIMIT FOR STM            Y02072 07350002
RUCB     EQU   10                       UCB ADDR                        07400000
RDEB     EQU   11                       DEB ADDR                        07500000
RWRK10   EQU   11                       WORK REGISTER                   07550002
RWRK5    EQU   12                       WORK REG.                       07600002
RWRK6    EQU   13                       WORK REG.                       07700002
R14      EQU   14                       LINK REG.                       07800002
RWRK7    EQU   14                       WORK REGISTER                   07850002
R15      EQU   15                       LINK RETURN CODE REG.           07900002
RWRK8    EQU   15                       WORK REGISTER                   07950002
*                                                                       08000000
*********************************************************************** 08100000
*                                                                       08200000
*   RETURN CODES                                                        08900002
*                                                                       09000000
RCNORM   EQU   X'00'                    NORMAL RETURN                   09100002
RCLOADIO EQU   X'0C'                    I/O ERROR DURING LOAD           09200002
RCVERIO  EQU   X'10'                    I/0 ERROR DURING VERIF          09300002
RCOPVER  EQU   X'14'                    OPER CANCEL IN VERIF            09400002
RCNOPEN  EQU   X'18'                    DCB NOT OPEN             Y02072 09450002
*                                                                       09500000
*********************************************************************** 09510002
*              MESSAGE NUMBERS IN IGGMSG01                              09520002
*        ALL MESSAGE NUMBERS HAVE BEEN DOUBLED IN THESE EQUATES         09530002
*        TO PROVIDE OFFSETS INTO THE MESSAGE CSECT.                     09540002
*        THIS IS DEPENDENT ON L'MSGINDOF BEING 2.                       09542002
*                                                                       09544002
MSG121   EQU   16*2                     IEC121D, NO FOLD         Y02072 09550002
MSG121F  EQU   12*2                     IEC121D, FOLD            Y02072 09600002
MSG125   EQU   8*2                      IEC125I                  Y02072 09610002
HEADING  EQU   13*2                     UCS HEADING, NO FOLD     Y02072 09620002
HEADINGF EQU   18*2                     UCS HEADING, FOLD        Y02072 09630002
*                                                                       09632002
*********************************************************************** 09634002
*              OTHER EQUATES                                            09636002
*                                                                       09638002
UCB43211 EQU   X'09'                    MASK FOR 3211 PRINTER     M5149 10265002
BLANK    EQU   C' '                     A BLANK FOR AN MVI OPERAND      10315002
UCSLNGTH EQU   X'F0'                    UCS IMAGE LENGTH                10415002
         EJECT                                                          10465002
         USING SPW,RSPW                                                 10515002
         USING SPPARM,RPAR                                              10565002
         USING IOBQSAMN,RIOB                                            10615002
         USING IMAGE,RIMAG                                              10665002
         USING SPRBXSV,RSVR                                             10715002
*                                                                       12800000
*********************************************************************** 12900000
*                                                                       13000000
*   INITIALIZE REGISTERS                                                13100000
*                                                                       13200000
*********************************************************************** 13300000
*                                                                       13400000
         BALR  RBASE,0                  ESTABLISH BASE                  13500002
START    EQU   *                                                        14400000
         USING START,RBASE                                              14450002
         SPACE                                                          14460002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 14500002
         DC    C'IGG08102'              MODULE NAME              Y02072 14550002
         DC    C'@ZA25004'              LAST SHIP CODE         @ZA25004 14600048
         DC    C'&SYSDATE'              LAST DATE MODIFIED     @ZA25004 14630048
BEGIN    DS    0H                                                Y02072 14700002
         SPACE                                                          14750002
         L     RDCB,SPPDCBA             LOAD DCB ADDR                   14800002
         USING IHADCB,RDCB                                              14850002
         L     RDEB,DCBDEBAD            LOAD DEB ADDR                   14900000
         USING DEBDASD-(DEBBASND-DEBBASIC),RDEB                         14950002
         L     RUCB,DEBUCBAD            LOAD UCB ADDR                   15000000
         USING UCBOB,RUCB                                               15050002
         USING DEBBASIC,RDEB                                            15060002
*                                                                       15100000
*********************************************************************** 15200000
*                                                                       15300000
*   SET CCW FOR EXCP                                                    15400002
*                                                                       15500000
*********************************************************************** 15600000
*                                                                       15700000
         MVI   IOBFLAG1,IOBCMDCH+IOBUNREL  SET IOBFLAG=C.C/UNRL         15800002
*                                                                       16600000
*********************************************************************** 16700000
*                                                                       16800000
*   EXCP TO LOAD IMAGE INTO UCS BUFFER                                  16900000
*                                                                       17000000
*********************************************************************** 17100000
*                                                                       17200000
*   CONSTRUCT CCW'S TO LOAD UCS IMAGE                                   17500020
*                                                                       17600000
         XC    SPWCCW1(L'SPWCCW1+L'SPWCCW2),SPWCCW1   RESET CCWS        17700002
         SR    RWRK8,RWRK8              RESET REGISTER           S20202 17702002
         IC    RWRK8,IMANOLN            INSERT NO. OF            S20202 17704002
*                                       VERIFICATION LIN         S20202 17706020
         LA    RWRK5,IMALEN1            LOAD IMAGE LOAD ADDR + 2 S20202 17708002
*                                       = X                      S20202 17710020
         AR    RWRK5,RWRK8              DISPLACE BY NO. OF LINES S20202 17712002
         CLI   UCBTBYT4,UCB43211        CK FOR 3211 DCB           M5149 17714002
         BNE   BLDCCW2                  NO BUILD 1403 UCS LOAD   S20202 17716020
*                                       CCW'S                    S20202 17718020
*                                                                       17720020
*   YES BUILDS CCW TO LOAD UCS 3211 - LOAD CCW FOLLOWED BY FOLD CCW     17722002
*                                                                       17724020
         ST    RWRK5,SPWCCW1            STORE ADDR OF UCS IN CCW S20202 17726002
         MVI   SPWOPCD1,SPWLDUCS        SET COMMAND CODE=LOAD    S20202 17728002
*                                       UCS.                     S20202 17730020
         LA    RWRK8,IMA3211L           GET LENGTH OF UCS IMAGE  S20202 17732002
         ST    RWRK8,SPWCCWF1           STORE LENGTH OF UCS IN   S20202 17736002
*                                       CCW                      S20202 17738020
         TM    SPWPARM1,SPWFOLD         TEST IF FOLD MODE        Y02072 17740002
*                                       SPECIFIED                S20202 17742020
         BNO   EXCPLOAD                 NO GO TO ISSUE EXCP      S20202 17744002
*                                       YES CHAIN AND BUILD FOLD CCW    17746020
         MVI   SPWCCWF1,SPWCC           SET CC ON IN LOAD CCW    S20202 17748002
         MVI   SPWOPCD2,SPWFLDCD        SET COMMAND CODE=FOLD    S20202 17750002
         MVI   SPWCCWF2,SPWSILI         SET SILI BIT ON          S20202 17752002
         MVI   SPWBYTE2+1,1             SET COUNT EQ 1           S20202 17754002
         B     EXCPLOAD                 GO ISSUE EXCP TO         S20202 17756002
*                                       LOAD&FOLD UCS            S20202 17758020
*                                                                       17760020
*   BUILD CCW TO LOAD UCS 1403 - GATE LOAD CCW FOLLOWED BY A            17762020
*   LOAD UCS OR LOAD AND FOLD CCW.                                      17764020
*                                                                       17766020
BLDCCW2  EQU   *                                                 S20202 17768020
*                                                                       17770020
         MVI   SPWOPCD1,SPWCNTRL        SET CONTROL CCW                 17800002
         MVI   SPWCCWF1,SPWSILI+SPWCC   SET FLAGS                       17900002
         MVI   SPWBYTE1+1,1             SET COUNT = 1                   18000002
*                                                                       18100000
         MVI   SPWBYTE2+1,IMA1403L      SET COUNT TO IMAGE LENGTH       18300002
*                                                                       18400000
         ST    RWRK5,SPWCCW2            STORE DATA ADDR IN CCW          18900002
*                                                                       19000000
         MVI   SPWOPCD2,SPWLDUCS        COMMAND CODE = LOAD NO FOLD     19100002
         TM    SPWPARM1,SPWFOLD         IF FOLD IS NOT SPECIFIED Y02072 19200002
         BNO   EXCPLOAD                 THEN GO TO EXCP                 19300002
*                                                                       19400000
         MVI   SPWOPCD2,SPWLDFLD        IF YES,COMMAND CODE = LOAD FOLD 19500002
*                                                                       19600000
EXCPLOAD EQU   *                                                        19700002
*                                                                       19800000
         L     RWRK2,UCBXTADR           LOAD UCB EXTENSION ADDR  M0092  19820002
         USING UCBUCS,RWRK2                                             19830002
         IC    RWRK1,UCBUCSOP           PASS OP UNCHANGED        Y02072 19832002
         DROP  RWRK2                                                    19910002
         BAL   RRET,SETUCB              STORE UCSID AND UCSOP    Y02072 19960002
         OI    IOBFLAG1,IOBSPSVC        IND NO SAM APPENDAGE    ZA02199 19970000
*                                       PROCESSING REQUIRED     ZA02199 19980003
         EXCP  IOBSTDRD                 EXCP                            20000002
*                                                                       20100000
         L     R1,IOBECBPT              LOAD ECB ADDR                   20200002
         WAIT  ECB=(1)                  WAIT ON EXCP                    20300000
         NI    IOBFLAG1,X'FF'-IOBSPSVC  RESET IOB FLAG          ZA02199 20350003
*                                                                       20400000
         L     RWRK2,IOBECBPT           LOAD ECB ADDR                   20500002
         USING ECB,RWRK2                                                20550002
         CLI   ECBCC,ECBNORM            TEST IF I/O COMPLETE            20600002
         DROP  RWRK2                                                    20650002
         BE    UCSVRFY                  IF YES,GOTO TEST IF VERIFY SPEC 20700002
*                                                                       21200000
*********************************************************************** 21300000
*                                                                       21400000
*   WHEN I/O ERROR WAS DETECTED DURING LOAD UCS                         21500000
*   UPDATE UCB WITH X'00',DELETE IMAGE LOADED AND GIVE CONTROL BACK     21600000
*   TO USER'S PROGRAM WITH RETURN CODE = X'0C' IN REG.15                21700000
*   RUN THE C.E. DIAGNOSTICS FOR THE UCS FEATURE                        21800000
*                                                                       21900000
*********************************************************************** 22000000
*                                                                       22100000
         LA    RWRK5,RCLOADIO           LOAD RETURN CODE                22200002
*                                                                       22500000
NULLUCB  EQU   *                                                        22600000
*                                                                       22900000
*   SET UCB TO INDICATE THE IMAGE IN THE BUFFER IS NOT USABLE           23000000
*                                                                       23100000
         SR    RWRK1,RWRK1              UCSOP = 0                Y02072 23350002
         SR    RWRK6,RWRK6              UCSID = 0                Y02072 23400002
         BAL   RRET,SETUCB              PUT VALUES IN UCB        Y02072 23450002
         B     IMAGDEL                  GO DELETE IMAGE                 23600002
         EJECT                                                          23700002
UCSVRFY  EQU   *                                                        24000000
*                                                                       24100000
*********************************************************************** 24200000
*                                                                       24300000
*    TEST IF VERIFICATION IS REQUIRED BY EITHER THE USER OR THE  A34950 24360020
*    OPERATOR.                                                   A34950 24420020
*            - YES: VERIFY IMAGE                                 A34950 24480020
*            - NO : UPDATE UCB & EXIT                            A34950 24540020
*                                                                       24600000
*********************************************************************** 24700000
*                                                                       24800000
         TM    SPWPARM1,SPWVERIF       IF VERIFICATION REQUIRD   Y02072 24900002
         BO    VRFY2                   YES, VERIFY (USER OPTION) A34950 24930002
         TM    SPWFLG1,SPWRPVER        IF OPERATOR SPEC VERIFY   Y02072 24960002
         BNO   SETNORM                 IF NOT,GOTO EXIT ROUTINE         25000002
         SPACE 3                                                        25100002
VRFY2    EQU   *                                                        25400002
*                                                                       25500000
*********************************************************************** 25600000
*                                                                       25700000
*   INITIALIZE REGISTERS FOR VERIFICATION                               25800000
*        RWRK5 - NUMBER OF LINES REMAINING TO PRINT                     25850002
*        RWRK7 - POINTER TO CURRENT LINE                                25860002
*        RWRK9 - CURRENT ENTRY IN TABLE OF LINE LENGTHS                 25870002
*        RWRK10- NUMBER OF CHARACTERS IN CURRENT LINE                   25880002
*                                                                       25900000
*********************************************************************** 26000000
         DROP  RDEB,RDCB                                                26050002
*                                                                       26100000
         SR    RWRK5,RWRK5              RESET REGISTER                  26200002
         IC    RWRK5,IMANOLN            INSERT NO. OF LINES             26300002
*                                                                       26400000
         LTR   RWRK5,RWRK5              TEST IF NO VERIFICATION         26500002
         BZ    SETNORM                  IF NOT,GOTO EXIT ROUTINE        26600002
*                                                                       26700000
         SR    RWRK10,RWRK10            RESET RDEB REG.                 26800002
         LA    RWRK9,IMALEN1            OBTAIN 1ST NO. OF CHAR/LINE     26900002
         IC    RWRK10,0(RWRK9)          INSERT NO. OF CHAR/LINE         27000002
         LR    RWRK7,RWRK9              OBTAIN UCS IMAGE POSITION       27100002
         AR    RWRK7,RWRK5              ADD NO. OF LINES TO POSITION    27200002
*                                                                       27300000
*                                                                       27400000
*********************************************************************** 27500000
*                                                                       27600000
*   EXCP ON PRINTER TO PRINT VERIFICATION LINES                         27700000
*                                                                       27800000
*********************************************************************** 27900000
*                                                                       28000000
*                                                                       28100000
*   CONSTRUCT CCW TO SKIP TO NEW PAGE AND PRINT HEADING                 28200000
*                                                                       28300000
         XC    SPWCCW1(L'SPWCCW1+L'SPWCCW2),SPWCCW1 RESET CCWS          28400002
         MVI   SPWBYTE1+1,1             DATA LENGTH=X'01'               28500002
         MVI   SPWCCWF1,SPWSILI+SPWCC   SET C.C.AND SILI                28600002
         MVI   SPWOPCD1,SPWSKIP         SET COMMAND CODE = SKIP TO CH1  28700002
*                                                                       28800000
         MVI   SPWCCWF2,SPWSILI         SET SILI FLAG                   29000002
*                                                                       29100000
         LA    RWRK1,SPWMSGTX           PRINT AREA ADDR          Y02072 29200002
         ST    RWRK1,SPWCCW2            STORE DATA ADDR                 29300002
         MVI   SPWOPCD2,SPWWRITE        SET COMMAND CODE = WRITE        29400002
*                                                                       29500000
*   MOVE UCS HEADING,UCS IMAGE ID AND LOAD MODE                         29600000
*                                                                       29700000
         LA    RWRK2,HEADING            ASSUME NO FOLD           Y02072 29750002
         TM    SPWPARM1,SPWFOLD         TEST IF LOAD MODE = FOLD Y02072 29760002
         BNO   GETHEAD                  IF NOT,GOTO GET HEADING  Y02072 29770002
         LA    RWRK2,HEADINGF           IF SO, INDICATE FOLD     Y02072 29800002
GETHEAD  BAL   RRET,GETMSG              GET THE MESSAGE          Y02072 29850002
         USING MSGENTRY,RWRK8                                    Y02072 29900002
*                                                                       29910002
*     FILL IN CCW LENGTH                                                29950002
*                                                                       29960002
         SR    RWRK2,RWRK2                                       Y02072 30000002
         IC    RWRK2,MSGLNG             GET MESSAGE LENGTH       Y02072 30050002
         LA    RWRK2,1(RWRK2)           CHANGE LEN-1 TO LEN      Y02072 30060002
         STH   RWRK2,SPWBYTE2           SET LENGTH IN CCW        Y02072 30070002
*                                                                       30070402
*    FILL IN IMAGE ID                                                   30072002
*                                                                       30074002
         IC    RWRK2,MSGOFF1            PICK UP OFFSET TO ID     Y02072 30080002
         LA    RWRK2,SPWMSGTX(RWRK2)    INDEX INTO MESSAGE       Y02072 30090002
         ST    RWRK6,0(RWRK2)           STORE IMAGE ID           Y02072 30100002
         DROP  RWRK8                                             Y02072 30200002
         BAL   RRET,WRITEGO             GO ISSUE EXCP            Y02072 30250002
*                                                                       36000000
VRFYEXCP EQU   *                                                        36100000
*                                                                       36200000
*********************************************************************** 36300000
*                                                                       36400000
*   EXCP FOR VERIFICATION LINES                                         36500000
*                                                                       36600000
*********************************************************************** 36700000
*                                                                       36800000
         ST    RWRK7,SPWCCW1            STORE DATA ADDR IN CCW          36900002
         ST    RWRK10,SPWCCWF1          STORE DATA LENGTH IN CCW        37000002
         MVI   SPWCCWF1,SPWSILI         SET SILI FLAG                   37100002
         MVI   SPWOPCD1,SPWWRITE        SET COMMAND CODE = WRITE        37200002
         BAL   RRET,WRITEGO             GO EXCP,WAIT AND TST     S20202 37700002
*                                       COMP CODE                S20202 38200020
*                                                                       38700000
*   REPEAT EXCP WHEN NO I/O ERROR                                       38800000
*                                                                       38900000
         AR    RWRK7,RWRK10             MODIFY IMAGE POSITION           39000002
         LA    RWRK9,1(RWRK9)           INCREMENT REG. BY '1'           39100002
         IC    RWRK10,0(RWRK9)          INSERT NO. OF CHAR/LINE         39200002
*                                                                       39300000
         BCT   RWRK5,VRFYEXCP           REPEAT EXCP                     39400002
*                                                                       39500000
*********************************************************************** 39600000
*                                                                       39700000
*   SKIP TO NEW PAGE                                                    39800000
*                                                                       39900000
*********************************************************************** 40000000
*                                                                       40100000
         MVI   SPWBYTE1+1,1             MOVE DATA LENGTH=1              40200002
         MVI   SPWOPCD1,SPWSKIP       SET COMMAND CODE=SKIP             40300002
         BAL   RRET,WRITEGO             GO EXCP,WAIT AND TST     S20202 40800002
*                                       COMP CODE                S20202 41300020
*                                                                       41800000
*********************************************************************** 41810002
*                                                                       41850002
*   WTOR 'IEC121D V XXX,YYYY,FOLD' TO REQUEST OPERATOR'S REPLY          41900002
*                                                                       41950002
*********************************************************************** 41960002
*                                                                       42000002
         LA    RWRK2,MSG121             ASSUME NO FOLD           Y02072 44350002
         TM    SPWPARM1,SPWFOLD         IF LOAD MODE NOT = FOLD  Y02072 44400002
         BNO   GET121                   THEN GO GET NOFOLD MSG   Y02072 44500002
         LA    RWRK2,MSG121F            ELSE SET FOR FOLD MSG    Y02072 44550002
*                                                                       44600002
GET121   BAL   RRET,GETMSG              GET THE MESSAGE          Y02072 44650002
         ST    RWRK6,SPWREPID           STORE UCS IMAGE ID              44700002
         BAL   RRET,FILLFLDS            FILL IN UNIT & IMAGE ID  Y02072 44750002
MESSAGO  EQU   *                                                   DM0Q 45050018
         MVC   SPWREPLY,BLANKS          CLEAR REPLY AREA TO BLANKS      45300002
         MVI   SPWRPECB,0               RESET REPLY ECB                 45400002
*                                                                       45500000
         TM    SPRKEY,SPRUSKEY          IF CALLED AS SYS FUNCT   Y02072 45510002
         BZ    MESSAGO2                 DO NOT SYNCH TO WTOR     Y02072 45520002
         SYNCH WTOR                     ISSUE WTOR IN PROB STATE Y02072 45550002
         B     WAIT                     THEN WAIT FOR COMPLETION Y02072 45600002
MESSAGO2 EQU   *                        SYS WTOR                 Y02072 45650002
         BAL   R14,WTOR                 ISSUE WTOR IN SUP STATE  Y02072 45660002
*                                                                       45700000
WAIT     EQU   *                        WAIT FOR OPERATOR REPLY  Y02072 45750002
         WAIT  ECB=SPWRPECB,LONG=YES                             Y02072 45900002
         XC    SPWMSGID(4),SPWMSGID     CLEAR MSG ID FOR DOM   @ZA25004 45950048
*                                                                       46000000
*********************************************************************** 46100000
*                                                                       46200000
*   REPLY ANALYSIS                                                      46300000
*                                                                       46400000
*********************************************************************** 46500000
*                                                                       46600000
         OC    SPWREPLY,LOWER           OR TO ALLOW LOWER CASE REPLY    46700002
         CLC   SPWREPLY(L'RETRYCN),RETRYCN  TEST IF REPLY='RETRY'       46800002
         BE    VRFY2                    IF YES GO RE-VERIFY      S20202 46900002
*                                                                       47000000
         CLC   SPWREPLY(L'CANCELCN),CANCELCN  TEST IF REPLY='CANCEL'    47100002
         BNE   TESTOK                   IF NOT,GOTO CONTINUE TEST       47200002
*                                                                       47500000
CANCELGO EQU   *                                                        47600000
*                                                                       47700000
*********************************************************************** 47800000
*                                                                       47900000
*   AN OPERATOR CANCELLED THE JOB STEP BECAUSE SPECIFIED CHAIN IS NOT   48000000
*   AVAILABLE. RETURN CODE = X'14' IN REG.15                            48100000
*   RERUN THE JOB WITH CORRECT CHAIN/TRAIN                              48200000
*                                                                       48300000
*********************************************************************** 48400000
*                                                                       48500000
         LA    RWRK5,RCOPVER            LOAD RETURN CODE                48600002
         B     NULLUCB                  GOTO UPDATE UCB AND EXIT RTN    48700002
*                                                                       49000000
TESTOK   EQU   *                                                        49100000
*                                                                       49300000
         CLC   SPWREPLY(L'OKCN),OKCN    TEST IF REPLY = 'VERIFIED'      49400002
         BE    SETNORM                  IF YES,GOTO EXIT ROUTINE        49500002
         CLC   SPWREPLY(L'VBLANK),VBLANK TEST IF REPLY = 'V'            49600002
         BE    SETNORM                  IF YES,GOTO EXIT ROUTINE        49700002
*                                                                       49800000
         CLC   SPWREPLY(L'RBLANK),RBLANK  TEST IF REPLY = 'R'           49900002
         BE    VRFY2                    IF YES GO RE-VERIFY      S20202 50000002
*                                                                       50100000
         CLC   SPWREPLY(L'CBLANK),CBLANK TEST IF REPLY = 'C'            50200002
         BE    CANCELGO                 IF YES,GOTO CANCEL ROUTINE      50300002
*                                                                       50400000
*                                                                       50500000
*********************************************************************** 50600000
*                                                                       50700000
*   REPLY ERROR 'IEC125I ERROR - REPEAT REPLY'                          50800000
*                                                                       50900000
*********************************************************************** 51000000
*                                                                       51100000
         LA    RWRK2,MSG125             REQUEST ERROR MSG        Y02072 51150002
         BAL   RRET,GETMSG              GO GET THE MESSAGE       Y02072 51200002
         B     MESSAGO                  GO BACK TO WTORX21 ROUTINE DM0Q 51400018
         EJECT                                                          53800002
SETNORM  EQU   *                                                        54400002
*                                                                       54500000
*********************************************************************** 54600000
*                                                                       54700000
*   SET RETURN CODE = X'00' (SUCCESSFUL)                                54800000
*   AND UPDATE UCB WITH NEW IMAGE IN THE UCS BUFFER                     54850002
*                                                                       54900000
*********************************************************************** 55000000
*                                                                       55100000
         LA    RWRK5,RCNORM             LOAD RETURN CODE                55200002
         IC    RWRK1,SPWPARM1           GET UCS OPTION BITS      Y02072 56170002
         LA    RWRK2,X'FF'-(SPWOVLAP+SPWVERIF)                   Y02072 56220002
         NR    RWRK1,RWRK2              RESET TWO FLAGS          Y02072 56270002
         IC    RWRK2,IMAFLAG            GET DEFAULTS             Y02072 56320002
         OR    RWRK1,RWRK2              OR THEM IN               Y02072 56370002
         BAL   RRET,SETUCB              PUT IN UCSOP AND UCSID   Y02072 56420002
*                                                                       56600000
*                                                                       56800000
IMAGDEL  EQU   *                                                        56900002
*                                                                       57000000
*********************************************************************** 57100000
*                                                                       57200000
*   DELETE IMAGE LOADED, RESTORE REGISTERS, AND TEST FOR FCB.           57300002
*                                                                       57700000
*********************************************************************** 57800000
*                                                                       57900000
         DELETE EPLOC=SPWUCSIM          DELETE THE IMAGE LOADED         58300002
*                                                                       58400000
         SR    RWRK6,RWRK6              CLEAR IMAGE ID           Y02072 58402002
         ST    RWRK6,SPWUCS2H                                    Y02072 58402402
*                                                                       58404020
*   RESET REG'S WITH DCB AND DEB ADDRESSES                              58408020
*                                                                       58412020
         CH    RWRK5,ERRCODE            IF RET CODE = X'18'      YM3920 58414002
*                                         CANNOT GO TO NEXT LOAD YM3920 58414402
         BE    FREEMAIN                 YES, DEBCHK MUST HAVE    YM3920 58414802
*                                         FAILED                 YM3920 58415202
         L     RDCB,SPPDCBA             GET DCB ADDR             S20202 58416002
         USING IHADCB,RDCB                                              58418002
         L     RDEB,DCBDEBAD            GET DEB ADDR             S20202 58420020
         USING DEBBASIC,RDEB                                            58422002
         CLI   UCBTBYT4,UCB43211        CK FOR 3211 DCB           M5149 58424002
         BNE   FREEMAIN                 NO GO FREE               S20202 58428020
*                                       MESSAGE/WORKAREA         S20202 58432020
*                                                                       58448020
**********************************************************************  58452020
*                                                                       58456020
*   FCB LOAD REQUIRED-BRANCH TO SETPRT MODULE IGG08103                  58460048
*                                                                       58464020
**********************************************************************  58468020
*                                                                       58472020
         L     R15,ID3                 ADDR. OF MOD. IGG08103  @Z40MSMI 58496048
         BR    R15                     GO TO NEXT MODULE       @Z40MSMI 58498048
*                                                                       58500048
FREEMAIN EQU   *                                                        58600000
*                                                                       58610020
*********************************************************************** 58612002
*                                                                       58614002
*   EXIT TO ENTRY POINT. (1) CLOSE IMAGELIB                             58616002
*                        (2) DELETE MESSAGE CSECT                       58616402
*                        (3) FREEMAIN WORK AREA                         58618002
*                        (4) FREEMAIN BLDL PARAMETER LIST        YM5703 58618102
*                        (5) RESTORE IOB                                58618402
*                        (6) EXIT WITH RETURN CODE IN REG.15            58618802
*                                                                       58619202
*********************************************************************** 58619602
*                                                                       58620002
         MODESET EXTKEY=ZERO            SWITCH TO SVRB KEY       Y02072 58622002
*                                                                       58624002
         L     RWRK1,SPRIDCBA           PICK UP IMAGELIB DCB     Y02072 58626002
         ST    RWRK6,SPRIDCBA           INDIC IMAGELIB CLOSED    YM5703 58628402
*                                                                       58650002
         IMGLIB CLOSE,(RWRK1)           GO DELETE IMAGELIB DCB   Y02072 58660002
*                                                                       58666002
         ST    RWRK6,SPRMSG                                      Y02072 58670002
*                                                                       58672002
         DELETE EP=IGGMSG01             DELETE MSG CSECT         Y02072 58680002
*                                                                       58690002
         ST    RWRK6,SPRIOBSV           INDICATE IOB RESTORED    Y02072 58710102
*                                                                       58710402
         MODESET KEYADDR=SPRKEY,WORKREG=1  RESUME NORMAL KEY     Y02072 58712002
         SPACE                                                          58720002
         MVC   IOBFLAG1(4),SPWFLGSV     RESTORE FLAGS            Y02072 58770002
         MVC   IOBSTART,SPWSTRSV        RESTORE IOB START        Y02072 58820002
*                                                                       58830002
*  ISSUE FREEMAINS FOR SETPRT WORKAREA AND BLDL PARAMETER LIST.  YM5703 58840002
*                                                                       58870002
         FREEMAIN R,LV=SPWLNGTH,A=(RSPW),SP=SPWPOOL              Y02072 59000002
*                                                                       59700000
         SPACE                                                          59750002
         MODESET  EXTKEY=DATAMGT        KEY OF BLDL PARA LIST    YM5703 59800002
         SPACE                                                          59850002
         L     RWRK2,SPRBLDLA           ADDR OF BLDL LIST        YM5703 59860002
         USING SPW5,RWRK2                                      @Z40MSAP 59870048
         ST    RWRK6,SPWWKADR           INDIC WORKAREA FREED     YM5703 59900002
*                                                                       59950002
         FREEMAIN  R,LV=SPW5LNTH,A=(RWRK2),SP=SPW5POOL         @Z40MSAP 60000048
         SPACE                                                          60050002
         MODESET  EXTKEY=SUPR           KEY OF SVRB              YM5703 60060002
         SPACE                                                          60070002
         DROP  RWRK2                                             YM5703 60100002
         ST    RWRK6,SPRBLDLA           INDIC BLDL LIST FREED    YM5703 60150002
         LR    R15,RWRK5                LOAD RETURN CODE                61600002
         L     R14,SPREXIT              GET EXIT PROLOG ADDR     Y02072 61700002
         BR    R14                      AND RETURN TO IT         Y02072 61710002
         EJECT                                                          61712002
         DROP  RDEB,RUCB                                         Y02072 61712102
SETUCB   EQU   *                                                 Y02072 61712502
*********************************************************************** 61712702
*        THIS ROUTINE UPDATES THE UCB                                   61712902
*        TO PERFORM THIS FUNCTION IT MUST VALIDATE THAT:                61713002
*        1. A PROTECTED CHAIN LEADS TO THE UCB                          61713102
*        2. THE UCB IS ALLOCATED TO THE JOB REQUESTING SETPRT           61713302
*        BOTH OF THESE ARE SATISFIED BY DEBCHK, SO LONG AS THERE        61713402
*        IS NO TIME OF CHECK TO TIME OF USE EXPOSURE.                   61713602
*        THAT EXPOSURE IS COVERED BY RUNNING WITH THE LOCAL LOCK.       61713702
*        INPUT: RWRK6 CONTAINS THE UCS ID TO PLACE IN THE UCB           61713802
*               RWRK1 CONTAINS (LOW BYTE) THE UCS OPTIONS TO SET        61714002
*        ADDRESSIBILITY REQUIRED:                                       61714202
*               SVRB EXTENDED SAVE AREA                                 61714302
*        OUTPUT:UCBUCSOP AND UCBUCSID ARE UPDATED (NORMAL)              61714402
*               THE SAVE AREA SPRSAVE IN SVRB IS USED                   61714502
*               IF DEB NOT VALID, DOES NOT RETURN TO SUBROUTINE CALLER, 61714602
*               INSTEAD SETS RETURN CODE AND EXITS                      61714702
*        THIS ROUTINE RETURNS ON REGISTER RRET                          61714902
*        ALL REGISTERS EXCEPT R15 AND R1 (= RWRK2) ARE TRANSPARENT      61715002
*********************************************************************** 61715102
         MODESET EXTKEY=ZERO            CHANGE TO KEY FOR BR ENT Y02072 61715302
         STM   R10,R14,SPRSAVE          SAVE VOLATILE REGS       Y02072 61715502
LOCK     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02072*61715602
               RELATED=(DEB/UCB,UNLOCK) GET THE LOCAL LOCK       Y02072 61715702
         L     R10,CVTPTR               FIND CVT                 Y02072 61715802
         USING CVT,R10                                           Y02072 61715902
         L     R15,CVTEXT2              FIND CVT EXTENSION       Y02072 61716002
         USING CVTXTNT2,R15                                      Y02072 61716502
         L     R15,CVTDEBVR             GET PTR TO DEBCHK        Y02072 61717002
         DROP  R15                                               Y02072 61717502
         USING PSA,0                                             Y02072 61719502
         L     R10,PSATOLD              GET CURRENT TCB ADDR     Y02072 61720202
         L     R14,SPPDCBA              GET DCB ADDRESS          YM5919 61720602
         USING IHADCB,R14               TEMP USING               YM5919 61721002
         L     R1,DCBDEBAD              GET DEB ADDRESS          YM5703 61722202
         DROP  R14                                               YM5919 61722302
         LA    R1,0(R1)                 CLEAR HI-BYTE            YM5703 61722402
         BALR  R14,R15                  CALL DEBCHK              Y02072 61722502
*                                                                       61722902
*  DEBCHK RETURNS ON REGISTER 14 PLUS THE CONTENTS OF REG 15     YM5703 61723302
*    REG 15 : 0 - DEB OK                                         YM5703 61723702
*             4 - DEB INVALID                                    YM5703 61723802
*  REGARDLESS OF DEBCHK RETURN, THE LOCAL LOCK MUST BE RELEASED  YM5703 61724202
*  AS SVC'S CANNOT BE ISSUED WHILE HOLDING THE LOCK.             YM5703 61724602
*                                                                       61724802
         B     DEBOK                    DEB VALID--PTR IN R1     YM5703 61726802
         B     UNLOCK                   INVALID--REL LOCK        YM5703 61728802
DEBOK    EQU   *                                                 Y02072 61730602
         USING DEBDASD-(DEBBASND-DEBBASIC),R1                    Y02072 61731602
         L     RWRK2,DEBUCBAD           FIND UCB                 Y02072 61732602
         DROP  R1                                                Y02072 61733602
         USING SRT,RWRK2                                         Y02072 61734602
         L     RWRK2,UCBXTADR           FIND UCS EXTENSION       Y02072 61735602
         USING UCBUCS,RWRK2                                      Y02072 61736602
         LM    R10,R14,SPRSAVE          RESTORE VOLATILE REGS    Y02072 61737602
         ST    RWRK6,UCBUCSID           UPDATE ID IN UCB         Y02072 61738602
         STC   RWRK1,UCBUCSOP           UPDATE OPTIONS IN UCB    Y02072 61739602
UNLOCK   SETLOCK RELEASE,TYPE=LOCAL,RELATED=(DEB/UCB,LOCK)       Y02072 61740602
         LM    R10,R14,SPRSAVE          RESTORE VOLATILE REGS    Y02072 61741602
         SPACE                                                          61742002
         MODESET KEYADDR=SPRKEY,WORKREG=1  RESUME NORMAL KEY     Y02072 61742602
         SPACE                                                          61743002
         LTR   R15,R15                  WAS DEB VALID            YM5703 61743402
         BZR   RRET                     YES, CONTINUE            YM5703 61743502
*                                                                       61744602
NOTOPEN  DS    0H                                                YM5703 61745702
         LA    RWRK5,RCNOPEN            DCB NOT VALIDLY OPEN     YM5703 61746402
         B     IMAGDEL                  GO DELETE IMAGE          Y02072 61746602
         SPACE 3                                                        61747602
GETMSG   EQU   *                                                 Y02072 61748602
*********************************************************************** 61749602
*        THIS SUBROUTINE FINDS A MESSAGE IN THE MESSAGE CSECT           61750602
*        AND MOVES IT INTO THE SETPRT WORK AREA                         61751602
*        INPUT: RWRK2 CONTAINS AN INDEX OFFSET (MSG NUMBER * 2)         61752602
*               SPRMSG CONTAINS THE ADDRESS OF THE MESSAGE CSECT        61753602
*        ADDRESSIBILITY REQUIRED:                                       61754602
*               SVRB EXTENDED SAVE AREA                                 61755602
*               SETPRT WORK AREA                                        61756602
*        OUTPUT:RWRK2 POINTS TO MESSAGE TEXT IN MSG CSECT               61757602
*               RWRK8 POINTS TO THE MSG ENTRY IN MSG CSECT              61758602
*               SPWMSGTX CONTAINS A COPY OF THE MESSAGE TEXT            61759602
*        THIS ROUTINE RETURNS ON REGISTER RRET                          61760602
*        ALL REGISTERS EXCEPT RWRK2 AND RWRK8 ARE TRANSPARENT           61761602
*********************************************************************** 61762602
         L     RWRK8,SPRMSG             PICK UP MSG CSECT ADDR   Y02072 61763602
         USING MSGINDEX,RWRK8                                    Y02072 61764602
         AH    RWRK8,MSGINDOF(RWRK2)    ADD ENTRY OFFSET         Y02072 61765602
         USING MSGENTRY,RWRK8                                    Y02072 61766602
         SR    RWRK2,RWRK2                                       Y02072 61776602
         IC    RWRK2,MSGOFF             PICK UP TEXT OFFSET      Y02072 61778602
         AR    RWRK2,RWRK8              GET PTR TO TEXT          Y02072 61780602
         USING MSGTXT,RWRK2                                      Y02072 61782602
         MVC   SPWMSGTX,MSGTXT          MOVE IT INTO WORK AREA   Y02072 61783002
         BR    RRET                     RETURN TO CALLER         Y02072 61783102
         DROP  RWRK2,RWRK8                                       Y02072 61783202
         SPACE 3                                                        61785202
FILLFLDS EQU   *                                                 Y02072 61787202
         USING UCBOB,RUCB                                        Y02072 61787602
*********************************************************************** 61788802
*        THIS ROUTINE FILLS IN THE UNIT NAME AND IMAGE ID               61790802
*        IN MESSAGES WHICH HAVE ALREADY BEEN MOVED TO THE WORK AREA     61792802
*        INPUT: RWRK8 POINTS TO THE MESSAGE ENTRY IN MSG CSECT          61793202
*               SPWREPID CONTAINS THE IMAGE ID TO FILL IN               61793602
*        ADDRESSIBILITY REQUIRED:                                       61794002
*               UCB                                                     61794102
*               SETPRT WORK AREA                                        61795202
*        OUTPUT:SPWREPID AND UCBNAME HAVE MEEN MOVED TO THE             61797802
*               APPROPRIATE OFFSETS FROM SPWMSGTX                       61798902
*               RWRK8 IS UNCHANGED FROM INPUT                           61800002
*        THIS ROUTINE RETURNS ON REGISTER RRET                          61830702
*        ALL REGISTERS ARE TRANSPARENT EXCEPT RWRK2                     61832702
*********************************************************************** 61840702
         USING MSGENTRY,RWRK8                                    Y02072 61844702
         SR    RWRK2,RWRK2                                       Y02072 61846702
         IC    RWRK2,MSGOFF1            PICK UP FIRST OFFSET     Y02072 61847102
         LA    RWRK2,SPWMSGTX(RWRK2)    POINT TO VAR IN WORKAREA Y02072 61855902
         MVC   0(L'UCBNAME,RWRK2),UCBNAME  MOVE IN UCBNAME       Y02072 61857902
         SR    RWRK2,RWRK2                                       Y02072 61859902
         IC    RWRK2,MSGOFF2            PICK UP SECOND OFFSET    Y02072 61861902
         LA    RWRK2,SPWMSGTX(RWRK2)    POINT TO VAR IN WORKAREA Y02072 61863902
         MVC   0(L'SPWREPID,RWRK2),SPWREPID  MOVE IN IMAGE ID    Y02072 61864302
         BR    RRET                                              Y02072 61864702
         DROP  RWRK8                                             Y02072 61873502
         SPACE 3                                                        61874502
WTOR     EQU   *                                                 Y02072 61874602
*********************************************************************** 61874902
         WTOR  MF=(E,SPWRPLYA)          ISSUE WTOR IN PROB STATE Y02072 61875502
         ST    R1,SPWMSGID              SAVE MSG ID FOR DOM    @ZA25004 61875848
         OI    SPWMSGID,X'80'           SET HIGH ORDER BIT     @ZA25004 61876148
         BR    R14                      RETURN TO SYNCH          Y02072 61876502
*********************************************************************** 61876902
         EJECT                                                          61877302
WRITEGO  EQU   *                                                        61878502
*                                                                       61880502
**********************************************************************< 61880902
*                                                                       61881302
*   EXCP/WAIT.  NO I/O ERROR - CONTINUE THE PROCESS                     61881702
*               ANY I/O ERROR - EXIT WITH RETURN CODE = X'10'           61882102
*                                                                       61882202
*********************************************************************** 61882302
*                                                                       61905802
         OI    IOBFLAG1,IOBSPSVC        IND NO SAM APPENDAGE    ZA02199 61907800
*                                       PROCESSING REQUIRED     ZA02199 61909803
         EXCP  IOBSTDRD                 EXCP                            61915802
*                                                                       61925802
         L     R1,IOBECBPT              LOAD ECB ADDR                   61927802
         WAIT  ECB=(1)                  WAIT                            61928202
         NI    IOBFLAG1,X'FF'-IOBSPSVC  RESET IOB FLAG          ZA02199 61928303
*                                                                       61928602
*   TEST COMPLETION CODE                                                61929002
*                                                                       61929402
         L     RWRK2,IOBECBPT           LOAD ECB ADDR                   61937202
         USING ECB,RWRK2                                                61939202
         TM    ECBCC,ECBNORM            TEST IF I/O COMPLETE            61941202
         DROP  RWRK2                                                    61943202
         BOR   RRET                     RETURN FROM              S20202 61943602
*                                       EXCP,WAIT,COMP TES       S20202 61944002
*                                                                       61944402
*********************************************************************   61944802
*                                                                       61944902
*   CHECK IF THE DEVICE IS A 3211 PRINTER AND THE ERROR IS RETRYABLE    61945002
*   -NO GO SET RETURN CODE FOR PERM I/O ERROR DURING UCS VERIFICATION   61945102
*   -YES GO REISSUE PRINT LINE ONCE. IF ERROR PERSIST ISSUE SKIP TO     61952902
*   CHANNEL 0 AND SET RETURN CODE FOR PERM I/O ERROR UCS VERIFICATION   61954902
*                                                                       61956902
*********************************************************************** 61958902
*                                                                       61959302
         CLI   UCBTBYT4,UCB43211        CK FOR 3211 DCB           M5149 61959702
         BNE   GOSTRTCD                 NO GO SET RETURN CODE    S20202 61960102
         TM    IOBSENS1,IOBS1B0         TEST FOR COMMAND RETRY   S20202 61960502
         BNO   GOSTRTCD                 NO GO SET RETURN CODE    S20202 61960602
         LTR   RWRK9,RWRK9              TEST IF ERROR HAS BEEN   S20202 61960702
*                                       RETRIED ONCE                    61960802
         BL    ISSUSKP0                 YES GO RESET 3811        S20202 61968602
         LA    RWRK1,1                  GET RETRY FLG            S20202 61970602
         SLL   RWRK1,31                 SHIFT FLG TO BIT 0       S20202 61972602
         OR    RWRK9,RWRK1              SET FLAG ON              S20202 61974602
         B     WRITEGO                  GO EXCP TO CCW THAT      S20202 61975002
*                                       FAILED                   S20202 61975402
*                                                                       61975802
*   FORM SKIP TO CHANNEL 0 CCW TO RESET CONTROL UNIT                    61976202
*                                                                       61976302
ISSUSKP0 EQU   *                                                 S20202 61976402
*                                                                       61976502
         L     RWRK2,IOBSTART           GET ADDR OF CHANNEL PGM  Y02072 61997002
         MVC   0(L'SKP0CCW,RWRK2),SKP0CCW  REPLACE CCW           Y02072 62007002
         BAL   RRET,WRITEGO             GO EXCP,WAIT AND TST     S20202 62017002
*                                       COMP                     S20202 62017402
*                                                                       62017802
GOSTRTCD EQU   *                                                 S20202 62017902
*                                                                       62024702
*********************************************************************** 62026702
*                                                                       62028702
*   WHEN THERE IS AN PERMANENT I/O ERROR DURING VERIFICATION,           62030702
*   SET UCB TO INDICATE THE IMAGE IN THE BUFFER IS NOT USABLE           62031102
*   GIVE CONTROL BACK TO ENTRY POINT. RETURN CODE = X'10' IN REG.15     62031502
*   IF THE I/O ERROR PERSITS,RUN C.E. DIAGNOSTICS FOR THE PRINTER       62031602
*                                                                       62038402
*********************************************************************** 62040402
*                                                                       62042402
         LA    RWRK5,RCVERIO            LOAD RETURN CODE                62044402
         B     NULLUCB                  GOTO UPDATE UCB AND EXIT RTN    62044802
         EJECT                                                          62045402
*                                                                       62052202
*********************************************************************** 62059002
*                                                                       62079502
*   CONSTANTS                                                           62100000
*                                                                       62200000
*********************************************************************** 62300000
*                                                                       62400000
*   REPLY CONSTANT                                                      63400000
*                                                                       63500000
ERRCODE  DC    H'24'                    ERROR RETURN CODE        YM3920 63550002
RETRYCN  DC    C'RETRY'                 REPLY='RETRY'                   63600000
CANCELCN DC    C'CANCEL'                REPLY='CANCEL'                  63700000
OKCN     DC    C'VERIFIED'              REPLY='VERIFIED'                63800000
CBLANK   DC    C'C '                    REPLY = 'C'                     63900000
RBLANK   DC    C'R '                    REPLY = 'R'                     64000000
VBLANK   DC    C'V '                    REPLY = 'V'                     64100000
BLANKS   DC    CL16' '                 BLANKS                           64200002
LOWER    EQU   BLANKS                  MASK TO ALLOW LOWER CASE REPLY   64250002
*                                                                       64300000
UCSCONST DC    C'UCS1'                  UCS IMAGE ID FOR 1403           64400000
*                                                                       64430020
*   CCW'S                                                               64460020
*                                                                       64490020
SKP0CCW  CCW   SPWSKIP0,0,SPWSILI,1     SKIP TO 0 CCW            S20202 64520002
*                                                                       64550020
*   BRANCH TABLE                                                        64970048
*                                                                       65000020
ID3      DC    V(IGG08103)              FIRST FCB LOAD         @Z40MSMI 65200048
*                                                                       65250002
PATCH    DC    0H'0',52X'00'            PATCH AREA               Y02072 65250402
END      EQU   *                        END OF MODULE            Y02072 65262002
         EJECT                                                          65300002
*                                                                       65350002
*        THIS DSECT IS USED TO MOVE THROUGH THE IMAGE PASSED FROM       65400002
*        IGGO8101                                                       65450002
*                                                                       65500002
IMAGE    DSECT                                                          65550002
IMAFLAG  DS    B                        FLAG BYTE                       65600002
IMAFLDEF EQU   X'80'                    THIS IS A DEFAULT IMAGE         65650002
IMANOLN  DS    AL1                      NUMBER OF LINES IN THIS IMAGE   65700002
IMALEN1  DS    AL1                      LENGTH OF FIRST LINE            65750002
IMA3211L EQU   512                      LENGTH OF 3211 UCS BUFFER       65800002
IMA1403L EQU   240                      LEN OF 1403 UCS BUFFER   Y02072 65802002
         TITLE 'IGG08102 - SETPRT - SYSTEM DSECTS'                      65842002
         CVT   DSECT=YES                                         Y02072 65844002
         EJECT                                                          65846002
         DCBD  DSORG=PS                                                 68800000
         EJECT                                                          70100002
         IEZDEB                                                         70150002
         EJECT                                                          70300002
         IHAECB                                                         70350002
         EJECT                                                          70352002
         IEZIOB                                                         70354002
         EJECT                                                          70404002
         IGGMSG                                                  Y02072 70454002
         EJECT                                                          70464002
         IHAPSA                                                  Y02072 70474002
         EJECT                                                          70500002
         IHASPP                                                         70550002
         EJECT                                                          70560002
         IGGSPW                                                         70570002
         EJECT                                                          70600002
SRT      DSECT                                                          70650002
*                                                                       70700002
         IEFUCBOB                                                       70750002
         END                                                            75000000
./  ADD  SSI=73640182,NAME=IGG08103
8103     TITLE 'IGG08103 - GET FCB IMAGE- ANAL. REPLIES'         M0191  00100010
IGG08103 CSECT                                                   M0191  00102021
* /*  START OF SPECIFICATIONS****                             @Z40MSAP  00102110
*01*  PROCESSOR = ASSEMXF:                                              00102210
**** END OF SPECIFICATIONS **                                @Z40MSAP*/ 00102310
*                                                                       00102402
* MODULE-NAME = IGG08103                                                00152402
*                                                                       00162402
* DESCRIPTIVE-NAME = LOAD FCB                                           00172402
*                                                                       00182402
* COPYRIGHT = NONE                                                      00192402
*                                                                       00194402
* STATUS = VS2-2, LEVEL 0                                               00196402
*                                                                       00200020
* FUNCTION = USE BLDL MACRO TO LOCATE FCB IMAGE IN SYS1.IMAGELIB        00300002
*            USE LOAD MACRO TO LOAD THE FCB IMAGE INTO CPU STORAGE      00400002
*            FROM SYS1.IMAGELIB                                         00500020
*            WHEN THE FCB IMAGE IS NOT FOUND, ISSUE A WTOR MESSAGE      00600002
*            IEC127D REQUESTING THE OPERATOR TO SPECIFY AN ALTERNATE    00700020
*            FCB IMAGE                                                  00800020
*            ANALYZE OPERATOR REPLYS AND ISSUE WTOR MESSAGE IEC125I     00900002
*            IF IT IS INVALID                                           00950002
*                                                                       01100020
* NOTES =                                                               01150002
*    DEPENDENCIES = BLANK AND COMMA ARE USED--CORRECTABLE BY            01200002
*        REASSEMBLY.  THE FOLLOWING CHARACTER STRINGS ARE USED IN       01250002
*        TESTING OPERATOR REPLIES:                                      01300002
*        'A', 'V', 'U', 'C', 'ALIGN', 'VERIFY', 'CANCEL'                01350002
*        THESE STRINGS ARE CONSIDERED TO BE OPERATING SYSTEM KEYWORDS   01400002
*        RATHER THAN LANGUAGE DEPENDENT PHRASES.                        01450002
*                                                                       01500002
*        BLANKS ARE OR'ED TO ALL REPLIES TO CONVERT THEM TO UPPER CASE  01550002
*                                                                       01600002
*    RESTRICTIONS = NONE                                                01650002
*                                                                       01700002
*    REGISTER-CONVENTIONS = ALL REGISTER NAMES BEGIN WITH R             01750002
*        SEE EQUATES IMMEDIATELY FOLLOWING PROLOG                       01800002
*                                                                       01810002
*    PATCH-LABEL = PATCH, AN AREA ASSEMBLED AS BINARY 0                 01820002
*                                                                       01830002
* MODULE-TYPE =                                                         01840002
*    PROCESSOR = OS/VS ASSEMBLER                                        01842002
*                                                                       01844002
*    MODULE-SIZE = 690 DECIMAL BYTES                                    01846002
*                                                                       01848002
*    ATTRIBUTES = REENTRANT, ENABLED, PRIVELEGED,                       01848402
*        EXECUTES IN SETPRT INVOKER KEY                                 01848802
*        CODE AT ENTRY POINT WTOR IS NON-PRIVELEGED                     01849202
*                                                                       01849602
* ENTRY POINT = IGG08103                                                01849702
*    PURPOSE = SEE FUNCTION                                             01849802
*                                                                       01849902
*    LINKAGE = BRANCH FROM IGC0008A,IGG08101, OR IGG08102               01866610
*                                                                       01876602
*    INPUT =                                                            02043202
*        REGISTER 4(RSPW) = WORK AREA ADDRESS                           02043602
*        REGISTER 5(RPAR) = PARAMETER LIST ADDR                         02044002
*        REGISTER 6(RSVR) = SVRB EXTENDED SAVE AREA ADDRESS             02044402
*        REGISTER 12(RWK5) = RETURN CODE FOR USER FROM UCS LOADS        02045202
*                                                                       02053002
*    OUTPUT =                                                           02103002
*      REGISTERS = TO INVOKER                                           02153002
*        R0 = UNDEFINED                                                 02203002
*        R1 = UNDEFINED                                                 02253002
*        R2-R14 = UNCHANGED                                             02303002
*        R15 = RETURN CODE (SEE EXIT-ERROR)                             02353002
*                                                                       02363002
*      REGISTERS = TO IGG08104                                          02373002
*        R0-R3 = UNDEFINED                                              02383002
*        R4(RSPW) = AS FOR INPUT                                        02393002
*        R5/BYTE 0(RPAR) = UCS RETURN CODE                              02393102
*        R5/BYTES 1-3(RPAR) = PARAMETER LIST ADDRESS                    02393402
*        R6(RSVR) = AS FOR INPUT                                        02393802
*        R7 = UNDEFINED                                                 02395002
*        R8(RWK4) = ADDR OF IMAGE TO BE LOADED                          02397002
*        R9(RIOB) = AS FOR INPUT                                        02399002
*        R10-R14 = UNDEFINED                                            02399410
*        R15 = RESERVED FOR BRANCH INTERFACE                            02399810
*                                                                       02399902
*      MESSAGES = RETRIEVED FROM IGGMSG01                               02442802
*          'IEC127D XXX,YYYY FCB IMAGE NOT FOUND'                       02444402
*          'IEC125I ERROR - REPEAT REPLY'                               02460002
*                                                                       02500020
* EXITS-NORMAL = BRANCH TO IGG08104 TO LOAD THE FCB                     02550010
*                                                                       03300020
* EXITS-ERROR = WHEN OPERATOR CANCELS, RETURN CONTROL TO CALLER         03400002
*                WITH RETURN CODE = 04                                  03500002
*               WHEN PERMANENT I/O ERRORS OCCUR DURING BLDL,            03600002
*                RETURN CONTROL TO CALLER WITH RETURN CODE = 08.        03700002
*                                                                       03710002
* ENTRY-POINT = WTOR (INTERNAL ENTRY)                                   03750002
*    PURPOSE = ISSUE WTOR SVC IN PROBLEM STATE TO AVOID INTEGRITY       03800002
*        EXPOSURE FROM NON-PROTECTED MESSAGE                            03850002
*                                                                       03860002
*    LINKAGE = SYNCH FROM WITHIN THIS MODULE                            03870002
*                                                                       03880002
*    INPUT =                                                            03890002
*        REGISTER 4(RSPW) = WORK AREA ADDRESS                           03892002
*        REGISTER 14(R14) = RETURN ADDRESS                              03894002
*                                                                       03896002
*    OUTPUT =                                                           03898002
*      REGISTERS = TO INVOKER                                           03898402
*        R0 = UNDEFINED                                                 03898802
*        R1 = UNDEFINED                                                 03899202
*        R2-R14 = UNCHANGED                                             03899602
*        R15 = UNDEFINED                                                03899702
*                                                                       03899802
* EXTERNAL REFERENCES =                                                 03899902
*   ROUTINES = BLDL    (SVC 18)                                         03933202
*              DELETE  (SVC  9)                                         03943202
*              FREEMAIN(SVC 10)                                         03953202
*              IGG08104(SETPRT LOAD 5)                                  03965202
*              IMGLIB  (SVC105)                                         03965602
*              LOAD    (SVC  8)                                         03966002
*              SYNCH   (SVC 12)                                         03966402
*              WAIT    (SVC  1)                                         03966502
*              WTOR    (SVC 35)                                         03966602
*                                                                       03987702
*   DATA-AREAS = SPP -- SETPRT PARAMETER LIST                           03988102
*              SPW5 -- BLDL PARAMETER LIST                     @Z40MSAP 03988210
*              SPW -- SETPRT WORK AREA                                  03988502
*              SPRBXSV -- RB EXTENDED SAVE AREA                         03988602
*              FCBIM -- FCB IMAGE                                       03988702
*              MSG -- MESSAGE CSECT                                     03988802
*   CONTROL-BLOCKS =                                                    03988902
*              DCB -- DATA CONTROL BLOCK                                03992502
*              DEB -- DATA EXTENT BLOCK                                 03994502
*              ECB -- EVENT CONTROL BLOCK                               03994902
*              EXLST -- DCB EXIT LIST                                   03995002
*              IOB -- INPUT/OUTPUT BLOCK                                03995302
*              UCB -- UNIT CONTROL BLOCK                                03995702
*                                                                       03996302
* MACROS = BLDL,DELETE,FREEMAIN,IMGLIB,LOAD,SYNCH,WAIT,WTOR,            04046310
*          IEFUCBOB, IEZDEB, IEZIOB, IGGMSG IGGSPW,                     04250002
*          IHADCB, IHAEXLST, IHAFCBIM, IHASPP,                          04250402
*                                                                       04252402
* CHANGE ACTIVITY = AS FOLLOWS                                          04260402
*                                                                       04270402
* NOTE = THIS MODULE WAS BROUGHT UP TO STANDARDS FOR VS2-2              04280402
*        WHICH CAUSED ALL PREVIOUS RELEASE SEQUENCE NUMBER DELETIONS TO 04290402
*        BECOME INVALID.                                                04292402
*                                                                       04294402
*        RELEASE 21 DELETIONS                                           04550402
*THE FOLLOWING PTMS WERE FIXED IN THIS RELEASE = 0151, 0084, 0191, 1759 04600402
*THE FOLLOWING APARS WERE FIXED IN THIS RELEASE - 52346, 50699          04650402
*THE FOLLOWING DEVELOPMENT CODE WAS FOR 2245 SUPPORT - S21092           04700402
*                                                                       04750402
*        VS2 RELEASE 2 DELETIONS                                        04800402
*THE FOLLOWING DEVELOPMENT CODE WAS FOR VS2-2 - Y02072                  04850402
*                                                                YM3920 04900402
*                                                                YM5703 04950402
*                                                                       04950910
*        VS2 RELEASE 4 DELETIONS                                        04951410
*                                                              @Z40MSMI 04951910
*        VS2 037 CHANGES                                                04960410
*C147300,147400                                                @ZA20901 04970410
*A132910-132950,158500-164500                                  @ZA20901 04980410
*C147330-147340                                                @ZA25004 04985448
*A322500,465630-465660                                         @ZA25004 04990448
*C147300,147340,161500,162500,163000                           @ZA28905 04992448
*                                                                       04995448
*       VS2 RELEASE 4.0 CHANGES/DELETIONS                               05000410
*ASSEMBLED WITH NEW VERSION OF BLDL MACRO                       ZA02250 05050410
*                                                                       05100410
         EJECT                                                          05150002
*********************************************************************** 05200002
*                                                                       05250002
*   REGISTER CONVENTIONS USED THROUGH OUT ALL SETPRT MODULES            05300002
*                                                                       05350002
*********************************************************************** 05400002
R0       EQU   0                        PARAMETER REGISTER              05800002
RWK1     EQU   R0                       WORK REGISTER                   05850002
R1       EQU   1                        PARAMETER REGISTER              05900002
RWK2     EQU   R1                       WORK REGISTER                   05950002
RDCB     EQU   2                        DCB REGOSTER                    06000002
RBASE    EQU   3                        BASE REGISTER                   06100002
RCORE    EQU   4                        ADDRESS OF MESSAGE/WORK AREA    06200020
RPAR     EQU   5                        PARAMETER LIST ADDRESS          06300020
RSVR     EQU   6                        SVRB EXTENDED SAVE AREA         06400002
RRET     EQU   7                        SUBROUTINE RETURN               06500002
RWK4     EQU   8                        WORK REGISTER                   06600002
RIOB     EQU   9                        IOB REGISTER                    06700002
RUCB     EQU   10                       UCB REGISTER                    06800002
RDEB     EQU   11                       DEB REGISTER                    06900002
RBLDL    EQU   RDEB                     BLDL PARAMETER LIST      YM5703 06950002
RWK5     EQU   12                       WORK REGISTER                   07000002
RWK6     EQU   13                       WORK REGISTER                   07100002
R14      EQU   14                       PARAMETER REGISTER              07200002
RWK7     EQU   R14                      WORK REGISTER                   07250002
R15      EQU   15                       PARAMETER REGISTER              07300002
RWK8     EQU   R15                      WORK REGISTER                   07350002
         EJECT                                                          07400002
*********************************************************************** 07450002
*              RETURN CODES                                             07500002
*                                                                       07800020
NOERR    EQU   X'00'                    RETURN CODE FOR SUCCESSFUL      09500002
*                                         COMPLETION                    09550002
NOTINCOR EQU   X'04'                    RETURN CODE FOR FCB IMAGE NOT   09600002
*                                         FOUND                         09650002
PERMIOER EQU   X'08'                    RETURN CODE FOR PERM I/O ERROR  09700002
*                                                                       09750002
*********************************************************************** 09800002
*              MESSAGE NUMBERS IN IGGMSG01                              09850002
*        ALL MESSAGE NUMBERS HAVE BEEN DOUBLED IN THESE EQUATES         09900002
*        TO PROVIDE OFFSETS INTO THE MESSAGE CSECT.                     09950002
*        THIS IS DEPENDENT ON L'MSGINDOF BEING 2.                       10000002
*                                                                       10050002
MSG127   EQU   11*2                     IEC127D                  Y02072 10100002
MSG125   EQU   8*2                      IEC125A                  Y02072 10150002
*                                                                       10200002
*********************************************************************** 10250002
*              OTHER EQUATES                                            10300002
*                                                                       10350002
BLANK    EQU   X'40'                    CONSTANT=' '                    10500020
COMMA    EQU   C','                     CONSTANT=','                    10600020
PRT2245  EQU   X'0B'                    MASK FOR 2245 PRINTER    S21092 13206021
F2245ID  EQU   C'K'                     CNST FOR 2245 ID'S        M0191 13212002
ERRCODE  EQU   4                        FOR TESTING RETURN CODE FROM    13280002
*                                       BLDL                            13290010
NOFCBLD  EQU   X'40'                    FCB NOT TO BE LOADED   @ZA20901 13291010
ALIGNMSK EQU   X'01'                    ALIGN FCB              @ZA20901 13292010
VERFYMSK EQU   X'80'                    VERIFY FCB             @ZA20901 13293010
FCBOFSET EQU   X'08'                    OFFSET TO FCBID IN UCB @ZA20901 13294010
RTNCD00  EQU   X'00'                    RETUN CODE OF X'00'    @ZA20901 13295010
         EJECT                                                          13300002
*                                                                       13500020
* INITIALIZE REGISTERS                                                  13600002
*                                                                       13900020
         USING SPRBXSV,RSVR             LOADED ON ENTRY          Y02072 13950002
         BALR  RBASE,0                  INIT BASE REG                   14000002
         USING FCBFN000,RBASE                                           14100020
FCBFN000 EQU   *                                                        14700020
         SPACE                                                          14702002
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 14710002
         DC    C'IGG08103'              MODULE NAME              Y02072 14720002
         DC    C'@ZA28905'              LAST SHIP CODE         @ZA28905 14730048
         DC    C'12/21/77'              LAST DATE MODIFIED     @ZA28905 14734048
BEGIN    DS    0H                                                Y02072 14742002
         SPACE                                                          14744002
         USING SPPARM,RPAR                                              14750002
         L     RDCB,SPPDCBA             LOAD USER DCB ADDRESS           14900002
         USING IHADCB,RDCB                                              14950002
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS                15000020
         USING DEBBASIC,RDEB                                            15050002
         L     RUCB,DEBSUCBA            LOAD UCB ADDRESS                15100002
         DROP  RDEB                                                     15110002
         L     RBLDL,SPRBLDLA           GET ADDR OF BLDL LIST    YM5703 15120002
         USING SPW5,RBLDL                                      @Z40MSAP 15130010
         USING UCBOB,RUCB                                               15150002
         USING SPW,RCORE                                                15160002
         L     RWK8,UCBXTADR            GET UCB EXTEN ADDR       Y02072 15170002
         USING UCBUCS,RWK8                                       Y02072 15180002
         MVC   SPWFCB2H,UCBFCBID        ASSUME USER DID NOT SPEC Y02072 15182002
*                                         AN FCB IMAGE           Y02072 15184002
         MVI   SPWFLG1,0                NO OPTIONS IF USER DID   Y02072 15186002
*                                         NOT SPEC IMAGE         Y02072 15188002
         CLI   SPPFCB,0                 DID USER SPEC AN IMAGE   Y02072 15190002
         BE    FCBFN001                 NO, USE CURRENT IMAGE    Y02072 15200002
         MVC   SPWFCB2H,SPPFCB          MOVE FCB IMAGE TO WORKA  Y02072 15210002
         MVC   SPWFLG1,SPPVERAL         MOVE FCB OPT BITS TO WORKA      15300002
FCBFN001 EQU   *                                                 Y02072 15350002
*                                                                       15400020
* SAVE RETURN CODE FOR EXIT ROUTINE                                     15500002
*                                                                       15600020
         LA    RPAR,0(RPAR)             CLEAR 0 BYTE                    15650002
         SLL   RWK5,24                  SHIFT RETURN CODE TO 0 BYTE     15700002
         OR    RPAR,RWK5                SAVE UCS RTN CODE IN PARM REG   15800002
         TM    UCBFCBOP,X'01'           PARITY ERROR ON FCB ?  @ZA20901 15850010
         BO    FCBFN005                 YES-RELOAD FCB IMAGE   @ZA20901 15900010
         CLC   SPWFCB2H,FCBOFSET(RWK8)  SPECIFIED FCB = TO FCB @ZA20901 15950010
*                                       ID IN UCB?             @ZA20901 16000010
         BNE   FCBFN005                 NO- GO LOAD FCB IMAGE  @ZA20901 16050010
         OI    SPWFLG1,NOFCBLD          SET NO LOAD FCB IMAGE  @ZA28905 16150048
         TM    SPWFLG1,VERFYMSK         VERIFY FCB ?           @ZA28905 16180048
         BO    FCBFN005                 YES-LOAD FCB TO VERIFY @ZA20901 16210048
         TM    SPWFLG1,ALIGNMSK         ALIGN FCB ?            @ZA28905 16240048
         BO    FCBFN050                 YES-EXIT TO NEXT MODUL @ZA20901 16350010
         LA    RWK5,RTNCD00             NO-SET RET CODE X'00'  @ZA20901 16400010
         B     FCBFN150                 RETURN TO PROB PROGRAM @ZA20901 16450010
*                                                                       17700020
* CORE TRANSFER ROUTINE                                                 17800002
* CHECK IF THE FCB IMAGE TO BE LOADED IS SPECIFIED IN THE DCBEXLST      17900002
* IF YES, LOAD THE FCB WITH THE IMAGE SPECIFIED BY THE USER'S DCB       18000002
* IF NO, GO TO BLDL ROUTINE TO LOCATE FCB IMAGE IN SYS1.IMAGELIB        18100002
*                                                                       18400020
FCBFN005 EQU   *                                                        18500002
         TM    DCBMACF1,DCBMRECP        IS THIS AN EXCP DCB      YM3920 18550002
         BZ    FCBFN007                 NO, DCB HAS FOUND EXTN   YM3920 18600002
         TM    DCBMACF1,DCBMRFE         IS FOUNDATION EXTN PRES  YM3920 18650002
         BZ    FCBFN030                 NO, BYPASS LOOKING FOR   YM3920 18660002
*                                         EXIT LIST              YM3920 18670002
FCBFN007 EQU   *                                                 YM3920 18680002
         L     RWK4,DCBEXLST            GET ADDRESS OF DCB EXIT LIST    18700002
         LA    RWK4,0(RWK4)             CLEAR RECFM FROM BYTE 0         18800002
         LTR   RWK4,RWK4                TEST IF DCBEXLST SPECIFIED      18900002
         BZ    FCBFN030                 NO GO TO BLDL ROUTINE           19000020
*                                                                       19100020
* FIND FCB IMAGE ADDRESS IN DCB EXIT LIST                               19200002
*                                                                       19300020
FCBFN010 EQU   *                                                        19400020
         USING EXLST,RWK4                                               19450002
         CLI   EXLCODES,EXLFCBIM        CK FOR ENTRY WITH FCB IM ADDR   19600002
         BE    FCBFN020                 YES GO CK IF FCB ID'S EQUAL     19700020
         CLI   EXLCODES,EXLLASTE+EXLFCBIM   TST IF LAST ENTRY IN EXLST  19730002
*                                              IS AND FCB IMAGE         19760002
         BE    FCBFN020                 YES GO CK FCB ID'S              19790020
FCBFN015 EQU   *                                                        19850002
         TM    EXLCODES,EXLLASTE        TEST FOR END OF EXLST           19910002
         BO    FCBFN030                 YES GO TO BLDL RTN              19940020
         LA    RWK4,EXLLENTH(RWK4)      INCREMENT POINTER TO NEXT ENTRY 20500002
         B     FCBFN010                 GO CK IF THIS ENTRY FCB IM ADDR 20600020
*                                                                       20700020
* FCB IMAGE SPECIFIED IN DCBEXLST -CK IF IT IS IMAGE TO BE LOADED       20800002
*                                                                       20900020
FCBFN020 EQU   *                                                        21000020
         L     RWK2,EXLENTRA            GET ADDR OF FCB FROM EXLST      21200002
         USING FCBIMAGE,RWK2                                            21250002
         LA    RWK2,0(RWK2)             CLEAR 0 BYTE                    21300002
         CLC   SPWFCB2H,FCBIMGID        TST IF FCB ID'S EQUAL           21400002
         BNE   FCBFN015                 NO CONTINUE SEARCHING EXITLST   21500020
         LA    RWK4,FCBIMBEG            GET BEGINNING ADDR OF FCB       21560002
         B     FCBFN050                 GO TO BRANCH TO NEXT EXECUTOR   21700010
         DROP  RWK2                                                     21750002
*                                                                       22000020
* BLDL ROUTINE TO LOCATE FCB IMAGE IN SYS1.IMAGELIB                     22100002
*                                                                       22200020
FCBFN030 EQU   *                                                        22500020
         L     RWK2,SPWFCB2H            GET FCB ID IN USER KEY   Y02072 22510002
         SPACE                                                          22550002
         MODESET  EXTKEY=DATAMGT                                 YM5703 22600002
         SPACE                                                          22650002
         MVC   SPWBLDLC,BLDLCNST        BLDLIST TO WORK AREA            22700002
         MVC   SPWFCBMB,FCBCONST        MOVE PREFIC FOR FCBID           22800002
         ST    RWK2,SPWBLFCB            FCB ID TO BLDL LIST      Y02072 22850002
         CLI   UCBTBYT4,PRT2245         CHECK FOR 2245 PRINTER   S21092 22920002
         BNE   FCBFN035                 IF NOT 2245 SKIP NEXT    S21092 22940002
*                                         INSTR                  S21092 22960002
         MVI   SPWFCB2,F2245ID          MOVE 'K' INTO 4TH BYTE   M0191  22980002
*                                          OF IMAGE ID (FCBK)    M0191  23090002
FCBFN035 EQU   *                                                 S21092 23420021
         L     R1,SPRIDCBA              GET SYS1.IMAGELIB DCB ADDRESS   23660002
         BLDL  (1),SPWBLDLC             BLDL TO FIND FCB IMAGE          23800002
         SPACE                                                          23850002
         MODESET  KEYADDR=SPRKEY,WORKREG=14                      YM5703 23860002
         SPACE                                                          23870002
*                                                                       23900020
* TEST RETURN CODE FROM BLDL                                            24000002
*  -X'00' - FOUND                                                       24100002
*  -X'04' - NOT FOUND                                                   24200002
*  -X'08' - PERM I/O ERROR                                              24300002
*                                                                       24400020
         LA    RWK7,ERRCODE             SET REG TO TEST RETURN CODE     24500002
         CLR   R15,RWK7                 TEST RETURN CODE FROM BLDL      24600002
         BL    FCBFN040                 FCB IMAGE FOUND-GO LOAD FCB IM  24700020
         BE    FCBFN055                 FCB IMG NOT FOUND GO ISSUE WTOR 24800002
*                                                                       25200020
* PERMANENT I/O ERROR DURING BLDL - RETURN TO PROBLEM PROG WITH         25300002
* RETURN CODE X'08' IN BITS 16-23 OF REG 15.                            25400002
* IF I/O ERROR PERSIST, RUN C.E. DIAGNOSTICS FOR SYSTEM RESIDENT DASD   25500002
*                                                                       25600020
         LA    RWK5,PERMIOER            SET RETURN CODE =X'08'          25900002
         B     FCBFN150                 GO TO FREE MESSAGE/WORK AREA    26000020
*                                                                       26300020
* WHEN FCB IMAGE IS FOUND IN SYS1.IMAGELIB LOAD FCB IMAGE               26400002
*                                                                       26700020
FCBFN040 EQU   *                                                        26800020
         L     RWK6,SPWBLFCB            SAVE FCB IMGID                  27000002
         MVC   SPWFCBIM,SPWFCBMB        MOVE FCB IMGID                  27100002
         L     R1,SPRIDCBA              GET ADDR OF SYS1.IMAGELIB DCB   27300002
         SPACE                                                          27350002
         MODESET  EXTKEY=DATAMGT                                 YM5703 27360002
*                                                                       27400020
         LOAD  DE=SPWFCBMB,DCB=(1)      LOAD FCB FROM SYS1.IMAGELIB     27500002
         SPACE                                                          27550002
         MODESET  KEYADDR=SPRKEY,WORKREG=8                       YM5703 27560002
*                                                                       27600020
         OI    SPWFLG5,SPWFCBDE         INDIC TO 8104 THAT IMAGE Y02072 27650002
*                                         MUST BE DELETED        Y02072 27660002
         LR    RWK4,R0                  GET ADDR OF FCB LOADED          27700002
*                                                                       28000020
* BRANCH ROUTINE                                                        28100010
*                                                                       28400020
FCBFN050 EQU   *                                                        28500020
         L     R15,ID4                  ADDRESS OF 0GG08104    @Z40MSMI 29200010
         BR    R15                      BRANCH TO NEXT MODULE  @Z40MSMI 29250010
*                                                                       29500020
* WTOR 'IEC127D XXX,YYYY FCB IMAGE NOT FOUND' REQUEST OPERATOR          29600002
* TO SPECIFY AN ALTERNATE FCB IMAGE OR CANCEL ATTEMPT TO LOAD FCB       29700002
*                                                                       30000020
FCBFN055 EQU   *                                                        30030020
         MVC   SPWREPID,SPWBLFCB        SAVE FCB ID FOR MESSAGE         30100002
         LA    RWK2,MSG127              INDICATE MSG WANTED      Y02072 30200002
         BAL   RRET,GETMSG              GO GET MESSAGE           Y02072 30250002
         BAL   RRET,FILLFLDS            FILL IN ID AND UNIT      Y02072 30300002
*                                                                       30600020
* CLEAR REPLY AREA AND FCB ID SAVE AREA / ISSUE WTOR AND WAIT           30700002
*                                                                       30800020
FCBFN060 EQU   *                                                        30900020
         MVC   SPWREPLY,CLEARFLD        CLEAR REPLY AREA                31200002
         MVC   SPWREPID,CLEARFLD        CLEAR REPLY NAME                31400002
         MVI   SPWRPECB,0               RESET REPLY ECB                 31500002
         TM    SPRKEY,SPRUSKEY          IF CALLED AS SYS FUNCT   Y02072 31550002
         BZ    FCBFN065                 DO NOT SYNCH TO WTOR     Y02072 31600002
         SYNCH WTOR                     ISSUE WTOR IN PROB STATE Y02072 31650002
         B     WAIT                     THEN WAIT FOR COMPLETION Y02072 31700002
FCBFN065 EQU   *                        SYS WTOR                 Y02072 31750002
         BAL   R14,WTOR                 ISSUE WTOR IN SUP STATE  Y02072 31800002
WAIT     EQU   *                                                 Y02072 31850002
         WAIT  ECB=SPWRPECB,LONG=YES    ISSUE WAIT FOR REPLY     Y02072 32200002
         XC    SPWMSGID(4),SPWMSGID     CLEAR MSG ID           @ZA25004 32250048
*                                                                       32500020
* TEST OPERATOR REPLY FOR ONE OF THE FOLLOWING                          32600002
* (1) 'U'- USE CURRENT FCB IMAGE - RETURN PROB PROG- RETURN CODE=00     32700002
* (2) 'C'- CANCEL RETURN TO PROBLEM PROGRAM RETURN CODE =X'04'          32800002
* (3) FCB IMAGE REPLIED - ANALIZE FCB IMAGE                             32900002
*                                                                       33200020
         OC    SPWREPLY,LOWERCSE        SET FOR LOWER CASE REPLY        33300002
         LA    RWK5,NOERR               LOAD RETURN CODE=X'00'          33400002
         CLC   SPWREPLY(L'USECON),USECON  CK IF REPLY='U' USE           33500002
         BE    FCBFN075                 YES, USE CURRENT IMAGE   Y02072 33600002
         CLC   SPWREPLY(L'CANCEL01),CANCEL01  CK IF REPLY='CANCEL'      33700002
         BE    FCBFN070                 YES GO SET RET CODE =X'04'      33800020
         CLC   SPWREPLY(L'CANCEL02),CANCEL02  CK IF REPLY='C ' CANCEL   33900002
         BNE   FCBFN080                 NO GO TO ANALIZE REPLY          34000020
*                                                                       34100020
* OPERATOR CANCELED FCB LOAD BECAUSE SPECIFIED FCB IMAGE WAS NOT        34200002
* IN CORE OR IN SYS1.IMAGELIB, RETURN CODE =X'04' AND RETURN TO         34320002
* PROBLEM PROGRAM                                                       34400002
*                                                                       34500020
FCBFN070 EQU   *                                                        34600020
         LA    RWK5,NOTINCOR            SET RETURN CODE =X'04'          34800002
         B     FCBFN150                 GO EXIT TO PROBLEM PROGRAM      34900020
*                                                                       34950002
* OPERATOR REPLIED 'U'. DO FCB LOAD USING CURRENT IMAGE.         Y02072 35000002
*                                                                       35050002
FCBFN075 EQU   *                                                 Y02072 35100002
         MVC   SPWFCB2H,UCBFCBID        FCB IMAGE ID TO WORKA    Y02072 35150002
         MVI   SPWFLG1,0                NO OPTIONS               Y02072 35160002
         B     FCBFN030                 GO DO BLDL FOR IMAGE, DO Y02072 35170002
*                                         NOT LOOK FOR IMAGE IN  Y02072 35180002
*                                         AN EXIT LIST           Y02072 35190002
*                                                                       35200020
* ANALYSIS OF FCB IMAGE ID SPECIFIED BY OPERATOR                        35300002
*                                                                       35600020
FCBFN080 EQU   *                                                        35700020
         LA    RWK7,SPWREPLY            GET ADDRESS OF REPLY            35900002
         LA    RWK8,L'SPWFCB2H          SET LOOP COUNTER TO TEST        36000002
*                                       FOR INVALID FCB LENGTH          36100002
         DROP  RCORE                                                    36150002
         USING SPWREPLY,RWK7                                            36160002
         CLI   SPWREPLY,COMMA           CK FOR , IN FIRST POSITION      36200002
         BE    FCBFN170                 YES GO TO REPEAT REPLY MSG      36300020
         CLI   SPWREPLY,BLANK           CK FOR BLANK IN 1ST POSITION    36400002
         BE    FCBFN170                 YES GO TO REPEAT REPLY MSG      36500020
*                                                                       36600020
* SEPERATE FCB IMAGE ID FROM REPLY                                      36700002
*                                                                       36800020
FCBFN090 EQU   *                                                        36900020
         MVC   SPWFCB2H(1),SPWREPLY     MOVE ONE CHAR OF FCB ID TO      37100002
*                                         FCB IMAGE ID AREA             37200002
         LA    RWK7,1(RWK7)             IMCREMENT REPLY POINTER BY ONE  37300002
         CLI   SPWREPLY,BLANK           CK FOR BLANK (END OF FCB ID)    37400002
         BE    FCBFN130                 YES GO CK IF BLDL REQUIRED      37500020
         CLI   SPWREPLY,COMMA           CK IF THIS CHAR IS A COMMA      37600002
         BE    FCBFN100                 YES GO CK FOR VERIFY OR ALIGN   37700020
         BCT   RWK8,FCBFN090            GO MOVE NXT CHAR TO FCB SAVE    37800002
         B     FCBFN170                 IF REPLY ID GT 4 GO ISSUE       37900020
*                                         REPEAT REPLY MESSAGE          38000002
*                                                                       38100020
* TEST IF THE FCB IMAGE IS TO BE VERIFIED OR FORMS ALIGNED              38200002
*                                                                       38300020
FCBFN100 EQU   *                                                        38400020
         CLC   SPWFCBOR(L'VERIFY01),VERIFY01  CK IF VERIFY SPECIFIED    38600002
         BE    FCBFN120                 YES GO SET VERIFY BIT ON        38700020
         CLC   SPWFCBOR(L'VERIFY02),VERIFY02  CK IF 'V' VERIFY          38800002
*                                               SPECIFIED               38850002
         BE    FCBFN120                 YES GO SET VERIFY BIT ON        38900020
         CLC   SPWFCBOR(L'ALIGN01),ALIGN01  CK IF ALIGN SPECIFIED       39000002
         BE    FCBFN110                 YES GO SET ALIGN FORMS BIT      39100020
         CLC   SPWFCBOR(L'ALIGN02),ALIGN02   CK IF 'A' ALIGN SPECIFIED  39200002
         BNE   FCBFN170                 NO GO TO ISSUE REPEAT REPLY MSG 39300020
         DROP  RWK7                                                     39350002
         USING SPW,RCORE                                                39400002
FCBFN110 EQU   *                                                        39500020
         MVI   SPWFLG1,SPWALIGN         SET ALIGN FORMS BIT FOR FCB     39700002
         B     FCBFN005                 GO TO CK IF BLDL REQUIRED       39800020
FCBFN120 EQU   *                                                        40000020
         MVI   SPWFLG1,SPWVRFCB         SET VERIFY FCB BIT ON           40200002
         B     FCBFN005                 GO TO CK IF BLDL REQUIRED       40300020
FCBFN130 EQU   *                                                        40500020
         MVI   SPWFLG1,0                RESET FCB OPTION BITS           40700002
         B     FCBFN005                 GO CK IF BLDL REQUIRED          40800020
         EJECT                                                          40810002
*                                                                       40850002
*  CLEAN UP AND RETURN TO USER WITH RETURN CODE IN BITS 16-23    YM5703 40900002
*  OF REGISTER 15.                                               YM5703 40950002
*                                                                       41000002
FCBFN150 EQU   *                                                        41700020
*                                                                       41872102
* RESTORE IOB TO ORIGIONAL STATUS                                Y02072 41872202
*                                                                       41872302
         USING IOBQSAMN,RIOB                                            41872402
         MVC   IOBFLAG1(4),SPWFLGSV     RESTORE IOB FLAGS        Y02072 41872502
         MVC   IOBSTART,SPWSTRSV        RESTORE IOB START ADDR   Y02072 41872602
         DROP  RIOB                                                     41872702
         SPACE                                                          41872802
         MODESET  EXTKEY=SUPR           KEY OF SVRB              Y02072 41872902
         SPACE                                                          41873002
         SR    RWK6,RWK6                PREPARE TO ZERO FIELDS   Y02072 41873502
         ST    RWK6,SPRIOBSV            INDIC IOB'S RESTORED     Y02072 41873902
         SPACE                                                          41874302
         IMGLIB CLOSE,SPRIDCBA          ISSUE SVC TO CLOSE IMAGELIB     41874702
         SPACE                                                          41876702
         ST    RWK6,SPRIDCBA            INDICATE IMGLIB CLOSED   Y02072 41878902
         ST    RWK6,SPRMSG              INDICATE MSG CSECT DELTD Y02072 41889202
         DELETE  EP=IGGMSG01            DELETE MESSAGE CSECT     Y02072 42029202
*                                                                       42079202
*  FREEMAIN SETPRT WORKAREA AND BLDL PARAMETER LIST.             YM5703 42129202
*                                                                       42179202
         MODESET  KEYADDR=SPRKEY,WORKREG=1  KEY OF CORE TO FREE  Y02072 42189202
         SPACE                                                          42199202
         FREEMAIN R,LV=SPWLNGTH,A=(RCORE),SP=SPWPOOL             Y02072 42200002
         SPACE                                                          42250002
         MODESET  EXTKEY=DATAMGT        KEY OF BLDL LIST         YM5703 42300002
         SPACE                                                          42350002
         ST    RWK6,SPWWKADR            INDIC WORKAREA FREED     YM5703 42400002
         SPACE                                                          42450002
         FREEMAIN  R,LV=SPW5LNTH,A=(RBLDL),SP=SPW5POOL         @Z40MSAP 42500010
         SPACE                                                          42550002
*                                                                       43900002
* SET RETURN CODE IN REGISTER 15 AND RETURN                             44100002
*                                                                       44400020
FCBFN160 EQU   *                                                        44500020
         MODESET  EXTKEY=SUPR           KEY TO RETURN IN         Y02072 44550002
         SPACE                                                          44600002
         ST    RWK6,SPRBLDLA            INDIC BLDL LIST FREED    YM5703 44650002
         SLL   RWK5,8                   SHIFT RETURN CODE TO BITS 16-23 44700002
         LR    R15,RWK5                 PUT RETURN CODE IN REG 15       44800002
         SRL   RPAR,24                  MOVE RETURN CODE TO BYTE 3      44900002
         OR    R15,RPAR                 INSERT THE RTN CODE      M0084  45000002
         L     R14,SPREXIT              GET SAVED EXIT ADDR      Y02072 45100002
         BR    R14                      RETURN TO EXIT PROLOG    Y02072 45150002
         EJECT                                                          45200002
*                                                                       45300020
* FORM REPEAT REPLY MESSAGE 'IEC125I ERROR - REPEAT REPLY'              45700002
*                                                                       46000020
FCBFN170 EQU   *                                                        46100020
         LA    RWK2,MSG125              INDICATE MSG WANTED      Y02072 46300002
         BAL   RRET,GETMSG              GO GET MESSAGE           Y02072 46350002
         B     FCBFN060                 GO TO CLEAR REPLY AREA          46500020
         SPACE 4                                                        46550002
WTOR     WTOR  MF=(E,SPWRPLYA)          WRITE MESSAGE            Y02072 46560002
         ST    R1,SPWMSGID              SAVE MSG ID FOR DOM    @ZA25004 46563048
         OI    SPWMSGID,X'80'           SET HIGH ORDER BIT     @ZA25004 46566048
         BR    R14                      RETURN TO SYNCH          Y02072 46570002
         SPACE 3                                                        46580002
GETMSG   EQU   *                                                 Y02072 46590002
*********************************************************************** 46600002
*        THIS SUBROUTINE FINDS A MESSAGE IN THE MESSAGE CSECT           46650002
*        AND MOVES IT INTO THE SETPRT WORK AREA                         46700002
*        INPUT: RWK2 CONTAINS AN INDEX OFFSET (MSG NUMBER * 2)          46750002
*               SPRMSG CONTAINS THE ADDRESS OF THE MESSAGE CSECT        46760002
*        ADDRESSIBILITY REQUIRED:                                       46770002
*               SVRB EXTENDED SAVE AREA                                 46780002
*               SETPRT WORK AREA                                        46790002
*        OUTPUT:RWK2 POINTS TO MESSAGE TEXT IN MSG CSECT                46792002
*               RWK8 POINTS TO THE MSG ENTRY IN MSG CSECT               46794002
*               SPWMSGTX CONTAINS A COPY OF THE MESSAGE TEXT            46796002
*        THIS ROUTINE RETURNS ON REGISTER RRET                          46798002
*        ALL REGISTERS EXCEPT RWK2 AND RWK8 ARE TRANSPARENT             46798402
*********************************************************************** 46798802
         L     RWK8,SPRMSG              PICK UP MSG CSECT ADDR   Y02072 46799202
         USING MSGINDEX,RWK8                                     Y02072 46799602
         AH    RWK8,MSGINDOF(RWK2)      ADD ENTRY OFFSET         Y02072 46799702
         USING MSGENTRY,RWK8                                     Y02072 46799802
         SR    RWK2,RWK2                                         Y02072 46799902
         IC    RWK2,MSGOFF              PICK UP TEXT OFFSET      Y02072 46833202
         AR    RWK2,RWK8                GET PTR TO TEXT          Y02072 46843202
         USING MSGTXT,RWK2                                       Y02072 46853202
         MVC   SPWMSGTX,MSGTXT          MOVE IT INTO WORK AREA   Y02072 46863202
         BR    RRET                     RETURN TO CALLER         Y02072 46865202
         DROP  RWK2,RWK8                                         Y02072 46865602
         SPACE 3                                                        46865702
FILLFLDS EQU   *                                                 Y02072 46865802
*********************************************************************** 46866002
*        THIS ROUTINE FILLS IN THE UNIT NAME AND IMAGE ID               46866402
*        IN MESSAGES WHICH HAVE ALREADY BEEN MOVED TO THE WORK AREA     46866502
*        INPUT: RWK8 POINTS TO THE MESSAGE ENTRY IN MSG CSECT           46866602
*               SPWREPID CONTAINS THE IMAGE ID TO FILL IN               46877702
*        ADDRESSIBILITY REQUIRED:                                       46887702
*               UCB                                                     46888102
*               SETPRT WORK AREA                                        46888502
*        OUTPUT:SPWREPID AND UCBNAME HAVE MEEN MOVED TO THE             46888602
*               APPROPRIATE OFFSETS FROM SPWMSGTX                       46888702
*               RWK8 IS UNCHANGED FROM INPUT                            46888802
*        THIS ROUTINE RETURNS ON REGISTER RRET                          46892502
*        ALL REGISTERS EXCEPT RWK2 ARE TRANSPARENT                      46894502
*********************************************************************** 46894902
         USING MSGENTRY,RWK8                                     Y02072 46895702
         SR    RWK2,RWK2                                         Y02072 46896102
         IC    RWK2,MSGOFF1             PICK UP FIRST OFFSET     Y02072 46896202
         LA    RWK2,SPWMSGTX(RWK2)      POINT TO VAR IN WORKAREA Y02072 46946202
         MVC   0(L'UCBNAME,RWK2),UCBNAME   MOVE IN UCBNAME       Y02072 46956202
         SR    RWK2,RWK2                                         Y02072 46966202
         IC    RWK2,MSGOFF2             PICK UP SECOND OFFSET    Y02072 46976202
         LA    RWK2,SPWMSGTX(RWK2)      POINT TO VAR IN WORKAREA Y02072 46986202
         MVC   0(L'SPWREPID,RWK2),SPWREPID   MOVE IN IMAGE ID    Y02072 46988202
         BR    RRET                                              Y02072 46990202
         DROP  RWK8                                              Y02072 46992202
         EJECT                                                          46994202
*                                                                       46996202
* CONSTANTS                                                             47046202
*                                                                       47200020
         DS    0F                       ALIGN ON WORD BD                47230020
BLDLCNST DC    AL2(1,SPWBLDLN)          BLDL LIST                       47300002
FCBCONST DC    C'FCB2'                  PREFIX FOR FCB IMG ID           47400020
USECON   DC    C'U '                    OPERATOR REPLY=USE              47500020
CANCEL01 DC    C'CANCEL'                OPERATOR REPLY=CANCEL           47600020
CANCEL02 DC    C'C '                    OPERATOR REPLY=C                47700020
ALIGN01  DC    C'ALIGN'                 OPERATOR REPLY=ALIGN            47800020
ALIGN02  DC    C'A '                    OPERATOR REPLY=A                47900020
VERIFY01 DC    C'VERIFY'                OPERATOR REPLY=VERIFY           48000020
VERIFY02 DC    C'V '                    OPERATOR REPLY=V                48100020
LOWERCSE DC    CL16' '                  LOWER CASE MASK                 48200002
CLEARFLD EQU   LOWERCSE                 USED TO CLEAR FIELDS IN         48250002
*                                         WORK AREA                     48260002
*                                                                       50500020
* BRANCH TABLE                                                          50600010
*                                                                       50700020
ID4      DC    V(IGG08104)              NEXT MODULE EXECUTED   @Z40MSMI 50710010
*                                                                       50720002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 50720402
END      EQU   *                        END OF MODULE            Y02072 50724002
         TITLE 'IGG08103--DCB DSECT'                                    50800002
         IHADCB  DSORG=PS,DEVD=PR                                       54100002
         TITLE 'IGG08103--DEB DSECT'                                    54900002
         IEZDEB                                                         54950002
         TITLE 'IGG08103--DCB EXLST DSECT'                              55300002
         IHAEXLST                                                       55350002
         TITLE 'IGG08103--FCB IMAGE DSECT'                              55360002
         IHAFCBIM                                                       55370002
         TITLE 'IGG08103--IOB DSECT'                                    55400002
         IEZIOB                                                         55400402
         TITLE 'IGG08103--DSECT FOR MESSAGE CSECT'                      55400802
         IGGMSG                                                  Y02072 55401202
         TITLE 'IGG08103--SETPRT PARAMETER LIST DSECT'                  55402002
         IHASPP                                                         55404002
         TITLE 'IGG08103--SETPRT WORKAREA DSECT'                        55410002
         IGGSPW                                                         55420002
         TITLE 'IGG08103--UCB DSECT'                                    55430002
SRT      DSECT                                                          55440002
         IEFUCBOB                                                       55442002
         END                                                            55600020
./  ADD  SSI=81320129,NAME=IGG08104
8104       TITLE ' IGG08104 - LOAD FCB, VERIFY FCB, FREE AREAS'  Y02072 00100003
IGG08104 CSECT                                                   M0191  00102021
* /*  START OF SPECIFICATIONS****                             @Z40MSAP  00102410
*01*  PROCESSOR = ASSEMXF:                                              00102810
**** END OF SPECIFICATIONS **                                @Z40MSAP*/ 00103210
*                                                                       00104002
*MODULE-NAME = IGG08104                                                 00154002
*                                                                       00204002
*DESCRIPTIVE-NAME = SETPRT FCB LOAD AND VERIFY                          00254002
*                                                                       00256002
*COPYRIGHT = NONE                                                       00258002
*                                                                       00258402
*STATUS = LEVEL 001                                                     00258803
*                                                                       00260021
*FUNCTION = EXECUTE LOADING OF FORMS CONTROL BUFFER (FCB)               00300002
*         - WHEN VERIFY SPECIFIED PRINT OUT FCB IMAGE FOR VISUAL        00400002
*           VERIFICATION AND HAVE OPERATOR VERIFY FORMS ALIGNMENT       00500002
*         - WHEN ALIGN SPECIFIED, HAVE OPERATOR VERIFY FORMS ALIGNMENT  00600002
*         - UPDATE UCB TO SHOW STATUS OF FCB                            00700002
*         - DELETE FCB IMAGE LOADED                                     00800002
*         - FREE SETPRT MESSAGE/WORK AREA                               00900002
*         - FREE BLDL PARAMETER LIST                             YM5703 00950002
*                                                                       01000020
*NOTES =                                                                01050002
*    DEPENDENCIES = BLANK IS USED--CORRECTABLE BY REASSEMBLY.           01100002
*        THE FOLLOWING CHARACTER STRINGS ARE USED IN                    01150002
*        TESTING OPERATOR REPLIES:                                      01200002
*        'V', 'R', 'C', 'RETRY', 'VERIFY', 'CANCEL'                     01250002
*        THESE STRINGS ARE CONSIDERED TO BE OPERATING SYSTEM KEYWORDS   01300002
*        RATHER THAN LANGUAGE DEPENDENT PHRASES.                        01350002
*                                                                       01400002
*        BLANKS ARE OR'ED TO ALL REPLIES TO CONVERT THEM TO UPPER CASE  01450002
*                                                                       01500002
*    RESTRICTIONS = NONE                                                01550002
*                                                                       01600002
*    REGISTER-CONVENTIONS = ALL REGISTER NAMES BEGIN WITH R             01650002
*        SEE EQUATES IMMEDIATELY FOLLOWING PROLOG                       01700002
*                                                                       01750002
*    PATCH-LABEL = PATCH, AN AREA ASSEMBLED AS BINARY 0                 01800002
*                                                                       01850002
*MODULE-TYPE =                                                          01900002
*    PROCESSOR = OS/VS ASSEMBLER                                        01950002
*                                                                       02000002
*    MODULE-SIZE = 1100 DECIMAL BYTES                                   02050002
*                                                                       02100002
*    ATTRIBUTES = REENTRANT, ENABLED, PRIVELEGED,                       02150002
*        EXECUTES IN SETPRT INVOKER KEY                                 02200002
*        CODE AT ENTRY POINT WTOR IS NON-PRIVELEGED                     02250002
*                                                                       02300002
*ENTRY POINT = IGG08104                                                 02350002
*    PURPOSE = SEE FUNCTION                                             02400002
*                                                                       02450002
*    LINKAGE = BRANCH FROM IGG08103                                     02500010
*                                                                       02550002
*INPUT =                                                                02600002
*    REGISTER 4(RSPW) = WORK AREA ADDRESS                               02650002
*    REGISTER R5/BYTE 0(RPAR) = UCS RETURN CODE                         02700002
*    REGISTER R5/BYTES 1-3(RPAR) = PARAMETER LIST ADDRESS               02750002
*    REGISTER 6(RSVR) = SVRB EXTENDED SAVE AREA ADDRESS                 02800002
*    REGISTER 8(RWK4) = ADDR OF IMAGE TO BE LOADED                      02850002
*    REGISTER 9(RIOB) = IOB ADDRESS                                     02900002
*                                                                       02950002
*OUTPUT =                                                               03000002
*    REGISTER 15(R15) = RETURN CODE (SEE EXITS)                         03050002
*                                                                       03100002
*    MESSAGES = RETRIEVED FROM IGGMSG01                                 03150002
*      'IEC125A ERROR - REPEAT REPLY'                                   03200002
*      'IEC128D V XXXX,VERIFY FORMS ALIGNMENT'                          03250002
*      'LINE NN CHANNEL NN FCB ID=XXXX SPACING=N LPI' - FCB HEADING VER 03300002
*      'CHANNEL' - INSERT FOR FCB VERIFICATION                          03350002
*      'LINE NN CHANNEL NN' - FCB PRINT LINE FOR VERIFICATION           03400002
*      'LINE NN CHANNEL NN END' - FCB FINAL PRINT LINE FOR VERIFICATION 03450002
*                                                                       03500002
*    UCB = UPDATED TO REFLECT NEW FCB IMAGE                             03550002
*                                                                       03600002
*    PRINTER = FORMS CONTROL BUFFER IS LOADED                           03650002
*                                                                       03700002
*EXITS =                                                                03750002
*    NORMAL = RETURN TO SUPERVISOR WITH RETURN CODE = 0 IN BITS 15-31   03800002
*             OF REGISTER 15 FOR SUCCESSFUL FCB OPERATION               03850002
*           = REGISTER 15 BITS 0-15 WITH UCS RETURN CODE                03860002
*                                                                       03900002
*    ERROR = RETURN TO SUPERVISOR WITH RETURN CODE IN BITS 15-31 OF     03950002
*            REGISTER 15 FOR UNSUCCESSFUL FCB OPERATION =               04000002
*              X'0C' - PERMANENT I/O ERROR DURING FCB LOAD              04050002
*              X'10' - PERMAINENT I/O ERROR DURING FCB IMAGE VERIFY     04100002
*              X'14' - OPERATOR CANCELED REPLY TO IEC128D               04150002
*                                                                       04200002
*EXTERNAL REFERENCES =                                                  04250002
*    ROUTINES = EXCP     (SVC 0)                                        04300002
*               WAIT     (SVC 1)                                        04350002
*               DELETE   (SVC 9)                                        04400002
*               IMGLIB   (SVC 105)                                      04450002
*               FREEMAIN (SVC 10)                                       04500002
*               SYNCH    (SVC 12)                                       04550002
*               WTOR     (SVC 35)                                       04560002
*               SETLOCK  (BALR 14,13)                                   04570002
*               DEBCHK   (BALR 14,15)                                   04580002
*                                                                       04590002
*    DATA-AREAS = SPP - SETPRT PARM LIST                                04600002
*                 SPW5 - BLDL PARM LIST                        @Z40MSAP 04610010
*                 SPW - SETPRT WORK AREA                                04650002
*                 FCBIMAGE - FORMS CONTROL BUFFER IMAGE                 04700002
*                 MSG CSECT - IGGMSG01                                  04750002
*                 SPRBXSV - SVRB EXTENDED SAVE AREA                     04800002
*                                                                       04850002
*    CONTROL-BLOCKS = DCB, IOB, UCB, ECB, DEB                           04900002
*                                                                       04950002
*    MACROS-ACTION = EXCP, WAIT, DELETE, IMGLIB, FREEMAIN, SYNCH, WTOR, 05000002
*                    SETLOCK (OBTAIN AND RELEASE), MODESET              05050002
*                                                                       05052002
*    MACROS-MAPPING = IGGSPW, IHASPP, IHAFCBIM, IEZIOB, IEFUCBOB,       05060002
*                     IHAECB, IEZDEB, IHADCB                            05070002
*                                                                       05100020
*CHANGE ACTIVITY = AS FOLLOWS                                           05110002
*                                                                       05120002
*NOTE =  THIS MODULE WAS BROUGHT UP TO STANDARDS FOR VS2-2              05130002
*        WHICH CAUSED ALL PREVIOUS RELEASE SEQUENCE NUMBER DELETIONS TO 05140002
*        BECOME INVALID.                                                05142002
*                                                                       05144002
*         VS2 RELEASE 4 CHANGES                                         05144410
*                                                              @Z40MSMI 05144810
*                                                                       05145210
*         VS2 RELEASE 3 CHANGES                                         05146010
*A195700-196200,202500,419100-419120,419900,478100-478200,      ZA02199 05146403
*A479520,503500-504000,510500                                   ZA02199 05146803
*A420000                                                       @ZA07594 05148010
*C405000,459000,461000                                         @ZA07594 05148610
*D318000-322500                                                @ZA07594 05149210
*A348010                                                       @ZA10220 05149610
*         VS2 RELEASE 3.7 CHANGES                              @ZA10228 05149710
*C074900,463000,465000,476000                                  @ZA10228 05149810
*C162150,162200,516123,517367,517375                           @ZA19734 05149910
*C162150,162180                                                @ZA20901 05150310
*A146900,176500-178500                                         @ZA20901 05150710
*C162150-162180                                                @ZA25004 05151048
*A450500,515481-515482                                         @ZA25004 05151248
*A178500,178700                                                @ZA28402 05151448
*C162150,162180,177500                                         @ZA28905 05151648
*A517320,517325                                                @ZA30716 05151748
*A188500                                                       @ZA32079 05151848
*         VS2 RELEASE 2 DELETIONS                                       05152248
*THE FOLLOWING DEVELOPMENT CODE WAS FOR VS2-2 - Y02072                  05153348
*                                                                YM4640 05153748
*                                                                YM5703 05154102
*                                                                YM5919 05156102
*                                                                YA3018 05158102
*                                                                       05160002
*         VS1 RELEASE 2 DELETIONS                                       05162002
*THE FOLLOWING PTM'S WERE FIXED IN THIS RELEASE - 2963                  05164002
*                                                                       05166002
*         RELEASE 21 DELETIONS                                          05170002
*THE FOLLOWING PTMS WERE FIXED IN THIS RELEASE - 0092, 0191, 1759       05180002
*THE FOLLOWING APARS WERE FIXED IN THIS RELEASE - 52367, 50699          05190002
*THE FOLLOWING DEVELOPMENT CODE WAS FOR 2245 SUPPORT - S21092           05192002
         EJECT                                                          05200002
*                                                                       05300020
*   REGISTER CONVENTIONS USED THROUGH OUT ALL SETPRT EXECUTORS          05400020
*                                                                       05500020
R0       EQU   0                        PARAMETER REGISTER              05800002
RWK1     EQU   R0                       WORK REGISTER                   05850002
R1       EQU   1                        PARAMETER REGISTER              05900002
RWK2     EQU   R1                       WORK REGISTER                   05950002
RDCB     EQU   2                        USER'S DCB ADDR                 06000020
RIMAGSAV EQU   RDCB                     REG TO SAVE ADDR OF FCB  Y02072 06050002
*                                         IMAGE                  Y02072 06060002
RBASE    EQU   3                        BASE REG                        06100020
RCORE    EQU   4                        WORK AREA/MESSAGE ADDRESS       06200020
RPAR     EQU   5                        PARAMETER LIST ADDRESS          06300020
RSVR     EQU   6                        SVRB EXTENDED SAVE AREA         06400002
RRET     EQU   7                        WORK REGISTER                   06500002
RWK4     EQU   8                        WORK REGISTER                   06600002
RIOB     EQU   9                        ADDRESS OF LAST IOB USED        06700020
R10      EQU   10                       LIMIT FOR STM RANGE      Y02072 06750002
*                                       AND DEBCHK INPUT REG     Y02072 06760002
RUCB     EQU   10                       UCB ADDRESS                     06800020
RDEB     EQU   11                       DEB ADDRESS                     06900020
RWK5     EQU   12                       WORK REGISTER                   07000002
RWK6     EQU   13                       WORK REGISTER                   07100002
R14      EQU   14                       PARAMETER REGISTER              07200002
RWK7     EQU   R14                      WORK REGISTER                   07250002
R15      EQU   15                       PARAMETER REGISTER              07300002
RWK8     EQU   R15                      WORK REGISTER                   07350002
         EJECT                                                          07400002
*********************************************************************** 07450002
*              RETURN CODES                                             07460002
*                                                                       07470002
OKCOMP   EQU   X'00'                    RETURN CODE - SUCCESSFUL COMP   07480002
OPRCANCL EQU   X'14'                    RETURN CODE - OPER CAN @ZA10228 07490010
PERMIOER EQU   X'0C'                    RETURN CODE - PERM I/O ERR      07492002
*                                         LOADING FCB IMAGE             07494002
PERMIOEV EQU   X'10'                    RETURN CODE - PERM I/O ERR      07496002
*                                         VERIFYING FCB IMAGE           07498002
RCNOPEN  EQU   X'18'                    DCB NOT OPEN             Y02072 07498102
*                                                                       07498402
*********************************************************************** 07498802
*              MESSAGE NUMBERS IN IGGMSG01                              07499202
*        ALL MESSAGE NUMBERS HAVE BEEN DOUBLED IN THESE EQUATES         07499602
*        TO PROVIDE OFFSETS INTO THE MESSAGE CSECT.                     07499702
*        THIS IS DEPENDENT ON L'MSGINDOF BEING 2.                       07499802
*                                                                       07499902
MSG128   EQU   14*2                     IEC128D--VERIFY FORMS    Y02072 07533202
MSG125   EQU   8*2                      IEC125A--ERROR - REPEAT  Y02072 07543202
MSGFHEAD EQU   20*2                     LINE--FCB ID--SPACING    Y02072 07553202
MSGFCHAN EQU   19*2                     'CHANNEL' FILL IN        Y02072 07563202
MSGFLINE EQU   21*2                     LINE MESSAGE             Y02072 07565202
MSGFFOOT EQU   22*2                     LAST LINE MESSAGE        Y02072 07565602
*                                                                       07615602
*********************************************************************** 07665602
*              OTHER EQUATES                                            07675602
*                                                                       07700020
CMDRETRY EQU   X'80'                    MASK FOR COMMAND RETRY ON       13600020
*                                         IN IOB SENSE BYTE 1    Y02072 13650002
MASKSIGN EQU   X'F0'                    MASK TO REMOVE SIGN             13700020
BLANK    EQU   X'40'                    CONSTANT=C' '                   14200020
PRT2245  EQU   X'0B'                    CODE IN UCBTBYT4 FOR     Y02072 14650002
*                                         2245 PRINTER           Y02072 14660002
NOFCBLD  EQU   X'40'                    NO FCB LOAD REQUIRED   @ZA20901 14690010
         EJECT                                                          14720002
*                                                                       14900020
* INITIALIZE REGISTERS                                                  15000002
*                                                                       15300020
         BALR  RBASE,0                                                  15400020
FCBLD000 EQU   *                                                        15450002
         USING FCBLD000,RBASE                                           15500020
         USING SPW,RCORE                                                15700002
         USING SPRBXSV,RSVR                                             15750002
         USING SPPARM,RPAR                                              16150002
         SPACE 2                                                        16200002
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 16205002
         DC    C'IGG08104'              MODULE NAME            @ZA20901 16210048
         DC    C'@ZA32079'              LAST MODULE CHANGE     @ZA32079 16215048
         DC    C'04/26/78'              LAST SHIP DATE         @ZA32079 16218048
BEGIN    DS    0H                       END OF MODULE ID         YM4640 16225002
         L     RDCB,SPPDCBA             LOAD DCB ADDRESS                16300002
         USING IHADCB,RDCB                                              16350002
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS                16400020
         USING DEBBASIC,RDEB                                            16450002
         L     RUCB,DEBSUCBA            LOAD UCB ADDRESS                16500002
         USING UCBOB,RUCB                                               16550002
         MVI   SPWFLG8,0                CLEAR FLAG FOR USE HERE  Y02072 16600002
         USING IOBQSAMN,RIOB                                            17550002
         MVI   IOBFLAG1,IOBCMDCH+IOBUNREL SET IOBFLAG=CMD CHAINING/UNRL 17600002
         L     RWK2,UCBXTADR            LOAD UCB EXTENSION ADD @ZA20901 17650010
         USING UCBUCS,RWK2                                     @ZA20901 17700010
         TM    SPWFLG1,NOFCBLD          LOAD FCB IMAGE ?       @ZA28905 17750048
         BO    FCBLD020                 NO- GO CHECK OPTIONS   @ZA20901 17800010
         MODESET EXTKEY=SUPR            GET INTO SUPERVISOR KEY@ZA28402 17850048
         NI    UCBFCBOP,X'FE'           TURN OFF PARITY ERROR  @ZA20901 17860048
         MODESET KEYADDR=SPRKEY,WORKREG=2 RESUME NORMAL KEY    @ZA28402 17870048
*                                                                       17900020
* FORM CCW TO LOAD FCB                                                  18000002
*                                                                       18100020
         USING FCBIMBEG,RWK4                                            18150002
         LR    RIMAGSAV,RWK4            SAVE IMAGE ADDR FOR      Y02072 18200002
*                                         RE-VERIFICATION        Y02072 18250002
         LA    RWK1,FCBLINE1            GET ADDR OF FCB IMAGE           18300002
         ST    RWK1,SPWADD1A            STORE FCB ADDR IN CCW           18400002
         SR    RWK1,RWK1                ZERO OUT REGISTER               18500002
         IC    RWK1,FCBLENTH            GET LENGTH OF FCB IMAGE         18600002
         ST    RWK1,SPWCCWF1            STORE LENGTH OF FCB IMG IN CCW  18700002
         MVI   SPWOPCD1,SPWFCBLD        MOVE IN LOAD FCB COMMAND        18800002
         MVI   SPWCCWF1,SPWSILI         SET SILI ON           @ZA32079  18850048
*                                                                       18900020
* ISSUE EXCP AND WAIT TO LOAD FCB                                       19000002
*                                                                       19100020
FCBLD010 EQU   *                                                        19400020
         BAL   RRET,SETUCB              MOVE SPWFCB2H TO UCB     Y02072 19520002
         OI    IOBFLAG1,IOBSPSVC        IND NO SAM APPENDAGE    ZA02199 19570003
*                                       PROCESSING REQUIRED     ZA02199 19620003
         EXCP  IOBSTDRD                 EXCP FOR FCB LOAD               19800002
*                                                                       19900020
         L     R1,IOBECBPT              GET ADDRESS OF ECB              19950002
         WAIT  ECB=(1)                  WAIT FOR COMPLETION OF FCB LD   20200002
         NI    IOBFLAG1,X'FF'-IOBSPSVC  RESET IOB FLAG          ZA02199 20250003
*                                                                       20300020
         L     RWK2,IOBECBPT            GET ADDR OF ECB                 20400002
         USING ECBCC,RWK2                                               20450002
         CLI   ECBCC,ECBNORM            CK FOR SUCCESSFUL FCB LOAD      20500002
         BE    FCBLD020                 YES GO CK FCB OPTIONS           20600020
*                                                                       21400020
* WHEN A PERMANENT I/O ERROR IS DETECTED DURING AN FCB LOAD, UPDATE     21500002
* THE UCB WITH X'00', DELETE THE FCB IMAGE LOADED AND GIVE CONTROL      21600002
* BACK TO THE PROBLEM PROGRAM WITH RETURN CODE=0C IN BITS 16-23         21700002
* OF REGISTER 15                                                        21800002
*                                                                       22100020
         LA    RWK5,PERMIOER            LOAD RETURN CODE =X'0C'         22200002
FCBLD015 EQU   *                                                        22400020
         L     RWK1,SPWFCB2H            SAVE ID OF IMAGE LOADED  Y02072 22450002
         SR    RWK2,RWK2                CLEAR FCB ID             Y02072 22600002
         ST    RWK2,SPWFCB2H                                     Y02072 22650002
         BAL   RRET,SETUCB              CLEAR ID IN UCB          Y02072 22700002
         ST    RWK1,SPWFCB2H            RESTORE NAME FOR DELETE  Y02072 22750002
         B     FCBLD040                 GO TO HOUSE CLEANING ROUTINE    22800020
*                                                                       23100020
* TEST  FCB OPTION BITS FOR VERIFY OR ALIGN                             23200002
*                                                                       23300020
FCBLD020 EQU   *                                                        23600020
         TM    SPWFLG1,SPWVRFCB         TEST IF VERIFY FCB SPECIFIED    23800002
         BO    FCBLD070                 YES GO PRINT LINES OF VERIFICAT 23900002
         TM    SPWFLG1,SPWALIGN         TEST IF ALIGN FORMS SPECIFIED   24000002
         BO    FCBLD120                 YES GO ISSUE ALIGN FORMS MSG    24100020
         LA    RWK5,OKCOMP              SET RETURN CODE=00              24200002
*                                         NO FALL THROUGH TO EXIT RTN   24300002
*                                                                       24600020
* EXIT ROUTINE  -  UPDATE FCB FIELDS OF UCB FOR SUCCESSFUL FCB LOAD     24700002
*               -  DELETE FCB IMAGE IF ONE WAS LOADED                   24800002
*               -  DELETE MESSAGE CSECT                                 24850002
*               -  FREE MESSAGE/WORK AREA                               24900002
*               -  FREE BLDL PARAMETER LIST                      YM5703 24950002
*               -  SET RETURN CODE IN BITS 16-23 REG.15                 25000002
*               -  RETURN TO INVOKER                                    25100002
*                                                                       25400020
FCBLD030 EQU   *                                                        25500020
         OI    SPWFLG8,SPWFCBOP         REQUEST OPTION UPDATE    Y02072 25700002
         BAL   RRET,SETUCB              PUT OPTIONS & ID IN UCB  Y02072 25750002
         NI    SPWFLG8,X'FF'-SPWFCBOP   RESET OPTIONS REQUEST    Y02072 25800002
*                                                                       26000020
* DETERMINE IF AN FCB IMAGE WAS LOADED                                  26100002
*                                                                       26200020
FCBLD040 EQU   *                                                        26300020
         TM    SPWFLG5,SPWFCBDE         DID USER SUPPLY IMAG VIA Y02072 26350002
*                                          DCB EXIT LIST         Y02072 26400002
         BZ    FCBLD050                 YES, DO NOT ISSUE DELETE Y02072 26450002
*                                                                       26800020
* DELETE FCB IMAGE                                                      26900002
*                                                                       26950002
         DELETE EPLOC=SPWFCBIM          DELETE THE FCB IMAGE LOADED     27300002
         NI    SPWFLG5,X'FF'-SPWFCBDE   INDICATE IMAGE DELETED   Y02072 27310002
FCBLD050 SR    RWK6,RWK6                                         Y02072 27350002
         ST    RWK6,SPWFCB2H            CLEAR IMAGE NAME         Y02072 27360002
*                                                                       27400020
*  DELETE MESSAGE CSECT                                                 27500002
*                                                                       27600020
         DELETE EP=IGGMSG01             DELETE MSG CSECT         Y02072 27750002
         SPACE 2                                                        27760002
         MODESET EXTKEY=SUPR            PREPARE TO MODIFY SVRB   Y02072 27800002
         SPACE                                                          27850002
         ST    RWK6,SPRMSG              INDICATE MSGS DELETED    Y02072 27852002
*                                                                       27860020
*  CLOSE SYS1.IMAGELIB                                                  27870002
*                                                                       27880002
         IMGLIB  CLOSE,SPRIDCBA         CLOSE SYS1.IMGLIB        Y02072 27890002
*                                                                       27920020
         ST    RWK6,SPRIDCBA            INDICATE IMGLIB DELETED  Y02072 27950002
         ST    RWK6,SPRIOBSV            INDICATE IOB RESTORED    Y02072 27952002
         MODESET KEYADDR=SPRKEY,WORKREG=1 RESUME NORMAL KEY      Y02072 27960002
*                                                                       27960402
* RESTORE IOB TO ORIGIONAL STATUS                                Y02072 27960802
*                                                                       27961202
         MVC   IOBFLAG1(4),SPWFLGSV     RESTORE IOB FLAGS        Y02072 27962002
         MVC   IOBSTART,SPWSTRSV        RESTORE IOB START ADDR   Y02072 27964002
*                                                                       27970002
*  FREEMAIN SETPRT WORKAREA AND BLDL PARAMETER LIST              YM5703 28020002
*                                                                       28070002
         FREEMAIN R,LV=SPWLNGTH,A=(RCORE),SP=SPWPOOL             Y02072 28200002
         SPACE                                                          28250002
         MODESET  EXTKEY=DATAMGT        KEY OF BLDL LIST         YM5703 28260002
         SPACE                                                          28270002
         L     RWK2,SPRBLDLA            ADDR OF BLDL PARM LIST   YM5703 28272002
         USING SPW5,RWK2                                       @Z40MSAP 28274010
         ST    RWK6,SPWWKADR            INDIC WORKAREA FREED     YM5703 28280002
         SPACE                                                          28282002
         FREEMAIN  R,LV=SPW5LNTH,A=(RWK2),SP=SPW5POOL          @Z40MSAP 28290010
         SPACE                                                          28290402
         MODESET  EXTKEY=SUPR           KEY TO RETURN IN         Y02072 28292002
         SPACE                                                          28294002
         ST    RWK6,SPRBLDLA            INDIC BLDL LIST FREED    YM5703 28296002
*                                                                       28300020
* RESET REGISTERS AND IOB TO RETURN TO PROBLEM PROGRAM                  28400002
*                                                                       28500020
         L     RDCB,SPPDCBA             GET DCB ADDRESS                 28600002
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 28700002
*                                                                       29700020
*        RETURN TO PROBLEM PROGRAM                                      29800002
*                                                                       29900020
         SLL   RWK5,8                   SHIFT RETURN CODE TO BITS 16-23 30200002
         LR    R15,RWK5                                                 30300002
         SRL   RPAR,24                  MOVE UCS RTN CODE TO BYTE 3     30400002
         OR    R15,RPAR                 OR IN UCS PART OF RTN CODE      30500002
*                                                                       30600020
         L     R14,SPREXIT              GET EXIT ADDRESS         Y02072 30700002
         BR    R14                      RETURN TO EXIT PROLOG    Y02072 30750002
         EJECT                                                          30800002
*                                                                       31100020
* VERIFICATION ROUTINE TO DISPLAY THE FCB IMAGE                         31200002
*                                                                       31520020
FCBLD070 EQU   *                                                        31600020
         CLI   UCBTBYT4,PRT2245         CHECK FOR 2245 PRINTER   S21092 31680002
         BE    FCBLD120                 IF VERIFY SPECIFIED GO TO M0191 31700002
*                                         ALIGN                  S21092 31720002
*                                                                       33400020
* INITIALIZE REGISTERS FOR VERIFICATION                                 33500002
* -RWK5 CONTAINS LINE NUMBER                                            33700002
* -RWK7 POINTER TO ENTRIES IN FCB IMAGE                                 33800002
*                                                                       33900020
         LA    RWK5,1                   SET LINE COUNTER TO 1           34000002
         LA    RWK7,FCBLINE1            SET FCB IMG PTR TO START OF IM  34100002
         TM    FCBINDEX,FCBLFTIN+FCBRGTIN  IS INDEXING SPECIFIED XM2963 34150002
         BZ    FCBLD072                 NO, RWK7 HAS RIGHT ADDR  XM2963 34160002
         LA    RWK7,FCBLNPN1            ADDR IF USING INDEXING   XM2963 34170002
FCBLD072 EQU   *                                                 XM2963 34180002
*                                                                       34200020
* FORM CCW TO PRINT LINES OF VERIFICATION                               34300002
*                                                                       34400020
         LA    RWK6,SPWMSGTX            GET ADDR OF PRINT LINE          34600002
         ST    RWK6,SPWADD1A            SET ADDR OF PRT LINE            34700002
         MVI   SPWOPCD1,SPWWRTSP        SET COMMAND CODE TO PRINT+SKP1  34800002
         MVI   SPWCCWF1,SPWSILI         SET SILI ON            @ZA10220 34850010
*                                                                       34900020
* INITIALIZE PRINT LINE                                                 35000002
*                                                                       35100020
         LA    RWK2,MSGFHEAD            REQUEST FCB HEADER       Y02072 35200002
         BAL RRET,GETMSG                GO GET IT                Y02072 35250002
         LR    RWK6,RWK8                KEEP PTR TO MSG ENTRY    Y02072 35300002
         USING MSGENTRY,RWK6                                     Y02072 35350002
         SR    RWK2,RWK2                CLEAR REG FOR INSERTS    Y02072 35360002
         IC    RWK2,MSGLNG              GET LENGTH-1 FOR CCW    Y02072  35370002
         LA    RWK2,1(RWK2)             ADD TO GET REAL LENGTH   Y02072 35372002
         STH   RWK2,SPWBYTE1            PUT LEN IN THE CCW       Y02072 35380002
         IC    RWK2,MSGOFF5             OFFSET TO FCB ID         Y02072 35390002
         L     RWK8,SPWFCB2H            PICK UP FCB ID           Y02072 35392002
         ST    RWK8,SPWMSGTX(RWK2)      STORE IT AT ITS OFFSET   Y02072 35394002
         IC    RWK2,MSGOFF6             OFFSET TO LINES/INCH     Y02072 35396002
         LA    RWK8,SPWMSGTX(RWK2)      PTR TO LINES/INCH        Y02072 35398002
         DROP  RWK4                                                     35398402
         USING FCBLINE,RWK7                                             35398802
         MVI   0(RWK8),SPW6LINE         INIT AT 6 INES/INCH      Y02072 35400002
         TM    FCBLINE,FCB8LINE         CK IF LINE/INCH = 8             35500002
         BNO   FCBLD075                 NO CONTINUE WITH 1ST PRINT LINE 35600020
         MVI   0(RWK8),SPW8LINE         YES SET TO 8 LINES/INCH  Y02072 35700002
FCBLD075 EQU   *                                                        35900020
*                                                                       36200020
* INSERT LINE NUMBER INTO PRINT LINE                                    36300002
*                                                                       36400020
FCBLD080 EQU   *                                                        36500020
         CVD   RWK5,SPWUNPKA            CONVERT LINE NO TO DECIMAL      36700002
         UNPK  SPWUNPKA,SPWLNENO        UNPACK LINE NO.                 36800002
         OI    SPWZONE,MASKSIGN         INSERT ZONE IN LOW ORDER DIGIT  36900002
         SR    RWK2,RWK2                                         Y02072 36950002
         IC    RWK2,MSGOFF1             OFFSET TO LINE NUMBER    Y02072 36960002
         LA    RWK8,SPWMSGTX(RWK2)      PTR TO LINE NUMBER       Y02072 36970002
         MVC   0(L'SPWWKAR,RWK8),SPWWKAR+1 MOVE LINE NO TO PRINT Y02072 37000002
*                                                                       37100020
* TRANSLATE CHANNEL CODE TO CHARACTER FORM AND ADD TO PRINT LINE        37200002
*                                                                       37300020
         LA    RWK8,FCBCHAN             PICK UP CHANNEL MASK     Y02072 37350002
         IC    RWK2,FCBLINE             GET CHANNEL CODE         Y02072 37400002
         NR    RWK2,RWK8                IF CHANNEL CODE IS 00    Y02072 37500002
         BZ    FCBLD100                 BYPASS TRANSLATION       Y02072 37600002
         SLL   RWK2,1                   MUTIPLY CODE BY 2        Y02072 38300002
         LH    RWK8,TRANSTAB(RWK2)      GET EBCDIC CHANNEL CODE  Y02072 38400002
         IC    RWK2,MSGOFF3             OFFSET TO CHANNEL CODE   Y02072 38500002
         STH   RWK8,SPWMSGTX(RWK2)      STORE CODE IN MSG        Y02072 38550002
         LA    RWK2,MSGFCHAN            REQUEST 'CHANNEL' MSG    Y02072 38600002
         OI    SPWFLG8,SPWNOMOV         SUPPRESS SUBR MOVE       Y02072 38650002
         BAL   RRET,GETMSG              GET THE MESSAGE          Y02072 38660002
         USING MSGTXT,RWK2                                       Y02072 38670002
         USING MSGENTRY,RWK8                                     Y02072 38680002
         NI    SPWFLG8,X'FF'-SPWNOMOV   RESTORE NORMAL MODE      Y02072 38682002
         IC    RWK8,MSGLNG              GET LENGTH OF 'CHANNEL'  Y02072 38690002
         DROP  RWK8                                              Y02072 38690402
         USING MSGENTRY,RWK6            RETURN TO MAIN MESSAGE   Y02072 38692002
         SR    RWK4,RWK4                                         Y02072 38694002
         IC    RWK4,MSGOFF2             OFFSET TO 'CHANNEL       Y02072 38696002
         LA    RWK4,SPWMSGTX(RWK4)      PTR TO 'CHANNEL' IN      Y02072 38698002
*                                       WORK AREA                Y02072 38698402
         EX    RWK8,MVCHAN              MOVE WORD INTO MSG       Y02072 38698802
         DROP  RWK2                                              Y02072 38699202
FCBLD100 EQU   *                                                        38700020
         BAL   RRET,EXCP                PRINT A VERIF LINE       Y02072 39300002
         TM    SPWFLG8,SPWVREND         IF THIS WAS LAST LINE    Y02072 40400002
         BO    FCBLD120                 GO TO MSG 'IEC128D'    @ZA07594 40500010
*                                                                       40600020
* SET REGISTERS AND MESSAGE TO PRINT NEXT LINE OF VERIFICATION          40700002
*                                                                       40800020
         LA    RWK5,1(RWK5)             INCREMENT LINE COUNTER          40900002
         LA    RWK7,1(RWK7)             INCREMENT POINTER TO NEXT       41100002
*                                         POSITION OF FCB IMAGE         41200002
         LA    RWK2,MSGFLINE            REQUEST LINE MSG         Y02072 41300002
         TM    FCBLINE,FCBLAST          CK FOR END OF IMAGE FLAG        41400002
         BNO   FCBLD105                 NO - FORM NEXT LINE      Y02072 41500002
*                                         YES SET FOR LAST LINE OF VFY  41600002
         LA    RWK2,MSGFFOOT            REQUEST LAST LINE MSG    Y02072 41700002
         OI    SPWFLG8,SPWVREND         SET LAST LINE FLAG       Y02072 41750002
FCBLD105 EQU   *                                                 Y02072 41800002
         BAL   RRET,GETMSG              GET REQUESTED MESSAGE    Y02072 41802002
         LR    RWK6,RWK8                SAVE ITS ENTRY PTR       Y02072 41804002
         SR    RWK2,RWK2                                         Y02072 41806002
         IC    RWK2,MSGLNG              GET LENGTH-1 OF MSG      Y02072 41808002
         LA    RWK2,1(RWK2)             ADD TO GET REAL LENGTH   Y02072 41808102
         STH   RWK2,SPWBYTE1            AND UPDATE CCW           Y02072 41808402
         B     FCBLD075                 GO PUT LINE NUM IN       Y02072 41810002
*                                         IN PRINT LINE          Y02072 41810402
         DROP  RWK6                                              Y02072 41812002
*                                                                Y02072 41814002
* FOLLOWING INSTRUCTION EXECUTED FROM FCBLD080 ABOVE             Y02072 41816002
*                                                                Y02072 41818002
MVCHAN   MVC   0(0,RWK4),0(RWK2)        MOVE 'CHANNEL' INTO MSG  Y02072 41818402
*                                                                       41820020
* ISSUE SKIP TO CHANNEL 1                                               41830002
*                                                                       41840020
FCBLD110 EQU   *                                                        41850020
         XC    SPWCCW1,SPWCCW1          RESET CCW                       41870002
         MVI   SPWBYTE1+1,1             SET DATA LENGTH =1              41880002
         MVI   SPWCCWF1,SPWSILI         SET SILI ON                     41890002
         MVI   SPWOPCD1,SPWSKIP         MOVE SKIP COMMAND CD            41900002
         OI    IOBFLAG1,IOBSPSVC        IND NO SAM APPENDAGE    ZA02199 41910003
*                                       PROCESSING REQUIRED     ZA02199 41912003
         EXCP  IOBSTDRD                 ISSUE SKIP TO CH 1              41920002
*                                                                       41922002
         L     R1,IOBECBPT              GET ADDRESS OF ECB              41932002
         WAIT  ECB=(1)                  WAIT FOR SKIP TO COMPLETE       41940002
         NI    IOBFLAG1,X'FF'-IOBSPSVC  RESET IOB FLAG          ZA02199 41990003
         B     FCBLD030                 RETURN TO PROBLEM PROG @ZA07594 42000010
* WTOR TO REQUEST OPERATOR TO VERIFY FORMS ALIGNMENT                    42300002
* 'IEC128D V XXX,VERIFY FORMS ALIGNMENT'                                42400002
*                                                                       42700020
FCBLD120 EQU   *                                                        42800020
         LA    RWK2,MSG128              REQUEST 'VERIFY' MSG     Y02072 42900002
         BAL   RRET,GETMSG              GET IT IN WORK AREA      Y02072 42950002
         USING MSGENTRY,RWK8                                     Y02072 43000002
         SR    RWK2,RWK2                                         Y02072 43050002
         IC    RWK2,MSGOFF1             OFFSET TO UNIT ADDRESS   Y02072 43100002
         LA    RWK2,SPWMSGTX(RWK2)      POINT TO VAR IN WORKAREA Y02072 43150002
         MVC   0(L'UCBNAME,RWK2),UCBNAME   MOVE IN UCBNAME       Y02072 43200002
         DROP  RWK8                                                     43250002
*                                                                       43600020
* CLEAR REPLY AREA                                                      43700002
*                                                                       43800020
FCBLD130 EQU   *                                                        43830020
         MVI   SPWREPLY,BLANK           MOVE BLANK TO 1ST POSITION      44000002
         MVC   SPWREPC1,SPWREPLY        CLEAR REPLY AREA                44100002
         MVI   SPWRPECB,0               SET REPLY ECB NOT COMPLETE      44300002
         LA    RWK5,OKCOMP              SET RETURN CODE =00             44400002
         TM    SPRKEY,SPRUSKEY          TEST KEY FOR SYS FUNCT   Y02072 44450002
         BZ    FCBLD131                 YES, DO NOT SYNCH        Y02072 44460002
         SYNCH WTOR                     GO ISSUE WTOR IN         Y02072*44500002
                                        USER KEY, PROBLEM STATE  Y02072 44550002
         B     FCBLD132                 GO ISSUE WAIT            Y02072 44600002
FCBLD131 BAL   R14,WTOR                 GO ISSUE WTOR IN SYS KEY Y02072 44650002
*                                                                       44900020
FCBLD132 WAIT  ECB=SPWRPECB,LONG=YES    WAIT FOR OPERATOR REPLY  Y02072 45000002
         XC    SPWMSGID(4),SPWMSGID     CLEAR MSG ID           @ZA25004 45050048
*                                                                       45300020
* ANALYSIS OF REPLY                                                     45400002
*                                                                       45700020
         OC    SPWREPLY(L'LOWCASE),LOWCASE SET FOR LOWER CASE           45750002
         CLC   SPWREPLY(L'VERIFY01),VERIFY01 TEST REPLY='VERIFIED'      45800002
         BE    FCBLD110                 YES ISSUE SKIP CHANN 1 @ZA07594 45900010
         CLC   SPWREPLY(L'VERIFY02),VERIFY02  TEST REPLY='V'            46000010
         BE    FCBLD110                 YES ISSUE SKIP CHANN 1 @ZA07594 46100010
         CLC   SPWREPLY(L'CANCEL01),CANCEL01  TEST REPLY='CANCEL'       46200002
         BE    FCBLD135                 YES-SET RETURN CODE=14 @ZA10228 46300010
         CLC   SPWREPLY(L'CANCEL02),CANCEL02  TEST IF REPLY='C'         46370010
         BE    FCBLD135                 YES-SET RETURN CODE=14 @ZA10228 46440010
         CLC   SPWREPLY(L'RETRY01),RETRY01   TST IF REPLY=RETRY         46510002
         BE    FCBLD133                 YES GO CK IF VERIFY OR          46520020
*                                         ALIGN SPECIFIED               46530002
         CLC   SPWREPLY(L'RETRY02),RETRY02  TST IF REPLY = RETRY        46540002
         BE    FCBLD133                 YES GO CK IF VERIFY OR ALIGN    46550002
*                                         SPECIFIED, NO ISSUE REPEAT    46560002
*                                         REPLY MSG                     46600002
* ERROR IN REPLY - ISSUE 'IEC125I ERROR - REPEAT REPLY'                 46800002
*                                                                       46900020
         LA    RWK2,MSG125              REQUEST ERROR MSG        Y02072 47000002
         BAL   RRET,GETMSG              GET IT IN WORK AREA      Y02072 47050002
         B     FCBLD130                 GO CLEAR REPLY AREA AND         47100020
*                                         ISSUE MESSAGE                 47200002
FCBLD133 EQU   *                                                        47220020
         TM    SPWFLG1,SPWALIGN         TST IF ALIGN MSG RETRY   Y02072 47240002
         BO    FCBLD120                 YES, GO REPEAT ALIGN MSG Y02072 47242002
         NI    SPWFLG8,X'FF'-SPWVREND   NO, RESET END INDICATOR  Y02072 47244002
         LR    RWK4,RIMAGSAV            GET ADDR OF FCB IMAGE    Y02072 47244402
         B     FCBLD070                 GO RE-VERIFY IMAGE       Y02072 47246002
FCBLD135 EQU   *                                                        47400020
         LA    RWK5,OPRCANCL            SET RETURN CODE =14    @ZA10228 47600010
         B     FCBLD015                 GO RETURN TO PROB PROG          47700020
         EJECT                                                          47710002
EXCP     EQU   *                                                        47712002
*********************************************************************** 47720002
*        SUBROUTINE TO EXCP AND TEST RESULTS                            47750002
*        INPUT: IOB AND CHANNEL PROGRAM ARE READY FOR EXCP              47752002
*        ADDRESSIBILITY REQUIRED:                                       47754002
*               IOB                                                     47756002
*               SETPRT WORK AREA                                        47758002
*        OUTPUT:ECB IS POSTED COMPLETE, EXCP COMPLETED NORMALLY         47758402
*        OUTPUT, ERROR:  SKIP TO 0 CCW IS EXECUTED, RETURN CODE 16 SET  47758802
*        THIS ROUTINE NORMALLY RETURNS ON REGISTER RRET                 47759602
*        ON UNCORRECTABLE ERRORS IT BRANCHES TO EXIT FUNCTION           47759702
*        ALL REGISTERS EXCEPT R15,R0,R1 (AND RWK2=R1) ARE TRANSPARENT   47759802
*********************************************************************** 47760002
*                                                                       47800002
         OI    IOBFLAG1,IOBSPSVC        IND NO SAM APPENDAGE    ZA02199 47810003
*                                       PROCESSING REQUIRED     ZA02199 47820003
         EXCP  IOBSTDRD                 ISSUE REQUESTED EXCP            47850002
*                                                                       47900002
         L     R1,IOBECBPT              GET ADDRESS OF ECB              47910002
         WAIT  ECB=(1)                  WAIT FOR COMPLETION             47950002
         NI    IOBFLAG1,X'FF'-IOBSPSVC  RESET IOB FLAG          ZA02199 47952003
*                                                                       47960002
         L     RWK2,IOBECBPT            GET ADDR OF ECB                 47970002
         USING ECB,RWK2                                                 47980002
         CLI   ECBCC,ECBNORM            CK IF SKIP TO CH 1 SUCCESSFUL   47990002
         BNE   FCBLD140                 NO GO TO ERROR RTN              47992002
         NI    SPWFLG8,X'FF'-SPWRETRY   YES, CLEAR ERROR BIT     Y02072 47994002
         BR    RRET                     AND RETURN TO CALLER     Y02072 47996002
*                                                                       48000020
* ERROR ROUTINE - FOR ERRORS OCCURING WHILE PRINTING OUT THE FCB IMG    48100002
*                                                                       48400020
FCBLD140 EQU   *                                                        48500020
         TM    CSWSTAT1,CSWUNCHK        IF NOT UNIT CHECK        Y02072 48550002
         BNO   FCBLD160                 DON'T CONSIDER RETRY     Y02072 48600002
         TM    IOBSENS1,CMDRETRY        CK IF COMMAND RETRY ON          48700002
         BNO   FCBLD160                 NO GO SET RETURN CODE FOR       48800020
*                                         PERM I/O ERROR DURING VERIFY  48900002
* TEST IF PRINT LINE SHOULD BE RETRIED                                  49100002
*                                                                       49200020
         TM    SPWFLG8,SPWRETRY         ARE WE ALREADY RETRYING  Y02072 49300002
         BNZ   FCBLD150                 YES GO RESET CONTROL UNIT       49700020
         OI    SPWFLG8,SPWRETRY         NO, INDICATE WE WILL     Y02072 49800002
         B     FCBLD100                 GO RETRY PRINT LINE             49900020
FCBLD150 EQU   *                                                        50100020
         MVC   SPWCCW1,SKP0CCW          REPLACE 1ST CCW          Y02072 50300002
         OI    IOBFLAG1,IOBSPSVC        IND NO SAM APPENDAGE    ZA02199 50350003
*                                       PROCESSING REQUIRED     ZA02199 50400003
         EXCP  IOBSTDRD                 ISSUE RESET FOR CONTROL UNIT    50700002
*                                                                       50950002
         L     R1,IOBECBPT              GET ADDRESS OF ECB              50960002
         WAIT  ECB=(1)                  ISSUE WAIT FOR SKIP TO 0        51000020
         NI    IOBFLAG1,X'FF'-IOBSPSVC  RESET IOB FLAG          ZA02199 51050003
*                                                                       51100020
FCBLD160 EQU   *                                                        51200020
         LA    RWK5,PERMIOEV            SET RETURN CODE=10              51400002
         B     FCBLD030                 GO TO EXIT ROUTINE              51500020
         SPACE 6                                                        51510002
*                                                                       51512002
* THE FOLLOWING WTOR IS EXECUTED IN PROBLEM STATE, SINCE THE            51520002
* MESSAGE AREA IS IN CORE (THE SETPRT WORK AREA) ACCESSIBLE             51530002
* TO THE USER.  THIS CAUSES WTOR TO MARK THE MESSAGE AS A               51540002
* USER REQUEST (LEADING + ADDED), AND ALERTS THE OPERATOR               51542002
* THAT NO CRITICAL FUNCTION IS BEING REQUESTED.                         51544002
*                                                                       51546002
WTOR     WTOR  MF=(E,SPWRPLYA)          ISSUE MESSAGE WITH REPLY Y02072 51548002
         ST    R1,SPWMSGID              SAVE MSG ID FOR DOM    @ZA25004 51548148
         OI    SPWMSGID,X'80'           SET HIGH ORDER BIT     @ZA25004 51548248
         BR    R14                      RETURN TO SYNCH          Y02072 51548402
         EJECT                                                          51550402
*********************************************************************** 51552002
*        THIS SUBROUTINE FINDS A MESSAGE IN THE MESSAGE CSECT           51554002
*        AND (UNLESS SUPPRESSED) MOVES IT INTO THE SETPRINT WORK AREA   51556002
*        INPUT: RWK2 CONTAINS AN INDEX OFFSET (MSG NUMBER * 2)          51558002
*               SPRMSG CONTAINS THE ADDRESS OF THE MESSAGE CSECT        51558402
*               SPWNOMOV IS ON IF MOVE SHOULD BE SUPPRESSED             51558502
*        ADDRESSIBILITY REQUIRED:                                       51558802
*               SVRB EXTENDED SAVE AREA                                 51559202
*               SETPRT WORK AREA                                        51559602
*        OUTPUT:RWK2 POINTS TO MESSAGE TEXT IN MSG CSECT                51559702
*               RWK8 POINTS TO THE MSG ENTRY IN MSG CSECT               51559802
*               SPWMSGTX CONTAINS A COPY OF THE MESSAGE TEXT            51559902
*               (UNLESS MOVE SUPPRESSED BY SPWNOMOV)                    51562002
*        THIS ROUTINE RETURNS ON REGISTER RRET                          51563202
*        ALL REGISTERS EXCEPT RWK2 AND RWK8 ARE TRANSPARENT             51565202
*********************************************************************** 51565602
GETMSG   L     RWK8,SPRMSG              PICK UP MSG CSECT ADDR   Y02072 51566002
         USING MSGINDEX,RWK8                                     Y02072 51566402
         AH    RWK8,MSGINDOF(RWK2)      ADD ENTRY OFFSET         Y02072 51566502
         USING MSGENTRY,RWK8                                     Y02072 51566602
         SR    RWK2,RWK2                                         Y02072 51569902
         IC    RWK2,MSGOFF              PICK UP TEXT OFFSET      Y02072 51571902
         AR    RWK2,RWK8                GET PTR TO TEXT          Y02072 51572302
         USING MSGTXT,RWK2                                       Y02072 51572702
         TM    SPWFLG8,SPWNOMOV         IF MOVE SHOULD BE        Y02072 51572802
         BOR   RRET                     BYPASSED, RETURN         Y02072 51572902
         MVC   SPWMSGTX,MSGTXT          MOVE TEXT INTO WORK AREA Y02072 51573102
         BR    RRET                     RETURN TO CALLER         Y02072 51573202
         DROP  RWK2,RWK8                                         Y02072 51573302
         DROP  RDEB,RUCB                                         Y02072 51575302
         EJECT                                                          51575702
SETUCB   EQU   *                                                 Y02072 51577302
*********************************************************************** 51577702
*        THIS ROUTINE UPDATES THE UCB                                   51578102
*        TO PERFORM THIS FUNCTION IT MUST VALIDATE THAT:                51578502
*        1. A PROTECTED CHAIN LEADS TO THE UCB                          51579002
*        2. THE UCB IS ALLOCATED TO THE JOB REQUESTING SETPRT           51579402
*        BOTH OF THESE ARE SATISFIED BY DEBCHK, SO LONG AS THERE        51579802
*        IS NO TIME OF CHECK TO TIME OF USE EXPOSURE.                   51579902
*        THAT EXPOSURE IS COVERED BY RUNNING WITH THE LOCAL LOCK.       51589902
*        INPUT: SPWFCB2H CONTAINS THE FCB ID TO PLACE IN THE UCB        51599902
*               SPWFCBOP IN FLG8 IS ON IF OPTIONS SHOULD BE UPDATED     51609902
*               IF ON, FCBDEFLT CONTAINS THE OPTIONS                    51611902
*               IF ON, RWK4 MUST POINT TO FCBIMAGE             @ZA19734 51612310
*        ADDRESSIBILITY REQUIRED:                                       51615202
*               SVRB EXTENDED SAVE AREA                                 51615602
*               SETPRT WORK AREA                                        51615702
*        OUTPUT:UCBFCBID AND (OPTIONALLY) UCBFCBOP ARE UPDATED (NORMAL) 51616002
*               THE SAVE AREA SPRSAVE IN SVRB IS USED                   51616402
*               IF DEB NOT VALID, DOES NOT RETURN TO SUBROUTINE CALLER, 51616502
*               INSTEAD SETS RETURN CODE AND EXITS                      51616602
*        THIS ROUTINE RETURNS ON REGISTER RRET                          51619902
*        ALL REGISTERS EXCEPT R15 AND R1 (= RWK2) ARE TRANSPARENT       51621902
*********************************************************************** 51622302
         MODESET EXTKEY=ZERO            CHANGE TO KEY FOR BR ENT Y02072 51622702
         SPACE                                                          51623102
         STM   R10,R14,SPRSAVE          SAVE VOLATILE REGS       Y02072 51623202
LOCK     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02072*51623302
               RELATED=(DEB/UCB,UNLOCK) GET THE LOCAL LOCK       Y02072 51626602
         L     R10,CVTPTR               FIND CVT                 Y02072 51628602
         USING CVT,R10                                           Y02072 51629002
         L     R15,CVTEXT2              FIND CVT EXTENSION       Y02072 51629402
         USING CVTXTNT2,R15                                      Y02072 51629802
         L     R15,CVTDEBVR             GET PTR TO DEBCHK        Y02072 51629902
         L     R14,SPPDCBA              GET DCB ADDR             YM5919 51631902
         USING IHADCB,R14               TEMP USING               YM5919 51633902
         L     R1,DCBDEBAD              GET DEB ADDRESS          YM5703 51634302
         LA    R1,0(R1)                 CLEAR HI-BYTE            YM5703 51634702
         DROP  R14,R15                                           YM5919 51634802
         USING PSA,0                                             Y02072 51644902
         L     R10,PSATOLD              FIND CURRENT TCB         Y02072 51649902
         DROP  R10                                               Y02072 51654902
         BALR  R14,R15                  CALL DEBCHK              Y02072 51659902
*                                                                       51661902
*  DEBCHK RETURNS ON REGISTER 14 PLUS THE CONTENTS OF REG 15     YM5703 51663902
*    REG 15 : 0 - DEB VALID                                      YM5703 51665902
*             4 - DEB INVALID                                    YM5703 51667902
*  REGARDLESS OF DEBCHK RETURN, THE LOCAL LOCK MUST BE RELEASED  YM5703 51668302
*  AS SVC'S CANNOT BE ISSUED WHILE HOLDING THE LOCK.             YM5703 51668702
*                                                                       51669102
         B     DEBOK                    DEB VALID--PTR IN R1     Y02072 51669902
         B     UNLOCK                   INVALID--GET OUT         YM5703 51674902
DEBOK    EQU   *                                                 Y02072 51679902
         USING DEBDASD-(DEBBASND-DEBBASIC),R1                    Y02072 51684902
         L     RWK2,DEBUCBAD            FIND UCB                 Y02072 51689902
         DROP  R1                                                Y02072 51699902
         USING SRT,RWK2                                          Y02072 51709902
         L     RWK2,UCBXTADR            FIND UCS EXTENSION       Y02072 51719902
         USING UCBUCS,RWK2                                       Y02072 51729902
         LM    R10,R14,SPRSAVE          RESTORE VOLATILE REGS    Y02072 51731902
         TM    SPWFLG1,NOFCBLD          FCB LOADED?            @ZA30716 51732548
         BO    UNLOCK                   NO-DONT UPDATE FCB     @ZA30716 51733148
         MVC   UCBFCBID,SPWFCB2H        STORE FCB ID             Y02072 51733902
         TM    SPWFLG8,SPWFCBOP         IF NO OPTIONS REQUEST,   Y02072 51735902
         BZ    UNLOCK                   BYPASS OPTIONS STORE     Y02072 51736302
         USING FCBIMBEG,RWK4                                   @ZA19734 51736710
         MVC   UCBFCBOP,FCBDEFLT        MOVE IN FCB OPTION       Y02072 51737010
         DROP  RWK4                                            @ZA19734 51737310
UNLOCK   SETLOCK RELEASE,TYPE=LOCAL,RELATED=(DEB/UCB,LOCK)       Y02072 51737902
         LM    R10,R14,SPRSAVE          RESTORE VOLATILE REGS    Y02072 51738302
         SPACE                                                          51738402
         MODESET KEYADDR=SPRKEY,WORKREG=1  RESUME NORMAL KEY     Y02072 51738702
         SPACE                                                          51738802
         LTR   R15,R15                  WAS DEB VALID            YM5703 51739102
         BZR   RRET                     YES, CONTINUE            YM5703 51739202
*                                                                       51739502
NOTOPEN  ICM   RPAR,B'1000',=AL1(RCNOPEN) SET DCB NOT OPEN       Y02072 51739602
*                                         AS UCS ERROR CODE      Y02072 51749602
         SR    RWK5,RWK5                NO FCB ERROR CODE        Y02072 51762102
         B     FCBLD040                 GO GET OUT               Y02072 51764902
         EJECT                                                          51777402
*                                                                       51789902
* CONSTANTS                                                             51839902
*                                                                       51889902
SKP0CCW  CCW   SPWSKIP0,0,SPWSILI,1     SKIP TO CHANNEL 0 CCW           51939902
LOWCASE  DC    CL10' '                  TO ALLOW LOWER CASE REPLYS      52350002
BLANKFLD EQU   LOWCASE                  TO BLANK A FIELD                52360002
VERIFY01 DC    C'VERIFIED'              REPLY=VERIFIED                  52400020
VERIFY02 DC    C'V '                    REPLY='V'                       52500020
CANCEL01 DC    C'CANCEL'                REPLY=CANCEL                    52600020
CANCEL02 DC    C'C '                    REPLY='C'                       52700020
RETRY01  DC    C'R '                    CONST FOR RETRY                 52730020
RETRY02  DC    C'RETRY'                 RETRY CONST                     52760020
         DS    0H                       SET ON HALF WORD BDY            52810048
TRANSTAB DC    C'00010203040506070809101112'                            53000020
*                                                                       54000020
* PATCH AREA                                                            54100002
*                                                                       54200020
PATCH    DC    25H'0'                   PATCH AREA               YM4640 54210002
END      EQU   *                        END OF MODULE            Y02072 54212002
         TITLE 'IGG08104 - SYSTEM DESECTS'                       YM4640 54270002
         CVT   DSECT=YES                                         Y02072 54320002
         EJECT                                                          54330002
         DCBD  DSORG=PS                                                 56800020
         EJECT                                                          56850002
         IEZDEB                                                         56900002
         EJECT                                                          56950002
         IHAECB                                                         57000002
         EJECT                                                          57910002
         IHAFCBIM                                                       57920002
         EJECT                                                          57950002
         IEZIOB                                                         58000002
         EJECT                                                          58050002
         ORG   IOBCSW-1                                                 58100002
         IHACSW DSECT=NO                                                58150002
         EJECT                                                          58200002
         IGGMSG                                                  Y02072 58202002
         EJECT                                                          58204002
         IHAPSA                                                  Y02072 58204402
         EJECT                                                          58206002
         IHASPP                                                         58208002
         EJECT                                                          58208402
         IGGSPW                                                         58208802
         EJECT                                                          58210002
SRT      DSECT                                                          58250002
         IEFUCBOB  LIST=YES                                             58300002
         END                                                            58800020
./  ADD  SSI=33000030,NAME=IGG1AN
         TITLE '  IGG1AN -  IBM STANDARD UCS IMAGE - AN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1AN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=AN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - AN - ALPHANUMERIC (48 GRAPHICS)            00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE AN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDAN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNAN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1AN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             AN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1AN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDAN   CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04050002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04100002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04150002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04200002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04250002
IGGNAN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04500002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04550002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04600002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04650002
         DC    C'1234567890#@/STUVWXYZ&&,%JKLMNOPQR-$*ABCDEFGHI+.<'     04700002
         END                                                            04750002
./  ADD  SSI=33000031,NAME=IGG1HN
         TITLE '  IGG1HN -  IBM STANDARD UCS IMAGE - HN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1HN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=HN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - HN - ALPHANUMERIC (48 GRAPHICS)            00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE HN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDHN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNHN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1HN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             HN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1HN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDHN   CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04050002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04100002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04150002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04200002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04250002
IGGNHN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04500002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04550002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04600002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04650002
         DC    C'1234567890=''/STUVWXYZ&&,(JKLMNOPQR-$*ABCDEFGHI+.)'    04700002
         END                                                            04750002
./  ADD  SSI=33000032,NAME=IGG1PCAN
         TITLE '  IGG1PCAN -  IBM STANDARD UCS IMAGE - PCAN   '         00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1PCAN                                            00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=PCAN                            00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - PCAN - PREFFERRED CHARACTER SET            00600002
*                                             (48 GRAPHICS)             00610002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE PCAN                   00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDPCAN AND THE FLAG BYTE IS X'80'   00850002
*              THE SECOND IS NAMED IGGNPCAN AND THE FLAG BYTE IS X'0'   00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1PCAN.  THE ONE TO BE   01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             PCAN IS TO BE A DEFAULT IMAGE.                            01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1PCAN                                              02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDPCAN CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890,-PQR#$@/STUVWXYZ<.*1234567890,-JKLMNOABCDEFC04050002
               GHI+.*'                                                  04100002
         DC    C'1234567890,-PQR&&$%/STUVWXYZ<.*1234567890,-JKLMNOABCDEC04150002
               FGHI+.*'                                                 04200002
         DC    C'1234567890,-PQR#$@/STUVWXYZ<.*1234567890,-JKLMNOABCDEFC04250002
               GHI+.*'                                                  04260002
         DC    C'1234567890,-PQR&&$%/STUVWXYZ<.*1234567890,-JKLMNOABCDEC04270002
               FGHI+.*'                                                 04280002
IGGNPCAN CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890,-PQR#$@/STUVWXYZ<.*1234567890,-JKLMNOABCDEFC04500002
               GHI+.*'                                                  04550002
         DC    C'1234567890,-PQR&&$%/STUVWXYZ<.*1234567890,-JKLMNOABCDEC04600002
               FGHI+.*'                                                 04650002
         DC    C'1234567890,-PQR#$@/STUVWXYZ<.*1234567890,-JKLMNOABCDEFC04700002
               GHI+.*'                                                  04710002
         DC    C'1234567890,-PQR&&$%/STUVWXYZ<.*1234567890,-JKLMNOABCDEC04720002
               FGHI+.*'                                                 04730002
         END                                                            04750002
./  ADD  SSI=33000033,NAME=IGG1PCHN
         TITLE '  IGG1PCHN -  IBM STANDARD UCS IMAGE - PCHN   '         00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1PCHN                                            00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=PCHN                            00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - PCHN - PREFERRED CHARACTER SET             00600002
*                                            (48 GRAPHICS)              00610002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE PCHN                   00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDPCHN AND THE FLAG BYTE IS X'80'   00850002
*              THE SECOND IS NAMED IGGNPCHN AND THE FLAG BYTE IS X'0'   00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1PCHN.  THE ONE TO BE   01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             PCHN IS TO BE A DEFAULT IMAGE.                            01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1PCHN                                              02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDPCHN CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890,-PQR=$''/STUVWXYZ).*1234567890,-JKLMNOABCDEC04050002
               FGHI+.*'                                                 04100002
         DC    C'1234567890,-PQR&&$(/STUVWXYZ).*1234567890,-JKLMNOABCDEC04150002
               FGHI+.*'                                                 04200002
         DC    C'1234567890,-PQR=$''/STUVWXYZ).*1234567890,-JKLMNOABCDEC04250002
               FGHI+.*'                                                 04260002
         DC    C'1234567890,-PQR&&$(/STUVWXYZ).*1234567890,-JKLMNOABCDEC04270002
               FGHI+.*'                                                 04280002
IGGNPCHN CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890,-PQR=$''/STUVWXYZ).*1234567890,-JKLMNOABCDEC04500002
               FGHI+.*'                                                 04550002
         DC    C'1234567890,-PQR&&$(/STUVWXYZ).*1234567890,-JKLMNOABCDEC04600002
               FGHI+.*'                                                 04650002
         DC    C'1234567890,-PQR=$''/STUVWXYZ).*1234567890,-JKLMNOABCDEC04700002
               FGHI+.*'                                                 04710002
         DC    C'1234567890,-PQR&&$(/STUVWXYZ).*1234567890,-JKLMNOABCDEC04720002
               FGHI+.*'                                                 04730002
         END                                                            04750002
./  ADD  SSI=33000041,NAME=IGG1PN
         TITLE '  IGG1PN -  IBM STANDARD UCS IMAGE - PN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1PN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=PN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - QN - PL/1 (60 GRAPHICS)                    00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE PN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDPN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNPN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1PN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             PN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1PN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDPN   CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04050002
               @<;''?>'                                                04100002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04150002
               @<;''?>'                                                04200002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04250002
               @<;''?>'                                                04260002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04270002
               @<;''?>'                                                04280002
IGGNPN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04500002
               @<;''?>'                                                04550002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04600002
               @<;''?>'                                                04650002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04700002
               @<;''?>'                                                04710002
         DC    C'1234567890XY/STUVW|:_",=JKLMNOPQR-Z(ABCDEFGHI+.)%$*#&&C04720002
               @<;''?>'                                                04730002
         END                                                            04750002
./  ADD  SSI=33000042,NAME=IGG1QN
         TITLE '  IGG1QN -  IBM STANDARD UCS IMAGE - QN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1QN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=QN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - QN - PL/1 (60 GRAPHICS - 45 PREFERRED)     00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE QN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDQN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNQN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1QN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             QN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1QN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDQN   CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890XY/STUVW_"$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04050002
         DC    C'1234567890XY/STUVW<;#*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04100002
         DC    C'1234567890XY/STUVW?>@*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04150002
         DC    C'1234567890XY/STUVW''&&*,=JKLMNOPQR-Z(ABCDEFGHI+.)'    04200002
         DC    C'1234567890XY/STUVW|:%*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04250002
IGGNQN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890XY/STUVW_"$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04500002
         DC    C'1234567890XY/STUVW<;#*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04550002
         DC    C'1234567890XY/STUVW?>@*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04600002
         DC    C'1234567890XY/STUVW''&&*,=JKLMNOPQR-Z(ABCDEFGHI+.)'    04650002
         DC    C'1234567890XY/STUVW|:%*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04700002
         END                                                            04750002
./  ADD  SSI=33000043,NAME=IGG1QNC
         TITLE '  IGG1QNC -  IBM STANDARD UCS IMAGE - QNC   '           00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1QNC                                             00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=QNC                             00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - QNC - PL/1 (60 GRAPHICS - 45 PREFERRED)    00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE QNC                    00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDQNC AND THE FLAG BYTE IS X'80'    00850002
*              THE SECOND IS NAMED IGGNQNC AND THE FLAG BYTE IS X'0'    00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1QNC.  THE ONE TO BE    01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             QNC IS TO BE A DEFAULT IMAGE.                             01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1QNC                                               02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDQNC  CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI",='     04050002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI|:_'     04100002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI<;'     04150002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI''?>'    04200002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI)+('     04250002
IGGNQNC  CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI",='     04500002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI|:_'     04550002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI<;'     04600002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI''?>'    04650002
         DC    C'1234567890#@/STUVWXYZ&&.%JKLMNOPQR-$*ABCDEFGHI)+('     04700002
         END                                                            04750002
./  ADD  SSI=33000044,NAME=IGG1RN
         TITLE '  IGG1RN -  IBM STANDARD UCS IMAGE - RN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1RN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=RN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - RN - FORTRAN-COBOL-COMMERCIAL              00600002
*                                    (52 GRAPHICS-47 PREFERRED)         00610002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE RN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDRN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNRN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1RN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             RN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1RN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDRN   CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04000002
         DC    C'1234567890XY/STUVW''@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'     04050002
         DC    C'1234567890XY/STUVW%@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04100002
         DC    C'1234567890XY/STUVW#@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04150002
         DC    C'1234567890XY/STUVW<@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04200002
         DC    C'1234567890XY/STUVW&&@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'     04250002
IGGNRN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(5)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    5AL1(48)                 NO. OF CHARS. PER LINE          04450002
         DC    C'1234567890XY/STUVW''@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'     04500002
         DC    C'1234567890XY/STUVW%@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04550002
         DC    C'1234567890XY/STUVW#@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04600002
         DC    C'1234567890XY/STUVW<@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'      04650002
         DC    C'1234567890XY/STUVW&&@$*,=JKLMNOPQR-Z(ABCDEFGHI+.)'     04700002
         END                                                            04750002
./  ADD  SSI=62510189,NAME=IGG1SN
         TITLE '  IGG1SN -  IBM STANDARD UCS IMAGE - SN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1SN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=SN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - SN - TEXT PRINTING                         00600002
*                                         (84 GRAPHICS-78 PREFERRED)    00610002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE SN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDSN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNSN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1SN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             SN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1SN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDSN   CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(3)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    AL1(78)                  NO. OF CHARS. FIRST LINE        04000002
         DC    AL1(78)                  NO. OF CHARS. SECOND LINE       04010002
         DC    AL1(84)                  NO. OF CHARS. THIRD LINE        04020002
         DC    C'1234567890&&./STUVWXYZ,$*JKLMNOPQR-":ABCDEFGHI+abcdefgC04070037
               hijklmnopqrstuvwxyz@''()|'                     @ZA12237 04100037
         DC    C'1234567890&&./STUVWXYZ,$*JKLMNOPQR-":ABCDEFGHI+abcdefgC04130037
               hijklmnopqrstuvwxyz@''()|'                     @ZA12237 04160037
         DC    C'1234567890&&./STUVWXYZ,$*JKLMNOPQR-":ABCDEFGHI+abcdefgC04190037
               hijklmnopqrstuvwxyz@''()|?!;%<'               @ZA12237 04220037
IGGNSN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(3)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    AL1(78)                  NO. OF CHARS. FIRST LINE        04450002
         DC    AL1(78)                  NO. OF CHARS. SECOND LINE       04460002
         DC    AL1(84)                  NO. OF CHARS. THIRD LINE        04470002
         DC    C'1234567890&&./STUVWXYZ,$*JKLMNOPQR-":ABCDEFGHI+abcdefgC04520037
               hijklmnopqrstuvwxyz@''()|'                     @ZA12237 07520037
         DC    C'1234567890&&./STUVWXYZ,$*JKLMNOPQR-":ABCDEFGHI+abcdefgC10520037
               hijklmnopqrstuvwxyz@''()|'                     @ZA12237 13520037
         DC    C'1234567890&&./STUVWXYZ,$*JKLMNOPQR-":ABCDEFGHI+abcdefgC16520037
               hijklmnopqrstuvwxyz@''()|?!;%<'               @ZA12237 19520037
         END                                                            22520037
./  ADD  SSI=81300237,NAME=IGG1TN
         TITLE '  IGG1TN -  IBM STANDARD UCS IMAGE - TN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1TN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=TN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - TN - TEXT PRINTING (120 GRAPHICS)          00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE TN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDTN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNTN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1TN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             TN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1TN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*     VS2037 CHANGES                                           @ZA10603 03610037
*     C042000,046500                                           @ZA10603 03620037
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
*                                                               YM5768  03760002
**** END OF SPECIFICATIONS ***/                                         03800002
UCS1TN   CSECT                                                          03850037
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04000002
         DC    X'F1F2F3F4F5F6F7F8F9F07E4B61E2E3E4E5E6E7E8E96B7B50D1D2D3*04050002
               D4D5D6D7D8D9607F7AC1C2C3C4C5C6C7C8C94E818283848586878889*04100002
               919293949596979899A2A3A4A5A6A7A8A97C7D6F5E9E5A5B5C6C'    04150002
         DC    X'9CB1B2B3B4B5B6B7B8B9B0A08E8D9DA15F4D5DBE8F6E4C8CAE4A9F*04200037
               ADBD9B8BABBBACBCAF6DBF4F'                                04250002
         DC    X'F1F2F3F4F5F6F7F8F9F07E4B61E2E3E4E5E6E7E8E96B7B50D1D2D3*04260002
               D4D5D6D7D8D9607F7AC1C2C3C4C5C6C7C8C94E818283848586878889*04270002
               919293949596979899A2A3A4A5A6A7A8A97C7D6F5E9E5A5B5C6C'    04280002
         DC    X'9CB1B2B3B4B5B6B7B8B9B0A08E8D9DA15F4D5DBE8F6E4C8CAE4A9F*04290037
               ADBD9B8BABBBACBCAF6DBF4F'                                04292002
IGGNTN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(4)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    4AL1(60)                 NO. OF CHARS. PER LINE          04450002
         DC    X'F1F2F3F4F5F6F7F8F9F07E4B61E2E3E4E5E6E7E8E96B7B50D1D2D3*04500002
               D4D5D6D7D8D9607F7AC1C2C3C4C5C6C7C8C94E818283848586878889*04550002
               919293949596979899A2A3A4A5A6A7A8A97C7D6F5E9E5A5B5C6C'    04600002
         DC    X'9CB1B2B3B4B5B6B7B8B9B0A08E8D9DA15F4D5DBE8F6E4C8CAE4A9F*04650037
               ADBD9B8BABBBACBCAF6DBF4F'                                04700002
         DC    X'F1F2F3F4F5F6F7F8F9F07E4B61E2E3E4E5E6E7E8E96B7B50D1D2D3*04710002
               D4D5D6D7D8D9607F7AC1C2C3C4C5C6C7C8C94E818283848586878889*04720002
               919293949596979899A2A3A4A5A6A7A8A97C7D6F5E9E5A5B5C6C'    04730002
         DC    X'9CB1B2B3B4B5B6B7B8B9B0A08E8D9DA15F4D5DBE8F6E4C8CAE4A9F*04740037
               ADBD9B8BABBBACBCAF6DBF4F'                                07740037
         END                                                            10740037
./  ADD  SSI=33000052,NAME=IGG1XN
         TITLE '  IGG1XN -  IBM STANDARD UCS IMAGE - XN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1XN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=XN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - XN - HIGH SPEED ALPHAMERIC (40 GRAPHICS)   00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE XN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDXN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNXN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1XN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             XN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1XN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDXN   CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(6)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    6AL1(40)                 NO. OF CHARS. PER LINE          04000002
         DC    6C'1234567890,.ABCDEFGHIZJKLMNOPQR*$STUVWXY'             04050002
IGGNXN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(6)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    6AL1(40)                 NO. OF CHARS. PER LINE          04450002
         DC    6C'1234567890,.ABCDEFGHIZJKLMNOPQR*$STUVWXY'             04500002
         END                                                            04800002
./  ADD  SSI=33000053,NAME=IGG1YN
         TITLE '  IGG1YN -  IBM STANDARD UCS IMAGE - YN   '             00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG1YN                                              00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=YN                              00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - YN - HIGH SPEED ALPHANUMERIC               00600002
*                                     (42 GRAPHICS-39 PREFERRED)        00620002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE YN                     00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDYN AND THE FLAG BYTE IS X'80'     00850002
*              THE SECOND IS NAMED IGGNYN AND THE FLAG BYTE IS X'0'     00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS1YN.  THE ONE TO BE     01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             YN IS TO BE A DEFAULT IMAGE.                              01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 500 BYTES                                           01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG1YN                                                02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDYN CSECT                                                            03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(6)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    AL1(39)                 CHARACTERS ON FIRST LINE         03970002
         DC    AL1(42)                 CHARACTERS ON SECOND LINE        03990002
         DC    AL1(39)                 CHARACTERS ON THIRD LINE         04010002
         DC    AL1(39)                 CHARACTERS ON FOURTH LINE        04030002
         DC    AL1(42)                 CHARACTERS ON FIFTH LINE         04050002
         DC    AL1(39)                 CHARACTERS ON SIXTH LINE         04070002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               04090002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.#-$'            04110002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               04130002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               04150002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.#-$'            04170002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               04190002
IGGNYN   CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(6)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    AL1(39)                 CHARACTERS ON FIRST LINE         04450002
         DC    AL1(42)                 CHARACTERS ON SECOND LINE        04500002
         DC    AL1(39)                 CHARACTERS ON THIRD LINE         04550002
         DC    AL1(39)                 CHARACTERS ON FOURTH LINE        04600002
         DC    AL1(42)                 CHARACTERS ON FIFTH LINE         04650002
         DC    AL1(39)                 CHARACTERS ON SIXTH LINE         04700002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               04750002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.#-$'            04800002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               04850002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               04900002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.#-$'            04950002
         DC    C'1234567890STABCDEFGHIJKLMNOPQRUVWXYZ*,.'               05000002
         END                                                            05050002
./  ADD  SSI=33000054,NAME=IGG2A11
         TITLE '  IGG2A11 -  IBM STANDARD UCS IMAGE - A11   '           00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG2A11                                             00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=A11                             00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - A11 - STANDARD COMMERCIAL (48 GRAPHICS)    00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE A11                    00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDA11 AND THE FLAG BYTE IS X'80'    00850002
*              THE SECOND IS NAMED IGGNA11 AND THE FLAG BYTE IS X'0'    00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS2A11.  THE ONE TO BE    01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             A11 IS TO BE A DEFAULT IMAGE.                             01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 1046 BYTES                                          01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG2A11                                               02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDA11 CSECT                                                           03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(9)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    9AL1(48)                 NO. OF CHARS. PER LINE          04000002
         DC    9C'1<.+IHGFEDCBA*$-RQPONMLKJ%,&&ZYXWVUTS/@#098765432'    04050002
*                                                                       04100002
*        BLANK SPACE                                                    04150002
*                                                                       04200002
         DC    X'C1F1F1000000000000000000000000C0'                      04250002
*                                                                       04260002
*        ASSOCIATIVE BITS - 64 BYTES                                    04270002
*                                                                       04280002
         DC    X'101010101010101010004040424000401010101010101010100040X04290002
               40410000404010101010101010100040400000001010101010101010X04292002
               101000404044480000'                                      04294002
IGGNA11  CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(9)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    9AL1(48)                 NO. OF CHARS. PER LINE          04450002
         DC    9C'1<.+IHGFEDCBA*$-RQPONMLKJ%,&&ZYXWVUTS/@#098765432'    04500002
*                                                                       04550002
*        BLANK SPACE                                                    04600002
*                                                                       04650002
         DC    X'C1F1F1000000000000000000000000C0'                      04700002
*                                                                       04750002
*        ASSOCIATIVE BITS - 64 BYTES                                    04800002
*                                                                       04850002
         DC    X'101010101010101010004040424000401010101010101010100040X04900002
               40410000404010101010101010100040400000001010101010101010X04950002
               101000404044480000'                                      05000002
         END                                                            05050002
./  ADD  SSI=33000055,NAME=IGG2G11
         TITLE '  IGG2G11 -  IBM STANDARD UCS IMAGE - G11   '           00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG2G11                                             00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=G11                             00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - G11 - ASCII (63 GRAPHICS)                  00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE G11                    00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDG11 AND THE FLAG BYTE IS X'80'    00850002
*              THE SECOND IS NAMED IGGNG11 AND THE FLAG BYTE IS X'0'    00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS2G11.  THE ONE TO BE    01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             G11 IS TO BE A DEFAULT IMAGE.                             01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 1060 BYTES                                          01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG2G11                                               02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDG11  CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(16)                  NO. OF LINES FOR VERIFICATION   03950002
         DC    16AL1(27)                NO. OF CHARS. PER LINE          04000002
         DC    4C'1''BDJL-5K*C(N0?)SA@=E#R>V92\YTG68XF"H.|UO7/P3WMIQX04050002
               ,41''BDJL-5K*C(N0$)SA&&=E:#RZV92;YT+G68<XF%H._UO7/P3WMIQX04100002
               ,4'                                                      04150002
*                                                                       04200002
*        BLANK BYTES                                                    04250002
*                                                                       04260002
         DC    X'C7F1F1000000000000000000000000C0'                      04270002
*                                                                       04280002
*        ASSOCIATIVE BITS - 64 BYTES                                    04290002
*                                                                       04292002
         DC    X'101010101010101010004040404040401010101010101010100040X04294002
               40404040504010101010101010100040406040401010101010101010X04296002
               101040404060404000'                                      04298002
IGGNG11  CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(16)                  NO. OF LINES FOR VERIFICATION   04400002
         DC    16AL1(27)                NO. OF CHARS. PER LINE          04450002
         DC    4C'1''BDJL-5K*C(N0?)SA@=E#R>V92\YTG68XF"H.|UO7/P3WMIQX04500002
               ,41''BDJL-5K*C(N0$)SA&&=E:#RZV92;YT+G68<XF%H._UO7/P3WMIQX04550002
               ,4'                                                      04600002
*                                                                       04650002
*        BLANK BYTES                                                    04700002
*                                                                       04750002
         DC    X'C7F1F1000000000000000000000000C0'                      04800002
*                                                                       04850002
*        ASSOCIATIVE BITS - 64 BYTES                                    04900002
*                                                                       04950002
         DC    X'101010101010101010004040404040401010101010101010100040X05000002
               40404040504010101010101010100040406040401010101010101010X05050002
               101040404060404000'                                      05100002
 END                                                                    05150002
./  ADD  SSI=33000076,NAME=IGG2H11
         TITLE '  IGG2H11 -  IBM STANDARD UCS IMAGE - H11   '           00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG2H11                                             00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=H11                             00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - H11 - STANDARD SCIENTIFIC (48 GRAPHICS)    00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE H11                    00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDH11 AND THE FLAG BYTE IS X'80'    00850002
*              THE SECOND IS NAMED IGGNH11 AND THE FLAG BYTE IS X'0'    00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS2H11.  THE ONE TO BE    01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             H11 IS TO BE A DEFAULT IMAGE.                             01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 1046 BYTES                                          01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG2H11                                               02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDH11  CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(9)                   NO. OF LINES FOR VERIFICATION   03950002
         DC    9AL1(48)                 NO. OF CHARS. PER LINE          04000002
         DC    9C'1HGFE<.+IDCBA*$-RQPONMLKJ%,&&ZYXWV8765@#09UTS/432'    04050002
*                                                                       04100002
*        BLANK SPACE                                                    04150002
*                                                                       04200002
         DC    X'C8F1F1000000000000000000000000C0'                M4070 04250002
*                                                                       04260002
*        ASSOCIATIVE BITS - 64 BYTES                                    04270002
*                                                                       04280002
         DC    X'101010101010101010004040424000401010101010101010100040X04290002
               40410000404010101010101010100040400000001010101010101010X04292002
               101000404044480000'                                      04294002
IGGNH11  CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(9)                   NO. OF LINES FOR VERIFICATION   04400002
         DC    9AL1(48)                 NO. OF CHARS. PER LINE          04450002
         DC    9C'1HGFE<.+IDCBA*$-RQPONMLKJ%,&&ZYXWV8765@#09UTS/432'    04500002
*                                                                       04550002
*        BLANK SPACE                                                    04600002
*                                                                       04650002
         DC    X'C8F1F1000000000000000000000000C0'                M4070 04700002
*                                                                       04710002
*        ASSOCIATIVE BITS - 64 BYTES                                    04720002
*                                                                       04730002
         DC    X'101010101010101010004040424000401010101010101010100040X04740002
               40410000404010101010101010100040400000001010101010101010X04742002
               101000404044480000'                                      04744002
         END                                                            04750002
./  ADD  SSI=33000077,NAME=IGG2P11
         TITLE '  IGG2P11 -  IBM STANDARD UCS IMAGE - P11   '           00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG2P11                                             00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=P11                             00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - P11 - PL/1 (60 GRAPHICS)                   00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE P11                    00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDP11 AND THE FLAG BYTE IS X'80'    00850002
*              THE SECOND IS NAMED IGGNP11 AND THE FLAG BYTE IS X'0'    00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS2P11.  THE ONE TO BE    01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             P11 IS TO BE A DEFAULT IMAGE.                             01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 1060 BYTES                                          01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG2P11                                               02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*    MODULE CREATED                                                     03700002
*                                                                       03750002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDP11  CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(16)                  NO. OF LINES FOR VERIFICATION   03950002
         DC    16AL1(27)                NO. OF CHARS. PER LINE          04000002
         DC    4C'1''BDJL-5K*C(NA@=E0?)S#R>V92"68<XYT|GF%H._UO7/P3WMIQX04050002
               ,41''BDJL-5K*C(N0$=E:#)SA&&RZV9+G682;YT<XF%H._UO7/P3WMIQX04100002
               ,4'                                                      04150002
*                                                                       04200002
*        BLANK SPACE                                                    04250002
*                                                                       04260002
         DC    X'D7F1F1000000000000000000000000C0'                      04270002
*                                                                       04280002
*        ASSOCIATIVE BITS - 64 BYTES                                    04290002
*                                                                       04292002
         DC    X'101010101010101010004040404040401010101010101010100040X04294002
               40404040404010101010101010100040404040401010101010101010X04296002
               101040404040404000'                                      04298002
IGGNP11  CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(16)                  NO. OF LINES FOR VERIFICATION   04400002
         DC    16AL1(27)                NO. OF CHARS. PER LINE          04450002
         DC    4C'1''BDJL-5K*C(NA@=E0?)S#R>V92"68<XYT|GF%H._UO7/P3WMIQX04500002
               ,41''BDJL-5K*C(N0$=E:#)SA&&RZV9+G682;YT<XF%H._UO7/P3WMIQX04550002
               ,4'                                                      04600002
*                                                                       04650002
*        BLANK SPACE                                                    04700002
*                                                                       04750002
         DC    X'D7F1F1000000000000000000000000C0'                      04800002
*                                                                       04850002
*        ASSOCIATIVE BITS - 64 BYTES                                    04900002
*                                                                       04950002
         DC    X'101010101010101010004040404040401010101010101010100040X05000002
               40404040404010101010101010100040404040401010101010101010X05050002
               101040404040404000'                                      05100002
         END                                                            05150002
./  ADD  SSI=61910008,NAME=IGG2T11
         TITLE '  IGG2T11 -  IBM STANDARD UCS IMAGE - T11   '           00050002
* /* START OF SPECIFICATIONS ****                                       00100002
*                                                                       00150002
*01*  MODULE-NAME = IGG2T11                                             00200002
*                                                                       00250002
*01*  DESCRIPTIVE-NAME = UCS IMAGE TYPE=T11                             00300002
*                                                                       00350002
*01*  COPYRIGHT = NONE                                                  00400002
*                                                                       00450002
*01*  STATUS = RELEASE LEVEL 01                                         00500002
*                                                                       00550002
*01*  FUNCTION = UCS IMAGE - T11 - TEXT PRINTING (120 GRAPHICS)         00600002
*                                                                       00650002
*01*  NOTES = THIS MODULE CONTAINS THE UCS IMAGE T11                    00700002
*             THIS MODULE IS NOT EXECUTABLE                             00750002
*             THIS MODULE CONTAINS TWO CSECTS                           00800002
*              THE FIRST IS NAMED IGGDT11 AND THE FLAG BYTE IS X'80'    00850002
*              THE SECOND IS NAMED IGGNT11 AND THE FLAG BYTE IS X'0'    00900002
*             EITHER THE FIRST OR SECOND CSECT WILL BE LINK-EDITED      00950002
*             INTO IMAGELIB DURING SYSGEN AS UCS2T11.  THE ONE TO BE    01000002
*             LINK EDITED IS DETERMINED DURING SYSGEN BY WHETHER        01050002
*             T11 IS TO BE A DEFAULT IMAGE.                             01100002
*                                                                       01150002
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01200002
*                                                                       01250002
*02*    DEPENDENCIES = NONE                                             01300002
*                                                                       01350002
*02*    RESTRICTIONS = NONE                                             01400002
*                                                                       01450002
*02*    REGISTER-CONVENTIONS = NONE                                     01500002
*                                                                       01550002
*02*    PATCH-LABEL = NONE                                              01600002
*                                                                       01650002
*01*  MODULE-TYPE = MODULE                                              01700002
*                                                                       01750002
*02*  PROCESSOR = ASSEM-370R                                            01800002
*                                                                       01850002
*02*  MODULE-SIZE = 1048 BYTES                                          01900002
*                                                                       01950002
*02*  ATTRIBUTES = REENTERABLE                                          02000002
*                                                                       02050002
*01*ENTRY-POINT = IGG2T11                                               02100002
*                                                                       02150002
*02*  PURPOSE = STANDARD UCS IMAGE                                      02200002
*                                                                       02250002
*02*  LINKAGE = NONE                                                    02300002
*                                                                       02350002
*02*  INPUT = NONE                                                      02400002
*                                                                       02450002
*02*  OUTPUT = NONE                                                     02500002
*                                                                       02550002
*02*  EXIT-NORMAL = NONE                                                02600002
*                                                                       02650002
*02*  EXIT-ERROR = NONE                                                 02700002
*                                                                       02750002
*01*EXTERNAL-REFERENCES = NONE                                          02800002
*                                                                       02850002
*02*  ROUTINES = NONE                                                   02900002
*                                                                       02950002
*02*  DATA-SETS = NONE                                                  03000002
*                                                                       03050002
*02*  DATA-AREA = NONE                                                  03100002
*                                                                       03150002
*02*  CONTROL-BLOCKS = NONE                                             03200002
*                                                                       03250002
*01*TABLES = NONE                                                       03300002
*                                                                       03350002
*01*MACROS = NONE                                                       03400002
*                                                                       03450002
*01*  CHANGE-ACTIVITY = SEE BELOW                                       03500002
*                                                                       03550002
*02*  VS2-02                                                            03600002
*                                                                       03650002
*     VS2037 CHANGES                                                    03660000
*C041600,042692,042752,046100,046400,046497                    @ZA11071 03670000
*    MODULE CREATED                                                     03700002
*                                                                       03750002
*                                                               YM5768  03760002
**** END OF SPECIFICATIONS ***/                                         03800002
IGGDT11  CSECT                                                          03850002
         DC    X'80'                    DEFAULT FLAG SET                03900002
         DC    AL1(10)                  NO. OF LINES FOR VERIFICATION   03950002
         DC    9AL1(45)                 NO. OF CHARS. PER LINE          04000002
         DC    AL1(27)                  NO. OF CHARS. LAST LINE         04010002
         DC    X'F1D8E787D98582D1C7F3C8E886C9E397944F60A4E48899F983936B*04060002
               F4C284D4E2D76DC6F74B7ED5D3A3A2D695F8C59689C3C1816E4CF6F0*04110002
               4A5A8FC45C9D9FA0F5B6B7B9BFBE9CB0F2F19EA1B8D985AEB57FF3'  04160000
         DC    X'B35FB4C9E38C7C8D608EB1B299F95E8B9BF4ADBD6CE291A96FF74B*04264002
               50BCACA3BBAB7AF8C5987DAFC1E9A77BF6F0A55B92C45CA64E5DF54D*04266002
               D2E6BF61A8E5F2'                                          04268002
         DC    X'F1D8E787D98582D1C7F3C8E886C9E397944F60A4E48899F983936B*04268402
               F4C284D4E2D76DC6F74B7ED5D3A3A2D695F8C59689C3C1816E4CF6F0*04268802
               4A5A8FC45C9D9FA0F5B6B7B9BFBE9CB0F2F19EA1B8D985AEB57FF3'  04269200
         DC    X'B35FB4C9E38C7C8D608EB1B299F95E8B9BF4ADBD6CE291A96FF74B*04269602
               50BCACA3BBAB7AF8C5987DAFC1E9A77BF6F0A55B92C45CA64E5DF54D*04269702
               D2E6BF61A8E5F2'                                          04269802
         DC    X'F1D8E787D98582D1C7F3C8E886C9E397944F60A4E48899F983936B*04269902
               F4C284D4E2D76DC6F74B7ED5D3A3A2D695F8C59689C3C1816E4CF6F0*04273202
               4A5A8FC45C9D9FA0F5B6B7B9BFBE9CB0F2F19EA1B8D985AEB57FF3'  04275200
         DC    X'B35FB4C9E38C7C8D608EB1B299F95E8B9BF4ADBD6CE291A96FF74B*04275602
               50BCACA3BBAB7AF8C5987DAFC1E9A77BF6F0A55B92C45CA64E5DF54D*04276002
               D2E6BF61A8E5F2'                                          04276402
*                                                                       04276702
         DC    X'E3F1F1000000000000000000000000C0'                      04280002
*                                                                       04282002
*        ASSOCIATIVE BITS - 64 BYTES                                    04284002
*                                                                       04286002
         DC    X'303030303030303030406060606060403030303030303030304060X04290002
               60606060606030303030303030300060606060603030303030303030X04292002
               303040606060606000'                                      04294002
IGGNT11  CSECT                                                          04300002
         DC    X'00'                    DEFAULT FLAG NOT SET            04350002
         DC    AL1(10)                  NO. OF LINES FOR VERIFICATION   04400002
         DC    9AL1(45)                 NO. OF CHARS. PER LINE          04450002
         DC    AL1(27)                  NO. OF CHARS LAST LINE          04460002
         DC    X'F1D8E787D98582D1C7F3C8E886C9E397944F60A4E48899F983936B*04510002
               F4C284D4E2D76DC6F74B7ED5D3A3A2D695F8C59689C3C1816E4CF6F0*04560002
               4A5A8FC45C9D9FA0F5B6B7B9BFBE9CB0F2F19EA1B8D985AEB57FF3'  04610000
         DC    X'B35FB4C9E38C7C8D608EB1B299F95E8B9BF4ADBD6CE291A96FF74B*04620002
               50BCACA3BBAB7AF8C5987DAFC1E9A77BF6F0A55B92C45CA64E5DF54D*04630002
               D2E6BF61A8E5F2'                                          04640002
         DC    X'F1D8E787D98582D1C7F3C8E886C9E397944F60A4E48899F983936B*04642002
               F4C284D4E2D76DC6F74B7ED5D3A3A2D695F8C59689C3C1816E4CF6F0*04644002
               4A5A8FC45C9D9FA0F5B6B7B9BFBE9CB0F2F19EA1B8D985AEB57FF3'  04646000
         DC    X'B35FB4C9E38C7C8D608EB1B299F95E8B9BF4ADBD6CE291A96FF74B*04648002
               50BCACA3BBAB7AF8C5987DAFC1E9A77BF6F0A55B92C45CA64E5DF54D*04648402
               D2E6BF61A8E5F2'                                          04648802
         DC    X'F1D8E787D98582D1C7F3C8E886C9E397944F60A4E48899F983936B*04649202
               F4C284D4E2D76DC6F74B7ED5D3A3A2D695F8C59689C3C1816E4CF6F0*04649602
               4A5A8FC45C9D9FA0F5B6B7B9BFBE9CB0F2F19EA1B8D985AEB57FF3'  04649700
         DC    X'B35FB4C9E38C7C8D608EB1B299F95E8B9BF4ADBD6CE291A96FF74B*04649802
               50BCACA3BBAB7AF8C5987DAFC1E9A77BF6F0A55B92C45CA64E5DF54D*04649902
               D2E6BF61A8E5F2'                                          04666602
*                                                                       04683302
*        BLANK SPACE                                                    04700002
*                                                                       04750002
         DC    X'E3F1F1000000000000000000000000C0'                      04800002
*                                                                       04810002
*        ASSOCIATIVE BITS - 64 BYTES                                    04820002
*                                                                       04830002
         DC    X'303030303030303030406060606060403030303030303030304060X04850002
               60606060606030303030303030300060606060603030303030303030X04900002
               303040606060606000'                                      04950002
         END                                                            05000002
./  ADD  SSI=62220335,NAME=XTB1GFC
         TITLE 'XTB1 GFC  - TRANSLATE TABLE                            *00001000
                        '                                               00002000
XTB1GFC   CSECT                                                         00003000
*/*                                                                  */ 00004000
*/********************************************************************/ 00005000
*        END   XTB1GFC;                                            0005 00006000
@DATA    DS    0H                                                       00007000
         DS    0F                                                       00008000
         DS    0F                                                       00009000
         DS    0D                                                       00010000
@NM00001 DS    CL8                                                      00011000
         ORG   @NM00001                                                 00012000
@NM00002 DC    CL4'GFC '                                                00013000
@NM00003 DC    X'0000'                                                  00014000
@NM00004 DC    AL2(280)                                                 00015000
         ORG   @NM00001+8                                               00016000
XTBL     DS    CL280                                                    00017000
         ORG   XTBL                                                     00018000
XTB100   DC    X'00'                                                    00019000
XTB101   DC    X'01'                                                    00020000
XTB102   DC    X'02'                                                    00021000
XTB103   DC    X'03'                                                    00022000
XTB104   DC    X'04'                                                    00023000
XTB105   DC    X'05'                                                    00024000
XTB106   DC    X'06'                                                    00025000
XTB107   DC    X'07'                                                    00026000
XTB108   DC    X'08'                                                    00027000
XTB109   DC    X'09'                                                    00028000
XTB10A   DC    X'0A'                                                    00029000
XTB10B   DC    X'0B'                                                    00030000
XTB10C   DC    X'0C'                                                    00031000
XTB10D   DC    X'0D'                                                    00032000
XTB10E   DC    X'0E'                                                    00033000
XTB10F   DC    X'0F'                                                    00034000
XTB110   DC    X'10'                                                    00035000
XTB111   DC    X'11'                                                    00036000
XTB112   DC    X'12'                                                    00037000
XTB113   DC    X'13'                                                    00038000
XTB114   DC    X'14'                                                    00039000
XTB115   DC    X'15'                                                    00040000
XTB116   DC    X'16'                                                    00041000
XTB117   DC    X'17'                                                    00042000
XTB118   DC    X'18'                                                    00043000
XTB119   DC    X'19'                                                    00044000
XTB11A   DC    X'1A'                                                    00045000
XTB11B   DC    X'1B'                                                    00046000
XTB11C   DC    X'1C'                                                    00047000
XTB11D   DC    X'1D'                                                    00048000
XTB11E   DC    X'1E'                                                    00049000
XTB11F   DC    X'1F'                                                    00050000
XTB120   DC    X'20'                                                    00051000
XTB121   DC    X'21'                                                    00052000
XTB122   DC    X'22'                                                    00053000
XTB123   DC    X'23'                                                    00054000
XTB124   DC    X'24'                                                    00055000
XTB125   DC    X'25'                                                    00056000
XTB126   DC    X'26'                                                    00057000
XTB127   DC    X'27'                                                    00058000
XTB128   DC    X'28'                                                    00059000
XTB129   DC    X'29'                                                    00060000
XTB12A   DC    X'FF'                                                    00061000
XTB12B   DC    X'2B'                                                    00062000
XTB12C   DC    X'2C'                                                    00063000
XTB12D   DC    X'2D'                                                    00064000
XTB12E   DC    X'2E'                                                    00065000
XTB12F   DC    X'2F'                                                    00066000
XTB130   DC    X'30'                                                    00067000
XTB131   DC    X'31'                                                    00068000
XTB132   DC    X'32'                                                    00069000
XTB133   DC    X'33'                                                    00070000
XTB134   DC    X'34'                                                    00071000
XTB135   DC    X'35'                                                    00072000
XTB136   DC    X'36'                                                    00073000
XTB137   DC    X'37'                                                    00074000
XTB138   DC    X'38'                                                    00075000
XTB139   DC    X'39'                                                    00076000
XTB13A   DC    X'3A'                                                    00077000
XTB13B   DC    X'3B'                                                    00078000
XTB13C   DC    X'3C'                                                    00079000
XTB13D   DC    X'3D'                                                    00080000
XTB13E   DC    X'3E'                                                    00081000
XTB13F   DC    X'3F'                                                    00082000
XTB140   DC    X'00'                                                    00083000
XTB141   DC    X'01'                                                    00084000
XTB142   DC    X'02'                                                    00085000
XTB143   DC    X'03'                                                    00086000
XTB144   DC    X'04'                                                    00087000
XTB145   DC    X'05'                                                    00088000
XTB146   DC    X'06'                                                    00089000
XTB147   DC    X'07'                                                    00090000
XTB148   DC    X'08'                                                    00091000
XTB149   DC    X'09'                                                    00092000
XTB14A   DC    X'0A'                                                    00093000
XTB14B   DC    X'0B'                                                    00094000
XTB14C   DC    X'0C'                                                    00095000
XTB14D   DC    X'0D'                                                    00096000
XTB14E   DC    X'0E'                                                    00097000
XTB14F   DC    X'0F'                                                    00098000
XTB150   DC    X'10'                                                    00099000
XTB151   DC    X'11'                                                    00100000
XTB152   DC    X'12'                                                    00101000
XTB153   DC    X'13'                                                    00102000
XTB154   DC    X'14'                                                    00103000
XTB155   DC    X'15'                                                    00104000
XTB156   DC    X'16'                                                    00105000
XTB157   DC    X'17'                                                    00106000
XTB158   DC    X'18'                                                    00107000
XTB159   DC    X'19'                                                    00108000
XTB15A   DC    X'1A'                                                    00109000
XTB15B   DC    X'1B'                                                    00110000
XTB15C   DC    X'1C'                                                    00111000
XTB15D   DC    X'1D'                                                    00112000
XTB15E   DC    X'1E'                                                    00113000
XTB15F   DC    X'1F'                                                    00114000
XTB160   DC    X'20'                                                    00115000
XTB161   DC    X'21'                                                    00116000
XTB162   DC    X'22'                                                    00117000
XTB163   DC    X'23'                                                    00118000
XTB164   DC    X'24'                                                    00119000
XTB165   DC    X'25'                                                    00120000
XTB166   DC    X'26'                                                    00121000
XTB167   DC    X'27'                                                    00122000
XTB168   DC    X'28'                                                    00123000
XTB169   DC    X'29'                                                    00124000
XTB16A   DC    X'FF'                                                    00125000
XTB16B   DC    X'2B'                                                    00126000
XTB16C   DC    X'2C'                                                    00127000
XTB16D   DC    X'2D'                                                    00128000
XTB16E   DC    X'2E'                                                    00129000
XTB16F   DC    X'2F'                                                    00130000
XTB170   DC    X'30'                                                    00131000
XTB171   DC    X'31'                                                    00132000
XTB172   DC    X'32'                                                    00133000
XTB173   DC    X'33'                                                    00134000
XTB174   DC    X'34'                                                    00135000
XTB175   DC    X'35'                                                    00136000
XTB176   DC    X'36'                                                    00137000
XTB177   DC    X'37'                                                    00138000
XTB178   DC    X'38'                                                    00139000
XTB179   DC    X'39'                                                    00140000
XTB17A   DC    X'3A'                                                    00141000
XTB17B   DC    X'3B'                                                    00142000
XTB17C   DC    X'3C'                                                    00143000
XTB17D   DC    X'3D'                                                    00144000
XTB17E   DC    X'3E'                                                    00145000
XTB17F   DC    X'3F'                                                    00146000
XTB180   DC    X'00'                                                    00147000
XTB181   DC    X'01'                                                    00148000
XTB182   DC    X'02'                                                    00149000
XTB183   DC    X'03'                                                    00150000
XTB184   DC    X'04'                                                    00151000
XTB185   DC    X'05'                                                    00152000
XTB186   DC    X'06'                                                    00153000
XTB187   DC    X'07'                                                    00154000
XTB188   DC    X'08'                                                    00155000
XTB189   DC    X'09'                                                    00156000
XTB18A   DC    X'0A'                                                    00157000
XTB18B   DC    X'0B'                                                    00158000
XTB18C   DC    X'0C'                                                    00159000
XTB18D   DC    X'0D'                                                    00160000
XTB18E   DC    X'0E'                                                    00161000
XTB18F   DC    X'0F'                                                    00162000
XTB190   DC    X'10'                                                    00163000
XTB191   DC    X'11'                                                    00164000
XTB192   DC    X'12'                                                    00165000
XTB193   DC    X'13'                                                    00166000
XTB194   DC    X'14'                                                    00167000
XTB195   DC    X'15'                                                    00168000
XTB196   DC    X'16'                                                    00169000
XTB197   DC    X'17'                                                    00170000
XTB198   DC    X'18'                                                    00171000
XTB199   DC    X'19'                                                    00172000
XTB19A   DC    X'1A'                                                    00173000
XTB19B   DC    X'1B'                                                    00174000
XTB19C   DC    X'1C'                                                    00175000
XTB19D   DC    X'1D'                                                    00176000
XTB19E   DC    X'1E'                                                    00177000
XTB19F   DC    X'1F'                                                    00178000
XTB1A0   DC    X'20'                                                    00179000
XTB1A1   DC    X'21'                                                    00180000
XTB1A2   DC    X'22'                                                    00181000
XTB1A3   DC    X'23'                                                    00182000
XTB1A4   DC    X'24'                                                    00183000
XTB1A5   DC    X'25'                                                    00184000
XTB1A6   DC    X'26'                                                    00185000
XTB1A7   DC    X'27'                                                    00186000
XTB1A8   DC    X'28'                                                    00187000
XTB1A9   DC    X'29'                                                    00188000
XTB1AA   DC    X'FF'                                                    00189000
XTB1AB   DC    X'2B'                                                    00190000
XTB1AC   DC    X'2C'                                                    00191000
XTB1AD   DC    X'2D'                                                    00192000
XTB1AE   DC    X'2E'                                                    00193000
XTB1AF   DC    X'2F'                                                    00194000
XTB1B0   DC    X'30'                                                    00195000
XTB1B1   DC    X'31'                                                    00196000
XTB1B2   DC    X'32'                                                    00197000
XTB1B3   DC    X'33'                                                    00198000
XTB1B4   DC    X'34'                                                    00199000
XTB1B5   DC    X'35'                                                    00200000
XTB1B6   DC    X'36'                                                    00201000
XTB1B7   DC    X'37'                                                    00202000
XTB1B8   DC    X'38'                                                    00203000
XTB1B9   DC    X'39'                                                    00204000
XTB1BA   DC    X'3A'                                                    00205000
XTB1BB   DC    X'3B'                                                    00206000
XTB1BC   DC    X'3C'                                                    00207000
XTB1BD   DC    X'3D'                                                    00208000
XTB1BE   DC    X'3E'                                                    00209000
XTB1BF   DC    X'3F'                                                    00210000
XTB1C0   DC    X'00'                                                    00211000
XTB1C1   DC    X'01'                                                    00212000
XTB1C2   DC    X'02'                                                    00213000
XTB1C3   DC    X'03'                                                    00214000
XTB1C4   DC    X'04'                                                    00215000
XTB1C5   DC    X'05'                                                    00216000
XTB1C6   DC    X'06'                                                    00217000
XTB1C7   DC    X'07'                                                    00218000
XTB1C8   DC    X'08'                                                    00219000
XTB1C9   DC    X'09'                                                    00220000
XTB1CA   DC    X'0A'                                                    00221000
XTB1CB   DC    X'0B'                                                    00222000
XTB1CC   DC    X'0C'                                                    00223000
XTB1CD   DC    X'0D'                                                    00224000
XTB1CE   DC    X'0E'                                                    00225000
XTB1CF   DC    X'0F'                                                    00226000
XTB1D0   DC    X'10'                                                    00227000
XTB1D1   DC    X'11'                                                    00228000
XTB1D2   DC    X'12'                                                    00229000
XTB1D3   DC    X'13'                                                    00230000
XTB1D4   DC    X'14'                                                    00231000
XTB1D5   DC    X'15'                                                    00232000
XTB1D6   DC    X'16'                                                    00233000
XTB1D7   DC    X'17'                                                    00234000
XTB1D8   DC    X'18'                                                    00235000
XTB1D9   DC    X'19'                                                    00236000
XTB1DA   DC    X'1A'                                                    00237000
XTB1DB   DC    X'1B'                                                    00238000
XTB1DC   DC    X'1C'                                                    00239000
XTB1DD   DC    X'1D'                                                    00240000
XTB1DE   DC    X'1E'                                                    00241000
XTB1DF   DC    X'1F'                                                    00242000
XTB1E0   DC    X'20'                                                    00243000
XTB1E1   DC    X'21'                                                    00244000
XTB1E2   DC    X'22'                                                    00245000
XTB1E3   DC    X'23'                                                    00246000
XTB1E4   DC    X'24'                                                    00247000
XTB1E5   DC    X'25'                                                    00248000
XTB1E6   DC    X'26'                                                    00249000
XTB1E7   DC    X'27'                                                    00250000
XTB1E8   DC    X'28'                                                    00251000
XTB1E9   DC    X'29'                                                    00252000
XTB1EA   DC    X'FF'                                                    00253000
XTB1EB   DC    X'2B'                                                    00254000
XTB1EC   DC    X'2C'                                                    00255000
XTB1ED   DC    X'2D'                                                    00256000
XTB1EE   DC    X'2E'                                                    00257000
XTB1EF   DC    X'2F'                                                    00258000
XTB1F0   DC    X'30'                                                    00259000
XTB1F1   DC    X'31'                                                    00260000
XTB1F2   DC    X'32'                                                    00261000
XTB1F3   DC    X'33'                                                    00262000
XTB1F4   DC    X'34'                                                    00263000
XTB1F5   DC    X'35'                                                    00264000
XTB1F6   DC    X'36'                                                    00265000
XTB1F7   DC    X'37'                                                    00266000
XTB1F8   DC    X'38'                                                    00267000
XTB1F9   DC    X'39'                                                    00268000
XTB1FA   DC    X'3A'                                                    00269000
XTB1FB   DC    X'3B'                                                    00270000
XTB1FC   DC    X'3C'                                                    00271000
XTB1FD   DC    X'3D'                                                    00272000
XTB1FE   DC    X'3E'                                                    00273000
XTB1FF   DC    X'3F'                                                    00274000
XTBCGM0  DC    X'92'                                                    00275000
XTBWCGM0 DC    X'00'                                                    00276000
XTBCGM1  DC    X'00'                                                    00277000
XTBWCGM1 DC    X'00'                                                    00278000
XTBCGM2  DC    X'00'                                                    00279000
XTBWCGM2 DC    X'00'                                                    00280000
XTBCGM3  DC    X'00'                                                    00281000
XTBWCGM3 DC    X'00'                                                    00282000
XTBGRAF0 DC    CL4'    '                                                00283000
XTBGRAF1 DC    CL4'    '                                                00284000
XTBGRAF2 DC    CL4'    '                                                00285000
XTBGRAF3 DC    CL4'    '                                                00286000
         ORG   XTBL+280                                                 00287000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00288000
@01      EQU   01                                                       00289000
@02      EQU   02                                                       00290000
@03      EQU   03                                                       00291000
@04      EQU   04                                                       00292000
@05      EQU   05                                                       00293000
@06      EQU   06                                                       00294000
@07      EQU   07                                                       00295000
@08      EQU   08                                                       00296000
@09      EQU   09                                                       00297000
@10      EQU   10                                                       00298000
@11      EQU   11                                                       00299000
@12      EQU   12                                                       00300000
@13      EQU   13                                                       00301000
@14      EQU   14                                                       00302000
@15      EQU   15                                                       00303000
@ENDDATA EQU   *                                                        00304000
         END   XTB1GFC,(C'PLS2331',0701,76222)                          00305000
./  ADD  SSI=62220338,NAME=XTB1GSC
         TITLE 'XTB1 GSC   - TRANSLATE TABLE                           *00001000
                        '                                               00002000
XTB1GSC   CSECT                                                         00003000
*/*                                                                  */ 00004000
*/********************************************************************/ 00005000
*        END   XTB1GSC;                                            0005 00006000
@DATA    DS    0H                                                       00007000
         DS    0F                                                       00008000
         DS    0F                                                       00009000
         DS    0D                                                       00010000
@NM00001 DS    CL8                                                      00011000
         ORG   @NM00001                                                 00012000
@NM00002 DC    CL4'GSC '                                                00013000
@NM00003 DC    X'0000'                                                  00014000
@NM00004 DC    AL2(280)                                                 00015000
         ORG   @NM00001+8                                               00016000
XTBL     DS    CL280                                                    00017000
         ORG   XTBL                                                     00018000
XTB100   DC    X'FF'                                                    00019000
XTB101   DC    X'FF'                                                    00020000
XTB102   DC    X'FF'                                                    00021000
XTB103   DC    X'FF'                                                    00022000
XTB104   DC    X'FF'                                                    00023000
XTB105   DC    X'FF'                                                    00024000
XTB106   DC    X'FF'                                                    00025000
XTB107   DC    X'FF'                                                    00026000
XTB108   DC    X'FF'                                                    00027000
XTB109   DC    X'FF'                                                    00028000
XTB10A   DC    X'FF'                                                    00029000
XTB10B   DC    X'FF'                                                    00030000
XTB10C   DC    X'FF'                                                    00031000
XTB10D   DC    X'FF'                                                    00032000
XTB10E   DC    X'FF'                                                    00033000
XTB10F   DC    X'FF'                                                    00034000
XTB110   DC    X'FF'                                                    00035000
XTB111   DC    X'FF'                                                    00036000
XTB112   DC    X'FF'                                                    00037000
XTB113   DC    X'FF'                                                    00038000
XTB114   DC    X'FF'                                                    00039000
XTB115   DC    X'FF'                                                    00040000
XTB116   DC    X'FF'                                                    00041000
XTB117   DC    X'FF'                                                    00042000
XTB118   DC    X'FF'                                                    00043000
XTB119   DC    X'FF'                                                    00044000
XTB11A   DC    X'FF'                                                    00045000
XTB11B   DC    X'FF'                                                    00046000
XTB11C   DC    X'FF'                                                    00047000
XTB11D   DC    X'FF'                                                    00048000
XTB11E   DC    X'FF'                                                    00049000
XTB11F   DC    X'FF'                                                    00050000
XTB120   DC    X'FF'                                                    00051000
XTB121   DC    X'FF'                                                    00052000
XTB122   DC    X'FF'                                                    00053000
XTB123   DC    X'FF'                                                    00054000
XTB124   DC    X'FF'                                                    00055000
XTB125   DC    X'FF'                                                    00056000
XTB126   DC    X'FF'                                                    00057000
XTB127   DC    X'FF'                                                    00058000
XTB128   DC    X'FF'                                                    00059000
XTB129   DC    X'FF'                                                    00060000
XTB12A   DC    X'FF'                                                    00061000
XTB12B   DC    X'FF'                                                    00062000
XTB12C   DC    X'FF'                                                    00063000
XTB12D   DC    X'FF'                                                    00064000
XTB12E   DC    X'FF'                                                    00065000
XTB12F   DC    X'FF'                                                    00066000
XTB130   DC    X'FF'                                                    00067000
XTB131   DC    X'FF'                                                    00068000
XTB132   DC    X'FF'                                                    00069000
XTB133   DC    X'FF'                                                    00070000
XTB134   DC    X'FF'                                                    00071000
XTB135   DC    X'FF'                                                    00072000
XTB136   DC    X'FF'                                                    00073000
XTB137   DC    X'FF'                                                    00074000
XTB138   DC    X'FF'                                                    00075000
XTB139   DC    X'FF'                                                    00076000
XTB13A   DC    X'FF'                                                    00077000
XTB13B   DC    X'FF'                                                    00078000
XTB13C   DC    X'FF'                                                    00079000
XTB13D   DC    X'FF'                                                    00080000
XTB13E   DC    X'FF'                                                    00081000
XTB13F   DC    X'FF'                                                    00082000
XTB140   DC    X'00'                                                    00083000
XTB141   DC    X'FF'                                                    00084000
XTB142   DC    X'FF'                                                    00085000
XTB143   DC    X'FF'                                                    00086000
XTB144   DC    X'FF'                                                    00087000
XTB145   DC    X'FF'                                                    00088000
XTB146   DC    X'FF'                                                    00089000
XTB147   DC    X'FF'                                                    00090000
XTB148   DC    X'FF'                                                    00091000
XTB149   DC    X'FF'                                                    00092000
XTB14A   DC    X'0A'                                                    00093000
XTB14B   DC    X'0B'                                                    00094000
XTB14C   DC    X'0C'                                                    00095000
XTB14D   DC    X'0D'                                                    00096000
XTB14E   DC    X'0E'                                                    00097000
XTB14F   DC    X'0F'                                                    00098000
XTB150   DC    X'10'                                                    00099000
XTB151   DC    X'FF'                                                    00100000
XTB152   DC    X'FF'                                                    00101000
XTB153   DC    X'FF'                                                    00102000
XTB154   DC    X'FF'                                                    00103000
XTB155   DC    X'FF'                                                    00104000
XTB156   DC    X'FF'                                                    00105000
XTB157   DC    X'FF'                                                    00106000
XTB158   DC    X'FF'                                                    00107000
XTB159   DC    X'FF'                                                    00108000
XTB15A   DC    X'1A'                                                    00109000
XTB15B   DC    X'1B'                                                    00110000
XTB15C   DC    X'1C'                                                    00111000
XTB15D   DC    X'1D'                                                    00112000
XTB15E   DC    X'1E'                                                    00113000
XTB15F   DC    X'1F'                                                    00114000
XTB160   DC    X'20'                                                    00115000
XTB161   DC    X'21'                                                    00116000
XTB162   DC    X'FF'                                                    00117000
XTB163   DC    X'FF'                                                    00118000
XTB164   DC    X'FF'                                                    00119000
XTB165   DC    X'FF'                                                    00120000
XTB166   DC    X'FF'                                                    00121000
XTB167   DC    X'FF'                                                    00122000
XTB168   DC    X'FF'                                                    00123000
XTB169   DC    X'FF'                                                    00124000
XTB16A   DC    X'FF'                                                    00125000
XTB16B   DC    X'2B'                                                    00126000
XTB16C   DC    X'2C'                                                    00127000
XTB16D   DC    X'2D'                                                    00128000
XTB16E   DC    X'2E'                                                    00129000
XTB16F   DC    X'2F'                                                    00130000
XTB170   DC    X'FF'                                                    00131000
XTB171   DC    X'FF'                                                    00132000
XTB172   DC    X'FF'                                                    00133000
XTB173   DC    X'FF'                                                    00134000
XTB174   DC    X'FF'                                                    00135000
XTB175   DC    X'FF'                                                    00136000
XTB176   DC    X'FF'                                                    00137000
XTB177   DC    X'FF'                                                    00138000
XTB178   DC    X'FF'                                                    00139000
XTB179   DC    X'FF'                                                    00140000
XTB17A   DC    X'3A'                                                    00141000
XTB17B   DC    X'3B'                                                    00142000
XTB17C   DC    X'3C'                                                    00143000
XTB17D   DC    X'3D'                                                    00144000
XTB17E   DC    X'3E'                                                    00145000
XTB17F   DC    X'3F'                                                    00146000
XTB180   DC    X'FF'                                                    00147000
XTB181   DC    X'FF'                                                    00148000
XTB182   DC    X'FF'                                                    00149000
XTB183   DC    X'FF'                                                    00150000
XTB184   DC    X'FF'                                                    00151000
XTB185   DC    X'FF'                                                    00152000
XTB186   DC    X'FF'                                                    00153000
XTB187   DC    X'FF'                                                    00154000
XTB188   DC    X'FF'                                                    00155000
XTB189   DC    X'FF'                                                    00156000
XTB18A   DC    X'FF'                                                    00157000
XTB18B   DC    X'FF'                                                    00158000
XTB18C   DC    X'FF'                                                    00159000
XTB18D   DC    X'FF'                                                    00160000
XTB18E   DC    X'FF'                                                    00161000
XTB18F   DC    X'FF'                                                    00162000
XTB190   DC    X'FF'                                                    00163000
XTB191   DC    X'FF'                                                    00164000
XTB192   DC    X'FF'                                                    00165000
XTB193   DC    X'FF'                                                    00166000
XTB194   DC    X'FF'                                                    00167000
XTB195   DC    X'FF'                                                    00168000
XTB196   DC    X'FF'                                                    00169000
XTB197   DC    X'FF'                                                    00170000
XTB198   DC    X'FF'                                                    00171000
XTB199   DC    X'FF'                                                    00172000
XTB19A   DC    X'FF'                                                    00173000
XTB19B   DC    X'FF'                                                    00174000
XTB19C   DC    X'2A'                                                    00175000
XTB19D   DC    X'FF'                                                    00176000
XTB19E   DC    X'FF'                                                    00177000
XTB19F   DC    X'FF'                                                    00178000
XTB1A0   DC    X'FF'                                                    00179000
XTB1A1   DC    X'FF'                                                    00180000
XTB1A2   DC    X'FF'                                                    00181000
XTB1A3   DC    X'FF'                                                    00182000
XTB1A4   DC    X'FF'                                                    00183000
XTB1A5   DC    X'FF'                                                    00184000
XTB1A6   DC    X'FF'                                                    00185000
XTB1A7   DC    X'FF'                                                    00186000
XTB1A8   DC    X'FF'                                                    00187000
XTB1A9   DC    X'FF'                                                    00188000
XTB1AA   DC    X'FF'                                                    00189000
XTB1AB   DC    X'FF'                                                    00190000
XTB1AC   DC    X'FF'                                                    00191000
XTB1AD   DC    X'FF'                                                    00192000
XTB1AE   DC    X'FF'                                                    00193000
XTB1AF   DC    X'FF'                                                    00194000
XTB1B0   DC    X'FF'                                                    00195000
XTB1B1   DC    X'FF'                                                    00196000
XTB1B2   DC    X'FF'                                                    00197000
XTB1B3   DC    X'FF'                                                    00198000
XTB1B4   DC    X'FF'                                                    00199000
XTB1B5   DC    X'FF'                                                    00200000
XTB1B6   DC    X'FF'                                                    00201000
XTB1B7   DC    X'FF'                                                    00202000
XTB1B8   DC    X'FF'                                                    00203000
XTB1B9   DC    X'FF'                                                    00204000
XTB1BA   DC    X'FF'                                                    00205000
XTB1BB   DC    X'FF'                                                    00206000
XTB1BC   DC    X'FF'                                                    00207000
XTB1BD   DC    X'FF'                                                    00208000
XTB1BE   DC    X'FF'                                                    00209000
XTB1BF   DC    X'FF'                                                    00210000
XTB1C0   DC    X'FF'                                                    00211000
XTB1C1   DC    X'01'                                                    00212000
XTB1C2   DC    X'02'                                                    00213000
XTB1C3   DC    X'03'                                                    00214000
XTB1C4   DC    X'04'                                                    00215000
XTB1C5   DC    X'05'                                                    00216000
XTB1C6   DC    X'06'                                                    00217000
XTB1C7   DC    X'07'                                                    00218000
XTB1C8   DC    X'08'                                                    00219000
XTB1C9   DC    X'09'                                                    00220000
XTB1CA   DC    X'FF'                                                    00221000
XTB1CB   DC    X'FF'                                                    00222000
XTB1CC   DC    X'FF'                                                    00223000
XTB1CD   DC    X'FF'                                                    00224000
XTB1CE   DC    X'FF'                                                    00225000
XTB1CF   DC    X'FF'                                                    00226000
XTB1D0   DC    X'FF'                                                    00227000
XTB1D1   DC    X'11'                                                    00228000
XTB1D2   DC    X'12'                                                    00229000
XTB1D3   DC    X'13'                                                    00230000
XTB1D4   DC    X'14'                                                    00231000
XTB1D5   DC    X'15'                                                    00232000
XTB1D6   DC    X'16'                                                    00233000
XTB1D7   DC    X'17'                                                    00234000
XTB1D8   DC    X'18'                                                    00235000
XTB1D9   DC    X'19'                                                    00236000
XTB1DA   DC    X'FF'                                                    00237000
XTB1DB   DC    X'FF'                                                    00238000
XTB1DC   DC    X'FF'                                                    00239000
XTB1DD   DC    X'FF'                                                    00240000
XTB1DE   DC    X'FF'                                                    00241000
XTB1DF   DC    X'FF'                                                    00242000
XTB1E0   DC    X'FF'                                                    00243000
XTB1E1   DC    X'FF'                                                    00244000
XTB1E2   DC    X'22'                                                    00245000
XTB1E3   DC    X'23'                                                    00246000
XTB1E4   DC    X'24'                                                    00247000
XTB1E5   DC    X'25'                                                    00248000
XTB1E6   DC    X'26'                                                    00249000
XTB1E7   DC    X'27'                                                    00250000
XTB1E8   DC    X'28'                                                    00251000
XTB1E9   DC    X'29'                                                    00252000
XTB1EA   DC    X'FF'                                                    00253000
XTB1EB   DC    X'FF'                                                    00254000
XTB1EC   DC    X'FF'                                                    00255000
XTB1ED   DC    X'FF'                                                    00256000
XTB1EE   DC    X'FF'                                                    00257000
XTB1EF   DC    X'FF'                                                    00258000
XTB1F0   DC    X'30'                                                    00259000
XTB1F1   DC    X'31'                                                    00260000
XTB1F2   DC    X'32'                                                    00261000
XTB1F3   DC    X'33'                                                    00262000
XTB1F4   DC    X'34'                                                    00263000
XTB1F5   DC    X'35'                                                    00264000
XTB1F6   DC    X'36'                                                    00265000
XTB1F7   DC    X'37'                                                    00266000
XTB1F8   DC    X'38'                                                    00267000
XTB1F9   DC    X'39'                                                    00268000
XTB1FA   DC    X'FF'                                                    00269000
XTB1FB   DC    X'FF'                                                    00270000
XTB1FC   DC    X'FF'                                                    00271000
XTB1FD   DC    X'FF'                                                    00272000
XTB1FE   DC    X'FF'                                                    00273000
XTB1FF   DC    X'FF'                                                    00274000
XTBCGM0  DC    X'92'                                                    00275000
XTBWCGM0 DC    X'00'                                                    00276000
XTBCGM1  DC    X'00'                                                    00277000
XTBWCGM1 DC    X'00'                                                    00278000
XTBCGM2  DC    X'00'                                                    00279000
XTBWCGM2 DC    X'00'                                                    00280000
XTBCGM3  DC    X'00'                                                    00281000
XTBWCGM3 DC    X'00'                                                    00282000
XTBGRAF0 DC    CL4'    '                                                00283000
XTBGRAF1 DC    CL4'    '                                                00284000
XTBGRAF2 DC    CL4'    '                                                00285000
XTBGRAF3 DC    CL4'    '                                                00286000
         ORG   XTBL+280                                                 00287000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00288000
@01      EQU   01                                                       00289000
@02      EQU   02                                                       00290000
@03      EQU   03                                                       00291000
@04      EQU   04                                                       00292000
@05      EQU   05                                                       00293000
@06      EQU   06                                                       00294000
@07      EQU   07                                                       00295000
@08      EQU   08                                                       00296000
@09      EQU   09                                                       00297000
@10      EQU   10                                                       00298000
@11      EQU   11                                                       00299000
@12      EQU   12                                                       00300000
@13      EQU   13                                                       00301000
@14      EQU   14                                                       00302000
@15      EQU   15                                                       00303000
@ENDDATA EQU   *                                                        00304000
         END   XTB1GSC,(C'PLS2334',0701,76222)                          00305000
./  ADD  SSI=62220344,NAME=XTB1GUC
         TITLE 'XTB1 GUC   - TRANSLATE TABLE                           *00001000
                        '                                               00002000
XTB1GUC   CSECT                                                         00003000
*/*                                                                  */ 00004000
*/********************************************************************/ 00005000
*        END   XTB1GUC;                                            0005 00006000
@DATA    DS    0H                                                       00007000
         DS    0F                                                       00008000
         DS    0F                                                       00009000
         DS    0D                                                       00010000
@NM00001 DS    CL8                                                      00011000
         ORG   @NM00001                                                 00012000
@NM00002 DC    CL4'GUC '                                                00013000
@NM00003 DC    X'0000'                                                  00014000
@NM00004 DC    AL2(280)                                                 00015000
         ORG   @NM00001+8                                               00016000
XTBL     DS    CL280                                                    00017000
         ORG   XTBL                                                     00018000
XTB100   DC    X'FF'                                                    00019000
XTB101   DC    X'FF'                                                    00020000
XTB102   DC    X'FF'                                                    00021000
XTB103   DC    X'FF'                                                    00022000
XTB104   DC    X'FF'                                                    00023000
XTB105   DC    X'FF'                                                    00024000
XTB106   DC    X'FF'                                                    00025000
XTB107   DC    X'FF'                                                    00026000
XTB108   DC    X'FF'                                                    00027000
XTB109   DC    X'FF'                                                    00028000
XTB10A   DC    X'FF'                                                    00029000
XTB10B   DC    X'FF'                                                    00030000
XTB10C   DC    X'FF'                                                    00031000
XTB10D   DC    X'FF'                                                    00032000
XTB10E   DC    X'FF'                                                    00033000
XTB10F   DC    X'FF'                                                    00034000
XTB110   DC    X'FF'                                                    00035000
XTB111   DC    X'FF'                                                    00036000
XTB112   DC    X'FF'                                                    00037000
XTB113   DC    X'FF'                                                    00038000
XTB114   DC    X'FF'                                                    00039000
XTB115   DC    X'FF'                                                    00040000
XTB116   DC    X'FF'                                                    00041000
XTB117   DC    X'FF'                                                    00042000
XTB118   DC    X'FF'                                                    00043000
XTB119   DC    X'FF'                                                    00044000
XTB11A   DC    X'FF'                                                    00045000
XTB11B   DC    X'FF'                                                    00046000
XTB11C   DC    X'FF'                                                    00047000
XTB11D   DC    X'FF'                                                    00048000
XTB11E   DC    X'FF'                                                    00049000
XTB11F   DC    X'FF'                                                    00050000
XTB120   DC    X'FF'                                                    00051000
XTB121   DC    X'FF'                                                    00052000
XTB122   DC    X'FF'                                                    00053000
XTB123   DC    X'FF'                                                    00054000
XTB124   DC    X'FF'                                                    00055000
XTB125   DC    X'FF'                                                    00056000
XTB126   DC    X'FF'                                                    00057000
XTB127   DC    X'FF'                                                    00058000
XTB128   DC    X'FF'                                                    00059000
XTB129   DC    X'FF'                                                    00060000
XTB12A   DC    X'FF'                                                    00061000
XTB12B   DC    X'FF'                                                    00062000
XTB12C   DC    X'FF'                                                    00063000
XTB12D   DC    X'FF'                                                    00064000
XTB12E   DC    X'FF'                                                    00065000
XTB12F   DC    X'FF'                                                    00066000
XTB130   DC    X'FF'                                                    00067000
XTB131   DC    X'FF'                                                    00068000
XTB132   DC    X'FF'                                                    00069000
XTB133   DC    X'FF'                                                    00070000
XTB134   DC    X'FF'                                                    00071000
XTB135   DC    X'FF'                                                    00072000
XTB136   DC    X'FF'                                                    00073000
XTB137   DC    X'FF'                                                    00074000
XTB138   DC    X'FF'                                                    00075000
XTB139   DC    X'FF'                                                    00076000
XTB13A   DC    X'FF'                                                    00077000
XTB13B   DC    X'FF'                                                    00078000
XTB13C   DC    X'FF'                                                    00079000
XTB13D   DC    X'FF'                                                    00080000
XTB13E   DC    X'FF'                                                    00081000
XTB13F   DC    X'FF'                                                    00082000
XTB140   DC    X'00'                                                    00083000
XTB141   DC    X'FF'                                                    00084000
XTB142   DC    X'FF'                                                    00085000
XTB143   DC    X'FF'                                                    00086000
XTB144   DC    X'FF'                                                    00087000
XTB145   DC    X'FF'                                                    00088000
XTB146   DC    X'FF'                                                    00089000
XTB147   DC    X'FF'                                                    00090000
XTB148   DC    X'FF'                                                    00091000
XTB149   DC    X'FF'                                                    00092000
XTB14A   DC    X'0A'                                                    00093000
XTB14B   DC    X'0B'                                                    00094000
XTB14C   DC    X'0C'                                                    00095000
XTB14D   DC    X'0D'                                                    00096000
XTB14E   DC    X'0E'                                                    00097000
XTB14F   DC    X'0F'                                                    00098000
XTB150   DC    X'10'                                                    00099000
XTB151   DC    X'FF'                                                    00100000
XTB152   DC    X'FF'                                                    00101000
XTB153   DC    X'FF'                                                    00102000
XTB154   DC    X'FF'                                                    00103000
XTB155   DC    X'FF'                                                    00104000
XTB156   DC    X'FF'                                                    00105000
XTB157   DC    X'FF'                                                    00106000
XTB158   DC    X'FF'                                                    00107000
XTB159   DC    X'FF'                                                    00108000
XTB15A   DC    X'1A'                                                    00109000
XTB15B   DC    X'1B'                                                    00110000
XTB15C   DC    X'1C'                                                    00111000
XTB15D   DC    X'1D'                                                    00112000
XTB15E   DC    X'1E'                                                    00113000
XTB15F   DC    X'1F'                                                    00114000
XTB160   DC    X'20'                                                    00115000
XTB161   DC    X'21'                                                    00116000
XTB162   DC    X'FF'                                                    00117000
XTB163   DC    X'FF'                                                    00118000
XTB164   DC    X'FF'                                                    00119000
XTB165   DC    X'FF'                                                    00120000
XTB166   DC    X'FF'                                                    00121000
XTB167   DC    X'FF'                                                    00122000
XTB168   DC    X'FF'                                                    00123000
XTB169   DC    X'FF'                                                    00124000
XTB16A   DC    X'FF'                                                    00125000
XTB16B   DC    X'2B'                                                    00126000
XTB16C   DC    X'2C'                                                    00127000
XTB16D   DC    X'2D'                                                    00128000
XTB16E   DC    X'2E'                                                    00129000
XTB16F   DC    X'2F'                                                    00130000
XTB170   DC    X'FF'                                                    00131000
XTB171   DC    X'FF'                                                    00132000
XTB172   DC    X'FF'                                                    00133000
XTB173   DC    X'FF'                                                    00134000
XTB174   DC    X'FF'                                                    00135000
XTB175   DC    X'FF'                                                    00136000
XTB176   DC    X'FF'                                                    00137000
XTB177   DC    X'FF'                                                    00138000
XTB178   DC    X'FF'                                                    00139000
XTB179   DC    X'FF'                                                    00140000
XTB17A   DC    X'3A'                                                    00141000
XTB17B   DC    X'3B'                                                    00142000
XTB17C   DC    X'3C'                                                    00143000
XTB17D   DC    X'3D'                                                    00144000
XTB17E   DC    X'3E'                                                    00145000
XTB17F   DC    X'3F'                                                    00146000
XTB180   DC    X'FF'                                                    00147000
XTB181   DC    X'FF'                                                    00148000
XTB182   DC    X'FF'                                                    00149000
XTB183   DC    X'FF'                                                    00150000
XTB184   DC    X'FF'                                                    00151000
XTB185   DC    X'FF'                                                    00152000
XTB186   DC    X'FF'                                                    00153000
XTB187   DC    X'FF'                                                    00154000
XTB188   DC    X'FF'                                                    00155000
XTB189   DC    X'FF'                                                    00156000
XTB18A   DC    X'FF'                                                    00157000
XTB18B   DC    X'FF'                                                    00158000
XTB18C   DC    X'FF'                                                    00159000
XTB18D   DC    X'FF'                                                    00160000
XTB18E   DC    X'FF'                                                    00161000
XTB18F   DC    X'FF'                                                    00162000
XTB190   DC    X'FF'                                                    00163000
XTB191   DC    X'FF'                                                    00164000
XTB192   DC    X'FF'                                                    00165000
XTB193   DC    X'FF'                                                    00166000
XTB194   DC    X'FF'                                                    00167000
XTB195   DC    X'FF'                                                    00168000
XTB196   DC    X'FF'                                                    00169000
XTB197   DC    X'FF'                                                    00170000
XTB198   DC    X'FF'                                                    00171000
XTB199   DC    X'FF'                                                    00172000
XTB19A   DC    X'FF'                                                    00173000
XTB19B   DC    X'FF'                                                    00174000
XTB19C   DC    X'2A'                                                    00175000
XTB19D   DC    X'FF'                                                    00176000
XTB19E   DC    X'FF'                                                    00177000
XTB19F   DC    X'FF'                                                    00178000
XTB1A0   DC    X'FF'                                                    00179000
XTB1A1   DC    X'FF'                                                    00180000
XTB1A2   DC    X'FF'                                                    00181000
XTB1A3   DC    X'FF'                                                    00182000
XTB1A4   DC    X'FF'                                                    00183000
XTB1A5   DC    X'FF'                                                    00184000
XTB1A6   DC    X'FF'                                                    00185000
XTB1A7   DC    X'FF'                                                    00186000
XTB1A8   DC    X'FF'                                                    00187000
XTB1A9   DC    X'FF'                                                    00188000
XTB1AA   DC    X'FF'                                                    00189000
XTB1AB   DC    X'FF'                                                    00190000
XTB1AC   DC    X'FF'                                                    00191000
XTB1AD   DC    X'FF'                                                    00192000
XTB1AE   DC    X'FF'                                                    00193000
XTB1AF   DC    X'FF'                                                    00194000
XTB1B0   DC    X'FF'                                                    00195000
XTB1B1   DC    X'FF'                                                    00196000
XTB1B2   DC    X'FF'                                                    00197000
XTB1B3   DC    X'FF'                                                    00198000
XTB1B4   DC    X'FF'                                                    00199000
XTB1B5   DC    X'FF'                                                    00200000
XTB1B6   DC    X'FF'                                                    00201000
XTB1B7   DC    X'FF'                                                    00202000
XTB1B8   DC    X'FF'                                                    00203000
XTB1B9   DC    X'FF'                                                    00204000
XTB1BA   DC    X'FF'                                                    00205000
XTB1BB   DC    X'FF'                                                    00206000
XTB1BC   DC    X'FF'                                                    00207000
XTB1BD   DC    X'FF'                                                    00208000
XTB1BE   DC    X'FF'                                                    00209000
XTB1BF   DC    X'FF'                                                    00210000
XTB1C0   DC    X'FF'                                                    00211000
XTB1C1   DC    X'01'                                                    00212000
XTB1C2   DC    X'02'                                                    00213000
XTB1C3   DC    X'03'                                                    00214000
XTB1C4   DC    X'04'                                                    00215000
XTB1C5   DC    X'05'                                                    00216000
XTB1C6   DC    X'06'                                                    00217000
XTB1C7   DC    X'07'                                                    00218000
XTB1C8   DC    X'08'                                                    00219000
XTB1C9   DC    X'09'                                                    00220000
XTB1CA   DC    X'FF'                                                    00221000
XTB1CB   DC    X'FF'                                                    00222000
XTB1CC   DC    X'FF'                                                    00223000
XTB1CD   DC    X'FF'                                                    00224000
XTB1CE   DC    X'FF'                                                    00225000
XTB1CF   DC    X'FF'                                                    00226000
XTB1D0   DC    X'FF'                                                    00227000
XTB1D1   DC    X'11'                                                    00228000
XTB1D2   DC    X'12'                                                    00229000
XTB1D3   DC    X'13'                                                    00230000
XTB1D4   DC    X'14'                                                    00231000
XTB1D5   DC    X'15'                                                    00232000
XTB1D6   DC    X'16'                                                    00233000
XTB1D7   DC    X'17'                                                    00234000
XTB1D8   DC    X'18'                                                    00235000
XTB1D9   DC    X'19'                                                    00236000
XTB1DA   DC    X'FF'                                                    00237000
XTB1DB   DC    X'FF'                                                    00238000
XTB1DC   DC    X'FF'                                                    00239000
XTB1DD   DC    X'FF'                                                    00240000
XTB1DE   DC    X'FF'                                                    00241000
XTB1DF   DC    X'FF'                                                    00242000
XTB1E0   DC    X'FF'                                                    00243000
XTB1E1   DC    X'FF'                                                    00244000
XTB1E2   DC    X'22'                                                    00245000
XTB1E3   DC    X'23'                                                    00246000
XTB1E4   DC    X'24'                                                    00247000
XTB1E5   DC    X'25'                                                    00248000
XTB1E6   DC    X'26'                                                    00249000
XTB1E7   DC    X'27'                                                    00250000
XTB1E8   DC    X'28'                                                    00251000
XTB1E9   DC    X'29'                                                    00252000
XTB1EA   DC    X'FF'                                                    00253000
XTB1EB   DC    X'FF'                                                    00254000
XTB1EC   DC    X'FF'                                                    00255000
XTB1ED   DC    X'FF'                                                    00256000
XTB1EE   DC    X'FF'                                                    00257000
XTB1EF   DC    X'FF'                                                    00258000
XTB1F0   DC    X'30'                                                    00259000
XTB1F1   DC    X'31'                                                    00260000
XTB1F2   DC    X'32'                                                    00261000
XTB1F3   DC    X'33'                                                    00262000
XTB1F4   DC    X'34'                                                    00263000
XTB1F5   DC    X'35'                                                    00264000
XTB1F6   DC    X'36'                                                    00265000
XTB1F7   DC    X'37'                                                    00266000
XTB1F8   DC    X'38'                                                    00267000
XTB1F9   DC    X'39'                                                    00268000
XTB1FA   DC    X'FF'                                                    00269000
XTB1FB   DC    X'FF'                                                    00270000
XTB1FC   DC    X'FF'                                                    00271000
XTB1FD   DC    X'FF'                                                    00272000
XTB1FE   DC    X'FF'                                                    00273000
XTB1FF   DC    X'FF'                                                    00274000
XTBCGM0  DC    X'36'                                                    00275000
XTBWCGM0 DC    X'00'                                                    00276000
XTBCGM1  DC    X'00'                                                    00277000
XTBWCGM1 DC    X'00'                                                    00278000
XTBCGM2  DC    X'00'                                                    00279000
XTBWCGM2 DC    X'00'                                                    00280000
XTBCGM3  DC    X'00'                                                    00281000
XTBWCGM3 DC    X'00'                                                    00282000
XTBGRAF0 DC    CL4'    '                                                00283000
XTBGRAF1 DC    CL4'    '                                                00284000
XTBGRAF2 DC    CL4'    '                                                00285000
XTBGRAF3 DC    CL4'    '                                                00286000
         ORG   XTBL+280                                                 00287000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00288000
@01      EQU   01                                                       00289000
@02      EQU   02                                                       00290000
@03      EQU   03                                                       00291000
@04      EQU   04                                                       00292000
@05      EQU   05                                                       00293000
@06      EQU   06                                                       00294000
@07      EQU   07                                                       00295000
@08      EQU   08                                                       00296000
@09      EQU   09                                                       00297000
@10      EQU   10                                                       00298000
@11      EQU   11                                                       00299000
@12      EQU   12                                                       00300000
@13      EQU   13                                                       00301000
@14      EQU   14                                                       00302000
@15      EQU   15                                                       00303000
@ENDDATA EQU   *                                                        00304000
         END   XTB1GUC,(C'PLS2337',0701,76222)                          00305000
