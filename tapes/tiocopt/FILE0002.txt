./  ADD  SSI=72410243,NAME=IEDAYAA
         TITLE 'IEDAYAA  -  TSO/TIOC ATTENTION ROUTINE'                 00010020
IEDAYAA  CSECT                                                          00020020
*********************************************************************** 00030020
*********************************************************************** 00040021
*                                                                     * 00040321
*        RELEASE 3 VS/2  PTF                                   @ZA08015 00041103
*0000072500,087000,268200-269110,270910-270950                 @ZA08015 00041903
*0000280810-281700,509410-509460,519310                        @ZA08015 00042703
*         RELEASE 3 VS/2 CHANGES                                        00043602
*  ZA00968 - SEE SA70323                                        ZA00968 00045602
*A191300,191400                                                 ZA02235 00046002
*         RELEASE VS2/2 CHANGES                                 YS02019 00047102
*                                       9/25/1973               YM03889 00050402
*                                       1/23/1974               YM06727 00050802
*         RELEASE 21 DELETIONS                                        * 00051002
*0966727427                                                      A50694 00055902
*0966                                                            M0167  00060802
*0966073100,083100,092000-092200,092700,120600-121500,159300-    S21008 00065702
*0966160200,698400,701100-703800,707400-725600,727270,727354-    S21008 00070602
*0966727606,727669-841500                                        S21008 00075502
*0966000400,087000                                               M0891  00080402
*          RELEASE 20 DELETIONS                                       * 00085302
*                                                                 M4034 00090202
*                                                                M3835  00095102
*0000099780,100440-100500,100620-100680,175800,327600,330300,    TS1637 00100020
*0000600300,678600,680800,697500,719100,720900,724500-727200,    TS1637 00110020
*0000766800-782100,929700,934300,936900-937800,954000,958500-    TS1637 00120020
*0000999999                                                      TS1637 00130020
*0000621000,641900-684900                                        M0029  00150020
*0000                                                            TS0035 00160020
*                                                                 M2265 00170020
*                                                                M3658  00200020
*                                                                     * 00240020
*STATUS CHANGE LEVEL 003                                        YS02019 00310002
*                                                                     * 00380020
* FUNCTION -                                                          * 00450020
*                                                                     * 00480002
*    QTIP0000 - ENTERED FROM ATTN IEDAYA                              * 00520020
*                                                                     * 00590002
*         WHEN ATTENTION EXIT IS AVAILABLE -                    YS02019 00690002
*                                                                     * 00790002
*    * SET NEW ATTENTION COUNT IN TSB                           YS02019 00890002
*    * POST THE RCT TO SCHEDULE AN ATTENTION EXIT               YS02019 00990002
*    * CLEAR INPUT AND OUTPUT QUEUES EXCEPT ASID MESSAGES       YS02019 01090002
*    * RESET AUTOMATIC LINE NUMBERING BITS IN TSB               YS02019 01190002
*    * REMOVE USER AND SYSTEM LWAIT, USER AND SYSTEM OWAIT      YS02019 01290002
*                                                                     * 01390002
*         WHEN ATTENTION EXIT IS NOT AVAILABLE -                YS02019 01570002
*                                                                     * 01620002
*    * TURN ON TSBATTN IF USER IS IN OWAIT                      YS02019 01670002
*    * CLEAR INPUT AND OUTPUT QUEUES EXCEPT ASID MESSAGES       YS02019 01720002
*    * REMOVE USER AND SYSTEM LWAIT, USER AND SYSTEM OWAIT      YS02019 01770002
*                                                                     * 01820002
*    QTIP0030 - ENTERED FROM IEDAYOO FOR HANGUP                       * 01920020
*                                                                     * 01950002
*    1. CLEAR INPUT AND OUTPUT QUEUES INCLUDING TJID MESSAGES         * 01990020
*    2. REMOVE SYSTEM LWAIT, USER AND SYSTEM OWAIT                    * 02060020
*                                                                     * 02090002
*    QTIP0210 - ENTERED FROM IGG09401                           YS02019 02130002
*                                                                     * 02160002
*    1. CLEAR INPUT QUEUE                                             * 02200020
*    2. REMOVE SYSTEM LWAIT AND SYSTEM OWAIT                          * 02270020
*                                                                     * 02300002
*    QTIP0220 - ENTERED FROM IGG09401                           YS02019 02340002
*                                                                     * 02370002
*    1. CLEAR OUTPUT HEADER QUEUE EXCEPT TJID MESSAGES                * 02410020
*    2. REMOVE SYSTEM LWAIT, USER AND SYSTEM OWAIT                    * 02480020
*                                                                     * 02550020
* ENTRY POINTS -                                                      * 02620020
*                                                                     * 02650002
*         QTIP0000 - QTIP 0 ENTRY FROM IEDAYA                         * 02690020
*         QTIP0030 - BRANCH ENTRY FROM IEDAYOO DURING HANGUP          * 02900020
*         QTIP0210 - QTIP 21 ENTRY FROM IGG09401                YS02019 02970002
*         QTIP0220 - QTIP 22 ENTRY FROM IGG09401                YS02019 03040002
*                                                                     * 03110020
* INPUT -                                                             * 03180020
*                                                                     * 03190002
*         WHEN ENTERED FROM IEDAYA                              YS02019 03200002
*                                                                     * 03210002
*    REGISTER 3 - SCB                                           YS02019 03220002
*    REGISTER 4 - LCB                                                 * 03250020
*    REGISTER 5 - ASCB                                          YS02019 03320002
*    REGISTER 6 - TSB                                                 * 03390020
*    REGISTER 7 - QCB                                           YS02019 03420002
*    REGISTER 10 - TIOCRPT                                      YS02019 03460002
*                                                                     * 03600020
*         WHEN ENTERED FROM IEDAYOO                             YS02019 03607002
*                                                                     * 03614002
*    REGISTER  6 - TSB                                          YS02019 03621002
*    REGISTER 10 - TIOCRPT                                      YS02019 03628002
*                                                                     * 03635002
*         WHEN ENTERED FROM IGG09401                            YS02019 03642002
*                                                                     * 03649002
*    REGISTER 15 - TSB                                          YS02019 03656002
*                                                                     * 03663002
* OUTPUT - SAME AS INPUT                                              * 03670020
*                                                                     * 03740020
* EXTERNAL REFERENCES -                                               * 03810020
*         IEA0PT01 - BRANCH ENTRY TO POST ROUTINE                     * 04020020
*         TIOCSAVE - REGISTER SAVE AND WORK AREA IN TIOCRPT           * 04090020
*                                                                     * 04160020
* EXITS,NORMAL -                                                      * 04230020
*    SET RETURN CODE REG. 15 TO 0                                     * 04370020
*    BR 14 RETURN TO CALLER                                           * 04440020
*                                                                     * 04510020
* EXITS,ERROR - NONE                                                  * 04580020
*                                                                     * 04650020
* TABLES/WORKAREAS -                                                  * 04720020
*    TIOCSAVE - 72 BYTE REGISTER SAVE AND WORK AREA IN TIOCRPT  YS02019 04790002
*                                                                     * 04860020
* ATTRIBUTES - REUSABLE,ENABLED                                 YS02019 04930002
*                                                                     * 05000020
* CHARACTER CODE DEPENDENCIES - NONE                                  * 05070020
*                                                                     * 05140020
* NOTES - N/A                                                         * 05210020
*                                                                     * 05280020
*********************************************************************** 05350020
*********************************************************************** 05420020
         EJECT                                                          05490020
* E Q U A T E S                                                         05560020
R0       EQU   0                        PARM,WORK REG.                  05630020
R1       EQU   1                        PARM,WORK REG.                  05700020
R2       EQU   2                        ATTN COUNT AND TJID             05770020
R3       EQU   3                        SCB                     YS02019 05840002
R4       EQU   4                        LCB                             05910020
R5       EQU   5                        ASCB                    YS02019 05980002
R6       EQU   6                        TSB                             06050020
R7       EQU   7                        QCB                             06120020
R8       EQU   8                        WORK REG AND RCB                06190020
R9       EQU   9                        WORK REG                        06260020
R10      EQU   10                       TIOCRPT                 YS02019 06330002
R11      EQU   11                       WORK REG                        06400020
R12      EQU   12                       BASE REG                        06470020
R13      EQU   13                       SAVE AREA                       06540020
R14      EQU   14                       RETURN TO CALLER                06610020
R15      EQU   15                       RETURN FROM INTERNAL SUBRTN     06680020
E0       EQU   0                        LENGTH/DISPLACEMENT CONSTANT    06750020
E1       EQU   1                        LENGTH/DISPLACEMENT CONSTANT    06820020
E3       EQU   3                        LENGTH/DISPLACEMENT CONSTANT    06890020
E4       EQU   4                        LENGTH/DISPLACEMENT CONSTANT    06960020
E5       EQU   5                        LENGTH/DISPLACEMENT CONSTANT    07030020
E16      EQU   16                       LENGTH/DISPLACEMENT     YS02019 07060002
E24      EQU   24                       LENGTH/DISPLACEMENT CONSTANT    07100020
OFF      EQU   X'FF'                    TO TURN OFF BITS                07170020
ON       EQU   4                        FOR TEST AND SET COND.          07240020
BUFFIHOT EQU   X'80'                    BUFFER ON IN & OUT QUE @ZA08015 07310003
         SPACE 2                                                        07380020
*                                                                       08190020
* DEFINE ENTRIES HERE                                                   08230020
*                                                                       08270020
         ENTRY QTIP0000,QTIP0030,QTIP0210,QTIP0220               S21008 08300021
         USING IEDQSCB,R3                                        S21008 08330021
         USING ASCB,R5                                          YS02019 08370002
         USING TSB,R6                                                   08550020
         USING TIOCRPT,R10              ADDRESSABILITY OF RPT   YS02019 08640002
         USING ATTNSAVE,R13                                      TS1637 08680020
         DC    CL8'IEDAYAA'             MODULE ID                S21008 08690021
         DC    X'6098'                  JULIAN DATE - 4/07/76  @ZA08015 08700003
*                                                                       08730020
* ENTRY 0                                                               08820020
*                                                                       08910020
*                                                                       09000020
QTIP0000 DS    0H                                                       09090020
         USING *,R12                                                    09180020
         LA    R13,TIOCSAVE             GET RPT SAVE AREA       YS02019 09181002
         CLI   TSBSTAX,AVTEZERO         IS STAX EXIT AVAILABLE  YS02019 09182002
         BE    QTIPE2                   NO, DO ATTN IGNORED      S21008 09183021
*                                       PROCESSING                      09184021
ATTNCT   EQU   *                                                YS02019 09185002
         CLC   TSBATTNC,TSBSTAX         IS ATTN LEVEL AVAILABLE YS02019 09205002
         BE    QTIPE2                   NO, IGNORE ATTENTION    YS02019 09225002
         L     R1,TSBATTNC              GET FULL WORD - BYTE 0  YS02019 09245002
*                                       HAS ATTNC, BYTE 1 HAS   YS02019 09265002
*                                       STAX                    YS02019 09285002
         LR    R2,R1                    PUT IT IN WORK REGISTER YS02019 09305002
         SRL   R2,E24                   RIGHT ADJUST ATTNC      YS02019 09325002
         TM    SCBERR3,SCBATTN          HARDWARE ATTN RECEIVED  YS02019 09345002
         BNO   CALCATCT                 NO, GO TO CALCULATE SIM YS02019 09365002
*                                       ATTENTION ACOUNT        YS02019 09385002
         LA    R2,E1(,R2)               INCREMENT ATTN CT BY 1  YS02019 09405002
         B     UPDATE                   GO TO UPDATE TSBATTNC   YS02019 09425002
         SPACE 1                                                        09445002
CALCATCT EQU   *                                                YS02019 09465002
         SR    R0,R0                    CLEAR REGISTER          YS02019 09485002
         IC    R0,SCBSALEV              GET ATTN LEVEL ENTERED  YS02019 09505002
         SRL   R0,E4                    RIGHT ADJUST VALUE      YS02019 09525002
         AR    R2,R0                    OBTAIN NEW ATTN COUNT   YS02019 09545002
         LA    R0,E0(,R1)               GET STAX COUNT          YS02019 09565002
         SRL   R0,E16                   RIGHT ADJUST VALUE      YS02019 09585002
         CR    R2,R0                    IS NEW ATTN CT GT STAX  YS02019 09605002
         BNH   UPDATE                   NO, UPDATE TSBATTNC     YS02019 09625002
         LR    R2,R0                    OTHERWISE MAKE ATTN CT  YS02019 09645002
*                                       EQUAL TO STAX CT        YS02019 09665002
         SPACE 1                                                        09685002
UPDATE   EQU   *                                                YS02019 09705002
         SLL   R2,E24                   PUT NEW ATTNC IN BYTE 0 YS02019 09725002
         LA    R0,E0(,R1)               CLEAR HIGH ORDER BYTE   YS02019 09745002
         OR    R2,R0                    MERGE IN BYTES 1-2-3    YS02019 09765002
         CS    R1,R2,TSBATTNC           STORE NEW ATTN COUNT    YS02019 09785002
         BNE   ATTNCT                   LOOP UNTIL IT'S DONE    YS02019 09805002
         SPACE 1                                                        09825002
         NI    SCBERR3,OFF-SCBXPI-SCBXPD  RESET ERROR BITS      YS02019 09845002
         NI    TSBFLG4,OFF-TSBOWAIT-TSBIWAIT RESET WAIT BITS    YS02019 09865002
*                                       (SINCE RCT WILL REMOVE  YS02019 09885002
*                                       IWAIT/OWAIT)            YS02019 09905002
*                                                               YS02019 09925002
* POST THE RCT TO SCHEDULE ATTENTION EXIT                       YS02019 09945002
*                                                               YS02019 09965002
         STM   R8,R14,SAVE8             SAVE REGISTERS          YS02019 09985002
         LR    R8,R13                   SAVE AREA POINTER       YS02019 10005002
         SR    R10,R10                  COMPLETION CODE IS ZERO YS02019 10025002
         LA    R11,ASCBECB              PASS THE ECB ADDRESS    YS02019 10045002
         O     R11,HIGHBIT              HI ORDER BIT ON FOR XM  YS02019 10065002
*                                       POST                    YS02019 10085002
         L     R12,CVTPTR               GET CVT ADDRESS         YS02019 10105002
         L     R15,CVT0PT01-CVT(,R12)   GET POST ROUTINE'S EPA  YS02019 10125002
         LA    R12,CVTBRET-CVT(,R12)    GET ADDRESS OF CVTBRET  YS02019 10145002
         LR    R13,R5                   ADDRESS OF USER'S ASCB  YS02019 10165002
         MODESET EXTKEY=SUPR            CHANGE INTO KEY 0       YS02019 10175002
         BALR  R14,R15                  GO TO POST RCT          YS02019 10185002
         MODESET EXTKEY=TCAM            CHANGE BACK TO TCAM KEY YS02019 10195002
         LR    R13,R8                   GET SAVE AREA POINTER   YS02019 10205002
         LM    R8,R14,SAVE8             RESTORE REGISTERS       YS02019 10225002
         SPACE                                                          10530020
         MVI   CLRSW,CLRTRL+CLRATTN     INDICATE TRLR Q TO BE CLEARED   10620020
         BAL   R15,CLROUTQ              CLEAR OUTPUT QUEUES             10720002
         BAL   R15,CLRINQ               CLEAR INPUT QUEUES              10820002
         SPACE                                                          10980020
         NI    TSBFLG2,OFF-TSBAUTON-TSBSTAUT   RESET AUTOLN BITS        11080020
         SPACE                                                          11250020
         MVI   RMVSW,RMVULW+RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM     11340020
         BAL   R15,RMVWAITS             TYPE WAITS                      11430002
         SPACE                                                          11520020
         B     RETURN                    RETURN TO CALLER               11610020
         SPACE 1                                                        11700002
QTIPE2   EQU   *                                                 S21008 15890021
         NI    SCBERR3,OFF-SCBXPD-SCBATTN-SCBSATTN  RESET        S21008 15940021
         OI    SCBERR3,SCBXPI           ATTN IGNORED MESSAGE     S21008 15990021
         TM    TSBFLG4,TSBOWAIT         IS USER IN OWAIT        YS02019 16040002
         BNO   QENTRY2A                 NO-DON'T SET TSBATTN            16220002
         OI    TSBFLG3,TSBATTN          YES-SET TSBATTN                 16230002
         SPACE 1                                                        16235002
QENTRY2A EQU   *                                                        16240020
         MVI   CLRSW,CLRTRL+CLRATTN+CLRIGN   SET CLEAR SWITCHES         16380020
         BAL   R15,CLROUTQ              CLEAR OUTPUT QUEUES             16480002
         BAL   R15,CLRINQ               CLEAR INPUT QUEUES              16580002
         SPACE                                                          16740020
         MVI   RMVSW,RMVULW+RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM     16830020
         BAL   R15,RMVWAITS                   TYPE WAITS                16920020
         SPACE                                                          17010020
         B     RETURN                   RETURN TO CALLER                17100020
         DROP  R3,R5                    DROP SCB AND ASCB BASE YS02019  17140002
         SPACE 3                                                        17190020
*                                                                       17280020
* ENTRY 3                                                               17370020
*                                                                       17460020
QTIP0030 DS    0H                                                       17550020
         LA    R13,TIOCSAVE             GET SAVE AREA ADDRESS   YS02019 17590002
         SPACE                                                          17730020
         MVI   CLRSW,CLRTRL+CLRTJID+CLRHANG                             17820020
         BAL   R15,CLROUTQ              CLEAR OUTPUT QUEUES             17920002
         BAL   R15,CLRINQ               CLEAR INPUT QUEUES              18020002
         SPACE                                                          18180020
         MVI   RMVSW,RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM            18270020
         BAL   R15,RMVWAITS                    TYPE WAITS               18360002
         SPACE                                                          18450020
         B     RETURN                   RETURN TO CALLER                18540020
         SPACE 3                                                        18580002
*                                                                       18630020
* ENTRY 21                                                              18720020
*                                                                       18810020
QTIP0210 DS    0H                                                       18900020
         BAL   R1,FINDSAVE              FIND THE RPT SAVEAREA   YS02019 18990002
         LR    R6,R15                   GET TSB ADDRESS         YS02019 19010002
         TM    TSBFLG4,TSBHUNG          DID USER HANG UP        YS02019 19030002
         BCR   1,R14                    YES, RETURN             YS02019 19050002
         SPACE 2                                                        19080020
         TM    TSBFLG2,TSBBIPI          IS REPROMPT IN PROCESS  ZA02235 19130002
         BOR   R14                      YES, RETURN             ZA02235 19140002
         MVI   CLRSW,CLRTCLRQ           INDICATE CALL FROM TCLEARQ      19170020
         BAL   R15,CLRINQ               GO CLEAR INPUT Q                19260020
         SPACE 2                                                        19350020
         MVI   RMVSW,RMVSLW+RMVSOWT            REMOVE SYSTEM            19440020
         BAL   R15,RMVWAITS                         REMOVE SYSTEM       19530020
         SPACE 2                                                        19620020
         B     RETURN                   RETURN TO CALLER                19710020
         SPACE 3                                                        19750002
*                                                                       19800020
* ENTRY 22                                                              19890020
*                                                                       19980020
QTIP0220 DS    0H                                                       20070020
         BAL   R1,FINDSAVE              FIND THE RPT SAVEAREA   YS02019 20160002
         LR    R6,R15                   GET TSB ADDRESS         YS02019 20180002
         TM    TSBFLG4,TSBHUNG          DID USER HANG UP        YS02019 20200002
         BCR   1,R14                    YES, RETURN             YS02019 20220002
         SPACE 2                                                        20250020
         MVI   CLRSW,CLRTCLRQ           INDICATE CALL FROM TCLEARQ      20340020
         BAL   R15,CLROUTQ              GO CLEAR OUTPUT Q               20430020
         SPACE 2                                                        20520020
         MVI   RMVSW,RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM            20610020
         BAL   R15,RMVWAITS                   TYPE WAITS                20700020
         SPACE 2                                                        20790020
RETURN   EQU   *                                                        20880002
         SR    R15,R15                  PASS GOOD RETURN                21420020
         BR    R14                      RETURN TO CALLER                21510020
         SPACE 2                                                 TS1637 21516020
*                                                                       21522020
* THIS SUBROUTINE LOCATES THE SAVE AREA IN TIOCRPT AND RETURNS  YS02019 21528002
* THE ADDRESS IN REGISTER 13                                    YS02019 21534002
*                                                                       21540020
FINDSAVE EQU   *                                                 TS1637 21546020
         L     R10,CVTPTR               GET CVT ADDRESS         YS02019 21552002
         L     R10,CVTAQAVT-CVT(,R10)   GET TCS ADDRESS         YS02019 21561002
         L     R10,TCXRPT-IEDQTCX(,R10) GET RPT ADDRESS         YS02019 21570002
         LA    R13,TIOCSAVE             GET RPT SAVE AREA       YS02019 21579002
         BR    R1                       RETURN TO CALLER        YS02019 21588002
         EJECT                                                          21600020
*                                                                       21690020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21780020
*                                                                       21870020
*  C L I N Q- CLEAR INPUT QUEUE                                         21960020
*                                                                       22050020
*            INPUT-  R6   TSB                                           22140020
*                    R10  TIOCRPT                               YS02019 22230002
*                    R15  RETURN                                        22410020
*            THE FOLLOWING REGISTERS ARE VOLATILE OVER THIS SUBR        22500020
*                    R0                                                 22590020
*                    R1                                                 22680020
*                    R2                                         YS02019 22710002
*                    R3                                         YS02019 22740002
*                    R8                                                 22770020
*                    R9                                                 22860020
*                    R11                                                22950020
*                                                                       23040020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 23130020
*                                                                       23220020
CLRINQ   DS    0H                                                       23310020
         USING IEDQQCB,R7               ADDRESSABILITY FOR QCB  YS02019 23400002
         ST    R15,SAVE15               SAVE RETURN ADDRESS     YS02019 23490002
         SR    R3,R3                    CLEAR LINE CT REGISTER  YS02019 23760002
         NI    TSBFLG2,OFF-(TSBBRKIN+TSBBIPI) END BREAKIN PROCESSING    23850020
         TM    CLRSW,CLRTCLRQ           CALL FROM TCLEARQ?      YM2814  23860000
         BO    CLINSPIT                 YES, DON'T RESET SPIT,  YM2814  23862000
*                                       OR IFLSH                        23864000
         NI    TSBFLG1,OFF-TSBIFLSH     TURN OFF IFLSH (SET BY    M0029 23870002
*                                       TCLEARQ)                  M0029 23890002
         NI    TSBFLG3,OFF-TSBSPIT      TURN OFF STOP PROMPT BIT  M0029 23910002
CLINSPIT EQU   *                                                YM2814  23920000
*                                                                       23940020
* CHECK FOR ANY BUFFERS ON TRAILER Q                                    24030020
*                                                                       24120020
         OC    TSBITBFP,TSBITBFP        IS  TRLR Q EMPTY                24210020
         BZ    CLIHQ                    YES CLEAR H Q                   24300020
*                                                                       24390020
* PREPARE TO CLEAR TRAILER Q                                            24480020
*                                                                       24570020
         L     R11,TSBITBFP-E1          TRAILR QUE PTR                  24660020
         USING TIOCBUF,R11                                              24750020
         L     R1,TSBIBFP-E1            SAVE HDR Q PTR          YS02019 24840002
         XC    TSBITBFP,TSBITBFP        ZAP T Q                         24930020
         XC    TSBIBFP,TSBIBFP          CLEAR INPUT HDR BFFR POINTER    24970020
         B     CLIXBUFF                 GO REMOVE BUFFER                25020020
*                                                                       25110020
* PREPARE TO CLEAR HEADER Q                                             25200020
*                                                                       25290020
CLIHQ    DS    0H                                                       25380020
         OC    TSBIBFP,TSBIBFP          TEST IF INPUT Q EMPTY           25410020
         BZ    CLIEXITA                 YES,GO TO EXIT                  25440002
         L     R11,TSBIBFP-E1           HEADER QUE PTR                  25500020
         XC    TSBIBFP,TSBIBFP          CLEAR H Q PTR                   25560020
         SPACE 2                                                        25650020
CLIA     DS    0H                                                       25740020
         L     R1,BUFFHEAD-E1           SAVE NEXT HEADER PTR    YS02019 25830002
         LA    R11,0(R11)               CLEAR FOR TEST                  25920020
         LTR   R11,R11                  DID WE JUST PROCESS LAST MSG    26010020
         BZ    CLIEXIT                  YES,BEGIN EXIT PROCESSING       26110002
         TM    BUFFFL1,BUFFNLCR         HAS MSG BEEN COUNTED            26280020
*                                       BY TSINPUT                      26370020
         BZ    CLIXBUFF                 IF NOT, DON'T COUNT             26460020
         LA    R3,E1(R3)                ADD 1 TO LINE COUNT     YS02019 26550002
         SPACE 2                                                        26640020
*                                                                       26730020
* REMOVE BUFFER FROM INPUT QUE AND PUT ON FREE QUE IF          @ZA08015 26820003
* IT IS DETERMINED IT IS NOT ALSO ON OUTPUT QUE(BUFFIHOT).     @ZA08015 26850003
*  IF ON BOTH QUES, DROP BUFFER FROM INPUT QUE BUT DONT        @ZA08015 26880003
* PUT ON FREE QUE.                                             @ZA08015 26910003
*                                                              @ZA08015 26940003
CLIXBUFF DS    0H                                                       26970003
         L     R8,BUFFTRLR-E1           SAVE NEXT TRLR PTR              27000003
         TM    BUFFFL1,BUFFIHOT         BUFFER ON BOTH QUES?   @ZA08015 27030003
         BNO   CLIXBUF1                 NO, PUT IT ON FREE QUE @ZA08015 27060003
         NI    BUFFFL1,OFF-BUFFIHOT     TURN OFF FLAG          @ZA08015 27090003
         B     CLISKIP                  GET NEXT TRAILER       @ZA08015 27120003
CLIXBUF1 EQU   *                                               @ZA08015 27150003
         LR    R2,R11                   BFR TO BE RETURNED      YS02019 27180002
         L     R15,AYQBRAD              BFR RETURN RTN'S EPA    YS02019 27380002
         BALR  R0,R15                   GO TO RETURN BFR        YS02019 27580002
         SPACE                                                          27900020
*                                                                       27990020
* PREPARE NEXT TRAILER FOR REMOVAL                                      28080020
*                                                              @ZA08015 28170003
CLISKIP  EQU   *                                               @ZA08015 28210003
         LA    R11,0(R8)                GET TRAILER POINTER             28260020
         LTR   R11,R11                  WAS THIS THE LAST PART OF MSG   28440020
         BNZ   CLIXBUFF                 NO,CLEAR ANOTHER TRAILER        28530020
         SPACE                                                          28620020
*                                                                       28710020
* PREPARE TO PROCESS NEXT MSG                                           28800020
*                                                                       28890020
         LR    R11,R1                   GET NEXT MSG HDR PRT    YS02019 28980002
         B     CLIA                     AND GO BACK                     29070002
*                                                                       29160020
* ENTERED UPON COMPLETION OF CLEARING INPUT Q.                          29250020
* LAST MSG JUST PROCESSED, DO EXIT PROCESSING                           29520020
*                                                                       29610020
CLIEXIT  EQU   *                                                        29640020
         MVI   TSBNIBF,E0               CLEAR TSBNIFB           YS02019 29670002
CLIEXITA EQU   *                                                        29820020
         TM    CLRSW,CLRHANG            FROM HANGUP                     29880020
         BO    CLIEND                   YES,BRANCH                      29940002
         TM    CLRSW,CLRTCLRQ           CALLED BY TCLEARQ       YS02019 29950002
         BO    IFLSHON                  YES, SKIP BFR CHECKING  YS02019 29960002
         TM    QCBTSOF2,QCBBUFQ         IS BUFF ON HOLD Q               29970002
         BNO   CLIEXITB                 NO,BRANCH TO EXIT               30170002
         SPACE 1                                                        30230002
IFLSHON  EQU   *                                                YS02019 30290002
         OI    TSBFLG1,TSBIFLSH         TELL TSINPUT TO FLSH TCAM BUFS  30370002
CLIEXITB EQU   *                                                        30570020
         TM    CLRSW,CLRIGN+CLRTCLRQ    CALLED BY ATTN IGNORED  YM06727 30770002
*                                       OR TCLEARQ              YM06727 30820002
         BNZ   CLIEXITC                 YES,DON'T TURN OFF QCBREAD/TGET 30970002
         LM    R0,R1,TSBTPOST           GET TSBTPOST CONDITION  YS02019 31290002
RETRY1   EQU   *                                                YS02019 31298002
         LR    R8,R0                    .PUT TSBTPOST STATUS IN YS02019 31306002
         LR    R9,R1                    .WORK REGISTERS         YS02019 31314002
         O     R8,MASK1                 .TURN OFF QCBREAD IN    YS02019 31322002
         N     R8,MASK2                 .QCBFLAG                YS02019 31330002
         O     R9,MASK3                 .TURN OFF QCBTGET IN    YS02019 31338002
         N     R9,MASK4                 .QCBTSOF1               YS02019 31346002
         CDS   R0,R8,TSBTPOST           UPDATE TSBTPOST         YS02019 31354002
         BNE   RETRY1                   LOOP UNTIL IT'S DONE    YS02019 31362002
         BAL   R7,TPOSTAYP              GO TO TPOST AYP         YS02019 31370002
CLIEXITC EQU   *                                                        31380020
         TM    TSBFLG2,TSBAULST+TSBAUTON     IS AUTO LN IN EFFECT       31410020
         BNO   CLIEND                    IF NOT, EXIT                   31500020
         LTR   R3,R3                    ANY LINES DELETED       YS02019 31590002
         BZ    CLIEND                    IF NOT, EXIT                   31680020
         L     R1,TSBAUTOS               CURRENT LINE COUNT             31770020
         L     R0,TSBAUTOI               LINE CNT INCR                  31860020
         SPACE                                                          31950020
CLILNDEC DS    0H                                                       32040020
         SR    R1,R0                    DECR LN CNT                     32130020
         BNP   CLIST0                   IF NOT PLUS, STORE ZERO         32220020
         BCT   R3,CLILNDEC              DECREMENT LD COUNT      YS02019 32310002
         ST    R1,TSBAUTOS              STORE NEW AUTO LN COUNT         32400020
         B     CLIEND                   SKIP NEXT INSTRUCTION           32490020
CLIST0   XC    TSBAUTOS,TSBAUTOS        ZERO LINE COUNT                 32580020
CLIEND   DS    0H                                                       32670020
         L     R15,SAVE15               GET RETURN ADDRESS      YS02019 32770002
         BR    R15                      RETURN                          32940020
         DROP  R7                       DROP QCB BASE                   33750002
         EJECT                                                          38700020
*                                                                       44280020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 44370020
*                                                                       44460020
* C L R O U T Q   -   CLEAR TSO OUTPUT QUEUES                           44550020
*                                                                       44640020
*        INPUT: CLRSW    BIT 0:  0= CLEAR ALL NSGS EXCEPT TJID TYPE     44730020
*                                1= CLEAR ALL MSGS                      44820020
*                        BIT 1:  0= DO NOT CLEAR TRAILER BUFFER         44910020
*                                1= CLEAR IT                            45000020
*                                                                       45090020
*                        R4:  LCB FOR THIS LINE                         45180020
*                        R6:  TSB                                       45270020
*                        R10: TIOCRPT                           YS02019 45360002
*                                                                       45450020
*        REGISTERS VOLATILE OVER THIS SUBROUTINE: R0,R1,R8,R11          45540020
*                                                 R2,R9         YS02019 45580002
*                                                                       45630020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 45720020
*                                                                       45810020
CLROUTQ  DS    0H                                                       45900020
         ST    R15,SAVE15               SAVE RETURN REGISTER            45990002
         SR    R15,R15                  ZAP R15                         46080002
         ST    R15,SAVE11               ZERO OUT SAVE11         YM03889 46130002
         CLI   TSBNOBF,E0               ARE THERE ANY OUTPUT BUF        46160020
         BNZ   CLROQ1                   YES,BRANCH                      46180002
         TM    CLRSW,CLRATTN+CLRHANG    FROM ATTN OR HANGUP             46200020
         BZ    CLOEXIT2                 NO,EXIT                         46220002
         XC    TSBOTBFP(E3),TSBOTBFP    CLEAR OUTBUF POINTER            46240002
*                                       OF POSSIBLE REPROMPT MESSAGES   46245002
         B     CLOEXIT2                 GO TO EXIT                      46250002
CLROQ1   EQU   *                                                        46260020
         L     R9,TSBOBFP-E1            SAVE HQ PTR                     46280020
         LA    R9,0(R9)                 CLEAR HIGH ORDER BYTE           46300002
         XC    TSBOBFP(E3),TSBOBFP      CLEAR TSB HQ PTR                46320020
         TM    CLRSW,CLRTRL             SHOULD TRAILR QUE BE CLEARED    46380020
         BZ    CLOHEAD                  NO, GO CLEAR HEADER Q           46440002
         TM    TSBSTAT,TSB3270          IS THIS A 3270          SA70323 46490002
         BNO   CLRNO327                 NO, CLEAR TRLR NORMALLY SA70323 46500002
         TM    CLRSW,CLRHANG            IS THIS HANGUP          SA70323 46510002
         BNO   CLOHEAD                  FOR 3270, CLEAR TRAILER SA70323 46520002
*                                       ONLY FOR HANGUP ENTRY   SA70323 46522002
CLRNO327 EQU   *                                                SA70323 46524002
         OC    TSBOTBFP(E3),TSBOTBFP    IS TRAILR QUE EMPTY             46530020
         BZ    CLOHEAD                  YES, CLEAR H Q                  46620002
         TM    TSBFLG3,TSBTJMSG         TJID TYPE MESSAGE               46710020
         BZ    CLOTRL                   NO, GO CLEAR                    46800002
         TM    CLRSW,CLRTJID            SHOULD TJID MSGS BE CLEARED     46890020
         BZ    CLOHEAD                  NO, GO CLEAR H Q                46980002
         SPACE 2                                                        47070020
CLOTRL   DS    0H                                                       47160020
         L     R11,TSBOTBFP-E1          GET 1ST TRLR PTR                47250020
         XC    TSBOTBFP(E3),TSBOTBFP    ZERO T Q PTR                    47340020
         USING TIOCBUF,R11                                              47430020
         TM    CLRSW,CLRATTN+CLRHANG    FROM ATTN OR HANGUP             47520020
         BZ    CLOTRL2                  NO, DON'T TEST BIPI             47610002
         TM    TSBFLG2,TSBBIPI          IS BIPI ON (SET BY BREAKIN)     47700002
         BO    CLOHEAD                  DO NOT FREE TRLR QUE BFR        47800002
CLOTRL2  DS    0H                                                       48060020
         LA    R8,0(R9)                 SAVE HQ PTR                     48150020
         B     CLOXBUFF                 GO REMOVE BUFFER FROM Q         48240020
         SPACE 2                                                        48330020
CLOHEAD  DS    0H                                                       48420020
         LTR   R11,R9                   LAST HDR MSG                    48620020
         BZ    CLOEXIT0                 YES,BRANCH                      48820020
         SPACE 2                                                        49770002
CLOBUMP  DS    0H                                                       49860020
         L     R8,BUFFHEAD-E1           SAVE NEXT MSG PTR               49950020
         ST    R11,SAVE11               SAVE CURRENT BUFFER     YS02019 50310002
*                                       HEADER POINTER          YS02019 50350002
         TM    BUFFFL2,BUFFTJID         TEST IF TJID MESSAGE            50400020
         BNO   CLOXBUFF                 NO,GO RENAME BUFFER FROM Q      50490020
         TM    CLRSW,CLRTJID            SHOULD TJID MSGS BE CLRD        50580020
         BZ    CLORECHN                 NO,BRANCH                       50670020
         SPACE                                                          50760020
CLOXBUFF DS    0H                                                       50850020
         L     R3,BUFFTRLR-E1           SAVE CURR BFR TRLR PTR  YS02019 50940002
         TM    BUFFFL1,BUFFIHOT         BUFFER ON BOTH QUES?   @ZA08015 50950003
         BNO   CLOXBUF1                 NO, PUT ON FREE QUE    @ZA08015 50960003
         NI    BUFFFL1,OFF-BUFFIHOT     TURN OFF FLAG          @ZA08015 50970003
         B     CLOSKIP                  GET NEXT TRAILER       @ZA08015 50980003
         SPACE 1                                               @ZA08015 50990003
CLOXBUF1 EQU   *                                               @ZA08015 51000003
         LR    R2,R11                   BFR TO BE RETURNED      YS02019 51040002
         L     R15,AYQBRAD              BFR RETURN RTN'S EPA    YS02019 51140002
         BALR  R0,R15                   GO TO RETURN BFR        YS02019 51240002
         SR    R1,R1                    CLEAR REGISTER          YS02019 51340002
         IC    R1,TSBNOBF               GET OUTPUT BUFFER CNT           51480020
         BCTR  R1,R0                    SUBTRACT 1                      51570020
         STC   R1,TSBNOBF               UPDATE TSB CNT                  51660020
*                                                                       51750020
* PREPARE TO FREE NEXT BUFFER                                           51840020
*                                                                       51930020
CLOSKIP  EQU   *                                               @ZA08015 51970003
         LR    R11,R3                   GET TRLR POINTER        YS02019 52020002
         LA    R11,E0(R11)              CLEAR 1ST BYTE                  52110020
         LTR   R11,R11                  LAST OF MSG CLEARED             52200020
         BNZ   CLOXBUFF                 NO, REMOVE NEXT BUFF            52290002
*                                                                       52380020
* GET NEXT MSG FOR REMOVAL                                              52470020
*                                                                       52560020
CLONEXT  DS    0H                                                       52650020
         LA    R8,0(R8)                 CLEAR HI ORDER BYTE             52700020
         LTR   R11,R8                   LAST HDR MSG                    52750020
         BZ    CLOEXIT0                 YES, EXIT                       52800020
         B     CLOBUMP                  NO,CLEAR NEXT MSG               52860020
*                                                                       52920020
* RECHAIN TJID MSG                                                      53010020
*                                                                       53100020
CLORECHN DS    0H                                                       53190020
         XC    BUFFHEAD(E3),BUFFHEAD    ZAP HQ PTR                      53220020
         OC    TSBOBFP(E3),TSBOBFP      IS QUE EMPTY                    53290020
         BNZ   CLOFLAST                 NO, FIND LAST MSG               53370002
         IC    R1,TSBOBFP-E1            GET FLAG BYTE                   53460020
         SLL   R1,E24                   LEFT ADJUST COUNT               53550020
         OR    R11,R1                   PUT CNT IN 1ST BYTE             53640020
         ST    R11,TSBOBFP-E1           UPDATE QUE PTR                  53730020
         B     CLONEXT                  GO GET NEXT HDR MSG             53820020
*                                                                       53910020
* FIND LAST MSG                                                         54000020
*                                                                       54090020
CLOFLAST DS    0H                                                       54180020
         LR    R0,R11                   SAVE HEADER PTR                 54270020
         L     R11,TSBOBFP-E1           GET 1ST MSG PTR                 54360020
         SPACE                                                          54450020
CLOA     DS    0H                                                       54540020
         OC    BUFFHEAD(E3),BUFFHEAD    LAST MSG                        54630020
         BZ    CLOB                     YES, CHAIN TO Q                 54720002
         L     R11,BUFFHEAD-E1          NEXT MSG                        54810020
         B     CLOA                     LOOK FOR LAST MSG               54900020
CLOB     DS    0H                                                       54990020
         IC    R1,BUFFHEAD-E1           GET FLAG BYTE                   55080020
         SLL   R1,E24                   LEFT ADJUST                     55170020
         OR    R0,R1                    MERGE                           55260020
         ST    R0,BUFFHEAD-E1           CHAIN MSG INTO QUE              55350020
         B     CLONEXT                  GO PROCESS NEXT MSG             55440020
         SPACE 2                                                        55490002
CLOEXIT0 DS    0H                                                       55800020
         OC    TSBOTBFP(E3),TSBOTBFP    TEST IF ANY TRAILER IN Q        55810020
         BZ    NOTRILR                  NO,SKIP SETTING BIT             55820020
         TM    TSBFLG3,TSBTJMSG         TEST IF ANY TJID MSG IN Q       55830020
         BO    NOTRILR                  YES,SKIP SETTING BIT            55840020
         TM    TSBFLG2,TSBBIPI          REPROMPT MSG ON OUT TRLR QUE    55845020
         BO    NOTRILR                  YES,BRANCH                      55850002
         OI    TSBFLG1,TSBOFLSH         NO,TELL TSOUTPUT TO FLUSH TRLRQ 55855002
NOTRILR  EQU   *                                                        55860020
         TM    CLRSW,CLRHANG            CALL FROM HANGUP        YS02019 55900002
         BO    CLOEXIT2                 YES, EXIT               YS02019 55930002
         L     R15,SAVE11               GET HEAD QUEUE PTR      YS02019 55960002
         LTR   R15,R15                  WAS HEADER QUE EMPTY            56010002
         BNZ   NOTRILR2                 NO,CHECK LAST MSG CLEARED       56020002
         TM    TSBFLG3,TSBTJMSG         TJID MSG ON OUT TRLR QUE        56030020
         BO    CLOEXIT2                 YES,DO NOT TURN OFF QCBPARTO    56040002
         B     NOTRILR3                 NO,TURN OFF QCBPARTO            56050002
NOTRILR2 EQU   *                                                        56060020
         DROP  R11                                                      56100020
         USING TIOCBUF,R15                                              56200020
         TM    BUFFFL2,BUFFTJID         TEST IF TJID MESSAGE            56280020
         BO    CLOEXIT2                 YES,GOTO RETURN                 56360020
NOTRILR3 EQU   *                                                        56450020
         L     R0,TSBF2M                GET TSBTPOST CONDITION  YS02019 56500002
RETRY2   EQU   *                                                YS02019 56510002
         LR    R1,R0                    .PUT TSBTPOST STATUS IN YS02019 56520002
*                                       .WORK REGISTERS         YS02019 56530002
         O     R1,MASK5                 .TURN OFF QCBPARTO      YS02019 56540002
         N     R1,MASK6                 .IN QCBTSOF1            YS02019 56550002
         CS    R0,R1,TSBF2M             UPDATE TSBTPOST         YS02019 56560002
         BNE   RETRY2                   LOOP UNTIL IT IS DONE   YS02019 56570002
         BAL   R7,TPOSTAYP              GO TO TPOST AYP         YS02019 56580002
         DROP  R15                                                      56600020
CLOEXIT2 DS    0H                                                       57330020
         L     R15,SAVE15               RESTORE RETURN REGISTER         57420002
         BR    R15                      RETURN TO CALLER                57510020
         EJECT                                                          57600020
*                                                                       57690020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   57780020
*                                                                       57870020
*  R M V W A I T S: REMOVE THE VARIOUS SYSTEM AND USER WAIT             57960020
*                   CONDITIONS. THE FLOW OF CONTROL THROUGH             58050020
*                   THIS ROUTINE IS CONTROLLED BY BIT SETTINGS          58140020
*                   IN RMVSW.                                           58230020
*                                                                       58320020
*                       BIT 0:     REMOVE USER LWAITS                   58410020
*                           1:            SYSTEM LWAITS                 58500020
*                           2:            WAITS ON OWAITS               58590020
*                           3:            TJID/TPUT WAITS               58680020
*                           4:            IWAITS                        58770020
*                           5:            OWAITS                        58860020
*                                                                       58950020
*                                                                       59040020
*                   REGISTER INPUTS:                                    59130020
*                        R4: LCB                                        59310020
*                        R6: TSB                                        59490020
*                        R10: TIOCRPT                           YS02019 59580002
*                        R13: TIOCSAVE                          YS02019 59670002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   59760020
*                                                                     * 59850020
RMVWAITS DS    0H                                                       59940020
         STM   R14,R15,SAVE14           SAVE REGISTERS           TS1637 60030002
         USING TIOCRPT,R10                                      YS02019 60120002
         OC    TIOCNFBF,TIOCNFBF        ANY FREE BFRS AT ALL    YS02019 60300002
         BZ    RMVEXIT                  NO, GO TO EXIT          YS02019 60400002
         TM    RMVSW,RMVULW             DO WE WANT TO REMOVE USER       60660020
*                                       LWAITS                          60750002
         BZ    RMVTSLW                  NO, MAKE MORE TESTS             60840002
         TM    TSBSTAT,TSBINUSE         IS USER STILL CONNECTED         60870020
         BZ    RMVTSLW                  NO,CHECK SYSTEM LWAIT           60900020
         TM    TSBSTAT,TSBLWAIT         IS USER IN LWAIT                60960020
         BZ    RMVTSLW                  NO, MAKE TEST FOR SYS LWAIT     61020002
*                                                                       61110020
* TRY TO REMOVE USER FROM LWAIT                                         61200020
*                                                                       61290020
         SR    R1,R1                    CLEAR WORK REG.                 61390020
         IC    R1,TSBNIBF               NO. OF BUFRS ON INPUT Q         61490020
         CH    R1,TIOCRSTH              IS THRESHOLD EXCEEDED           61590020
         BH    RMVTSLW                  YES, SKIP FOLLOWING CODE        61740002
         NI    TSBSTAT,OFF-TSBLWAIT     TURN OFF LWAIT                  61830020
*                                                                       61920020
         TM    TIOCFLG,TIOCSYLW         IS SYSTEM IN LWAIT              62010020
         BO    RMVTSLW                  YES, CHK FOR SYS LWAIT    M0029 62070002
*                                       REMOVAL                  M0029  62130020
         L     R0,TSBF2M                GET TSBTPOST CONDITION  YS02019 62190002
RETRY3   EQU   *                                                YS02019 62790002
         LR    R1,R0                    .PUT TSBTPOST IN        YS02019 63390002
*                                       .WORK REGISTERS         YS02019 63990002
         O     R1,MASK7                 .TURN OFF QCBNOBUF      YS02019 64590002
         N     R1,MASK8                 .IN QCBTSOF1            YS02019 65190002
         CS    R0,R1,TSBF2M             UPDATE TSBTPOST         YS02019 65790002
         BNE   RETRY3                   LOOP UNTIL IT IS DONE   YS02019 66390002
         BAL   R7,TPOSTAYP              GO TO INVOKE TPQ FOR    YS02019 66990002
*                                       TPOSTING TSB TO AYP     YS02019 67590002
         SPACE 2                                                        68580020
*                                                                       68670020
* TEST TO SEE IF TCAM BUFFERS CAN BE REMOVED FROM THE WAIT QUEUE        68760020
* AND/OR IF THE SYSTEM CAN BE REMOVED FROM SYSTEM LWAIT                 68850020
*                                                                       68940020
         SPACE 2                                                        69030020
RMVTSLW  EQU   *                                                        69120020
         TM    RMVSW,RMVSLW             DO WE WANT TO REMOVE SYS LWAIT  69210002
         BZ    RMVTUOWT                 NO,GO CHECK USER OWAIT          69300002
         TM    TIOCFLG,TIOCSYLW         NO,IS SYSTEM IN LWAIT           70550002
         BZ    RMVTUOWT                 NO,CHECK USER OWAIT             70570002
         SPACE 3                                                 M0167  70622021
POSTTSI  EQU   *                                                        70630020
         L     R0,TSBTPOST              GET STATUS OF TSBTPOST  YS02019 70630502
RETRY4   EQU   *                                                YS02019 70830502
         LR    R1,R0                    PUT IN WORK REGISTER    YS02019 71030502
         O     R1,MASK9                 TURN ON TSBTPAYI FOR    YS02019 71230502
*                                       TPOSTING TSI TO AYI     YS02019 71430502
         CS    R0,R1,TSBTPOST           UPDATE TSBTPFLG         YS02019 71630502
         BNE   RETRY4                   LOOP UNTIL IT'S DONE    YS02019 71830502
         BAL   R7,TPOSTAYP              CALL AYP TO POST        YS02019 72030502
         SPACE 2                                                        72720720
*                                                                       72721420
* THIS SECTION TESTS TO SEE IF USER OWAIT CAN BE REMOVED                72722120
*                                                                       72722820
         SPACE 2                                                        72723520
RMVTUOWT EQU   *                                                        72724220
         TM    RMVSW,RMVUOWT            DO WE WANT TO REMOVE USER OWAIT 72724902
         BZ    RMVTSOWT                 NO,CHECK SYSTEM OWAIT           72725602
         TM    TSBSTAT,TSBINUSE         IS USER STILL CONNECTED         72725820
         BZ    RMVTSOWT                 NO,CHECK SYSTEM OWAIT           72726020
         TM    TSBFLG4,TSBOWAIT         IS USER IN OWAIT        YS02019 72726302
         BZ    RMVTSOWT                 GO CHECK SYS OWAIT       S21008 72727021
*                                                                       72727720
* REGULAR TPUT IS IN OWAIT - TEST TO SEE IF IT CAN BE REMOVED           72728420
*                                                                       72729120
         SR    R0,R0                    CLEAR TEST REGISTER             72729802
         IC    R0,TSBNOBF               GET NO. BFR USER NOW HOLDING    72730502
         CH    R0,TIOCOWTH              IS THRESHOLD EXCEEDED           72731420
         BH    RMVTSOWT                 YES,CHECK SYSTEM OWAIT          72732320
*                                                                       72733320
* REMOVE USER FROM OWAIT                                                72734020
*                                                                       72734720
         STM   R8,R12,SAVE8             SAVE REGISTERS ACROSS   YS02019 72735702
*                                       CALL                     S21008 72736721
         LA    R8,0(,R6)                SET UP TSB ADDR FOR      S21008 72737721
*                                       SUB-RTN                  S21008 72738721
         IC    R9,TSBFLG2               SAVE TSBBIPI SETTING     S21008 72739721
         NI    TSBFLG2,OFF-TSBBIPI      REQUEST OWAIT REMOVAL    S21008 72740721
*                                                                       72745721
RMVUOWT1 EQU   *                                                 S21008 72746721
         L     R15,UOWRR                GET USER-OWAIT-REMOVAL   S21008 72747721
*                                       RTN ADD                  S21008 72748721
         L     R12,AYOOBASE             GET BASE ADDR OF RTN     S21008 72749721
         BALR  R4,R15                   GO TO OWAIT REMOVAL RTN  S21008 72750721
*                                       ADDR                     S21008 72751721
*                                                                       72752721
         STC   R9,TSBFLG2               RESTORE TSBBIPI SETTING  S21008 72753721
         LM    R8,R12,SAVE8             RESTORE REGISTERS       YS02019 72754702
         SPACE 2                                                        72761320
*                                                                       72762020
* THIS SECTION TESTS FOR REMOVAL OF SYSTEM OWAIT                        72762720
*                                                                       72763420
         SPACE 2                                                        72764120
RMVTSOWT EQU   *                                                        72764820
         TM    RMVSW,RMVSOWT            DO WE WANT TO REMOVE SYS OWAIT  72765502
         BZ    RMVEXIT                  NO,EXIT                         72766202
         LR    R8,R6                    GET TSB ADDR FOR SUB-RTN S21008 73366221
         STM   R6,R7,SAVE6              SAVE REGISTERS          YS02019 76366202
         ST    R12,SAVE12               SAVE BASE ADDRESS       YS02019 76966202
         L     R15,SOWRR                GET SYS-OWAIT REMOVAL    S21008 77566221
*                                       RTN ADDR                 S21008 78166221
         L     R12,AYOOBASE             GET BASE ADDR OF RTN     S21008 78766221
         BALR  R1,R15                   GO REMOVE SYSTEM OWAIT   S21008 79366221
         L     R12,SAVE12               RESTORE BASE ADDRESS    YS02019 79966202
         STM   R6,R7,SAVE6              RESTORE REGISTERS       YS02019 80566202
         SPACE 2                                                        84240020
         SPACE 5                                                        92520020
*                                                                       92610020
* COMMON EXIT FOR RMVWAIT  ROUTINE                                      92700020
*                                                                       92790020
RMVEXIT  DS    0H                                                       92880020
         LM    R14,R15,SAVE14           RESTORE REGISTERS        TS1637 92970002
         BR    R15                      RETURN                          93060020
         SPACE 3                                                        93061002
*                                                               YS02019 93062002
* GO TO TPQ FOR TPOSTING THE TSB TO AYP                         YS02019 93063002
*                                                               YS02019 93064002
*                                                               YS02019 93065002
* INTERFACE TO IEDAYTPQ                                         YS02019 93066002
*                                                               YS02019 93067002
*        R0  - RETURN ADDRESS                                   YS02019 93068002
*        R1  - ZERO, MEANS TPOST TSB TO IEDQYP                  YS02019 93069002
*        R2  - TSB ADDRESS                                      YS02019 93070002
*        R13 - ADDRESS OF 6-WORD SAVE AREA                      YS02019 93071002
*        R15 - ENTRY POINT ADDRESS                              YS02019 93072002
*                                                               YS02019 93073002
TPOSTAYP EQU   *                                                YS02019 93074002
         SR    R1,R1                    INDICATE TPOST TSB TO   YS02019 93075002
*                                       AYP                     YS02019 93076002
         LR    R2,R6                    PASS TSB ADDRESS        YS02019 93077002
         L     R15,TPOSTRTN             GET TPOST RTN'S EPA     YS02019 93078002
         BALR  R0,R15                   GO TO TPOST TSB TO AYP  YS02019 93079002
         BR    R7                       GO BACK TO CALLER       YS02019 93080002
         SPACE 3                                                        93081002
         DS    0F                       FORCE WORD BOUNDARY     YS02019 93082002
MASK1    DC    AL1(0,0,QCBREAD,0)       MASK - INDICATING       YS02019 93083002
*                                       QCBREAD BIT POSITION    YS02019 93084002
MASK2    DC    AL1(255,255,255,255-QCBREAD)  MASK - TURN OFF    YS02019 93085002
*                                       QCBREAD                 YS02019 93086002
MASK3    DC    AL1(0,0,QCBTGET,0)       MASK - INDICATING       YS02019 93087002
*                                       QCBTGET BIT POSITION    YS02019 93088002
MASK4    DC    AL1(255,255,255,255-QCBTGET)  MASK - TURN OFF    YS02019 93089002
*                                       QCBTGET                 YS02019 93090002
MASK5    DC    AL1(0,0,QCBPARTO,0)      MASK - INDICATING       YS02019 93091002
*                                       QCBPARTO BIT POSITION   YS02019 93092002
MASK6    DC    AL1(255,255,255,255-QCBPARTO) MASK - TURN OFF    YS02019 93093002
*                                       QCBPARTO                YS02019 93094002
MASK7    DC    AL1(0,0,QCBNOBUF,0)      MASK - INDICATING       YS02019 93095002
*                                       QCBNOBUF BIT POSITION   YS02019 93096002
MASK8    DC    AL1(255,255,255,255-QCBNOBUF) MASK - TURN OFF    YS02019 93097002
*                                       QCBNOBUF                YS02019 93098002
MASK9    DC    AL1(TSBTPAYI,0,0,0)      MASK - TURN ON TSBTPAYI YS02019 93099002
         EJECT                                                          93150020
*                                                                       93240020
* WORKAREAS,DSECTS                                                      93330020
*                                                                       93420020
HIGHBIT  DS    0F                                                S21008 93420721
         DC    X'80000000'              HIGH ORDER BIT MASK      S21008 93421421
TPOSTRTN DC    V(IEDAYTPQ)              TPOST RTN'S EPA         YS02019 93422102
UOWRR    DC    V(IEDAYQIO)              USER OWAIT REMOVAL RTN  YS02019 93422802
SOWRR    DC    V(IEDAYQSO)              SYS OWAIT REMOVAL RTN   YS02019 93423502
AYOOBASE DC    V(QTIP0110)              IEDAYOO BASE ADDRESS     S21008 93424221
AYQBRAD  DC    V(IEDAYQBR)              BFR RETURN RTN'S EPA    YS02019 93424402
PATCHIT  DC    10F'0'                   PATCH AREA              YS02019 93424602
         SPACE 3                                                        93424802
ATTNSAVE DSECT                                                          93435020
SAVE0    DS    F                        RPT SAVE AREA WORD 0    YS02019 93465002
SAVE1    DS    F                        RPT SAVE AREA WORD 1    YS02019 93485002
SAVE2    DS    F                        RPT SAVE AREA WORD 2    YS02019 93505002
SAVE3    DS    F                        RPT SAVE AREA WORD 3    YS02019 93525002
SAVE4    DS    F                        RPT SAVE AREA WORD 4    YS02019 93545002
SAVE5    DS    F                        RPT SAVE AREA WORD 5    YS02019 93565002
SAVE6    DS    F                        RPT SAVE AREA WORD 6    YS02019 93585002
SAVE7    DS    F                        RPT SAVE AREA WORD 7    YS02019 93605002
SAVE8    DS    F                        RPT SAVE AREA WORD 8    YS02019 93625002
SAVE9    DS    F                        RPT SAVE AREA WORD 9    YS02019 93645002
SAVE10   DS    F                        RPT SAVE AREA WORD 10   YS02019 93665002
SAVE11   DS    F                        RPT SAVE AREA WORD 11   YS02019 93685002
SAVE12   DS    F                        RPT SAVE AREA WORD 12   YS02019 93705002
SAVE13   DS    F                        RPT SAVE AREA WORD 13   YS02019 93725002
SAVE14   DS    F                        RPT SAVE AREA WORD 14   YS02019 93745002
SAVE15   DS    F                        RPT SAVE AREA WORD 15   YS02019 93765002
PARMSW   DS    0XL3                                                     93870020
CLRSW    DC    X'00'                    INPUT PARM TO CLROUTQ           93960020
CLRTRL   EQU   X'80'                    ON=CLEAR TRLR Q                 94050002
CLRTJID  EQU   X'40'                    ON=CLEAR TJID TYPE MSGS         94140002
CLRATTN  EQU   X'20'                    ON=ATTN IS CLEARING Q'S         94230020
CLRHANG  EQU   X'10'                    ON=HANGUP IS CLEARING Q'S       94320020
CLRTCLRQ EQU   X'08'                    ON=TCLEARQ IS CLEARING Q'S      94410020
CLRIGN   EQU   X'04'                    ATTENTION IGNORED               94450002
RMVSW    DC    X'00'                    SWITCH FOR REMOVING WAITS       94520020
RMVULW   EQU   X'80'                    REMOVE USER LWAITS              94590020
RMVSLW   EQU   X'40'                    SYSTEM LWAITS                   94680002
RMVUOWT  EQU   X'20'                    INDICATES REMOVE USER OWAIT     94780002
RMVSOWT  EQU   X'10'                    INDICATES REMOVE SYSTEM OWAIT   94880002
         EJECT                                                          95760020
         IHAASCB                                                YS02019 95860002
         TAVTD                                                          95960020
         IKJTIOCB                                                       96160020
CVT      DSECT                                                          96360020
         CVT                                                            96560020
         TPRIOR                                                         96760020
         TQCBD                                                          96960020
         TSCBD                                                          97210021
         IKJTCB                                                         97360020
         EJECT                                                          97410002
         TTCXD                                                  YS02019 97460002
         EJECT                                                          97510002
         IKJTIOCP                                                       97560020
         IKJTSB                                                         98160020
         TTSID                                                          98560020
         END                                                            98760020
./  ADD  SSI=72930071,NAME=IEDAYGP
         TITLE 'IEDAYGP - TYPE 1 SVC PORTION OF TGET AND TPUT'          00090020
IEDAYGP  CSECT                                                  YS02019 00100002
         GBLC  &LIB                                            @Z944FIX 00120001
&LIB     SETC  'LIB4'                                          @Z944FIX 00150001
*                   VS- 2 RELEASE 3.7 MAINT                             00153003
*                                                                       00156003
*                                                                       00159003
*                                                                       00162003
*  C 314040,314060                                              ZA26776 00162503
*  C 917094                                                     ZA25139 00163003
*  C 763039                                                     ZA24904 00164003
*  D 261100,261200                                              ZA16628 00165003
*  A 266700-267000,268600                                       ZA16628 00167003
*A262000-253000                                                 ZA14775 00169003
*                                                              @ZA12530 00171003
*                                                              @ZA12530 00174003
*304500,304800                                                  ZA12530 00177003
         SPACE 2                                                        00180020
*********************************************************************** 00270020
***** US02278 FIXES APAR OS60002 *****                          SA60002 00270102
***** UY70029 IS THE SAME AS US02278, BUT FOR VS *****          YA00677 00270202
*1150113800,203300,522900,945580                                 S22028 00270402
*1150113800,856600                                               M1800  00272021
*1150306000,333900                                               M1770  00280021
*1150113800,840600,842600,849600,868600-879600,886600-889600,    M0139  00300021
*1150923480-923520                                               M0139  00330021
*                                                                     * 00360020
*                                                                S21A12 00360121
*1150113800,167400-173200,178900,180000-182700,183600-190800,    M0094  00360321
*1150203400-204300,227700,229500,265500,399600,522900,582300,    M0094  00360621
*1150593100,598500,606600-607500,623800,632100,664200-665100,    M0094  00360921
*1150690300,706500,708300,716400,723600,742500-743400,751500-    M0094  00361221
*1150754200,758700,818560-818590,818740-818950,819100-819160,    M0094  00361521
*1150819190,819340-819370,820800,839600,895000,898000,900800,    M0094  00361821
*1150901600,902600,904200                                        M0094  00362121
*1150036000,113800,128700,130500,771300-774900,784800,798300,    S21008 00363021
*1150816300-818100,819000,832500-893700,894600-909320            S21008 00366021
*1150                                                            M0103  00368021
*                                                                M2152  00370020
*                                                                M3280  00380020
*                                                                M0707  00400020
*0000823980,825700                                               M0019  00450020
*0000338400                                                      TS1615 00540020
*0000                                                            TS0018 00630020
*                                                                M0661  00720020
*0000                                                            TS0020 00760020
*                                                                TS1628 00780020
*                                                                M1479  00790020
*                                                                M2688  00800020
*                                                                 M3396 00805020
*                                                                M2793  00807020
*                                                                M4022  00808020
*                                                                 M1966 00809020
*                                                                 M5113 00809220
*                                                                 M4415 00809520
*                                                                 M5442 00809720
*                                                                 M5718 00809820
*                                                                     * 00814802
*                   RELEASE 2, VS-2, DELETIONS                        * 00819802
*                                                                     * 00824802
*D035100-037800,117000,132700,153900,156600,157500,157900       YS02019 00829802
*D160200,183400,765900-906000,923440-924100,924700              YS02019 00834802
*                                                                       00839802
*                                       3/28/73                 VS00129 00841802
*                                       5/30/73                 YM01246 00843802
*                    RELEASE 3  VS/2  CHANGES                  @ZA12528 00843903
*                                                              @ZA12528 00844003
*                                                              @ZA12528 00844103
*  A 507680-508000,509700                                       ZA12528 00844203
*  C 270090                                                     ZA12534 00844303
*0000114100,270080,270084                                      @ZA11573 00844437
*0000114100,244344,244394,244420,314052                        @ZA11104 00844537
*0000114100,284400,305200-305500,313361,313362,313842          @ZA10217 00844637
*0000114100,244344-244454,313281-313284,314001-314023          @ZA07613 00844737
*0000914701,914840                                             @ZA05453 00844837
*C114100                                                        ZA02652 00844937
*A270041,270042                                                 ZA02652 00845437
*A313210-313300                                                 ZA02652 00846237
*C114100                                                        ZA01354 00847037
*A178300,178400,265100-265400                                   ZA01354 00847837
*                                                                       00848837
* STATUS -                                                            * 00849802
*    CHANGE LEVEL 003                                           YS02019 00869802
*                                                                     * 00900020
* FUNCTION -                                                          * 00990020
*                                                                     * 01080020
*    THIS MODULE HAS THREE FUNCTIONS & IS DIVIDED INTO THREE          * 01170020
*    PARTS (ENTRIES 18, 19 AND 20) INTRODUCTORY COMMENTS FOR          * 01260020
*    THE LATTER TWO ENTRIES APPEAR AT THEIR RESPECTIVE                * 01350020
*    BEGINNINGS.                                                      * 01440020
*                                                                     * 01530020
*    THE FUNCTION OF QTIP0180 IS TO PERFORM THE EDIT AND MOVE         * 01620020
*    STEPS OF TGET. THESE STEPS INCLUDE- THE REMOVAL OF ALL           * 01710020
*    CONTROL CHARACTERS BUT HORIZONTAL TAB AND BACKSPACE (IF          * 01800020
*    BACKSPACE IS NOT USED FOR CHARACTER DELETE) FROM EDIT            * 01890020
*    TYPE MESSAGES, THE REMOVAL OF CARRIAGE RETURN OR NEW             * 01980020
*    LINE CONTROL CHARACTERS FROM THE END OF ALL MESSAGES,            * 02070020
*    THE REMOVAL OF UP TO ONE LINE FEED CONTROL CHARACTER             * 02160020
*    IF IT IS AT END OF MESSAGE AFTER CR OR NL HAS BEEN               * 02250020
*    REMOVED, MOVEMENT OF DATA FROM TS BUFFERS TO USER                * 02340020
*    BUFFER, THE PADDING WITH BLANKS ANY UNFILLED PORTION OF          * 02430020
*    THE USERS BUFFER ON EDIT TYPE MESSAGES, RETURNING EMPTY          * 02520020
*    TS BUFFERS TO THE FREE QUEUE AND UPDATE THE FREE AND             * 02610020
*    INPUT QUEUE COUNTS.                                              * 02700020
*                                                                     * 02790020
* ENTRY POINTS                                                        * 02880020
*                                                                     * 02970020
*         QTIP0180 - ENTRY FROM MODULE IGC0009C TO PERFORM            * 03060020
*                    INPUT EDITING AND DATA MOVE FOR TGET.            * 03150020
*                                                                     * 03240020
*         QTIP0190 - ENTRY FROM MODULE IGG09301 OR IGG09302           * 03330020
*                    TO PERFORM MOVE OF DATA FOR TPUT.                * 03420020
*                                                                     * 03870020
*         QTIP0290 - ENTRY FROM ABEND TO CLEAN UP                     * 03890020
*                    ANY TSBECB'S WAITED ON BY THE                    * 03910020
*                    ABENDING TASK.                                   * 03930020
*   NOTE THAT, EXCEPT FOR QTIP0290, EVERY ENTRY IS VIA BRANCH-        * 03990020
*                   L    0,ENTRYCD      ENTRY CODE                    * 04050020
*                   L    15,TSCVTQTP    QTIP ENTRY                    * 04140020
*                   BALR 14,15          GO TO QTIP                    * 04230020
*    BRANCH TABLE WITHIN QTIP (MODULE IKJGGQT0) WILL USE              * 04320020
*    THE ENTRY CODE TO BRANCH TO THE PROPER ENTRY                     * 04410020
*                                                                     * 04500020
* INPUT                                                               * 04590020
*                                                                     * 04680020
*    UPON ENTRY TO QTIP0180 THE FOLLOWING REGISTERS CONTAIN           * 04770020
*    USABLE INFORMATION                                               * 04860020
*                                                                     * 04950020
*         2- POINTER TO TS BUFFER , 5 - POINTER TO SVRB               * 05040020
*         9- POINTER TO TSB, 10- POINTER TO TIOCRPT                   * 05130020
*         12- BASE REGISTER (LOADED IN IKJGGQT0), 14- RETURN ADDR     * 05220020
*                                                                     * 05310020
*    THE EXTENDED SAVE AREA OF THE SVRB CONTAINS THE FOLLOWING        * 05400020
*    INFORMATION AT THE OFFSETS INDICATED                             * 05490020
*                                                                     * 05580020
*         00 - TJID OF TASK (TWO BYTES)                               * 05670020
*         02 - SIZE OF USER BUFFER (TWO BYTES)                        * 05760020
*         04 - FLAG BYTE OF OPTIONS REQUESTED (ONE BYTE)              * 05850020
*         05 - POINTER TO USER BUFFER (THREE BYTES)                   * 05940020
*                                                                     * 06030020
* OUTPUT                                                              * 06120020
*                                                                     * 06210020
*    UPON LEAVING QTIP0180 REGISTERS 3 THRU 11 WILL BE THE            * 06300020
*    SAME AS THEY WERE ON ENTRY.                                      * 06390020
*                                                                     * 06480020
*    REGISTER 0 WILL CONTAIN THE RETURN CODE                          * 06570020
*         00 - SUCCESSFUL                                             * 06660020
*         0C - USER BUFFER TOO SMALL FOR MESSAGE                      * 06750020
*                                                                     * 06840020
*         REGISTER 1 WILL CONTAIN THE COUNT OF DATA MOVED             * 06930020
*                                                                     * 07020020
* EXTERNAL REFERENCES                                                 * 07110020
*                                                                     * 07200020
*         IEDAYQBR - BUFFER RETURN SUBROUTINE IN IEDAYQT              * 07290002
*                                                                     * 07380020
* EXITS,NORMAL                                                        * 07470020
*                                                                     * 07560020
*         EXIT IS MADE BY BRANCHING TO ADDRESS IN RETURN REG          * 07650020
*                                                                     * 07740020
* EXITS,ERROR                                                         * 07830020
*                                                                     * 07920020
*         THERE ARE NO ERROR EXITS FOR THIS ROUTINE                   * 08010020
*                                                                     * 08100020
* TABLES/WORK AREAS                                                   * 08190020
*                                                                     * 08280020
*    THE TABLES USED BY THIS ROUTINE ARE DESCRIBED BY                 * 08370020
*    THE DSECTS AT THE END OF THE LISTING.                            * 08460020
*                                                                     * 08550020
* ATTRIBUTES                                                          * 08640020
*                                                                     * 08730020
*    REENTRANT, REFRESHABLE, PRIVILEGED, HOLDS LOCAL AND CMS LOCKS,   * 08820002
*    RUNS IN USER KEY AND KEY 0                                       * 08850002
* NOTES                                                               * 08880002
*                                                                     * 08910020
* CHARACTER CODE DEPENDENCY                                           * 09000020
*                                                                     * 09090020
*    THE OPERATION OF THIS MODULE DEPENDS UPON THE FOLLOWING          * 09180003
*    PROPERTIES OF THE INTERNAL REPRESENTATION OF THE EXTERNAL        * 09270003
*    CHARACTER SET- NO PRINTABLE CHARACTER HAVING A HEX VALUE         * 09360003
*    LESS THAN 40, HORIZONTAL TAB EQUAL TO X'05', CARRIAGE            * 09450003
*    RETURN EQUAL TO X'0D', NEW LINE EQUAL TO X'15', BACKSPACE        * 09540003
*    EQUAL TO X'16', LINE FEED EQUAL TO X'25',                        * 09630003
*    STX LINE CTL CHAR EQUAL TO X'02', ETB LINE CTL CHAR              * 09680003
*    EQUAL TO X'26',SOH DEVICE CTL CHAR EQUAL TO X'01',               * 09690003
*    SBA DEVICE CTL CHAR EQUAL TO X'11'                               * 09700003
*    BLANK EQUAL TO X'40', ILLEGAL CHARACTER EQUAL TO X'3F'.          * 09810003
*    THE SPECIFIC INSTRUCTIONS WHICH REQUIRE MODIFICATION IF          * 09900003
*    THESE PROPERTIES OF THE CHARACTER SET ARE CHANGED MAY BE         * 09990003
*    IDENTIFIED BY- BLNKCHAR, BKSPCHAR, HTCHAR, NLCHAR, LFCHAR,       * 10080003
*    CRCHAR, ILLCHAR, STXCHAR, ETBCHAR, SOHCHAR,  AND SBACHAR.        * 10170003
*                                                                     * 10260020
* NOTES                                                               * 10350020
*                                                                     * 10440020
*    NONE                                                             * 10530002
*                                                                     * 10620020
*********************************************************************** 10710020
         EJECT                                                          10800020
*********************************************************************** 10890020
*****                                                             ***** 10980020
*****               REGISTER EQUATES                              ***** 11070020
*****                                                             ***** 11160020
*********************************************************************** 11250020
         DC    C'IEDAYGP'               MODULE IDENTIFICATION           11360020
         DC    X'7131'                  DATE - 05/11/77        @ZA16628 11410003
         DS    0H                                                       11420002
         SPACE 2                                                        11430020
         ENTRY QTIP0180                                                 11520020
         ENTRY QTIP0190                                                 11610020
         ENTRY QTIP0290                                                 11740020
         SPACE                                                          11790020
R0       EQU   0                        USED TO SPEED ASSEMBLY          11880020
RCODE    EQU   0                        RETURN CODE                     11970020
RCNT     EQU   1                        COUNT OF DATA MOVED             12060020
RBUF     EQU   2                        POINTER TO TS BUFFER            12150020
RCVT     EQU   3                        POINTER TO CVT                  12240020
RBN      EQU   3                        NEXT BYTE TO BE SCANNED         12330020
RSAVE    EQU   4                        WORK REGISTER                   12420020
RTCB     EQU   4                        POINTER TO TCB                  12510020
RUBN     EQU   5                        USER BFR POSITION WHERE         12600020
*                                       NEXT BYTE GOES                  12690020
RSVRB    EQU   5                        SVRB POINTER                    12780020
RQCB     EQU   6                        QCB POINTER              S21008 12870021
RUBE     EQU   6                        END OF USER BUFFER              12960020
RTBASE   EQU   7                        TEMPORARY BASE REGISTER  S21008 13050021
RLVC     EQU   7                        PTR TO TS BFR CONTAINING        13140020
*                                       A VALID CHAR NOT MOVED          13230020
RASCB    EQU   8                        POINTER TO ASCB         YS02019 13270002
RTSB     EQU   9                        POINTER TO TSB                  13410020
RRPT     EQU   10                       POINTER TO TIOCRPT              13500020
RTSI     EQU   11                       TSINPUT QCB POINTER             13590020
RTCX     EQU   11                       POINTER TO TCAM CVT EXT YS02019 13680002
RASVT    EQU   11                       POINTER TO ASVT         YS02019 13730002
RBE      EQU   11                       POINTER TO END OF TS BFR        13770020
RECBP    EQU   11                       ECB POINTER FOR POST            13860020
RBASE    EQU   12                       BASE REG                        14040020
RAVT     EQU   13                       AVT POINTER                     14130020
RTJID    EQU   13                       TJID                            14220020
RXSA     EQU   13                       TEMP SVRB POINTER               14310020
RETURN   EQU   14                       RETURN ADDRESS                  14400020
RGOTO    EQU   15                       BRANCH ADDRESS                  14490020
RWRK     EQU   15                       WORK REGISTER                   14580020
         EJECT                                                          14670020
*********************************************************************** 14760020
*****                                                             ***** 14850020
*****               CONSTANT EQUATES                              ***** 14940020
*****                                                             ***** 15030020
*********************************************************************** 15120020
K0       EQU   0                        OFFSET                          15210020
K1       EQU   1                        OFFSET & INCREMENT & SZ         15300020
K2       EQU   2                        OFFSET AND SIZE         YS02019 15350002
K3       EQU   3                        OFFSET AND SIZE                 15480020
K4       EQU   4                        OFFSET AND SIZE                 15570020
SAVER14  EQU   12                       OFFSET TO THE 4TH WORD  YS02019 15620002
*                                       IN TIOCSAVE             YS02019 15670002
K16      EQU   16                       OFFSET                          15840020
K24      EQU   24                       SHIFT CONSTANT                  15930020
TPQSAVE  EQU   44                       OFFSET TO LAST 6 WORDS  YS02019 15980002
*                                       IN TIOCSAVE FOR AYTPQ   YS02019 15990002
*                                       TO USE                  YS02019 16000002
         SPACE 3                                                        16110020
***                                                                     16200020
***                 OTHER EQUATES                                       16290020
***                                                                     16380020
RC0C     EQU   X'0C'                    USER BFR TOO SMALL CODE         16470020
KZIP     EQU   X'00'                    ZERO LENGTH                     16560020
KONE     EQU   X'01'                    LENGTH OF ONE                   16650020
OFF      EQU   X'FF'                    TO TURN OFF SELECTED BIT        17370020
HTCHAR   EQU   X'05'                    HORIZONTA TAB                   17460020
CRCHAR   EQU   X'0D'                    CHARRIAGE RETURN                17550020
NLCHAR   EQU   X'15'                    NEW LINE                        17640020
BKSPCHAR EQU   X'16'                    BACKSPACE                       17730020
LFCHAR   EQU   X'25'                    LINE FEED                       17820020
STXCHAR  EQU   X'02'                    STX CONTROL CHAR        ZA01354 17830003
ETBCHAR  EQU   X'26'                    ETB CONTROL CHAR        ZA01354 17840003
ILLCHAR  EQU   X'3F'                    TCAM SUBSTITUTES THIS FOR ILLE -17850020
                                        GAL CHARACTERS                  17880020
BLNKCHAR EQU   X'40'                    BLANK                           17910020
SOHCHAR  EQU   X'01'                    SOH CHARACTER            S22028 17960002
SBACHAR  EQU   X'11'                    SBA CHARACTER            S22028 17970002
PLUSCHAR EQU   C'+'                     TO SHOW NONAUTH USER    YS02019 18010002
WAITBIT  EQU   X'80'                    ECB IS WAITED ON        YM03998 18060002
***                                                                     18280020
***                 MASKS FOR BCR INSTRUCTIONS                          18290020
***                                                                     18300020
ONES     EQU   1                        AFTER TEST UNDER MASK           18310020
NOTONES  EQU   14                       AFTER TEST UNDER MASK           18320020
EQUAL    EQU   8                        AFTER COMPARE INSTRUCTIONS      18330020
         EJECT                                                          19170020
QTIP0180 EQU   *                                                        19260020
         SPACE 4                                                        19350020
*********************************************************************** 19440020
*********************************************************************** 19530020
*****                                                             ***** 19620020
*****          QTIP ENTRY FOR EDITING AND MOVEMENT OF DATA        ***** 19710020
*****          FROM TS BUFFER(S) TO USER BUFFER.                  ***** 19800020
*****                                                             ***** 19890020
*********************************************************************** 19980020
*********************************************************************** 20070020
         SPACE 2                                                        20160020
         USING *,RBASE                                                  20250020
         USING RBSECT,RSVRB                                      M0094  20290021
         DROP  RSVRB                                             M0094  20370021
         LR    RXSA,RSVRB               SAVE RB POINTER          M0094  20410021
         USING RBSECT,RXSA                                       M0094  20450021
         SR    RCODE,RCODE              CLEAR                           20610020
         SR    RCNT,RCNT                CLEAR                           20700020
         SR    RLVC,RLVC                CLEAR                           20790020
         USING TIOCBUF,RBUF                                             20880020
         USING TSB,RTSB                                                 20970020
         USING TIOCRPT,RRPT                                             21060020
         SPACE 2                                                        21150020
***                                                             YS02019 21200002
***                  SAVE SVC CALLER'S KEY                      YS02019 21210002
***                                                             YS02019 21220002
         L     RTCB,RBLINK              NEXT RB ADDRESS         YS02019 21236002
         IC    RTCB,RBOPSW+K1-RBBASIC(,RTCB)  KEY FROM RB OPSW  YS02019 21238002
         MODESET EXTKEY=SUPR            CHANGE TO KEY 0         YS02019 21238102
         STC   RTCB,XSAUSERK            SAVE CALLER'S KEY       YS02019 21238402
         MODESET EXTKEY=TCAM            GET BACK TO TCAM'S KEY  YS02019 21238802
         SPACE 2                                                YS02019 21239202
***                                                                     21240002
***                 PLACE NEXT MESSAGE ONTO THE TRAILER                 21330020
***                 QUEUE TO PROCESS                                    21420020
***                                                                     21510020
         CLC   TSBITBFP(K3),KZERO       ANY TRAILER QUEUE MSG           21600020
         BNE   QTIE0200                 IF PARTIAL MSG                  21690020
         MVC   TSBIBFP(K3),BUFFHEAD     LINK NEXT MSG TO QUEUE          21780020
         LA    RBUF,K0(R0,RBUF)         CLEAR FIRST BYTE                21870020
         IC    RWRK,TSBITBFP-K1         GET FLAG BYTE                   21960020
         SLL   RWRK,K24                 LEFT ADJUST FLAG                22050020
         OR    RWRK,RBUF                ADD FLAG TO PTR                 22140020
         ST    RWRK,TSBITBFP-K1         UPDATE QUEUE                    22230020
         SPACE 2                                                        22320020
QTIE0200 EQU   *                                                        22410020
***                                                                     22500020
***                 SET UP USER BUFFER POINTERS                         22590020
***                                                                     22680020
         L     RUBN,XSAPRM1             GET ADDR OF USER BUFFER  M0094  22770021
         LA    RUBN,K0(R0,RUBN)         DROP FLAG BYTE                  22860020
         LH    RUBE,XSAPRMSZ            GET SIZE OF USER BUFFER  M0094  22950021
         AR    RUBE,RUBN                END OF USER BUFFER              23040020
         CLI   BUFFLNTH,K0              NULL LINE                       23130020
         BNE   QTIE0300                 IF NOT NULL LINE        YS02019 23220002
         MODESET KEYADDR=XSAUSERK,WORKREG=4 GET INTO CALLER KEY YS02019 23270002
         B     QTIE7000                 GO TO PAD USER'S BFR    YS02019 23280002
         SPACE 2                                                        23310020
QTIE0300 EQU   *                                                        23400020
***                                                                     23490020
***                 SET UP TS BUFFER DATA POINTERS                      23580020
***                                                                     23670020
         LR    RBN,RBUF                 START OF TS BFR                 23760020
         SR    RWRK,RWRK                                                23850020
         IC    RWRK,BUFFOFST            DATA OFFSET                     23940020
         AR    RBN,RWRK                 POINTER TO START OF DATA        24030020
         SR    RBE,RBE                                                  24120020
         IC    RBE,BUFFLNTH             DATA LENGTH                     24210020
         TM    BUFFFL1,BUFFHDR          IS THIS A HDR BFR        S22028 24260002
         BZ    QTIE0350                 BR IF NO                 S22028 24270002
         TM    BUFFFL2,BUFF3270         DOES THIS BFR HAVE 3270  S22028 24280002
*                                       CONTROL CHARACTERS       S22028 24290002
         BZ    QTIE0350                 BR IF NO                 S22028 24292002
         TM    XSAOPTNS,MASIS           ASIS OPTION SPECIFIED    S22028 24294002
         BO    QTIE0350                 BR IF YES                S22028 24296002
         CLI   BUFFLNTH,K3              IS DATA LENGTH LESS THAN S22028 24298002
*                                       3                        S22028 24298402
         BNL   QTIE0320                 NO, BRANCH AROUND        S22028 24298802
         LA    RBN,K1(R0,RBN)           STRIP FIRST CHAR FOR     S22028 24299202
*                                       EDIT                     S22028 24299602
         BCTR  RBE,R0                   MINUS 1 FROM DATA LNG    S22028 24299702
         B     QTIE0330                 GOTO UPDATE TS BFR       S22028 24299802
         SPACE 1                                                        24299902
QTIE0320 EQU   *                                                 S22028 24329902
         LA    RBN,K3(R0,RBN)           STRIP 3 BYTES FOR EDIT   S22028 24339902
         SH    RBE,KTHREE               SUBTRACT 3 FROM DATA LGN S22028 24349902
         CLI   K0(RBN),SBACHAR          CHECK FOR SBA CHAR       S22028 24359902
         BNE   QTIE0330                 BRANCH IF NOT            S22028 24369902
         LA    RBN,K3(R0,RBN)           STRIP 3 BYTES FOR EDIT   S22028 24379902
         SH    RBE,KTHREE               SUBTRACT 3 FROM DATA LGN S22028 24383202
         SPACE 1                                                 S22028 24385202
QTIE0330 EQU   *                                                 S22028 24385602
         STC   RBE,BUFFLNTH             UPDATE LNG IN TS BFR     S22028 24386002
         LR    RWRK,RBUF                GET TS BFR ADDR          S22028 24386402
         SR    RWRK,RBN                 OFFSET IN NEGATIVE       S22028 24386502
         LPR   RWRK,RWRK                GET POSITIVE VALUE       S22028 24386602
         STC   RWRK,BUFFOFST            UPDATE OFFSET IN TS BFR  S22028 24409902
         NI    BUFFFL2,OFF-BUFF3270     INDICATE CONTROL CHARS   S22028 24419902
*                                       ALREADY STRIPPED         S22028 24429902
         SPACE 1                                                        24431902
QTIE0350 EQU   *                                                 S22028 24432302
         AR    RBE,RBN                  POINTER TO END OF DATA          24433402
         CLC   TSBSBASV(K1),KZERO CONTROL CHAR TO SKIP?        @ZA11104 24434401
         BNH   QTIE0400                 NO GO CHECK DATA       @ZA07613 24435437
         SR    RWRK,RWRK                ZERO WORK REG.         @ZA07613 24436437
         IC    RWRK,BUFFOFST            GET OFFSET             @ZA07613 24437437
         SR    RSAVE,RSAVE              ZERO WORK REG.         @ZA07613 24438437
         IC    RSAVE,TSBSBASV           GET # OF CHARS TO SKIP @ZA11104 24439437
         AR    RWRK,RSAVE               ADD # OF CHARS TO OFFST@ZA07613 24440037
         STC   RWRK,BUFFOFST            STORE NEW OFFSET       @ZA07613 24440637
         SR    RWRK,RWRK                ZERO WORK REG          @ZA07613 24441237
         STC   RWRK,TSBSBASV            ZERO WORK AREA         @ZA11104 24441837
         IC    RWRK,BUFFLNTH            GET LENGTH             @ZA07613 24442437
         SR    RWRK,RSAVE               SUB. # OF CHARS FROM LN@ZA07613 24443437
         STC   RWRK,BUFFLNTH            STORE NEW LENGTH       @ZA07613 24444437
         AR    RBN,RSAVE                ADD # TO CHAR. POINTER @ZA07613 24445437
         SPACE 2                                                        24456702
QTIE0400 EQU   *                                                        24480020
***                                                                     24570020
***                 CHECK IF ALL DATA SCANNED                           24660020
***                                                                     24750020
         CR    RBN,RBE                  LAST CHAR ALREADY DONE          24840020
         BL    QTIE0500                 IF NOT                          24930020
         CLC   BUFFTRLR(K3),KZERO       IS THIS THE LAST TS             25020020
*                                       BFR OF THE MESSAGE              25110020
         BE    QTIE6000                 IF SO GO TO END OF DATA         25200020
*                                       ROUTINE                         25290020
         L     RBUF,BUFFTRLR-K1         IF NOT LAST PREPARE             25380020
*                                       TO CHECK NEXT BUFFER            25470020
         LA    RBUF,K0(R0,RBUF)         CLEAR FIRST BYTE                25560020
         B     QTIE0300                 START CHECK OF NEXT BFR         25650020
         SPACE 2                                                        25740020
QTIE0500 EQU   *                                                        25830020
***                                                                     25920020
***                 CHECK NEXT CHARACTER IN TS BUFFER                   26010020
***                                                                     26100020
         CLI   TSBCHDCC,K0              0 MEANS NO DELETE CHAR  OS58447 26150002
         BE    QTIE0520                 NO CHAR, DON'T COMPARE  OS58447 26170002
         CLC   K0(K1,RBN),TSBCHDCC      IS IT CHAR DELETE CHAR          26190020
         BE    QTIE1000                 IF SO HANDLE CHAR DELETE        26280020
         SPACE 1                                                        26282002
QTIE0520 EQU   *                                                OS58447 26290002
         CLI   K0(RBN),ILLCHAR          HEX '3F' IS ILLEGAL FOR ALL     26310020
         BE    QTIE0550                 IF ILLEGAL, DON'T MOVE          26340020
         CLI   K0(RBN),BLNKCHAR         IS CHARACTER VALID              26370020
         BNL   QTIE0600                 IF VALID TRY TO MOVE            26460020
*                                                                       26470003
*                  DON'T MOVE LINE CONTROL CHARACTERS.                  26480003
*                                                                       26490003
         CLI   K0(RBN),STXCHAR          STX CHAR?               ZA01354 26510003
         BE    QTIE0550                 YES, DON'T MOVE         ZA01354 26520003
         CLI   K0(RBN),ETBCHAR          ETB CHAR?               ZA01354 26530003
         BE    QTIE0550                 YES, DON'T MOVE         ZA01354 26540003
         TM    XSAOPTNS,MASIS           ASIS OPTION SPECIFIED    M0094  26550021
         BO    QTIE0600                 IF ASIS TRY TO MOVE             26640020
         TM    TSBSTAT,TSB3270          TEST FOR 3270           ZA16628 26670003
         BO    QTIE0540                 SKIP BACKSPACE TEST     ZA16628 26700003
         CLI   K0(RBN),BKSPCHAR         BACKSPACE CHAR                  26730020
         BE    QTIE0600                 IF SO TRY TO MOVE               26820020
QTIE0540 EQU   *                                                ZA16628 26860003
         CLI   K0(RBN),HTCHAR           HORIZONTAL TAB CHAR             26910020
         BE    QTIE0600                 IF SO TRY TO MOVE               27000020
         TM    TSBSTAT,TSB3270          TEST FOR 3270 TERMINAL   S22028 27002002
         BZ    QTIE0550                 BR IF NO                 S22028 27004002
         CLI   K0(RBN),SBACHAR          SBA CHARACTER ?         ZA02652 27004637
         BE    QTIE0960                 YES SKIP THREE CHAR     ZA02652 27005237
         CLI   K0(RBN),SOHCHAR          SOH CHAR                 S22028 27006002
         BNE   QTIE0550                 BR IF NO                 S22028 27008002
         MODESET EXTKEY=SUPR            CHANGE TO KEY ZERO     @ZA11573 27008437
         OI    XSAFLAG2,XSAATR          INDICATE NEXT CHAR IS A  S22028 27008637
*                                       3270 ATTRIBUTE BYTE             27008837
         B     QTIE0600                 TRY TO MOVE              S22028 27009202
         SPACE 1                                                        27010020
QTIE0550 EQU   *                                                        27020020
***                                                                     27030020
***                 CHARACTER SHOULD NOT BE MOVED                       27040020
***                                                                     27050020
         LTR   RLVC,RLVC                ANY UNMOVED DATA                27090020
         BZ    QTIE0900                 IF NOT                          27180020
         B     QTIE0950                 IF UNMOVED               M1770  27270021
         SPACE 2                                                        27360020
QTIE0600 EQU   *                                                        27450020
***                                                                     27540020
***                 MOVE CHARACTER TO USER BUFFER                       27630020
***                                                                     27720020
         CR    RUBE,RUBN                ANY ROOM LEFT IN BFR            27810020
         BNH   QTIE0700                 IF NOT                          27900020
         SPACE 2                                                YS02019 27990002
***                                                             YS02019 27996002
***                 ASSUME USER KEY FOR STORE                   YS02019 28002002
***                                                             YS02019 28008002
         IC    RWRK,K0(,RBN)            GET NEXT CHAR           YS02019 28014002
         MODESET KEYADDR=XSAUSERK,WORKREG=4                     YS02019 28032002
         STC   RWRK,K0(,RUBN)           STORE NEXT CHAR         YS02019 28038002
         MODESET EXTKEY=TCAM                                    YS02019 28044002
         SPACE 2                                                YS02019 28056002
***                                                             YS02019 28062002
***                 UPDATE COUNTS                               YS02019 28068002
***                                                             YS02019 28074002
         LA    RUBN,K1(R0,RUBN)         POINT TO NEXT USER              28080020
*                                       BUFFER SPACE                    28170020
         LA    RCNT,K1(R0,RCNT)         ADD ONE TO COUNT OF DATA        28260020
*                                       MOVED TO USER BUFFER            28350020
         B     QTIE0925                 GO UPDATE TS BFR       @ZA10217 28440037
         SPACE 2                                                        28530020
QTIE0700 EQU   *                                                        28620020
***                                                                     28710020
***                 NO ROOM LEFT IN USER BUFFER                         28800020
***                                                                     28890020
         LTR   RLVC,RLVC                WAS THERE A PRIOR VALID         28980020
*                                       CHAR THAT DIDN'T MOVE           29070020
         BNZ   QTIE0800                 IF THERE WAS                    29160020
         LR    RLVC,RBUF                SAVE TS BFR PTR                 29250020
         SPACE 2                                                        29340020
QTIE0800 EQU   *                                                        29430020
         LA    RBN,K1(R0,RBN)           POINT TO NEXT CHARACTER         29520020
*                                       IN TS BUFFER                    29610020
         LA    RUBN,K1(R0,RUBN)         POINT TO WHERE NEXT CHAR        29700020
*                                       WOULD GO IF IT COULD            29790020
         B     QTIE0400                 CHECK NEXT CHARACTER            29880020
         SPACE 2                                                        29970020
QTIE0900 EQU   *                                                        30060020
***                                                                     30150020
***                 UPDATE TS BUFFER PRIOR TO CHECKING                  30240020
***                 THE NEXT CHARACTER OF THE MESSAGE                   30330020
***                                                                     30420020
         TM    TSBSTAT,TSB3270          IS THIS 3270?           ZA12530 30450003
         BZ    QTIE0925                 NO GO UPDATE OFST-LNTH  ZA12530 30480003
         SPACE                                                          30510020
         CR    RUBE,RUBN                ANY ROOM IN USER BFR?  @ZA10217 30540037
         BNH   QTIE0950                 IF NOT                 @ZA10217 30570037
         SPACE 1                                                        30600037
QTIE0925 EQU   *                                               @ZA10217 30630037
         SR    RWRK,RWRK                                                30690020
         IC    RWRK,BUFFOFST            DATA OFFSET                     30780020
         LA    RWRK,K1(R0,RWRK)         INCREMENT BY ONE                30870020
         STC   RWRK,BUFFOFST            UPDATE OFFSET                   30960020
         IC    RWRK,BUFFLNTH            DATA LENGTH                     31050020
         BCTR  RWRK,R0                  DECREMENT                       31140020
         STC   RWRK,BUFFLNTH            UPDATE LENGTH                   31230020
QTIE0950 EQU   *                                                 M1770  31240021
         LA    RBN,K1(R0,RBN)           POINT TO NEXT CHAR       M1770  31280021
         B     QTIE0400                 CHECK NEXT CHARACTER            31320020
QTIE0960 EQU   *                                                ZA02652 31328037
         LR    RWRK,RBE                 LOAD END OF BUFFER PTR @ZA07613 31329037
         SH    RWRK,KTHREE              SUBTRACT THREE         @ZA07613 31330037
         CR    RBN,RWRK                 WITHIN 3 OF END OF BUF.@ZA07613 31331037
         BH    QTIE0975                 YES GO CALCULATE       @ZA07613 31332037
         SR    RWRK,RWRK                ZERO WORK REG           ZA02652 31336037
         CR    RUBE,RUBN                ANY ROOM IN USER BFR?  @ZA10217 31338037
         BNH   QTIE0965                 IF NOT                 @ZA10217 31340037
         IC    RWRK,BUFFOFST            GET DATA OFFSET         ZA02652 31344037
         LA    RWRK,K3(R0,RWRK)         INCREMENT BY THREE      ZA02652 31352037
         STC   RWRK,BUFFOFST            UPDATE OFFSET           ZA02652 31360037
         IC    RWRK,BUFFLNTH            GET DATA LENGTH         ZA02652 31368037
         SH    RWRK,KTHREE              DECREMENT BY THREE      ZA02652 31376037
         STC   RWRK,BUFFLNTH            UPDATE LENGTH           ZA02652 31384037
         SPACE 1                                                        31386037
QTIE0965 EQU   *                                               @ZA10217 31388037
         LA    RBN,K3(R0,RBN)           SKIP THREE CHARS        ZA02652 31392037
         B     QTIE0400                 CHECK NEXT CHAR         ZA02652 31400037
         SPACE 2                                               @ZA07613 31400437
***              CALCULATE FOR NUMBER OF CONTROL               @ZA07613 31400837
***              CHARACTERS FOLLOWING SBA WITHIN               @ZA07613 31401237
***              THIS BUFFER AND FOLLOWING BUFFER.             @ZA07613 31401637
         SPACE 2                                               @ZA07613 31402037
QTIE0975 EQU   *                                               @ZA07613 31402437
         LR    RWRK,RBN                 LOAD CHAR POINTER      @ZA07613 31402837
         SR    RWRK,RBE                 HOW MANY CHARACTERS ?  @ZA07613 31403237
         LPR   RWRK,RWRK                CONVERT TO POS. NUMBER @ZA07613 31403637
         STH   RWRK,BUFFWORK            STORE IN WORK AREA      ZA26776 31404003
         SH    RWRK,KTHREE              GET 3'S COMPLEMENT     @ZA07613 31404437
         LPR   RWRK,RWRK                CONVERT TO POS NUMBER  @ZA07613 31404837
         STC   RWRK,TSBSBASV            PUT # TO SKIP IN NXT BF@ZA11104 31405237
         SR    RWRK,RWRK                ZERO WORK REG.         @ZA07613 31405637
         LH    RWRK,BUFFWORK            GET # TO SKIP IN THIS 1 ZA26776 31406003
         AR    RBN,RWRK                 INCREMENT CHAR PTR     @ZA07613 31406437
         IC    RWRK,BUFFOFST            GET BUFFER OFFSET      @ZA07613 31406837
         AH    RWRK,BUFFWORK            ADD # OF CHARS TO OFFST@ZA07613 31407237
         STC   RWRK,BUFFOFST            STORE NEW OFFSET       @ZA07613 31407637
         IC    RWRK,BUFFLNTH            GET LENGTH             @ZA07613 31408037
         SH    RWRK,BUFFWORK            SUB # OF CHARS FROM LN @ZA07613 31408437
         STC   RWRK,BUFFLNTH            STORE NEW LENGTH       @ZA07613 31408837
         B     QTIE0400                 CHECK NEXT CHARACTER   @ZA07613 31409237
         SPACE 2                                                        31410020
QTIE1000 EQU   *                                                        31500020
*********************************************************************** 31590020
*****                                                             ***** 31680020
*****               CHARACTER DELETE ROUTINE                      ***** 31770020
*****                                                             ***** 31860020
*********************************************************************** 31950020
         SPACE                                                          32040020
         LTR   RCNT,RCNT                ANY DATA MOVED YET              32130020
         BZ    QTIE0550                 IF NOTHING TO DELETE            32220020
         BCTR  RUBN,R0                  MOVE BACK USER BFR PTR          32310020
         LTR   RLVC,RLVC                ANY UNMOVED DATA                32400020
         BNZ   QTIE1100                 IF UNMOVED DATA                 32490020
         BCTR  RCNT,R0                  DECREMENT DATA COUNT            32580020
         SPACE 2                                                        32670020
         B     QTIE0900                 PREPARE FOR NEXT CHAR           32760020
         SPACE 2                                                        32850020
QTIE1100 EQU   *                                                        32940020
         CR    RUBN,RUBE                HAVE ENOUGH CHARACTERS          33030020
*                                       BEEN DELETED TO ACCOUNT         33120020
*                                       FOR ALL VALID CHAR'S            33210020
*                                       THAT WERE NOT MOVED             33300020
         BNE   QTIE0950                 IF NOT                   M1770  33390021
         SPACE 2                                                        33480020
***                                                                     33570020
***                 REMOVE ALL VALID NON-MOVED CHARACTERS               33660020
***                 FROM TS BUFFERS                                     33750020
***                                                                     33840020
         CR    RLVC,RBUF                ARE ALL UNMOVED CHARS IN        33930020
*                                       TS BFR BEING SCANNED            34020020
         BE    QTIE1500                 IF SO                           34110020
         LR    RSAVE,RBUF               SAVE PRESENT BFR POINTER        34200020
         LR    RBUF,RLVC                                                34290020
         SPACE 2                                                        34380020
QTIE1300 EQU   *                                                        34470020
         MVI   BUFFLNTH,KZIP            ZERO LENGTH                     34560020
         L     RBUF,BUFFTRLR-K1         NEXT TS BFR PTR                 34650020
         LA    RBUF,K0(R0,RBUF)         CLEAR FIRST BYTE                34740020
         CR    RBUF,RSAVE               ALL BUT PRESENT ZEROED          34830020
         BNE   QTIE1300                 IF NOT ZERO NEXT ONE            34920020
         SPACE 2                                                        35010020
QTIE1500 EQU   *                                                        35100020
***                                                                     35190020
***                 UPDATE PRESENT BFR TO DROP DELETED CHARS            35280020
***                                                                     35370020
         LA    RBN,K1(R0,RBN)           POINT TO NEXT CHAR              35460020
         SR    RLVC,RLVC                CLEAR LAST VALID                35550020
*                                       CHARACTER BFR POINTER           35640020
         LR    RWRK,RBN                 CALCULATE THE CORRECT           35730020
         SR    RWRK,RBUF                OFFSET FOR PRESENT BFR          35820020
         STC   RWRK,BUFFOFST            AND UPDATE IT                   35910020
         LR    RWRK,RBE                 CALCULATE THE CORRECT           36000020
         SR    RWRK,RBN                 LENGTH FOR PRESENT BFR          36090020
         STC   RWRK,BUFFLNTH            AND UPDATE IT            TS1615 36180020
         B     QTIE0400                 CHECK NEXT CHAR                 36270020
         SPACE 3                                                        36360020
QTIE6000 EQU   *                                                        36450020
*********************************************************************** 36540020
*****                                                             ***** 36630020
*****               END OF MESSAGE PROCESSING                     ***** 36720020
*****                                                             ***** 36810020
*********************************************************************** 36900020
         SPACE                                                          36990020
         MODESET KEYADDR=XSAUSERK,WORKREG=4  GET CALLER'S KEY   YS02019 37060002
         LTR   RLVC,RLVC                ANY UNMOVED DATA                37080020
         BNZ   QTIE8000                 IF ANY                          37170020
         LTR   RCNT,RCNT                ANY DATA MOVED                  37260020
         BZ    QTIE7000                 IF NOT GO TO PAD                37350020
         BCTR  RUBN,R0                  LOOK AT LAST CHAR               37440020
         CLI   K0(RUBN),CRCHAR          CARRIAGE RETURN CHAR            37530020
         BE    QTIE6100                 IF SO                           37620020
         CLI   K0(RUBN),NLCHAR          NEW LINE CHAR                   37710020
         BNE   QTIE6200                 IF NEITHER                      37800020
         SPACE 2                                                        37890020
QTIE6100 EQU   *                                                        37980020
         BCTR  RCNT,R0                  DECREMENT DATA COUNT            38070020
         BCTR  RUBN,R0                  LOOK AT PRECEEDING CHAR         38160020
         LTR   RCNT,RCNT                ANY DATA LEFT                   38250020
         BZ    QTIE6500                 IF NOT                          38340020
         SPACE 2                                                        38430020
QTIE6200 EQU   *                                                        38520020
***                                                                     38610020
***                 CHECK FOR LINE FEED                                 38700020
***                                                                     38790020
         CLI   K0(RUBN),LFCHAR          IS THIS A LINE FEED             38880020
         BNE   QTIE6500                 IF NOT                          38970020
         BCTR  RCNT,R0                  DECREMENT COUNT                 39060020
         B     QTIE7000                 GO TO PAD                       39150020
         SPACE 2                                                        39240020
QTIE6500 EQU   *                                                        39330020
         LA    RUBN,K1(R0,RUBN)         RE-ADJUST USER DATA PTR         39420020
         SPACE 2                                                        39510020
QTIE7000 EQU   *                                                        39600020
***                                                                     39690020
***                 PAD USER BUFFER WITH BLANKS                         39780020
***                                                                     39870020
         TM    XSAOPTNS,MASIS           ASIS OPTION SPECIFIED    M0094  39960021
         BO    QTIE7250                 IF SO DON'T PAD         YS02019 40050002
         LR    RWRK,RUBE                END OF USER BFR                 40140020
         SR    RWRK,RUBN                AMOUNT OF BLANKS NEEDED         40230020
         LTR   RWRK,RWRK                ANY BLANKS NEEDED               40320020
         BZ    QTIE7250                 IF NONE GO TO END RTN   YS02019 40410002
         MVI   K0(RUBN),BLNKCHAR        BLANK FIRST BYTE                40500020
         BCTR  RWRK,R0                  DECREMENT NO. OF BLANKS         40590020
         LTR   RWRK,RWRK                ANY MORE TO BLANK               40680020
         BZ    QTIE7250                 NO GET TCAMS KEY        YS02019 40770002
         SPACE 2                                                        40860020
QTIE7200 EQU   *                                                        40950020
         CH    RWRK,KMAX                MORE THAN 255 MORE BLNKS        41040020
         BH    QTIE7300                 IF TOO MANY FOR ONE MOVE        41130020
         BCTR  RWRK,R0                  DECREMENT FOR EXECUTE           41220020
         EX    RWRK,QTIEPAD             PAD REMAINDER OF BFR            41310020
         SPACE 2                                                        41312002
QTIE7250 EQU   *                                                YS02019 41320002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 41360002
         B     QTIE9500                 GO TO END ROUTINE               41400020
         SPACE 2                                                        41490020
QTIE7300 EQU   *                                                        41580020
***                                                                     41670020
***                 PAD NEXT 255 BYTES                                  41760020
***                                                                     41850020
         LH    RSAVE,KMAX               NO. TO BE MOVED                 41940020
         BCTR  RSAVE,R0                 DECREMENT FOR EXECUTE           42030020
         EX    RSAVE,QTIEPAD            PAD NEXT 255 BYTES              42120020
         AH    RUBN,KMAX                ADJUST POINTER                  42210020
         SH    RWRK,KMAX                ADJUST BLANK COUNT              42300020
         B     QTIE7200                 RECHECK NO. LEFT                42390020
         SPACE 3                                                        42480020
QTIE8000 EQU   *                                                        42570020
***                                                                     42660020
***                 CHECK FOR  CR, NL AND LF NOT MOVED                  42750020
***                                                                     42840020
         MODESET EXTKEY=TCAM            GET INTO TCAM'S KEY     YS02019 42890002
         BCTR  RBN,R0                   LOOK AT LAST CHAR OF MSG        42930020
         CLI   K0(RBN),CRCHAR           LAST CHAR CARRIAGE RET          43020020
         BE    QTIE8200                 IF SO DROP IT                   43110020
         CLI   K0(RBN),NLCHAR           LAST CHAR NEW LINE              43200020
         BE    QTIE8200                 IF SO DROP IT                   43290020
         CLI   K0(RBN),LFCHAR           LAST CHAR                       43380020
         BE    QTIE8500                 IF SO MAY DROP IT               43470020
         SPACE 2                                                        43560020
QTIE8100 EQU   *                                                        43650020
***                                                                     43740020
***                 MESSAGE TOO LONG RETURN                             43830020
***                                                                     43920020
         LA    RCODE,RC0C               RETURN CODE                     44010020
         B     QTIE9500                 GO TO END ROUTINE               44100020
         SPACE 2                                                        44190020
QTIE8200 EQU   *                                                        44280020
         IC    RWRK,BUFFLNTH            GET DATA LENGTH                 44370020
         BCTR  RWRK,R0                  DECREMENT ONE                   44460020
         STC   RWRK,BUFFLNTH            UPDATE LENGTH                   44550020
         BCTR  RUBN,R0                  UPDATE USER BFR PTR             44640020
         CLI   BUFFLNTH,K0              LENGTH OF TS BFR NOW 0          44730020
         BNZ   QTIE8400                 IF NOT ZERO                     44820020
         CR    RLVC,RBUF                IS ALL OF MSG MOVED             44910020
         BNE   QTIE8300                 IF NOT                          45000020
         BCTR  RUBN,R0                  DECREMENT USER BFR PTR          45090020
         MODESET KEYADDR=XSAUSERK,WORKREG=4  GET CALLER'S KEY   YS02019 45160002
         B     QTIE6200                 CHECK IF LAST CHAR              45180020
*                                       MOVED WAS LINE FEED             45270020
         SPACE 2                                                        45360020
QTIE8300 EQU   *                                                        45450020
***                                                                     45540020
***                 CHECK PREVIOUSLY SCANNED TS BUFFER                  45630020
***                 TO SEE IF ONLY THING LEFT IS ONE LF                 45720020
***                                                                     45810020
         LR    RSAVE,RBUF               SAVE PTR TO LAST TS BFR         45900020
         LR    RBUF,RLVC                PTR TO BFR W/UNMOVED            45990020
*                                       VALID CHARACTER                 46080020
         CLI   BUFFLNTH,KONE            LENGTH ONE                      46170020
         BNE   QTIE8100                 MSG TOO LONG                    46260020
         L     RWRK,BUFFTRLR-K1         TRAILER POINTER                 46350020
         LA    RWRK,K0(R0,RWRK)         CLEAR FIRST BYTE                46440020
         CR    RWRK,RSAVE               ANY TS BUFFERS BETWEEN          46530020
*                                       THIS ONE AND LAST ONE           46620020
         BNE   QTIE9500                 IF MORE QUIT                    46710020
         IC    RBN,BUFFOFST             OFFSET TO CHAR                  46800020
         AR    RBN,RBUF                 POINTER TO CHAR                 46890020
         B     QTIE9000                 CHECK IF LINE FEED              46980020
         SPACE 2                                                        47070020
QTIE8400 EQU   *                                                        47160020
***                                                                     47250020
***                 PREPARE TO CHECK PREVIOUS CHAR IN TS BFR            47340020
***                                                                     47430020
         BCTR  RBN,R0                   POINTER TO CHAR                 47520020
         SPACE 2                                                        47610020
QTIE8500 EQU   *                                                        47700020
***                                                                     47790020
***                 CHECK FOR LAST CHAR IN TS BUFFERS BEING LF          47880020
***                                                                     47970020
         CR    RLVC,RBUF                IS THIS LAST BFR                48060020
         BNE   QTIE8100                 IF NOT                          48150020
         CLI   BUFFLNTH,KONE            LENGTH EQUAL ONE                48240020
         BNE   QTIE8100                 IF MORE                         48330020
         SPACE 2                                                        48420020
QTIE9000 EQU   *                                                        48510020
***                                                                     48600020
***                 CHECK CHARACTER KNOWN TO BE ONLY ONE                48690020
***                 NOT MOVED TO USER BUFFER                            48780020
***                                                                     48870020
         CLI   K0(RBN),LFCHAR           IS IT LINE FEED                 48960020
         BNE   QTIE8100                 IF NOT                          49050020
         MVI   BUFFLNTH,KZIP            ZERO LNTH                       49140020
         SPACE 3                                                        49230020
QTIE9500 EQU   *                                                        49320020
*********************************************************************** 49410020
*****                                                             ***** 49500020
*****               END OF ROUTINE CLEAN UP                       ***** 49590020
*****                                                             ***** 49680020
*********************************************************************** 49770020
         L     RBUF,TSBITBFP-K1         FIRST TS BFR OF MSG             49860020
*                                       JUST MOVED                      49950020
         CLI   BUFFLNTH,KZIP            BUFFER EMPTY                    50040020
         BNE   QTIE9900                 IF NOT LEAVE                    50130020
         SPACE 2                                                        50220020
***                                                                     50310020
***                 REMOVE TS BUFFER FROM INPUT QUEUE                   50400020
***                 AND PLACE ON FREE QUEUE                             50490020
***                                                                     50580020
         MVC   TSBITBFP(K3),BUFFTRLR    UPDATE TRAILER QUEUE            50670020
         L     RGOTO,QTIEQBR            ADDRESS OF BFR RETURN   YS02019 50760002
         TM    BUFFFL1,BUFFIHOT     BFR ON BOTH QUEUES?         ZA12528 50768003
         BZ    QTIE9600             NO, GO FREE BFR             ZA12528 50776003
         NI    BUFFFL1,OFF-BUFFIHOT TURN OFF FLAG               ZA12528 50784003
         B     QTIE9800             GO HANDLE NEXT BFR          ZA12528 50792003
QTIE9600 EQU   *                                                ZA12528 50800003
         LR    RSVRB,RCODE              SAVE RETURN CODE        YS02019 50810002
         BALR  R0,RGOTO                 GO THERE AND RETURN     YS02019 50860002
         LR    RCODE,RSVRB              RESTORE RETURN CODE     YS02019 50910002
QTIE9800 EQU   *                                                ZA12528 50970003
         SR    RWRK,RWRK                                                51030020
         IC    RWRK,TSBNIBF             NO. OF INPUT BFRS               51120020
         BCTR  RWRK,R0                  DECREMENT                       51210020
         STC   RWRK,TSBNIBF             UPDATE COUNT                    51300020
         CLC   TSBITBFP(K3),KZERO       ANY MORE BFRS TO FREE           51660020
         BNE   QTIE9500                 IF SO CHECK NEXT ONE            51750020
         SPACE 2                                                        51840020
QTIE9900 EQU   *                                                        51930020
***                                                                     52020020
***                 RESTORE REGISTERS AND LEAVE                         52110020
***                                                                     52200020
         LR    RSVRB,RXSA               RESTORE SVRB ADDR       YS02019 52250002
         BR    RETURN                   RETURN TO IGC0009C              52380020
         SPACE 2                                                        52470020
***                                                                     52560020
***                 MOVE INSTRUCTION FOR BLANK PADDING                  52650020
***                                                                     52740020
QTIEPAD  MVC   K1(K1,RUBN),K0(RUBN)     MOVE WITH OVERLAP               52830020
         SPACE 2                                                YS02019 52840002
***                                                             YS02019 52850002
***                 ADDRESS OF BUFFER RETURN ROUTINE            YS02019 52860002
***                                                             YS02019 52870002
QTIEQBR  DC    V(IEDAYQBR)              IN IEDAYQT              YS02019 52880002
         EJECT                                                          52920020
*********************************************************************** 53010020
*                                                                     * 53100020
* FUNCTION -                                                          * 53190020
*                                                                     * 53280020
*    THE FUNCTION OF QTIP0190 IS TO GET A TS BUFFER FROM THE FREE     * 53370020
*    QUEUE, PLACE IN THE PROPER LOCATION ON THE OUTPUT QUEUE,         * 53460020
*    FORMAT THE BUFFER PREFIX, MOVE DATA FROM USER BUFFER TO THE      * 53550020
*    TS BUFFER.                                                       * 53640020
*                                                                     * 53730020
* ENTRY POINTS                                                        * 53820020
*                                                                     * 53910020
*    SEE QTIP0180                                                     * 54000020
*                                                                     * 54090020
* INPUT                                                               * 54180020
*                                                                     * 54270020
*    UPON ENTRY TO QTIP0190 THE FOLLOWING REGISTERS CONTAIN           * 54360020
*    USABLE INFORMATION                                               * 54450020
*                                                                     * 54540020
*         5- SVRB PTR, 9- TSB PTR, 10- TIOCRPT PTR,                   * 54630020
*         13 - SAVE AREA POINTER, 14 - RETURN ADDRESS                 * 54720002
*                                                                     * 55620020
* OUTPUT                                                              * 55710020
*                                                                     * 55800020
*    UPON LEAVING QTIP0190 THE TS BUFFER WILL BE COMPLETED            * 55890020
*    AS DESCRIBED UNDER FUNCTION, AND THE FIELDS 'XSAUBFRP,' AND      * 55980002
*    'XSAUBFRS' WILL BE UPDATED IN THE EXTENDED SAVE AREA.            * 56070002
*                                                                     * 56160020
* EXTERNAL REFERENCES                                                 * 56250020
*                                                                     * 56340020
*         IEDAYQBA - BUFFER ALLOCATE SUBROUTINE IN IEDAYQT            * 56430002
*                                                                     * 56520020
* EXITS, NORMAL                                                       * 56610020
*                                                                     * 56700020
*    EXIT IS MADE BY BRACHING TO THE ADDR IN RETURN REGISTER          * 56790020
*                                                                     * 56880020
* EXITS, ERROR                                                        * 56970020
*                                                                     * 57060020
*    THERE ARE NO ERROR EXITS FROM THIS ROUTINE                       * 57150020
*                                                                     * 57240020
* TABLES/WORK AREAS                                                   * 57330020
* ATTRIBUTES                                                          * 57420020
* CHARACTER CODE DEPENDENCY                                           * 57510020
* NOTE                                                                * 57600020
*                                                                     * 57690020
*     SEE QTIP0180 FOR ALL OF THESE                                   * 57780020
*                                                                     * 57870020
*********************************************************************** 57960020
         DROP  RXSA                                              M0094  57990021
         USING RBSECT,RSVRB                                      M0094  58020021
         SPACE 4                                                        58050020
QTIP0190 EQU   *                                                        58140020
         SAVE  (14,12)                  SAVE THE REGISTERS      YS02019 58230002
         SPACE 2                                                        58320020
***                                                                     58370002
***                 SET UP RECOVERY ENVIROMENT FOR QTIP 19              58380002
***                                                                     58390002
         MODESET EXTKEY=SUPR            KEY 0 FOR FRR           YM05909 58400002
         LA    RBN,QTOMFRR              FRR ROUTINE ADDRESS     YM05909 58402002
         SETFRR A,FRRAD=(RBN),WRKREGS=(RUBE,RLVC)               YM05909 58404002
         MODESET EXTKEY=TCAM            GET BUFR IN TCAM KEY    YM05909 58406002
         SPACE  2                                                       58408002
***                                                                     58410020
***                 GO TO IEDAYQBA TO GET A BUFFER              YS02019 58500002
***                                                             YS02019 58600002
         L     RGOTO,QTOMQBA            ADDRESS OF ROUTINE      YS02019 58700002
         BALR  R0,RGOTO                 REGISTER 2 (RBUF) NOW   YS02019 58800002
*                                       HAS A BUFFER ADDRESS    YS02019 58900002
         MODESET EXTKEY=SUPR            GET IN SUPERVISOR KEY   YM05909 58910002
         OI    XSAFLAG2,XSABFRAL        INDICATE TO ESTAE TIOC  YM05909 58950002
*                                       HAS BEEN ALLOCATED      YM05909 59000002
         MODESET EXTKEY=TCAM            GET BACK IN TCAM KEY    YM05909 59050002
         XC    TIOCBUF(BUFFHDLN),TIOCBUF  CLEAR BUFFER PREFIX   YS02019 59220002
         SPACE 2                                                        59400020
***                                                                     59490020
***                 FIND PROPER PLACE ON OUTPUT QUEUE                   59580020
***                 FOR THE NEXT BUFFER                                 59670020
***                                                                     59760020
         TM    XSAF,HSW                 HAS HDR BFR BEEN PLACED  M0094  59850021
*                                       ON OUTPUT QUEUE YET             59940020
         BO    QTOM0500                 IF HDR DONE                     60030020
         SPACE 2                                                        60120020
***                                                                     60210020
***                 FIND SPOT FOR HEADER BFR                            60300020
***                                                                     60390020
         CLC   TSBOBFP(K3),KZERO        ANYTHING ON OUTPUT QUEUE        60480020
         BNE   QTOM0100                 IF QUEUE NOT EMPTY              60570020
         STCM  RBUF,B'0111',TSBOBFP     LINK BFR TO PREVIOUS    YS02019 60670002
         B     QTOM0300                 GO FORMAT HDR BFR               60840020
         SPACE 2                                                        60930020
QTOM0100 EQU   *                                                        61020020
***                                                                     61110020
***                 FIND END OF QUEUE                                   61200020
***                                                                     61290020
         L     RSAVE,TSBOBFP-K1         FIRST HDR PTR                   61380020
         DROP  RBUF                                                     61470020
         USING TIOCBUF,RSAVE            TO CHECK OTHER BFRS             61560020
         SPACE                                                          61650020
QTOM0150 EQU   *                                                        61740020
         CLC   BUFFHEAD(K3),KZERO       IS THIS LAST MSG                61830020
         BE    QTOM0200                 IF IT IS                        61920020
         L     RSAVE,BUFFHEAD-K1        IF NOT CHECK NEXT ONE           62010020
         B     QTOM0150                 CHECK NEXT MSG                  62100020
         SPACE 2                                                        62190020
QTOM0200 EQU   *                                                        62280020
         STCM  RBUF,B'0111',BUFFHEAD    LINK NEW BFR TO END     YS02019 62380002
         DROP  RSAVE                                                    62550020
         USING TIOCBUF,RBUF                                             62640020
         SPACE 2                                                        62730020
QTOM0300 EQU   *                                                        62820020
***                                                                     62910020
***                 FORMAT HEADER BUFFER                                63000020
***                                                                     63090020
         SR    RWRK,RWRK                                        YS02019 63180002
         ST    RWRK,BUFFHEAD-K1         ZERO FLAG AND HDR PTR   YS02019 63190002
         LH    RWRK,XSAPRMTJ            GET DESTINATION TJID     M0094  63210021
         LTR   RWRK,RWRK                WAS IT SPECIFIED                63240020
         BZ    QTOM0400                 IF NOT                          63270020
         OI    BUFFFL2,BUFFTJID         INDICATE TJID MESSAGE           63300020
QTOM0400 EQU   *                                                        63330020
         MVI   BUFFOFST,BUFFHDLN        SET OFFSET                      63360020
         OI    BUFFFL1,BUFFHDR          HEADER BUFFER INDICATOR         63450020
         MVI   BUFFLNTH,K0              SET SIZE TO ZERO        YS02019 63459002
         SPACE 2                                                YS02019 63468002
***                                                             YS02019 63477002
***                 INSERT '+' SIGN IF CALLER NOT AUTHORIZED    YS02019 63486002
***                                                             YS02019 63495002
         TM    XSAF,XSAAUTH             IS CALLER AUTHORIZED    YS02019 63504002
         BO    QTOM2000                 YES, SKIP               YS02019 63513002
         MVI   BUFFHDAT,PLUSCHAR        ADD + SIGN              YS02019 63522002
         MVI   BUFFLNTH,K1              SIZE IS NOW 1           YS02019 63531002
         B     QTOM2000                 FORMAT REST OF BUFFER           63540020
         SPACE 2                                                        63630020
QTOM0500 EQU   *                                                        63720020
***                                                                     63810020
***                 FIND PROPER LOCATION FOR TRAILER                    63900020
***                                                                     63990020
         CLC   TSBOBFP(K3),KZERO        IS HEADER QUEUE EMPTY           64040020
         BNE   QTOM0800                 IF NOT, PUT ON HEADER QUEUE     64090020
         CLC   TSBOTBFP(K3),KZERO       IS TRAILER QUEUE EMPTY          64140020
         BE    QTOM0750                 IF SO, PUT ON TRAILER QUEUE     64190020
         SPACE 2                                                        64260020
***                                                                     64350020
***                 FIND END OF TRAILER QUEUE                           64440020
***                                                                     64530020
         DROP  RBUF                                                     64620020
         USING TIOCBUF,RSAVE                                            64710020
         L     RSAVE,TSBOTBFP-K1        FIRST TRAILER QUEUE BFR         64800020
         SPACE                                                          64890020
QTOM0600 EQU   *                                                        64980020
         CLC   BUFFTRLR(K3),KZERO       IS THIS THE LAST BFR            65070020
         BE    QTOM0650                 IF LAST                         65160020
         L     RSAVE,BUFFTRLR-K1        PREPARE TO CHECK NEXT           65250020
         B     QTOM0600                 CHECK NEXT BUFFER               65340020
         SPACE 2                                                        65430020
QTOM0650 EQU   *                                                        65520020
         TM    BUFFFL1,BUFFNLCR         IS THIS MSG COMPLETE            65610020
         BZ    QTOM1100                 IF NOT                          65700020
         SPACE 2                                                        65790020
QTOM0700 EQU   *                                                        65880020
***                                                                     65970020
***                 FIND END OF HEADER QUEUE                            66060020
***                                                                     66150020
         CLC   TSBOBFP(K3),KZERO        QUEUE EMPTY                     66240020
         BNE   QTOM0800                 IF NOT EMPTY                    66330020
         SPACE                                                          66340020
QTOM0750 EQU   *                                                        66350020
***                                                                     66360020
***                 PUT BUFFER ONTO TRAILER QUEUE                       66370020
***                                                                     66380020
         STCM  RBUF,B'0111',TSBOTBFP    MAKE THIS 1ST ON TRLR Q YS02019 66480002
         B     QTOM1200                 FORMAT TRAILER BFR              66600020
         SPACE 2                                                        66690020
QTOM0800 EQU   *                                                        66780020
***                                                                     66870020
***                 FIND LAST MESSAGE                                   66960020
***                                                                     67050020
         L     RSAVE,TSBOBFP-K1         FIRST HDR POINTER               67140020
         SPACE                                                          67230020
QTOM0900 EQU   *                                                        67320020
         CLC   BUFFHEAD(K3),KZERO       IS THIS LAST MSG                67410020
         BE    QTOM1000                 IF LAST                         67500020
         L     RSAVE,BUFFHEAD-K1        IF NOT CHECK NEXT ONE           67590020
         B     QTOM0900                 CHECK NEXT MSG FOR LAST         67680020
         SPACE 2                                                        67770020
QTOM1000 EQU   *                                                        67860020
***                                                                     67950020
***                 FIND END OF LAST MESSAGE                            68040020
***                                                                     68130020
         CLC   BUFFTRLR(K3),KZERO       IS THIS LAST BUFFER             68220020
         BE    QTOM1100                 IF SO LINK NEW BFR              68310020
         L     RSAVE,BUFFTRLR-K1        IF NOT PREP TO CHECK            68400020
         B     QTOM1000                 THE NEXT BUFFER OF MSG          68490020
         SPACE 2                                                        68580020
QTOM1100 EQU   *                                                        68670020
***                                                                     68760020
***                 LINK BUFFER TO LAST BUFFER OF LAST MESSAGE          68850020
***                                                                     68940020
         STCM  RBUF,B'0111',BUFFTRLR    MAKE THIS LAST OF MSG   YS02019 69030002
         DROP  RSAVE                                                    69120020
         USING TIOCBUF,RBUF                                             69210020
         SPACE 2                                                        69300020
QTOM1200 EQU   *                                                        69390020
***                                                                     69480020
***                 ADD OFFSET TO THE PREFIX                            69570020
***                                                                     69660020
         MVI   BUFFOFST,BUFFTRLN        SET OFFSET                      69750020
         SPACE 4                                                        69840020
QTOM2000 EQU   *                                                        69930020
***                                                                     70020020
***                 FORMAT FLAG BYTE OF BUFFER                          70110020
***                                                                     70200020
         SR    RWRK,RWRK                                                70290020
         IC    RWRK,TSBNOBF             GET NO. OF OUTPUT BFRS          70380020
         LA    RWRK,K1(R0,RWRK)         ADD ONE TO COUNT                70470020
         STC   RWRK,TSBNOBF             UPDATE COUNT                    70560020
         TM    XSAOPTNS,MCNTRL+MASIS    TEST FOR BOTH = FULLSCR SA60002 70650002
         BO    QTOM2050                 BOTH ON, FULL SCREEN    SA60002 70700002
         BZ    QTOM2100                 NEITHER, MUST BE EDIT   SA60002 70740002
         TM    XSAOPTNS,MASIS           TEST FOR ASIS           SA60002 70790002
         BO    QTOM2200                 GO TO ASIS PROCESS      SA60002 70800002
         OI    BUFFFL1,BUFFCNTL         MUST BE CONTROL         SA60002 70810002
         B     QTOM2200                 GO TO FURTHER CHECK     SA60002 70820002
         SPACE 2                                                        70822002
QTOM2050 EQU   *                                                SA60002 70824002
         OI    BUFFFL1,BUFFCNTL         SET FLAG FOR FULLSCR    SA60002 70826002
         SPACE 2                                                        70828002
QTOM2100 EQU   *                                                SA60002 70828402
         OI    BUFFFL1,BUFFEDIT         SET FLAG FOR EDIT       SA60002 70829202
         SPACE 2                                                        70829602
QTOM2200 EQU   *                                                        71550020
         TM    XSAOPTNS,MHOLD           HOLD OPTION SPECIFIED    M0094  71640021
         BZ    QTOM2500                 IF NOT                          71730020
         OI    BUFFFL1,BUFFHOLD         INDICATE HOLD OPTION            71820020
         SPACE 2                                                        71910020
QTOM2500 EQU   *                                                        72000020
***                                                                     72090020
***                 DETERMINE AMOUNT OF DATA TO MOVE                    72180020
***                                                                     72270020
         SR    RWRK,RWRK                                        YS02019 72280002
         SR    RSAVE,RSAVE                                      YS02019 72290002
         IC    RWRK,BUFFLNTH            GET CURRENT LENGTH      YS02019 72300002
         IC    RSAVE,BUFFOFST           GET CURRENT OFFSET      YS02019 72310002
         AR    RSAVE,RWRK               ADD OFFSET AND SIZE     YS02019 72320002
         LH    RWRK,XSAUBFRS            USER BUFFER SIZE         M0094  72360021
         AR    RWRK,RSAVE               ADD USER BFR & PREFIX           72630020
         CH    RWRK,TIOCBFSZ            CAN ALL OF MSG BE MOVED         72720020
         BH    QTOM3000                 IF NOT ROOM FOR ALL             72810020
         OI    BUFFFL1,BUFFNLCR         INDICATE EOM                    72900020
         B     QTOM4000                 MOVE ALL DATA                   72990020
         SPACE 2                                                        73080020
QTOM3000 EQU   *                                                        73170020
***                                                                     73260020
***                 MOVE ONE BFR FULL OF DATA                           73350020
***                                                                     73440020
         LH    RWRK,TIOCBFSZ            TS BFR SIZE                     73530020
         SPACE 2                                                        73620020
QTOM4000 EQU   *                                                        73710020
         SR    RWRK,RSAVE               AMOUNT OF DATA TO MOVE          73800020
         SR    RASCB,RASCB                                      YS02019 73890002
         IC    RASCB,BUFFLNTH           GET OLD SIZE            YS02019 73910002
         AR    RASCB,RWRK               ADD NEW SIZE            YS02019 73930002
         STC   RASCB,BUFFLNTH           STORE TOTAL SIZE        YS02019 73950002
         LR    RCNT,RBUF                COPY OF TS BFR PTR              73980020
         AR    RCNT,RSAVE               POINTER TO WHERE DATA           74070020
*                                       IS TO BE MOVED                  74160020
         L     RSAVE,XSAUBFRP           NEXT DATA FROM HERE      M0094  74260021
         BCTR  RWRK,R0                  SUBTRACT ONE FOR EXECUTE        74430020
         SPACE 2                                                YS02019 74436002
***                                                                     74442002
***                 REFERENCE BUFFER IN USER KEY BEFORE MOVING IN       74448002
***                 KEY ZERO                                            74454002
***                                                                     74460002
         L     RASCB,TSBCTCB            GET TCB PT FOR MODESET  YS02019 74466002
         USING TCB,RASCB                                        YS02019 74472002
         MODESET EXTKEY=RBT234,WORKREG=8                        YS02019 74478002
         CLI   K0(RSAVE),K0             TOUCH FIRST BYTE        YS02019 74484002
         AR    RSAVE,RWRK               GO TO LAST BYTE         YS02019 74490002
         CLI   K0(RSAVE),K0             ...AND TOUCH IT         YS02019 74496002
         SR    RSAVE,RWRK               BACK TO 1ST BYTE        YS02019 74502002
         MODESET EXTKEY=SUPR,WORKREG=8                          YS02019 74508002
         DROP  RASCB                                            YS02019 74514002
         EX    RWRK,QTOMMOVE            MOVE DATA                       74520020
         SPACE 2                                                        74610020
***                                                                     74700020
***                 UPDATE USER BUFFER POINTER AND SIZE                 74790020
***                                                                     74880020
         LA    RWRK,K1(R0,RWRK)         ADD BACK TO AMOUNT MOVED        74970020
         AR    RSAVE,RWRK               ADD AMOUNT TO POINTER           75060020
         ST    RSAVE,XSAUBFRP           UPDATE 'NEXT' POINTER    M0094  75130021
         LH    RSAVE,XSAUBFRS           GET OLD SIZE             M0094  75200021
         SR    RSAVE,RWRK               CALC REMAINING LENGTH    M0094  75270021
         STH   RSAVE,XSAUBFRS           STORE UPDATED SIZE       M0094  75340021
***                                                                     75426020
***                 CHECK WHETHER SYSTEM SHOULD BE IN LWAIT             75432020
***                                                                     75438020
         SR    RWRK,RWRK                                                75444020
         CH    RWRK,TIOCNFBF            ANY FREE BFRS AT ALL            75450020
         BE    QTOM4100                 NO, PUT SYS INTO LWAIT          75456020
         CLC   TIOCNFBF,TIOCUSLW        ARE ENOUGH BFRS FREE            75462020
         BNL   QTOM4200                 YES, DON'T PUT SYS IN LWT       75468020
QTOM4100 EQU   *                                                        75474020
***                                                                     75480020
***                 PUT SYSTEM IN LWAIT                                 75486020
***                                                                     75492020
         OI    TIOCFLG,TIOCSYLW         INDICATE SYSTEM LWAIT           75498020
QTOM4200 EQU   *                                                        75504020
         SETFRR D,WRKREGS=(RCNT,RBUF)   DELETE FRR FROM STACK   YM05909 75506002
         SPACE 2                                                        75510020
***                                                                     75600020
***                 RETURN TO USER                                      75690020
***                                                                     75780020
         RETURN (14,12)                 RESTORE REGS AND RETURN YS02019 75870002
         EJECT                                                          75920002
*********************************************************************** 75970002
*                                                                     * 76020002
*          Q T I P  19   FRR EXIT ROUTINE                             * 76070002
*     THIS ROUTINE GETS CONTROL WHEN AN ABEND OCCURS DURING THE       * 76120002
*     PROCESSING OF QTIP 19. IT WILL THEN CHECK IF TIOC BUFFERS       * 76130002
*     WERE ALLOCATED,AND IF SO FREE THEM. UPON EXIT FOR THIS          * 76132002
*     ROUTINE, R T M WILL CONTINUE ITS TERMINATION PROCESSING.        * 76134002
*                                                                     * 76134402
*             REGISTERS AT ENTRY                                      * 76136002
*                                                                     * 76138002
*             REGISTER  1 - SDWA                                      * 76138402
*             REGISTER 14 - R T M RETURN ADDRESS                      * 76138802
*             REGISTER 15 - ENTRY POINT                               * 76139202
*                                                                     * 76139602
*********************************************************************** 76139702
QTOMFRR  EQU   *                                                YM05909 76139802
         USING SDWA,RCNT                SDWA ADDRESSABILITY     YM05909 76139902
         LM    RSVRB,RAVT,SDWAGR05      RESTORE REGS 5-13       YM05909 76169902
         TM    XSAFLAG2,XSABFRAL        TIOC BFR ALLOCATED      YM05909 76179902
         BZ    QTOMRP                   NO,RETURN TO RTM        YM05909 76189902
*                                                                       76199902
*   PREPARE TO FREE THE MESSAGE BEING BUILT WHEN A TPUT FAILED          76209902
*                                                                       76219902
         SR    RCVT,RCVT                CLEAR WORK REGISTER     YM05909 76223202
         USING TSB,RTSB                 TSB ADDRESSABLE         YM05909 76225202
         ICM   RCVT,7,TSBOBFP           GET ADDR OF FIRST BFR   YM05909 76225602
         BZ    QTOMRP                   BR IF QUEUE EMPTY       YM05909 76226002
         LA    RBUF,TSBOBFP-(BUFFHEAD-TIOCBUF)  PRETEND THAT    YM05909 76226402
*                                       THE BFR PTR IS IN A BFR YM05909 76226502
*                                       RATHER THAN IN THE TSB  YM05909 76226602
         SPACE 1                                                        76249902
*                                                                       76259902
*   SCAN FOR LAST MESSAGE ON OUTPUT (HEADER) QUEUE                      76269902
*                                                                       76271902
         SPACE 1                                                        76272302
QTOMNHDR EQU   *                                                YM05909 76272702
         LR    RCNT,RBUF                SAVE BFR POINTER ADDR   YM05909 76273102
         LR    RBUF,RCVT                SAVE BFR ADDRESS        YM05909 76273202
         USING TIOCBUF,RBUF             BUFFER ADDRESSABLE      YM05909 76273302
         ICM   RCVT,7,BUFFHEAD          GET ADDR OF NEXT BUFFER YM05909 76281102
         BNZ   QTOMNHDR                 BR UNLESS NO MORE       YM05909 76283102
         DROP  RBUF                     BFR ADDRESSABILITY ENDS YM05909 76285102
*                                                                       76287102
*   CLEAR POINTER TO THIS MESSAGE AND FREE ALL ITS BUFFERS              76287502
*                                                                       76287902
         USING TIOCBUF,RCNT             BUFFER PTR ADDRESSABLE  YM05909 76288302
         XC    BUFFHEAD,BUFFHEAD        CLEAR BUFFER POINTER    YM05909 76288702
         DROP  RCNT                     BFR ADDRESSIBILITY ENDS YM05909 76288802
         IC    RCVT,TSBNOBF             GET NUMBER OF BUFFERS   YM05909 76296602
QTOMBFR  EQU   *                                                YM05909 76298702
         USING TIOCBUF,RBUF             BUFFER ADDRESSABLE      YM05909 76300702
         L     RGOTO,QTIEQBR            ADDR OF BFR RETURN CODE YM05909 76302702
         ICM   RCNT,7,BUFFTRLR          POINT TO NEXT BUFFER    YM05909 76303102
         BCTR  RCVT,R0                  DECREMENT BUFFER COUNT  YM05909 76303502
         BALR  R0,RGOTO                 GO TO FREE BFR IN REG 2 ZA24904 76303903
         LTR   RBUF,RCNT                ADDR OF NEXT BUFFER     YM05909 76304302
*                                       (IF ANY)                YM05909 76325402
         BNZ   QTOMBFR                  BR UNLESS NO MORE       YM05909 76335402
         DROP  RBUF                     BFR ADDRESSABILITY ENDS YM05909 76345402
         STC   RCVT,TSBNOBF             STORE UPDATED COUNT     YM05909 76345802
QTOMRP   EQU   *                                                YM05909 76346202
         LR    RBN,RETURN               SAVE R T M RETURN ADDR  YM05909 76346602
         SETRP RC=0,FRELOCK=(CMS,LOCAL) CANCEL FRR              YM05909 76353602
         BR    RBN                      RETURN TO R T M         YM05909 76355602
***                                                                     76360802
***                 DATA MOVE EXECUTION                                 76367802
***                                                                     76388902
QTOMMOVE MVC   K0(K1,RCNT),K0(RSAVE)    MOVE DATA TO TS BUFFER          76410020
         SPACE 2                                                YS02019 76420002
***                                                                     76430002
***                 ADCON FOR BUFFER ALLOCATION ROUTINE         YS02019 76440002
***                                                                     76450002
QTOMQBA  DC    V(IEDAYQBA)              ADDRESS OF BFR ALLOC RT YS02019 76460002
         EJECT                                                          76500020
         EJECT                                                          90936020
*********************************************************************** 90940020
*                                                                     * 90944020
*    QTIP0290                                                         * 90948020
*                                                                     * 90952020
* FUNCTION -                                                          * 90956020
*                                                                     * 90960020
*     QTIP0290 CLEANS UP THE TSBECB WHEN THE TASK WAITING             * 90964020
*     THEREUPON ABENDS.  IF ANOTHER TASK IS WAITING TO USE            * 90968020
*     THE TSB, THIS ROUTINE REMOVES THAT TASK FROM OWAIT.             * 90972020
*                                                                     * 90974002
*     NORMALLY, THIS ROUTINE IS INVOKED VIA A BRANCH ENTRY TO         * 90974402
*     SVC 101 (QTIP) FROM SVC 93'S ESTAE.  HOWEVER, IN THE CASE       * 90974802
*     OF AN ABNORMAL MEMORY TERMINATION, ESTAE'S ARE NOT ABLE TO      * 90975202
*     GET CONTROL, SO QTIP 29 IS ISSUED BY THE TIOC RMTR (RESOURCE    * 90975602
*     MANAGER TERMINATION ROUTINE), IEDAY8.                           * 90975702
*                                                                     * 90975802
*  ENTRY POINT -                                                      * 90993702
*                                                                     * 90996702
*     QTIP0290                                                        * 90999702
*                                                                     * 91002702
* INPUT -                                                             * 91005702
*                                                                     * 91008702
*    UPON ENTRY FROM IGC0009C ESTAE                                   * 91011702
*                                                                     * 91014702
*    REGISTER 2 - ASID OF THE ABENDING TASK                           * 91017702
*    REGISTER 3 - POINTER TO TCB OF ABENDING TASK, OR ZERO            * 91020702
*                                                                     * 91029702
*    UPON ENTRY FROM IEDAY8                                           * 91032702
*                                                                     * 91035702
*    REGISTER 15 - ADDRESS OF RMPL                                    * 91038702
*                                                                     * 91041702
* OUTPUT                                                              * 91044702
*                                                                     * 91047702
*    IF THE ABENDING TASK WAS WAITING ON ANY TSBECB'S, THE            * 91050702
*    FIRST BYTE OF EACH SUCH ECB IS ZEROED.                           * 91053702
*                                                                     * 91056702
* EXTERNAL REFERENCES -                                               * 91059702
*                                                                     * 91062702
*    TIME-SHARING INTERFACE PROGRAM, ENTRY CODE 4, TO BRING A USER    * 91065702
*    INTO MAIN STORAGE AND MAKE HIM ACTIVE.                           * 91068702
*                                                                     * 91071702
* EXITS, NORMAL                                                       * 91074702
*                                                                     * 91077702
*    THIS MODULE ZEROES REGISTER 15, AND BRANCHES VIA REGISTER 14.    * 91080702
*                                                                     * 91083702
* EXITS, ERROR                                                        * 91086702
*                                                                     * 91089702
*    NONE                                                             * 91092702
*                                                                     * 91095702
* TABLES/WORK AREAS -                                                 * 91098702
*                                                                     * 91101702
*    SEE QTIP0180                                                     * 91104702
*                                                                     * 91107702
* ATTRIBUTES -                                                        * 91110702
*                                                                     * 91113702
*    REENTRANT, REFRESHABLE, PRIVILEGED, DISABLED                     * 91116702
*                                                                     * 91119702
* CHARACTER CODE DEPENDENCY -                                         * 91122702
*                                                                     * 91125702
*    NONE                                                             * 91128702
*                                                                     * 91132020
* NOTES -                                                             * 91136020
*                                                                     * 91140020
*    NONE                                                             * 91144020
*                                                                     * 91148020
*********************************************************************** 91152020
         SPACE 3                                                        91156002
QTIP0290 EQU   *                                                        91160020
*********************************************************************** 91164020
*****                                                             ***** 91168020
*****               ENTRY FOR TSBECB CLEANUP                      ***** 91172020
*****                                                             ***** 91176020
*****    REGS 5, 6, 7, 8 ARE PRESERVED THROUGOUT THIS ROUTINE     ***** 91178002
*****                                                             ***** 91178402
*********************************************************************** 91180020
         SPACE 2                                                        91184020
         LR    RTCB,RCVT                TCBPT PASSED IN RCVT (R3)       91192020
         L     RCVT,CVTPTR              ADDRESS OF CVT          YS02019 91194002
         USING CVT,RCVT                 CVT ADDRESSABLE         YS02019 91196002
         L     RRPT,CVTAQAVT            ADDRESS OF TCX          YS02019 91196402
         L     RRPT,TCXRPT-IEDQTCX(,RRPT)  ADDRESS OF RPT       YS02019 91196802
         USING TIOCRPT,RRPT             TIOCRPT ADDRESSABLE     YS02019 91197202
         C     RGOTO,TIOCQTIP           IS CALL MADE BY AY8     YS02019 91197702
         BE    NOTOOCA                  NO, CALLED BY ESTAE     YS02019 91199602
         SR    RTCB,RTCB                DENOTE OOCA             YS02019 91211002
         USING RMPL,RGOTO               RMPL ADDRESSABLE        YS02019 91211502
         MODESET EXTKEY=SUPR            CHANGE INTO KEY 0       YS02019 91212002
         LH    RBUF,RMPLASID            GET ASID                YS02019 91212502
         MODESET EXTKEY=TCAM            GET BACK INTO TCAM KEY  YS02019 91213002
         SPACE 1                                                YS02019 91214002
NOTOOCA  EQU   *                                                YS02019 91216002
         LR    RTJID,RBUF               ASID PASSED IN RBUF     YS02019 91218002
         L     RASVT,CVTASVT            ADDRESS OF ASVT         YS02019 91220002
         USING ASVT,RASVT               ASVT ADDRESSABLE        YS02019 91222002
         SLL   RTJID,K2                 ASID * 4                YS02019 91224002
         L     RTJID,ASVTENTY-L'ASVTENTY(RTJID)  ADDR OF ASCB   YS02019 91226002
         USING ASCB,RTJID               ASCB ADDRESSABLE        YS02019 91228002
         L     RTSB,ASCBTSB             ADDRESS OF TSB OR 0     YS02019 91230002
         LTR   RTSB,RTSB                FOREGROUND TASK         YS02019 91232002
         BNZ   GOTTJID                  IF SO, DON'T NEED TCB           91234002
         LTR   RTCB,RTCB                TCB BETTER BE SPECIFIED         91236002
         BZ    DONE29                   IF NEITHER TCB NOR TJID, QUIT   91238002
         DROP  RTJID                    ASCB NOT ADDRESSABLE    YS02019 91238402
*                                                                       91240002
*              ASCBTSB = 0 MEANS BACKGROUND TASK                        91242002
*                        TCB # 0 REQUIRED                               91244002
*                        TCB = 0 MEANS EFFECTIVE NOP                    91246002
*              ASCBTSB # 0 MEANS FOREGROUND TASK                        91248002
*                        TCB = 0 MEANS OUT-OF-CORE ABEND                91250002
*                        TCB # 0 IS ABENDING TASK                       91252002
*                                                                       91254002
         SPACE 1                                                        91256002
GOTTJID  EQU   *                                                        91258002
*                                                                       91260020
*   SEE IF ABENDING USER HAS CONTROL OF TSB OUTPUT                      91264020
*                                                                       91268020
         LTR   RTSB,RTSB                CHECK FOR BACKGROUND    YS02019 91278002
         BZ    TJIDS                    YES, ONLY ASID TPUT     YS02019 91288002
         LR    RTJID,RBUF               ASID PASSED AT ENTRY    YM01373 91290002
         TM    TSBFLG1,TSBOWIP+TSBTJIP  IS TSB IN USE BY NORMAL TPUT    91296020
         BNM   TJIDS                    IF NOT, CHECK TSB TABLE         91300020
         LTR   RTCB,RTCB                TCB GIVEN                       91301020
         BZ    CLEAN                    NO. CLEAN-UP FOR OUT-OF-        91302020
*                                       CORE ABEND                      91303020
         C     RTCB,TSBCTCB             IS CURRENT TCB ABENDING         91304020
         BNE   TJIDS                    IF NOT, DON'T CLEAN THIS TSB    91308020
*                                                                       91312020
*   GO CLEAN UP TSB AND TURN OFF QCBPARTO, IF NECESSARY                 91316020
*                                                                       91320020
CLEAN    EQU   *                                                        91322020
         BAL   RCVT,CLEANUP             GO DO IT                        91324020
         SPACE                                                          91328020
*                                                                       91332020
*   POST TSBECB IF WAITED ON BY A LOGGED-ON USER                        91336020
*                                                                       91340020
         TM    TSBECB,WAITBIT           IS ECB WAITED ON        YM03998 91344002
         BNO   TJIDS                    IF NOT, DON'T POST              91348020
         LH    RTJID,TSBWTJID           GET WAITING ASID        YS02019 91358002
         SLL   RTJID,K2                 ASID * 4                YS02019 91368002
         L     RTJID,ASVTENTY-L'ASVTENTY(RTJID)  ASCB OF WAITER YS02019 91378002
         DROP RASVT                     ASVT NOT ADDRESSABLE    YS02019 91378402
         SPACE                                                          91380020
*                                                                       91388020
*   GO TO POST ROUTINE TO AWAKEN WAITING TJID TPUT, SO IT CAN FIND      91392020
*   OUT THAT THIS USER HAS HUNG UP.                                     91396020
*                                                                       91400020
*   REGISTERS FOR POST: 10 - COMPLETION CODE          RRPT              91404002
*                       11 - PTR TO ECB, BIT 0 = 1    RECBP             91408002
*                       12 - ADDR OF CVTBRET          RBASE             91412002
*                       13 - WAITING ASCB             RTJID             91416002
*                       14 - RETURN                   RETURN            91420020
*                       15 - POST ENTRY ADDRESS       RGOTO,RWRK        91424020
*                                                                       91428020
         L     RCVT,CVTPTR              ADDRESS OF CVT          YS02019 91438002
         L     RWRK,CVT0PT01            POST ROUTINE ADDRESS            91444002
         LR    RCNT,RBASE               SAVE BASE REGISTER      YS02019 91448002
         LA    RBASE,CVTBRET            ADDRESS OF CVTBRET      YS02019 91450002
         DROP  RBASE                    MODULE NOT ADDRESSABLE  YS02019 91450402
         USING QTIP0180,RCNT            USE RCNT AS MOD BASE    YS02019 91451202
         LR    R0,RRPT                  SAVE RPT ADDRESS        YS02019 91452002
         SR    RRPT,RRPT                MAKE COMPLETION CODE 0          91460020
         LA    RECBP,TSBECB             ECB POINTER              S21A12 91469021
         O     RECBP,HIGHON             HIGH-ORDER BIT FOR POST  S21A12 91470021
         MODESET EXTKEY=SUPR            CHANGE TO SUP KEY      @ZA05453 91484037
         BALR  RETURN,RGOTO             GO TO POST                      91484137
         MODESET EXTKEY=TCAM            CHANGE BACK TO TCAM    @ZA05453 91484237
*                                                                       91484402
*   NOTE - RBUF STILL CONTAINS TJID PASSED AT ENTRY, SO RTJID NOT SAVED 91486002
*                                                                       91486402
         SPACE 2                                                        91488020
*                                                                       91492020
*   RESTORE REGISTERS ON RETURN FROM POST                               91496020
*                                                                       91500020
         LR    RBASE,RCNT               BASE REGISTER           YS02019 91504002
         DROP  RCNT                     RCNT NO LONGER MOD BASE YS02019 91514002
         USING QTIP0180,RBASE           USE RBASE AS MOD BASE   YS02019 91514402
         LR    RRPT,R0                  TIOCRPT ADDRESS         YS02019 91516002
         LR    RTJID,RBUF               TJID PASSED AT ENTRY            91520020
         L     RETURN,TIOCSAVE+SAVER14  GET RETURN ADDR FROM    YS02019 91522002
*                                       SAVE AREA (SAVED BY     YS02019 91522402
*                                       SUBROUTINE CLEANUP)     YS02019 91522802
         SPACE 2                                                        91524020
TJIDS    EQU   *                                                        91528020
         L     RTSB,TIOCTSB-K1          ADDRESS OF 1ST TSB      YS02019 91538002
         SR    RBUF,RBUF                CLEAR WORK REGISTER     YS02019 91540002
         IC    RBUF,TIOCTSBS            TSB SIZE FOR INCREMENT  YS02019 91542002
         LH    RCNT,TIOCNTSB            NO. OF TSB'S AS LIMIT   YS02019 91544002
*                                                                       91548020
*    LOOK AT EACH TSB AND CHECK FOR A WAITED-UPON TSBECB AND TJID=RTJID 91552002
*                                                                       91560020
TSBLOOP  EQU   *                                                        91564020
         TM    TSBSTAT,TSBINUSE         IS THIS TSB IN USE      YS02019 91574002
         BZ    NEXTTSB                  NO, CHECK NEXT TSB      YS02019 91576002
         CH    RTJID,TSBWTJID           CAN ABEND'G TJID BE             91580020
*                                       EITHER WAITING OR IN PROGRESS.  91584020
         BNE   NEXTTSB                  NO. GET NEXT TSB                91588020
         TM    TSBFLG1,TSBTJIP          YES.IS IT IN PROGRESS.          91592020
         BO    CKCTCB                   YES.                            91596020
         TM    TSBECB,WAITBIT           NO. IS IT WAITING       YM03998 91600002
         BNO   NEXTTSB                  NO. GET NEXT TSB                91604020
         L     RWRK,TSBWTCB-K1          YES. GET WAITING TCB            91608020
         LA    RWRK,K0(,RWRK)           GET RID OF FLAGS        YS02019 91610002
         CR    RWRK,RTCB                IS WAITING TCB = ABEND'G TCB    91616020
         BE    THISTSB                  YES. GO CLEAN                   91620020
         B     CKRTCB                   NO. BUT....                     91624020
CKCTCB   EQU   *                                                        91628020
         C     RTCB,TSBCTCB             IS ABEND'G TCB= IN PROGRESS TCB 91632020
         BE    THISTSB                  YES. GO CLEAN                   91636020
*                                       NO. BUT...                      91640020
CKRTCB   EQU   *                                                        91644020
         LTR   RTCB,RTCB                WAS TCB GIVEN                   91648020
         BZ    THISTSB                  NO. GO CLEAN                    91652020
*                                       YES. GET NEXT TSB               91656020
         SPACE 1                                                        91670520
NEXTTSB  EQU   *                                                        91671020
*                                                                       91671520
*   CHECK NEXT TSB, OR JUMP OUT IF LAST HAS BEEN CHECKED                91672020
*                                                                       91672520
         AR    RTSB,RBUF                PT TO NEXT TSB          YS02019 91673002
         BCT   RCNT,TSBLOOP             CHECK AGAIN IF THIS WASN'T LAST 91673520
         SPACE 2                                                        91674020
*                                                                       91674520
*   ALL TSBS HAVE BEEN CHECKED.  SET CODE AND RETURN                    91675020
*                                                                       91675520
DONE29   EQU   *                                                        91676020
         SR    RGOTO,RGOTO              SET CODE TO ZERO                91676520
         BR    RETURN                   RETURN                          91677020
         EJECT                                                          91677520
THISTSB  EQU   *                                                        91678020
*                                                                       91678520
*  THIS TSB IS WAITED ON OR IN USE BY THE ABENDING TASK                 91679020
*                                                                       91679520
         MVI   TSBECB,K0                ZERO WAIT AND POST BITS         91680020
         TM    TSBFLG1,TSBTJIP          IS TJID TPUT GOING              91680520
         BZ    NEXTTSB                  IF NOT, NO FURTHER ACTION       91681020
         LA    RCVT,NEXTTSB             RETURN ADDR FOR SUBROUTINE      91681220
         SPACE                                                          91681320
CLEANUP  EQU   *                                                        91681420
*                                                                       91681520
*   SUBROUTINE TO CLEAN UP TSB AND HANDLE QCBPARTO                      91681620
*                                                                       91681720
         STM   RASVT,RBUF,TIOCSAVE      SAVE REGISTERS (11-2)   YS02019 91681802
         NI    TSBFLG1,OFF-(TSBOWIP+TSBTJIP+TSBTJBF+TSBTJOW)           -91681902
                                        INDICATE TSB NO LONGER SIEZED   91682002
         NI    TSBSTAT,OFF-TSBNOBUF     DON'T FORGET THIS               91682102
         L     RWRK,CVTPTR(,R0)         GET CVT POINTER         YS02019 91682202
         USING CVT,RWRK                 CVT ADDRESSABLE         YS02019 91682302
         TM    CVTTCMFG,CVTTCRDY        IS TCAM UP                      91682402
         BNO   NOQCB                    IF NOT, DON'T TOUCH QCB         91682502
*                                                                       91682602
*   TURN OFF QCBPARTO VIA IEDAYP SO TCAM WON'T EXPECT MORE OUTPUT       91682702
*                                                                       91682802
         TM    TSBFLG4,TSBCANC          IS USER STILL WITH US   YS02019 91693802
         BO    NOQCB                    NO. DON'T TURN OFF PARTO        91695602
         SPACE 2                                                        91697602
         L     R0,TSBF2M                GET SETTING OF TSB              91697702
RETRY    EQU   *                                                YS02019 91697802
         LR    RWRK,R0                  PUT IT IN WORK REGISTER YS02019 91697902
         O     RWRK,TPSTMSK1            * TURN OFF QCBPARTO     YS02019 91698002
         N     RWRK,TPSTMSK2            * IN QCBTSOF1           YS02019 91698102
         CS    R0,RWRK,TSBF2M           UPDATE TSB              YS02019 91698202
         BNE   RETRY                    LOOP UNTIL DONE         YS02019 91698302
         SPACE 3                                                        91698402
*                                                                       91698802
*   GO TO IEDAYTPQ FOR TPOST THE TSB TO IEDAYP                  YS02019 91698902
*                                                                       91699002
*        INTERFACE WITH IEDAYTPQ                                YS02019 91699102
*                                                                       91699202
*        REGISTER  0 - RETURN ADDRESS                           YS02019 91699302
*        REGISTER  1 - ZERO (MEANS TPOST TSB TO AYP)            YS02019 91699702
*        REGISTER  2 - TSB ADDRESS                              YS02019 91699802
*        REGISTER 13 - 6-WORD SAVE AREA                         YS02019 91700202
*        REGISTER 15 - ENTRY POINT ADDRESS TO IEDAYTPQ          YS02019 91700402
*                                                                       91700802
         SR    RCNT,RCNT                ZERO OUT REG 1          YS02019 91700902
         LR    RBUF,RTSB                TSB ADDRESS IN REG 2    YS02019 91701002
         LA    RTJID,TIOCSAVE+TPQSAVE   SAVE AREA ADDRESS       YS02019 91701202
         L     RGOTO,AYTPQAD            EPA OF IEDAYTPQ         YS02019 91701402
         BALR  R0,RGOTO                 GO TO UPDATE QCBPARTO   YS02019 91701502
         SPACE 2                                                        91701602
NOQCB    EQU   *                                                        91701802
*                                                                       91702002
*      CHECK FOR OTHER WAITING TPUTS FROM THIS TASK                     91702802
*                                                                       91704602
         TM    TSBFLG1,TSBWOWIP         IS A REGULAR TPUT WAITING       91706402
         BNO   RESTREGS                 IF NOT, THIS TSB DONE   YS02019 91708202
         TM    TSBFLG4,TSBOCAB          OUT OF CORE ABEND CHECK YS02019 91708602
         BO    RESTREGS                 YES, DONE WITH THIS TSB YS02019 91709002
         NI    TSBFLG4,OFF-(TSBOWAIT+TSBHOLD)  OUT OF OWAIT     ZA25139 91709403
         SPACE 1                                                        91710002
*                                                                       91711802
*   A NORMAL TPUT IS WAITING FOR THIS TSB.  MAKE ALL TCB'S              91713602
*   ASSOCIATED WITH THIS TSB ACTIVE                                     91715602
*                                                                       91717202
*        INTERFACE WITH STATUS                                          91717602
*                                                                       91718002
*        REGISTER  0 - BYTES 0-1 - ASID                                 91718402
*                      BYTES 2-3 - STATUS ENTRY CODE (8)                91718802
*        REGISTER  1 - X'80000000' (REQUESTS RESETTING)                 91718902
*        REGISTER 13 - TCB NONDISPATCHABILITY BIT MASK                  91722402
*        REGISTER 14 - RETURN ADDRESS                                   91724402
*        REGISTER 15 - ENTRY POINT ADDRESS                              91726402
*                                                                       91728402
         LM    R0,RCNT,INITREGS         LOAD PARMS FOR STATUS   YS02019 91778402
         L     RGOTO,TSBASCBA           GET ASCB ADDRESS        YS02019 91828402
         ICM   R0,B'1100',ASCBASID-ASCB(RGOTO)  GET ASID        YS02019 91878402
         L     RAVT,MSKOWAIT            SET TO REMOVE OWAIT     YS02019 91878602
         L     RGOTO,CVTPTR             CVT ADDRESS             YS02019 91878702
         L     RGOTO,CVTABEND-CVT(,RGOTO)   SCVT ADDRESS        YS02019 91878802
         USING SCVTSECT,RGOTO           SCVT ADDRESSABLE        YS02019 91879202
         L     RGOTO,SCVTSTAT           GET EPA OF STATUS       YS02019 91879302
         DROP  RGOTO                    SCVT NOT ADDRESSABLE    YS02019 91882802
         MODESET EXTKEY=SUPR            CHANGE INTO KEY 0       YS02019 91884802
         BALR  RETURN,RGOTO             GO TO STATUS            YS02019 91890002
         MODESET EXTKEY=TCAM            GET BACK TO TCAM'S KEY  YS02019 91892002
         SPACE 1                                                        91894002
RESTREGS EQU   *                                                YS02019 91896002
         LM    RASVT,RBUF,TIOCSAVE      RESTORE REGS (11-2)     YS02019 91899302
         SPACE 1                                                        91902802
         BR    RCVT                     GO BACK TO MAINLINE     YS02019 91906102
         SPACE 5                                                        91913202
*********************************************************************** 91923202
*****                                                             ***** 91925202
*****               ADCON FOR TPOSTING ROUTINE                    ***** 91927202
*****                                                             ***** 91929202
*********************************************************************** 91929602
         SPACE 2                                                        91929702
AYTPQAD  DC    V(IEDAYTPQ)              EPA OF IEDAYTPQ         YS02019 91929802
         EJECT                                                          91929902
*********************************************************************** 91946602
*****                                                             ***** 91963302
*****               THE FOLLOWING CONSTANTS ARE USED              ***** 91980020
*****                                                             ***** 92070020
*********************************************************************** 92160020
         SPACE 2                                                        92250020
KZERO    DC    F'0'                     ZERO COMPARATOR                 92340020
MSKOWAIT DC    AL1(0,0,TCBOWAIT,0)      MASK FOR STATUS         YS02019 92390002
TPSTMSK1 DC    AL1(0,0,QCBPARTO,0)      QCBPARTO IS THE BIT     YS02019 92394002
TPSTMSK2 DC    AL1(255,255,255,255-QCBPARTO) TURN OFF QCBPARTO  YS02019 92396002
INITREGS DC    A(8)                     REGISTERS 0 AND 1       YS02019 92400002
INITREG1 DC    X'80000000'              FOR STATUS              YS02019 92410002
HIGHON   EQU   INITREG1                 FOR CORSS MEMORY POST   YS02019 92412002
KMAX     DC    H'255'                   MAXIMUM MOVABLE                 92414002
KTHREE   DC    H'3'                     USED TO STRIP 3270       S22028 92416002
*                                       CONTROL CHARACTER        S22028 92418002
PATCHREA DC    10F'0'                   PATCH AREA               Y01018 92420000
         EJECT                                                          92520020
         IHAASCB                                                YS02019 92610002
         EJECT                                                  YS02019 92660002
         IHAASVT                                                YS02019 92670002
         EJECT                                                  YS02019 92710002
         TAVTD                                                  YS02019 92810002
         EJECT                                                  YS02019 92910002
         IKJTIOCB                                               YS02019 93010002
         EJECT                                                  YS02019 93110002
CVT      DSECT                                                  YS02019 93210002
         CVT                                                    YS02019 93310002
         EJECT                                                  YS02019 93410002
         TPRIOR                                                 YS02019 93510002
         EJECT                                                  YS02019 93610002
         TQCBD                                                  YS02019 93710002
         EJECT                                                          94508100
         IKJRB                                                          94509400
***                                                                     94510700
***      EXTENDED SAVE AREA.  THSES STATEMENTS SHOULD FOLLOW            94512000
***      THE MACRO 'IKJRB.'                                             94513300
***                                                                     94514600
         ORG   RBEXSAVE                 START OF SAVE AREA       M0094  94515900
XSAPRM0  DS    0F                       REG 0 AT ENTRY           M0094  94517200
XSAPRMTJ DS    H                        TJID PASSED              M0094  94518500
XSAPRMSZ DS    H                        SIZE PASSED              M0094  94519800
XSAPRM1  DS    0F                       REG 1 AT ENTRY           M0094  94521100
XSAOPTNS DS    X                        USER OPTIONS             M0094  94522400
MASIS    EQU   X'01'                    ASIS OPTION SPECIFIED    M0094  94523700
MCNTRL   EQU   X'02'                    1 MEANS CONTROL          M0094  94525000
*                                                                       94526300
*   BOTH OF THE ABOVE BITS OFF MEANS EDIT OPTION                        94527600
*                                                                       94528900
MBREAK   EQU   X'04'                    BREAKIN SPECIFIED        M0094  94530200
MHOLD    EQU   X'08'                    1 MEANS HOLD             M0094  94531500
MTGET    EQU   X'80'                    1 MEANS TGET REQUESTED   M0094  94532800
MUSERID  EQU   X'40'                    USERID PTD TO BY REG 15 YS02019 94534102
MLOWP    EQU   X'20'                    0 HIGHPRI, 1 LOWPRI      M0094  94535400
MWAIT    EQU   X'10'                    1 MEANS NOWAIT           M0094  94536700
         DS    AL3                      REST OF REGISTER ONE     M0094  94538000
XSAWD3   DS    0F                       FOR SAVING REGISTERS     M0094  94539300
XSAFLAG  DS    X                        FLAG PASSED BY 9C TO 01  M0094  94540600
*                                       AND 02                   M0094  94541900
XSATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT   M0094  94543200
         DS    AL3                      REST OF WORD             M0094  94544500
         ORG   XSAWD3+2                 INPUT ED, OUTPUT MOVE    M0094  94545800
XSAUBFRS DS    H                        AMT DATA LEFT TO MOVE    M0094  94547100
XSAUBFRP DS    0F                       LOC DATA LEFT TO MOVE    M0094  94548400
XSAESTAL DS    CL16                     LIST FOR ESTAE MACRO    YS02019 94558402
         ORG   XSAUBFRP+4               USED FOR SAVE AREA WHEN YS02019 94560102
*                                       NOT NEEDED BY ESTAE     YS02019 94561402
XSAWD5   DS    F                        FOR SAVING REGISTERS     M0094  94562700
XSAWD6   DS    F                        FOR SAVING REGISTERS     M0094  94564000
         ORG   XSAWD5                   USE WORDS 5-6 FOR NAME   M0094  94565300
XSAENQNM DS    CL8                      ENQ NAME FOR TJID TPUT   M0094  94566600
XSAWD7   DS    F                        FOR SAVING REGISTERS     M0094  94567900
XSAWD8   DS    F                        FOR SAVING REGISTERS     M0094  94569200
         ORG   XSAWD7                   USE WDS 7-8 FOR ENQ PRMS M0094  94570500
XSAENQAD DS    2F                       WORK AREA FOR ENQ/DEQ    M0094  94571800
XSAUSERP DS    0F                       USER ID POINTER         YS02019 94572402
XSAWD9   DS    F                        FOR SAVING REGISTERS     M0094  94573100
XSARETRG DS    0F                       TGET/TPUT RETURN ADDRES YS02019 94573702
XSAWD10  DS    F                        FOR SAVING REGISTERS     M0094  94574400
         DS    CL1                      RESERVED                YS02019 94574802
XSAUSERK DS    CL1                      SVC CALLER'S KEY        YS02019 94575202
XSARC    DS    H                        RETURN CODE SAVE AREA   YS02019 94575702
XSATJID  DS    H                        CALLER'S TJID            M0094  94577000
XSAFLAG2 DS    X                        FLAGS                   YM05909 94579002
XSAATR   EQU   X'80'                    NEXT CHAR IN TS BFR IS   S22028 94579402
*                                       A 3270 ATTRIBUTE BYTE    S22028 94579502
XSABFRAL EQU   X'40'                    TIOC BUFFER HAS BEEN    YM05909 94589502
*                                       ALLOCATED               YM05909 94599502
XSA15D   EQU   X'20'                    CHANGE COMPLETION CODE  YM05909 94609502
*                                       TO 15D IN ETAE          YM05909 94611502
*                   NEXT 5 BITS UNUSED                          YM05909 94617602
XSAF     DS    X                        FLAGS USED BY TPUT. INI- M0094  94656602
*                                       TIALIZED FROM XSAFLAG.          94694702
HSW      EQU   X'80'                    HEADER BFR DONE          M0094  94732802
PSW      EQU   X'40'                    NEED TO TPOST QCB        M0094  94770902
*SATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT          94809002
OSW      EQU   X'10'                    TSBOWIP TURNED ON BY US  M0094  94847102
*                                       (NOT SOME OTHER TPUT)           94885202
XSADMOVE EQU   X'08'                    DATA IS MOVING          YS02019 94923302
XSAAUTH  EQU   X'04'                    USER IS AUTHORIZED      YS02019 94961402
XSAIDENQ EQU   X'02'                    ASID TPUT ASID ENQUEUED YS02019 94999502
XSAPARTO EQU   X'01'                    QCBPARTO IS SET ON      YM01246 95009502
         EJECT                                                          95037602
         IHASCVT                                                YS02019 95075702
         EJECT                                                  YS02019 95113802
         IHARMPL                                                YS02019 95123802
         EJECT                                                  YS02019 95133802
         IKJTCB                                                         95151902
         EJECT                                                          95190002
         TTCXD                                                          95790002
         EJECT                                                          96390002
         IKJTIOCP                                                       96990002
         EJECT                                                          97590002
         IKJTSB                                                         98190002
         EJECT                                                          98240002
         IHAFRRS                                                        98290002
         EJECT                                                          98340002
         IHASDWA                                                        98390002
         EJECT                                                          98440002
         IHAPSA                                                         98490002
         END                                                            99390002
./  ADD  SSI=41060042,NAME=IEDAYHH
         TITLE 'IEDAYHH - HANG UP INITIALIZATION FOR TSO REGION'        00500020
IEDAYHH  CSECT                                                          01000020
         COPY  LCGASMS2                                        ,YS02019 01050002
         ENTRY QTIP0040                                                 01500020
         DC    C'IEDAYHH '              MODULE ID                       01560020
         DC    X'4098'                  DATE  4/8/74            VS08528 01620002
         DS    0H                                                       01700020
         SPACE 3                                                        02000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02300020
*                                                                     * 02600020
*                                                                     * 02900020
*    NAME - IEDAYHH, TIOC HANG UP'S SECTION OF QTIP SVC               * 03200020
*                                                                     * 03500020
*    RELEASE 21 DELETIONS/CHANGES                                     * 04400020
*    RELEASE 20 DELETIONS/CHANGES                                     * 04700020
*                                                                TS1623 05000020
*                                                                TS1628 05300020
*                                                                 M3846 05600020
*                                                                 M0032 05700020
*                                                                     * 05900020
* STATUS -                                                            * 06200020
*    CHANGE LEVEL 0                                                   * 06500020
*                                                                     * 06800020
* FUNCTION -                                                          * 07100020
*    CALL SYSTEM INITIATED CANCEL (SIC) ROUTINE TO REMOVE THE         * 07400002
*    USER FROM THE SYSTEM                                             * 07700002
*                                                                     * 08000020
* ENTRY POINTS -                                                      * 08300020
*         QTIP0040, TO PERFORM HANG UP PROCESSING                     * 08600002
*                                                                     * 08900020
* INPUT -                                                             * 09200020
*    REGISTER  2 HAS ASCB ADDRESS                                     * 09500002
*    REGISTER  7 HAS QCB ADDRESS                                      * 09800002
*    REGISTER  9 HAS TSB ADDRESS                                      * 10100002
*    REGISTER 12 HAS ENTRY POINT ADDRESS                              * 10400002
*    REGISTER 13 HAS AVTSAVE2 ADDRESS                                 * 10700020
*    REGISTER 14 HAS RETURN ADDRESS                                   * 11000020
*                                                                     * 11300020
* OUTPUT -                                                            * 11600020
*    NONE                                                             * 11900020
*                                                                     * 12200020
* EXTERNAL REFERENCES -                                               * 12500020
*         SIC, VIA BRANCH ENTRY AT CVTSIC                             * 13100002
*         QTIP 28, VIA BRANCH ENTRY AT QTIP28AD                       * 13400002
*         QTIP 14, VIA BRANCH ENTRY AT QTIP14AD                       * 13450002
*                                                                     * 13700020
* EXITS, NORMAL -                                                     * 14000020
*         BR 14, RETURN TO HANG UP (IEDAYH)                           * 14300020
*                                                                     * 14600020
* EXITS, ERROR -                                                      * 14900020
*         NONE                                                        * 15200020
*                                                                     * 15500020
* TABLES/WORK AREAS -                                                 * 15800020
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 16100020
*                                                                     * 16400020
* ATTRIBUTES -                                                        * 16700020
*    REENTRANT, REFRESHABLE, SUPERVISOR STATE                         * 17000002
*                                                                     * 17300020
* CHARACTER CODE DEPENDENCY -                                         * 17600020
*    THIS MODULE IS ASSEMBLED IN EBCDIC AND MUST BE RE-ASSEMBLED IF A * 17900020
*    DIFFERENT CHARACTER SET IS TO BE USED DURING EXECUTION           * 18200020
*                                                                     * 18500020
* NOTES -                                                             * 18800020
*    NONE                                                             * 19400002
*                                                                     * 19700020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20000020
         EJECT                                                          24000020
********                                                                24500020
******** REGISTER EQUATES                                               25000020
********                                                                25500020
R0       EQU   0                        WORK REGISTER           YS02019 26000002
R1       EQU   1                        WORK REGISTER           YS02019 26500002
RASCB    EQU   2                        ASCB ADDR PASSED BY AYH YS02019 27000002
RHOLDRET EQU   3                        SAVES RET ADDR TO HANG UP       27500020
ROTTEN   EQU   4                        WORK REGISTER                   28000020
ROB      EQU   5                        WORK REGISTER                   28300020
RTIOC    EQU   6                        TIOCRPT ADDR            YS02019 28600002
RQCB     EQU   7                        QCB ADDRESS             YS02019 28650002
RWORK8   EQU   8                        WORK REGISTER           YS02019 28900002
RTSB     EQU   9                        TSB ADDRESS             YS02019 28950002
RAH      EQU   10                       WORK REGISTER                   29200020
RECB     EQU   11                       ECB ADDR                        29800020
RBASE    EQU   12                       ENTRY AND BASE ADDRESS          30500020
RSAVE    EQU   13                       AVT SAVE AREA ADDR AT ENTRY AND 31000020
*                                       SAVE AREA ADDR FOR SIL RTN      31500020
RETURN   EQU   14                       RETURN ADDRESS                  32000020
RGO      EQU   15                       HOLDS ENTRY ADDRESSES           32700020
         SPACE 3                                                        33400020
********                                                                34100020
******** MASKS                                                          34800020
********                                                                35500020
SAVESIZE EQU   72                       SIZE OF AVT SAVEAREAS           35800020
NOT      EQU   X'FF'                    ZEROS VARIOUS BITS              36200020
POSTBIT  EQU   X'40'                    POST BIT                YS02019 36250002
ONE      EQU   1                        CONSTANT OF 1           YS02019 36300002
         SPACE 3                                                        37000020
********                                                                37500020
******** ESTABLISH ADDRESSABILITY AND INITIALIZE REGISTERS              38000020
********                                                                38500020
QTIP0040 EQU   *                                                        39000020
         USING *,RBASE                                                  39500020
         USING TSB,RTSB                 TSB ADDRESSABILITY      YS02019 39550002
         USING ASCB,RASCB               ASCB ADDRESSABILITY     YS02019 39600002
         USING IEDQQCB,RQCB             QCB ADDRESSABILITY      YS02019 39650002
         LR    RHOLDRET,RETURN          SAVE HANG UP RETURN ADDR        42000020
         SPACE 3                                                        42500020
**********************************************************************  42550002
*        CHECK IF TSB HAS BEEN THRU LOGOFF                           *  42600002
**********************************************************************  42650002
         TM    TSBSTAT,TSBDISC          LOGOFF OCCURED          YS02019 42700002
         BNO   HANGUP                   NO, BR TO SET TSBHUNG   YS02019 42750002
         SPACE 3                                                        42800002
**********************************************************************  42850002
*        EXIT QTIP 14 TO CLEAN UP TSO CONTROL BLOCKS                 *  42900002
**********************************************************************  42950002
         LR    RWORK8,RTSB              QTIP14 NEEDS TSB IN R8  YS02019 43000002
         LR    ROTTEN,RBASE             SAVE BASE ADDRESS       YS02019 43050002
         L     RGO,QTIP14AD             QTIP14 ENTRY ADDRESS    YS02019 43100002
         L     RBASE,QTIP11AD           QTIP14 BASE ADDRESS     YS02019 43150002
         BR    RGO                      BRANCH TO QTIP14        YS02019 43200002
         SPACE 3                                                        46500020
*********************************************************************** 46550002
*        INDICATE TERMINAL HAS HUNG UP                                * 46600002
*********************************************************************** 46650002
HANGUP   EQU   *                                                YS02019 46700002
         OI    TSBFLG4,TSBHUNG          INDICATE A HANGUP       YS02019 46750002
         SR    ROTTEN,ROTTEN            CLEAR REGISTER          VS08528 46760002
         STH   ROTTEN,TSBASRCE          ZERO TSBASRCE SO AYP    VS08528 46770002
*                                       WON'T TOUCH THE QCB     VS08528 46780002
         SPACE 3                                                        46800002
**********************************************************************  46850002
*       GO TO QTIP ENTRY 28 TO RETURN HELD TCAM BUFFERS FOR THIS USER*  50500002
*       INPUT REGISTERS ARE 7 (QCB), 9 (TSB), AND 13 (AVTSAVE2)      *  51500002
*********************************************************************** 52500002
         LR    ROTTEN,RBASE             PRESERVE BASE ADDR              54500020
         L     RGO,QTIP28AD             GET QTIP 28 ENTRY ADDR          56500020
         L     RBASE,QTIP5AD            GET QTIP 28 BASE ADDR           58500020
         BALR  RETURN,RGO               GO DO YOUR THING                60500020
         LR    RBASE,ROTTEN             RESTORE BASE ADDR               62500020
         SPACE 3                                                        62900020
**********************************************************************  62950002
*         CHECK IF A LINE DISCONNECT RECOVERY PERIOD WAS SPECIFIED    * 63000002
**********************************************************************  63050002
         L     ROB,CVTPTR               CVT ADDRESS             YS02019 63060002
         L     RTIOC,CVTAQAVT-CVT(,ROB) GET TCX ADDRESS         YS02019 63070002
         L     RTIOC,TCXRPT-IEDQTCX(,RTIOC) GET TIOCRPT ADDRESS YS02019 63080002
         USING TIOCRPT,RTIOC            TIOCRPT ADDRESSABILITY  YS02019 63300002
         LH    RAH,TIOCRCLM             GET RECONNECT LIMIT     YS02019 63350002
         CH    RAH,ZERO                 IS RECONNECT 0 MINUTES  YS02019 63400002
         BE    SIC                      YES, BR TO FORCE LOGOFF YS02019 63450002
         SPACE 3                                                        63500002
*********************************************************************** 63550002
*        LINE DISCONNECT RECOVERY - SEE IF RECONNECT PERIOD WAS       * 63600002
*    ALREADY ENTER                                                    * 63602002
*********************************************************************** 63650002
*                                       .STORE # OF MIN. BEFORE YS02019 63700002
         ST    RAH,TSBMINL              .USER WILL DISCONNECT   YS02019 63750002
         TM    TIOCTECB,POSTBIT         RECON PERIOD STARTED    YM01176 63800002
         BO    INCR                     YES,BR & INCR TSBMINL   YS02019 63900002
         SPACE 3                                                        63950002
*********************************************************************** 64000002
*        POST TIOCTECB SO A RECONNECT PERIOD CAN BEGIN                * 64050002
*           ENTRY TO POST                                             * 64060002
*             R10 = COMPLETION CODE                                   * 64070002
*             R11 = ECB ADDRESS                                       * 64080002
*             R12 = ERROR RETURN ADDRESS                              * 64090002
*             R13 = ZERO ASCB ADDRESS                                 * 64092002
*             R14 = RETURN ADDRESS                                    * 64094002
*             R15 = CVTOPT01                                          * 64096002
*********************************************************************** 64100002
         LA    RECB,TIOCTECB            GET ECB ADDR                    67700002
         SR    RAH,RAH                  ZERO COMPLETION CODE            68100020
         LR    ROB,RBASE                SAVE BASE REGISTER              68500020
         L     ROTTEN,CVTPTR            GET ADDR OF CVT                 69300020
         USING CVT,ROTTEN               CVT ADDRESSABILITY      YS02019 69310002
         LA    RBASE,CVTBRET            NO ERROR RETURN ADDR    YS02019 69350002
         L     RGO,CVT0PT01             GET ADDR OF POST ROUTINE        69700020
         LR    ROTTEN,RSAVE             PRESERVE SAVEAREA ADDR          69900020
         SR    RSAVE,RSAVE              NO ASCB ADDR            YS02019 69950002
         MODESET EXTKEY=SUPR            NEED SUPERVISOR KEY FOR POST    70000002
         BALR  RETURN,RGO               GO POST LOGOFF                  70100020
         MODESET EXTKEY=TCAM            BACK TO TCAMS KEY               70150002
         LR    RBASE,ROB                RESTORE BASE REGISTER           70500020
         LR    RSAVE,ROTTEN             RESTORE SAVEAREA ADDR           70700020
         B     FINISH                   RETURN TO CALLER        YS02019 70750002
         SPACE 3                                                        73000020
*********************************************************************** 73050002
*        RECONNECT PERIOD HAS STARTED, ADD 1 MINUTE TO SYNCHRONIZE    * 73100002
*********************************************************************** 73150002
INCR     EQU   *                                                YS02019 73200002
         L     RAH,TSBMINL              .UPDATE DISCONNECT      YS02019 73250002
         LA    RAH,ONE(,RAH)            .TIME BY ONE            YS02019 73300002
         ST    RAH,TSBMINL              .MINUTE                 YS02019 73350002
         B     FINISH                   RETURN TO CALLER        YS02019 73400002
         SPACE 3                                                        73450002
*********************************************************************** 73500002
*        SYSTEM INITIATED CANCEL (SIC) - USED TO CANCEL A TERMINAL    * 73550002
*              IF HANGUP OCCURS OR IF UNRECOVERABLE I/O ERRORS OCCUR  * 73600002
*         ENTRY TO SIC                                                * 73650002
*           R0 = POST CODE (622 ABEND)                                * 73700002
*           R1 = ASCB                                                 * 73800002
*           R13= SAVEAREA ADDRESS                                     * 73850002
*           R14= RETURN ADDRESS                                       * 73900002
*           R15= ENTRY POINT                                          * 74000002
*********************************************************************** 74050002
SIC      EQU   *                                                YS02019 74100002
         L     R1,TSBASCBA              ASCB OF USER TO SIC     YS02019 74150002
         L     R0,SICODE                622 ABEND CODE          YS02019 74200002
         L     ROB,CVTPTR               ADDR OF CVT             YS02019 74250002
         USING CVT,ROB                  CVT ADDRESSABILITY      YS02019 74260002
         L     RGO,CVTSIC               ENTRY TO SIC            YS02019 74300002
         LA    RSAVE,SAVESIZE(,RSAVE)   NEXT USABLE SAVEAREA    YS02019 74310002
         MODESET EXTKEY=SUPR            KEY ZERO FOR SIC        YS02019 74350002
         BALR  RETURN,RGO               CALL SIC                YS02019 74400002
         SPACE 3                                                        74450002
**********************************************************************  74500002
*        RETURN TO HANG UP, IEDAYH                                    * 74550002
*********************************************************************** 74600002
FINISH   EQU   *                                                        74650002
         LR    RETURN,RHOLDRET          RESTORE RETURN ADDR             84000020
         BR    RETURN                   GO BACK                         84500020
         SPACE 3                                                        85000020
*********************************************************************** 85050002
*        CONSTANTS                                                    * 85100002
*********************************************************************** 85150002
QTIP5AD  DC    V(QTIP0050)              BASE ADDR FOR QTIP ENTRY 28     86600020
QTIP28AD DC    V(QTIP0280)              ENTRY ADDR FOR QTIP ENTRY 28    86700020
QTIP11AD DC    V(QTIP0110)              BASE ADDR FOR QTIP 14   YS02019 86850002
QTIP14AD DC    V(QTIP0140)              ENTRY ADDR FOR QTIP 14  YS02019 86900002
SICODE   DS    0F                                               YS02019 86950002
         DC    XL4'00000622'            SIC ABEND CODE          YS02019 87000002
ZERO     DC    H'0'                     ZERO CONSTANT           YS02019 87050002
KSAVESIZ DC    H'72'                    SIZE OF AVT SAVEAREA            87060002
PATCH    DC    10F'0'                   PATCH AREA              YS02019 87100002
         EJECT                                                          88000002
* * * * * * * * * * * *  CONTROL BLOCK DSECTS * * * * * * * * * * * * * 88500020
         SPACE 3                                                        88600020
CVT      DSECT                                                          88700020
         CVT                                                            88800020
         EJECT                                                          89000002
         IKJTSB                                                         89500002
         EJECT                                                          89600002
         IKJTIOCP                                                       89700020
         EJECT                                                          90000002
         IHAASCB                                                        90010002
         EJECT                                                          90050002
         TTCXD                                                          90060002
         EJECT                                                          90100002
         TQCBD                                                          90110002
         EJECT                                                          90150002
         TAVTD                                                          90200002
         END                                                            98500020
./  ADD  SSI=81000361,NAME=IEDAYII
         TITLE 'IEDAYII - QTIP CODE FOR TSINPUT'                        00100020
IEDAYII  CSECT                                                          00200020
         SPACE 1                                                        00500020
         DC    CL7'IEDAYII'             IDENTIFIER                      00800020
         DC    X'7203'                  DATE - 07/22/77         ZA25074 00850000
         DS    0H                       FILLER                          00900020
         SPACE 1                                                        01108020
*********************************************************************** 01116020
*                                                                       01116400
*A064400,138118,138980                                          ZA25074 01116800
*C138110                                                        ZA25074 01117200
*D138124-138126,645200-6456000                                  ZA25074 01117600
*          VS2  3.7  PTF                                                01118000
*                                                              @ZA12528 01118400
*                                                              @ZA12528 01118800
*                                                              @ZA12528 01119200
*                                                              @ZA12528 01119600
*                                                              @ZA12528 01120000
*                                                              @ZA12528 01120400
*  A 237230-241230,264430-266230,268430-274030,275930,276930    ZA12528 01120800
*  C 210806,211630-213230,215630-218030                         ZA12528 01121200
*  C 242030-245230,256430-262030,280290                         ZA12528 01121600
*  D 235630,237230-239630,249230,250030,264430-266030           ZA12528 01122000
*  D 268430-274430,275930                                       ZA12528 01122400
*                                                                     * 01124020
*        VS2 3.0 SU                                                     01124100
*0000137840                                                    @ZA11600 01124200
*0000137030,137658                                             @ZA10588 01124300
*0000617000                                                    @ZA08015 01124400
*0000008100,337630                                             @ZA07609 01124500
*0000617000                                                    @ZA05465 01124600
*0000750674                                                    @ZA03667 01124700
*0000530680-530700                                             @ZA02244 01124800
*                                                                       01124900
*                                                                       01125000
*                                                                M2688  01126020
*                                                                TS1628 01128020
*                                                                M0030  01130020
*                                                                 M3660 01131020
*                                                                 M6361 01131520
*          RELEASE 21 DELETIONS                                       * 01148020
*1332137210,311000,335000,339600,412320,453000-453200,455100,    S22028 01148100
*1332455400,455600,456600,530080,530380,684000,747000            S22028 01148200
*1332                                                            A45625 01148521
*1332139370-139400                                               A43888 01149021
*1332535000-542000,548500-600000,663080-663920                   S21008 01150021
*                                                                 M2673 01152020
*                                                               SA59536 01152500
*          VS2-3.0 CHANGES                                              01153000
*D003000,682000,751727,751883                                   ZA01370 01153500
*C008100,751922,677500                                          ZA01370 01154000
*A677100-677484                                                 ZA01370 01154500
*A279612                                                        ZA02167 01155000
*C279640                                                        ZA02167 01155500
*                                                                     * 01156020
**************************************************************  ZA25074 01156500
* MODULE NAME = IEDAYII   (QTIP,TSO)                            ZA25074 01157000
*                                                               ZA25074 01157500
* DESCRIPTIVE NAME = TSINPUT ROUTINE IN QTIP SVC                ZA25074 01158000
*                                                               ZA25074 01158500
* COPYRIGHT = NONE                                              ZA25074 01159000
*                                                               ZA25074 01159500
* STATUS = TCAM VERSION 10.0                                    ZA25074 01160000
*                                                                     * 01172020
* FUNCTION -                                                          * 01180020
*    THIS ROUTINE PROVIDES AN INTERFACE FOR TSINPUT (IEDAYI) BETWEEN  * 01188020
*    THE TCAM AND TSO REGIONS.                                        * 01196020
*                                                                     * 01204020
* ENTRY POINTS -                                                      * 01212020
*    QTIP0050,QTIP0060,QTIP0070,QTIP0080,QTIP0090, AND QTIP0280.      * 01220020
*                                                                     * 01228020
* INPUT -                                                             * 01236020
*    REFER TO THE PREFACE OF THE APPLICABLE ENTRY POINT.              * 01244020
*                                                                     * 01252020
* OUTPUT -                                                            * 01260020
*    FOR QTIP ENTRY CODE 9, REGISTER 15 WILL CONTAIN A RETURN CODE IN * 01268020
*    THE HI ORDER BYTE INDICATING WEITHER OR NOT SUFFICIENT TS        * 01276020
*    BUFFERS WERE AVAILABLE TO PROCESS THE TS MESSAGE.  THE LOW ORDER * 01284020
*    3 BYTES WILL CONTAIN THE ADDRESS OF THE LAST TS HEADER BUFFER ON * 01292020
*    THE INPUT HEADER QUEUE.  THE RETURN CODES ARE AS FOLLOWS.        * 01300020
*        00 - SUFFICIENT TS BUFFERS WERE AVAILABLE.                   * 01308020
*        04 - NO TS BUFFERS WERE AVAILABLE.                           * 01316020
*                                                                     * 01324020
* EXTERNAL REFERENCES -                                               * 01332020
*    THIS ROUTINE CALLS THE TIME SHARING INTERFACE PROGRAM (TSIP)     * 01340020
*    WITH AN ENTRY CODE OF 4, VIA A BRANCH AND LINK, TO BRING THE     * 01348020
*    USER INTO CORE FOLLOWING THE REMOVAL OF AN IWAIT CONDITION.      * 01356020
*                                                                     * 01364020
* EXITS, NORMAL -                                                     * 01372020
*    RETURN IS ALWAYS TO TSINPUT (IEDAYI) VIA A BRANCH ON REGISTER 14.* 01380020
*                                                                     * 01388020
* EXITS, ERROR -                                                      * 01396020
*    NONE                                                             * 01404020
*                                                                     * 01412020
* TABLES/WORK AREAS -                                                 * 01420020
*    NONE                                                             * 01428020
*                                                                     * 01436020
* ATTRIBUTES -                                                        * 01444020
*    SERIALLY-REUSABLE,REFRESHABLE,DISABLED                           * 01452020
*                                                                     * 01460020
* CHARACTER CODE DEPENDENCY -                                         * 01468020
*    THIS ROUTINE IS DEPENDENT ON THE FOLLOWING EBCDIC CHARACTERS.    * 01476020
*        X'0D' - EBCDIC CARRIAGE RETURN CHARACTER.  EQUATED TO        * 01484020
*        'CARRTRN' WITHIN THIS ROUTINE.                               * 01492020
*                                                                     * 01500020
*        X'15' - EBCDIC NEW LINE CHARACTER.  EQUATED TO 'NEWLINE'     * 01508020
*        WITHIN THIS ROUTINE.                                         * 01516020
*                                                                     * 01524020
* NOTES -                                                             * 01532020
*    EACH ENTRY POINT INTO THIS ROUTINE IS PREFACED WITH DESCRIPTION  * 01540020
*    WHICH DEFINES THE FUNCTION AND INPUT PARAMETERS OF THE ASSOCI-   * 01548020
*    ATED ENTRY.                                                      * 01556020
*                                                                     * 01564020
*********************************************************************** 01572020
         EJECT                                                          01580020
*********************************************************************** 01605020
********                                                       ******** 01610020
******** ENTRY POINTS                                          ******** 01615020
********                                                       ******** 01620020
*********************************************************************** 01625020
         SPACE 1                                                        01630020
         ENTRY QTIP0050,QTIP0060,QTIP0070,QTIP0080,QTIP0090             01650020
         ENTRY QTIP0280                                                 01660020
         SPACE 3                                                        01670020
*********************************************************************** 01700020
********                                                       ******** 01800020
******** REGISTER EQUATES                                      ******** 01900020
********                                                       ******** 02000020
*********************************************************************** 02100020
         SPACE 1                                                        02200020
R0       EQU   0                        INDEX REGISTER                  02300020
RMVSZ1   EQU   R0                       SIZE OF DATA IN THE BASIC UNIT  02400020
RMVSZ2   EQU   1                        UNFILLED SPACE SIZE IN TS BFR   02600020
RWRK1    EQU   RMVSZ2                   WORK/PARAMETER REGISTER         02800020
RWK1     EQU   1                        WORK REG               @ZA03667 02850000
RSCANF   EQU   2                        POINTER TO BEGIN OF DATA SCANED 02900020
RWRK2    EQU   RSCANF                   WORK/PARAMETER REGISTER         03000020
RSCANL   EQU   3                        POINTER TO END OF DATA SCANNED  03100020
RWRK3    EQU   RSCANL                   WORK/PARAMETER REGISTER         03200020
RWRK4    EQU   4                        WORK/PARAMETER REGISTER         03300020
RLCB     EQU   RWRK4                    LCB ADDRESS                     03350020
RTSBFR   EQU   5                        TIME SHARING BUFFER ADDRESS     03400020
RTCBFR   EQU   6                        TCAM BUFFER ADDRESS             03700020
RQCB     EQU   7                        DESTINATION QCB ADDRESS         03900020
RFILL    EQU   RQCB                     ADDR OF BEGIN FILL IN TS BFR    04000020
RWRK7    EQU   RFILL                    WORK/PARAMETER REGISTER         04100020
RDSZE    EQU   8                        SIZE OF DATA IN BUFFER          04200020
RWRK8    EQU   RDSZE                    WORK/PARAMETER REGISTER         04300020
RTSB     EQU   9                        TSB ADDRESS                     04400020
RTIOC    EQU   10                       TIOCRPT ADDRESS                 04500020
RWK11    EQU   11                       WORK/PARAMETER REGISTER         04600020
RBASE    EQU   12                       BASE REGISTER                   04700020
RAVT     EQU   13                       ADDRESS OF AVTSAVE2             04800020
RETRN    EQU   14                       RETURN ADDRESS                  05000020
RNTRY    EQU   15                       ENTRY POINT                     05200020
RTRNCD   EQU   RNTRY                    RETURN CODE TO TSINPUT          05300020
RWK15    EQU   RTRNCD                   WORK/PARAMETER REGISTER         05400020
         EJECT                                                          05500020
*********************************************************************** 05600020
********                                                       ******** 05700020
******** MASKS AND DISPLACEMENTS                               ******** 05800020
********                                                       ******** 05900020
*********************************************************************** 06000020
         SPACE 1                                                        06100020
K0       EQU   0                        NULL DISPLACEMENT               06200020
K1       EQU   1                        CONSTANT 1                      06300020
CC3270ND EQU   1                        3270 AID CONTROL CHAR    S22028 06310000
*                                       LENGTH                   S22028 06320000
K2       EQU   2                        LENGTH FIELD                    06330020
K3       EQU   3                        LENGTH FIELD                    06360020
CC3270R  EQU   3                        LENGTH OF EXTRA CONTROL  S22028 06368000
*                                       CONCHARACTERS FOR 3270 REMOTE   06376000
CC3270D3 EQU   3                        CONTROL CHAR LNG FOR     S22028 06384000
*                                       3270                     S22028 06392000
K4       EQU   4                        LENGTH FIELD                    06400020
CC3270D6 EQU   6                        MAXIMUM NO. OF CONTROL   S22028 06410000
*                                       CHARACTERS FOR 3270             06420000
ADDR     EQU   7                        ADDRESS MASK            ZA25074 06430000
ZEROS    EQU   8                        MASK FOR A CONDITION CODE OF 8  06460020
K8       EQU   8                        LENGTH FIELD                    06500020
K12      EQU   12                       LENGTH FIELD                    06600020
K16      EQU   16                       LENGTH FIELD                    06700020
K44      EQU   44                       OFFSET OF 4-WORD SAVE   YS02019 06740000
*                                       AREA IN AVTSAVE2                06780000
K60      EQU   60                       LENGTH FIELD            YS02019 06820000
K64      EQU   64                       LENGTH FIELD            YS02019 06860000
LCBDELAY EQU   X'02'                    LCB IS ON THE DELAY QUEUE       06900020
CARRRTRN EQU   X'0D'                    CARRIAGE RETURN CHARACTER       07110020
SBA      EQU   X'11'                    SBA CHARACTER            S22028 07120000
WAITQBFR EQU   X'10'                    USED TO INDICATE TCAM BFR HAS   07130020
*                                       BEEN ON TCAM BFR WAIT QUEUE     07160020
NEWLINE  EQU   X'15'                    NEW LINE CHARACTER              07190020
NOTMOVED EQU   X'20'                    IND NOT ALL OF SCANNED DATA IN  07210020
*                                       TCAM BFR WAS MOVED TO TS BFR(S) 07230020
TIMEOUT  EQU   X'40'                    TIME OUT OCCURED IN THIS BFR    07260020
WRITEBRK EQU   X'80'                    WRITE BREAK IN PROGRESS         07300020
CC32706  EQU   X'08'                    MORE THAN 1 3270 CONTROL S22028 07330000
*                                       CHARACTER IN BUFFER             07360000
OFF      EQU   X'FF'                    USED TO TURN OFF BITS           07400020
CLRSCREN EQU   X'FF'                    USED TO IND DISPLAY SCREEN MUST 07430020
*                                       BE CLEARED BEFORE CONTINUING    07460020
         EJECT                                                          07500020
*********************************************************************** 07600020
********                                                       ******** 07700020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 07800020
******** TERMINATE TCLEARQ PROCESSING.  THE ENTRY POINT INTO   ******** 07900020
******** THIS CODE IS QTIP0050.                                ******** 08000020
********                                                       ******** 08200020
******** INPUT REGISTERS -                                     ******** 08300020
********                                                       ******** 08400020
********       REG 9 - ADDRESS OF THE CURRENT TSB.             ******** 08500020
********                                                       ******** 08600020
*********************************************************************** 08700020
QTIP0050 EQU   *                                                        08800020
         USING *,RBASE                  ESTABLISH ADDRESSABILITY        08900020
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   09000020
         NI    TSBFLG1,OFF-TSBIFLSH     TERMINATE TCLEARQ PROCESSING    09060020
         NI    TSBFLG2,OFF-TSBBIPI      TERMINATE BREAK-IN PROCESSING   09200020
         NI    TSBFLG3,OFF-TSBSPIT      PROMPTING OK NOW         YM2814 09250000
         BR    RETRN                    RETURN TO CALLER                09300020
         DROP  RTSB                     DROP CONTROL BLOCK BASE REGS    09400020
         EJECT                                                          10400020
*********************************************************************** 12300020
********                                                       ******** 12400020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 12500020
******** REMOVE THE SYSTEM FROM AN LWAIT CONDITION AND CHECK   ******** 12540020
******** THE LINE STATUS OF EACH TERMINAL WHOSE KEYBOARD WAS   ******** 12580020
******** LOCKED TO INPUT DUE TO THE SYSTEM LWAIT CONDITION.    ******** 12620020
******** IF IT IS NECESSARY TO ACTIVATE THE TERMINAL, THE LINE ******** 12660020
******** WILL BE TPOSTED TO ITSELF.  THE ENTRY POINT INTO THIS ******** 12700020
******** CODE IS QTIP0060.                                     ******** 12740020
********                                                       ******** 12800020
******** INPUT REGISTERS -                                     ******** 12900020
********                                                       ******** 13000020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 13100020
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 13150020
********                                                       ******** 13200020
*********************************************************************** 13300020
QTIP0060 EQU   *                                                        13400020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   13600020
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REGISTER   13650020
         ST    RETRN,AVTSAVE2+K60       SAVE RETURN ADDRESS     YS02019 13670000
         NI    TIOCFLG,OFF-TIOCSYLW     REMOVE SYSTEM FROM LWAIT        13700020
         LH    RWK11,TIOCNTSB           GET CURRENT NO. OF TS  @ZA10588 13703000
*                                       USERS                   YS02019 13706000
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   13727020
         L     RTSB,TIOCTSB-K1          GET ADDR OF FIRST TSB IN TABLE  13730020
         SR    RWRK8,RWRK8              CLEAR REGISTER                  13733020
         IC    RWRK8,TIOCTSBS           GET SIZE OF A TSB               13736020
         SPACE 2                                                        13739020
********                                                                13742020
******** CHECK EVERY TSB IN USE TO DETERMINE IF THE ASSOCIATED TERMINAL 13745020
******** KEYBOARD WAS LOCKED TO INPUT DUE TO THE SYSTEM LWAIT           13748020
******** CONDITION.  IF THE ASSOCIATED TERMINAL IS NOT ALSO IN A USER   13751020
******** LWAIT CONDITION, UNLOCK THE TERMINAL KEYBOARD TO ALLOW ANOTHER 13754020
******** READ TO BE ISSUED.  OTHERWISE, LEAVE THE KEYBOARD LOCKED.      13757020
********                                                                13760020
TSIN6000 EQU   *                                                        13763020
         LTR   RWK11,RWK11              ARE ANY USERS LEFT       A43888 13764021
         BNZ   TSIN6010                 YES, CONTINUE CHECKING  YS02019 13764500
         L     RETRN,AVTSAVE2+K60       GET RETURN ADDRESS      YS02019 13765000
         BR    RETRN                    RETURN TO CALLER        YS02019 13765200
         SPACE 1                                                        13765400
TSIN6010 EQU   *                                                YS02019 13765600
         BCTR  RWK11,R0                 DECR COUNT OF TSBS     @ZA10588 13766000
*                                       LEFT TO SCAN           @ZA10588 13767000
         TM    TSBSTAT,TSBINUSE         IS THIS TSB IN USE              13769000
         BZ    TSIN6070                 BRANCH IF NOT TO GET NEXT TSB   13772000
         TM    TSBSTAT,TSBLWAIT         IS THE TERMINAL IN A USER LWAIT 13775020
         BO    TSIN6070                 BRANCH IF YES TO GET NEXT TSB   13778020
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   13781020
         LH    RWRK1,TSBASRCE           GET INDEX TO TNT        YS02019 13782000
         LTR   RWRK1,RWRK1              IS TNT INDEX ZERO?     @ZA11600 13784000
         BZ    TSIN6070                 YES,GO GET NEXT TSB    @ZA11600 13784300
         L     RNTRY,AVTRNMPT           GET TNT CODE ENTRY ADDR YS02019 13784600
         BALR  RETRN,RNTRY              GO TO TNT CODE          YS02019 13784900
         USING IEDQTRM,RWRK1            TRM ADDRESSABILITY      YS02019 13785200
         L     RQCB,TRMDESTQ-K1         GET QCB ADDRESS         YS02019 13785500
         DROP  RWRK1                    TRM NOT ADDRESSABLE     YS02019 13785800
         TM    QCBFLAG,QCBTSSES         IS A TSO SESSION IN PROGRESS    13787020
         BZ    TSIN6070                 BRANCH IF NOT TO GET NEXT TSB   13790020
         NI    QCBTSOF1,OFF-QCBNOBUF    UNLOCK THE TERMINAL KEYBOARD    13793020
         SPACE 2                                                        13796020
********                                                                13799020
******** POST THE LINE, IF NECESSARY, TO ACTIVATE THE TERMINAL.         13802020
********                                                                13805020
         USING IHADCB,RWRK3             USE RWRK3 AS DCB BASE REGISTER  13805100
         ICM   RWRK3,ADDR,QCBDCBAD      GET DCB ADDRESS         ZA25074 13805200
         LA    RWRK2,IEDQQCB-IEDNQCB    BACK UP TO QCB PREFIX    Y06327 13805300
         SR    RQCB,RWRK2               ADJUST POINTER           Y06327 13805400
         DROP  RQCB                     ADJUST FUTURE REFERENCES Y06327 13805500
         USING IEDNQCB,RQCB             COND ASSEMBLY WILL ADJS  Y06327 13805600
         TM    DCBDSORG,TRMLGB          IS THIS 3705             Y06327 13805700
         BNO   TSIN6011                 BRANCH IF NO             Y06327 13805800
         TM    QCBSTAT1,QCBPLCBN        IS A PLCB ASSIGNED      ZA25074 13805900
         BO    TSIN6070                 YES, DON'T POST QCB     ZA25074 13806000
         TM    QCBTSOF1,QCBDELAY        IS QCB ON THE TIME      ZA25074 13806100
*                                       DELAY QUEUE             ZA25074 13806200
         BO    TSIN6070                 YES, DON'T POST QCB     ZA25074 13806300
         TM    QCBTSOF2,QCBPOSTO        HAS QCB ALREADY BEEN    ZA25074 13806400
*                                       POSTED                  ZA25074 13806500
         BO    TSIN6070                 YES, DON'T POST QCB     ZA25074 13806600
         B     TSIN6030                 GO SEE IF POST REQ'D    ZA25074 13806700
         L     RLCB,QCBPLCBA-K1         FOR 3705, USE PLCB       Y06327 13806800
         B     TSIN6020                 CONTINUE PROCESS         Y06327 13806900
         SPACE 1                                                        13807000
TSIN6011 EQU   *                                                 Y06327 13807100
         L     RLCB,DCBIOBAD            GET IOB ADDRESS                 13807200
         LA    RWRK2,LCBFLAG1-IEDQLCB   GET OFFSET OF IOB FROM LCB      13807300
         SR    RLCB,RWRK2               POINT TO BEGINNING OF FIRST LCB 13807400
         SR    RWRK2,RWRK2              CLEAR REGISTER                  13807500
         IC    RWRK2,DCBEIOBX           GET SIZE OF AN LCB ENTRY        13807600
         DROP  RWRK3                    DROP RWRK3 AS DCB BASE REGISTER 13807700
         SR    RWRK3,RWRK3              CLEAR REGISTER                  13832020
         IC    RWRK3,QCBRELLN           RELATIVE POSITION OF LCB IN TBL 13835020
         MR    RWRK2,RWRK2              CALC OFFSET OF LCB IN TABLE     13838020
         AR    RLCB,RWRK3               ADDRESS OF THE DESIRED LCB      13841020
         ICM   RWRK3,ADDR,QCBDCBAD      GET DCB ADDRESS         ZA25074 13842000
         USING IHADCB,RWRK3             DCB ADDRESSABILITY      ZA25074 13843000
         USING IEDQLCB,RLCB             USE RLCB AS LCB BASE REGISTER   13844020
         SPACE 1                                                        13845000
TSIN6020 EQU   *                                                 Y06327 13846000
         TM    LCBINSRC+K2,LCBDELAY     IS LCB ON THE DELAY QUEUE       13847020
         BO    TSIN6070                 BRANCH IF YES TO GET NEXT TSB   13850020
         CLI   LCBSTAT1,LCBFREEN        IS THIS LINE FREE               13853020
         BE    TSIN6030                 BRANCH IF YES                   13856020
         NI    LCBTSOB,OFF-LCBSOPL      REMOVE LCB FROM POLLING LIST    13859020
         B     TSIN6070                 BRANCH TO GET NEXT TSB          13862020
         SPACE 1                                                        13865020
TSIN6030 EQU   *                                                        13868020
         TM    QCBTSOF1,QCBPARTO        ANY OUTPUT IN PROGRESS          13871020
         BO    TSIN6070                 BRANCH IF YES TO GET NEXT TSB   13874020
         TM    QCBFLAG,QCBNOBRK         DOES TERM HAVE REVERSE BREAK    13877020
         BZ    TSIN6050                 BRANCH IF YES                   13880020
         TM    QCBFLAG,QCBREAD          DOES READ HAVE PRIORITY         13883020
         BO    TSIN6050                 BRANCH IF YES                   13886020
         TM    QCBTSOF1,QCBTGET         HAS TGET BEEN REQUESTED         13889020
         BZ    TSIN6070                 BRANCH IF NOT TO GET NEXT TSB   13892020
         SPACE 1                                                        13895020
TSIN6050 EQU   *                                                        13898020
         TM    DCBDSORG,TRMLGB          TERM ATTACHED VIA NCP   ZA25074 13898100
         BZ    TSIN6051                 NO, GO POST PLCB        ZA25074 13898200
**************************************************************  ZA25074 13898300
*        FOR NCP ATTACHED TERMINALS,QCB IS POSTED TO ITSELF TO  ZA25074 13898400
*        REMOVE LOCK.                                           ZA25074 13898500
**************************************************************  ZA25074 13898600
         LA    RQCB,QCBPRFSZ(RQCB)      POINT TO QCB            ZA25074 13898700
         DROP  RQCB                                             ZA25074 13898800
         USING IEDQQCB,RQCB             QCB ADDRESSABILITY      ZA25074 13898900
         STCM  RQCB,ADDR,QCBELCHN       QCB TO POSTED           ZA25074 13899000
         MVC   QCBLINK,AVTDOUBL+K1      CHAIN ELEMENTS TO BE    ZA25074 13899100
*                                       POSTED                  ZA25074 13899200
         ST    RQCB,AVTDOUBL            PUT QCB ON CHAIN        ZA25074 13899300
         MVI   QCBPRI,PRILNFRE          SET POST PRIORITY       ZA25074 13899400
         B     TSIN6070                 PROCESS NEXT TSB        ZA25074 13899500
         DROP RWRK3                                             ZA25074 13899600
TSIN6051 EQU   *                                                ZA25074 13899700
         MVI   LCBSTAT1,LCBSENDN        INDICATE LINE IS SENDING        13901020
         ST    RLCB,LCBQCBA-K1          TPOST THE LINE TO ITSELF        13904020
         MVC   LCBLINK,AVTDOUBL+K1      CHAIN LCB TO FIRST ELEMENT ON   13907020
*                                       THE RETURN QUEUE                13910020
         ST    RLCB,AVTDOUBL            PLACE THIS LCB ON RETURN QUEUE  13913020
         MVI   LCBPRI,PRILNFRE          PRIORITY TO FREE A LINE         13916020
         SPACE 2                                                        13919020
********                                                                13922020
******** IF THERE ARE ANY MORE TSB'S WHICH ARE IN USE CONTINUE          13925020
******** SCANNING, OTHERWISE RETURN TO TSINPUT.                         13928020
********                                                                13931020
TSIN6070 EQU   *                                                        13934020
         AR    RTSB,RWRK8               POINT TO NEXT TSB IN THE TABLE  13943020
         B     TSIN6000                 BRANCH TO CONTINUE SCAN         13946020
         DROP  RLCB,RQCB,RTSB,RTIOC,RAVT  DROP CONTROL BLOCK BASE REGS  13949020
         EJECT                                                          14000020
*********************************************************************** 14100020
********                                                       ******** 14200020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 14300020
******** PUT THE SYSTEM IN AN LWAIT CONDITION.  THE ENTRY      ******** 14400020
******** POINT INTO THIS CODE IS QTIP0070.                     ******** 14500020
********                                                       ******** 14800020
******** INPUT REGISTERS -                                     ******** 14900020
********                                                       ******** 15000020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 15250020
********                                                       ******** 15300020
*********************************************************************** 15400020
QTIP0070 EQU   *                                                        15500020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   15840020
         OI    TIOCFLG,TIOCSYLW         PLACE THE SYSTEM IN LWAIT       16180020
         BR    RETRN                    RETURN TO TSINPUT               16200020
         DROP  RTIOC                    DROP CONTROL BLOCK BASE REGS    16300020
         EJECT                                                          16400020
*********************************************************************** 16500020
********                                                       ******** 16600020
******** THE FOLLOWING SECTION OF CODE IS USED BY CHARACTER    ******** 16700020
******** LINE DELETE AND CANCEL MESSAGE ROUTINES WITHIN        ******** 16800020
******** TSINPUT TO REMOVE TIME SHARING BUFFERS FROM THE INPUT ******** 16900020
******** QUEUE AND RETURN THEM TO THE FREE QUEUE.  THE ENTRY   ******** 17000020
******** POINT INTO THIS CODE IS QTIP0080.                     ******** 17100020
********                                                       ******** 17200020
******** INPUT REGISTERS -                                     ******** 17300020
********                                                       ******** 17400020
********       REG 6 -  ADDR OF TCAM BFR CURRENTLY PROCESSING. ******** 17500020
********       REG 9 -  ADDR OF THE CURRENT TSB.               ******** 17600020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 17700020
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 17800020
********                                                       ******** 17900020
*********************************************************************** 18000020
QTIP0080 EQU   *                                                        18100020
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 18300020
         USING TSB,RTSB                 USE RTSB AS TSB BASE REG        18400020
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REG        18500020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   18600020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   18700020
         SPACE 2                                                        18900020
********                                                                19000020
******** IF CANCEL MESSAGE IS IN PROGRESS, SEARCH FOR THE BEGINNING OF  19100020
******** THE FRAGMENT MESSAGE ON THE INPUT QUEUE.  IF CHARACTER LINE    19200020
******** DELETE HAS OCCURED, SEARCH FOR THE LAST BUFFER (WHICH WILL BE  19300020
******** A PARTIAL LINE) ON THE INPUT QUEUE.                            19400020
********                                                                19500020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  19550020
         BE    TSIN0800                 BRANCH IF NONE                  19600020
         L     RTSBFR,TSBIBFP-K1        GET FIRST TS BFR ON INPUT QUEUE 19660020
         LR    RWRK4,RTSBFR             SAVE ADDR OF CURRENT HDR BFR    19700020
         SPACE 1                                                        19800020
TSIN0620 EQU   *                                                        19900020
         TM    BUFFFL2,BUFFFRAG         IS THIS TS BFR PART OF FRAG MSG 20000020
         BZ    TSIN0640                 BRANCH IF NOT                   20100020
         TM    PRFSTAT1,PRFCNCLN        IS CANCEL MESSAGE IN PROGRESS   20200020
         BO    TSIN0660                 BRANCH IF YES                   20300020
         SPACE 1                                                        20400020
TSIN0640 EQU   *                                                        20500020
         CLC   BUFFHEAD,AVTFZERO        MORE HDR BFRS ON INPUT QUEUE    20600020
         BE    TSIN0650                 BRANCH IF NO MORE               20700020
         LR    RWRK4,RTSBFR             SAVE ADDR OF CURRENT HDR BFR    20800020
         L     RTSBFR,BUFFHEAD-K1       GET ADDR OF NEXT HDR BFR ON Q   20900020
         B     TSIN0620                 CONTINUE SEARCH                 21000020
         SPACE 1                                                        21020020
TSIN0650 EQU   *                                                        21040020
         TM    BUFFFL1,BUFFNLCR         IS LAST TS MSG COMPLETE         21060020
         BO    TSIN0800                 BRANCH IF YES                   21080020
         NI    BUFFFL1,BUFFHDR+BUFFIHOT RESET FLAG BYTE         ZA12528 21080300
         NI    BUFFFL2,BUFFFRAG         RESET SECOND FLAG BYTE          21081220
         XC    BUFFLNTH,BUFFLNTH        RESET AMOUNT OF DATA TO ZERO    21082020
         XC    BUFFWORK,BUFFWORK        RESET CHAR COUNT TO ZERO        21122020
         L     RWRK2,BUFFTRLR-K1 GET NEXT TRAILER               ZA12528 21132000
         LA    RWRK2,K0(,RWRK2)  CLEAR HI BYTE                  ZA12528 21142000
         LTR   RWRK2,RWRK2       ANY MORE TRAILERS?             ZA12528 21163000
         BZ    TSIN0800                 BRANCH IF NONE                  21403020
         XC    BUFFTRLR,BUFFTRLR        CLEAR TRAILER BUFFER POINTER    21483020
         DROP  RTSBFR          DROP TS BFR BASE                 ZA12528 21503000
TSIN0655 EQU   *                                               @ZA12528 21523000
         USING TIOCBUF,RWRK2   NEW TS BFR BASE                  ZA12528 21563000
         L     RTSBFR,BUFFTRLR-K1 GET NEXT TRAILER              ZA12528 21583000
         LA    RTSBFR,K0(,RTSBFR) CLEAR HI BYTE                 ZA12528 21643000
         BAL   RWRK4,TSIN0760     GO FREE BFR                   ZA12528 21663000
         LTR   RWRK2,RTSBFR       GET NEXT BFR                  ZA12528 21683000
         BZ    TSIN0800           IF NO BFR, DONE               ZA12528 21723000
         B     TSIN0655           HANDLE NEXT BFR               ZA12528 21743000
         SPACE 1                                                        21883020
TSIN0660 EQU   *                                                        21963020
         USING TIOCBUF,RWRK4            USE RWRK4 AS TS BFR BASE REG    22043020
         CR    RTSBFR,RWRK4             IS FIRST BFR TO BE DROPPED ALSO 22123020
*                                       FIRST ON INPUT QUEUE            22203020
         BNE   TSIN0670                 BRANCH IF NO                    22363020
         XC    TSBIBFP,TSBIBFP          CLEAR INPUT QUEUE POINTER       22443020
         B     TSIN0680                 BRANCH TO RETURN BUFFERS        22523020
         SPACE 1                                                        22603020
TSIN0670 EQU   *                                                        22683020
         XC    BUFFHEAD,BUFFHEAD        ZERO LINK FIELD OF PREVIOUS HDR 22763020
         DROP  RWRK4                    DROP RWRK4 AS TS BFR BASE REG   22843020
         SPACE 2                                                        22923020
********                                                                23003020
******** DETERMINE HOW MANY TS BUFFERS ARE TO BE RETURNED AND LINK THEM 23083020
******** TOGETHER FOR PLACEMENT ON THE FREE QUEUE.  IF AUTOMATIC LINE   23163020
******** NUMBERING IS IN PROGRESS, DECREMENT THE LINE COUNT FOR EACH    23243020
******** TS HEADER BUFFER RETURNED.                                     23323020
********                                                                23403020
TSIN0680 EQU   *                                                        23483020
         LR    RWK11,RTSBFR             INITIALIZE NEXT HDR BFR POINTER 23643020
         SPACE 1                                                        24043020
TSIN0700 EQU   *                                                        24123020
         LA    RWRK2,K0(,RWK11)   GET HEADER BFR TO FREE        ZA12528 24143000
         LTR   RWRK2,RWRK2        IS THERE A HEADER BFR?        ZA12528 24163000
         BZ    TSIN0800           NO, DONE                      ZA12528 24203000
         L     RTSBFR,BUFFTRLR-K1 SAVE NEXT TRAILER PTR         ZA12528 24283000
         LA    RTSBFR,K0(,RTSBFR) CLEAR HI BYTE                 ZA12528 24363000
         SPACE 1                                                        24603020
TSIN0720 EQU   *                                                        24683020
         TM    TSBFLG2,TSBAUTON+TSBAULST  IS AUTO LINE NO. IN PROGRESS  24763020
         BNO   TSIN0740                 BRANCH IF NO                    24843020
         TM    BUFFFL1,BUFFNLCR         IS THE LAST TS MSG COMPLETE     25083020
         BZ    TSIN0740                 BRANCH IF NOT                   25163020
         L     RWK15,TSBAUTOS           GET CURRENT VALUE OF LINE NO.   25243020
         S     RWK15,TSBAUTOI           DECR LINE NO. BY INCR VALUE     25323020
         ST    RWK15,TSBAUTOS           UPDATE LINE NUMBER              25403020
         SPACE 1                                                        25483020
TSIN0740 EQU   *                                                        25563020
         L     RWK11,BUFFHEAD-K1  GET NEXT HEADER               ZA12528 25583000
TSIN0750 EQU   *                                               @ZA12528 25603000
         BAL   RWRK4,TSIN0760     GO FREE BFR THATS IN RWRK2    ZA12528 25643000
         LTR   RWRK2,RTSBFR       ANY MORE BUFFERS?             ZA12528 25723000
         BZ    TSIN0700           NO, CHECK NEXT HEADER         ZA12528 25803000
         L     RTSBFR,BUFFTRLR-K1 GET NEXT TRAILER              ZA12528 25883000
         LA    RTSBFR,K0(,RTSBFR) CLEAR HI BYTE                 ZA12528 25963000
         B     TSIN0750           LOOP BACK TO FREE NEXT        ZA12528 26043000
         SPACE 2                                                        26283020
********                                                                26363020
******           BUFFER FREE ROUTINE                            ZA12528 26383000
******  ALWAYS BAL OR BRANCH WITH RETURN ADDRESS IN RWRK4       ZA12528 26403000
******  AND BUFFER TO BE FREED IN RWRK2.                        ZA12528 26443000
******                                                          ZA12528 26523000
********                                                                26683020
TSIN0760 EQU   *                                                        26763020
         SR    RWK15,RWK15      CLEAR REG                       ZA12528 26803000
         IC    RWK15,TSBNIBF    GET INPUT BFR COUNT             ZA12528 26843000
         BCTR  RWK15,K0         DECREMINT COUNT                 ZA12528 26923000
         STC   RWK15,TSBNIBF    STORE UPDATED COUNT             ZA12528 26953000
         TM    BUFFFL1,BUFFIHOT BUFFER ON BOTH QUEUES?          ZA12528 27023000
         BZ    TSIN0770         NO, RETURN BFR TO FREE Q        ZA12528 27123000
         NI    BUFFFL1,OFF-BUFFIHOT YES, TURN OF FLAG           ZA12528 27223000
         BR    RWRK4            RETURN, BFR FREED LATER         ZA12528 27253000
TSIN0770 EQU   *                                                ZA12528 27323000
         L     RNTRY,QBRADDR            GET BFR RETURN RTN EPA  YS02019 27373000
         BALR  R0,RNTRY                 GO TO BFR RETURN RTN    YS02019 27423000
         BR    RWRK4           RETURN                           ZA12528 27473000
         DROP  RWRK2                                            ZA12528 27523000
         SPACE 2                                                        27902020
********                                                                27904020
******** IF ENTRY INTO THIS ROUTINE WAS TO CANCEL A TCAM MESSAGE,       27906020
******** RETURN TO THE CALLER AT THIS TIME.                             27908020
********                                                                27912020
TSIN0800 EQU   *                                                        27920020
         TM    PRFSTAT1,PRFCNCLN        IS CANCEL MESSAGE IN PROGRESS   27930020
         BZ    TSIN0900                 BRANCH IF NOT                   27933020
         NI    TSBFLG2,OFF-TSBBIPI-TSBBRKIN  TERM BREAKIN PROCESSING    27939020
         BR    RETRN                    RETURN TO TSINPUT               27942020
         SPACE 2                                                        27949620
********                                                                27950420
******** IF THIS IS THE LAST TCAM BUFFER OF THE MESSAGE AND NO DATA     27951220
******** REMAINS TO BE SCANNED, OR IF THE NEXT CHARACTER IN THE TCAM    27952020
******** BUFFER IS A NEW LINE OR CARRIAGE RETURN CHARACTER, BRANCH TO   27952820
******** COMPLETE THE TCAM AND/OR TS MESSAGE.  OTHERWISE, RETURN TO     27953620
******** TSINPUT.                                                       27954420
********                                                                27955220
TSIN0900 EQU   *                                                        27959220
         L     RSCANF,AVTSAVE2          GET @ OF TCAM DATA      ZA02167 27960200
         CLR   RSCANL,RSCANF            CR OR NL CHAR NEXT IN   ZA02167 27961200
*                                       TCAM BFR ?              ZA02167 27964000
         BNE   TSIN0170                 BRANCH IF YES                   27972020
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    27980020
         BCR   ZEROS,RETRN              RETURN TO TSINPUT IF NOT        27990020
         LTR   RDSZE,RDSZE              ANY DATA LEFT TO SCAN           28000020
         BZ    TSIN0170                 BR IF NONE TO EOM PROCESSING    28009020
         BR    RETRN                    RETURN TO TSINPUT               28018020
         DROP  RTCBFR,RTSB,RTIOC,RAVT                           ZA12528 28023000
         EJECT                                                          28038020
*********************************************************************** 28300020
********                                                       ******** 28400020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 28500020
******** ALLOCATE TS BUFFERS AND MOVE THE SCANED DATA IN THE   ******** 28600020
******** TCAM BUFFER INTO TS BUFFER(S), AND/OR PERFORM END OF  ******** 28700020
******** TRANSMISSION PROCESSING WHENEVER APPLICABLE.  THE     ******** 28800020
******** ENTRY POINT INTO THIS CODE IS QTIP0090.               ******** 28900020
********                                                       ******** 29000020
******** INPUT REGISTERS -                                     ******** 29100020
********                                                       ******** 29200020
********       REG 2 -  POINTER TO BEGINNING OF DATA SCANNED.  ******** 29260020
********       REG 3 -  POINTER TO END OF DATA SCANNED.        ******** 29320020
********       REG 6 -  ADDR OF TCAM BFR CURRENTLY PROCESSING. ******** 29400020
********       REG 9 -  ADDRESS OF THE CURRENT TSB.            ******** 29500020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 29600020
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 29700020
********                                                       ******** 29800020
*********************************************************************** 29900020
QTIP0090 EQU   *                                                        30000020
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REGISTER   30200020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   30300020
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   30400020
         USING IEDQPRF,RTCBFR           TCAM BFR ADDRESSABLE    YS02019 30403000
         SPACE 3                                                 A45625 30407021
********                                                                30414021
******** CHECK FOR TCLEARQ INPUT ISSUED, IF SO, RETURN TO TSINPUT       30421021
********                                                                30428021
         TM    TSBFLG1,TSBIFLSH         IS INPUT FLUSH IN        A45625 30435021
*                                       PROGRESS                 A45625 30442021
         BZ    TSIN0150                 NO, CHECK SIZE OF DATA   A45625 30449021
         NI    TSBFLG1,OFF-TSBIFLSH     TURN OFF INPUT FLUSH     A45625 30456021
*                                       FLAG                     A45625 30463021
         NI    TSBFLG2,OFF-(TSBBIPI+TSBBRKIN) TURN OFF BREAKIN-  A45625 30470021
*                                       FLASHBACK FLAGS                 30477021
         XC    PRFSIZE,PRFSIZE          SET DATA SIZE TO ZERO   YS02019 30479000
         SR    RTRNCD,RTRNCD            ZERO RETURN CODE        YS02019 30481000
         BR    RETRN                    RETURN TO TSINPUT        A45625 30484021
         SPACE 2                                                        30500020
********                                                                30600020
******** GET SIZE OF DATA IN THE TCAM BUFFER.                           30700020
********                                                                30800020
TSIN0150 EQU   *                                                 A45625 30850021
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 30900020
         LH    RDSZE,PRFSIZE            GET SIZE OF DATA IN TCAM BFR    31000020
         SPACE 2                                                        31200020
********                                                                31300020
******** DETERMINE IF A PARTIALLY FILLED TS BUFFER EXISTS ON THE INPUT  31400020
******** QUEUE.  IF SO, CONTINUE MOVING DATA INTO THIS TS BUFFER BEGIN- 31500020
******** ING AT THE POINT WHERE THE LAST MOVE LEFT OFF.                 31600020
********                                                                31700020
TSIN0170 EQU   *                                                        31750020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  31800020
         BE    TSIN0242                 BRANCH IF NONE                  31900020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   32000020
         L     RTSBFR,TSBIBFP-K1        GET FIRST TS BFR ON INPUT QUEUE 32010020
         SPACE 1                                                        32020020
TSIN0190 EQU   *                                                        32030020
         CLC   BUFFHEAD,AVTFZERO        MORE HDR BFRS ON INPUT QUEUE    32040020
         BE    TSIN0210                 BRANCH IF NO MORE               32050020
         L     RTSBFR,BUFFHEAD-K1       GET NEXT HDR BFR ON INPUT QUEUE 32060020
         B     TSIN0190                 CONT SEARCH FOR LAST HDR BFR    32070020
         SPACE 1                                                        32080020
TSIN0210 EQU   *                                                        32090020
         LR    RWK11,RTSBFR             SAVE POINTER TO LAST HDR BFR    32100020
         TM    BUFFFL1,BUFFNLCR         IS HDR MARKED AS COMPL TS MSG   32200020
         BZ    TSIN0230                 BRANCH IF NO                    32230020
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR TO MOVE    32260020
         BNZ   TSIN0242                 BRANCH IF YES                   32290020
         TM    BUFFFL2,BUFFFRAG         IS LAST TCAM MSG COMPLETE       32320020
         BZ    TSIN0242                 BRANCH IF YES                   32350020
         SPACE 1                                                        32400020
TSIN0230 EQU   *                                                        32500020
         CLC   BUFFTRLR,AVTFZERO        ANY TRLR BFRS LINKED TO LST BFR 32600020
         BE    TSIN0240                 BRANCH IF NO                    32700020
         L     RTSBFR,BUFFTRLR-K1       GET ADDR OF NEXT TRAILER BFR    32800020
         B     TSIN0230                 CONT SEARCH FOR LAST BFR IN Q   32900020
         SPACE 1                                                        33000020
TSIN0240 EQU   *                                                        33100020
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR TO MOVE    33200020
         BZ    TSIN0352                 BRANCH IF NONE                  33300020
         TM    BUFFFL1,BUFFFULL         IS THE LAST BFR IN QUEUE FULL   33400020
         BZ    TSIN0249                 BRANCH IF NO             S22028 33450000
         SPACE 1                                                        33600020
TSIN0242 EQU   *                                                        33700020
         LR    R0,RWRK7                 SAVE CURRENT CHARACTER COUNT    33720020
         BAL   RWK15,TSIN0500           BR TO BFR ALLOCATION ROUTINE    33750020
         SPACE 2                                                 S22028 33750900
********                                                                33751800
******** FOR 3270, IF THIS IS BEGINNING OF A TCAM MSG, MOVE CONTROL     33752700
******** CHARACTERS INTO TS BUFFERS                                     33753600
********                                                                33754500
         TM    TSBSTAT,TSB3270          TEST FOR 3270 TERMINAL   S22028 33755400
         BZ    TSIN0248                 BR AROUND IF NOT         S22028 33756300
         TM    PRFSTAT1,PRFNHDRN        IS THIS FIRST TCAM BFR   S22028 33757200
*                                       OF MSG                   S22028 33758100
         BO    TSIN0248                 BR IF NO                 S22028 33759000
         TM    BUFFFL1,BUFFHDR          IS THIS A TS HDR BFR     S22028 33759900
         BZ    TSIN0248                 BR IF NO                 S22028 33760800
         SR    RWRK7,RWRK7              ZERO R7                 OZ07609 33761700
         USING IEDQLCB,RLCB                                     OZ07609 33762600
         L     RLCB,PRFLCB-K1           LCB ADDRESSABILITY      OZ07609 33763500
         IC    RWRK7,LCBISZE            GET RESERVE NUMBER      OZ07609 33764400
         LA    RWRK7,PRFSHDR(RWRK7)     POINT AT FIRST CHAR.    OZ07609 33765300
         DROP  RLCB                                             OZ07609 33766200
*                                       POINTS AT FIRST CHAR IN BFR     33767100
         SPACE 1                                                 S22028 33768000
TSIN0244 EQU   *                                                 S22028 33768900
         CLI   K0(RWRK7),AVTEZERO       CHECK FOR ZEROS          S22028 33769800
         BNE   TSIN0245                 BRANCH IF NO             S22028 33770700
         LA    RWRK7,K1(R0,RWRK7)       POINT PASS ZERO          S22028 33771600
         B     TSIN0244                 CHECK NEXT BYTE          S22028 33772500
         SPACE 1                                                 S22028 33773400
TSIN0245 EQU   *                                                 S22028 33774300
         LA    RMVSZ2,CC3270ND          ASSUME MSG HAS NO DATA   S22028 33775200
*                                       (ONLY 1 AID CHAR)               33776100
         TM    PRFTIC,CC32706           DOES MSG HAVE MORE THAN  S22028 33777000
*                                       1 CONTROL CHARS                 33777900
         BZ    TSIN0246                 NO, BRANCH AROUND        S22028 33778800
         LA    RMVSZ2,CC3270D3          ASSUME 3 CONTROL CHARS   S22028 33779700
         CLI   CC3270D3(RWRK7),SBA      CHECK FOR SBA CHAR       S22028 33780600
         BNE   TSIN0246                 BRANCH IF NO             S22028 33781500
         LA    RMVSZ2,CC3270D6          THERE ARE 6 CONTROL      S22028 33782400
*                                       CHARS                    S22028 33783300
         SPACE 1                                                 S22028 33784200
TSIN0246 EQU   *                                                 S22028 33785100
         STC   RMVSZ2,BUFFLNTH          UPDATE DATA LENGTH IN    S22028 33786000
*                                       BFR                      S22028 33786900
         BCTR  RMVSZ2,R0                DECREMENT FOR EX         S22028 33787800
*                                       INSTRUCTION              S22028 33788700
         SPACE 1                                                 S22028 33789600
TSIN0247 EQU   *                                                 S22028 33790500
         EX    RMVSZ2,TSIN0345          MOVE 3270 CONTROL CHARS  S22028 33791400
*                                       INTO TS BUFFER                  33792300
         OI    BUFFFL2,BUFF3270         TELL TGET THIS BFR HAS   S22028 33793200
*                                       3270                     S22028 33794100
*                                       CONTROL CHARS                   33795000
         SPACE 1                                                 S22028 33795900
TSIN0248 EQU   *                                                 S22028 33796800
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR TO MOVE    33800020
         BZ    TSIN0352                 BRANCH IF NONE                  33900020
         LR    RWRK7,R0                 RESTORE CURRENT CHARACTER COUNT 33903020
         SPACE 2                                                        33906020
********                                                                33912020
******** IF THERE IS ANY DATA IN THIS TCAM BUFFER WHICH IS REMAINING    33918020
******** FROM A PREVIOUS INCOMPLETE MOVE, THE CURRENT CHARACTER COUNT   33924020
******** IN THE LAST TS HEADER BUFFER REFLECTS THE ACTUAL NUMBER OF     33930020
******** CHARACTERS NOT DELETED.  IF THIS IS THE FIRST ATTEMPT TO MOVE  33936020
******** THE SCANNED DATA, PLACE THE CURRENT CHARACTER COUNT INTO THE   33942020
******** LAST TS HEADER BUFFER ON THE INPUT QUEUE.                      33948020
********                                                                33954020
TSIN0249 EQU   *                                                 S22028 33957000
         TM    PRFTIC,NOTMOVED          ANY UNMOVED DATA IN TCAM BUFFER 33966020
*                                       FROM A PREVIOUS SCAN            33972020
         BO    TSIN0250                 BRANCH IF YES                   33978020
         STH   RWRK7,BUFFWORK-TIOCBUF(R0,RWK11) STORE CHARACTER COUNT   34038020
         SPACE 2                                                        34100020
********                                                                34200020
******** DETERMINE IN WHICH BASIC UNIT OF THE TCAM BUFFER THE DATA TO   34300020
******** BE MOVED BEGINS.                                               34400020
********                                                                34500020
TSIN0250 EQU   *                                                        34600020
         DROP  RTCBFR                   DROP RTCBFR AS TCAM BFR BASE    34700020
         USING IEDQPRF,RWRK4            USE RWRK4 AS TCAM BFR BASE REG  34800020
         LR    RWRK4,RTCBFR             GET ADDR OF FIRST BASIC UNIT    34900020
         SPACE 1                                                        35000020
TSIN0260 EQU   *                                                        35100020
         LH    RWK15,AVTKEYLE           GET BASIC UNIT SIZE             35200020
         SPACE 1                                                        35300020
TSIN0270 EQU   *                                                        35400020
         LA    RMVSZ1,K12(RWK15,RWRK4)  POINT TO END OF THIS BASIC UNIT 35500020
         LA    RWRK4,K0(R0,RWRK4)       CLEAR HI ORDER BYTE OF REGISTER 35600020
         CLR   RSCANF,RWRK4             COULD DATA BEGIN IN THIS B.U.   35700020
         BL    TSIN0280                 BRANCH IF NO TO CONT SEARCH     35800020
         CLR   RSCANF,RMVSZ1            DOES DATA BEGIN IN THIS B.U.    35900020
         BE    TSIN0290                 NO, IT BEGINS IN THE NEXT B.U.  36000020
         BNH   TSIN0300                 BRANCH IF YES                   36100020
         SPACE 1                                                        36200020
TSIN0280 EQU   *                                                        36300020
         L     RWRK4,PRFTIC             GET ADDR OF NEXT BASIC UNIT     36400020
         B     TSIN0270                 CONT SEARCH FOR BEGIN OF MOVE   36500020
         SPACE 1                                                        36600020
TSIN0290 EQU   *                                                        36700020
         L     RWRK4,PRFTIC             GET ADDR OF NEXT BASIC UNIT     36800020
         LA    RSCANF,K12(R0,RWRK4)     RESET BEGIN DATA PTR TO THIS BU 36900020
         LA    RMVSZ1,K12(RWK15,RWRK4)  POINT OT END OF THIS BASIC UNIT 37000020
         SPACE 2                                                        37100020
********                                                                37200020
******** DETERMINE HOW MUCH DATA IS TO BE MOVED AT THIS TIME.  THIS     37300020
******** AMOUNT WILL BE THE SMALLER OF EITHER THE NUMBER OF UNFILLED    37400020
******** BYTES IN THE CURRENT TS BUFFER, OR THE AMOUNT OF UNMOVED DATA  37500020
******** IN THE CURRENT BASIC UNIT.                                     37600020
********                                                                37700020
TSIN0300 EQU   *                                                        37800020
         CLR   RSCANL,RMVSZ1            COULD END OF DATA BE IN THIS BU 37900020
         BH    TSIN0310                 BRANCH IF NO                    38000020
         CLR   RSCANL,RSCANF            IS END OF DATA IN THIS B.U.     38100020
         BNH   TSIN0310                 BRANCH IF NO                    38200020
         LR    RMVSZ1,RSCANL            END OF DATA IS IN THIS B.U.     38300020
         SPACE 1                                                        38400020
TSIN0310 EQU   *                                                        38500020
         SR    RMVSZ1,RSCANF            CALC AMOUNT OF DATA IN THIS BU  38600020
         LR    RFILL,RTSBFR             INIT TS BFR BEGIN DATA MOVE PT  38700020
         SR    RWK15,RWK15              CLEAR REGISTER                  38800020
         IC    RWK15,BUFFOFST           GET HDR OR TRLR OFFSET          38900020
         AR    RFILL,RWK15              ADD OFFSET TO TS BFR ADDRESS    39000020
         IC    RWK15,BUFFLNTH           GET LENGTH OF DATA IN TS BFR    39100020
         AR    RFILL,RWK15              CALC BEGIN ADDR OF NEXT MOVE    39200020
         LH    RMVSZ2,TIOCBFSZ          GET TS BUFFER SIZE              39300020
         AR    RMVSZ2,RTSBFR            POINT TO END OF THIS TS BUFFER  39400020
         SR    RMVSZ2,RFILL             CALC UNFILLED SPACE IN TS BFR   39500020
         CLR   RMVSZ2,RMVSZ1            IS UNFILLED SPACE LESS OR EQUAL 39600020
*                                       TO AMOUNT OF DATA IN TCAM B.U.  39700020
         BNH   TSIN0320                 BRANCH IF YES                   39800020
         LR    RMVSZ2,RMVSZ1            MOVE AMOUNT OF DATA IN B.U.     39900020
         B     TSIN0330                 BRANCH TO CONTINUE MOVE         40000020
         SPACE 1                                                        40100020
TSIN0320 EQU   *                                                        40200020
         OI    BUFFFL1,BUFFFULL         MARK TS BUFFER AS FULL          40300020
         SPACE 2                                                        40400020
********                                                                40500020
******** MOVE DATA FROM THE TCAM BASIC UNIT INTO THE TS BUFFER AND      40600020
******** CALCULATE THE AMOUNT OF UNMOVED DATA LEFT IN THE TCAM BUFFER.  40700020
********                                                                40800020
TSIN0330 EQU   *                                                        40900020
         SR    RDSZE,RMVSZ2             DECR AMOUNT OF DATA IN TCAM BFR 41000020
         AR    RWK15,RMVSZ2             INCR AMOUNT OF DATA IN TS BFR   41100020
         STC   RWK15,BUFFLNTH           STORE UPDATED TS BFR DATA COUNT 41200020
         DROP  RWRK4                    DROP RWRK4 AS TCAM BFR BASE REG 41210020
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 41220020
         LH    RWK15,PRFSRCE            GET OLD DATA OFFSET             41226020
         AR    RWK15,RMVSZ2             UPDATE DATA OFFSET              41240020
         STH   RWK15,PRFSRCE            STORE UPDATED OFFSET            41270020
         BCTR  RMVSZ2,R0                DECR MOVE AMOUNT FOR EXECUTE    41300020
         EX    RMVSZ2,TSIN0340          MOVE DATA INTO TS BUFFER        41400020
         LA    RSCANF,K1(RMVSZ2,RSCANF) INCR TCAM BFR BEGIN DATA PTR    41500020
         SPACE 2                                                        41600020
********                                                                41700020
******** DETERMINE IF ALL THE DATA HAS BEEN MOVED FROM THE TCAM BUFFER  41800020
******** INTO TS BUFFER(S).  IF NOT, DETERMINE IF ANOTHER TS BUFFER IS  41900020
******** NEEDED TO PERFORM THE NEXT MOVE.                               42000020
********                                                                42100020
         CLR   RSCANF,RSCANL            ALL OF SCANED DATA MOVED        42200020
         BE    TSIN0350                 BRANCH IF YES                   42300020
         TM    BUFFFL1,BUFFFULL         IS THE LAST TS BUFFER FULL      42400020
         BZ    TSIN0260                 BRANCH IF NO                    42500020
         OI    PRFTIC,NOTMOVED          IND NOT ALL OF SCANNED DATA     42530020
*                                       MOVED FROM TCAM BUFFER          42560020
         LA    RWK15,TSIN0260           RETURN PT FROM BFR ALLOCATION   42600020
         B     TSIN0500                 BR TO BFR ALLOCATION ROUTINE    42700020
         SPACE 1                                                        42800020
TSIN0340 EQU   *                                                        42900020
         MVC   K0(RMVSZ2,RFILL),K0(RSCANF)  MOVE DATA FR TCAM TO TS BFR 43000020
         SPACE 1                                                 S22028 43020000
TSIN0345 EQU   *                                                 S22028 43040000
         MVC   BUFFHDLN(RMVSZ2,RTSBFR),K0(RWRK7) MOVE 3270       S22028 43060000
*                                       CONTROL CHA              S22028 43080000
         SPACE 2                                                        43100020
********                                                                43200020
******** IF A COMPLETE LINE (ENDS IN CARRIAGE RETURN AND/OR EOT) HAS    43300020
******** BEEN MOVED INTO THE TS BUFFER, MARK THE BUFFER AS FULL AND     43400020
******** INCREMENT THE LINE COUNT IF AUTOMATIC LINE NUMBERING IS IN     43500020
******** PROGRESS.  IF EOT OCCURED, TURN OFF THE FRAGMENT INDICATORS    43600020
******** IN ALL THE HEADER BUFFERS WHICH ARE IN THIS TSBS INPUT QUEUE.  43700020
********                                                                43800020
TSIN0350 EQU   *                                                        43900020
         NI    PRFTIC,OFF-NOTMOVED      IND ALL OF SCANNED DATA MOVED   43950020
         BCTR  RSCANL,R0                BACK UP TO LAST CHAR SCANED     44000020
         LTR   RDSZE,RDSZE              ANY UNMOVED DATA IN TCAM BUFFER 44100020
         BNZ   TSIN0362                 BRANCH IF YES                   44160020
         SPACE 1                                                        44280020
TSIN0352 EQU   *                                                        44340020
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   44420020
         L     RQCB,AVTSAVE2+K64        GET QCB ADDRESS (SAVED  YS02019 44430000
*                                       BY IEDAYI)              YS02019 44440000
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    44460020
         BO    TSIN0360                 BRANCH IF NO                    44480020
         TM    PRFTIC,WRITEBRK          DID WR BREAK OCCUR IN THIS BFR  44540020
         BO    TSIN0420                 BRANCH IF YES                   44600020
         TM    PRFTIC,TIMEOUT           DID TIMEOUT OCCUR IN THIS BFR   44650020
         BZ    TSIN0370                 BRANCH IF NO                    44700020
         TM    PRFTIC,WAITQBFR          WAS THIS BFR ON THE WAIT QUEUE  44750020
         BO    TSIN0420                 BRANCH IF YES                   44800020
         OI    QCBFLAG,QCBREAD          IND READ STILL HAS PRIORITY     44850020
         SPACE 1                                                        44900020
TSIN0360 EQU   *                                                        45000020
         CLC   PRFSIZE,AVTFZERO         ANY DATA MOVED FROM TCAM BFR    45006020
         BE    TSIN0490                 BRANCH IF NONE                  45012020
         TM    PRFSTAT1,PRFEOFN         WAS SET EOF EXECUTED            45020020
         BO    TSIN0370                 YES, TREAT AS END OF MESSAGE    45040020
         SPACE 1                                                        45060020
TSIN0362 EQU   *                                                        45080020
         CLI   K0(RSCANL),NEWLINE       WAS LAST CHAR SCANNED NEW LINE  45086020
         BE    TSIN0364                 BRANCH IF YES                   45093020
         CLI   K0(RSCANL),CARRRTRN      WAS LAST CHAR SCANED CARR RETRN 45100020
         BNE   TSIN0490                 RETURN TO TSINPUT IF NOT        45120020
         SPACE 2                                                        45140020
********                                                                45160020
******** IF THIS TS MESSAGE IS A NULL LINE (NO DATA OR THE ONLY         45180020
******** CHARACTER IN THE TS BUFFER IS NEW LINE OR CARRIAGE RETURN),    45200020
******** TERMINATE AUTOMATIC PROMPTING.                                 45220020
********                                                                45240020
TSIN0364 EQU   *                                                        45260020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  45280020
         BAL   RWK15,TSIN9010           CALCULATE ACTUAL DATA    S22028 45290000
*                                       SIZE                     S22028 45300000
         CH    R0,ONE                   IS ONLY CHAR NL OR CR    S22028 45306000
         BH    TSIN0390                 BRANCH IF NO                    45340020
         NI    TSBFLG2,OFF-TSBAUTON     TERMINATE AUTO PROMPTING        45360020
         B     TSIN0390                 CONTINUE                        45380020
         SPACE 1                                                        45400020
TSIN0370 EQU   *                                                        45500020
         BAL   RWK15,TSIN9010           CALCULATE ACTUAL DATA    S22028 45505000
*                                       SIZE                     S22028 45510000
         CH    R0,ONE                   IS DATA LENGTH IN TS BFR S22028 45512000
*                                       1                        S22028 45514000
         BH    TSIN0374                 BR IF MORE THAN ONE CHAR IN BFR 45520020
         BL    TSIN0372                 BR IF NO DATA IN TS BFR         45530020
         LA    RWRK1,BUFFHDLN(RWRK1,RWK11) POINTS AT ONLY DATA   S22028 45535000
*                                       CHAR                     S22028 45540000
         CLI   K0(RWRK1),NEWLINE        IS THE ONLY CHAR IN TS   S22028 45542000
*                                       BFR NL                   S22028 45544000
         BE    TSIN0372                 BRANCH IF YES                   45550020
         CLI   K0(RWRK1),CARRRTRN       IS THE ONLY CHAR IN TS   S22028 45555000
*                                       BFR CR                   S22028 45560000
         BNE   TSIN0374                 BRANCH IF NO                    45570020
         SPACE 1                                                        45580020
TSIN0372 EQU   *                                                        45590020
         NI    TSBFLG2,OFF-TSBAUTON     TERMINATE AUTO PROMPTING        45600020
         SPACE 2                                                        45610020
********                                                                45620020
******** INDICATE THIS TCAM MESSAGE IS COMPLETE.                        45630020
********                                                                45640020
TSIN0374 EQU   *                                                        45650020
         USING TIOCBUF,RWRK4            USE RWRK4 AS TS BFR BASE REG    45700020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  45800020
         BE    TSIN0392                 BRANCH IF NONE                  45900020
         L     RWRK4,TSBIBFP-K1         GET FIRST TS HDR ON INPUT QUEUE 46000020
         SPACE 1                                                        46100020
TSIN0380 EQU   *                                                        46200020
         NI    BUFFFL2,OFF-BUFFFRAG     TURN OFF MSG FRAG INDR IN BFR   46300020
         L     RWRK4,BUFFHEAD-K1        GET NEXT HDR BFR ON INPUT QUEUE 46400020
         LA    RWRK4,K0(R0,RWRK4)       CLEAR HI-ORDER BYTE OF REG      46500020
         LTR   RWRK4,RWRK4              IS THIS END OF INPUT BFR QUEUE  46600020
         BNZ   TSIN0380                 BRANCH IF NO                    46700020
         TM    K0(RWK11),BUFFNLCR       IS LAST TS MESSAGE COMPLETE     46800020
         BO    TSIN0393                 BRANCH IF YES                   46900020
         SPACE 2                                                        46940020
********                                                                46980020
******** INDICATE THIS TS MESSAGE IS COMPLETE.                          47020020
********                                                                47060020
TSIN0390 EQU   *                                                        47100020
         DROP  RWRK4                    DROP RWRK4 AS TS BFR BASE REG   47200020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   47300020
         OI    BUFFFL1,BUFFFULL         MARK LAST TS BFR AS FULL        47400020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  47460020
         USING TIOCBUF,RWK11            USE RWK11 AS TS BFR BASE REG    47520020
         OI    BUFFFL1,BUFFNLCR         MARK LAST TS MSG AS COMPLETE    47580020
         NI    BUFFFL2,OFF-BUFFPART     TURN OFF PART LINE INDR IF ON   47640020
         NI    TSBFLG2,OFF-TSBBRKIN-TSBBIPI  IND PARTIAL LINE COMPLETE  47670020
         SPACE 2                                                        47700020
********                                                                47800020
******** INCREMENT AUTOMATIC LINE NUMBER                                47900020
********                                                                48000020
         TM    TSBFLG2,TSBAUTON+TSBAULST  IS AUTO LINE NO. IN PROGRESS  48100020
         BNO   TSIN0392                 BRANCH IF NO                    48200020
         L     RWK15,TSBAUTOS           GET CURRENT AUTO LINE NUMBER    48500020
         A     RWK15,TSBAUTOI           ADD INCR VALUE TO AUTO LINE NO. 48600020
         ST    RWK15,TSBAUTOS           STORE UPDATED AUTO LINE NUMBER  48700020
         SPACE 2                                                        48800020
********                                                                48900020
******** WHEN END OF MESSAGE IS DETECTED AND THERE IS NO MORE DATA LEFT 49000020
******** IN THE TCAM BUFFER TO BE MOVED INTO TS BUFFERS, PERFORM THE    49100020
******** FOLLOWING FUNCTIONS.                                           49200020
********                                                                49300020
TSIN0392 EQU   *                                                        49400020
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    49500020
         BO    TSIN0490                 BRANCH IF NO                    49600020
         LTR   RDSZE,RDSZE              ANY UNMOVED DATA IN TCAM BFR    49700020
         BNZ   TSIN0490                 BRANCH IF YES                   49800020
         SPACE 1                                                        49900020
TSIN0393 EQU   *                                                        50000020
         NI    TSBFLG2,OFF-TSBBIPI-TSBBRKIN  IND PARTIAL LINE COMPLETE  50160020
         NI    QCBTSOF1,OFF-QCBTGET     IND READ NO LONGER HAS PRIORITY 50300020
         SPACE 2                                                        50404020
********                                                                50408020
******** IF THE USER HAS EXCEEDED THE MAXIMUM NUMBER OF TIME SHARING    50412020
******** BUFFERS ALLOWED HIS TERMINAL FOR INPUT, PLACE HIM IN LWAIT.    50416020
******** IF THE AMOUNT OF TIME SHARING BUFFERS ON THE FREE QUEUE HAS    50420020
******** FALLEN BELOW THE RESERVE MINIMUM, PLACE THE SYSTEM IN LWAIT.   50424020
******** IN EITHER CASE, LOCK THE USERS KEYBOARD TO FURTHER INPUT.      50428020
********                                                                50432020
         CLC   TSBNIBF,TIOCAIMX+K1      MAX NO. OF INPUT BFRS EXCEEDED  50436020
         BL    TSIN0394                 BRANCH IF NO                    50440020
         OI    TSBSTAT,TSBLWAIT         PLACE USER IN LWAIT             50444020
         OI    QCBTSOF1,QCBNOBUF        LOCK USERS KEYBOARD TO INPUT    50448020
         SPACE 1                                                        50452020
TSIN0394 EQU   *                                                        50456020
         CLC   TIOCNFBF,AVTFZERO        ANY TS BFRS ON FREE QUEUE       50460020
         BE    TSIN0395                 BRANCH IF NONE                  50464020
         CLC   TIOCNFBF,TIOCUSLW        NO. FREE BFRS BELOW MINIMUM     50468020
         BNL   TSIN0396                 BRANCH IF NO                    50472020
         SPACE 1                                                        50476020
TSIN0395 EQU   *                                                        50480020
         OI    TIOCFLG,TIOCSYLW         PLACE THE SYSTEM IN LWAIT       50484020
         OI    QCBTSOF1,QCBNOBUF        LOCK USERS KEYBOARD TO INPUT    50488020
         SPACE 1                                                        50988020
TSIN0396 EQU   *                                                        51488020
         CLI   TSBNIBF,AVTEZERO         ANY TS BFRS ON THE INPUT QUEUE  51988020
         BE    TSIN0410                 BRANCH IF NONE                  52488020
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY SCREEN        52538020
         BZ    TSIN0398                 BRANCH IF NO                    52588020
         SR    R0,R0                    CLEAR REGISTER                  52638020
         SR    RWRK1,RWRK1              CLEAR REGISTER                  52688020
         IC    R0,QCBSATCT              GET NO. OF LINES ENTERED        52738020
         IC    RWRK1,TSBLNNO            GET NO. OF LINES ON SCREEN (N)  52788020
         BCTR  RWRK1,R0                 DECR BY 1 NO. OF SCREEN LINES   52838020
         CLR   R0,RWRK1                 IS NO. OF LINES ENTERED LESS    52888020
*                                       THAN (N-1)                      52938020
         BL    TSIN0398                 BRANCH IF YES                   52948020
         MVI   QCBSATCT,AVTEZERO        RESET NO. LINES ENTERED TO ZERO 52958020
         BH    TSIN0397                 BR IF LINES ENTERED IS GT (N-1) 52968020
         MVI   QCBSATCT,CLRSCREN        INDICATE SCREEN MUST BE CLEARED 52978020
         SPACE 1                                                        52988020
TSIN0397 EQU   *                                                        52998020
         BAL   RWK15,TSIN9010           CALCULATE ACTUAL DATA    S22028 53003000
*                                       SIZE                     S22028 53008000
         CH    R0,ONE                   IS DATA LENGTH IN TS BFR S22028 53010000
*                                       1                        S22028 53012000
         BH    FLASHBAK                 BR IF MORE THAT ONE CHAR IN BFR 53018020
         BL    TSIN0398                 IF NO DATA, DON'T FLASH BACK    53028020
         LA    RWRK1,BUFFHDLN(RWRK1,RWK11) POINTS AT ONLY DATA   S22028 53033000
*                                       CHAR                     S22028 53038000
         CLI   K0(RWRK1),NEWLINE        IS ONLY CHAR IN BFR NEW  S22028 53040000
*                                       LINE                     S22028 53042000
         BE    TSIN0398                 IF CHAR IS NL, DON'T FLASH BACK 53048020
         SPACE 1                                                        53058020
FLASHBAK EQU   *                                                        53068020
*  TEST IF LINE SHOULD BE FLASHED BACK                         @ZA02244 53073000
         TM    TSBFLG3,TSBNFLOP         FLAG ON                @ZA02244 53078000
         BO    TSIN0398                 YES                    @ZA02244 53083000
         OI    BUFFFL2,BUFFPART         MARK TS BFR FOR FLASH BACK      53088020
         OI    TSBFLG2,TSBBRKIN         TELL TSOUTPUT TO FLASH BACK     53138020
         B     TSIN0440                 GO TO CHK IF ANY OUTPUT IN PROG 53188020
         SPACE 2                                                        53300020
********                                                                53400020
******** IF THE USER IS IN IWAIT, CALL THE IKJGGQIO ROUTINE             53700021
******** IN IEDAYOO TO REMOVE IWAIT.                                    54000021
********                                                                54300020
TSIN0398 EQU   *                                                        54400020
         TM    TSBFLG4,TSBIWAIT         IS USER IN IWAIT        YS02019 54450000
         BZ    TSIN0410                 BRANCH IF NO                    54800020
         STM   RTSBFR,RETRN,TIOCSAVE    SAVE REG.S 5-14 ACROSS   S21008 55100021
*                                       CALL                     S21008 55400021
         LA    RWRK8,AVTEZERO(,RTSB)    LD TSB ADDR & CLEAR BYTE S21008 56000021
*                                       0                        S21008 56300021
         IC    RWK11,TSBFLG2            SAVE TSBBIPI SETTING     S21008 56600021
         OI    TSBFLG2,TSBBIPI          REQUEST IWAIT REMOVAL    S21008 56900021
         L     RNTRY,QIOEPA             GET REMOVAL RTN'S EPA    S21008 57200021
         L     RBASE,QIOBASE            GET REMOVAL RTN'S BASE   S21008 57500021
*                                       ADDR                     S21008 57800021
         BALR  RWRK4,RNTRY              GO REMOVE IWAIT          S21008 58100021
         STC   RWK11,TSBFLG2            RESTORE TSBBIPI SETTING  S21008 58400021
         LM    RTSBFR,RETRN,TIOCSAVE    RESTORE REGISTERS        S21008 58700021
         SPACE 2                                                        60004020
********                                                                60008020
******** IF AUTOMATIC PROMPTING IS IN PROGRESS, TELL TCAM OR TSOUTPUT   60011020
******** TO PROMPT THE USER WITH THE PROMPT CHARACTER OR THE NEXT LINE  60014020
******** NUMBER.                                                        60017020
********                                                                60020020
TSIN0410 EQU   *                                                        60024020
         TM    TSBFLG2,TSBAUTON         IS AUTO PROMPTING IN PROGRESS   60029020
         BNO   TSIN0490                 BRANCH IF NO                    60034020
         TM    PRFSRCE,WAITQBFR         WAS THIS BFR ON WAIT QUEUE      60044020
         BZ    TSIN0412                 BRANCH IF NO                    60048020
         OI    TSBFLG2,TSBSTAUT         TELL TSOUTPUT TO PROMPT USER    60049020
         B     TSIN0440                 BRANCH TO POST TSOUTPUT         60052020
         SPACE 1                                                        60056020
TSIN0412 EQU   *                                                        60060020
         USING IEDQLCB,RWRK2            USE RWRK2 AS LCB BASE REG       60064020
         L     RWRK2,PRFLCB-K1          GET LCB ADDRESS                 60068020
         L     RWRK2,LCBSCBA-K1         GET SCB ADDRESS                 60072020
         DROP  RWRK2                    DROP RWRK2 AS LCB BASE REG      60076020
         USING IEDQSCB,RWRK2            USE RWRK2 AS SCB BASE REG       60080020
         OI    SCBERR2,SCBALN           TELL TCAM TO PROMPT THE USER    60084020
         B     TSIN0490                 BRANCH TO RETURN TO TSINPUT     60088020
         DROP  RWRK2                    DROP RWRK2 AS SCB BASE REG      60092020
         SPACE 2                                                        60100020
********                                                                60200020
******** IF A PARTIAL LINE CAUSED BY BREAK-IN EXISTS, MARK THE LAST TS  60300020
******** HEADER BUFFER ON THE INPUT QUEUE AS A PARTIAL LINE.  ALSO      60400020
******** DETERMINE IF THE PARTIAL LINE CAN BE PROCESSED BY TSOUTPUT AT  60500020
******** THIS TIME.                                                     60600020
********                                                                60700020
TSIN0420 EQU   *                                                        60800020
         CLC   PRFSIZE,AVTFZERO         ANY DATA MOVED FROM TCAM BFR    60803020
         BNE   TSIN0430                 BRANCH IF YES                   60806020
         TM    BUFFFL1,BUFFNLCR         WAS LAST CHAR MOVED NL OR CR    60809020
         BO    TSIN0370                 BRANCH IF YES - NO PARTIAL LINE 60812020
         B     TSIN0434                 BR TO INDICATE A PARTIAL LINE   60815020
         SPACE 1                                                        60818020
TSIN0430 EQU   *                                                        60821020
         CLI   K0(RSCANL),NEWLINE       WAS LAST CHAR SCANNED NEW LINE  60830020
         BE    TSIN0370                 BRANCH IF YES - NO PARTIAL LINE 60860020
         CLI   K0(RSCANL),CARRRTRN      WAS LAST CHAR SCANED CARR RETRN 60900020
         BE    TSIN0370                 BRANCH IF YES - NO PARTIAL LINE 61000020
         SPACE 1                                                        61100020
TSIN0434 EQU   *                                                        61200020
         OI    TSBFLG2,TSBBRKIN         IND PARTL LINE DUE TO BREAK-IN  61300020
         OI    BUFFFL2,BUFFPART          IND PART LINE IN BUFF @ZA08015 61700000
         NI    QCBTSOF1,OFF-QCBNOBUF    TURN OFF TCAM NO BFRS INDICATOR 62200020
         DROP  RWK11                    DROP RWK11 AS TS BFR BASE REG   62600020
         SPACE 1                                                        63040020
TSIN0440 EQU   *                                                        63080020
         TM    QCBTSOF1,QCBTPUT+QCBPARTO  ANY OUTPUT IN PROGRESS        63120020
         BNZ   TSIN0490                 BRANCH IF YES                   63160020
         OI    QCBTSOF1,QCBTPUT         REQUEST A TPUT OPERATION        63180020
         TM    QCBTSOF1,QCBDELAY        IS THIS QCB ON THE DELAY QUEUE  63200020
         BZ    TSIN0450                 BRANCH IF NO                    63240020
         SPACE 2                                                        63300020
********                                                                63400020
******** QPOST THE DELAY QUEUE QCB TO ITSELF TO REMOVE THE TERMINAL     63460020
******** DESTINATION QCB FROM THE DELAY QUEUE.                          63520020
********                                                                63600020
         DROP  RQCB                     DROP RQCB AS QCB BASE REGISTER  63620020
         L     RQCB,AVTTSOPT            GET ADDR OF TSINPUT'S QCB       63640020
         USING IEDQTSI,RQCB             USE RQCB AS TSINPUT'S QCB BASE  63660020
         TM    TSIDYQFG,TSIDYPOS        HAS DELAY QUEUE QCB BEEN POSTED 63680020
         BO    TSIN0490                 BR IF YES, NOTHING MORE TO DO   63700020
         OI    TSIDYQFG,TSIDYPOS        IND DELAY QUEUE QCB IS POSTED   63720020
         LA    RQCB,TSIDYQFG            PT TO DELAY QUEUE QCB           63740020
         B     TSIN0470                 BR TO POST DELAY QUEUE QCB      63760020
         DROP  RQCB                     DROP RQCB AS TSINPUT'S QCB BASE 63780020
         SPACE 2                                                        63800020
********                                                                63900020
******** QPOST THE TERMINAL QCB TO ITSELF TO ACTIVATE A SEND            64000020
******** OPERATION FOR THIS TERMINAL.                                   64100020
********                                                                64200020
TSIN0450 EQU   *                                                        64300020
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   64320020
         TM    QCBTSOF2,QCBPOSTO        IS QCB POSTED TO ITSELF         64326020
         BO    TSIN0490                 BRANCH IF YES                   64332020
         OI    QCBTSOF2,QCBPOSTO        IND QCB IS POSTED TO ITSELF     64340020
         MVI   QCBPRI,PRIDESTQ          SET QCB PRIORITY                64360020
         SPACE 2                                                        64380020
********                                                                64400020
******** THIS IS A COMMON ROUTINE USED TO QPOST A QCB TO ITSELF AND     64420020
******** ADD THAT QCB TO THE QUEUE OF ELEMENTS BEING PASSED TO THE TCAM 64440020
******** DISPATCHER FOR POSTING.                                        64460020
********                                                                64480020
TSIN0470 EQU   *                                                        64500020
         IC    RWRK2,QCBELCHN-K1        SAVE FLAG BYTE                  64520020
         ST    RQCB,QCBELCHN-K1         QPOST QCB TO ITSELF             64540020
         STC   RWRK2,QCBELCHN-K1        RESTORE FLAG BYTE               64560020
         MVC   QCBLINK,AVTDOUBL+K1      CHAIN FIRST ELEMENT ALREADY IN  64600020
*                                       QUEUE TO THIS QCB               64700020
         ST    RQCB,AVTDOUBL            CHAIN QCB TO RETURN QUEUE       64800020
         SPACE 2                                                        65100020
********                                                                65200020
******** STORE UPDATED DATA SIZE IN TCAM BUFFER AND RETURN TO TSINPUT   65300020
********                                                                65400020
TSIN0490 EQU   *                                                        65500020
         SR    RTIOC,RTIOC              SET RETURN CODE EQUAL TO ZERO   65600020
         SPACE 1                                                        65700020
TSIN0492 EQU   *                                                        65800020
         SLL   RWK11,K8                 LEFT ADJ LAST TS HDR BFR ADDR   65900020
         SRDL  RTIOC,K8                 ADJ RETURN CODE AND BUFFER ADDR 66000020
         LR    RTRNCD,RWK11             RETRN CODE AND LAST TS HDR ADDR 66100020
         STH   RDSZE,PRFSIZE            STORE UPDATED COUNT IN TCAM BFR 66200020
         BR    RETRN                    RETURN TO TSINPUT               66300020
         SPACE 2                                                        66304020
         SPACE 2                                                        66400020
********                                                                66500020
******** THE FOLLOWING SUBROUTINE OBTAINS A FREE TS BUFFER, IF ANY ARE  66600020
******** AVAILABLE, AND BUILDS A HEADER OR TRAILER BUFFER DEPENDING ON  66700020
******** WHICH IS REQUIRED.  THE BUFFER IS THEN CHAINED TO THE LAST     66800020
******** HEADER OR TRAILER AS REQUIRED.                                 66900020
********                                                                67000020
TSIN0500 EQU   *                                                        67100020
         NC    TIOCNFBF,TIOCNFBF        ANY FREE TS BUFFERS             67200020
         BNZ   TSIN0510                 BRANCH IF YES                   67300020
         LA    RTIOC,K4                 RETURN CODE FOR NO FREE TS BFRS 67400020
         B     TSIN0492                 BRANCH TO RETURN TO TSINPUT     67500020
         SPACE 1                                                        67600020
TSIN0510 EQU   *                                                        67700020
         SR    RWRK7,RWRK7              CLEAR REGISTER          ZA01370 67707000
         IC    RWRK7,TSBNIBF            # OF INPT BFRS ON QUEUE ZA01370 67714000
         CH    RWRK7,TIOCAIMX           MAX ALREADY ASSIGNED?   ZA01370 67721000
         BL    ALLOC                    NO, CONTINUE TO GET BFR ZA01370 67728000
         USING TIOCBUF,RWRK7            USE RWRK7 AS BFR BASE   ZA01370 67735000
         L     RWRK7,TSBIBFP-K1         GET @ OF 1ST INPUT BFR  ZA01370 67742000
         TM    BUFFFL2,BUFFFRAG         DO WE ONLY HAVE FRAGS?  ZA01370 67749000
         BNO   ALLOC                    NO, LET USER HAVE BFR   ZA01370 67756000
         OI    PRFSTAT1,PRFCNCLN        CANCEL THIS MESSAGE     ZA01370 67763000
         B     TSIN0490                 RETURN TO TCAM          ZA01370 67770000
ALLOC    STM   RWK15,RWRK2,AVTSAVE2+K44 SAVE REGISTERS          ZA01370 67777000
         L     RNTRY,QBAADDR            GET BFR ALLOCATION RTN  YS02019 67784000
*                                       ENTRY ADDRESS           YS02019 67800000
         BALR  R0,RNTRY                 GO TO OBTAIN A BFR      YS02019 67900000
         LR    RWRK7,RWRK2              BFR ADDR RETURNED IN    YS02019 68000000
         LM    RWK15,RWRK2,AVTSAVE2+K44 RESTORE REG.S           YS02019 68100000
         XC    BUFFFL1(BUFFHDLN),BUFFFL1  CLEAR PREFIX OF NEW BUFFER    68700020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  68800020
         BE    TSIN0530                 BRANCH IF NONE                  68900020
         DROP  RWRK7                    DROP RWRK7 AS TS BFR BASE REG   69000020
         USING TIOCBUF,RTSBFR           TS BFR ADDRESSABILITY   YS02019 69050000
         TM    BUFFFL1,BUFFHDR          IS LAST BFR POINTED TO A HDR    69200020
         BZ    TSIN0520                 BR IF NO TO BUILD A TRAILER BFR 69300020
         TM    BUFFFL1,BUFFNLCR         DOES HDR CONTAIN CARRIAGE RETRN 69400020
         BO    TSIN0540                 BR IF YES TO BUILD A HDR BFR    69500020
         SPACE 2                                                        69600020
********                                                                69700020
******** BUILD A TRAILER BUFFER AND CHAIN IT TO THE LAST BUFFER ON THE  69800020
******** INPUT QUEUE                                                    69900020
********                                                                70000020
TSIN0520 EQU   *                                                        70100020
         O     RWRK7,BUFFFL1            RESTORE FLAGS TO BFR ADDR       70200020
         ST    RWRK7,BUFFFL1            CHAIN NEW TRLR BFR TO LAST BFR  70300020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  70400020
         USING TIOCBUF,RWRK7            USE RWRK7 AS TS BFR BASE REG    70500020
         MVI   BUFFOFST,BUFFTRLN        OFFSET TO BEGIN DATA IN TRLR    70600020
         B     TSIN0560                 BR TO UPDATE INPUT BFR COUNT    70700020
         SPACE 2                                                        70800020
********                                                                70900020
******** BUILD A HEADER BUFFER AND CHAIN IT TO THE LAST HEADER BUFFER   71000020
******** IN THE INPUT QUEUE OR TO THE QUEUE ITSELF IF THE QUEUE IS      71100020
******** EMPTY                                                          71200020
********                                                                71300020
TSIN0530 EQU   *                                                        71400020
         O     RWRK7,TSBNIBF            RESTORE NO. BFRS TO BFR ADDR    71500020
         ST    RWRK7,TSBNIBF            CHAIN NEW HDR BFR TO QUEUE      71600020
         B     TSIN0550                 BR TO BUILD A HDR BFR           71700020
         SPACE 1                                                        71800020
TSIN0540 EQU   *                                                        71900020
         DROP  RWRK7                    DROP RWRK7 AS TS BFR BASE REG   72000020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   72100020
         O     RWRK7,BUFFFL2            RESTORE FLAGS TO BFR ADDR       72200020
         ST    RWRK7,BUFFFL2            CHAIN NEW HDR BFR TO LAST HDR   72300020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  72400020
         USING TIOCBUF,RWRK7            USE RWRK7 AS TS BFR BASE REG    72500020
         SPACE 1                                                        72600020
TSIN0550 EQU   *                                                        72700020
         OI    BUFFFL1,BUFFHDR          IND THIS IS A HEADER BFR        72800020
         OI    BUFFFL2,BUFFFRAG         IND THIS BFR CONTAINS FRAG MSG  72900020
         MVI   BUFFOFST,BUFFHDLN        OFFSET TO BEGIN DATA IN HDR BFR 73000020
         LR    RWK11,RWRK7              UPDATE LAST HEADER POINTER      73100020
         DROP  RWRK7                    DROP RWRK7 AS TS BFR BASE REG   73200020
         SPACE 2                                                        73300020
********                                                                73400020
******** UPDATE INPUT QUEUE BUFFER COUNT AND RETURN TO CALLER           73500020
********                                                                73600020
TSIN0560 EQU   *                                                        73700020
         SR    RWRK1,RWRK1              CLEAR REGISTER                  73800020
         IC    RWRK1,TSBNIBF            GET NO. OF BFRS ON INPUT QUEUE  73900020
         LA    RWRK1,K1(R0,RWRK1)       INCR NO. OF BFRS ON INPUT QUEUE 74000020
         STC   RWRK1,TSBNIBF            ST UPDATED BFR COUNT            74100020
         LR    RTSBFR,RWRK7             POINT TO NEXT BFR TO BE FILLED  74200020
         BR    RWK15                    RETURN TO CALLING ROUTINE       74300020
         DROP  RAVT,RTCBFR,RTIOC        DROP CONTROL BLOCK BASE  S22028 74350000
*                                       REGS                     S22028 74700000
         SPACE 3                                                 S22028 74700300
********                                                                74700600
******** FOR 3270 THERE WILL BE CONTROL CHARACTERS RANGING FROM 1 TO    74700900
******** 6 BYTES IN LENGTH. SUBTRACT THIS LENGTH FROM DATA SIZE TO      74701200
******** GET THE ACTUAL DATA LENGTH.                                    74701500
********                                                                74701800
TSIN9010 EQU   *                                                 S22028 74702100
         USING TIOCBUF,RWK11            USE RWK11 AS TS BFR BASE S22028 74702400
*                                       REG                      S22028 74702700
         SR    R0,R0                    CLEAR LENGTH REGISTER   SA59536 74703000
         SR    RWRK1,RWRK1              CLEAR OFFSET REGISTER   SA59536 74704000
         IC    R0,BUFFLNTH              GET DATA LENGTH          S22028 74708000
         TM    TSBSTAT,TSB3270          TEST FOR 3270            S22028 74724000
         BZ    TSIN9050                 BRANCH IF NOT            S22028 74728000
         CH    R0,CC3270L               IS DATA LENGTH LESS THAN S22028 74729000
*                                       3                        S22028 74732000
         BNL   TSIN9020                 BRANCH IF NO             S22028 74736000
         BCTR  R0,R0                    SUBTRACT 1 FROM DATA     S22028 74740000
*                                       SIZE                     S22028 74744000
         LA    RWRK1,K1                 REMEMBER OFFSET          S22028 74748000
         B     TSIN9050                 GO BACK                  S22028 74752000
         SPACE 1                                                 S22028 74756000
TSIN9020 EQU   *                                                 S22028 74760000
         SH    R0,CC3270L               SUBTRACT 3 FROM DATA     S22028 74764000
*                                       SIZE                     S22028 74768000
         LA    RWRK1,K3                 REMEMBER OFFSET          S22028 74772000
         CLI   BUFFHDLN+K3(RWK11),SBA   IS FOURTH CHAR SBA       S22028 74776000
         BNE   TSIN9050                 BRANCH IF NOT            S22028 74780000
         SH    R0,CC3270L               SUBTRACT 3 MORE FROM     S22028 74784000
*                                       DATA SIZE                S22028 74788000
         LA    RWRK1,K3(R0,RWRK1)       REMEMBER OFFSET          S22028 74792000
         SPACE 1                                                 S22028 74796000
TSIN9050 EQU   *                                                 S22028 74800000
         BR    RWK15                    RETURN TO CHECK DATA     S22028 74804000
*                                       LENGTH                   S22028 74808000
         DROP  RTSB,RWK11               DROP BASE REGS           S22028 74812000
         EJECT                                                          74816000
*********************************************************************** 74820000
********                                                       ******** 74824000
******** THE FOLLOWING SECTION CODE IS USED BY THE LOGOFF AND  ******** 74828000
******** HANGUP ROUTINES (IEDAYOO AND IEDAYHH) TO REMOVE THE   ******** 74832000
******** USERS TERMINAL FROM THE SYSTEM LWAIT CONDITION AND    ******** 74836000
******** RETURN ANY TCAM BUFFERS WHICH ARE ASSOCIATED WITH     ******** 74840000
******** THIS TERMINAL AND ARE ON THE TCAM BUFFER WAIT QUEUE.  ******** 74844000
******** THE ENTRY POINT INTO THIS CODE IS QTIP0280.           ******** 74848000
********                                                       ******** 74852000
******** INPUT REGISTERS -                                     ******** 74856000
********                                                       ******** 74860000
********       REG 7 -  ADDR OF THE TERMINAL DESTINATION QCB.  ******** 74864000
********       REG 9 -  ADDRESS OF THE CURRENT TSB.            ******** 74868000
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 74872000
********                                                       ******** 74876000
*********************************************************************** 74880000
QTIP0280 EQU   *                                                        74884000
         USING IEDQQCB,RQCB             USE RQCB AS TERM QCB BASE REG   74885000
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   74888000
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REGISTER   74892000
         TM    QCBTSOF2,QCBBUFQ         HOLDING TCAM BFRS FOR THIS TERM 74896000
         BCR   ZEROS,RETRN              RETURN TO CALLER IF NOT         74900000
         L     RWK15,CVTPTR             GET CVT ADDRESS                 74904000
         L     RWK15,CVTAQAVT-CVT(R0,RWK15)    GET TCX ADDR     YS02019 74908000
         L     RWK15,TCXRPT-IEDQTCX(,RWK15)    GET TIOCRPT ADDR YS02019 74912000
         USING TIOCRPT,RWK15            USE RWK15 AS TIOCRPT BASE REG   74916000
         STM   RWRK1,RWRK3,TIOCSAVE     SAVE CALLER'S REGISTERS 1-3     74920000
         STM   RTCBFR,RETRN,TIOCSAVE+K12  SAVE CALLER'S REGISTERS 6-14  74924000
         LA    RTSB,K0(R0,RTSB)         CLEAR HI-ORDER BYTE OF REG      74928000
         USING IEDQTSI,RWRK8            USE RWRK8 AS TSINPUT'S QCB BASE 74932000
         L     RWRK8,AVTTSOPT           GET ADDR OF TSINPUT'S QCB       74936000
         LA    RWRK8,TSIBUFQ            GET ADDR OF TCAM BFR WAIT QUEUE 74940000
         DROP  RWRK8                    DROP RWRK8 AS TSINPUT QCB BASE  74944000
         SPACE 2                                                        74948000
********                                                                74952000
******** REMOVE ALL TCAM BUFFERS FROM THE BUFFER WAIT QUEUE WHICH ARE   74956000
******** ASSOCIATED WITH THIS TERMINAL AND RETURN THEM TO TCAM.         74960000
********                                                                74964000
TSIN7000 EQU   *                                                        74968000
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 74972000
         L     RTCBFR,K0(R0,RWRK8)      GET NEXT TCAM BFR ON WAIT QUEUE 74976000
         LA    RTCBFR,K0(R0,RTCBFR)     CLEAR HI-ORDER BYTE OF REGISTER 74980000
         LTR   RTCBFR,RTCBFR            ANY MORE TCAM BFR ON WAIT QUEUE 74984000
         BZ    TSIN7050                 RETURN TO CALLER IF NOT         74988000
         L     RWRK2,PRFQCBA-K1         GET TSB ASSOCIATED WITH BFR     74992000
         LA    RWRK2,K0(R0,RWRK2)       CLEAR HI-ORDER BYTE OF REGISTER 74996000
         CR    RTSB,RWRK2               DOES BFR BELONG TO CURRENT TSB  75000000
         BE    TSIN7030                 BRANCH IF YES TO RETURN BUFFER  75004000
         LA    RWRK8,PRFLINK-K1         PT TO ADDR OF NEXT BFR ON QUEUE 75008000
         B     TSIN7000                 BR TO CONT SCAN OF WAIT QUEUE   75012000
         SPACE 2                                                        75016000
********                                                                75020000
******** TPOST TCAM BUFFER TO THE BUFFER RETURN QCB VIA THE TCAM        75022000
******** DISPATCHER.                                                    75028000
********                                                                75030000
TSIN7030 EQU   *                                                        75036000
         MVC   K1(K3,RWRK8),PRFLINK     REMOVE BFR FROM WAIT QUEUE      75038000
         XC    PRFLINK,PRFLINK          CLEAR LINK FIELD OF BFR         75040000
         LA    RWRK3,AVTBFRTB           GET ADDR OF BFR RETURN QCB      75044000
         ST    RWRK3,PRFQCBA-K1         TPOST BFR TO BFR RETURN QCB     75046000
         MVI   PRFPRI,PRIBFRTB          GIVE PRIORITY                   75052000
         USING IEDQDISP,RWK11           RWK11 AS TCAM DISP BASE         75054000
         L     RWK11,AVTEA              ADDR OF TCAM DISPATCHER         75060000
         LR    RWK1,RTCBFR              TCAM BFR TO BE RETU    @ZA03667 75062000
         BAL   RETRN,DSPPOSTR           RETURN BFR VIA TCAM             75068000
         B     TSIN7000                 BR TO CONT SCAN OF WAIT QUEUE   75070000
         SPACE 2                                                        75076000
********                                                                75078000
******** INDICATE ALL TCAM BUFFERS HAVE BEEN REMOVED FROM THE BUFFER    75084000
******** WAIT QUEUE WHICH ARE ASSOCIATED WITH THE CURRENT TSB, AND      75087000
******** RETURN TO THE CALLER.                                          75090000
********                                                                75093000
TSIN7050 EQU   *                                                        75100000
         NI    QCBTSOF2,OFF-QCBBUFQ     NO MORE BFRS IN Q FOR THIS TSB  75104000
         LM    RWRK1,RWRK3,TIOCSAVE     RESTORE CALLER'S REGISTERS 1-3  75108000
         LM    RTCBFR,RETRN,TIOCSAVE+K12  RESTORE CALLER'S REGS 6-14    75112000
         BR    RETRN                    RETURN TO CALLER                75116000
         DROP  RTCBFR,RQCB,RTSB,RAVT,RWK15  DROP CONTROL BLK BASE REGS  75120000
         SPACE 2                                                 S21008 75124000
**********************************************************************  75128000
********                                                                75132000
******** CONSTANTS                                                      75136000
********                                                                75140000
**********************************************************************  75144000
QIOEPA   DC    V(IEDAYQIO)              IWAIT REMOVAL RTN'S EPA YS02019 75148000
QIOBASE  DC    V(QTIP0110)              IWAIT REMOVAL RTN'S BASE S21008 75152000
ONE      DC    H'1'                     USED TO DETERMINE DATA   S22028 75156000
*                                       SIZE                     S22028 75160000
CC3270L  DC    H'3'                     USED TO SKIP 3270        S22028 75164000
*                                       CONTROL CHAR             S22028 75168000
QBAADDR  DC    V(IEDAYQBA)              BFR ALLOCATION RTN EPA  YS02019 75172000
QBRADDR  DC    V(IEDAYQBR)              ADDR OF BFR RETURN RTN  YS02019 75176000
TPPRI    DC    AL1(PRIBFRTB)            TPOST PRIORITY                  75180000
PATCH    DC    10F'0'                   PATCH AREA FOR IEDAYII  ZA01370 75184000
         SPACE 1                                                        75188000
         EJECT                                                          75200020
*********************************************************************** 75300020
********                                                       ******** 75400020
******** DSECTS                                                ******** 75500020
********                                                       ******** 75600020
*********************************************************************** 75700020
         SPACE 1                                                        75800020
********                                                                75900020
******** AVT - ADDRESS VECTOR TABLE                                     76000020
********                                                                76100020
         SPACE 1                                                        76200020
         TAVTD                                                          76300020
         EJECT                                                          76400020
********                                                                76500020
******** TIOCBUF - TIOC BUFFER FORMAT                                   76600020
********                                                                76700020
         SPACE 1                                                        76800020
         IKJTIOCB                                                       76900020
         EJECT                                                          77000020
********                                                                77100020
******** CVT - COMMUNICATIONS VECTOR TABLE                              77200020
********                                                                77300020
         SPACE 1                                                        77400020
CVT      DSECT                                                          77500020
         CVT                                                            77600020
         EJECT                                                          77700020
********                                                                77707020
******** DCB - DATA CONTROL BLOCK                                       77714020
********                                                                77721020
         SPACE 1                                                        77728020
         DCBD  DSORG=TX                                                 77735020
         EJECT                                                          77742020
********                                                                77749020
******** TCAM DISPATCHER                                                77756020
********                                                                77763020
         SPACE 1                                                        77770020
         TDISPD                                                         77777020
         EJECT                                                          77784020
********                                                                77800020
******** LCB - LINE CONTROL BLOCK                                       77900020
********                                                                78000020
         SPACE 1                                                        78100020
         TLCBD                                                          78200020
         EJECT                                                          78300020
********                                                                78400020
******** TCAM BUFFER PREFIX                                             78500020
********                                                                78600020
         SPACE 1                                                        78700020
         TPRFD                                                          78800020
         EJECT                                                          78900020
********                                                                79000020
******** TCAM BUFFER PRIORITIES                                         79100020
********                                                                79200020
         SPACE 1                                                        79300020
         TPRIOR                                                         79400020
         EJECT                                                          79500020
********                                                                79600020
******** QCB - DESTINATION QUEUE ELEMENT CONTROL BLOCK                  79700020
********                                                                79800020
         SPACE 1                                                        79900020
         TQCBD                                                          80000020
         EJECT                                                          80100020
********                                                                80200020
******** SCB - STATION CONTROL BLOCK                                    80300020
********                                                                80400020
         SPACE 1                                                        80500020
         TSCBD                                                          80600020
         EJECT                                                          80700020
********                                                                80800020
******** TCB - TASK CONTROL BLOCK                                       80900020
********                                                                81000020
         SPACE 1                                                        81100020
         IKJTCB                                                         81200020
         EJECT                                                          81230000
         TTCXD                                                  YS02019 81260000
         EJECT                                                          81300020
********                                                                81400020
******** TIOCRPT - TIOC REFERENCE POINTER TABLE                         81500020
********                                                                81600020
         SPACE 1                                                        81700020
         IKJTIOCP                                                       81800020
         EJECT                                                          81900020
********                                                                83200020
******** TERMINAL ENTRY TABLE                                           83300020
********                                                                83400020
         SPACE 1                                                        83500020
         TTRMD                                                          83600020
         EJECT                                                          83700020
********                                                                83800020
******** TSB - TERMINAL STATUS BLOCK                                    83900020
********                                                                84000020
         SPACE 1                                                        84100020
         IKJTSB                                                         84200020
         EJECT                                                          84300020
********                                                                85000020
******** DESTINATION QCB FOR TSINPUT                                    85100020
********                                                                85200020
         SPACE 1                                                        85300020
         TTSID                                                          85400020
         END                                                            85500020
./  ADD  SSI=81000362,NAME=IEDAYLL
         TITLE 'IEDAYLL - TIOC LOGON QTIP'                              00200002
IEDAYLL  CSECT                                                          00400020
         ENTRY QTIP0100                                                 00600020
         DC    C'IEDAYLL '              MODULE ID                       00640020
         DC    X'7203'             JULIAN DATE-07/22/77 G32TKKM ZA25074 00660000
         DS    0H                                                       00720020
         SPACE 3                                                        00800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00900020
*                                                                     * 01000020
*                                                                     * 01100020
*    NAME - IEDAYLL, TIOC LOGON'S SECTION OF QTIP SVC                 * 01200020
*                                                               ZA25074 01210000
*A270600,428360,429600,632000,812900                            ZA25074 01220000
*C254000,332500,428340,429700,438600,440000,550500,576000       ZA25074 01230000
*C588000,594500                                                 ZA25074 01240000
*D428380-428397                                                 ZA25074 01250000
*                                                                     * 01300020
*    VS/2-2 ACTIVITY                                                  * 01350002
*                                       02/19/73                VS00022 01360002
*                                       07/02/73                YM01114 01362002
*    VS2-3.0 ACTIVITY                                                 * 01364003
*C006800,194500                         08/22/74                ZA00966 01366003
*                                                                     * 01366300
*              VS2 - 037   ACTIVITY                            @ZA1251  01366600
*                                                              @ZA1251  01366900
*                                                              @ZA1251  01367200
*  A 272XXX                                                     ZA12511 01367500
*                                                              @ZA1251  01367800
*    VS2-MVS SU ACTIVITY                                              * 01368100
* A 132500,134700,166500,260500-261500   07/15/76       G32TKKM ZA16608 01368400
* A 632221-632234,779640,779660,809100   07/15/76       G32TKKM ZA16608 01368700
* A 809200                               07/15/76       G32TKKM ZA16608 01369000
*                                                                     * 01370002
*    RELEASE 21 DELETIONS/CHANGES                                     * 01600020
*1374006800,439200,441000,443000,450000,478000,504000,530000,    S22028 01630002
*1374536000,546000,550000                                        S22028 01660002
*    RELEASE 20 DELETIONS/CHANGES                                     * 01700020
*                                                                TS1623 01800020
*                                                                 M2668 01900020
*                                                                 M2725 02000020
*                                                                 M4540 02100020
*0000006800,290000,330000                                        M5446  02150020
**************************************************************  ZA25074 02160000
* MODULE NAME = IEDAYII  (QTIP,TSO)                             ZA25074 02170000
*                                                               ZA25074 02175000
* DESCRIPTIVE NAME = TIOC LOGON ROUTINE IN QTIP SVC             ZA25074 02180000
*                                                               ZA25074 02185000
* STATUS = TCAM VERSION 10.0                                    ZA25074 02190000
*                                                                     * 02500020
* FUNCTION -                                                          * 02600020
*    PREPARE TSO CONTROL BLOCKS FOR A NEW USER                        * 02700020
*                                                                     * 02900020
* ENTRY POINTS -                                                      * 03000020
*         IEDAYLL, TO PERFORM LOGON PROCESSING THAT REQUIRES THE      * 03100002
*         LOCAL AND CMS LOCKS.                                        * 03150002
*                                                                     * 03200020
* INPUT -                                                             * 03300020
*    REGISTER  4 HAS LCB ADDRESS                                      * 03500020
*    REGISTER  6 HAS TCAM BUFFER ADDRESS                              * 03600020
*    REGISTER  7 HAS QCB ADDRESS                                      * 03700020
*    REGISTER  8 HAS TERMINAL ENTRY ADDRESS                           * 03800020
*    REGISTER 10 HAS TERMINAL CHARACTERISTICS TABLE ADDRESS           * 03900020
*    REGISTER 12 HAS BASE ADDRESS                                     * 04000020
*    REGISTER 14 HAS RETURN ADDRESS                                   * 04100020
*                                                                     * 04200020
* OUTPUT -                                                            * 04300020
*    REGISTER 15 CONTAINS RETURN CODE                                 * 04320002
*       0 - A TSB-ASCB PAIR HAS BEEN INITIALIZED                      * 04330002
*       4 - NO TSB FOUND, OR TS STOPPED - USER 'SICED'                * 04340002
*                                                                     * 04600020
* EXTERNAL REFERENCES -                                               * 04700020
*         POST, VIA BRANCH ENTRY AT CVT0PT01                          * 04800020
*         SYSTEM-INITIATED CANCEL VIA BRANCH                          * 04840002
*                                                                     * 04900020
* EXITS, NORMAL - BR 14, RETURN TO IEDAYL VIA IDAYQT                  * 04920002
*                                                                     * 04930002
* EXITS, ERROR  - NONE                                                * 04940002
*                                                                     * 05500020
* TABLES/WORK AREAS -                                                 * 05600020
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 05700020
*                                                                     * 05800020
* ATTRIBUTES -                                                        * 05900020
*    REENTRANT, REFRESHABLE, SUPERVISOR STATE, HOLDS TCAM'S KEY       * 05920002
*    AND KEY 0                                                        * 05930002
*                                                                     * 06100020
* CHARACTER CODE DEPENDENCY -                                         * 06200020
*    THE OPERATION OF THIS MODULE IS DEPENDENT  UPON CERTAIN INTERNAL * 06300020
*    REPRESENTATIONS OF ITS CHARACTER SET...IT IS ASSEMBLED IN EBCDIC * 06400020
*    AND MUST BE SPECIALLY MODIFIED IF RE-ASSEMBLY IN ANOTHER CHARAC- * 06500020
*    TER SET IS DESIRED.....THE FIELDS REQUIRE THIS TREATMENT BECAUSE * 06600020
*    THEY ARE REPRESENTED BY HEX VALUES AND ARE OTHERWISE UNPRINTABLE * 06700020
*    THESE FIELDS ARE - TWXLD, TWXCD, AND T4150CD                     * 06800020
*                                                                     * 06900020
* NOTES -                                                             * 07000020
*    REGISTER EQUATES START WITH 'R'                                  * 07100020
*    LENGTH AND DISPLACEMENT EQUATES START WITH 'E'                   * 07200020
*                                                                     * 07300020
*                                                                     * 07400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07500020
         EJECT                                                          12400020
********                                                                12600020
******** REGISTERS                                                      12800020
********                                                                13000020
R0       EQU   0                        REGISTER 0              YS02019 13050002
RTERM    EQU   1                        TERMINAL ENTRY ADDR             13200020
RLNTH    EQU   1                   LENGTH OF TERM ID            ZA16608 13250000
RTCX     EQU   2                        TCX ADDRESS             YS02019 13460002
RAVT     EQU   2                   TCAM AVT ADDRESS             ZA16608 13470000
RASCB    EQU   3                        ASCB ADDRESS            YS02019 13490002
RLCB     EQU   4                        LCB ADDRESS                     13800020
RUCB     EQU   5                        UCB ADDRESS                     14000020
RBUF     EQU   6                        BUFFER ADDRESS                  14200020
RWORKA   EQU   6                        WORK REGISTER                   14400020
RQCB     EQU   7                        QCB ADDRESS                     14600020
RWORKB   EQU   7                        WORK REGISTER                   14800020
RRPT     EQU   8                        TIOCRPT ADDR AND TERMINAL ENTRY 14900020
*                                       ADDR AT ENTRY                   15000020
RTSB     EQU   9                        TSB ADDRESS                     15200020
RCH      EQU   10                       WORK REG & TCT ADDR AT ENTRY    15400020
RIS      EQU   11                       WORK REGISTER                   15600020
RBASE    EQU   12                       BASE ADDRESS                    15800020
R13      EQU   13                       TJID FOR POST ROUTINE           16000020
R14      EQU   14                       RETURN ADDRESS                  16200020
R15      EQU   15                       POST ADDR & PASS TJID TO IEDAYL 16400020
RTCT     EQU   15                       TCT ADDRESS                     16600020
RTNT     EQU   15                  TNT ENTRY ADDRESS            ZA16608 16650000
         SPACE 3                                                        16800020
********                                                                17000020
******** MASKS                                                          17200020
********                                                                17400020
E0       EQU   0                        GIVE OFFSET OF 0         Y06327 17450002
E1       EQU   1                        GIVES A VALUE OF 1              17800020
E2       EQU   2                        GIVES A VALUE OF 2              18000020
E3       EQU   3                        GIVES A VALUE OF 3              18200020
E4       EQU   4                        GIVES A VALUE OF 4              18400020
E16      EQU   16                       GIVES VALUE OF 16       ZA25074 18420000
TIMES4   EQU   2                        SHIFT VALUE FOR TIMES 4 YS02019 18450002
E100     EQU   100                      GIVES A VALUE OF 100            18800020
DEBEXSCL EQU   2                        COMM DEVICE DEB EXTENT SCALE    19200020
DEBSIZE  EQU   32                       SIZE OF BASIC SECTION OF DEB    19400020
NOFLAGS  EQU   X'0F'                    ZEROS UCB CHANNEL FLAGS ZA00966 19450003
MODEL    EQU   16                       OFFSET TO UCB MODEL FIELD       19600020
UNITTYPE EQU   19                       OFFSET TO UCB UNIT TYPE FIELD   19800020
TELE     EQU   X'50'                    TELEGRAPH ADAPTER (UCB)         20100020
C1050    EQU   X'80'                    1050 TERMINAL (TCT)      Y06327 20400002
TERMADPT EQU   X'10'                    ADAPTER FOR 1050 TERMINAL (UCB) 20600020
NON1050A EQU   X'E0'                    ADAPTER FOR NON-1050 TERM (UCB) 20800020
TWX      EQU   X'20'                    TWX TERMINAL (TCT)              21000020
C2260    EQU   X'02'                    2260 TERMINAL (TCT)             21200020
C3270    EQU   X'04'                    3270 TERMINAL (TCT)      S22028 21300002
C2741    EQU   X'08'                    2741 TERMINAL (TCT)             21400020
C5041    EQU   X'10'                    1050/2741 LINE (TCT)            21430020
TELELNSZ EQU   72                       LINE SIZE OF TELEGRAPH TERMINAL 21460020
REGLNSZ  EQU   120                      LINE SIZE OF NON-TELEGRAPH TERM 21520020
TWXLD    EQU   X'18'                    LD CHAR FOR TWX                 21600020
TWXCD    EQU   X'6D'                    CD CHAR FOR TWX                 21800020
T4150CD  EQU   X'16'                    CD CHAR FOR 2741 AND 1050       22000020
NODEFALT EQU   X'00'                    DENOTES NO LD/CD DEFAULT CHARS  22200020
TMMASK   EQU   X'80'                    TESTS TRMDEVFL BITS             22400020
NOMASK   EQU   X'00'                    NULL MASK FOR EX TM INSTR       22600020
BITPOS7  EQU   7                        POS OF SCRSIZE BIT IN TRMDEVFL  22900020
NOT      EQU   X'FF'                    TURNS OFF VARIOUS BITS          23400020
         SPACE 3                                                        23600020
* * * * * * * * * * * * *  SET UP ADDRESSES * * * * * * * * * * * * * * 23800020
         SPACE 3                                                        24000020
********                                                                24200020
******** ESTABLISH ADDRESSABILITY                                       24400020
********                                                                24600020
QTIP0100 EQU   *                                                        24800020
         USING *,RBASE                                                  25000020
         LR    RTERM,RRPT               TERM ENT ADDR PASSED IN RRPT    25200020
         USING IEDNTRM,RTERM                                    ZA25074 25250000
         L     RTCX,CVTPTR              GET PTR TO CVT          YS02019 25440002
         L     RTCX,CVTAQAVT-CVT(,RTCX) GET PTR TO TCX          YS02019 25460002
         USING IEDQTCX,RTCX                                     YS02019 25480002
         L     RRPT,TCXRPT              RPT PTR FROM TCX        YS02019 25500002
         USING TIOCRPT,RRPT                                             26000020
         L     RAVT,TCXAVT         GET ADDRESS OF AVT           ZA16608 26050000
         DROP  RTCX                TCX NO LONGER NEEDED         ZA16608 26100000
         USING IEDQAVTD,RAVT       AVT IS ADDRESSABLE           ZA16608 26150000
         USING IEDQLCB,RLCB             LCB ADDR PASSED BY IEDAYL       26600020
         USING IEDQPRF,RBUF             TCAM BFR ADDR PASSED BY IEDAYL  26800020
         USING IEDQQCB,RQCB             QCB ADDR PASSED BY AYL  YS02019 26850002
         LR    RTCT,RCH                 SAVE TCT ADDR PASSED BY IEDAYL  27000020
         SPACE 3                                                YS02019 27010002
********                                                                27045002
******** FIND AN UNUSED TSB, AND USE IT.                                27050002
********                                                                27055002
         L     RTSB,TIOCTSB-E1          INITIAL POINTER         YS02019 27060002
         LA    RCH,TRMPRFSZ             GET SIZE OF TTE INDEX   ZA25074 27061000
         SR    RTERM,RCH                BACK UP TO TTE PREFIX   ZA25074 27062000
         SR    RCH,RCH                  FOR INSERTION           YS02019 27065002
         IC    RCH,TIOCTSBS             GET TSB SIZE            YS02019 27067002
         LR    R0,RCH                   SAVE SIZE               YS02019 27070002
         LH    RIS,TIOCNTSB             GET NO. OF TSB'S        YS02019 27080002
         BCTR  RIS,0                    SUBTRACT 1 FOR LAST TSB YS02019 27082002
         MR    RCH,RCH                  MULT BY SIZE, TO GET    YS02019 27084002
*                                       OFFSET OF LAST TSB      YS02019 27086002
         LR    RCH,R0                   RESTORE SIZE            YS02019 27088002
         AR    RIS,RTSB                 GET PTR TO LAST TSB     YS02019 27090002
* RCH= TSB SIZE, RIS= LAST TSB, RTSB= FIRST TSB AND CURRENT TSB YS02019 27095002
CHKTHIS  EQU   *                                                YS02019 27100002
         USING TSB,RTSB                                         YS02019 27105002
         L     RASCB,TSBASCB-E1         GET POINTER FOR TEST    YS02019 27110002
         LTR   RASCB,RASCB              CHECK FOR 0, WHICH      YS02019 27120002
*                                       MEANS TSB UNUSED        YS02019 27125002
         BNZ   NEXT                     IN USE,TRY AGAIN        YS02019 27130002
         TM    TSBTPFLG,TSBPOSTO        IS TPOST OUTSTANDING    YM03998 27132002
         BZ    EUREKA                   NO,ALLOCATE TSB         YS02019 27134002
NEXT     EQU   *                                                YS02019 27134402
         BXLE  RTSB,RCH,CHKTHIS         ADD SIZE TO CURRENT PTR YS02019 27135002
*                                       CHECK FOR END OF TABLE, YS02019 27140002
*                                       BRANCH IF NOT END       YS02019 27145002
         L     RCH,CVTPTR               GET CVT ADDRESS         YM03998 27145402
         USING CVT,RCH                  CVT ADDRESSABLE         YM03998 27145802
         L     RCH,CVTASVT              GET ASVT ADDRESS        YM03998 27147002
         DROP  RCH                      ADDRESSABILITY ENDS     YS03998 27149002
         USING ASVT,RCH                 ASVT ADDRESSABLE        YM03998 27149402
         LH    RIS,QCBTJID              GET ASID                YM03998 27149802
         SLL   RIS,E2                   GET OFFSET IN ASVT      YM03998 27149902
         L     RASCB,ASVTENTY-L'ASVTENTY(RIS)  GET ASCB ADDRESS YM03998 27199902
         MODESET EXTKEY=SUPR                                    ZA12511 27219900
         B     CALLSIC                  GO CANCEL IF NO TSB     YS02019 27249902
         DROP  RCH                      ASVT NOT ADDRESSABLE    YM03998 27259902
         SPACE 3                                                YS02019 27299902
********                                                        YS02019 27349902
******** AT THIS POINT, RTSB HAS THE TSB ADDRESS                YS02019 27399902
********                                                        YS02019 27449902
EUREKA   EQU   *                                                YS02019 27499902
         SPACE 3                                                        32600020
********                                                                32800020
******** GET UCB ADDRESS TO INITIALIZE TSB                              33000002
********                                                                33200020
         TM    TRMSTATE,TRMPREF         NCP ATTACHED TERM       ZA25074 33220000
         BO    NOUCB                    YES,DON'T WANT UCB       Y06327 33300002
         L     RCH,LCBDCBPT             GET DCB ADDR                    33400020
         L     RIS,DCBDEBAD-IHADCB(0,RCH)    GET DEB ADDR               33600020
         SR    RCH,RCH                  ZERO REG                        33800020
         IC    RCH,LCBUCBX              GET UCB INDEX                   34000020
         SLL   RCH,DEBEXSCL             GET PROPER DEB EXTENT OFFSET    34200020
         LA    RCH,DEBSIZE(RCH,RIS)     POINT TO END OF BASIC DEB AND   34400020
*                                       ADD DEB EXTENT OFFSET VALUE     34600020
         L     RUCB,0(0,RCH)            GET UCB ADDR                    34800020
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y06327 34802002
NOUCB    EQU   *                                                 Y06327 34810002
         SPACE 3                                                YS02019 34820002
* * * * * * * * * * * * * * *  FIND ASCB * * * * * * * * * * * * * * *  34870002
         SPACE 3                                                YS02019 34920002
         LH    RASCB,QCBTJID            GET ASID                YS02019 34970002
         L     RIS,CVTPTR               ADDRESSABILITY ON CVT   YS02019 35020002
         USING CVT,RIS                                          YS02019 35030002
         SLA   RASCB,TIMES4             GET OFFSET OF ENTRY     YS02019 35070002
         L     RIS,CVTASVT              GET ADDRESS OF ASVT     YS02019 35120002
         DROP  RIS                                              YS02019 35170002
         USING ASVT,RIS                                         YS02019 35220002
         L     RASCB,ASVTENTY-L'ASVTENTY(RASCB) ASCB ADDR       YS02019 35270002
         USING ASCB,RASCB                                       YS02019 35320002
         DROP  RIS                                              YS02019 35370002
         SPACE 3                                                YS02019 35420002
* * * * * * * * * * * * *  TSB INITIALIZATION * * * * * * * * * * * * * 40000020
         SPACE 3                                                        40200020
********                                                                40400020
******** REFRESH TSB TO AN UNUSED STATE                                 40600002
********                                                                40800020
         XC    TSB(TSBEND-TSB),TSB      ZERO WHOLE TSB                  40900020
         SPACE 3                                                YS02019 41000002
********                                                        YS02019 41050002
******** PUT ASCB ADDRESS IN TSB, TSB ADDRESS IN ASCB           YS02019 41060002
********                                                        YS02019 41070002
         MODESET EXTKEY=SUPR            GET KEY OF ASCB         YS02019 41072002
         ST    RTSB,ASCBTSB             STORE TSB ADDR          YS02019 41080002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 41082002
         ST    RASCB,TSBASCBA           STORE ASCB ADDR         YS02019 41090002
         SPACE 3                                                        41092002
********                                                        YS02019 41100002
******** UPDATE TIOC USER COUNT                                 YS02019 41200002
********                                                        YS02019 41300002
         L     RCH,TIOCUSCT-E2          GET ENTIRE WORD         YS02019 41400002
UPCOUNT  EQU   *                                                YS02019 41500002
         LR    RIS,RCH                  COPY USER COUNT         YS02019 41600002
         LA    RIS,E1(,RIS)             ADD 1 (WIPES OUT FLG)   YS02019 41700002
         CS    RCH,RIS,TIOCUSCT-E2      STORE IF NOT CHANGED    YS02019 41800002
         BNE   UPCOUNT                  RECOMPUTE IF CHANGED    YS02019 41900002
         STCM  RCH,B'1000',TIOCFLG      RESTORE TIOCFLG         YS02019 41950002
         SPACE 3                                                        42000020
********                                                                42200020
******** TURN ON TSBINUSE                                               42400020
********                                                                42600020
         OI    TSBSTAT,TSBINUSE         DENOTE TSB IS BEING USED        42800020
         LR    R0,RQCB                  SAVE QCB POINTER        YM01114 42810002
         SPACE 2                                                        42810102
**************************************************************  ZA25074 42814100
*        FOR TERMINALS ATTACHED VIA A NCP THE TCAM NETWORK      ZA25074 42820000
*        ADDRESS CONVERT ROUTINE IS USED TO CONVERT THE         ZA25074 42821000
*        TERMINAL NAME TABLE (TNT) INDEX TO A NETWORK ADDRESS   ZA25074 42822000
*        FOR SAVING IN THE TSB LINE ADDRESS FIELD.              ZA25074 42823000
**************************************************************  ZA25074 42824000
         TM    TRMSTATE,TRMPREF         NCP ATTACHED TERM       ZA25074 42830000
         BZ    NORSID                   NO,DON'T USE RESRCE  ID  Y06327 42836002
         STM   R14,RTERM,E4(RTSB)       SAVE REGS USED BY       ZA25074 42836100
*                                       NETWORK ADDRESS         ZA25074 42836200
*                                       CONVERT ROUTINE         ZA25074 42836300
         LH    RTERM,LCBTTCIN           GET TNT INDEX           ZA25074 42836400
         L     R15,CVTPTR               GET CVT                 ZA25074 42836500
         USING CVT,R15                                          ZA25074 42836600
         L     R15,CVTAQAVT             GET TCX                 ZA25074 42836700
         DROP  R15                                              ZA25074 42836800
         USING IEDQTCX,R15                                      ZA25074 42836900
         L     R15,TCXAVT               GET AVT                 ZA25074 42837000
         DROP  R15                                              ZA25074 42837100
         USING IEDQAVTD,R15                                     ZA25074 42837200
         L     R15,AVTSAVTP             GET SAVT                ZA25074 42837300
         DROP  R15                                              ZA25074 42837400
         USING IEDNSVTD,R15             SAVT ADDRESSABILITY     ZA25074 42837500
         L     R15,SAVTTNTX             GET ADDRESS OF THE      ZA25074 42837600
*                                       NETWORK ADDRESS         ZA25074 42837700
*                                       CONVERT ROUTINE         ZA25074 42837800
         BALR  R14,R15                  GET NETWORK ADDRESS     ZA25074 42837900
         DROP  R15                                              ZA25074 42838000
         STH   R15,TSBLINE              PUT NETWORK ADDRESS IN  ZA25074 42838100
*                                       TSB                     ZA25074 42838200
         LM    R14,RTERM,E4(RTSB)       RESTORE SAVED REGS      ZA25074 42838400
         XC    E4(E16,RTSB),E4(RTSB)    REINIT TSB              ZA25074 42838500
         B     TEST3270                 CHECK FOR 3270           Y06327 42839702
NORSID   EQU   *                                                 Y06327 42839802
         MVC   TSBLINE,UCBCHAN          SAVE CHAN & UNIT ADDR   YS02019 42839902
         NI    TSBLINE,NOFLAGS          REMOVE CHAN FLGS IF ANY  Y06327 42853202
         SPACE 3                                                        42863202
********                                                                42880002
******** IF 3270, TURN ON TSB3270                                       42920002
********                                                                42960002
TEST3270 EQU   *                                                 Y06327 42970002
         USING IEDDCT,RTCT              DCT ADDRESSABILITY      ZA25074 42980000
         TM    DCTBYTE1,DCT3270         3270 TERMINAL           ZA25074 42990000
         BZ    CHK2260                  NO - CHK FOR 2260        S22028 43040002
SET3270  EQU   *                                                 S22028 43080002
         OI    TSBSTAT,TSB3270          DENOTE A 3270 TERMINAL   S22028 43120002
         B     SETDSPLY                 GO FINISH 3270 INIT      S22028 43160002
         SPACE 3                                                        43200020
********                                                                43400020
******** IF 2260, TURN ON TSBDSPLY                                      43600020
********                                                                43800020
CHK2260  EQU   *                                                 S22028 43830002
         TM    DCTBYTE3,DCTNOIDL        2260R TERMINAL          ZA25074 43840000
         BO    SETDSPLY                 YES - INIT TSB           S22028 43920002
*                                       ACCORDINGLY              S22028 43960002
         TM    DCTBYTE2,DCTLOCAL        2260 LOCAL TERMINAL     ZA25074 43980000
         BZ    NOTDSPLY                 NO - CHK FOR TELE TERM   S22028 44100002
SETDSPLY EQU   *                                                 S22028 44300002
         OI    TSBSTAT,TSBDSPLY         DENOTE A DISPLAY STATION        44400020
         SPACE 3                                                        44600020
********                                                                44800020
******** FOR DISPLAY TERMINAL, COUNT THE NUMBER OF TRMDEVFL BITS THAT   45000002
******** ARE ON                                                         45100002
********                                                                45200020
         LA    RIS,BITPOS7              GET NUMBER OF BITS TO CHECK     45400020
         LR    RCH,RIS                  GET NUMBER OF BITS TO CHECK     45600020
         LA    RWORKB,TMMASK            GET MASK FOR TM EX INSTR        45800020
         DROP  RQCB                     RWORKB SAME AS RQCB     YS02019 45850002
CHKBITS  EQU   *                                                        46000020
         EX    RWORKB,TESTBITS          IS THIS TRMDEVFL BIT ON         46200020
         BO    SHIFTMSK                 YES - DON'T DECR NO. OF BITS ON 46400020
         BCTR  RIS,0                    DECR NUMBER OF BITS ON          46600020
SHIFTMSK EQU   *                                                        46800020
         SRL   RWORKB,E1                SHIFT MASK RIGHT ONE            47000020
         BCT   RCH,CHKBITS              BRANCH IF ALL BITS NOT CHECKED  47200020
         SPACE 3                                                        47400020
********                                                                47600020
******** FOR DISPLAY TERMINAL, POINT PAST TERMINAL ENTRY OPTION FIELDS, 47800002
******** IF ANY                                                         47900002
********                                                                48000020
         LA    RWORKB,TRMOPNO           ADDR OF NUMBER OF OPTIONS       48200020
*                                       IF ANY; OTHERWISE, ADDR OF      48400020
*                                       FIRST DEVICE DEPENDENT FIELD    48600020
         SR    RCH,RCH                  ZERO REG FOR IC INSTR           48800020
         TM    TRMSTATE,TRMOPTFN        ANY OPTION FIELDS               49000020
         BZ    CHECKDDF                 NO - CHECK FOR DEVICE FIELDS    49200020
         IC    RCH,TRMOPNO              GET NO. & SIZE OF OPTIONS       49400020
         LA    RWORKB,E3(RCH,RWORKB)    BUMP PAST REST OF TERMINAL      49600020
*                                       ENTRY (3) AND ANY OPTIONS (RCH) 49800020
         SPACE 3                                                        50000020
********                                                                50200020
******** FOR DISPLAY TERMINAL, POINT PAST TERMINAL ENTRY DEVICE         50400002
******** DEPENDENT FIELDS, IF ANY                                       50500002
********                                                                50600020
CHECKDDF EQU   *                                                        50800020
         LTR   RIS,RIS                  ANY TRMDEVFL BITS ON            51000020
         BZ    GETINFO                  NO - RWORKB NOW POINTS TO       51200020
*                                       FIRST DEVICE DEPENDENT FIELD    51400020
BUMPDDF  EQU   *                                                        51600020
         IC    RCH,0(0,RWORKB)          GET LNG OF DEVICE DEPENDENT FLD 51800020
         LA    RWORKB,E1(RCH,RWORKB)    BUMP PAST LENGTH FIELD (1) AND  52000020
*                                       DEVICE DEPENDENT FIELD (RCH)    52200020
         BCT   RIS,BUMPDDF              BRANCH IF MORE FIELDS TO SKIP   52400020
         SPACE 3                                                        52600020
********                                                                52800020
******** FOR DISPLAY TERMINAL, INIT TSBLNNO FROM TERMINAL ENTRY DEVICE  53000002
******** DEPENDENT FIELDS                                               53100002
********                                                                53200020
GETINFO  EQU   *                                                        53400020
         MVC   TSBLNNO,E1(RWORKB)       PUT NO. LINES INTO TSB   S22028 53600002
         SPACE 3                                                        53800020
********                                                                54000020
******** INITIALIZE TSBLNSZ ACCORDING TO TERMINAL TYPE                  54200020
********                                                                54400020
         MVC   TSBLNSZ,E2(RWORKB)       PUT LINE SIZE INTO TSB   S22028 54600002
         B     NULLSTCC                 GO SET TSBSTCC TO NO DEFAULT    54800020
NOTDSPLY EQU   *                                                 S22028 55000002
         TM    DCTBYTE2,DCTTWX          TELE TERMINAL           ZA25074 55020000
         BO    SMALLSIZ                 YES - SET TSBLNSZ TO 72         55400020
         LA    RCH,REGLNSZ              GET SIZE OF 120                 55600020
         B     SETLINE                  BR TO SPECIFY SIZE              55800020
SMALLSIZ EQU   *                                                        56000020
         LA    RCH,TELELNSZ             GET SIZE OF 72                  56200020
SETLINE  EQU   *                                                        56400020
         STC   RCH,TSBLNSZ              SPECIFY LINE SIZE IN TSB        56600020
         SPACE 3                                                        56800020
********                                                                57000020
******** INITIALIZE TSBSTCC ACCORDING TO TERMINAL TYPE                  57200020
********                                                                57400020
         TM    DCTBYTE2,DCTTWX          TWX TERMINAL            ZA25074 57450000
         BZ    CHKREST                  NO - CHK FOR 2741 OR 1050       57800020
         MVI   TSBLNDCC,TWXLD           SET TWX LD DEFAULT              58000020
         MVI   TSBCHDCC,TWXCD           SET TWX CD DEFAULT              58200020
         B     SETASRCE                 CONTINUE TSB INIT               58400020
CHKREST  EQU   *                                                        58600020
         TM    DCTBYTE1,DCT2741+DCT5041 2741 OR 1050 TERMINAL   ZA25074 58650000
         BNZ   SETBOTH                  YES - SET PROPER DEFAULT CHARS  59000020
CHK1050  EQU   *                                                        59400020
         TM    DCTBYTE3,DCT1050         IS IT A 1050            ZA25074 59420000
         BNO   NULLSTCC                 NO - DON'T DEFAULT       Y06327 60600002
         OI    TSBTERM2,TSBC1050        TERMINAL IS 1050        YS02019 60650002
SETBOTH  EQU   *                                                        60800020
         MVI   TSBCHDCC,T4150CD         SET 2741 AND 1050 CD DEFAULT    61000020
         OI    TSBSTAT,TSBATNLD         DENOTE ATTN FOR LD              61200020
         B     NULLLD                   INIT LD CHAR                    61400020
NULLSTCC EQU   *                                                        61600020
         MVI   TSBCHDCC,NODEFALT        DENOTE CD HAS NO DEFAULT        61800020
NULLLD   EQU   *                                                        62000020
         MVI   TSBLNDCC,NODEFALT        DENOTE LD HAS NO DEFAULT        62200020
         SPACE 3                                                        62400020
********                                                                62600020
******** SET TERMINAL INDEX AND CHARACTERISTICS                         62800002
********                                                                63000020
SETASRCE EQU   *                                                        63200020
         OC    TSBTERMC,E1(RTCT)        COPY TCT FIELDS         YS02019 63222002
         DROP  RTCT                                             ZA25074 63222200
         LH    RWORKB,PRFSRCE      GET TNT INDEX FROM BFR       ZA16608 63222400
         STH   RWORKB,TSBASRCE     PUT TNT INDEX IN TSB         ZA16608 63222600
         BCTR  RWORKB,R0           DECR INDEX FOR MULT.         ZA16608 63222800
         L     RTNT,AVTRNMPT       GET TNT ENTRY ADDRESS        ZA16608 63223000
*              TCT NO LONGER ADDRESSABLE                        ZA16608 63223200
         SR    RLNTH,RLNTH         ZERO THE REGISTER            ZA16608 63223400
         IC    RLNTH,X'28'(,RTNT)  GET ID LENGTH FROM TNT       ZA16608 63224000
         LA    RIS,E3              GET LENGTH OF ADDRESS        ZA16608 63224200
         AR    RIS,RLNTH           ADD ADR. FIELD TO LENGTH     ZA16608 63224400
         MR    RCH,RWORKB          MULT LNTH * OFFSET           ZA16608 63224600
         AR    RIS,RTNT            ADD START OF TNT             ZA16608 63224800
         MVC   TSBTRMID,BLANKS     BLANK OUT ID FIELD           ZA16608 63225000
         BCTR  RLNTH,R0            DECR TERM NAME LNTH          ZA16608 63225200
         EX    RLNTH,ANMVC         MOVE TERM ID TO TSB          ZA16608 63225400
         LR    RQCB,R0             RESTORE QCB POINTER          YM01114 63225600
         USING IEDQQCB,RQCB             QCB ADDRESSABLE         YM01114 63226002
         TM    QCBFLAG,QCBNOBRK         IS REVERSE BREAK        YM01114 63228002
*                                       FEATURE ALLOWED         YM01114 63228402
         BZ    POSTAY3                  YES, DON'T SET TSBNOBRK YM01114 63228802
         OI    TSBFLG3,TSBNOBRK         USE OF REVERSE BREAK    YM01114 63229202
*                                       FEATURE NOT ALLOWED     YM01114 63229602
         DROP  RQCB                     QCB NO LONG ADDRESSABLE YM01114 63229702
         SPACE 3                                                YS02019 63230002
********                                                        YS02019 63240002
******** GO TO POST ROUTINE, TO WAKE UP IEDAY3, WHICH COULD BE  YS02019 63250002
******** WAITING ON ASCBECB.                                    YS02019 63260002
********                                                        YS02019 63270002
POSTAY3  EQU   *                                                YM01114 63272002
         LA    RIS,ASCBECB                                      YS02019 63280002
         SR    RCH,RCH                  ZERO COMPLETION CODE    YS02019 75120002
         L     RWORKA,CVTPTR            LOAD CVT ADDRESS                75200020
         SPACE 2                                                YS02019 75250002
********                                                                75300002
******** FIND MASTER SCHEDULER'S ASCB FOR POST ROUTINE                  75350002
********                                                                75360002
         USING CVT,RWORKA               ADDRESS CVT                     75400020
         L     R13,CVTMSER              ADDRESS OF BASEA        YS02019 75490002
         L     R13,BAASCB-BASE(,R13)    ASCB OF MASTR SCHED     YS02019 75500002
         SPACE 2                                                YS02019 75518402
********                                                                75518802
******** CONTINUE SETTING UP REGISTERS FOR POST                         75519202
********                                                                75519602
         O     RIS,HIGHON               HI BIT SIGNALS XM POST  YS02019 75520002
         LR    R0,RBASE                 SAVE BASE REGISTER      YS02019 75530002
         LA    RBASE,CVTBRET            'ERRET' ADDRESS (BR14)  YS02019 75570002
         L     R15,CVT0PT01             LOAD POST ROUTINE ADDRESS       76400020
         LR    RWORKB,R14               SAVE RETURN ADDR                76600020
         DROP  RWORKA                                                   76800020
         MODESET EXTKEY=SUPR            GET KEY ZERO FOR POST           76850002
         BALR  R14,R15                  GO TO POST ROUTINE              77000020
         LR    RBASE,R0                 RESTORE BASE REGISTER   YS02019 77050002
         LR    R14,RWORKB               RESTORE RETURN ADDR     YM06501 77100002
         SPACE 3                                                        77200020
********                                                                77250002
******** CHECK FOR TS STOPPING OR ABENDING.  SIC THIS USER IF IT IS     77300002
********                                                                77350002
         TM    TIOCFLG,TIOCSTOP+TIOCTSAB CK FOR TERMINATION     YS02019 77360002
         BNZ   CALLSIC                  CALL CANCEL ROUTINE     YS02019 77370002
         DROP  RBASE                                            YS02019 77372002
         SPACE 3                                                YS02019 77380002
********                                                                77400020
******** RETURN TO TIOC LOGON (IEDAYL)                                  77600020
********                                                                77800020
         SR    R15,R15                  SET 0 RETURN CODE       YS02019 77812002
         BR    R14                      RETURN TO IEDAYQT       YS02019 77824002
         SPACE 3                                                YS02019 77830002
* * * * * * * * * *  CALL SIC TO CANCEL THIS USER  * * * * * * * * * *  77836002
********                                                        YS02019 77848002
******** USE BRANCH ENTRY TO SYSTEM-INITIATED CANCEL            YS02019 77854002
********                                                        YS02019 77860002
CALLSIC  EQU   *                                                YS02019 77866002
         USING QTIP0100,RBASE                                   YS02019 77868002
         L     RWORKA,CVTPTR            CVT ADDRESSABILITY      YS02019 77872002
         LA    R13,TIOCSAVE             GET SAVE AREA POINTER   YS02019 77874002
         L     R0,POSTCODE              'POST CODE' FOR SIC     YS02019 77876002
         USING CVT,RWORKA               CVT ADDRESSABLE         YS02019 77876402
         L     R15,CVTSIC               SIC ROUTINE ENTRY POINT YS02019 77878002
         DROP  RWORKA                   ADDRESSABILITY ENDS     YS02019 77880002
         LR    RTERM,RASCB              ASCB ADDR FOR SIC       YS02019 77882002
         LR    RWORKB,R14               SAVE RETURN ADDR        YS02019 77890002
         BALR  R14,R15                  GO TO SIC               YS02019 77896002
         SPACE 3                                                YS02019 77902002
********                                                        YS02019 77908002
******** SET RETURN CODE TO 4 AND RETURN                        YS02019 77914002
********                                                        YS02019 77920002
         LR    R14,RWORKB               RESTORE RETURN ADDRESS  YS02019 77926002
         LA    R15,E4                   SET CODE                YS02019 77932002
         BR    R14                      RETURN                  YS02019 77938002
         SPACE 3                                                YS02019 77944002
********                                                        YS02019 77950002
******** CONSTANTS                                              YS02019 77956002
********                                                        YS02019 77962002
BLANKS   DS    0F                  8 BYTES OF BLANKS USED       ZA16608 77964000
         DC    C'        '         TO BLANK OUT TSBTRMID        ZA16608 77966000
HIGHON   DS    0F                                               YS02019 77968002
         DC    X'80000000'              HIGH BIT FOR XMPOST     YS02019 77974002
POSTCODE DS    0F                       COMPLETION CODE FOR     YS02019 78024002
         DC    X'00000622'              TERMINATED MEMORY       YS02019 78074002
TESTBITS TM    TRMDEVFL,NOMASK          COUNT THE BITS THAT ARE ON      80000020
ANMVC    MVC   TSBTRMID(0),X'52'(RIS)                           ZA16608 80020000
PATCH    DC    10F'0'                   PATCH AREA              YM03998 80050002
         SPACE 3                                                        80400020
* * * * * * * * * * * *  CONTROL BLOCK DSECTS * * * * * * * * * * * * * 80600020
         SPACE 3                                                        80660002
         IHAASCB                                                        80720002
         EJECT                                                          80800002
         IHAASVT                                                YS02019 80850002
         EJECT                                                YS02019   80900002
         TAVTD                                                  ZA16608 80910000
         EJECT                                                  ZA16608 80920000
         IEEBASEA                                               YS02019 80950002
         EJECT                                                YS02019   80960002
CVT      DSECT                                                          81000020
         CVT                                                            81200020
         EJECT                                                YS02019   81260002
         TDCTD                                                  ZA25074 81270000
         EJECT                                                  ZA25074 81280000
         TTCXD                                                  YS02019 81290002
         EJECT                                                          81800002
         IKJTIOCP                                                       82000020
         EJECT                                                          82200002
         IKJTSB                                                         82400020
         EJECT                                                          83400002
         TLCBD                                                          83600020
         EJECT                                                          83800002
         TPRFD                                                          84000020
         EJECT                                                          84200002
         TQCBD                                                          84250002
         EJECT                                                          84300002
         DCBD  DSORG=TX                                                 84400020
         EJECT                                                          84600002
         TTRMD                                                          84800020
         EJECT                                                          84850002
UCB      DSECT                                                   Y06327 84860002
         IEFUCBOB LIST=YES                                       Y06327 84900002
         END                                                            85000020
./  ADD  SSI=81000363,NAME=IEDAYOO
         TITLE 'IEDAYOO - TSOUTPUT QTIP ROUTINES'                       00100020
IEDAYOO  CSECT                                                          00150002
*                                                                       00170002
*        VS2  3.0  SU                                                   00172037
*0000003600,491510,491520,516988                     UZ04353   @ZA10219 00173037
*0000003600,628523                                   UZ04353   @ZA10218 00173437
*0000072500,087000,268200-269110,270910-270950       UZ03998   @ZA08015 00173837
*0000280810-281700,509410-509460,519310                        @ZA08015 00174337
*0000627800-627800,628501-628527  QTIP 10 FIX                  @ZA07610 00174637
*0000193280                                                    @ZA05465 00174937
*0000054000,104002-104083                                      @ZA02242 00175237
*0000464100-464200                                             @ZA02256 00175537
*                                                                       00176037
*         RELEASE 3, VS/2, ACTIVITY                                     00180002
*   FOR APAR ZA00968, SEE ALSO SA70323.                         ZA00968 00190002
*A091500-092532                                                 ZA00968 00190402
*C003600                                                        ZA01350 00192002
*A612402,612406                                                 ZA01350 00200002
*D001600                                                        ZA01350 00200102
*         RELEASE 2, VS/2, ACTIVITY                                     00200302
*                                       02/19/73                VS00022 00200402
*                                       05/08/73                SJ00088 00200502
*                                       05/14/73                VS01090 00201902
*                                                                       00206002
*         RELEASE 1, VS/2, DELETIONS                            *       00207402
*D090200-090600,091100-091500,094500                             YM2814 00208802
*          RELEASE 21.8 CHANGES                                         00210902
*A002837-002845,079500-080000,698520-698540                     SA70323 00211002
*C028500-028550,084000-096920,104000-104030,439000-444500       SA70323 00211102
*C461000-464996,465000-496000,513000-516997                     SA70323 00211802
*D002342-002345,002634-002652,002837,013500-014500,104035-104080SA70323 00213802
*                                                                S22028 00215802
*                                                                S22029 00217802
*        STATUS  VS2  3.0   SU                                          00218237
*                                                                       00219800
* FUNCTION -- THIS CSECT IS A COLLECTION OF ROUTINES USED BY TSOUTPUT   00220700
*    (IEDAYO), OR SYSTEM-INITIATED CANCEL                               00221602
*    TO PERFORM FUNCTIONS WHICH MUST BE PERFORMED                       00222502
*    WHILE LOCKED.                                                      00224002
*                                                                       00224300
* ENTRY POINTS --                                                       00225200
*         QTIP0110 - MOVES A TSO MESSAGE FROM THE OUTPUT HEADER         00227000
*    QUEUE TO THE OUTPUT TRAILER QUEUE.                                 00227900
*         QTIP0120 - REMOVES FROM THE OUTPUT TRAILER QUEUE TS           00228800
*    BUFFERS FROM WHICH ALL DATA HAS BEEN SUCCESSFULLY SENT TO          00229700
*    THE TERMINAL.  IF THE NUMBER OF BUFFERS FREED PERMITS ANY          00230600
*    WAIT CONDITIONS TO BE REMOVED, THEY ARE REMOVED.                   00231500
*    QCBTPUT/QCBWRBRK ARE RESET UNLESS THERE ARE MORE MESSAGES TO BE    00232602
*    SENT.                                                              00234002
*         QTIP0130 - REFORMATS A TS MESSAGE TO ITS ORIGINAL FORMAT,     00235402
*    SO A MESSAGE IN ERROR MAY BE RESENT.                               00236802
*         QTIP0140 - CLEANS UP TSO CONTROL BLOCKS FOR LOGOFF AND        00238202
*    HANGUP SITUATIONS.                                                 00239602
*         QTIP0150 - MAKES A DISPLAY TERMINAL FLASHBACK MESSAGE OR      00241002
*    AN INPUT MESSAGE INTERRUPTED BY A BREAK-IN TPUT, RESIDING ON       00242402
*    THE INPUT QUEUE, RESIDE ALSO ON THE OUTPUT TRAILER QUEUE.          00243802
*         QTIP0160 - RESETS QCBTPUT/QCBWRBRK, DETECTS START AUTO        00245202
*    PROMPT REQUEST, AND TPOSTS LCB TO ITSELF.                          00246602
*         QTIP0240 - ENTERED FROM SYSTEM-INITIATED CANCEL ROUTINE       00248002
*    TO CHECK FOR AND REMOVE ASID OWAIT.                                00249402
*                                                                       00250802
*    THE CALLING SEQUENCE IS THE SAME FOR ALL ENTRY POINTS.             00252202
*    FOR ANY ENTRY POINT, QTIP0XX0, WHERE XX REPRESENTS THE DECIMAL     00253602
*    ENTRY NUMBER, THE CALLING SEQUENCE IS AS FOLLOWS:                  00255002
*        LA    0,XX          LOAD QTIP ENTRY NUMBER                     00256402
*        LA    1,SAVEAREA    POINT REG. 1 TO 12 WORD PARAMETER AREA     00257802
*        STM   2,13,0(1)     STORE REGISTERS IN PARAMETER AREA          00259202
*        SVC   101           ISSUE QTIP SVC                             00260602
*                                                                       00262002
* INPUT --                                                              00263402
*         QTIP0110 -                                                    00264802
*    REG. 7 - ADDRESS OF DESTINATION QCB                        ZA00968 00265202
*    REG. 8 - TSB ADDRESS                                               00266202
*    REG. 13 - ADDRESS OF AVTSAVE2                                      00267602
*         QTIP0120 -                                                    00269002
*    REG.  8 - ADDRESS OF TSB                                           00270402
*    REG. 10 - ADDRESS OF TIOCRPT                                       00271802
*    REG. 13 - ADDRESS OF AVTSAVE2                                      00273202
*    REG. 15 - ZERO MEANS QUEUE FLUSH ALLOWED                           00274602
*         QTIP0130 -                                                    00276002
*    REG. 7 - ADDRESS OF DESTINATION QCB                        ZA00968 00276402
*    REG. 8 - ADDRESS OF TSB                                            00277402
*    REG. 13 - ADDRESS OF AVTSAVE2                                      00278802
*         QTIP0140 -                                                    00280202
*    REG.  7 - ADDRESS OF DESTINATION QCB                               00281602
*    REG.  8 - ADDRESS OF TSB                                           00283002
*         QTIP0150 -                                                    00284402
*    REG. 8 - ADDRESS OF TSB                                            00285802
*         QTIP0160 -                                                    00287202
*    REG.  4 - ADDRESS OF LCB                                           00288602
*    REG.  7 - ADDRESS OF DESTINATION QCB                               00290002
*    REG.  8 - ADDRESS OF TSB                                           00291402
*    REG. 13 - ADDRESS OF AVTSAVE2                                      00292802
*         QTIP0170 -                                                    00294202
*    REG. 2 - ADDR OF TS BUFFER                                         00295602
*    REG. 15 - AMOUNT OF DATA MOVED FROM THIS BUFFER                    00297002
*         QTIP0240 -                                                    00298402
*    REG.  5 - ASID                                                     00299802
*                                                                       00301202
*    FOR ALL ENTRY POINTS REGISTER 12 IS THE BASE REGISTER AND          00302602
*    CONTAINS THE ADDRESS OF QTIP0110.                                  00304002
*                                                                       00305402
* OUTPUT --                                                             00306802
*         QTIP0110 - RETURN CODE IN REGISTER 15 -               SA70323 00308602
*    X'00' - NOTHING TO SEND                                    SA70323 00309002
*    X'04' - SOMETHING TO SEND                                  SA70323 00309402
*         QTIP0120 - NONE                                               00309602
*         QTIP0130 - NONE                                               00315202
*         QTIP0140 - NONE                                               00315602
*         QTIP0150 - NONE                                               00316602
*         QTIP0160 - RETURN CODE IN REGISTER 15 -                       00318002
*    X'00' - AUTO PROMPT STARTING NOT REQUESTED                         00319402
*    X'04' - START OF AUTO PROMPTING REQUESTED                          00320802
*         QTIP0170 - NONE.                                              00322202
*         QTIP0240 - NONE                                               00323602
*                                                                       00325002
* EXTERNAL REFERENCES -                                                 00326402
*         QTIP0030 - THIS IS A QTIP ROUTINE IN CSECT IEDAYAA            00327802
*    USED TO CLEAR ALL TS BUFFER QUEUES.                                00329202
*         QTIP0280 - THIS IS A QTIP ROUTINE IN CSECT IEDAYII            00330602
*    USED TO CLEAN UP LWAIT CONDITIONS.                                 00332002
*                                                                       00333402
* EXITS, NORMAL --                                                      00334802
*         QTIP0140 - EXITS TO QTIP0030 IN CSECT IEDAYAA                 00336202
*                                                                       00337602
*    ALL OTHER ENTRIES RETURN TO THE CALLER BY BRANCHING TO THE         00339002
*    ADDRESS IN REGISTER 14.                                            00340402
*                                                                       00341802
* EXITS,ERROR -- NONE                                                   00343202
*                                                                       00344602
* TABLES/WORK AREAS -- SEE REMARKS ACCOMPANYING DATA DEFINITION         00346002
*    STATEMENTS.                                                        00347402
*                                                                       00348802
* ATTRIBUTES -- REENTRANT, REUSABLE, PRIVILEGED, LOCKED, REFRESHABLE    00350202
*                                                                       00351602
* CHARACTER CODE DEPENDENCY -- NONE                                     00353002
*                                                                       00354402
* NOTES -- NONE                                                         00355802
*                                                                       00357202
         DC    C'IEDAYOO'               MODULE I.D.                     00358602
         DC    X'6125'                  DATE -  05/04/76       @ZA10219 00360037
         DC    C'5752SC1T3'             COMP ID                         00380037
         DS    0H                                                       00400020
*                                                                       00500020
*********************************************************************** 00600020
*                                                                       00700020
*   QTIP ENTRIES FOR TSOUTPUT (IEDAYO)                                  00800020
*                                                                       00900020
*********************************************************************** 01000020
*                                                                       01100020
         ENTRY QTIP0110                                                 01200020
         ENTRY QTIP0120                                                 01300020
         ENTRY QTIP0130                                                 01400020
         ENTRY QTIP0140                                                 01500020
         ENTRY QTIP0150                                                 01600020
         ENTRY QTIP0160                                                 01700020
*                                                                       02000020
*********************************************************************** 02100020
*                                                                       02110020
*   QTIP ENTRY FOR CANCEL                                               02120002
*                                                                       02130020
**********************************************************************  02140020
*                                                                       02150020
         ENTRY QTIP0240                                                 02160020
*                                                                       02164021
**********************************************************************  02168021
*                                                                       02172021
*   COMMON ROUTINE ENTRIES                                              02176021
*                                                                       02180021
**********************************************************************  02184021
*                                                                       02188021
         ENTRY IEDAYQIO                 IWAIT/OWAIT REMOVAL     YS02019 02192002
         ENTRY IEDAYQSO                 SYSTEM OWAIT REMOVAL    YS02019 02196002
*                                                                       02200020
**********************************************************************  02206020
*                                                                       02212020
*   EXTRN'S FOR EXTERNAL REFERENCES                                     02218020
*                                                                       02224020
**********************************************************************  02230020
*                                                                       02236020
         EXTRN QTIP0000                 BASE FOR ATTENTION      YS02019 02242002
         EXTRN QTIP0030                 ATTENTION ENTRY         YS02019 02248002
         EXTRN QTIP0050                 TSINPUT BASE            YS02019 02250002
         EXTRN QTIP0280                 TSINPUT ENTRY           YS02019 02252002
         EXTRN IEDAYTPQ                 TPOSTING ROUTINE        YS02019 02253002
         EXTRN IEDAYQBR                 BUFFER RETURN ROUTINE   YS02019 02253202
*                                                                       02254020
**********************************************************************  02260020
*                                                                       02266020
*   REGISTER EQUATES                                                    02272020
*                                                                       02278020
**********************************************************************  02284020
*                                                                       02300020
R0       EQU   0                        REGISTER 0                      02400020
R1       EQU   1                        REGISTER 1                      02500020
R2       EQU   2                        TSO BUFFER REGISTER             02600020
R3       EQU   3                        WORK REGISTER                   02700002
RSCB     EQU   3                        SCB REGISTER                    02800020
R4       EQU   4                        WORK REGISTER                   02900002
R5       EQU   5                        WORK REGISTER                   02950002
RASCB    EQU   5                        ASCB REGISTER           YS02019 03000002
R6       EQU   6                        WORK REGISTER                   03100002
R7       EQU   7                        WORK REGISTER                   03200002
RTSB     EQU   8                        TSB REGISTER                    03300020
R8       EQU   8                        WORK REGISTER                   03400002
R9       EQU   9                        WORK REGISTER                   03500002
RTIOC    EQU   10                       TIOCRPT REGISTER                03600020
R10      EQU   10                       WORK REGISTER                   03700002
R11      EQU   11                       WORK REGISTER                   03800002
RBASE    EQU   12                       BASE REGISTER                   03900020
R12      EQU   12                       WORK REGISTER                   04000002
RAVT     EQU   13                       ADDR OF AVT                     04100020
R13      EQU   13                       WORK REGISTER                   04200002
R14      EQU   14                       REGISTER 14                     04300020
R15      EQU   15                       REGISTER 15                     04400020
*                                                                    *  04500020
**********************************************************************  04600020
*                                                                       04700020
NULL     EQU   0                        CONSTANT '0'                    04800020
NOT      EQU   X'FF'                    NOT                             05000020
SBA      EQU   X'11'                    SBA CHAR                 S22028 05050002
E1       EQU   1                        DECIMAL ONE             YS02019 05100002
E2       EQU   2                        DECIMAL TWO             YS02019 05150002
E16      EQU   16                       DECIMAL 16                      05300020
E32      EQU   X'32'                    DECIMAL 32             @ZA02242 05400037
RTNCD04  EQU   4                        RETURN CODE = X'04'             05600020
ONE      EQU   1                        DECIMAL ONE                     05670020
THREE    EQU   3                        DECIMAL THREE            S22028 05720002
SIX      EQU   6                        DECIMAL SIX              S22028 05730002
E31      EQU   31                       DECIMAL THIRTY-ONE              05750020
REGLEN   EQU   4                        REGISTER LENGTH IN BYTES A42911 05770021
TIMES4   EQU   2                        SHIFT VALUE FOR TIMES 4 YS02019 05780002
*                                                                       05800020
**********************************************************************  05900020
*                                                                       06000020
         USING *,RBASE                  ESTABLISH BASE                  06100020
         USING IEDQSCB,RSCB             ESTABLISH SCB                   06200020
         USING TSB,RTSB                 ESTABLISH TSB                   06300020
         USING TIOCRPT,RTIOC            ESTABLISH TIOC                  06400020
         USING TIOCBUF,R2               ESTABLISH BUFFER                06500020
         USING IEDQDISP,R11             MAKE DISPATCHER ADDRESSABLE     06560020
         USING AVTSAVE2,RAVT                                            06580020
         USING IEDQQCB,R7               ESTABLISH DEST QCB      ZA00968 06590002
*                                                                       06600020
*********************************************************************** 06700020
*                                                                       06800020
QTIP0110 EQU   *                                                        06900020
*                                                                       07000020
*********************************************************************** 07100020
*                                                                       07300020
*        IF TRAILER QUEUE IS EMPTY MOVE A MESSAGE FROM THE HEADER       07500020
*        QUEUE TO THE TRAILER QUEUE.                                    07600020
*                                                                       07700020
*********************************************************************** 07900020
         SR    R15,R15                  SET RETURN CODE TO ZERO SA70323 07950002
         SR    R9,R9                    ZERO PT TO TRLR Q       SA70323 08000002
*                                                                       08300020
*   SCAN THE TRAILER QUEUE FOR ANY UNMOVED DATA                 SA70323 08400002
*                                                                       08500020
         L     R2,TSBOTBFP-1            GET ANCHOR FOR TRAILER  SA70323 08700002
         LA    R2,NULL(,R2)             CLEAR HIGH ORDER BITS   SA70323 08750002
         LTR   R2,R2                    TRAILER QUEUE EMPTY?    SA70323 08800002
         BZ    CKHEADER                 YES, GO CHECK HEADER    SA70323 08850002
         SPACE 2                                                        08900002
CKLENGTH EQU   *                                                SA70323 08950002
         LR    R9,R2                    SAVE PTR TO CURRENT BFR SA70323 08952002
         CLI   BUFFLNTH,NULL            ANY DATA IN THIS BFR    SA70323 08960002
         BNE   RET10                    YES, GO HANDLE IT       SA70323 08970002
         L     R2,BUFFTRLR-1            POINT TO NEXT BUFFER    SA70323 08980002
         LA    R2,NULL(,R2)             CLEAR HIGH BYTE         SA70323 08990002
         LTR   R2,R2                    IS THIS END OF CHAIN    SA70323 08992002
         BNZ   CKLENGTH                 NO, CHECK NEXT BUFFER   SA70323 08994002
*                                                                       08994402
*   AT THIS POINT, WE KNOW THERE IS NO UNMOVED DATA ON THE      SA70323 08994802
*   TRAILER QUEUE.  REGISTER 9 POINTS TO THE LAST               SA70323 08995202
*   BUFFER ON THE QUEUE.                                        SA70323 08995602
         SPACE 3                                                SA70323 08996002
CKHEADER EQU   *                                                SA70323 08998002
         NC    TSBOBFP,TSBOBFP          TEST IF ANY BFFR IN HEADER Q    09000020
         BCR   8,R14                    RETURN TO CALLER IF NOT SA70323 09100002
*                                                                       09150002
*   IF A REPROMPT MESSAGE IS ON THE TRAILER QUEUE, DON'T CHAIN          09160002
*   ANYTHING TO IT, BECAUSE BUFFERS ON THE TRAILER QUEUE ARE            09170002
*   NOT FREED IF THEY WERE PUT THERE DURING A REPROMPT.                 09180002
         TM    TSBFLG2,TSBBIPI          REPROMPT IN PROGRESS?   ZA00968 09190002
         BZ    NOREPRMT                 NO PROCESS Q'S NORMALLY ZA00968 09192002
         TM    TSBFLG2,TSBBRKIN         DOES BIPI REALLY MEAN   ZA00968 09194002
*                                       A PROMPT IS OUTSTANDING ZA00968 09196002
*                                       (RATHER THAN 'IN PROGRESS')?    09198002
         BZR   R14                      BIPI REALLY MEANS IT -  ZA00968 09198402
*                                       SO, RETURN              ZA00968 09198802
NOREPRMT EQU   *                                                ZA00968 09199202
*                                                                       09200020
*   DELINK A TSO BFFR FROM HEADER Q AND LINK IT TO TRAILER Q            09300020
*                                                                       09400020
         L     R2,TSBOBFP-1             LOAD 1ST BFFR ADDR              09500020
         LTR   R9,R9                    WAS THERE A TRLR QUEUE  SA70323 09600002
         BZ    NOTRAILR                 NO                      SA70323 09650002
         MVC   BUFFTRLR-TIOCBUF(3,R9),TSBOBFP                   SA70323 09660002
*                                       ADD NEW MESSAGE TO TRLR SA70323 09662002
         B     GOTITIN                  DONE ADDING             SA70323 09670002
NOTRAILR EQU   *                                                SA70323 09680002
         MVC   TSBOTBFP,TSBOBFP         MAKE NEW MESSAGE FIRST  SA70323 09690002
GOTITIN  EQU   *                                                SA70323 09692002
         MVC   TSBOBFP,BUFFHEAD         MOVE NEXT HEADER TO THE TOP     09700020
*                                                                       09800020
         NI    TSBFLG3,NOT-TSBTJMSG     ASSUME MSG NOT TJID TPUT        09900020
         TM    BUFFFL2,BUFFTJID         IS THIS A TJID MESSAGE          10000020
         BNO   RET10                    NO,GOTO SET UP TO RETURN        10100020
         OI    TSBFLG3,TSBTJMSG         SHOW MSG IS TJID TPUT           10200020
*                                                                       10300020
RET10    EQU   *                                                        10400020
*                                                                       10400137
*  DON'T PERMIT THE DUMMY TPUT'S ISSUSED BY                    @ZA02242 10400237
*  TCLEAR Q AND STBREAK (FOR SYNCHRONIZATION                   @ZA02242 10400337
*  PURPOSES) TO APPEAR ON A DISPLAY SCREEN                     @ZA02242 10400437
*                                                                       10401837
         TM    TSBFLG3,TSBSPIT          TEST TCLEARQ OR        @ZA02242 10402237
*                                       STBREAK                @ZA02242 10402337
         BNO   NOTDUM                   NO,NOTDUM TPUT         @ZA02242 10402637
         TM    TSBSTAT,TSBDSPLY         IS TERM DISPLAY TYPE   @ZA02242 10403237
         BNO   NOTDUM                   NO,DON'T INTERC TPUT   @ZA02242 10403337
         TM    BUFFFL1,BUFFCNTL          DUM ARE CTRL TPUT'S   @ZA02242 10403437
         BNO   NOTDUM                   BR IF NOT DUM          @ZA02242 10404337
         CLI   BUFFLNTH,ONE             IS TPUT 1 BYTE         @ZA02242 10406337
         BNE   NOTDUM                   BR IF NOT 1 BYTE       @ZA02242 10406437
         CLI   BUFFHDAT,E32             IS TPUT IDLE           @ZA02242 10406837
         BNE   NOTDUM                   BR IF NOT IDLE         @ZA02242 10407237
         L     R15,CVTPTR               GET CVT ADDR           @ZA02242 10407337
         L     R15,CVTAQAVT-CVT(R15)    GET TCX ADDR           @ZA02242 10407437
         L     RTIOC,TCXRPT-TCXAVT(R15) GET TIOC ADDR          @ZA02242 10407637
         MVI   BUFFLNTH,NULL            MAKE BUFFER 'FREEABLE' @ZA02242 10407837
         B     QTIP0120                 GO FREE TS BUFFER      @ZA02242 10408237
NOTDUM   EQU   *                                               @ZA02242 10408337
*                                                                       10408637
*   MUST SAVE QCBSATCT AND CARCT IN CASE MSG MUST BE REBUILT.           10408937
*                                                                       10409237
         IC    R15,QCBSATCT                                             10409537
         SLL   R15,8                    ONE BYTE                        10410037
         IC    R15,QCBCARCT                                             10411037
         STH   R15,BUFFWORK             SAVE IN BUFFER                  10412537
         DROP  R7                                               SA70323 10414037
         LA    R15,RTNCD04              INDICATE SOMETHING TO   SA70323 10415537
*                                       SEND                    SA70323 10417037
*                                                                       10418537
*   CHECK FOR AN OUTSTANDING REPROMPT.  IF FOUND, SET INDICATORS        10420020
*   TO REPROMPT AGAIN AFTER THIS NEW OUTPUT.                            10430020
*                                                                       10440020
         TM    TSBFLG2,TSBBIPI+TSBBRKIN IS A REPROMPT OUTSTANDING       10450020
         BNO   SETUPRET                 NO, GO SET UP TO RETURN         10460020
         NI    TSBFLG2,NOT-TSBBIPI      CLEAR INDICATOR                 10470020
*                                                                       10480020
SETUPRET EQU   *                                                        10490020
         NI    TSBFLG2,NOT-TSBSTAUT     AUTO PROMPT REQUEST WILL BE     10500020
*                                       HANDLED ALONG WITH OUTPUT       10600020
         BR    R14                      RETURN TO CALLER                10700020
*                                                                       12700020
*********************************************************************** 12800020
*                                                                       12900020
QTIP0120 EQU   *                                                        13000020
*                                                                       13100020
*********************************************************************** 13200020
*                                                                       13300020
*   THIS ENTRY FREES TS BUFFERS AND REMOVES WAITS IF APPROPRIATE        13400020
*                                                                       13700020
*********************************************************************** 13800020
*                                                                       13900020
         LR    R11,R15                  SAVE Q FLUSH SWITCH             14000020
         SR    R15,R15                  SET SW - NO BFR FREED           14100020
         LA    RTSB,0(,RTSB)            CLEAR FOR WAIT REMOVAL SUBR     14350020
         SR    R1,R1                                            YS02019 14400002
         IC    R1,TSBNOBF               INSERT NO. OF OUTPUT    YS02019 14500002
*                                       BFFR                    YS02019 14550002
*                                                                       14800020
LOOP03   EQU   *                                                        14900020
*                                                                       15000020
         L     R2,TSBOTBFP-1            LOAD ADDR OF 1ST OUTPUT BFFR    15100020
*                                                                       15200020
BRKINLOP EQU   *                                                        15300020
*                                                                       15400020
         LA    R2,NULL(R2)              CLEAR HI-ORDER BYTES            15500020
         LTR   R2,R2                    TEST IF ANY MORE BFFR           15600020
         BZ    UPDATE1                  NO,GOTO UPDATE COUNTS           15700020
*                                                                       15800020
         SR    R4,R4                    CLEAR R4                        16000020
         IC    R4,BUFFLNTH              INSERT DATA LENGTH              17100020
         LTR   R4,R4                    IS BUFFER EMPTY?                17200020
         BNZ   PUTNULL                  NO, GO CHK FOR QUEUE FLUSH      17300020
*                                                                       17400020
*        ARRIVAL AT THIS POINT MEANS ALL DATA IN BFR HAS BEEN SENT      17500020
*                                                                       17600020
         NI    BUFFFL1,NOT-BUFFIHOT     TURN OFF FLAG          @ZA08015 17620037
         MVC   TSBOTBFP,BUFFTRLR        POINT TO NEXT BFR               17650020
         TM    TSBFLG2,TSBBIPI          IS THIS BFR PART OF A PARTIAL   17700020
*                                       INPUT MSG CAUSED BY BREAK-IN    17800020
         BNO   BFRFREED                 NO, GO INDICATE BFR FREED       17900020
*                                                                       18000020
         TM    BUFFFL1,BUFFHDR          IS THIS A HEADER BFR            18020020
         BZ    NOTHDRBF                 NO, GO GET PROPER OFFSET        18040020
         LA    R3,BUFFHDLN              GET OFFSET FOR HDR BFR          18060020
         B     STOREOFF                 GO RESTORE ORIGINAL OFFSET      18080020
*                                                                       18100020
NOTHDRBF EQU   *                                                        18120020
         LA    R3,BUFFTRLN              GET OFFSET FOR TRAILER BFR      18140020
*                                                                       18160020
STOREOFF EQU   *                                                        18180020
         IC    R4,BUFFOFST              GET CURRENT OFFSET              18200020
         STC   R3,BUFFOFST              RESTORE ORIGINAL OFFSET         18220020
         SR    R4,R3                    GET ORIGINAL LENGTH             18240020
         STC   R4,BUFFLNTH              RESTORE ORIGINAL LENGTH         18260020
*                                                                       18400020
         NC    BUFFTRLR,BUFFTRLR        MORE BFRS IN THIS MSG           18500020
         BZ    PROMPTED                 NO, GO REMOVE FROM TRAILER Q    18600020
         L     R2,BUFFTRLR-1            YES, POINT TO NEXT BFR          18700020
         B     BRKINLOP                 GO CHECK NEXT BFR EMPTY         18800020
*                                                                       18900020
PROMPTED EQU   *                                                        19000020
*                                                                       19100020
         TM    TSBSTAT,TSBDSPLY         WAS IT REALLY A FLASHBACK MSG?  19309020
         BNO   PROMOUT                  NO, SKIP 2260 CODE              19318020
*                                                                       19327020
         NI    BUFFFL2,NOT-BUFFFRAG     TURN OFF BUFFFRAG      @ZA05465 19336037
         TM    TSBFLG4,TSBIWAIT         IS USER IN IWAIT        YS02019 19345002
         BZ    RSTBIPI                  NO, SKIP WAIT REMOVAL           19354020
         BAL   R4,RSTOWAIT              GO REMOVE IWAIT                 19363020
*                                                                       19372020
RSTBIPI  EQU   *                                                        19381020
         NI    TSBFLG2,NOT-TSBBIPI      RESET BREAK-IN/FLASHBACK SW     19390020
         B     SETTPUT                  GO SET TPUT BIT                 19440020
*                                                                       19450020
PROMOUT  EQU   *                                                        19460020
         OI    TSBFLG2,TSBBRKIN         INDICATE REPROMPT OUTSTANDING   19470020
         B     SETTPUT2                 GO CHK FOR MORE MSGS            19480020
*                                                                       19500020
BFRFREED EQU   *                                                        19600020
*                                                                       19700020
         L     R15,QBRADDR              ADDR OF BFR RETURN RTN  YS02019 19750002
         BALR  R0,R15                   GO RETURN BUFFER        YS02019 19800002
         BCTR  R1,NULL                  DECREMENT OUTPUT BFFR   YS02019 21000002
*                                       COUNT                   YS02019 21050002
         B     LOOP03                   GOTO CHECK NEXT BUFFER          21200020
*                                                                       21300020
PUTNULL  EQU   *                                                        21400020
*                                                                       21420020
         TM    TSBFLG2,TSBBIPI          IS THIS BFR ON INPUT Q ALSO?    21422020
         BO    UPDATE1                  YES, SKIP FLUSH CHECK           21424020
         TM    TSBFLG3,TSBTJMSG         IS THIS MESSAGE NON-FLUSHABLE?  21426020
         BO    UPDATE1                  YES, SKIP FLUSH CHECK           21432020
         TM    TSBFLG1,TSBOFLSH         SHOULD OUTPUT TRAILER QUEUE     21440020
*                                       BE CLEARED?                     21460020
         BNO   UPDATE1                  NO, GO UPDATE COUNT             21470020
         LTR   R11,R11                  IS Q FLUSHHING OK               21472020
         BNZ   UPDATE2                  NO, FLUSH LATER WHEN            21474020
*                                       CARRIAGE CAN BE RETURNED        21476020
         MVC   TSBOTBFP,BUFFTRLR        POINT TO NEXT BUFFER            21480020
         B     BFRFREED                 GO FREE BUFFER                  21490020
*                                                                       21500020
UPDATE1  EQU   *                                                        23200020
*                                                                       23300020
         NI    TSBFLG1,NOT-TSBOFLSH     INDICATE QUEUE FLUSH CHECKED    23400020
*                                       AND HANDLED IF NECESSARY        23500020
UPDATE2  EQU   *                                                        23550020
         STC   R1,TSBNOBF               UPDATE NO. OF OUTPUT    YS02019 23600002
*                                       BFFR                    YS02019 23650002
         LTR   R15,R15                  HAVE ANY BUFFERS BEEN FREED?    23800020
         BZ    SETTPUT                  NO, GO SET QCBTPUT              23900020
*                                                                       24100020
*   THIS SECTION CHECKS FOR AN OWAIT CONDITION CAUSED BY A TPUT WITH    24120020
*   HOLD OPTION OR TPUT RUNNING OUT OF BUFFERS WHILE PUTTING A          24140020
*   MESSAGE ON THE OUTPUT QUEUE.  THIS CONDITION WILL BE REMOVED IF     24160020
*   CONDITIONS ALLOW.                                                   24180020
*                                                                       24300020
         TM    TSBFLG4,TSBOWAIT         TEST IF USER IN OWAIT   YS02019 24600002
         BNO   CHKTSBS                  NO, GO CHECK FOR WAITING TSB'S  24700020
*                                                                       24800020
         TM    TSBFLG4,TSBHOLD          TEST IF TASK IS IN      YS02019 24900002
*                                       HOLD-OWAIT              YS02019 24950002
         BNO   CHKBFFNO                 NO,GOTO CHECK BFFR NO.          25000020
*                                                                       25100020
*   WHEN HOLD-OWAIT,CHECK IF HOLD OPTION MSG HAS BEEN SENT              25200020
*        YES - REMOVE OWAIT                                             25300020
*        NO  - KEEP OWAIT CONDITION                                     25400020
*                                                                       25500020
         CLI   TSBNOBF,NULL             IS ALL OF MSG SENT              25700020
         BNE   CHKTSBS                  NO, GO CHK FOR WAITING TSB'S    25900020
*                                                                       26100020
         NI    TSBFLG4,NOT-TSBHOLD      RESET HOLD OWAIT BIT    YS02019 26200002
         BAL   R4,RSTOWAIT              GO REMOVE OWAIT                 26260020
         B     CHKTSBS                  GO CHK FOR WAITING TSB'S        26320020
*                                                                       26400020
CHKBFFNO EQU   *                                                        26500020
*                                                                       26600020
*   SEE IF NUMBER OF BUFFERS FREED ALLOWS REMOVAL FROM OWAIT            26700020
*                                                                       26800020
         CH    R1,TIOCOWTH              USER STILL HOGGING BFRS YS02019 26880002
         BH    CHKTSBS                  YES, DON'T REMOVE OWAIT         26960020
         LA    R4,CHKTSBS               OPEN CLOSED SUBROUTINE  YS02019 27060002
*                                                                       27120020
**********************************************************************  27150020
*                                                                       27200020
RSTOWAIT EQU   *                                                        27300020
*                                                                       27400020
**********************************************************************  27420020
*                                                                       27440020
*   THIS ROUTINE REMOVES A USER FROM IWAIT OR OWAIT                     27444020
*        --TSBBIPI ON - REMOVE FROM IWAIT                               27448020
*        --TSBBIPI OFF - REMOVE FROM OWAIT                              27452020
*   REGISTER USAGE (OTHERS NOT ALTERED)                                 27455121
*        15-2  WORK REGISTERS                                           27455202
*        4     RETURN ADDR                                              27455321
*        8     TSB ADDR                                                 27455521
*        12    BASE ADDR                                                27455621
*   ENTERED AND EXITED IN TCAM'S KEY                                    27455702
*                                                                       27456020
**********************************************************************  27460020
*                                                                       27464020
IEDAYQIO EQU   *                                                YS02019 27466002
         LR    R2,R13                   SAVE REG. CONTENTS      YS02019 27467002
         TM    TSBFLG2,TSBBIPI          SHOULD IWAIT BE REMOVED         27468020
         BZ    RESETO1                  NO, REMOVE OWAIT                27472020
         TM    TSBFLG4,TSBIWAIT         IS USER IN IWAIT        YS02019 27472202
         BZR   R4                       NO, RETURN TO CALLER    YS02019 27472402
         L     R13,MSKIWAIT             SET TO REMOVE IWAIT     YS02019 27472602
         NI    TSBFLG4,NOT-TSBIWAIT     RESET INDICATOR         YS02019 27473002
         B     CHKINCOR                 GO SET UP FOR STATUS    YS02019 27474002
*                                                                       27484020
RESETO1  EQU   *                                                        27488020
         TM    TSBFLG4,TSBOWAIT         IS USER IN OWAIT?       YS02019 27492002
         BCR   14,R4                    NO, RETURN TO SUBRTN CALLER     27496020
         NI    TSBFLG4,NOT-TSBOWAIT     RESET OWAIT BIT OFF     YS02019 27500002
         L     R13,MSKOWAIT             SET TO REMOVE OWAIT     YS02019 27550002
*                                                                       28000020
*   INTERFACE TO STATUS                                                 28004002
*        REG. 00 - BYTES 0-1 - ASID                                     28008002
*                  BYTES 2-3 - STATUS ENTRY CODE (8)                    28012002
*        REG. 01 - X'80000000' (REQUESTS RESETTING)                     28016002
*        REG. 13 - TCB NONDISPATCHABILITY BIT MASK                      28020002
*        REG. 14 - RETURN ADDR                                          28024002
*        REG. 15 - ENTRY POINT ADDR                                     28028002
*                                                                       28032002
*        CMS AND LOCAL LOCKS HELD ON ENTRY AND UPON RETURN.             28036002
*        REGISTERS 2-12 AND 14 SHOULD REMAIN UNCHANGED BY STATUS.       28040002
*                                                                       28044002
CHKINCOR EQU   *                                                        28050020
         LM    R0,R1,STATREGS           LOAD PARM.S FOR STATUS  YS02019 28053002
         L     R15,TSBASCBA             GET ASCB ADDR           YS02019 28056002
         ICM   R0,B'1100',ASCBASID-ASCB(R15)  GET ASID          YS02019 28059002
         L     R15,CVTPTR               GET CVT ADDR            YS02019 28062002
         L     R15,CVTABEND-CVT(,R15)   GET SCVT ADDR           YS02019 28065002
         USING SCVTSECT,R15             SCVT ADDRESSABLE        YS02019 28068002
         L     R15,SCVTSTAT             GET EPA OF STATUS       YS02019 28071002
         LR    RBASE,R14                SAVE RETURN ADDR        YS02019 28073002
         MODESET EXTKEY=SUPR            GET SUPR KEY FOR STATUS YS02019 28073402
         BALR  R14,R15                  GO TO STATUS            YS02019 28074002
         USING *,R14                    USE R14 AS BASE         YS02019 28074402
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 28076002
         L     R15,AYOOBASE             GET ORIGINAL BASE       YS02019 28080002
         LR    R14,RBASE                RESTORE RETURN ADDR     YS02019 28083002
         DROP  R14                      R14 NO LONGER IS BASE   YS02019 28086002
         LR    RBASE,R15                RESTORE ORIGINAL BASE   YS02019 28089002
         LR    R13,R2                   RESTORE REG. CONTENTS   YS02019 28092002
         BR    R4                       RETURN TO CALLER        YS02019 28095002
*                                                                       33850020
*********************************************************************** 33900020
*                                                                       34000020
CHKTSBS  EQU   *                                                        34050020
*                                                                       34100020
*   THIS ROUTINE REMOVES WAIT CONDITIONS OF TSB'S                       34150020
*        (1)   OWAIT CAUSED BY NO BUFFERS TO HOLD ANY OF TPUT MESSAGE   34200020
*        (2)   OS WAIT CAUSED BY TPUT/TJID FOR WHICH THERE WERE         34250020
*              NOT ENOUGH BUFFERS.                                      34300020
*                                                                       34400020
         LA    R1,CHKLWAIT              OPEN CLOSED SUBROUTINE   S21008 34400221
*                                                                       34400421
*   REGISTER USAGE IN CLOSED SUBROUTINE (OTHERS NOT ALTERED)            34400621
*        1     RETURN ADDR                                              34400821
*        2-7   WORK REGISTERS                                           34401021
*        8     TSB ADDR                                                 34401221
*        10    TIOCRPT ADDR                                             34401621
*        12    BASE ADDR                                                34402021
*        13    ADDR OF 5 WORD SAVE AREA                                 34402221
*        15    WORK REGISTER                                            34402421
*                                                                       34402502
*   ENTERED AND EXITED IN TCAM'S KEY.                                   34406102
*                                                                       34410402
IEDAYQSO EQU   *                                                YS02019 34414002
         TM    TSBFLG1,TSBTJOW          DOES TJID TPUT NEED BFR'S       34417602
         BNO   OTHTSBS                  NO, GO CHK OTHER TSB'S          34421202
*                                                                       34424802
         CLC   TSBNOBF,TIOCOWTH+1       IS OWAIT REMOVABLE              34428402
         BH    OTHTSBS                  NO, DON'T REMOVE                34432002
         BAL   R4,POSTECB               GO REMOVE                       34435602
         NI    TSBFLG1,NOT-TSBTJOW                                      34439202
*                                                                       34442802
OTHTSBS  EQU   *                                                        34446402
         TM    TIOCFLG,TIOCTJBF+TIOCNOBF  ARE ANY TSB'S WAITING?        34450020
         BCR   8,R1                     NO, RETURN               S21008 34500021
         LR    R5,RTSB                  SAVE ORIGINAL TSB ADDR  YS02019 34550002
*                                                                       34600020
*   SET POINTERS FOR A SCAN OF TSB'S                                    34650020
*                                                                       34700020
         SR    R6,R6                    CLEAR                   YS02019 34750002
         IC    R6,TIOCTSBS              GET TSB SIZE            YS02019 34800002
         LR    R7,R6                    COPY TSB SIZE           YS02019 34850002
         L     R8,TIOCTSB-E1            START OF TSB TABLE      YS02019 34950002
         MH    R7,TIOCNTSB              LENGTH OF TSB TABLE     YS02019 35000002
         LA    R8,NULL(,R8)             CLEAR BYTE 0            YS02019 35050002
         AR    R7,R8                    ONE BEYOND LAST TSB     YS02019 35060002
         SR    R7,R6                    GET ADDR OF LAST TSB    YS02019 35070002
*                                                                       35100020
SCANLOOP EQU   *                                                        35150020
         TM    TSBSTAT,TSBINUSE         IS THIS TSB IN USE      YS02019 35160002
         BZ    SCANTEST                 NO, GO CK LOOP LIMITS   YS02019 35180002
*                                                                       35200002
         TM    TSBFLG1,TSBTJBF          IS THIS TSB IN OS WAIT?         35400020
         BZ    CHKNOBUF                 NO, GO CHK FOR OWAIT            35450020
         NI    TSBFLG1,NOT-TSBTJBF      SHOW WAIT REMOVED               35500020
         BAL   R4,POSTECB               GO POST ECB TO REMOVE WAIT      35550020
         B     SCANTEST                 GO TO SCAN LOOP TEST            35600020
*                                                                       35650020
CHKNOBUF EQU   *                                                        35700020
         TM    TSBSTAT,TSBNOBUF         COULD USER BE IN OWAIT?         35750020
         BZ    SCANTEST                 NO, GO TO SCAN LOOP TEST        35800020
         TM    TSBFLG4,TSBOWAIT         IS OWAIT ALREADY        YS02019 35850002
*                                       REMOVED?                YS02019 35870002
         BZ    SCANTEST                 YES, GO TO SCAN LOOP TEST       35900020
         STM   R14,R1,0(R13)            SAVE REG.S ACROSS SUBRTN S21008 35920021
         BAL   R4,RSTOWAIT              GO REMOVE OWAIT                 35950020
         LM    R14,R1,0(R13)            RESTORE REGISTERS        S21008 35970021
         NI    TSBSTAT,NOT-TSBNOBUF     SHOW OWAIT REMOVED              36000020
*                                                                       36050020
SCANTEST EQU   *                                                        36100020
         BXLE  R8,R6,SCANLOOP           SCAN LOOP TEST          YS02019 36150002
         NI    TIOCFLG,NOT-(TIOCTJBF+TIOCNOBF) RESET NO BFRS BITS       36170020
         LR    RTSB,R5                  ESTABLISH ORIGINAL ADDR YS02019 36180002
         BR    R1                       RETURN TO CALLER         M0104  36220021
*                                                                       36250020
**********************************************************************  36300020
*                                                                       36350020
CHKLWAIT EQU   *                                                        36400020
*                                                                       36450020
*   THIS ROUTINE CHECKS FOR SYSTEM LWAIT CONDITION AND IF PRESENT       36500020
*   WHETHER IT CAN BE REMOVED.  IF SO, TSINPUT IS TPOSTED TO REMOVE     36550020
*   THE CONDITION.                                                      36600020
*                                                                       36650020
         TM    TIOCFLG,TIOCSYLW         SYSTEM-WIDE LWAIT?              36700020
         BZ    SETTPUT                  NO, GO SET QCBTPUT              36750020
*                                                                       36800020
         L     R1,AVTTSOPT              LOAD ADDR OF TSINPUT QCB        36850020
         USING IEDQTSI,R1                                               36900020
*                                                                       36950020
         NC    TSIBUFQ,TSIBUFQ          IS TSINPUT HOLDING TCAM BFR'S?  37000020
         BNZ   POSTTSI                  YES, GO TPOST TSINPUT           37050020
         CLC   TIOCUSLW,TIOCNFBF        SHOULD SYSTEM LWAIT BE REMOVED  37100020
         BH    SETTPUT                  NO, DON'T POST TSINPUT          37150020
*                                                                       37200020
POSTTSI  EQU   *                                                        37250020
         TM    TSIFLAG,TSIPOST          HAS TSINPUT ALREADY BEEN POSTED 37300020
         BO    SETTPUT                  YES, GO SET QCBTPUT             37350020
*                                                                       37400020
*   TPOST TSINPUT TO ITSELF                                             37420000
*                                                                       37450000
         ST    R1,TSIELCHN-1            PUT QCB ADDR IN RECB            37500000
         MVI   TSIFLAG,TSIPOST          SHOW TSINPUT POSTED             37504000
         MVI   TSIPRI,PRIBFRTB          SET TPOST PRIORITY              37508000
         L     R11,AVTEA                LOAD ADDR OF TCAM DISPATCHER    37512000
         LR    R6,R14                   SAVE RETURN ADDRESS             37516000
         BAL   R14,DSPPOSTR             GO TPOST AND RETURN             37520000
         LR    R14,R6                   RESTORE RETURN ADDRESS          37524000
         DROP  R1                       ADDRESSABILITY ENDS     YS02019 37800002
*                                                                       37850020
**********************************************************************  37900020
*                                                                       37950020
SETTPUT  EQU   *                                                        38000020
*                                                                       38050020
*   IF THERE ARE MORE MESSAGES TO SEND, THIS ROUTINE LEAVES THE QCBTPUT 38100020
*   BIT ON INDICATING TO THE TCAM SEND SCHEDULER THAT TSOUTPUT SHOULD   38150020
*   BE TPOSTED AGAIN.                                                   38200020
*                                                                       38250020
         LR    R2,R14                   SAVE REGISTER CONTENTS  YS02019 38251602
         L     R15,AVTRNMPT             EPA OF TRM LOOKUP RTN   YS02019 38254002
         LH    R1,TSBASRCE              GET TERMINAL INDEX      YS02019 38255002
         BALR  R14,R15                  GO GET TRM ADDR         YS02019 38258002
         L     R7,TRMDESTQ-E1-IEDQTRM(,R1)  GET QCB ADDR        YS02019 38259002
         LR    R14,R2                   RESTORE REG. CONTENTS   YS02019 38260002
*                                                                       38261002
         TM    QCBTSOF1-IEDQQCB(R7),QCBPARTO  OUTPUT SPLIT BY   YS02019 38262002
*                                       OWAIT                   YS02019 38263002
         BNO   CHKBRKIN                 NO, GO CHK FOR BREAK-IN YS02019 38264002
*                                                                       38266002
         CLI   TSBNOBF,NULL             IS PARTIAL OUTPUT ALL   YS02019 38268002
*                                       SENT                    YS02019 38270002
         BE    GIVUPCTL                 YES, GIVE UP CONTROL    YS02019 38272002
*                                                                       38274002
CHKBRKIN EQU   *                                                YS02019 38278002
         TM    TSBFLG2,TSBBRKIN         DOES A PARTIAL INPUT    YS02019 38282002
*                                       LINE DUE                YS02019 38284002
*                                       TO BREAK-IN NEED TO BE PUT OUT  38286002
         BO    GOBACK11                 YES, LEAVE QCBTPUT ON   YS02019 38288002
*                                                                       38290002
SETTPUT2 EQU   *                                                YS02019 38295002
         NC    TSBOBFP,TSBOBFP          IS OUTPUT HEADER QUEUE EMPTY?   38300020
         BNZ   GOBACK11                 NO, GO RETURN                   38350020
         NC    TSBOTBFP,TSBOTBFP        IS OUTPUT TRAILER QUEUE EMPTY?  38400020
         BNZ   GOBACK11                 NO, GO RETURN                   38450020
*                                                                       38650020
         TM    TSBFLG1,TSBIFLSH         IS INPUT FLUSH IN        A45625 38655021
*                                       PROGRESS                 A45625 38660021
         BZ    CHKABEND                 NO, CHECK ABEND          A45625 38665021
         NI    TSBFLG1,NOT-TSBIFLSH     TURN OFF INPUT FLUSH     A45625 38670021
*                                       FLAG                     A45625 38675021
         NI    TSBFLG3,NOT-TSBSPIT      ALLOW PROMPTING          YM2814 38677000
         NI    TSBFLG2,NOT-(TSBBIPI+TSBBRKIN) TURN OFF BREAKIN-  A45625 38680021
*                                       FLASHBACK FLAGS                 38685021
CHKABEND EQU   *                                                 A45625 38690021
         TM    AVTBIT3,AVTTSAB          DOES ABEND MSG NEED SENDING?    38700020
         BO    GOBACK11                 YES, LEAVE QCBTPUT ON           38750020
*                                                                       38800020
         TM    TSBSTAT,TSBDISC          DOES LOGOFF MSG NEED SENDING?   38850020
         BO    GOBACK11                 YES, LEAVE QCBTPUT ON           38900020
*                                                                       39100020
         TM    TSBFLG2,TSBSTAUT         AUTO PROMPT MSG REQUESTED?      39150020
         BO    GOBACK11                 YES, LEAVE QCBTPUT ON           39200020
*                                                                       39250020
         LR    R2,R14                   SAVE REGISTER CONTENTS  YS02019 39300002
         L     R15,AVTRNMPT             EPA OF TRM LOOKUP RTN   YS02019 39301002
         LH    R1,TSBASRCE              GET TERMINAL INDEX      YS02019 39302002
         BALR  R14,R15                  GO GET TRM ADDR         YS02019 39303002
         L     R7,TRMDESTQ-E1-IEDQTRM(,R1)  GET QCB ADDR        YS02019 39304002
         LR    R14,R2                   RESTORE REG. CONTENTS   YS02019 39305002
*                                                                       39310020
GIVUPCTL EQU   *                                                        39320020
         NI    TSBFLG3,NOT-TSBTPUT      SHOW TSOUTPUT IS DONE   YS02019 39325002
         TM    QCBFLAG-IEDQQCB(R7),QCBTSSES  TSO SESSION                39330020
         BCR   14,R14                   NO, RETURN TO CALLER            39340020
         NI    QCBTSOF1-IEDQQCB(R7),NOT-QCBTPUT-QCBWRBRK                39350020
*                                                                       39400020
GOBACK11 EQU   *                                                        39450020
         BR    R14                      RETURN TO CALLER                39500020
*                                                                       39800020
*********************************************************************** 39900020
*                                                                       40000020
POSTECB  EQU   *                                                        40100020
*                                                                       40200020
*********************************************************************** 40300020
*                                                                       40400020
*   POST THE TSBECB                                                     40500020
*                                                                       40600020
*   ENTRY TO POST                                                       40700020
*        R10 - COMPLETION CODE                                          40800020
*        R11 - ECB ADDRESS AND HIGH ORDER BIT 'ON' - INDICATES          40900021
*              INTERPARTITION POST                                      41000021
*        R13 - ASCB ADDR                                                41200002
*        R14 - RETURN ADDR                                              41300020
*        R15 - CVT0PT01                                                 41400020
*                                                                       41500020
*********************************************************************** 41600020
*                                                                       41700020
         L     R3,CVTPTR                LOAD CVT ADDR                   41800020
         USING CVT,R3                                                   41900020
         L     R15,CVT0PT01             GET ADDR OF POST ROUTINE        42000020
         LR    R2,R13                   LOAD SAVE AREA ADDRESS          42120020
         STM   R10,R14,0(R13)           SAVE REGISTERS                  42180020
         SR    R10,R10                  ZERO COMPLETION CODE    YS02019 42240002
         LA    R11,TSBECB               LOAD ECB ADDR                   42400020
         O     R11,HIGHON               TURN ON HIGH-ORDER BIT   S21A12 42600021
         LA    R12,CVTBRET              NO ERROR RETURN RTN     YS02019 42700002
         LH    R13,TSBWTJID             LOAD TJID OF ORIGINATING TPUT   42900020
         L     R14,CVTASVT              ADDR OF ASVT            YS02019 42950002
         SLL   R13,E2                   MULTIPLY BY 4           YS02019 43000002
         L     R13,ASVTENTY-L'ASVTENTY-ASVT(R13,R14)  GET ASCB  YS02019 43050002
         MODESET EXTKEY=SUPR            GET SUPR KEY FOR POST   YS02019 43100002
         BALR  R14,R15                  GOTO POST ROUTINE               43300020
*                                                                       43400020
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 43450002
         LM    R10,R14,0(R2)            RESTORE REGISTERS               43500020
         BR    R4                       RETURN TO SUBROUTINE CALLER     43800020
         DROP  R3                       DROP AS CVT BASE        YS02019 43850002
         SPACE 3                                                SA70323 43900002
QTIP0130 EQU   *                                                        44500020
*                                                                       44600020
*********************************************************************** 44700020
*                                                                       44800020
*        THIS QTIP IS ENTERED WHEN THERE WAS AN OUTPUT I/O ERROR AND    45100020
*        THE TSO MSG HAS TO BE RE-BUILT AND RE-SENT                     45200020
*                                                                       45300020
*        MAKE ALL THE BUFFERS AS POSTED TO TSOUTPUT INITIALLY           45400020
*                                                                       45500020
*********************************************************************** 45600020
*                                                                       45700020
         USING TIOCBUF,R2                                               45900020
         USING IEDQQCB,R7               DESTINATION QCB         ZA00968 45950002
*                                                                       46000020
         SR    R4,R4                    CLEAR FOR IC USE                46100020
         SR    R1,R1                    CLEAR FOR FIRST HDR PTR SA70323 46150002
         SR    R5,R5                    PREVIOUS HDR PTR        SA70323 46250002
         SR    R6,R6                    PREVIOUS TRLR PTR       SA70323 46300002
         L     R2,TSBOTBFP-1            PT TO 1ST BFR ON QUEUE          46400020
         NC    TSBOTBFP,TSBOTBFP        IS TRAILER Q EMPTY     @ZA02256 46410037
         BZ    GOBACK11                 YES, GO BACK TO CALLER @ZA02256 46420037
*                                                                       46450002
*   RESTORE QCBCARCT AND SATCT TO PREVIOUS VALUES, SINCE MESSAGE        46460002
*   WASN'T SENT.                                                        46470002
*                                                                       46480002
         LH    R9,BUFFWORK              GET SAVED VALUE         SA70323 46490002
         STC   R9,QCBCARCT              RESTORE CARCT           SA70323 46492002
         SRL   R9,8                     ONE BYTE                SA70323 46494002
         STC   R9,QCBSATCT              RESTORE LINE COUNT      SA70323 46496002
         DROP  R7                                               SA70323 46496402
         SPACE 3                                                SA70323 46498002
*                                                                       46498402
*   START CHECKING THE BUFFERS ON THE OUTPUT TRAILER QUEUE      SA70323 46498802
*                                                                       46499202
NEXTBUFR EQU   *                                                SA70323 46499602
         TM    BUFFFL1,BUFFHDR          IS THIS A HDR BFR       SA70323 46500002
         BNO   NOTHDRB                  NO, UPDATE COUNT, ETC.  SA70323 46550002
         SPACE 3                                                        46650002
*                                                                       46700002
*   THIS IS A HEADER BUFFER.  RECHAIN THE QUEUE SO THE LAST             46750002
*   HEADER POINTS TO THIS ONE, AND THE LAST TRAILER POINTS TO           46800002
*   ZERO.                                                               46850002
*                                                                       46900002
         LTR   R5,R5                    ANY PREVIOUS HEADER     SA70323 46950002
         BZ    FIRSTHDR                 NO, THIS IS FIRST HDR   SA70323 47000002
         IC    R4,BUFFFL2-TIOCBUF(,R5) SAVE OLD FLAG            SA70323 47100002
         ST    R2,BUFFHEAD-1-TIOCBUF(,R5) ST NEW HDR PT         SA70323 47150002
         STC   R4,BUFFFL2-TIOCBUF(,R5)  RESTORE FLAG            SA70323 47200002
         B     MAKEPREV                 GO MAKE CURR BFR LAST   SA70323 47250002
         SPACE 2                                                SA70323 47300002
FIRSTHDR EQU   *                                                        47350002
         LR    R1,R2                    MAKE THIS FIRST HDR     SA70323 47360002
MAKEPREV EQU   *                                                        47400002
         LR    R5,R2                    SHOW THIS IS MOST       SA70323 47450002
*                                       RECENT HEADER BUFFER    SA70323 47500002
         LTR   R6,R6                    WAS THERE A PREV TRLR   SA70323 47550002
         BZ    DONTCLR                  NO, NO PTR TO RESET     SA70323 47600002
         MVC   BUFFTRLR-TIOCBUF(3,R6),ZEROS ZERO TRLR PT        SA70323 47610002
*                                       IN PREVIOUS BUFFER      SA70323 47620002
DONTCLR  EQU   *                                                        47650002
         LA    R3,BUFFHDLN              GET HDR PREFIX SIZE     SA70323 47700002
RESETLEN EQU   *                                                        47750002
         IC    R4,BUFFOFST              GET CURRENT OFFSET      SA70323 47800002
         CR    R3,R4                    THIS BFR BEEN TOUCHED?  SA70323 47850002
         BE    VIRGIN                   NO, NOTHING TO UPDATE   SA70323 47900002
         STC   R3,BUFFOFST              RESTORE ORIG OFFSET     SA70323 47950002
         SR    R4,R3                    GET LENGTH MOVED        SA70323 48000002
         IC    R3,BUFFLNTH              GET OLD LENGTH          SA70323 48050002
         AR    R3,R4                    ADD PREV MOVED TO IT    SA70323 48100002
         STC   R3,BUFFLNTH              STORE NEW LENGTH        SA70323 48150002
         B     VIRGIN                   BUFFER LIKE NEW AGAIN   SA70323 48200002
         SPACE 3                                                        48250002
*                                                                       48300002
*   THIS IS NOT A HEADER BUFFER.  ONLY OFFSET AND LENGTH NEED BE        48350002
*   ADJUSTED.                                                           48400002
*                                                                       48450002
NOTHDRB  EQU   *                                                        48500002
         LA    R3,BUFFTRLN              GET TRAILER PREF SIZE   SA70323 48550002
         B     RESETLEN                 GO RESET OFFSET AND LEN SA70323 48600002
VIRGIN   EQU   *                                                        48700002
*                                                                       48750002
*   THE BUFFER HAS BEEN RESTORED TO ITS ORIGINAL CONDITION.             48800002
*   NOW WE BUMP THE POINTERS TO THE NEXT BUFFER                         48850002
*                                                                       48900002
         LR    R6,R2                    CURR BFR NOW PREVIOUS   SA70323 48950002
         L     R2,BUFFTRLR-1            POINT TO NEXT BFR       SA70323 49000002
         LA    R2,0(,R2)                CLEAR HI ORDER BITS     SA70323 49050002
         LTR   R2,R2                    IS THERE ANOTHER BFR    SA70323 49100002
         BNZ   NEXTBUFR                 YES, GO FIX IT UP       SA70323 49150002
         TM    TSBFLG2,TSBBIPI          ERROR ON REPROMPT MSG? @ZA10219 49160037
         BO    NOTHDR                   YES, DONT MAKE IT HDR  @ZA10219 49170037
         SPACE 3                                                        49200002
*                                                                       49250002
*  WE HAVE REACHED THE END OF THE TRAILER QUEUE.  R5 POINTS TO THE      49300002
*   LAST HEADER BUFFER, R1 POINTS TO THE FIRST HEADER BUFFER.           49350002
*  NOW ANY HEADER BUFFERS WILL BE PUT AT THE HEAD OF THE HEADER         49400002
*   QUEUE, AND ANY LEFT-OVER TRAILERS WILL REMAIN ON                    49450002
*   THE TRAILER QUEUE.                                                  49500002
         LTR   R5,R5                    ANY HEADERS FOUND       SA70323 49550002
         BZR   R14                      NO, ALL DONE            SA70323 49600002
         MVC   BUFFHEAD-TIOCBUF(3,R5),TSBOBFP POINT LAST HEADER SA70323 49650002
*                                       IN NEW CHAIN TO FIRST   SA70323 49700002
*                                       HEADER IN OLD CHAIN     SA70323 49800002
         IC    R4,TSBOBFP-1             SAVE FLAGS              SA70323 51600002
         ST    R1,TSBOBFP-1             MAKE FIRST HDR IN       SA70323 51650002
*                                       NEW CHAIN HEAD OF       SA70323 51660002
*                                       HEADER QUEUE            SA70323 51670002
         STC   R4,TSBOBFP-1             RESTORE FLAG            SA70323 51680002
*   IF FIRST BFR ON TRLR Q WAS HDR, TRLR QUEUE IS EMPTY                 51690002
         LA    R1,0(,R1)                CLEAR HIGH ORDER BYTE   SA70323 51692002
         L     R2,TSBOTBFP-1            POINT TO TRLR Q         SA70323 51694002
         LA    R2,0(,R2)                CLEAR HIGH ORDER BYTE   SA70323 51696002
         CR    R1,R2                    SAME?                   SA70323 51698002
         BNER  R14                      NO, DONE                SA70323 51698402
         MVC   TSBOTBFP,ZEROS           CLEAR POINTER           SA70323 51698802
         SPACE 1                                                        51698937
NOTHDR   EQU   *                                               @ZA10219 51699037
         BR    R14                      RETURN                  SA70323 51699202
         SPACE 3                                                SA70323 51699602
QTIP0140 EQU   *                                                        51699702
*                                                                       51700020
*********************************************************************** 51800020
*                                                                       51900020
*   THIS QTIP ENTRY CLEANS UP TSO CONTROL BLOCKS FOR LOGOFF             52100020
*   AND HANGUP SITUATIONS                                               52300020
*                                                                       52500020
*********************************************************************** 52600020
*                                                                       52700020
*   REGISTERS AT ENTRY--                                                52730020
*                                                                       52760020
*        R8 -  ADDRESS OF TSB                                           52880020
*                                                                       52940020
         TM    TSBFLG4,TSBHUNG          IS THIS A HANG-UP       YS02019 53020002
*                                       SITUATION               YS02019 53030002
         BO    PASTCALL                 YES, DON'T CALL QTIP 28         53040020
*                                                                       53060020
*   SET UP AND GO TO QTIP 28 IN IEDAYII TO CLEAN UP LWAIT               53080020
*                                                                       53100020
         LR    R9,RTSB                  LOAD TSB ADDRESS                53120020
         LR    R2,R12                   SAVE BASE ADDRESS               53140020
         L     R15,QT28ADDR             GET ENTRY ADDR OF RTN           53160020
         L     R12,QT28BASE             GET BASE ADDR OF RTN    YS02019 53180002
         LR    R6,R14                   SAVE RETURN ADDR                53200020
         BALR  R14,R15                  GO CLEAN UP LWAIT               53220020
         LR    R12,R2                   RESTORE BASE ADDRESS            53240020
*                                                                       53249020
*   POST LOGOFF/TERMINATION                                             53249602
*                                                                       53250220
         LA    R11,TSBLECB              GET ECB ADDR            YS02019 53251402
         LR    R2,R12                   SAVE BASE ADDR                  53252020
         SR    R10,R10                  ZERO COMPLETION CODE            53253220
         O     R11,HIGHON               CROSS-MEMORY REQUEST    YS02019 53253402
         L     R15,CVTPTR               GET CVT ADDR            YS02019 53253802
         USING CVT,R15                  CVT ADDRESSABLE         YS02019 53254102
         L     R13,CVTMSER              ADDR OF BASEA           YS02019 53254502
         L     R13,BAASCB-BASE(R13)     ASCB OF MASTR SCHED     YS02019 53254902
         LA    R12,CVTBRET              NO ERROR RETURN ROUTINE YS02019 53264002
         L     R15,CVT0PT01             ENTRY POINT TO POST     YS02019 53268002
         DROP  R15                      AS CVT BASE             YS02019 53272002
         MODESET EXTKEY=SUPR            GET SUPR KEY FOR POST   YS02019 53276002
         BALR  R14,R15                  GO POST LOGOFF          YS02019 53280002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 53284002
         LR    R12,R2                   RESTORE BASE ADDR       YS02019 53288002
         USING QTIP0110,R12             MODULE ADDRESSABLE      YS02019 53290002
         LR    R14,R6                   RESTORE RETURN ADDR     YS02019 53292002
*                                                                       53296002
PASTCALL EQU   *                                                        53300020
         L     RTIOC,CVTPTR             GET CVT ADDR            YS02019 53302002
         L     RTIOC,CVTAQAVT-CVT(,RTIOC)  GET ADDR OF TCX      YS02019 53304002
         L     RTIOC,TCXRPT-IEDQTCX(,RTIOC) GET TIOCRPT ADDR    YS02019 53306002
         TM    TSBECB,AVTE80            IS ECB WAITED ON                53310020
         BNO   CLEANTSB                 NO, NO NEED TO POST             53320020
         LA    R13,TIOCSAVE             GET SAVE AREA ADDR              53328020
         BAL   R4,POSTECB               GO POST WAITING ECB             53330020
*                                                                       53340020
CLEANTSB EQU   *                                                        53350020
         L     RASCB,TSBASCBA           GET ASCB ADDR           YS02019 53360002
         USING ASCB,RASCB               ASCB ADDRESSABLE        YS02019 53370002
*                                                                       53400020
*   CLEAN UP TSB                                                        53500020
*                                                                       53600020
         SR    R0,R0                    ZERO REGISTER                   53670020
         STC   R0,TSBSTAT               CLEAR STATUS BYTE       YS02019 53740002
*                                       (IEDAY8 WILL CLR TSBASCB)       53790002
         STC   R0,TSBFLG3               CLEAR FLAG              YS02019 53810002
         STH   R0,TSBASRCE              CLEAR TERMINAL INDEX            53880020
         STC   R0,TSBFLG1               CLEAR 1ST FLAG BYTE             53950020
         STC   R0,TSBLNSZ               CLEAR LINE SIZE                 54020020
         STC   R0,TSBFLG2               CLEAR 2ND FLAG BYTE             54090020
*                                                                       54200020
*   CLEAN UP ASCB                                                       54300002
*                                                                       54400020
         MODESET EXTKEY=SUPR            GET KEY OF ASCB         YS02019 54450002
         ST    R0,ASCBTSB               CLEAR TSB POINTER       YS02019 54500002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 54550002
*                                                                       54900020
*   INITIALIZE REGISTERS FOR QUEUE CLEARING ROUTINE                     55000020
*                                                                       55100020
         LH    R2,ASCBASID              LOAD ASID VALUE         YS02019 55200002
         LR    R6,RTSB                  LOAD TSB ADDR                   55300020
*                                                                       55400020
*   GO TO QTIP 3 IN IEDAYAA TO CLEAR ALL TSO BUFFER QUEUES              55500020
*                                                                       55600020
         L     R15,CLRQADDR             GET ADDR OF Q CLEARING RTN      55700020
         L     R12,CLRQBASE             GET BASE ADDR OF RTN            55800020
         BR    R15                      GO TO Q CLEARING RTN            55900020
         DROP  RASCB                    AS ASCB BASE            YS02019 56300002
*                                                                       56700020
*                                                                       56800020
*********************************************************************** 56900020
*                                                                       57000020
QTIP0150 EQU   *                                                        57100020
*                                                                       57200020
*********************************************************************** 57300020
*                                                                       57400020
*   THIS QTIP ENTRY MAKES A PARTIAL INPUT MESSAGE OR 2260 FLASHBACK     57430020
*   MESSAGE, RESIDING ON THE INPUT QUEUE, RESIDE ALSO ON THE OUTPUT     57460020
*   TRAILER QUEUE.  AFTER THE MESSAGE HAS BEEN SENT TO THE TERMINAL     57490020
*   QTIP0120 WILL GET CONTROL AND REMOVE THE MESSAGE FROM THE TRAILER   57520020
*   QUEUE.                                                              57550020
*                                                                       57600020
*********************************************************************** 57700020
*                                                                       57800020
         DROP  R2                                                       58100020
         USING TIOCBUF,R2               ESTABLISH BASE FOR BUFFER       58200020
*                                                                       58300020
         NI    TSBFLG2,NOT-TSBBRKIN     RESET BREAK-IN OCCURED MSG      58400020
*                                                                       58500020
         NC    TSBIBFP,TSBIBFP          TEST IF ANY INPUT MSG IN Q      58600020
         BCR   8,R14                    RETURN IF EMPTY                 58700020
*                                                                       58800020
         L     R2,TSBIBFP-1             LOAD ADDR OF TS INPUT BUFFER    58900020
*                                                                       59000020
REPEAT2  EQU   *                                                        59100020
*                                                                       59200020
         NC    BUFFHEAD,BUFFHEAD        TEST IF ANY BUFFER IN CHAIN     59300020
         BZ    CHKPART                  NO,GOTO CHECK PARTIAL LINE      59400020
*                                                                       59500020
         L     R2,BUFFHEAD-1            LOAD NEXT BUFFER ADDR           59600020
         B     REPEAT2                  GOTO CHECK NEXT BUFFER          59700020
*                                                                       59800020
CHKPART  EQU   *                                                        59900020
*                                                                       60000020
         TM    TSBSTAT,TSBDSPLY         IS THIS A FLASHBACK MSG?        60030020
         BO    PROCPART                 YES, SKIP TEST                  60060020
         TM    BUFFFL2,BUFFPART         TEST IF PARTIAL MSG IN BUFFER   60100020
         BCR   14,R14                   RETURN IF NOT                   60200020
*                                                                       60300020
PROCPART EQU   *                                                        60400020
*                                                                       60500020
         STCM  R2,7,TSBOTBFP            PUT BFR ADDR IN TRAILER Q       60540000
         LR    R6,R2                    SAVE BUFFER ADDRESS    @ZA08015 61000037
         SPACE 1                                               @ZA08015 61000137
SETIHOT  EQU   *                                               @ZA08015 61000237
         OI    BUFFFL1,BUFFIHOT         TURN ON FLAG           @ZA08015 61000337
         L     R2,BUFFTRLR-1            GET NEXT TRAILER       @ZA08015 61000437
         LA    R2,0(,R2)                CLEAR HIGH BYTE        @ZA08015 61000537
         LTR   R2,R2                    ANY MORE TRAILERS?     @ZA08015 61000637
         BNZ   SETIHOT                  FLAG THEM TOO          @ZA08015 61000737
         LR    R2,R6                    RESTORE BUFFER ADDRESS @ZA08015 61000837
         TM    TSBSTAT,TSBDSPLY         2260 FLASHBACK REQUEST?         61001020
         BZ    SETBIPI                  NO, GO SET TSBBIPI              61002020
*                                                                       61003020
         SR    R6,R6                    CLEAR REGISTER                  61004020
         SR    R7,R7                    CLEAR REGISTER                  61005020
*                                                                       61006020
*   GET LENGTH OF INPUT MESSAGE                                         61007020
*                                                                       61008020
GETLEN   EQU   *                                                        61009020
         IC    R6,BUFFLNTH              LOAD DATA LENGTH                61010020
         TM    BUFFFL1,BUFFHDR          IS THIS A HEADER BFR     S22028 61010402
         BZ    ADDMSGLN                 BRANCH IF NO             S22028 61010802
         TM    BUFFFL2,BUFF3270         DOES IT HAVE 3270        S22028 61010902
*                                       CONTROL CHARACTERS       S22028 61012402
         BZ    ADDMSGLN                 BRANCH IF NO             S22028 61016002
         LA    R0,THREE                 ASSUME 3 CONTROL CHARS   S22028 61017402
         CR    R6,R0                    IS DATA LENGTH IN THIS   S22028 61017602
*                                       BFR LESS THAN 3          S22028 61017702
         BNL   CHKSBA                   NO, CHECK SBA CHAR       S22028 61017802
         LA    R0,ONE                   THERE IS 1 CONTROL CHAR  S22028 61017902
         B     ADJUST                   GO TO ADJUST MSG LENGTH  S22028 61018402
CHKSBA   EQU   *                                                 S22028 61018802
         CLI   BUFFHDLN+THREE(R2),SBA   IS THE 4TH CHAR SBA      S22028 61019202
         BNE   ADJUST                   BRANCH IF NOT            S22028 61019302
         LA    R0,SIX                   THERE ARE 6 CNTRL CHARS  S22028 61019402
ADJUST   EQU   *                                                 S22028 61019702
         SR    R6,R0                    SUBTRACT LENGTH OF 3270  S22028 61020102
*                                       CONTROL CHARACTERS       S22028 61020202
         STC   R6,BUFFLNTH              ADJUST DATA LENGTH       S22028 61020602
         SR    R3,R3                    CLEAR REGISTER           S22028 61021102
         IC    R3,BUFFOFST              GET OFFSET TO DATA       S22028 61021202
         AR    R3,R0                    SKIP OVER CONTROL CHARS  S22028 61021302
         STC   R3,BUFFOFST              ADJUST OFFSET TO DATA    S22028 61021402
ADDMSGLN EQU   *                                                 S22028 61021902
         AR    R7,R6                    ADD TO MESSAGE LENGTH           61022002
         OI    BUFFFL1,BUFFEDIT         FLASHBACK IN EDIT MODE          61022202
         NC    BUFFTRLR,BUFFTRLR        ANY MORE BUFFERS                61022602
         BZ    GOTLEN                   NO, MESSAGE LENGTH GOTTEN       61023002
         L     R2,BUFFTRLR-1            POINT TO NEXT BFR               61023502
         B     GETLEN                   GO ADD TO MSG LENGTH            61025002
GOTLEN   EQU   *                                                        61026502
         OI    BUFFFL1,BUFFNLCR         LET EDIT RTN ALLOW NL           61028002
*                                                                       61029502
*   IF MESSAGE IS LESS THAN TWO LINES FLASHBACK WHOLE MESSAGE           61031002
*                                                                       61032502
         IC    R6,TSBLNSZ               GET LINE SIZE                   61034002
         LA    R5,0(R6,R6)              GET TWICE LINE SIZE             61035502
         CR    R7,R5                    IS MESSAGE LT 2 LINES?          61037002
         BL    SETBIPI                  YES, WHOLE MSG WILL BE FLASHED  61038502
*                                                                       61040002
*   PARE LINES OFF THE FRONT OF THE MESSAGE UNTIL THE                   61041502
*   MESSAGE IS LESS THAN TWO LINES LONG                                 61043002
*                                                                       61044502
         SR    R3,R3                    CLEAR REGISTER                  61046002
         SR    R4,R4                    CLEAR REGISTER                  61047502
         LR    R9,R6                    LOAD LINE SIZE                  61049002
*                                                                       61050502
NEXTBUFF EQU   *                                                        61052002
         L     R2,TSBOTBFP-1            POINT TO 1ST ON TRAILER QUEUE   61053502
         LA    R2,0(,R2)                ISOLATE BFR ADDRESS             61055002
         LTR   R2,R2                    ANY MORE BFRS ON TRAILER Q?     61056502
         BZ    SETBIPI                  NO, GO SET TSBBIPI              61058002
*                                                                       61059502
         IC    R3,BUFFOFST              LOAD OFFSET TO DATA             61061002
         IC    R4,BUFFLNTH              LOAD LENGTH OF DATA             61071002
*                                                                       61105002
COMPARE  EQU   *                                                        61124802
         CR    R4,R9                    IS BFR LNG GT LINE SIZE         61144602
         BH    BFRHIGH                  YES, GO UPDATE OFFSET           61164402
         SR    R9,R4                    DECR LINE SIZE BY BFR LNG       61184202
         SR    R7,R4                    DECR MSG LNG BY BFR LNG         61204002
         NI    BUFFFL1,NOT-BUFFIHOT     TURN OFF FLAG,BOTH Q'S @ZA08015 61213037
         MVC   TSBOTBFP,BUFFTRLR        DROP THIS BFR OFF OF TRAILER Q  61223802
*                                                                       61225802
*   IF THIS IS A 3270 HEADER BUFFER, RESTORE BUFFOFST AND BUFFLNTH      61227802
*   TO INCLUDE THE CONTROL CHARACTERS                                   61229802
*                                                                       61231802
         TM    BUFFFL1,BUFFHDR          IS THIS A HEADER BFR     S22028 61233802
         BNO   NEXTBUFF                 BRANCH IF NO             S22028 61235802
         TM    BUFFFL2,BUFF3270         CHECK FOR 3270           S22028 61237802
         BNO   NEXTBUFF                 NO, GET NEXT BFR         S22028 61239802
         SR    R3,R3                    CLEAR REGISTER          ZA01350 61240202
         IC    R3,BUFFOFST              LOAD OFFSET TO DATA     ZA01350 61240602
         LA    R4,BUFFHDLN              GET HEADER OFFSET        S22028 61241802
         STC   R4,BUFFOFST              RESTORE ORIGINAL OFFSET  S22028 61242202
         SR    R3,R4                    GET THE DIFFERENCE       S22028 61242602
         IC    R4,BUFFLNTH              GET CURRENT DATA LENGTH  S22028 61243002
         AR    R3,R4                    GET ORIGINAL DATA LENGTH S22028 61243402
         STC   R3,BUFFLNTH              RESTORE ORIGINAL LENGTH  S22028 61243502
         B     NEXTBUFF                 GO GET NEXT BUFFER              61243602
*                                                                       61263402
BFRHIGH  EQU   *                                                        61283202
         AR    R3,R9                    BUMP OFFSET BY LINE SIZE        61303002
         SR    R4,R9                    DECR BFR LNG BY LINE SIZE       61322802
         SR    R7,R9                    DECR MSG LNG BY LINE SIZE       61342602
*                                                                       61362402
         CR    R7,R5                    IS MSG LNG NOW LT 2 LINES?      61382202
         BL    REPBFR                   YES, GO STORE LNG & OFFSET      61402002
         LR    R9,R6                    LOAD UNADJUSTED LINE SIZE       61421802
         B     COMPARE                  GO COMPARE AGAINST BFR LNG      61441602
*                                                                       61461402
REPBFR   EQU   *                                                        61481202
         STC   R3,BUFFOFST              STORE UPDATED OFFSET            61501002
         STC   R4,BUFFLNTH              STORE UPDATED DATA LENGTH       61520802
*                                                                       61540602
SETBIPI  EQU   *                                                        61560402
         OI    TSBFLG2,TSBBIPI          SET PARTIAL LINE IN PROCESS     61580202
         BR    R14                      RETURN TO CALLER                61600020
*                                                                       62100020
*********************************************************************** 62200020
*                                                                       62300020
QTIP0160 EQU   *                                                        62400020
*                                                                       62500020
*********************************************************************** 62600020
*                                                                       62700020
*                                                                       62705020
*   THIS ENTRY RESETS QCBTPUT/QCBWRBRK AND TPOSTS THE LCB TO ITSELF     62710020
*                                                                       62715020
*   REGISTERS AT ENTRY --                                               62720020
*        REG. 4 - LCB ADDR                                              62725020
*        REG. 7 - QCB ADDR                                              62730020
*        REG. 8 - TSB ADDR                                              62735020
*        REG.13 - ADDR OF AVTSAVE2                                      62740020
*                                                                       62745020
*   RETURN CODE IN REG. 15 --                                           62750020
*        0 - NO AUTO PROMPT REQUESTED                                   62755020
*        4 - AUTO PROMPT REQUESTED                                      62760020
*                                                                       62765020
         SR    R15,R15                  ASSUME NO AUTO PROMPT           62770020
         CLI   TSBNOBF,NULL             ARE THERE ANY MORE MSGS         62775020
         BNZ   TESTQS                   YES, CK REALLY ANY DATA@ZA07610 62780037
TCQISS   EQU   *                                               @ZA07610 62780137
         TM    TSBFLG1,TSBIFLSH         WAS TCLEARQ INPUT ISSUED YM2814 62780200
         BNO   PASTCI                   NO, DON'T RESET FLAGS    YM2814 62780400
         NI    TSBFLG1,NOT-TSBIFLSH     NO MORE FLUSHING         YM2814 62780600
         NI    TSBFLG2,NOT-TSBBIPI-TSBBRKIN  NOTHING TO REPROMPT YM2814 62781000
         NI    TSBFLG3,NOT-TSBSPIT      PERMIT FUTURE REPROMPTS  YM2814 62784000
*                                                                       62787000
PASTCI   EQU   *                                                        62790000
         NI    TSBFLG3,NOT-TSBTPUT      SHOW TSOUTPUT IS DONE   YS02019 62791002
         TM    QCBFLAG-IEDQQCB(R7),QCBTSSES  TSO SESSION                62792000
         BNO   POSTLCB                  NO, GO TPOST LCB                62795000
         NI    QCBTSOF1-IEDQQCB(R7),NOT-QCBTPUT-QCBWRBRK                62800000
*                                                                       62805000
RET15    EQU   *                                                        62810000
         TM    TSBSTAT,TSBDISC          DISCONNECT REQUESTED    YM2814  62815000
         BO    POSTLCB                  YES, DON'T CHECK PROMPT YM2814  62820000
         TM    TSBFLG2,TSBSTAUT         AUTO PROMPTING REQUESTED?       62825000
         BNO   POSTLCB                  NO, GO POST LCB TO ITSELF       62830000
         NI    TSBFLG2,NOT-TSBSTAUT     RESET PROMPT REQUEST BIT        62835000
         LA    R15,RTNCD04              INDICATE AUTO PROMPT REQUESTED  62840000
         BR    R14                      RETURN TO CALLER                62845000
*                                                                       62850000
TESTQS   EQU   *                                               @ZA07610 62850137
         NC    TSBOBFP,TSBOBFP          OUTPUT HEADER QUEUE    @ZA07610 62850237
*                                       EMPTY                  @ZA07610 62850337
         BNZ   COHQBKI                  NO, CHECK IF BREAKIN   @ZA07610 62850437
         NC    TSBOTBFP,TSBOTBFP        TRAILER BUFFER QUEUE   @ZA07610 62850537
*                                       EMPTY                  @ZA07610 62850637
         BZ    MNULICT                  YES, SHOULDN'T HAPPEN  @ZA07610 62850737
*                                       CLEAR CT FIELD         @ZA07610 62850837
         L     R2,TSBOTBFP-1            GET FIRST TR BFR       @ZA07610 62850937
ANYDINB  EQU   *                                               @ZA07610 62851037
         CLI   BUFFLNTH,NULL            ANY DATA IN THIS BFR   @ZA07610 62851137
         BNE   RET15                    YES, LEAVE QCBTPUT ON  @ZA07610 62851237
         L     R2,BUFFTRLR-1            POINT TO NEXT BFR      @ZA07610 62851337
         LA    R2,NULL(,R2)             CLEAR HIGH BYTE        @ZA07610 62851437
         LTR   R2,R2                    IS THIS END OF CHAIN   @ZA07610 62851537
         BNZ   ANYDINB                  NO, SEE IF ANY DATA    @ZA07610 62851637
*                                       IN BUFFER              @ZA07610 62851737
         B     TCQISS                   YES, TURN QCBTPUT OFF  @ZA07610 62851837
COHQBKI  TM    TSBFLG2,TSBBIPI          REPROMPT IN PROGRESS ? @ZA07610 62851937
         BZ    RET15                    NO, LEAVE QCBTPUT ON   @ZA07610 62852037
         TM    TSBFLG2,TSBBRKIN         DOES BIPI REALLY MEAN  @ZA07610 62852137
*                                       A PROMPT IS OUTSTANDING@ZA07610 62852237
         BNZ   RET15                    NO, LEAVE QCBTPUT ON   @ZA10218 62852337
         B     TCQISS                   YES, TURN QCBTPUT OFF  @ZA07610 62852437
*                                                              @ZA07610 62852537
MNULICT  MVI   TSBNOBF,NULL             MOVE ZERO INTO CT FIELD@ZA07610 62852637
         B     TCQISS                   TURN OFF QCBTPUT       @ZA07610 62852737
POSTLCB  EQU   *                                                        62855000
         LR    R1,R4                    LCB IS ELEMENT                  62860000
         LR    R2,R4                    LCB IS QCB TOO                  62865000
         ICM   R1,8,TPPRILCB            INSERT TPOST PRIORITY           62870000
         LA    R13,0(,R13)              REQUEST NO TIME DELAY CHK       62875000
         L     R15,TPQADDR              ADDR OF IKJGGTPQ                62880000
         BALR  R0,R15                   GO TPOST LCB TO SELF            62885000
         SR    R15,R15                  SET RETURN CODE                 62890000
         BR    R14                      RETURN TO CALLER                62895000
*                                                                       66300020
*********************************************************************** 66800020
*                                                                       66830020
QTIP0240 EQU   *                                                        66860020
*                                                                       66900020
*********************************************************************** 68200020
*                                                                       68203020
*   THIS QTIP ENTRY REMOVES ASID OWAIT.                                 68206002
*   IT IS USED BY THE CANCEL FUNCTION                                   68209002
*                                                                       68212020
*   THE ASID IS EXPECTED IN REG. 5.  REGS. 2-14 WILL BE PRESERVED.      68215002
*                                                                       68218020
**********************************************************************  68221020
*                                                                       68224020
         L     R15,CVTPTR               GET CVT ADDR            YS02019 68226002
         USING CVT,R15                  MAKE CVT ADDRESSABLE    YS02019 68228002
         L     R1,CVTAQAVT              GET TCX ADDR            YS02019 68230002
         DROP  RTIOC                                             A42911 68234521
         L     R1,TCXRPT-IEDQTCX(,R1)   ADDRESS OF TIOCRPT      YS02019 68235002
         USING TIOCRPT,R1                                        A42911 68235502
         LR    R0,R12                   SAVE BASE REGISTER      YS02019 68235602
         L     R12,TIOCSAVE             RESTORE CALLER'S REG 12 VS01090 68235902
         STM   R2,R14,TIOCSAVE+R5*REGLEN SAVE REGISTER CONTENTS YS02019 68236002
         LR    R12,R0                   RESTORE BASE REGISTER   YS02019 68236102
         L     R9,CVTASVT               GET ADDR OF ASVT        YS02019 68236202
         USING ASVT,R9                  ASVT NOW ADDRESSABLE    YS02019 68236502
         LA    R13,TIOCSAVE             5-WORD SAVE AREA FOR    YS02019 68237502
         DROP  R15,R1                    POSTECB SUBROUTINE     YS02019 68238002
*                                                                       68242020
         SLL   RASCB,E2                 GET OFFSET IN ASVT      YS02019 68251802
         L     RASCB,ASVTENTY-L'ASVTENTY(RASCB)  GET ASCB ADDR  YS02019 68260002
         USING ASCB,RASCB               ASCB NOW ADDRESSABLE    YS02019 68263002
         L     RTSB,ASCBTSB             GET TSB ADDR            YS02019 68272002
*                                                                       68272302
         OI    TSBFLG4,TSBCANC          INDICATE TSB CANCELED   YS02019 68272602
         TM    TSBFLG1,TSBTJOW          IS ASID TPUT WAITING    YS02019 68273002
         BNO   RETURN24                 NO, GO SET UP TO RETURN  A42911 68276021
         BAL   R4,POSTECB               GO POST THE TJID TPUT    A42911 68279021
*                                       WAITING FOR BUFFERS             68282021
RETURN24 EQU   *                                                 A42911 68285021
         LM    R2,R14,R5*REGLEN(R13)    RESTORE REGISTER        YS02019 68288002
         DROP  R9,RASCB                 ADDRESSABILITY ENDS     YS02019 68289002
         LR    R15,R12                  SAVE SIC'S REG 12 SO    VS01090 68291002
*                                       QTIP EPILOG WON'T       VS01090 68293402
         BR    R14                      RETURN                   A42911 68294021
*                                                                       68300020
*********************************************************************** 68400020
*                                                                       68500020
*   CONSTANTS                                                           68600020
*                                                                       68700020
*********************************************************************** 68800020
*                                                                       68900020
CLRQADDR DC    A(QTIP0030)              ADDR OF QUEUE CLEARING QTIP     69100020
CLRQBASE DC    A(QTIP0000)              BASE ADDR OF Q CLEARING QTIP    69300020
*                                                                       69500020
QT28ADDR DC    A(QTIP0280)              ADDRESS OF QTIP 28 ROUTINE      69570020
QT28BASE DC    A(QTIP0050)              BASE ADDR OF QTIP 28 RTN        69640020
*                                                                       69710020
STATREGS DC    A(8)                     .REGISTERS 0 AND 1      YS02019 69720002
STATREG1 DC    X'80000000'              .FOR STATUS             YS02019 69730002
HIGHON   EQU   STATREG1                 FOR INTERREGION POST REQYS02019 69732002
         ORG   HIGHON+1                 LOW-ORDER USED AS ZEROS SA70323 69734002
ZEROS    DS    CL3                      HERE THEY ARE           SA70323 69736002
MSKIWAIT DC    AL1(0,0,TCBIWAIT,0)      MASK FOR STATUS         YS02019 69740002
MSKOWAIT DC    AL1(0,0,TCBOWAIT,0)      MASK FOR STATUS         YS02019 69750002
*                                                                       69760002
QBRADDR  DC    A(IEDAYQBR)              ADDR OF BFR RETURN RTN  YS02019 69770002
AYOOBASE DC    A(QTIP0110)              BASE ADDR OF IEDAYOO    YS02019 69852002
TPQADDR  DC    A(IEDAYTPQ)              TPOSTING ROUTINE        YS02019 69854002
PATCHREA DC    20F'0'                   PATCH AREA               Y01018 69857037
TSIPRIOR DC    AL1(PRIBFRTB)            TPOST PRIORITY FOR TSI   Y01018 69878000
TPPRILCB DC    AL1(PRILNFRE)            TPOST PRIORITY FOR LCB   Y01018 69885000
         EJECT                                                          70240002
         IHAASCB                                                        70280002
         EJECT                                                          70320002
         IHAASVT                                                        70360002
         EJECT                                                          70409020
         TAVTD                                                          70509020
         EJECT                                                          70609020
         IKJTIOCB                                                       70709020
         EJECT                                                          70809020
CVT      DSECT                                                          70909020
         CVT                                                            71009020
         EJECT                                                          71109020
         TDISPD                                                         71209020
         EJECT                                                          71309020
         TLCBD                                                          71409020
         EJECT                                                          71509020
         TPRIOR                                                         71609020
         EJECT                                                          71709020
         TQCBD                                                          71809020
         EJECT                                                          71909020
         TSCBD                                                          72009020
         EJECT                                                          72029021
         IHASCVT                                                        72093000
         EJECT                                                          72109020
         IKJTCB                                                         72209020
         EJECT                                                          72239002
         TTCXD                                                          72269002
         EJECT                                                          72309020
         IKJTIOCP                                                       72409020
         EJECT                                                          72459002
         TTRMD                                                          72509002
         EJECT                                                          72909020
         IKJTSB                                                         73009020
         EJECT                                                          73109020
         TTSID                                                          73409020
         EJECT                                                          73459002
         IEEBASEA                                                       73509002
         END                                                            74800020
./  ADD  SSI=72410248,NAME=IEDAYQT
         TITLE 'IEDAYQT - QTIP (TIOC EXTENDED ROUTER SVC)'              00200002
* **************************************************************        00250002
*                                                                       00300002
*01* MODULE-NAME = IEDAYQT                                              00350002
*                                                                       00360002
*01* DESCRIPTIVE-NAME = QTIP (TIOC EXTENDED ROUTER SVC)                 00370002
*                                                                       00380002
*01* COPYRIGHT = NONE                                                   00390002
*                                                                       00392002
*01* STATUS = 01                                                        00394003
*                                                                       00394403
********    VS2-3.0 DELETIONS, CHANGES AND ADDITIONS                    00394803
*C753600,753800,753900,753920,085500                            ZA00611 00395203
*                                                                       00396002
*01* FUNCTION = ROUTES QTIP REQUESTS TO THE APPROPRIATE ROUTINE.        00398002
*               THIS MODULE ALSO CONTAINS CERTAIN COMMON                00398402
*               SUBROUTINES USED BY THE VARIOUS QTIP ROUTINES.          00398802
*                                                                       00399202
*01* NOTES =                                                            00399602
*                                                                       00399702
*02*   DEPENDENCIES = N/A                                               00399802
*                                                                       00399902
*02*   RESTRICTIONS = THE QTIP SVC WILL ACT AS A NOP WHEN ISSUED        00416602
*                     IN A NON-SYSTEM KEY, OR WHEN TIME SHARING         00426602
*                     IS NOT ACTIVE.                                    00427002
*                                                                       00427402
*02*   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                      00428602
*                                                                       00430602
*02*   PATCH-LABEL = PATCH                                              00432602
*                                                                       00433002
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             00433102
*                                                                       00433202
*02*   PROCESSOR = SEE LISTING                                          00438802
*                                                                       00440802
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID 01       00442802
*                                                                       00443202
*02*   ATTRIBUTES = REENTRANT, REFRESHABLE, SUPERVISOR STATE            00443602
*                                                                       00444102
*01* ENTRY-POINTS = IEDAYQT, IEDAYQT1, IEDAYTPQ, IEDAYQBA, IEDAYQBR     00444202
*                                                                       00444302
*02*   PURPOSE =                                                        00483202
*                                                                       00493202
*        (IEDAYQT AND IEDAYQT1)                                         00495202
*        VALIDATE CALLING PARAMETERS (EXPLICIT AND IMPLICIT)            00497202
*        AND PASS CONTROL TO APPROPRIATE FUNCTIONAL CSECT.              00499202
*                                                                       00501202
*        (IEDAYTPQ)                                                     00501602
*        TPOST THE SPECIFIED ELEMENT TO THE SPECIFIED QCB.              00502002
*                                                                       00502402
*        (IEDAYQBA)                                                     00502802
*        GET A TIOC BUFFER FROM ONE OF THE FREE LISTS.                  00502902
*                                                                       00503002
*        (IEDAYQBR)                                                     00503102
*        RETURN A TIOC BUFFER TO THE PROPER FREE LIST.                  00506402
*                                                                       00508402
*02*   LINKAGE =                                                        00509902
*                                                                       00513202
*        IEDAYQT - ENTERED BECAUSE SVC 101 ISSUED.                      00513602
*        IEDAYQT1 - ENTERED VIA BALR 14,15                              00514002
*        IEDAYTPQ - ENTERED VIA BALR 0,15                               00514402
*        IEDAYQBA - ENTERED VIA BALR 0,15                               00514802
*        IEDAYQBR - ENTERED VIA BALR 0,15                               00514902
*                                                                       00515002
*01* INPUT =                                                            00515202
*                                                                       00517202
*        (IEDAYQT)                                                      00519202
*        SVC MUST BE ISSUED IN SUPERVISOR KEY (0-7).                    00521202
*        REGISTER 00 CONTAINS THE ENTRY CODE.                           00521302
*        REGISTER 01 CONTAINS 0 OR THE ADDRESS OF A 12 WORD SAVE AREA.  00521402
*        REGISTER 03 CONTAINS CVT ADDRESS                               00521502
*        REGISTER 04 CONTAINS TCB ADDRESS                               00521602
*        REGISTER 05 CONTAINS RB ADDRESS                                00521702
*        REGISTER 14 CONTAINS SUPERVISOR RETURN ADDRESS                 00521802
*                                                                       00521902
*        (IEDAYQT1)                                                     00524502
*        MUST BE CALLED IN SUPERVISOR STATE (ANY KEY).                  00526502
*        REGISTER 00 CONTAINS THE ENTRY CODE                            00526902
*        REGISTER 14 CONTAINS RETURN ADDRESS                            00527002
*        REGISTER 15 CONTAINS ENTRY POINT ADDRESS                       00527102
*                                                                       00527202
*        (IEDAYTPQ, IEDAYQBA, IEDAYQBR)                                 00530102
*        SEE COMMENTS IN FRONT OF SUBROUTINES THEMSELVES.               00534802
*                                                                       00538102
*01* OUTPUT =                                                           00541002
*                                                                       00541402
*        (IEDAYQT)                                                      00541602
*        INVOKES SPECIFIED QTIP ROUTINE IN TCAM'S KEY.                  00543602
*        REGISTER 00 AND 01 CONTAIN ADDRESS OF QTIP ROUTINE.            00544002
*        REGISTERS 2-11 AND 13 ARE RESTORED FROM SAVE AREA IF PASSED    00544402
*        REGISTER 12 CONTAINS BASE ADDRESS OF QTIP ROUTINE.             00544802
*        REGISTER 14 CONTAINS SUPERVISOR RETURN ADDRESS                 00544902
*        REGISTER 15 CONTAINS SAME CONTENTS AS WHEN SVC ISSUED.         00545002
*                                                                       00545502
*        (IEDAYQT1)                                                     00545902
*        INVOKES SPECIFIED QTIP ROUTINE IN TCAM'S KEY.                  00546302
*        REGISTERS 0, 1, 12 SAME AS WITH IEDAYQT.                       00546402
*        REGISTERS 2-13 AND 15 SAME AS ENTRY.                           00546702
*        REGISTER 14 CONTAINS ADDRESS OF BRANCH ENTRY EPILOG            00547102
*                    (IN IEDAYQT)                                       00547202
*        AFTER THE QTIP ROUTINE EXITS, THE BRANCH ENTRY EPILOG          00547302
*        RESTORES THE CALLER'S ORIGINAL KEY.                            00547402
*        ALL REGISTERS EXCEPT 12 AND 14 ARE AS WHEN THE QTIP ROUTINE    00548202
*        EXITED.  12 IS CLOBBERED.  14 CONTAINS USERS RETURN ADDRESS.   00550402
*                                                                       00550502
*        (IEDAYTPQ, IEDAYQBA, IEDAYQBR)                                 00550602
*        SEE COMMENTS IN FRONT OF SUBROUTINES THEMSELVES.               00550702
*                                                                       00550802
*01* EXIT-NORMAL =                                                      00551202
*                                                                       00552002
*        (IEDAYQT)                                                      00552402
*        INVOKES SPECIFIED QTIP ROUTINE.                                00552502
*                                                                       00553202
*        (IEDQYQT1)                                                     00553402
*        INVOKES SPECIFIED QTIP ROUTINE, THEN RETURNS TO CALLER.        00553602
*                                                                       00553702
*        (IEDAYTPQ, IEDAYQBA, IEDAYQBR)                                 00553802
*        RETURN TO CALLER'S RETURN ADDRESS.                             00554202
*                                                                       00554602
*01* EXIT-ERROR =                                                       00555102
*                                                                       00555202
*        (IEDAYQT, IEDAYQT1) - BR 14                                    00555302
*                                                                       00555402
*        (IEDAYTPQ, IEDAYQBR, IEDAYQBA) - NONE                          00556202
*                                                                       00557902
*01* EXTERNAL-REFERENCES -                                              00558702
*                                                                       00559502
*02*   ROUTINES = POST (IEA0PT01), AND THE QTIP ROUTINES                00560302
*                                                                       00561102
*02*   DATA-AREAS = NA                                                  00567502
*                                                                       00577902
*02*   CONTROL-BLOCKS = SEE MAPPING MACROS AT END OF LISTING            00578302
*                                                                       00581902
*01* TABLES = QTIP ROUTINE ADDRESSES (SEE LABEL 'TABLE').               00583902
*                                                                       00584302
*01* MACROS = MODESET                                                   00584702
*                                                                       00585102
*01* CHANGE-ACTIVITY -  SJ00088 05/07/73                                00585502
*                       VS01090 05/14/73                                00587502
*                       VS01373 06/16/73                                00587902
*                       ZA00611 08/22/74                                00588303
*                                                                       00589102
******************************************************************      00591102
         EJECT                                                          00591502
IEDAYQT  CSECT                                                          00592802
         COPY  LCGASMS2                 LIBRARY CONTROL                 00596402
*                                                                       00600002
*   REGISTER EQUATES                                                    00800002
*                                                                       01000002
R0       EQU   0                        INTERFACE REGISTER              01200002
RCODE    EQU   0                        ENTRY CODE                      01400002
RWRK0    EQU   0                        WORK REGISTER                   01600002
RPARM    EQU   1                        PARAMETER REGISTER              01800002
RELEM    EQU   1                        RECB POINTER                    02000002
R2       EQU   2                        INTERFACE REGISTER              02200002
RQCB     EQU   2                        QCB POINTER                     02400002
R3       EQU   3                        CVT POINTER                     02450002
RTCB     EQU   4                        TCB POINTER                     02600002
RRB      EQU   5                        RB POINTER                      02800002
RRPT     EQU   6                        TIOCRPT POINTER                 02850002
RWK9     EQU   9                        WORK REGISTER                   02900002
R10      EQU   10                       INTERFACE REGISTER              03000002
RWK10    EQU   10                       INTERFACE REGISTER              03200002
RWK11    EQU   11                       INTERFACE REGISTER              03400002
R12      EQU   12                       INTERFACE REGISTER              03600002
RBASE    EQU   12                       BASE REGISTER                   03800002
RTCX     EQU   12                       TCX POINTER                     04000002
R13      EQU   13                       INTERFACE REGISTER              04200002
RLINK    EQU   14                       LINK REGISTER                   04400002
R15      EQU   15                       INTERFACE REGISTER              04600002
*                                                                       04800002
*   MASKS AND DISPLACEMENTS                                             05000002
*                                                                       05200002
PKEYDISP EQU   1                        OFFSET OF PROTECTION            05400002
*                                       KEY IN PSW                      05600002
USERKEY  EQU   X'80'                    MASK FOR KEYS 8-15              05800002
E0       EQU   0                        NULL                            06000002
E24      EQU   24                       DECIMAL 24                      06200002
E1       EQU   1                        DECIMAL 1                       06400002
TBLSHIFT EQU   2                        SHIFT VALUE TO MULTIPLY         06600002
*                                       BY TABLE ENTRY LENGTH           06800002
E8       EQU   8                        DECIMAL 7                       07000002
E7       EQU   7                        DECIMAL 8                       07200002
EPGSHIFT EQU   12                       SHIFT VALUE FOR PAGE NO.        07400002
R13DISP  EQU   X'2C'                    R13 DISPL. IN PARM AREA         07450002
*                                                                       07600002
**********************************************************************  07650002
*                                                                       07700002
*              VALIDITY CHECK FOR SVC CALLER                            07800002
*                                                                       07810002
**********************************************************************  07850002
*                                                                       08000002
         BALR  RBASE,RWRK0              GET BASE ADDRESS                08200002
         USING *,RBASE                  BASE REG                        08400002
         B     SVCBASE                  BRANCH AROUND MODULE ID         08450002
         DC    C'IEDAYQT '              MODULE I.D.                     08500002
         DC    X'4234'                  DATE - 08/22/74         ZA00611 08550003
SVCBASE  EQU   *                                                        08600002
         USING RBSECT,RRB               RB PASSED BY FLIH               09200002
         TM    RBOPSW+PKEYDISP,USERKEY  WAS SVC ISSUED BY SYSTEM        09400002
         BOR   RLINK                    NO, EXIT                        09600002
         DROP  RRB                      RB NOT ADDRESSABLE              09610002
         SPACE 3                                                        09650002
*                                                                       09700002
**********************************************************************  09710002
*                                                                       09720002
*        SET UP FUNCTION RECOVERY ROUTINE FOR QTIP SVC                  09750002
*                                                                       09760002
**********************************************************************  09762002
*                                                                       09764002
         LA    RWK9,QTIPFRR             GET FRR EXIT RTN ADDRESS        09766002
         SETFRR A,FRRAD=(9),WRKREGS=(10,11) SET UP FRR                  09770002
         SPACE 3                                                        09780002
*                                                                       09790002
**********************************************************************  09790402
*                                                                       09790802
*              SAVE RETURN ADDRESS IN TIOCQRET                          09792002
*                                                                       09794002
**********************************************************************  09794102
*                                                                       09794202
         MODESET EXTKEY=TCAM            GET INTO TCAM'S KEY             09794402
         L     RRPT,CVTAQAVT-CVT(,R3)   ADDRESS OF TCX                  09796002
         L     RRPT,TCXRPT-IEDQTCX(,RRPT)  ADDRESS OF TIOCRPT           09798002
         USING TIOCRPT,RRPT             TIOCRPT ADDRESSABLE             09798402
         ST    RLINK,TIOCQRET           SAVE RETURN ADDRESS             09798802
         MVI   TIOCQTKY,E0              CHANGE BACK TO KEY 0 BEFORE     09809002
*                                       RETURNING TO SUPERVISOR         09819002
         DROP  RRPT                     TIOCRPT NOT ADDRESSABLE         09819402
         SPACE 3                                                        09829602
*                                                                       09839802
**********************************************************************  09850002
*                                                                       09900002
*   RESTORE REGISTERS 2-13 FROM THE CALLER-SUPPLIED PARAMETER AREA      10000002
*                                                                       10200002
**********************************************************************  10250002
*                                                                       10300002
         LTR   RPARM,RPARM              ANY PARAMETERS PASSED           10400002
         BZ    ROUTING                  NO, DON'T RESTORE               10600002
         LM    R2,RWK11,E0(RPARM)       RESTORE REG.S                   10800002
         L     R13,R13DISP(,RPARM)      RESTORE REG. 13                 10810002
ROUTING  EQU   *                                                        10992002
         BAL   RLINK,ROUTER             GO CALCULATE DESTINATION        11000002
         DROP  RBASE                    MODULE NOT ADDRESSABLE          11010002
         SPACE 3                                                        11020002
*                                                                       11050002
**********************************************************************  11060002
*                                                                       11070002
*              SVC ENTRY EPILOG                                         11100002
*                                                                       11150002
**********************************************************************  11152002
*                                                                       11154002
         USING *,RLINK                  SET UP BASE FOR MODULE          11154402
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR KEY      11154802
         SETFRR D,WRKREGS=(1,12)        CANCEL THE FRR                  11156002
         B     BREPILOG                 GO TO BRANCH ENTRY EPILOG       11206002
         DROP  RLINK                    DROP MODULE BASE                11256002
         SPACE 5                                                        11292002
*                                                                       11800002
**********************************************************************  11850002
*                                                                       11900002
*              BRANCH ENTRY POINT TO QTIP                               12000002
*                                                                       12200002
**********************************************************************  12250002
*                                                                       12300002
IEDAYQT1 EQU   *                                                        12400002
         ENTRY IEDAYQT1                 ENTRY POINT                     12600002
         SPACE 3                                                        12650002
         L     RPARM,CVTPTR             GET CVT ADDR                    12800002
         L     RPARM,CVTAQAVT-CVT(,RPARM)  GET TCX ADDR                 13000002
         L     RPARM,TCXRPT-IEDQTCX(,RPARM) GET TIOCRPT ADDR            13200002
         USING TIOCRPT,RPARM            TIOCRPT ADDRESSABLE             13400002
         MODESET EXTKEY=TCAM,WORKREG=15, GET TCAM'S KEY AND            -13600002
               SAVEKEY=TIOCQTKY          SAVE CALLER'S KEY              13800002
         L     R15,TIOCQTIP             RELOAD BRANCH ENTRY     YM01373 13850002
         ST    RLINK,TIOCQRET           SAVE RETURN ADDR                14000002
         ST    RBASE,TIOCSAVE           SAVE REGISTER 12                14050002
         DROP  RPARM                    NO LONGER TIOCRPT BASE          14200002
         BALR  RBASE,RWRK0              SET BASE REGISTER               14400002
         USING *,RBASE                  MODULE ADDRESSABILITY           14600002
         BAL   RLINK,ROUTER             SET RETURN ADDR AND             14800002
*                                       GO INVOKE QTIP ROUTINE          15000002
         DROP  RBASE                    END OF ADDRESSABILITY           15200002
         SPACE 3                                                        15250002
*                                                                       15400002
**********************************************************************  15450002
*                                                                       15500002
*              BRANCH ENTRY EPILOG                                      15600002
*                                                                       15800002
**********************************************************************  15850002
*                                                                       15900002
BREPILOG EQU   *                                                        15950002
         L     RBASE,CVTPTR             GET CVT ADDR                    16000002
         L     RBASE,CVTAQAVT-CVT(,RBASE)   GET TCX ADDR                16200002
         L     RBASE,TCXRPT-IEDQTCX(,RBASE) GET TIOCRPT ADDR            16400002
         USING TIOCRPT,RBASE            TIOCRPT ADDRESSABLE             16600002
         L     RLINK,TIOCQRET           RESTORE RETURN ADDR             16800002
         MODESET KEYADDR=TIOCQTKY,      RESTORE CALLER'S KEY           -17000002
               WORKREG=12                                               17200002
         LR    RBASE,R15                RESTORE REG 12 FOR SIC  VS01090 17210002
         DROP  RBASE                    RPT ADDRESSABILITY ENDS         17250002
QTIPEXIT EQU   *                        RETURN TO CALLER (OR SVC EPILOG 17400002
         BR    RLINK                    IN CASE OF INVALID ENTRY)       17410002
         SPACE 3                                                        17450002
*                                                                       17460002
**********************************************************************  17500002
*                                                                       17600002
*   ROUTE THIS REQUEST TO THE APPROPRIATE QTIP ROUTINE                  17800002
*                                                                       18000002
**********************************************************************  18050002
*                                                                       18100002
ROUTER   EQU   *                                                        18200002
         BALR  RBASE,RWRK0              GET ADDRESSABILITY              18400002
         USING *,RBASE                  MODULE ADDRESSABILITY           18600002
         LTR   RPARM,RCODE              IS ENTRY CODE POSITIVE          18800002
         BMR   RLINK                    NO, EXIT                        19000002
         C     RCODE,TBLIMIT            IS ENTRY CODE INVALID           19200002
         BHR   RLINK                    YES, EXIT                       19400002
         SLL   RPARM,TBLSHIFT           GET OFFSET INTO TABLE           19800002
         L     RCODE,TABLE(RPARM)       LOAD ENTRY POINT                20000002
         LR    RPARM,RCODE              GET NO. OF BASE ENTRY           20200002
         SRL   RPARM,E24                RIGHT ADJUST ENTRY NO.          20400002
         SLL   RPARM,TBLSHIFT           GET OFFSET OF BASE ADDR         20600002
         L     RBASE,TABLE(RPARM)       GET BASE ADDR                   20800002
         DROP  RBASE                    MODULE NOT ADDRESSABLE          21000002
         LR    RPARM,RCODE              PREPARE TO BRANCH               21200002
         BR    RPARM                    BR TO QTIP ROUTINE              21400002
         SPACE 3                                                        21450002
*                                                                       21600002
**********************************************************************  21650002
*                                                                       21700002
*   ENTRY POINT AND BASE ADDRESS TABLE FOR QTIP ROUTINES                21800002
*                                                                       22000002
*        BYTE 0 OF EACH ENTRY CONTAINS THE NUMBER OF THE TABLE          22050002
*        ENTRY CONTAINING THE BASE ADDRESS FOR THAT MODULE.             22100002
*                                                                       22150002
**********************************************************************  22160002
*                                                                       22170002
TABLE    DS    0A                                                       22200002
         DC    AL1(00),VL3(QTIP0000)    ATTENTION (IEDAYAA BASE)        22400002
         DC    AL1(23),VL3(QTIP0010)    LOGOFF RECONNECT (IEDAY88 BASE) 22600002
         DC    AL1(00),AL3(QTIPEXIT)    RESERVED                        22800002
         DC    AL1(00),VL3(QTIP0030)    ATTENTION                       23000002
         DC    AL1(04),VL3(QTIP0040)    HANGUP    (IEDAYHH BASE)        23200002
         DC    AL1(05),VL3(QTIP0050)    TSINPUT   (IEDAYII BASE)        23400002
         DC    AL1(05),VL3(QTIP0060)    TSINPUT                         23600002
         DC    AL1(05),VL3(QTIP0070)    TSINPUT                         23800002
         DC    AL1(05),VL3(QTIP0080)    TSINPUT                         24000002
         DC    AL1(05),VL3(QTIP0090)    TSINPUT                         24200002
         DC    AL1(10),VL3(QTIP0100)    LOGON     (IEDAYLL BASE)        24400002
         DC    AL1(11),VL3(QTIP0110)    TSOUTPUT  (IEDAYOO BASE)        24600002
         DC    AL1(11),VL3(QTIP0120)    TSOUTPUT                        24800002
         DC    AL1(11),VL3(QTIP0130)    TSOUTPUT                        25000002
         DC    AL1(11),VL3(QTIP0140)    TSOUTPUT                        25200002
         DC    AL1(11),VL3(QTIP0150)    TSOUTPUT                        25400002
         DC    AL1(11),VL3(QTIP0160)    TSOUTPUT                        25600002
         DC    AL1(00),AL3(QTIPEXIT)    RESERVED                        25800002
         DC    AL1(18),VL3(QTIP0180)    TGET/TPUT (IEDAYGP BASE)        26000002
         DC    AL1(18),VL3(QTIP0190)    TGET/TPUT                       26200002
         DC    AL1(00),AL3(QTIPEXIT)    RESERVED                        26400002
         DC    AL1(00),VL3(QTIP0210)    TCLEARQ                         26600002
         DC    AL1(00),VL3(QTIP0220)    TCLEARQ                         26800002
         DC    AL1(23),VL3(QTIP0230)    TERMINT'N (IEDAY88 BASE)        27000002
         DC    AL1(11),VL3(QTIP0240)    CANCEL                          27200002
         DC    AL1(00),AL3(QTIPEXIT)    RESERVED                        27400002
         DC    AL1(00),AL3(QTIPEXIT)    RESERVED                        27600002
         DC    AL1(23),VL3(QTIP0270)    LOGOFF DISCONNECT(IEDAY88 BASE) 27800002
         DC    AL1(05),VL3(QTIP0280)    TSINPUT                         28000002
         DC    AL1(18),VL3(QTIP0290)    TGET/TPUT                       28200002
TBLIMIT  DC    A((*-TABLE)/4-1)         HIGHEST ENTRY IN TABLE          28400002
         EJECT                                                          28600002
*                                                                       28800002
**********************************************************************  29000002
*                                                                       29200002
*   TPOSTING SUBROUTINE OF QTIP                                         29400002
*                                                                       29600002
**********************************************************************  29800002
*                                                                       30000002
*   REGISTERS AT ENTRY--                                                30200002
*        00 -- RETURN ADDRESS                                           30400002
*        01 -- ADDR OF ELEMENT TO BE TPOSTED (PRIORITY IN BYTE 0).      30600002
*              IF ZERO, MEANS SIMPLY TPOST TSB IF NOT ALREADY TPOSTED.  30800002
*        02 -- TARGET QCB ADDR IF REG. 1 IS NOT ZERO.                   31000002
*              TSB ADDR IF REG. 1=0.                                    31200002
*        13 -- ADDR OF 6 WORD SAVE AREA                                 31400002
*        15 -- ENTRY POINT                                              31600002
*                                                                       31800002
*   REGISTERS 2-14 ARE PRESERVED ACROSS THE CALL                        32000002
*                                                                       32050002
*   CALLER SHOULD BE IN TCAM'S KEY                                      32100002
*                                                                       32200002
IEDAYTPQ EQU   *                                                        32400002
         ENTRY IEDAYTPQ                 ENTRY POINT                     32600002
         USING *,R15                    ROUTINE ADDRESSABLE             32800002
         STM   RWK10,R15,E0(R13)        SAVE REGISTERS                  33000002
         L     RTCX,CVTPTR              GET CVT ADDR                    33200002
         L     RTCX,CVTAQAVT-CVT(,RTCX) GET TCX ADDR                    33400002
         USING IEDQTCX,RTCX             TCX ADDRESSABLE                 33600002
*                                                                       33800002
*   SET UP TO TPOST THE TSB TO IEDAYP                                   34000002
*                                                                       34200002
         LTR   RELEM,RELEM              TPOST OF TSB REQUESTED          34400002
         BNZ   TPOST                    NO, GO TPOST ELEM PASSED        34600002
         USING TSB,RQCB                 TSB ADDRESSABLE                 34800002
         TM    TSBTPFLG,TSBPOSTO        IS TSB ALREADY TPOSTED          35000002
         BO    TPQEXIT                  YES, EXIT                       35200002
*                                                                       35400002
         L     RWK10,TSBTPOST           GET CURRENT SETTINGS            35600002
RESWAP   EQU   *                                                        35800002
         LR    RWK11,RWK10              COPY                            36000002
         O     RWK11,MSKPOSTO           SET TSBPOSTO                    36200002
         CS    RWK10,RWK11,TSBTPOST     FLAG TSB AS TPOSTED             36400002
         BNE   RESWAP                   RETRY UNTIL SUCCESSFUL          36600002
*                                                                       36800002
         LTR   RWK10,RWK10              WAS TSB ALREADY TPOSTED         37000002
         BM    TPQEXIT                  YES, EXIT                       37200002
*                                                                       37400002
         LA    RELEM,TSBRCB             WILL TPOST RCB IN TSB           37600002
         DROP  RQCB                     TSB NOT ADDRESSABLE             37800002
         L     RQCB,TCXTSI              GET ADDR OF TSI                 38000002
         O     RELEM,MSKPRI             INSERT TPOST PRIORITY           38200002
         LA    RQCB,TSITSAP-TSINPUT(,RQCB)  GET ADDR OF 'QCB'           38400002
*                                       FOR IEDAYP                      38600002
*                                                                       38800002
*   TPOST AN ELEMENT TO A QCB                                           39000002
*                                                                       39200002
TPOST    EQU   *                                                        39400002
         USING IEDQRECB,RELEM           ELEMENT IS ADDRESSABLE          39600002
         STCM  RQCB,E7,RECBQCBA         PUT QCB ADDR IN ELEM            39800002
         L     RWK10,TCXREADY           GET CURRENT 1ST ON LIST         40000002
ADDAGAIN EQU   *                                                        40200002
         ST    RWK10,RECBLINK-E1        LINK NEW ELEM TO OLD            40400002
         STCM  RELEM,E8,RECBPRI         SET TPOST PRIORITY              40600002
         CS    RWK10,RELEM,TCXREADY     ADD NEW ELEM TO LIST            40800002
         BNE   ADDAGAIN                 RETRY UNTIL SUCCESSFUL          41000002
         DROP  RELEM                    ELEM ADDRESSABILITY ENDS        41200002
*                                                                       41400002
*   POST TCAM                                                           41600002
*                                                                       41800002
         LR    RELEM,R13                HOLD SAVE AREA ADDR             42000002
         L     RWK11,TCXAVT             GET AVT ADDR                    42200002
         SR    RWK10,RWK10              ZERO COMPLETION CODE            42400002
         LA    RWK11,AVTOSECB-IEDQAVTD(,RWK11)  GET ADDR OF ECB         42600002
         O     RWK11,MSKXMPST           SET XMPOST FLAG                 42800002
         DROP  R15                      DROP BASE REG                   43000002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    43050002
         L     R15,CVTPTR               GET CVT ADDR                    43200002
         USING CVT,R15                  CVT ADDRESSABLE                 43400002
         L     R13,TCXASCB              GET TCAM'S ASCB ADDR            43600002
         LA    R12,CVTBRET              NO ERROR RETURN                 43800002
         L     R15,CVT0PT01             GET EPA FOR POST                44000002
         BALR  RLINK,R15                GO POST TCAM                    44200002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY                  44250002
         DROP  R15                      CVT ADDR ENDS                   44400002
         LR    R13,RELEM                RESTORE SAVE AREA ADDR          44600002
*                                                                       44800002
*   RESTORE REGISTERS AND RETURN TO CALLER                              45000002
*                                                                       45200002
TPQEXIT  EQU   *                                                        45400002
         LM    RWK10,RLINK,E0(R13)      RESTORE                         45600002
         LR    R15,RWRK0                GET RETURN ADDR                 45800002
         BR    R15                      RETURN                          46000002
         EJECT                                                          46200002
*                                                                       46400002
**********************************************************************  46600002
*                                                                       46800002
*    TIOC BUFFER ALLOCATION SUBROUTINE                                  47000002
*                                                                       47200002
**********************************************************************  47400002
*                                                                       47600002
*   INPUT--                                                             47800002
*        REG. 00 - RETURN ADDR                                          48000002
*        REG. 10 - TIOCRPT ADDR (ONLY)                                  48200002
*        REG. 15 - ENTRY POINT ADDR                                     48400002
*   OUTPUT--                                                            48600002
*        REG. 02 - ADDR OF ALLOCATED BUFFER                             48800002
*        TIOCNFBF WILL BE DECREMENTED.                                  49000002
*                                                                       49200002
*   REGISTERS 2 & 15 WILL BE ALTERED BY THIS ROUTINE.                   49400002
*                                                                       49600002
*   FOR PERFORMANCE OPTIMIZATION, THIS ROUTINE ASSUMES ITS              49800002
*   CALLER HAS DETERMINED THAT A BUFFER IS AVAILABLE.                   50000002
*                                                                       50200002
IEDAYQBA EQU   *                                                        50400002
         ENTRY IEDAYQBA                 BUFFER ALLOCATION               50600002
         USING *,R15                    ROUTINE ADDRESSABLE             50800002
         USING TIOCRPT,R10              PASSED AS PARAMETER             51000002
*                                                                       51200002
*   UPDATE THE FREE BUFFER COUNT                                        51400002
*                                                                       51600002
         LH    R2,TIOCNFBF              GET COUNT                       51800002
         BCTR  R2,E0                    DECREMENT                       52000002
         STH   R2,TIOCNFBF              STORE UPDATED COUNT             52200002
*                                                                       52400002
*   FIND FIRST AVAILABLE BUFFER                                         52600002
*                                                                       52800002
         LA    R10,TIOCFBFL             GET ADDR OF 1ST LIST            53000002
         DROP  R10                      TIOCRPT NOT ADDRESSABLE         53200002
BALOOP   EQU   *                                                        53400002
         L     R2,E0(,R10)              GET ADDR OF 1ST ELEM            53600002
         LTR   R2,R2                    IS LIST EMPTY                   53800002
         BP    BFRFOUND                 NO, GO ALLOCATE BFR             54000002
         LA    R10,L'TIOCFBFL(,R10)     GET ADDR OF NEXT LIST           54200002
         B     BALOOP                   GO CHECK IT                     54400002
*                                                                       54600002
*   REMOVE ALLOCATED BUFFER FROM FREE LIST & RETURN                     54800002
*                                                                       55000002
BFRFOUND EQU   *                                                        55200002
         DROP  R15                      DROP BASE REGISTER              55400002
         L     R15,BUFFTRLR-E1-TIOCBUF(,R2)  ADDR OF NEXT ELEM          55600002
         ST    R15,E0(,R10)             MAKE IT FIRST ELEM              55800002
         L     R10,CVTPTR               GET CVT ADDR                    56000002
         L     R10,CVTAQAVT-CVT(,R10)   GET TCX ADDR                    56200002
         LR    R15,R0                   GET RETURN ADDR                 56400002
         L     R10,TCXRPT-IEDQTCX(,R10) GET TIOCRPT ADDR                56600002
         BR    R15                      RETURN                          56800002
         EJECT                                                          57000002
*                                                                       57200002
**********************************************************************  57400002
*                                                                       57600002
*   TIOC BUFFER RETURN SUBROUTINE                                       57800002
*                                                                       58000002
**********************************************************************  58200002
*                                                                       58400002
*   INPUT--                                                             58600002
*        REG. 00 - RETURN ADDR                                          58800002
*        REG. 02 - ADDR OF BUFFER BEING RETURNED                        59000002
*        REG. 10 - TIOCRPT ADDR                                         59200002
*        REG. 15 - ENTRY POINT ADDR                                     59400002
*                                                                       59600002
*   OUTPUT--                                                            59800002
*        TIOCNFBF WILL BE INCREMENTED                                   60000002
*                                                                       60200002
*   REGISTER 15 WILL BE ALTERED BY THIS ROUTINE                         60400002
*   THE HIGH-ORDER BYTE OF REGISTERS 2 & 10 MAY BE ALTERED.             60600002
*                                                                       60800002
IEDAYQBR EQU   *                                                        61000002
         ENTRY IEDAYQBR                 BUFFER RETURN                   61200002
         USING TIOCRPT,R10              TIOCRPT ADDRESSABLE             61400002
*                                                                       61600002
*   UPDATE FREE BUFFER COUNT                                            61800002
*                                                                       62000002
         LH    R15,TIOCNFBF             GET COUNT                       62200002
         LA    R15,E1(,R15)             INCREMENT                       62400002
         STH   R15,TIOCNFBF             STORE UPDATED COUNT             62600002
         LA    R2,E0(,R2)               CLEAR BYTE ZERO                 62800002
*                                                                       63000002
*   DETERMINE WHICH LIST THIS BUFFER SHOULD BE ADDED TO                 63200002
*                                                                       63400002
         LA    R10,TIOCFBFL             GET ADDR OF FIRST LIST          63600002
         DROP  R10                      AS TIOCRPT BASE                 63800002
BRLOOP   EQU   *                                                        64000002
         L     R15,E0(,R10)             GET BUFFER ADDR                 64200002
         LPR   R15,R15                  INSURE POSITIVE VALUE           64400002
*                                       (AN EMPTY LIST POINTER          64600002
*                                       CONTAINS THE COMPLEMENTED       64800002
*                                       ADDR OF THE BFR PAGE)           65000002
         SRL   R15,EPGSHIFT             ISOLATE PAGE NO.                65200002
         SLL   R15,EPGSHIFT             GET ADDRESS OF PAGE             65400002
*                                       CONTAINING THE BUFFERS          65600002
*                                       ON THIS LIST                    65800002
         XR    R15,R2                   .SEE IF RETURNING               66000002
         SRL   R15,EPGSHIFT             .BUFFER BELONGS                 66200002
         LTR   R15,R15                  .ON THIS LIST                   66400002
         BALR  R15,E0                   SET BASE ADDR                   66600002
         USING *,R15                    USE R15 AS BASE REG             66800002
QBRBASE  EQU   *                        TEMPORARY BASE                  67000002
         BZ    LSTFOUND                 BR IF BFR GOES ON THIS LIST     67200002
         LA    R10,L'TIOCFBFL(,R10)     POINT AT NEXT LIST              67400002
         S     R15,QBRDISP              GET BRANCH ADDR                 67600002
         DROP  R15                      ADDRESSABILITY CHANGED          67800002
         BR    R15                      GO CHECK NEXT LIST              68000002
QBRDISP  DC    A(QBRBASE-BRLOOP)        DISPLACEMENT TO BR ADDR         68200002
*                                                                       68400002
*   ADD BUFFER TO LIST & RETURN                                         68600002
*                                                                       68800002
LSTFOUND EQU   *                                                        69000002
         L     R15,E0(,R10)             GET ADDR OF 1ST ELEMENT         69200002
         ST    R15,BUFFTRLR-E1-TIOCBUF(,R2)  LINK NEW BFR TO OLD        69400002
         ST    R2,E0(,R10)              PUT NEW BFR AS 1ST              69600002
*                                                                       69800002
         L     R10,CVTPTR               GET CVT ADDRESS                 70000002
         L     R10,CVTAQAVT-CVT(,R10)   GET ADDR OF TCX                 70200002
         LR    R15,R0                   GET RETURN ADDR                 70400002
         L     R10,TCXRPT-IEDQTCX(,R10) GET ADDR OF TIOCRPT             70600002
         BR    R15                      RETURN                          70800002
         DROP  RTCX                     TCX NOT ADDRESSABLE             70802002
         EJECT                                                          70810002
*                                                                       70850002
**********************************************************************  70900002
*                                                                       70950002
*                      QTIP FRR EXIT ROUTINE                            70960002
*                                                                       70962002
*        THIS ROUTINE GETS CONTROL WHEN ABNORMAL SITUATION OCCURS       70964002
*        DURING THE PROCESS OF SVC 101.  IT REQUESTS THE RTM TO -       70968002
*                                                                       70968802
*        * DUMP THE TIOCRPT AND TSB TABLE                               70969202
*        * WRITE THE SDWA WORKAREA TO SYS1.LOGREC SO THE REGISTERS AT   70969602
*          TIME OF ERROR CAN BE EXAMINED                                70969702
*        * RELEASE THE CMS AND LOCAL LOCKS                              70969802
*        * CONTINUE WITH TERMINATION                                    70969902
*                                                                       70970002
*        REGISTERS AT ENTRY -                                           70972002
*                                                                       70974002
*        REGISTER  1 - SDWA                                             70976002
*        REGISTER 14 - RETURN ADDRESS                                   70978002
*        REGISTER 15 - ENTRY ADDRESS                                    70978402
*                                                                       70978802
**********************************************************************  70980002
*                                                                       70990002
QTIPFRR  EQU   *                                                        70990402
         USING *,RBASE                  ROUTINE ADDRESSABLE             70990502
         LR    RBASE,R15                LOAD BASE REGISTER              70990802
         USING SDWA,RPARM               SDWA (RTCA) ADDRESSABLE         70994002
*                                                                       70994402
*   CALCULATE THE STORAGE OF TIOCRPT AND TSB TABLE TO DUMP              70994802
*                                                                       70995202
         L     R3,CVTPTR                GET CVT ADDRESS                 70996002
         USING CVT,R3                   CVT ADDRESSABLE                 70998002
         L     RRPT,CVTAQAVT            GET TCX ADDRESS                 70998402
         L     RRPT,TCXRPT-IEDQTCX(,RRPT)    GET TIOCRPT ADDRESS        70999202
         USING TIOCRPT,RRPT             TIOCRPT ADDRESSABLE             70999602
         SR    RWK10,RWK10              CLEAR WORK REGISTER             70999702
         IC    RWK10,TIOCTSBS           GET TSB SIZE                    70999802
         LH    RWK11,TIOCNTSB           GET NUMBER OF TSB'S             70999902
         MR    RWK10,RWK10              REG 11 HAS TSB TABLE SIZE       71049902
         BCTR  RWK11,R0                 1 LESS THAN TSB TABLE SIZE      71051902
         L     RWK10,TIOCTSB-E1         GET BEGINNING OF TSB TABLE      71059902
         LA    RWK10,E0(,RWK10)         CLEAR HIGH ORDER BYTE           71061902
         AR    RWK10,RWK11              GET ENDING ADDRESS OF TSB TABLE 71069902
*                                                                       71070002
*   SET UP THE LIST FOR RTM TO TAKE A SNAP DUMP                         71070102
*                                                                       71070202
         MVC   SDWAVLST(ENDLIST-SNAPLIST),SNAPLIST   MOVE LIST TO WA    71072302
         LA    RWK11,STARTADD           GET ADDR OF SNAP SHOT LIST      71075202
         ST    RWK11,SNAPSHOT           PUT IT IN WORK AREA             71077302
         ST    RRPT,STARTADD            RPT IS THE STARTING ADDRESS     71079402
         O     RWK10,HIGHON             LAST PARM INDICATOR             71081502
         ST    RWK10,ENDADD             END OF TSB TABLE IS ENDING ADDR 71083602
         LR    RWK9,RLINK               SAVE RETURN ADDRESS TO RTM      71085702
         SPACE 1                                                        71087802
         SETRP DUMP=YES,DUMPOPT=SDWAVLST,RECORD=YES,RECPARM=IDLIST,    X71089902
               RC=0,FRELOCK=(CMS,LOCAL)                                 71091902
         SPACE 1                                                        71092302
         BR    RWK9                     GO BACK TO RTM                  71116302
         DROP  R3,RRPT                  DROP REGISTERS                  71127502
         SPACE 4                                                        71138702
SNAPLIST SNAP  STORAGE=(0,0),MF=L       LIST FORM FOR SNAP MACRO        71188702
ENDLIST  EQU   *                        END OF SNAP LIST                71238702
         SPACE 4                                                        71259902
*                                                                       71299902
*   CONSTANTS                                                           71400002
*                                                                       71600002
         DS    0F                       ALIGNMENT                       71800002
MSKPOSTO DC    AL1(TSBPOSTO,0,0,0)      TSB POST OUTSTANDING            72000002
MSKXMPST EQU   MSKPOSTO                 CROSS-MEMORY POST               72200002
MSKPRI   DC    AL1(PRIDESTQ,0,0,0)      TPOST PRIORITY                  72400002
HIGHON   DC    X'80000000'              USED TO SET HIGH ORDER BIT ON   72450002
IDLIST   DC    CL8'IEDAYQT'             MICROFICHE NAME                 72500002
         DC    CL8'IEDAYQT'             CSECT NAME                      72550002
         DC    CL8'IEDAYQT'             FRR ID                          72560002
PATCH    DC    9F'0'                    PATCH AREA                      72600002
         EJECT                                                          72800002
         IHAASCB                                                        72850002
         EJECT                                                          72900002
         IHAASXB                                                        72950002
         EJECT                                                          72960002
         TAVTD                                                          73000002
         EJECT                                                          73200002
         IKJTIOCB                                                       73400002
         EJECT                                                          73600002
CVT      DSECT                                                          73800002
         CVT                                                            74000002
         EJECT                                                          74200002
         IHAFRRS                                                        74250002
         EJECT                                                          74300002
         TPRIOR                                                         74400002
         EJECT                                                          74600002
         IHAPSA                                                         74650002
         EJECT                                                          74700002
         IKJRB                                                          74800002
         EJECT                                                          75000002
         TRECBD                                                         75200002
         EJECT                                                          75250002
         IHASDWA                                                        75300002
         SPACE 1                                                        75350002
SDWAVLST EQU   SDWAVRA                  USE FIRST PORTION OF    ZA00611 75360003
*                                       RECORDING AREA AS LIST FOR SNAP 75370002
SNAPSHOT EQU   SDWAVRA+16               ADDR OF SNAP-SHOT LIST  ZA00611 75380003
STARTADD EQU   SDWAVRA+20               BEGINNING ADDR FOR SNAP ZA00611 75390003
ENDADD   EQU   SDWAVRA+24               ENDING ADDRESS FOR SNAP ZA00611 75392003
         EJECT                                                          75400002
         IKJTCB                                                         75600002
         EJECT                                                          75800002
         TTCXD                                                          76000002
         EJECT                                                          76200002
         IKJTIOCP                                                       76400002
         EJECT                                                          76600002
         IKJTSB                                                         76800002
         EJECT                                                          77000002
         TTSID                                                          77200002
         EJECT                                                          77250002
         IHAWSAVT                                                       77300002
         END                                                            77400002
./  ADD  SSI=81000364,NAME=IEDAY1
         TITLE 'IEDAY1 - TIOC INITIALIZATION'                           00060002
IEDAY1   CSECT                                                          00120002
* ********************************************************************* 00230002
*                                                                       00232002
*01* MODULE-NAME = IEDAY1                                               00234002
*                                                                       00236002
*01* DESCRIPTIVE-NAME = TIOC INITIALIZATION/DE-INITIALIZATION           00238002
*                                                                       00238402
*01* COPYRIGHT = NONE                                                   00238802
*                                                                       00239202
*01* STATUS = 00                                                        00239602
*                                                                       00239702
*01* FUNCTION = START - COMPUTE AND OBTAIN MAIN STORAGE REQUIRED FOR    00239802
*                       TIOC.  INITIALIZE TIOC CONTROL CLOCKS AND       00239902
*                       BUFFERS.                                        00259902
*               STOP  - CLEAR POINTERS IN CONTROL BLOCKS AND FREE       00269902
*                       TIOC MAIN STORAGE.                              00279902
*                                                                       00286602
*01* NOTES = N/A                                                        00288602
*                                                                       00290602
*01* RESTRICTIONS = N/A                                                 00292602
*                                                                       00293002
*02*   DEPENDENCIES = NONE                                              00293102
*                                                                       00293202
*02*   RESTRICTIONS = NONE                                              00309902
*                                                                       00319902
*02*   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                      00321902
*                                                                       00323902
*02*   PATCH-LABEL = PATCH                                              00325902
*                                                                       00326302
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             00326402
*                                                                       00326502
*02*   PROCESSOR = ASSEMXF-370R                                         00332102
*                                                                       00334102
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID-01       00336102
*                                                                       00336502
*02*   ATTRIBUTES = REENTRANT, REUSABLE, ENABLED                        00336902
*                                                                       00337302
*01* ENTRY-POINT = IEDAY1                                               00337402
*                                                                       00337502
*02*   PURPOSE = SEE FUNCTION                                           00339502
*                                                                       00341502
*02*   LINKAGE = FROM TCAM OPERATOR CONTROL MODULE IGCM010D VIA XCTL    00341902
*                                                                       00342302
*01* INPUT = REGISTER 1 CONTAINS ADDRESS OF OPERATOR CONTROL AVT        00342702
*                                                                       00343102
*01* OUTPUT = REGISTER 1 CONTAINS ADDRESS OF OPERATOR CONTROL AVT       00343202
*             REGISTER 4 CONTAINS ADDRESS OF TCAM AVT                   00356002
*                                                                       00366002
*01* EXIT-NORMAL = TO TCAM OPERATOR CONTROL MODUEL IGC0710D VIA XCTL    00368002
*                                                                       00368402
*01* EXIT-ERROR = NONE                                                  00368502
*                                                                       00368602
*01* EXTERNAL REFERENCES = SYSTEM INITIATED CANCEL VIA BRANCH ENTRY     00368702
*                                                                       00373002
*02*   CONTROL-BLOCKS = ASCB, CVT, SCVT, TCAM AVT, TCAM OPCAVT,         00375002
*                       TCAM OPE, DCB, QCB, TNT, TIOCBUF, TIOCRPT,      00377002
*                       TCX, TRM, TSB                                   00379602
*                                                                       00383602
*01* TABLES = SEE WORK AREA MAPPING LABELED DAPLIST, DUPLIST, PARMTBL,  00387702
*             WASTART, WASTOP                                           00388102
*                                                                       00388802
*01* MACROS = GETMAIN, FREEMAIN, ATTACH, DETACH, OPEN, CLOSE, READ,     00391402
*             WTO, FIND, TSEND, TCABEND, MODESET, DYNALLOC, LOAD,       00394002
*             SETLOCK                                                   00396602
*                                                                       00399202
*         VS2 030  SU                                                   00399603
*                                                                       00400003
*                                                              @ZA09955 00400100
*  D 058800                                                     ZA09955 00400200
*  A 058800-059200                                              ZA09955 00400300
*0000079210                                                    @ZA05227 00400403
*                                                                       00400803
*                                                                       00401203
*01* CHANGE-ACTIVITY  VS01806 05/17/73                                  00401802
*                     VS01246 06/06/73                                  00403802
*                     VS01382 06/27/73                                  00404202
*                     VS01176 07/16/73                                  00404302
*                     VS03016 08/07/73                                  00414302
*                     VS03842 09/18/73                                  00416302
*                     VS04639 10/15/73                                  00418302
*                                                                       00423602
*********************************************************************/  00433002
*                                                                       00442402
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00451802
*                                                                       00461202
*              REGISTER EQUATES                                         00470602
*                                                                       00480002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00540002
*                                                                       00600002
R0       EQU   0                        WORK REGISTER                   00660002
R1       EQU   1                        PARM/WORK REGISTER              00720002
R2       EQU   2                        KEYWORD TABLE ENTRY/WORK REG    00780002
R3       EQU   3                        WORK REGISTER                   00840002
R4       EQU   4                        WORK REGISTER                   00900002
R5       EQU   5                        WORK REGISTER                   00960002
R6       EQU   6                        WORK REGISTER                   01020002
RQCB     EQU   7                        HAS ADDRESS OF QCB              01080002
R7       EQU   7                        TIOCRPT ADDRESS/WORK REGISTER   01140002
R8       EQU   8                        TSB ADDRESS/WORK REGISTER       01200002
R9       EQU   9                        BUFFER ADDRESS/WORK REGISTER    01260002
RSTOP    EQU   10                       STOPPER WHILE SCANNING PARM     01320002
R10      EQU   10                       WORK REGISTER                   01380002
RWABASE  EQU   11                       WORK AREA BASE                  01440002
RBASE    EQU   12                       BASE REGISTER                   01500002
R13      EQU   13                       POINT TO REGISTER SAVE AREA     01550002
ROPCAVT  EQU   13                       POINT TO TCAM OP CONTROL AVT    01560002
R14      EQU   14                       RETURN ADDRESS/WORK REGISTER    01620002
R15      EQU   15                       ENTRY ADDRESS/WORK REGISTER     01680002
         SPACE 3                                                        01740002
*                                                                       01800002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 01860002
*                                                                       01920002
*              EQUATES FOR MASKS, LENGTH, DISPLACEMENTS                 01980002
*              AND CONSTANTS                                            02040002
*                                                                       02100002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02160002
*                                                                       02220002
E0       EQU   0                        '0'                             02280002
ECABEND  EQU   0                        ENTRY CODE FOR TCABEND  YM03842 02330002
E1       EQU   1                        '1'                             02340002
NOTDUMP  EQU   1                        FLAG FOR NOT DUMPING    YM03842 02390002
E2       EQU   2                        '2'                             02400002
E3       EQU   3                        '3'                             02460002
E4       EQU   4                        '4'                             02520002
E5       EQU   5                        '5'                             02580002
E6       EQU   6                        '6'                             02640002
E7       EQU   7                        '7'                             02700002
E8       EQU   8                        '8'                             02760002
E10      EQU   10                       '10'                            02820002
E13      EQU   13                       '13'                            02870002
E20      EQU   20                       '20'                            02880002
E24      EQU   24                       '24'                            02940002
E33      EQU   33                       '33'                            03000002
E36      EQU   36                       '36'                            03060002
E37      EQU   37                       '37'                            03120002
E38      EQU   38                       '38'                            03180002
E63      EQU   63                       '63'                            03240002
E68      EQU   68                       '68'                            03300002
TYPE31   EQU   31                       SMF RECORD TYPE                 03360002
TERMSTUS EQU   94                       SVC NUMBER FOR TERM     YM03842 03410002
*                                       STATUS                  YM03842 03412002
QTIP     EQU   101                      SVC NUMBER FOR QTIP             03420002
TIOCSP   EQU   231                      SUBPOOL NO. FOR TIOC STORAGE    03480002
REPLYL   EQU   5                        REPLY LENGTH FOR WTOR           03530002
EQUAL    EQU   C'='                     EQUAL SIGN                      03540002
BLANK    EQU   X'40'                    BLANK                           03600002
COMMA    EQU   C','                     COMMA                           03660002
LOW      EQU   4                        1ST COMPARAND LOW               03720002
NOTHIGH  EQU   13                       CONDITION CODE NOT HIGH AFTER   03780002
*                                       COMPARE                         03840002
TRMTSO   EQU   X'01'                    TERMINAL IS SUPPORTED BY TS     03900002
NOT      EQU   X'FF'                    USED TO TURN BITS OFF           03960002
XF0      EQU   X'F0'                    USED TO OR THE ZONE FIELD       04020002
UNALLOC  EQU   X'02'                    VERBCODE FOR UNALLOCATION       04070002
WAITBIT  EQU   X'80'                    DENOTE ECB IS BEING WAITED ON   04070102
POSTBIT  EQU   X'40'                    DENOTE ECB HAS BEEN POSTED      04120002
MINIBFNO EQU   4                        MINIMUM BUFFER NUMBER           04140002
MINIBFSZ EQU   20                       MINIMUM BUFFER SIZE             04200002
MAXIBFSZ EQU   252                      MAXIMUM BUFFER SIZE             04260002
DEFTBFSZ EQU   64                       DEFAULT BUFFER SIZE             04320002
DEFTOWTH EQU   20                       DEFAULT OWAITHI                 04380002
DEFTNLKH EQU   4                        DEFAULT INLOCKHI                04440002
INPTDALN EQU   2                        OFFSET TO DATA LENGTH FIELD     04490002
INPTDATA EQU   8                        OFFSET TO DATA FIELD            04492002
SYNTAXID EQU   18                       MSG ID FOR SYNTAX ERROR         04494002
         SPACE 3                                                        04500002
*                                                                       04560002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04620002
*                                                                       04680002
*              BEGINNING OF MODULE                                      04740002
*                                                                       04800002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04860002
*                                                                       04920002
         SPACE 3                                                        04980002
HEREWEGO EQU   *                                                        05040002
         BALR  RBASE,R0                 SET BASE REGISTER               05100002
         USING *,RBASE                  MODULE ADDRESSABILITY           05160002
         USING IEDQOPCD,ROPCAVT         ADDRESSABILITY FOR OPC AVT      05220002
         USING IEDQAVTD,R10             ADDRESSABILITY FOR TCAM AVT     05280002
         B     SKIPID                   SKIP MODULE ID                  05340002
         DC    C'IEDAY1'                MODULE NAME                     05400002
         DC    X'5253'                  JULIAN DATE - 09/10/75 @ZA05227 05460003
         DS    0H                       ALIGN ON HALF WORD BOUNDARY     05520002
         SPACE 1                                                        05580002
SKIPID   EQU   *                                                        05640002
         LR    ROPCAVT,R1               SET BASE FOR OP CONTROL AVT     05700002
         L     R10,OPCAVTPT             SET BASE FOR TCAM AVT           05760002
         L     R3,OPCCOPCE              GET ADDRESS OF OPC ELEMENT      05810002
         USING IEDQOPCE,R3              USE R3 AS OPC ELEMENT BASE      05812002
         TM    OCFLAG,OCCONSOL          IS MSG FROM SYS OPERATOR        05814002
         BNZ   MSGOK              YES, CONTINUE                @ZA09955 05880000
         L     R5,OPCWORK         GET OPC ELEMENT BASE          ZA09955 05887000
         SR    R4,R4              CLEAR REG.                    ZA09955 05894000
         STH   R4,0(,R5)          ZERO MSG LENGTH               ZA09955 05901000
         B     EXIT               GO TO EXIT                    ZA09955 05908000
MSGOK    EQU   *                                                ZA09955 05915000
         DROP  R3                       DROP OPC ELEMENT BASE           05930002
         L     R2,OPCWORK               GET ADDR OF OPER CTL WORK AREA  05940002
         LA    R3,INPTDATA(,R2)         SET PTR TO DATA                 06000002
         LH    R5,INPTDALN(,R2)         GET LENGTH OF DATA AREA         06060002
         SPACE 1                                                        06120002
FINDEQ   EQU   *                                                        06180002
         CLI   E0(R3),EQUAL             SCAN FOR EQUAL SIGN             06240002
         BE    FOUNDEQ                  BR IF FOUND                     06300002
         LA    R3,E1(R3)                INCREMENT PTR BY 1              06360002
         BCT   R5,FINDEQ                LOOK AT NEXT CHAR IF ANY        06420002
         B     ERROR01                  ERROR CONDITION - STOP          06480002
         SPACE 1                                                        06540002
FOUNDEQ  EQU   *                                                        06600002
         CLC   CSTOP,E1(R3)             IS REQUEST FOR STOP             06660002
         BE    STOP                     YES, GO TO PROCESS STOP         06720002
         CLC   CSTART,E1(R3)            IS REQUEST FOR START            06780002
         BNE   ERROR01                  ERROR CONDITION                 06840002
         LA    R4,E6                    SUBTRACT LENGTH OF '=START'     06890002
         SR    R5,R4                    FROM DATA LENGTH                06892002
         BNP   START                    NO MEMBER NAME SPECIFIED        06894002
         CLI   E6(R3),COMMA             SCAN FOR ',' AFTER 'START'      06896002
         BNE   ERROR01                  ERROR CONDITION IF NOT ','      06898002
         SPACE 3                                                        06900002
*                                                                       06960002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07020002
*                                                                       07080002
*              INITIALIZATION FOR TIME SHARING                          07140002
*                                                                       07200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07260002
*                                                                       07320002
*                                                                       07380002
* GETMAIN FOR WORK AREA                                                 07440002
*                                                                       07500002
START    EQU   *                                                        07560002
         IPK                            GET CALLER'S KEY IN REG 2       07620002
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          07680002
         LA    R0,WAEND-WASTART         SIZE OF WORK AREA               07740002
         GETMAIN R,LV=(0)               GET STORAGE FOR WORK AREA       07800002
         LR    RWABASE,R1               STORAGE RETURNED IN R1          07860002
         USING WASTART,RWABASE          ADDRESSABILITY FOR WORK AREA    07920002
         ST    ROPCAVT,OPCAVTSV         SAVE OPCAV             @ZA05227 07950003
         STC   R2,CALLRKEY              SAVE CALLER'S KEY IN WORK AREA  07980002
         L     R2,CVTPTR                GET CVT ADDRESS                 08040002
         L     R2,CVTAQAVT-CVT(,R2)     POINT TO TCX                    08100002
         L     R4,TCXRPT-IEDQTCX(,R2)   GET RPT POINTER                 08160002
         LTR   R4,R4                    HAS TS ALREADY BEEN INITIALIZED 08220002
         BNZ   ERROR02                  YES, TELL OPERATOR SO           08280002
         L     R4,AVTTSOPT              GET TSINPUT'S QCB ADDR          08340002
         LTR   R4,R4                    DOES TCAM SUPPORT TS            08400002
         BZ    ERROR03                  NO, TELL OPERATOR SO            08460002
         DROP  R10                                                      08520002
         SPACE 3                                                        08580002
*                                                                       08640002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08700002
*                                                                       08760002
*              ALLOCATE SYS1.PARMLIB                                    08820002
*                                                                       08880002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08940002
*                                                                       09000002
         MVC   RQBLOCK(DAPEND-DAPLIST),DAPLIST  MOVE REQUEST BLOCK FOR  09060002
*                                       DNY ALLOCATION TO WORK AREA     09120002
         MVC   KYWDTBL(ENDPMTBL-PARMTBL),PARMTBL  INITIALIZE TIOC       09180002
*                                                 PARM KEYWORD TABLE    09240002
         LA    R2,RQBLOCK               R2 HAS REQUEST BLOCK ADDRESS    09300002
         O     R2,HIBITON               TURN HIGH ORDER BIT ON          09360002
         ST    R2,RQBLKPTR              PUT IN WORK AREA                09420002
         LA    R4,WATPTR1               ADDR OF TEXT PTR IN WORK AREA   09600002
         ST    R4,TEXTPTR               PUT IT IN REQUEST BLOCK         09660002
         LA    R4,WATEXT1               ADDR OF TEXT UNIT 1 IN WA       09710002
         ST    R4,WATPTR1               RELOCATE WA TEXT POINTER 1      09712002
         LA    R4,WATEXT2               ADDR OF TEXT UNIT 2 IN WA       09714002
         ST    R4,WATPTR2               RELOCATE WA TEXT POINTER 2      09716002
         LA    R4,WATEXT3               ADDR OF TEXT UNIT 3 IN WA       09720002
         ST    R4,WATPTR3               RELOCATE WA TEXT POINTER 3      09780002
         LA    R4,WATEXT4               ADDR OF TEST UNIT 4 IN WA       09830002
         O     R4,HIBITON               SIGNAL LAST POINTER             09830402
         ST    R4,WATPTR4               RELOCATE WA TEXT POINTER 4      09832002
         SPACE 1                                                        09840002
         DYNALLOC                       ALLOCATE SYS1.PARMLIB           09900002
         SPACE 1                                                        09960002
         LH    R4,ERRCODE               GET RETURN CODE                 10020002
         LTR   R4,R4                    IS ALLOCATION SUCCESSFUL        10080002
         BNZ   ERROR041                 NO, SEND ERROR MSG              10140002
         SPACE 3                                                        10200002
*                                                                       10260002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10320002
*                                                                       10380002
*              OPEN SYS1.PARMLIB                                        10440002
*                                                                       10500002
* MOVE DCB TO THE WORK AREA, BUILD A ONE-WORD PARAMETER LIST FOR OPEN   10550002
* AS FOLLOWS -                                                          10552002
*                                                                       10680002
*        BYTE 0     X'80'               LAST DCB, OPEN FOR INPUT        10740002
*        BYTE 1-3                       DCB ADDRESS                     10800002
*                                                                       10860002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10920002
*                                                                       10980002
         USING IHADCB,R2                ADDRESSABILITY FOR DCB          11040002
         MVC   WADCB(ENDDCB-PARMDCB),PARMDCB MOVE DCB TO WORK AREA      11100002
         LA    R2,WADCB                 GET ADDRESS OF DCB IN WORK AREA 11150002
         O     R2,HIBITON               SET HI ORDER BIT ON TO INDICATE 11152002
*                                       LAST DCB TO OPEN                11154002
         ST    R2,OPENPARM              INITIALIZE PARM LIST IN WA      11156002
         MVC   DOUBLE1(E2),WADDLEN      MOVE LENGTH OF PARMLIB DDNAME   11160002
*                                       RETURNED BY DYNAMIC ALLOCATION  11220002
         LH    R1,DOUBLE1               PUT LENGTH IN REGISTER          11280002
         BCTR  R1,R0                    DECREMENT FOR EX INSTRCTION     11340002
         EX    R1,MOVEDDNM              MOVE PARMLIB DDNAME TO DCB      11400002
         LA    R1,OPENPARM              SET UP PARMLIST PTR             11460002
         OPEN  MF=(E,(1))               OPEN SYS1.PARMLIB               11520002
         TM    DCBOFLGS,DCBOFOPN        IS OPEN SUCCESSFUL              11580002
         BZ    ERROR04                  NO, SEND ERROR MSG              11640002
         DROP  R2                                                       11700002
         SPACE 3                                                        11760002
*                                                                       11820002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11880002
*                                                                       11940002
*              FIND SYS1.PARMLIB MEMBER WHICH CONTAINS                  12000002
*              TIOC PARAMETERS                                          12060002
*                                                                       12120002
* SEE WHETHER A MEMBER NAME IS SPECIFIED. CONTINUE TO SCAN TCAM         12180002
* OPERATOR WORK AREA. R5 HAS REMAINING DATA LENGTH, R3 POINTS AT        12240002
* THE EQUAL SIGN                                                        12300002
*                                                                       12360002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 12420002
*                                                                       12480002
GETMEM   EQU   *                                                        12780002
         BCTR  R5,R0                    TAKE AWAY LENGTH FOR ','        12840002
         LA    R4,E8                    PUT 8 IN REG                    12900002
         CR    R5,R4                    IS MEMBER NAME GT 8 BYTES       12960002
         BH    ERROR05                  YES, SEND ERROR MESSAGE         13020002
         SPACE 3                                                        13080002
*                                                                       13140002
* FIND MEMBER IF SPECIFIED, OTHERWISE FIND IKJPRM00                     13200002
*                                                                       13260002
*                                                                       13320002
         LTR   R5,R5                    IS MEMBER SPECIFIED             13380002
         BNP   PRM00                    NO, FIND IKJPRM00               13440002
         L     R4,BLANKS                .BLANK OUT THE                  13500002
         ST    R4,DOUBLE1               .DOUBLE WORD WORK AREA          13560002
         ST    R4,DOUBLE1+E4            .FOR FIND MACRO                 13620002
         BCTR  R5,R0                    DECREMENT FOR EX                13680002
         EX    R5,MOVENAME              MOVE MEMBER NAME                13740002
         LA    R5,E1(,R5)               RESTORE MEMBER NAME LENGTH      13800002
         SPACE 1                                                        13860002
FINDMEM  EQU   *                                                        13920002
         FIND  WADCB,DOUBLE1,D          FIND MEMBER NAME                13980002
         SPACE 1                                                        14040002
         LA    R0,E4                    PUT 4 IN REG                    14100002
         CR    R15,R0                   WAS MEMBER FOUND                14160002
         BL    READRCD                  YES, PROCESS MEMBER             14220002
         BH    ERROR06                  I/O ERROR, SEND ERROR MSG       14280002
         LTR   R5,R5                    WAS MEMBER SPECIFIED            14340002
         BNP   ERROR08                  NO, USE DEFAULT VALUES          14400002
         SPACE 3                                                        14460002
*                                                                       14520002
* WHEN MEMBER IS SPECIFIED BUT CANNOT BE FOUND, START TIME SHARING      14580002
* REQUEST WILL BE REJECTED                                              14640002
*                                                                       14700002
ERROR05  EQU   *                                                        14760002
         L     R1,MSG005I               GET ADDR OF MSG LIST            14820002
         BAL   R14,WTO                  INFORM OPERATOR                 14880002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   14940002
         B     FREEWA                   FREE WORK AREA AND EXIT         15000002
         SPACE 3                                                        15060002
PRM00    EQU   *                                                        15120002
         MVC   DOUBLE1,CPRM00           MOVE NAME 'IKJPRM00' TO WORK    15180002
*                                       AREA                            15240002
         B     FINDMEM                  GO TO FIND IT                   15300002
         SPACE 3                                                        15360002
*                                                                       15420002
* READ MEMBER RECORD                                                    15480002
*                                                                       15540002
READRCD  EQU   *                                                        15600002
         XC    WADECB,WADECB            ZERO DECB IN WORK AREA          15660002
         ST    ROPCAVT,OPCAVTSV         SAVE OPC AVT ADDRESS            15710002
         LA    R13,REGSAVE              GET REGISTER SAVE AREA          15712002
         SPACE 1                                                        15720002
NEXTRCD  EQU   *                                                        15780002
         READ  WADECB,SF,WADCB,BUFFER,MF=E  READ A RECORD               15840002
         CHECK WADECB                   FINISH READING IT               15900002
         SPACE 3                                                        15960002
*                                                                       16020002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 16080002
*                                                                       16140002
*              SCAN THE RECORD WHICH IS IN 80 COLUMN CARD IMAGE         16200002
*              ENTER PARAMETER VALUES IN KEYWORD TABLE                  16260002
*                                                                       16320002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 16380002
*                                                                       16440002
         LA    R3,BUFFER                POINTS AT COLUMN 1              16500002
         LA    RSTOP,E63(,R3)           ONLY WANTS TO SCAN TO COL 64    16560002
         SPACE 1                                                        16620002
SKIPBLNK EQU   *                                                        16680002
         CLI   E0(R3),BLANK             CHECK FOR BLANK                 16740002
         BNE   CHKTIOC                  GO TO FURTHER SCAN              16800002
         CR    R3,RSTOP                 CHECK FOR END OF CARD           16860002
         BNL   NEXTRCD                  IF END OF CARD, READ NEXT RCD   16920002
         LA    R3,E1(,R3)               OTHERWISE ADVANCE 1 COLUMN      16980002
         B     SKIPBLNK                 CHECK FOR BLANK AGAIN           17040002
         SPACE 1                                                        17100002
CHKTIOC  EQU   *                                                        17160002
         CLC   E0(E5,R3),CTIOC          SCAN FOR TIOC CARD              17220002
         BNE   NEXTRCD                  NOT TIOC CARD, READ NEXT RECORD 17280002
         SPACE 1                                                        17340002
*                                                                       17400002
* WHEN A TIOC CARD HAS BEEN IDENTIFIED, SCAN FOR PARAMETERS             17460002
*                                                                       17520002
         SPACE 1                                                        17580002
FINDPARM EQU   *                                                        17640002
         LA    R3,E5(,R3)               POINT TO 1ST POSSIBLE PARM      17700002
         LA    RSTOP,E5(,RSTOP)         STOP AT COL 69                  17760002
         SPACE 1                                                        17820002
SKIPBLK  EQU   *                                                        17880002
         CLI   E0(R3),BLANK             SKIP ANY BLANKS                 17940002
         BNE   EQUSIGN                  NOT BLANK, FURTHER SCAN         18000002
         CR    R3,RSTOP                 CHECK FOR END OF CARD           18060002
         BNL   NEXTRCD                  IF END OF CARD READ NEXT RECORD 18120002
         LA    R3,E1(,R3)               ADVANCE 1 COLUMN                18180002
         B     SKIPBLK                  CONTINUE LOOKING FOR BLANK      18240002
         SPACE 1                                                        18300002
EQUSIGN  EQU   *                                                        18360002
         LA    R4,E1(,R3)               USED TO SCAN EQUAL SIGN         18420002
         LA    RSTOP,E1(,RSTOP)         STOP AT COL 70                  18480002
         SPACE 1                                                        18540002
SCANEQU  EQU   *                                                        18600002
         CLI   E0(R4),EQUAL             LOOK FOR EQUAL SIGN             18660002
         BE    GETVALUE                 FOUND EQUAL SIGN                18720002
         CR    R4,RSTOP                 CHECK END OF CARD               18780002
         BL    NEXTCHAR                 BRANCH IF NOT END OF CARD       18840002
         LA    R5,E1(,R4)               R5 POINTS TO COL 71             18900002
         SPACE 1                                                        18960002
ISITBLNK EQU   *                                                        19020002
         CLI   E0(R5),BLANK             CHECK FOR BLANK                 19080002
         BNE   NOTBLANK                 BRANCH IF NOT BLANK             19140002
         BCTR  R5,R0                    BACK UP 1 COLUMN                19200002
         B     ISITBLNK                 CHECK FOR BLANK AGAIN           19260002
         SPACE 1                                                        19320002
NOTBLANK EQU   *                                                        19380002
         BAL   R14,KYWDBAD              GO TO SEND ERROR MESSAGE        19440002
         B     NEXTRCD                  READ IN NEXT RECORD             19500002
         SPACE 1                                                        19560002
NEXTCHAR EQU   *                                                        19620002
         LA    R4,E1(,R4)               ADVANCE 1 COLUMN                19680002
         B     SCANEQU                  CONTINUE LOOKING FOR EQUAL SIGN 19740002
         SPACE 1                                                        19800002
GETVALUE EQU   *                                                        19860002
         LA    R5,E1(R4)                POINTS TO 1ST BYTE OF VALUE     19920002
         LA    RSTOP,E1(,RSTOP)         STOP AT COL 71                  19980002
         SPACE 1                                                        20040002
DELIMTER EQU   *                                                        20100002
         CLI   E0(R5),BLANK             CHECK FOR BLANK                 20160002
         BE    NOTEOC                   FOUND BLANK. GO GET VALUE       20220002
         CLI   E0(R5),COMMA             CHECK FOR COMMA                 20280002
         BE    NOTEOC                   FOUND COMMA, GO GET VALUE       20340002
         CR    R5,RSTOP                 END OF CARD CHECK               20400002
         BNL   ENDOFCRD                 IF END OF CARD GO GET VALUE     20460002
         LA    R5,E1(,R5)               ADVANCE 1 COL                   20520002
         B     DELIMTER                 CONTINUE SCAN FOR BLANK/COMMA   20580002
         SPACE 1                                                        20640002
ENDOFCRD EQU   *                                                        20700002
         BAL   R14,CHKYWORD             CHECK FOR VALID KEYWORD         20760002
         B     NEXTRCD                  READ IN NEXT RECORD             20820002
         SPACE 1                                                        20880002
NOTEOC   EQU   *                                                        20940002
         BCTR  R5,R0                    BACK UP TO POINT TO LAST        21000002
*                                       BYTE OF VALUE                   21060002
         LA    R14,NEXTPARM             SET UP BRANCH ADDRESS AFTER     21120002
*                                       KEYWORD VALIDATION              21180002
         SPACE 3                                                        21240002
CHKYWORD EQU   *                                                        21300002
         LA    R2,KYWDTBL               POINTS TO FIRST ENTRY IN        21360002
*                                       PARM KEYWORD TABLE              21420002
         USING KYWDSECT,R2              ADDRESSABILITY                  21480002
         SPACE 1                                                        21540002
NEXTNTRY EQU   *                                                        21600002
         LH    R6,PLENGTH               GET KEYWORD LENGTH              21660002
         LTR   R6,R6                    IS IT END OF TABLE              21720002
         BNP   KYWDBAD                  YES, KEYWORD INVALID            21780002
         BCTR  R6,R0                    DECREMENT FOR EX                21840002
         EX    R6,COMPKYWD              IS KEYWORD VALID                21900002
         BE    SECONDCK                 YES, FURTHER CHECK              21960002
         LA    R2,PSIZE(,R2)            POINTS TO NEXT ENTRY IN PARM    22020002
*                                       KEYWORD TABLE                   22080002
         B     NEXTNTRY                 CHECK NEXT ENTRY                22140002
         SPACE 1                                                        22200002
SECONDCK EQU   *                                                        22260002
         LA    R7,E1(R6,R3)             1 BYTE BEYOND LAST CHAR OF KYWD 22320002
         CR    R7,R4                    IS IT THE EQUAL SIGN            22380002
         BE    KYWDOK                   YES, KEYWORD IS OK              22440002
         SPACE 1                                                        22500002
KYWDBAD  EQU   *                                                        22560002
         LR    R7,R5                    POINT TO LAST VALUE BYTE        22610002
         SR    R7,R3                    1 LT NO. OF CHARS TO MOVE       22620002
         LA    R1,E13                   1 LT MAX. NO. OF CHARS ALLOWED  22670002
         CR    R7,R1                    DOES KEYWORD EXCEED MAXIMUM     22672002
         BNH   LENGTHOK                 NO, IT'S OK TO MOVE             22674002
         LR    R7,R1                    TRUNCATE TO MAXIMUM LENGTH      22676002
         SPACE 1                                                        22678002
LENGTHOK EQU   *                                                        22678402
         L     R1,MSG407I               GET ADDR OF WTO'S PARMLIST      22680002
         LH    R15,E0(,R1)              GET MSG LENGTH                  22740002
         LA    R15,E3(,R15)             ADD 1 LT LENGTH OF DESCRIPTOR   22790002
*                                       AND ROUTING CODES               22840002
         EX    R15,MOVEMSG              MOVE MSG TO WORK AREA           22860002
         EX    R7,MOVEKYWD              MOVE PARM TO MSG LIST           22920002
         LA    R1,MSGLIST               SET UP FOR WTO                  22980002
         WTO   MF=(E,(1))               SEND ERROR MESSAGE              23040002
         BR    R14                      CONTINUE SCAN                   23100002
         SPACE 3                                                        23160002
KYWDOK   EQU   *                                                        23220002
         LR    R7,R5                    R7 POINTS TO LAST BYTE OF       23280002
*                                       SPECIFIED VALUE                 23340002
         SR    R7,R4                    GET NO. OF VALUE BYTES          23400002
         BZ    KYWDBAD                  VALUE WAS NOT SPECIFIED         23460002
         LA    R1,E1(,R4)               POINT TO FIRST VALUE BYTE       23510002
         SPACE 1                                                        23510402
FOX029   EQU   *                                                        23512002
         TM    E0(R1),XF0               IS ZONE FOX                     23514002
         BNO   KYWDBAD                  NO, VALUE IS BAD                23516002
         CR    R1,R5                    IS THIS LAST BYTE OF VALUE      23518002
         BNL   PACKIT                   YES, PACK THE VALUE             23518402
         LA    R1,E1(,R1)               OTHERWISE ADVANCE ONE BYTE      23518802
         B     FOX029                   GO TO CHECK ZONE                23519202
         SPACE 1                                                        23519302
PACKIT   EQU   *                                                        23519602
         BCTR  R7,R0                    DECREMENT FOR EX                23520002
         EX    R7,PACKVALU              CHANG TO PACKED DECIMAL         23580002
         CVB   R4,DOUBLE1               CONVERT TO BINARY               23640002
         LTR   R4,R4                    IS VALUE NEGATIVE               23700002
         BM    KYWDBAD                  YES, SEND ERROR MESSAGE         23760002
         C     R4,MAXIMUM               DOES IT EXCEED MAXIMUM          23810002
         BH    KYWDBAD                  YES, SEND ERROR MESSAGE         23812002
         ST    R4,PVALUE                PUT VALUE IN KEYWORD TABLE      23820002
         OI    PFLAG,PUSER              SIGNAL VALUE IS SPECIFIED       23880002
         BR    R14                      GO TO SCAN FOR NEXT PARM        23940002
         SPACE 3                                                        24000002
NEXTPARM EQU   *                                                        24060002
         LA    R3,E2(,R5)               POINTS TO FIRST POSSIBLE        24120002
*                                       CHAR OF NEXT PARM               24180002
         CR    R3,RSTOP                 CHECK FOR END OF CARD           24240002
         BNL   NEXTRCD                  IF END OF CARD, READ NEXT RCD   24300002
         LA    RSTOP,BUFFER+E68         REINITIALIZE STOP POINT         24360002
*                                       AT COLUMN 69                    24420002
         B     SKIPBLK                  GO TO SCAN FOR BLANK            24480002
         SPACE 3                                                        24540002
CLOSELIB EQU   *                                                        24600002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   24660002
         L     ROPCAVT,OPCAVTSV         RELOAD OPC AVT ADDRESS          24710002
         SPACE 3                                                        24720002
*                                                                       24780002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 24840002
*                                                                       24900002
*              VALIDATE AND DEFAULT PARAMETER VALUES, RESOLVE           24960002
*              CONFLICTS                                                25020002
*                                                                       25080002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 25140002
*                                                                       25200002
         SPACE 3                                                        25260002
*                                                                       25320002
* BUFSIZE VALIDITY CHECK - MINIMUM - 20, MAXIMUM - 252, ROUND UP TO     25380002
*                          WORD BOUNDARY. DEFAULT VALUE IS 64           25440002
*                                                                       25500002
         SPACE 1                                                        25560002
CHKBFSZ  EQU   *                                                        25620002
         LA    R2,BUFSIZE               POINT TO BUFSIZE ENTRY IN       25680002
*                                       KEYWORD TABLE                   25740002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              25800002
         BZ    DEFBFSZ                  NO, DEFAULT BUFFER SIZE         25860002
         L     R3,PVALUE                GET SPECIFIED VALUE             25920002
         LA    R0,MINIBFSZ              GET MINIMUM                     25980002
         CR    R3,R0                    IS VALUE GT/EQ MINIMUM          26040002
         BL    BADBFSZ                  NO, BUFSIZE VALUE INVALID       26100002
         LA    R0,MAXIBFSZ              GET MAXIMUM                     26160002
         CR    R3,R0                    IS VALUE LT/EQ MAXIMUM          26220002
         BH    BADBFSZ                  NO, BUFSIZE VALUE INVALID       26270002
         LA    R3,E3(,R3)               * ROUND UP BUFFER SIZE          26320002
         N     R3,MINUS4                * TO WORD BOUNDARY              26370002
         B     STBFSZ                   GO TO STORE VALUE               26580002
         SPACE 1                                                        26640002
BADBFSZ  EQU   *                                                        26700002
         LR    R10,R2                   SET UP PARM ADDR IN KEYWORD     26760002
*                                       TABLE FOR SUBROUTINE            26820002
         BAL   R14,BADPARM              GO TO RTN TO PROCESS INVALID    26880002
*                                       PARAMETER VALUE                 26940002
         SPACE 1                                                        27000002
DEFBFSZ  EQU   *                                                        27060002
         LA    R3,DEFTBFSZ              GET BUFFER SIZE DEFAULT VALUE   27120002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT VALUE USED     27180002
STBFSZ   EQU   *                                                        27240002
         ST    R3,PVALUE                PUT DEFAULT/ADJUSTED VALUE IN   27300002
*                                       TABLE                           27360002
         SPACE 3                                                        27420002
*                                                                       27470002
* 'USERMAX' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS 32,767, DEFAULT   27472002
*                            IS NUMBER OF TS TERMINALS PLUS TEN PERCENT 27474002
*                                                                       27476002
CHKUSMAX EQU   *                                                        27478002
         LA    R2,USERMAX               POINT TO USERMAX ENTRY IN       27478402
*                                       KEYWORD TABLE                   27478802
         TM    PFLAG,PUSER              IS KEYWORD SPECIFIED            27479202
         BZ    DEFUSMAX                 NO, DEFAULT USERMAX             27479602
         L     R3,PVALUE                GET SPEFICIED VALUE             27479702
         LTR   R3,R3                    IS VALUE ZERO                   27479802
         BP    CHKBFNO                  NO, VALUE IS OK                 27479902
         SPACE 1                                                        27499902
BADUSMAX EQU   *                                                        27509902
         LR    R10,R2                   SET UP PARM ADDRESS IN KEYWORD  27519902
*                                       TABLE FOR SUBROUTINE            27529902
         BAL   R14,BADPARM              GO TO RTN TO PROCESS INVALID    27531902
*                                       PARAMETER VALUE                 27532302
         SPACE 1                                                        27532702
DEFUSMAX EQU   *                                                        27533102
         BAL   R10,CTTSTERM             GO TO FIND OUT NUMBER OF TS     27533202
*                                       TERMINAL UPON RTN R5 HAS IT     27549902
         LTR   R3,R5                    SAVE NUMBER OF TS       YM04639 27560302
*                                       TERMINALS, AND CHECK    YM04639 27560402
*                                       FOR ANY TS TERMINALS    YM04639 27560502
         BZ    ERROR03                  NO, SEND ERROR MSG      YM04639 27560702
         SR    R4,R4                    CLEAR REGISTER FOR DEVIDE       27561902
         LA    R0,E10                   GET 10 PERCENT                  27563902
         DR    R4,R0                    OF NO. OF TS TERMINALS          27565902
         LTR   R4,R4                    ANY REMAINDER                   27566302
         BZ    ADDIT                    NO                              27566402
         LA    R5,E1(,R5)               ROUND UP QUOTIENT               27570602
         SPACE 1                                                        27574902
ADDIT    EQU   *                                                        27576902
         AR    R3,R5                    10 PERCENT + NO. OF TS TERMS    27578902
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT VALUE USED     27579002
         ST    R3,PVALUE                PUT VALUE IN KEYWORD TABLE      27584202
         SPACE 3                                                        27586202
*                                                                       27589602
* 'BUFFERS' VALIDITY CHECK - MINIMUM IS 4, MAXIMUM IS 32,767, DEFAULT   27594802
*                            IS SIX TIMES THE VALUE OF USERMAX  OR      27600002
*                            MAXIMUM VALUE ALLOWED                      27650002
         SPACE 1                                                        27660002
CHKBFNO  EQU   *                                                        27720002
         LA    R2,BUFFERS               POINT TO BUFFERS ENTRY IN       27780002
*                                       KEYWORD TABLE                   27840002
         LA    R6,CHKOWTHI              SET UP BRANCH ADDRESS           27900002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              27960002
         BZ    DEFTBFNO                 NO, USE DEFAULT VALUE           28020002
         L     R9,PVALUE                GET SPECIFIED VALUE             28080002
         LA    R0,MINIBFNO              GET MINIMUM                     28140002
         CR    R9,R0                    IS VALUE GT/EQ TO MINIMUM       28200002
         BL    BADBFNO                  NO, VALUE INVALID               28260002
         L     R0,MAXIMUM               GET MAXIMUM                     28320002
         CR    R9,R0                    IS VALUE LT/EQ TO MAXIMUM       28380002
         BCR   NOTHIGH,R6               VALUE OK, GO TO CHECK 'OWAITHI' 28440002
         SPACE 1                                                        28500002
BADBFNO  EQU   *                                                        28560002
         LR    R10,R2                   SET UP PARM ADDR IN KEYWORD     28620002
*                                       TABLE FOR SUBROUTINE            28680002
         BAL   R14,BADPARM              GO TO RTN FOR ERROR MSG         28740002
         SPACE 1                                                        28800002
*                                                                       28850002
* NOTE - TO PICK UP USERMAX VALUE AGAIN FROM THE KEYWORD TABLE          28852402
*        SEEMS TO BE REDUNDANT IF FLOW OF CONTROL IS FROM ABOVE,        28852802
*        (VALUE NEEDED STILL IS R3), BUT IT IS ESSENTIAL                28853202
*        WHEN ARRIVING HERE VIA BRANCH FROM LABEL 'COMPTOBF'.           28853602
*                                                                       28858002
DEFTBFNO EQU   *                                                        28860002
         LA    R9,USERMAX               POINT TO USERMAX ENTRY IN       28910002
*                                       KEYWORD TABLE                   28960002
         DROP  R2                       * TEMPORARILY MAPPING USERMAX   29010002
         USING KYWDSECT,R9              * ENTRY IN KEYWORD TABLE        29020002
         L     R9,PVALUE                GET NO. OF TS TERMINALS FOR     29030002
*                                       MULTIPLICATION                  29100002
         DROP  R9                       R9 NO LONGER BASE FOR KYWDSECT  29150002
         USING KYWDSECT,R2              R2 RESUMES ADDRESSABILITY TO    29152002
*                                       PARAMETER KEYWORD ENTRY         29154002
         LA    R8,E6                    6 X USERMAX                     29160002
         MR    R8,R8                    GOT DEFAULT VALUE FOR BUFFERS   29220002
         C     R9,MAXIMUM               DOES IT EXCEED MAXIMUM          29270002
         BNH   STBFNO                   NO, IT IS OK                    29272002
         L     R9,MAXIMUM               GET MAXIMUM VALUE ALLOWED       29274002
         SPACE 1                                                        29276002
STBFNO   EQU   *                                                        29278002
         ST    R9,PVALUE                PUT DEFAULT VALUE IN TABLE      29280002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT VALUE USED     29340002
         BR    R6                       CONTINUE VALIDITY CHECKING      29400002
         SPACE 3                                                        29460002
*                                                                       29520002
* 'OWAITHI' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS 32,767, DEFAULT   29580002
*                            IS 20                                      29640002
*                                                                       29700002
         SPACE 1                                                        29760002
CHKOWTHI EQU   *                                                        29820002
         LA    R3,OWAITHI               POINT TO 'OWAITHI' ENTRY IN     29880002
*                                       KEYWORD TABLE                   29940002
         BAL   R5,OWTNLKHI              GO TO COMMON CHECK RTN          30000002
         SPACE 3                                                        30060002
*                                                                       30120002
* 'OWAITLO' VALIDITY CHECK - MUST BE LESS THAN BOTH 'OWAITI' AND        30180002
*                            'BUFFERS', DEFAULT IS 4                    30240002
         SPACE 1                                                        30300002
CHKOWTLO EQU   *                                                        30360002
         LA    R4,OWAITLO               POINT TO 'OWAITLO' ENTRY IN     30420002
*                                       KEYWORD TABLE                   30480002
         BAL   R6,OWTNLKLO              GO TO COMMON CHECK RTN          30540002
         SPACE 3                                                        30600002
*                                                                       30660002
* 'INLOCKHI' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS 32,767, DEFAULT  30720002
*                             IS 4                                      30780002
         SPACE 1                                                        30840002
CHKNLKHI EQU   *                                                        30900002
         LA    R3,INLOCKHI              POINT TO 'INLOCKHI' ENTRY       30960002
         BAL   R5,OWTNLKHI              GO TO COMMON CHECK RTN          31020002
         SPACE 3                                                        31080002
*                                                                       31140002
* 'INLOCKLO' VALIDITY CHECK - MUST BE LESS THAN BOTH 'INLOCKHI' AND     31200002
*                             'BUFFERS', DEFAULT IS 1                   31260002
*                                                                       31320002
         SPACE 1                                                        31380002
CHKNLKLO EQU   *                                                        31440002
         LA    R4,INLOCKLO              POINT TO 'INLOCKLO' ENTRY       31500002
         BAL   R6,OWTNLKLO              GO TO COMMON CHECK RTN          31560002
         SPACE 3                                                        31620002
*                                                                       31680002
* 'RESVBUF' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS NO. OF BUFFERS,   31740002
*                            DEFAULT IS TEN PER CENT OF NO. OF BUFFERS  31800002
*                                                                       31860002
         SPACE 1                                                        31920002
CHKRSVBF EQU   *                                                        31980002
         LA    R2,RESVBUF               POINT TO 'RESVBUF' ENTRY        32040002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              32100002
         BZ    DEFTRSBF                 NO, USE DEFAULT VALUE           32160002
         L     R4,PVALUE                GET SPECIFIED VALUE             32220002
         LTR   R4,R4                    IS VALUE 0                      32280002
         BZ    BADRSBF                  YES, VALUE IS INVALID           32340002
         CR    R4,R9                    IS VALUE LT/EQ 'BUFERS'         32400002
         BNH   CHKRCLIM                 YES, GO TO CHECK RECONLIM       32460002
         SPACE 1                                                        32520002
BADRSBF  EQU   *                                                        32580002
         LR    R10,R2                   SET UP PARM ADDR IN KEYWORD     32640002
*                                       TABLE FOR SUBROUTINE            32700002
         BAL   R14,BADPARM              WRITE ERROR MESSAGE             32760002
         SPACE 1                                                        32820002
DEFTRSBF EQU   *                                                        32880002
         LA    R0,E10                   DEFAULT IS TEN PER CENT         32940002
*                                       OF TOTAL NUMBER OF BUFFERS      33000002
         LR    R5,R9                    GET TOTAL NO. OF BFRS           33060002
         SR    R4,R4                    CLEAR REG FOR DEVIDE            33120002
         DR    R4,R0                    BFR NO. DEVIDED BY 10           33180002
         LTR   R4,R4                    ANY REMAINDER                   33240002
         BZ    STOREIT                  NO, QUOTIENT IS DEFAULT VALUE   33300002
         LA    R5,E1(,R5)               ROUND UP DEFAULT                33360002
         SPACE 1                                                        33420002
STOREIT  EQU   *                                                        33480002
         ST    R5,PVALUE                PUT DEFAULT VALUE IN TABLE      33540002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT                33600002
         SPACE 3                                                        33650002
*                                                                       33700002
* 'RECONLIM' VALIDITY CHECK - MINIMUM IS 0, MAXIMUM IS 32,767, DEFAULT  33710002
*                             IS 0 (NO RECONNECT)                       33712002
*                                                                       33712402
*        NO CHECKING IS NECESSARY HERE SINCE BOTH UPPER AND LOWER       33712802
*        LIMITS WERE CHECKED WHILE CONVERTING EBCDIC VALUE TO           33713202
*        BINARY WHEN THE PARAMETER RECORDS WERE READ.  (SEE             33713702
*        LABEL 'PACKIT')                                                33713802
*                                                                       33713902
*        NO DEFAULTING IS NECESSARY EITHER, SINCE DEFAULT VALUE         33714402
*        IS ZERO.                                                       33714802
*                                                                       33715202
CHKRCLIM EQU   *                                                        33715502
         B     CNTRLBLK                 GO TO BUILD CONTROL BLOCKS      33739902
         SPACE 3                                                        33760002
*                                                                       33780002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 33840002
*                                                                       33900002
*              THIS ROUTINE IS TO VALIDITY CHECK BOTH 'OWAITHI' AND     33960002
*              'INLOCKHI'.   INPUT EXPECTED -                           34020002
*                                                                       34080002
*              REG 3 PROPER KEYWORD TABLE ENTRY ADDRESS                 34140002
*              REG 5 RETURN ADDRESS                                     34200002
*                                                                       34260002
*              NOTE - MAXIMUM VALUE OF BOTH KEYWORDS HAS ALREADY        34310002
*                     BEEN CHECKED, SEE LABEL 'PACKIT'.                 34312002
*                                                                       34314002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 34320002
*                                                                       34380002
OWTNLKHI EQU   *                                                        34440002
         DROP  R2                                                       34500002
         USING KYWDSECT,R3                                              34560002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              34620002
         BZ    DEFTHI                   NO, DEFAULT 'HIGH'              34680002
         L     R7,PVALUE                GET SPECIFIED VALUE             34740002
         LTR   R7,R7                    IS VALUE 0                      34980002
         BNP   BADHI                    YES, USE DEFAULT VALUE  YM01176 35040002
         BR    R5                       GO BACK TO MAINLINE             35100002
         SPACE 1                                                        35160002
BADHI    EQU   *                                                        35220002
         LR    R10,R3                   SET UP PARM ADDR IN KEYWORD     35280002
*                                       TABLE FOR SUBROUTINE            35340002
         BAL   R14,BADPARM              GO TO SEND OUT ERROR MSG        35400002
         SPACE 1                                                        35450002
DEFTHI   EQU   *                                                        35460002
         SR    R7,R7                    CLEAR REGISTER                  35520002
         IC    R7,PDEFAULT              GET DEFAULT VALUE               35580002
         ST    R7,PVALUE                PUT IN KEYWORD TABLE            35640002
         NI    PFLAG,NOT-PUSER          INDICATE VALUE IS DEFAULT       35700002
         BR    R5                       GO BACK TO MAINLINE             35760002
         SPACE 3                                                        35820002
*                                                                       35880002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 35940002
*                                                                       36000002
*              THIS ROUTINE IS TO VALIDITY CHECK 'OWAITLO' AND          36060002
*              'INLOCKLO'.                                              36120002
*                                                                       36180002
*              INPUT EXPECTED -                                         36190002
*                                                                       36200002
*              REG 3 'OWAITHI/INLOCKHI' ENTRY ADDRESS IN                36230002
*                    KEYWORD TABLE                                      36232002
*              REG 4 PROPER ENTRY ADDRESS IN KEYWORD TABLE              36240002
*              REG 6 RETURN ADDRESS                                     36300002
*              REG 9 TOTAL NUMBER OF BUFFERS                            36420002
*                                                                       36480002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 36540002
*                                                                       36600002
OWTNLKLO EQU   *                                                        36660002
         DROP  R3                                                       36720002
         USING KYWDSECT,R4                                              36780002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              36840002
         BZ    DEFTLO                   NO, USE DEFAULT VALUE           36900002
         L     R5,PVALUE                GET SPECIFIED VALUE             36960002
         SPACE 1                                                        36970002
COMPHIGH EQU   *                                                        37010002
         DROP  R4                       DROP KEYWORD ENTRY BASE         37012002
         USING KYWDSECT,R3              USE R3 AS KEYWORD ENTRY BASE    37014002
         C     R5,PVALUE                IS IT LESS THAN 'HIGH'          37020002
         BL    COMPTOBF                 YES, COMPARE WITH 'BUFFERS'     37080002
         DROP  R3                       DROP KEYWORD ENTRY BASE         37130002
         USING KYWDSECT,R4              USE R4 AS KEYWORD ENTRY BASE    37180002
         TM    PFLAG,PUSER              IS 'LOW' DEFAULT                37260002
         BO    BADLO                    NO, 'LOW' IS INVALID            37320002
         LA    R5,COMPTOBF              SET UP RETURN ADDRESS           37380002
         B     BADHI                    GO TO RTN HANDLING BAD 'HIGH'   37440002
         SPACE 1                                                        37500002
COMPTOBF EQU   *                                                        37560002
         L     R5,PVALUE                GET 'LOW' VALUE                 37740002
         CR    R5,R9                    IS 'LOW' LESS THAN 'BUFFERS'    37800002
         BCR   LOW,R6                   YES, 'LOW' OK                   37860002
         TM    PFLAG,PUSER              IS 'LOW' DEFAULT                37920002
         BO    BADLO                    NO, 'LOW' IS INVALID            37980002
         LA    R6,CHKNLKHI              SET UP RETURN ADDRESS           38040002
         B     BADBFNO                  'BUFFERS' IS INVALID            38100002
         SPACE 1                                                        38160002
BADLO    EQU   *                                                        38220002
         LR    R10,R4                   SET UP PARM ADDR IN KEYWORD     38280002
*                                       TABLE FOR SUBROUTINE            38340002
         BAL   R14,BADPARM              SEND OUT 'LOW' ERROR MSG        38400002
         SPACE 1                                                        38460002
DEFTLO   EQU   *                                                        38520002
         SR    R5,R5                    CLEAR REGISTER                  38580002
         IC    R5,PDEFAULT              GET 'LOW' DEFAULT VALUE         38640002
         ST    R5,PVALUE                PUT VALUE IN TABLE              38700002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT                38760002
         B     COMPHIGH                 GO TO COMPARE WITH 'HIGH'       38810002
         DROP  R4                       DROP KEYWORD ENTRY BASE         38860002
         SPACE 3                                                        38880002
         SPACE 3                                                        38940002
         SPACE 3                                                        39000002
*                                                                       39060002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 39120002
*                                                                       39180002
*              COMPUTE AMOUNT OF STORAGE NEEDED FOR RPT,                39240002
*              TSB TABLE AND BUFFERS                                    39300002
*                                                                       39360002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 39420002
*                                                                       39480002
CNTRLBLK EQU   *                                                        39540002
         USING KYWDSECT,R2                                              39660002
         LA    R2,BUFSIZE               POINTS TO 'BUFSIZE' ENTRY IN    39720002
*                                       KEYWORD TABLE                   39780002
         L     R3,PVALUE                GET BUFFER SIZE                 39840002
         SR    R0,R0                    CLEAR REGISTER FOR DEVIDE       39900002
         LH    R1,ONEPAGE               GET PAGE SIZE                   39960002
         DR    R0,R3                    NO. OF BUFRS PER PAGE IN R1     40020002
         STH   R1,PGBUFNO               SAVE IT IN WORK AREA            40080002
         LA    R2,BUFFERS               POINTS TO 'BUFFERS' ENTRY       40140002
         L     R5,PVALUE                GET TOTAL NO. OF BUFFERS        40200002
         SR    R4,R4                    CLEAR REGISTER FOR DEVIDE       40260002
         DR    R4,R1                    NO. OF PAGES NEEDED IN R5       40320002
*                                       R4 HAS NO. OF BFRS ON LAST PG   40380002
*                                                                       40390002
*  CALCULATE SIZE OF LAST SECTION OF BUFFERS                            40400002
*                                                                       40410002
         LTR   R4,R4                    DOES ALL BFRS FIT IN FULL PAGES 40430002
         BNZ   SAVEIT                   NO, SAVE THE REMAINDER          40432002
         LR    R4,R1                    PUT ONE FULL PAGE ON LAST SECT  40434002
         BCTR  R5,R0                    ONE LESS NO. OF FULL PAGES      40434402
         SPACE 1                                                        40436002
SAVEIT   EQU   *                                                        40438002
         STH   R4,LPGBUFNO              SAVE NO. OF BFRS ON LAST PAGE   40440002
         STH   R5,BFRPAGE               SAVE NO. OF FULL PAGES FOR BFR  40490002
         LR    R2,R4                    .BUFSIZE X NO. OF BFRS ON LAST  40560002
         MR    R2,R2                    .PAGE = NO. OF BYTES NEEDED FOR 40620002
*                                       .BFRS ON LAST PAGE (IN R3)      40680002
         LR    R4,R3                    SAVE IT IN ANOTHER REGISTER     40682002
*                                                                       40690002
*  CALCULATE TIOCRPT SIZE                                               40730002
*                                                                       40780002
         LA    R5,E1(,R5)               NO. OF ENTRIES IN RPT FREE      40860002
*                                       BFR LIST                        40920002
         SLL   R5,E2                    MULTIPLY BY SIZE OF EACH ENTRY  41100002
         LA    R9,TIOCFBFL-TIOCRPT      GET RPT BASIC SECTION SIZE      41160002
         AR    R5,R9                    RPT SIZE IN R5                  41220002
         STH   R5,RPTSIZE               SAVE RPT SIZE IN WORK AREA      41230002
         AR    R4,R5                    STORAGE NEEDED FOR BUFFERS ON   41240002
*                                       LAST PAGE PLUS RPT              41250002
         LA    R4,E7(,R4)               * MAKE SURE TSB STARTS          41270002
         N     R4,DWBNDY                * ON DOUBLE WORD BOUNDARY       41274002
*                                                                       41290002
*  CALCULATE SIZE OF TSB TABLE                                          41300002
*                                                                       41310002
         LA    R2,USERMAX               POSITION BASE REGISTER          41330002
         L     R5,PVALUE                GET USERMAX VALUE               41380002
         LR    R6,R5                    PUT IT IN R6                    41400002
         LA    R7,TSBEND-TSB            GET TSB SIZE                    41460002
         MR    R6,R6                    STORAGE NEEDED FOR TSB'S IS IN  41520002
*                                       R7                              41580002
*                                                                       41630002
*  TOTAL SIZE FOR LAST SECTION OF BUFFERS, TIOCRPT AND TSB TABLE        41632002
*                                                                       41634002
         AR    R7,R4                    STORAGE NEEDED FOR LAST PAGE(S) 41700002
         ST    R7,LASTPAGE              SAVE IT IN WORK AREA            41820002
         SPACE 1                                                        41870002
         GETMAIN RC,LV=(R7),SP=TIOCSP,BNDRY=PAGE GET STORAGE FOR RPT,   41940002
*                                       TSB TABLE AND BUFFERS           42000002
         SPACE 1                                                        42060002
         LTR   R15,R15                  WAS STORAGE ALLOCATED           42120002
         BNZ   ERROR07                  GETMAIN FAILED                  42180002
*                                                                       42240002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 42300002
*                                                                       42360002
*              INITIALIZE TIOCRPT                                       42420002
*                                                                       42480002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 42540002
*                                                                       42600002
         USING TIOCRPT,R7               ADDRESSABILITY FOR RPT          42660002
         USING TSB,R8                   ADDRESSABILITY FOR TSB          42720002
         USING TIOCBUF,R9               ADDRESSABILITY FOR BUFFERS      42780002
         LR    R7,R1                    ADDR OF PAGE JUST OBTAINED      42840002
         AR    R7,R3                    GET TO BEGINNING OF RPT         42900002
         ST    R7,RPTADDR               SAVE TIOCRPT ADDRESS            42960002
         LH    R8,RPTSIZE               GET RPT SIZE                    43020002
         BCTR  R8,R0                    DECREMENT FOR EX                43080002
         EX    R8,ZERORPT               ZERO OUT RPT                    43140002
         LA    R2,BUFFERS               POINTS TO 'BUFFERS' ENTRY       43200002
*                                       IN KEYWORD TABLE                43260002
         L     R0,PVALUE                GET TOTAL NO. OF TS BUFFERS     43320002
         STH   R0,TIOCNBF               INITIALIZE TIOCNBF FIELD        43380002
         STH   R0,TIOCNFBF              INITIALIZE TIOCNFBF             43440002
         LA    R2,BUFSIZE               R2 POINTS TO 'BUFSIZE' ENTRY    43500002
*                                       IN KEYWORD TABLE                43560002
         L     R0,PVALUE                GET BFR SIZE                    43620002
         STH   R0,TIOCBFSZ              PUT BFR SIZE IN RPT             43680002
         STH   R5,TIOCNTSB              NO. OF TSB'S                    43740002
         LA    R2,OWAITLO               R2 POINTS TO 'OWAITLO' ENTRY    43800002
*                                       IN KEYWORD TABLE                43860002
         L     R0,PVALUE                GET 'OWAITLO'                   43920002
         STH   R0,TIOCOWTH              'OWAITLO' IS OWAIT THRESHOLD    43980002
         LA    R2,INLOCKLO              POSITION R2                     44040002
         L     R0,PVALUE                GET 'INLOCKLO'                  44100002
         STH   R0,TIOCRSTH              'INLOCKLO' IS RESTART THRESHOLD 44160002
         LA    R2,OWAITHI               POSITION R2                     44220002
         L     R0,PVALUE                GET 'OWAITHI'                   44280002
         STH   R0,TIOCAOMX              'OWAITHI' IS AOMX               44340002
         LA    R2,INLOCKHI              POSITION R2                     44400002
         L     R0,PVALUE                GET 'INLOCKHI'                  44460002
         STH   R0,TIOCAIMX              'INLOCKHI' IS AIMX              44520002
         LA    R2,RESVBUF               POSITION R2                     44570002
         L     R0,PVALUE                GET 'RESVBUF' VALUE             44572002
         STH   R0,TIOCUSLW              INITIALIZE TIOCUSLW FIELD       44574002
         LA    R2,RECONLIM              POSITION BASE REGISTER          44576002
         L     R0,PVALUE                GET USERMAX VALUE               44578002
         STH   R0,TIOCRCLM              PUT IT IN TIOCRPT               44578402
         LH    R2,BFRPAGE               GET NO. OF FULL PAGES FOR BFRS  44580002
         LA    R2,E1(,R2)               ADD 1 TO BFR PAGES              44760002
         STH   R2,TIOCNBFL              NO. OF ENTRIES IN FREE BFR LIST 44940002
         LA    R8,E0(R4,R1)             GET ADDR OF TSB TABLE           45000002
*                                       (R1 HAS BEGINNING OF BUFFER     45050002
*                                       ADDR, R4 HAS STORAGE NEEDED FOR 45100002
*                                       BUFFERS ON LAST PAGE AND RPT    45150002
         ST    R8,TIOCTSB-1             PUT IT IN RPT                   45180002
         LA    R0,TSBEND-TSB            GET SIZE OF TSB                 45240002
         STC   R0,TIOCTSBS              PUT IT IN RPT                   45300002
         ST    R1,TIOCFBFL              FREE BUFFER LIST                45480002
         LR    R9,R1                    PUT BFR ADDR IN R9              45540002
         LNR   R3,R1                    NEGATIVE VALUE OF PAGE ADDRESS  45600002
*                                                                       45660002
* GET QTIP BRANCH ENTRY ADDRESS                                         45720002
*                                                                       45780002
         SPACE 1                                                        45840002
QTIPBRAD EQU   *                                                        45900002
         LOAD  EP=IEDAYQT1,DCB=0        GET QTIP BRANCH ENTRY ADDR      45960002
         SPACE 2                                                        46020002
         ST    R0,TIOCQTIP              PUT QTIP ENTRY ADDR IN RPT      46080002
         SPACE 3                                                        46140002
*                                                                       46200002
*                                                                       46260002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 46320002
*                                                                       46380002
*              INITIALIZE TSB'S                                         46440002
*                                                                       46500002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 46560002
*                                                                       46620002
*                                                                       46680002
         LH    R0,TIOCNTSB              GET NO. OF TSB'S FOR CTR        46740002
         SPACE 1                                                        46800002
CLEARTSB EQU   *                                                        46860002
         XC    TSBSTAT(TSBEND-TSB),TSBSTAT  CLEAR TSB                   46920002
         LA    R8,TSBEND-TSB(,R8)       POINTS TO NEXT TSB              46980002
         BCT   R0,CLEARTSB              BR UNTIL ALL TSB'S ARE DONE     47040002
         DROP  R8                                                       47100002
         SPACE 3                                                        47160002
         LA    R8,TIOCFBFL              POINT TO FREE BFR LIST IN RPT   47220002
         LH    R14,BFRPAGE              GET NO. OF PAGES FOR BUFFERS    47280002
         LH    R4,LPGBUFNO              GET NO. OF BFRS ON LAST PAGE    47330002
         SPACE 3                                                        47640002
*                                                                       47700002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 47760002
*                                                                       47820002
*              CHAIN BUFFERS                                            47880002
*                                                                       47940002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 48000002
*                                                                       48060002
CHAINBFR EQU   *                                                        48120002
         BCTR  R4,R0                    1 LT BFR NO. IN THIS PAGE       48180002
         LTR   R4,R4                    IS THIS THE LAST BFR            48240002
         BNP   LASTBFR                  YES, BRANCH                     48300002
         LH    R10,TIOCBFSZ             GET BUFFER SIZE                 48360002
         LNR   R6,R10                   NEG BFR SIZE FOR INDEXING       48420002
         SPACE 1                                                        48480002
LINKBFR  EQU   *                                                        48540002
         AR    R9,R10                   POINT TO NEXT BFR               48600002
         ST    R9,BUFFTRLR-1-TIOCBUF(R6,R9) CHAIN BUFFER                48660002
         BCT   R4,LINKBFR               BR UNTIL ALL BFRS CHAINED       48720002
         SPACE 1                                                        48780002
LASTBFR  EQU   *                                                        48840002
         ST    R3,BUFFTRLR-1            LAST BFR HAS NEGATIVE VALUE     48900002
*                                       OF PAGE ADDRESS                 48960002
         SPACE 1                                                        49020002
FULLPAGE EQU   *                                                        49080002
         LTR   R14,R14                  ANY FULL PAGE BFR NEEDED        49140002
         BZ    FINALE                   NO, GO TO DO FINAL THINGS       49200002
*                                                                       49260002
         LH    R2,ONEPAGE               SIZE FOR ONEPAGE                49320002
         GETMAIN RC,LV=(R2),SP=TIOCSP,BNDRY=PAGE GET STORAGE FOR BFRS   49380002
*                                                                       49440002
         LTR   R15,R15                  WAS STORAGE ALLOCATED           49500002
         BNZ   ERROR09                  NO, CANNOT PROCEED              49560002
         BCTR  R14,R0                   DECREMENT PAGE COUNT            49620002
         LA    R8,E4(,R8)               POINT TO NEXT ENTRY OF FREE     49680002
*                                       BUFFER LIST IN RPT              49740002
         ST    R1,E0(,R8)               PUT PAGE ADDR IN RPT            49800002
         LR    R9,R1                    ADDRESS OF FIRST BUFFER         49860002
         LNR   R3,R1                    NEGATIVE VALUE OF PAGE ADDRESS  49920002
         LH    R4,PGBUFNO               GET NO. OF BFRS PER PAGE        49980002
         B     CHAINBFR                 BR TO CHAIN BUFFERS             50040002
         DROP  R2                       KEYWORD TABLE NOT ADDRESSABLE   50042002
         SPACE 3                                                        50050002
*                                                                       50160002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 50220002
*                                                                       50280002
*              WRITE RECORD TYPE 31 FOR SMF                             50340002
*                                                                       50400002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 50460002
*                                                                       50520002
FINALE   EQU   *                                                        50570002
         L     R3,CVTPTR                GET CVT ADDR                    50640002
         USING CVT,R3                   CVT ADDRESSABLE                 50700002
         L     R2,CVTSMCA               GET SMCA ADDRESS                50760002
         LTR   R2,R2                    IS SMCA IN THE SYSTEM           50820002
         BZ    TSABOFF                  NO, GO TO TURN OFF TS ABEND     50880002
*                                       INDICATOR                       50940002
         XC    TTISMF(RCDSIZE),TTISMF   ZERO OUT RECORD                 51000002
         LA    R2,RCDSIZE               GET SIZE OF                     51060002
         STH   R2,TTIRLEN               RECORD TYPE 31                  51120002
         MVI   TTIRCDTY,TYPE31          RECORD TYPE 31                  51180002
         LH    R2,TIOCNFBF              TOTAL NUMBER OF                 51240002
         STH   R2,TTINBF                TIOC BUFFERS                    51300002
         LH    R2,TIOCBFSZ              TIOC BUFFER                     51360002
         STH   R2,TTIBUFSE              SIZE IN BYTES                   51420002
         L     R2,TIOCAOMX              OWAIT MAX AND                   51480002
         ST    R2,TTIOMAX               INLOCK MAX                      51540002
         L     R2,TIOCOWTH              OWAIT THRESHOLD AND             51600002
         ST    R2,TTIOWTH               RESTART THRESHOLD               51660002
         LH    R2,TIOCUSLW              NUMBER OF BFRS RESERVED         51720002
         STH   R2,TTIUSLW               ON THE FREE QUEUE               51780002
         IC    R2,TIOCTSBS              SIZE OF                         51840002
         STC   R2,TTITSBS               TSB'S                           51900002
         LA    R1,TTISMF                PUT SMF RCD ADDR IN R1          51960002
         SMFWTM (1)                     SEND THIS RECORD TO SMF         52020002
         SPACE 3                                                        52080002
*                                                                       52140002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 52200002
*                                                                       52260002
*            * PUT TIOCRPT ADDRESS AND TSINPUT'S QCB ADDRESS IN TCX     52360002
*            * TURN OFF TS ABEND INDICATOR IN TCAM AVT                  52410002
*            * PUT QTIP ENTRY ADDRESS IN SVC TABLE                      52460002
*                                                                       52500002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 52560002
*                                                                       52620002
TSABOFF  EQU   *                                                        52680002
         L     R4,CVTAQAVT              GET TCX ADDR                    52730002
         USING IEDQTCX,R4               TCX ADDRESSABLE                 52780002
         L     R0,RPTADDR               GET TIOCRPT ADDRESS             52830002
         ST    R0,TCXRPT                PUT RPT ADDR IN TCX             52880002
         L     R2,OPCAVTPT              GET TCAM AVT ADDRESS            52930002
         USING IEDQAVTD,R2              ADDRESSABILITY                  52940002
         NI    AVTBIT3,NOT-AVTTSAB      TURN OFF ABEND INDICATOR        52950002
         L     R0,AVTTSOPT              GET TSINPUT'S QCB ADDRESS       52960002
         ST    R0,TCXTSI                PUT IT IN TCX                   52970002
         L     R2,CVTABEND              GET SECONDARY CVT ADDR          52980002
         DROP  R2                       DROP TCAM AVT BASE              53030002
         USING SCVTSECT,R2              ADDRESSABILITY FOR SEC'DARY CVT 53032002
         L     R2,SCVTSVCT              GET SVC TABLE ADDRESS           53040002
         DROP  R2                       DROP SECONDARY CVT BASE         53090002
         LA    R4,QTIP                  GET QTIP SVC NO.                53100002
         SLL   R4,E3                    MULTIPLY BY 8 TO GET OFFSET     53160002
*                                       TO SLOT FOR SVC 101             53220002
         LOAD  EP=IEDAYQT,DCB=0         GET QTIP MAIN ENTRY ADDRESS     53280002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    53340002
         ST    R0,E0(R4,R2)             PUT IT IN SVC TABLE             53400002
         SPACE 3                                                        53698502
*                                                                       53698602
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 53698702
*                                                                       53698802
*              ATTACH IEDAY802                                          53714002
*                                                                       53724002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 53726002
*                                                                       53728002
         MODESET EXTKEY=TCAM            CHANGE BACK INTO TCAM'S KEY     53728402
         ATTACH EP=IEDAY802             ATTACH IEDAY802                 53728802
         ST    R1,TIOCLDS               SAVE SUBTASK TCB ADDRESS        53729202
         DROP  R3,R4,R9                 DROP BASE REGISTERS             53729402
         L     R1,MSG019I               GET WTO'S PARMLIST              53744702
         BAL   R14,WTO                  TELL OPER TS IS INITIALIZED     53760002
         SPACE 3                                                        53820002
*                                                                       53880002
*                                                                       53940002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 54000002
*                                                                       54060002
*              FREE THE WORK AREA AND XCTL TO NEXT LOAD                 54120002
*                                                                       54180002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 54240002
*                                                                       54300002
*                                                                       54360002
FREEWA   EQU   *                                                        54420002
*                                                                       54480002
         IC    R2,CALLRKEY              SAVE CALLER'S KEY               54540002
         LA    R0,WAEND-WASTART         SIZE OF WORK AREA               54600002
FREEWAB  EQU   *                                                        54650002
         FREEMAIN R,LV=(0),A=(11)       FREE WORK AREA                  54720002
*                                                                       54780002
         SPKA  E0(R2)                   CHANGE BACK INTO CALLER'S KEY   54840002
         SPACE 3                                                        54900002
EXIT     EQU   *                                                        54960002
         L     R5,OPCCOPCE              GET ADDR OF OPC CONTROL ELEM    55020002
         USING IEDQOPCE,R5                                              55080002
         SR    R0,R0                    ZERO OUT REGISTER               55140002
         STH   R0,OCPARM                ZERO OUT BRANCH PARM            55200002
         L     R4,OPCAVTPT              REESTABLISH AVT BASE PTR        55380002
         LR    R1,ROPCAVT               R1 HAS OP CNTRL AVT ADDR        55440002
         XCTL  EP=IGC0710D              GIVE CONTROL TO NEXT LOAD       55490002
         DROP  R5                       DROP OPC CONTROL ELEM BASE      55540002
         SPACE 3                                                        55560002
*                                                                       55620002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 55680002
*                                                                       55740002
*              ERROR ROUTINES                                           55800002
*                                                                       55860002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 55920002
*                                                                       55980002
         SPACE 1                                                        56040002
ERROR01  EQU   *                                                        56100002
         LA    R0,SYNTAXID              GET ERROR MESSAGE ID            56150002
         LR    R1,ROPCAVT               PASS OP CONTROL AVT PTR         56200002
         XCTL  EP=IGC0310D              GIVE CONTROL TO ERROR MSG LOAD  56210002
         SPACE 3                                                        56220002
ERROR02  EQU   *                                                        56280002
         L     R1,MSG007I               GET ADDR OF PARMLIST            56340002
         BAL   R14,WTO                  TELL OPER TS IS ALREADY IN      56400002
*                                       PROGRESS                        56460002
         B     FREEWA                   FREE WORK AREA AND EXIT         56520002
         SPACE 3                                                        56580002
ERROR03  EQU   *                                                        56640002
         L     R1,MSG402I               GET ADDR OF PARMLIST            56700002
         BAL   R14,WTO                  TELL OPER TCAM PROC DOES NOT    56760002
*                                       SUPPORT TIME SHARING            56820002
         B     FREEWA                   FREE WORK AREA AND EXIT         56880002
         SPACE 3                                                        56940002
ERROR04  EQU   *                                                        57000002
         BAL   R14,UNALLOCA             UNALLOCATE PARMLIB              57060002
         SPACE 1                                                        57120002
ERROR041 EQU   *                                                        57180002
         L     R1,MSG414I               GET ADDR OF WTO PARMLIST        57240002
         BAL   R14,WTO                  TELL OPER PARMLIB OPEN FAILED   57300002
         B     CHKBFSZ                  USE DEFAULT VALUES              57360002
         SPACE 3                                                        57420002
ERROR06  EQU   *                                                        57480002
         L     R1,MSG006I               GET WTO PARMLIST ADDR           57540002
         BAL   R14,WTO                  TELL OPER I/O ERROR             57600002
         B     ERROR081                 GO TO USE DEFAULT VALUES        57660002
         SPACE 3                                                        57720002
ERROR07  EQU   *                                                        57780002
         L     R1,MSG404I               GET WTO PARMLIST ADDR           57840002
         BAL   R14,WTO                  SEND MSG FOR INSUFFICIENT       57900002
*                                       MAIN STORAGE                    57960002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   58020002
         B     FREEWA                   FREE WORK AREA AND EXIT         58080002
         SPACE 3                                                        58140002
ERROR08  EQU   *                                                        58200002
         L     R1,MSG408I               GET ADDR OF PARMLIST            58260002
         BAL   R14,WTO                  TELL OPER IKJPRM00              58320002
*                                       CANNOT BE FOUND                 58380002
ERROR081 EQU   *                                                        58440002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   58500002
         B     CHKBFSZ                  USE DEFAULT VALUES              58560002
         SPACE 3                                                        58620002
ERROR09  EQU   *                                                        58680002
         LA    R4,TIOCFBFL              AD OF SECT RPT RESIDES  YM03016 58730002
         L     R3,MINUS4                FOR INDEXING            YM03016 58730402
         LH    R2,ONEPAGE               SIZE FOR ONE PAGE       YM03016 58732302
         SPACE 1                                                        58736202
FREESTUP EQU   *                                                YM03016 58738102
         CR    R8,R4                    IS IT LAST SECT TO FREE YM03016 58740002
         BE    FREELAST                 YES, GO TO FREE LAST SECTION    58800002
         L     R1,E0(,R8)               GET ADDR OF PAGE TO FREE        59100002
         SPACE 1                                                        59220002
FREE     EQU   *                                                        59280002
         FREEMAIN R,LV=(2),A=(1),SP=TIOCSP  FREE 1 PAGE OF BUFFERS      59340002
         LTR   R3,R3                    WAS IT LAST PAGE JUST FREED     59400002
         BZ    ERROR07                  YES, SEND ERROR MSG             59460002
         LA    R8,E0(R3,R8)             BACK UP ONE ENTRY IN FREE       59580002
*                                       BUFFER LIST                     59640002
         B     FREESTUP                 FREE NEXT PAGE                  59700002
         SPACE 1                                                        59750002
FREELAST EQU   *                                                        60060002
         L     R1,E0(,R8)               GET ADDR OF PAST PAGE OF BFR    60300002
*                                       PLUS RPT AND TSB'S              60360002
         L     R2,LASTPAGE              GET SIZE OF LAST PAGE           60540002
         SR    R3,R3                    INDICATE LAST PAGE FREED        60600002
         B     FREE                     GO TO FREE STORAGE              60660002
         DROP  R7                                                       60720002
         SPACE 3                                                        60780002
*                                                                       60840002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60900002
*                                                                       60960002
*              THIS ROUTINE CONVERTS THE PARAMETER VALUE                61020002
*              INTO EBCDIC AND WRITE THE ERROR MESSAGE                  61080002
*              TO THE OPERATOR CONSOLE                                  61140002
*                                                                       61200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 61260002
*                                                                       61320002
BADPARM  EQU   *                                                        61380002
         USING KYWDSECT,R10                                             61440002
         L     R1,MSG407I               GET ADDRESS OF WTO PARMLIST     61500002
         LH    R15,E0(,R1)              GET MSG LENGTH                  61560002
         BCTR  R15,R0                   DECREMENT FOR EX                61620002
         EX    R15,MOVEMSG              MOVE MSG TO WORK AREA           61680002
         LH    R7,PLENGTH               GET LENGTH OF PARM              61740002
         BCTR  R7,R0                    DECREMENT FOR EX                61800002
         EX    R7,MOVEPARM              MOVE PARAMETER TO MSG LIST      61860002
         LA    R8,MSGLIST+E38(R7)       POINT TO END OF KEYWORD         61920002
         MVI   E0(R8),EQUAL             PUT IN '=' SIGN                 61980002
         L     R7,PVALUE                GET INVALUD VALUE               62040002
         CVD   R7,DOUBLE1               CONVERT VALUE TO PACKED DECIMAL 62100002
         UNPK  DOUBLE2(E8),DOUBLE1(E8)  UNPACK TO EBCDIC                62160002
         OI    DOUBLE2+E7,XF0           MAKE LAST DIGIT PRINTABLE       62220002
         LA    R7,DOUBLE2+E3            POINT TO FIRST POSSIBLE CHAR    62280002
         LA    R15,E4                   1 LT MAX BAD VALUE LENGTH       62340002
         SPACE 1                                                        62400002
CHKZERO  EQU   *                                                        62460002
         CLI   E0(R7),XF0               IS IT ZERO                      62520002
         BNE   MOVEIT                   NO, MOVE VALUE                  62580002
         LA    R7,E1(,R7)               POINT TO NEXT CHAR              62640002
         BCT   R15,CHKZERO              CHECK NEXT CHAR IF IT IS 0      62700002
         SPACE 1                                                        62760002
MOVEIT   EQU   *                                                        62820002
         EX    R15,MOVEVAL              MOVE BAD VALUE                  62880002
         B     WTO001                   GO TO SEND ERROR MSG            62940002
         DROP  R10                                                      63000002
         SPACE 3                                                        63060002
*                                                                       63120002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63180002
*                                                                       63240002
*              MOVE WTO'S PARAMETER LIST TO THE WORK AREA               63300002
*              AND ISSUE WTO MACRO                                      63360002
*                                                                       63420002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63480002
*                                                                       63540002
WTO      EQU   *                                                        63600002
         LH    R15,E0(,R1)              GET MSG LENGTH                  63660002
         LA    R15,E3(,R15)             ADD 1 LT THE LENGTH OF          63710002
*                                       DESCRIPTOR/ROUTING CODES        63760002
         EX    R15,MOVEMSG              MOVE MSG LIST TO WORK AREA      63780002
         SPACE 1                                                        63840002
WTO001   EQU   *                                                        63900002
         LA    R1,MSGLIST               SET UP FOR WTO                  63960002
         WTO   MF=(E,(1))               WRITE MSG OUT TO OPER CONSOL    64020002
         BR    R14                      GO BACK TO CALLER               64070002
         SPACE 3                                                        64140002
*                                                                       64200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 64260002
*                                                                       64320002
*              THIS SUBROUTINE FINDS OUT THE NUMBER OF TERMINALS        64380002
*              WHICH CAN BE USED FOR TIME SHARING                       64440002
*                                                                       64500002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 64560002
*                                                                       64620002
CTTSTERM EQU   *                                                        64680002
         USING IEDQTRM,R1               ADDRESSABILITY FOR TRM          64740002
         USING IEDQAVTD,R4              ADDRESSABILITY FOR TCAM AVT     64800002
         USING IEDQTNTD,R15             ADDRESSABILITY FOR TNT          64860002
*                                                                       64920002
* LOCATE THE TRM VIA INDEX IN REG 1 AND TNT ROUTINE                     64980002
*                                                                       65040002
         L     R4,OPCAVTPT              GET TCAM AVT ADDR               65100002
         SR    R5,R5                    INITIALIZE COUNTER              65160002
         L     R15,AVTRNMPT             GET TNT CODE ADDR               65220002
         LH    R8,TNTLEN                HIGHEST INDEX NO.               65280002
NEXTTRM  EQU   *                                                        65340002
         LR    R1,R8                    PUT INDEX IN REG 1              65400002
         BALR  R14,R15                  GO TO TNT CODE                  65460002
         L     R1,TRMDESTQ-E1           GET ADDRESS OF QCB              65510002
         DROP  R1                       R1 NO LONGER BASE FOR TRM       65512002
         USING IEDQQCB,R1               USE R1 AS QCB BASE              65514002
         TM    QCBDSFLG,QCBTSQ          CAN THIS TERM BE USED FOR TS    65520002
         BZ    CHKSTOP                  NO, SEE IF ANY MORE TERMINALS   65580002
*                                       TO CHECK                        65640002
         LA    R5,E1(,R5)               ADD 1 TO TS TERM NUMBER         65700002
         SPACE 1                                                        65760002
CHKSTOP  EQU   *                                                        65820002
         BCT   R8,NEXTTRM               CHECK NEXT TERM IF ANY          65880002
         BR    R10                      TO BACK TO CALLER               65940002
         DROP  R1,R4,R15                                                66000002
         SPACE 3                                                        66060002
*                                                                       66120002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 66180002
*                                                                       66240002
*              CLOSE SYS1.PARMLIB                                       66300002
*                                                                       66360002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 66420002
*                                                                       66480002
CPARMLIB EQU   *                                                        66540002
         LA    R1,OPENPARM              GET ADDR OF PARMLIST            66600002
         CLOSE MF=(E,(1))               CLOSE PARMLIB                   66660002
         SPACE 3                                                        66720002
*                                                                       66780002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 66840002
*                                                                       66900002
*              UNALLOCATE SYS1.PARMLIB                                  66960002
*                                                                       67020002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67080002
*                                                                       67140002
         SPACE 1                                                        67200002
UNALLOCA EQU   *                                                        67260002
         MVC   RQBLOCK(DAPLEND-DAPLIST),DAPLIST  RE-INTIALIZE REQUEST   67320002
*                                       BLOCK FOR UNALLOCATION          67420002
         MVI   VERBCODE,UNALLOC         REQUEST IS FOR UNALLOCATION     67422002
         MVC   WATEXT1,TEXT1            RE-INITIALIZE TEXT UNIT 1 IN WA 67430002
         LA    R1,WATPTR1               ADDR OF TEXT POINTER IN WA      67432002
         ST    R1,TEXTPTR               RELOCATE PTR TO TEXT PTR        67434002
         LA    R1,WATEXT1               ADDR OF TEXT UNIT 1 IN WA       67436002
         O     R1,HIBITON               SIGNAL LAST POINTER             67436402
         ST    R1,WATPTR1               RELOCATE WA TEXT POINTER 1      67438002
         LA    R1,RQBLKPTR              GET REQUEST BLOCK PTR           67440002
         DYNALLOC                       UNALLOCATE SYS1.PARMLIB         67500002
         BR    R14                      GO BACK TO CALLER               67560002
         DROP  RWABASE                  DROP WORK AREA BASE             67610002
         SPACE 3                                                        67620002
*                                                                       67800002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67850002
*                                                                       67850402
*              STOP TIME SHARING                                        67852002
*                                                                       67854002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67856002
*                                                                       67858002
STOP     EQU   *                                                        67860002
         IPK                            GET CALLER'S KEY IN REG 2       67870002
         LR    R10,R2                   SAVE IT IN REG 10               67880002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    67890002
         LA    R5,E1(,R3)               R5 POINTS TO OPC WORK AREA      67892002
*                                       AFTER 'TS='                     67894002
         L     R3,CVTPTR                GET CVT ADDRESS                 67910002
         USING CVT,R3                   ADDRESSABILITY FOR CVT          67960002
         L     R4,CVTAQAVT              GET ADDRESS OF TCX              67970002
         USING IEDQTCX,R4               ADDRESSABILITY FOR TCX          67970102
         LR    R15,RBASE                SAVE BASE REGISTER              67970502
         LR    R6,ROPCAVT               SAVE OP CONTROL AVT PTR         67972502
         SPACE 1                                                        67972602
GTLOCAL  EQU   *                                                        67972702
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,      * GET LOCAL       X67973002
               RELATED=(TIOCRPT,IEDAY1(FREELCL))     * LOCK             67973402
         SPACE 1                                                        67973802
GTCMS    EQU   *                                                        67974202
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,        * GET CMS         X67974302
               RELATED=(TIOCRPT,IEDAY1(FREECMS))     * LOCK             67974402
         SPACE 3                                                        67974502
         LR    RBASE,R15                RESTORE BASE REGISTER           67974602
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          67974702
         L     R7,TCXRPT                GET TIOCRPT ADDRESS             67974802
         LTR   R7,R7                    IS TS IN PROGRESS               67974902
         BZ    RJCTSTOP                 NO, REJECT STOP TS REQUEST      67975202
         USING TIOCRPT,R7               ADDRESSABILITY FOR TIOCRPT      67977002
         TM    TIOCFLG,TIOCSTOP         IS TS STOP IN PROCESS           67978002
         BO    ASKREPLY                 YES, ASK FOR 'U' OR 'FSTOP'     67978402
         SPACE 3                                                        67978502
*                                                                       67978602
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67978702
*                                                                       67978802
*              SET ON TIOCSTOP FLAG                                     67979102
*                                                                       67979402
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67979602
*                                                                       67980002
         SPACE 3                                                        67999702
         OI    TIOCFLG,TIOCSTOP         SET ON TS STOP FLAG             68019202
         LA    R5,E3(,R5)               * PICK AN ADDRESS ON WORD       68021202
         N     R5,MINUS4                * BOUNDARY IN OP CNTRL BFR      68023202
         L     R1,TIOCLDS               GET TIOC SUBTASK TCB ADDRESS    68025202
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    68026202
         ST    R1,E0(,R5)               SAVE TIOCLDS IN OP CNTRL BUFFER 68029002
         SPACE 3                                                        68030002
*                                                                       68031002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   68032002
*                                                                       68033002
*              LOGOFF EACH TIME SHARING USER                            68034002
*                                                                       68035002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   68036002
*                                                                       68037002
         LH    R9,TIOCUSCT              GET TIOC USE COUNT              68038002
         LTR   R9,R9                    IS THERE ANY TS USER ON         68039002
         BZ    DETAY802                 NO, GO TO DETACH TIOC SUBTASK   68040002
         SPACE 1                                                        68044702
*                                                                       68054702
*  LOGOFF EACH TIME SHARING USER                                        68064702
*                                                                       68065102
*        INTERFACE WITH SYSTEM INITIATED CANCEL -                       68065502
*                                                                       68065902
*        REGISTER  0 - POST CODE                                        68066302
*        REGISTER  1 - ASCB ADDRESS                                     68068002
*        REGISTER 13 - POINT TO A SAVE AREA                             68068402
*        REGISTER 14 - RETURN ADDRESS                                   68070002
*        REGISTER 15 - BRANCH ENTRY ADDRESS                             68072002
*                                                                       68072402
         LH    R2,TIOCNTSB              GET NUMBER OF TSB'S             68072802
         L     R8,TIOCTSB-E1            GET FIRST TSB ADDRESS           68074502
         USING TSB,R8                   ADDRESSABILITY FOR TSB          68076202
         LA    R13,TIOCSAVE             SET UP SAVE AREA POINTER        68077902
         SPACE 1                                                        68079602
TSBLOOP  EQU   *                                                        68081302
         TM    TSBSTAT,TSBINUSE         IS THIS TSB IN USE              68083002
         BNO   NEXTTSB                  NO, CHECK NEXT TSB              68084702
         L     R1,TSBASCBA              GET ASCB ADDRESS                68086402
         L     R0,POSTCODE              'POST CODE' FOR SIC             68088102
         L     R15,CVTSIC               GET BRANCH ENTRY ADDRESS TO SIC 68089802
         BALR  R14,R15                  GO TO SYSTEM INITIATED CANCEL   68091502
         SPACE 1                                                        68093202
NEXTTSB  EQU   *                                                        68094902
         LA    R8,TSBEND-TSB(,R8)       POINT TO NEXT TSB               68096602
         BCT   R2,TSBLOOP               CHECK NEXT TSB IF ANY           68098302
         SPACE 3                                                        68100002
*                                                                       68166102
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68166502
*                                                                       68166902
*              DETACH IEDAY802                                          68167302
*                                                                       68167702
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68167802
*                                                                       68167902
DETAY802 EQU   *                                                        68169002
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          68169102
         NI    TIOCTECB,NOT-WAITBIT     TURN WAIT BIT OFF               68169402
         OI    TIOCTECB,POSTBIT         TURN POST BIT ON                68169802
         BAL   R1,FREECMS               FREE LOCKS                      68171002
         DETACH E0(,R5)                 DETACH IEDAY802                 68172602
         SPACE 3                                                        68179202
*                                                                       68180302
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68181402
*                                                                       68182502
*              IF NO TIME SHARING USER ON, CALL TSEND TO FREE TIOC      68183602
*              STOREAGE.  IF THERE ARE TS USERS ON, TSEND WILL          68185602
*              BE CALLED BY IEDAY8 AFTER THE LAST USER HAS BEEN         68185702
*              LOGGED OFF.                                              68186702
*                                                                       68190002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68191002
*                                                                       68192002
         LTR   R9,R9                    ANY TIME SHARING USER ON        68193002
         BNZ   RESTOREK                 YES, EXIT TO NEXT LOAD          68194002
         TSEND                         ,CALL TSEND TO FREE TIOC STORAGE 68195002
         SPACE 1                                                        68196002
         B     RESTOREK                 GET BACK TO CALLER'S KEY        68197002
         SPACE 1                                                        68198002
RJCTSTOP EQU   *                                                        68199002
         BAL   R1,FREECMS               GO TO FREE LOCKS                68200002
         L     R1,MSG021I               GET ADDRESS OF MSG LIST         68201002
         WTO   MF=(E,(1))               REJECT STOP TS REQUEST          68202002
         SPACE 1                                                        68203002
RESTOREK EQU   *                                                        68204002
         LR    R2,R10                   GET CALLER'S KEY                68205002
         SPKA  E0(R2)                   CHANGE  BACK TO CALLER'S KEY    68206002
         B     EXIT                     EXIT TO NEXT LOAD               68207002
         SPACE 3                                                        68208002
*                                                                       68209002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68210002
*                                                                       68211002
*              FREE LOCK AND CROSS MEMORY LOCKS                         68212002
*                                                                       68213002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68214002
*                                                                       68215002
FREECMS  EQU   *                                                        68216002
         LR    R15,RBASE                SAVE BASE REGISTER              68217002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    68218002
         SETLOCK RELEASE,TYPE=CMS,               * FREE CMS            X68219002
               RELATED=(TIOCRPT,IEDAY1(GETCMS))  * LOCK                 68220002
         SPACE 1                                                        68221002
FREELCL  EQU   *                                                        68222102
         SETLOCK RELEASE,TYPE=LOCAL,             * FREE LOCAL          X68223202
               RELATED=(TIOCRPT,IEDAY1(GETLCL))  * LOCK                 68224302
         SPACE 1                                                        68225402
*                                       FREE LOCAL LOCK                 68226502
         LR    RBASE,R15                RESTORE BASE REGISTER           68227602
         LR    ROPCAVT,R6               RESTORE OP CONTROL AVT ADDR     68228702
         BR    R1                       RETURN TO CALLER OF SUBROUTINE  68229802
         SPACE 3                                                        68230902
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68232002
*                                                                       68233102
*              THIS SECTION OF CODE WILL BE ENTERED ONLY                68234202
*              IF TS STOP IS CALLED AGAIN WHEN IT IS IN                 68235302
*              PROGRESS.  IN SUCH CASE, THE OPERATOR IS ASKED           68236402
*              IF HE WANTS 'FSTOP'.  WHEN 'FSTOP' IS REQUESTED,         68237502
*              ISSUE TCABEND TO CANCEL ALL TIME SHARING USERS           68238602
*              AND FREE TIOC STORAGE.  OTHERWISE, JUST EXIT             68239702
*              TO LET NORMAL TS STOP FINISH ITS PROCESSING.             68240802
*                                                                       68241902
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68243002
*                                                                       68244102
ASKREPLY EQU   *                                                        68245202
         BAL   R1,FREECMS               FREE LOCKS                      68246302
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          68246702
         LA    R0,WASTOPND-WASTOP       SIZE OF WORK AREA               68247402
         GETMAIN R,LV=(0)               GET STORAGE FOR WORK AREA       68248502
         LR    RWABASE,R1               STORAGE RETURNED IN REG 1       68249602
         USING WASTOP,RWABASE           RWABASE IS THE BASE             68250702
         L     R2,MSG024D               GET MSG LIST ADDRESS            68251802
         MVC   MESSAGE,E0(R2)           MOVE MSG LIST TO WORK AREA      68252902
         LA    R2,REPLYECB              GET ADDRESS OF REPLY ECB        68254002
         ST    R2,ECBADDR               PUT IT IN MESSAGE LIST          68255102
         LA    R2,REPLY                 GET ADDRESS TO PLACE REPLY      68256202
         ST    R2,REPLYADD-E1           PUT IT IN MESSAGE LIST          68257302
         LA    R2,REPLYL                GET REPLY LENGTH                68258402
         STC   R2,REPLYLNG              PUT IT IN MESSAGE LIST          68259502
         SPACE 1                                                        68260602
WTOR     EQU   *                                                        68261702
         LA    R1,MESSAGE               POSITION R1 FOR WTOR            68262102
         SR    R0,R0                    CLEAR REGISTER                  68262502
         ST    R0,REPLYECB              ZERO OUT ECB                    68262602
         WTOR  ,,,,,MF=(E,(1))          INFORM OPERATOR TS STOP IN     -68262802
                                        PROGRESS, ASK REPLY U OR FSTOP  68263902
         SPACE 1                                                        68264002
         WAIT  ECB=REPLYECB,LONG=YES    WAIT FOR THE REPLY              68264302
         SPACE 1                                                        68264402
         OC    REPLY(E8),BLANKS         FOLD REPLY TO UPPER CASE        68264802
         CLC   CU,REPLY                 IS REPLY 'U'                    68265002
         BE    FREEWAP                  YES, NOTHING MORE TO DO         68266102
         CLC   CFSTOP(E5),REPLY         IS REPLY 'FSTOP'                68267202
         BNE   WTOR                     NO, LOOP BACK TO ASK AGAIN      68268302
         SPACE 1                                                        68269402
*        TCABEND                        CALL TCABEND TO FORCE STOP TS   68270502
         SPACE 1                                                        68270902
         LA    R0,ECABEND               LOAD ENTRY CODE         YM03842 68271302
         LA    R1,NOTDUMP               INFORM 9400 NOT TO DUMP YM03842 68271402
         SVC   TERMSTUS                 ISSUE TERM STATUS SVC   YM03842 68271502
         SPACE 1                                                        68271602
FREEWAP  EQU   *                                                        68272702
         LR    R2,R10                   GET CALLER'S KEY                68273802
         LA    R0,WASTOPND-WASTOP       SIZE OF WORK AREA               68274902
         B     FREEWAB                  FREE WORK AREA STORAGE AND EXIT 68276002
         DROP  R3,R4,R7,R8,RWABASE      DROP BASE REGISTERS             68277102
         SPACE 3                                                        68278202
         USING WASTART,RWABASE          START WORK AREA ADDRESSABLE     68279302
MOVENAME MVC   DOUBLE1(0),E7(R3)        MOVE MEMBER TO WORK AREA        68280402
MOVEMSG  MVC   MSGLIST(E0),E0(R1)       MOVE WTO PARM LIST TO WORK AREA 68281502
MOVEKYWD MVC   MSGLIST+E37(E0),E0(R3)   MOVE BAD PARM TO MSG LIST       68301002
MOVEVAL  MVC   E1(0,R8),E0(R7)          MOVE BAD VALUE TO MSG LIST      68320502
         USING IHADCB,R2                                                68340002
MOVEDDNM MVC   DCBDDNAM(E0),WADDNAM     MOVE DDNAME OF PARMLIB TO DCB   68400002
         DROP  R2                       DROP DCB BASE                   68460002
         USING KYWDSECT,R10             USE R10 AS KEYWORD ENTRY BASE   68520002
MOVEPARM MVC   MSGLIST+E37(E0),PKEYWORD MOVE KEYWORD TO MSG LIST        68580002
         DROP  R10                      DROP KEYWORD ENTRY BASE         68630002
         USING KYWDSECT,R2              USE R2 AS KEYWORD ENTRY BASE    68632002
COMPKYWD CLC   PKEYWORD(0),E0(R3)       COMPARE KEYWORD                 68640002
         DROP  R2                       DROP KEYWORD ENTRY BASE         68690002
PACKVALU PACK  DOUBLE1(E8),E1(0,R4)     PACK SPECIFIED VALUE            68700002
         USING TIOCRPT,R7               USE R7 AS RPT BASE              68760002
ZERORPT  XC    TIOCQTIP(0),TIOCQTIP     ZERO OUT RPT                    68820002
         SPACE 3                                                        68880002
*                                                                       68940002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 69000002
*                                                                       69060002
*              CONSTANTS                                                69120002
*                                                                       69180002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 69240002
*                                                                       69300002
CSTART   DC    C'START'                 USED TO SCAN FOR STARTING TS    69360002
CFSTOP   DC    C'F'                     USED TO SCAN FOR FORCE STOP     69410002
CSTOP    DC    C'STOP'                  USED TO SCAN FOR STOPPING TS    69420002
CTIOC    DC    CL5'TIOC'                USED TO SCAN FOR TIOC PARAMETER 69480002
CPRM00   DC    C'IKJPRM00'              MEMBER NAME OF INSTALLATION     69540002
*                                       DEFAULT OF START TS PARAMETERS  69550002
CU       DC    C'U'                     USED TO SCAN NORMAL STOP        69590002
MINUS4   DC    F'-4'                    USED TO ROUND UP BUFFER SIZE    69660002
MAXIMUM  DC    F'32767'                 MAXIMUM FOR BUFFER NUMBER,      69720002
*                                       OWAITHI AND INLOCKHI            69780002
BLANKS   DC    X'40404040'              FULL WORD OF BLANKS             69840002
         DC    X'40404040'              FULL WORD OF BLANKS             69890002
HIBITON  DC    X'80000000'              USED TO TURN HIGH ORDER BIT ON  69900002
DWBNDY   DC    X'FFFFFFF8'              USED TO ROUND UP TO DW BNDY     69952002
POSTCODE DC    X'00000622'              COMPLETION CODE FOR             69954002
*                                       TERMINATED MEMORY               69956002
ONEPAGE  DC    H'4096'                  PAGE SIZE                       69960002
MSGWRIT  DC    C'07'                    ID TO MOVE INTO OPCLDNME        70020002
*                                       IN OPCAVT                       70080002
MSG005I  DC    V(WTO005I)               ADDRESS OF MSG LIST             70140002
MSG006I  DC    V(WTO006I)               ADDRESS OF MSG LIST             70200002
MSG007I  DC    V(WTO007I)               ADDRESS OF MSG LIST             70260002
MSG019I  DC    V(WTO019I)               ADDRESS OF MSG LIST             70320002
MSG021I  DC    V(WTO021I)               ADDRESS OF MSG LIST             70380002
MSG024D  DC    V(WTO024D)               ADDRESS OF MSG LIST             70440002
MSG402I  DC    V(WTO402I)               ADDRESS OF MSG LIST             70500002
MSG404I  DC    V(WTO404I)               ADDRESS OF MSG LIST             70560002
MSG407I  DC    V(WTO407I)               ADDRESS OF MSG LIST             70620002
MSG408I  DC    V(WTO408I)               ADDRESS OF MSG LIST             70680002
MSG414I  DC    V(WTO414I)               ADDRESS OF MSG LIST             70740002
         SPACE 3                                                        70800002
*                                                                       70860002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 70920002
*                                                                       70980002
*              DCB FOR SYS1.PARMLIB                                     71040002
*                                                                       71100002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 71160002
*                                                                       71220002
PARMDCB  DCB   BLKSIZE=80,LRECL=80,DSORG=PO,EODAD=CLOSELIB,MACRF=(R),  X71280002
               RECFM=F,DEVD=DA,SYNAD=ERROR06,DDNAME=A                   71340002
ENDDCB   EQU   *                                                        71400002
         SPACE 3                                                        71460002
*                                                                       71520002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 71580002
*                                                                       71640002
*              REQUEST BLOCK FOR ALLOCATING PARMLIB                     71700002
*                                                                       71760002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 71820002
*                                                                       71880002
DAPLIST  DS    0F                                                       71940002
         DC    X'14'                    LENGTH OF REQUEST BLOCK         72000002
         DC    X'01'                    REQUEST FOR DSN ALLOCATION      72060002
         DC    XL2'0000'                USE IT, IF ALREADY ALLOCATED    72120002
         DC    XL2'0000'                USED BY SVC 99 FOR ERROR CODE   72180002
         DC    XL2'0000'                USED BY SVC 99 FOR ERROR INFO   72240002
         DC    A(0)                     PTR TO A LIST OF TEXT PTRS      72300002
         DC    F'0'                     RESERVED                        72360002
         DC    XL4'00000000'            NO SPECIAL REQUEST              72420002
DAPLEND  EQU   *                        END OF REQUEST BLOCK            72470002
             SPACE 1                                                    72540002
*                                                                       72600002
*  TEXT POINTERS                                                        72660002
*                                                                       72720002
TEXTPTRS DC    A(0)                     1ST TEXT POINTER                72780002
         DC    A(0)                     2ND TEXT POINTER                72840002
         DC    A(0)                     3RD TEXT POINTER                72900002
         DC    X'80',AL3(0)             4TH TEXT POINTER                72960002
             SPACE 1                                                    73020002
*                                                                       73080002
*  TEXT UNITS                                                           73140002
*                                                                       73200002
TEXT1    DC    XL2'0002'                DSNAME REQUEST                  73260002
         DC    XL2'0001'                NUMBER                          73320002
         DC    XL2'000C'                LENGTH OF PARM                  73380002
         DC    C'SYS1.PARMLIB'          DATA SET NAME                   73440002
         SPACE 1                                                        73500002
TEXT2    DC    XL2'0004'                DATA SET STATUS                 73560002
         DC    XL2'0001'                NUMBER                          73620002
         DC    XL2'0001'                LENGTH OF PARM                  73680002
         DC    XL1'08'                  SHARE                           73740002
         SPACE 1                                                        73800002
TEXT3    DC    X'0055'                  RETURN ALLOCATED DDNAME         73860002
         DC    X'0001'                  NUMBER                          73920002
         DC    X'0008'                  LENGTH OF PARM                  73980002
         DS    CL8                      DDNAME TO BE RETURNED           74040002
         SPACE 1                                                        74100002
TEXT4    DC    XL2'0005'                DISPOSITION                     74160002
         DC    XL2'0001'                NUMBER                          74220002
         DC    XL2'0001'                LENGTH OF PARM                  74280002
         DC    XL1'08'                  KEEP                            74340002
DAPEND   EQU   *                        END OF DYN ALLOCATION PARM LIST 74390002
         SPACE 3                                                        74400002
*                                                                       75840002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 75900002
*                                                                       75960002
*              TIOC PARAMETER KEYWORD TABLE                             76020002
*                                                                       76080002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 76140002
*                                                                       76200002
PARMTBL  DS    0F                       WORD BOUNDARY ALIGNMENT         76260002
         DC    X'00'                    FLAG                            76320002
         DC    AL1(64)                  BUFSIZE DEFAULT VALUE           76380002
         DC    H'7'                     LENGTH OF KEYWORD               76440002
         DC    C'BUFSIZE '              KEYWORD                         76500002
         DC    F'0'                     SPECIFIED BUFSIZE VALUE         76560002
         DC    X'00'                    FLAG                            76610002
         DC    AL1(0)                   USERMAX DEFAULT NOT USED        76612002
         DC    H'7'                     LENGTH OF KEYWORD               76614002
         DC    C'USERMAX '              KEYWORD                         76616002
         DC    F'0'                     SPECIFIED USERMAX VALUE         76618002
         DC    X'00'                    FLAG                            76620002
         DC    AL1(0)                   BUFFERS DEFAULT NOT USED        76680002
         DC    H'7'                     LENGTH OF KEYWORD               76740002
         DC    C'BUFFERS '              KEYWORD                         76800002
         DC    F'0'                     SPECIFIED BUFFERS VALUE         76860002
         DC    X'00'                    FLAG                            76920002
         DC    AL1(20)                  OWAITHI DEFAULT VALUE           76980002
         DC    H'7'                     LENGTH OF KEYWORD               77040002
         DC    C'OWAITHI '              KEYWORD                         77100002
         DC    F'0'                     SPECIFIED OWAITHI VALUE         77160002
         DC    X'00'                    FLAG                            77220002
         DC    AL1(4)                   OWAITLO DEFAULT VALUE           77280002
         DC    H'7'                     LENGTH OF KEYWORD               77340002
         DC    C'OWAITLO '              KEYWORD                         77400002
         DC    F'0'                     SPECIFIED OWAITLO VALUE         77460002
         DC    X'00'                    FLAG                            77520002
         DC    AL1(4)                   INLOCKHI DEFAULT VALUE          77580002
         DC    H'8'                     LENGTH OF KEYWORD               77640002
         DC    C'INLOCKHI'              KEYWORD                         77700002
         DC    F'0'                     SPECIFIED INLOCKLO VALUE        77760002
         DC    X'00'                    FLAG                            77820002
         DC    AL1(1)                   INLOCKLO DEFAULT VALUE          77880002
         DC    H'8'                     LENGTH OF KEYWORD               77940002
         DC    C'INLOCKLO'              KEYWORD                         78000002
         DC    F'0'                     SPECIFIED INLOCKLO VALUE        78060002
         DC    X'00'                    FLAG                            78120002
         DC    AL1(0)                   RESVBUF DEFAULT NOT USED        78180002
         DC    H'7'                     LENGTH OF KEYWORD               78240002
         DC    C'RESVBUF '              KEYWORD                         78300002
         DC    F'0'                     SPECIFIED RESVBUF VALUE         78360002
         DC    X'00'                    FLAG                            78410002
         DC    AL1(10)                  RECONLIM DEFAULT VALUE          78412002
         DC    H'8'                     LENGTH OF KEYWORD               78414002
         DC    C'RECONLIM'              KEYWORD                         78414402
         DC    F'0'                     SPECIFIED RECONLIM VALUE        78416002
         DC    X'00'                    FLAG                            78420002
         DC    AL1(0)                   USERCHG DEFAULT NOT USED        78480002
         DC    H'7'                     LENGTH OF KEYWORD               78540002
         DC    C'USERCHG '              KEYWORD                         78600002
         DC    F'0'                     SPECIFIED USERCHG VALUE         78660002
         DC    X'00'                    FLAG                            78720002
         DC    AL1(0)                   SLACK DEFAULT NOT USED          78780002
         DC    H'5'                     LENGTH OF KEYWORD               78840002
         DC    C'SLACK   '              KEYWORD                         78900002
         DC    F'0'                     SPECIFIED SLACK VALUE           78960002
         DC    F'-1'                    MARK END OF TABLE               79020002
ENDPMTBL EQU   *                                                        79080002
PATCH    DC    20F'0'                   PATCH AREA FOR IEDAY1           79130002
         SPACE 3                                                        79140002
*                                                                       79200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 79260002
*                                                                       79320002
*              PRIVATE DSECT OF WORK AREA FOR START TS                  79380002
*                                                                       79440002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 79500002
*                                                                       79560002
         DS    0F                                                       79620002
WASTART  DSECT                                                          79680002
RQBLKPTR DS    F                        REQUEST BLOCK POINTER           79740002
RQBLOCK  DS    0X                       REQUEST BLOCK FOR SVC 99        79860002
LENGTH   DS    XL1                      LENGTH OF REQUEST BLOCK         79980002
VERBCODE DS    XL1                      VERB CODE                       80040002
FLAG1    DS    XL2                      FLAGS                           80100002
ERRCODE  DS    XL2                      ERROR CODE                      80160002
INFOCODE DS    XL2                      INFORMATION CODE                80220002
TEXTPTR  DS    A                        PTR TO TEXT POINTERS            80280002
         DS    F                        RESERVED                        80340002
FLAG2    DS    XL4                      FLAGS                           80400002
RQBLKEND EQU   *                                                        80460002
RQBLKLEN EQU   RQBLKEND-RQBLOCK         LENGTH OF REQUEST BLOCK         80520002
WATPTR1  DS    A                        ADDR OF TEXT UNIT 1             80580002
WATPTR2  DS    A                        ADDR OF TEXT UNIT 2             80640002
WATPTR3  DS    A                        ADDR OF TEXT UNIT 3             80700002
WATPTR4  DS    A                        ADDR OF TEXT UNIT 4             80760002
WATEXT1  DS    CL18                     TEXT UNIT 1                     80770002
WATEXT2  DS    CL7                      TEXT UNIT 2                     80780002
WATEXT3  DS    0CL14                    TEXT UNIT 3                     80820002
         DS    CL4                      KEY AND NUMBER                  80880002
WADDLEN  DS    CL2                      PARM LENGTH                     80940002
WADDNAM  DS    CL8                      PARM FOR DDNAME                 81000002
WATEXT4  DS    CL7                      TEXT UNIT 4                     81050002
OPENPARM DS    F                        PARM LIST FOR OPEN              81100002
WADCB    DS    CL88                     WORK COPY FOR THE PARMLIB DCB   81110002
WADECB   DS    CL24                     WORK COPY OF DECB               81120002
BUFFER   DS    CL80                     AREA TO READ IN PARM RECORD     81180002
MSGLIST  DS    CL80                     AREA FOR WTO PARM LIST          81240002
KYWDTBL  DS    0F                       BEGINNING OF KEYWORD TABLE      81300002
BUFSIZE  DS    4F                       BUFFER SIZE                     81360002
USERMAX  DS    4F                       USERMAX                         81410002
BUFFERS  DS    4F                       TOTAL NUMBER OF BUFFERS         81420002
OWAITHI  DS    4F                       OWAITHI                         81480002
OWAITLO  DS    4F                       OWAITLO                         81540002
INLOCKHI DS    4F                       INLOCKHI                        81600002
INLOCKLO DS    4F                       INLOCKLO                        81660002
RESVBUF  DS    4F                       NO. OF RESERVED BUFFERS         81720002
RECONLIM DS    4F                       RECONNECT LIMIT                 81770002
USERCHG  DS    4F                       USER CHANGE                     81780002
SLACK    DS    4F                       SLACK TIME                      81840002
ENDMARK  DS    F                        END OF TABLE MARKER             81900002
DOUBLE1  DS    D                        AREA FOR PACK/UNPACK            81960002
DOUBLE2  DS    D                        AREA FOR PACK/UNPACK            82020002
REGSAVE  DS    18F                      REGISTER SAVE AREA              82070002
OPCAVTSV DS    F                        SAVE AREA FOR OPC AVT           82072002
LASTPAGE DS    F                        SIZE OF LAST PAGE OF BFRS PLUS  82080002
*                                       RPT AND TSB TABLE               82140002
RPTSIZE  DS    H                        CONTAINS SIZE OF TIOCRPT        82200002
PGBUFNO  DS    H                        CONTAINS NO. OF BFRS PER PAGE   82260002
LPGBUFNO DS    H                        NO. OF BFRS ON LAST PAGE        82320002
BFRPAGE  DS    H                        KEEPS NO. OF FULL PAGE FOR BFRS 82380002
RPTADDR  DS    A                        AREA TO SAVE TIOCRPT ADDRESS    82440002
CALLRKEY DS    CL1                      SAVE AREA FOR CALLER'S KEY      82500002
         SPACE 2                                                        82560002
*                                                                       82620002
* SMF RECORD                                                            82680002
*                                                                       82740002
         IFASMFR (31)                                                   82800002
TTIREND  EQU   *                                                        82860002
RCDSIZE  EQU   TTIREND-TTISMF           SIZE OF SMF RCD TYPE 31         82920002
WAEND    EQU   *                        END OF WORK AREA                82980002
         SPACE 3                                                        83040002
*                                                                       83100002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83160002
*                                                                       83220002
*              PRIVATE DSECT FOR MAPPING EACH ENTRY IN                  83280002
*              THE KEYWORD TABLE                                        83340002
*                                                                       83400002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83460002
*                                                                       83520002
         DS    0F                       ALIGN ON WORD BOUNDARY          83580002
KYWDSECT DSECT                                                          83640002
PFLAG    DS    X                        FLAG BUTE                       83700002
PUSER    EQU   X'80'                    VALUE IS SPECIFIED              83760002
*        BITS 1-7 NOT USED                                              83820002
PDEFAULT DS    X                        DEFAULT VALUE                   83880002
PLENGTH  DS    H                        LENGTH OF KEYWORD               83940002
PKEYWORD DS    CL8                      PARAMETER KEYWORD               84000002
PVALUE   DS    F                        SPECIFIED VALUE                 84060002
PSIZE    EQU   *-PFLAG                  SIZE OF EACH PARMETER ENTRY IN  84120002
*                                       THE KEYWORD TABLE               84180002
         SPACE 3                                                        84190002
*                                                                       84200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 84210002
*                                                                       84220002
*              PRIVATE DSECT OF WORK AREA FOR STOP TS                   84222002
*                                                                       84224002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 84226002
*                                                                       84228002
         DS    0F                       FORCE WORD BOUNDARY             84230002
WASTOP   DSECT                                                          84232002
REPLYECB DS    F                        ECB FOR WTOR                    84234002
REPLY    DS    2F                       REPLY AREA                      84236002
MESSAGE  DS    0CL67                    MESSAGE LIST                    84238002
REPLYLNG DS    AL1                      REPLY LENGTH                    84238402
REPLYADD DS    AL3                      REPLY ADDRESS                   84238802
ECBADDR  DS    A                        ECB ADDRESS                     84239202
MSGLNGTH DS    AL2                      MESSAGE LENGTH                  84239602
MSGFLAGS DS    AL2                      MESSAGE FLAGS                   84239702
MSGTEXT  DS    CL51                     MESSAGE TEXT                    84239802
DESCCODE DS    AL2                      DESCRIPTOR CODE                 84239902
ROUTCODE DS    AL2                      ROUTING CODE                    84259902
WASTOPND EQU   *                        END OF WORK AREA FOR STOP       84279902
         SPACE 3                                                        84280002
         TAVTD                                                          84300002
         SPACE 3                                                        84360002
         IKJTIOCB                                                       84420002
         SPACE 3                                                        84480002
CVT      DSECT                                                          84540002
         CVT   LIST=YES                                                 84600002
         SPACE 3                                                        84660002
         DCBD  DSORG=PS                                                 84720002
         SPACE 3                                                        84780002
         TOPCAVTD                                                       84840002
         SPACE 3                                                        84900002
         TOPCED                                                         84960002
         SPACE 3                                                        85020002
         IHAPSA                                                         85070002
         SPACE 3                                                        85072002
         TQCBD                                                          85080002
         SPACE 3                                                        85140002
         IHASCVT LIST=YES                                               85200002
         SPACE 3                                                        85260002
         IKJTIOCP LIST=YES                                              85320002
         SPACE 3                                                        85380002
         TTCXD                                                          85440002
         SPACE 3                                                        85500002
         TTNTD                                                          85560002
         SPACE 3                                                        85620002
         TTRMD                                                          85680002
         SPACE 3                                                        85740002
         IKJTSB LIST=YES                                                85800002
         END                                                            85860002
./  ADD  SSI=32230008,NAME=IEDAY2
         TITLE 'IEDAY2 - TIOC INITIALIZATION MESSAGES'                  02000002
IEDAY2   CSECT                          MESSAGE CSECT FOR IGCMC10D      04000002
         COPY  LCGASMS2                 LIBRARY CONTROL                 06000002
* *****************************************************************     06050002
*                                                                       06100002
*01* MODULE-NAME = IEDAY2                                               06150002
*                                                                       06200002
*01* DESCRIPTIVE-NAME = TIOC INITIALIZATION MESSAGES                    06250002
*                                                                       06300002
*01* COPYRIGHT = NONE                                                   06350002
*                                                                       06400002
*01* STATUS = 00                                                        06450002
*                                                                       06500002
*01* FUNCTION = CONTAINS MESSAGES WHICH IEDAY1 ISSUES                   06550002
*                                                                       06600002
*01* NOTES = N/A                                                        06650002
*                                                                       06700002
*01* RESTRICTIONS = N/A                                                 06750002
*                                                                       06800002
*02*   DEPENDENCIES = NONE                                              06850002
*                                                                       06900002
*02*   RESTRICTIONS = NONE                                              06950002
*                                                                       07000002
*02*   REGISTER-CONVENTIONS = N/A                                       07050002
*                                                                       07100002
*02*   PATCH-LABEL = AY2END                                             07150002
*                                                                       07200002
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             07250002
*                                                                       07300002
*02*   PROCESSOR = SEE LISTING                                          07350002
*                                                                       07400002
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID-01       07450002
*                                                                       07500002
*02*   ATTRIBUTES = REENTRANT, RESUABLE, ENABLED                        07550002
*                                                                       07600002
*01* ENTRY-POINT = N/A                                                  07650002
*                                                                       07700002
*02*   PURPOSE = SEE FUNCTION                                           07750002
*                                                                       07800002
*02*   LINKAGE = N/C                                                    07850002
*                                                                       07900002
*01* INPUT = N/A                                                        07950002
*                                                                       07960002
*01* OUTPUT = N/A                                                       07970002
*                                                                       07980002
*01* EXIT-NORMAL = N/A                                                  07990002
*                                                                       07992002
*01* EXIT-ERROR = N/A                                                   07994002
*                                                                       07996002
*01* EXTERNAL-REFERENCE = NONE                                          07998002
*                                                                       07998402
*02*   CONTROL-BLOCKS = NONE                                            07998802
*                                                                       07999202
*01* TABLES = NONE                                                      07999602
*                                                                       07999702
*01* MACROS = WTO (MF=L), WTOR (MF=L)                                   07999802
*                                                                       07999902
*01* CHANGE-ACTIVITY                                                    08049902
*                                                                       08059902
**********************************************************************  08069902
         ENTRY WTO414I,WTO005I,WTO006I,WTO007I,WTO019I,WTO021I          08099902
         ENTRY WTO024D,WTO402I,WTO404I,WTO407I,WTO408I                  10000002
         SPACE 2                                                        12000002
WTO414I  WTO   'IKJ414I UNABLE TO OPEN SYS1.PARMLIB',ROUTCDE=2,DESC=5, X14000002
               MF=L                     MESSAGE LIST                    16000002
         SPACE 2                                                        18000002
WTO005I  WTO   'IKJ005I TS START REJECTED - MEMBER OF SYS1.PARMLIB NOT X20000002
               FOUND',ROUTCDE=2,DESC=3,MF=L  MESSAGE LIST               22000002
         SPACE 2                                                        24000002
WTO006I  WTO   'IKJ006I I/O ERROR READING SYS1.PARMLIB',ROUTCDE=10,    X26000002
               DESC=5,MF=L                   MESSAGE LIST               28000002
         SPACE 2                                                        30000002
WTO007I  WTO   'IKJ007I TS START REJECTED - TIME SHARING IS IN PROGRESSX32000002
               ',ROUTCDE=2,DESC=5,MF=L       MESSAGE LIST               34000002
         SPACE 2                                                        36000002
WTO019I  WTO   'IKJ019I TIME SHARING IS INITIALIZED',ROUTCDE=2,DESC=5, X38000002
               MF=L                          MESSAGE LIST               40000002
         SPACE 2                                                        42000002
WTO021I  WTO   'IKJ021I TS STOP REJECTED - TIME SHARING IS NOT IN PROGRX44000002
               ESS',ROUTCDE=2,DESC=5,MF=L    MESSAGE LIST               46000002
         SPACE 2                                                        48000002
WTO024D  WTOR  'IKJ024D TS STOP IN PROGRESS - REPLY ''U'', OR ''FSTOP''X50000002
               ',ROUTCDE=1,DESC=2,MF=L       MESSAGE LIST               52000002
         SPACE 2                                                        54000002
WTO402I  WTO   'IKJ402I TCAM PROCEDURE DOES NOT SUPPORT TIME SHARING', X56000002
               ROUTCDE=2,DESC=3,MF=L         MESSAGE LIST               58000002
WTO404I  WTO   'IKJ404I TS START REJECTED - INSUFFICIENT COMMON AREA STO60000002
               ORAGE AVAILABLE',ROUTCDE=2,DESC=5,MF=L                   62000002
         SPACE 2                                                        64000002
WTO407I  WTO   'IKJ407I INVALID TIOC PARAMETER -                - IGNORE70000002
               ED',ROUTCDE=2,DESC=5,MF=L     MESSAGE LIST               72000002
         SPACE 2                                                        74000002
WTO408I  WTO   'IKJ408I MEMBER ''IKJPRM00'' NOT FOUND',ROUTCDE=2,      X76000002
               DESC=5,MF=L              MESSAGE LIST                    78000002
AY2END   DC    10F'-1'                  PATCH AREA FOR AY2              80050002
         END                                                            80100002
./  ADD  SSI=72410251,NAME=IEDAY88
         TITLE 'IEDAY88 - TIOC LOGOFF/TERMINATION QTIP'                 00700002
IEDAY88  CSECT                                                          01400002
**********************************************************************  02150002
*                                                                       02160002
*01 MODULE-NAME = IEDAY88                                               02200002
*                                                                       02250002
*01 DESCRIPTIVE-NAME = TIOC LOGOFF/TERMINATION QTIP                     02300002
*                                                                       02350002
*01 COPYRIGHT = NONE                                                    02400002
*                                                                       02450002
*01 STATUS = 01                                                         02500003
*                                                                       02550002
*01 FUNCTION = PERFORM TERMINATION CLEANUP (QTIP 23). TRY TO            02600002
*               RECONNECT A DISCONNECTED USER WHO HAS LOGGED BACK IN    02650002
*               (QTIP 1). LOG OFF DISCONNECTED USERS WHOSE RECONNECT    02700002
*               PERIOD HAS EXPIRED (QTIP 27). TEST WHETHER USER HAS     02750002
*               HUNG UP.                                                02760002
*                                                                       02770002
*01 NOTES = N/A                                                         02780002
*                                                                       02790002
*02   DEPENDENCIES = N/A                                                02792002
*                                                                       02794002
*02   RESTRICTIONS = N/A                                                02796002
*                                                                       02798002
*02   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                       02798402
*                                                                       02798802
*02   PATCH-LABEL = PATCH                                               02799202
*                                                                       02799602
*01 MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                              02799702
*                                                                       02799802
*02   PROCESSOR = ASSEMXF-370R                                          02799902
*                                                                       02849902
*02   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID 01        02859902
*                                                                       02869902
*02   ATTRIBUTES = REENTRANT,REUSABLE ENABLED,SUPERVISOR STATE          02879902
*                                                                       02889902
*01 ENTRY-POINT = QTIP0230,QTIP0010,QTIP0270                            02891902
*                                                                       02892302
*02   PURPOSE = SEE FUNCTION                                            02892702
*                                                                       02893102
*02   LINKAGE = QTIP0230 FROM IEDAY8 (VIA IEDAYQT)                      02893502
*                QTIP0270 FROM IEDAY8 (VIA IEDAYQT)                     02943502
*                QTIP0010 FROM LOGON PROMPTER (VIA IEDAYQT)             02953502
*                                                                       02993502
*01 INPUT = REGISTER 12 CONTAINS ENTRY POINT                            03003502
*            REGISTER 14 CONTAINS RETURN ADDRESS                        03013502
*             (QTIP0010)                                                03023502
*            REGISTER 15 CONTAINS ADDRESS OF TWO WORD PARAMETER LIST.   03033502
*                        WORD 1 POINTS TO THE USER ID.                  03035502
*                        WORD 2 POINTS TO THE PASSWORD SUPPLIED BY USER 03037502
*             (QTIP0230)                                                03039902
*            REGISTER 15 CONTAINS ADDRESS OF RMPL                       03040302
*             (QTIP0270)                                                03040702
*            REGISTER 15 CONTAINS ADDRESS OF TIOCRPT                    03041102
*                                                                       03041202
*01 OUTPUT =                                                            03041502
*            QTIP0010                                                   03041602
*               REGISTER 15 = 0  -  SUCCESSFUL                          03041702
*                           = 4  -  PASSWORD DOES NOT MATCH             03041802
*                           = 8  -  USERID UNAVAILABLE(SEE REGISTER 0)  03043802
*               REGISTER  0 = 0  -  USERID NOT FOUND                    03045802
*                           = 4  -  USERID IN USE                       03045902
*            QTIP0230                                                   03046002
*               REGISTER 15 = 4  -  TELL IEDAY8 TO WAIT FOR TSOUTPUT    03048602
*                                   TO FINISH                           03050602
*            QTIP0270                                                   03051002
*               REGISTER 15 = 0  -  TELL IEDAY802 TO ISSUE ANOTHER      03051402
*                                   1 MINUTE STIMER                     03051502
*                           = 4  -  TELL IEDAY802 TO ISSUE WAIT ON      03051602
*                                   TIOCTECB                            03051702
*                                                                       03052102
*01 EXIT-NORMAL = TO IEDAYQT                                            03054302
*                                                                       03056902
*01 EXIT-ERROR = NONE                                                   03059502
*                                                                       03062102
*01 EXTERNAL-REFERENCES                                                 03064702
*                                                                       03067302
*02   ROUTINES = QTIP0140 IN CSECT IEDAYOO IN LOAD MODULE SVC 101       03069902
*                                                                       03072503
*                                                                       03072902
*02   DATA-AREAS = N/A                                                  03074102
*                                                                       03076102
*02   CONTROL-BLOCKS = CVT,TSB,ASCB,QCB,RMPL,TCX,TIOCRPT,TSI            03076502
*                                                                       03076602
*01 TABLES = N/A                                                        03076702
*                                                                       03082302
*01 MACROS = NONE                                                       03084302
*                                                                       03086302
*01 CHANGE-ACTIVITY                                                     03086403
*        VS2-3.0 CHANGES                                                03086503
*A756974-756979                                                 ZA01520 03086603
*D021000                                                        ZA01520 03086703
*C182000                                                        ZA01520 03087003
*        VS2-030 SERVICE UPDATE                                         03087103
*0000754794-754795                                             @ZA07703 03087203
*                                                                       03087303
*                                                                       03087403
**********************************************************************  03087502
         EJECT                                                          03087602
         ENTRY QTIP0010                                                 03087702
         ENTRY QTIP0230                                                 03087902
         ENTRY QTIP0270                                                 03137902
*                                                                       03193502
*   REGISTER EQUATES                                                    03500002
*                                                                       04200002
RWRK0    EQU   0                        WORK REGISTER                   04900002
RWRK1    EQU   1                        WORK REGISTER                   05600002
RWRK2    EQU   2                        WORK REGISTER                   06300002
RCVT     EQU   3                        CVT POINTER                     07000002
RWRK3    EQU   3                        WORK REGISTER                   07050002
RTCX     EQU   4                        TCX ADDRESS                     07100002
RTCB     EQU   4                        TCB POINTER                     07700002
RWRK4    EQU   4                        WORK REGISTER                   07750002
RWRK5    EQU   5                        WORK REGISTER                   07800002
RASCB    EQU   5                        ASCB POINTER                    08400002
RWRK6    EQU   6                        WORK REGISTER                   08450002
RWRK7    EQU   7                        WORK REGISTER                   08500002
RTIOC    EQU   7                        TIOC POINTER                    09800002
RTSB     EQU   8                        TSB POINTER                     10500002
RWRK8    EQU   8                        WORK REGISTER                   10550002
RWRK9    EQU   9                        WORK REGISTER                   10600002
RCSCB    EQU   9                        CSCB ADDRESS                    10650002
RWRK10   EQU   10                       WORK REGISTER                   11200002
RWRK11   EQU   11                       WORK REGISTER                   11900002
RBASE    EQU   12                       BASE REGISTER                   11950002
RSAVE    EQU   13                       SAVE AREA POINTER               12600002
RLINK    EQU   14                       LINK REGISTER                   13300002
RRMPL    EQU   15                       RMPL POINTER                    14000002
REPA     EQU   15                       ENTRY POINT ADDR                14700002
RCODE    EQU   15                       RETURN CODE REGISTER            14750002
         SPACE 3                                                        14800002
*                                                                       14810002
*        VALUE EQUATES                                                  14850002
*                                                                       14900002
E0       EQU   0                        ZERO                            14950002
E1       EQU   1                        ONE                             15000002
E2       EQU   2                        TWO                             15010002
E4       EQU   4                        FOUR                            15050002
E8       EQU   8                        EIGHT                           15100002
E12      EQU   12                       OFFSET OF 12                    15110002
ALL      EQU   X'FF'                    FLAG FOR NI                     15120002
WAITCODE EQU   4                        IEDAY8 SHOULD WAIT FOR TCAM     15170002
         SPACE 3                                                        15200002
*                                                                       15400002
*   ADDRESSABILITY                                                      16100002
*                                                                       16800002
         DC    C'IEDAY88 '              MODULE I.D.                     17500002
         DC    X'6036'                  DATE - 01/05/76         ZA07703 18200003
QTIP0230 EQU   *                                                        18900002
         USING *,RBASE                  MODULE ADDRESSABLE              19600002
         USING RMPL,RRMPL               RMPL ADDRESSABLE                20300002
         L     RASCB,RMPLASCB           GET ASCB ADDR                   21000002
         USING ASCB,RASCB               ASCB ADDRESSABLE                21700002
         L     RTSB,ASCBTSB             GET TSB ADDR                    22400002
         USING TSB,RTSB                 TSB ADDRESSABLE                 23100002
         L     RCVT,CVTPTR              GET CVT ADDR                    23800002
         USING CVT,RCVT                 CVT ADDRESSABLE                 24500002
         L     RTCX,CVTAQAVT            GET TCX ADDR                    25200002
         USING IEDQTCX,RTCX             TCX ADDRESSABLE                 25900002
         L     RTIOC,TCXRPT             GET TIOCRPT ADDR                26600002
         USING TIOCRPT,RTIOC            TIOCRPT ADDRESSABLE             27300002
*                                                                       28000002
*   IF THE USER HAS HUNG UP, EXIT TO QTIP 14 (IN IEDAYOO) TO            28700002
*   CLEAN UP THE TS CONTROL BLOCKS                                      29400002
*                                                                       30100002
         TM    TSBFLG4,TSBHUNG          HAS USER HUNG UP                30800002
         BNO   NOTHUNG                  NO, DON'T CLEANUP YET           31500002
*                                                                       32200002
*   REGISTERS AT ENTRY TO QTIP 14                                       32900002
*                                                                       33600002
*        08 - TSB ADDR                                                  34300002
*        12 - BASE ADDR OF IEDAYOO                                      35000002
*        14 - RETURN ADDR                                               35700002
*        15 - ADDR OF QTIP 14                                           36400002
*                                                                       37100002
         L     REPA,QTIP14AD            GET EPA OF QTIP 14              37800002
         DROP  RRMPL                    15 NOT RMPL BASE                38500002
         L     RBASE,AYOOBASE           GET BASE ADDR FOR AYOO          39200002
         DROP  RBASE                    BASE REGISTER ALTERED           39900002
         BR    REPA                     EXIT TO QTIP 14                 40600002
*                                                                       41300002
         USING QTIP0230,RBASE           REESTABLISH BASE ADDR           42000002
         USING RMPL,RRMPL               RMPL                            42700002
*                                                                       43400002
*   TERMINAL IS STILL CONNECTED.  CAUSE TSOUTPUT TO PERFORM             44100002
*   CONTROL BLOCK CLEANUP FOR THIS USER AFTER CURRENT OUTPUT            44800002
*   MESSAGES HAVE BEEN SENT.                                            45500002
*                                                                       46200002
NOTHUNG  EQU   *                                                        46900002
         OI    TSBSTAT,TSBDISC          FLAG TERM AS LOGGING OFF        47600002
         TM    RMPLFLG1,RMPLTYPE        IS THIS OUT-OF-CORE ABND        48300002
         BNO   TPOST                    NO, DON'T SET FLAG              49000002
         OI    TSBFLG4,TSBOCAB          HAVE IEDAYO SEND MSG            49700002
*                                                                       50400002
TPOST    EQU   *                                                        51100002
         LM    RWRK0,RWRK1,TSBTPOST     GET TPOST FLAGS                 51800002
RESET    EQU   *                                                        52500002
         LR    RWRK10,RWRK0             COPY TPOST FLAGS                53200002
         LR    RWRK11,RWRK1             COPY TPOST FLAGS                53900002
         O     RWRK11,DISCMASK          REQUEST QCB BIT SETTINGS        54600002
         O     RWRK10,TQCBMASK          REQUEST QCB TPOST               55300002
         CDS   RWRK0,RWRK10,TSBTPOST    UPDATE TPOST FLAGS              56000002
         BNE   RESET                    RETRY UNTIL SUCCESSFUL          56700002
*                                                                       57400002
*   CALL IEDAYTPQ TO TPOST THE TSB TO IEDAYP.                           58100002
*   IEDAYP WILL SET QCBWRBRK, QCBTPUT, AND QCBDISC AND WILL             58800002
*   TPOST THE QCB TO ITSELF.                                            59500002
*   THIS WILL CAUSE TSOUTPUT TO GAIN CONTROL.                           60200002
*   TSOUTPUT WILL THEN PERFORM LOGOFF CLEANUP PROCESSING                60900002
*   AFTER ALL OUTPUT MESSAGES HAVE BEEN SENT TO THE TERMINAL.           61600002
*                                                                       62300002
*   REGISTERS FOR IEDAYTPQ--                                            63000002
*                                                                       63700002
*        00 -- RETURN ADDR.                                             64400002
*        01 -- ZERO, INDICATING REQUEST TO TPOST TSB TO IEDQYP          65100002
*        02 -- TSB ADDR                                                 65800002
*        13 -- SIX WORD SAVE AREA                                       65850002
*        15 -- EPA                                                      66500002
*                                                                       67200002
         LA    RSAVE,TIOCSAVE           GET ADDR OF SAVE AREA           67900002
         SR    RWRK1,RWRK1              REQUEST TPOST OF TSB            68600002
         LR    RWRK2,RTSB               GET TSB ADDR                    69300002
         L     REPA,TPQEPA              GET ADDR OF IEDAYTPQ            70000002
         BALR  RWRK0,REPA               GO TPOST                        70700002
*                                                                       71400002
         LA    REPA,WAITCODE            TELL IEDAY8 TO WAIT             72100002
*                                       FOR TSOUTPUT TO FINISH          72800002
         BR    RLINK                    RETURN                          73500002
*                                                                       74200002
         EJECT                                                          74250002
*********************************************************************** 74300002
*        QTIP0010 IS ENTERED FROM THE LOGON PROMPTER(VIA IEDAYQT). IT * 74350002
*      IS USED TO RECONNECT A DISCONNECTED USER WHO HAS RELOGGED ON   * 74400002
*      WITH THE RECONNECT OPERAND. IT WILL SCAN THE TSB/ASCB/CSCB     * 74450002
*      CHAINS FOR A MATCHING USERID AND PASSWORD, PLUS CHECK IF THE   * 74500002
*      TSBHUNG BIT IS ON INDICATING THIS IS THE "OLD TSB". IT THEN    * 74550002
*      WILL REMOVE ANY WAITS VIA IEDAYQIO, MERGE THE TERMINAL         * 74600002
*      DEPENDENT FIELDS FROM THE "CURRENT OR NEW TSB" INTO THE "OLD   * 74650002
*      TSB", TURN ON TSBNEWID IN THE 'OLD TSB' AND POST IT TO IEDAYP. * 74700002
*         INPUT - REGISTER 4  =TCB ADDRESS                            * 74750002
*                 REGISTER 15 =ADDRESS OF TWO WORD PARAMETER          * 74800002
*                   WORD 1=USERID ADDRESS                             * 74850002
*                   WORD 2=PASSWORD ADDRESS                           * 74860002
*      NOTE - 'NEW TSB' IS THE TSB THE USER CURRENTLY HAS WHEN HE HAS * 74870002
*                       LOGGED ON WITH RECONNECT.                     * 74880002
*             'OLD TSB' IS THE TSB QTIP0010 IS SCANNING FOR, THE ONE  * 74890002
*                       HE WAS DISCONNECTED FROM.                     * 74892002
*********************************************************************** 74894002
QTIP0010 EQU   *                                                        74896002
         USING CSCB,RCSCB               CSCB ADDRESSABILITY             74898002
         MODESET EXTKEY=SUPR            KEY ZERO TO AVOID FETCH YM02856 74898402
*                                       PROTECTION CHK ON PARMS YM02856 74898502
****     FIND CURRENT TSB OF USER RECONNECTING                     **** 74898802
         L     RCVT,PSAAOLD-PSA         GET CURRENT ASCB ADDR           74948802
         L     RWRK1,ASCBTSB-ASCB(,RCVT) 'NEW TSB'                      74969902
         SPACE 1                                                        74979902
****     GET USERID AND PASSWORD ADDRESSES                         **** 74989902
         L     RWRK10,E0(,REPA)         USERID ADDRESS                  74991902
         L     RWRK11,E4(,REPA)         PASSWORD ADDRESS                74993902
         SPACE 1                                                        74995902
****     SET UP FOR TSB/ASCB/CSCB SCAN                             **** 74997902
         L     RCVT,CVTPTR              CVT ADDRESS                     74998302
         L     RCVT,CVTAQAVT-CVT(,RCVT) TCX ADDRESS                     74998702
         L     RTIOC,TCXRPT-IEDQTCX(,RCVT)  TIOCRPT ADDRESS             74999102
         USING TIOCRPT,RTIOC            TIOCRPT ADDRESSABILITY          74999502
         SR    RWRK2,RWRK2              CLEAR WORK REGISTER             74999602
         IC    RWRK2,TIOCTSBS           SIZE OF TSB                     74999702
         LH    RWRK3,TIOCNTSB           NUMBER OF TSBS                  74999802
         BCTR  RWRK3,E0                 DECREMENT BY ONE                75049802
         MR    RWRK2,RWRK2              OFFSET TO LAST TSB              75059802
         L     RTSB,TIOCTSB-E1          START OF TSBS                   75079802
         USING TSB,RTSB                 TSB ADDRESSABILITY              75080202
         LA    RTSB,E0(,RTSB)           ZERO HIGH ORDER BYTE            75080602
         AR    RWRK3,RTSB               ADDR OF LAST TSB                75080702
         SR    RWRK2,RWRK2              ZERO WORK REGISTER              75081002
         IC    RWRK2,TIOCTSBS           SIZE OF TSB                     75081402
         LA    RSAVE,TIOCSAVE           SAVE AREA FOR TPOST             75081802
         SPACE 2                                                        75089802
****     SCAN FOR 'OLD TSB'                                             75091802
SCAN     EQU   *                                                        75093802
         CR    RTSB,RWRK1               IS THIS 'NEW TSB'               75095802
         BE    BUMP                     YES, POINT TO NEXT TSB          75097802
         L     RASCB,TSBASCBA           ASCB OF TSB BEING SCAND         75098202
         LTR   RASCB,RASCB              VALID ASCB ADDRESS      YM04678 75098302
         BZ    BUMP                     NO,CHECK NEXT ONE       YM04678 75098402
         L     RCSCB,ASCBCSCB-ASCB(,RASCB) CSCB CONTAINS USERID         75098602
         USING CSCB,RCSCB               CSCB ADDRESSABILITY             75098802
         CLC   CHKEY,E0(RWRK10)         USERIDS MATCH                   75099002
         DROP  RCSCB                    DROP CSCB BASE REG              75099102
         BE    HUNG                     YES, CHECK FURTHER              75099402
BUMP     EQU   *                                                        75099502
         BXLE  RTSB,RWRK2,SCAN          POINT TO NEXT TSB & CHK         75099602
****     NO MATCHING USERID, ERROR, RETURN                         **** 75099702
         LA    RCODE,E8                 RETURN CODE = 8                 75149702
         LA    RWRK0,E0                 USERID NOT FOUND                75159702
         BR    RLINK                    RETURN TO CALLER                75169702
         SPACE 1                                                        75179702
HUNG     EQU   *                                                        75189702
         TM    TSBFLG4,TSBHUNG          IS THIS THE OLD TSB             75191702
         BNO   ERROR1                   NO,ERROR                        75193702
         CLC   TSBPSWD,E0(RWRK11)       PASSWORDS MATCH                 75195702
         BNE   ERROR2                   NO, ERROR                       75197702
         SPACE 1                                                        75198102
         MODESET EXTKEY=TCAM            CHANGE TSBS IN KEY 6    YM02856 75198202
****     START RECONNECT PROCESS HERE                              **** 75198502
         OI    TSBFLG4-TSB(RWRK1),TSBHUNG SET TSBHUNG IN NEW TSB        75198902
         NI    TSBFLG4,ALL-TSBHUNG      TURN OFF TSBHUNG IN OLD         75199302
         SPACE 1                                                        75199402
****     CHECK IF OLD TSB HAS ANY IWAIT OR OWAIT OUTSTANDING       **** 75199502
         TM    TSBFLG4,TSBIWAIT+TSBOWAIT ANY WAITS IN PROGRESS          75199602
         BZ    TERM                     NO,CONTINUE RECONNECT           75249602
         SPACE 1                                                        75259602
*********************************************************************** 75269602
*        BRANCH TO IEDAYQIO TO REMOVE USER IWAIT OR OWAIT             * 75279602
*          INPUT TO IEDAYQIO = REGS 15 - 2 WORK REGS                  * 75289602
*                              REG  4      RETURN ADDRESS             * 75291602
*                              REG  8      TSB ADDRESS                * 75293602
*                              REG  12     BASE ADDRESS               * 75295602
*          NOTE: REG 8 IS RTSB WHICH CONTAINS 'OLD TSB'               * 75297602
*********************************************************************** 75298002
         LR    RWRK3,RWRK1              SAVE 'NEW TSB ADDRESS           75298402
         LR    RWRK7,RBASE              SAVE BASE ADDRESS               75298802
         L     REPA,QIO                 ENTRY POINT TO IEDAYQIO         75298902
         L     RBASE,QIOBASE            BASE ADDR FOR IEDAYQIO          75299202
         DROP  RBASE                    DROP BASE ADDRESSABILITY        75299302
         BALR  RWRK4,REPA               BR TO IEDAYQIO                  75299402
         XI    TSBFLG2,TSBBIPI          INDICATE TO REMOVE OTHER WAIT   75316102
         USING QTIP0230,RWRK7           RESET ADDRESSABILITY            75318102
         L     REPA,QIO                 ENTRY POINT TO IEDAYQIO         75326102
         BALR  RWRK4,REPA               BR TO IEDAYQIO                  75328102
         DROP  RWRK7                    USE NORMAL BASE REG             75328502
         USING QTIP0230,RBASE           REESTABLISH ADDRESSABILITY      75328902
         XI    TSBFLG2,TSBBIPI          RESTORE ORIGINAL STATE          75330102
         LR    RBASE,RWRK7              RESTORE BASE ADDR               75332802
         LR    RWRK1,RWRK3              RESTORE 'NEW TSB' ADDRESS       75342802
         SPACE 1                                                        75349502
TERM     EQU   *                                                        75359502
****     MERGE TERMINAL DEPENDENT FIELDS FROM 'NEW TSB' TO 'OLD    **** 75369502
****       TSB' IN CASE USER HAS RECONNECTED ON A DIFFERENT TYPE   **** 75379502
****       TERMINAL. old tsb has addressability.                   **** 75389502
         TM    TSBSTAT-TSB(RWRK1),TSBDSPLY   NEW TSB A DISPLAY          75391502
         BZ    OFFDSPLY                 NO,INDICATE NO DISPLAY          75393502
         OI    TSBSTAT,TSBDSPLY         INDICATE A DISPLAY              75395502
         B     T3270                    TEST FOR 3270                   75397502
OFFDSPLY EQU   *                                                        75397902
         NI    TSBSTAT,ALL-TSBDSPLY     TURN OFF DISPLAY BIT            75398302
T3270    EQU   *                                                        75398702
         TM    TSBSTAT-TSB(RWRK1),TSB3270  NEW TSB A 3270               75399102
         BZ    NO3270                   NO,SHOW NO 3270                 75399202
         OI    TSBSTAT,TSB3270          INDICATE 3270 TERM              75399302
         B     LINSZE                   MOVE IN LINE SIZE               75399402
NO3270   EQU   *                                                        75449402
         NI    TSBSTAT,ALL-TSB3270      TURN OFF 3270 BIT               75459402
LINSZE   EQU   *                                                        75469402
         MVC   TSBLNSZ(E8),TSBLNSZ-TSB(RWRK1)  PHYSICAL LINE   @ZA07703 75479403
*                           SIZE AND OUTPUT BUFFER QUEUES      @ZA07703 75484403
         TM    TSBFLG3-TSB(RWRK1),TSBNOBRK BREAK FEATURE ALLOWD         75489402
         BZ    BRK                      YES,TURN BIT OFF                75491402
         OI    TSBFLG3,TSBNOBRK         BREAK NOT ALLOWED               75493402
         B     TERMCHAR                 COPY TERMINAL CHAR.             75495402
BRK      EQU   *                                                        75497402
         NI    TSBFLG3,ALL-TSBNOBRK     INDICATE BREAK ALLOWED          75497802
TERMCHAR EQU   *                                                        75498202
         MVC   TSBTERMC(E2),TSBTERMC-TSB(RWRK1) TERMINAL CHARS.         75498602
         MVC   TSBLNNO(E1),TSBLNNO-TSB(RWRK1)  # LINES ON SCREEN        75499002
         MVC   TSBASRCE(E2),TSBASRCE-TSB(RWRK1) TCAM TERM INDEX         75499102
         MVC   TSBLINE(E2),TSBLINE-TSB(RWRK1)  LINE ADDR OR 3705 ID     75499202
         SPACE 2                                                        75499302
*********************************************************************** 75532802
*        TURN ON TSBNEWID TO INDICATE TO IEDAYP THAT THE NEW QCBTJID  * 75542802
*           FIELD MUST BE UPDATED WITH THE OLD ASID(TJID).            * 75552802
*********************************************************************** 75562802
         LM    RWRK4,RWRK5,TSBTPOST     CONTENTS OF TSBTPOST            75564802
RETRY    EQU   *                                                        75565202
         LR    RWRK6,RWRK4              1ST WORD OF TSBTPOST            75565602
         LR    RWRK7,RWRK5              2ND WORD OF TSBTPOST            75566002
         O     RWRK6,TPMSK              TELL IEDAYP TO UPDATE QCBTJID   75566402
         TM    TSBFLG3,TSBTPUT          WAS A TPUT IN PROGRESS          75576402
         BZ    SWAP                     NO                              75586402
         O     RWRK6,TQCBMASK           TPOST QCB                       75586802
         O     RWRK7,TPQCBMSK           TURN ON QCBTPUT                 75587202
SWAP     EQU   *                                                        75587602
         CDS   RWRK4,RWRK6,TSBTPOST     STORE IN NEW TSBPOST            75588402
         BNE   RETRY                    FIELDS NOT EQUAL RETRY          75588502
         SR    RWRK1,RWRK1              INDICATE TSB TO TPOST           75589402
         ST    RWRK1,TSBMINL            ZERO RECONNECT LIMIT            75591402
         LTR   RWRK4,RWRK4              IS POST OUTSTANDING             75591902
         BM    RETURN                   YES,RETURN TO CALLER            75592802
         SPACE 2                                                        75593702
*********************************************************************** 75594602
*        CALL IEDAYTPQ TO TPOST THE TSB TO IEDAYP                     * 75595502
*          INPUT REGISTERS = REG  0 - RETURN ADDRESS                  * 75596402
*                            REG  1 - ZERO,INDICATING TPOST TSB TO AYP* 75596802
*                            REG  2 - TSB ADDRESS                     * 75597302
*                            REG 13 - SIX WORD SAVE AREA              * 75598202
*                            REG 15 - ENTRY POINT                     * 75599102
*********************************************************************** 75600002
         LR    RWRK2,RTSB               ADDRESS OF TSB                  75656202
         L     REPA,TPQEPA              ENTRY POINT ADDR                75666202
         BALR  RWRK0,REPA               TPOST TSB VIA IEDAYQTP          75676202
RETURN   EQU   *                                                        75678202
         LA    RCODE,E0                 RETURN CODE ZERO                75678602
         BR    RLINK                    RETURN TO CALLER                75679002
         SPACE 1                                                        75679402
ERROR1   EQU   *                                                        75679802
         LA    RCODE,E8                 USERID UNAVAILABLE              75679902
         LA    RWRK0,E4                 USERID IN USE                   75680002
         BR    RLINK                    RETURN TO CALLER                75680102
         SPACE 1                                                        75680402
ERROR2   EQU   *                                                        75687102
         LA    RCODE,E4                 PASSWORD UNEQUAL                75687202
         BR    RLINK                    RETURN TO CALLER                75687302
         EJECT                                                          75687402
*********************************************************************** 75687502
*        QTIP0270 IS USED TO CANCEL A DISCONNECTED USER WHOSE         * 75687802
*         RECONNECT PERIOD HAS EXPIRED,OR DECREMENT BY 1 MINUTE THE   * 75688102
*         TIME THAT IS LEFT.                                          * 75688402
*          INPUT: REGISTER 15 = TIOCRPT ADDRESS                       * 75688702
*********************************************************************** 75689002
QTIP0270 EQU   *                                                        75689302
         SR    RWRK10,RWRK10            ZERO WORK REGISTER              75689602
         LR    RTIOC,REPA               TIOCRPT ADDRESS                 75689902
         USING TIOCRPT,RTIOC            TIOCRPT ADDRESSABILITY          75690202
         SR    RWRK2,RWRK2              ZERO WORK REGISTER              75690802
         IC    RWRK2,TIOCTSBS           SIZE OF TSB                     75691102
         LH    RWRK3,TIOCNTSB           NUMBER OF TSBS                  75691402
         BCTR  RWRK3,E0                 ADJUST FOR OFFSET               75691702
         MR    RWRK2,RWRK2              OFFSET TO LAST TSB              75692002
         L     RTSB,TIOCTSB-E1          START OF TSBS                   75692602
         LA    RTSB,E0(,RTSB)           CLEAR HIGH ORDER BYTE           75692702
         AR    RWRK3,RTSB               ADDR OF LAST TSB                75693402
         SR    RWRK2,RWRK2              ZERO WORK REGISTER              75695202
         IC    RWRK2,TIOCTSBS           SIZE OF TSB                     75695902
         USING TSB,RTSB                 TSB ADDRESSABILITY              75696602
NEXTTSB  EQU   *                                                        75697302
         L     RWRK5,TSBASCBA           LOAD ADR OF ASCB        ZA01520 75697403
         LA    RWRK5,0(,RWRK5)          CLEAR HIGH ORDER BYTE   ZA01520 75697503
         LTR   RWRK5,RWRK5              DOES ASCB EXIST?        ZA01520 75697603
         BZ    NEXT                     NO,CHECK NEXT TSB       ZA01520 75697903
         TM    TSBFLG4,TSBHUNG          IS USER DISCONNECTED            75700202
         BNO   NEXT                     NO,CHECK NEXT TSB               75701202
         L     RWRK5,TSBMINL            RECONNECT TIME LIMIT            75702202
         LTR   RWRK5,RWRK5              RECONNECT TIME EXPIRED          75703202
         BNP   NEXT                     YES,CHECK NEXT TSB              75704202
         BCTR  RWRK5,E0                 DECREMENT BY 1 MINUTE           75705202
         ST    RWRK5,TSBMINL            SAVE NEW TIME LIMIT             75706202
         LTR   RWRK5,RWRK5              RECONNECT TIME EXPIRED NOW      75707202
         BZ    CANCEL                   YES,CANCEL USER                 75708202
         BCTR  RWRK10,E0                INDICATE RECONNECT PERIOD LEFT  75709202
NEXT     EQU   *                                                        75710202
         BXLE  RTSB,RWRK2,NEXTTSB       CHECK NEXT TSB                  75711202
         LTR   RWRK10,RWRK10            RECONNECT PERIOD OUTSTANDING    75712202
         BZ    RC4                      NO,RETURN CODE 4                75713202
         LA    RCODE,E0                 RETURN CODE OF 0                75714202
         BR    RLINK                    RETURN TO CALLER                75715202
RC4      EQU   *                                                        75716202
         XC    TIOCTECB(E4),TIOCTECB    CLEAR ECB                       75717202
         LA    RCODE,E4                 RETURN CODE OF 4                75718202
         BR    RLINK                    RETURN TO CALLER                75719202
         SPACE 3                                                        75720202
CANCEL   EQU   *                                                        75721202
*********************************************************************** 75722202
*        CANCEL USER WITH 622 ABEND WHEN RECONNECT PERIOD HAS         * 75723202
*         EXPIRED.                                                    * 75724202
*          REGISTER INPUT TO SYSTEM INITIATED CANCEL(SIC)             * 75725202
*            0 = POST CODE (622 ABEND)                                * 75726202
*            1 = ASCB ADDRESS                                         * 75727202
*           13 = SAVEAREA ADDRESS                                     * 75728202
*           14 = RETURN ADDRESS                                       * 75729202
*           15 = ENTRY POINT TO SIC                                   * 75730202
*********************************************************************** 75731202
         L     RWRK0,SICODE             622 ABEND CODE                  75732202
         L     RWRK1,TSBASCBA           ASCB ADDRESS                    75733202
         LA    RSAVE,TIOCSAVE           SAVE AREA ADDRESS               75734202
         LR    RWRK5,RLINK              SAVE RETURN ADDDRESS            75735202
         L     RLINK,CVTPTR             ADDRESS OF CVT                  75736202
         USING CVT,RLINK                CVT ADDRESSABILITY              75737202
         L     REPA,CVTSIC              ENTRY TO SIC                    75738202
         MODESET EXTKEY=SUPR            SUPERVISOR KEY FOR SIC          75739202
         DROP  RLINK                                                    75740202
         BALR  RLINK,REPA               GO SIC'M                        75741202
         MODESET EXTKEY=TCAM            BACK TO TCAMS KEY               75742202
         LR    RLINK,RWRK5              RESTORE RETURN ADDRESS          75743202
         B     NEXT                     CHECK NEXT TSB                  75744202
*   CONSTANTS                                                           75745202
*                                                                       75746202
TPQEPA   DC    V(IEDAYTPQ)              ADDR OF IEDAYTPQ                77000002
TQCBMASK DC    AL1(TSBTPQCB,0,0,0)      REQUEST QCB TPOST               77700002
DISCMASK DC    AL1(0,0)                 DON'T ALTER QCBTSOF2            78400002
         DC    AL1(QCBTPUT+QCBWRBRK+QCBDISC) MASK BYTE                  79100002
         DC    AL1(QCBTPUT+QCBWRBRK+QCBDISC) VALUE BYTE                 79800002
QTIP14AD DC    V(QTIP0140)              ADDR OF QTIP 14                 80500002
AYOOBASE DS    0A                       BASE ADDR OF QTIP 14            81200002
QIOBASE  DC    V(QTIP0110)              BASE ADDR FOR IEDAYQIO          81210002
QIO      DC    V(IEDAYQIO)              ENTRY POINT                     81220002
TPMSK    DC    AL1(TSBNEWID,0,0,0)      .TELL IEDAYP TO UPDATE QCBTJID  81230002
TPQCBMSK DC    AL1(0,0,QCBTPUT,QCBTPUT) TURN ON QCBTPUT                 81242002
SICODE   DS    0F                                                       81246002
         DC    XL4'00000622'            622 ABEND FOR SIC               81248002
PATCH    DC   16F'0'                    PATCH SPACE                     81250002
         EJECT                                                          81900002
         IHAASCB                                                        82600002
         EJECT                                                          83300002
CVT      DSECT                                                          84000002
         CVT                                                            84700002
         EJECT                                                          85400002
         TQCBD                                                          86100002
         EJECT                                                          86800002
         IHARMPL                                                        87500002
         EJECT                                                          88200002
         TTCXD                                                          88900002
         EJECT                                                          89600002
         IKJTIOCP                                                       90300002
         EJECT                                                          91000002
         IKJTSB                                                         91700002
         EJECT                                                          91750002
CSCB     DSECT                                                          91760002
         IEECHAIN                                                       91800002
         IKJTCB                                                         92000002
         EJECT                                                          92050002
         IHAPSA                                                         92100002
         END                                                            92400002
./  ADD  SSI=72410256,NAME=IGG09301
         TITLE 'IGG09301 - SECOND LOAD OF TPUT'                         00100020
IGG09301 CSECT                                                          00150002
*                                                                     * 00200020
*            VS2 3.7                                                    00200103
*  C 535560,535630                                              ZA16599 00200203
*  C 301842-301942,305877-305926,305942,305944,307000           ZA14769 00200303
*  C 308000-309000  D 313000-319000                             ZA14769 00200403
*0000227500,305886,305843                                      @ZA08262 00200503
*0000522354                                                    @ZA03182 00200603
*0000680520                                                    @ZA03945 00200703
*0000535010-535120                                             @ZA02244 00200803
*                                                                       00200903
*                                                                       00201003
*    RELEASE VS2-3.0 ACTIVITY                                         * 00201103
*D001760                                                        ZA02097 00201203
*C227500,238900                                                 ZA02097 00201303
*                                                                     * 00201603
*    RELEASE VS/2-2 ACTIVITY                                          * 00202002
*                                       02/19/73                VS00022 00202102
*                                       03/24/73                YM01564 00208202
*                                       05/30/73                YM01246 00210202
*                                       07/03/73                YM01114 00212202
*                                       07/16/73                YM01176 00214202
*                                       10/11/73                YM03998 00214302
*                                       11/15/73                YM05387 00214402
*                                       04/11/74                YM08378 00214502
*                                                                     * 00214602
*D500000                                                         YM3028 00220702
*D272800-294000,299700-300000                                    YM0895 00226802
*1301                                                            M0126  00232902
*                                                                S21A12 00239002
*1301182000-185000,193000-208000,227300-227600,229000,234000-    M0094  00245102
*1301235000,257000,271500-275000,293000,326000,335000,346750-    M0094  00251202
*1301346800,348600-349200,353000,378000-384000,418000,422000,    M0094  00257302
*1301449000,462000-462500,496000,500000,509000-512000,521000,    M0094  00263402
*1301529000,538000,544200-544300,545300-546300,548000,571000,    M0094  00269502
*1301577000-578000,581000,582000,587000,590000,605000,631000,    M0094  00275602
*1301674000,676300,722000                                        M0094  00281702
*1301349000,546000,706000-707000                                 S21008 00287802
*                                                                M2152  00293902
*0000455100-456000,547800                                        M0019  00300020
*0000158100,158700,382200                                        TS1635 00400020
*                                                                M0661  00500020
*                                                                M3391  00550020
*                                                                 M3807 00570020
*                                                                 M3830 00580020
*                                                                M4395  00590020
*                                                                 M5113 00592020
*                                                                 M4415 00595020
*0000530000                                                      M3830  00597020
*                                                                M6024  00598020
*1301722620                                                      S22028 00618002
*                                                                       00628003
* STATUS -                                                            * 00648003
*           VS2    3.0  SU                                     @ZA02244 00698003
*                                                                     * 00700020
* FUNCTION -                                                          * 00830020
*                                                                     * 00900020
*   PUT OUTPUT FROM USER'S BUFFER INTO TSO BUFFERS FOR LATER          * 01000020
*   TRANSFERENCE, VIA TCAM, TO A TERMINAL.                            * 01100020
*                                                                     * 01200020
*   PROVIDE LIMITED EDITING OPTIONS                                   * 01300020
*                                                                     * 01400020
*                                                                     * 01500020
* ENTRY POINTS -                                                      * 01600002
*                                                                     * 01700020
*   IGG09301 - ENTRY FROM FIRST LOAD OF TERMINAL I/O SVC              * 01800020
*              ROUTINES (IGC0009C) VIA BRANCH                         * 01900002
*                                                                     * 02000020
* INPUT -                                                             * 02100002
*                                                                     * 02200020
*********************************************************************** 02300020
***                                                                 *** 02400020
***                 REGISTER CONTENTS UPON ENTRY                    *** 02500020
***      3 - CVT POINTER      8 - ASCB POINTER                      *** 02540002
***      4 - TCB POINTER      9 - TSB POINTER       12 - TJID       *** 02800020
***      5 - SVRB POINTER    10 - TIOCRPT POINTER                   *** 02900020
***                                                                 *** 03000020
***                                                                 *** 03200020
*********************************************************************** 03300020
         SPACE 2                                                        03400020
* OUTPUT -                                                            * 04800002
*                                                                     * 04900020
*   RETURN CODE IN REG15                                              * 05000020
*              00 - SUCCESSFUL                                        * 05100020
*              04 - NOWAIT SPECIFIED AND NO BFRS AVAILABLE            * 05200020
*              08 - ATTN OCCURED DURING SVC EXECUTION                 * 05300020
*              10   INVALID PARAMETERS SPECIFIED                      * 05400020
*              14 - USER HAS HUNG UP                                    05500020
*                                                                     * 05600020
* EXTERNAL REFERENCES -                                                 05700020
*                                                                     * 05800020
*         OPTIMIZER (VIA SYSEVENT MACRO)                              * 05820002
*         SETLOCK                                                     * 05830002
*         POST (VIA BRANCH ENTRY AT CVTOPT01)                         * 05840002
*                                                                     * 06200020
* EXITS,NORMAL -                                                      * 06300020
*                                                                     * 06400020
*    BR 14, WITH RETURN CODES AS ABOVE                                * 06440002
*                                                                     * 06560020
* EXITS,ERROR -                                                       * 06620020
*                                                                     * 06700020
*   THERE ARE NO ERROR EXITS FROM THIS ROUTINE.                       * 06800020
*                                                                     * 06900020
* TABLES/WORKAREAS -                                                  * 07000020
*                                                                     * 07100020
*   ALL TABLES AND WORK AREAS ARE DESCRIBED BY                        * 07200000
*   DSECTS AT THE END OF THE LISTING .                                * 11100020
*                                                                     * 11200020
* ATTRIBUTES -                                                        * 11300002
*                                                                     * 11400020
*   REENTRANT, ENABLED, PRIVILEGED, LOCAL LOCK IS HELD AT ENTRANCE,   * 11500002
*   CMS LOCK IS OBTAINED EXPLICITLY, KEY ZERO.                        * 11550002
*                                                                     * 11600020
* CHARACTER CODE DEPENDENCY -                                         * 11700020
*                                                                     * 11800020
*    THE OPERATION OF THIS MODULE DEPENDS UPON THE FOLLOWING          * 11900003
*    PROPERTIES OF THE INTERNAL REPRESENTATION OF THE EXTERNAL        * 12000003
*    CHARACTER SET- BACKSPACE EQUAL TO X'16', BLANK EQUAL TO          * 12100003
*    X'40', NEW LINE EQUAL X'15'.                                     * 12200020
*    THE SPECIFIC INSTRUCTIONS WHICH REQUIRE MODIFICATION IF          * 12300003
*    THESE PROPERTIES OF THE CHARACTER SET ARE CHANGED MAY BE         * 12400003
*    IDENTIFIED BY - BLANK, BKSPCHR, AND NEWLINE, RESPECTIVELY.       * 12500020
*                                                                     * 12600020
* NOTES -                                                             * 12700020
*                                                                     * 12800020
*    NONE                                                             * 12900020
*                                                                     * 13000020
*********************************************************************** 13100020
         EJECT                                                          13200020
*********************************************************************** 13400020
*****                                                             ***** 13500020
*****               REGISTER EQUATES                              ***** 13600020
*****                                                             ***** 13700020
*********************************************************************** 13800020
         SPACE                                                          13900020
R0       EQU   0                        USED TO SPEED ASSEMBLY          14000020
RSAVE    EQU   0                        WORK REGISTER                   14100020
RWRK2    EQU   1                        WORK REGISTER                   14200020
RBUF     EQU   2                        POINTER TO TS BUFFER            14300020
RCVT     EQU   3                        POINTER TO CVT                  14400020
RTCB     EQU   4                        POINTER TO TCB                  14500020
RSVRB    EQU   5                        POINTER TO SVRB                 14600020
RBASE    EQU   6                        BASE REGISTER                   14700020
RTCX     EQU   7                        TCX POINTER             YS02019 14720002
RASCB    EQU   8                        ASCB POINTER            YS02019 14730002
RTSB     EQU   9                        POINTER TO TSB                  15000020
RRPT     EQU   10                       POINTER TO TIOCRPT              15100020
RECB     EQU   11                       ADDR OF ECB TO BE POSTED        15300020
RTJID    EQU   12                       TJID                            15400020
RAVT     EQU   13                       POINTER TO AVT                  15500020
RETURN   EQU   14                       RETURN ADDRESS                  15600020
RWRK     EQU   14                       WORK REGISTER                   15700020
RWRK1    EQU   15                       WORK REGISTER                   15800020
RCODE    EQU   15                       RETURN CODE                     15900020
RGO      EQU   15                       BRANCH ADDRESS                  16000020
         SPACE 2                                                        16100020
***                                                                     16200020
***                 CONSTANTS                                           16300020
***                                                                     16400020
K0       EQU   0                        OFFSET                          16500020
K1       EQU   1                        OFFSET AND SIZE                 16600020
K2       EQU   2                        OFFSET AND SIZE                 16700020
K3       EQU   3                        OFFSET AND SIZE                 16800020
K4       EQU   4                        OFFSET AND SIZE                 16900020
K5       EQU   5                        OFFSET                          17000020
K8       EQU   8                        OFFSET                          17100020
K16      EQU   16                       SHIFT CONSTANT                  17200020
SDTCB    EQU   15                       ENTRY CODE FOR STATUS   YS02019 17250002
***                                                                     17300020
***                 RETURN CODES                                        17400020
***                                                                     17500020
RC04     EQU   X'04'                    NOWAIT AND NO BUFFERS           17600020
RC08     EQU   X'08'                    ATTENTION HIT                   17700020
RC10     EQU   X'10'                    INVALID PARAMETER               17750002
RC14     EQU   X'14'                    DISCONNECTED                    17800020
***                                                                     17900020
***                 MASKS                                               18000020
***                                                                     18100020
NDISPBIT EQU   X'400'                   MASK FOR 'STATUS'       YS02019 18550002
ECBWAIT  EQU   X'80'                    ECB WAITING                     18600020
BYPASS   EQU   X'24'                    BYPASS CHAR            @ZA02244 18650003
OFF      EQU   X'FF'                    TO TURN OFF SELECTED BIT        18700020
ON       EQU  1                         FOR BCR INSTRUCTIONS    YS02019 18750002
***                                                                     18800020
***                 OTHER EQUATES                                       18900020
***                                                                     19000020
BKSPCHAR EQU   X'16'                    BACKSPACE CHARACTER             19100020
BLANK    EQU   X'40'                    BLANK CHARACTER                 19200020
RGOTO    EQU   15                       ENTRY POINT                     21100020
MOVECODE EQU   19                       QTIP ENTRY CODE FOR MOVE        21200020
SEVEN    EQU   7                        MASK USED IN STCM        Y01018 21210002
STEPSD   EQU   8                        ENTRY CODE FOR 'STATUS' YS02019 21230002
         EJECT                                                          21400020
*                                                                       21410002
*********************************************************************** 21450002
*                                                                       21452002
*        THIS MODULE IS BRANCH ENTERED FROM IGC0009C HOLDING THE        21460002
*        LOCAL LOCK                                                     21470002
*                                                                       21480002
*********************************************************************** 21490002
*                                                                       21492002
         BALR  RBASE,R0                 SET BASE REGISTER               21500020
         USING *,RBASE                  ADDRESSABILITY          YS02019 21600002
         SPACE 2                                                        21700020
         USING CVT,RCVT                                                 21800020
         USING TCB,RTCB                                                 21900020
         USING ASCB,RASCB                                       YS02019 21920002
         USING TSB,RTSB                                         YS02019 21930002
         USING TIOCRPT,RRPT                                     YS02019 21940002
         USING RBSECT,RSVRB                                      M0094  22350021
         SPACE 3                                                        22400020
***                                                                     22500020
***                INITIALIZE                                           22600020
***                                                                     22700020
         MVC   XSAF,XSAFLAG             INIT FLAGS               M0094  22730021
         B     TPT0050                  BRANCH AROUND ID         Y01018 22740000
         DC    C'IGG09301'              MODULE IDENTIFIER        Y01018 22745000
         DC    X'6007'                  DATE - 01/07/76        @ZA08262 22750003
TPT0050  EQU   *                                                 Y01018 22755000
         STH   RTJID,XSATJID            SAVE CALLER'S TJID       M0094  22760021
         SR    RBUF,RBUF                                                22800020
         LR    RCODE,RBUF               SET RETURN CODE TO ZERO         22850002
         CH    RBUF,XSAPRMSZ            IS USER SIZE ZERO        M0094  23050021
         BE    TPT9750                  RETURN TO CALLER                23300020
         STH   RBUF,XSAPRMTJ            ZERO DESTINATION TJID    M0094  23400021
*                                       SO GP DOESN'T SET BUFF-         23500021
*                                       TJID                            23600021
         SPACE 2                                                        23800020
         LH    RWRK1,XSAPRMSZ           GET USER SPECD SIZE      M0094  23850000
         L     RWRK,XSAPRM1             GET PTR TO USER AREA     M0094  23860000
         LA    RWRK,0(,RWRK)            CLEAR HI-ORDER BYTE      M0094  23870000
         OI    XSAF,XSADMOVE+XSAAUTH    SHOW DATA MOVEMENT,     YM05387 23872002
*                                       TELL GP NOT TO ADD '+'  YM05387 23874002
         TM    XSAOPTNS,MCNTRL+MASIS    OTHER THAN EDIT          M0094  23880000
         BNZ   TPT0390                  IF ASIS OR CONTROL      ZA02097 23890003
         SPACE 2                                                        23892000
***                                                                     23894000
***                 REMOVE TRAILING BLANKS                              23896000
***                                                                     23898000
         AR    RWRK,RWRK1               PTR TO END OF BFR + ONE         23898400
         SPACE                                                          23898800
TPT0300  EQU   *                                                        23899200
         BCTR  RWRK,R0                  ADJUST BUFFER POINTER           23899600
         CLI   K0(RWRK),BLANK           IS CHARACTER A BLANK            23899700
         BNE   TPT0350                  IF NON-BLANK                    23899800
         BCT   RWRK1,TPT0300            SUBTRACT 1 FROM BUFFER  YS02019 23899902
*                                       SIZE, BRANCH IF NOT 0   YS02019 23909902
         B     TPT7500                  SIZE IS NOW 0, MSG MUST YS02019 23919902
*                                       HAVE BEEN ALL BALNKS    YS02019 23929902
         SPACE 2                                                        23963200
TPT0350  EQU   *                                                        23965200
         STH   RWRK1,XSAPRMSZ           STORE UPDATED SIZE       M0094  23965600
         SPACE 2                                                 Y01018 23966000
TPT0390  EQU   *                                                 Y01018 23966400
         STH   RWRK1,XSAUBFRS           STORE STARTING SIZE      Y01018 23966500
         L     RWRK1,XSAPRM1            GET STARTING ADDRESS    YS02019 23966602
         ST    RWRK1,XSAUBFRP           STORE IT                YS02019 23976602
         SPACE 2                                                        23977700
***                                                                     24000020
***                 CHECK FOR OWAIT IN PROGRESS                         24100020
***                                                                     24200020
*                                       SERIALIZE TSB CHANGES   YS02019 24216002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*24224002
               RELATED=(TSB,IGG09301(TPT9700))                  YS02019 24274002
         SPACE 1                                                YM01176 24324002
TPT0100  EQU   *                                                YM01176 24374002
         BAL   RBUF,TPT8400             GO CHECK TERMINAL STATUS        24600020
         TM    TSBFLG1,TSBOWIP          IS OWAIT IN PROGRESS            25000020
         BZ    TPT0200                  IF NOT                          25100020
         SPACE 2                                                        25200020
*****                                                                   25300020
*****               SET UP FOR OWAIT SUBROUTINE                         25400020
*****                                                                   25500020
TPT0150  EQU   *                                                        25600020
         TM    XSAOPTNS,MWAIT           WAS WAIT SPECIFIED (0)   M0094  25700021
         BO    TPT8000                  IF NOT                          25800020
         OI    TSBFLG1,TSBWOWIP         WAITING ON OWAIT INDR           25900020
         BAL   RBUF,TPT6000             GO TO OWAIT SUBROUTINE          26000020
         SPACE 2                                                        26100020
***                                                                     26200020
***                 UPON RETURN FROM OWAIT SUBROUTINE                   26300020
***                                                                     26400020
         SPACE                                                          26500020
         B     TPT0100                  CHECK AGAIN                     26600020
         SPACE 2                                                        26700020
TPT0200  EQU   *                                                        26800020
         NI    TSBFLG1,OFF-TSBWOWIP     TURN OFF WAITING ON             26900020
*                                       OWAIT IN PROGRESS               27000020
         OI    TSBFLG1,TSBOWIP          INDICATE OWAIT                  27100020
         ST    RTCB,TSBCTCB             STORE CURRENT TCB ADDRESS       27120020
         OI    XSAF,OSW                 INDICATE WE SET TSBOWIP  M0094  27200021
***                                                                     29500020
***                 CHECK FOR BFR ELIGIBILITY AND AVAIALABILITY         29600020
***                                                                     29700020
TPT0400  EQU   *                                                        29800020
         TM    TSBFLG4,TSBHUNG          IS TERMINAL DISC'TED    YM01176 29802002
         BO    TPT0470                  YES GO ENTER OWAIT      YM01176 29802802
         BAL   RBUF,TPT8400             GO CHECK TERMINAL STAT  YS02019 29804002
         CLC   TIOCNFBF(K2),TIOCUSLW ANY FREE BFR?              ZA14769 30184203
         BL    TPT0425               NO, SET SYSTEM FLAG        ZA14769 30264203
         SPACE 3                                                SA60002 30350002
***                                                                     30400002
*** FOR FULL-SCREEN OPTION, ENTIRE MESSAGE MUST GO THROUGH, WITH        30450002
***  NO OWAIT.  THEREFORE, CALCULATE HOW MANY BUFFERS MESSAGE WILL      30460002
***  REQUIRE, AND WAIT UNTIL THAT MANY ARE AVAILABLE.                   30470002
***                                                                     30480002
         TM    XSAOPTNS,MASIS+MCNTRL    FULL SCREEN OPTION      SA60002 30482002
         BNO   TPT0423                  NO, BYPASS CALCULATION  SA60002 30484002
         SR    RWRK,RWRK                CLEAR FOR DIVIDE        SA60002 30490002
         LH    RWRK1,XSAPRMSZ           GET LENGTH OF MSG       SA60002 30492002
         LA    RWRK1,BUFFHDLN-BUFFTRLN(,RWRK1) ADD EXTRA FOR    SA60002 30494002
*                                              HEADER PREFIX    SA60002 30496002
         LA    R0,BUFFTRLN              GET LENGTH OF TRLR PRF  SA60002 30498002
         SH    R0,TIOCBFSZ              WHAT'S LEFT OVER (COMP) SA60002 30498402
         LPR   R0,R0                    GET BUFSIZE-TRLR PREF   SA60002 30498802
***                                                                     30499202
*** R0 = AMOUNT OF ROOM IN EACH BUFFER FOR REAL DATA                    30499602
*** R15 AND R15 = AMOUNT OF DATA THAT MUST GO INTO BUFFERS              30499702
***                                                                     30499802
         DR    RWRK,R0                  GET NO OF BFRS REQD     SA60002 30499902
         LA    RWRK1,1(,RWRK1)          ADD 1 FOR POSSIBLE      SA60002 30533202
*                                       REMAINDER               SA60002 30543202
         SPACE 3                                                        30553202
***                                                                     30563202
*** RWRK1 NOW CONTAINS NUMBER OF BFRS MSG WILL REQUIRE.                 30565202
*** MESSAGE CAN PROCEED IF                                              30565602
***     1.  RWRK1 LTE TIOCNFBF, AND                                     30566002
***     2.  RWRK1+TSBNOBF LTE TIOCAOMX                                  30566402
***                                                                     30566502
         CH    RWRK1,TIOCAOMX        EVER POSSIBLE TO GET BFRS? ZA14769 30587703
         BH    TPT6800               NO, INV. PARM              ZA14769 30588403
         LH    RWRK2,TIOCNFBF      GET NO. OF FREE BFR          ZA14769 30589103
         SH    RWRK2,TIOCUSLW      ALLOW RESERVE LEVEL          ZA14769 30589803
         CR    RWRK1,RWRK2         ENOUGH FREE BFRS?            ZA14769 30590503
         BH    TPT0427             NO, GHECK FLAG SETTING       ZA14769 30591203
         CLI   TSBNOBF,K0          ANY ON OUTPUT QUEUE?         ZA14769 30591903
         BE    TPT0500             NO, GO GET BUFFERS           ZA14769 30592603
         SR    R0,R0                    CLEAR                   SA60002 30593302
         IC    R0,TSBNOBF               CURRENT NO. OUTPUT BUFF SA60002 30593702
         AR    RWRK1,R0                 ADD TO NUMBER NEEDED    SA60002 30594102
         CH    RWRK1,TIOCAOMX      TOTAL OF BOTH LESS THEN MAX? ZA14769 30594203
         BH    TPT0450                  NO, GO WAIT OR RETURN  @ZA08262 30594303
         B     TPT0500             YES, GO GET BUFFER           ZA14769 30594403
***                                                                     30615402
*** SEE WHETHER ANY TPUT CAN PROCEED                                    30625402
***                                                                     30635402
TPT0423  EQU   *                                                SA60002 30646702
         CLC   TIOCAOMX+K1(K1),TSBNOBF  IS NO. ALLOWED GREATER          30657802
*                                       THAN NO. ALREADY ON Q           30678902
         BH    TPT0500             YES, GO GET BUFFER           ZA14769 30700003
TPT0425  EQU   *                                                        30750020
         OI    TIOCFLG,TIOCNOBF    SET SYSTEM FLAG              ZA14769 30800003
TPT0427  EQU   *                                                ZA14769 30900003
         CLI   TSBNOBF,K0               ANY ON OUTPUT QUEUE?    YS02019 31000002
         BNE   TPT0450                  IF ANY                          31100020
         SPACE 2                                                        31200020
         OI    TSBSTAT,TSBNOBUF         TASK INDICATOR                  32000020
         SPACE 2                                                        32100020
TPT0450  EQU   *                                                        32200020
***                                                                     32300020
***                 PREPARE TO GO TO OWAIT SUBROUTINE                   32400020
***                                                                     32500020
         TM    XSAF,PSW                 DOES TCAM NEED TO BE     M0094  32600021
*                                       POSTED - IS PART OF             32700020
*                                       THIS MSG ON THE QUEUE           32800020
         BZ    TPT0470                  IF NOT                          32900020
         SPACE 2                                                        33000020
***                                                                     33100020
***                 CHECK NEXT CHAR TO BE SENT FOR BACKSPACE            33200020
***                                                                     33300020
         SPACE 2                                                        33400020
         L     RWRK,XSAUBFRP            PTR TO NEXT CHARACTER    M0094  33440021
*   NOTE THAT, SINCE PSW IS ON, IEDAYGP (OUTPUT MOVE PORTION) HAS BEEN  33480021
*   ENTERED AT LEAST ONCE.  THEREFORE,XSAUBFRP WILL, BY THIS TIME,      33520021
*   POINT TO SOMEWHERE WITHIN THE USER'S BUFFER.                        33560021
         CLI   K0(RWRK),BKSPCHAR        IS NEXT CHAR A BACKSPACE        33600020
         BNE   TPT0460                  IF NOT                          33700020
         OI    TSBFLG3,TSBNBKSP         INDR TO OUTPUT EDIT SO          33800020
*                                       IT WON'T SEND CR AT END         33900020
         SPACE 2                                                        34000020
TPT0460  EQU   *                                                        34100020
***                                                             YS02019 34120002
***                 GO TO TPOST SUBROUTINE                      YS02019 34130002
***                                                             YS02019 34140002
         BAL   RBUF,TPT9900             GO TO TPOSTER           YS02019 34150002
         NI    XSAF,OFF-PSW             INDICATE TCAM POSTED     M0126  34960021
         B     TPT0490                  GO TO TSIP CALL                 35000020
         SPACE 2                                                        35100020
TPT0470  EQU   *                                                        35200020
         TM    XSAOPTNS,MWAIT           WAS WAIT SPECIFIED (0)   M0094  35300021
         BO    TPT8000                  IF NOT, GO TO NOWAIT RETURN     35400020
         SPACE 2                                                        35500020
TPT0490  EQU   *                                                        35600020
         OI    TSBFLG4,TSBOWAIT         INDICATE REAL OWAIT     YS02019 35640002
         BAL   RBUF,TPT6000             GO TO OWAIT SUBROUTINE          35800020
         SPACE 2                                                        35900020
         B     TPT0400                  RECHECK BFR ELEGIBILITY         36000020
         SPACE 2                                                        36100020
TPT0500  EQU   *                                                        36200020
*********************************************************************** 36300020
***                                                                 *** 36400020
***            AT THIS POINT IT HAS BEEN DETERMINED THAT            *** 36500020
***            THIS TASK IS ELIGIBLE FOR AT LEAST ONE TS            *** 36600020
***            BUFFER AND THERE IS ONE FREE. IT IS NOW              *** 36700020
***            COMMITED TO PLACING THE ENTIRE MESSAGE               *** 36800020
***            ONTO THE OUTPUT QUEUE.                               *** 36900020
***                                                                 *** 37000020
*********************************************************************** 37100020
         NI    XSAOPTNS,OFF-MWAIT       FORCE WAIT OPTION        M0094  38200021
         SPACE 2                                                        38500020
*********************************************************************** 38600020
***                                                                   * 38700020
***            QTIP WILL NOW BE CALLED TO DO THE FOLLOWING            * 38800020
***                                                                   * 38900020
***                 1- FIND THE PROPER PLACE ON THE OUTPUT            * 39000020
***                    QUEUE TO PUT THE NEXT BFR.                     * 39100020
***                                                                   * 39200020
***                 2- PLACE FIRST FREE BUFFER ONTO OUTPUT QUEUE.     * 39300020
***                                                                   * 39400020
***                 3- UPDATE PTRS & CNTS OF FREE AND OUTPUT QUEUES.  * 39500020
***                                                                   * 39600020
***                 4- MOVE EITHER ALL REMAINING DATA, OR AS MUCH AS  * 39700020
***                           BUFFER WILL HOLD WHICHEVER IS LESS.     * 39800020
***                                                                   * 39900020
***                 5- UPDATE USER BUFFER SIZE AND POINTER IN SVRB    * 40000020
***                    EXTENDED SAVE AREA (XSABSZ AND XSABPTR)        * 40100020
***                                                                   * 40200020
*********************************************************************** 40300020
         SPACE 2                                                        40400020
TPT1000  EQU   *                                                        40500020
***                                                                     40600020
***                 GO TO QTIP TO GET A TS BFR AND MOVE DATA            40700020
***                                                                     40800020
         LA    RSAVE,MOVECODE           ENTRY CODE                      40900020
         L     RGOTO,TIOCQTIP           QTIP BRANCH ADDRESS     YS02019 40940002
         LA    RAVT,TIOCSAVE            GET SAVE AREA FOR GP    YS02019 41170002
         BALR  RETURN,RGOTO             GO TO QTIP                      41200020
         SPACE 2                                                        41300020
***                                                                     41400020
***                 UPON RETURN FROM QTIP                               41500020
***                                                                     41600020
         NI    XSAF,OFF-XSADMOVE        DATA MOVEMENT DONE      YS02019 41750002
         OI    XSAF,HSW+PSW             TURN ON TO INDICATE      M0094  41800021
*                                       THAT NEXT BFR IS TO BE          41900020
*                                       A TRLR AND TCAM NEEDS           42000020
*                                       TO BE POSTED                    42100020
         CLC   XSAUBFRS,KZERO           HAS ALL OF DATA BEEN     M0094  42200021
*                                       MOVED INTO TS BUFFERS           42300020
         BE    TPT9000                  IF SO PREPARE TO RETURN         42400020
         TM    XSAOPTNS,MASIS+MCNTRL    FULL SCREEN OPTION      SA60002 42410002
         BO    TPT1000                  YES, BYPASS RECHECKING  SA60002 42420002
         B     TPT0400                  GO TO GET NEXT BUFFER           43200020
         EJECT                                                          43300020
TPT6000  EQU   *                                                        43400020
*********************************************************************** 43500020
*****                                                             ***** 43600020
*****               COMMON OWAIT SUBROUTINE                       ***** 43700020
*****                                                             ***** 43800020
*********************************************************************** 43900020
         SPACE                                                          44000020
***                                                             YS02019 44004002
***           INFORM SYSTEM RESOURCE MANAGER OF WAIT            YS02019 44006002
***                                                             YS02019 44008002
         LH    RWRK2,TIOCNFBF           NO, FREE BFRS FOR       YS02019 44010002
*                                       SRM STATISTICS          YS02019 44012002
         O     RWRK2,TSIPSIGN           SIGN BIT ON MEANS OWAIT YS02019 44014002
         LA    RAVT,TIOCSAVE            GET SYSEVENT SAVE AREA  YS02019 44014402
         SYSEVENT TERMWAIT,ASIDL=XSATJID,ENTRY=BRANCH           YS02019 44016002
         SPACE 2                                                YS02019 44018002
***                                                                     44020002
***                 FREE CMS LOCK AND SET UP RESUME ENVIRONMENT.        44022002
***                 'STATUS' WILL FREE LOCAL LOCK                       44024002
***                                                                     44026002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGG09301(TPT0100))       44028002
         STM   R0,RGOTO,TCBGRS          SAVE REGISTERS IN TCB - YS02019 44030002
*                                       DISPATCHER WILL RESTORE YS02019 44032002
         LA    RGOTO,TPT6500            GET RESUME ADDRESS      YS02019 44038002
         ST    RGOTO,RBOPSW+K4          STORE RESUME ADDRESS    YS02019 44040002
         SPACE 2                                                YS02019 44042002
***                                                             YS02019 44044002
***                 BRANCH TO 'STATUS' ROUTINE TO SET UP WAIT.  YS02019 44046002
***                 DISPATCHER WILL RETURN CONTROL TO TPT6500,  YS02019 44048002
***                 AFTER WHOEVER REMOVES OWAIT GOES TO         YS02019 44050002
***                 STATUS TO MAKE THIS TASK DISPATCHABLE.      YS02019 44052002
***                                                             YS02019 44054002
         L     RGOTO,CVTABEND           SECONDARY CVT POINTER   YS02019 44058002
         USING SCVTSECT,RGOTO                                   YS02019 44060002
         LA    R0,SDTCB                 SET ENTRY CODE          YS02019 44060102
         LA    RAVT,NDISPBIT            GET NONDISP MASK IN R13 YS02019 44060402
         L     RGOTO,SCVTSTAT           STATUS BRANCH ENTRY ADR YS02019 44062002
         DROP  RGOTO                                            YS02019 44064002
         LA    RWRK2,0(,RTCB)           TCB PTR FOR STATUS      YS02019 44064402
         BALR  RETURN,RGOTO             GO TO STATUS ROUTINE    YS02019 44066002
         SPACE 2                                                        47100020
TPT6500  EQU   *                                                        47200020
***                                                                     47300020
***                 UPON RETURN FROM OWAIT                              47400020
***                                                                     47500020
         SPACE 2                                                        47600020
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YS02019*47620002
               RELATED=(TSB,IGG09301(TPT9800))                  YS02019 47622002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*47630002
               RELATED=(TSB,IGG09301(TPT9700))                  YS02019 47680002
         LH    RTJID,XSATJID            SETLOCK BLASTS RTJID    YS02019 47730002
         BR    RBUF                     RETURN TO MAINLINE              48500020
         EJECT                                                          48600020
***                                                                     48650002
***                    INVALID PARAMETER RETURN                         48660002
***                                                                     48670002
TPT6800  EQU   *                                                 Y06327 48680002
         LA    RCODE,RC10               SET INVALID RETURN CODE  YM0895 48690002
         B     TPT7250                  GO TO ERROR ROUTINE      YM0895 48692002
         SPACE 3                                                SA60002 48694402
TPT7000  EQU   *                                                        48700020
***                                                                     48800020
***                 ATTENTION RETURN                                    49000020
***                                                                     49200020
         LA    RCODE,RC08               SET RETURN CODE                 49400020
         SPACE 2                                                        49560000
TPT7250  EQU   *                                                 YM0895 49570000
***                                                                     49580000
***            COMMON ERROR RETURN                                      49590000
***                                                                     49592000
         STH   RCODE,XSARC              SAVE RETURN CODE        YS02019 49594402
         TM    XSAF,OSW                 DID THIS TPUT REALLY DO  M0094  49596000
*                                       ANYTHING                        49600021
         BZ    TPT9700                  NO, JUST RETURN                 49800020
         B     TPT9300                  REMOVE WAITS IF POSSIBLE        50200020
         SPACE 3                                                YS02019 50250002
TPT7500  EQU   *                                                        50400020
***                                                                     50500020
***                 NO DATA - JUST SEND NEW LINE CHARACTER              50600020
***                                                                     50700020
         LA    RWRK1,NEWLINE            POINT TO NL CHAR                50800020
         STCM  RWRK1,SEVEN,XSAPRM1+K1   STORE NEW BFR POINTER    Y01018 50840002
         OI    XSAOPTNS,MASIS           FORCE ASIS OPTION        M0094  51200021
         LA    RWRK1,K1                 INDICATE LENGTH OF 1            51300020
         B     TPT0350                  RETURN                          51400020
         SPACE 4                                                        51500020
TPT8000  EQU   *                                                        51600020
***                                                                     51700020
***                 NOWAIT RETURN                                       51800020
***                                                                     51900020
         LA    RCODE,RC04               NOWAIT RETURN CODE              52000020
         STH   RCODE,XSARC              SAVE RETURN CODE       YS02019  52100002
         B     TPT9600                  GO TO EXIT                      52200002
         SPACE                                                          52207020
TPT8400  EQU   *                                                        52214020
***                                                                     52221020
***                 SUBROUTINE TO CHECK TERMINAL STATUS                 52228020
***                                                                     52235020
         TM    TSBFLG4,TSBHUNG          ID USER HUNG           @ZA03182 52235403
         BO    TPT8500                  YES, ABORT THIS TPUT    YS02019 52235802
         L     RRPT,CVTAQAVT            GET TCX POINTER         YS02019 52245002
         LTR   RRPT,RRPT                IS TCAM UP              YM01564 52247002
         BNM   TPT8500                  NO, ABORT THIS TPUT     YM01564 52249402
         USING IEDQTCX,RRPT                                     YS02019 52249802
         L     RRPT,TCXRPT              GET RPT PTR FOR TEST    YM01564 52250202
         DROP  RRPT                     DROP TCX BASE           YM01564 52250602
         LTR   RRPT,RRPT                IS TS STILL UP          YM01564 52250702
         BZ    TPT8500                  NO, ABORT THIS TPUT     YM01564 52250802
         USING TIOCRPT,RRPT             RPT ADDRESSABLE         YM01564 52250902
         TM    TCBTSFLG,TCBTIOTG        HAS ATTENTION BEEN HIT          52251002
         BO    TPT7000                  YES, GO TO ATTN RETURN          52255002
         TM    TSBFLG3,TSBATTN          HAS ATTEN BEEN HIT, IGNORED     52271002
         BO    TPT7000                  YES, GO TO ATTN RETURN          52275002
         BR    RBUF                     ALL IS WELL, RETURN     YM01564 52291002
         SPACE 2                                                        52300020
TPT8500  EQU   *                                                        52400020
***                                                                     52500020
***                 USER HUNG UP RETURN                                 52600020
***                                                                     52700020
         LA    RCODE,RC14                                               52800020
         STH   RCODE,XSARC              SAVE RETURN CODE        YS02019 52900002
         B     TPT7250                  GO TO RETURN            YS02019 53000002
         EJECT                                                          53100020
TPT9000  EQU   *                                                        53200020
***                                                                     53300020
***                 RETURN TO USER ROUTINE                              53400020
***                                                                     53500020
*   TEST TO SEE IF LINE SHOULD BE MARKED FOR NO                @ZA02244 53507003
*   FLASHBACK                                                  @ZA02244 53514003
         TM    TSBSTAT,TSBDSPLY         DISPLAY SCREEN         @ZA02244 53521003
         BNO   NTDPSC                   NO                     @ZA02244 53528003
         NI    TSBFLG3,OFF-TSBNFLOP     TURN OFF FLAG          @ZA02244 53535003
         L     RWRK,XSAUBFRP            POINT TO BUFFER        @ZA02244 53542003
         BCTR  RWRK,R0                  DECEM BY 1             @ZA02244 53549003
         CLI   0(RWRK),BYPASS          BYPASS CHAR. ON?         ZA16599 53556003
         BNE   NTDPSC                  NO                       ZA16599 53563003
         OI    TSBFLG3,TSBNFLOP         TURN ON BIT            @ZA02244 53570003
*                                                              @ZA02244 53577003
NTDPSC   EQU   *                                               @ZA02244 53584003
         SPACE                                                          53600020
         SR    RCODE,RCODE              SUCCESSFUL RETURN CODE          53700020
         STH   RCODE,XSARC              SAVE RETURN CODE        YS02019 53800002
         SPACE 2                                                        53900020
***                                                             YS02019 53920002
***                 GO TO SUBROUTINE TO TPOST TSB               YS02019 53930002
***                                                             YS02019 53940002
         BAL   RBUF,TPT9900             GO DO TPOST             YS02019 53950002
         SPACE 2                                                        54700020
***                                                                     54900020
***                 CHECK IF SMF IS UP                                  55000020
***                                                                     55100020
         L     RWRK,TCBTCT              TCT POINTER                     55200020
         LA    RWRK,K0(R0,RWRK)         CLEAR FIRST BYTE                55300020
         LTR   RWRK,RWRK                IS SMF UP                       55400020
         BZ    TPT9200                  IF NOT                          55500020
         SPACE 2                                                        55600020
***                                                                     55700020
***                 UPDATE LINE COUNT IF UP                             55800020
***                                                                     55900020
         USING SMFTCT,RWRK                                              56000020
         L     RWRK2,TCTLOUT            OLD COUNT                       56100020
         LA    RWRK2,K1(R0,RWRK2)       ADD ONE TO COUNT                56200020
         ST    RWRK2,TCTLOUT                                            56300020
         DROP  RWRK                                                     56400020
         SPACE 2                                                        56500020
TPT9200  EQU   *                                                        56600020
         SPACE 2                                                        56700020
***                                                                     56800020
***                 ENTER OWAIT FOR HOLD MESSAGE                        56900020
***                                                                     57000020
         TM    XSAOPTNS,MHOLD           DID USER SPECIFY HOLD    M0094  57100021
         BZ    TPT9250                  IF NOT                          57200020
         OI    TSBFLG4,TSBOWAIT+TSBHOLD INDICATE OWAIT          YS02019 57320002
         BAL   RBUF,TPT6000             GO TO OWAIT SUBROUTINE          57900020
*                   AFTER MESSAGE HAS BEEN PRINTED                      58000020
         BAL   RBUF,TPT8400             GO CHECK TERMINAL STATUS        58150020
         LH    RCODE,XSARC              RESTORE RETURN CODE     YS02019 58220002
TPT9250  EQU   *                                                        58300020
***                                                             YS02019 58304002
***        INFORM SYSTEM RESOURCE MANAGER OF SUCCESSFUL TPUT    YS02019 58306002
***                                                             YS02019 58308002
         LH    RWRK2,XSAPRMSZ           AMMOUNT OF DATA MOVED   YS02019 58310002
         O     RWRK2,TSIPSIGN           SIGN MEANS TPUT         YS02019 58312002
         LA    RAVT,TIOCSAVE            GET SYSEVENT SAVE AREA  YS02019 58312402
         SYSEVENT TGETTPUT,ASIDL=XSATJID,ENTRY=BRANCH           YS02019 58314002
         SPACE 2                                                YS02019 58316002
***                                                             YS02019 58318002
***                 POST TSBECB IF AN ASID TPUT IS WAITING      YS02019 58320002
***                                                             YS02019 58322002
TPT9300  EQU   *                                                YS02019 58324002
         TM    TSBFLG3,TSBAWOIP         ANYBODY WAITING         YS02019 58326002
         BNO   TPT9400                  NO, FORGET IT           YS02019 58328002
         NI    TSBFLG3,OFF-TSBAWOIP     SET WAIT INDICATOR OFF  YS02019 58328402
         SPACE 2                                                YS02019 58330002
***                                                             YS02019 58332002
***                 CROSS-MEMORY POST THE TSBECB                YS02019 58334002
***                                                             YS02019 58336002
         LA    RECB,TSBECB              ECB ADDRESS             YS02019 58340002
         LA    RTJID,CVTBRET            ERRET = NOP (BR 14)     YS02019 58342002
         LH    RAVT,TSBWTJID            ASID OF WAITING TASK    YS02019 58344002
         BCTR  RAVT,R0                  DECREMENT ASID BY 1     YS02019 58344402
         SLL   RAVT,K2                  ASID * 4                YS02019 58344802
         L     RRPT,CVTASVT             GET ASVT ADDR           YS02019 58345202
         DROP  RRPT                     NO LONGER HAS RPT ADDR  YS02019 58345302
         L     RAVT,ASVTENTY-ASVT(RAVT,RRPT) GET ASCB ADDR      YS02019 58345602
         SR    RRPT,RRPT                ZERO COMPLETION CODE    YS02019 58345702
         L     RGOTO,CVT0PT01           ENTRY POINT OF POST     YS02019 58346002
         O     RECB,TSIPSIGN            HI-ORDER BIT SIGNIFIES  YS02019 58348002
*                                       CORSS-MEMORY POST       YS02019 58350002
         SPACE 2                                                YS02019 58352002
***                                                             YS02019 58354002
***                 REGISTERS FOR POST -                        YS02019 58356002
***                                                             YS02019 58358002
***            10 (RRPT) = COMPLETION CODE                      YS02019 58360002
***            11 (RECB) = ECB ADDRESS, HI-ORDER BIT ON         YS02019 58362002
***            12 (RTJID) = 'ERRET' ADDRESS                     YS02019 58364002
***            13 (RAVT) = ASCB ADDRESS OF POSTED MEMORY        YS02019 58366002
***            14 (RETURN) = RETURN ADDRESS                     YS02019 58368002
***            15 (RGOTO) = ENTRY POINT OF POST                 YS02019 58370002
***                                                             YS02019 58372002
         BALR  RETURN,RGOTO             GO TO POST ROUTINE      YS02019 58374002
         SPACE 2                                                        63200020
TPT9400  EQU   *                                                        63300020
***                                                                     63400020
***                 CHECK FOR WAITING ON OWAIT TASKS                    63500020
***                                                                     63600020
         TM    TSBFLG1,TSBWOWIP         ANY TASKS WAITING               63700020
         BZ    TPT9600                  IF NOT                          63800020
         SPACE 2                                                        63900020
***                                                             YS02019 63906002
***                 GO TO STATUS TO RESET ALL TASKS THAT MIGHT  YS02019 63909002
***                 HAVE BEEN WAITING FOR THE TSB               YS02019 63912002
***                                                             YS02019 63915002
***                 REGISTERS FOR 'STATUS' -                    YS02019 63918002
***                                                             YS02019 63921002
***            0 (R0) - HIGH-ORDER = ASID, LOW = ENTRY CODE (8) YS02019 63924002
***            1 (RWRK2) - HIGH-ORDER BIT ON, REST = 0          YS02019 63927002
***            13 (RAVT) - MASK OF SECONDARY BITS TO BE RESET   YS02019 63930002
***            14,15 (RETURN,RGOTO) - CONVENTIONAL              YS02019 63933002
***                                                             YS02019 63936002
         LA    R0,STEPSD                ENTRY CODE TO RESET ALL YS02019 63939002
*                                       TASKS IN STEP           YS02019 63942002
         L     RWRK2,TSIPSIGN           MEANS 'RESET', NO TCB   YS02019 63945002
*                                       POINTER MEANS ALL STEP  YS02019 63948002
         ICM   R0,B'1100',XSATJID       ASID OF CALLER          YS02019 63951002
         L     RGOTO,CVTABEND           PTR TO 2NDARY CVT       YS02019 63954002
         LA    RAVT,NDISPBIT            USE SAME MASK AS BEFORE YS02019 63957002
         USING SCVTSECT,RGOTO                                   YS02019 63960002
         L     RGOTO,SCVTSTAT           ENTRYPOINT OF STATUS    YS02019 63963002
         DROP  RGOTO                                            YS02019 63966002
         BALR  RETURN,RGOTO             GO TO STATUS ROUTINE    YS02019 63969002
TPT9600  EQU   *                                                        66600020
         NI    TSBFLG1,OFF-(TSBOWIP+TSBWOWIP)                           66700020
*                                       OTHER TPUTS CAN NOW PROCEED     66800002
         SPACE 2                                                        66900020
TPT9700  EQU   *                                                        67000020
***                                                                     67100020
***                 TURN OFF TCB ATTN INDR AND RETURN                   67200020
***                                                                     67300020
         LH    RCODE,XSARC              RESTORE RETURN CODE     YS02019 67400002
         NI    TCBTSFLG,OFF-TCBTIOTG    ATTN HIT INDR                   67500020
         NI    TSBFLG3,OFF-TSBATTN      TURN OFF ATTN HIT INDR          67600020
*                                       ALL DONE WITH CMS LOCK  YS02019 67602002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGG09301(TPT0100))       67603002
         SPACE 1                                                        67605020
TPT9750  EQU   *                                                        67610020
***                                                                     67615020
***                TURN OFF TCBFX IF OFF AT ENTRY                       67620020
***                                                                     67625020
         TM    XSAF,XSATCBFX            SHOULD WE TURN OFF TCBFX M0094  67635002
         BZ    TPT9800                  IF NOT,SKIP                     67660020
         NI    TCBFLGS1,OFF-TCBFX       ALLOW ASYNCHRONOUS EXITS        67700020
TPT9800  EQU   *                                                        67750020
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=('SVC SLIH')        YS02019 67760002
         L     RETURN,XSARETRG          GET SUPERVISOR RET ADDR YS02019 67766002
         BR    RETURN                   RETURN                  YS02019 67774002
         EJECT                                                          67900020
*********************************************************************** 67902002
***                                                                 *** 67903002
***                 SUBROUTINE TO TPOST TSB TO IEDAYP               *** 67904002
***                                                                 *** 67905002
*********************************************************************** 67906002
TPT9900  EQU   *                                                YS02019 67907002
         LM    R0,RWRK2,TSBTPOST        GET TPOSTING FIELD      YS02019 67914002
         ST    RBUF,XSAWD7              SAVE REGISTER 2         YM03998 67914402
TPT9907  EQU   *                                                        67915002
         STM   R0,RWRK2,XSAWD5          MOVE TO XSA TO SET BITS YS02019 67916002
         LA    RGO,XSAWD5               ADDRESSABILITY          YS02019 67917002
         USING TSBTPOST,RGO             NEXT REFERENCES TO TSB  YS02019 67918002
*                                       TPOST & BEYOND WILL     YS02019 67919002
*                                       REALLY BE TO XSA        YS02019 67920002
***                                                             YS02019 67921002
***                 IF ALL OUTPUT IS ON QUEUE, TURN OFF         YS02019 67922002
***                 QCBPARTO. ELSE, TURN IT ON                  YS02019 67923002
***                                                             YS02019 67924002
         SR    RWRK,RWRK                                        YS02019 67925002
         CH    RWRK,XSAUBFRS            REMAINING SIZE ZERO     YS02019 67926002
         BNE   TPT9910                  NO, TURN ON PARTO       YS02019 67927002
         TM    XSAF,XSAPARTO            HAS PARTO BEEN SET      YM01246 67927402
         BZ    TPT9915                  NO, NO NEED TO RESET    YM01246 67927802
         NI    TSBF1V,OFF-QCBPARTO      YES, TURN OFF PARTO     YS02019 67928002
         OI    TSBF1M,QCBPARTO          ACTION BIT FOR AYP      YM01246 67928402
         NI    XSAF,OFF-XSAPARTO        RESET PARTO FLAG        YM01246 67928802
         B     TPT9915                  SKIP                    YS02019 67929002
TPT9910  EQU   *                                                YS02019 67930002
         TM    XSAF,XSAPARTO            HAS PARTO BEEN SET      YM01246 67930402
         BO    TPT9915                  YES, NO NEED TO SET     YM01246 67930802
         OI    TSBF1M,QCBPARTO          ACTION BIT FOR AYP      YM01246 67930902
         OI    TSBF1V,QCBPARTO          TURN ON PARTO           YS02019 67934502
         OI    XSAF,XSAPARTO            SET PARTO FLAG IN WA    YM01246 67935402
TPT9915  EQU   *                                                YS02019 67935602
         SPACE 2                                                YS02019 67936702
***                                                             YS02019 67937802
***                 TURN ON QCBTPUT.  IF BREAKIN REQUEST, AND   YS02019 67938902
***                 BREAKIN IS ALLOWED, TURN ON QCBWRBRK.       YS02019 67940002
***                                                             YS02019 67941102
         TM    XSAOPTNS,MBREAK          BREAKIN REQUEST         YM01176 67941502
         BO    TPT9917                  YES, SKIP TSBTPUT TEST  YM01176 67941902
         TM    TSBFLG3,TSBTPUT          ALREADY DOING A TPUT    YM01246 67942102
         BZ    TPT9917                  NO, MUST TPOST          YM01246 67942402
         TM    TSBF1M,QCBPARTO          MUST PARTO BE SET       YM01246 67942802
         BZ    TPT9930                  NO NEED TO TPOST        YM08378 67942902
TPT9917  EQU   *                                                YM01246 67943102
         OI    TSBF1V,QCBTPUT           SET TPUT VALUE          YS02019 67943802
         OI    TSBF1M,QCBTPUT           ACTION BIT FOR AYP      YS02019 67944002
         TM    XSAOPTNS,MBREAK          BREAKIN REQUEST         YS02019 67945502
         BNO   TPT9920                  NO, SKIP                YS02019 67946602
         TM    TSBFLG3,TSBNOBRK         BREAKIN ALLOWED         YS02019 67947702
         BO    TPT9920                  NO, SKIP                YM01114 67948802
         OI    TSBF1V,QCBWRBRK          SET VALUE BIT           YS02019 67949902
         OI    TSBF1M,QCBWRBRK          SET ACTION BIT          YS02019 67951002
TPT9920  EQU   *                                                YS02019 67953002
         OI    TSBTPFLG,TSBPOSTO+TSBTPQCB TELL TYP TO TPOST QCB YS02019 67955002
*                                         SHOW TPOST OUTSTAND'G YS02019 67957002
         SPACE 2                                                YS02019 67958702
***                                                                     67959802
***                 SET BITS IN REAL TSB, USING CDS.  IF TSBPOSTO       67960902
***                 WAS ON DURING SWAP, NO NEED TO DO ACTUAL            67962002
***                 TPOST                                               67963102
***                                                                     67964202
         DROP  RGO                      USE REAL TSB NOW        YS02019 67965302
         LM    RBUF,RCVT,XSAWD5         GET NEW BITS            YS02019 67967502
         DROP  RCVT                                             YS02019 67968602
         CDS   R0,RBUF,TSBTPOST         TRY TO RESET BITS       YS02019 67969702
         BNE   TPT9907                  IF CHANGED, DO IT AGAIN YS02019 67970802
         OI    TSBFLG3,TSBTPUT          SET INDR FOR FUTURE     YS03998 67971202
         L     RCVT,CVTPTR                                      YS02019 67977102
         USING CVT,RCVT                                         YS02019 67978302
         L     RTCX,CVTAQAVT            GET TCX ADDRESS         YS02019 67979502
         USING IEDQTCX,RTCX                                     YS02019 67980702
         LTR   R0,R0                    TEST TSBPOSTO (THIS TST YS02019 67981902
*                                       NEEDS TSBPOSTO EQU 8)   YS02019 67983102
         BM    TPT9930                  IF ON, DON'T TPOST.     YS02019 67984302
*                                       IEDAYP WILL PICK UP     YS02019 67985502
*                                       THESE FLAGS ANYWAY      YS02019 67986702
         SPACE 2                                                YS02019 67987902
***                                                             YS02019 67989102
***                 TPOST THE TSB TO IEDAYP                             67990302
***                                                                     67991502
         L     RWRK,TCXTSI              GET TSINPUT QCB ADDRESS YS02019 67992702
         USING IEDQTSI,RWRK                                     YS02019 67993902
         LA    RWRK,TSITSAP-(QCBSTVTO-IEDQQCB)                  YS02019 67995102
*                                       ADDRESS OF IEDAYP'S     YS02019 67996302
*                                       'QCB'                   YS02019 67997502
         DROP  RWRK                                             YS02019 67998702
         ST    RWRK,TSBRQCB             QCB TO WHICH TSB WILL   YS02019 67999902
*                                       BE TPOSTED              YS02019 68001102
         L     RWRK,TCXREADY            GET CONTENTS OF READY Q YS02019 68002302
TPT9925  EQU   *                                                YS02019 68003502
         ST    RWRK,TSBLINKA            LINK TSB TO NEXT ELEM   YS02019 68004702
         MVI   TSBPRI,PRIDESTQ          SET PRIORITY            YS02019 68005902
         LA    RSAVE,TSBRCB             GET READY TO PUT ELEM   YS02019 68007102
*                                       ADDRESS INTO Q HEADER   YS02019 68008302
         CS    RWRK,RSAVE,TCXREADY      TRY TO ADD IT TO QUEUE  YS02019 68009502
         BNE   TPT9925                  NO GOOD, TRY AGAIN      YS02019 68010702
         SPACE 2                                                YS02019 68011902
***                                                             YS02019 68013102
***                 X-M POST TCAM                               YS02019 68014302
***                                                             YS02019 68015502
         SR    RRPT,RRPT                COMPLETION CODE         YS02019 68016702
         LR    RASCB,RTJID              SAVE TJID               YS02019 68017902
         LA    RTJID,CVTBRET            'ERRET' ADDRESS         YS02019 68019102
         L     RAVT,TCXASCB             LOAD ASCB OF TCAM       YS02019 68020302
         LR    R0,RTCX                  SAVE TCX POINTER        YS02019 68021502
         L     RTCX,TCXAVT              AVT POINTER             YS02019 68023502
         DROP  RTCX                                             YS02019 68023902
         USING IEDQAVTD,RTCX                                    YS02019 68025502
         LA    RECB,AVTOSECB            ECB POINTER ** NOTE     YS02019 68027502
*                                       THAT AVT IS NOT REALLY  YS02019 68029502
*                                       ADDRESSABLE             YS02019 68035402
         L     RGOTO,CVT0PT01           POST ROUTINE ADDRESS    YS02019 68039402
         O     RECB,TSIPSIGN            HI-ORDER BIT=XMPOST     YS02019 68039502
         BALR  RETURN,RGOTO             GO POST                 YS02019 68039802
         SPACE 2                                                YS02019 68040202
         LR    RTCX,R0                  RESTORE TCX PTR         YS02019 68040602
         USING IEDQTCX,RTCX                                     YS02019 68041002
         LR    RTJID,RASCB              RESTORE TJID            YS02019 68041102
         L     RASCB,TSBASCBA           RESTORE ASCB POINTER    YS02019 68041202
         L     RRPT,TCXRPT              RESTORE RPT POINTER     YS02019 68047102
         USING TIOCRPT,RRPT                                     YS02019 68049102
TPT9930  EQU   *                                                YS02019 68051102
         L     RCVT,CVTPTR              RESTORE CVTPTR         @ZA03945 68052003
         L     RBUF,XSAWD7              RESTORE REGISTER 2      YS02019 68053002
         BR    RBUF                     RETURN                  YS02019 68058902
         EJECT                                                  YS02019 68064802
*********************************************************************** 68082402
*****                                                             ***** 68100020
*****               CONSTANTS USED BY IGG09301                    ***** 68200020
*****                                                             ***** 68300020
*********************************************************************** 68400020
         SPACE                                                          68500020
NEWLINE  DC    X'15'                    NL CHAR TO SEND WHEN NO DATA    69000020
TPTPSW   DS    0F                       ALIGNMENT                       69010002
         DC    X'070C0000'              1ST WD OF RESUME PSW -   Y01018 69030000
*                                       TRANS, ENABLE, EC, M CK  Y01018 69040000
FOUR     DC    F'4'                     CONSTANT FOR COMPARISON  YM0895 69042000
KZERO    DC    F'0'                     ZERO COMPARATOR                 69100020
TSIPSIGN DC    X'80000000'              TPUT INDR FOR TSIP              69200020
PATCHREA DC    10F'0'                   PATCH AREA               Y01018 69220000
         EJECT                                                          70300020
         IHAASCB                                                YS02019 70610002
         EJECT                                                  YS02019 70620002
         IKJTIOCB                                               SA60002 70630002
         EJECT                                                  SA60002 70650102
         IHAASVT                                                YS02019 70700002
         EJECT                                                  YS02019 71100002
         TAVTD                                                  YS02019 71150002
         EJECT                                                  YS02019 71160002
CVT      DSECT                                                  YS02019 71200002
         CVT                                                    YS02019 71300002
         EJECT                                                  YS02019 71310002
         TPRIOR                                                 YS02019 71350002
         EJECT                                                  YS02019 71400002
         IHAPSA                                                 YS02019 71500002
         EJECT                                                  YS02019 71600002
         TQCBD                                                  YS02019 71700002
         EJECT                                                          72100020
         IKJRB                                                          72103021
***                                                                     72106021
***      EXTENDED SAVE AREA.  THSES STATEMENTS SHOULD FOLLOW            72109021
***      THE MACRO 'IKJRB.'                                             72112021
***                                                                     72115021
         ORG   RBEXSAVE                 START OF SAVE AREA       M0094  72118021
XSAPRM0  DS    0F                       REG 0 AT ENTRY           M0094  72121021
XSAPRMTJ DS    H                        TJID PASSED              M0094  72124021
XSAPRMSZ DS    H                        SIZE PASSED              M0094  72127021
XSAPRM1  DS    0F                       REG 1 AT ENTRY           M0094  72130021
XSAOPTNS DS    X                        USER OPTIONS             M0094  72133021
MASIS    EQU   X'01'                    ASIS OPTION SPECIFIED    M0094  72136021
MCNTRL   EQU   X'02'                    1 MEANS CONTROL          M0094  72139021
*                                                                       72142021
*   BOTH OF THE ABOVE BITS OFF MEANS EDIT OPTION                        72145021
*                                                                       72148021
MBREAK   EQU   X'04'                    BREAKIN SPECIFIED        M0094  72151021
MHOLD    EQU   X'08'                    1 MEANS HOLD             M0094  72154021
MTGET    EQU   X'80'                    1 MEANS TGET REQUESTED   M0094  72157021
MUSERP   EQU   X'40'                    REG 15 PTS TO USERID    YS02019 72160002
MLOWP    EQU   X'20'                    0 HIGHPRI, 1 LOWPRI      M0094  72163021
MWAIT    EQU   X'10'                    1 MEANS NOWAIT           M0094  72166021
         DS    AL3                      REST OF REGISTER ONE     M0094  72169021
XSAWD3   DS    0F                       FOR SAVING REGISTERS     M0094  72172021
XSAFLAG  DS    X                        FLAG PASSED BY 9C TO 01  M0094  72175021
*                                       AND 02                   M0094  72178021
XSATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT   M0094  72181021
         DS    AL3                      REST OF WORD             M0094  72184021
         ORG   XSAWD3+2                 INPUT ED, OUTPUT MOVE    M0094  72187021
XSAUBFRS DS    H                        AMT DATA LEFT TO MOVE    M0094  72190021
XSAUBFRP DS    0F                       LOC DATA LEFT TO MOVE    M0094  72193021
XSAESTAL DS    CL16                     LIST FOR ESTAE MACRO    YS02019 72203002
         ORG   XSAUBFRP+4               USED FOR SAVE AREA WHEN YS02019 72220002
*                                       NOT NEEDED BY ESTAE     YS02019 72223002
XSAWD5   DS    F                        FOR SAVING REGISTERS     M0094  72226021
XSAWD6   DS    F                        FOR SAVING REGISTERS     M0094  72229021
         ORG   XSAWD5                   USE WORDS 5-6 FOR NAME   M0094  72232021
XSAENQNM DS    CL8                      ENQ NAME FOR TJID TPUT   M0094  72235021
XSAWD7   DS    F                        FOR SAVING REGISTERS     M0094  72238021
XSAWD8   DS    F                        FOR SAVING REGISTERS     M0094  72241021
         ORG   XSAWD7                   USE WDS 7-8 FOR ENQ PRMS M0094  72244021
XSAENQAD DS    2F                       WORK AREA FOR ENQ/DEQ    M0094  72247021
XSAUSERP DS    0F                       PTR TO USERID           YS02019 72249002
XSAWD9   DS    F                        FOR SAVING REGISTERS     M0094  72250021
XSARETRG DS    0F                       FOR SAVING RETURN ADDR  YS02019 72252002
XSAWD10  DS    F                        FOR SAVING REGISTERS     M0094  72253021
         DS    CL1                      RESERVED                YS02019 72255002
XSAUSERK DS    CL1                      KEY OF TGET CALLER      YS02019 72255402
XSARC    DS    H                        RETURN CODE SAVE AREA   YS02019 72256002
XSATJID  DS    H                        CALLER'S TJID            M0094  72259021
XSAFLAG2 DS    X                        FLAGS                   YM05387 72261002
XSAATR   EQU   X'80'                    NEXT CHAR IN TS BUFFER   S22028 72263202
*                                       IS A 3270 ATTRIBUTE BYTE        72263802
XSABFRAL EQU   X'40'                    TIOC BUFFER HAS BEEN    YM05387 72264202
*                                       ALLOCATED               YM05387 72264302
XSA15D   EQU   X'20'                    CHANGE COMPLETION CODE  YM05387 72266602
*                                       TO 15D                  YM05387 72268602
*                  NEXT 5 BITS UNUSED                           YM05387 72269002
XSAF     DS    X                        FLAGS USED BY TPUT. INI- M0094  72271302
*                                       TIALIZED FROM XSAFLAG.          72273602
HSW      EQU   X'80'                    HEADER BFR DONE          M0094  72275902
PSW      EQU   X'40'                    NEED TO TPOST QCB        M0094  72278202
*SATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT          72280502
OSW      EQU   X'10'                    TSBOWIP TURNED ON BY US  M0094  72282802
XSADMOVE EQU   X'08'                    DATA MOVEMENT GOES ON   YS02019 72285102
XSAAUTH  EQU   X'04'                    USER IS AUTHORIZED      YS02019 72287402
*                                       (NOT SOME OTHER TPUT)   YS02019 72289702
XSAUDEBQ EQU   X'02'                    ASID TPUT ASID ENQUEUED YS02019 72292002
XSAPARTO EQU   X'01'                    QCBPARTO IS SET ON      YM01246 72302002
         EJECT                                                  YS02019 72312002
         IHASCVT                                                YS02019 72342002
         EJECT                                                  YS02019 72402002
         IKJTCB                                                 YS02019 72412002
         EJECT                                                  YS02019 72422002
         IEFTCT                                                 YS02019 72432002
         EJECT                                                  YS02019 72442002
         TTCXD                                                  YS02019 72462002
         EJECT                                                  YS02019 72472002
         IKJTIOCP                                               YS02019 72492002
         EJECT                                                  YS02019 72502002
         IKJTSB                                                 YS02019 72552002
         EJECT                                                  YS02019 72562002
         TTSID                                                  YS02019 72612002
         EJECT                                                  YS02019 72632002
         END   IGG09301                                                 72900020
./  ADD  SSI=53350182,NAME=IGG09302
         TITLE 'IGG09302 - SECOND LOAD OF TPUT WITH TJID'               00100002
IGG09302 CSECT                                                          00200002
         SPACE 3                                                YS02019 00240002
*                                                                       00241003
*         VS2   030   SU                                                00242003
*                                                                       00243003
*0000275510                                                    @ZA05569 00244003
*                                                                       00245003
*                                                                       00246003
*                   RELEASE 3, VS/2, CHANGES                          * 00250003
*D002200                                                        ZA00968 00252003
*C202700                                                        ZA00968 00254003
*                   RELEASE 2, VS/2, DELETIONS                        * 00260002
*                                       03/24/73                YM01564 00270002
*                                       05/30/73                YM01246 00272002
*                                       07/03/73                YM01114 00274002
*                                       07/16/73                YM01176 00276002
*                                       10/11/73                YM03998 00278002
*                                       11/15/73                YM05387 00278402
*                                       04/11/74                YM08378 00278802
*     THIS MODULE HAS BEEN COMPLETELY RESEQUENCED FOR VS2-2     YS02019 00280002
*                                                                     * 00300002
*                   RELEASE 1, VS/2, DELETIONS                        * 00320002
*                                                                     * 00400002
*580260-580740,217021                                            YM0895 00600002
*1301554000                                                      A44943 00800002
*1301612550                                                      S22028 00819002
*1301516000                                                      A45242 00900002
*1301                                                            M0126  01000002
*1301035000-046000,073000-112000,191000-192400,203000-209000,    M0094  01100002
*1301217010-217020,217080,217130-217140,217220,219200-219300,    M0094  01200002
*1301223000,238500,241000,284000,290000,292000,307000-310000,    M0094  01300002
*1301314000,343000,350000,361400-363200,401000,406000-409000,    M0094  01400002
*1301422000,428000,470400-475200,499000,503000,508000,577300,    M0094  01500002
*1301579540-579720                                               M0094  01600002
*                                                                M2152  01700002
*0000927000-944000                                               M0019  01800002
*0000246000,252000-255400,256000-297000,303000,339000,340000-    TS1634 01900002
*0000346000,356000,375000-412000,463000,478000-498000,504000,    TS1634 02000002
*0000546000,555000-579000,586500                                 TS1634 02100002
*                                                                M0661  02200002
*0000258000-259000,569000                                        TS0034 02300002
*                                                                 M2677 02400002
*                                                                M3391  02500002
*                                                                M4022  02600002
*                                                                M0048  02700002
*                                                                 M5113 02800002
*                                                                 M4415 02900002
*                                                                M4696  03000002
*                                                                M6024  03100002
*1301                                                            S21A12 03200002
*1301061500,361000,363000,471000,475000                          S21008 03300002
* STATUS -                                                            * 03400002
*    CHANGE LEVEL VS2  030  SU                                 @ZA05569 03450003
*                                                                     * 03500002
* FUNCTION -                                                          * 03600002
*                                                                     * 03700002
*    PUT OUTPUT FROM USER'S BUFFER INTO TSO BUFFERS FOR LATER         * 03800002
*    TRANSFERENCE, VIA TCAM, TO A TERMINAL NOT CONNECT TO THIS TASK.  * 03900002
*                                                                     * 04000002
*    PROVIDE LIMITED EDITING OPTIONS                                  * 04100002
*                                                                     * 04200002
* ENTRY POINTS -                                                      * 04300002
*                                                                     * 04400002
*    IGG09302 - ENTRY FROM FIRST LOAD OF TERMINAL I/O SVC             * 04500002
*    ROUTINES (IGC0009C).                                             * 04600002
*                                                                     * 04700002
* INPUT -                                                             * 04800002
*                                                                     * 04900002
*********************************************************************** 05000002
***                                                                 *** 05100002
***                 REGISTER CONTENTS UPON ENTRY                    *** 05200002
***                                                                 *** 05300002
***      3 - CVT POINTER      8 - ASCB OF CALLER  15 - USERID PTR   *** 05400002
***      4 - TCB POINTER      9 - TSB OF CALLER       (IF USERID    *** 05500002
***      5 - SVRB POINTER    10 - TIOCRPT POINTER      TPUT)        *** 05600002
***                                                                 *** 05700002
***                                                                 *** 05900002
*********************************************************************** 06000002
*                                                                     * 06100002
* OUTPUT                                                              * 06200002
*                                                                     * 06300002
*    RETURN CODE IN REG 15                                            * 06400002
*              00 - SUCCESSFUL                                        * 06500002
*              04 - NOWAIT SPECIFIED, AND TSB WAS IN USE              * 06600002
*              08 - ATTN OCCURED DURING SVC EXECUTION                 * 06700002
*              OC - NO INTER-TERMINAL COMMUNICATION ALLOWED           * 06800002
*              14 - CALLED TASK IS NO LONGER ACTIVE                   * 07300002
*                                                                     * 07400002
* EXTERNAL REFERENCES -                                               * 07500002
*                                                                     * 07600002
*              MODESET                                          YS02019 07700002
*              SETLOCK                                          YS02019 07750002
*              OPTIMIZER                                        YS02019 07800002
*              TESTAUTH                                         YS02019 07850002
*              QTIP                                                   * 07900002
*              ENQ/DEQ                                                * 08000002
*                                                                     * 08400002
* EXITS,NORMAL -                                                      * 08500002
*                                                                     * 08600002
*    RETURN TO SUPERVISOR VIA BR14 (RETURN ADDRESS IS SAVED IN        * 08700002
*    XSARETRG BY IGC0009C)                                            * 08750002
*                                                                     * 08800002
* EXITS,ERROR -                                                       * 08900002
*                                                                     * 09000002
*    THERE ARE NO ERROR EXITS FROM THIS ROUTINE.                      * 09100002
*                                                                     * 09200002
* TABLES/WORK AREAS -                                                 * 09300002
*                                                                     * 09400002
*    THE FORMAT AND CONTENTS OF THE TABLES USED ARE                   * 09500002
*    DESCRIBED BY THE DSECTS AT THE END OF THE LISTING                * 09600002
*                                                                     * 09700002
* ATTRIBUTES -                                                        * 09800002
*                                                                     * 09900002
*    REENTRANT, PRIVILEGED, REFRESHABLE                               * 10000002
*    HOLDS THE LOCAL LOCK AT ENTRY AND GETS CMS LOCK EXPLICITLY       * 10060002
*                                                                     * 10100002
* CHARACTER CODE DEPENDENCY -                                         * 10200002
*                                                                     * 10300002
*    THE OPERATION OF THIS MODULE DEPENDS UPON THE FOLLOWING          * 10400003
*    PROPERTIES OF THE INTERNAL REPRESENTATION OF THE EXTERNAL        * 10500003
*    CHARACTER SET- BACKSPACE EQUAL TO X'16', BLANK EQUAL TO          * 10600003
*    X'40', NEW LINE EQUAL TO X'15'.                                  * 10700002
*    THE SPECIFIC INSTRUCTIONS WHICH REQUIRE MODIFICATION IF          * 10800003
*    THESE PROPERTIES OF THE CHARACTER SET ARE CHANGED MAY BE         * 10900003
*    IDENTIFIED BY BLNKCHAR, BKSPCHAR, AND NEWLINE, RESPECTIVELY.     * 11000002
*                                                                     * 11100002
* NOTES -                                                             * 11200002
*                                                                     * 11300002
*    NONE                                                             * 11400002
*                                                                     * 11500002
*********************************************************************** 11600002
         EJECT                                                          11800002
*********************************************************************** 11900002
******                                                            ***** 12000002
******              REGISTER EQUATES                              ***** 12100002
******                                                            ***** 12200002
*********************************************************************** 12300002
       SPACE                                                            12400002
R0       EQU   0                        REG USED TO SPEED ASM           12500002
RP0      EQU   0                        FOR TPOST SUBROUTINE    YS02019 12550002
RSAVE    EQU   0                        WORK REGISTER                   12600002
RWRK2    EQU   1                        WORK REGISTER                   12700002
RP1      EQU   1                        FOR TPOSTING SUBROUTINE YS02019 12750002
RBUF     EQU   2                        POINTER TO TS BUFFER            12800002
RCVT     EQU   3                        POINTER TO CVT                  12900002
RTCB     EQU   4                        POINTER TO TCB                  13300002
RSVRB    EQU   5                        POINTER TO SVRB                 13400002
RBASE    EQU   6                        BASE REGISTER                   13500002
RSAVE2   EQU   7                        SAVE REGISTER FOR TJID          13600002
RASCB    EQU   8                        POINTER TO ASCB         YS02019 13700002
RTSB     EQU   9                        POINTER TO TSB                  13800002
RRPT     EQU   10                       POINTER TO TIOCRPT              13900002
RTCX     EQU   11                       POINTER TO TCAM CVT EXT YS02019 14000002
RTJID    EQU   12                       TJID                            14200002
RAVT     EQU   13                       POINTER TO AVT                  14300002
RETURN   EQU   14                       RETURN ADDRESS                  14400002
RWRK     EQU   14                       WORK REGISTER                   14500002
RWRK1    EQU   15                       WORK REGISTER                   14600002
RCODE    EQU   15                       RETURN CODE                     14700002
RGOTO    EQU   15                       BRANCH ADDRESS                  14800002
         SPACE 2                                                        14900002
***                                                                     15000002
***                 CONSTANTS                                           15100002
***                                                                     15200002
K0       EQU   0                        OFFSET                          15700002
K1       EQU   1                        OFFSET AND SIZE                 15800002
K3       EQU   3                        OFFSET AND SIZE                 16000002
K12      EQU   12                       SIZE OF QNAME FOR ENQ-DEQ       16200002
TIMES4   EQU   2                        SHIFT CONSTANT          YS02019 16300002
         SPACE 2                                                        16400002
***                                                                     16500002
***                 RETURN CODES                                        16600002
***                                                                     16700002
RCNOWT   EQU   X'04'                    NOWAIT SPEC'D AND TSB BUSY      16800002
RCNOIT   EQU   X'0C'                    NO INTER-TERM ALLOWED           16900002
RCGONE   EQU   X'14'                    CALLED TASK NO LONGER           17300002
*                                       ACTIVE                          17400002
         SPACE 2                                                        17500002
***                                                                     17600002
***                 MASKS                                               17700002
***                                                                     17800002
OFF      EQU   X'FF'                    USED TO TURN OFF BITS           17900002
NDISPBIT EQU   X'400'                   NONDISPATCHABILITY MASK YS02019 18000002
SEVEN    EQU   7                        MASK USED IN STMC        Y01018 18050002
STEPSD   EQU   8                        ENTRY CODE FOR STATUS   YS02019 18100002
         SPACE 2                                                        18300002
***                                                                     18400002
***                 OTHER EQUATES                                       18500002
***                                                                     18600002
MOVECODE EQU   19                       QTIP ENTRY CODE FOR MOVE        18800002
BKSPCHAR EQU   X'16'                    BACKSPACE                       19200002
BLNKCHAR EQU   X'40'                    BLANK                           19300002
         EJECT                                                  YS02019 19350002
*********************************************************************** 19350402
***                                                             YS02019 19350802
***            THIS MODULE IS BRANCH ENTERED FROM IGC0009C      YS02019 19352002
***            HOLDING THE LOCAL LOCK                           YS02019 19354002
***                                                             YS02019 19354102
*********************************************************************** 19354402
         SPACE 3                                                        19356002
***                                                                     19360002
***                ESTABLISH ADDRESSABILITY AND                         19362002
***                INITIALIZE EXTENDED SAVE AREA FIELDS                 19370002
***                                                                     19380002
         BALR  RBASE,R0                 SET ADDRESSABILITY              19400002
         USING *,RBASE                                                  19500002
         USING TCB,RTCB                                                 19700002
         USING TIOCRPT,RRPT                                             20000002
         USING RBSECT,RSVRB                                      M0094  20200002
         B     INIT                     AROUND I.D.             YS02019 20250002
         DC    C'IGG09302'              MODULE I.D.             YS02019 20260002
         DC    X'5237'                  DATE - 08/25/75        @ZA05569 20270003
INIT     DS    0H                       BRANCH TARGET           YS02019 20280002
         MVC   XSAF,XSAFLAG             INITIALIZE FLAGS         M0094  20300002
         MVC   XSAUBFRS,XSAPRMSZ        ASSUME NO TRAILING       Y01018 20500002
*                                       BLANKS                   Y01018 20600002
         MVC   XSAUBFRP+K1(K3),XSAPRM1+K1 SET UP USER BFR PTR    Y01018 20700002
         STH   RTJID,XSATJID            SAVE CALLER'S ASID      YS02019 20750002
         SPACE 3                                                YS02019 20801002
*********************************************************************** 20802002
*                                                                     * 20803002
*                   LOCATE DESTINATION TSB, ASCB, AND CSCB            * 20804002
*                                                                     * 20805002
*********************************************************************** 20806002
         SR    RBUF,RBUF                                        YS02019 20807002
         IC    RBUF,TIOCTSBS            INCREMENT AMOUNT=SIZE   YS02019 20808002
         LR    RWRK,RBUF                FOR MULTIPLICATION      YS02019 20809002
         LH    RWRK1,TIOCNTSB           GET NO. OF TSBS         YS02019 20810002
         BCTR  RWRK1,R0                 SUBTRACT ONE            YS02019 20811002
         MR    RWRK,RWRK                GET OFFSET OF LAST TSB  YS02019 20812002
         LR    RCVT,RWRK1               CHANGE REGS FOR BXLE    YS02019 20813002
         L     RTSB,TIOCTSB-K1          GET ORIGIN OF TABLE     YS02019 20814002
         LA    RTSB,K0(,RTSB)           CLEAR HIGH ORDER BYTE   YS02019 20814102
         USING TSB,RTSB                                         YS02019 20814402
         AR    RCVT,RTSB                ADD TO OFFSET           YS02019 20815002
         SPACE 2                                                YS02019 20816002
*********************************************************************** 20817002
*                                                                     * 20818002
*                   REGISTERS 2, 3, AND RTSB ARE SET FOR A BXLE LOOP  * 20819002
*                   TO SCAN THE TSB TABLE -                           * 20820002
*                    RBUF (2), INCREMENT, HAS THE TSB SIZE,           * 20821002
*                    RCVT (3), COMPARAND, POINTS TO THE LAST TSB IN   * 20822002
*                      THE TSB TABLE, AND                             * 20823002
*                    RTSB, INDEX, POINTS TO THE FIRST TSB IN THE TSB  * 20824002
*                      TABLE                                          * 20825002
*                                                                     * 20826002
*                   NOW, THE TSB'S, AND ASSOCIATED ASCB'S (AND CSCB'S)* 20827002
*                   WILL BE SCANNED FOR A MATCH ON THE ASID OR        * 20828002
*                   THE USERID.                                       * 20829002
*                                                                     * 20830002
*                  THE ASVT CANNOT BE USED, BECAUSE IT MUST BE        * 20830402
*                  STABILIZED WITH THE DISPATCHER LOCK, AND HOLDERS   * 20830802
*                  OF THIS LOCK MUST BE FIXED AND DISABLED.           * 20830902
*                                                                     * 20832002
*********************************************************************** 20834002
         SPACE 3                                                        20834402
***                                                                     20834802
***                NEED CMS LOCK FOR TSB                        YS02019 20836002
***                                                                     20838002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019-20840002
               RELATED=(TSB,IGG09302(TPT0100))                  YS02019 20840102
***                                                                     20840402
***                 MAKE SURE TIME SHARING IS STILL ACTIVE              20840502
***                                                                     20840602
         L     RRPT,CVTPTR              GET CVT POINTER         YS02019 20843102
         L     RRPT,CVTAQAVT-CVT(,RRPT) GET TCX POINTER         YS02019 20847502
         LTR   RRPT,RRPT                IS TCAM UP              YM01564 20849502
         BZ    TPT7500                  NO, ABORT THIS TPUT     YM01564 20849902
         L     RRPT,TCXRPT-IEDQTCX(,RRPT) GET RPT POINTER       YS02019 20850002
         LTR   RRPT,RRPT                CHECK FOR ZERO          YS02019 20852502
         BZ    TPT7500                  ZERO, ABORT THIS TPUT   YS02019 20855002
         SPACE 1                                                YS02019 20857502
         TM    XSAOPTNS,MUSERP          WAS USERID SPECIFIED    YS02019 20860002
         BO    TPT0020                  YES, GO LOOK FOR IT     YS02019 20862502
         SPACE 2                                                YS02019 20865002
***                                                             YS02019 20867502
***                 SCAN FOR ASID MATCH                         YS02019 20870002
***                                                             YS02019 20872502
         LH    RSAVE,XSAPRMTJ           GET SPECIFIED ASID      YS02019 20875002
TPT0010  EQU   *                                                YS02019 20877502
         L     RASCB,TSBASCBA           GET ASCB POINTER        YS02019 20880002
         LTR   RASCB,RASCB              IS THERE ONE            YS02019 20882502
         BZ    TPT0015                  NO, CONTINUE SCAN       YS02019 20885002
         USING ASCB,RASCB                                       YS02019 20887502
         CH    RSAVE,ASCBASID           CHECK ASID              YS02019 20890002
         BE    TPT0027                  IF SAME, THIS IS IT     YS02019 20892502
TPT0015  EQU   *                                                YS02019 20895002
         BXLE  RTSB,RBUF,TPT0010        CONTINUE SCAN           YS02019 20897502
         B     TPT7500                  GO GIVE 'NOT HERE' CODE YS02019 20900002
         SPACE 2                                                YS02019 20902502
***                                                             YS02019 20905002
***                 SCAN FOR USERID MATCH                       YS02019 20907502
***                                                             YS02019 20910002
TPT0020  EQU   *                                                YS02019 20912502
         L     RWRK1,XSAUSERP           GET PTR TO USER ID              20915002
TPT0021  EQU   *                                                YS02019 20917502
         L     RASCB,TSBASCBA           GET ASCB POINTER        YS02019 20920002
         LTR   RASCB,RASCB              IS THERE ONE            YS02019 20922502
         BZ    TPT0022                  NO, GET NEXT            YS02019 20925002
         L     RWRK,ASCBCSCB            GET CSCB POINTER        YS02019 20927502
         USING CSCB,RWRK                                        YS02019 20930002
         CLC   CHKEY,0(RWRK1)           CHECK USERID            YS02019 20932502
         BNE   TPT0022                  NOT THIS TSB            YS02019 20934502
***                                                                     20936502
***   WHEN A MATCHING USERID IS FOUND, SAVE ASID IN TPUT WORK AREA      20936902
***                                                                     20937302
         LH    RWRK1,ASCBASID           GET DESTINATION ASID    YS02019 20937402
         STH   RWRK1,XSAPRMTJ           SAVE IT IN WORK AREA    YS02019 20943202
         B     TPT0027                  GO TO PROCESS IT        YS02019 20945202
         SPACE 1                                                        20947202
TPT0022  EQU   *                                                YS02019 20949202
         BXLE  RTSB,RBUF,TPT0021        LOOK AT EACH TSB        YS02019 20955002
         B     TPT7500                  GO GIVE 'NOT HERE' CODE YS02019 20960802
*                                       AFTER ALL TSB'S CHECKED YS02019 20966602
         DROP  RWRK                                             YS02019 20972402
         SPACE 2                                                YS02019 20978202
TPT0027  EQU   *                                                YS02019 20984002
***                                                             YS02019 20989802
***   RTSB = DESTINATION TSB, RASCB = DESTINATION ASCB          YS02019 20995602
***                                                             YS02019 21001402
         SETLOCK RELEASE,TYPE=CMS,RELATED=('BEFORE SVC')        YS02019 21007202
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=('BEFORE SVC')      YS02019 21013002
***                                                                     21018802
***                TEST AUTHORIZATION OF USER.  '+' SIGN AND CHECK FOR  21024602
***                'HIPRI' DEPEND ON THIS                               21030402
***                                                                     21036202
         TESTAUTH FCTN=1,KEY=YES,STATE=YES,RBLEVEL=2,BRANCH=YES YS02019 21042002
         L     RCVT,CVTPTR              RESTORE REG 3           YS02019 21047802
         USING CVT,RCVT                                         YS02019 21053602
         LTR   RCODE,RCODE              TEST RETURN CODE        YS02019 21059402
         BNZ   TPT0028                  SKIP BIT IF NOT ZERO    YS02019 21065202
         OI    XSAF,XSAAUTH             REMEMBER RETURN CODE    YS02019 21071002
         SPACE 2                                                YS02019 21076802
TPT0028  EQU   *                                                YS02019 21082602
*********************************************************************** 21088402
****                                                               **** 21094202
****                SEE IF NOWAIT OPTION CAN PROCEED               **** 21100002
****                                                               **** 21200002
*********************************************************************** 21300002
         TM    XSAOPTNS,MWAIT           NOWAIT SPECIFIED         M0094  21400002
         BNO   TPT0075                  NO, PROCEED WITH TPUT   YS02019 21500002
***                                                                     21600002
***                 TEST AVAILABILITY OF ENQUEUED RESOURCES             21700002
***                                                                     21800002
         MVC   XSAENQNM(K12),QNAME      INIT ENQ/DEQ PARMS       YM0895 21900002
         LA    RWRK2,XSAENQAD           GET PT TO ENQ WORK AREA  M0094  22000002
         ENQ   (XSAENQNM,ASCBASID,E,2,SYSTEM),RET=USE,MF=(E,(1))        22100002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YM03998*22150002
               RELATED=(TSB,IGG09302(TGT9600))                  YM03998 22160002
         LTR   RCODE,RCODE              WAS CONTROL ASSIGNED    YM03998 22200002
*                                       FROM ENQUEUE            YM03998 22250002
         BNZ   TPT0070                  IF NOT, RETURN                  22300002
         OI    XSAF,XSAIDENQ            INDICATE TO ESTAE EXIT  YS02019 22350002
*                                       ROUTINE ASID TPUT ENQ'D YS02019 22360002
***                                                                     22400002
***   CALCULATE NUMBER OF BUFFERS REQUIRED TO HOLD MESSAGE,             22500002
***   ASSUMING NO TRAILING BLANKS                                       22600002
***   NUMBER=(MSGLEN+(HDRSIZE-TRLSIZE))/(BUFSIZE-TRLRSIZE)              22700002
***                                                                     22800002
         SPACE 1                                                 Y01018 22900002
         SR    RWRK,RWRK                                         Y01018 23000002
         LH    RWRK1,XSAPRMSZ           GET LENGTH OF MSG        Y01018 23100002
         LA    RWRK1,BUFFHDLN-BUFFTRLN(,RWRK1) ADD EXTRA FOR     Y01018 23200002
*                                       HEADER PREFIX                   23300002
         LA    R0,BUFFTRLN              GET LENGTH OF TRLR PREF  Y01018 23400002
         SH    R0,TIOCBFSZ              WHAT'S LEFT OVER (COMP)  Y01018 23500002
         LPR   R0,R0                    GET BUFSIZE - TRLR PREF  Y01018 23600002
***   R0 = AMOUNT OF ROOM IN EACH BUFFER FOR REAL DATA                  23700002
***   R14 + 15 = AMOUNT OF DATA THAT MUST GO INTO BUFFERS               23800002
         DR    RWRK,R0                  GET NUMBER OF BUFFERS    Y01018 23900002
*                                       REQ                      Y01018 24000002
         LA    RWRK1,K1(,RWRK1)         ADD 1 FOR POSSIBLE       Y01018 24100002
*                                       REMAINDER                Y01018 24200002
         SPACE                                                          24300002
TPT0030  EQU    *                                                       24400002
***                                                                     24500002
***                 RWRK1 HAS NUMBER OF BUFFERS MESSAGE WILL NEED.      24600002
***                 TPUT NOWAIT CAN PROCEED IF                          24700002
***                    1.) RWRK1 LTE TIOCNFBF - TIOCUSLW, AND           24800002
***                    2.) RWRK1 + TSBNOBF LTE TIOCAOMX OR TIOCAOMX * 3 24900002
***                       IF THE MONITOR SUBCOMMAND IS ACTIVE           25000002
***                       (TSBGETBF NE 0).                              25100002
***                                                                     25200002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*25400002
               RELATED=(TSB,IGG09302(TPT9700))                  YS02019 25450002
         TM    TSBFLG1,TSBOWIP          IS A TPUT IN PROGRESS           25600002
         BNZ   TPT0072                  YES, CAN'T DO IT        YM03998 25700002
         LH    RWRK2,TIOCNFBF           NO. FREE BFRS                   25800002
         SH    RWRK2,TIOCUSLW           MINUS THRESHOLD                 25900002
         CR    RWRK2,RWRK1              COMPARE WITH BFRS NEEDED        26000002
         BL    TPT0072                  NEEDED GT AVAILABLE     YM03998 26100002
*                                       = BRANCH                YM03998 26150002
***                                                                     26200002
***                 ADEQUATE BFRS AVAILABLE.  CHECK AOMX.               26300002
***                                                                     26400002
         LH    RWRK2,TIOCAOMX           GET MAX VALUE                   26500002
         TM    TSBFLG4,TSBGETBF         MONITOR SUBCMD ACTIVE   YS02019 26600002
         BZ    TPT0040                  NO, DON'T INCREASE AOMX         26700002
         AR    RWRK2,RWRK2              DOUBLE                   Y01018 26800002
         AH    RWRK2,TIOCAOMX           ADD 1 TO MAKE *3                26900002
TPT0040  EQU   *                                                        27000002
         SR    RBUF,RBUF                                                27100002
         IC    RBUF,TSBNOBF             GET NO. ALREADY ON OUTPUT QUEUE 27200002
         SR    RWRK2,RBUF               SUBTRACT FROM NUMBER ALLOWED    27300002
         CR    RWRK2,RWRK1              COMPARE NEEDED WITH ALLOWED     27400002
         BNL   TPT0080                  ALLOWED GTE NEEDED, SO  YS02019 27500002
*                                       PROCEED WITH TPUT       YS02019 27550002
         B     TPT0072                  RELEASE LOCKS          @ZA05569 27570003
         SPACE 1                                                        27600002
TPT0070  EQU   *                                                        27700002
***                                                                     27800002
***                 CAN'T PUT OUT MESSAGE WITHOUT WAITING.              27900002
***                 RETURN WITH CODE = 4.                               28000002
***                                                                     28100002
         LA    RCODE,RCNOWT             SET CODE                        28200002
         B     TPT9650                  CLEAN UP AND RETURN             28300002
         SPACE 1                                                YM03998 28350002
TPT0072  EQU   *                                                YM03998 28360002
         LA    RCODE,RCNOWT             SET RETURN CODE         YM03998 28370002
         B     TPT9625                  FREE LOCKS AND RETURN   YM03998 28380002
         SPACE 1                                                 Y01018 28400002
TPT0075  EQU   *                                                        29350002
         SPACE 2                                                 TS1634 29400002
*********************************************************************** 29500002
****                                                               **** 29600002
****                ENQ ON ASID, SINCE ONLY 1 TPUT AT A TIME       **** 29700002
****                CAN USE TSB                                    **** 29800002
****                                                               **** 29900002
*********************************************************************** 30000002
         SPACE                                                          30300002
         MVC   XSAENQNM(K12),QNAME      INIT ENQ/DEQ PARMS       YM0895 30400002
         LA    RWRK2,XSAENQAD           GET PT TO ENQ WORK AREA  M0094  30500002
         ENQ   (XSAENQNM,ASCBASID,E,2,SYSTEM),MF=(E,(1))        YS02019 30600002
         OI    XSAF,XSAIDENQ            INDICATE TO ESTAE EXIT  YS02019 30602002
*                                       ROUTINE ASID TPUT ENQ'D YS02019 30604002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YS02019*30610002
               RELATED=(TSB,IGG09302(TPT0100))                  YS02019 30620002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*30630002
               RELATED=(TSB,IGG09302(TPT0100))                          30640002
TPT0080  EQU   *                                                YS02019 30650002
***                                                             YS02019 30660002
***                 INITIALIZATION                                      30670002
***                                                                     30680002
         SPACE 2                                                 TS1634 30700002
         BAL   RBUF,TPT6000             CHECK STATUS             TS0034 30800002
         LH    RTJID,XSATJID            GET ASID FROM WHERE 9C  YS02019 31050002
*                                       SAVED IT                YS02019 31060002
         SR    RSAVE2,RSAVE2                                            31100002
         LR    RCODE,RSAVE2             SET RETURN CODE TO 0            31200002
         CH    RSAVE2,XSAPRMSZ          IS MESSAGE LENGTH ZERO   M0094  31300002
         BE    TPT9625                  GET OUT                 YM03998 31400002
         SPACE 2                                                        31600002
         TM    TSBSTAT,TSBITOFF         IS INTER-TERMINAL               31700002
*                                       COMMUNICATION ALLOWED           31800002
         BZ    TPT0100                  IF ALLOWED                      31900002
         LA    RCODE,RCNOIT             RETURN CODE                     32000002
         TM    XSAF,XSAAUTH             IS CALLER AUTHORIZED    YS02019 32100002
         BNO   TPT9625                  NO, DON'T OVERRIDE      YM03998 32200002
         TM    XSAOPTNS,MLOWP           IF AUTHORIZED, CHECK PRTY M0094 32300002
*                                       LEVEL                    S21A12 32400002
         BO    TPT9625                  IF LOWP, ABORT TPUT     YM03998 32500002
         SPACE 2                                                        32600002
TPT0100  EQU   *                                                        32700002
         TM    TSBFLG1,TSBOWIP          IS NORMAL TPUT GOING     TS1634 32800002
         BNO   TPT0350                  GO AHEAD IF NOT          TS1634 32900002
***                                                                     33000002
***                 WAIT ON TSBECB FOR NORMAL TPUT TO COMPLETE          33100002
***                                                                     33200002
         MVI   TSBECB,K0                RESET WAIT+POST BITS     TS1634 33300002
         STH   RTJID,TSBWTJID           SHOW WHO'S WAITING       TS1634 33400002
         STCM  RTCB,SEVEN,TSBWTCB       STORE WAITING TCB ADDR   Y01018 33600002
         OI    TSBFLG3,TSBAWOIP         SHOW WE ARE WAITING     YS02019 33620002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGG09302(TPT0100))       33640002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,IGG09302(TPT0100))     33660002
         WAIT  ECB=TSBECB,LONG=YES                              YS02019 34300002
         SPACE 2                                                 TS1634 34400002
***                                                                     34500002
***                 AFTER POST, DISABLE AND CHECK AGAIN                 34600002
***                                                                     34700002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YS02019*34800002
               RELATED=(TSB,IGG09302(TPT9600))                  YS02019 34900002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*35000002
               RELATED=(TSB,IGG09302(TPT9700))                          35100002
         LH    RTJID,TSBWTJID           RESTORE TJID            YS02019 35200002
         BAL   RBUF,TPT6000             CHECK USER'S STATUS      TS1634 35400002
         B     TPT0100                  CHECK OWIP AGAIN                35500002
         SPACE 2                                                        35600002
TPT0350  EQU   *                                                        35700002
***                                                                     35800002
***                 CHECK EDIT OPTION                                   35900002
***                                                                     36000002
         OI    TSBFLG1,TSBOWIP+TSBTJIP  SIEZE TSB                       36100002
         OI    XSAF,OSW                 INDICATE WE SET TSBOWIP  YM0895 36300002
         ST    RTCB,TSBCTCB             STORE CURRENT TCB ADDRESS       36500002
         STH   RTJID,TSBWTJID           STORE CURRENT TJID              36600002
         OI    XSAF,XSADMOVE            INDICATE DATA MOVEMENT  YM05387 36650002
         TM    XSAOPTNS,MCNTRL+MASIS    CONTROL OR ASIS OPTION   M0094  36700002
         BM    TPT0600                  IF EITHER SKIP EDIT             36800002
         BZ    TPT0475                  IF EDIT, GO REMOVE      SA61765 36850002
***                                                                     36860002
***      MUST BE AN ATTEMPT AT FULL-SCREEN TJID TPUT.  QUASH IT.        36870002
***                                                                     36880002
         NI    XSAOPTNS,OFF-MCNTRL      FORCE ASIS ONLY         SA61765 36890002
         B     TPT0600                  SKIP BLANK REMOVAL      SA61765 36892002
TPT0475  EQU   *                                                SA61765 36894002
         SPACE 2                                                        36900002
***                                                                     37000002
***                 REMOVE TRAILING BLANKS                              37100002
***                                                                     37200002
         L     RWRK,XSAPRM1             GET USER BUFFER POINTER  M0094  37300002
         LA    RWRK,K0(R0,RWRK)         CLEAR FIRST BYTE                37400002
         LH    RWRK1,XSAPRMSZ           USER BUFFER SIZE         M0094  37500002
         AR    RWRK,RWRK1               PTR TO USER BFR END+1           37600002
         SPACE 2                                                        37700002
TPT0400  EQU   *                                                        37800002
         BCTR  RWRK,R0                  DECREMENT POINTER               37900002
         CLI   K0(RWRK),BLNKCHAR        IS CHARACTER BLANK              38000002
         BNE   TPT0500                  IF NOT QUIT REMOVAL             38100002
         BCT   RWRK1,TPT0400            BR IF BFR SIZE NOT ZERO  Y01018 38200002
         SPACE 2                                                        38300002
***                                                                     38400002
***                 NO DATA LEFT AFTER REMOVING BLANKS - SEND NL ONLY   38500002
***                                                                     38600002
         LA    RWRK1,NEWLINE            POINT TO NL CHAR                38700002
         STCM  RWRK1,SEVEN,XSAPRM1+K1   POINT AT NL CHAR         Y01018 38900002
         OI    XSAOPTNS,MASIS           FORCE ASIS OPTION SO NL  M0094  39700002
*                                       CAN GET THROUGH                 39800002
         LA    RWRK1,K1                 INDICATE LENGTH OF 1            39900002
         SPACE 2                                                        40000002
TPT0500  EQU   *                                                        40100002
         STH   RWRK1,XSAPRMSZ           UPDATE USER BFR SIZE     M0094  40200002
         SPACE 2                                                        40300002
TPT0600  EQU   *                                                        40400002
***                                                                     40500002
***                 CHECK BUFFER AVAILABILITY                           40600002
***                                                                     40700002
         LH    RWRK,TIOCAOMX            GET NORMAL MAX                  40800002
         TM    TSBFLG4,TSBGETBF         MONITOR SUBCMD ACTIVE   YS02019 40840002
         BNO   TPT0625                  NO, DON'T INCREASE AOMX         41000002
         AR    RWRK,RWRK                DOUBLE IT                Y01018 41100002
         AH    RWRK,TIOCAOMX            ADD ONE TO GET 3                41200002
TPT0625  EQU   *                                                        41300002
         SR    RWRK2,RWRK2                                              41400002
         IC    RWRK2,TSBNOBF            NUMBER ALREADY ON OUT QUEUE     41500002
         CR    RWRK2,RWRK               SHOULD BE LESS THAN MAX         41600002
         BNL   TPT0700                  IF NOT, WAIT                    41700002
         SR    RWRK,RWRK                                         TS1634 41800002
         TM    TSBFLG4,TSBGETBF         MONITOR SUBCMD ACTIVE   YS02019 41840002
         BZ    TPT0650                  NO, DON'T RESTRICT              42000002
         LH    RWRK,TIOCUSLW            DON'T USE LAST BUFFERS          42100002
TPT0650  EQU   *                                                        42200002
         CH    RWRK,TIOCNFBF            ANY FREE BUFFERS         TS1634 42300002
         BL    TPT1000                  IF SO, GO PROCESS ONE    TS1634 42400002
***                                                                     42500002
***                 NO FREE BUFFERS - SET BITS IN RPT AND TSB           42600002
***                    AND WAIT                                         42700002
***                                                                     42800002
         OI    TSBFLG1,TSBTJBF          SHOW WHICH TASK WAITING  TS1634 42900002
         OI    TIOCFLG,TIOCTJBF         SET SYSTEM INDICATOR     TS1634 43000002
         B     TPT0800                  WAIT                     TS1634 43100002
TPT0700  EQU   *                                                 TS1634 43200002
         OI    TSBFLG1,TSBTJOW          INDICATE WHY WAITING     TS1634 43300002
TPT0800  EQU   *                                                        43400002
*********************************************************************** 43500002
*****                                                             ***** 43600002
*****               ROUTINE FOR WAITING ON ECB                    ***** 43700002
*****                                                             ***** 43800002
*********************************************************************** 43900002
         SPACE                                                          44000002
         TM    XSAF,PSW                 DOES TCAM NEED TO BE     M0094  44100002
*                                       POSTED FOR PARTIAL MSG          44200002
         BZ    TPT0900                  BRANCH IF ZEROES                44300002
         SPACE 2                                                        44400002
***                                                                     44500002
***                 CHECK IF NEXT CHAR TO BE SENT IS A BACKSPACE        44600002
***                                                                     44700002
         L     RWRK,XSAUBFRP            GET PTR TO NEXT CHAR     M0094  44800002
         CLI   K0(RWRK),BKSPCHAR        IS NEXT CHAR BACKSPACE          44900002
         BNE   TPT0830                  IF NOT                          45000002
         OI    TSBFLG3,TSBNBKSP         INDR FOR OUTPUT EDIT            45100002
         SPACE 2                                                        45200002
TPT0830  EQU   *                                                        45300002
***                                                             YS02019 45320002
***                 GO TO SUBROUTINE TO TPOST TSB AND POST TCAM YS02019 45330002
***                                                             YS02019 45340002
         BAL   RBUF,TPT9900             GO TO SUBROUTINE        YS02019 45350002
         SPACE 2                                                        48000002
TPT0900  EQU   *                                                        48100002
***                                                                     48200002
***                 WAIT ON ECB                                         48300002
***                                                                     48400002
         SR    RWRK,RWRK                                        YS02019 48500002
         ST    RWRK,TSBECB              CLEAR OUT ECB           YS02019 48550002
         IC    RWRK,TSBWTCB-K1          SAVE FLAGS                      48600002
         STCM  RTCB,SEVEN,TSBWTCB       STORE WAITING TCB ADDR   Y01018 48800002
         SETLOCK RELEASE,TYPE=CMS,RELATED=('BEFORE SVC')        YS02019 49340002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=('BEFORE SVC')      YS02019 49360002
         WAIT  ECB=TSBECB,LONG=YES                              YS02019 49400002
         SPACE 2                                                        49500002
***                                                                     49600002
***                 UPON POST OF ECB                                    49700002
***                                                                     49800002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YS02019*49940002
               RELATED=(TSB,IGG09302(TPT9700))                  YS02019 49950002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*50000002
               RELATED=(TSB,IGG09302(TPT9600))                  YS02019 50050002
         BAL   RBUF,TPT6000             CHECK USER'S STATUS      TS1634 50500002
         B     TPT0600                  RECHECK BFR AVAILABILITY        50600002
         SPACE 3                                                        50700002
TPT1000  EQU   *                                                        50800002
         SPACE 2                                                        50900002
*********************************************************************** 51000002
***                                                                   * 51100002
***            QTIP WILL NOW BE BRANCHED TO TO ACCOMPLISH             * 51200002
***                                                                   * 51300002
***                 1- FIND THE PROPER PLACE ON THE OUTPUT            * 51400002
***                    QUEUE TO PUT THE NEXT BFR.                     * 51500002
***                                                                   * 51600002
***                 2- PLACE FIRST FREE BUFFER ONTO OUTPUT QUEUE.     * 51700002
***                                                                   * 51800002
***                 3- UPDATE PTR AND COUNT OF OUTPUT QUEUE           * 51900002
***                                                                   * 52000002
***                 4- MOVE EITHER ALL REMAINING DATA, OR AS MUCH AS  * 52100002
***                    BUFFER WILL HOLD WHICHEVER IS LESS.            * 52200002
***                                                                   * 52300002
***                 5- UPDATE USER BUFFER SIZE AND POINTER IN SVRB    * 52400002
***                    EXTENDED SAVE AREA (XSUBFRS AND XSAUBFRP)      * 52500002
***                                                                   * 52600002
*********************************************************************** 52700002
         SPACE 2                                                        52800002
TPT1100  EQU   *                                                        53900002
         LA    RSAVE,MOVECODE           ENTRY CODE                      54000002
         L     RGOTO,TIOCQTIP           ENTRY POINT OF QTIP     YS02019 54040002
         LA    RAVT,TIOCSAVE            SAVE AREA FOR QTIP      YS02019 54200002
         BALR  RETURN,RGOTO             GO TO QTIP                      54300002
         SPACE 2                                                        54400002
***                                                                     54500002
***                 UPON RETURN FROM QTIP                               54600002
***                                                                     54700002
         SPACE                                                          54800002
         NI    XSAF,OFF-XSADMOVE        DATA MOVEMENT DONE      YS02019 54900002
         OI    XSAF,PSW+HSW             SHOW PART OF MSG ON Q    M0094  55000002
*                                       AND HEADER BFR DONE             55100002
         SPACE 2                                                        55300002
***                                                                     55400002
***                 CHECK FOR EOM                                       55500002
***                                                                     55600002
         SR    RBUF,RBUF                                         M0094  55700002
         CH    RBUF,XSAUBFRS            HAS ALL DATA BEEN MOVED  M0094  55800002
         BE    TPT9000                  DONE IF SO                      55900002
         LA    RBUF,TPT0600             SUBR WILL RETURN TO      Y01018 56800002
*                                       GET NEXT BUFFER                 56900002
         SPACE 4                                                        57000002
TPT6000  EQU   *                                                 TS1634 57100002
*********************************************************************** 57200002
****                                                                    57300002
****                SUBROUTINE TO CHECK USER'S STATUS                   57400002
****                                                                    57500002
*********************************************************************** 57600002
         LA    RWRK2,TPT7500            GET ABORT ADDR           Y01018 57700002
         TM    CVTTCMFG,CVTTCRDY        IS TCAM UP               TS0034 57800002
         L     RRPT,CVTAQAVT            TCX PTR FOR LATER TEST  YS02019 57850002
         BNOR  RWRK2                    ABORT IF TCAM NOT UP     Y01018 57900002
         TM    TSBSTAT,TSBINUSE         STILL ACTIVE            YS02019 58000002
         L     RRPT,TCXRPT-IEDQTCX(,RRPT) RPT PT FOR LATER TEST YS02019 58050002
         BNOR  RWRK2                    ABORT IF NOT ACTIVE      Y01018 58100002
         TM    TSBSTAT,TSBDISC          DISCONNECTING           YS02019 58110002
         BNZR  RWRK2                    YES, ABORT              YS02019 58120002
         LTR   RRPT,RRPT                TEST VALUE OF RPT PTR   YS02019 58130002
         BZR   RWRK2                    IF ZERO, TS DOWN        YS02019 58132002
         TM    TSBFLG4,TSBHUNG          USER HUNG UP            YS02019 58140002
         BNOR  RBUF                     NO, RETURN TO CALLER     Y01018 58500002
         SPACE 2                                                 TS1634 58600002
TPT7500  EQU   *                                                        58700002
***                                                                     58800002
***                 CALLED TASK NO LONGER ACTIVE RETURN                 58900002
***                                                                     59000002
         LA    RCODE,RCGONE             RETURN CODE                     59100002
         TM    XSAF,OSW                 SHOULD TSB BE RESET     YS02019 59150002
         BNO   TPT9625                  NO, DON'T RESET         YS02019 59170002
         B     TPT9600                  RETURN                          59200002
         SPACE 4                                                        59300002
TPT9000  EQU   *                                                        60900002
***                                                                     61000002
***                 SUCCESSFUL RETURN                                   61100002
***                                                                     61200002
         SR    RCODE,RCODE              INDICATE SUCCESS         YM0895 61400002
         STH   RCODE,XSARC              SAVE RETURN CODE        YS02019 61500002
         SPACE                                                          61800002
***                                                             YS02019 61820002
***                 GO TO TPOST SUBROUTINE                      YS02019 61830002
***                                                             YS02019 61840002
         BAL   RBUF,TPT9900             GO TO SUBROUTINE        YS02019 61850002
         SPACE 3                                                        63700002
TPT9100  EQU   *                                                        63800002
***                                                                     63900002
***                 CHECK TO SEE IF SMF IS UP                           64000002
***                                                                     64100002
         ICM   RWRK,B'0111',TCBTCTB     GET & TEST TCT ADDRESS  YS02019 64200002
         BZ    TPT9200                  IF NOT                          64500002
         SPACE 2                                                        64600002
***                                                                     64700002
***                 UPDATE LINE COUNT IF UP                             64800002
***                                                                     64900002
         USING SMFTCT,RWRK                                              65000002
         L     RWRK2,TCTLOUT            OLD COUNT                       65100002
         LA    RWRK2,K1(R0,RWRK2)       ADD ONE TO COUNT                65200002
         ST    RWRK2,TCTLOUT                                            65300002
         DROP  RWRK                                                     65400002
         SPACE 2                                                        65500002
TPT9200  EQU   *                                                        65600002
***                                                             YS02019 65618002
***        INFORM SYSTEM RESOURCE MANAGER OF SUCCESSFUL TPUT    YS02019 65627002
***                                                             YS02019 65636002
         LH    RWRK2,XSAPRMSZ           AMOUNT OF DATA SENT     YS02019 65645002
         LA    RAVT,TIOCSAVE            SAVE AREA PTR FOR SYSEV YS02019 65647002
         O     RWRK2,TSIPSIGN           HI BIT MEANS TPUT       YS02019 65654002
         SYSEVENT TGETTPUT,ASIDL=XSATJID,ENTRY=BRANCH           YS02019 65672002
         SPACE 2                                                        67200002
TPT9400  EQU   *                                                        67300002
***                                                                     67400002
***                 CHECK FOR WAITING ON OWAIT TASKS                    67500002
***                                                                     67600002
         TM    TSBFLG1,TSBWOWIP         ANY TASKS WAITING               67700002
         BZ    TPT9600                  IF NOT                          67800002
         SPACE 2                                                        67900002
***                                                                     67908002
***                 GO TO 'STATUS' TO REMOVE WAITING TASKS FROM OWAIT   67912002
***                                                                     67916002
***                 REGISTERS FOR STATUS -                              67920002
***                                                                     67924002
***                                                                     67928002
***            0 (R0) - HIGH HALF = ASID, LO HALF = ENTRY CODE (8)      67932002
***            1 (RWRK2) - HI BIT MUST BE ON, OTHERS OFF                67936002
***            13 (RAVT) - MASK OF SECONDARY BITS TO BE RESET           67940002
***            14,15 (RETURN, RGOTO) - CONVENTIONAL             YS02019 67944002
***                                                             YS02019 67948002
         LA    R0,STEPSD                ENTRY CODE TO RESET ALL YS02019 67952002
*                                       TASKS IN STEP           YS02019 67956002
         L     RGOTO,CVTABEND           PTR TO 2NDARY CVT       YS02019 67960002
         USING SCVTSECT,RGOTO                                   YS02019 67964002
         L     RWRK2,TSIPSIGN           HI BIT MEANS 'RESET'    YS02019 67968002
         ICM   R0,B'1100',XSAPRMTJ      ASID TO BE ACTIVATED    YS02019 67972002
         L     RGOTO,SCVTSTAT           ENTRY POINT OF STATUS   YS02019 67974002
         LA    RAVT,NDISPBIT            NONDISPATCHABILITY MASK YS02019 67976002
*                                       (TCBOWAIT, IN NDSP2)    YS02019 67980002
         BALR  RETURN,RGOTO             GO TO STATUS ROUTINE    YS02019 67988002
         SPACE 2                                                        72800002
TPT9600  EQU   *                                                        72900002
***                                                                     72910002
***                 CLEAN UP AND RETURN                                 72912002
***                                                                     72914002
         NI    TSBFLG1,OFF-(TSBOWIP+TSBTJIP) RELEASE TSB                72916002
         NI    TSBFLG3,OFF-TSBATTN      ATTN IGNORED INDR               72918002
         NI    TCBTSFLG,OFF-TCBTIOTG    ATTN HIT INDR                   72918102
         SPACE 2                                                YS02019 72918402
TPT9625  EQU   *                                                YS02019 72918802
***                                                             YS02019 72920002
***                 ALL DONE WITH CMS LOCK                      YS02019 72930002
***                                                             YS02019 72940002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGG09302)        YS02019 72950002
         SPACE 1                                                        73600002
TPT9650  EQU   *                                                        73700002
***                                                                     73800002
***                TURN OFF TCBFX IF OFF AT ENTRY                       73900002
***                                                                     74000002
         TM    XSAF,XSATCBFX            SHOULD WE TURN OFF TCBFX M0094  74100002
         BZ    TPT9700                  SKIP IF NOT                     74200002
         NI    TCBFLGS1,OFF-TCBFX       ALLOW ASYNCHRONOUS EXITS        74300002
TPT9700  EQU   *                                                        74400002
***                                                             YS02019 74420002
***                 ALL DONE WITH LOCAL LOCK                    YS02019 74430002
***                                                             YS02019 74440002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,IGG09302)      YS02019 74450002
         SPACE 2                                                        74500002
***                                                                     74600002
***                 DEQ FROM TJID TO RELEASE ENQUEUED TASKS             74700002
***                                                                     74800002
         SPACE                                                          74900002
         LR    RSAVE2,RCODE             SAVE RETURN CODE                75000002
         MVC   XSAENQNM(K12),QNAME      RESET ENQ/DEQ PARMS      M0094  75100002
         LA    RWRK2,XSAENQAD           GET ADDR OF ENQ WRK AREA M0094  75200002
         DEQ   (XSAENQNM,ASCBASID,2,SYSTEM),RET=HAVE,MF=(E,(1)) YS02019 75300002
         NI    XSAF,OFF-XSAIDENQ        RESET ASID ENQUEUE FLAG YS02019 75350002
         SPACE 2                                                        75400002
         LR    RCODE,RSAVE2             RESTORE RETURN CODE             75500002
         L     RETURN,XSARETRG          RESTORE RETURN ADDRESS  YS02019 75600002
         BR    RETURN                   RETURN TO SUPERVISOR    YS02019 75650002
         SPACE 5                                                YS02019 75800002
*********************************************************************** 75860002
***                                                                 *** 75920002
***                 SUBROUTINE TO TPOST TSB TO IEDAYP               *** 75980002
***                                                                 *** 76040002
*********************************************************************** 76100002
TPT9900  EQU   *                                                YS02019 76160002
         LM    RP0,RP1,TSBTPOST         GET TPOSTING FIELD      YS02019 76580002
         STM   RBUF,RCVT,XSAWD7         SAVE REGISTERS 2&3      YM03998 76630002
TPT9907  EQU   *                                                YS02019 76640002
         STM   RP0,RP1,XSAWD5           MOVE TO XSA TO SET BITS YS02019 76700002
         LA    RGOTO,XSAWD5             ADDRESSABILITY          YS02019 76760002
         USING TSBTPOST,RGOTO           NEXT REFERENCES TO TSB  YS02019 76820002
*                                       TPOST & BEYOND WILL     YS02019 76880002
*                                       REALLY BE TO XSA        YS02019 76940002
         SPACE 2                                                YS02019 77000002
***                                                             YS02019 77060002
***                 IF ALL OUTPUT IS ON QUEUE, TURN OFF         YS02019 77120002
***                 QCBPARTO. ELSE, TURN IT ON                  YS02019 77180002
***                                                             YS02019 77240002
         SR    RWRK,RWRK                ZERO WORK REGISTER      YM01246 77300002
         CH    RWRK,XSAUBFRS            REMAINING SIZE ZERO     YS02019 77360002
         BNE   TPT9910                  NO, TURN ON PARTO       YS02019 77420002
         TM    XSAF,XSAPARTO            HAS PARTO BEEN SET      YM01246 77470002
         BZ    TPT9915                  NO, NO NEED TO RESET    YM01246 77472002
         NI    TSBF1V,OFF-QCBPARTO      YES, TURN OFF PARTO     YS02019 77480002
         OI    TSBF1M,QCBPARTO          ACTION BIT FOR AYP      YM01246 77530002
         NI    XSAF,OFF-XSAPARTO        RESET PARTO FLAG        YM01246 77532002
         B     TPT9915                  SKIP                    YS02019 77540002
TPT9910  EQU   *                                                YS02019 77600002
         TM    XSAF,XSAPARTO            HAS PARTO BEEN SET      YM01246 77650002
         BO    TPT9915                  YES, NO NEED TO SET     YM01246 77652002
         OI    TSBF1V,QCBPARTO          TURN ON PARTO           YS02019 77660002
         OI    TSBF1M,QCBPARTO          ACTION BIT FOR AYP      YM01246 77710002
         OI    XSAF,XSAPARTO            SET PARTO FLAG IN WA    YM01246 77712002
         SPACE 2                                                YS02019 77780002
***                                                             YS02019 77840002
***                 TURN ON QCBTPUT.  IF BREAKIN REQUEST, AND   YS02019 77900002
***                 BREAKIN IS ALLOWED, TURN ON QCBWRBRK.       YS02019 77960002
***                                                             YS02019 78010002
TPT9915  EQU   *                                                YS02019 78060002
         TM    XSAOPTNS,MBREAK          BREAKIN REQUEST         YM01176 78062002
         BO    TPT9917                  YES, SKIP TSBTPUT TEST  YM01176 78064002
         TM    TSBFLG3,TSBTPUT          ALREADY DOING A TPUT    YM01246 78070002
         BZ    TPT9917                  NO, MUST TPOST          YM01246 78070402
         TM    TSBF1M,QCBPARTO          MUST PARTO BE SET       YM01246 78070802
         BZ    TPT9930                  NO, NO NEED TO TPOST    YM08378 78072002
TPT9917  EQU   *                                                YM01246 78074002
         OI    TSBF1V,QCBTPUT           SET TPUT VALUE          YS02019 78080002
         OI    TSBF1M,QCBTPUT           ACTION BIT FOR AYP      YM03998 78130002
         TM    XSAOPTNS,MBREAK          BREAKIN REQUEST         YS02019 78140002
         BNO   TPT9920                  NI, SKIP                YS02019 78200002
         TM    TSBFLG3,TSBNOBRK         BREAKIN ALLOWED         YS02019 78260002
         BO    TPT9920                  NO, SKIP                YM01114 78320002
         OI    TSBF1V,QCBWRBRK          SET VALUE BIT           YS02019 78380002
         OI    TSBF1M,QCBWRBRK          SET ACTION BIT          YS02019 78440002
TPT9920  EQU   *                                                YS02019 78500002
         OI    TSBTPFLG,TSBPOSTO+TSBTPQCB                       YS02019 78740002
*                                       TELL AYP TO TPOST QCB,  YS02019 78800002
*                                       SHOW A TPOST IS         YS02019 78860002
*                                       OUTSTANDING             YS02019 78920002
         SPACE 2                                                YS02019 78980002
***                                                                     79040002
***                 SET BITS IN REAL TSB, USING CDS.  IF TSBPOSTO       79100002
***                 WAS ON DURING SWAP, NO NEED TO DO ACTUAL            79160002
***                 TPOST                                               79220002
***                                                                     79280002
         LM    RBUF,RCVT,XSAWD5         GET NEW BITS            YS02019 79400002
         DROP  RGOTO                                            YS02019 79460002
         CDS   RP0,RBUF,TSBTPOST        TRY TO RESET BITS       YS02019 79520002
         BNE   TPT9907                  IF CHANGED, DO IT AGAIN YS02019 79580002
         OI    TSBFLG3,TSBTPUT          SET INDR FOR FUTURE     YS03998 79630002
         LTR   RP0,RP0                  TEST TSBPOSTO (THIS TST YS02019 79640002
*                                       DEPENDS UPON            YS02019 79700002
*                                       TSBPOSTO EQU X'80')     YS02019 79750002
         BM    TPT9930                  IF ON, DON'T TPOST.     YS02019 79760002
*                                       IEDAYP WILL PICK UP     YS02019 79820002
*                                       THESE FLAGS ANYWAY      YS02019 79880002
         SPACE 2                                                YS02019 79940002
***                                                                     80000002
***                TPOST THE TSB TO IEDAYP                              80060002
***                                                                     80120002
         L     RCVT,CVTPTR                                      YS02019 80180002
         L     RTCX,CVTAQAVT            GET TCX ADDRESS         YS02019 80240002
         USING IEDQTCX,RTCX                                     YS02019 80300002
         L     RWRK,TCXTSI              GET TSINPUT QCB ADDRESS YS02019 80360002
         USING IEDQTSI,RWRK                                     YS02019 80420002
         LA    RWRK,TSITSAP-(QCBSTVTO-IEDQQCB)                  YS02019 80480002
*                                       ADDRESS OF IEDAYP'S     YS02019 80540002
*                                       'QCB'                   YS02019 80600002
         ST    RWRK,TSBRQCB             QCB TO WHICH TSB WILL   YS02019 80660002
*                                       BE TPOSTED              YS02019 80720002
         L     RWRK,TCXREADY            GET CONTENTS OF READY Q YS02019 80780002
TPT9925  EQU   *                                                YS02019 80840002
         ST    RWRK,TSBLINKA            LINK TSB TO NEXT ELEM   YS02019 80900002
         MVI   TSBPRI,PRIDESTQ          SET PRIORITY            YS02019 80950002
         LA    RSAVE,TSBRCB             GET READY TO PUT ELEM   YS02019 80960002
*                                       ADDRESS INTO Q HEADER   YS02019 81020002
         CS    RWRK,RSAVE,TCXREADY      TRY TO ADD IT TO QUEUE  YS02019 81080002
         BNE   TPT9925                  NO GOOD, TRY AGAIN      YS02019 81140002
         SPACE 2                                           YS02019      81200002
***                                                                     81260002
***                CROSS-MEMORY POST TCAM'S ECB                         81320002
***                                                                     81380002
         SR    RRPT,RRPT                COMPLETION CODE         YS02019 81500002
         LA    RTJID,CVTBRET            'ERRET' ADDRESS         YS02019 81560002
         L     RAVT,TCXASCB             GET ASCB ADDRESS        YS02019 81620002
         LR    R0,RTCX                  SAVE TCX POINTER        YS02019 81860002
         L     RTCX,TCXAVT              GET AVT ADDRESS         YS02019 81920002
         DROP  RTCX                                             YS02019 81980002
         USING IEDQAVTD,RTCX                                    YS02019 82040002
         LA    RTCX,AVTOSECB            ECB POINTER FOR POST    YS02019 82100002
         DROP  RTCX                                             YS02019 82160002
         L     RGOTO,CVT0PT01           POST ROUTINE ADDRESS    YS02019 82280002
         O     RTCX,TSIPSIGN            HI-ORDER BIT = XMPOST   YS02019 82330002
         BALR  RETURN,RGOTO             GO TO POST ROUTINE      YS02019 82340002
         SPACE 2                                                YS02019 82400002
         LR    RTCX,R0                  RESTORE TCX POINTER     YS02019 82460002
         USING IEDQTCX,RTCX                                     YS02019 82520002
         LH    RTJID,TSBWTJID           RESTORE ASID OF CALLER  YS02019 82580002
         L     RRPT,TCXRPT              RESTORE RPT POINTER     YS02019 82640002
         SPACE 2                                                YS02019 82820002
***                                                             YS02019 82880002
***                 RETURN TO SUBROUTINE CALLER                 YS02019 82940002
***                                                             YS02019 83000002
TPT9930  EQU   *                                                YS02019 83060002
         LM    RBUF,RCVT,XSAWD7         RESTORE REGISTERS       YS02019 83120002
         BR    RBUF                     RETURN                  YS02019 83180002
         EJECT                                                  YS02019 83240002
*****                                                                   83600002
*****               CONSTANTS                                           83700002
*****                                                                   83800002
NEWLINE  DC    X'15'                    NEW LINE CHAR FOR BLANK LINE    85200002
TSIPSIGN DS    0F                       ALIGN ON FULLWORD BDY    Y01018 85300002
         DC    X'80000000'              TPUT SIGN FOR TSIP              85400002
QNAME    DC    C'SYSZIGGI'              ENQ DEQ QNAME           YS02019 85500002
         DC    X'FF000000'              DEQ/ENQ PARM LIST               85600002
PATCHREA DC    10F'0'                   PATCH AREA               Y01018 85700002
         EJECT                                                          87000002
*****                                                                   87100002
*****               THE FOLLOWING DSECTS ARE USED BY THIS MODULE        87200002
*****                                                                   87300002
         IHAASCB                                                YS02019 87340002
         EJECT                                                  YS02019 87360002
         IHAASVT                                                YS02019 87370002
         EJECT                                                  YS02019 87390002
         TAVTD                                                  YS02019 87392002
         EJECT                                                  YS02019 87394002
         IKJTIOCB                                                       87400002
         EJECT                                                          87500002
CSCB     DSECT                                                  YS02019 87520002
         IEECHAIN                                               YS02019 87530002
         EJECT                                                  YS02019 87540002
CVT      DSECT                                                          87600002
         CVT                                                            87700002
         EJECT                                                          87710002
         TPRIOR                                                 YS02019 87750002
         EJECT                                                  YS02019 87760002
         IHAPSA                                                 YS02019 87820002
         EJECT                                                  YS02019 87830002
         TQCBD                                                  YS02019 87840002
         EJECT                                                  YS02019 87850002
         IKJRB                                                          87900002
***                                                                     88000002
***      EXTENDED SAVE AREA.  THSES STATEMENTS SHOULD FOLLOW            88100002
***      THE MACRO 'IKJRB.'                                             88200002
***                                                                     88300002
         ORG   RBEXSAVE                 START OF SAVE AREA       M0094  88400002
XSAPRM0  DS    0F                       REG 0 AT ENTRY           M0094  88500002
XSAPRMTJ DS    H                        TJID PASSED              M0094  88600002
XSAPRMSZ DS    H                        SIZE PASSED              M0094  88700002
XSAPRM1  DS    0F                       REG 1 AT ENTRY           M0094  88800002
XSAOPTNS DS    X                        USER OPTIONS             M0094  88900002
MASIS    EQU   X'01'                    ASIS OPTION SPECIFIED    M0094  89000002
MCNTRL   EQU   X'02'                    1 MEANS CONTROL          M0094  89100002
*                                                                       89200002
*   BOTH OF THE ABOVE BITS OFF MEANS EDIT OPTION                        89300002
*                                                                       89400002
MBREAK   EQU   X'04'                    BREAKIN SPECIFIED        M0094  89500002
MHOLD    EQU   X'08'                    1 MEANS HOLD             M0094  89600002
MTGET    EQU   X'80'                    1 MEANS TGET REQUESTED   M0094  89700002
MUSERP   EQU   X'40'                    USERID SPECIFIED        YS02019 89800002
MLOWP    EQU   X'20'                    0 HIGHPRI, 1 LOWPRI      M0094  89900002
MWAIT    EQU   X'10'                    1 MEANS NOWAIT           M0094  90000002
         DS    AL3                      REST OF REGISTER ONE     M0094  90100002
XSAWD3   DS    0F                       FOR SAVING REGISTERS     M0094  90200002
XSAFLAG  DS    X                        FLAG PASSED BY 9C TO 01  M0094  90300002
*                                       AND 02                   M0094  90400002
XSATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT   M0094  90500002
         DS    AL3                      REST OF WORD             M0094  90600002
         ORG   XSAWD3+2                 INPUT ED, OUTPUT MOVE    M0094  90700002
XSAUBFRS DS    H                        AMT DATA LEFT TO MOVE    M0094  90800002
XSAUBFRP DS    0F                       LOC DATA LEFT TO MOVE    M0094  90900002
XSAESTAL DS    CL16                     LIST FOR ESTAE MACRO    YS02019 90950002
         ORG   XSAUBFRP+4               USED FOR SAVE AREA WHEN YS02019 91800002
*                                       NOT NEEDED BY ESTAE     YS02019 91900002
XSAWD5   DS    F                        FOR SAVING REGISTERS     M0094  92000002
XSAWD6   DS    F                        FOR SAVING REGISTERS     M0094  92100002
         ORG   XSAWD5                   USE WORDS 5-6 FOR NAME   M0094  92200002
XSAENQNM DS    CL8                      ENQ NAME FOR TJID TPUT   M0094  92300002
XSAWD7   DS    F                        FOR SAVING REGISTERS     M0094  92400002
XSAWD8   DS    F                        FOR SAVING REGISTERS     M0094  92500002
         ORG   XSAWD7                   USE WDS 7-8 FOR ENQ PRMS M0094  92600002
XSAENQAD DS    2F                       WORK AREA FOR ENQ/DEQ    M0094  92700002
XSAUSERP DS    0F                       PTR TO USERID, IF PRES  YS02019 92750002
XSAWD9   DS    F                        FOR SAVING REGISTERS     M0094  92800002
XSARETRG DS    0F                       FOR SAVING RETURN ADDR  YS02019 92850002
XSAWD10  DS    F                        FOR SAVING REGISTERS     M0094  92900002
         DS    CL1                      RESERVED                YS02019 92950002
XSAUSERK DS    CL1                      SVC CALLER'S KEY        YS02019 92970002
XSARC    DS    H                        RETURN CODE SAVE AREA   YS02019 93000002
XSATJID  DS    H                        CALLER'S TJID            M0094  93100002
XSAFLAG2 DS    X                        FLAGS                   YM05387 93150002
XSAATR   EQU   X'80'                    NEXT CHAR IN TS BUFFER   S22028 93260002
*                                       IS A 3270 ATTRIBUTE BYTE        93270002
XSABFRAL EQU   X'40'                    TIOC BUFFER HASS BEEN   YM05387 93272002
*                                       ALLOCATED               YM05387 93274002
XSA15D   EQU   X'20'                    CHANGE COMPLETION CODE  YM05387 93276002
*                                       TO 15D                  YM05387 93278002
*                  NEXT 5 BITS UNUSED                           YM05387 93280002
XSAF     DS    X                        FLAGS USED BY TPUT. INI- M0094  93300002
*                                       TIALIZED FROM XSAFLAG.          93400002
HSW      EQU   X'80'                    HEADER BFR DONE          M0094  93500002
PSW      EQU   X'40'                    NEED TO TPOST QCB        M0094  93600002
*SATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT          93700002
OSW      EQU   X'10'                    TSBOWIP TURNED ON BY US  M0094  93800002
XSADMOVE EQU   X'08'                    DATA BEING MOVED        YS02019 93970002
XSAAUTH  EQU   X'04'                    USER IS AUTHORIZED      YS02019 94040002
*                                       (NOT SOME OTHER TPUT)           94200002
XSAIDENQ EQU   X'02'                    ASID TPUT ASID ENQUEUED YS02019 94250002
XSAPARTO EQU   X'01'                    QCBPARTO IS SET ON      YM01246 94260002
         EJECT                                                          94300002
         IHASCVT                                                YS02019 94400002
         EJECT                                                  YS02019 94500002
         IKJTCB                                                         94700002
         EJECT                                                          94800002
         IEFTCT                                                         94900002
         EJECT                                                          95000002
         TTCXD                                                  YS02019 95200002
         EJECT                                                  YS02019 95300002
         IKJTIOCP                                                       96100002
         EJECT                                                          96200002
         IKJTSB                                                         96300002
         EJECT                                                          96400002
         TTSID                                                  YS02019 96600002
         END                                                            97100002
./  ADD  SSI=80160101,NAME=IGG09303
IGG09303 CSECT                                                          00060002
         TITLE 'IGG09303 - SECOND LOAD OF TGET'                         00200020
*********************************************************************** 00400020
*                                                                     * 00600002
*                  RELEASE 2, VS/2 DELETIONS                          * 00800002
*                                                                     * 01000002
*D006000-022000,078600-086000,118000-128000,142000,166000       YS02019 01200002
*D174000,202000-204000,212000-224000,250000,254000              YS02019 01400002
*D302000-316400,586080-602000,662180-663840                     YS02019 01600002
*                                                               YS02019 01800002
*                                       05/30/73                YM01246 01850002
*                                       10/11/73                YM03998 01900002
*0795768860                                                      S22028 01950002
*                  VS/2  RELEASE 3.7 CHANGES                          * 01960003
*                                                                     * 01962003
*A 504000,525000                                                ZA28576 01964003
*C 482000,506000                                                ZA28576 01966003
*A280200,559500                                                 ZA16627 01970003
*                                                                       01980003
*                                                                       01990003
* STATUS -                                                            * 02000002
*    CHANGE LEVEL 003                                                 * 02200002
*                                                                     * 02400020
* FUNCTION -                                                          * 02600020
*                                                                     * 02800020
*    THE FUNCTION OF IGG09303 IS TO LEAVE ALL WAIT STATES THAT        * 03000020
*    THE FREEING OF TS BUFFERS BY THIS TGET WILL ALLOW.               * 03200020
*                                                                     * 03400020
* ENTRY POINTS -                                                      * 03600020
*                                                                     * 03800020
*         IGG09303 - ENTRY POINT FROM IGC0009C VIA BRANCH             * 04000002
*                                                                     * 04200020
* INPUT -                                                             * 04400020
*                                                                     * 04600020
*    AT TIME OF ENTRY THE FOLLOWING REGISTERS HAVE USABLE             * 04800020
*         3- CVT POINTER, 4- TCB POINTER, 5- SVRB POINTER,            * 05000020
*         8- ASCB POINTER, 9- TSB POINTER, 10- TIOCRPT POINTER,       * 05200002
*    ALSO AT TIME OF ENTRY, THE FIELDS 'XSAPRM0,' AND XSAPRM1,'       * 05400002
*    IN THE SVRB EXTENDED SAVE AREA, CONTAIN, RESPECTIVELY, THE       * 05450002
*    RETURN CODE FROM IGC0009C AND THE AMOUNT OT DATA MOVED.          * 05500002
*                                                                     * 06400020
* OUTPUT                                                              * 06600020
*                                                                     * 06800020
*    OUTPUT IS RETURN CODE IN REGISTER 15 AND COUNT OF DATA IN 1      * 07000020
*                                                                     * 07200020
* EXTERNAL REFERENCES                                                 * 07400020
*                                                                     * 07600020
*         CVT0PT01 - POST ROUTINE                                     * 07800020
*         SETLOCK                                                     * 07850002
*         STATUS                                                      * 07852002
*                                                                     * 07860002
* EXITS, NORMAL                                                       * 08060002
*                                                                     * 08260002
*    BRANCH BACK TO SUPERVISOR VIA REGISTER 14                        * 08460002
*                                                                     * 08800020
* EXITS,ERROR -                                                       * 09000020
*                                                                     * 09200020
*    THERE ARE NO ERROR EXITS FROM THIS ROUTINE                       * 09400020
*                                                                     * 09600020
* TABLES/WORK AREAS -                                                 * 09800020
*                                                                     * 10000020
*    THESE ARE DESCRIBED BY DSECTS AT THE END OF THE LISTING          * 10200020
*                                                                     * 10400020
* ATTRIBUTES -                                                        * 10600020
*                                                                     * 10800020
*    REENTRANT, REUSABLE, PRIVILEGED, KEY 0, HOLDS THE LOCAL AND      * 11000002
*    THE CMS LOCKS AT ENTRY                                           * 11050002
*                                                                     * 11200020
* CHARACTER CODE DEPENDENCY -                                         * 11400020
*                                                                     * 11600020
*    NONE                                                             * 11800002
*                                                                     * 13000020
* NOTES -                                                             * 13200020
*                                                                     * 13400020
*    NONE                                                             * 13600020
*                                                                     * 13800020
*********************************************************************** 14000020
***                                                                     14400020
***                 REGISTER EQUATES                                    14600020
***                                                                     14800020
R0       EQU   0                        USED TO SPEED ASM               15000020
RP1      EQU   1                        PARM REG - LENGTH RETURN        15200020
RAVT     EQU   2                        POINTER TO AVT                  15400020
RCVT     EQU   3                        POINTER TO CVT                  15600020
RTCB     EQU   4                        POINTER TO TCB                  15800020
RSVRB    EQU   5                        POINTER TO SVRB                 16000020
RBASE    EQU   6                        BASE REGISTER                   16200020
RTSI     EQU   7                        POINTER TO TSINPUT QCB          16400020
RASCB    EQU   8                        POINTER TO ASCB         YS02019 16600002
RTSB     EQU   9                        POINTER TO TSB                  16800020
RRPT     EQU   10                       POINTER TO TIOCRPT              17000020
RECB     EQU   11                       ECB POINTER FOR POST            17200020
RTCX     EQU   11                       POINTER TO TCX          YS02019 17400002
RRCB     EQU   12                       POINTER TO RCB                  17600020
RSAVE    EQU   13                       WORK REGISTER                   17800020
RTJID    EQU   13                       TJID FOR POST                   18000020
RETURN   EQU   14                       RETURN ADDRESS                  18200020
RWRK     EQU   14                       WORK REGISTER                   18400020
RWRK1    EQU   15                       WORK REGISTER                   18600020
RGO      EQU   15                       GO TO ADDRESS                   18800020
RCODE    EQU   15                       RETURN CODE REGISTER            19000020
         SPACE 2                                                        19200020
***                                                                     19400020
***                 OTHER EQUATES                                       19600020
***                                                                     19800020
K0       EQU   0                        ZERO DISPLACEMENT               20000020
K1       EQU   1                        OFFSET AND CONSTANT             20200002
K3       EQU   3                        LENGTH OF ADDRESS               20600020
K4       EQU   4                        LENGTH OF WORD                  20800020
K5       EQU   5                        OFFSET CONSTANT                 21000020
NDISPBIT EQU   X'800'                   OWAIT NONDISP BIT       YS02019 21200002
STEPSD   EQU   8                        ENTRY CODE FOR 'STATUS' YS02019 22200002
TIMES4   EQU   2                        SHIFT CONSTANT          YS02019 22250002
OFF      EQU   X'FF'                    USED TO TURN BITS OFF           23200002
         SPACE 2                                                        23400020
         BALR  RBASE,R0                 SET BASE REGISTER               23600020
         USING *,RBASE                  ADDRESSABILITY                  23800020
         B     TGT0050                  BRANCH AROUND ID/DATE   YS02019 23850002
         DC    C'IGG09303'              MODULE ID               YS02019 23900002
         DC    X'3319'                  JULIAN DATE 11/15/73    YM05387 23950002
         USING TIOCRPT,RRPT                                             24000020
         USING IEDQAVTD,RAVT                                            24200020
         USING CVT,RCVT                                                 24400020
         USING TCB,RTCB                                                 24600020
         USING IEDQTSI,RTSI                                             24800020
         USING ASCB,RASCB                                       YS02019 25000002
         USING TSB,RTSB                                                 25200020
         USING RBSECT,RSVRB                                      M0094  25600021
         SPACE 2                                                        25800020
*********************************************************************** 25822002
***                                                             YS02019 25824002
***            THIS MODULE IS BRANCH ENTERED FROM IGC0009C      YS02019 25830002
***            HOLDING BOTH THE CMS AND THE LOCAL LOCKS         YS02019 25840002
***                                                             YS02019 25860002
*********************************************************************** 25910002
         SPACE 3                                                YS02019 25960002
TGT0050  EQU   *                                                YS02019 25960402
***                                                                     25962002
***                 DETERMINE WHETHER ANYTHING TO DO                    25964002
***                                                                     25966002
         TM    CVTTCMFG,CVTTCRDY        IS TCAM STILL AROUND    YS02019 25970002
         BNO   TGT3000                  IF NOT, DO NOTHING      YS02019 25980002
         L     RWRK,CVTAQAVT            GET POINTER TO TCX      YS02019 25990002
         L     RWRK,TCXRPT-IEDQTCX(,RWRK) GET TIOCRPT POINTER   YS02019 25992002
         LTR   RWRK,RWRK                SEE IF TSO STILL UP     YS02019 25996002
         BZ    TGT3000                  NOT UP, DO NOTHING      YS02019 25998002
         NC    TIOCNFBF,TIOCNFBF        ANY FREE TS BUFFERS             26000020
         BZ    TGT3000                  NO, RETURN TO USER              26200020
         TM    TIOCFLG,TIOCTJBF+TIOCNOBF ANY TPUTS WAITING FOR BFRS     26400020
         BZ    TGT2000                  NO, GO CHECK LWAIT              26600020
         SPACE 2                                                        27000020
*********************************************************************** 27200020
*****                                                             ***** 27400020
*****          WAKE UP ALL TPUTS WAITING FOR BUFERS               ***** 27600020
*****                                                             ***** 27800020
*********************************************************************** 28000020
         SPACE 2                                                        28200020
         LR    RRCB,RTSB                SAVE TSB REG            ZA16627 28250003
         L     RTSB,TIOCTSB-K1          START OF TSB TABLE              28400020
         LH    RSAVE,TIOCNTSB           NO. TSB'S IN TABLE      YS02019 28600002
         SR    RWRK1,RWRK1                                              29000020
         IC    RWRK1,TIOCTSBS           SIZE OF TSB'S                   29200020
TGT0100  EQU   *                                                        29400020
         TM    TSBFLG1,TSBTJBF          IS THIS TSB WAITED ON           29600020
         BNO   TGT0300                  IF NOT                          29800020
         NI    TSBFLG1,OFF-TSBTJBF      TURN OFF NO BFR INDR            29900020
         SPACE 1                                                        30000020
***                                                                     31680020
***                 GO TO POST ROUTINE TO ACTIVATE WAITING TASK         31720020
***                                                                     31760020
         SPACE 2                                                        31800020
         STM   RRPT,RWRK1,XSAUBFRP      SAVE REGISTERS           M0094  32000021
         SR    RRPT,RRPT                COMPLETION CODE FOR POST        32200020
         LA    RECB,TSBECB              ECB POINTER                     32600020
         LH    RAVT,TSBWTJID            ASID OF POSTED USER     YS02019 32800002
         SLA   RAVT,TIMES4              MULTIPLY BY FOUR        YS02019 32850002
         L     RGO,CVTASVT              GET ASVT POINTER        YS02019 32900002
         L     RSAVE,ASVTENTY-ASVT-L'ASVTENTY(RGO,RAVT)         YS02019 32950002
*                                       GET ASCB ADDRESS        YS02019 32960002
         O     RECB,TJIDN               TURN ON HIGH-ORDER BIT   S21A12 33000021
         L     RGO,CVT0PT01             POST ROUTINE ADDR               33050002
         LA    RRCB,CVTBRET             'ERRET' ADDRESS         YS02019 33200002
         SPACE 2                                                        33800020
*********************************************************************** 34000020
***                                                                 *** 34200020
***      CONTENTS OF REGISTERS TO BE USE BY POST ROUTINE            *** 34400020
***                                                                 *** 34600020
***      10- COMPLETION CODE (ZERO), 11- ADDRESS OF TSBECB WITH     *** 34800002
***      HIGH-ORDER BIT ON, 12- ERRET ADDR, 13- ASCB OF TARGET      *** 35000002
***      TASK, 14 - RETURN ADDRESS, 15 - ADDRESS OF POST ROUTINE    *** 35200020
***                                                                 *** 35400020
*********************************************************************** 35600020
         SPACE 2                                                      * 35800020
         BALR  RETURN,RGO               GO TO POST ROUTINE              36000020
         SPACE 2                                                        36200020
***                                                                     36400020
***                 UPON RETURN FROM POST                               36600020
***                                                                     36800020
         LM    RRPT,RWRK1,XSAUBFRP      RESTORE REGISTERS        M0094  37100021
         SPACE                                                          37400020
TGT0300  EQU   *                                                        37600020
***                                                                     38600020
***            CHECK FOR NORMAL TPUT WAITING FOR BUFFERS                39600020
***                                                                     40600020
         TM    TSBSTAT,TSBNOBUF         IS THIS TSB IN OWAIT            44400020
         BNO   TGT1600                  IF NOT                          44600020
         L     RASCB,TSBASCBA           GET ASCB ADDRESS        YS02019 44650002
         SPACE 2                                                        44800020
***                                                                     45000020
***                 REMOVE OWAIT                                        45200020
***                                                                     45400020
         NI    TSBSTAT,OFF-TSBNOBUF     TURN OFF INDICATOR              45600020
         SPACE 3                                                        45800002
***                GO TO 'STATUS' ROUTINE TO RESET NONDISPATCHABILITY   46100002
***                OF ALL TASKS IN THIS TSB'S STEP THAT ARE IN OWAIT    46400002
***                                                                     46700002
***                REGISTERS FOR 'STATUS' -                             47000002
***                                                                     47300002
***            0 (R0) - HIGH-ORDER = ASID, LOW= ENTRY CODE (8)          47600002
***            1 (RP1)- HIGH BIT ON TO INDICATE 'RESET'                 47900002
***            13 (RSAVE)-MASK OF SECONDARY BITS TO RESET       ZA28576 48200003
***            14,15- RETURN, ENTRY                                     48500002
         SPACE 3                                                YS02019 48800002
         LA    R0,STEPSD                ENTRY CODE              YS02019 49100002
         L     RP1,TJIDN                HIGH-ORDER BIT ONLY ON  YS02019 49400002
         ICM   R0,B'1100',ASCBASID      ASID OF TARGET STEP     YS02019 49700002
         L     RGO,CVTABEND             SECONDARY CVT POINTER   YS02019 50000002
         USING SCVTSECT,RGO                                     YS02019 50300002
         LR    RAVT,RSAVE               SAVE REG 13             ZA28576 50350003
         LA    RSAVE,NDISPBIT           BIT TO RESET            ZA28576 50600003
         L     RGO,SCVTSTAT             ADDRESS OF STATUS RTN   YS02019 50900002
         DROP  RGO                                              YS02019 51200002
         BALR  RETURN,RGO               GO TO STATUS ROUTINE    YS02019 51500002
         LR    RSAVE,RAVT               RESTORE REG 13 VALUE    ZA28576 51550003
         SPACE 2                                                        53600020
TGT1600  EQU   *                                                        53800020
***                                                                     54000020
***                 PREPARE TO LOOK AT NEXT TSB                         54200020
***                                                                     54400020
         SR    RWRK1,RWRK1              ZERO REGISTER           YM03998 54410002
         IC    RWRK1,TIOCTSBS           RELOAD TSB SIZE (SAVED  YM03998 54450002
*                                       BEFORE WENT TO POST)    YM03998 54500002
         AR    RTSB,RWRK1               UPDATE TSB POINTER              54800020
         BCT   RSAVE,TGT0100            CHECK NEXT TSB, IF ANY          55200020
         SPACE 2                                                        55600020
***                                                                     55800002
***                 TURN OFF SYSTEM WAIT INDICATORS                     55850002
***                                                                     55900002
         LR    RTSB,RRCB                 RESTORE TSB POINTER    ZA16627 55950003
         NI    TIOCFLG,OFF-(TIOCNOBF+TIOCTJBF)                          56000020
         SPACE 2                                                        56200020
TGT2000  EQU   *                                                        56600020
*********************************************************************** 56800020
*****                                                             ***** 57000020
*****               CAN HELD TCAM BUFFERS BE REMOVED FROM WAIT    ***** 57200020
*****               QUEUE, AND CAN SYSTEM BE REMOVED FROM LWAIT   ***** 57400020
*****                                                             ***** 57600020
*********************************************************************** 57800020
         SPACE 2                                                        58000020
         TM    TIOCFLG,TIOCSYLW         IS SYSTEM IN LWAIT              59600020
         BNO   TGT3000                  NO, RETURN TO USER              59800020
         CLC   TIOCNFBF,TIOCUSLW        CAN SYS LWAIT BE REMOVED        60000020
         BL    TGT3000                  NO, RETURN TO USER              60200020
         SPACE 2                                                        60400020
***                                                                     60600020
***                 TPOST THE TSB TO IEDAYP WITH TSBTPAYI ON,   YS02019 60800002
***                 TO INDICATE TSINPUT SHOULD BE POSTED.       YS02019 60900002
***                 ONLY TSINPUT MAY REMOVE SYSTEM LWAIT        YS02019 61000002
***                                                             YS02019 61100002
         L     RWRK,TSBTPFLG            GET OLD FLAGS           YS02019 61200002
TGT2050  EQU   *                                                YS02019 61300002
         LR    RWRK1,RWRK               COPY                    YS02019 61400002
         O     RWRK1,TPOSTBTS           SET BITS IN COPY        YS02019 61500002
         CS    RWRK,RWRK1,TSBTPFLG      SWAP NEW BITS FOR OLD   YS02019 61600002
         BNE   TGT2050                  TRY AGAIN IF CHANGED    YS02019 61700002
         LTR   RWRK,RWRK                WAS TSBPOSTO ON         YS02019 61800002
         BM    TGT3000                  YES, NEEDN'T TPOST, BE- YS02019 61900002
*                                       CAUSE ALREADY TPOSTED   YS02019 62000002
         SPACE 2                                                YS02019 62100002
***                                                                     62200002
***                 TPOST THE TSB TO IEDAYP                             62300002
***                                                                     62400002
         L     RTCX,CVTAQAVT            GET TCX POINTER         YS02019 62500002
         USING IEDQTCX,RTCX                                     YS02019 62600002
         L     RTSI,TCXTSI              GET TSI POINTER         YS02019 62700002
         USING IEDQTSI,RTSI                                     YS02019 62800002
         LA    RWRK,TSITSAP-(QCBSTVTO-IEDQQCB)                  YS02019 62900002
*                                       ADDR OF AYP'S 'QCB'     YS02019 63000002
         ST    RWRK,TSBRQCB             QCB TO WHICH TSB IS     YS02019 63100002
*                                       BEING TPOSTED           YS02019 63200002
         L     RWRK,TCXREADY            CURRENT READY Q PTR     YS02019 63300002
TGT2100  EQU   *                                                YS02019 63500002
         ST    RWRK,TSBLINKA            LINK TSB TO NEXT ELEM   YS02019 63600002
         MVI   TSBPRI,PRIBFRTB          SET PRIORITY            YS02019 63650002
         LA    RWRK1,TSBRCB             ADDRESS OF NEW ELEMENT  YS02019 63700002
         CS    RWRK,RWRK1,TCXREADY      UPDATE READY Q ANCHOR   YS02019 63800002
         BNE   TGT2100                  AGAIN IF NO GOOD        YS02019 63900002
         SPACE 3                                                YS02019 64000002
***                                                             YS02019 64100002
***                 XM POST TCAM'S ECB                          YS02019 64200002
***                                                             YS02019 64300002
         SR    RRPT,RRPT                COMPLETION CODE IN 10   YS02019 64400002
         L     RAVT,TCXAVT              GET AVT POINTER         YS02019 64500002
*                   NOTE - AVT ISN'T REALLY ADDRESSABLE         YS02019 64600002
         L     RSAVE,TCXASCB            GET ASCB POINTER        YM03998 64650002
         DROP  RTCX                     TCX NOT ADDRESSABLE     YM03998 64660002
         LA    RECB,AVTOSECB            ADDRESS OF ECB          YS02019 64700002
         LA    RRCB,CVTBRET             'ERRET' ADDRESS         YS02019 64800002
         L     RGO,CVT0PT01             POST ROUTINE ADDRESS            65080002
         O     RECB,TJIDN               SHOW X-M REQUEST        YS02019 65100002
         BALR  RETURN,RGO               GO TO POST ROUTINE              66200020
         SPACE 2                                                        66208002
TGT3000  EQU   *                                                        67000020
         L     RP1,XSAPRM0              RESTORE DATA COUNT       M0094  67200021
         L     RCODE,XSAPRM1            RESTORE RETURN CODE      M0094  67400021
         TM    XSAFLAG,XSATCBFX         SHOULD WE TURN OFF TCBFX M0094  67600021
         BZ    TGT4000                  NO,SKIP                         67800020
         NI    TCBFLGS1,OFF-TCBFX       ALLOW ASYNCHRONOUS EXITS        68000020
TGT4000  EQU   *                                                        68200020
         NI    TCBTSFLG,OFF-TCBTIOTG    ATTN EXIT INDR                  68400020
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGC0009C(TGT0350))       68600002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,IGC0009C(TGT0350))     68650002
         L     RETURN,XSARETRG          RESTORE RETURN ADDRESS  YS02019 68700002
         BR    RETURN                   RETURN TO SUPERVISOR    YS02019 68750002
         SPACE 2                                                        68800020
***                                                                     69000020
***                 CONSTANTS                                           69200020
***                                                                     69400020
KZERO    DC    F'00'                    ZERO COMPARATOR                 69600020
TJIDN    DC    X'80000000'              FOR INTERREGION POST REQ S21A12 69800021
TPOSTBTS DC    AL1(TSBTPAYI+TSBPOSTO)   BITS FOR IEDAYP         YS02019 70400002
         DC    AL3(0)                   FILL OUT FULLWORD       YS02019 70410002
PATCHREA DC    10F'0'                   PATCH AREA               Y01018 70450002
         EJECT                                                          72400020
         IHAASCB                                                YS02019 72600002
         EJECT                                                  YS02019 72800002
         IHAASVT                                                YS02019 72850002
         EJECT                                                  YS02019 72950002
         TAVTD                                                  YS02019 73000002
         EJECT                                                  YS02019 73200002
CVT      DSECT                                                          73400002
         CVT                                                            73600002
         EJECT                                                          73800002
         IHAPSA                                                 YS02019 74000002
         EJECT                                                  YS02019 74200002
         TPRIOR                                                 YS02019 74400002
         EJECT                                                  YS02019 74600002
         TQCBD                                                  YS02019 74800002
         EJECT                                                  YS02019 75000002
         IKJRB                                                          76409021
***                                                                     76418021
***      EXTENDED SAVE AREA.  THSES STATEMENTS SHOULD FOLLOW            76427021
***      THE MACRO 'IKJRB.'                                             76436021
***                                                                     76445021
         ORG   RBEXSAVE                 START OF SAVE AREA       M0094  76454021
XSAPRM0  DS    0F                       REG 0 AT ENTRY           M0094  76463021
XSAPRMTJ DS    H                        TJID PASSED              M0094  76472021
XSAPRMSZ DS    H                        SIZE PASSED              M0094  76481021
XSAPRM1  DS    0F                       REG 1 AT ENTRY           M0094  76490021
XSAOPTNS DS    X                        USER OPTIONS             M0094  76499021
MASIS    EQU   X'01'                    ASIS OPTION SPECIFIED    M0094  76508021
MCNTRL   EQU   X'02'                    1 MEANS CONTROL          M0094  76517021
*                                                                       76526021
*   BOTH OF THE ABOVE BITS OFF MEANS EDIT OPTION                        76535021
*                                                                       76544021
MBREAK   EQU   X'04'                    BREAKIN SPECIFIED        M0094  76553021
MHOLD    EQU   X'08'                    1 MEANS HOLD             M0094  76562021
MTGET    EQU   X'80'                    1 MEANS TGET REQUESTED   M0094  76571021
MILLEGAL EQU   X'40'                    RESERVED BIT             M0094  76580021
MLOWP    EQU   X'20'                    0 HIGHPRI, 1 LOWPRI      M0094  76589021
MWAIT    EQU   X'10'                    1 MEANS NOWAIT           M0094  76598021
         DS    AL3                      REST OF REGISTER ONE     M0094  76607021
XSAWD3   DS    0F                       FOR SAVING REGISTERS     M0094  76616021
XSAFLAG  DS    X                        FLAG PASSED BY 9C TO 01  M0094  76625021
*                                       AND 02                   M0094  76634021
XSATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT   M0094  76643021
         DS    AL3                      REST OF WORD             M0094  76652021
         ORG   XSAWD3+2                 INPUT ED, OUTPUT MOVE    M0094  76661021
XSAUBFRS DS    H                        AMT DATA LEFT TO MOVE    M0094  76670021
XSAUBFRP DS    0F                       LOC DATA LEFT TO MOVE    M0094  76679021
XSAESTAL DS    CL16                     LIST FOR ESTAE MACRO    YS02019 76729002
         ORG   XSAUBFRP+4               USED FOR SAVE AREA WHEN YS02019 76760002
*                                       NOT NEEDED BY ESTAE     YS02019 76769002
XSAWD5   DS    F                        FOR SAVING REGISTERS     M0094  76778021
XSAWD6   DS    F                        FOR SAVING REGISTERS     M0094  76787021
         ORG   XSAWD5                   USE WORDS 5-6 FOR NAME   M0094  76796021
XSAENQNM DS    CL8                      ENQ NAME FOR TJID TPUT   M0094  76805021
XSAWD7   DS    F                        FOR SAVING REGISTERS     M0094  76814021
XSAWD8   DS    F                        FOR SAVING REGISTERS     M0094  76823021
         ORG   XSAWD7                   USE WDS 7-8 FOR ENQ PRMS M0094  76832021
XSAENQAD DS    2F                       WORK AREA FOR ENQ/DEQ    M0094  76841021
XSAUSERP DS    0F                       PTR TO USER ID, IF PRES YS02019 76843002
XSAWD9   DS    F                        FOR SAVING REGISTERS     M0094  76850021
XSARETRG DS    0F                       RETURN ADDRESS          YS02019 76852002
XSAWD10  DS    F                        FOR SAVING REGISTERS     M0094  76859021
         DS    CL1                      RESERVED                YS02019 76861002
XSAUSERK DS    CL1                      SVC CALLER'S KEY        YS02019 76863002
XSARC    DS    H                        RETURN CODE SAVE AREA   YS02019 76868002
XSATJID  DS    H                        CALLER'S TJID            M0094  76877021
XSAFLAG2 DS    X                        FLAGS                   YM05387 76887002
XSAATR   EQU   X'80'                    NEXT CHAR IN TS BUFFER   S22028 76888002
*                                       IS A 3270 ATTRIBUTE BYTE        76889002
XSABFRAL EQU   X'40'                    TIOC BUFFER HAS BEEN    YM05387 76889402
*                                       ALLOCATED USED BY ESTAE YM05387 76889802
XSA15D   EQU   X'20'                    CHANGE COMPLETION CODE  YM05387 76889902
*                                       TO 15D IN ESTAE         YM05387 76897202
*                  NEXT 5 BITS UNUSED                           YM05387 76905102
XSAF     DS    X                        FLAGS USED BY TPUT. INI- M0094  76912402
*                                       TIALIZED FROM XSAFLAG.          76919702
HSW      EQU   X'80'                    HEADER BFR DONE          M0094  76927002
PSW      EQU   X'40'                    NEED TO TPOST QCB        M0094  76934302
*SATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT          76941602
OSW      EQU   X'10'                    TSBOWIP TURNED ON BY US  M0094  76948902
*                                       (NOT SOME OTHER TPUT)           76956202
XSADMOVE EQU   X'08'                    DATA IS MOVING          YS02019 76963502
XSAAUTH  EQU   X'04'                    USER IS AUTHORIZED      YS02019 76970802
XSAIDENQ EQU   X'02'                    ASID TPUT ASID ENQUEUED YS02019 76978102
XSAPARTO EQU   X'01'                    QCBPARTO IS SET ON      YM01246 76985402
         EJECT                                                          76992702
         IHASCVT                                                        77000002
         EJECT                                                          78000002
         IKJTCB                                                 YS02019 79000002
         EJECT                                                  YS02019 80000002
         TTCXD                                                  YS02019 81000002
         EJECT                                                  YS02019 82000002
         IKJTIOCP                                               YS02019 83000002
         EJECT                                                  YS02019 84000002
         IKJTSB                                                 YS02019 85000002
         EJECT                                                          86000002
         TTSID                                                          87000002
         END   ,                                                YS02019 88000002
./  ADD  SSI=80870680,NAME=IGG0940A
         TITLE 'IGG0940A - STSIZE ROUTINE'                              00700020
IGG0940A CSECT                                                          01300020
*********************************************************************** 89140000
*                                                                M2650  89170000
*                                                                 M2696 89200000
*                                                                 M2697 89230000
*                                                                 M2689 89260000
*                                                                M5113  89290000
*                                                                     * 89320000
*                                                                M0590  89350000
*                                                                 M5113 89380000
*                                                                       89410000
*    RELEASE 23 DELETIONS/CHANGES                                     * 89440000
*    RELEASE 22 DELETIONS/CHANGES                                     * 89470000
*    RELEASE 21 DELETIONS/CHANGES                                     * 89500000
*    NDS DEVICE INTERFACE SUPPORT                               OZ27085 89507003
* A942640,942660,964349,964409                                  OZ27085 89514003
* C913700,964349,964409                                         OZ27085 89521003
*                                                                     * 89530000
* STATUS - CHANGE LEVEL 002                                           * 89560000
*    CHANGE LEVEL 0                                                   * 89590000
*                                                                     * 89620000
* FUNCTION -                                                          * 89650000
*    THIS ROUTINE IS TO SERVE THE MACRO 'STSIZE', WHICH               * 89680000
*    ALLOW THE USER TO VARY THE PHYSICAL LINE SIZE OF HIS TERMINAL,   * 89710000
*    AND THE SCREEN LENGTH OF HIS DISPLAY STATION.  THIS ROUTINE      * 89740000
*    REPLACES THE ORIGINAL PHYSICAL LINE SIZE KEPT IN TSB (TSBLNSZ)   * 89770000
*    WITH USER SPECIFIED VALUE.  FOR DISPLAY STATION, IT ALSO REPLACES* 89800000
*    THE ORIGINAL SCREEN LENGTH KEPT IN TSB (TSBLNNO) WITH USER       * 89830000
*    SPECIFIED VALUE.                                                 * 89860000
*                                                                     * 89890000
* ENTRY POINTS -                                                      * 89920000
*         IGG0940A - CONTROL IS RECEIVED FROM MODULE IGC0009D VIA     * 89950000
*         BRANCH ACCORDING TO THE ENTRY CODE 10                       * 89980002
*         (HOLDING THE LOCAL AND THE CMS LOCKS IN SUPERVISOR KEY)     * 89990002
*                                                                     * 90010000
* INPUT -                                                             * 90040000
*    REGISTER 0 CONTAINS:                                             * 90070000
*    ********************************************************         * 90120002
*    * ENTRY CODE *            *            * SCREEN LENGTH *         * 90170002
*    ********************************************************         * 90180002
*    REGISTER 1 CONTAINS:                                             * 90190000
*    ********************************************************         * 90200002
*    *            *            *            *   LINE SIZE   *         * 90210002
*    ********************************************************         * 90212002
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 90310000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 90340000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 90370002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS          90400002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                              90430002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            90490002
*                                                                     * 90580000
* OUTPUT -                                                            * 90610000
*    REGISTER 15 HAS RETURN CODE:                                     * 90640000
*           0 - SUCCESSFUL                                            * 90670000
*           4 - INVALID PARAMETER                                     * 90700000
*           8 - INCORRECT PARAMETER FOR TERMINAL                      * 90730000
*           C - DIMENSION NOT STANDARD (FOR DISPLAY STATION ONLY)     * 90760000
*                                                                     * 90790000
* EXTERNAL REFERENCES -                                               * 90820000
*         NONE                                                        * 90850000
*                                                                     * 90880000
* EXITS, NORMAL -                                                     * 90910000
*         BR 14 WITH 0 IN REGISTER 15                                 * 90940002
*                                                                     * 90970000
* EXITS, ERROR -                                                      * 91000000
*         BR 14 WITH 4, 8, 12 IN REGISTER 15                          * 91030002
*                                                                     * 91060000
* TABLES/WORK AREAS -                                                 * 91090000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 91120000
*                                                                     * 91150000
* ATTRIBUTES -                                                        * 91180000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, AND ENABLED             * 91210002
*                                                                     * 91240000
* CHARACTER CODE DEPENDENCY -                                         * 91270000
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 91300000
*                                                                     * 91310002
*    NOTE -     THE STANDARD SCREEN DIMENSIONS ARE -                  * 91350002
*                                                                     * 91360002
*               FOR 3270 - 12X40, 24X80, 32X80, 43X80           OZ27085 91362000
*                                                                     * 91380002
*               FOR 2260 - 12X80, 12X40, 6X40, 15X64                  * 91382002
*                                                                     * 91390000
*********************************************************************** 91420000
         SPACE 3                                                        91450000
********                                                                91480000
******** EQUATES FOR REGISTER                                           91510000
********                                                                91540000
RPARM0   EQU   0                        PARAMETER REG 0                 91570000
RWORK0   EQU   0                        WORK REGISTER                   91600000
RPARM1   EQU   1                        PARAMETER REG 1                 91630000
RWORK1   EQU   1                        WORK REGISTER                   91660000
RWORK2   EQU   2                        WORK REGISTER                   91690000
RWORK3   EQU   3                        WORK REGISTER                   91720000
RCVT     EQU   3                        POINTS TO CVT                   91750000
RTCB     EQU   4                        POINTS TO TCB                   91840000
RTSB     EQU   5                        POINTS TO TSB           YS02019 91930002
RBASE    EQU   12                       BASE REGISTER                   92290000
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 92320002
*                                       CONSTANTS               YS02019 92330002
R13      EQU   13                       REGISTER 13                     92350000
R14      EQU   14                       REGISTER 14                     92380000
RLINK    EQU   14                       LINK REGISTER                   92410000
R15      EQU   15                       REGISTER 15                     92470000
RBRANCH  EQU   15                       BRANCH REGISTER                 92500000
RCODE    EQU   15                       RETURN CODE REGISTER            92530000
         SPACE 2                                                        92560000
********                                                                92590000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           92620000
********                                                                92650000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         92680000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         92710000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         92740000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         92770000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      92800000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    92830000
D0       EQU   0                        DISPLACEMENT OF 0               92860000
D1       EQU   1                        DISPLACEMENT OF 1               92890000
D2       EQU   2                        DISPLACEMENT OF 2               92920000
D3       EQU   3                        DISPLACEMENT OF 3               92950000
D4       EQU   4                        DISPLACEMENT OF 4               92980000
D5       EQU   5                        DISPLACEMENT OF 5               93010000
D6       EQU   6                        DISPLACEMENT OF 6               93040000
D14      EQU   14                       DISPLACEMENT OF 14              93070000
L1       EQU   1                        LENGTH OF 1                     93100000
L2       EQU   2                        LENGTH OF 2                     93130000
L3       EQU   3                        LENGTH OF 3                     93160000
L4       EQU   4                        LENGTH OF 4                     93190000
L8       EQU   8                        LENGTH OF 8                     93220000
L16      EQU   16                       LENGTH OF 16                    93250000
L20      EQU   20                       LENGTH OF 20                    93280000
L24      EQU   24                       LENGTH OF 24                    93310000
L31      EQU   31                       LENGTH OF 31                    93340000
L32      EQU   32                       LENGTH OF 32                    93370000
RETCODE4 EQU   4                        RETURN CODE OF 4                93400000
RETCODE8 EQU   8                        RETURN CODE OF 8                93430000
RETCODEC EQU   12                       RETURN CODE OF 12               93460000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           93490000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       93520000
CZERO    EQU   0                        TO TEST FOR ZERO                93550000
CONE     EQU   1                        CONSTANT OF 1                   93580000
CTWO     EQU   2                        CONSTANT OF 2                   93610000
CTHREE   EQU   3                        CONSTANT OF 3                   93640000
CFIFTEEN EQU   15                       CONSTANT OF 15                  93670000
CSIXTEEN EQU   16                       CONSTANT OF 16                  93700000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                93730000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               93760000
OFF      EQU   X'FF'                    TO TURN BITS OFF                93790000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         93850000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     93880000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 93910000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    93940000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    93970000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           94000000
LNSZ40   EQU   40                       LINE SIZE 40                    94030000
LNSZ64   EQU   64                       LINE SIZE 64                    94060000
LNSZ80   EQU   80                       LINE SIZE 80                    94090000
LNNO6    EQU   6                        LINES PER SCREEN - 6            94120000
LNNO12   EQU   12                       LINES PER SCREEN - 12           94150000
LNNO15   EQU   15                       LINES PER SCREEN - 15           94180000
QINEC    EQU   21                       QTIP ENTRY CODE/TCLEARQ/INPUT   94210000
QOUTEC   EQU   22                       QTIP ENTRY CODE/TCLEARQ/OUTPUT  94240000
M8       EQU   8                        EIGHT                           94250002
M16      EQU   16                       SIXTEEN                         94260002
M12      EQU   12                       TWELVE                          94262002
M15      EQU   15                       FIFTEEN                         94264002
M32      EQU   32                       THIRTY-TWO              OZ27085 94265003
M40      EQU   40                       FORTY                           94266002
M43      EQU   43                       FORTY-THREE             OZ27085 94267003
M64      EQU   64                       SIXTY-FOUR                      94268002
M6       EQU   6                        SIX                             94268402
M24      EQU   24                       TWENTY-FOUR                     94268802
M80      EQU   80                       EIGHTY                          94269202
L80      EQU   80                       SAME AS ABOVE                   94269602
         SPACE 3                                                        94270000
********                                                                94300000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     94330000
********                                                                94360000
         USING *,RBASE                  BASE REGISTER ADDRESSABILITY    94540000
         USING TSB,RTSB                 TSB ADDRESSABILITY              94570000
         B     VALIDITY                 BR AROUND ID AND DATE   YS02019 94580002
         DC    C'IGG0940A'              MODULE IDENTIFIER       YS02019 94592002
         DC    X'3123'                  DATE - 05/03/73         YS02019 94594002
********                                                                94600000
******** VALIDITY CHECK PARAMETERS                                      94630000
********                                                                94660000
VALIDITY EQU   *                                                YS02019 94670002
         LR    RWORK2,RPARM0            PUT PARM IN WORK REG            94690000
         SLL   RWORK2,L8                DROP ENTRY CODE                 94720000
         SRL   RWORK2,L16               DROP PARAMETER                  94750000
         LTR   RWORK2,RWORK2            TEST PARM                       94780000
         BNZ   PARMBAD                  INVALID                         94810002
         LR    RWORK2,RPARM1            PUT PARM IN WORK REG            94840000
         SRL   RWORK2,L8                DROP PARM                       94870000
         LTR   RWORK2,RWORK2            TEST PARM                       94900000
         BNZ   PARMBAD                  INVALID                         94930002
********                                                                94960000
******** PERFORM MAIN FUNCTION OF ROUTINE                               94990000
********                                                                95020000
         SR    RCODE,RCODE              CLEAR RETURN CODE REGISTER      95050000
         LTR   RPARM1,RPARM1            LINE SIZE SPECIFIED      S22028 95080002
         BZ    RC08                     NO - INVALIDS            S22028 95110002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 95120002
         SLL   RPARM0,L8                DROP ENTRY CODE          Y01018 95140000
         SRL   RPARM0,L8                RESET REGISTER           Y01018 95170000
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY               95200000
         BO    DISPLAY                  YES                             95230000
NOTDSPLY EQU   *                                                        95260000
         LTR   RPARM0,RPARM0            SCREEN LENGTH SPECIFIED  S22028 95290002
         BNZ   RC08                     YES,INVALID FOR NONDISPLAYS     95320002
         STC   RPARM1,TSBLNSZ           SET NEW LINE SIZE IN TSB        95350000
         B     RETRN                    RETURN TO SUPERVISOR    YS02019 95380002
DISPLAY  EQU   *                                                        95410000
         LTR   RPARM0,RPARM0            SCREEN LENGTH SPECIFIED  S22028 95440002
         BZ    RC08                     NO PARM - INVALID               95470002
         STC   RPARM0,TSBLNNO           SET NUMBER OF LINES/SCREEN      95500000
         STC   RPARM1,TSBLNSZ           SET LINE SIZE                   95530000
         SPACE 3                                                        95580002
********                                                                95630002
******** CHECK SCREEN DIMENSIONS                                        95680002
********                                                                95730002
         CLI   TSBLNNO,LNNO12           LNNO SPECIFIED = 12      S22028 95780002
         BNE   CHK3270                  NO, CHK FOR 3270         S22028 95830002
         CLI   TSBLNSZ,M40              LNSZ SPECIFIED = 40      S22028 95880002
         BE    RETRN                    YES, RETURN             YS02019 95920002
         SPACE 1                                                 S22028 96080002
CHK3270  EQU   *                                                 S22028 96130002
         TM    TSBSTAT,TSB3270          TEST FOR 3270 TERMINAL   S22028 96180002
         BO    TERM3270                 BRANCH IF YES            S22028 96230002
TERM2260 EQU   *                                                 S22028 96330002
         CLI   TSBLNNO,M12              LNNO SPECIFIED = 12      S22028 96380002
         BNE   CKLNNO6                  NO, BRANCH               S22028 96390002
         CLI   TSBLNSZ,L80              LNSZ SPECIFIED = 80      S22028 96392002
         BE    RETRN                    YES, RETURN             YS02019 96394002
         SPACE 1                                                 S22028 96398002
CKLNNO6  EQU   *                                                 S22028 96398402
         CLI   TSBLNNO,M6               LNNO SPECIFIED 6         S22028 96398802
         BNE   CKLNNO15                 NO, BRANCH               S22028 96399202
         CLI   TSBLNSZ,M40              LNSZ SPECIFIED = 40      S22028 96399602
         BE    RETRN                    YES, RETURN             YS02019 96399702
         SPACE 1                                                 S22028 96399902
CKLNNO15 EQU   *                                                 S22028 96409902
         CLI   TSBLNNO,M15              LNNO SPECIFIED = 15      S22028 96419902
         BNE   RC0C                     NO, RETURN CODE = C      S22028 96423202
         CLI   TSBLNSZ,M64              LNSZ SPECIFIED = 64      S22028 96425202
         BNE   RC0C                     NO, RETURN CODE = C      S22028 96425602
         B     RETRN                    15X64 VALID FOR 2260    YS02019 96426002
         SPACE 1                                                 S22028 96426402
TERM3270 EQU   *                                                 S22028 96426502
         CLI   TSBLNNO,M24              LNNO SPECIFIED = 24      S22028 96426602
         BNE   CKLNNO32                 NO, CK OTHER LNNO'S     OZ27085 96427600
CKLSZ80  EQU   *                                                OZ27085 96430603
         CLI   TSBLNSZ,L80              LNSZ SPECIFIED = 80      S22028 96436902
         BNE   RC0C                     NO, RETURN CODE = C      S22028 96438902
         B     RETRN                    24X80, 32X80 OR 43X80   OZ27085 96439000
         SPACE 1                                                OZ27085 96439303
CKLNNO32 EQU   *                                                OZ27085 96439503
         CLI   TSBLNNO,M32              LNNO SPECIFIED = 32     OZ27085 96439703
         BE    CKLSZ80                  YES, CK LNSZ            OZ27085 96439903
         CLI   TSBLNNO,M43              LNNO SPECIFIED = 43     OZ27085 96440103
         BE    CKLSZ80                  YES, CK LNSZ; ELSE 0C   OZ27085 96440303
         SPACE 3                                                 S22028 96442902
RC0C     EQU   *                                                 S22028 96443302
         LA    RCODE,RETCODEC           SET RETURN CODE TO C     S22028 96452602
         B     RETRN                    RETURN TO SUPERVISOR    YS02019 96454602
         SPACE 3                                                        96456602
RC08     EQU   *                                                        96458602
         LA    RCODE,RETCODE8           SET RETURN CODE TO 08           96460602
         B     RETRN                    RETURN TO SUPERVISOR    YS02019 96461002
         SPACE 1                                                 S22028 96461402
PARMBAD  EQU   *                                                        96462102
         LA    RCODE,RETCODE4           INVALID PARAMETERS              96512102
RETRN    EQU   *                                                        96562102
         MODESET EXTKEY=SUPR            CHANGE TO KEY 0         YS02019 96572102
         BR    RLINK                    RETURN TO CALLER        YS02019 96582102
         SPACE 3                                                        96612102
         DC    9F'0'                    MAINTENANCE PATCH AREA  YS02019 96670002
         EJECT                                                          96730000
         IKJTSB                                                         96760000
         END                                                            96790000
./  ADD  SSI=31480245,NAME=IGG0940B
         TITLE 'IGG0940B - GTSIZE ROUTINE'                              00700020
IGG0940B CSECT                                                          01300020
         COPY  LCGASMS2                 LIBRARY CONTROL         YS02019 01400002
*0000765800-769000                                               M0590  85200000
*                                                                 M5113 85250000
*********************************************************************** 85300000
*                                                                     * 85350000
*    RELEASE 23 DELETIONS/CHANGES                                     * 85400000
*    RELEASE 22 DELETIONS/CHANGES                                     * 85450000
*    RELEASE 21 DELETIONS/CHANGES                                     * 85500000
*                                                                     * 85550000
* STATUS -                                                            * 85600000
*    CHANGE LEVEL 001                                                 * 85650000
*                                                                     * 85700000
* FUNCTION -                                                          * 85750000
*    THIS ROUTINE IS TO SERVE THE MACRO 'GTSIZE', WHICH               * 85800000
*    FURNISHES THE USER PHYSICAL LINE SIZE OF HIS TERMINAL (KEPT IN   * 85850000
*    TSBLNZ) IN REGISTER 1. FOR DISPLAY STATION, THIS ROUTINE WILL    * 85900000
*    ALSO FURNISH THE SCREEN LENGTH (KEPT IN TSBLNNO) IN REGISTER 0.  * 85950000
*                                                                     * 86000000
* ENTRY POINTS -                                                      * 86050000
*         IGG0940B - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 86100000
*                    VIA BRANCH ACCORDING ENTRY CODE 11, WITH THE     * 86110002
*                    LOCAL AND THE CMS LOCKS HELD AND IN              * 86120002
*                    SUPERVISOR KEY                                   * 86130002
*                                                                     * 86150000
* INPUT -                                                             * 86200000
*    REGISTER 0 CONTAINS PARAMETER                                    * 86250000
*    REGISTER 1 CONTAINS PARAMETER                                    * 86300000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 86350000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 86400000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 86450002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS          86500002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                              86550002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            86600002
*                                                                     * 86800000
* OUTPUT -                                                            * 86850000
*    REGISTER 0 HAS SCREEN LENGTH (OR 0 FOR NON-DISPLAY STATION)      * 86900000
*    REGISTER 1 HAS LINE SIZE                                         * 86950000
*    REGISTER 15 HAS RETURN CODE:                                     * 87000000
*           0 - SUCCESSFUL                                            * 87050000
*           4 - INVALID PARAMETER                                     * 87100000
* EXTERNAL REFERENCES -                                               * 87150000
*         NONE                                                        * 87200000
*                                                                     * 87250000
* EXITS, NORMAL -                                                     * 87300000
*         BR 14 WITH 0 IN REGISTER 15                                 * 87350002
*                                                                     * 87400000
* EXITS, ERROR -                                                      * 87450000
*         BR 14 WITH 4 IN REGISTER 15                                 * 87500002
*                                                                     * 87550000
* TABLES/WORK AREAS -                                                 * 87600000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 87650000
*                                                                     * 87700000
* ATTRIBUTES -                                                        * 87750000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, ENABLED                 * 87800000
*                                                                     * 87850000
* CHARACTER CODE DEPENDENCY -                                         * 87900000
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 87950000
* NOTES -                                                             * 88000000
*    NONE                                                             * 88050000
*                                                                     * 88100000
*********************************************************************** 88150000
         SPACE 3                                                        88200000
********                                                                88250000
******** EQUATES FOR REGISTERS AND MASKS                                88300000
********                                                                88350000
RPARM0   EQU   0                        PARAMETER REG 0                 88400000
RWORK0   EQU   0                        WORK REGISTER                   88450000
RPARM1   EQU   1                        PARAMETER REG 1                 88500000
RWORK1   EQU   1                        WORK REGISTER                   88550000
RWORK2   EQU   2                        WORK REGISTER                   88600000
RWORK3   EQU   3                        WORK REGISTER                   88650000
RCVT     EQU   3                        POINTS TO CVT                   88700000
RTCB     EQU   4                        POINTS TO TCB                   88850000
RTSB     EQU   5                        POINTS TO TSB           YS02019 89000002
RBASE    EQU   12                       BASE REGISTER                   89600000
RCONST   EQU   13                       POINTS TO PROGRAM CONSTANTS     89650000
R13      EQU   13                       REGISTER 13                     89700000
R14      EQU   14                       REGISTER 14                     89750000
RLINK    EQU   14                       LINK REGISTER                   89800000
R15      EQU   15                       REGISTER 15                     89900000
RBRANCH  EQU   15                       BRANCH REGISTER                 89950000
RCODE    EQU   15                       RETURN CODE REGISTER            90000000
         SPACE 2                                                        90050000
********                                                                90100000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           90150000
********                                                                90200000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         90250000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         90300000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         90350000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         90400000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      90450000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    90500000
D0       EQU   0                        DISPLACEMENT OF 0               90550000
D1       EQU   1                        DISPLACEMENT OF 1               90600000
D2       EQU   2                        DISPLACEMENT OF 2               90650000
D3       EQU   3                        DISPLACEMENT OF 3               90700000
D4       EQU   4                        DISPLACEMENT OF 4               90750000
D5       EQU   5                        DISPLACEMENT OF 5               90800000
D6       EQU   6                        DISPLACEMENT OF 6               90850000
D14      EQU   14                       DISPLACEMENT OF 14              90900000
L1       EQU   1                        LENGTH OF 1                     90950000
L2       EQU   2                        LENGTH OF 2                     91000000
L3       EQU   3                        LENGTH OF 3                     91050000
L4       EQU   4                        LENGTH OF 4                     91100000
L8       EQU   8                        LENGTH OF 8                     91150000
L16      EQU   16                       LENGTH OF 16                    91200000
L24      EQU   24                       LENGTH OF 24                    91250000
L32      EQU   32                       LENGTH OF 32                    91300000
RETCODE4 EQU   4                        RETURN CODE OF 4                91350000
RETCODE8 EQU   8                        RETURN CODE OF 8                91400000
RETCODEC EQU   12                       RETURN CODE OF 12               91450000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           91500000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       91550000
CZERO    EQU   0                        TO TEST FOR ZERO                91600000
CONE     EQU   1                        CONSTANT OF 1                   91650000
CTWO     EQU   2                        CONSTANT OF 2                   91700000
CTHREE   EQU   3                        CONSTANT OF 3                   91750000
CFIFTEEN EQU   15                       CONSTANT OF 15                  91800000
CSIXTEEN EQU   16                       CONSTANT OF 16                  91850000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                91900000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               91950000
OFF      EQU   X'FF'                    TO TURN BITS OFF                92000000
EXIT     EQU   3                        TO INVOKE EXIT,SVC 3            92050000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         92100000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     92150000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 92200000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    92250000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    92300000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           92350000
LNSZ40   EQU   40                       LINE SIZE 40                    92400000
LNSZ64   EQU   64                       LINE SIZE 64                    92450000
LNSZ80   EQU   80                       LINE SIZE 80                    92500000
LNNO6    EQU   6                        LINES PER SCREEN - 6            92550000
LNNO12   EQU   12                       LINES PER SCREEN - 12           92600000
LNNO15   EQU   15                       LINES PER SCREEN - 15           92650000
QINEC    EQU   21                       QTIP ENTRY CODE/TCLEARQ/INPUT   92700000
QOUTEC   EQU   22                       QTIP ENTRY CODE/TCLEARQ/OUTPUT  92750000
         SPACE 3                                                        92800000
********                                                                92850000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     92900000
********                                                                92950000
         USING *,RBASE                  BASE REGISTER ADDRESSABILITY    93250000
         USING TSB,RTSB                 TSB ADDRESSABILITY              93300000
         B     VALIDITY                 BR AROUND ID AND DATE   YS02019 93310002
         DC    C'IGG0940B'              MODULE IDENTIFIER       YS02019 93320002
         DC    X'3123'                  DATE - 05/03/73         YS02019 93330002
********                                                                93350000
******** CHECK FOR VALID PARAMETERS                                     93400000
********                                                                93450000
VALIDITY EQU   *                                                YS02019 93460002
         LTR   RPARM1,RPARM1            ANY PARM SPECIFIED              93500000
         BNZ   PARMBAD                  YES,INVALID                     93550000
********                                                                93600000
******** PERFORM MAIN FUNCTION OF ROUTINE                               93650000
********                                                                93700000
         SR    RPARM0,RPARM0            CLEAR REGISTER                  93750000
         SR    RPARM1,RPARM1            CLEAR REGISTER           Y01018 93800000
         CLI   TSBLNSZ,CZERO            TSB INDICATE LINE SIZE          93850000
         BE    PARMBAD                  NO,ERROR CONDITION              93900000
         IC    RPARM1,TSBLNSZ           YES,GET LINE SIZE FOR CALLER    93950000
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY TERMINAL      94000000
         BZ    RETURN                   NO,RETURN TO CALLER             94050000
         CLI   TSBLNNO,CZERO            YES,IS THERE A SCREEN SIZE      94100000
         BE    PARMBAD                  NO,ERROR CONDITION              94150000
         IC    RPARM0,TSBLNNO           YES,GET SCREEN SIZE FOR CALLER  94200000
RETURN   EQU   *                                                        94250000
         SR    RCODE,RCODE              SET GOOD RETURN CODE            94300000
         BR    RLINK                    RETURN TO SUPERVISOR    YS02019 94350002
PARMBAD  EQU   *                                                        94400000
         LA    RCODE,RETCODE4           SET PARM INVALID RETURN CODE    94450000
         BR    RLINK                    RETURN TO SUPERVISOR    YS02019 94500002
         DC    9F'0'                    MAINTENANCE PATCH AREA  YS02019 95000002
*                                       Y0101                   YS02019 95020002
         EJECT                                                          95100000
         IKJTSB                                                         95150000
         END                                                            95200000
./  ADD  SSI=33100023,NAME=IGG0940C
         TITLE 'IGG0940C - STAUTOCP ROUTINE'                            00500020
IGG0940C CSECT                                                          00530020
         COPY  LCGASMS2                                                 00580002
*0000824540-824700                                               M0590  98559000
*0000498600                                                      TS0007 98562000
*                                                                M2653  98565000
*                                                                 M2666 98568000
*                                                                M4283  98571000
*                                                                M0047  98574000
*                                                                 M5113 98577000
*                                                                 M5467 98580000
*                                                                       98583000
*********************************************************************** 98586000
*                                                                     * 98589000
*    RELEASE 23 DELETIONS/CHANGES                                     * 98592000
*    RELEASE 22 DELETIONS/CHANGES                                     * 98595000
*    RELEASE 21 DELETIONS/CHANGES                                     * 98598000
*0884744600,768440                                               M0104  98601000
*0884750480,754000,767000                                        S21008 98604000
*                                                                     * 98607000
* STATUS -                                                            * 98610000
*    CHANGE LEVEL 003                                                 * 98613000
*                                                                     * 98616000
* FUNCTION -                                                          * 98619000
*    THIS ROUTINE IS TO SERVE THE MACRO 'STAUTOCP'. IT IS TO PREPARE  * 98622000
*    THE CHARACTER FOR DIFFERENT TYPE OF TERMINALS. ITACTS AS A NOP   * 98625000
*    IF THE STAUTOCP MACRO IS ISSUED FOR A DISPLAY STATION. FOR       * 98628000
*    TERMINALS WHICH HAVE THE UNDERSCORE AND BACK SPACE, SUCH         * 98631000
*    CHARACTERS WILL BE MOVED TO TSB. FOR THE TERMINALS WHICH DO NOT  * 98634000
*    HAVE SUCH CHARACTERS, PERIOD AND CARRIAGE RETURN WILL BE MOVED   * 98637000
*    INTO THE TSB. THE TSBAUTOS, TSBAUTON, TSBAUTOC BITS WILL BE SET  * 98640000
*    ON. TSBAULST BIT WILL BE SET OFF.                                * 98643000
*                                                                     * 98646000
* ENTRY POINTS -                                                      * 98649000
*         IGG0940C - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 98652000
*                    VIA BRANCH ACCORDING TO ENTRY CODE 12            * 98654002
*                    WITH THE LOCAL AND THE CMS LOCKS HELD, AND       * 98654402
*                    IN SUPERVISOR KEY                                * 98654902
*                                                                     * 98655000
* INPUT -                                                             * 98658000
*    REGISTER 0 CONTAINS PARAMETER                                    * 98661000
*    REGISTER 1 CONTAINS PARAMETER                                    * 98664000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 98667000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 98670000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 98673002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS          98676002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                              98685002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            98688002
*                                                                     * 98694000
* OUTPUT -                                                            * 98697000
*    REGISTER 15 HAS RETURN CODE:                                     * 98700000
*           0 - SUCCESSFUL                                            * 98703000
*           4 - INVALID PARAMETER                                     * 98706000
*                                                                     * 98709000
* EXTERNAL REFERENCES -                                               * 98712000
*         NONE                                                        * 98715000
*                                                                     * 98718000
* EXITS, NORMAL -                                                     * 98721000
*         BR 14 WITH 0 IN REGISTER 15                                 * 98724002
*                                                                     * 98727000
* EXITS, ERROR -                                                      * 98730000
*         BR 14 WITH 4 IN REGISTER 15                                 * 98733002
*                                                                     * 98736000
* TABLES/WORK AREAS -                                                 * 98739000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 98742000
*                                                                     * 98745000
* ATTRIBUTES -                                                        * 98748000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, AND ENABLED             * 98751002
*                                                                     * 98754000
* CHARACTER CODE DEPENDENCY -                                         * 98757000
*    THIS MODULE IS ASSEMBLED IN EBCDIC AND MUST BE REASSEMBLED IF    * 98760000
*    A DIFFERENT CHARACTER SET IS TO BE USED DURING EXECUTION         * 98763000
* NOTES -                                                             * 98766000
*    NONE                                                             * 98769000
*                                                                     * 98772000
*********************************************************************** 98775000
********                                                                98778000
******** REGISTER EQUATES                                               98781000
********                                                                98784000
RPARM0   EQU   0                        PARAMETER REG 0                 98787000
RWORK0   EQU   0                        WORK REGISTER                   98790000
RPARM1   EQU   1                        PARAMETER REG 1                 98793000
RWORK1   EQU   1                        WORK REGISTER                   98796000
RWORK2   EQU   2                        WORK REGISTER                   98799000
RWORK3   EQU   3                        WORK REGISTER                   98802000
RCVT     EQU   3                        POINTS TO CVT                   98805000
RTCB     EQU   4                        POINTS TO TCB                   98814000
RTSB     EQU   5                        POINTS TO TSB           YS02019 98823002
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 98862002
*                                       CONSTANTS               YS02019 98863002
RBASE    EQU   12                       BASE REGISTER           YS02019 98864002
R13      EQU   13                       REGISTER 13                     98865000
R14      EQU   14                       REGISTER 14                     98868000
RLINK    EQU   14                       LINK REGISTER                   98871000
R15      EQU   15                       REGISTER 15                     98877000
RBRANCH  EQU   15                       BRANCH REGISTER                 98880000
RCODE    EQU   15                       RETURN CODE REGISTER            98883000
         SPACE 2                                                        98886000
********                                                                98889000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           98892000
********                                                                98895000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         98898000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         98901000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         98904000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         98907000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      98910000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    98913000
D0       EQU   0                        DISPLACEMENT OF 0               98916000
D1       EQU   1                        DISPLACEMENT OF 1               98919000
D2       EQU   2                        DISPLACEMENT OF 2               98922000
D3       EQU   3                        DISPLACEMENT OF 3               98925000
D4       EQU   4                        DISPLACEMENT OF 4               98928000
D5       EQU   5                        DISPLACEMENT OF 5               98931000
D6       EQU   6                        DISPLACEMENT OF 6               98934000
D14      EQU   14                       DISPLACEMENT OF 14              98937000
L1       EQU   1                        LENGTH OF 1                     98949000
L2       EQU   2                        LENGTH OF 2                     98952000
L3       EQU   3                        LENGTH OF 3                     98955000
L4       EQU   4                        LENGTH OF 4                     98958000
L8       EQU   8                        LENGTH OF 8                     98961000
L16      EQU   16                       LENGTH OF 16                    98964000
L20      EQU   20                       LENGTH OF 20                    98967000
L24      EQU   24                       LENGTH OF 24                    98970000
L31      EQU   31                       LENGTH OF 31                    98973000
L32      EQU   32                       LENGTH OF 32                    98976000
RETCODE4 EQU   4                        RETURN CODE OF 4                98979000
RETCODE8 EQU   8                        RETURN CODE OF 8                98982000
RETCODEC EQU   12                       RETURN CODE OF 12               98985000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           98988000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       98991000
CZERO    EQU   0                        TO TEST FOR ZERO                98994000
CONE     EQU   1                        CONSTANT OF 1                   98997000
CTWO     EQU   2                        CONSTANT OF 2                   99000000
CTHREE   EQU   3                        CONSTANT OF 3                   99003000
CFIFTEEN EQU   15                       CONSTANT OF 15                  99006000
CSIXTEEN EQU   16                       CONSTANT OF 16                  99009000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                99012000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               99015000
OFF      EQU   X'FF'                    TO TURN BITS OFF                99018000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         99024000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     99027000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 99030000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    99033000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    99036000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           99039000
LNSZ40   EQU   40                       LINE SIZE 40                    99042000
LNSZ64   EQU   64                       LINE SIZE 64                    99045000
LNSZ80   EQU   80                       LINE SIZE 80                    99048000
LNNO6    EQU   6                        LINES PER SCREEN - 6            99051000
LNNO12   EQU   12                       LINES PER SCREEN - 12           99054000
LNNO15   EQU   15                       LINES PER SCREEN - 15           99057000
QINEC    EQU   21                       QTIP ENTRY CODE/TCLEARQ/INPUT   99060000
QOUTEC   EQU   22                       QTIP ENTRY CODE/TCLEARQ/OUTPUT  99063000
         SPACE 3                                                        99066000
********                                                                99069000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     99072000
********                                                                99075000
         USING *,RBASE                  BASE REGISTER ADDRESSABILITY    99093000
         USING CVT,RCVT                 CVT ADDRESSABILITY              99096000
         USING TSB,RTSB                 TSB ADDRESSABILITY              99099000
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY         99123000
         B     VALIDITY                 BR AROUND ID AND DATE   YS02019 99125002
         DC    C'IGG0940C'              MODULE IDENTIFIER       YS02019 99125402
         DC    X'3304'                  DATE - 10/31/73         YA03021 99125802
********                                                                99126000
******** CHECK FOR VALID PARAMETERS                                     99129000
********                                                                99132000
VALIDITY EQU   *                                                YS02019 99134002
         LTR   RPARM1,RPARM1            ANY PARM SPECIFIED              99135000
         BNZ   PARMBAD                  YES,INVALID                     99138000
********                                                        YS02019 99148002
********ASSUME TCAM'S KEY TO REFERENCE TIOC CONTROL BLOCKS      YS02019 99158002
********                                                        YS02019 99168002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 99175002
********                                                                99210000
******** PERFORM MAIN FUNCTION OF ROUTINE                               99213000
********                                                                99216000
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY TERMINAL      99219000
         BO    RETURN                   YES,RETURN                      99222000
         OI    TSBFLG2,TSBAUTON+TSBAUTOC+TSBSTAUT                       99225000
*                                       INDICATE AUTO PROMPT REQUESTED, 99228000
*                                       AUTO CHAR. PROMPT STARTED,      99231000
*                                       THIS IS 1ST CHAR. PROMPT SENT   99234000
         NI    TSBFLG2,OFF-TSBAULST     TURN OFF AUTO LINE NUMBERING    99237000
         NI    TSBFLG3,OFF-TSBSPIT      ALLOW PROMPTING         YA03021 99239002
********                                                                99240000
******** CHECK TERMINAL TYPE AND SET APPROPRIATE CHAR. PROMPT CHARACTER 99243000
********                                                                99246000
         TM    TSBTERM2,TSBCTWX         IS IT A TWX TERMINAL    YS02019 99249002
         BO    PERIOD                   YES SET PERIOD/CR.RETURN        99252000
         MVC   TSBAUTOS(L3),CP5041      SET CHAR. PROMPT 2741/1050      99255000
         B     TPUT                     SEE IF TPUT IS REQUIRED         99258000
PERIOD   EQU   *                                                        99261000
         MVC   TSBAUTOS(L3),CPTWX       PERIOD/CR.RETURN CHAR. PROMPT   99264000
********                                                                99267000
******** CHECK TO SEE IF TPUT HAS ALREADY BE INITIATED                  99270000
********                                                                99273000
TPUT     EQU   *                                                        99276000
         TM    TSBFLG3,TSBTPUT          WAS TPUT ALREADY ISSUED YS02019 99279002
         BO    RETURN                   YES, NO NEED TO TPOST   YS02019 99327002
         OI    TSBFLG3,TSBTPUT          INDIC TPUT SCHEDULED    YS02019 99339002
         LA    RPARM1,TPMASK            ADDR OF TPOSTING MASK   YS02019 99378002
         L     R15,TPADDR               ADDR OF TPOSTING RTN    YS02019 99429002
         LR    RPARM0,RLINK             SAVE RETURN ADDR        YS02019 99431002
         BALR  R14,R15                  GO TPOST TSB            YS02019 99438002
         LR    RLINK,RPARM0             RESTORE RETURN ADDR     YS02019 99448002
RETURN   EQU   *                                                        99453000
         MODESET EXTKEY=SUPR            GET BACK IN KEY 0       YS02019 99489002
         SR    RCODE,RCODE              SET GOOD RETURN CODE    YS02019 99494402
         BR    RLINK                    RETURN TO CALLER        YS02019 99495002
PARMBAD  EQU   *                                                        99498000
         LA    RCODE,RETCODE4           INDICATE BAD PARAMETERS         99501000
         BR    RLINK                    RETURN TO CALLER        YS02019 99504002
PATCH    DC    9F'0'                    PATCH AREA              YS02019 99514002
CONSTANT DSECT                          DEFINES CONSTANTS IN 1ST CSECT  99687000
ZERO     DC    F'0'                     CONSTANT OF 0                   99690000
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          99693000
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  99696000
TWO      DC    XL1'02'                  CONSTANT OF 2                   99699000
TEN      DC    H'10'                    CONSTANT OF 10                  99702000
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  99705000
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS            99708000
SIX      DC    H'6'                     CONSTANT OF 6                   99711000
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   99714000
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    99717000
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         99720000
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  99723000
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               99726000
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    99729000
ONE      DC    AL1(1)                   CONSTANT OF ONE                 99732000
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER     YA00364 99742002
TPADDR   DC    V(POSTTSB)               ADDR OF TPOSTING RTN    YS02019 99742402
TPMASK   DS    4F                       TPOST QCB TO ITSELF     YS02019 99744002
         EJECT                                                          99747002
CVT      DSECT                                                          99759002
         CVT                                                            99760002
         EJECT                                                          99761002
         IHAPSA                                                         99762002
         EJECT                                                          99763002
         IKJTSB                                                         99765002
         END                                                            99960000
./  ADD  SSI=31480253,NAME=IGG0940D
         TITLE 'IGG0940D - SPAUTOPT ROUTINE'                            97360000
IGG0940D CSECT                                                          97370000
*0000799000-800000,808000                                        M1614  97380000
*                                                                 M5113 97390000
*                                                                 M5467 97400000
*********************************************************************** 97410000
*                                                                     * 97420000
*    RELEASE 23 DELETIONS/CHANGES                                     * 97430000
*    RELEASE 22 DELETIONS/CHANGES                                     * 97440000
*    RELEASE 21 DELETIONS/CHANGES                                     * 97450000
*                                                                     * 97460000
* STATUS -                                                            * 97470000
*    CHANGE LEVEL 001                                                 * 97480000
*                                                                     * 97490000
* FUNCTION -                                                          * 97500000
*    THIS ROUTINE IS TO SERVE THE MACRO 'SPAUTOPT'.  IT IS TO         * 97510000
*    SET THE BIT CONDITION IN TSB (TSBAUTOTN,TSBAUTOC,TSBAULST) TO    * 97520000
*    REFLECT THAT AUTOMATIC PROMPTING IS STOPPED THROUGH THE USE OF   * 97530000
*    THE 'SPAUTOPT' MACRO. ONCE STOPPED IN THIS MANNER, THE AUTOMATIC * 97540000
*    PROMPT MAY NOT BE RESTARTED.                                     * 97550000
*                                                                     * 97560000
*    AFTER THIS FUNCTION IS SUCCESSFULLY COMPLETED, A CODE OF '00' IS * 97570000
*    RETURNED TO THE CALLER.                                          * 97580000
*                                                                     * 97590000
* ENTRY POINTS -                                                      * 97600000
*         IGG0940D - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 97610000
*                    VIA BRANCH ACCORDING ENTRY CODE 13 WITH          * 97612002
*                    THE LOCAL AND CMS LOCKS HELD AND IN              * 97614002
*                    SUPERVISOR KEY                                   * 97616002
*                                                                     * 97620000
* INPUT -                                                             * 97630000
*    REGISTER 0 CONTAINS PARAMETER                                    * 97640000
*    REGISTER 1 CONTAINS PARAMETER                                    * 97650000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 97660000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 97670000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 97680002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS          97690002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                              97740002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            97745002
*                                                                       97750000
* OUTPUT -                                                            * 97760000
*    REGISTER 15 HAS RETURN CODE:                                     * 97770000
*           0 - SUCCESSFUL                                            * 97780000
*           4 - INVALID PARAMETER                                     * 97790000
*           8 - AUTOMATIC PROMPT HAS NOT PREVIOUSLY BEEN STARTED      * 97800000
*                                                                     * 97810000
* EXTERNAL REFERENCES -                                               * 97820000
*         NONE                                                        * 97830000
*                                                                     * 97840000
* EXITS, NORMAL -                                                     * 97850000
*         BR 14 WITH 0 IN REGISTER 15                                 * 97860002
*                                                                     * 97870000
* EXITS, ERROR -                                                      * 97880000
*         BR 14 WITH 4 OR 8 IN REGISTER 15                            * 97890002
*                                                                     * 97900000
* TABLES/WORK AREAS -                                                 * 97910000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 97920000
*                                                                     * 97930000
* ATTRIBUTES -                                                        * 97940000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, AND ENABLED             * 97950000
*                                                                     * 97960000
* CHARACTER CODE DEPENDENCY -                                         * 97970000
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 97980000
* NOTES -                                                             * 97990000
*    NONE                                                             * 98000000
*                                                                     * 98010000
*                                                                     * 98020000
*********************************************************************** 98030000
         SPACE 3                                                        98040000
********                                                                98050000
******** REGISTER EQUATES                                               98060000
********                                                                98070000
RPARM0   EQU   0                        PARAMETER REG 0                 98080000
RWORK0   EQU   0                        WORK REGISTER                   98090000
RPARM1   EQU   1                        PARAMETER REG 1                 98100000
RWORK1   EQU   1                        WORK REGISTER                   98110000
RWORK2   EQU   2                        WORK REGISTER                   98120000
RWORK3   EQU   3                        WORK REGISTER                   98130000
RCVT     EQU   3                        POINTS TO CVT                   98140000
RTCB     EQU   4                        POINTS TO TCB                   98170000
RTSB     EQU   5                        POINTS TO TSB           YS02019 98200002
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 98330002
*                                       CONSTANTS               YS02019 98333002
RBASE    EQU   12                       BASE REGISTER           YS02019 98336002
R13      EQU   13                       REGISTER 13                     98340000
R14      EQU   14                       REGISTER 14                     98350000
RLINK    EQU   14                       LINK REGISTER                   98360000
R15      EQU   15                       REGISTER 15                     98380000
RBRANCH  EQU   15                       BRANCH REGISTER                 98390000
RCODE    EQU   15                       RETURN CODE REGISTER            98400000
         SPACE 2                                                        98410000
********                                                                98420000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           98430000
********                                                                98440000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         98450000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         98460000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         98470000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         98480000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      98490000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    98500000
D0       EQU   0                        DISPLACEMENT OF 0               98510000
D1       EQU   1                        DISPLACEMENT OF 1               98520000
D2       EQU   2                        DISPLACEMENT OF 2               98530000
D3       EQU   3                        DISPLACEMENT OF 3               98540000
D4       EQU   4                        DISPLACEMENT OF 4               98550000
D5       EQU   5                        DISPLACEMENT OF 5               98560000
D6       EQU   6                        DISPLACEMENT OF 6               98570000
D14      EQU   14                       DISPLACEMENT OF 14              98580000
L1       EQU   1                        LENGTH OF 1                     98590000
L2       EQU   2                        LENGTH OF 2                     98600000
L3       EQU   3                        LENGTH OF 3                     98610000
L4       EQU   4                        LENGTH OF 4                     98620000
L8       EQU   8                        LENGTH OF 8                     98630000
L16      EQU   16                       LENGTH OF 16                    98640000
L24      EQU   24                       LENGTH OF 24                    98650000
L32      EQU   32                       LENGTH OF 32                    98660000
RETCODE4 EQU   4                        RETURN CODE OF 4                98670000
RETCODE8 EQU   8                        RETURN CODE OF 8                98680000
RETCODEC EQU   12                       RETURN CODE OF 12               98690000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           98700000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       98710000
CZERO    EQU   0                        TO TEST FOR ZERO                98720000
CONE     EQU   1                        CONSTANT OF 1                   98730000
CTWO     EQU   2                        CONSTANT OF 2                   98740000
CTHREE   EQU   3                        CONSTANT OF 3                   98750000
CFIFTEEN EQU   15                       CONSTANT OF 15                  98760000
CSIXTEEN EQU   16                       CONSTANT OF 16                  98770000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                98780000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               98790000
OFF      EQU   X'FF'                    TO TURN BITS OFF                98800000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         98820000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     98830000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 98840000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    98850000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    98860000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           98870000
         SPACE 3                                                        98960000
********                                                                98970000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     98980000
********                                                                98990000
         USING *,RBASE                  BASE REGISTER ADDRESSABILITY    99040000
         USING TSB,RTSB                 TSB ADDRESSABILITY              99050000
         B     VALIDITY                 BR AROUND ID AND DATE   YS02019 99052002
         DC    C'IGG0940D'              MODULE IDENTIFIER       YS02019 99054002
         DC    X'3123'                  DATE - 05/03/73         YS02019 99056002
********                                                                99060000
******** CHECK FOR VALID PARAMETER                                      99070000
********                                                                99080000
VALIDITY EQU   *                                                YS02019 99082002
         LTR   RPARM1,RPARM1            ANY PARM SPECIFIED              99090000
         BNZ   PARMBAD                  YES,INVALID                     99100000
********                                                                99110000
******** PERFORM MAIN FUNCTION OF ROUTINE                               99120000
********                                                                99130000
         TM    TSBFLG2,TSBAULST         AUTO LINE NUMBERING ON          99140000
         BO    AUTOFF                   YES,TURN OFF FUNCTION           99150000
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY TERMINAL      99160000
         BO    RETURN                   RETURN TO CALLER        YS02019 99180002
TEST     EQU   *                                                        99190000
         TM    TSBFLG2,TSBAUTOC         AUTO CHAR. PROMPT ON            99200000
         BNZ   AUTOFF                   BRANCH IF YES                   99210000
         LA    RCODE,RETCODE8           SET ERROR RETURN CODE           99220000
         B     EXIT                     RETURN TO CALLER        YS02019 99230002
AUTOFF   EQU   *                                                        99240000
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 99248802
         NI    TSBFLG2,OFF-(TSBAUTON+TSBAUTOC+TSBAULST)                 99250000
*                                       TURN OFF ALL AUTOPROMPTING BITS 99260000
         MODESET EXTKEY=SUPR            GET BACK IN KEY 0       YS02019 99261002
RETURN   EQU   *                                                        99270000
         SR    RCODE,RCODE              SET GOOD RETURN CODE            99280000
EXIT     EQU   *                                                YS02019 99285002
         BR    RLINK                    RETURN TO CALLER        YS02019 99290002
PARMBAD  EQU   *                                                        99300000
         LA    RCODE,RETCODE4           SET BAD PARM RET. CODE          99310000
         BR    RLINK                    RETURN TO CALLER        YS02019 99320002
         DC    9F'0'                    PATCH AREA              YS02019 99420002
         EJECT                                                          99430002
         IHAPSA                                                         99435002
         EJECT                                                          99440000
         IKJTSB                                                         99450000
         END                                                            99460000
./  ADD  SSI=33100025,NAME=IGG0940E
         TITLE 'IGG0940E - RTAUTOPT ROUTINE'                            00400020
IGG0940E CSECT                                                          00800020
         COPY  LCGASMS2                                                 00850002
*0000760500-761700                                               M0590  92110000
*0000                                                            TS0007 92130000
*                                                                 M2669 92150000
*                                                                M4283  92170000
*                                                                M0047  92190000
*                                                                 M5113 92210000
*                                                                 M5467 92230000
*********************************************************************** 92250000
*    RELEASE 23 DELETIONS/CHANGES                                     * 92270000
*    RELEASE 22 DELETIONS/CHANGES                                     * 92290000
*    RELEASE 21 DELETIONS/CHANGES                                     * 92310000
*0885563780-563810                                               M0108  92330000
*0885563600,634000                                               M0104  92350000
*0885569000                                                      M0101  92370000
*0885                                                            S21008 92390000
*                                                                     * 92410000
* STATUS -                                                            * 92430000
*    CHANGE LEVEL 001                                                 * 92450000
*                                                                     * 92470000
* FUNCTION -                                                          * 92490000
*    THIS ROUTINE IS TO SERVE THE MACRO 'RTAUTOPT'. IT IS TO          * 92510000
*    SET THE BIT CONDITION IN TSB (TSBAUTON) TO REFLECT THAT AUTOMATIC* 92530000
*    PROMPTING IS RESTARTED. WHEN THE USER REQUESTS RESTARTING OF     * 92550000
*    AUTOMATIC PROMPTING FACILITY, TSBAULST BIT AND TSBAUTOC BIT ARE  * 92570000
*    CHECKED TO SEE WHETHER THIS FACILITY HAS PREVIOUSLY BEEN STARTED.* 92590000
*                                                                     * 92610000
* ENTRY POINTS -                                                      * 92630000
*         IGG0940E - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 92650000
*                    VIA BRANCH ACCORDING ENTRY CODE 14 HOLDING       * 92660002
*                    THE LOCAL AND THE CMS LOCKS, IN SUPERVISOR KEY   * 92662002
* INPUT -                                                             * 92670000
*    REGISTER 0 CONTAINS PARAMETER                                    * 92690000
*    REGISTER 1 CONTAINS PARAMETER                                    * 92710000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 92730000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 92750000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 92770002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS        * 92790002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                            * 92830002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                          * 92890002
*                                                                     * 92910000
* OUTPUT -                                                            * 92930000
*    REGISTER 15 HAS RETURN CODE:                                     * 92950000
*           0 - SUCCESSFUL                                            * 92970000
*           4 - INVALID PARAMETER                                     * 92990000
*           8 - AUTOMATIC PROMPTING NOT PREVIOUSLY STARTED            * 93010000
*                                                                     * 93030000
* EXTERNAL REFERENCES -                                               * 93050000
*         NONE                                                        * 93070000
*                                                                     * 93090000
* EXITS, NORMAL -                                                     * 93110000
*         BR 14 WITH 0 IN REGISTER 15                                 * 93130002
*                                                                     * 93150000
* EXITS, ERROR -                                                      * 93170000
*         BR 14 WITH 4 OR 8 IN REGISTER 15                            * 93190002
*                                                                     * 93210000
* TABLES/WORK AREAS -                                                 * 93230000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 93250000
*                                                                     * 93270000
* ATTRIBUTES -                                                        * 93290000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, AND ENABLED             * 93310002
*                                                                     * 93330000
* CHARACTER CODE DEPENDENCY -                                         * 93350000
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 93370000
* NOTES -                                                             * 93390000
*    NONE                                                             * 93410000
*                                                                     * 93430000
*********************************************************************** 93450000
         SPACE 3                                                        93470000
********                                                                93490000
******** REGISTER EQUATES                                               93510000
********                                                                93530000
RPARM0   EQU   0                        PARAMETER REG 0                 93550000
RWORK0   EQU   0                        WORK REGISTER                   93570000
RPARM1   EQU   1                        PARAMETER REG 1                 93590000
RWORK1   EQU   1                        WORK REGISTER                   93610000
RWORK2   EQU   2                        WORK REGISTER                   93630000
RWORK3   EQU   3                        WORK REGISTER                   93650000
RCVT     EQU   3                        POINTS TO CVT                   93670000
RTCB     EQU   4                        POINTS TO TCB                   93730000
RTSB     EQU   5                        POINTS TO TSB           YS02019 93790002
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 94050002
*                                       CONSTANTS               YS02019 94056002
RBASE    EQU   12                       BASE REGISTER           YS02019 94062002
R13      EQU   13                       REGISTER 13                     94070000
R14      EQU   14                       REGISTER 14                     94090000
RLINK    EQU   14                       LINK REGISTER                   94110000
R15      EQU   15                       REGISTER 15                     94150000
RBRANCH  EQU   15                       BRANCH REGISTER                 94170000
RCODE    EQU   15                       RETURN CODE REGISTER            94190000
         SPACE 2                                                        94210000
********                                                                94230000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           94250000
********                                                                94270000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         94290000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         94310000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         94330000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         94350000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      94370000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    94390000
D0       EQU   0                        DISPLACEMENT OF 0               94410000
D1       EQU   1                        DISPLACEMENT OF 1               94430000
D2       EQU   2                        DISPLACEMENT OF 2               94450000
D3       EQU   3                        DISPLACEMENT OF 3               94470000
D4       EQU   4                        DISPLACEMENT OF 4               94490000
D5       EQU   5                        DISPLACEMENT OF 5               94510000
D6       EQU   6                        DISPLACEMENT OF 6               94530000
D14      EQU   14                       DISPLACEMENT OF 14              94550000
L1       EQU   1                        LENGTH OF 1                     94570000
L2       EQU   2                        LENGTH OF 2                     94590000
L3       EQU   3                        LENGTH OF 3                     94610000
L4       EQU   4                        LENGTH OF 4                     94630000
L8       EQU   8                        LENGTH OF 8                     94650000
L16      EQU   16                       LENGTH OF 16                    94670000
L24      EQU   24                       LENGTH OF 24                    94690000
L32      EQU   32                       LENGTH OF 32                    94710000
RETCODE4 EQU   4                        RETURN CODE OF 4                94730000
RETCODE8 EQU   8                        RETURN CODE OF 8                94750000
RETCODEC EQU   12                       RETURN CODE OF 12               94770000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           94790000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       94810000
CZERO    EQU   0                        TO TEST FOR ZERO                94830000
CONE     EQU   1                        CONSTANT OF 1                   94850000
CTWO     EQU   2                        CONSTANT OF 2                   94870000
CTHREE   EQU   3                        CONSTANT OF 3                   94890000
CFIFTEEN EQU   15                       CONSTANT OF 15                  94910000
CSIXTEEN EQU   16                       CONSTANT OF 16                  94930000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                94950000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               95030000
OFF      EQU   X'FF'                    TO TURN BITS OFF                95050000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         95090000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     95110000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 95130000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    95150000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    95170000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           95190000
LNSZ40   EQU   40                       LINE SIZE 40                    95210000
LNSZ64   EQU   64                       LINE SIZE 64                    95230000
LNSZ80   EQU   80                       LINE SIZE 80                    95250000
LNNO     EQU   6                        LINES PER SCREEN - 6            95270000
LNNO12   EQU   12                       LINES PER SCREEN - 12           95290000
LNNO15   EQU   15                       LINES PER SCREEN - 15           95310000
QINEC    EQU   21                       QTIP ENTRY CODE/TCLEARQ/INPUT   95330000
QOUTEC   EQU   22                       QTIP ENTRY CODE/TCLEARQ/OUTPUT  95350000
         SPACE 3                                                        95370000
         SPACE 3                                                        95390000
********                                                                95410000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     95430000
********                                                                95450000
         USING *,RBASE                  BASE REGISTER ADDRESSABILITY    95570000
         USING TSB,RTSB                 TSB ADDRESSABILITY              95590000
         USING CVT,RCVT                 CVT ADDRESSABILITY              95610000
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY         95750000
         B     VALIDATE                 BR AROUND ID AND DATE   YS02019 95760002
         DC    C'IGG0940E'              MODULE IDENTIFIER       YS02019 95762002
         DC    X'3304'                  DATE - 10/31/73         YA03021 95764002
********                                                                95770000
******** CHECK FOR VALID PARAMETER                                      95790000
********                                                                95810000
VALIDATE EQU   *                                                YS02019 95820002
         LTR   RPARM1,RPARM1            ANY PARM SPECIFIED              95830000
         BNZ   PARMBAD                  YES, PARM INVALID       YS02019 95850002
********                                                                96170000
******** WAS AUTO LINE NUMBERING OR AUTO CHAR. PROMPT PREVIOUSLY ON     96190000
********                                                                96210000
         TM    TSBFLG2,TSBAUTON         AUTO PROMPTING NOW ON    Y01018 96230000
         BO    RETURN                   YES, DON'T RESTART       Y01018 96250000
         TM    TSBFLG2,TSBAULST         WAS AUTO LINE NO. ON            96270000
         BNZ   PUTITOUT                 YES,HAS A PUT BEEN      YS02019 96310002
*                                       INITIATED               YS02019 96320002
CKAUTOCP EQU   *                                                        96330000
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY TERMINAL      96350000
         BO    RETURN                   YES, DO NOTHING                 96370000
         TM    TSBFLG2,TSBAUTOC         WAS CHAR. PROMPT ON BEFORE      96390000
         BNZ   PUTITOUT                 YES,HAS A TPUT BEEN INITIATED   96410000
         LA    RCODE,RETCODE8           NO,SET ERROR RETURN CODE        96430000
         BR    RLINK                    RETURN TO CALLER        YS02019 96450002
PUTITOUT EQU   *                                                        96470000
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 96480002
         OI    TSBFLG2,TSBAUTON+TSBSTAUT INDICATE AUTO PROMPTING        96490000
*                                       STARTED,THIS IS THE 1ST PROMPT  96510000
         NI    TSBFLG3,OFF-TSBSPIT      ALLOW PROMPTING         YA03021 96560002
         TM    TSBFLG3,TSBTPUT          IS TSOUTPUT SCHEDULED   YS02019 96830002
*                                       TO GET CONTROL                  96890002
         BO    GOBACK                   YES, DON'T TPOST        YS02019 96930002
         OI    TSBFLG3,TSBTPUT          INDIC TPUT SCHEDULED    YS02019 96950002
*                                       YS0201                  YS02019 96960002
         LA    RPARM1,TPMASK            ADDR OF TPOSTING MASK   YS02019 96990002
         L     R15,TPADDR               ADDR OF TPOSTING RTN    YS02019 97030002
         LR    RPARM0,RLINK             SAVE RETURN ADDRESS     YS02019 97080002
         BALR  R14,R15                  GO TPOST TSB TO         YS02019 97090002
*                                       SCHEDULE TSOUTPUT               97092002
         LR    RLINK,RPARM0             RETURN RETURN ADDRESS   YS02019 97100002
GOBACK   EQU   *                                                        97140002
         MODESET EXTKEY=SUPR            GET KEY FOR SETLOCK     YS02019 97150002
RETURN   EQU   *                                                        97160002
         SR    RCODE,RCODE              SET ZERO RETURN CODE    YS02019 97200002
         BR    RLINK                    RETURN TO CALLER        YS02019 97250002
PARMBAD  EQU   *                                                        98030000
         LA    RCODE,RETCODE4           INDICATE BAD PARAMETERS         98050000
         BR    RLINK                    RETURN TO CALLER        YS02019 98070002
PATCH    DC    9F'0'                    PATCH AREA              YS02019 98630002
         SPACE 3                                                        98640002
CONSTANT DSECT                          DEFINES CONSTANTS IN 1ST CSECT  98670000
ZERO     DC    F'0'                     CONSTANT OF 0                   98690000
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          98710000
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  98730000
TWO      DC    XL1'02'                  CONSTANT OF 2                   98750000
TEN      DC    H'10'                    CONSTANT OF 10                  98770000
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  98790000
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS            98810000
SIX      DC    H'6'                     CONSTANT OF 6                   98830000
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   98850000
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    98870000
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         98890000
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  98910000
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               98930000
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    98950000
ONE      DC    AL1(1)                   CONSTANT OF ONE         YS02019 98954002
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER     YA00364 98964002
TPADDR   DC    V(POSTTSB)               ADDR OF TPOSTING RTN    YS02019 99014002
TPMASK   DS    4F                       TPOST QCB TO ITSELF     YS02019 99064002
         EJECT                                                          99310000
CVT      DSECT                                                          99350002
         CVT                                                            99410002
         EJECT                                                          99450002
         IHAPSA                                                         99470002
         EJECT                                                          99480002
         IKJTSB                                                         99510000
         END                                                            99650000
./  ADD  SSI=31480259,NAME=IGG0940G
         TITLE 'IGG0940G - STCLEAR ROUTINE'                             85280000
IGG0940G CSECT                                                          85310000
         COPY  LCGASMS2                                                 85320002
*0000717000-721000                                               M0590  85340000
*0000468000-488000                                               TS0023 85370000
*                                                                M2651  85400000
*                                                                M4283  85430000
*                                                                 M5113 85460000
*                                                                 M5467 85490000
*                                                                       85520000
*********************************************************************** 85550000
*    RELEASE 23 DELETIONS/CHANGES                                     * 85580000
*    RELEASE 22 DELETIONS/CHANGES                                     * 85610000
*    RELEASE 21 DELETIONS/CHANGES                                     * 85640000
*                                                                     * 85670000
* STATUS -                                                            * 85700000
*    CHANGE LEVEL 001                                                 * 85730000
*                                                                     * 85760000
* FUNCTION -                                                          * 85790000
*    THIS ROUTINE IS TO SERVE THE MACRO 'STCLEAR'. THE CHARACTER      * 85820000
*    STRING (1 TO 4 CHARACTERS) WHICH IS TO BE USED TO ERASE A        * 85850000
*    DISPLAY STATION SCREEN WILL BE STORED IN 'TSBERSDS'. ZEROS IN    * 85880000
*    THIS FIELD INDICATE THAT NO CHARACTER STRING WILL BE USED TO     * 85910000
*    ERASE THE SCREEN.                                                * 85940000
*                                                                     * 85970000
* ENTRY POINTS -                                                      * 86000000
*         IGG0940G - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 86030000
*                    VIA BRANCH ACCORDING TO ENTRY CODE 16, HOLDING   * 86040002
*                    THE LOCAL AND THE CMS LOCKS, IN SUPERVISOR KEY   * 86050002
*                                                                     * 86060000
* INPUT -                                                             * 86090000
*    REGISTER 0 CONTAINS PARAMETER                                    * 86120000
*    REGISTER 1 CONTAINS PARAMETER                                    * 86150000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 86180000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 86210000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 86240002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS        * 86270002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                            * 86300002
*    REGISTER 15 CONTAINS THE RETURN ADDRESS                          * 86360002
*                                                                     * 86450000
* OUTPUT -                                                            * 86480000
*    REGISTER 15 HAS RETURN CODE:                                     * 86510000
*           0 - SUCCESSFUL                                            * 86540000
*           4 - INVALID PARAMETER                                     * 86570000
*           8 - INVALID TERMINAL TYPE                                 * 86600000
*                                                                     * 86630000
* EXTERNAL REFERENCES -                                               * 86660000
*         NONE                                                        * 86690000
*                                                                     * 86720000
* EXITS, NORMAL -                                                     * 86750000
*         BR 14 WITH 0 IN REGISTER 15                                 * 86780002
*                                                                     * 86810000
* EXITS, ERROR -                                                      * 86840000
*         BR 14 WITH 4 OR 8 IN REGISTER 15                            * 86870002
*                                                                     * 86900000
* TABLES/WORK AREAS -                                                 * 86930000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 86960000
*                                                                     * 86990000
* ATTRIBUTES -                                                        * 87020000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, ENABLED                 * 87050000
*                                                                     * 87080000
* CHARACTER CODE DEPENDENCY -                                         * 87110000
*    THIS MODULE IS ASSEMBLED IN EBCDIC AND MUST BE REASSEMBLED IF    * 87140000
*    A DIFFERENT CHARACTER SET IS TO BE USED DURING EXECUTION         * 87170000
* NOTES -                                                             * 87200000
*         VS01537 - REFERENCED USER CORE IN TCAM'S KEY - 0C4          * 87250002
*                                                                     * 87260000
*********************************************************************** 87290000
         SPACE 3                                                        87320000
********                                                                87350000
******** REGISTER EQUATES                                               87380000
RPARM0   EQU   0                        PARAMETER REG 0                 87410000
RWORK0   EQU   0                        WORK REGISTER                   87440000
RPARM1   EQU   1                        PARAMETER REG 1                 87470000
RWORK1   EQU   1                        WORK REGISTER                   87500000
RWORK2   EQU   2                        WORK REGISTER                   87530000
RWORK3   EQU   3                        WORK REGISTER                   87560000
RCVT     EQU   3                        POINTS TO CVT                   87590000
RTCB     EQU   4                        POINTS TO TCB                   87680000
RUCB     EQU   4                        POINTS TO UCB                   87710000
RTSB     EQU   5                        POINTS TO TSB           YS02019 87770002
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 88160002
*                                       CONSTANTS               YS02019 88170002
RBASE    EQU   12                       BASE REGISTER           YS02019 88180002
R13      EQU   13                       REGISTER 13                     88190000
R14      EQU   14                       REGISTER 14                     88220000
RLINK    EQU   14                       LINK REGISTER                   88250000
R15      EQU   15                       REGISTER 15                     88310000
RBRANCH  EQU   15                       BRANCH REGISTER                 88340000
RCODE    EQU   15                       RETURN CODE REGISTER            88370000
         SPACE 2                                                        88400000
********                                                                88430000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           88460000
********                                                                88490000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         88520000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         88550000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         88580000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         88610000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      88640000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    88670000
D0       EQU   0                        DISPLACEMENT OF 0               88700000
D1       EQU   1                        DISPLACEMENT OF 1               88730000
D2       EQU   2                        DISPLACEMENT OF 2               88760000
D3       EQU   3                        DISPLACEMENT OF 3               88790000
D4       EQU   4                        DISPLACEMENT OF 4               88820000
D5       EQU   5                        DISPLACEMENT OF 5               88850000
D6       EQU   6                        DISPLACEMENT OF 6               88880000
D14      EQU   14                       DISPLACEMENT OF 14              88910000
L1       EQU   1                        LENGTH OF 1                     88940000
L2       EQU   2                        LENGTH OF 2                     88970000
L3       EQU   3                        LENGTH OF 3                     89000000
L4       EQU   4                        LENGTH OF 4                     89030000
L8       EQU   8                        LENGTH OF 8                     89060000
L16      EQU   16                       LENGTH OF 16                    89090000
L20      EQU   20                       LENGTH OF 20                    89120000
L24      EQU   24                       LENGTH OF 24                    89150000
L31      EQU   31                       LENGTH OF 31                    89180000
L32      EQU   32                       LENGTH OF 32                    89210000
RETCODE4 EQU   4                        RETURN CODE OF 4                89240000
RETCODE8 EQU   8                        RETURN CODE OF 8                89270000
RETCODEC EQU   12                       RETURN CODE OF 12               89300000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           89330000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       89360000
CZERO    EQU   0                        TO TEST FOR ZERO                89390000
CONE     EQU   1                        CONSTANT OF 1                   89420000
CTWO     EQU   2                        CONSTANT OF 2                   89450000
CTHREE   EQU   3                        CONSTANT OF 3                   89480000
CFIFTEEN EQU   15                       CONSTANT OF 15                  89510000
CSIXTEEN EQU   16                       CONSTANT OF 16                  89540000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                89570000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               89690000
OFF      EQU   X'FF'                    TO TURN BITS OFF                89720000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         89780000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     89810000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 89840000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    89870000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    89900000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           89930000
LNSZ40   EQU   40                       LINE SIZE 40                    89960000
LNSZ64   EQU   64                       LINE SIZE 64                    89990000
LNSZ80   EQU   80                       LINE SIZE 80                    90020000
LNNO6    EQU   6                        LINES PER SCREEN - 6            90050000
LNNO12   EQU   12                       LINES PER SCREEN - 12           90080000
LNNO15   EQU   15                       LINES PER SCREEN - 15           90110000
QINEC    EQU   21                       QTIP ENTRY CODE/TCLEARQ/INPUT   90140000
QOUTEC   EQU   22                       QTIP ENTRY CODE/TCLEARQ/OUTPUT  90170000
         SPACE 3                                                        90200000
********                                                                90230000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     90260000
********                                                                90290000
         USING *,RBASE                  BASE REGISTER ADDRESSABILITY    90470000
         USING TSB,RTSB                 TSB ADDRESSABILITY              90620000
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY         90770000
         B     DISPLAY                  BRANCH AROUND MODULE ID YS02019 90780002
         DC    CL8'IGG0940G'            MODULE ID               YS02019 90790002
         DC    X'3124'                  DATE OF LAST UPDATE 5/04/73     90792002
********                                                                90800000
******** PERFORM MAIN FUNCTION OF ROUTINE                               90830000
********                                                                90860000
DISPLAY  EQU   *                                                        90870002
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY TERMINAL      90890000
         BZ    BADTERM                  NO,INVALID TERMINAL TYPE        90920000
         LTR   RPARM1,RPARM1            STRING PARM SPECIFIED           90950000
         BNZ   CKSTRING                 YES,CHECK THE STRING            90980000
         XC    TSBERSDS,TSBERSDS        NO,CLEAR SCREEN ERASE FIELD     91010000
         B     RETURN                   RETURN TO CALLER                91040000
********                                                                91070000
******** MOVE CHARACTER STRING TO TSB                                   91100002
********                                                                91130000
CKSTRING EQU   *                                                        91160000
         L     RPARM1,D0(,RPARM1)       GET STRING FOR STORE    YM01537 91170002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YM01537 91180002
         ST    RPARM1,TSBERSDS          STORE STRING            YM01537 91182002
         LA    RPARM1,TSBERSDS          RESET PARM POINTER              91220000
********                                                                91730000
******** LOCATE NECESSARY CONTROL BLOCKS                                91760000
********                                                                91790000
MAIN     EQU   *                                                        92450000
         LA    RWORK3,TSBERSDS+D3       POINT TO LAST CHAR. IN STRING   92480000
         LA    RWORK2,L1                SET INDEX INCREMENT             92510000
COMPARE  EQU   *                                                        92540000
         CLI   D0(RPARM1),BLANK         IS CHAR. A BLANK                92570000
         BE    RETURN                   YES,GO RETURN           YS02019 92600002
         CLI   D0(RPARM1),CR            IS IT A CARRIAGE RET. CHAR.     92630000
         BE    INVALID                  YES,INVALID CHARACTER           92660000
         CLI   D0(RPARM1),NL            IS IT A NEW LINE CHAR.          92690000
         BE    INVALID                  YES,INVALID CHARACTER           92720000
         CLI   D0(RPARM1),LF            IS IT A LINE FEED CHAR.         92750000
         BE    INVALID                  YES,INVALID CHARACTER           92780000
         BXLE  RPARM1,RWORK2,COMPARE    GO CHECK NEXT CHAR. IN STRING   92810000
********                                                                92870002
******** SET RETURN CODE AND EXIT                                       92930002
********                                                                92990002
RETURN   EQU   *                                                        93080000
         MODESET    EXTKEY=SUPR         CHANGE TO KEY 0         YS02019 93090002
         SR    RCODE,RCODE              SET GOOD RETURN CODE            93110000
         BR    RLINK                    RETURN TO CALLER        YS02019 93140002
INVALID  EQU   *                                                        93170000
         MODESET    EXTKEY=SUPR         CHANGE TO KEY 0         YS02019 93180002
         LA    RCODE,RETCODE4           SET RETURN CODE 4               93200000
         BR    RLINK                    RETURN TO CALLER        YS02019 93230002
BADTERM  EQU   *                                                        93260000
         LA    RCODE,RETCODE8           SET RETURN CODE 8               93290000
         BR    RLINK                    RETURN TO CALLER        YS02019 93320002
         DC    9F'0'                    MAINTENANCE PATCH AREA  YS02019 94760002
         SPACE 3                                                        94810002
CONSTANT DSECT                          DEFINES CONSTANTS IN 1ST CSECT  95150000
ZERO     DC    F'0'                     CONSTANT OF 0                   95180000
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          95210000
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  95240000
TWO      DC    XL1'02'                  CONSTANT OF 2                   95270000
TEN      DC    H'10'                    CONSTANT OF 10                  95300000
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  95330000
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS            95360000
SIX      DC    H'6'                     CONSTANT OF 6                   95390000
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   95420000
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    95450000
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         95480000
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  95510000
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               95540000
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    95570000
ONE      DC    AL1(1)                   CONSTANT OF ONE                 95600000
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER     YA00364 95610002
FOX      EQU   ENABLE                   CONSTANT OF 'FF'                95630000
DISABLE  EQU   ZERO                     TO DISABLE INTERRUPTS           95660000
         EJECT                                                          95690002
         IKJTSB                                                         95840000
         END                                                            97130000
./  ADD  SSI=80870683,NAME=IGG0940H
         TITLE 'IGG0940H - SECOND LOAD OF SVC 94 FOR TCAM/TSO'          00050000
IGG0940H CSECT                                                          00100000
*********************************************************************** 00150000
*                                                                     * 00200000
* MODULE NAME - IGG0940H - SVC 94, SECOND LOAD; ROUTER FOR TCAM/TSO   * 00250000
*                                                                     * 00300000
* STATUS - VERSION 000                                                * 00350000
*                                                                     * 00400000
* FUNCTION - THIS MODULE IS THE TCAM-SPECIFIC CODE FOR SVC 94. ITS    * 00450000
*    FUNCTION IS TO ROUTE CONTROL TO THE PROPER SUPPORT MODULE FOR    * 00500000
*    THE MACRO ISSUED.                                                * 00550000
*                                                                     * 00600000
* ENTRY POINTS -                                                      * 00650000
*         IGG0940H - CONTROL IS RECEIVED FROM IGC0009D IF TCAM/TSO    * 00700000
*                  IS ACTIVE.                                         * 00750000
*         POSTTSB - ROUTINE TO POST THE TSB TO IEDAYP                 * 00800000
*                  LOCAL AND CMS LOCKS MUST BE HELD, MUST BE IN       * 00850000
*                  TCAM'S KEY .                                       * 00900000
*                  R1 = ADDR OF MASK TO BE USED                       * 00950000
*                  R3 = ADDR OF CVT                                   * 01000000
*                  R14 = RETURN ADDR OF CALLER                        * 01050000
*                  R15 = ENTRY ADDRESS                                * 01100000
*                  R6 TO R9 ARE WORK REGISTERS                        * 01150000
*                                                                     * 01200000
* INPUT -  (WHEN ENTERED AT IGG0940H ENTRY POINT)                     * 01250000
*    REG 0 - ENTRY CODE IN HIGH ORDER BYTE, PARAMETERS IN REMAINDER   * 01300000
*    REG 1 - PARAMETERS                                               * 01350000
*    REG 3 - CVT                                                      * 01400000
*    REG 4 - TCB                                                      * 01450000
*    REG 5 - SVRB (UNUSED)                                            * 01500000
*    REG 12 - ENTRY POINT ADDRESS                                     * 01550000
*                                                                     * 01600000
* OUTPUT - RETURN CODE IN REGISTER 15                                 * 01650000
*                                                                     * 01700000
* EXTERNAL REFERENCES -                                               * 01750000
*         QTIP (IKJGGQT1) WITH ENTRY CODE 21 (CLEAR INPUT QUEUE) OR   * 01800000
*         ENTRY CODE 22 (CLEAR OUTPUT QUEUE)                          * 01850000
*                                                                     * 01900000
* EXITS - NORMAL                                                      * 01950000
*         BRANCH TO NEXT CSECT, LOCAL AND CMS LOCKS ARE HELD.         * 02000000
*    REG 0 - ENTRY CODE IN HIGH ORDER BYTE,PARAMETERS IN REMAINDER    * 02050000
*    REG 1 - PARAMETERS                                               * 02100000
*    REG 3 - CVT                                                      * 02150000
*    REG 4 - TCB                                                      * 02200000
*    REG 5 - TSB                                                      * 02250000
*    REG 10 - ADDR OF ARRAY OF CONSTANTS (FOR USE BY OTHER ROUTINES)  * 02300000
*    REG 14 - RETURN ADDRESS                                          * 02350000
*                                                                     * 02400000
* EXITS - ERROR                                                       * 02450000
*         BR 14 WITH RETURN CODE IN REGISTER 15                       * 02500000
*                                                                     * 02550000
* TABLES AND WORK AREAS - SEE DSECTS AT END OF MODULE                 * 02600000
*                                                                     * 02650000
* ATTRIBUTES - REENTRANT                                              * 02700000
*                                                                     * 02750000
* CHARACTER CODE DEPENDENCY - NONE                                    * 02800000
*                                                                     * 02850000
* NOTES - THIS MODULE CONTAINS THE TCAM-SPECIFIC CODE REMOVED IN THE  * 02900000
*         SPLIT OF IGC0009D                                           * 02950000
*                                                                     * 03000000
* CHANGE ACTIVITY -                                                   * 03050000
* A000000-999999                                               @ZZZZZZZ 03100000
*                                                                     * 03150000
*********************************************************************** 03200000
         SPACE 3                                                        03250000
********                                                                03300000
******** REGISTER EQUATES                                               03350000
********                                                                03400000
RPARM0   EQU   0                        PARAMETER REG 0                 03450000
RWORK0   EQU   0                        WORK REGISTER                   03500000
RPARM1   EQU   1                        PARAMETER REG 1                 03550000
RWORK1   EQU   1                        WORK REGISTER                   03600000
RWORK2   EQU   2                        WORK REGISTER                   03650000
RPARM2   EQU   2                        PARAMETER REG 2 FOR OUTPUT      03700000
RCVT     EQU   3                        POINTS TO CVT                   03750000
RTCB     EQU   4                        POINTS TO TCB                   03800000
RTSB     EQU   5                        POINTS TO TSB                   03850000
RWORK6   EQU   6                        WORK REGISTER                   03900000
RTCX     EQU   6                        BASE FOR TCX                    03950000
RTSI     EQU   7                        BASE FOR TSI                    04000000
RWORK7   EQU   7                        WORK REGISTER                   04050000
RWORK8   EQU   8                        WORK REGISTER                   04100000
RWORK9   EQU   9                        WORK REGISTER                   04150000
RWORK10  EQU   10                       WORK REGISTER                   04200000
RCONST   EQU   10                       POINTS TO PROGRAM CONSTANTS     04250000
RWORK11  EQU   11                       WORK REGISTER                   04300000
RBASE    EQU   12                       BASE REGISTER                   04350000
R13      EQU   13                       REGISTER 13                     04400000
R14      EQU   14                       REGISTER 14                     04450000
RLINK    EQU   14                       LINK REGISTER                   04500000
R15      EQU   15                       REGISTER 15                     04550000
RBRANCH  EQU   15                       BRANCH REGISTER                 04600000
RCODE    EQU   15                       RETURN CODE REGISTER            04650000
         SPACE 2                                                        04700000
********                                                                04750000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           04800000
********                                                                04850000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         04900000
D2       EQU   2                        DISPLACEMENT OF 2               04950000
L2       EQU   2                        LENGTH OF 2                     05000000
L24      EQU   24                       LENGTH OF 24                    05050000
RETCODE4 EQU   4                        RETURN CODE OF 4                05100000
RETCODE8 EQU   8                        RETURN CODE OF 8                05150000
CZERO    EQU   0                        TO TEST FOR ZERO                05200000
CFOUR    EQU   4                        CONSTANT OF 4                   05250000
CEIGHT   EQU   8                        CONSTANT OF 8                   05300000
TWELVE   EQU   12                       CONSTANT OF 12                  05350000
OFF      EQU   X'FF'                    TO TURN BITS OFF                05400000
QINEC    EQU   21                       QTIP ENTRY CODE/TCLEARQ/INPUT   05450000
QOUTEC   EQU   22                       QTIP ENTRY CODE/TCLEARQ/OUTPUT  05500000
         SPACE 3                                                        05550000
********                                                                05600000
******** DEFINE ALTERNATE ENTRY POINTS                                  05650000
********                                                                05700000
         ENTRY CONST                                                    05750000
         ENTRY POSTTSB                                                  05800000
         SPACE 3                                                        05850000
********                                                                05900000
******** ESTABLISH BASE REGISTERS AND ADDRESSABILITY                    05950000
********                                                                06000000
         BALR  RBASE,RWORK0             ADDRESSABILITY                  06050000
         USING *,RBASE                  FOR THIS CSECT                  06100000
         USING CVT,RCVT                 CVT ADDRESSABILITY              06150000
         USING TCB,RTCB                 TCB ADDRESSABILITY              06200000
IGG0940H IEDHJN AFTERHJN,HJN                                            06250000
         LA    RCONST,CONST             BASE FOR CONSTANTS              06300000
*                                       (PASSED FOR OTHER MODULES)      06350000
*******                                                                 06400000
*******  CHECK ENTRY CODES                                              06450000
*******                                                                 06500000
         CLM   RPARM0,BYTE1,T20         HIGHEST ENTRY CODE              06550000
         BH    INVALID                  CODE IS INVALID                 06600000
         SPACE 2                                                        06650000
TCABTSE  EQU   *                        CHECK FOR TCABEND OR            06700000
*                                       TSEND                           06750000
         CLM   RPARM0,BYTE1,XZERO       IS ENTRY CODE 0                 06800000
         BE    BRANCH1                  YES, BRANCH TO MODULE           06850000
         CLM   RPARM0,BYTE1,T2          IS ENTRY CODE 2                 06900000
         BE    BRANCH1                  YES BRANCH TO MODULE            06950000
         SPACE                                                          07000000
*********************************************************************** 07050000
*        GET POINTER TO TSB                                           * 07100000
*********************************************************************** 07150000
BRANCH   EQU   *                                                        07200000
         L     RWORK6,PSAAOLD-PSA       ADDRESS OF ASCB                 07250000
         USING ASCB,RWORK6              ASCB ADDRESSABILITY             07300000
         L     RTSB,ASCBTSB             ADDRESS OF TSB                  07350000
         DROP  RWORK6                                                   07400000
         USING TSB,RTSB                 TSB IS ADDRESSABLE              07450000
********                                                                07500000
******** BRANCH TO PROPER MODULE                                        07550000
********                                                                07600000
         LR    RWORK2,RPARM0            GET ENTRY CODE                  07650000
         SRL   RWORK2,L24               SHIFT TO LOW ORDER AND          07700000
         SLL   RWORK2,L2                MPY BY 4 (TABLE ENTRY           07750000
*                                       LENGTH)                         07800000
BRNEXT   L     RWORK2,BRTBL(RWORK2)     GET BRANCH ADDRESS              07850000
BRNCH    LR    RBASE,RWORK2             SET UP NEW BASE REG             07900000
         BR    RBASE                    GO TO PROPER ROUTINE            07950000
         SPACE                                                          08000000
*********************************************************************** 08050000
*        FOR TSO/TCAM ENTRY CODES 0 AND 2, REG 5 (RRB) MUST           * 08100000
*        CONTAIN THE RB ADDRESS. THOSE CODES ARE HANDLED HERE         * 08150000
*        TO AVOID THE RESETTING OF REG 5 TO THE TSB ADDRESS           * 08200000
*        NEEDED BY THE OTHER TSO/TCAM ENTRY CODES.                    * 08250000
*********************************************************************** 08300000
BRANCH1  EQU   *                                                        08350000
         LR    RWORK2,RPARM0            GET ENTRY CODE                  08400000
         SRL   RWORK2,L24               SHIFT TO LOW ORDER AND          08450000
         SLL   RWORK2,L2                MPY BY 4 (TABLE ENTRY LENGTH)   08500000
         L     RBASE,BRTBL(RWORK2)      GET BRANCH ADDRESS              08550000
         BR    RBASE                    GO TO PROPER ROUTINE            08600000
         SPACE 2                                                        08650000
INVALID  EQU   *                                                        08700000
         LA    RCODE,RETCODE4           INDICATE INVALID ENTRY CODE     08750000
         BR    R14                      RETURN TO CALLER                08800000
         SPACE                                                          08850000
INVALID8 EQU   *                                                        08900000
         LA    RCODE,RETCODE8           SET RETURN CODE 8 FOR           08950000
         BR    R14                                RETURN                09000000
         EJECT                                                          09050000
*********************************************************************** 09100000
*        POSTTSB ROUTINE - USED TO POST THE TSB TO IEDAYP WHO UPDATES * 09150000
*                          AND/OR DOES TPOSTING OF THE QCB AND/OR TSI * 09200000
*                          THE QCB IS IN TCAMS PRIVATE MEMORY AND NOT * 09250000
*                          DIRECTLY ADDRESSABLE                       * 09300000
*             INPUT = REGISTER 1  = ADDRESSS OF MASK                  * 09350000
*                     REGISTER 3  = ADDRESS OF CVT                    * 09400000
*                     REGISTER 5  = ADDRESS OF TSB TO BE POSTED       * 09450000
*                     REGISTER 6-9 = WORK REGISTERS                   * 09500000
*********************************************************************** 09550000
POSTTSB  EQU   *                                                        09600000
         USING *,RBRANCH                ADDRESSABILITY                  09650000
         USING TSB,RTSB                 TSB ADDRESSABILITY              09700000
         USING CVT,RCVT                 CVT ADDRESSABILITY              09750000
         LM    RWORK6,RWORK7,TSBTPOST   GET CONTENTS OF TSBTPOST        09800000
*                                       FIELD FOR COMPARE               09850000
RETRY    EQU   *                                                        09900000
         LR    RWORK8,RWORK6            COPY 1ST WORD IN REG8           09950000
         LR    RWORK9,RWORK7            COPY 2ND WORD IN REG9           10000000
         O     RWORK8,CZERO(,RWORK1)    OR WITH MASK                    10050000
         N     RWORK8,CFOUR(,RWORK1)    AND IN VALUE                    10100000
         O     RWORK9,CEIGHT(,RWORK1)   OR WITH MASK WORD 2             10150000
         N     RWORK9,TWELVE(,RWORK1)   AND WITH VALUE WORD 2           10200000
         CDS   RWORK6,RWORK8,TSBTPOST   COMPARE & SWAP TSBTPOST         10250000
         BNE   RETRY                    FIELDS NOT EQUAL,RETRY          10300000
         LTR   RWORK6,RWORK6            IS POST PENDING?                10350000
         BM    GOBACK                   YES,SKIP POSTING                10400000
         L     RTCX,CVTAQAVT            GET ADDR OF TCX                 10450000
         USING IEDQTCX,RTCX             TCX ADDRESSABILITY              10500000
         L     RTSI,TCXTSI              GET ADDR OF TSI                 10550000
         USING IEDQTSI,RTSI             TSI ADDRESSABILITY              10600000
         LA    RWORK8,TSITSAP-(QCBSTVTO-IEDQQCB) DUMMY QCB              10650000
*                                        STARTING ADDR                  10700000
         ST    RWORK8,TSBRQCB           STORE IN QCB CHAIN              10750000
         LA    RWORK9,TSBRCB            ADDRESS OF RCB                  10800000
         L     RWORK8,TCXREADY          GET ADDR OF READY QUEUE         10850000
AGAIN    EQU   *                                                        10900000
         ST    RWORK8,TSBLINKA          STORE LINK ADDRESS              10950000
         MVI   TSBPRI,PRIDESTQ          STOR PRIORITY FIELD             11000000
         CS    RWORK8,RWORK9,TCXREADY   SWAP READY QUEUE ADDR           11050000
         BNE   AGAIN                    NOT EQUAL TRY AGAIN             11100000
         EJECT                                                          11150000
*********************************************************************** 11200000
*        XMPOST ROUTINE - USED TO WAKE UP TCAM DISPATCHER TO POST     * 11250000
*                         QCB. XMPOST IS DONE IN KEY ZERO WITH THE    * 11300000
*                         LOCAL AND CMS LOCKS HELD.                   * 11350000
*        REG 10 = ZERO                                                * 11400000
*        REG 11 = ADDR OF TCAM DISPATCHER'S ECB, HIGH ORDER BIT IS 1  * 11450000
*                 TO INDICATED XMPOST                                 * 11500000
*        REG 12 = ADDR OF CVTBRET FOR ERRET(ERROR RETURN)             * 11550000
*        REG 13 = ADDR OF TCAMS ASCB                                  * 11600000
*        REG 14 = RETURN ADDR                                         * 11650000
*        REG 15 = ADDR OF IEAOPT01 - XMPOST ENTRY POINT ROUTINE       * 11700000
*        REG 14 SAVED IN REG 1,REG11 SAVED IN REG 8,REG 10 SAVED IN   * 11750000
*        REG 6,REG 12 SAVED IN REG 7 AND REG 13 SAVED IN REG 9        * 11800000
*********************************************************************** 11850000
         MODESET EXTKEY=SUPR            NEED SUPERVISOR KEY FOR XMPOST  11900000
         LR    RWORK1,R14               SAVE RETURN ADDR                11950000
         LR    RWORK7,RBASE             SAVE REG 12                     12000000
         LA    RBASE,CVTBRET            E.P. IF POST FAILS              12050000
         LR    RWORK8,RWORK11           SAVE REG 11                     12100000
         LR    RWORK9,R13               SAVE REG 13                     12150000
         L     R13,TCXASCB              @ OF TCAM'S ASCB                12200000
         L     RWORK11,TCXAVT           ADDR OF AVT                     12250000
         DROP  RTCX                                                     12300000
         USING IEDQAVTD,RWORK11         ADDRESSABILITY TO AVT           12350000
         LA    RWORK11,AVTOSECB         @ OF TCAM'S ECB TO POST         12400000
         ICM   RWORK11,BYTE1,HIHBIT     HIGH ORDER BIT INDICATES        12450000
*                                       IT IS AN XMPOST                 12500000
         DROP  RWORK11                                                  12550000
         LR    RWORK6,RWORK10           SAVE REG 10                     12600000
         SR    RWORK10,RWORK10          ZERO RWORK10 FOR XMPOST         12650000
         DROP  RBRANCH                                                  12700000
         L     RBRANCH,CVT0PT01         @ OF E.P. FOR XMPOST            12750000
         BALR  R14,RBRANCH              BR TO XMPOST (IEAOPT01)         12800000
         LR    R14,RWORK1               .RESTORE                        12850000
         LR    RWORK10,RWORK6           .ALL                            12900000
         LR    RBASE,RWORK7             .REGISTERS                      12950000
         LR    RWORK11,RWORK8           .PREVIOUSLY                     13000000
         LR    R13,RWORK9               .SAVED                          13050000
         MODESET EXTKEY=TCAM            RESTORE TCAM'S KEY              13100000
GOBACK   EQU   *                                                        13150000
         BR    R14                      RETURN TO CALLER                13200000
         EJECT                                                          13250000
PAT      DC    13F'0'                   MAINTENANCE PATCH AREA          13300000
         SPACE                                                          13350000
         DS    0F                                                       13400000
CONST    EQU   *                                                        13450000
XZERO    DC    F'0'                     CONSTANT OF 0                   13500000
XNINES   DC    F'99999999'              CONSTANT OF 99,999,999          13550000
XFIFTEEN DC    AL1(15)                  CONSTANT OF 15                  13600000
XTWO     DC    XL1'02'                  CONSTANT OF 2                   13650000
XTEN     DC    H'10'                    CONSTANT OF 10                  13700000
XSIXTEEN DC    AL1(16)                  CONSTANT OF 16                  13750000
XENABLE  DC    X'FF'                    TO ENABLE INTERRUPTS            13800000
XSIX     DC    H'6'                     CONSTANT OF 6                   13850000
XEIGHT   DC    AL1(8)                   CONSTANT OF 8                   13900000
XCP5041  DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    13950000
XHIGHBIT DC    XL1'80'                  TO TEST HIGH ORDER BITS         14000000
XCPTWX   DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  14050000
         DS    0F                                                       14100000
XTPUT1   DC    XL4'0E000000'            TPUT,HOLD,CONTROL               14150000
XTPUT2   DC    XL4'0A000000'            TPUT,CONTROL                    14200000
XONE     DC    AL1(1)                   CONSTANT OF 1                   14250000
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER             14300000
TPADDR   DC    A(POSTTSB)               TSB POSTING ROUTINE             14350000
TPMASK   DC    AL1(TSBPOSTO+TSBTPQCB,0,0,0) .MASK TO                    14400000
         DC    F'-1'                    .CAUSE IEDAYP                   14450000
         DC    AL1(0,0,QCBTPUT,QCBTPUT) .TO TPOST THE QCB               14500000
         DC    F'-1'                    .TO ITSELF                      14550000
T2       DC    AL1(2)                   CONSTANT OF 2 FOR CLM           14600000
T3       DC    AL1(3)                   CONSTANT OF 3 FOR CLM           14650000
T11      DC    AL1(11)                  CONSTANT OF 11 FOR CLM          14700000
T15      DC    AL1(15)                  CONSTANT OF 15 FOR CLM          14750000
T16      DC    AL1(16)                  CONSTANT OF 16 FOR CLM          14800000
T17      DC    AL1(17)                  CONSTANT OF 17 FOR CLM          14850000
T20      DC    AL1(20)                  CONSTANT OF 20 FOR CLM          14900000
HIHBIT   DC    XL1'80'                  HIGH ORDER BIT SETTING          14950000
         EJECT                                                          15000000
********                                                                15050000
******** BRANCH TABLE FOR FUNCTION SUPPORT ROUTINES                     15100000
********                                                                15150000
         USING IGG0940H+D2,RBASE                                        15200000
         DS    0F                       FULLWORD ALIGNMENT              15250000
BRTBL    EQU   *                                                        15300000
TCABEND  DC    V(IGG09400)              ENTRY CODE 0                    15350000
TCLEARQ  DC    A(IGG09401)              ENTRY CODE 1                    15400000
TSEND    DC    V(IGG09402)              ENTRY CODE 2                    15450000
MSGS     DC    V(IGG09403)              ENTRY CODE 3                    15500000
STBREAK  DC    V(IGG09404)              ENTRY CODE 4                    15550000
STCOM    DC    V(IGG09405)              ENTRY CODE 5                    15600000
STTIMEOU DC    V(IGG09406)              ENTRY CODE 6                    15650000
STCC     DC    V(IGG09407)              ENTRY CODE 7                    15700000
STATTN   DC    V(IGG09408)              ENTRY CODE 8                    15750000
STAUTOLN DC    V(IGG09409)              ENTRY CODE 9                    15800000
STSIZE   DC    V(IGG0940A)              ENTRY CODE 10                   15850000
GTSIZE   DC    V(IGG0940B)              ENTRY CODE 11                   15900000
STAUTOCP DC    V(IGG0940C)              ENTRY CODE 12                   15950000
STAUTOPT DC    V(IGG0940D)              ENTRY CODE 13                   16000000
RTAUTOPT DC    V(IGG0940E)              ENTRY CODE 14                   16050000
ENTRY15  DC    A(INVALID)               ENTRY CODE 15,INVALID           16100000
STCLEAR  DC    V(IGG0940G)              ENTRY CODE 16                   16150000
TSTGTTRM DC    V(IGG09411)              ENTRY CODE 17                   16200000
TSTFSMOD DC    A(INVALID8)              ENTRY CODE 18,INVALID           16250000
TSTLINEN DC    A(INVALID8)              ENTRY CODE 19,INVALID           16300000
TSTTMPMD DC    V(IGG09414)              ENTRY CODE 20                   16350000
         EJECT                                                          16400000
*********************************************************************** 16450000
* TCLEARQ - THE FUNCTION OF THIS SECTION IS TO PERFORM THE TCLEARQ    * 16500000
*           FUNCTION.  DEPENDING UPON THE PARAMETER PASSED, EITHER    * 16550000
*           INPUT OR OUTPUT BUFFER QUEUES ARE CLEARED.  FREED BUFFERS * 16600000
*           ARE REMOVED FROM THE TSB QUEUES AND RETURNED TO THE TIOC  * 16650000
*           FREE QUEUES .                                             * 16700000
*********************************************************************** 16750000
IGG09401 CSECT                                                          16800000
         USING CVT,RCVT                 CVT ADDRESSABILITY              16850000
         USING TCB,RTCB                 TCB ADDRESSABILITY              16900000
         USING TSB,RTSB                 TSB ADDRESSABILITY              16950000
         USING *,RBASE                  BASE ADDRESSABILITY             17000000
********                                                                17050000
******** MAIN LINE TCLEARQ                                              17100000
********                                                                17150000
         LR    RWORK2,RPARM1            SAVE PARM                       17200000
         LTR   RPARM1,RPARM1            TEST ENTRY CODE                 17250000
         BP    PARMBAD                  ONLY NEGATIVE OR ZERO VALID     17300000
         BZ    FREE                     GO PROCESS OUTPUT QUES          17350000
         SPACE 1                                                        17400000
*********************************************************************** 17450000
*        DISALLOW TERMINAL INPUT UNTIL NEXT TGET IN ORDER             * 17500000
*        TO SYNCHRONIZE WITH THE USER.                                * 17550000
*********************************************************************** 17600000
         SPACE 1                                                        17650000
INPUT    EQU   *                                                        17700000
         MODESET EXTKEY=TCAM            GET TCAMS KEY FOR TSB           17750000
*                                       UPDATE                          17800000
         NI    TSBFLG2,OFF-TSBBRKIN     DISALLOW BREAKIN IN PROGRESS    17850000
         OI    TSBSTAT,TSBLWAIT         LOCK KEYBOARD                   17900000
         OI    TSBFLG1,TSBIFLSH         TELL TSINPUT TO FLUSH INPUT     17950000
         OI    TSBFLG3,TSBSPIT          STOP AUTOPROMPTING              18000000
         LR    RWORK10,RLINK            SAVE RETURN REGISTER            18050000
         L     RWORK1,M1                PASS ADDR OF MASK FLD           18100000
         L     RBRANCH,POST             ADDR OF POSTTSB ROUTINE         18150000
         BALR  RLINK,RBRANCH            GO POST TSB                     18200000
         LR    RLINK,RWORK10            RESTORE RETURN REG              18250000
         EJECT                                                          18300000
*********************************************************************** 18350000
*        FREE CMS AND LOCAL LOCKS                                     * 18400000
*********************************************************************** 18450000
         SPACE 1                                                        18500000
FREE     EQU   *                                                        18550000
         LR    RWORK7,RLINK             SAVE RETURN ADDR                18600000
         LR    RWORK10,RBASE            SAVE BASE                       18650000
         MODESET EXTKEY=SUPR            RETURN TO SUPR KEY              18700000
         SETLOCK RELEASE,TYPE=CMS,      FREE CMS LOCK                  X18750000
               RELATED=(TSB,IGC0009D(GETLKS))                           18800000
         SETLOCK RELEASE,TYPE=LOCAL,    FREE LOCAL LOCK                X18850000
               RELATED=(TSB,IGC0009D(GETLKS))                           18900000
         LR    RBASE,RWORK10            RESTORE BASE                    18950000
         LR    RLINK,RWORK7             RESTORE RETURN ADDR             19000000
         SPACE 1                                                        19050000
*********                                                               19100000
********* ISSUE QTIP SVC TO INVOKE MODULE IEDAYAA FOR QUEUE CLEARING    19150000
*********                                                               19200000
         SPACE 1                                                        19250000
         LR    R15,RTSB                 PUT TSB ADDR IN REG 15          19300000
         LTR   RWORK2,RWORK2            TEST ENTRY CODE                 19350000
         BM    QTIPINPT                 ISSUE QTIP FOR INPUT            19400000
         SPACE                                                          19450000
         QTIP  QOUTEC                   QTIP FOR OUTPUT                 19500000
         B     LEAVE                    RETURN TO CALLER                19550000
         SPACE                                                          19600000
QTIPINPT EQU   *                                                        19650000
         QTIP QINEC                     QTIP FOR INPUT                  19700000
LEAVE    EQU   *                                                        19750000
         SR    RCODE,RCODE              SET RETURN CODE ZERO            19800000
         BR    R14                      RETURN TO CALLER                19850000
         SPACE                                                          19900000
PARMBAD  EQU   *                                                        19950000
         LA    RCODE,RETCODE4           INDICATE INVALID ENTRY CODE     20000000
         BR    R14                      RETURN TO CALLER                20050000
         EJECT                                                          20100000
ZAP      DS    9F'0'                    MAINTENANCE PATCH AREA          20150000
         SPACE                                                          20200000
POST     DC    A(POSTTSB)               POSTTSB ADDR                    20250000
MASKD1   DC    AL1(TSBPOSTO+TSBTPQCB,0,0,0) .ALLOW                      20300000
         DC    AL1(255,255,255,255)     .NO                             20350000
         DC    AL1(0,0,QCBNOBUF+QCBTPUT,QCBTPUT)    .TERMINAL           20400000
         DC    AL1(255,255,255,255-QCBNOBUF) .INPUT                     20450000
         SPACE                                                          20500000
M1       DC    A(MASKD1)                ADDR OF MASKD1                  20550000
         SPACE 4                                                        20600000
CONSTANT DSECT                                                          20650000
ZERO     DC    F'0'                     CONSTANT OF 0                   20700000
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          20750000
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  20800000
TWO      DC    XL1'02'                  CONSTANT OF 2                   20850000
TEN      DC    H'10'                    CONSTANT OF 10                  20900000
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  20950000
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS            21000000
SIX      DC    H'6'                     CONSTANT OF 6                   21050000
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   21100000
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    21150000
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         21200000
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  21250000
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               21300000
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    21350000
ONE      DC    AL1(1)                   CONSTANT OF ONE                 21400000
IDLE     DC    X'17'                    TPUT IDLE CHARACTER             21450000
         EJECT                                                          21500000
         IHAASCB                                                        21550000
         EJECT                                                          21600000
         TAVTD                                                          21650000
         EJECT                                                          21700000
CVT      DSECT                                                          21750000
         CVT                                                            21800000
         EJECT                                                          21850000
         TPRIOR                                                         21900000
         EJECT                                                          21950000
         IHAPSA                                                         22000000
         EJECT                                                          22050000
         TQCBD                                                          22100000
         EJECT                                                          22150000
         IKJTCB                                                         22200000
         EJECT                                                          22250000
         TTCXD                                                          22300000
         EJECT                                                          22350000
         IKJTSB                                                         22400000
         EJECT                                                          22450000
         TTSID                                                          22500000
         END                                                            22550000
./  ADD  SSI=81350039,NAME=IGG09400
         TITLE 'IGG09400 - TCABEND'                                     00062003
IGG09400 CSECT                                                          00062402
*********************************************************************** 00066002
*                                                                       00068002
*01* MODULE-NAME = IGG09400                                             00068402
*                                                                       00068802
*01* DESCRIPTIVE-NAME = TCABEND                                         00069202
*                                                                       00069602
*01* COPYRIGHT = NONE                                                   00069702
*                                                                       00069802
*01* STATUS                                                             00069903
*            -03/04/76                                         @ZA09622 00071903
*                                                                       00079902
*01* FUNCTION = NOTIFY THE SYSTEM THAT TCAM HAS ABNORMALLY TERMINATED   00089902
*               AND PREPARE TO STOP TIME SHARING.                       00093202
*                                                                       00095202
*01* NOTES = THIS MODULE IS A COMPLETE REWRITE OF VS2/1        YS02019  00095602
*                                                                       00096002
*01* RESTRICTIONS = N/A                                                 00096402
*                                                                       00096502
*02*   DEPENDENCIES = NONE                                              00096602
*                                                                       00109902
*02*   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                      00119902
*                                                                       00121902
*02*   PATCH-LABEL = ZAPAREA                                            00122302
*                                                                       00122702
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             00123102
*                                                                       00123202
*02*   PROCESSOR = ASSEMXF-370R                                         00123302
*                                                                       00127702
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID-01       00129702
*                                                                       00131702
*02*   ATTRIBUTES = REENTRANT,REUSABLE,ENABLED,SUPERVISOR STATE         00132102
*                                                                       00132202
*01* ENTRY-POINT = IGG09400 (HODLING THE LOCAL LOCK AND THE CMS LOCK,   00136602
*                  IN SUPERVISOR'S KEY)                                 00137002
*                                                                       00138602
*02*   PURPOSE = SEE FUNCTION                                           00140602
*                                                                       00141002
*02*   LINKAGE = FROM IGC0009D VIA BRANCH                               00141102
*                                                                       00152802
*01* INPUT = REGISTER  0 CONTAINS ENTRY CODE IN HIGH ORDER BYTE         00162802
*            REGISTER  1 CONTAINS ZERO                                  00164802
*            REGISTER  3 CONTAINS CVT ADDRESS                           00168702
*            REGISTER  4 CONTAINS TCB ADDRESS                           00170702
*            REGISTER  5 CONTAINS SVRB ADDRESS                          00170802
*            REGISTER 14 CONTAINS RETURN ADDRESS                        00171102
*                                                                       00171502
*01* OUTPUT = REGISTER 15 CONTAINS RETURN CODE                          00171902
*                                                                       00172302
*01* EXIT-NORMAL = RETURN TO CALLER                                     00172402
*                                                                       00172502
*01* EXIT-ERROR = NONE                                                  00172602
*                                                                       00176502
*01* EXTERNAL-REFERENCES = IKJ409I (ENTRY IN IGG09403)                  00178502
*                                                                       00178902
*02*   CONTROL-BLOCKS = CVT,TCB,TSB,TIOCRPT,TCX,AVT,BASEA,ASCB,ASVT     00179302
*                                                                       00179702
*01* TABLES = NONE                                                      00180102
*                                                                       00180202
*01* MACROS = GETMAIN,FREEMAIN,SDUMP,SETLOCK,WTO,TSEND                  00180302
*                                                                       00180402
*01* CHANGE-ACTIVITY                                                    00180903
*           VS2-037 CHANGES                                             00181403
*                                                                       00181903
*                                                                       00182403
*                                                                       00182903
* A 129430     D 129410                                         ZA32570 00183103
* A 123000-1234600,129410                                       ZA25126 00183403
* D 115500,122600-122700                                        ZA25126 00184303
*           VS2-3.0 CHANGES                                             00184703
*D000640,014000-016000,017000,017500,018000,040092-079540       ZA01299 00185103
*D079560-084987,116500-119500,129100,129200,129424-129460       ZA01299 00185203
*D134000-134100                                                 ZA01299 00185303
*C024500,037960,040088,089900                                   ZA01299 00185503
*A040888-041588,121500,040608-040668,084992-085728              ZA01299 00185903
*A12290-122984                                                  ZA01299 00186003
*           VS2-3.0 SERVICE UPDATE                                      00186303
*0000024500,129350                                   UZ03908   @ZA09622 00186403
*0000040838-041388                                   UZ02380   @ZA06118 00186503
*                                                                       00186603
*                                                                       00186703
*********************************************************************** 00186803
         EJECT                                                          00187102
*****    REGISTER EQUATES                                               00187502
RPARM0   EQU   0                  PARM REG 0                            00188302
RWRK0    EQU   0                  WORK REG                              00192202
RPARM1   EQU   1                  PARM REG 1                            00196102
RWRK1    EQU   1                  WORK REG                              00200002
RWRK2    EQU   2                  WORK REG                              00250002
RWRK3    EQU   3                  WORK REG                              00300002
RCVT     EQU   3                  CVT ADDRESS                           00350002
RWRK4    EQU   4                  WORK REG                              00400002
RTCB     EQU   4                  TCB ADDRESS                           00450002
RTIOC    EQU   5                  TIOCRPT ADDRESS                       00500002
RWRK5    EQU   5                  WORK REG                              00550002
RBASE    EQU   6                  BASE REG                              00600002
RWRK7    EQU   7                  WORK REG                              00650002
RRB      EQU   7                  RB ADDRESS                            00700002
RWRK8    EQU   8                  WORK REG                              00750002
RWRK9    EQU   9                  WORK REG                              00800002
RWRK10   EQU   10                 WORK REG                              00850002
RWRK11   EQU   11                 WORK REG                              00900002
RWRK12   EQU   12                 WORK REG                              00950002
RWRK13   EQU   13                 WORK REG                              01000002
RSAVE    EQU   13                 SAVE AREA ADDRESS                     01050002
RLINK    EQU   14                 RETURN ADDRESS                        01100002
RBRANCH  EQU   15                 BRANCH ADDRESS                        01150002
RCODE    EQU   15                 RETURN CODE                           01200002
         SPACE 3                                                        01250002
******   VALUE EQUATES                                         ******   01300002
E0       EQU   0                  VALUE OF 0                            01310002
E1       EQU   1                  VALUE OF 1                            01350002
BYTE1    EQU   8                  BYTE 1 OF WORD                        01650002
USERKEY  EQU   X'80'              CALLERS KEY FOR RB TEST       YM01246 01760002
RCODE4   EQU   4                  RETURN CODE 4,INVALID CALL            01850002
         EJECT                                                          01900002
*********************************************************************** 01950002
*        SET UP ADDRESSABILITY AND MODULE ID                          * 02000002
*********************************************************************** 02050002
         BALR  RBASE,E0           .BASE REGISTER                        02100002
         USING *,RBASE            .ADDRESSABILITY                       02150002
         USING CVT,RCVT           CVT ADDRESSABILITY                    02200002
         LR    RWRK10,RLINK       SAVE RETURN ADDRESS                   02300002
         B     VALIDATE           BRANCH PAST MODULE ID                 02350002
         DC    CL8'IGG09400'      MODULE ID                             02400002
         DC    X'6064'            DATE-  03/04/76              @ZA09622 02450003
         SPACE 1                                                        02500002
*********************************************************************** 02510002
*        SAVE PARAMETER IN SVRB EXTENDED SAVE AREA                    * 02520002
*********************************************************************** 02530002
VALIDATE EQU   *                                                        02532002
         USING RBBASIC,RWRK5      RB ADDRESSABLE                        02542002
         ST    RPARM1,RBEXSAVE    SAVE PARMETER FOR LATER USE           02544002
         LR    RWRK2,RPARM1       SAVE  PARAMETER FOR IMMEDIATE USE     02544402
         L     RWRK7,RBLINK       CALLERS RB ADDRESS            YM01246 02555502
         DROP  RWRK5              RB ADDRESSABILITY ENDS                02566702
         SPACE 2                                                        02577802
*********************************************************************** 02588902
*        VERIFY CALLER                                                * 02600002
*********************************************************************** 02650002
         USING RBBASIC,RWRK7            RB ADDRESSABILITY       YM01246 02700002
         TM    RBOPSW+E1,USERKEY        IS CALL MADE BY SYSTEM  YM01246 02750002
         DROP  RWRK7                    RB ADDRESSABILITY ENDS  YM01246 02800002
         BO    INVALID                  NO,RETURN CODE 4 & EXIT YM01246 02850002
         SPACE 2                                                        03000002
*********************************************************************** 03500002
*        GET TIOCRPT AND AVT TO INDICATE TIME SHARING HAS ABNORMALLY  * 03550002
*           TERMINATED                                                * 03600002
*********************************************************************** 03650002
         L     RWRK7,CVTAQAVT     TCX ADDRESS                           03700002
         L     RTIOC,TCXRPT-IEDQTCX(,RWRK7) TIOCRPT ADDRESS             03750002
         LTR   RTIOC,RTIOC        TIME SHARING RUNNING                  03752002
         BZ    INVALID            NO,INVALID CALL                       03754002
         USING TIOCRPT,RTIOC      TIOCRPT ADDRESSABILITY                03760002
         TM    TIOCFLG,TIOCTSAB   TIME SHARING ABENDED                  03770002
         BO    INVALID            YES,INVALID CALL                      03780002
         OI    TIOCFLG,TIOCTSAB   INDICATE TIME SHARING ABEND           03790002
         L     RWRK1,TCXASCB-IEDQTCX(,RWRK7) TCAM'S ASCB ADDR   YM02864 03792002
         C     RWRK1,PSAAOLD-PSA  RUNNING IN TCAM'S MEMORY?     YM02864 03794002
         BNE   DUMP               NO, CANNOT REFERENCE AVT      ZA01299 03796003
         L     RWRK7,TCXAVT-IEDQTCX(,RWRK7) AVT ADDRESS                 03800002
         USING IEDQAVTD,RWRK7     AVT ADDRESSABILITY                    03850002
         OI    AVTBIT3,AVTTSAB    TIME SHARING HAS ABENDED              03900002
         DROP  RWRK7              RELEASE ADDRESSABILITY ON AVT         03950002
         SPACE 2                                                        04000002
*********************************************************************** 04002002
*        TEST IF TIOC CONTROL BLOCKS SHOULD BE DUMPED                 * 04004002
*********************************************************************** 04006002
         LTR   RWRK2,RWRK2        CHECK IF FSTOP                        04008402
         BNZ   SCAN               YES, BYPASS DUMP              ZA01299 04008803
         SPACE 2                                                        04058803
*********************************************************************** 04060803
*        FREE CMS AND LOCAL LOCKS                                     * 04062803
*********************************************************************** 04064803
DUMP     EQU   *                                                ZA01299 04064903
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TIOCRPT,IGC0009D)    ZA01299 04065203
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TIOCRPT,IGC0009D)  ZA01299 04066803
*********************************************************************** 04068803
*        ISSUE SDUMP TO DUMP ALL TSO AND TCAM INFORMATION             * 04070803
*********************************************************************** 04078803
         USING TCBRBP,RTCB                                     @ZA06118 04083803
         CLC   TCBCMPC,CANCELED         WAS TCAM CANCELED?     @ZA06118 04088803
         BNE   DUMPIT                   NO,TAKE THE DUMP       @ZA06118 04098803
         TM    TCBCMP,TCBCREQ           WAS A DUMP REQUESTED?  @ZA06118 04108803
         BZ    IKJMSG                   NO,JUST SEND MESSAGE   @ZA06118 04118803
         DROP  RTCB                                            @ZA06118 04138803
DUMPIT   LA    RWRK1,SDUMP              LOAD ADDR OF LIST FORM  ZA01299 04148803
         SDUMP MF=(E,(RWRK1))                                   ZA01299 04158803
         SPACE 2                                                        04258803
*********************************************************************** 07954402
*        INFORM OPERATOR TIME SHARING HAS ABNORMALLY TERMINATED       * 07954803
*********************************************************************** 07955202
IKJMSG   L     RWRK1,MSG          PARAMETER FOR MESSAGE        @ZA06118 07955603
         WTO   MF=(E,(1))         MESSAGE IKJ409I                       07955702
         SPACE 2                                                        08498802
*********************************************************************** 08499203
*        GET CMS AND LOCAL LOCKS                                      * 08499603
*********************************************************************** 08499703
GETLOCK1 EQU   *                                               ZA01299  08499803
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                ZA01299 X08499903
               RELATED=(TIOCRPT,IGG09400(DUMP))                ZA01299  08512303
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                  ZA01299 X08525003
               RELATED=(TIOCRPT,IGG09400(DUMP))                ZA01299  08535003
*********************************************************************** 08537003
*         WHEN LOCKS ARE FREED AND THEN RE-OBTAINED, THE TIOCRPT      * 08539003
*         ADDRESS MUST BE RE-VERIFIED TO INSURE TIME SHARING IS       * 08541003
*         STILL ACTIVE.                                               * 08543003
*********************************************************************** 08543603
         L     RTIOC,CVTAQAVT     TCX ADDRESS                  ZA01299  08545603
         LTR   RTIOC,RTIOC        IS TCAM STILL AROUND         ZA01299  08545703
         BZ    INVALID            NO, EXIT                     ZA01299  08559203
         L     RTIOC,TCXRPT-IEDQTCX(,RTIOC)  TIOCRPT ADDRESS   ZA01299  08569203
         LTR   RTIOC,RTIOC        TIME SHARING STILL ACTIVE    ZA01299  08571203
         BNZ   SCAN               YES, CANCEL TSBS             ZA01299  08571603
         SR    RCODE,RCODE        ZERO RETURN CODE             ZA01299  08572003
         LR    RLINK,RWRK10       RETURN ADDRESS               ZA01299  08572403
         BR    RLINK              RETURN TO CALLER             ZA01299  08572803
*********************************************************************** 08573003
*        SCAN ALL TSBS AND CANCEL THE ONES THAT DON'T HAVE THE TSBCANC* 08586503
*         BIT ON. USE SYSTEM INITIATED CANCEL.                        * 08600002
*********************************************************************** 08610002
*          INPUT REGISTERS TO SIC                                     * 08650002
*                     0 = POST CODE (622 ABEND)                       * 08700002
*                     1 = ASCB                                        * 08750002
*                    13 = SAVE AREA ADDRESS                           * 08800002
*                    14 = RETURN ADDRESS                              * 08850002
*                    15 = ENTRY POINT                                 * 08900002
*********************************************************************** 08950002
SCAN     EQU   *                                                        08960002
         LR    RWRK4,RWRK10       SAVE RETURN ADDRESS           YM05366 08962002
         LH    RWRK8,TIOCUSCT     GET NO. ACTIVE USERS                  08970002
         LTR   RWRK8,RWRK8        ANY USERS LOGGED ON                   08980002
         BZ    CLEAN              NO, GO CHECK TSEND            ZA01299 08990003
         SR    RWRK8,RWRK8        CLEAR REG                             09000002
         IC    RWRK8,TIOCTSBS     SIZE OF TSB                           09050002
         LH    RWRK9,TIOCNTSB     NUMBER OF TSBS                        09100002
         BCTR  RWRK9,E0           MINUS ONE                             09150002
         MR    RWRK8,RWRK8        OFFSET TO LAST TSB                    09200002
         L     RWRK7,TIOCTSB-E1   START OF TSBS                         09300002
         LA    RWRK7,E0(,RWRK7)   CLEAR HI-BYTE FOR BXLE                09310002
         AR    RWRK9,RWRK7        ADDRESS OF LAST TSB                   09312002
         SR    RWRK8,RWRK8        CLEAR REGISTER                        09350002
         IC    RWRK8,TIOCTSBS     SIZE OF TSB                           09400002
         L     RWRK0,POSTCODE     622 ABEND CODE                        09500002
         L     RWRK2,CVTPTR       ADDRESS OF CVT                        09600002
         L     RSAVE,CVTMSER-CVT(,RWRK2) ADDRESS OF BASEA               09700002
         L     RSAVE,BAASCB-BASE(,RSAVE) ASCB OF MASTER SCHEDULER       09750002
         USING TSB,RWRK7          TSB ADDRESSABILITY                    10000002
         LR    RWRK2,RSAVE        SAVE MSTR SCHED ASCB ADDR     YM02864 10010002
NEXTTSB  EQU   *                                                        10050002
         TM    TSBSTAT,TSBINUSE   TSB ACTIVE                            10150002
         BNO   CHECKTSB           NO,CHECK NEXT TSB                     10200002
         SR    RWRK1,RWRK1              CLEAR REGISTER          VS08528 10202002
         STH   RWRK1,TSBASRCE           ZERO TSBASRCE, SO AYP   VS08528 10204002
*                                       WON'T TOUCH THE QCB     VS08528 10206002
         TM    TSBFLG4,TSBCANC    USER CANCELLED                        10210002
         BO    POSTAY8            YES, DON'T SIC AGAIN          YM02864 10220002
         L     RWRK1,TSBASCBA     ASCB ADDRESS                          10300002
         L     RBRANCH,CVTPTR     CVT ADDRESS                           10400002
         USING CVT,RBRANCH        CVT ADDRESSABILITY                    10410002
         L     RBRANCH,CVTSIC     ENTRY POINT TO SIC                    10450002
         DROP  RBRANCH                                                  10460002
         LA    RSAVE,TIOCSAVE     SAVE AREA ADDRESS                     10500002
         BALR  RLINK,RBRANCH      BRANCH TO SIC                         10550002
         LR    RSAVE,RWRK2        RESTORE MSTR SCHED ASCB ADDR  YM02864 10560002
         SPACE 1                                                        10600002
*********************************************************************** 10650002
*        XMPOST THE TSBLECB SO THAT IEDAY8 CAN TERMINATE USER         * 10700002
*********************************************************************** 10710002
*                                                                     * 10750002
*        INPUT REGISTERS TO XMPOST -                                  * 10760002
*                                                                     * 10770002
*              10 = ZERO (NO ERROR CODE)                              * 10780002
*              11 = ECB ADDRESS (HIGH ORDER BIT ON FOR XM)            * 10790002
*              12 = ADDRESS OF CVTBRET                                * 10792002
*              13 = MASTER SCHEDULER'S ASCB ADDRESS                   * 10794002
*              14 = RETURN ADDRESS                                    * 10796002
*              15 = ENTRY ADDRESS                                     * 10798002
*********************************************************************** 10800002
POSTAY8  EQU   *                                                YM02864 10850002
         SR    RWRK10,RWRK10      CLEAR REG                             10950002
         L     RWRK1,CVTPTR       CVT ADDRESS                   YM02864 11050002
         LA    RWRK12,CVTBRET-CVT(,RWRK1) ERROR RETURN ADDR     YM02864 11100002
         LA    RWRK11,TSBLECB     ECB ADDRESS TO POST                   11200002
         ICM   RWRK11,BYTE1,XMPOST  INDICATE  CROSS MEMORY POST         11250002
         L     RBRANCH,CVT0PT01-CVT(,RWRK1) POST ENTRY POINT    YM02864 11300002
         BALR  RLINK,RBRANCH      GO TO POST                            11350002
         LR    RSAVE,RWRK2        RESTORE MSTR SCHED ASCB ADDR  YM02864 11400002
CHECKTSB EQU   *                                                        11450002
         BXLE  RWRK7,RWRK8,NEXTTSB PROCESS MORE TSBS                    11500002
         SPACE 2                                                        11600002
*********************************************************************** 12000002
*        CHECK IF TSEND SHOULD BE ISSUED                              * 12050002
*********************************************************************** 12100002
CLEAN    EQU   *                                                ZA01299 12150003
         L     RPARM1,PSATOLD-PSA GET CURRENT TCB ADDRESS               12200002
         L     RPARM1,TCBRBP-TCB(,RPARM1)  GET SVRB ADDRESS             12210002
         L     RPARM1,RBEXSAVE-RBBASIC(,RPARM1) GET CALLER'S PARM       12230002
         LTR   RPARM1,RPARM1      WAS CALL MADE BY FSTOP                12242002
         BNZ   RETURN             YES, DON'T ISSUE TSEND                12250002
         SPACE 2                                                        12280003
*********************************************************************** 12290003
*        FREE CMS AND LOCAL LOCKS BEFORE TSEND                        * 12292003
*********************************************************************** 12294003
         SETLOCK RELEASE,TYPE=CMS,                              ZA01299X12296003
               RELATED=(TIOC,IGG09400(GETLOCK1))                ZA01299 12296403
         SETLOCK RELEASE,TYPE=LOCAL,                            ZA01299X12298003
               RELATED=(TIOC,IGG09400(GETLOCK1))                ZA01299 12298403
         SPACE 2                                                        12298803
         L     RWRK7,CVTAQAVT     TCX ADDRESS                   ZA25126 12300003
         LTR   RWRK7,RWRK7        TCAM STILL RUNNING?           ZA25126 12303003
         BZ    INVALID            NO, INVALID NOW               ZA25126 12306003
         L     RTIOC,TCXRPT-IEDQTCX(,RWRK7) TIOCRPT ADDRESS     ZA25126 12309003
         LTR   RTIOC,RTIOC        TIME SHARING RUNNING?         ZA25126 12312003
         BZ    INVALID            NO,INVALID NOW                ZA25126 12315003
         USING TIOCRPT,RTIOC      TIOCRPT ADDRESSABILITY        ZA25126 12318003
         LH    RWRK8,TIOCUSCT     GET USER COUNT                ZA25126 12321003
         LTR   RWRK8,RWRK8        USER COUNT ZERO               ZA25126 12324003
         BZ    DOTSEND            YES, DONE DO TSEND            ZA25126 12327003
         STIMER WAIT,BINTVL=TIME  GIVE USERS TIME FOR CLEANUP   ZA25126 12330003
DOTSEND  EQU   *                                                ZA25126 12333003
         TSEND                    ,CLEAN UP TIOC CONTROL BLOCKS         12336003
RETURN   EQU   *                                                        12350002
         SR    RCODE,RCODE        RETURN CODE ZERO                      12400002
         LR    RLINK,RWRK4        RETURN ADDRESS                        12450002
         BR    RLINK              RETURN TO CALLER                      12500002
INVALID  EQU   *                                                        12550002
         LR    RLINK,RWRK10       RETURN ADDRESS                        12600002
         LA    RCODE,RCODE4       INVALID CALL                          12650002
         BR    RLINK              RETURN TO CALLER                      12700002
         EJECT                                                          12750002
*********************************************************************** 12800002
*        CONSTANTS AND MAPPING MACROS                                 * 12850002
*********************************************************************** 12900002
MSG      DC    V(IKJ409I)         TIME SHARING TERMINATED               12930002
CANCELED DC    XL3'222000'        TCAM CANCELED                @ZA09622 12935003
POSTCODE DS    0F                                                       12940002
         DC    XL4'00000622'      CANCEL ABEND CODE 622                 12942002
TIME     DC    F'3000'            WAIT VALUE                    ZA32570 12946003
         DS    0F                                                       12950002
XMPOST   DC    XL1'80'            CROSS MEMORY POST                     13000002
SDUMP    SDUMP HDR='TIOC AND TCAM CONTROL BLOCKS AND BUFFERS',  ZA01299X13050003
               SDATA=(RGN,TRT,CSA,NUC,LPA,SQA,ALLPSA),MF=L      ZA01299 13100003
ZAPAREA  DC    10F'0'             PATCH AREA                            13450002
         EJECT                                                          13500002
         IHAASCB                                                        13550002
         EJECT                                                          13600002
         IHAASVT                                                        13650002
         EJECT                                                          13700002
         TAVTD                                                          13750002
         EJECT                                                          13800002
         IEEBASEA                                                       13850002
         EJECT                                                          13900002
CVT      DSECT                                                          13910002
         CVT                                                            13950002
         EJECT                                                          14000002
         IHAPSA                                                         14050002
         EJECT                                                          14060002
         IKJRB                                                          14070002
         EJECT                                                          14080002
         IKJTCB LIST=YES                                                14090003
         EJECT                                                          14100002
         TTCXD                                                          14150002
         EJECT                                                          14200002
         IKJTIOCP                                                       14250002
         EJECT                                                          14300002
         IKJTSB                                                         14350002
         END                                                            14400002
./  ADD  SSI=32790135,NAME=IGG09402
         TITLE 'IGG09402 - TS END'                                      00050002
IGG09402 CSECT                                                          00100002
         COPY  LCGASMS2                                                 00150002
         SPACE 3                                                        00160002
*********************************************************************** 00170002
*                                                                       00180002
*01* MODULE-NAME = IGG09402                                             00190002
*                                                                       00192002
*01* DESCRIPTIVE-NAME = TIME SHARING END                                00194002
*                                                                       00196002
*01* COPYRIGHT = NONE                                                   00198002
*                                                                       00198402
*01* STATUS = 00                                                        00198802
*                                                                       00199202
*01* FUNCTION = FREE MAIN STORAGE FOR TIOC                              00199602
*                                                                       00199702
*01* NOTES = N/A                                                        00199802
*                                                                       00199902
*01* RESTRICTIONS = N/A                                                 00216602
*                                                                       00226602
*02*   DEPENDENCIES = NONE                                              00228602
*                                                                       00230602
*02*   RESTRICTIONS = NONE                                              00232602
*                                                                       00233002
*02*   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                      00233102
*                                                                       00233202
*02*   PATCH-LABEL = TSENDEND                                           00238802
*                                                                       00240802
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             00242802
*                                                                       00243202
*02*   PROCESSOR = ASSEMXF-370R                                         00243602
*                                                                       00244002
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE DS ID-01       00244102
*                                                                       00244202
*02*   ATTRIBUTES = REENTRANT, REUSABLE, ENABLED                        00244302
*                                                                       00258202
*01* ENTRY-POINT = IGG09402 (HOLDING THE LOCAL AND THE CMS LOCKS,       00268202
*                  IN SUPERVISOR'S KEY)                                 00268602
*                                                                       00270202
*02*   PURPOSE = SEE FUNCTION                                           00270602
*                                                                       00271002
*02*   LINKAGE = FROM IGC0009D VIA BRANCH                               00271402
*                                                                       00271802
*01* INPUT = REGISTER 0 CONTAINS ENTRY CODE IN HIGH ORDER BYTE          00271902
*            REGISTER 1 CONTAINS ZERO                                   00272002
*            REGISTER 3 CONTAINS CVT ADDRESS                            00272102
*            REGISTER 4 CONTAINS TCB ADDRESS                            00276702
*            REGISTER 5 CONTAINS SVRB ADDRESS                           00278702
*            REGISTER 14 CONTAINS RETURN ADDRESS                        00280702
*                                                                       00281102
*01* OUTPUT = REGISTER 14 CONTAINS RETURN ADDRESS                       00281202
*                                                                       00281302
*01* EXIT-NORMAL = GO BACK TO CALLER VIA BR 14                          00281402
*                                                                       00286002
*01* EXIT-ERROR = NONE                                                  00288002
*                                                                       00290002
*01* EXTERNAL REFERENCES = IGG09403                                     00290402
*                                                                       00290502
*02*   CONTROL BLOCKS = TCX, CVT, SCVT, SVC TABLE, TIOCRPT, TSB         00290602
*                                                                       00290702
*01* TABLES = NONE                                                      00302502
*                                                                       00312502
*01* MACROS = FREEMAIN, MODESET, SETLOCK, WTO                           00314502
*                                                                       00318402
*01* CHANGE-ACTIVITY                                                    00320402
*        VS01246 -  05/30/73 (CHECK CALLERS KEY IN RB)                  00320802
*                                                                       00322402
**********************************************************************  00326302
         SPACE 3                                                        00328302
*                                                                       00330402
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00334302
*                                                                       00338202
*              REGISTER EQUATES                                         00350002
*                                                                       00400002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00450002
*                                                                       00500002
R0       EQU   0                        WORK/PARAMETER REGISTER         00550002
R1       EQU   1                        WORK/PARAMETER REGISTER         00600002
RBASE    EQU   2                        BASE FOR THIS MODULE            00650002
RCVT     EQU   3                        BASE FOR CVT                    00700002
R4       EQU   4                        WORK REGISTER                   00750002
RRB      EQU   5                        BASE FOR RB                     00800002
RTCX     EQU   6                        BASE FOR TCX                    00850002
RWORK6   EQU   6                        WORK REGISTER           YM01246 00860002
RRPT     EQU   7                        BASE FOR TIOCRPT                00900002
RWORK8   EQU   8                        WORK REGISTER                   00950002
RWORK9   EQU   9                        WORK REGISTER                   01000002
RWORK10  EQU   10                       WORK REGISTER                   01050002
RWORK11  EQU   11                       WORK REGISTER                   01100002
RSVCT    EQU   12                       BASE FOR SVC TABLE              01150002
R13      EQU   13                       WORK REGISTER                   01200002
R14      EQU   14                       CONTAINS RETURN ADDRESS         01250002
R15      EQU   15                       CONTAINS RETURN CODE            01300002
         SPACE 3                                                        01350002
*                                                                       01400002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 01450002
*                                                                       01452002
*              EQUATES FOR MASKS, DISPLACEMENTS, CONSTANTS              01454002
*                                                                       01456002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 01460002
*                                                                       01500002
ZERO     EQU   0                        '0'                             01660002
ONE      EQU   1                        '1'                             01700002
FOUR     EQU   4                        '4'                             01750002
E8       EQU   8                        '8'                             01800002
E20      EQU   20                       '20'                            01850002
E28      EQU   28                       '28'                            01900002
TIMES8   EQU   3                        MUSK FOR MULTIPLY BY 8 W/SLL    01950002
QTIP     EQU   101                      SVC NUMBER FOR QTIP             02000002
TIOCSP   EQU   231                      SUBPOOL NUMBER FOR TIOC STORAGE 02050002
HEX80    EQU   X'80'                    HIGH ORDER BIT IN A BYTE        02052002
BADCALLR EQU   4                        RC FOR INVALID CALLER           02070002
TSNOTUP  EQU   8                        RC FOR TS ALREADY ENDED         02080002
         SPACE 3                                                        02100002
         BALR  RBASE,R0                 ESTABLISH BASE                  02150002
         USING *,RBASE                  MODULE ADDRESSABLE              02200002
         USING CVT,RCVT                 CVT ADDRESSABLE                 02250002
         USING RBBASIC,RRB              RB ADDRESSABLE                  02300002
         USING TIOCRPT,RRPT             TIOCRPT ADDRESSABLE             02350002
         SPACE 3                                                        02400002
         B     VALIDITY                 BRANCH AROUND DATE/ID           02450002
         DC    C'IGG09402'              MODULE ID                       02500002
         DC    X'3150'                  JULIAN DATE 05/30/73            02510002
         SPACE 3                                                        02520002
*                                                                       02550002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02600002
*                                                                       02610002
*              VALIDITY CHECK                                           02620002
*                                                                       02630002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02640002
*                                                                       02650002
VALIDITY EQU   *                                                        02650402
         LR    R4,R14                   SAVE RETURN ADDRESS             02652002
         LTR   R1,R1                    ANY PARAMETER PASSED            02660002
         BNZ   INVALID                  SHOULD NOT HAVE ANY             02670002
         L     RWORK6,RBLINK            CALLERS RB              YM01246 02720002
         DROP  RRB                      RB ADDRESSABILITY ENDS  YM01246 02730002
         USING RBBASIC,RWORK6           CALLERS RB ADDR         YM01246 02740002
         TM    RBOPSW+ONE,HEX80         IS CALL MADE BY SYSTEM  YM01246 02750002
         DROP  RWORK6                   RB ADDRESSABILITY ENDS  YM01246 02760002
         USING IEDQTCX,RTCX             TCX ADDRESSABLE         YM01246 02770002
         BO    INVALID                  NO, CALLER IS INVALID           02800002
         SPACE 3                                                        03000002
*                                                                       03304002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03306002
*                                                                       03308002
*              ASSUME TCAM'S KEY TO ZERO OUT TCXRPT AND TCXTSI          03308402
*                                                                       03308802
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03309202
*                                                                       03309602
         L     RTCX,CVTAQAVT            GET ADDRESS OF TCX              03310002
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          03349802
         L     RRPT,TCXRPT              SAVE TIOCRPT ADDRESS            03349902
         LTR   RRPT,RRPT                IS TIME SHARING UP              03366602
         BZ    TSSTOPED                 NO, GIVE BAD RETURN CODE        03376602
         SR    RWORK11,RWORK11          CLEAR REGISTER                  03383302
         ST    RWORK11,TCXRPT           CLEAR RPT POINTER IN TCX        03400002
         ST    RWORK11,TCXTSI           CLEAR TSINPUT'S QCB ADDRESS     03400402
         MODESET EXTKEY=SUPR            CHANGE BACK INTO KEY 0          03402002
         SPACE 3                                                        03450002
*                                                                       03500002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03550002
*                                                                       03560002
*              PUT THE ADDRESS OF CVTBRET IN QTIP SLOT                  03570002
*              IN SVC TABLE                                             03580002
*                                                                       03590002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03592002
*                                                                       03600002
         L     RSVCT,CVTABEND           GET SECONDARY CVT ADDRESS       03650002
         USING SCVTSECT,RSVCT           ADDRESSABILITY FOR SEC'DARY CVT 03700002
         L     RSVCT,SCVTSVCT           GET SVC TABLE ADDRESS           03750002
         DROP  RSVCT                    DROP SEC'DARY CVT BASE          03760002
         LA    RWORK9,QTIP              GET QTIP SVC NUMBER             03800002
         SLL   RWORK9,TIMES8            MULTIPLY BY SIZE OF EACH ENTRY  03850002
         LA    RWORK10,CVTBRET          GET ADDRESS OF CVTBRET          03900002
         SPACE 1                                                        03950002
         ST    RWORK10,ZERO(RWORK9,RSVCT)  PUT IT IN SVC TABLE          04000002
         SPACE 1                                                        04030002
FREECMS  EQU   *                                                        04040002
         SETLOCK RELEASE,TYPE=CMS,                  * FREE CMS         X04042002
               RELATED=(TIOCRPT,IGC0009D)           * LOCK              04044002
         SPACE 1                                                        04046002
FREELCL  EQU   *                                                        04048002
         SETLOCK RELEASE,TYPE=LOCAL,                * FREE LOCAL       X04048402
               RELATED=(TIOCRPT,IGC0009D)           * LOCK              04048802
         SPACE 1                                                        04049202
         MODESET EXTKEY=TCAM            GET INTO TCAM'S KEY             04050002
         SPACE 3                                                        04100002
*                                                                       04150002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04160002
*                                                                       04170002
*              FREE TIOC STORAGE                                        04180002
*                                                                       04190002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04192002
*                                                                       04250002
         L     RWORK11,ONEPAGE          SIZE OF ONE PAGE                04300002
         LA    RWORK10,TIOCFBFL+L'TIOCFBFL  POINT TO 2ND ENTRY          04310002
*                                           IN FREE BUFFER LIST         04320002
         LH    RWORK9,TIOCNBFL          GET NUMBER OF BUFFER LISTS      04350002
*                                                                       04352002
*  FIRST SECTION OF BUFFERS IS FOLLOWED BY TIOCRPT AND TSB TABLE        04354002
*                                                                       04358002
NEXTPAGE EQU   *                                                        04360002
         BCT   RWORK9,FREEBFPG          IS THIS THE FIRST LIST          04400002
         L     R1,TIOCFBFL              YES, GET ADDR OF IT             04470002
         LPR   R1,R1                    MAKE SURE ADDRESS IS POSITIVE   04520002
         N     R1,PAGEADDR              ONLY WANT PAGE ADDRESS          04570002
         SPACE 1                                                        04580002
*                                                                       04590002
*  COMPUTE SIZE OF TIOCRPT AND TSB TABLE                                04600002
*                                                                       04610002
         SR    RWORK10,RWORK10          CLEAR REGISTER                  04620002
         IC    RWORK10,TIOCTSBS         GET TSB SIZE                    04670002
         LH    RWORK11,TIOCNTSB         GET NUMBER OF TSB'S             04720002
         MR    RWORK10,RWORK10          SIZE OF TSB TABLE IN RWORK11    04770002
         L     RWORK10,TIOCTSB-ONE      GET BEGINNING OF TSB TABLE      04820002
         LA    RWORK10,ZERO(,RWORK10)   CLEAR HIGH ORDER BYTE           04830002
         SR    RWORK10,R1               GET SIZE OF RPT AND BUFFERS     04870002
         AR    RWORK11,RWORK10          GET SIZE OF BFRS/RPT/TSB'S      04920002
         B     FREE                     GO TO FREE STORAGE              05020002
         SPACE 1                                                        05070002
FREEBFPG EQU   *                                                        05120002
         L     R1,ZERO(,RWORK10)        GET ADDRESS OF BUFFER PAGE      05170002
         LPR   R1,R1                    MAKE SURE IT IS POSITIVE        05220002
         N     R1,PAGEADDR              ONLY WANT PAGE ADDRESS          05270002
         SPACE 1                                                        05320002
FREE     EQU   *                                                        05370002
         FREEMAIN R,LV=(11),A=(1),SP=TIOCSP  FREE STORAGE               05420002
         SPACE 1                                                        05470002
         LTR   RWORK9,RWORK9            WAS ALL TIOC STORAGE FREED      05520002
         BZ    LASTMSG                  YES, SEND OUT LAST MESSAGE      05570002
         LA    RWORK10,L'TIOCFBFL(,RWORK10) POINT TO NEXT ENTRY IN      05620002
*                                           FREE BUFFER LIST            05670002
         B     NEXTPAGE                 GO TO DETERMINE SIZE TO FREE    05720002
         SPACE 3                                                        06300002
*                                                                       06310002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06320002
*                                                                       06330002
*              WTO TO STATE TIME SHARING ENDED                          06340002
*                                                                       06342002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06344002
*                                                                       06346002
LASTMSG  EQU   *                                                        06350002
         L     R1,MSGADDR               GET MSG LIST ADDRESS            06500002
         WTO   MF=(E,(1))               INFORM OPERATOR TS HAS ENDED    06550002
         SPACE 1                                                        06560002
         SR    R15,R15                  ZERO RETURN CODE                06570002
         SPACE 1                                                        06600002
EXIT     EQU   *                                                        06750002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    06760002
         BR    R4                       RETURN TO CALLER                06800002
         SPACE 1                                                        06850002
INVALID  EQU   *                                                        06900002
         LA    R15,BADCALLR             RETURN CODE FOR INVALID CALLER  06950002
         BR    R4                       RETURN TO CALLER                07000002
         SPACE 1                                                        07050002
TSSTOPED EQU   *                                                        07100002
         LA    R15,TSNOTUP              GIVE BAD RETURN CODE            07150002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    07160002
         BR    R4                       RETURN TO CALLER                07200002
         SPACE 1                                                        07250002
*                                                                       07300002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07350002
*                                                                       07360002
*              CONSTANTS                                                07370002
*                                                                       07380002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07390002
*                                                                       07400002
ONEPAGE  DC    F'4096'                  SIZE OF ONE PAGE                07450002
PAGEADDR DC    X'00FFF000'              USED TO GET JUST PAGE ADDRESS   07460002
MSGADDR  DC    V(MSGLIST)               ADDRESS OF MESSAGE LIST FOR WTO 07500002
TSENDEND DC    10F'0'                   PATCH AREA                      07550002
         SPACE 3                                                        07600002
*                                                                       07610002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07626002
*                                                                       07626402
*              DSECT MACROS                                             07626802
*                                                                       07627202
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07628002
*                                                                       07630002
CVT      DSECT                                                          07650002
         CVT                                                            07700002
         SPACE 3                                                        07750002
         IHAPSA                                                         07760002
         SPACE 3                                                        07770002
         TTCXD                                                          07800002
         SPACE 3                                                        07850002
         IKJTIOCP                                                       07900002
         SPACE 3                                                        07950002
         IHASCVT                                                        08000002
         SPACE 3                                                        08050002
         IKJRB                                                          08100002
         END                                                            08150002
./  ADD  SSI=31321038,NAME=IGG09403
         TITLE 'IGG09403 - TIME SHARING END MESSAGE'                    00050002
IGG09403 CSECT                                                          00100002
         COPY  LCGASMS2                                                 00150002
**********************************************************************  00200002
*                                                                       00250002
*01* MODULE-NAME = IGG09403                                             00300002
*                                                                       00350002
*01*  DESCRIPTIVE-NAME = TIME SHARING END MESSAGE                       00400002
*                                                                       00450002
*01* COPYRIGHT = NONE                                                   00500002
*                                                                       00550002
*01* STATUS = 00                                                        00600002
*                                                                       00650002
*01* FUNCTION = LIST FORM OF WTO MESSAGE FOR IGG09402                   00700002
*                                                                       00750002
*01* NOTES = N/A                                                        00800002
*                                                                       00850002
*01* RESTRICTIONS = N/A                                                 00900002
*                                                                       00950002
*02*   DEPENDENCIES = NONE                                              01000002
*                                                                       01050002
*02*   RESTRICTIONS = NONE                                              01100002
*                                                                       01150002
*02*   REGISTER-CONVENTIONS = N/A                                       01200002
*                                                                       01250002
*02*   PATCH-LABEL = PTCHAREA                                           01300002
*                                                                       01350002
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             01400002
*                                                                       01450002
*02*   PROCESSOR = SEE LISTING                                          01500002
*                                                                       01550002
*02*   ATTRIBUTES = N/A                                                 01600002
*                                                                       01650002
*01* ENTRY-POINT = N/A                                                  01700002
*                                                                       01750002
*02*   PURPOSE = SEE FUNCTION                                           01800002
*                                                                       01850002
*02*   LINKAGE = VIA LINKAGE EDITOR                                     01900002
*                                                                       01950002
*01* INPUT = N/A                                                        02000002
*                                                                       02050002
*01* OUTPUT = N/A                                                       02100002
*                                                                       02150002
*01* EXIT-NORMAL = N/A                                                  02200002
*                                                                       02250002
*01* EXIT-ERROR = N/A                                                   02300002
*                                                                       02350002
*01* EXTERNAL REFERENCES = NONE                                         02400002
*                                                                       02450002
*02*   CONTROL-BLOCKS = NONE                                            02500002
*                                                                       02550002
*01* TABLES = NONE                                                      02600002
*                                                                       02650002
*01* MACROS = WTO (LIST FORM)                                           02700002
*                                                                       02750002
*01* CHANGE-ACTIVITY                                                    02800002
*                                                                       02850002
**********************************************************************  02900002
         SPACE 3                                                        02950002
         ENTRY MSGLIST                                                  03000002
         ENTRY IKJ409I                                                  03010002
MSGLIST  WTO   'IKJ405I TIME SHARING ENDED',ROUTCDE=2,DESC=5,MF=L       03050002
         SPACE 3                                                        03052002
IKJ409I  WTO   'IKJ409I SYSTEM ERROR - TIME SHARING TERMINATED',       X03060002
               ROUTCDE=(2),DESC=(5),MF=L                                03070002
         SPACE 3                                                        03080002
PTCHAREA DC    9F'0'                    PATCH AREA                      03100002
         END                                                            03150002
./  ADD  SSI=31940043,NAME=IGG09404
         TITLE 'IGG09404 - STBREAK ROUTINE'                             96570900
IGG09404 CSECT                                                          96573600
         COPY  LCGASMS2                                                 96574002
*                                                                M3267  96574500
*                                                                 M3810 96575400
*0000433000,558000,670400,733800-735000,792000-999999            TS0015 96576300
*                                                                M4283  96577200
*                                                                 M5466 96578100
*********************************************************************** 96579000
*                                                                     * 96579900
*    VS2/2 DELETIONS/CHANGES                                          * 96581902
*                                                               YS02019 96582002
*                                                               YM01114 96582302
*    RELEASE 21 DELETIONS/CHANGES                                     * 96582600
*0891488000-510000,744000                                        A222   96583500
*0891736000                                                      S21008 96584400
*                                                                     * 96585300
* STATUS                                                              * 96586200
*    CHANGE LEVEL 002                                                 * 96587100
*                                                                     * 96588000
* FUNCTION -                                                          * 96588900
*    THIS ROUTINE IS TO SERVE THE MACRO 'STBREAK'. IT IS PART OF SVC  * 96589800
*    94. IT IS TO SET THE STATUS BITS IN QCB TO REFLECT THE PRESENCE/ * 96590700
*    ABSENCE OF A BREAK FEATURE ON THE TERMINAL.  IT ONLY APPLIES TO  * 96591600
*    TERMINAL TYPES 1050 OR 2741 DIAL.  IF THE MACRO 'STBREAK' IS     * 96592500
*    ISSUED FOR TERMINALS OTHER THAN THE ABOVE MENTIONED TYPES, THE   * 96593400
*    FUNCTION IS IGNORED.                                             * 96594300
*                                                                     * 96595200
*    FOR 2741 OR 1050 DIAL TERMINAL TYPES, IF OPERAND IS-             * 96596100
*                                                                     * 96597000
*    YES (BIT 0 OF FLAG BYTE IN REG 1 IS ON) - SET QCBNOBRK OFF       * 96597900
*                                                                     * 96598800
*    NO (BIT 0 OF FLAG BYTE IN REG 1 IS OFF) - SET QCBNOBRK ON        * 96599700
*                                                                     * 96600600
* ENTRY POINTS -                                                      * 96601500
*         IGG09404 - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 96602400
*                                                                     * 96603300
* INPUT -                                                             * 96604200
*    REGISTER 0 CONTAINS PARAMETER                                    * 96606202
*    REGISTER 1 CONTAINS PARAMETER                                    * 96608202
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 96612300
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 96613200
*    REGISTER 5 CONTAINS TSB ADDRESS                            YS02019 96615002
*                                                                     * 96620400
* OUTPUT -                                                            * 96621300
*    REGISTER 15 HAS RETURN CODE:                                     * 96622200
*           0 - SUCCESSFUL                                            * 96623100
*           4 - INVALID PARAMETER                                     * 96624000
*           8 - WRONG TERMINAL TYPE                                   * 96624900
*                                                                     * 96625800
* EXTERNAL REFERENCES -                                               * 96626700
*         TPUT - VIA SVC CALL                                         * 96627600
*         IEDQTNT - VIA BRANCH                                        * 96628500
*                                                                     * 96629400
* EXITS, NORMAL -                                                     * 96630300
*         BR 14 WITH 0 IN REGISTER 15                           YS02019 96631202
*                                                                     * 96632100
* EXITS, ERROR -                                                      * 96633000
*         BR 14 WITH 4 OR 8 IN REGISTER 15                      YS02019 96633902
*                                                                     * 96634800
* TABLES/WORK AREAS -                                                 * 96635700
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 96636600
*                                                                     * 96637500
* ATTRIBUTES -                                                        * 96638400
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE                          * 96639302
*                                                                     * 96640200
* CHARACTER CODE DEPENDENCY -                                         * 96641100
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 96642000
* NOTES -                                                             * 96642900
*    YS02019 - VS/2 RELEASE 2 CHANGES                                 * 96643302
*                                                                     * 96644700
*********************************************************************** 96645600
         SPACE 3                                                        96646500
********                                                                96647400
******** REGISTER EQUATES                                               96648300
********                                                                96649200
RWORK0   EQU   0                        WORK REGISTER                   96651000
RPARM0   EQU   0                        PARAMETER REGISTER              96651402
RWORK1   EQU   1                        WORK REGISTER                   96652800
RPARM1   EQU   1                        PARAMETER REGISTER              96652902
RWORK2   EQU   2                        WORK REGISTER                   96653700
RWORK3   EQU   3                        WORK REGISTER                   96654600
RCVT     EQU   3                        POINTS TO CVT                   96655500
RTCB     EQU   4                        POINTS TO TCB                   96658200
RWORK4   EQU   4                        WORK REGISTER           YS02019 96658602
RTSB     EQU   5                        POINTS TO TSB                   96660902
RWORK6   EQU   6                        WORK REGISTER           YS02019 96661302
RWORK7   EQU   7                        WORK REGISTER           YS02019 96663302
RWORK8   EQU   8                        WORK REGISTER           YS02019 96665302
RWORK9   EQU   9                        WORK REGISTER           YS02019 96667302
RCONST   EQU   10                       POINTS TO PROGRAM CONSTANTS     96668102
RWORK11  EQU   11                       WORK REGISTER           YS02019 96670102
RBASE    EQU   12                       BASE REGISTER                   96671700
RWORK13  EQU   13                       WORK REGISTER           YS02019 96672602
R13      EQU   13                       REGISTER 13                     96673500
R14      EQU   14                       REGISTER 14                     96674400
RLINK    EQU   14                       LINK REGISTER                   96675300
RTRNSTBL EQU   14                       POINTS TO TRANSLATE TABLES      96676200
R15      EQU   15                       REGISTER 15                     96677100
RBRANCH  EQU   15                       BRANCH REGISTER                 96678000
RCODE    EQU   15                       RETURN CODE REGISTER            96678900
         SPACE 2                                                        96679800
********                                                                96680700
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           96681600
********                                                                96682500
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         96683400
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         96684300
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         96685200
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         96686100
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      96687000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    96687900
D0       EQU   0                        DISPLACEMENT OF 0               96688800
D1       EQU   1                        DISPLACEMENT OF 1               96689700
D2       EQU   2                        DISPLACEMENT OF 2               96690600
D3       EQU   3                        DISPLACEMENT OF 3               96691500
D4       EQU   4                        DISPLACEMENT OF 4               96692400
D5       EQU   5                        DISPLACEMENT OF 5               96693300
D6       EQU   6                        DISPLACEMENT OF 6               96694200
D14      EQU   14                       DISPLACEMENT OF 14              96695100
L1       EQU   1                        LENGTH OF 1                     96698700
L2       EQU   2                        LENGTH OF 2                     96699600
L3       EQU   3                        LENGTH OF 3                     96700500
L4       EQU   4                        LENGTH OF 4                     96701400
L8       EQU   8                        LENGTH OF 8                     96702300
L16      EQU   16                       LENGTH OF 16                    96703200
L20      EQU   20                       LENGTH OF 20                    96704100
L24      EQU   24                       LENGTH OF 24                    96705000
L32      EQU   32                       LENGTH OF 32                    96705900
RETCODE4 EQU   4                        RETURN CODE OF 4                96706800
RETCODE8 EQU   8                        RETURN CODE OF 8                96707700
RETCODEC EQU   12                       RETURN CODE OF 12               96708600
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           96709500
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       96710400
CZERO    EQU   0                        TO TEST FOR ZERO                96711300
CONE     EQU   1                        CONSTANT OF 1                   96712200
CTWO     EQU   2                        CONSTANT OF 2                   96713100
CTHREE   EQU   3                        CONSTANT OF 3                   96714000
CFOUR    EQU   4                        CONSTANT OF 4           YS02019 96714402
CFIFTEEN EQU   15                       CONSTANT OF 15                  96714900
CSIXTEEN EQU   16                       CONSTANT OF 16                  96715800
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                96716700
BLANK    EQU   X'40'                    TO TEST FOR BLANK               96717600
OFF      EQU   X'FF'                    TO TURN BITS OFF                96718500
IDLE     EQU   X'17'                    IDLE CHARACTER                  96728502
         SPACE 3                                                        96735600
********                                                                96736500
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     96737400
********                                                                96738300
         USING *,RBASE                  REGISTER ADDRESSABILITY         96743700
         USING CVT,RCVT                 CVT ADDRESSABILITY              96744600
         USING TSB,RTSB                 TSB ADDRESSABILITY              96746400
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY         96752700
         B     PASTID                   SKIP MODULE ID.         YS02019 96753102
         DC    C'IGG09404'              MODULE ID.              YS02019 96753502
         DC    X'3183'                  DATE - 07/02/73         YM01114 96755202
PASTID   EQU   *                                                YS02019 96755602
********                                                                96757102
******** TEST FOR VALID PARAMETER                                       96758802
********                                                                96760502
         SLDL  RPARM0,L1                .TEST                           96762202
         LTR   RPARM1,RPARM1            .FOR                            96763902
         BNZ   PARMBAD                  .VALID                          96765602
         SRDL  RPARM0,L1                .PARAMETER                      96767302
         SPACE 1                                                        96771302
         MODESET EXTKEY=TCAM            GET TCAMS KEY           YS02019 96773302
         TM    TSBFLG4,TSBHUNG          HAS USER HUNG UP        YS02019 96775002
         BO    RETURN                   YES,RETURN                      96775702
********                                                                96785100
******** TEST FOR 1050 OR 2741 TERMINAL                                 96786000
********                                                                96786900
         TM    TSBTERM1,TSBC5041+TSBC2741 VALID 2741 OR 1050    YS02019 96787802
         BNZ   TRMOK                    VALID TERMINAL                  96788700
         TM    TSBTERM2,TSBC1050        IS IT A 1050 TERMINAL   YS02019 96789602
         BO    TRMOK                    YES, VALID TERMINAL             96793602
WRNGTYPE EQU   *                                                        96799500
         MODESET EXTKEY=SUPR            CHANGE TO KEY 0         YS02019 96799902
         LA    RCODE,RETCODE8           INDICATE INVALID TERMINAL TYPE  96800400
         BR    R14                      RETURN TO CALLER        YS02019 96801302
TRMOK    EQU   *                                                        96802200
         LTR   RPARM1,RPARM1            REQUEST TO ACTIVATE REVERSE BRK 96803102
         BNZ   BREAK                    BRANCH IF YES                   96804000
NOBREAK  EQU   *                                                        96804900
         LR    RWORK2,RLINK             SAVE RETURN REGISTER    YS02019 96805302
         LA    RPARM1,MASK1             MASK ADDR FOR TPOST     YS02019 96805702
         L     RBRANCH,TPOST            ADDR OF POSTIT ROUTINE  YS02019 96806102
         BALR  RLINK,RBRANCH            TURN ON BIT             YS02019 96806502
*                                       IN QCB TO PREVENT INPUT YS02019 96806602
         LR    RLINK,RWORK2             RESTORE RETURN ADDRESS  YS02019 96807402
         OI    TSBSTAT,TSBLWAIT         LOCK KEYBOARD                   96809402
         OI    TSBFLG3,TSBSPIT+TSBNOBRK NO AUTOPROMPTING BY     YM01114 96810202
*                                       TSOUTPUT AND BREAK      YM01114 96810302
*                                       FEATURE NOT ALLOWED     YM01114 96810802
         USING TCB,RTCB                 TCB ADDRESSABILITY              96812202
         L     RTCB,TCBRBP              LOCATE BUFFER                   96814202
         USING RBSECT,RTCB              ADDRESSABILITY                  96816602
FREE1    EQU   *                        FREE LOCKS FOR TPUT     YS02019 96817802
         MODESET EXTKEY=SUPR            NEED SUPR KEY FOR SETLK YS02019 96817902
         MVI   RBEXSAVE,IDLE            PUT IDLE CHAR IN BUFFER         96818302
         LR    RWORK6,RLINK             SAVE RETURN ADDR        YS02019 96818802
         LR    RWORK7,RBASE             SAVE BASE               YS02019 96818902
         SETLOCK RELEASE,TYPE=CMS,      FREE CMS LOCK           YS02019X96819002
               RELATED=(TSB,IGC0009D(GETLKS))                   YS02019 96820802
         SETLOCK RELEASE,TYPE=LOCAL,    FREE LOCAL LOCK         YS02019X96827602
               RELATED=(TSB,IGC0009D(GETLKS))                   YS02019 96828002
         LA    RWORK0,L1                .ISSUE                          96829402
         LA    RWORK1,RBEXSAVE          .TPUT                           96831202
         O     RWORK1,TPUT1             .TO                             96833002
         TPUT  (1),(0),R                .SYNCHRONIZE THE LINE           96834802
GET2     EQU   *                        GET LOCKS AGAIN         YS02019 96836602
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YS02019X96838402
               RELATED=(TSB,'SVC EXIT PROLOGUE')                YS02019 96840202
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019X96842002
               RELATED=(TSB,'SVC EXIT PROLOGUE')                YS02019 96843802
         LR    RLINK,RWORK6             RESTORE RETURN ADDR     YS02019 96845602
         LR    RBASE,RWORK7             RESTORE BASE ADDR       YS02019 96847402
         MODESET EXTKEY=TCAM            GET TCAMS KEY TO UPDTE  YS02019 96849202
*                                       THE TSB                 YS02019 96851002
         L     RWORK6,CVTAQAVT          GET ADDR OF TCX         YS02019 96852802
         LTR   RWORK6,RWORK6            IS TCAM STILL ACTIVE    YS02019 96854802
         BZ    RETURN                   NO, RETURN TO CALLER    YS02019 96855202
         L     RWORK6,TCXRPT-IEDQTCX(,RWORK6) GET TIOCRPT ADDR  YS02019 96855602
         LTR   RWORK6,RWORK6            IS TIME SHARING ACTIVE  YS02019 96856002
         BZ    RETURN                   NO, RETURN TO CALLER    YS02019 96856102
         TM    TSBFLG4,TSBHUNG          HAS USER HUNG UP        YS02019 96856402
         BO    RETURN                   YES,RETURN                      96858202
         LR    RWORK2,RLINK             SAVE RETURN ADDR        YS02019 96860002
         LA    RPARM1,MASK2             MASK PARM FOR TPOST     YS02019 96861802
         L     RBRANCH,TPOST            ADDR OF POSTIT ROUTINE  YS02019 96863602
         BALR  RLINK,RBRANCH            MAKE A NOBREAK          YS02019 96865402
*                                       TERMINAL & ALLOW INPUT  YS02019 96867202
         LR    RLINK,RWORK2             RESTORE RETURN ADDR     YS02019 96869002
         NI    TSBSTAT,OFF-TSBLWAIT     UNLOCK KEYBOARD                 96870802
         NI    TSBFLG3,OFF-TSBSPIT      PERMIT AUTOPROMPTING            96872602
         B     RETURN                   RETURN TO CALLER                96874402
BREAK    EQU   *                                                        96876202
         NI    TSBFLG3,OFF-TSBNOBRK     USE OF BREAK FEATURE OK YM01114 96876602
         LR    RWORK2,RLINK             SAVE RETURN ADDR        YS02019 96878002
         LA    RPARM1,MASK3             PASS MASK ADDR          YS02019 96879802
         L     RBRANCH,TPOST            ADDR OF POSTIT ROUTINE  YS02019 96881602
         BALR  RLINK,RBRANCH            GO TO POSTTSB TO TPOST  YS02019 96883402
*                                       TO MAKE IT A BREAK TERM         96885202
         LR    RLINK,RWORK2             RESTORE RETURN REGISTER YS02019 96895202
RETURN   EQU   *                                                        96896002
         MODESET EXTKEY=SUPR            RETURN TO SUPR KEY      YS02019 96897802
         SR    RCODE,RCODE              SET GOOD RETURN CODE            96908602
         BR    R14                      GO BACK TO CALLER       YS02019 96910402
PARMBAD  EQU   *                                                        96912202
         LA    RCODE,RETCODE4           BAD PARAMETER RETURN CODE       96914002
         BR    R14                      GO BACK TO CALLER       YS02019 96915802
         DS    0A                       FORCE ALIGNMENT         YS02019 96916202
MASK1    DC    AL1(TSBPOSTO,0,0,0)      .ALLOW                  YS02019 96917602
         DC    AL1(255,255,255,255)     .NO                     YS02019 96918002
         DC    AL1(0,0,QCBNOBUF,QCBNOBUF) .INPUT                YS02019 96918102
         DC    AL1(255,255,255,255)     .TO TERMINAL            YS02019 96918202
MASK2    DC    AL1(TSBPOSTO,0,QCBNOBRK,QCBNOBRK) .ALLOW         YS02019 96919002
         DC    AL1(255,255,255,255)     .INPUT                  YS02019 96919402
         DC    AL1(0,0,QCBNOBUF,0)      .AND                    YS02019 96919802
         DC    AL1(255,255,255,255-QCBNOBUF) .NOBREAK           YS02019 96920202
MASK3    DC    AL1(TSBPOSTO,0,QCBNOBRK,0) .MAKE                 YS02019 96920302
         DC    AL1(255,255,255,255-QCBNOBRK) .IT                YS02019 96920402
         DC    AL1(0,0,0,0)             .A BREAK                YS02019 96920502
         DC    AL1(255,255,255,255)     .TERMINAL               YS02019 96920602
ZAP      DC    9F'0'                    PATCH AREA              YS02019 96921002
         SPACE 1                                                        96921502
CONSTANT DSECT                                                          96921702
ZERO     DC    F'0'                     CONSTANT OF 0                   96921902
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          96922202
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  96923002
TWO      DC    XL1'02'                  CONSTANT OF 2                   96923802
TEN      DC    H'10'                    CONSTANT OF 10                  96924602
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  96925402
SIX      DC    H'6'                     CONSTANT OF 6                   96926202
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   96927002
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    96927802
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         96928602
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  96929402
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               96930202
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    96931002
ONE      DC    AL1(1)                   CONSTANT OF ONE                 96931802
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER     YA00364 96932102
TPOST    DS    F                        ADDR OF POSTTSB ROUTINE YS02019 96933902
TPMASK   DS    4F                       MASK TO TPOST QCB       YS02019 96934202
         EJECT                                                          96934502
CVT      DSECT                                                          96934802
         CVT     LIST=YES                                               96935102
         EJECT                                                          96935402
         IKJRB                                                          96935702
         EJECT                                                          96936002
         TQCBD                                                          96936302
         EJECT                                                          96936602
         IKJTCB                                                         96936902
         EJECT                                                          96937002
         TTCXD                                                  YS02019 96937102
         EJECT                                                          96937202
         IKJTSB  LIST=YES                                               96938102
         EJECT                                                          96938502
         IHAPSA                                                         96959902
         END                                                            96960600
./  ADD  SSI=31480269,NAME=IGG09405
         TITLE 'IGG09405 - STCOM ROUTINE'                               98058000
IGG09405 CSECT                                                          98082000
*********************************************************************** 98090000
*                                                                M5113  98098000
*                                                                     * 98106000
*                                                                 M5113 98114000
*    RELEASE 23 DELETIONS/CHANGES                                     * 98122000
*    RELEASE 22 DELETIONS/CHANGES                                     * 98130000
*    RELEASE 21 DELETIONS/CHANGES                                     * 98138000
*                                                                     * 98146000
* STATUS -                                                            * 98154000
*    CHANGE LEVEL 01                                                  * 98162000
*                                                                     * 98170000
* FUNCTION -                                                          * 98178000
*    THIS ROUTINE IS TO SERVE THE MACRO STCOM', WHICH IS USED         * 98186000
*    BY PROFILE COMMAND AND OTHER PROBLEM PROGRAMS TO SPECIFY WHETHER * 98194000
*    OR NOT THE USER WISHES TO RECEIVE INTER-TERMINAL COMMUNICATIONS. * 98202000
*    ONCE THE USER STOPS INTER-TERMINAL COMMUNICATIONS VIA ISSUANCE   * 98210000
*    OF THIS MACRO, ANY SUBSEQUENT TPUTS WITH TJID TO THIS TERMINAL   * 98218000
*    WILL BE IGNORED AND A RETURN CODE OF '0C' WILL BE PASSED BACK TO * 98226000
*    THE CALLER.                                                      * 98234000
*                                                                     * 98242000
*    INTERNALLY, THIS ROUTINE WILL SET ON BITS IN TSB (TSBJTOFF,      * 98250000
*    TSBNOMSG) IF THE USER SPECIFIES NO INTER-TERMINAL COMMUNICATIONS.* 98258000
*    OTHERWISE, THE ABOVE MENTIONED BITS IN TSB WILL BE ON.  THE      * 98266000
*    TSBJTOFF BIT WILL BE CHECKED BY TPUT IF THE TJID OPTION IS       * 98274000
*    SPECIFIED.                                                       * 98282000
*                                                                     * 98290000
* ENTRY POINTS -                                                      * 98298000
*         IGG09405 - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 98306000
*                                                                     * 98314000
* INPUT -                                                             * 98322000
*    REGISTER 0 CONTAINS PARAMETER                                    * 98372002
*    REGISTER 1 CONTAINS PARAMETER                                    * 98374002
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 98394000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 98402000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 98418002
*                                                                     * 98466000
* OUTPUT -                                                            * 98474000
*    REGISTER 15 HAS RETURN CODE:                                     * 98482000
*           0 - SUCCESSFUL                                            * 98490000
*           4 - INVALID PARAMETER                                     * 98498000
*                                                                     * 98506000
* EXTERNAL REFERENCES -                                               * 98514000
*         NONE                                                        * 98522000
*                                                                     * 98530000
* EXITS, NORMAL -                                                     * 98538000
*         BR 14 WITH 0 IN REGISTER 15                                 * 98546002
*                                                                     * 98554000
* EXITS, ERROR -                                                      * 98562000
*         BR 14 WITH 4 IN REGISTER 15                                 * 98570002
*                                                                     * 98578000
* TABLES/WORK AREAS -                                                 * 98586000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 98594000
*                                                                     * 98602000
* ATTRIBUTES -                                                        * 98610000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE                    YS02019 98618002
*                                                                     * 98626000
* CHARACTER CODE DEPENDENCY -                                         * 98634000
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 98642000
* NOTES -                                                             * 98650000
*    YS02019 - VS/2 RELEASE 2 CHANGES                                 * 98660002
*                                                                     * 98666000
*********************************************************************** 98674000
         SPACE 3                                                        98682000
********                                                                98690000
******** REGISTER EQUATES                                               98698000
********                                                                98706000
RWORK0   EQU   0                        WORK REGISTER                   98722000
RPARM0   EQU   0                        PARAMETER REGISTER              98732002
RWORK1   EQU   1                        WORK REGISTER                   98738000
RPARM1   EQU   1                        PARAMETER REGISTER              98740002
RWORK2   EQU   2                        WORK REGISTER                   98750002
RWORK3   EQU   3                        WORK REGISTER                   98754000
RCVT     EQU   3                        POINTS TO CVT                   98762000
RTCB     EQU   4                        POINTS TO TCB                   98786000
RTSB     EQU   5                        POINTS TO TSB                   98810002
RWORK6   EQU   6                        WORK REG 6              YS02019 98820002
RWORK7   EQU   7                        WORK REGISTER           YS02019 98860002
RWORK8   EQU   8                        WORK REGISTER           YS02019 98870002
RWORK9   EQU   9                        WORK REGISTER           YS02019 98872002
RWORK10  EQU   10                       WORK REGISTER           YS02019 98872402
RWORK11  EQU   11                       WORK REGISTER           YS02019 98882402
RBASE    EQU   12                       BASE REGISTER                   98906000
RCONST   EQU   13                       POINTS TO PROGRAM CONSTANTS     98914000
R13      EQU   13                       REGISTER 13                     98922000
R14      EQU   14                       REGISTER 14                     98930000
RLINK    EQU   14                       LINK REGISTER                   98938000
RTRNSTBL EQU   14                       POINTS TO TRANSLATE TABLES      98946000
R15      EQU   15                       REGISTER 15                     98954000
RBRANCH  EQU   15                       BRANCH REGISTER                 98962000
RCODE    EQU   15                       RETURN CODE REGISTER            98970000
         SPACE 2                                                        98978000
********                                                                98986000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           98994000
********                                                                99002000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         99010000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         99018000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         99026000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         99034000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      99042000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    99050000
D0       EQU   0                        DISPLACEMENT OF 0               99058000
D1       EQU   1                        DISPLACEMENT OF 1               99066000
D2       EQU   2                        DISPLACEMENT OF 2               99074000
D3       EQU   3                        DISPLACEMENT OF 3               99082000
D4       EQU   4                        DISPLACEMENT OF 4               99090000
D5       EQU   5                        DISPLACEMENT OF 5               99098000
D6       EQU   6                        DISPLACEMENT OF 6               99106000
D14      EQU   14                       DISPLACEMENT OF 14              99114000
L1       EQU   1                        LENGTH OF 1                     99122000
L2       EQU   2                        LENGTH OF 2                     99130000
L3       EQU   3                        LENGTH OF 3                     99138000
L4       EQU   4                        LENGTH OF 4                     99146000
L8       EQU   8                        LENGTH OF 8                     99154000
L16      EQU   16                       LENGTH OF 16                    99162000
L20      EQU   20                       LENGTH OF 20                    99170000
L24      EQU   24                       LENGTH OF 24                    99178000
L32      EQU   32                       LENGTH OF 32                    99186000
RETCODE4 EQU   4                        RETURN CODE OF 4                99194000
RETCODE8 EQU   8                        RETURN CODE OF 8                99202000
RETCODEC EQU   12                       RETURN CODE OF 12               99210000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           99218000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       99226000
CZERO    EQU   0                        TO TEST FOR ZERO                99234000
CONE     EQU   1                        CONSTANT OF 1                   99242000
CTWO     EQU   2                        CONSTANT OF 2                   99250000
CTHREE   EQU   3                        CONSTANT OF 3                   99258000
CFIFTEEN EQU   15                       CONSTANT OF 15                  99266000
CSIXTEEN EQU   16                       CONSTANT OF 16                  99274000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                99282000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               99290000
OFF      EQU   X'FF'                    TO TURN BITS OFF                99298000
         SPACE 3                                                        99426000
********                                                                99434000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     99442000
********                                                                99450000
         USING *,RBASE                  CSECT BASE - SET BY ENTRY POINT 99490000
         USING TSB,RTSB                 TSB ADDRESSABILITY              99498000
         B     PASTID                   SKIP MODULE ID.         YS02019 99500002
         DC    C'IGG09405'              MODULE ID.              YS02019 99502002
         DC    X'3124'                  DATE - 05/04/73         YS02019 99504002
PASTID   EQU   *                                                YS02019 99504402
********                                                                99506000
******** CHECK PARAMETERS                                               99514000
********                                                                99522000
         SLDL  RPARM0,L1                .CHECK                          99530002
         LTR   RPARM1,RPARM1            .FOR                            99538002
         BNZ   PARMBAD                  .VALID                          99546000
         SRDL  RPARM0,L1                .PARAMETER                      99554002
         LR    RWORK10,RLINK            SAVE RETURN ADDR        YS02019 99560202
         SPACE 2                                                        99583402
********                                                                99587502
******** MAIN FUNCTION OF ROUTINE                                       99591602
********                                                                99595702
         MODESET EXTKEY=TCAM            GET TCAMS KEY           YS02019 99599802
         LTR   RPARM1,RPARM1            BIT BE SET OR RESET ?           99603902
         BZ    NOCOM                    SET FOR NO INTERCOM             99608002
COM      EQU   *                                                        99612102
         NI    TSBSTAT,OFF-TSBITOFF     ALLOW INTERCOMMUNICATION        99616202
         B     RETURN                   RETURN TO CALLER                99620302
NOCOM    EQU   *                                                        99626000
         OI    TSBSTAT,TSBITOFF         DISALOW INTERCOMMUNICATION      99634000
RETURN   EQU   *                                                        99644902
         MODESET EXTKEY=SUPR            RETURN TO SUPR KEY      YS02019 99653102
         LR    RLINK,RWORK10            RESTORE RETURN ADDR     YS02019 99669502
         SR    RCODE,RCODE              SET GOOD RETURN CODE            99673602
         BR   R14                       RETURN TO CALLER        YS02019 99677702
PARMBAD  EQU   *                                                        99681802
         LA    RCODE,RETCODE4           SET INVALID PARM CODE           99685902
         BR    R14                      GO BACK TO CALLER       YS02019 99690002
         DS    5F                       MAINTENANCE PATCH AREA   Y01018 99762000
         EJECT                                                          99770402
         IHAPSA                                                         99770802
         EJECT                                                          99778000
         IKJTSB  LIST=YES                                               99786002
         END                                                            99794000
./  ADD  SSI=31480452,NAME=IGG09406
         TITLE 'IGG09406 - STTIMEOU ROUTINE'                            00400020
IGG09406 CSECT                                                          00800020
         COPY  LCGASMS2                                                 00850002
*********************************************************************** 99325000
*                                                                     * 99332500
* STATUS -                                                            * 99334000
*    CHANGE LEVEL 01                                                  * 99335500
*                                                                     * 99337000
* FUNCTION -                                                          * 99338500
*    THIS ROUTINE IS TO SERVE THE MACRO 'STTIMEOU'. IT IS PART OF SVC * 99340000
*    94. IT SETS THE BIT CONDITION IN QCB TO REFLECT THE PRESENCE     * 99341500
*    OR ABSENCE OF TIMEOUT FEATURE OF THE TERMINAL.  THIS MACRO ONLY  * 99343000
*    APPLIES TO 1050 DIAL TERMINAL.  IF THE MACRO IS ISSUED FOR       * 99344500
*    TERMINALS OTHER THEN 1050 DIAL, THE FUNCTION IS IGNORED AND THE  * 99346000
*    INVALID TERMINAL CODE '08' IS RETURNED TO THE CALLER.            * 99347500
*    FOR 1050 DIAL TERMINALS,IF THE OPERAND SPECIFIES YES, (BIT 0 OF  * 99349000
*    FLAG BYTE IN REG 1 IS ON), THE QCBINHBN BIT IN QCB IS TURNED OFF.* 99350500
*    OTHERWISE, IF NO IS SPECIFIED, THE QCBINHBN BIT IS TURNED ON.    * 99352000
*                                                                     * 99353500
* ENTRY POINTS -                                                      * 99355000
*         IGG09406 - BEGINNING OF MODULE. CONTROL IS RECEIVED FROM    * 99356500
*         MODULE IGC0009D, FIRST LOAD OF SVC 94, ACCORDING TO ENTRY   * 99358000
*         CODE OF 6                                                   * 99359500
*                                                                     * 99361000
* INPUT -                                                             * 99362500
*    REGISTER 0 CONTAINS PARAMETER                                    * 99371500
*    REGISTER 1 CONTAINS PARAMETER                                    * 99373000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 99376000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 99377500
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 99379002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS          99388002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                              99388702
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            99391002
*                                                                     * 99394002
* OUTPUT -                                                            * 99395502
*    REGISTER 15 HAS RETURN CODE:                                     * 99397002
*           0 - SUCCESSFUL                                            * 99398502
*           4 - INVALID PARAMETER                                     * 99401502
*           8 - WRONG TERMINAL TYPE (NOT 1050)                        * 99403002
*                                                                     * 99404502
* EXTERNAL REFERENCES -                                               * 99406002
*         IEDQTNT - VIA BRANCH                                        * 99407502
*                                                                     * 99409002
* EXITS, NORMAL -                                                     * 99410502
*         BR 14 WITH 0 IN REGISTER 15                                 * 99412002
*                                                                     * 99413502
* EXITS, ERROR -                                                      * 99415002
*         BR 14 WITH 4 OR 8 IN REGISTER 15                            * 99416502
*                                                                     * 99418002
* TABLES/WORK AREAS -                                                 * 99419502
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 99421002
*    XCTL TABLE PRECEDES SAID DSECTS                                  * 99422502
*                                                                     * 99425502
* ATTRIBUTES -                                                        * 99427002
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, AND ENABLED             * 99428502
*                                                                     * 99430002
* CHARACTER CODE DEPENDENCY -                                         * 99431502
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 99433002
* NOTES -                                                             * 99434502
*    NONE                                                             * 99436002
*                                                                     * 99437502
*********************************************************************** 99439002
         SPACE 3                                                YS02019 99440502
********                                                                99442002
******** REGISTER EQUATES                                               99443502
********                                                                99445002
RPARM0   EQU   0                        PARAMETER REG 0         YS02019 99446502
RWORK0   EQU   0                        WORK REGISTER           YS02019 99449502
RPARM1   EQU   1                        PARAMETER REG 1         YS02019 99451002
RWORK1   EQU   1                        WORK REGISTER           YS02019 99452502
RWORK2   EQU   2                        WORK REGISTER           YS02019 99454002
RWORK3   EQU   3                        WORK REGISTER           YS02019 99455502
RCVT     EQU   3                        POINTS TO CVT           YS02019 99457002
RTCB     EQU   4                        POINTS TO TCB           YS02019 99461502
RTSB     EQU   5                        POINTS TO TSB           YS02019 99466002
RBASE    EQU   12                       BASE REGISTER           YS02019 99485502
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 99487002
*                                       CONSTANTS               YS02019 99487702
R13      EQU   13                       REGISTER 13             YS02019 99488502
R14      EQU   14                       REGISTER 14             YS02019 99490002
RLINK    EQU   14                       LINK REGISTER           YS02019 99491502
R15      EQU   15                       REGISTER 15             YS02019 99494502
RBRANCH  EQU   15                       BRANCH REGISTER         YS02019 99497502
RCODE    EQU   15                       RETURN CODE REGISTER    YS02019 99499002
         SPACE 2                                                YS02019 99500502
********                                                                99502002
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           99503502
********                                                                99505002
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG. YS02019 99506502
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG. YS02019 99508002
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG. YS02019 99509502
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG. YS02019 99511002
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN   YS02019 99512502
*                                       REG.                    YS02019 99513202
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN YS02019 99514002
*                                       REG.                    YS02019 99514702
D0       EQU   0                        DISPLACEMENT OF 0       YS02019 99515502
D1       EQU   1                        DISPLACEMENT OF 1       YS02019 99517002
D2       EQU   2                        DISPLACEMENT OF 2       YS02019 99518502
D3       EQU   3                        DISPLACEMENT OF 3       YS02019 99521502
D4       EQU   4                        DISPLACEMENT OF 4       YS02019 99523002
D5       EQU   5                        DISPLACEMENT OF 5       YS02019 99524502
D6       EQU   6                        DISPLACEMENT OF 6       YS02019 99526002
D14      EQU   14                       DISPLACEMENT OF 14      YS02019 99527502
L1       EQU   1                        LENGTH OF 1             YS02019 99533502
L2       EQU   2                        LENGTH OF 2             YS02019 99535002
L3       EQU   3                        LENGTH OF 3             YS02019 99536502
L4       EQU   4                        LENGTH OF 4             YS02019 99538002
L8       EQU   8                        LENGTH OF 8             YS02019 99539502
L16      EQU   16                       LENGTH OF 16            YS02019 99541002
L28      EQU   28                       LENGTH OF 28            YS02019 99542502
*                                       Y0101                   YS02019 99543202
L32      EQU   32                       LENGTH OF 32            YS02019 99545502
RETCODE4 EQU   4                        RETURN CODE OF 4        YS02019 99547002
RETCODE8 EQU   8                        RETURN CODE OF 8        YS02019 99548502
RETCODEC EQU   12                       RETURN CODE OF 12       YS02019 99550002
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY   YS02019 99551502
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE   YS02019 99553002
*                                       BIT                     YS02019 99553702
CZERO    EQU   0                        TO TEST FOR ZERO        YS02019 99554502
CONE     EQU   1                        CONSTANT OF 1           YS02019 99556002
CTWO     EQU   2                        CONSTANT OF 2           YS02019 99557502
CTHREE   EQU   3                        CONSTANT OF 3           YS02019 99559002
CFIFTEEN EQU   15                       CONSTANT OF 15          YS02019 99560502
CSIXTEEN EQU   16                       CONSTANT OF 16          YS02019 99562002
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'        YS02019 99563502
BLANK    EQU   X'40'                    TO TEST FOR BLANK       YS02019 99565002
OFF      EQU   X'FF'                    TO TURN BITS OFF        YS02019 99566502
         SPACE 3                                                YS02019 99593502
********                                                                99595002
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     99596502
********                                                                99598002
         USING *,RBASE                  BASE ADDRESSABILITY     YS02019 99607002
         USING CVT,RCVT                 CVT ADDRESSABILITY      YS02019 99608502
         USING TSB,RTSB                 TSB ADDRESSABILITY      YS02019 99622002
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY YS02019 99626502
         B     PASTID                   SKIP MODULE ID.         YS02019 99626902
         DC    C'IGG09406'              MODULE ID.              YS02019 99627302
         DC    X'3124'                  DATE - 05/04/73         YS02019 99627702
PASTID   EQU   *                                                YS02019 99627802
********                                                                99628002
******** CHECK FOR VALID PARAMETER                                      99629502
********                                                                99631002
         SLDL  RPARM0,L1                .CHECK                  YS02019 99632502
         LTR   RPARM1,RPARM1            .FOR                    YS02019 99634002
         BNZ   PARMBAD                  .VALID                  YS02019 99635502
         SRDL  RPARM0,L1                .PARAMETER IN RPARM1    YS02019 99637002
         LR    RWORK0,RLINK             SAVE RETURN ADDRESS     YS02019 99653502
         TM    TSBFLG4,TSBHUNG          HAS USER HUNG UP        YS02019 99661002
         BO    RETURN                   YES,RETURN TO CALLER    YS02019 99662502
********                                                                99686502
******** TEST FOR 1050 TERMINAL                                         99689502
********                                                                99691002
         TM    TSBTERM2,TSBC1050        IS TERMINAL A 1050      YS02019 99692502
         BO    TRMOK                    YES, CONTINUE           YS02019 99693202
         LA    RCODE,RETCODE8           SET INVALID TERMNL      YS02019 99746502
*                                       RETURN CODE             YS02019 99747202
         B     EXIT                     RETURN TO CALLER        YS02019 99748002
TRMOK    EQU   *                                                YS02019 99749502
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 99751002
         LTR   RPARM1,RPARM1            SET OR RESET TIMEOUT    YS02019 99751502
*                                       SUPPRESS                YS02019 99752002
         BNZ   TIMEOUT                  SET TIMEOUT             YS02019 99752502
         LA    RPARM1,MASKSET           GET MASKS TO SET        YS02019 99755502
         B     TPOST                    GO SET QCBINHBN         YS02019 99758502
TIMEOUT  EQU   *                                                YS02019 99759202
         LA    RPARM1,MASKRSET          GET MASKS TO RESET      YS02019 99761502
TPOST    EQU   *                                                YS02019 99761802
         L     R15,TPADDR               GET ENTRY POINT         YS02019 99762102
         BALR  R14,R15                  GO TPOST TSB            YS02019 99762402
RETURN   EQU   *                                                YS02019 99763002
         SR    RCODE,RCODE              SET GOOD RETURN CODE    YS02019 99764502
EXIT     EQU   *                                                YS02019 99766002
         MODESET EXTKEY=SUPR            GET KEY FOR SETLOCKS    YS02019 99766202
         LR    RLINK,RWORK0             RESTORE RETURN ADDR     YS02019 99768402
         BR    RLINK                    RETURN                  YS02019 99768702
PARMBAD  EQU   *                                                YS02019 99769002
         LA    RCODE,RETCODE4           SET BAD PARM RETURN CODEYS02019 99769702
         BR    RLINK                    RETURN TO SUPERVISOR    YS02019 99779502
         DS    0A                       FORCE ALIGNMENT         YS02019 99829502
MASKSET  DC    AL1(TSBPOSTO,0,0,0)      SET TSBPOSTO            YS02019 99901002
         DC    F'-1'                    NO RESETTING IN WORD 1  YS02019 99902502
         DC    AL1(QCBINHBN,QCBINHBN,0,0)  SET QCBINHBN         YS02019 99902802
         DC    F'-1'                    NO RESETTING IN WORD 2  YS02019 99903102
MASKRSET DC    AL1(TSBPOSTO,0,0,0)      SET TSBPOSTO            YS02019 99903402
         DC    F'-1'                    NO RESETTING IN WORD 1  YS02019 99903702
         DC    AL1(QCBINHBN,0,0,0)      ALTER QCBINHBN          YS02019 99904002
         DC    AL1(255,255-QCBINHBN,255,255)  RESET QCBINHBN    YS02019 99904702
TPADDR   DC    V(POSTTSB)               ADDR OF TPOSTING SUBRTN YS02019 99914702
PATCH    DC    10F'0'                   PATCH AREA              YS02019 99916702
CONSTANT DSECT                          DEFINES CONSTANTS IN 1STYS02019 99919002
*                                       CSECT                   YS02019 99919702
ZERO     DC    F'0'                     CONSTANT OF 0           YS02019 99920502
NINES    DC    F'99999999'              CONSTANT OF 99,999,999  YS02019 99922002
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15          YS02019 99923502
TWO      DC    XL1'02'                  CONSTANT OF 2           YS02019 99925002
TEN      DC    H'10'                    CONSTANT OF 10          YS02019 99926502
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16          YS02019 99929502
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS    YS02019 99931002
SIX      DC    H'6'                     CONSTANT OF 6           YS02019 99932502
EIGHT    DC    AL1(8)                   CONSTANT OF 8           YS02019 99934002
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR.   YS02019 99935502
*                                       PROMPT                  YS02019 99936202
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS YS02019 99937002
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. YS02019 99938502
*                                       PROMPT                  YS02019 99939202
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL       YS02019 99940002
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL            YS02019 99941502
ONE      DC    AL1(1)                   CONSTANT OF ONE         YS02019 99943002
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER     YA00364 99943402
FOX      EQU   ENABLE                   CONSTANT OF 'FF'        YS02019 99944502
DISABLE  EQU   ZERO                     TO DISABLE INTERRUPTS   YS02019 99946002
         EJECT                                                          99949002
CVT      DSECT                                                          99950502
         CVT                                                            99952002
         EJECT                                                          99955002
         IHAPSA                                                         99961002
         EJECT                                                          99967002
         TQCBD                                                          99973002
         EJECT                                                          99979002
         IKJTSB                                                         99985002
         END                                                            99991002
./  ADD  SSI=72870112,NAME=IGG09407
         TITLE 'IGG09407 - STCC ROUTINE'                                97105000
IGG09407 CSECT                                                          97110000
*********************************************************************** 97170000
*                                                                     * 97195000
* STATUS -                                                            * 97200000
*          A9861700-9861800                                   ZA26143 * 97202003
*    CHANGE LEVEL 01                                                  * 97205000
*                                                                     * 97210000
* FUNCTION -                                                          * 97215000
*    THIS ROUTINE IS TO SERVE THE MACRO 'STCC'. IT IS TO              * 97220000
*    CHANGE THE STCC BYTES IN TSB (TSBSTCC) TO REFLECT REQUEST OF THE * 97225000
*    MACRO.                                                           * 97230000
*                                                                     * 97235000
*    IF X'00' IS SPECIFIED AS LINE DELETE OR CHARACTER DELETE         * 97240000
*    CHARACTER, THE PREVIOUSLY USED CHARACTER IS RETAINED.  IN THIS   * 97245000
*    CASE, THE FORMER LINE DELETE CHARACTER IS PUT IN REG 0, THE      * 97250000
*    FORMER CHARACTER DELETE CHARACTER IS PUT IN REG 1.               * 97255000
*                                                                     * 97260000
*    IF X'FF' IS SPECIFIED, THE EDIT FUNCTION IS TERMINATED, AND      * 97265000
*    THE PROPER FIELD IS ZEROED OUT.                                  * 97270000
*                                                                     * 97275000
*    IF ATTENTION IS SPECIFIED FOR LINE DELETE, THE TSBATNLD BIT IN   * 97310000
*    TSBSTAT FIELD IS TURNED ON.                                      * 97315000
*                                                                     * 97320000
* ENTRY POINTS -                                                      * 97325000
*         IGG09407 - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 97330000
*         VIA BRANCH ACCORDING ENTRY CODE 7, HODLING THE LOCAL        * 97332002
*         AND THE CMS LOCKS, AND IN SUPERVISOR KEY                    * 97334002
*                                                                     * 97335000
* INPUT -                                                             * 97340000
*    REGISTER 0 CONTAINS PARAMETER                                    * 97370000
**********************************************************************  97371002
* ENTRY CODE     *                 *                 *               *  97372002
**********************************************************************  97373002
*    REGISTER 1 CONTAINS PARAMETER                                    * 97375000
**********************************************************************  97376002
* FLAG           *                 * LINE DELETE     * CHAR DELETE   *  97377002
**********************************************************************  97380002
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 97385000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 97390000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 97395002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS          97425002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                              97426002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            97427002
*                                                                     * 97430000
* OUTPUT -                                                            * 97435000
*    REGISTER 0 HAS THE FORMER LINE DELETE CHARACTER. X'FF' MEANS     * 97440000
*               THERE WAS NO FORMER LINE DELETE CHARACTER             * 97445000
*                                                                     * 97450000
*    REGISTER 1 HAS THE FORMER CHARACTER DELETE CHARACTER. X'FF' MEANS* 97455000
*               THERE WAS NO FORMER CHARACTER SELETE CHARACTER        * 97460000
*                                                                     * 97465000
*    REGISTER 15 HAS RETURN CODE:                                     * 97470000
*           0 - SUCCESSFUL                                            * 97475000
*           8 - CHARACTER REJECTED                                    * 97485000
*                                                                     * 97490000
* EXTERNAL REFERENCES -                                               * 97495000
*         NONE                                                        * 97500000
*                                                                     * 97505000
* EXITS, NORMAL -                                                     * 97510000
*         BR 14 WITH 0 IN REGISTER 15                                 * 97515002
*                                                                     * 97520000
* EXITS, ERROR -                                                      * 97525000
*         BR 14 WITH 4 OR 8 IN REGISTER 15                            * 97530002
*                                                                     * 97535000
* TABLES/WORK AREAS -                                                 * 97540000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 97545000
*                                                                     * 97550000
* ATTRIBUTES -                                                        * 97555000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, ENABLED                 * 97560000
*                                                                     * 97565000
* CHARACTER CODE DEPENDENCY -                                         * 97570000
*    THIS MODULE IS ASSEMBLED IN EBCDIC AND MUST BE REASSEMBLED IF    * 97575000
*    A DIFFERENT CHARACTER SET IS TO BE USED DURING EXECUTION         * 97580000
* NOTES -                                                             * 97585000
*    NONE                                                             * 97590000
*                                                                     * 97595000
*********************************************************************** 97600000
*                                                                     * 97605000
*********************************************************************** 97610000
         SPACE 3                                                        97615000
********                                                                97620000
******** REGISTER EQUATES                                               97625000
********                                                                97630000
RPARM0   EQU   0                        PARAMETER REG 0                 97635000
RWORK0   EQU   0                        WORK REGISTER                   97640000
RPARM1   EQU   1                        PARAMETER REG 1                 97645000
RWORK1   EQU   1                        WORK REGISTER                   97650000
RWORK2   EQU   2                        WORK REGISTER                   97655000
RWORK3   EQU   3                        WORK REGISTER                   97660000
RTSB     EQU   5                        POINTS TO TSB           YS02019 97695002
RBASE    EQU   6                        BASE REGISTER           YS02019 97755002
RWORK4   EQU   8                        WORK REGISTER           YS02019 97757002
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 97760002
*                                       CONSTANTS               YS02019 97761002
R12      EQU   12                       INTERFACE REGISTER      YS02019 97762002
R13      EQU   13                       REGISTER 13                     97765000
R14      EQU   14                       REGISTER 14                     97770000
RLINK    EQU   14                       LINK REGISTER                   97775000
R15      EQU   15                       REGISTER 15                     97785000
RBRANCH  EQU   15                       BRANCH REGISTER                 97790000
RCODE    EQU   15                       RETURN CODE REGISTER            97795000
         SPACE 2                                                        97800000
********                                                                97805000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           97810000
********                                                                97815000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         97820000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         97825000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         97830000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         97835000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      97840000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    97845000
D0       EQU   0                        DISPLACEMENT OF 0               97850000
D1       EQU   1                        DISPLACEMENT OF 1               97855000
D2       EQU   2                        DISPLACEMENT OF 2               97860000
D3       EQU   3                        DISPLACEMENT OF 3               97865000
D4       EQU   4                        DISPLACEMENT OF 4               97870000
D5       EQU   5                        DISPLACEMENT OF 5               97875000
D6       EQU   6                        DISPLACEMENT OF 6               97880000
D14      EQU   14                       DISPLACEMENT OF 14              97885000
L1       EQU   1                        LENGTH OF 1                     97890000
L2       EQU   2                        LENGTH OF 2                     97895000
L3       EQU   3                        LENGTH OF 3                     97900000
L4       EQU   4                        LENGTH OF 4                     97905000
L8       EQU   8                        LENGTH OF 8                     97910000
L16      EQU   16                       LENGTH OF 16                    97915000
L20      EQU   20                       LENGTH OF 20                    97920000
L24      EQU   24                       LENGTH OF 24                    97925000
L31      EQU   31                       LENGTH OF 31                    97930000
L32      EQU   32                       LENGTH OF 32                    97935000
RETCODE4 EQU   4                        RETURN CODE OF 4                97940000
RETCODE8 EQU   8                        RETURN CODE OF 8                97945000
RETCODEC EQU   12                       RETURN CODE OF 12               97950000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       97960000
CZERO    EQU   0                        TO TEST FOR ZERO                97965000
CONE     EQU   1                        CONSTANT OF 1                   97970000
CTWO     EQU   2                        CONSTANT OF 2                   97975000
CTHREE   EQU   3                        CONSTANT OF 3                   97980000
CFIFTEEN EQU   15                       CONSTANT OF 15                  97985000
CSIXTEEN EQU   16                       CONSTANT OF 16                  97990000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                97995000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               98015000
OFF      EQU   X'FF'                    TO TURN BITS OFF                98020000
EXIT     EQU   3                        TO INVOKE EXIT,SVC 3            98025000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         98030000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     98035000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 98040000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    98045000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    98050000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           98055000
         SPACE 3                                                        98100000
********                                                                98105000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     98110000
********                                                                98115000
         USING *,RBASE                  BASE ADDRESSABILITY             98140000
         LR    RBASE,R12                LOAD BASE REGISTER      YS02019 98145002
         B     MAIN                     BR AROUND ID AND DATE   YS02019 98147002
         DC    C'IGG09407'              MODULE ID               YS02019 98149002
         DC    X'3261'                  DATE - 09/18/73         YM03842 98151002
         USING TSB,RTSB                 TSB ADDRESSABILITY              98155000
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY         98195000
********                                                                98205002
******** MAIN FUNCTION OF ROUTINE - MODIFY LINE/CHAR DELETE CHARACTERS  98215002
********                                                                98225002
MAIN     EQU   *                                                YS02019 98245002
         LR    RWORK4,RLINK             SAVE RETURN ADDRESS     YS02019 98295002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 98370002
         SR    RCODE,RCODE              INITIALIZE RETURN CODE          98420000
         SR    RWORK0,RWORK0            CLEAR REGISTER                  98425000
         SR    RWORK2,RWORK2            CLEAR REGISTER                  98430000
         LR    RWORK3,RPARM1            PUT ENTRY PARMS IN WORK REG     98435000
         SR    RWORK1,RWORK1            CLEAR REGISTER                  98440000
         IC    RWORK0,TSBLNDCC          GET OLD LINE DEL CHAR           98445000
         LTR   RWORK0,RWORK0            WAS IT ZERO                     98450000
         BNZ   CHKOLDCD                 IF NOT, CHECK OLD CD CHAR       98455000
         LA    RWORK0,CFOX              YES,SET TO X'FF'                98460000
CHKOLDCD EQU   *                                                        98465000
         IC    RWORK1,TSBCHDCC          GET OLD CHAR DEL CHAR           98470000
         LTR   RWORK1,RWORK1            WAS OLD CH DEL CHAR ZERO        98475000
         BNZ   STORE                    NO,STORE NEW ONES               98480000
         LA    RWORK1,CFOX              YES,SET TO X'FF'                98485000
STORE    EQU   *                                                        98490000
         STH   RWORK3,TSBSTCC           STORE NEW LD/CD CHARS.   A111   98495000
********                                                                98500000
******** CHECK ATTENTION                                                98505000
********                                                                98510000
         TM    TSBSTAT,TSBATNLD         ATTN FOR LD ALREADY SET         98515000
         BZ    NOTON                    NO                              98520000
         ICM   RWORK0,BYTE1,HIGHBIT     INDICATE ATTN LD IN EFFECT      98555000
NOTON    EQU   *                                                        98565000
         SLDL  RWORK2,L1                GET FLAG BIT 0                  98570000
         LTR   RWORK2,RWORK2            IS IT 1                         98575000
         BZ    CHKLD1                   NO,1ST OP NOT SPECIF.    A111   98580000
         SR    RWORK2,RWORK2            CLEAR BIT                       98585000
         SLDL  RWORK2,L1                GET FLAG BIT 1                  98590000
         LTR   RWORK2,RWORK2            ATTN SPECIFIED                  98595000
         BZ    NATN                     NO,NATN                         98600000
ATTN     EQU   *                                                        98605000
         TM    TSBTERM1,TSBCATTN        DOES DEVICE HAVE FEATUREYS02019 98610002
         BO    SETATTN                  YES,GO SET FOR LD               98615000
         TM    TSBSTAT,TSB3270          IS THIS A 3270          ZA26143 98616003
         BO    SETATTN                  BRANCH YES              ZA26143 98617003
         LA    RCODE,RETCODE8           SET RETURN CODE OF 8            98620000
         B     CHKLD                    CHECK LINE DELETE               98625000
SETATTN  EQU   *                                                        98630000
         OI    TSBSTAT,TSBATNLD         TURN ON ATTN FOR LD             98635000
         B     CHKLD                    GO CHECK LD                     98640000
NATN     EQU   *                                                        98645000
         NI    TSBSTAT,OFF-TSBATNLD     TURN OFF ATTN FOR LD            98650000
********                                                                98655000
******** CHECK LINE DELETE CHARACTER                                    98660000
********                                                                98665000
CHKLD    EQU   *                                                        98670000
         SRL   RWORK3,L1                RESET FLAG BYTE          A111   98675000
CHKLD1   EQU   *                                                 A111   98680000
         SR    RWORK2,RWORK2            CLEAR BIT                       98685000
         SLDL  RWORK2,L2                GET FLAG BIT 2           A111   98690000
         LTR   RWORK2,RWORK2            LD CHAR. SPECIFIED              98695000
         BP    CKLDZERO                 YES,TEST IT                     98700000
LDZERO   EQU   *                                                        98705000
         STC   RWORK0,TSBLNDCC          RESTORE OLD LD CHAR             98710000
         CLI   TSBLNDCC,CFOX            WAS OLD LD ZERO                 98715000
         BNE   CHKCD                    NO,CHECK CD CHAR                98720000
         B     ZEROLDFD                 YES,RESET TO ZERO               98725000
CKLDZERO EQU   *                                                        98730000
         CLI   TSBLNDCC,CZERO           IS NEW LD ZERO                  98735000
         BNE   CKLDFOX                  NO,CHECK FOR X'FF'              98740000
         B     LDZERO                   NEW LD IS ZERO                  98745000
CKLDFOX  EQU   *                                                        98750000
         CLI   TSBLNDCC,CFOX            IS NEW LD FOX                   98755000
         BE    ZEROLDFD                 YES,SET TO ZERO                 98760000
CHKLDVLD EQU   *                                                        98765000
         CLI   TSBLNDCC,CR              IS NEW LD CARRIAGE RETURN CHAR. 98770000
         BE    LDREJECT                 SET REJECT CODE                 98775000
         CLI   TSBLNDCC,LF              WAS LINE FEED CHAR SPECIFIED    98780000
         BE    LDREJECT                 SET REJECT CODE                 98785000
         CLI   TSBLNDCC,NL              WAS NEW LINE CHAR. SPECIFIED    98790000
         BE    LDREJECT                 SET REJECT CODE                 98795000
         B     CHKCD                    GO CHECK CODE           YS02019 98840002
LDREJECT EQU   *                                                        98895000
         LA    RCODE,RETCODE8           SET RETURN CODE OF 8            98900000
ZEROLDFD EQU   *                                                        98905000
         MVI   TSBLNDCC,CZERO           ZERO FIELD                      98910000
********                                                                98915000
******** CHECK CHARACTER DELETE CHARACTER                               98920000
********                                                                98925000
CHKCD    EQU   *                                                        98930000
         SR    RWORK2,RWORK2            CLEAR BIT                       98935000
         SLDL  RWORK2,L1                GET FLAG BIT 3                  98940000
         LTR   RWORK2,RWORK2            CHAR. DELTE SPECIFIED           98945000
         BNZ   CHKMORE                  YES                             98950000
CDZERO   EQU   *                                                        98955000
         STC   RWORK1,TSBCHDCC          RESTORE OLD CD CHAR             98960000
         CLI   TSBCHDCC,CFOX            WAS OLD CD CHAR ZERO            98965000
         BE    ZEROCDFD                 YES,GO RESET TO ZERO            98970000
         B     RETURN                   NO,RETURN TO CALLER             98975000
CHKMORE  EQU   *                                                        98980000
         CLI   TSBCHDCC,CZERO           IS NEW CD ZERO                  98985000
         BNE   CHKCDFOX                 NO,CHECK FOR X'FF'              98990000
         B     CDZERO                   NEW CD CHAR IS ZERO             98995000
CHKCDFOX EQU   *                                                        99000000
         CLI   TSBCHDCC,CFOX            IS NEW CD CHAR. X'FF'           99005000
         BE    ZEROCDFD                 YES,RESET TO ZERO               99010000
CHKCDVLD EQU   *                                                        99015000
         CLI   TSBCHDCC,CR              IS NEW CD CARRIAGE RETURN       99020000
         BE    CDREJECT                 YES,INVALID                     99025000
         CLI   TSBCHDCC,NL              IS NEW CD NEW LINE CHAR.        99030000
         BE    CDREJECT                 YES,INVALID                     99035000
         CLI   TSBCHDCC,LF              IS NEW CD LINE FEED CHAR.       99040000
         BE    CDREJECT                 YES,INVALID                     99045000
         B     RETURN                   RETURN TO CALLER                99120000
CDREJECT EQU   *                                                        99125000
         LA    RCODE,RETCODE8           SET RETURN CODE OF 8            99130000
ZEROCDFD EQU   *                                                 A111   99135000
         MVI   TSBCHDCC,CZERO           SET TSBCHDCC TO X'00'    A111   99140000
RETURN   EQU   *                                                        99145000
         MODESET EXTKEY=SUPR            GET KEY FOR SETLOCKS    YS02019 99145802
*********************************************************************** 99146602
*        RELEASE CMS AND LOCAL LOCKS                                  * 99147402
*********************************************************************** 99148202
RELEASE  EQU   *                        LABEL FOR SETLOCK       YS02019 99149002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGC0009D)        YS02019 99150002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,IGC0009D)      YS02019 99151002
         LR    RLINK,RWORK4             RESTORE RETURN ADDR     YS02019 99153002
         BR    RLINK                    RETURN                  YS02019 99154002
         DC    9F'0'                    MAINTENANCE PATCH AREA  YS02019 99395002
         SPACE 3                                                        99445002
CONSTANT DSECT                          DEFINES CONSTANTS IN 1ST CSECT  99455000
ZERO     DC    F'0'                     CONSTANT OF 0                   99460000
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          99465000
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  99470000
TWO      DC    XL1'02'                  CONSTANT OF 2                   99475000
TEN      DC    H'10'                    CONSTANT OF 10                  99480000
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  99485000
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS            99490000
SIX      DC    H'6'                     CONSTANT OF 6                   99495000
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   99500000
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    99505000
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         99510000
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  99515000
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               99520000
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    99525000
ONE      DC    AL1(1)                   CONSTANT OF ONE                 99530000
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER     YA00364 99532002
FOX      EQU   ENABLE                   CONSTANT OF 'FF'                99535000
DISABLE  EQU   ZERO                     TO DISABLE INTERRUPTS           99540000
         EJECT                                                          99545002
         IHAPSA                                                         99555002
         EJECT                                                          99565002
         IKJTSB                                                         99580000
         END                                                            99895000
./  ADD  SSI=40820035,NAME=IGG09408
         TITLE 'IGG09408 - STATTN ROUTINE'                              90870000
IGG09408 CSECT                                                          90930000
         COPY  LCGASMS2                                                 90940002
*                                                                       90950000
*0000                                                            M5712  90970000
*                                                                M0252  90990000
*                                                                M4283  91010000
*                                                                 M4040 91030000
*                                                                 M5113 91050000
*                                                                 M4283 91070000
*                                                                 M5467 91090000
*                                                                       91110000
*********************************************************************** 91130000
*    RELEASE 23 DELETIONS/CHANGES                                     * 91150000
*    RELEASE 22 DELETIONS/CHANGES                                     * 91170000
*    RELEASE 21 DELETIONS/CHANGES                                     * 91190000
*                                                                     * 91210000
* STATUS -                                                            * 91230000
*    CHANGE LEVEL 01                                                  * 91250000
*                                                                     * 91270000
* FUNCTION -                                                          * 91290000
*    THIS ROUTINE IS TO SERVE THE MACRO 'STATTN'. IT IS TO PREPARE    * 91310000
*    DIFFERENT FIELDS IN TSB AND QCB TO REFLECT CONDITIONS WHICH THE  * 91330000
*    USER SPECIFIES WHEN SETTING ATTENTION SIMULATION.                * 91350000
*                                                                     * 91370000
*    THE VALUE SPECIFIED IN OPERANDS 'LINES' AND 'TENS' ARE MOVED INTO* 91390000
*    'TSBATNLC' AND 'TSBATNTC' LEFT JUSTIFIED. THE 2ND BYTE IN BOTH   * 91410000
*    FIELDS ARE NOT USED. 'INPUT CHARACTERS' IF SPECIFIED BY USER, IS * 91430000
*    MOVED INTO 'TSBATNCC'.                                           * 91450000
*                                                                     * 91470000
*    IF A FUNCTION IS CANCELLED, THAT IS, '0' IS SPECIFIED IN ANY     * 91490000
*    OF THE OPERAND, THE APPROPRIATE FIELD IN TSB IS ZEROED.          * 91510000
*                                                                     * 91530000
*    THE ATTENTION SIMULATION REQUESTED SWITCHES, 'TSBANR' IN THE TSB * 91550000
*    AND 'QCBSATCH', 'QCBSATTI', AND 'QCBSATLC' IN THE QCB ARE SET.   * 91570000
*                                                                     * 91590000
*    A RETURN CODE OF '00' INDICATES SUCCESSFUL COMPLETION OF THE     * 91610000
*    FUNCTION.                                                        * 91630000
*                                                                     * 91650000
* ENTRY POINTS -                                                      * 91670000
*         IGG09408 - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 91690000
*                                                                     * 91710000
* INPUT -                                                             * 91730000
*    REGISTER 0                                                       * 91750000
*    ****************************************************             * 91770000
*    * ENTRY CODE = 08 *             * LINES *   * TENS *               91790000
*    ****************************************************             * 91810000
*                                                                     * 91830000
*    REGISTER 1                                                       * 91850000
*    ****************************************************             * 91870000
*    *                      * INPUT CHARACTER ADDRESS   *             * 91890000
*    ****************************************************             * 91910000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 91930000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 91950000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 91970002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS          91990002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                              92030002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            92090002
*                                                                     * 92110000
* OUTPUT -                                                            * 92130000
*    REGISTER 15 HAS RETURN CODE:                                     * 92150000
*           0 - SUCCESSFUL                                            * 92170000
*                                                                     * 92190000
* EXTERNAL REFERENCES -                                               * 92210000
*         NONE                                                        * 92230000
*                                                                     * 92250000
* EXITS, NORMAL -                                                     * 92270000
*         BR 14 WITH 0 IN REGISTER 15                                 * 92290002
*                                                                     * 92310000
* EXITS, ERROR -                                                      * 92330000
*         NONE                                                        * 92350000
*                                                                     * 92370000
* TABLES/WORK AREAS -                                                 * 92390000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 92410000
*                                                                     * 92450000
* ATTRIBUTES -                                                        * 92470000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, AND ENABLED             * 92490002
*                                                                     * 92510000
* CHARACTER CODE DEPENDENCY -                                         * 92530000
*    THIS MODULE IS ASSEMBLED IN EBCDIC AND MUST BE REASSEMBLED IF    * 92550000
*    A DIFFERENT CHARACTER SET IS TO BE USED DURING EXECUTION         * 92570000
* NOTES -                                                             * 92590000
*    YM03948 - QCBSATTI NOT SET ON FIRST PASS TRU CODE                * 92610002
*                                                                     * 92630000
*********************************************************************** 92650000
         SPACE 3                                                        92670000
RPARM0   EQU   0                        PARAMETER REG 0                 92690000
RWORK0   EQU   0                        WORK REGISTER                   92710000
RPARM1   EQU   1                        PARAMETER REG 1                 92730000
RWORK1   EQU   1                        WORK REGISTER                   92750000
RWORK2   EQU   2                        WORK REGISTER                   92770000
RWORK3   EQU   3                        WORK REGISTER                   92790000
RRB      EQU   4                        POINTS TO RB            YS02019 92810002
RTCB     EQU   4                        POINTS TO TCB                   92870000
RTSB     EQU   5                        POINTS TO TSB           YS02019 92930002
RBASE    EQU   6                        BASE REGISTER           YS02019 92970002
RWORK4   EQU   9                        WORK REGISTER           YS02019 93090002
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 93190002
*                                       CONSTANTS               YS02019 93196002
R12      EQU   12                       INTERFACE REGISTER      YS02019 93202002
R13      EQU   13                       REGISTER 13                     93210000
R14      EQU   14                       REGISTER 14                     93230000
RLINK    EQU   14                       LINK REGISTER                   93250000
R15      EQU   15                       REGISTER 15                     93290000
RBRANCH  EQU   15                       BRANCH REGISTER                 93310000
RCODE    EQU   15                       RETURN CODE REGISTER            93330000
         SPACE 2                                                        93350000
********                                                                93370000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           93390000
********                                                                93410000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         93430000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         93450000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         93470000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         93490000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      93510000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    93530000
D0       EQU   0                        DISPLACEMENT OF 0               93550000
D1       EQU   1                        DISPLACEMENT OF 1               93570000
D2       EQU   2                        DISPLACEMENT OF 2               93590000
D3       EQU   3                        DISPLACEMENT OF 3               93610000
D4       EQU   4                        DISPLACEMENT OF 4               93630000
D5       EQU   5                        DISPLACEMENT OF 5               93650000
D6       EQU   6                        DISPLACEMENT OF 6               93670000
D14      EQU   14                       DISPLACEMENT OF 14              93690000
L1       EQU   1                        LENGTH OF 1                     93710000
L2       EQU   2                        LENGTH OF 2                     93730000
L3       EQU   3                        LENGTH OF 3                     93750000
L4       EQU   4                        LENGTH OF 4                     93770000
L8       EQU   8                        LENGTH OF 8                     93790000
L16      EQU   16                       LENGTH OF 16                    93810000
L20      EQU   20                       LENGTH OF 20                    93830000
L24      EQU   24                       LENGTH OF 24                    93850000
L31      EQU   31                       LENGTH OF 31                    93870000
L32      EQU   32                       LENGTH OF 32                    93890000
L34      EQU   34                       LENGTH OF 34             A111   93910000
RETCODE4 EQU   4                        RETURN CODE OF 4                93930000
RETCODE8 EQU   8                        RETURN CODE OF 8                93950000
RETCODEC EQU   12                       RETURN CODE OF 12               93970000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           93990000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       94010000
CZERO    EQU   0                        TO TEST FOR ZERO                94030000
CONE     EQU   1                        CONSTANT OF 1                   94050000
CTWO     EQU   2                        CONSTANT OF 2                   94070000
CTHREE   EQU   3                        CONSTANT OF 3                   94090000
CFIFTEEN EQU   15                       CONSTANT OF 15                  94110000
CSIXTEEN EQU   16                       CONSTANT OF 16                  94130000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                94150000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               94230000
OFF      EQU   X'FF'                    TO TURN BITS OFF                94250000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     94290000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 94310000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    94330000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    94350000
HEX20    EQU   X'20'                    USED TO TEST BIT 2 OF BYTE      94370000
         SPACE 3                                                        94550000
********                                                                94570000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     94590000
********                                                                94610000
         USING *,RBASE                  BASE ADDRESSABILITY             94730000
         LR    RBASE,R12                LOAD BASE REGISTER      YS02019 94740002
         USING TCB,RTCB                 TCB ADDRESSABILITY              94770000
         USING TSB,RTSB                 TSB ADDRESSABILITY              94810000
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY         94910000
         B     PASTID                   SKIP MODULE ID.         YS02019 94920002
         DC    C'IGG09408'              MODULE ID.              YS02019 94930002
         DC    X'4074'                  DATE - 03/15/74         YM08216 94940002
PASTID   EQU   *                                                YS02019 94942002
********                                                                94950000
******** MOVE USER DATA TO SVRB EXTENDED SAVE AREA                      94970002
********                                                                94990000
         L     RRB,TCBRBP               LOCATE SVRB             YS02019 95010002
         USING RBSECT,RRB               ADDRESSABILITY          YS02019 95030002
         STCM  RPARM1,BYTE1,RBEXSAVE+D4 SAVE FLAG BYTE                  95050000
         TM    RBEXSAVE+D4,HEX20        WAS INPUT ADDR. SPECIFIED       95070000
         BZ    MAIN                      NO                             95090000
         CLM   RPARM1,BYTE234,ZERO      WAS INPUT=NO SPECIFIED          95110000
         BE    MAIN                     YES,BRANCH                      95130000
         MVC   RBEXSAVE(L4),D0(RPARM1)  MOVE USER DATA                  95150000
         LA    RPARM1,RBEXSAVE          ADJUST PARM POINTER             95170000
         ICM   RPARM1,BYTE1,RBEXSAVE+D4 RESTORE FLAG BYTE               95190000
MAIN     EQU   *                                                        95290000
         ST    RLINK,RBXLINK            SAVE RETURN ADDRESS     YS02019 95310002
         MVC   RBXMASK,MASK             COPY TPOSTING MASK      YS02019 95350002
********                                                                95490000
******** CHECK LINES PARAMETER                                          95510000
********                                                                95530000
         SR    RWORK2,RWORK2            CLEAR WORK REG.                 95550000
         LR    RWORK3,RPARM1            PUT FLAG BYTE IN WORK REG.      95570000
         SLDL  RWORK2,L1                GET FIRST FLAG BIT              95590000
         LR    RLINK,RPARM0             GET LINES & TENS PARMS   A111   95610000
         LA    RLINK,D0(,RLINK)         ZERO HIGH ORDER BYTE     A111   95630000
         SRDL  RLINK,L8                 ISOLATE LINES IN LOW     A111   95650000
*                                       ORDER BYTE AND TENS IN          95670000
*                                       HIGH ORDER BYTE OF NXT REG      95690000
         LTR   RWORK2,RWORK2            LINES PARM SPECIFIED            95710000
         BZ    CKTENS                   NO,CHECK TENS PARM              95730000
         TM    TSBSTAT,TSBDSPLY         IS THIS A 2260/2265             95750000
         BO    CKTENS                   YES,IGNORE LINES PARM           95770000
         OI    RBXMSKF2,QCBSATLC        WILL ALTER QCBSATLC     YS02019 95780002
         LTR   RLINK,RLINK              WAS LINES=NO SPECIFIED   A111   95790000
         BZ    NOLINES                  YES,BRANCH                      95810000
         STC   RLINK,TSBATNLC+D1        NO,ST NEW ATN LINE COUNT A111   95830000
         OI    TSBFLG1,TSBANSR          TURN ON SIM. ATTN BIT IN TSB    95850000
         OI    RBXVALF2,QCBSATLC        TURN ON SIM. ATTN BY    YS02019 95870002
*                                       LINES                   YS02019 95880002
         B     CKTENS                   GO CHECK TENS PARM              95890000
NOLINES  EQU   *                                                        95910000
         XC    TSBATNLC,TSBATNLC        CLEAR LINE COUNT FIELD          95930000
         NI    RBXAVLF2,OFF-QCBSATLC    TURN OFF SIM. ATTN IN   YS02019 95950002
*                                       QCB                     YS02019 95960002
********                                                                95970000
******** CHECK TENS OF SECONDS PARAMETER                                95990000
********                                                                96010000
CKTENS   EQU   *                                                        96030000
         SR    RWORK2,RWORK2            CLEAR LAST BIT                  96050000
         SLDL  RWORK2,L1                GET FLAG BIT 2                  96070000
         LTR   RWORK2,RWORK2            WAS TENS PARM SPECIFIED         96090000
         BZ    CKADDR                   NO,CHECK INPUT ADDR PARM        96110000
         SRL   RBRANCH,L24              ISOLATE TENS IN LOW ORDR A111   96130000
         LTR   RBRANCH,RBRANCH          TENS=NO SPECIFIED        A111   96150000
         BZ    NOTENS                   YES,BRANCH                      96170000
         MH    RBRANCH,TEN              INTERVAL BY TEN          A111   96190000
         STH   RBRANCH,TSBATNTC         SET TENS COUNT IN TSB    A111   96210000
         OI    TSBFLG1,TSBANSR          SET SIM. ATTN IN TSB            96230000
         L     RBRANCH,TSBF2M           GET FIELDS TO UPDATE    YM03948 96240002
SWAP     EQU   *                                                YM03948 96250002
         LR    R14,RBRANCH              COPY FIELDS FOR SWAP    YM03948 96260002
         O     R14,SATTIM               TURN ON MASK AND VALUE  YM03948 96262002
         CS    RBRANCH,R14,TSBF2M       SWAP FIELDS FOR TPOST   YM03948 96264002
         BNE   SWAP                     IF FIELDS NOT EQUAL     YM03948 96266002
*                                       RESET REGS & TRY AGAIN  YM03948 96268002
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY       YM08216 96268402
         BO    CKADDR                   YES, SKIP DUMMY TPUT    YM08216 96268802
         OI    TSBFLG3,TSBSPIT          PREVENT AUTOPROMPTING           96270000
         LR    RWORK4,RPARM1            SAVE ADDR PARM                  96330000
         SETLOCK RELEASE,TYPE=CMS,REGS=USE,                     YS02019X96340002
               RELATED=(TSB,IGC0009D(GETLKS))                   YS02019 96342002
         SETLOCK RELEASE,TYPE=LOCAL,REGS=USE,                   YS02019X96344002
               RELATED=(TSB,IGC0009D(GETLKS))                   YS02019 96346002
         LA    RWORK0,L1                .ISSUE                          96350000
         LA    RWORK1,IDLE              TPUT OF IDLE CHARACTER   A111   96370000
         O     RWORK1,TPUT2             .TO SYNCHRONIZE                 96390000
         TPUT  (1),(0),R                .THE LINE                       96410000
OBTAIN   EQU   *                                                YS02019 96420002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=USE,        YS02019X96422002
               RELATED=(TSB,IGG09408(RELEASE))                  YS02019 96424002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,REGS=USE,          YS02019X96426002
               RELATED=(TSB,IGG09408(RELEASE))                  YS02019 96428002
         L     R15,CVTPTR               GET CVT ADDR            YS02019 96428402
         L     R15,CVTAQAVT-CVT(,R15)   GET TCX ADDR            YS02019 96428802
         LTR   R15,R15                  IS TCAM STILL ACTIVE    YS02019 96429202
         BZ    RELEASE                  NO, EXIT                YS02019 96429602
         L     R15,TCXRPT-IEDQTCX(,R15) GET TIOCRPT ADDR        YS02019 96429702
         LTR   R15,R15                  IS TIME SHARING ACTIVE  YS02019 96429802
         BZ    RELEASE                  NO, EXIT                YS02019 96429902
         LR    RPARM1,RWORK4            RESTORE ADDR PARM               96430000
         NI    TSBFLG3,OFF-TSBSPIT      ALLOW AUTOPROMPTING     YS02019 96450002
         B     CKADDR                   NO,GO CHECK ADDR. PARM          96590002
NOTENS   EQU   *                                                        96610000
         XC    TSBATNTC,TSBATNTC        CLEAR TIME COUNT FIELD          96630000
         OI    RBXMSKF2,QCBSATTI        WILL ALTER QCBSATTI     YM02882 96640002
         NI    RBXAVLF2,OFF-QCBSATTI    TURN OFF ATTN. BY TIME  YS02019 96650002
*                                       IN QCB                  YS02019 96660002
********                                                                96670000
******** CHECK SIM. ATTN BY CHAR. STRING ADDRESS                        96690000
********                                                                96710000
CKADDR   EQU   *                                                        96730000
         LR    RWORK3,RPARM1            RESET FLAG BYTE IN WORK REG.    96750000
         SLDL  RWORK2,L34               MOVE ADR BIT TO HI ORDR  A111   96770000
         SRL   RWORK2,L31               ISOLATE ADDR BIT & CLEAR A222   96790000
*                                       ALL OTHER BITS FOR SUBSE-       96810000
*                                       QUENT IC INSTRUCTION            96830000
         LTR   RWORK2,RWORK2            INPUT ADDR SPECIFIED            96850000
         BZ    RETURN                   NO ADDR SPECIFIED, RETRN A222   96870000
         OI    RBXMSKF2,QCBSATCH        WILL ALTER QCBSATCH     YS02019 96880002
         LA    RPARM1,D0(RPARM1)        CLEAR FLAG BYTE                 96890000
         LTR   RPARM1,RPARM1            INPUT=NO                        96910000
         BZ    NOINPUT                  YES,NO INPUT ADDR               96930000
         NI    TSBFLG2,OFF-TSBSATN1-TSBSATN2  RESET STRING LNGTH        96950000
         LA    RWORK3,D1(,RPARM1)        POINT TO 2ND BYTE OF STRING    96970000
         IC    RWORK2,TSBFLG2            PREPARE TO SET STRING LENGTH   96990000
         LA    RLINK,L1                 SET INCREMENT IN REGISTER       97010000
         LA    RBRANCH,D3(,RPARM1)      POINT TO END OF STRING          97030000
COMPARE  EQU   *                                                        97050000
         CLI   D0(RWORK3),BLANK          IS THIS CHAR. A BLANK          97070000
         BE    MOVE                     YES,MOVE STRING                 97090000
         ALR   RWORK2,RLINK              UPDATE STRING LENGTH COUNT     97110000
         BXLE  RWORK3,RLINK,COMPARE     CHECK NEXT CHARACTER            97130000
MOVE     EQU   *                                                        97150000
         STC   RWORK2,TSBFLG2            RESTORE UPDATED TSBFLG2        97170000
         MVC   TSBATNCC,D0(RPARM1)      MOVE STRING TO TSB              97190000
         OI    TSBFLG1,TSBANSR          SET SIM ATTN BIT                97210000
         OI    RBXVALF2,QCBSATCH        SET SIM ATTN BY CHAR    YS02019 97230002
*                                       STRING                  YS02019 97240002
         B     RETURN                   RETURN TO CALLER                97250000
NOINPUT  EQU   *                                                        97270000
         XC    TSBATNCC,TSBATNCC        CLEAR FIELD                     97290000
         NI    RBXAVLF2,OFF-QCBSATCH    TURN OFF ATTN BY CHAR   YS02019 97310002
*                                       STRING                  YS02019 97312002
********                                                                97314002
******** CALL POSTTSB SUBROUTINE TO TPOST THE TSB TO IEDAYP             97316002
*******  WHO WILL PERFORM THE REQUESTED BIT SETTING IN THE QCB          97318002
*******                                                                 97320002
*******        THE SUBROUTINE ALTERS REG.S 6 - 9                        97322002
*******                                                                 97324002
RETURN   EQU   *                                                        97330000
         NC    RBXMASK,RBXMASK          ANY NEED FOR TPOST TSB  YM02882 97333802
         BZ    RELEASE                  NO, RELEASE LOCKS       YM02882 97335802
*---------------------------------------------------------------------* 97338802
*   INPUT TO POSTTSB ROUTINE                                          * 97342602
*        REGISTER 1  = ADDRESS OF MASK FIELDS                         * 97346402
*        REGISTER 3  = CVT ADDRESS                                    * 97350202
*        REGISTER 5  = TSB ADDRESS                                    * 97354002
*        REGISTER 6-9 = WORK REGISTERS                                * 97357802
*---------------------------------------------------------------------* 97361602
         L     RWORK3,CVTPTR            ADDRESS OF CVT          YS02019 97365402
         LA    RPARM1,RBXMASK           ADDR OF TPOSTING MASK   YS02019 97369202
         L     R15,TPADDR               ADDR OF TPOSTING RTN    YS02019 97373002
         BALR  R14,R15                  GO TPOST TSB            YS02019 97376802
         DROP  RBASE                    ADDRESSABILITY ENDS     YS02019 97380602
*********************************************************************** 97384402
*        RELEASE CMS AND LOCAL LOCKS                                  * 97388202
*********************************************************************** 97392002
RELEASE  EQU   *                        SETLOCK LABEL           YS02019 97395802
         MODESET EXTKEY=SUPR            CHANGE TO KEY 0         YS02019 97399602
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGG09408(OBTAIN))YS02019 97403402
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,               YS02019,97407202
               IGG09408(OBTAIN))                                YS02019 97411002
         L     RLINK,RBXLINK            RESTORE RETURN ADDRESS  YS02019 97414802
         SR    RCODE,RCODE              SET GOOD RETURN CODE    YS02019 97418602
         BR    RLINK                    RETURN                  YS02019 97422402
MASK     DS    0F                                               YS02019 97426202
         DC    AL1(TSBPOSTO,0,0,0)      .POST                   YS02019 97430002
         DC    F'-1'                    .FLAGS                  YS02019 97530002
         DC    F'0'                     .FOR                    YS02019 97590002
         DC    F'-1'                    .TPOSTING QCB TO IEDAYP YS02019 97630002
SATTIM   DC    AL1(QCBSATTI,QCBSATTI,0,0) MASK AND VALUE FIELDS YM03948 97680002
PATCH    DC    9F'0'                    MAINTENANCE PATCH AREA  YS02019 97970002
CONSTANT DSECT                                                          97990000
ZERO     DC    F'0'                     CONSTANT OF 0                   98010000
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          98030000
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  98050000
TWO      DC    XL1'02'                  CONSTANT OF 2                   98070000
TEN      DC    H'10'                    CONSTANT OF 10                  98090000
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  98110000
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS            98130000
SIX      DC    H'6'                     CONSTANT OF 6                   98150000
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   98170000
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    98190000
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         98210000
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  98230000
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               98250000
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    98270000
ONE      DC    AL1(1)                   CONSTANT OF ONE                 98310000
IDLE     DC    X'17'                    TPUT IDLE CHARACTER     YA00364 98320002
FOX      EQU   ENABLE                   CONSTANT OF 'FF'                98330000
DISABLE  EQU   ZERO                     TO DISABLE INTERRUPTS           98350000
TPADDR   DC    V(POSTTSB)               ADDR OF TPOSTING RTN    YS02019 98370002
TPMASK   DS    4A                       TPOSTING MASK           YS02019 98376002
         EJECT                                                          98378002
CVT      DSECT                                                  YS02019 98380002
         CVT    ,                                               YS02019 98380402
         EJECT                                                          98382002
         IHAPSA                                                         98390002
         EJECT                                                          98400002
         TQCBD                                                          98430000
         EJECT                                                          98440002
         IKJRB                                                          98450000
********                                                                98451002
******** MAP USAGE OF EXTENDED SAVE AREA                                98452002
********                                                                98453002
         ORG   RBEXSAVE                 SET ORIGIN              YS02019 98454002
         DS    2F                       PARAMETER WORK AREA     YS02019 98455002
RBXLINK  DS    A                        SAVE RETURN ADDR        YS02019 98456002
RBXMASK  DS    0CL16                    TPOSTING MASKS          YS02019 98457002
         DS    A                        OR MASK - WORD 1        YS02019 98458002
         DS    A                        AND MASK - WORD 1       YS02019 98459002
RBXMSKF2 DS    X                        OR MASK - QCBTSOF2      YS02019 98460002
RBXVALF2 DS    X                        OR VALUE - QCBTSOF2     YS02019 98461002
         DS    H                        REST OF OR MASK         YS02019 98462002
         DS    X                        AND MASK - QCBTSOF2     YS02019 98470002
RBXAVLF2 DS    X                        AND VALUE - QCBTSOF2    YS02019 98474002
         DS    H                        REST OF AND MASK        YS02019 98478002
         EJECT                                                          98482002
         IKJTCB                                                         98486002
         EJECT                                                  YS02019 98488002
         TTCXD                                                  YS02019 98488402
         EJECT                                                          98490002
         IKJTSB                                                         98510000
         END                                                            98530000
./  ADD  SSI=33100031,NAME=IGG09409
         TITLE 'IGG09409 - STAUTOLN ROUTINE'                            93460000
         EJECT                                                          93462002
IGG09409 CSECT                                                          93470000
         COPY  LCGASMS2                                                 93472002
*********************************************************************** 93550000
*                                                                     * 93620000
* STATUS -                                                            * 93630000
*    CHANGE LEVEL 003                                                 * 93640000
*                                                                     * 93650000
* FUNCTION -                                                          * 93660000
*    THIS ROUTINE IS TO SERVE THE MACRO 'STAUTOLN'. IT PLACES THE     * 93670000
*    STARTING                                                         * 93680000
*    VALUE IN TSBAUTOS FIELD AND THE INCREMENT VALUE IN TSBAUTOI      * 93690000
*    FIELD. THE AUTOMATIC LINE NUMBERING BIT (TSBAULST) IS SET ON.    * 93700000
*    THE TSBAUTON AND QCBALN BITS ARE ALSO SET ON TO REFLECT AUTOMATIC* 93710000
*    PROMPT IS IN EFFECT. THE CHARACTER PROMPT BIT (TSBAUTOC) IS SET  * 93720000
*    OFF.                                                             * 93730000
*                                                                     * 93740000
*    AFTER INITIALIZATION FOR AUTOMATIC LINE NUMBERING, THE FIRST LINE* 93750000
*    NUMBER IS SENT TO THE TERMINAL VIA POSTING THE QCB AND INVOKE    * 93760000
*    TSOUTPUT                                                         * 93770000
*                                                                     * 93780000
* ENTRY POINTS -                                                      * 93790000
*         IGG09409 - CONTROL IS RECEIVED FROM MODULE IGC0009D         * 93800000
*                    VIA BRANCH, HOLDING THE LOCAL AND THE CMS        * 93802002
*                    LOCKS, AND IN SUPERVISOR KEY                     * 93804002
*                                                                     * 93810000
* INPUT -                                                             * 93820000
*    REGISTER 0 CONTAINS:                                             * 93830000
*    **********************************************************       * 93840000
*    *  ENTRY CODE  *   ADDRESS OF STARTING VALUE             *       * 93850000
*    **********************************************************       * 93860000
*    REGISTER 1 CONTAINS:                                             * 93870000
*    **********************************************************       * 93880000
*    *   FLAG       *   ADDRESS OF INCREMENT VALUE            *       * 93890002
*    **********************************************************       * 93900000
*    REGISTER 3 CONTAINS CVT ADDRESS                                  * 93910000
*    REGISTER 4 CONTAINS TCB ADDRESS                                  * 93920000
*    REGISTER 5 CONTAINS TSB ADDRESS                                  * 93930002
*    REGISTER 10 CONTAINS THE ADDRESS OF AN ARRAY OF CONSTANTS        * 93940002
*    REGISTER 12 CONTAINS THE BASE ADDRESS                            * 93990002
*    REGISTER 14 CONTAINS RETURN ADDRESS                              * 93995002
*                                                                     * 94000000
* OUTPUT -                                                            * 94010000
*    REGISTER 15 HAS RETURN CODE:                                     * 94020000
*           0 - SUCCESSFUL                                            * 94030000
*           4 - INVALID PARAMETER                                     * 94040000
*                                                                     * 94050000
* EXTERNAL REFERENCES -                                               * 94060000
*         NONE                                                        * 94070000
*                                                                     * 94080000
* EXITS, NORMAL -                                                     * 94090000
*         BR 14 WITH 0 IN REGISTER 15                                 * 94100002
*                                                                     * 94110000
* EXITS, ERROR -                                                      * 94120000
*         BR 14 WITH 4 IN REGISTER 15                                 * 94130002
*                                                                     * 94140000
* TABLES/WORK AREAS -                                                 * 94150000
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 94160000
*                                                                     * 94170000
* ATTRIBUTES -                                                        * 94180000
*    REENTRANT, REFRESHABLE, SUPERVISOR MODE, AND ENABLED             * 94190002
*                                                                     * 94200000
* CHARACTER CODE DEPENDENCY -                                         * 94210000
*    THIS MODULE IS NOT CHARACTER DEPENDENT                           * 94220000
* NOTES -                                                             * 94230000
*         VS01537 - REFERENCED USER CORE IN TCAMS' KEY,0C4            * 94240002
*                                                                     * 94250000
*********************************************************************** 94260000
         SPACE 3                                                        94270000
RPARM0   EQU   0                        PARAMETER REG 0                 94280000
RWORK0   EQU   0                        WORK REGISTER                   94290000
RPARM1   EQU   1                        PARAMETER REG 1                 94300000
RWORK1   EQU   1                        WORK REGISTER                   94310000
RWORK2   EQU   2                        WORK REGISTER                   94320000
RWORK3   EQU   3                        WORK REGISTER                   94330000
RCVT     EQU   3                        POINTS TO CVT                   94340000
RTCB     EQU   4                        POINTS TO TCB                   94370000
RTSB     EQU   5                        POINTS TO TSB           YS02019 94400002
RWORK6   EQU   6                        WORK REGISTER           YS02019 94480002
RCONST   EQU   10                       POINTS TO PROGRAM       YS02019 94530002
*                                       CONSTANTS               YS02019 94533002
RBASE    EQU   12                       BASE REGISTER           YS02019 94536002
R13      EQU   13                       REGISTER 13                     94540000
R14      EQU   14                       REGISTER 14                     94550000
RLINK    EQU   14                       LINK REGISTER                   94560000
R15      EQU   15                       REGISTER 15                     94580000
RBRANCH  EQU   15                       BRANCH REGISTER                 94590000
RCODE    EQU   15                       RETURN CODE REGISTER            94600000
         SPACE 2                                                        94610000
********                                                                94620000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           94630000
********                                                                94640000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         94650000
BYTE2    EQU   4                        MASK FOR BYTE 2 IN REG.         94660000
BYTE3    EQU   2                        MASK FOR BYTE 3 IN REG.         94670000
BYTE4    EQU   1                        MASK FOR BYTE 4 IN REG.         94680000
BYTE34   EQU   3                        MASK FOR BYTES 3&4 IN REG.      94690000
BYTE234  EQU   7                        MASK FOR BYTES 2&3&4 IN REG.    94700000
D0       EQU   0                        DISPLACEMENT OF 0               94710000
D1       EQU   1                        DISPLACEMENT OF 1               94720000
D2       EQU   2                        DISPLACEMENT OF 2               94730000
D3       EQU   3                        DISPLACEMENT OF 3               94740000
D4       EQU   4                        DISPLACEMENT OF 4               94750000
D5       EQU   5                        DISPLACEMENT OF 5               94760000
D6       EQU   6                        DISPLACEMENT OF 6               94770000
D14      EQU   14                       DISPLACEMENT OF 14              94780000
L1       EQU   1                        LENGTH OF 1                     94790000
L2       EQU   2                        LENGTH OF 2                     94800000
L3       EQU   3                        LENGTH OF 3                     94810000
L4       EQU   4                        LENGTH OF 4                     94820000
L8       EQU   8                        LENGTH OF 8                     94830000
L16      EQU   16                       LENGTH OF 16                    94840000
L20      EQU   20                       LENGTH OF 20                    94850000
L24      EQU   24                       LENGTH OF 24                    94860000
L31      EQU   31                       LENGTH OF 31                    94870000
L32      EQU   32                       LENGTH OF 32                    94880000
RETCODE4 EQU   4                        RETURN CODE OF 4                94890000
RETCODE8 EQU   8                        RETURN CODE OF 8                94900000
RETCODEC EQU   12                       RETURN CODE OF 12               94910000
HIPRI    EQU   X'E4'                    TCAM POSTING PRIORITY           94920000
COMPLETE EQU   X'40'                    TO TEST POST COMPLETE BIT       94930000
CZERO    EQU   0                        TO TEST FOR ZERO                94940000
CONE     EQU   1                        CONSTANT OF 1                   94950000
CTWO     EQU   2                        CONSTANT OF 2                   94960000
CTHREE   EQU   3                        CONSTANT OF 3                   94970000
CFIFTEEN EQU   15                       CONSTANT OF 15                  94980000
CSIXTEEN EQU   16                       CONSTANT OF 16                  94990000
CFOX     EQU   X'FF'                    TO TEST FOR 'FF'                95030000
BLANK    EQU   X'40'                    TO TEST FOR BLANK               95040000
OFF      EQU   X'FF'                    TO TURN BITS OFF                95050000
IDLE     EQU   X'17'                    TERM. CTL. CHAR. - IDLE         95070000
NL       EQU   X'15'                    TERM. CTL. CHAR. - NEW LINE     95080000
CR       EQU   X'0D'                    TERM. CTL. CHAR. - CARRIAGE RET 95090000
LF       EQU   X'25'                    TERM. CTL. CHAR. - LINE FEED    95100000
HEX18    EQU   X'18'                    TERM. CTL. CHAR. - TWX CHAR.    95110000
HEX20    EQU   X'20'                    TO TEST BIT 2 OF BYTE           95120000
         SPACE 3                                                        95210000
********                                                                95220000
******** ESTABLISH BASE REGISTER AND ADDRESSABILITY                     95230000
********                                                                95240000
         USING *,RBASE                  BASE REGISTER ADDRESSABILITY    95300000
         USING TSB,RTSB                 TSB ADDRESSABILITY              95320000
         USING CONSTANT,RCONST          CONSTANT ADDRESSABILITY         95390000
         B     VALID                    BRANCH AROUND MODULE ID YS02019 95392002
         DC    CL8'IGG09409'            MODULE NAME             YS02019 95394002
         DC    XL2'3304'                DATE 10/31/73           YA03021 95396002
********                                                                95400000
******** VALIDITY CHECK PARAMETERS                                      95410000
********                                                                95420000
VALID    EQU   *                                                        95430002
         LR    RWORK2,RWORK0            RESET PARM REGISTER     YS02019 95480002
         L     RWORK2,D0(,RWORK2)       GET STARTING VALUE      YS02019 95570002
         C     RWORK2,ZERO              TEST FOR NEGATIVE       YS02019 95580002
         BL    PARMBAD                  BAD PARAMETER                   95590000
         C     RWORK2,NINES             TEST FOR TOO HIGH       YS02019 95600002
         BH    PARMBAD                  TOO HIGH                        95610000
         L     RPARM1,D0(,RPARM1)       GET INCREMENT VALUE     YS02019 95620002
         C     RWORK1,ZERO              TEST FOR NEGATIVE       YS02019 95630002
         BL    PARMBAD                  BAD PARAMETER                   95640000
         C     RWORK1,NINES             TEST FOR TOO HIGH       YS02019 95650002
         BH    PARMBAD                  BAD PARAMETER                   95660000
********                                                                95670000
******** PERFORM MAIN FUNCTION OF ROUTINE                               95680000
********                                                                95690000
         LR    RWORK0,RLINK             SAVE RETURN ADDRESS     YS02019 95690602
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 95698402
         ST    RWORK2,TSBAUTOS          SET STARTING VALUE      YM01537 95708402
         ST    RPARM1,TSBAUTOI          SET INCREMENT VALUE     YM01537 95718402
         OI    TSBFLG2,TSBAUTON+TSBAULST+TSBSTAUT                       95720000
*                                       SIGNAL AUTOPROMPTING REQUESTED  95730000
*                                       AUTO LINE NUMBERING STARTED     95740000
*                                       THIS IS FIRST LINE NUMBER       95750000
         NI    TSBFLG2,OFF-TSBAUTOC     TURN OFF AUTO CHAR. PROMPT.     95760000
         NI    TSBFLG3,OFF-TSBSPIT      ALLOW PROMPTING         YA03021 95770002
********                                                                95810002
******** TPOST THE TSB IN ORDER TO SCHEDULE TSOUTPUT TO GET             95860002
******** CONTROL AND PUT OUT THE INITIAL LINE NUMBER                    95910002
********                                                                95960002
********       POSTTSB SUBROUTINE ALTERS REG.S 6-9                      96010002
********                                                                96060002
         TM    TSBFLG3,TSBTPUT          TSOUTPUT ALREADY        YS02019 96100002
*                                       SCHEDULED               YS02019 96103002
         BO    RETURN                   YES, NO NEED TO TPOST   YS02019 96106002
         OI    TSBFLG3,TSBTPUT          IND TPUT SCHEDULED      YS02019 96150002
*                                       YS0201                  YS02019 96155002
         LA    RPARM1,TPMASK            ADDR OF TPOSTING MASK   YS02019 96470002
         L     R15,TPADDR               ADDR OF TPOSTING RTN    YS02019 96520002
         L     RWORK3,CVTPTR            ADDR OF CVT             YS02019 96522002
         BALR  R14,R15                  GO TPOST TSB            YS02019 96525002
RETURN   EQU   *                                                        96530000
         MODESET EXTKEY=SUPR            GET KEY FOR SETLOCK     YS02019 96535002
         DROP  RBASE                    AS BASE REGISTER        YS02019 96540002
*********************************************************************** 96550002
*        RELEASE CMS AND LOCAL LOCKS                                  * 96560002
*********************************************************************** 96570002
RELEASE  EQU   *                        LABEL FOR SETLOCK       YS02019 96575002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGC0009D)        YS02019 96580002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,IGC0009D)      YS02019 96630002
         LR    RLINK,RWORK0             RESTORE RETURN ADDR     YS02019 96640002
         SR    RCODE,RCODE              SET GOOD RETURN CODE            96680000
         BR    RLINK                    RETURN                  YS02019 96685002
PARMBAD  EQU   *                                                        96700000
         LA    RCODE,RETCODE4           INDICATE BAD PARAMETERS         96710000
         BR    RLINK                    RETURN TO CALLER        YS02019 96720002
         DC    9F'0'                    MAINTENANCE PATCH AREA  YS02019 97010002
         SPACE 3                                                        97012002
CONSTANT DSECT                          DEFINES CONSTANTS IN 1ST CSECT  97020000
ZERO     DC    F'0'                     CONSTANT OF 0                   97030000
NINES    DC    F'99999999'              CONSTANT OF 99,999,999          97040000
FIFTEEN  DC    AL1(15)                  CONSTANT OF 15                  97050000
TWO      DC    XL1'02'                  CONSTANT OF 2                   97060000
TEN      DC    H'10'                    CONSTANT OF 10                  97070000
SIXTEEN  DC    AL1(16)                  CONSTANT OF 16                  97080000
ENABLE   DC    X'FF'                    TO ENABLE INTERRUPTS            97090000
SIX      DC    H'6'                     CONSTANT OF 6                   97100000
EIGHT    DC    AL1(8)                   CONSTANT OF 8                   97110000
CP5041   DC    XL3'026D16'              BKSP/UNDERSCORE CHAR. PROMPT    97120000
HIGHBIT  DC    XL1'80'                  TO TEST HIGH ORDER BITS         97130000
CPTWX    DC    XL3'024B0D'              PERIOD/CAR.RETURN CHAR. PROMPT  97140000
TPUT1    DC    XL4'0E000000'            TPUT,HOLD,CONTROL               97150000
TPUT2    DC    XL4'0A000000'            TPUT,CONTROL                    97160000
ONE      DC    AL1(1)                   CONSTANT OF ONE                 97170000
XIDLE    DC    X'17'                    TPUT IDLE CHARACTER     YA00364 97172002
FOX      EQU   ENABLE                   CONSTANT OF 'FF'                97180000
DISABLE  EQU   ZERO                     TO DISABLE INTERRUPTS           97190000
TPADDR   DC    V(POSTTSB)               ADDR OF TPOSTING RTN    YS02019 97193002
TPMASK   DS    4F                       TPOSTING MASK           YS02019 97196002
         EJECT                                                          97200002
         IHAPSA                                                         97250002
         EJECT                                                          97255002
         IKJTSB                                                         97260000
         EJECT                                                          97310002
         CVT                                                            97360002
         END                                                            97520000
./  ADD  SSI=80870684,NAME=IGG09411
         TITLE 'IGG09411, TSO/TCAM GTTERM MACRO SUPPORT MODULE         *00001000
                        '                                               00002000
IGG09411 CSECT                                                          00003000
         USING IGG09411,RBASE           ESTABLISH BASE ADDRESSABILITY   00004000
IGG09411 IEDHJN AFTERHJN,HJN                                            00005000
*                                                                  0010 00006000
*   /*****************************************************************/ 00007000
*   /*                                                               */ 00008000
*   /* PARAMETER REGISTER 1 MUST HAVE THE ADDRESS OF A TWO WORD PARM */ 00009000
*   /* LIST. IF THE FIRST WORD OF THE LIST IS 0, OR REG1 IS 0, RETURN*/ 00010000
*   /* CODE 12 IS ISSUED.                                            */ 00011000
*   /*                                                               */ 00012000
*   /*****************************************************************/ 00013000
*                                                                  0010 00014000
*   IF REG1=0|PRMSZEP=0 THEN                                       0010 00015000
         SLR   @04,@04                                             0010 00016000
         CR    REG1,@04                                            0010 00017000
         BE    @RT00010                                            0010 00018000
         C     @04,PRMSZEP(,REG1)                                  0010 00019000
         BNE   @RF00010                                            0010 00020000
@RT00010 DS    0H                                                  0011 00021000
*     RETCODE=CODE12;                                              0011 00022000
         LA    RETCODE,12                                          0011 00023000
*   ELSE                            /* PARAMETERS OKAY               */ 00024000
*     IF TSBDSPLY='0'B THEN         /* NOT A DISPLAY TERMINAL        */ 00025000
         B     @RC00010                                            0012 00026000
@RF00010 TM    TSBDSPLY(TSBPTR),B'00100000'                        0012 00027000
         BNZ   @RF00012                                            0012 00028000
*       RETCODE=CODE08;                                            0013 00029000
         LA    RETCODE,8                                           0013 00030000
*     ELSE                          /* A DISPLAY TERMINAL            */ 00031000
*                                                                  0014 00032000
*       /*************************************************************/ 00033000
*       /*                                                           */ 00034000
*       /* GET PRIMARY (DEFAULT) AND ALTERNATE SCREEN SIZES FROM THE */ 00035000
*       /* TSB AND PLACE IN USER'S AREA                              */ 00036000
*       /*                                                           */ 00037000
*       /*************************************************************/ 00038000
*                                                                  0014 00039000
*       DO;                                                        0014 00040000
         B     @RC00012                                            0014 00041000
@RF00012 DS    0H                                                  0015 00042000
*         RETCODE=CODE00;           /* SET GOOD RETURN CODE          */ 00043000
         SLR   RETCODE,RETCODE                                     0015 00044000
*         PRMROW=TSBPRMR;           /* GET PRIMARY ROW VALUE         */ 00045000
         L     @04,PRMSZEP(,REG1)                                  0016 00046000
         IC    @03,TSBPRMR(,TSBPTR)                                0016 00047000
         STC   @03,PRMROW(,@04)                                    0016 00048000
*         PRMCOL=TSBPRMC;           /* GET PRIMARY COL VALUE         */ 00049000
*                                                                  0017 00050000
         IC    @03,TSBPRMC(,TSBPTR)                                0017 00051000
         STC   @03,PRMCOL(,@04)                                    0017 00052000
*         /***********************************************************/ 00053000
*         /*                                                         */ 00054000
*         /* IF USER WANTS ALTERNATE SIZE, RETURN VALUE FROM TSB. IF */ 00055000
*         /* TSBALT SIZE IS ZERO, RETURN ALT EQUAL TO PRIMARY        */ 00056000
*         /*                                                         */ 00057000
*         /***********************************************************/ 00058000
*                                                                  0018 00059000
*         IF ALTSZEP=0             /* USER WANTS ALTERNATE          */ 00060000
*           THEN                                                   0018 00061000
         L     @04,ALTSZEP(,REG1)                                  0018 00062000
         LTR   @04,@04                                             0018 00063000
         BZ    @RF00018                                            0018 00064000
*           IF TSBALTR=0            /* IF NOT AVAILABLE -            */ 00065000
*             THEN                                                 0019 00066000
         CLI   TSBALTR(TSBPTR),0                                   0019 00067000
         BNE   @RF00019                                            0019 00068000
*             DO;                                                  0020 00069000
*               ALTROW=TSBPRMR;     /* SET ALTERNATE EQUAL TO        */ 00070000
         IC    @03,TSBPRMR(,TSBPTR)                                0021 00071000
         STC   @03,ALTROW(,@04)                                    0021 00072000
*               ALTCOL=TSBPRMC;     /* PRIMARY SIZES                 */ 00073000
         IC    @03,TSBPRMC(,TSBPTR)                                0022 00074000
         STC   @03,ALTCOL(,@04)                                    0022 00075000
*             END;                                                 0023 00076000
*           ELSE                                                   0024 00077000
*             DO;                                                  0024 00078000
         B     @RC00019                                            0024 00079000
@RF00019 DS    0H                                                  0025 00080000
*               ALTROW=TSBALTR;     /* RETURN ALTERNATE VALUES       */ 00081000
         L     @04,ALTSZEP(,REG1)                                  0025 00082000
         IC    @03,TSBALTR(,TSBPTR)                                0025 00083000
         STC   @03,ALTROW(,@04)                                    0025 00084000
*               ALTCOL=TSBALTC;                                    0026 00085000
         IC    @03,TSBALTC(,TSBPTR)                                0026 00086000
         STC   @03,ALTCOL(,@04)                                    0026 00087000
*             END;                                                 0027 00088000
*         ELSE                                                     0028 00089000
*           ;                                                      0028 00090000
@RF00018 DS    0H                                                  0029 00091000
*       END;                                                       0029 00092000
@RC00018 DS    0H                                                  0030 00093000
*                                                                  0030 00094000
*   /*****************************************************************/ 00095000
*   /*                                                               */ 00096000
*   /* RETURN TO CALLER                                              */ 00097000
*   /*                                                               */ 00098000
*   /*****************************************************************/ 00099000
*                                                                  0030 00100000
*   GEN CODE REFS(RLINK);                                          0030 00101000
@RC00012 DS    0H                                                  0030 00102000
@RC00010 DS    0H                                                  0030 00103000
          BR    RLINK                                                   00104000
*   END IGG09411                                                   0031 00105000
*                                                                  0031 00106000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00107000
*/*%INCLUDE SYSLIB  (IKJTSB  )                                       */ 00108000
*                                                                  0031 00109000
*       ;                                                          0031 00110000
@DATA    DS    0H                                                       00111000
@DATD    DSECT                                                          00112000
         DS    0F                                                       00113000
IGG09411 CSECT                                                          00114000
         DS    0F                                                       00115000
@DATD    DSECT                                                          00116000
         DS    0D                                                       00117000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00118000
@ENDDATD EQU   *                                                        00119000
IGG09411 CSECT                                                          00120000
         DS    0F                                                       00121000
@SIZDATD DC    AL1(0)                                                   00122000
         DC    AL3(@ENDDATD-@DATD)                                      00123000
         DS    0D                                                       00124000
PATCH    DS    CL50                                                     00125000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00126000
@01      EQU   01                                                       00127000
@02      EQU   02                                                       00128000
@03      EQU   03                                                       00129000
@04      EQU   04                                                       00130000
@05      EQU   05                                                       00131000
@06      EQU   06                                                       00132000
@07      EQU   07                                                       00133000
@08      EQU   08                                                       00134000
@09      EQU   09                                                       00135000
@10      EQU   10                                                       00136000
@11      EQU   11                                                       00137000
@12      EQU   12                                                       00138000
@13      EQU   13                                                       00139000
@14      EQU   14                                                       00140000
@15      EQU   15                                                       00141000
RBASE    EQU   @12                                                      00142000
REG1     EQU   @01                                                      00143000
REG2     EQU   @02                                                      00144000
TSBPTR   EQU   @05                                                      00145000
RLINK    EQU   @14                                                      00146000
RETCODE  EQU   @15                                                      00147000
INPARMS  EQU   0                                                        00148000
PRMSZEP  EQU   INPARMS                                                  00149000
ALTSZEP  EQU   INPARMS+4                                                00150000
PRMSZE   EQU   0                                                        00151000
PRMROW   EQU   PRMSZE                                                   00152000
PRMCOL   EQU   PRMSZE+1                                                 00153000
ALTSZE   EQU   0                                                        00154000
ALTROW   EQU   ALTSZE                                                   00155000
ALTCOL   EQU   ALTSZE+1                                                 00156000
TSB      EQU   0                                                        00157000
TSBASCBA EQU   TSB                                                      00158000
TSBSTAT  EQU   TSBASCBA                                                 00159000
TSBDSPLY EQU   TSBSTAT                                                  00160000
TSBFLG1  EQU   TSB+4                                                    00161000
TSBFLG2  EQU   TSB+16                                                   00162000
TSBFLG3  EQU   TSB+24                                                   00163000
TSBFLG5  EQU   TSB+25                                                   00164000
TSBTERMC EQU   TSB+26                                                   00165000
TSBTERM1 EQU   TSBTERMC                                                 00166000
TSBTERM2 EQU   TSBTERMC+1                                               00167000
TSBSTCC  EQU   TSB+34                                                   00168000
TSBFLG4  EQU   TSB+41                                                   00169000
TSBRCB   EQU   TSB+64                                                   00170000
TSBLINKA EQU   TSBRCB+4                                                 00171000
TSBTPOST EQU   TSB+72                                                   00172000
TSBTPFLG EQU   TSBTPOST                                                 00173000
TSBMINL  EQU   TSB+84                                                   00174000
TSBPRMR  EQU   TSB+100                                                  00175000
TSBPRMC  EQU   TSB+101                                                  00176000
TSBALTR  EQU   TSB+102                                                  00177000
TSBALTC  EQU   TSB+103                                                  00178000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00179000
TSBEND   EQU   TSB+120                                                  00180000
TSBSF1   EQU   TSB+112                                                  00181000
TSBTRMID EQU   TSB+104                                                  00182000
TSBEXTNT EQU   TSB+96                                                   00183000
TSBPSWD  EQU   TSB+88                                                   00184000
TSBLECB  EQU   TSBMINL                                                  00185000
TSBLINE  EQU   TSB+82                                                   00186000
TSBSTAX  EQU   TSB+81                                                   00187000
TSBATTNC EQU   TSB+80                                                   00188000
TSBF1V   EQU   TSBTPOST+7                                               00189000
TSBF1M   EQU   TSBTPOST+6                                               00190000
TSBF2V   EQU   TSBTPOST+5                                               00191000
TSBF2M   EQU   TSBTPOST+4                                               00192000
TSBFLAGV EQU   TSBTPOST+3                                               00193000
TSBFLAGM EQU   TSBTPOST+2                                               00194000
@NM00015 EQU   TSBTPOST+1                                               00195000
@NM00014 EQU   TSBTPFLG                                                 00196000
@NM00013 EQU   TSBTPFLG                                                 00197000
@NM00012 EQU   TSBTPFLG                                                 00198000
@NM00011 EQU   TSBTPFLG                                                 00199000
TSBNEWID EQU   TSBTPFLG                                                 00200000
TSBTPAYI EQU   TSBTPFLG                                                 00201000
TSBTPQCB EQU   TSBTPFLG                                                 00202000
TSBPOSTO EQU   TSBTPFLG                                                 00203000
TSBLINKB EQU   TSBLINKA+1                                               00204000
TSBPRI   EQU   TSBLINKA                                                 00205000
TSBRQCB  EQU   TSBRCB                                                   00206000
TSBCTCB  EQU   TSB+60                                                   00207000
TSBERSDS EQU   TSB+56                                                   00208000
TSBAUTOI EQU   TSB+52                                                   00209000
TSBAUTOS EQU   TSB+48                                                   00210000
TSBATNCC EQU   TSB+44                                                   00211000
TSBASRCE EQU   TSB+42                                                   00212000
TSBHLDL  EQU   TSBFLG4                                                  00213000
TSBGETBF EQU   TSBFLG4                                                  00214000
TSBCANC  EQU   TSBFLG4                                                  00215000
TSBHOLD  EQU   TSBFLG4                                                  00216000
TSBHUNG  EQU   TSBFLG4                                                  00217000
TSBOWAIT EQU   TSBFLG4                                                  00218000
TSBIWAIT EQU   TSBFLG4                                                  00219000
TSBOCAB  EQU   TSBFLG4                                                  00220000
TSBLNNO  EQU   TSB+40                                                   00221000
TSBATNTC EQU   TSB+38                                                   00222000
TSBATNLC EQU   TSB+36                                                   00223000
TSBCHDCC EQU   TSBSTCC+1                                                00224000
TSBLNDCC EQU   TSBSTCC                                                  00225000
TSBWTJID EQU   TSB+32                                                   00226000
TSBECB   EQU   TSB+28                                                   00227000
TSBC1050 EQU   TSBTERM2                                                 00228000
@NM00010 EQU   TSBTERM2                                                 00229000
@NM00009 EQU   TSBTERM2                                                 00230000
@NM00008 EQU   TSBTERM2                                                 00231000
@NM00007 EQU   TSBTERM2                                                 00232000
TSBCTWX  EQU   TSBTERM2                                                 00233000
@NM00006 EQU   TSBTERM2                                                 00234000
@NM00005 EQU   TSBTERM2                                                 00235000
@NM00004 EQU   TSBTERM1                                                 00236000
@NM00003 EQU   TSBTERM1                                                 00237000
@NM00002 EQU   TSBTERM1                                                 00238000
TSBC2741 EQU   TSBTERM1                                                 00239000
TSBC5041 EQU   TSBTERM1                                                 00240000
TSBCATTN EQU   TSBTERM1                                                 00241000
TSBCBRK  EQU   TSBTERM1                                                 00242000
TSBCIHBN EQU   TSBTERM1                                                 00243000
TSBVTAM  EQU   TSBFLG5                                                  00244000
TSBKEYS  EQU   TSBFLG5                                                  00245000
@NM00001 EQU   TSBFLG5                                                  00246000
TSBSPF   EQU   TSBFLG5                                                  00247000
TSBATMP  EQU   TSBFLG5                                                  00248000
TSBNFLOP EQU   TSBFLG3                                                  00249000
TSBNOBRK EQU   TSBFLG3                                                  00250000
TSBTPUT  EQU   TSBFLG3                                                  00251000
TSBAWOIP EQU   TSBFLG3                                                  00252000
TSBNBKSP EQU   TSBFLG3                                                  00253000
TSBSPIT  EQU   TSBFLG3                                                  00254000
TSBTJMSG EQU   TSBFLG3                                                  00255000
TSBATTN  EQU   TSBFLG3                                                  00256000
TSBIBFP  EQU   TSB+21                                                   00257000
TSBNIBF  EQU   TSB+20                                                   00258000
TSBITBFP EQU   TSB+17                                                   00259000
TSBSATN2 EQU   TSBFLG2                                                  00260000
TSBSATN1 EQU   TSBFLG2                                                  00261000
TSBSTAUT EQU   TSBFLG2                                                  00262000
TSBAUTOC EQU   TSBFLG2                                                  00263000
TSBAULST EQU   TSBFLG2                                                  00264000
TSBBRKIN EQU   TSBFLG2                                                  00265000
TSBAUTON EQU   TSBFLG2                                                  00266000
TSBBIPI  EQU   TSBFLG2                                                  00267000
TSBOBFP  EQU   TSB+13                                                   00268000
TSBNOBF  EQU   TSB+12                                                   00269000
TSBOTBFP EQU   TSB+9                                                    00270000
TSBLNSZ  EQU   TSB+8                                                    00271000
TSBWTCB  EQU   TSB+5                                                    00272000
TSBTJBF  EQU   TSBFLG1                                                  00273000
TSBTJIP  EQU   TSBFLG1                                                  00274000
TSBTJOW  EQU   TSBFLG1                                                  00275000
TSBIFLSH EQU   TSBFLG1                                                  00276000
TSBWOWIP EQU   TSBFLG1                                                  00277000
TSBOWIP  EQU   TSBFLG1                                                  00278000
TSBOFLSH EQU   TSBFLG1                                                  00279000
TSBANSR  EQU   TSBFLG1                                                  00280000
TSBASCB  EQU   TSBASCBA+1                                               00281000
TSBATNLD EQU   TSBSTAT                                                  00282000
TSB3270  EQU   TSBSTAT                                                  00283000
TSBDISC  EQU   TSBSTAT                                                  00284000
TSBITOFF EQU   TSBSTAT                                                  00285000
TSBNOBUF EQU   TSBSTAT                                                  00286000
TSBLWAIT EQU   TSBSTAT                                                  00287000
TSBINUSE EQU   TSBSTAT                                                  00288000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00289000
@RC00019 EQU   @RC00018                                                 00290000
@ENDDATA EQU   *                                                        00291000
         END   IGG09411,(C'PLS1930',0701,78087)                         00292000
./  ADD  SSI=72410258,NAME=IGG09414
         TITLE '********  IGG09414:  STTMPMD - TERMINAL CONTROL ROUTINE*00001000
               E  ******'                                               00002000
IGG09414 CSECT ,                                                   0001 00003000
@MAINENT BALR  @15,0                                               0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IGG09414  77.241'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  BALR  @12,0                                               0001 00010000
@PSTART  DS    0H                                                  0001 00011000
         USING @PSTART,@12                                         0001 00012000
*                                      BOUNDARY              @ZA16607*/ 00013000
*                                                                  0006 00014000
*   /*****************************************************************/ 00015000
*   /*                                                               */ 00016000
*   /* SHIFT OUT PARAMETER BIT. IF REMAINING BITS ARE NOT ZERO RETURN*/ 00017000
*   /* CODE 4 IS ISSUED.                                             */ 00018000
*   /*                                                               */ 00019000
*   /*****************************************************************/ 00020000
*                                                                  0006 00021000
*   SLDL(RPARM0,SHIFT2);            /* SHIFT OUT PARM BITS           */ 00022000
         SLDL  RPARM0,2                                            0006 00023000
*   IF RPARM1=0 THEN               /* INVALID - RETURN CODE 4       */ 00024000
         LTR   RPARM1,RPARM1                                       0007 00025000
         BZ    @RF00007                                            0007 00026000
*     RETCODE=CODE04;                                              0008 00027000
         LA    RETCODE,4                                           0008 00028000
*   ELSE                                                           0009 00029000
*                                                                  0009 00030000
*     /***************************************************************/ 00031000
*     /*                                                             */ 00032000
*     /* IF THE TERMINAL IS NOT A DISPLAY TERMINAL, THE INVALID      */ 00033000
*     /* TERMINAL IS NOTED WITH RETURN CODE 8                        */ 00034000
*     /*                                                             */ 00035000
*     /***************************************************************/ 00036000
*                                                                  0009 00037000
*     IF TSBDSPLY='0'B THEN                                        0009 00038000
         B     @RC00007                                            0009 00039000
@RF00007 TM    TSBDSPLY(TSBPTR),B'00100000'                        0009 00040000
         BNZ   @RF00009                                            0009 00041000
*       RETCODE=CODE08;                                            0010 00042000
         LA    RETCODE,8                                           0010 00043000
*     ELSE                                                         0011 00044000
*                                                                  0011 00045000
*       /*************************************************************/ 00046000
*       /*                                                           */ 00047000
*       /* THE PARAMETER BITS ARE RESTORED. PROCESSING OCCURS FOR THE*/ 00048000
*       /* INDIVIDUAL PARAMETER BITS                                 */ 00049000
*       /*                                                           */ 00050000
*       /*************************************************************/ 00051000
*                                                                  0011 00052000
*       DO;                                                        0011 00053000
         B     @RC00009                                            0011 00054000
@RF00009 DS    0H                                                  0012 00055000
*         SRDL(RPARM0,SHIFT2);      /* RESTORE PARM BITS             */ 00056000
         SRDL  RPARM0,2                                            0012 00057000
*         RETCODE=CODE00;           /* SET GOOD RETURN CODE          */ 00058000
         SLR   RETCODE,RETCODE                                     0013 00059000
*         IF RFIX1<0 THEN           /* IF MODE ON IS SPECIFIED       */ 00060000
         LTR   RFIX1,RFIX1                                         0014 00061000
         BNM   @RF00014                                            0014 00062000
*           TSBATMP='1'B;           /* SET TERMINAL CONTROLER MODE   */ 00063000
         OI    TSBATMP(TSBPTR),B'10000000'                         0015 00064000
*         ELSE                      /* IF MODE OFF IS SPECIFIED      */ 00065000
*           TSBATMP='0'B;           /* RESET TERM. CONTROLER MODE    */ 00066000
         B     @RC00014                                            0016 00067000
@RF00014 NI    TSBATMP(TSBPTR),B'01111111'                         0016 00068000
*         SLL(RPARM1,SHIFT1);       /* PUT KEYS BIT IN SIGN BIT      */ 00069000
@RC00014 SLL   RPARM1,1                                            0017 00070000
*         IF RFIX1<0 THEN           /* IF KEYS=ALL WAS SPECIFIED     */ 00071000
         LTR   RFIX1,RFIX1                                         0018 00072000
         BNM   @RF00018                                            0018 00073000
*           TSBKEYS='1'B;           /* SET TSBKEYS                   */ 00074000
         OI    TSBKEYS(TSBPTR),B'00000010'                         0019 00075000
*         ELSE                      /* IF KEYS=NO WAS SPECIFIED      */ 00076000
*           TSBKEYS='0'B;           /* RESET TSBKEYS                 */ 00077000
         B     @RC00018                                            0020 00078000
@RF00018 NI    TSBKEYS(TSBPTR),B'11111101'                         0020 00079000
*       END;                        /* END OF MODE PROCESSING        */ 00080000
*   END IGG09414                                                   0022 00081000
*                                                                  0022 00082000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00083000
*/*%INCLUDE SYSLIB  (IKJTSB  )                                       */ 00084000
*                                                                  0022 00085000
*       ;                                                          0022 00086000
@EL00001 DS    0H                                                  0022 00087000
@EF00001 DS    0H                                                  0022 00088000
@ER00001 BR    @14                                                 0022 00089000
@DATA    DS    0H                                                       00090000
@DATD    DSECT                                                          00091000
         DS    0F                                                       00092000
IGG09414 CSECT                                                          00093000
         DS    0F                                                       00094000
@DATD    DSECT                                                          00095000
         DS    0D                                                       00096000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00097000
@ENDDATD EQU   *                                                        00098000
IGG09414 CSECT                                                          00099000
         DS    0F                                                       00100000
@SIZDATD DC    AL1(0)                                                   00101000
         DC    AL3(@ENDDATD-@DATD)                                      00102000
         DS    0D                                                       00103000
PATCH    DC    13F'0'                                                   00104000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00105000
@01      EQU   01                                                       00106000
@02      EQU   02                                                       00107000
@03      EQU   03                                                       00108000
@04      EQU   04                                                       00109000
@05      EQU   05                                                       00110000
@06      EQU   06                                                       00111000
@07      EQU   07                                                       00112000
@08      EQU   08                                                       00113000
@09      EQU   09                                                       00114000
@10      EQU   10                                                       00115000
@11      EQU   11                                                       00116000
@12      EQU   12                                                       00117000
@13      EQU   13                                                       00118000
@14      EQU   14                                                       00119000
@15      EQU   15                                                       00120000
RPARM0   EQU   @00                                                      00121000
RPARM1   EQU   @01                                                      00122000
RFIX1    EQU   @01                                                      00123000
TSBPTR   EQU   @05                                                      00124000
RLINK    EQU   @14                                                      00125000
RETCODE  EQU   @15                                                      00126000
TSB      EQU   0                                                        00127000
TSBASCBA EQU   TSB                                                      00128000
TSBSTAT  EQU   TSBASCBA                                                 00129000
TSBDSPLY EQU   TSBSTAT                                                  00130000
TSBFLG1  EQU   TSB+4                                                    00131000
TSBFLG2  EQU   TSB+16                                                   00132000
TSBFLG3  EQU   TSB+24                                                   00133000
TSBFLG5  EQU   TSB+25                                                   00134000
TSBATMP  EQU   TSBFLG5                                                  00135000
TSBKEYS  EQU   TSBFLG5                                                  00136000
TSBTERMC EQU   TSB+26                                                   00137000
TSBTERM1 EQU   TSBTERMC                                                 00138000
TSBTERM2 EQU   TSBTERMC+1                                               00139000
TSBSTCC  EQU   TSB+34                                                   00140000
TSBFLG4  EQU   TSB+41                                                   00141000
TSBRCB   EQU   TSB+64                                                   00142000
TSBLINKA EQU   TSBRCB+4                                                 00143000
TSBTPOST EQU   TSB+72                                                   00144000
TSBTPFLG EQU   TSBTPOST                                                 00145000
TSBMINL  EQU   TSB+84                                                   00146000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00147000
TSBEND   EQU   TSB+120                                                  00148000
TSBSF1   EQU   TSB+112                                                  00149000
TSBTRMID EQU   TSB+104                                                  00150000
@NM00016 EQU   TSB+100                                                  00151000
TSBEXTNT EQU   TSB+96                                                   00152000
TSBPSWD  EQU   TSB+88                                                   00153000
TSBLECB  EQU   TSBMINL                                                  00154000
TSBLINE  EQU   TSB+82                                                   00155000
TSBSTAX  EQU   TSB+81                                                   00156000
TSBATTNC EQU   TSB+80                                                   00157000
TSBF1V   EQU   TSBTPOST+7                                               00158000
TSBF1M   EQU   TSBTPOST+6                                               00159000
TSBF2V   EQU   TSBTPOST+5                                               00160000
TSBF2M   EQU   TSBTPOST+4                                               00161000
TSBFLAGV EQU   TSBTPOST+3                                               00162000
TSBFLAGM EQU   TSBTPOST+2                                               00163000
@NM00015 EQU   TSBTPOST+1                                               00164000
@NM00014 EQU   TSBTPFLG                                                 00165000
@NM00013 EQU   TSBTPFLG                                                 00166000
@NM00012 EQU   TSBTPFLG                                                 00167000
@NM00011 EQU   TSBTPFLG                                                 00168000
TSBNEWID EQU   TSBTPFLG                                                 00169000
TSBTPAYI EQU   TSBTPFLG                                                 00170000
TSBTPQCB EQU   TSBTPFLG                                                 00171000
TSBPOSTO EQU   TSBTPFLG                                                 00172000
TSBLINKB EQU   TSBLINKA+1                                               00173000
TSBPRI   EQU   TSBLINKA                                                 00174000
TSBRQCB  EQU   TSBRCB                                                   00175000
TSBCTCB  EQU   TSB+60                                                   00176000
TSBERSDS EQU   TSB+56                                                   00177000
TSBAUTOI EQU   TSB+52                                                   00178000
TSBAUTOS EQU   TSB+48                                                   00179000
TSBATNCC EQU   TSB+44                                                   00180000
TSBASRCE EQU   TSB+42                                                   00181000
TSBHLDL  EQU   TSBFLG4                                                  00182000
TSBGETBF EQU   TSBFLG4                                                  00183000
TSBCANC  EQU   TSBFLG4                                                  00184000
TSBHOLD  EQU   TSBFLG4                                                  00185000
TSBHUNG  EQU   TSBFLG4                                                  00186000
TSBOWAIT EQU   TSBFLG4                                                  00187000
TSBIWAIT EQU   TSBFLG4                                                  00188000
TSBOCAB  EQU   TSBFLG4                                                  00189000
TSBLNNO  EQU   TSB+40                                                   00190000
TSBATNTC EQU   TSB+38                                                   00191000
TSBATNLC EQU   TSB+36                                                   00192000
TSBCHDCC EQU   TSBSTCC+1                                                00193000
TSBLNDCC EQU   TSBSTCC                                                  00194000
TSBWTJID EQU   TSB+32                                                   00195000
TSBECB   EQU   TSB+28                                                   00196000
TSBC1050 EQU   TSBTERM2                                                 00197000
@NM00010 EQU   TSBTERM2                                                 00198000
@NM00009 EQU   TSBTERM2                                                 00199000
@NM00008 EQU   TSBTERM2                                                 00200000
@NM00007 EQU   TSBTERM2                                                 00201000
TSBCTWX  EQU   TSBTERM2                                                 00202000
@NM00006 EQU   TSBTERM2                                                 00203000
@NM00005 EQU   TSBTERM2                                                 00204000
@NM00004 EQU   TSBTERM1                                                 00205000
@NM00003 EQU   TSBTERM1                                                 00206000
@NM00002 EQU   TSBTERM1                                                 00207000
TSBC2741 EQU   TSBTERM1                                                 00208000
TSBC5041 EQU   TSBTERM1                                                 00209000
TSBCATTN EQU   TSBTERM1                                                 00210000
TSBCBRK  EQU   TSBTERM1                                                 00211000
TSBCIHBN EQU   TSBTERM1                                                 00212000
TSBVTAM  EQU   TSBFLG5                                                  00213000
@NM00001 EQU   TSBFLG5                                                  00214000
TSBNFLOP EQU   TSBFLG3                                                  00215000
TSBNOBRK EQU   TSBFLG3                                                  00216000
TSBTPUT  EQU   TSBFLG3                                                  00217000
TSBAWOIP EQU   TSBFLG3                                                  00218000
TSBNBKSP EQU   TSBFLG3                                                  00219000
TSBSPIT  EQU   TSBFLG3                                                  00220000
TSBTJMSG EQU   TSBFLG3                                                  00221000
TSBIBFP  EQU   TSB+21                                                   00222000
TSBNIBF  EQU   TSB+20                                                   00223000
TSBITBFP EQU   TSB+17                                                   00224000
TSBSATN2 EQU   TSBFLG2                                                  00225000
TSBSATN1 EQU   TSBFLG2                                                  00226000
TSBSTAUT EQU   TSBFLG2                                                  00227000
TSBAUTOC EQU   TSBFLG2                                                  00228000
TSBAULST EQU   TSBFLG2                                                  00229000
TSBBRKIN EQU   TSBFLG2                                                  00230000
TSBAUTON EQU   TSBFLG2                                                  00231000
TSBBIPI  EQU   TSBFLG2                                                  00232000
TSBOBFP  EQU   TSB+13                                                   00233000
TSBNOBF  EQU   TSB+12                                                   00234000
TSBOTBFP EQU   TSB+9                                                    00235000
TSBLNSZ  EQU   TSB+8                                                    00236000
TSBWTCB  EQU   TSB+5                                                    00237000
TSBTJBF  EQU   TSBFLG1                                                  00238000
TSBTJIP  EQU   TSBFLG1                                                  00239000
TSBTJOW  EQU   TSBFLG1                                                  00240000
TSBIFLSH EQU   TSBFLG1                                                  00241000
TSBWOWIP EQU   TSBFLG1                                                  00242000
TSBOWIP  EQU   TSBFLG1                                                  00243000
TSBOFLSH EQU   TSBFLG1                                                  00244000
TSBANSR  EQU   TSBFLG1                                                  00245000
TSBASCB  EQU   TSBASCBA+1                                               00246000
TSBATNLD EQU   TSBSTAT                                                  00247000
TSB3270  EQU   TSBSTAT                                                  00248000
TSBDISC  EQU   TSBSTAT                                                  00249000
TSBITOFF EQU   TSBSTAT                                                  00250000
TSBNOBUF EQU   TSBSTAT                                                  00251000
TSBLWAIT EQU   TSBSTAT                                                  00252000
TSBINUSE EQU   TSBSTAT                                                  00253000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00254000
@RC00009 EQU   @EL00001                                                 00255000
@RC00007 EQU   @EL00001                                                 00256000
@RC00018 EQU   @EL00001                                                 00257000
@ENDDATA EQU   *                                                        00258000
         END   IGG09414,(C'PLS2111',0701,77241)                         00259000
