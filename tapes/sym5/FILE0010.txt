./  ADD  SSI=31640068,NAME=IEDAY3
         TITLE 'IEDAY3  -  TIOC LOGON SYNCHRONIZATION ROUTINE'          01000002
* ********************************************************************  01050002
*                                                                       01100002
*01* MODULE-NAME = IEDAY3                                               01150002
*                                                                       01200002
*01* DESCRIPTIVE-NAME = TIOC LOGON SYNCHRONIZATION ROUTINE              01250002
*                                                                       01300002
*01* COPYRIGHT = NONE                                                   01350002
*                                                                       01400002
*01* STATUS = 00                                                        01450002
*                                                                       01500002
*01* FUNCTION = SYNCHRONIZE THE LOGON PROCESS FOR TIOC BY               01550002
*               PREVENTING MEMORY CREATION FROM PROCEEDING UNTIL        01600002
*               THE TSB AND ASCB ARE FULLY INITIALIZED BY               01650002
*               TIOC LOGON.                                             01660002
*                                                                       01700002
*01* NOTES =                                                            01750002
*                                                                       01800002
*02*   DEPENDENCIES = ASCBECB MUST BE ZEROED WHEN ASCB IS CREATED.      01850002
*                                                                       01900002
*02*   RESTRICTIONS = N/A                                               01950002
*                                                                       01960002
*02*   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                      01970002
*                                                                       01980002
*02*   PATCH-LABEL = PATCH                                              01990002
*                                                                       01992002
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             01994002
*                                                                       01996002
*02*   PROCESSOR = SEE LISTING                                          01998002
*                                                                       01998402
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID 01       01998802
*                                                                       01999202
*02*   ATTRIBUTES = REENTRANT, REFRESHABLE, SUPERVISOR STATE            01999602
*                                                                       01999802
*01* ENTRY-POINT = IEEDAY3                                              01999902
*                                                                       02049902
*02*   PURPOSE = SEE FUNCTION                                           02059902
*                                                                       02069902
*02*   LINKAGE = ATTACHED BY MASTER SCHEDULER.                          02079902
*                                                                       02089902
*01* INPUT = REGISTER 01 CONTAINS ADDRESS OF HALFWORD CONTAINING        02091902
*                        THE ASID OF THE NEW USER.                      02093902
*            REGISTER 15 CONTAINS ENTRY POINT ADDRESS.                  02095902
*                                                                       02097902
*01* OUTPUT = REGISTER 01 SAME AS AT ENTRY.                             02098302
*                                                                       02099602
*01* EXIT-NORMAL = XCTL TO MEMORY CREATE (IEAVEMCR).                    02099702
*                                                                       02099802
*01* EXIT-ERROR = NONE                                                  02149802
*                                                                       02159802
*01* EXTERNAL-REFERENCES = N/A                                          02169802
*                                                                       02179802
*02*   ROUTINES = N/A                                                   02189802
*                                                                       02191802
*02*   DATA-AREAS = N/A                                                 02193802
*                                                                       02197802
*02*   CONTROL-BLOCKS = SEE MAPPING MACROS AT END OF LISTING            02198202
*                                                                       02198602
*01* TABLES = N/A                                                       02199002
*                                                                       02199402
*01* MACROS = WAIT, XCTL                                                02199502
*                                                                       02199602
*01* CHANGE-ACTIVITY -  VS01217 - 05/25/73                              02199702
*                                                                       02249702
*********************************************************************   02259702
         EJECT                                                          02269702
IEDAY3   CSECT                                                          03384802
         COPY  LCGASMS2                 LIBRARY CONTROL                 03434802
         ENTRY IEEDAY3                  ENTRY POINT                     04000002
*                                                                       05000002
*   REGISTER EQUATES                                                    06000002
*                                                                       07000002
RPARM    EQU   1                        PARAMETER REGISTER              08000002
RHOLD    EQU   2                        WORK REGISTER                   09000002
RASCB    EQU   3                        ASCB POINTER                    10000002
RASVT    EQU   4                        ASVT POINTER                    11000002
RBASE    EQU   12                       BASE REGISTER                   12000002
RENTY    EQU   15                       ENTRY POINT ADDRESS             12050002
*                                                                       13000002
*   OTHER EQUATES                                                       14000002
*                                                                       15000002
E0       EQU   0                        NULL DISPLACEMENT               16000002
*                                                                       17000002
         DC    C'IEDAY3'                MODULE I.D.                     18000002
         DC    X'3145'                  DATE 05/25/73                   19000002
IEEDAY3  EQU   *                                                        19050002
         LR    RBASE,RENTY              SET BASE REGISTER               19100002
         USING IEEDAY3,RBASE            SET ADDRESSABILITY              20000002
*                                                                       21000002
*   WAIT FOR TSB TO BE INITIALIZED                                      22000002
*                                                                       23000002
         LR    RHOLD,RPARM              SAVE PARM POINTER               25000002
         LH    RASCB,E0(,RPARM)         GET ASID                        26000002
         L     RASVT,CVTPTR             GET CVT ADDRESS                 27000002
         USING CVT,RASVT                CVT ADDRESSABLE                 28000002
         L     RASVT,CVTASVT            GET ASVT ADDRESS                29000002
         DROP  RASVT                    CVT NOT ADDRESSABLE             30000002
         USING ASVT,RASVT               ASVT ADDRESSABLE                31000002
         AR    RASCB,RASCB              DOUBLE ASID                     32000002
         AR    RASCB,RASCB              GET OFFSET IN ASVT              33000002
         L     RASCB,ASVTENTY-L'ASVTENTY(RASCB)    GET ASCB ADDR        34000002
         USING ASCB,RASCB               ASCB ADDRESSABLE                35000002
         WAIT  ECB=ASCBECB,LONG=YES     WAIT FOR IEDAYLL                36000002
         SPACE 2                                                        36050002
         MVI   ASCBECB,E0               ZERO OUT WAIT AND POST  vs01217 36100002
*                                       bits                    vs01217 36110002
         SPACE 2                                                        36150002
*                                                                       37000002
*   TRANSFER CONTROL TO MEMORY CREATION                                 38000002
*                                                                       39000002
         LR    RPARM,RHOLD              RESTORE REG. 1                  40000002
         XCTL  EP=IEAVEMCR              XCTL TO MEM CREATE              41000002
         DROP  RBASE                    ADDRESSABILITY ENDS             42000002
PATCH    DC    9F'0'                    PATCH AREA                      43000002
         EJECT                                                          44000002
         IHAASCB                                                        45000002
         EJECT                                                          46000002
         IHAASVT                                                        47000002
         EJECT                                                          48000002
CVT      DSECT                                                          49000002
         CVT                                                            50000002
         END                                                            51000002
./  ADD  SSI=72410250,NAME=IEDAY8
         TITLE 'IEDAY8  -  TIOC LOGOFF/TERMINATION ROUTINE'             00700002
IEDAY8   CSECT                                                          00710002
**********************************************************************  01450002
*                                                                       01500002
*01* MODULE-NAME = IEDAY8                                               01550002
*                                                                       01600002
*01* DESCRIPTIVE-NAME = TIOC LOGOFF/TERMINATION ROUTINE                 01650002
*                                                                       01700002
*01* COPYRIGHT = NONE                                                   01750002
*                                                                       01800002
*01* STATUS                                                             01850003
*            -  AUGUST 17,1977                               ZA25683    01860003
*                                                                       01900002
*01* FUNCTION = TERMINATING TIME SHARING MEMORIES. IEDAY8 INFORMS       01950002
*               TCAM THAT THIS USER SESSION IS ENDING, AND THAT         02000002
*               ALL HIS MESSAGES SHOULD BE SENT. IF THE MEMORY          02050002
*               IS TERMINATING ABNORMALLY,IEDAY8 SETS TSBOCAB           02060002
*               SO TSOUTPUT WILL SEND A SPECIAL MESSAGE TO THE          02070002
*               USER. IEDAY8 WAITS UNTIL ALL THE MESSAGES HAVE BEEN     02080002
*               SENT(WHERE UPON IT IS POSTED BY TSOUTPUT), AND THEN     02090002
*               FREES THE TSB.                                          02092002
*                                                               ZA25683 02092103
*               FOR TSO/VTAM RELATED ADDRESS SPACES, THERE ARE THREE    02092203
*               FUNCTION PERFORMED.                             ZA25683 02092303
*                  A. IF THE TERMINATING ADDRESS SPACE IS TCAS, ZA25683 02092403
*                     IKTAY81  IS INVOKED.                      ZA25683 02092503
*                  B. IF A TSO/VTAM ADDRESS SPACE IS TERMINATING,       02092603
*                     IKTAY82  IS INVOKED.                      ZA25683 02092703
*                  C. FOR A TSO/TCAM ADDRESS SPACE TERMINATING, ZA25683 02092803
*                     IKTAY83  IS INVOKED TO HANDLE TSO/VTAM ASID TPUTS 02092903
*                     TO THE TCAM ADDRESS SPACE.                ZA25683 02093003
*                                                                       02094002
*01* NOTES = N/A                                                        02096002
*                                                                       02098002
*01* RESTRICTIONS = N/A                                                 02098402
*                                                                       02098802
*02*   DEPENDENCIES = NONE                                              02099202
*                                                                       02099602
*02*   RESTRICTIONS = NONE                                              02099702
*                                                                       02099802
*02*   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                      02099902
*                                                                       02149902
*02*   PATCH-LABEL = AY8END                                             02159902
*                                                                       02169902
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             02179902
*                                                                       02189902
*02*   PROCESSOR = ASSEMXF-370R                                         02191902
*                                                                       02193902
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID-01       02195902
*                                                                       02197902
*02*   ATTRIBUTES = REENTRANT,REUSABLE,ENABLED                          02198302
*                                                                       02198702
*01* ENTRY-POINT = IEDAY8,IEDAY802                                      02199102
*                                                                       02199502
*02*   PURPOSE = SEE FUNCTION                                           02199602
*                                                                       02199702
*02*   LINKAGE = IEDAY8 FROM TASK AND MEMORY TERMINATION                02199802
*                IEDAY802 FROM DISPATCHER                               02249802
*                                                                       02259802
*01* INPUT = REGISTER 1 CONTAINS PARAMETER LIST                         02269802
*            REGISTER 14 CONTAINS RETURN ADDRESS                        02279802
*            REGISTER 13 CONTAINS ADDRESS OF STANDARD SAVE AREA         02289802
*            REGISTER 15 CONTAINS ENTRY POINT                           02291802
*                                                                       02293802
*01* OUTPUT = REGISTER 0-14 WILL BE RESTORED                            02295802
*             REGISTER 15 WILL CONTAIN A RETURN CODE                    02297802
*                                                                       02298202
*01* EXIT-NORMAL = TO CALLERS ADDRESS IN REGISTER 14                    02298602
*                  TO IKTAY81                                   ZA25683 02298703
*                  TO IKTAY82                                   ZA25683 02298803
*                                                                       02299002
*01* EXIT-ERROR = NONE                                                  02299402
*                                                                       02299502
*01* EXTERNAL-REFERENCES = NONE                                         02299602
*                                                                       02299702
*02*   CONTROL-BLOCKS = TSB,CVT,TIOCRPT,ASCB,RMPL,TCX,AVT,TCAST ZA25683 02349703
*                                                                       02359702
*01* TABLES = NONE                                                      02369702
*                                                                       02379702
*01* MACROS = MODESET,QTIP,WAIT                                         02389702
*                                                                       02391702
*01* CHANGE-ACTIVITY VS01852 - 5/24/73                                  02393702
*D007500                                                        ZA02526 02394103
*A018600,098500,888944,888960,888968,888972,889619-889679       ZA02526 02394503
*A910500                                                        ZA02526 02395303
*C259000,023497                                                 ZA02526 02395403
*                                                                       02395702
*01* CHANGE-ACTIVITY VS2 REL 4 - 9/2/75                         ZA25683 02396303
*D315500,316000,427000,532000-553000,672000,679000              ZA25683 02396903
*C018600,259000,301600,317000,318500,336000,469000,525000       ZA25683 02397703
*A020921-020938,022987-022988,023967-023972,023497              ZA25683 02427703
* 024876,301500,302000,315010-315290,319000,336500-337500       ZA25683 02457703
* 469599-471000,511500-514000,525500,526000,889839-889959       ZA25683 02487703
* 980500,981000                                                 ZA25683 02517703
*                                                               ZA25683 02547703
**********************************************************************  02577703
         EJECT                                                          02607703
         ENTRY IEDAY802                                                 02637703
*                                                                       02667703
*   REGISTER EQUATES                                                    02800002
*                                                                       03500002
RWRK0    EQU   0                        WORK REGISTER                   04200002
RPARM    EQU   1                        PARAMETER REG.                  04900002
RWRK3    EQU   3                        WORK REGISTER                   05600002
RWRK4    EQU   4                        WORK REGISTER                   06300002
RTCX     EQU   5                        TCX ADDRESS             YS02019 06350002
RCVT     EQU   7                        CVT ADDR                        07000002
RTSB     EQU   8                        TSB ADDR                        07700002
RTIOC    EQU   9                        TIOCRPT ADDR                    08400002
RASCB    EQU   10                       ASCB ADDR                       09100002
RRMPL    EQU   11                       RMPL ADDR                       09800002
RAVT     EQU   11                       AVT ADDR                ZA02526 09850003
RBASE    EQU   12                       BASE REG.                       10500002
RSAVE    EQU   13                       SAVE AREA ADDR                  11200002
RLINK    EQU   14                       LINK ADDR                       11900002
REPA     EQU   15                       ENTRY POINT ADDR                12600002
RCODE    EQU   15                       RETURN CODE                     13300002
*                                                                       14000002
*   MASKS AND DISPLACEMENTS                                             14700002
*                                                                       15400002
EC23     EQU   23                       QTIP ENTRY CODE                 16100002
EC29     EQU   29                       QTIP ENTRY CODE                 16800002
E12      EQU   12                       DECIMAL 12                      17500002
E0       EQU   0                        NULL VALUE                      18200002
UPHALF   EQU   B'1100'                  UPPER HALF OF WORD              18900002
E2       EQU   2                        DECIMAL 2                       19600002
EC27     EQU   27                       QTIP 27 ENTRY CODE      YS02019 19650002
*                                                                       20300002
*   ESTABLISH ADDRESSABILITY                                            21000002
*                                                                       21700002
         STM   RLINK,RBASE,E12(RSAVE)   SAVE CALLER'S REG.5             22400002
         LR    RBASE,REPA               LOAD BASE REG.                  23100002
         USING IEDAY8,RBASE             MODULE ADDRESSABILITY           23800002
         B     GETPTRS                  GO TO GET POINTERS              24500002
         DC    C'IEDAY8'                MODULE I.D.                     25200002
         DC    X'5245'                  DATE - SEPTEMBER 2,1975 ZA25683 25900003
*                                                                       26600002
*   GET CONTROL BLOCK POINTERS                                          27300002
*                                                                       28000002
GETPTRS  EQU   *                                                        28700002
         L     RRMPL,E0(,RPARM)         GET RMPL ADDRESS                28750002
         USING RMPL,RRMPL               RMPL ADDRESSABLE                30100002
         TM    RMPLFLG1,RMPLTERM        IS MEMORY TERMINATING   ZA25683 30150003
         BNO   EXIT                     GO EXIT                 ZA25683 30200003
         L     RASCB,RMPLASCB           GET ASCB ADDR                   30800002
         USING ASCB,RASCB               ASCB ADDRESSABLE                31500002
         L     RCVT,CVTPTR              GET CVT ADDR            ZA25683 31501003
         USING CVT,RCVT                 CVT ADDRESSABLE         ZA25683 31502003
         L     RWRK4,CVTTCASP           GET TCAS TABLE ADDRESS  ZA25683 31503003
         L     RTSB,ASCBTSB             GET TSB ADDR            ZA25683 31504003
         LTR   RTSB,RTSB                IS THIS A TS MEMORY     ZA25683 31505003
         BNZ   CKVTAM                   YES,SEE IF IT IS A      ZA25683 31506003
*                                       TSO/VTAM MEMORY         ZA25683 31507003
         LTR   RWRK4,RWRK4              IS THERE A TCAS TABLE   ZA25683 31508003
         BZ    CKASTP                   NO TCAS TABLE AND NO    ZA25683 31509003
*                                       TSB - RETURN TO CALLER  ZA25683 31510003
         USING TCAST,RWRK4              ADDRESS THE TCAST       ZA25683 31511003
         L     RWRK3,TCASASCB-TCAST(,RWRK4) GET TCAS ASCB       ZA25683 31512003
         C     RWRK3,RMPLASCB           IS TCAS THE MEMORY THAT ZA25683 31513003
*                                       IS TERMINATING          ZA25683 31514003
         BNE   CKASTP                   NOT TCAS AND NO TSB -   ZA25683 31515003
*                                       RETURN TO CALLER        ZA25683 31516003
         L     REPA,TCSDOWN             TCAS IS GOING DOWN -    ZA25683 31517003
         BR    REPA                     GO TO IKTAY81,RETURN TO ZA25683 31518003
*                                       RTM2 FROM THERE.        ZA25683 31519003
CKVTAM   EQU   *                        SEE IF TSB IS FOR       ZA25683 31520003
*                                       TSO/VTAM                ZA25683 31521003
         USING TSB,RTSB                 GET TSB ADDRESSABILITY  ZA25683 31522003
         TM    TSBFLG5,TSBVTAM          IS THIS TSO/VTAM TSB    ZA25683 31523003
         BNO   CKASTP                   NO - LOOK FOR ASID TPUTSZA25683 31524003
         L     REPA,TSVDOWN             TSO/VTAM A.S. GOING     ZA25683 31525003
         BR    REPA                     DOWN - GO TO IKTAY82,   ZA25683 31526003
*                                       RETURN TO RTM2 FROM THERE       31527003
CKASTP   EQU   *                        LOOK FOR POSSIBLE ASID  ZA25683 31528003
*                                       TPUTS - EITHER TSO/TCAM ZA25683 31529003
*                                       UP OR TCAS TABLE EXITS  ZA25683 31530003
         L     RWRK3,CVTAQAVT           GET TCX ADDRESS         ZA25683 31550003
         LTR   RWRK3,RWRK3              IS TCAM RUNNING         YM01852 31650002
         BZ    CKTCAS                   NO, LOOK FOR TCAS TABLE ZA25683 31700003
         L     RWRK3,TCXRPT-IEDQTCX(,RWRK3) GET RPT ADDRESS     YM01852 31750002
         LTR   RWRK3,RWRK3              IS TS RUNNING           YM01852 31800002
         BNZ   MEMORY                   YES, PROCESS THE TSO/   ZA25683 31850003
*                                       TCAM ADDRESS SPACE      ZA25683 31900003
CKTCAS   LTR   RWRK4,RWRK4              TCAS TABLE AROUND       ZA25683 33600003
         BZ    EXIT                     NO - NEITHER TCAS TABLE ZA25683 33650003
*                                       NOR TSO/TCAM AROUND. NO ZA25683 33700003
*                                       ASID TPUTS POSSIBLE.EXITZA25683 33750003
*                                                                       43400002
*   MEMORY TERMINATION PROCESSING                                       44100002
*                                                                       44800002
MEMORY   EQU   *                                                        45500002
         TM    RMPLFLG1,RMPLTYPE        IS MEMORY ABENDING              46200002
         BNO   QTIP23                   NO, DON'T CALL QTIP 29  ZA25683 46900003
         LTR   RWRK3,RWRK3              TSO/TCAM UP             ZA25683 46950003
         BZ    VTQT29                   NO,TCAS TABLE MUST BE   ZA25683 47000003
*                                       AROUND,LOOK FOR TSO/VTAMZA25683 47050003
*                                       ASID TPUTS              ZA25683 47100003
         LR    REPA,RRMPL               PASS RMPL ADDR IN 15            47600002
         QTIP  EC29                     CALL QTIP TO CLEAN UP           48300002
*                                       IN CASE A TASK IN THIS          49000002
*                                       MEMORY HAD A TPUT IN            49700002
*                                       PROGRESS TO (OR WAS             50400002
*                                       WAITING ON) ANOTHER TSB.        51100002
         LTR   RWRK4,RWRK4              TCAS TABLE AROUND       ZA25683 51150003
         BZ    QTIP23                   NO - GO CLEAN UP TIOC   ZA25683 51200003
*                                       CONTROL BLOCKS          ZA25683 51250003
VTQT29   L     REPA,VTQTIP29            LOOK FOR TSO/VTAM ASID  ZA25683 51300003
         BALR  RLINK,REPA               TPUTS BY INVOKING       ZA25683 51350003
*                                       IKTAY83                 ZA25683 51400003
*                                                                       51800002
QTIP23   EQU   *                                                ZA25683 52500003
         LTR   RTSB,RTSB                IF THIS IS NOT A TSO    ZA25683 52550003
         BZ    EXIT                     MEMORY, RETURN TO RTM2  ZA25683 52600003
         LR    REPA,RRMPL               PASS RMPL ADDR IN 15            56000002
         QTIP  EC23                     CALL QTIP TO CLEAN UP           56700002
*                                       TIOC CONTROL BLOCKS             57400002
         LTR   RCODE,RCODE              MUST WE WAIT FOR TCAM           58100002
*                                       TO FINISH PROCESSING            58800002
*                                       FOR THIS USER                   59500002
         BZ    CLEAN                    NO, GO CLEAN UP                 60200002
*                                                                       60900002
         WAIT  ECB=TSBLECB,LONG=YES     WAIT FOR TCAM                   61600002
*                                                                       62300002
CLEAN    EQU   *                                                        63000002
         MODESET EXTKEY=TCAM            CHANGE TO TCAM'S KEY    YS02019 63050002
         SR    RWRK0,RWRK0              CLEAR REG.                      63700002
         ST    RWRK0,TSBASCBA           CLEAR TSB ADDR IN ASCB  YS02019 64400002
*                                                                       65100002
*   UPDATE TIOC USER COUNT                                              65800002
*                                                                       66500002
         TM    CVTTCMFG,CVTTCRDY        HAS TCAM ENDED                  68600002
         BNO   EXIT                     YES, TS ENDED WITH IT           69300002
         L     RTIOC,CVTAQAVT           GET ADDR OF TCX                 70000002
         L     RTIOC,TCXRPT-IEDQTCX(,RTIOC)  GET TIOCRPT ADDR           70700002
         USING TIOCRPT,RTIOC            TIOCRPT ADDRESSABLE             71400002
         L     RWRK3,TIOCUSCT-E2        GET WORD CONTAINING CNT         72100002
REDO     EQU   *                                                        72800002
         LA    RWRK4,E0(,RWRK3)         INSURE VALUE IS POSITIVE        73500002
*                                       BEFORE DECREMENTING             74200002
         BCTR  RWRK4,E0                 DECREMENT USER COUNT            74900002
         ICM   RWRK4,UPHALF,TIOCUSCT-E2 RESTORE UPPER HALF              75600002
         CS    RWRK3,RWRK4,TIOCUSCT-E2  UPDATE COUNT                    76300002
         BNE   REDO                     RETRY IF NOT SUCCESSFUL         77000002
*                                                                       77700002
*   IF TIME SHARING IS ENDING & THIS WAS THE LAST USER,                 78400002
*   ISSUE TSEND TO TERMINATE TIME SHARING                               79100002
*                                                                       79800002
         TM    TIOCFLG,TIOCTSAB+TIOCSTOP IS TS ENDING                   80500002
         BZ    EXIT                     NO, EXIT                        81200002
         LH    RWRK4,TIOCUSCT           GET USE COUNT           YM06501 81250002
         LTR   RWRK4,RWRK4              IS LAST USER GONE       YM06501 81350002
         BNZ   EXIT                     NO, EXIT                        82600002
         TSEND                          ,TERMINATE TIME SHARING         83300002
*                                                                       84000002
EXIT     EQU   *                                                        84700002
         MODESET EXTKEY=SUPR            RESTORE CALLER'S KEY            85400002
         LM    RLINK,RBASE,E12(RSAVE)   RESTORE REGISTERS               86800002
         SR    RCODE,RCODE              ZERO RETURN CODE        YS02019 86850002
         BR    RLINK                    RETURN TO CALLER                87500002
*                                                                       88200002
         EJECT                                                          88250002
IEDAY802 EQU   *                                                        88260002
*********************************************************************** 88300002
*        IEDAY802 IS USED IN LINE DISCONNECT RECOVERY FOR TIMING THE  * 88350002
*          RECONNECT PERIOD AND PASSING CONTROL TO IEDAY88 BY         * 88400002
*          ISSUING A QTIP 27. QTIP 27 PASSES BACK A RETURN CODE OF 0  * 88450002
*          OR 4 IN REG 15. IF IT IS ZERO, THEN ALL USERS HAVE NOT     * 88500002
*          BEEN PROCESSED.                                            * 88550002
*          IF RETURN CODE IS FOUR THEN ALL USERS HAVE                 * 88600002
*          BEEN LOGGED OFF OR HAVE RE-LOGGED ON.                      * 88650002
*********************************************************************** 88700002
         STM   RLINK,RBASE,E12(RSAVE)  SAVE CALLERS REGISTERS   YS02019 88750002
         BALR  RBASE,RWRK0             .SET UP                  YS02019 88800002
         USING *,RBASE                 .ADDRESSABILITY          YS02019 88850002
         B     FINDRPT                 BR AROUND MODULE ID      YS02019 88860002
         DC    C'IEDAY802'                                      YS02019 88870002
FINDRPT  EQU   *                                                        88880002
         L     RCVT,CVTPTR             GET CVT ADDRESS          YS02019 88890002
         L     RTCX,CVTAQAVT-CVT(,RCVT) GET TCX ADDRESS         YS02019 88892002
         L     RTIOC,TCXRPT-IEDQTCX(,RTCX) GET TIOCRPT ADDRESS  YS02019 88894002
         L     RAVT,TCXAVT-IEDQTCX(,RTCX) GET AVT ADDRESS       ZA02526 88894403
         USING IEDQAVTD,RAVT           AVT ADDRESSABILITY       ZA02526 88894803
         USING TIOCRPT,RTIOC           TIOCRPT ADDRESSABILITY   YS02019 88896002
TIOCWAIT EQU   *                                                        88896402
         TM    AVTBIT3,AVTTSAB         HAS TSO ABENDED?         ZA02526 88896803
         BO    END                     YES, THEN RETURN         ZA02526 88897203
         WAIT  ECB=TIOCTECB            WAIT FOR HANGUP TO OCCUR YS02019 88898002
TIME     EQU   *                                                        88898102
         STIMER WAIT,BINTVL=ONEMIN     1 MINUTE FOR RECONNECT   YS02019 88898402
         LR    RCODE,RTIOC             PASS RPT ADDR TO QTIP    YS02019 88898802
         QTIP  EC27                    GO TO IEDAY88            YS02019 88899202
*                                      TSB                      YS02019 88899702
         LTR   RCODE,RCODE             DO MORE USERS NEED TO BE YS02019 88899802
*                                      PROCESSED                YS02019 88899902
         BZ    TIME                    YES,BRANCH               YS02019 88949902
         B     TIOCWAIT                NO,WAIT FOR NEXT HANGUP  YS02019 88959902
END      EQU   *                                                ZA02526 88961903
         LM    RLINK,RBASE,E12(RSAVE)  RESTOR CALLERS REGISTERS ZA02526 88963903
         SR    RCODE,RCODE             ZERO RETURN CODE         ZA02526 88965903
         BR    RLINK                   RETURN TO CALLER         ZA02526 88967903
         SPACE 3                                                        88969902
ONEMIN   DC    F'6000'                 ONE MINUTE TIME INTERVAL YS02019 88979902
TCSDOWN  DC    V(IKTAY81)               TCAS A.S. DOWN ROUTINE  ZA25683 88983903
TSVDOWN  DC    V(IKTAY82)               TSO/VTAM A.S. DOWN RTN  ZA25683 88987903
VTQTIP29 DC    V(IKTAY83)               CLEAN UP TSO/VTAM ASID  ZA25683 88991903
*                                       TPUTS ROUTINE           ZA25683 88995903
AY8END   DC    9F'0'                    PATCH AREA                      88999902
         EJECT                                                          89600002
         IHAASCB                                                        90300002
         EJECT                                                          91000002
         TAVTD                                                  ZA02526 91050003
         EJECT                                                          91100003
CVT      DSECT                                                          91700002
         CVT                                                            92400002
         EJECT                                                          93100002
         IHARMPL                                                        93800002
         EJECT                                                          94500002
         TTCXD                                                          95200002
         EJECT                                                          95900002
         IKJTIOCP                                                       96600002
         EJECT                                                          97300002
         IKJTSB                                                         98000002
         EJECT                                                  ZA25683 98050003
         IKTTCAST                                               ZA25683 98100003
         END                                                            98700002
./  ADD  SSI=81450446,NAME=IGC0009C
         TITLE 'IGC0009C - FIRST LOAD OF TGET AND TPUT'                 00100020
*********************************************************************** 00120003
*                                                                       00140003
*                                                                       00160003
*          RELEASE 4 VS/2 CHANGES                               ZA16607 00200003
* A 70750-70920,113000,207414-207462,207485,715050,718800       ZA24648 00200203
* A 153900,217970,218000,219470,219500                          ZA32421 00200403
* C 218040,219540                                               ZA32421 00200603
* D 218140,219640                                               ZA32421 00200803
* A 203200,203300,654700-658200                                 ZA11383 00201003
* C 206928,206948                                               ZA11383 00202003
* D 206960,206970                                               ZA11383 00203003
*                                                               ZA16607 00204003
*C019000,022000,259700,260192,                                  ZA16607 00205003
*C260497,260592,884200                                          ZA16607 00210003
*                                                               ZA16607 00215003
*A019500,022100-022400,072300,072600,074100-074500,             ZA16607 00220003
*A106500,113040,206917,206924,206931,207010-238310              ZA16607 00223003
*A259904-259616,259930,260562                                   ZA16607 00226003
*260712,714860-715040,894700,895200                             ZA16607 00230003
*                                                               ZA16607 00235003
*D022000,206920,206928,206930,206940-206970,260498,             ZA16607 00240003
*D268000-345300                                                 ZA16607 00245003
*                                                               ZA16607 00250003
*                                                               ZA16607 00255003
*          RELEASE 2 VS/2 DELETIONS                                   * 00260002
*          RELEASE 1 VS/2 DELETIONS                                   * 00292002
*          RELEASE 21 DELETIONS                                       * 00300020
*          UY70029 IS THE SAME AS US02278                       YA00677 00302102
*          US02278 FIXES APAR 60002                             SA60002 00304502
*D001760-001800,263000-264000                                   SA60002 00304602
*0834                                                            M1807  00304802
* A498820                                                       ZA12514 00305803
*0834393600,425500,622000                                        M1800  00306902
*0834383300                                                      M1757  00309002
*0834304000                                                      A46079 00311102
*0834155000,158000-159000,170000-173600,174000-176600,183000,    M0094  00313202
*0834185000,200100,200400,202200,202300-202900,203560,213000,    M0094  00315302
*0834215000,263000,265000,271000,278000-279000,316000-317000,    M0094  00317402
*0834320000,322000,332000-334000,346000-347000,369000,383600,    M0094  00319502
*0834461000-471000,498400,507000,520000-520500,525000,526400,    M0094  00321602
*0834589000-590000,593000,639000,643000,645000-646000,654000-    M0094  00323702
*0834657000,694300,707000-708000,749000-750000,764000-765000     M0094  00325802
*0834042000,159000                                               S21A12 00327902
*0834381600-382200,384000-418000,420000-490000,491000,589000,    S21008 00330021
*0834612100-633000,639000,759000-763000                          S21008 00360021
*0834763400                                                      S22028 00380002
*          RELEASE 22 DELETIONS                                       * 00400020
*                                                                     * 01200020
*                                                                M3281  01210020
*                                                                M2152  01220020
*                                                                M3279  01250020
*0000105500,113900,205200-205600                                 M0019  01300020
*0000204200-205200,359400-360200,412200-413000                   M0607  01400020
*                                                                M0661  01500020
*                                                                TS1628 01550020
*                                                                 M2265 01570020
*                                                                 M3491 01575020
*                                                                M2794  01580020
*                                                                M2331  01590020
*                                                                 M3830 01595020
*                                                                M4395  01597020
*                                                                M4424  01598020
*                                                                 M5312 01599020
* STATUS CHANGE LEVEL 003                                       ZA16607 01649003
*                                                                     * 01700020
* FUNCTION -                                                          * 01800020
*    GET INPUT FROM TERMINAL VIA THE TIOC(TCAM TERMINAL) OR     ZA16607 01900003
*    VTIOC(VTAM TERMINAL) AND PASS IT TO THE USER'S BUFFER      ZA16607 01930003
*    PUT OUTPUT FROM THE USER'S BUFFER TO THE TERMINAL VIA THE  ZA16607 01960003
*    TIOC(TCAM TERMINAL) OR VTIOC(VTAM TERMINAL)                ZA16607 02000003
*    TCAM VS. VTAM IS DETERMINED VIA TSBVTAM:                   ZA16607 02050003
*        TSBVTAM=0: TCAM                                        ZA16607 02100003
*        TSBVTAM=1: VTAM                                        ZA16607 02150003
*                                                                     * 02200003
*    PROVIDE LIMITED EDITING OPTIONS FOR BOTH INPUT AND OUTPUT.       * 02300002
*    PROVIDE FOR OUTPUT OF MESSAGES TO TERMINALS OTHER THAN THE       * 02400002
*    ONE ASSOCIATED WITH THE TASK.                                    * 02500020
*                                                                     * 02600020
* ENTRY POINTS -                                                      * 02700002
*    SVC - INITIAL ENTRY TO THIS MODULE WHEN AN SVC 93 OR A           * 02800002
*           TPUT OR TGET MACRO INSTRUCTION IS ISSUED.                 * 02900020
*                                                                     * 03000020
* INPUT -                                                             * 03100002
*    REGISTERS 0, 1, AND POSSIBLY 15 CONTAIN PARAMETERS AS FOLLOWS:   * 03200002
*        **********************************                           * 03260002
*    REG0*RAAAAAAAAAAAAAAARSSSSSSSSSSSSSSS*                           * 03270002
*        **********************************                           * 03280002
*           WHERE - R EQUALS RESERVED                                 * 03290002
*                   A EQUALS ASID OF DESTINATION TERMINAL             * 03292002
*                   S EQUALS USER'S BUFFER SIZE, IN BYTES             * 03294002
*        **********************************                           * 03298002
*    REG1*OULWHBEEPPPPPPPPPPPPPPPPPPPPPPPP*                           * 03298402
*        **********************************                           * 03298802
*           WHERE - O EQUALS OPTION - 0=TPUT, 1=TGET                  * 03299202
*                   U EQUALS USERID SPECIFIED BY REG 15               * 03299602
*                   L EQUALS LEVEL OF PRIORITY /0 HIGHP/1 LOWP          04550002
*                   W EQUALS WAIT  /0 WAIT/1 NOWAIT                   * 04600020
*                   H EQUALS HOLD  /0 NOHOLD/1 HOLD                   * 04700020
*                   B EQUALS BREAR  /0 NOBREAK/1 BREAKIN              * 04800020
*                  EE EQUALS EDIT  /00 EDIT/01 ASIS/10 CONTROL        * 04900020
*                   P EQUALS POINTER TO USER'S BUFFER                 * 05000020
*                                                                     * 05100020
*    REG 15 CONTAINS A POINTER TO THE USER ID, IF 'U,' ABOVE, IS      * 05150002
*    ONE.                                                             * 05160002
*                                                                     * 05170002
* OUTPUT -                                                            * 05200002
*    RETURN CODE IN REGISTER 15 -                                     * 05300002
*        00 SUCCESSFUL.                                               * 05400020
*        04 TPUT - NOWAIT SPECIFIED AND NO TIOC OUTPUT                * 05500020
*                  BUFFER WAS AVAILABLE.                              * 05600020
*           TGET - NOWAIT SPECIFIED AND NO INPUT READY.               * 05700020
*        08 ATTENTION INTERRUPT                                       * 05800020
*        0C TPUT - NO INTER-TERMINAL COMMUNICATION BIT ON             * 05900020
*           TGET THE BUFFER WAS TOO SMALL FOR INPUT GIVEN.            * 06000020
*        10 INVALID PARAMETERS SPECIFIED                              * 06100020
*        14 USER NO LONGER ACTIVE                                     * 06200002
*           OR THE TERMINAL USER HUNG UP                              * 06300020
*                                                                     * 06400020
*   TGET -                                                            * 06500020
*        LENGTH IN BYTES OF MSG GOTTEN IS GIVEN IN REG 1.             * 06600020
*                                                                     * 06700020
* EXTERAL ROUTINES -                                                  * 06800002
*         MODESET                                                     * 06900002
*         QTIP                                                        * 07000002
*         SETLOCK                                                     * 07050002
*         STATUS                                                      * 07060002
*         XCTL                                                        * 07070002
*         IKTTMPX1                                              ZA24648 07070803
*            REG 15 RETURN CODE FROM IKTTMPX1                   ZA24648 07071603
*                    RC < 0 NORMAL PROCESSING SHOULD CONTINUE   ZA24648 07072403
*                       >=0 THE SVC SHOULD RETURN TO THE CALLER ZA24648 07073203
*                           PASSING THRU THE VALUE IN REG 15    ZA24648 07074003
*                                                                     * 07100020
* EXITS,NORMAL -                                                      * 07200020
*                                                                     * 07230003
*  FOR TCAM REQUESTS:                                                 * 07260003
*    RETURN TO SUPERVISOR VIA BR 14, OR                               * 07300002
*    BRANCH TO MODULE IGG09301 TO DO A NORMAL TPUT, OR                * 07350002
*    BR TO MODULE IGG09302 TO DO AN ASID TPUT OR A USERID TPUT, OR    * 07360002
*    BR TO MODULE IGG09303 AFTER A TGET, TO REMOVE WAITS              * 07370002
*                                                                     * 07400020
*  FOR VTAM REQUESTS:                                           ZA16607 07410003
*    BR TO MODULE IKTVTPUT TO DO A NORMAL TPUT, OR              ZA16607 07420003
*    BR TO MODULE IKTASTPT TO DO AN ASID TPUT OR A USERID TPUT, OR      07430003
*    BR TO MODULE IKTVTGET TO DO A TGET.                        ZA16607 07440003
*                                                                     * 07450003
* EXITS,ERROR                                                         * 07500020
*    THERE ARE NO ERROR EXITS FROM THIS ROUTINE.                      * 07600002
*                                                                     * 07700020
* TABLES/WORKAREAS -                                                  * 07800020
*    THE FORMAT AND CONTENTS OF THE WORK AREA USED ARE DESCRIBED      * 07900002
*    BY THE DSECTS AT THE END OF THE LISTING.                         * 08000002
*    ALSO, THE EXTENDED SAVE AREA OF THE SVRB IS USED AS A SAVE AND   * 08030002
*    WORK AREA.                                                       * 08060002
*                                                                     * 08100020
* ATTRIBUTES -                                                        * 08200002
*    REENTRANT, ENABLED, PRIVILEGED, LOCAL LOCK HELD IMPLICITLY,      * 08300002
*    CMS LOCK GOTTEN EXPLICITLY.                                      * 08360002
*                                                                     * 08400020
* CHARACTER CODE DEPENDENCY -                                         * 08500020
*                                                                     * 08600020
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL              08700020
*    REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS              08800020
*    EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE                  08900020
*    CODING HAS BEEN ARRANGED SO THAT REDEFINITION OF                   09000002
*    'CHARACTER' CONSTANTS, BY REASSEMBLY, WILL RESULT IN A             09100020
*    CORRECT MODULE FOR THE NEW DEFINITIONS.                            09200020
*                                                                     * 09300020
*                                                                     * 09400020
* NOTES -                                                             * 09500020
*    NONE                                                             * 09600020
*                                                                     * 09700020
*********************************************************************** 09800020
         SPACE 2                                                        09900020
IGC0009C CSECT                                                          10000020
         SPACE 2                                                        10100020
***                                                                     10200020
***                 REGISTER EQUATES                                    10300020
***                                                                     10400020
R0       EQU   0                        REG USED FOR ASM SPEED          10500020
RP0      EQU   0                        FIRST PARAMETER REGISTER        10600020
RWRK4    EQU   0                        WORK REGISTER           ZA16607 10650003
RP1      EQU   1                        SECOND PARAMETER REGISTER       10700020
RSDWA    EQU   1                        POINT TO SDWA IN ESTAE  YS02019 10750002
RBUF     EQU   2                        POINTER TO TS BUFFER            10800020
RWSA     EQU   2                        POINTER TO ESTAE WSA    YS02019 10850002
RWRK02   EQU   2                        WORK REGISTER           YS02019 10860002
RCVT     EQU   3                        POINTER TO CVT                  10900020
RWRK3    EQU   3                        WORK REGISTER           YS02019 10950002
RTCB     EQU   4                        POINTER TO TCB                  11000020
RSVRB    EQU   5                        POINTER TO SVRB                 11100020
RBASE    EQU   6                        BASE REGISTER                   11200020
RWRK2    EQU   7                        WORK REGISTER           YS02019 11300002
RTSBX    EQU   7                        POINTER TO TSB EXTEN    ZA16607 11304003
REG7     EQU   7                                                ZA24648 11305003
RASCB    EQU   8                        POINTER TO ASCB         YS02019 11308002
RTSB     EQU   9                        POINTER TO TSB                  11500020
RRPT     EQU   10                       POINTER TO TIOCRPT              11600020
RESTAE   EQU   10                       POINTER TO TSO/VTAM ESTAZA16607 11620003
RTCX     EQU   11                       POINTER TO TCAM CVT EXT YS02019 11640002
RECB     EQU   11                       ECB TO BE POSTED POINTER        11800020
RJSCB    EQU   12                       POINTER TO JSCB                 11900020
RTJID    EQU   12                       TJID OF TASK                    12000020
RAVT     EQU   13                       POINTER TO AVT                  12100020
RSAVE    EQU   13                       SAVE REGISTER                   12200020
RWRK     EQU   14                       WORK REGISTER                   12300020
RETURN   EQU   14                       RETURN ADDRESS REGISTER         12400020
RET      EQU   15                       ENTRY POINTER                   12600020
RWRK1    EQU   15                       WORK REGISTER                   12700020
RCODE    EQU   15                       RETURN CODE REGISTER            12800020
***                                                                     12900020
***                 CONSTANTS                                           13000020
***                                                                     13100020
K0       EQU   0                        CONSTANT OFFSET                 13200020
K1       EQU   1                        CONSTANT OFFSET AND SIZE        13300020
K3       EQU   3                        CONSTANT OFFSET         YS02019 13350002
K4       EQU   4                        CONSTANT OFFSET         YS02019 13360002
K12      EQU   12                       CONSTANT OFFSET         YS02019 13370002
WORD4    EQU   12                       OFFSET                  YS02019 13380002
SDTCB    EQU   15                       ENTRY CODE FOR 'STATUS' YS02019 13400002
CLEANTSB EQU   29                       QTIP 29 ENTRY CODE      YS02019 13450002
***                                                                     14300020
***                 RETURN CODES                                        14400020
***                                                                     14500020
RC04     EQU   X'04'                    NOWAIT AND NO DATA              14600002
RC08     EQU   X'08'                    ATTENTION HIT DURING OPERATION  14700002
RC0C     EQU   X'0C'                    BFR TOO SMALL FOR DATA   M0607  14800020
RC10     EQU   X'10'                    INVALID PARAMETERS              14900002
RC14     EQU   X'14'                    USER GONE AWAY                  15000002
***                                                                     15100020
***                 MASKS                                               15200020
***                                                                     15300020
OFF      EQU   X'FF'                    TO TURN OFF BITS        YS02019 15320002
NDISPBIT EQU   X'800'                   MASK FOR 'STATUS'       YS02019 15330002
NP       EQU   13                       FOR BCR INSTRUCTIONS    YS02019 15340002
ICM7     EQU   7                        FOR ICM INSTRUCTIONS    ZA32421 15390003
         SPACE 2                                                        17700020
***                                                                     17800020
***                 OTHER EQUATES                                       17900020
***                                                                     18000020
RETPSW   EQU   20                       LOWER HALF OF RB OLD PSW        18200020
EDITCODE EQU   18                       QTIP ENTRY CODE FOR EDIT        18400020
MULTBY4  EQU   2                        SHIFT VAL FOR TIMES 4   YS02019 18410002
PARTT    EQU   X'400'                   PARTIAL FLAG FOR SYSEVENT       18530002
*                                       NEEDS TO BE SHIFTED LEFT        18560020
CCODE15D EQU   X'15D'                   COMPLETION CODE 15D     YS02019 18594002
         SPACE 2                                                        18600020
         BALR  RBASE,R0                 SET BASE REGISTER               18700020
         USING *,RBASE                  ADDRESSABILITY                  18800020
         SPACE 3                                                        18850002
         EJECT                                                          18900020
*********************************************************************** 18950002
***                                                                 *** 18960002
***      THIS MODULE HOLDS THE LOCAL LOCK AT ENTRY                  *** 18970002
***                                                                 *** 18980002
*********************************************************************** 18990002
         SPACE 3                                                        18992002
*********************************************************************** 19000020
***                                                                 *** 19100020
***                 COMMON  TGET / TPUT  ROUTINE                    *** 19200020
***                                                                 *** 19300020
*********************************************************************** 19400020
         SPACE 3                                                        19500020
         USING CVT,RCVT                                                 19600020
         USING TCB,RTCB                                                 19700020
         USING TIOCBUF,RBUF                                             19800020
         USING RBSECT,RSVRB                                      M0094  19850021
         ST    RETURN,XSARETRG          SAVE RETURN ADDRESS     YS02019 19852002
         ST    RET,XSAUSERP             SAVE USERID POINTER     YS02019 19854002
         STM   RP0,RP1,XSAPRM0          SAVE PARAMETERS IN RB    Y01018 19855000
         B     TGT0005                  BRANCH AROUND I.D.       Y01018 19865000
         DC    C'IGC0009C'              MODULE I.D.              Y01018 19870000
         DC    X'7007'                  JULIAN DATE - 01/07/77  ZA24648 19875003
TGT0005  EQU   *                                                YS02019 19876002
         MVI   XSAFLAG,K0               INITIALIZE FLAGS         M0094  20010021
         MVI   XSAFLAG2,K0              INITIALIZE FLAGS         S22028 20010402
         SPACE 2                                                YS02019 20012002
***                                                                     20014002
***                 TURN ON TCBFX TO PREVENT ASYNCHRONOUS EXITS,        20016002
***                 BUT RECORD PREVIOUS SETTING SO IT CAN BE RESTORED   20018002
***                                                                     20018402
         TM    TCBFLGS1,TCBFX           WAS TCBFX ON AT ENTRY           20020020
         BO    TGT0010                  IF SO, SKIP                     20030020
         OI    XSAFLAG,XSATCBFX         IF NOT, INDICATE THAT WE M0094  20040021
*                                       SHOULD TURN IT OFF LATER        20050020
TGT0010  EQU   *                                                        20060020
         OI    TCBFLGS1,TCBFX           PREVENT ASYNCHRONOUS EXIT       20100020
         SPACE                                                          20110002
***                                                                     20150002
***                 GET TSO CONTROL BLOCK POINTERS                      20200002
***                                                                     20210002
         L     RASCB,PSAAOLD-PSA        GET ASCB ADDRESS        YS02019 20260002
         USING ASCB,RASCB               ASCB ADDRESSABLE        YS02019 20310002
         L RTSB,ASCBTSB             GET TSB POINTER             ZA11383 20313003
         USING TSB,RTSB                                         ZA11383 20316003
         LH    RTJID,ASCBASID           GET ASID                YS02019 20360002
         L     RTCX,CVTASVT             GET ASVT POINTER        YS02019 20682002
         USING ASVT,RTCX                                        YS02019 20683002
         LH    RWRK,XSAPRMTJ            GET DEST ASID FOR CHECK YS02019 20684002
         C     RWRK,ASVTMAXU            CHECK FOR TOO HIGH      YS02019 20685002
         BH    TGT7000                  IF IT IS, YOU'RE OUT    YS02019 20686002
         DROP  RTCX                                             YS02019 20691002
***                                                             ZA16607 20691503
***                CHECK FOR VALID USER BUFFER SIZE             ZA16607 20692003
***                                                             ZA16607 20692803
         LH    RWRK1,XSAPRMSZ           GET BUFFER SIZE         ZA16607 20694003
         LTR   RWRK1,RWRK1              CHECK FOR EXCESSIVE     ZA16607 20704003
*                                       BUFFER SIZE             ZA16607 20714003
         BM    TGT7000                  IF TOO LARGE GO TO      ZA16607 20724003
*                                       ILLEGAL PARAMETER RETURNZA16607 20734003
         L     RET,USEREXIT             GET @ OF TERM MGR EXIT  ZA24648 20734403
         LTR   RET,RET                  IS THERE A USER EXIT    ZA24648 20734803
         BZ    TGTTPT                   BRANCH ON NO            ZA24648 20735203
         LR    REG7,RASCB               PUT ASCB @ IN REG 7     ZA24648 20735603
         BALR  RETURN,RET               BRANCH TO USER EXIT     ZA24648 20744003
         LTR   RCODE,RCODE              TEST RETURN CODE        ZA24648 20744503
         BNM   TGT9000                  BRANCH ON CODE >=0      ZA24648 20745003
*                                                               ZA16607 20745503
****************************************************************ZA16607 20754003
****                                                        ****ZA16607 20764003
****            DETERMINE IF TGET OR TPUT OR TPUT W/ASID    ****ZA16607 20774003
****                                                        ****ZA16607 20784003
****************************************************************ZA16607 20794003
*                                                               ZA16607 20804003
TGTTPT   EQU   *                                                ZA24648 20806003
         LTR   RP1,RP1                  IS  THIS A TGET REQUEST ZA16607 20814003
         BM    TGT0100                  IF  TGET  GO  TEST      ZA16607 20824003
*                                       TCAM/VTAM               ZA16607 20834003
         TM    XSAOPTNS,MUSERID         WAS USERID  SPECIFIED   ZA16607 20844003
         BNO   TGT0008                  NO SKIP CHECK           ZA16607 20854003
         L     RWRK,ASCBCSCB            GET CSCB POINTER        ZA16607 20864003
         L     RET,XSAUSERP             GET USERID POINTER      ZA16607 20874003
         LTR   RWRK,RWRK                IS THERE A CSCB         ZA16607 20884003
         BZ    TGT0012                  NO CSCB..CAN'T BE  SAME ZA16607 20894003
         USING CSCB,RWRK                                        ZA16607 20904003
         CLC   CHKEY,0(RET)             CHECK CALLER'S USERID   ZA16607 20914003
         DROP  RWRK                                             ZA16607 20924003
         BE    TGT0100                  IF SAME, NORMAL TPUT    ZA16607 20934003
*                                       CHECK TCAM/VTAM         ZA16607 20944003
         B     TGT0012                  IF NOT, ASID TPUT       ZA16607 20954003
TGT0008  LH    RWRK,XSAPRMTJ            PICK UP  SPECIFIED ID   ZA16607 20964003
         LTR   RWRK,RWRK                IS ASID POSITIVE        ZA16607 20974003
         BM    TGT7000                  NEGATIVE...INVALID      ZA16607 20984003
         BZ    TGT0100                  NO ASID SPECIFIED...    ZA16607 20994003
*                                       NORMAL TPUT. CHECK      ZA16607 21004003
*                                       TCAM/VTAM               ZA16607 21014003
         CR    RTJID,RWRK               IS ASID SAME AS THAT OF ZA16607 21024003
*                                       THE CALLING TASK        ZA16607 21034003
         BE    TGT0100                  YES. NORMAL TPUT. CHECK ZA16607 21044003
*                                       TCAM/VTAM               ZA16607 21054003
         EJECT                                                          21064003
*                                                               ZA16607 21074003
****************************************************************ZA16607 21084003
****                                                        ****ZA16607 21094003
****           CROSS MEMORY TPUT...DETERMINE WHETHER TARGET ****ZA16607 21104003
****           MEMORY IS USING TCAM OR VTAM AS ACCESS METHOD****ZA16607 21114003
****           BY SEARCHING THE TSB'S                       ****ZA16607 21124003
****                                                        ****ZA16607 21134003
****************************************************************ZA16607 21144003
*                                                               ZA16607 21154003
***                                                             ZA16607 21164003
***            NEED CMS LOCK FOR TSB                            ZA16607 21174003
***                                                             ZA16607 21184003
TGT0012  SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   ZA16607-21194003
               RELATED=(TSB,IGC0009C(TGT0030))                  ZA16607 21204003
*                                                               ZA16607 21214003
****************************************************************ZA16607 21224003
****                                                        ****ZA16607 21234003
****                SEARCH FOR TCAM TSB                     ****ZA16607 21244003
****                                                        ****ZA16607 21254003
****************************************************************ZA16607 21264003
*                                                               ZA16607 21274003
         L     RTCX,CVTAQAVT            GET TCX POINTER         ZA16607 21284003
         LTR   RTCX,RTCX                IS TCAM UP              ZA16607 21294003
         BZ    TGT0038                  NO, SCAN FOR VTAM       ZA11383 21304003
         USING IEDQTCX,RTCX                                     ZA16607 21314003
         L     RRPT,TCXRPT              GET TIOCRPT POINTER     ZA16607 21324003
         LTR   RRPT,RRPT                IS TSO/TCAM UP          ZA16607 21334003
         BZ    TGT0038                  NO, SCAN FOR VTAM       ZA11383 21344003
         SPACE                                                          21354003
         USING TIOCRPT,RRPT                                     ZA16607 21364003
***                                                             ZA16607 21374003
***                INITIALIZE REGS FOR SEARCH                   ZA16607 21384003
***                                                             ZA16607 21394003
         SR    RBUF,RBUF                                        ZA16607 21404003
         IC    RBUF,TIOCTSBS            INCREMENT AMOUNT=SIZE   ZA16607 21414003
         LR    RWRK,RBUF                FOR MULTIPLICATION      ZA16607 21424003
         LH    RWRK1,TIOCNTSB           GET NO. OF TSBS         ZA16607 21434003
         BCTR  RWRK1,R0                 SUBTRACT ONE            ZA16607 21444003
         MR    RWRK,RWRK                GET OFFSET OF LAST TSB  ZA16607 21454003
         LR    RWRK3,RWRK1              CHANGE REGS FOR BXLE    ZA16607 21464003
         L     RTSB,TIOCTSB-K1          GET ORIGIN OF TABLE     ZA16607 21474003
         LA    RTSB,K0(,RTSB)           CLEAR HIGH ORDER BYTE   ZA16607 21484003
         USING TSB,RTSB                                         ZA16607 21494003
         AR    RWRK3,RTSB               ADD TO OFFSET           ZA16607 21504003
*                                                               ZA16607 21514003
****************************************************************ZA16607 21524003
*                                                               ZA16607 21534003
*                   REGISTERS 2,3 AND RTSB ARE SET UP FOR A BXLEZA16607 21544003
*                     LOOP TO SCAN THE TSB TABLE                ZA16607 21554003
*                     RBUF(2),INCREMENT, HAS THE TSB SIZE       ZA16607 21564003
*                    RWRK3(3),COMPARAND, POINTS TO THE LAST TSB ZA16607 21574003
*                       IN THE TSB TABLE, AND                   ZA16607 21584003
*                     RTSB,INDEX, POINTS TO THE FIRST TSB IN THEZA16607 21594003
*                       TSB TABLE                               ZA16607 21604003
*                                                               ZA16607 21614003
*                     NOW, THE TSB'S AND ASSOCIATED ASCB'S      ZA16607 21624003
*                     (AND CSCB'S) WILL BE SCANNED FOR A MATCH  ZA16607 21634003
*                     ON THE ASID OR THE USERID                 ZA16607 21644003
*                                                               ZA16607 21654003
*                     THE ASVT CANNOT BE USED, BECAUSE IT MUST  ZA16607 21664003
*                     BE STABILIZED WITH THE DISPATCHER LOCK,   ZA16607 21674003
*                     AND HOLDERS OF THIS LOCK MUST BE FIXED    ZA16607 21684003
*                     AND DISABLED.                             ZA16607 21694003
*                                                               ZA16607 21704003
****************************************************************ZA16607 21714003
*                                                               ZA16607 21724003
         TM    XSAOPTNS,MUSERID         WAS USERID SPECIFIED    ZA16607 21734003
         BO    TGT0020                  YES, GO LOOK FOR IT.    ZA16607 21744003
***                                                             ZA16607 21754003
***                 SCAN FOR ASID MATCH                         ZA16607 21764003
***                                                             ZA16607 21774003
         LH    RWRK4,XSAPRMTJ           GET SPECIFIED ASID      ZA16607 21784003
TGT0014  EQU   *                                                ZA16607 21794003
         TM    TSBSTAT,TSBINUSE         TSB VALID?              ZA32421 21797003
         BNO   TGT0016                  NO, CONTINUE SCAN       ZA32421 21800003
         ICM   RASCB,ICM7,TSBASCB       GET ASCB POINTER, GOOD? ZA32421 21804003
         BZ    TGT0016                  NO, CONTINUE SCAN       ZA16607 21824003
         USING ASCB,RASCB                                       ZA16607 21834003
         CH    RWRK4,ASCBASID           CHECK ASID              ZA16607 21844003
         BE    TGT0030                  IF SAME, THIS IS IT     ZA16607 21854003
TGT0016  EQU   *                                                ZA16607 21864003
         BXLE  RTSB,RBUF,TGT0014        CONTINUE SCAN           ZA16607 21874003
         B     TGT0040                  NOT IN TCAM LIST        ZA16607 21884003
*                                       GO LOOK AT VTAM         ZA16607 21894003
***                                                             ZA16607 21904003
***                SCAN FOR USERID MATCH                        ZA16607 21914003
***                                                             ZA16607 21924003
TGT0020  EQU   *                                                ZA16607 21934003
         L     RWRK1,XSAUSERP           GET POINTER TO USERID   ZA16607 21944003
TGT0022  TM    TSBSTAT,TSBINUSE         TSB VALID?              ZA32421 21947003
         BNO   TGT0024                  NO, CONTINUE SCAN       ZA32421 21950003
         ICM   RASCB,ICM7,TSBASCB       GET ASCB POINTER, GOOD? ZA32421 21954003
         BZ    TGT0024                  NO, GET  NEXT           ZA16607 21974003
         L     RWRK,ASCBCSCB            GET CSCB POINTER        ZA16607 21984003
         USING CSCB,RWRK                                        ZA16607 21994003
         CLC   CHKEY,0(RWRK1)           CHECK USERID            ZA16607 22004003
         BE    TGT0030                  GO PROCESS IT           ZA16607 22014003
         DROP  RWRK                                             ZA16607 22024003
TGT0024  EQU   *                                                ZA16607 22034003
         BXLE  RTSB,RBUF,TGT0022        LOOK AT EACH TSB        ZA16607 22044003
         B     TGT0040                  NOT IN TCAM LIST        ZA16607 22054003
*                                       GO LOOK AT VTAM         ZA16607 22064003
TGT0030  EQU   *                                                ZA16607 22074003
***                                                             ZA16607 22084003
***  RTSB=DESTINATION TSB, RASCB=DESTINATION ASCB               ZA16607 22094003
***                                                             ZA16607 22104003
         SETLOCK RELEASE,TYPE=CMS,                              ZA16607-22114003
               RELATED=(TSB,IGC0009C(TGT0012))                  ZA16607 22124003
         SPACE 2                                                ZA16607 22134003
         L     RASCB,PSAAOLD-PSA        GET ASCB ADDRESS        ZA16607 22144003
         LH    RTJID,ASCBASID           GET ASID                ZA16607 22154003
         L     RCVT,CVTPTR              RESTORE CVT POINTER     ZA16607 22164003
         BAL   RWRK2,TGT0190            SET UP TCAM ESTAE       ZA16607 22174003
*                                                               ZA16607 22184003
****************************************************************ZA16607 22194003
***                                                         ****ZA16607 22204003
***                BRANCH TO IGG09302 HOLDING THE LOCAL LOCK****ZA16607 22214003
***                ASID TPUT TO A TCAM TERMINAL             ****ZA16607 22224003
***                                                         ****ZA16607 22234003
****************************************************************ZA16607 22244003
         L     RET,VCON9302             GET IGG09302'S EPA      ZA16607 22254003
         BR    RET                      GOTO IGG09302           ZA16607 22264003
TGT0038  EQU   *                                                ZA11383 22274003
         L     RCVT,CVTPTR              RESTORE CVT POINTER     ZA11383 22284003
         L     RWRK,CVTTCASP            GET POINTER TO TCAS TBL ZA11383 22294003
         LTR   RWRK,RWRK                IS TSO/VTAM UP          ZA11383 22304003
         BNZ   TGT0041                  NO. TERMINAL CAN'T BE   ZA11383 22314003
         LTR   RTSB,RTSB                IS THIS TSTASK          ZA11383 22324003
         BZ    TGT9200                  NO, MAKE IT NOP         ZA11383 22334003
         B     TGT6800                  GO RETURN TO CALLER     ZA11383 22344003
         DROP  RTSB                                             ZA16607 22354003
         EJECT                                                  ZA16607 22364003
*                                                               ZA16607 22374003
****************************************************************ZA16607 22384003
***                                                         ****ZA16607 22394003
***                SEARCH FOR VTAM TSB                      ****ZA16607 22404003
***                                                         ****ZA16607 22414003
****************************************************************ZA16607 22424003
*                                                               ZA16607 22434003
TGT0040  EQU   *                                                ZA16607 22444003
         L     RCVT,CVTPTR              RESTORE CVT POINTER     ZA16607 22454003
         L     RWRK,CVTTCASP            GET POINTER TO TCAS TBL ZA16607 22464003
         LTR   RWRK,RWRK                IS TSO/VTAM UP          ZA16607 22474003
         BZ    TGT6800                  NO. TERMINAL CAN'T BE   ZA16607 22484003
*                                       FOUND. RETURN TO        ZA16607 22494003
*                                       CALLER                  ZA16607 22504003
TGT0041  EQU   *                                                        22514003
         USING TCAST,RWRK                                       ZA16607 22524003
         L     RTSB,TCASTSB             INITIALIZE RTSB TO FIRSTZA16607 22534003
*                                       TSO/VTAM TSB FOR  SEARCHZA16607 22544003
         USING TSB,RTSB                                         ZA16607 22554003
         TM    XSAOPTNS,MUSERID         WAS USERID SPECIFIED    ZA16607 22564003
         BO    TGT0050                  YES, GO LOOK FOR IT     ZA16607 22574003
         LH    RWRK4,XSAPRMTJ           GET SPECIFIED ASID      ZA16607 22584003
***                                                             ZA16607 22594003
***                SCAN FOR ASID MATCH                          ZA16607 22604003
***                                                             ZA16607 22614003
TGT0042  EQU   *                                                ZA16607 22624003
         LTR   RTSB,RTSB                ANY MORE TSB'S          ZA16607 22634003
         BZ    TGT6800                  NO MORE. TERMINAL CAN'T ZA16607 22644003
*                                       BE FOUND. RETURN TO     ZA16607 22654003
*                                       CALLER                  ZA16607 22664003
         L     RASCB,TSBASCBA           GET  ASCB POINTER       ZA16607 22674003
         CH    RWRK4,ASCBASID           SAME ASID?              ZA16607 22684003
         BE    TGT0055                  YES, THIS IS IT         ZA16607 22694003
*                                                               ZA16607 22704003
         L     RTSBX,TSBEXTNT           GET ADDRESS OF TSB      ZA16607 22714003
*                                       EXTENSION               ZA16607 22724003
         USING TSBX,RTSBX                                       ZA16607 22734003
         L     RTSB,TSBXFWD             GET TSB POINTER TO      ZA16607 22744003
*                                       NEXT IN LIST            ZA16607 22754003
         B     TGT0042                                          ZA16607 22764003
***                                                             ZA16607 22774003
***                SCAN FOR USERID MATCH                        ZA16607 22784003
***                                                             ZA16607 22794003
TGT0050  EQU   *                                                ZA16607 22804003
         L     RWRK1,XSAUSERP           GET POINTER TO USERID   ZA16607 22814003
TGT0052  EQU   *                                                ZA16607 22824003
         LTR   RTSB,RTSB                ANY MORE TSB'S          ZA16607 22834003
         BZ    TGT6800                  NO MORE.TERMINAL CAN'T  ZA16607 22844003
*                                       BE FOUND. RETURN TO     ZA16607 22854003
*                                       CALLER                  ZA16607 22864003
         L     RASCB,TSBASCBA           GET ASCB POINTER        ZA16607 22874003
         L     RWRK,ASCBCSCB            GET CSCB POINTER        ZA16607 22884003
         USING CSCB,RWRK                                        ZA16607 22894003
         CLC   CHKEY,0(RWRK1)           COMPARE USERID S        ZA16607 22904003
         BE    TGT0054                  FOUND DESIRED ONE       ZA16607 22914003
         DROP  RWRK                                             ZA16607 22924003
         L     RTSBX,TSBEXTNT           GET ADDRESS OF          ZA16607 22934003
*                                       TSB EXTENSION           ZA16607 22944003
         L     RTSB,TSBXFWD             SET TSB POINTER TO      ZA16607 22954003
*                                       NEXT IN LIST            ZA16607 22964003
         B     TGT0052                  CONTINUE  SCAN          ZA16607 22974003
*                                                               ZA16607 22984003
TGT0054  EQU   *                                                ZA16607 22994003
***                                                             ZA16607 23004003
***                WHEN A MATCHING USERID IS FOUND,             ZA16607 23014003
***                SAVE ASID IN TPUT WORK AREA                  ZA16607 23024003
***                                                             ZA16607 23034003
         MVC   XSAPRMTJ,ASCBASID        GET DESTINATION ASID    ZA16607 23044003
*                                       SAVE IT IN WORK AREA    ZA16607 23054003
***                                                             ZA16607 23064003
***    RTSB =  DESTINATION  TSB                                 ZA16607 23074003
***                                                             ZA16607 23084003
TGT0055  SETLOCK RELEASE,TYPE=CMS,                              ZA16607-23094003
               RELATED=(TSB,IGC0009C(TGT0012))                  ZA16607 23104003
         SPACE 2                                                ZA16607 23114003
         L     RASCB,PSAAOLD-PSA        RESTORE CALLERS ASCB    ZA16607 23124003
         BAL   RWRK2,TGT0180            SET UP VTAM ESTAE       ZA16607 23134003
*                                                               ZA16607 23144003
****************************************************************ZA16607 23154003
****                                                        ****ZA16607 23164003
****               BRANCH TO IKTASTPT HOLDING THE LOCAL LOCK****ZA16607 23174003
****                                                        ****ZA16607 23184003
****************************************************************ZA16607 23194003
*                                                               ZA16607 23204003
         L     RET,VCONASTP             GET IKTASTPT'S EPA      ZA16607 23214003
         BR    RET                      GOTO IKTASTPT           ZA16607 23224003
         SPACE 2                                                ZA16607 23234003
*                                                               ZA16607 23244003
****************************************************************ZA16607 23254003
****                                                        ****ZA16607 23264003
****               NORMAL TPUT OR TGET                      ****ZA16607 23274003
****               CHECK CALLER'S TSB FOR ACCESS METHOD     ****ZA16607 23284003
****                                                        ****ZA16607 23294003
****************************************************************ZA16607 23304003
*                                                               ZA16607 23314003
TGT0100  EQU   *                                                ZA16607 23324003
         L     RTSB,ASCBTSB             GET TSB POINTER         ZA16607 23334003
         LTR   RTSB,RTSB                IS THIS A TS TASK       ZA16607 23344003
         BZ    TGT9200                  IF NOT, MAKE THIS A NOOPZA16607 23354003
*                                       USING ON TSB ALREADY    ZA16607 23364003
*                                       IN EFFECT               ZA16607 23374003
         TM    TSBFLG5,TSBVTAM          IS THIS A VTAM TSB      ZA16607 23384003
         BO    TGT0150                  YES, USE VTAM ROUTINES  ZA16607 23394003
***                                                             ZA16607 23404003
***                NORMAL TCAM REQUEST                          ZA16607 23414003
***                                                             ZA16607 23424003
         L     RTCX,CVTAQAVT            GET TCX POINTER         ZA16607 23434003
         LTR   RTCX,RTCX                IS TCAM UP              ZA16607 23444003
         BZ    TGT9200                  NO. NOOP THE REQUEST    ZA16607 23454003
         USING IEDQTCX,RTCX                                     ZA16607 23464003
         L     RRPT,TCXRPT              GET TIOCRPT POINTER     ZA16607 23474003
         LTR   RRPT,RRPT                IS TSO/TCAM UP          ZA16607 23484003
         BZ    TGT9200                  NO. NOOP THE REQUEST    ZA16607 23494003
         SPACE                                                          23504003
         BAL   RWRK2,TGT0190            SET UP TCAM ESTAE       ZA16607 23514003
         SPACE                                                          23524003
         LM    RP0,RP1,XSAPRM0          RESTORE PARM REGISTERS  ZA16607 23534003
         LTR   RP1,RP1                  IS THIS A TGET REQUEST  ZA16607 23544003
         BM    TGT0200                  IF TCAM TGET, REMAIN IN ZA16607 23554003
*                                       THIS MODULE             ZA16607 23564003
*                                                               ZA16607 23574003
****************************************************************ZA16607 23584003
****                                                        ****ZA16607 23594003
****               BRANCH TO IGG09301 HOLDING THE LOCAL LOCK****ZA16607 23604003
****                                                        ****ZA16607 23614003
****************************************************************ZA16607 23624003
*                                                               ZA16607 23634003
         L     RET,VCON9301             GET ADDRESS OF IGG09301 ZA16607 23644003
         BR    RET                      GO TO IGG09301          ZA16607 23654003
         SPACE 4                                                ZA16607 23664003
***                                                             ZA16607 23674003
***                NORMAL VTAM REQUEST                          ZA16607 23684003
***                                                             ZA16607 23694003
TGT0150  EQU   *                                                ZA16607 23704003
         L     RWRK,CVTTCASP            GET POINTER TO TCAS TBL ZA16607 23714003
         LTR   RWRK,RWRK                IS  TSO/VTAM UP         ZA16607 23724003
         BZ    TGT9200                  NO, NOOP THIS REQUEST   ZA16607 23734003
         SPACE                                                          23744003
         BAL   RWRK2,TGT0180            SET UP VTAM ESTAE       ZA16607 23754003
         SPACE                                                          23764003
         LM    RP0,RP1,XSAPRM0          RESTORE PARM REGS       ZA16607 23774003
         LTR   RP1,RP1                  IS THIS A TGET REQUEST  ZA16607 23784003
         BM    TGT0160                  BRANCH TO TGET ROUTINE  ZA16607 23794003
*                                                               ZA16607 23804003
****************************************************************ZA16607 23814003
****                                                        ****ZA16607 23824003
****               BRANCH TO IKTVTPUT HOLDING THE LOCAL LOCK****ZA16607 23834003
****                                                        ****ZA16607 23844003
****************************************************************ZA16607 23854003
*                                                               ZA16607 23864003
         L     RET,VCONVPUT             GET ADDRESS OF IKTVTPUT ZA16607 23874003
         BR    RET                      GOTO IKTVTPUT           ZA16607 23884003
*                                                               ZA16607 23894003
****************************************************************ZA16607 23904003
****                                                        ****ZA16607 23914003
****               BRANCH TO IKTVTGET HOLDING THE LOCAL LOCK****ZA16607 23924003
****                                                        ****ZA16607 23934003
****************************************************************ZA16607 23944003
*                                                               ZA16607 23954003
TGT0160  EQU   *                                                ZA16607 23964003
         L     RET,VCONVGET             GET ADDRESS OF IKTVTGET ZA16607 23974003
         BR    RET                      GOTO IKTVTGET           ZA16607 23984003
         EJECT                                                  ZA16607 23994003
*                                                               ZA16607 24004003
****************************************************************ZA16607 24014003
****                                                        ****ZA16607 24024003
****               SET UP FOR VTAM TGET/TPUT ESTAE          ****ZA16607 24034003
****                                                        ****ZA16607 24044003
****************************************************************ZA16607 24054003
*                                                               ZA16607 24064003
TGT0180  EQU   *                                                ZA16607 24074003
****                                                            ZA16607 24084003
****               RWRK2 CONTAINS RETURN ADDRESS                ZA16607 24094003
****                                                            ZA16607 24104003
         L     RWSA,ASCBASXB            GET ASXB POINTER        ZA16607 24114003
         USING ASXB,RWSA                ASXB ADDRESSABLE        ZA16607 24124003
         L     RWSA,ASXBSPSA            GET WSA VECTOR TABLE    ZA16607 24134003
         DROP  RWSA                     ASXB NOT ADDRESSABLE    ZA16607 24144003
         USING WSAL,RWSA                WSA VECTOR TBL BASE     ZA16607 24154003
         L     RWSA,WSALSTAE            GET ESTAE WORK SAVE ADD ZA16607 24164003
         DROP  RWSA                                             ZA16607 24174003
         MVC   XSAESTAL,ESTAELST        MOVE ESTAE LIST TO WA   ZA16607 24184003
         SPACE 1                                                        24194003
         L     RESTAE,VCONESTE          GET ADDRESS OF SVC'S    ZA16607 24204003
*                                       ESTAE FOR VTAM          ZA16607 24214003
         TM    XSAFLAG,XSATCBFX         SHOULD TCBFX BE RESET   ZA16607 24224003
         BZ    TGT0184                  NO, DON'T RESET         ZA16607 24234003
         SPACE 2                                                        24244003
         ESTAE (RESTAE),TERM=YES,BRANCH=YES,ASYNCH=YES,         ZA16607-24254003
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     ZA16607 24264003
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 24274003
         SPACE                                                          24284003
TGT0184  EQU   *                                                ZA16607 24294003
         ESTAE (RESTAE),TERM=YES,BRANCH=YES,ASYNCH=NO,          ZA16607-24304003
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     ZA16607 24314003
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 24324003
*                                                               ZA16607 24334003
         SPACE 2                                                        25900020
*********************************************************************** 25950002
***                                                                     25960002
***                 SET UP FOR TCAM TGET/TPUT ESTAE             ZA16607 25970003
***                                                                     25980002
*********************************************************************** 25990002
TGT0190  EQU   *                                                ZA16607 25990403
****                                                            ZA16607 25990803
****               RWRK2 CONTAINS RETURN ADDRESS                ZA16607 25991203
****                                                            ZA16607 25991603
         L     RWSA,ASCBASXB            GET ASXB POINTER        YS02019 25992002
         USING ASXB,RWSA                ASXB ADDRESSABLE        YS02019 25993003
         L     RWSA,ASXBSPSA            GET WSA VECTOR TABLE    YS02019 25994003
         DROP  RWSA                     ASXB NOT ADDRESSABLE    YS02019 25995003
         USING WSAL,RWSA                WSA VECTOR TBL BASE     YS02019 25996003
         L     RWSA,WSALSTAE            GET ESTAE WORKSAVE ADR  YS02019 25997003
         DROP  RWSA                                             YS02019 25998003
         MVC   XSAESTAL,ESTAELST        MOVE ESTAE LIST TO WA   YS02019 25998103
         SPACE                                                          25999203
         TM    XSAFLAG,XSATCBFX         SHOULD TCBFX BE  RESET  YM05366 26004203
         BZ    TGT0194                  NO, DON'T RESET         ZA16607 26009203
         ESTAE TGT9500,TERM=YES,BRANCH=YES,ASYNCH=YES,          YS02019X26049202
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     YS02019 26049602
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 26049703
         SPACE 1                                                        26049803
TGT0194  EQU   *                                                YS02019 26055803
         ESTAE TGT9500,TERM=YES,BRANCH=YES,ASYNCH=NO,           YS02019X26062202
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     YS02019 26068202
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 26071203
         SPACE 3                                                        26075002
         EJECT                                                          34900020
         SPACE 2                                                        35000020
*********************************************************************** 35100020
*****                                                             ***** 35200020
*****               TGET ROUTINE                                  ***** 35300020
*****                                                             ***** 35400020
*********************************************************************** 35500020
TGT0200  EQU   *                                                        35600020
         LTR   RTSB,RTSB                IS THIS A TS TASK       YS02019 35700002
         BZ    TGT9200                  IF NOT MAKE THIS A NOP          35800020
         STH   RTJID,XSAPRMTJ           SAVE TJID                M0094  36600021
         SPACE 2                                                YS02019 36601602
***                                                             YS02019 36602402
***                 GET CMS LOCK, SO TCAM WON'T GO DOWN, AND    YS02019 36603202
***                 SO TSB WILL BE CONSTANT                     YS02019 36604002
***                                                             YS02019 36604802
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*36605602
               RELATED=(TSB,IGC0009C(TGT0340))                  YS02019 36606002
         DROP  RTCX                     SETLOCK DESTROYS 11-14  YS02019 36656002
         LH    RTJID,XSAPRMTJ           GET ASID                YS02019 36706002
         SPACE 1                                                        36920020
***                                                                     36940020
***                 CHECK EXCEPTIONAL CONDITIONS                        36960020
***                                                                     36980020
TGT0210  EQU   *                                                        37000020
         L     RTCX,CVTAQAVT            GET TCX POINTER         YS02019 37002002
         USING IEDQTCX,RTCX                                     YS02019 37004002
         TM    CVTTCMFG,CVTTCRDY        IS TCAM STILL AROUND            37010020
         BNO   TGT6800                  NO, ABORT THIS REQUEST          37020020
         L     RRPT,TCXRPT              GET RPT POINTER AGAIN   YS02019 37020402
         TM    TSBFLG4,TSBCANC          IS USER CANCELLED       YS02019 37025002
         BNZ   TGT6800                  YES, ABORT TGET         YS02019 37027002
         TM    TSBFLG4,TSBHUNG          DID USER HANG UP        YS02019 37027402
         BO    TGT0320                  YES, ENTER IWAIT        YS02019 37027802
TGT0215  EQU   *                                                YS02019 37029002
         LTR   RRPT,RRPT                SEE IF RPT IS THERE     YS02019 37033002
         BZ    TGT6800                  NOT THERE, ABORT REQ    YS02019 37043002
         TM    TCBTSFLG,TCBTIOTG        HAS ATTN BEEN HIT               37050020
         BO    TGT7500                  YES, GIVE ATTN RETURN CODE      37060020
         SPACE 3                                                        37070002
*********************************************************************** 37080002
***                                                                 *** 37090002
***                DETERMINE WHETHER DATA IS AVAILABLE              *** 37092002
***                                                                 *** 37094002
*********************************************************************** 37096002
         L     RBUF,TSBITBFP-K1         TRAILER QUEUE POINTER           37100020
         LA    RBUF,0(,RBUF)            CLEAR FIRST BYTE        YS02019 37200002
         LTR   RBUF,RBUF                ANYTHING ON QUEUE               37300020
         BNZ   TGT0450                  IF DATA GO PROCESS IT           37400020
         L     RBUF,TSBIBFP-K1          INPUT QUEUE POINTER             37500020
         LA    RBUF,K0(R0,RBUF)         CLEAR FIRST BYTE                37600020
         LTR   RBUF,RBUF                IS QUEUE EMPTY                  37700020
         BNZ   TGT0400                  IF NOT PROCESS                  37800020
         SPACE 2                                                        37900020
TGT0220  EQU   *                                                        38000020
***                                                                     38100020
***                 NO DATA AVAILABLE. ASK FOR SOME                     38200021
***                                                                     38300020
         LA    RWRK2,TGT0320            SET RETURN ADDRESS      YS02019 39360002
         SPACE 3                                                YS02019 39363502
TGT0245  EQU   *                                                YS02019 39364002
*********************************************************************** 39364402
***                                                                 *** 39365602
***                 SUBROUTINE TO TPOST TSB TO IEDAYP               *** 39367602
***                                                                 *** 39367702
*********************************************************************** 39367802
         NI    TSBSTAT,OFF-TSBLWAIT     REMOVE PSEUDO-LWAIT     YS02019 39368002
*                                       THAT MIGHT HAVE BEEN    YS02019 39369202
*                                       SET BY TCLEARQ          YS02019 39370402
         LM    RP0,RP1,TSBTPOST         GET TPOSTING FIELD      YS02019 39371602
TGT0250  EQU   *                                                YS02019 39372802
         STM   RP0,RP1,XSAWD6           STORE, TO SET BITS      YS02019 39374002
         LA    RWRK1,XSAWD6             GET ADDRESSABILITY      YS02019 39375202
         USING TSBTPOST,RWRK1           REFERENCES TO TSBTPOST  YS02019 39376402
*                                       WILL REALLY BE TO XSA,  YS02019 39377602
*                                       SINCE DISPLACEMENT IS   YS02019 39378802
*                                       SMALLER                 YS02019 39380002
         TM    TIOCFLG,TIOCSYLW         IS SYSTEM IN LWAIT      YS02019 39381202
         BO    TGT0255                  YES, SKIP               YS02019 39382402
         NI    TSBF1V,OFF-QCBNOBUF      ALLOW INPUT             YS02019 39383602
         OI    TSBF1M,QCBNOBUF          TELL AYP TO CHANGE THIS YS02019 39384802
*                                       BIT                     YS02019 39386002
TGT0255  EQU   *                                                YS02019 39387202
         OI    TSBF1V,QCBTGET           REQUEST DATA            YS02019 39388402
         OI    TSBF1M,QCBTGET           TELL AYP TO CHANGE      YS02019 39389602
         OI    TSBTPFLG,TSBTPQCB+TSBPOSTO TELL AYP WHAT TO DO   YS02019 39390802
         LM    RBUF,RCVT,TSBTPOST       GET NEW BITS IN REG     YS02019 39392002
         DROP  RCVT                                             YS02019 39393202
         DROP  RWRK1                    NOW REFERENCE TSB       YS02019 39394402
         CDS   RP0,RBUF,TSBTPOST        EXCHANGE BIT-SETTINGS   YS02019 39395602
         BNE   TGT0250                  RELOAD IF NO GOOD       YS02019 39396802
         SPACE 3                                                YS02019 39398002
***                                                             YS02019 39399202
***                 TPOST TSB TO IEDAYP, IF TSBPOSTO WAS NOT ON YS02019 39400402
***                 DURING THE COMPARE-AND-SWAP                 YS02019 39401602
***                                                             YS02019 39402802
         L     RCVT,CVTPTR              RESTORE CVT POINTER     YS02019 39406802
         USING CVT,RCVT                                         YS02019 39407202
         LTR   RP0,RP0                  WAS TSBPOSTO ON - NOTE  YS02019 39407302
*                                       THIS TEST SENSITIVE TO  YS02019 39407402
*                                       POSITION OF TSBPOSTO    YS02019 39407502
         BMR   RWRK2                    YES, RETURN TO CALLER   YS02019 39407602
         SPACE 3                                                YS02019 39408802
         L     RTCX,CVTAQAVT            GET TCX POINTER         YS02019 39481402
         USING IEDQTCX,RTCX                                     YS02019 39531402
         L     RWRK,TCXTSI              PTR TO TSINPUT'S QCB    YS02019 39581402
         USING IEDQTSI,RWRK                                     YS02019 39631402
         LA    RWRK,TSITSAP-(QCBSTVTO-IEDQQCB)                  YS02019 39681402
*                                       ADDRESS OF AYP'S 'QCB'  YS02019 39731402
         DROP  RWRK                                             YS02019 39741402
         ST    RWRK,TSBRQCB                                     YS02019 39781402
         LA    RWRK1,TSBRCB             ADDRESS OF ELEMENT      YS02019 39831402
         L     RWRK,TCXREADY            GET OLD HEAD POINTER    YS02019 39881402
TGT0260 EQU    *                                                YS02019 39931402
         ST    RWRK,TSBLINKA            STORE IN LINK FIELD     YS02019 39981402
         MVI   TSBPRI,PRIDESTQ          SET PRIORITY            YS02019 39991402
         CS    RWRK,RWRK1,TCXREADY      PUT NEW ELEM ON QUEUE   YS02019 40031402
         BNE   TGT0260                  IF CHANGED, TRY AGAIN   YS02019 40081402
         SPACE 2                                                YS02019 40131402
***                                                             YS02019 40181402
***                 POST TCAM'S ECB                             YS02019 40191402
***                                                             YS02019 40201402
         SR    RRPT,RRPT                COMPLETION CODE         YS02019 40231402
         LA    RTJID,CVTBRET            'ERRET' ADDRESS         YS02019 40331402
         L     RAVT,TCXASCB             LOAD ASCB OF TCAM       YS02019 40381402
         LR    R0,RTCX                  SAVE TCX POINTER        YS02019 40431402
         L     RTCX,TCXAVT              AVT POINTER             YS02019 40481402
         USING IEDQAVTD,RTCX                                    YS02019 40531402
         LA    RTCX,AVTOSECB            ECB POINTER ** NOTE     YS02019 40581402
*                                       THAT AVT IS NOT REALLY  YS02019 40631402
*                                       ADDRESSABLE **          YS02019 40681402
         DROP  RTCX                                             YS02019 40691402
         O     RTCX,HIGHON              HI-ORDER BIT=XMPOST     YS02019 40731402
         L     RET,CVT0PT01             POST ROUTINE ADDRESS    YS02019 40781402
         BALR  RETURN,RET               GO POST                 YS02019 40831402
         SPACE 2                                                YS02019 40881402
         LR    RTCX,R0                  RESTORE TCX PTR         YS02019 40931402
         USING IEDQTCX,RTCX                                     YS02019 40981402
         LH    RTJID,ASCBASID           RESTORE TJID            YS02019 41031402
         L     RASCB,TSBASCBA           RESTORE ASCB POINTER    YS02019 41081402
         L     RRPT,TCXRPT              RESTORE RPT POINTER     YS02019 41131402
         BR    RWRK2                    RETURN TO MAINLINE      YS02019 48100002
         SPACE 2                                                        49200020
TGT0320  EQU   *                                                        49300020
***                                                                     49810020
***                 ENTER IWAIT IF WAIT OPTION SPECIFIED                49820020
***                                                                     49830020
         TM    XSAOPTNS,MWAIT           WAS 'WAIT' SPECIFIED     M0094  49840021
         BZ    TGT0340                  YES, GO WAIT                    49850020
         LA    RCODE,RC04               NOWAIT RETURN CODE              49860020
         SR    RP1,RP1                  LENGTH OF DATA                  49866020
         B     TGT9000                  GO TO EXIT                      49872020
TGT0340  EQU   *                                                        49880020
***                                                             YS02019 49881002
***            INFORM SYSTEM RESOURCE MANAGER OF WAIT           YS02019 49881502
***                                                             YS02019 49881603
         LA    RP1,0(,RP1)                INDICATE IWAIT TO SRM ZA12514 49881703
         LA    RSAVE,TIOCSAVE           SAVE AREA FOR SYSEVENT  YS02019 49882402
         SYSEVENT TERMWAIT,ASIDL=ASCBASID,ENTRY=BRANCH          YM03948 49882502
         SPACE 2                                                YS02019 49883002
***                                                             YS02019 49883502
***                 SET UP RESUME ENVIRONMENT                   YS02019 49884002
***                                                             YS02019 49884502
         STM   R0,RCODE,TCBGRS          SAVE ALL REGISTERS      YS02019 49885002
         LA    RET,TGT0350              RESUME ADDRESS          YS02019 49885402
         ST    RET,RBOPSW2              SET UP RESUME PSW       YS02019 49886502
         SPACE 2                                                YS02019 49887002
***                                                             YS02019 49887502
***                 BRANCH TO 'STATUS' ROUTINE TO SET UP WAIT.  YS02019 49888002
***                 STATUS WON'T RETURN CONTROL UNTIL DATA HAS  YS02019 49888502
***                 BEEN MADE AVAILABLE.                        YS02019 49889002
***                                                             YS02019 49889502
***      LOCAL LOCK IS HELD AT ENTRY TO STATUS, NO LOCK IS      YS02019 49889902
***      HELD UPON RETURN FROM STATUS                           YS02019 49896602
***                                                                     49896702
         OI    TSBFLG4,TSBIWAIT         REASON FOR NONDISP      YS02019 49896802
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGC0009C(TGT0200))       49899902
         L     RWRK,CVTABEND            SECONDARY CVT POINTER   YS02019 49903002
         USING SCVTSECT,RWRK                                    YS02019 49906102
         LR    RP1,RTCB                 FOR STATUS ROUTINE      YS02019 49909202
         LA    RP0,SDTCB                ENTRY CODE FOR STATUS   YS02019 49912302
         L     RWRK1,SCVTSTAT           BRANCH ENTRY ADDRESS    YS02019 49915402
         LA    RAVT,NDISPBIT            NONDISPATCHABILITY MASK YS02019 49918502
         BALR  RETURN,RWRK1             GO TO STATUS ROUTINE    YS02019 49921602
         SPACE 3                                                YS02019 49924702
***                                                             YS02019 49927802
***                 REOBTAIN LOCKS ON RETURN FROM STATUS        YS02019 49930902
***                                                             YS02019 49934002
TGT0350  EQU   *                                                YS02019 49937102
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YS02019*49940202
               RELATED=(TSB,IGG09303(TGT4000),IGC0009C(TGT9100))YS02019 49943302
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*49946402
               RELATED=(TSB,IGG09303(TGT4000),IGC0009C(TGT9100))YS02019 49949502
         B     TGT0210                  RECHECK BFR AVAIL       YS02019 53440002
         SPACE 2                                                        53900020
TGT0400  EQU   *                                                        54000020
*********************************************************************** 54100020
*****                                                             ***** 54200020
*****               SET UP FOR MOVE AND EDIT OF DATA              ***** 54300020
*****                                                             ***** 54400020
*********************************************************************** 54500020
         SPACE 2                                                        54600020
         USING TIOCBUF,RBUF                                             54700020
         TM    BUFFFL2,BUFFFRAG         IS MSG COMPLETE                 54800020
         BO    TGT0220                  IF NOT                          54900020
         SPACE 2                                                        55000020
TGT0450  EQU   *                                                        55100020
***                                                                     55200020
***                                                             YS02019 55300002
***                                                                     55400020
         LA    RP0,EDITCODE             ENTRY CODE                      55500020
         L     RET,TIOCQTIP             BRANCH ENTRY TO QTIP    YS02019 55600002
         STM   RCVT,RTCB,XSAUBFRP       SAVE REG.S 3-4          YS02019 55610002
         STM   RBASE,RTSB,XSAWD6        SAVE REG.S 6-9          YS02019 55620002
         OI    XSAF,XSADMOVE            SHOW DATA MOVEMENT      YS02019 55650002
         BALR  RETURN,RET               GO TO QTIP                      55700020
         NI    XSAF,OFF-XSADMOVE        SHOW MOVE ALL DONE      YS02019 55740002
         LM    RCVT,RTCB,XSAUBFRP       RESTORE REGS 3-4        YS02019 55790002
         LM    RBASE,RTSB,XSAWD6        RESTORE REG.S 6-9       YS02019 55792002
         L     RTCX,CVTAQAVT            RESTORE TCX ADDR        YS02019 55794002
         L     RRPT,TCXRPT-IEDQTCX(,RTCX) RESTORE TIOCRPT ADDR  YS02019 55796002
         SPACE 2                                                        55800020
*********************************************************************** 55900020
***                                                                 *** 56000020
***                 REGISTER CONTENTS AT ENTRY TO QTIP              *** 56100020
***      REG 0 ENTRY CODE    REG 2 TS BFR PTR    REG 3 CVT PTR      *** 56200002
***      REG 4 TCB PTR       REG 5 SVRB PTR      REG 8 ASCB PTR     *** 56300002
***      REG 9 TSB PTR       REG 10 TIOCRPT PTR  REG 11 TCX PTR     *** 56400002
***                                                                 *** 56500020
*********************************************************************** 56600020
         SPACE 2                                                        56700020
***                                                                     56800020
***                 UPON RETURN FROM EDIT CHECK IF SMF IN EFFECT        56900020
***                                                                     57000020
         NC    TCBTCT,TCBTCT            IS SMF UP                       57200020
         BZ    TGT1000                  IF NOT                          57400020
         SPACE 2                                                        57500020
***                                                                     57600020
***                 UPDATE LINE COUNT FOR SMF                           57700020
***                                                                     57800020
         L     RWRK,TCBTCT              GET TCT POINTER                 57850020
         USING SMFTCT,RWRK                                              57900020
         L     RWRK1,TCTLIN             GET INPUT LINE COUNT            58000020
         LA    RWRK1,K1(R0,RWRK1)       ADD ONE TO COUNT                58100020
         ST    RWRK1,TCTLIN             UPDATE COUNT                    58200020
         DROP  RWRK                                                     58300020
         SPACE 2                                                        58400020
TGT1000  EQU   *                                                        58500020
         SPACE 2                                                YS02019 58520002
***                                                             YS02019 58530002
***           INFORM SYSTEM RESOURCE MANAGER OF COMPLETED TGET  YS02019 58540002
***                                                             YS02019 58550002
         STM   RP0,RP1,XSAUBFRP         SAVE QTIP RET CODE & CNT M0094  58900021
         CLI   XSAUBFRP+K3,RC0C         WAS RC FROM QTIP 12 (NOT M0094  59260021
*                                       ALL DATA MOVED)                 59320021
         BNE   TGT1020                  IF ALL DATA MOVED        M0607  59400020
         LA    RWRK1,PARTT              PARTIAL FLAG                    59460020
         SLL   RWRK1,20                 SHIFT TO HI-ORDER               59520020
         OR    RP1,RWRK1                ADD FLAG TO COUNT               59600020
TGT1020  EQU   *                                                        59700020
         LA    RSAVE,TIOCSAVE           SAVE AREA FOR SYSEVENT  YS02019 59720002
         SYSEVENT TGETTPUT,ASIDL=ASCBASID,ENTRY=BRANCH          YS02019 59740002
         SPACE 2                                                        60000020
***                                                                     60100020
***                REMOVE LWAIT IF POSSIBLE                             60200020
***                                                                     60300020
         TM    TSBSTAT,TSBLWAIT         IS USER IN LWAIT                60400020
         BZ    TGT2000                  IF NOT                          60500020
         SR    RWRK1,RWRK1              CLEAR REGISTER                  60600020
         IC    RWRK1,TSBNIBF            NO. OF BFRS ON INPUT Q          60700020
         CH    RWRK1,TIOCRSTH           IF NIBF LTE RSTH, LWAIT         60900020
         BH    TGT2000                  IF LWAIT NOT LEAVABLE           61200020
         NI    TSBSTAT,OFF-TSBLWAIT     SHOW LWAIT REMOVED       M1800  61250021
         LA    RWRK2,TGT2000            RETURN ADDRESS          YS02019 61450002
         TM    TSBFLG3,TSBNOBRK         NOBREAK TERMINAL        YS02019 61550002
         BNO   TGT0245                  TPOST TSB TO UNLOCK KB  YS02019 61650002
         SPACE 2                                                        63700020
TGT2000  EQU   *                                                        63800020
         LM    RP0,RP1,XSAUBFRP         RESTORE CODE AND COUNT   M0094  63900021
         LR    RCODE,RP0                RETURN CODE                     64000020
         NC    TIOCNFBF,TIOCNFBF        ARE THERE ANY FREE TS BUFFERS   64030020
         BZ    TGT9000                  EXIT IF NONE                    64060020
         TM    TIOCFLG,TIOCTJBF+TIOCSYLW+TIOCNOBF                       64100020
*                                       IN ANY OF THESE WAITS           64200020
         BZ    TGT9000                  EXIT IF NOT (OTHERWISE,  M0094  64300021
*                                       XCTL TO IGG09303)               64400002
         ST    RP1,XSAPRM0              SAVE DATA COUNT          M0094  64500021
         ST    RCODE,XSAPRM1            SAVE RETURN CODE         M0094  64600021
         SPACE 2                                                        64700020
*********************************************************************** 64800020
*****                                                             ***** 64900020
*****    BRANCH TO IGG09303 HOLDING BOTH CMS AND LOCAL LOCKS      ***** 64950002
*****                                                             ***** 65100020
*********************************************************************** 65200020
         SPACE 2                                                        65300002
         L     RET,VCON9303             GET IGG09303'S EPA      YS02019 65350002
         BR    RET                      GO TO IGG09303          YS02019 65400002
         SPACE 2                                                        65900020
TGT6800  EQU   *                                                        66000020
***                                                                     66100020
***                 USER HUNG UP RETURN                                 66200020
***                                                                     66300020
         LA    RCODE,RC14               LOAD RETURN CODE                66400020
         B     TGT9000                  GO TO RETURN                    66500020
         SPACE 2                                                        66600020
TGT7000  EQU   *                                                        66700020
***                                                                     66800020
***                 ILLEGAL PARAMETER RETURN                            66900020
***                                                                     67000020
         LA    RCODE,RC10               RETURN CODE                     67100020
         B     TGT9000                  GO TO EXIT                      67200020
         SPACE 2                                                        68200020
TGT7500  EQU   *                                                        68300020
***                                                                     68400020
***                 ATTN HIT RETURN                                     68500020
***                                                                     68600020
         LA    RCODE,RC08               RETURN CODE                     68700020
         SPACE 2                                                        68800020
TGT9000  EQU   *                                                        68900020
***                                                                     69000020
***                 RESET TCB ATTENTION INDR PRIOR TO RETURN            69100020
***                                                                     69200020
         NI    TCBTSFLG,OFF-TCBTIOTG    TURN OFF ATTN INDR              69300020
         TM    XSAFLAG,XSATCBFX         SHOULD WE TURN OFF TCBFX M0094  69380021
         BZ    TGT9100                  IF NOT, DON'T                   69460020
         NI    TCBFLGS1,OFF-TCBFX       ALLOW ASYNCHRONOUS EXITS        69500020
TGT9100  EQU   *                                                        69550020
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGC0009C(TGT0350))       69560002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,IGC0009C(TGT0350))     69562002
         L     RETURN,XSARETRG          GET RETURN ADDRESS      YS02019 69566002
         BR    RETURN                   RETURN                  YS02019 69574002
         SPACE 2                                                        69700020
*****                                                                   69720020
*****               NOP TGET/TPUT FOR NON-TSO TASKS                     69740020
*****                                                                   69760020
TGT9200  EQU   *                                                        69800020
         SR    RCODE,RCODE              GIVE ZERO RETURN CODE           69900020
         SR    RP1,RP1                  NO DATA MOVED           YM07152 69950002
         B     TGT9000                  EXIT                            70000020
         DROP  RBASE                    MODULE NOT ADDRESSABLE  YS02019 70002002
         SPACE 5                                                        70010002
*********************************************************************** 70050002
***                                                                 *** 70052002
***                 ESTAE EXIT ROUTINE FOR TGET/TPUT                *** 70060002
***                                                                 *** 70070002
***      UPON RECEIVING CONTROL FROM RTM, THE FOLLOWING             *** 70070602
***      CONDITIONS EXIST -                                         *** 70070702
***                                                                 *** 70070802
***      * SUPERVISORY STATE                                        *** 70070902
***      * IN SUPERVISOR'S KEY                                      *** 70073102
***      * NO LOCKS ARE HELD                                        *** 70075002
***                                                                 *** 70076502
***      REGISTER CONTENTS -                                        *** 70078002
***                                                                 *** 70079502
***      REGISTER  0 - RETURN CODE (12 MEANS SDWA NOT AVAILABLE)    *** 70081002
***      REGISTER  1 - ADDRESS OF SDWA                              *** 70082502
***      REGISTER 13 - SAVE AREA                                    *** 70084002
***      REGISTER 14 - RETURN ADDRESS                               *** 70085502
***                                                                 *** 70087002
*********************************************************************** 70088502
TGT9500  EQU   *                                                YS02019 70090002
         BALR  RBASE,R0                 SET UP BASE REGISTER    YS02019 70090402
         USING *,RBASE                  MODULE ADDRESSABLE      YS02019 70090802
         C     R0,NOSDWA                IS SDWA AVAILABLE       YS02019 70092002
         BE    TGT9590                  NO, NOTHING CAN BE DONE YS02019 70094002
         SPACE 1                                                        70094102
         SAVE  (14,12)                  SAVE REGISTERS 14-12    YS02019 70096002
         USING SDWA,RSDWA               SDWA ADDRESSABILITY     YS02019 70098002
         L     RSVRB,SDWAPARM           GET ADDR OF SVRB        YS02019 70098502
         LR    RWRK2,RP1                SAVE SWDA ADDRESS       VS08528 70098902
         SPACE 3                                                        70100502
***                                                                     70104902
***            IF PROGRAM CHECK OCCURRED BECAUSE OF BAD BUFFER          70106902
***            ADDRESS, CHANGE THE COMPLETION CODE TO 15D               70107302
***                                                                     70110102
         TM    XSAF,XSADMOVE            DID DATA MOVE OCCUR     YM05387 70111902
         BZ    TGT9520                  NO, DON'T CHANGE        YM05387 70112702
*                                       COMPLETION CODE         YM05387 70113102
         TM    SDWAERRA,SDWAPCHK        DID PROGRAM CHECK OCCUR YM05387 70113502
         BZ    TGT9520                  NO, DON'T CHANGE        YM05387 70113902
         L     RWRK02,SDWACMPF          GET COMPLETION CODE     YM05387 70114302
         LA    RWRK02,K0(,RWRK02)       CLEAR FLAG BYTE         YM05387 70114402
         SRL   RWRK02,K12               PUT COMPLETION CODE     YM05387 70114502
*                                       IN LOW ORDER            YM05387 70115402
         C     RWRK02,CCODE0C4          CHECK FOR 0C4           YM05387 70115802
         BE    TGT9510                  YES, CHANGE CODE        YM05387 70116202
         C     RWRK02,CCODE0C5          CHECK FOR 0C5           YM05387 70116602
         BE    TGT9510                  YES, CHANGE CODE        YM05387 70117002
         C     RWRK02,CCODE0D0          CHECK FOR 0D0           YM05387 70117102
         BE    TGT9510                  YES, CHANGE CODE        YM05387 70117202
         C     RWRK02,CCODE0D1          CHECK FOR 0D1           YM05387 70117602
         BNE   TGT9520                  NO, NO CHANGE CODE      YM05387 70118002
         SPACE 1                                                        70118102
TGT9510  EQU   *                                                        70118502
         OI    XSAFLAG2,XSA15D          REMEMBER TO CHANGE      YM05387 70118602
*                                       COMPLETION CODE         YM05387 70118702
         SPACE 1                                                        70121202
***                                                             YS02019 70121802
***            IF ASID TPUT DEQUEUE THE ASID                    YS02019 70122402
***                                                             YS02019 70124502
TGT9520  EQU   *                                                YS02019 70127802
         TM    XSAF,XSAIDENQ            IS ASID ENQUEUED        YS02019 70131102
         BZ    TGT9530                  NO, NO NEED TO DEQ      YS02019 70134402
         LA    RP1,XSAENQAD             ADDR OF DEQ WORK AREA   YS02019 70153202
         MVC   XSAENQNM(K12),QNAME      RESET ENQ/DEQ QNAME     YM03998 70163202
         DEQ   (XSAENQNM,XSAPRMTJ,2,SYSTEM),RET=HAVE,MF=(E,(1)) YS02019 70168502
         SPACE 3                                                        70183802
TGT9530  EQU   *                                                YS02019 70199102
         LR    RASCB,RSAVE              SAVE RTM'S SAVE AREA    YM08216 70199202
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,    * GET LOCAL  YM08216-70199302
               RELATED=(TIOCRPT,IGC0009C(TGT9534)) * LOCK       YM08216 70199402
         SPACE 1                                                        70199502
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,      * GET CMS    YM08216-70209402
               RELATED=(TIOCRPT,IGC0009C(TGT9534)) * LOCK       YM08216 70219402
         SPACE 1                                                        70219502
         L     RTCB,CVTPTR              GET CVT ADDRESS         YS02019 70219702
         L     RRPT,CVTAQAVT-CVT(,RTCB) GET TCX ADDRESS         YS02019 70229702
         LA    RRPT,K0(,RRPT)           CLEAR HI ORDER BYTE     YM08216 70231702
         LTR   RRPT,RRPT                IS TCAM UP              YM08216 70233702
         BZ    TGT9534                  NO, TCAM IS GONE        YM08216 70235702
         L     RRPT,TCXRPT-IEDQTCX(,RRPT) GET TIOCRPT ADDRESS   YS02019 70239702
         LTR   RRPT,RRPT                IS TS STILL UP          YM08216 70241702
         BZ    TGT9534                  NO, TS IS GONE          YM08216 70243702
         L     RTCB,CVTTCBP-CVT(,RTCB)  ADDRESS OF TCB WORD     YS02019 70249702
         L     RWRK3,K4(,RTCB)          PASS ABENDING TASK'S    YM08216 70259702
*                                       TCB IN REGISTER 3       YM08216 70295802
         L     RJSCB,PSAAOLD-PSA        GET ASCB ADDRESS        YS02019 70297802
         LH    RWRK02,ASCBASID-ASCB(,RJSCB) GET CALLER'S ASID   YS02019 70298202
         SPACE 2                                                YS02019 70315502
***                                                             YS02019 70321202
***            GO TO QTIP 29 TO CLEAN UP TSB VIA BRANCH ENTRY   YS02019 70326902
***                                                             YS02019 70332602
***            INTERFACE WITH QTIP 29                           YS02019 70338302
***                                                             YS02019 70344002
***            REGISTER  0 HAS ENTRY CODE                       YS02019 70349702
***            REGISTER  2 HAS ASID OF ABENDING TASK            YS02019 70369702
***            REGISTER  3 HAS TCB ADDRESS OF ABENDING TASK     YS02019 70379702
***            REGISTER 14 HAS RETURN ADDRESS                   YS02019 70381702
***            REGISTER 15 HAS QTIP BRANCH ENTRY ADDRESS        YS02019 70383702
***                                                             YS02019 70385702
***            REGISTERS 5 THROUGH 8 ARE PRESERVED ACROSS       YS02019 70387702
***            QTIP 29 CALL                                     YS02019 70388102
***                                                             YS02019 70389702
         LA    R0,CLEANTSB              ENTRY CODE              YS02019 70394102
         L     RWRK1,TIOCQTIP           QTIP BRANCH ADDRESS     YS02019 70394502
         BALR  RETURN,RWRK1             GO TO QTIP 29           YS02019 70395702
         SPACE 3                                                        70395802
***                                                                     70396102
***            UPON RETURN FROM QTIP 29, RESTORE REGISTERS              70396502
***                                                                     70396902
TGT9534  EQU   *                                                YS02019 70397002
         SETLOCK RELEASE,TYPE=CMS,                 * FREE CMS   YS02019-70397102
               RELATED=(TIOCRPT,IGC0009C(TGT9532)) * LOCK       YS02019 70397302
         SPACE 1                                                        70407302
         SETLOCK RELEASE,TYPE=LOCAL,               * FREE LOCAL YS02019-70417302
               RELATED=(TIOCRPT,IGC0009C(TGT9532)) * LOCK       YS02019 70420702
         SPACE 1                                                        70422702
         LR    RSAVE,RASCB              RESTORE RTMS' SAVEAREA  YS02019 70424102
         LR    RSDWA,RWRK2              RESTORE SDWA ADDRESS    YS02019 70427502
         SPACE 3                                                YS02019 70437602
***                                                                     70447702
***            CHANGE THE COMPLETION CODE TO 15D                        70458102
***                                                                     70458502
         TM    XSAFLAG2,XSA15D          SHOULD COMPLETE CODE BE YM05387 70508502
*                                       CHANGED TO 15D          YM05387 70558502
         BZ    TGT9570                  NO, DON'T CHANGE        YM05387 70608502
         LA    RWRK02,CCODE15D          RESET ABEND CODE TO 15D YM05387 70658502
         SPACE 1                                                        70808502
         SETRP RC=0,COMPCOD=((RWRK02),SYSTEM)                   YS02019-70865502
                                        CONTINUE TERMINATION    YS02019 70867502
         B     TGT9580                  READY TO GO BACK TO RTM YM05387 70877502
         SPACE 1                                                YS02019 70899002
TGT9570  EQU   *                                                        70909002
         SETRP RC=0                     CONTINUE TERMINATION    YM05387 70919002
         SPACE 1                                                        70929002
TGT9580  EQU   *                                                        70931002
         LM    RETURN,RTJID,WORD4(RSAVE)   RESTORE REGISTERS    YS02019 70932502
         SPACE 1                                                YS02019 70966002
TGT9590  EQU   *                                                YS02019 70999502
         BR    RETURN                   GO BACK TO RTM          YS02019 71033002
         SPACE 2                                                        71066502
***                                                                     71076502
***            ESTAE LIST                                               71086502
***                                                                     71096502
ESTAELST ESTAE TGT9500,TERM=YES,MF=L                            YS02019 71098502
         SPACE 2                                                        71100020
***                                                                     71200020
***                 CONSTANTS                                           71300020
***                                                                     71400020
VCON9301 DC    V(IGG09301)              ADDR OF IGG09301         Y01018 71460000
VCON9302 DC    V(IGG09302)              ADDR OF IGG09302        YS02019 71470002
VCON9303 DC    V(IGG09303)              ADDR OF IGG09303        YS02019 71480002
VCONASTP DC    V(IKTASTPT)              ADDR OF IKTASTPT        ZA16607 71486003
VCONVGET DC    V(IKTVTGET)              ADDR OF IKTVTGET        ZA16607 71492003
VCONVPUT DC    V(IKTVTPUT)              ADDR OF IKTVTPUT        ZA16607 71498003
VCONESTE DC    V(IKT93EST)              ADDR OF IKT93EST        ZA16607 71504003
USEREXIT DC    V(IKTTMPX1)              TERMINAL CONTROLER EXIT ZA24648 71505003
NOSDWA   DC    F'12'                    CONSTANT                YS02019 71510002
CCODE0C4 DC    X'000000C4'              COMPLETION CODE 0C4     YS02019 71520002
CCODE0C5 DC    X'000000C5'              COMPLETION CODE 0C5     YS02019 71560002
CCODE0D0 DC    X'000000D0'              COMPLETION CODE 0D0     YS02019 71610002
CCODE0D1 DC    X'000000D1'              COMPLETION CODE 0D1     YS02019 71660002
HIGHON   DC    X'80000000'              HI BIT FOR POST         YS02019 71710002
         DS    0F                                               YM03998 71760002
QNAME    DC    CL8'SYSZIGGI'            ENQ/DEQ QNAME           YM03998 71810002
         DC    X'FF000000'              DEQ/ENQ PARM LIST       YM03998 71860002
PATCHREA DC    20F'0'                   PATCH AREA              ZA24648 71910003
         EJECT                                                  YS02019 74100002
         IHAASCB                                                YS02019 74180002
         EJECT                                                  YS02019 74230002
         IHAASXB                                                YS02019 74240002
         EJECT                                                  YS02019 74260002
         IHAASVT                                                YS02019 74340002
         EJECT                                                  YS02019 74420002
         TAVTD                                                  YS02019 74500002
         EJECT                                                  YS02019 74580002
         IKJTIOCB                                               YS02019 74660002
         EJECT                                                  YS02019 74740002
CSCB     DSECT                                                  YS02019 74820002
         IEECHAIN                                               YS02019 74900002
         EJECT                                                  YS02019 74980002
CVT      DSECT                                                  YS02019 75060002
         CVT                                                    YS02019 75140002
         EJECT                                                  YS02019 75220002
         IHAPSA                                                 YS02019 75300002
         EJECT                                                  YS02019 75540002
         TPRIOR                                                 YS02019 75590002
         EJECT                                                  YS02019 75610002
         TQCBD                                                  YS02019 75620002
         EJECT                                                  YS02019 75700002
         IKJRB                                                          75810021
         SPACE 2                                                        75810402
RBOPSW2  EQU   RBOPSW+4                 SECOND HALF OF RBOPSW   YS02019 75812002
         SPACE 2                                                        75814002
***                                                                     75820021
***      EXTENDED SAVE AREA.  THSES STATEMENTS SHOULD FOLLOW            75830021
***      THE MACRO 'IKJRB.'                                             75840021
***                                                                     75850021
         ORG   RBEXSAVE                 START OF SAVE AREA       M0094  75860021
XSAPRM0  DS    0F                       REG 0 AT ENTRY           M0094  75870021
XSAPRMTJ DS    H                        TJID PASSED              M0094  75880021
XSAPRMSZ DS    H                        SIZE PASSED              M0094  75890021
XSAPRM1  DS    0F                       REG 1 AT ENTRY           M0094  75900021
XSAOPTNS DS    X                        USER OPTIONS             M0094  75910021
MASIS    EQU   X'01'                    ASIS OPTION SPECIFIED    M0094  75920021
MCNTRL   EQU   X'02'                    1 MEANS CONTROL          M0094  75930021
*                                                                       75940021
*   BOTH OF THE ABOVE BITS OFF MEANS EDIT OPTION                        75950021
*                                                                       75960021
MBREAK   EQU   X'04'                    BREAKIN SPECIFIED        M0094  75970021
MHOLD    EQU   X'08'                    1 MEANS HOLD             M0094  75980021
MTGET    EQU   X'80'                    1 MEANS TGET REQUESTED   M0094  75990021
MUSERID  EQU   X'40'                    USERID SPECIFIED        YS02019 76000002
MLOWP    EQU   X'20'                    0 HIGHPRI, 1 LOWPRI      M0094  76010021
MWAIT    EQU   X'10'                    1 MEANS NOWAIT           M0094  76020021
         DS    AL3                      REST OF REGISTER ONE     M0094  76030021
XSAWD3   DS    0F                       FOR SAVING REGISTERS     M0094  76040021
XSAFLAG  DS    X                        FLAG PASSED BY 9C TO 01  M0094  76050021
*                                       AND 02                   M0094  76060021
XSATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT   M0094  76070021
         DS    AL3                      REST OF WORD             M0094  76080021
         ORG   XSAWD3+2                 INPUT ED, OUTPUT MOVE    M0094  76090021
XSAUBFRS DS    H                        AMT DATA LEFT TO MOVE    M0094  76100021
XSAUBFRP DS    0F                       LOC DATA LEFT TO MOVE    M0094  76110021
XSAESTAL DS    CL16                     LIST FOR ESTAE MACRO    YS02019 76112002
         ORG   XSAUBFRP+4               USED FOR SAVE AREA WHEN YS02019 76200002
*                                       NOT NEEDED BY ESTAE     YS02019 76210002
XSAWD5   DS    F                        FOR SAVING REGISTERS     M0094  76220021
XSAWD6   DS    F                        FOR SAVING REGISTERS     M0094  76230021
         ORG   XSAWD5                   USE WORDS 5-6 FOR NAME   M0094  76240021
XSAENQNM DS    CL8                      ENQ NAME FOR TJID TPUT   M0094  76250021
XSAWD7   DS    F                        FOR SAVING REGISTERS     M0094  76260021
XSAWD8   DS    F                        FOR SAVING REGISTERS     M0094  76270021
         ORG   XSAWD7                   USE WDS 7-8 FOR ENQ PRMS M0094  76280021
XSAENQAD DS    2F                       WORK AREA FOR ENQ/DEQ    M0094  76290021
XSAUSERP DS    0F                       PTR TO USER ID, IF PRES YS02019 76292002
XSAWD9   DS    F                        FOR SAVING REGISTERS     M0094  76300021
XSARETRG DS    0F                       FOR SAVING RETURN ADDR  YS02019 76302002
XSAWD10  DS    F                        FOR SAVING REGISTERS     M0094  76310021
         DS    CL1                      RESERVED                YS02019 76312002
XSAUSERK DS    CL1                      KEY OF TGET CALLER      YS02019 76314002
XSARC    DS    H                        RETURN CODE SAVE AREA   YS02019 76320002
XSATJID  DS    H                        CALLER'S TJID            M0094  76330021
XSAFLAG2 DS    X                        FLAGS                   YM05387 76340002
XSAATR   EQU   X'80'                    NEXT CHAR IN TS BUFFER   S22028 76344002
*                                       IS A 3270 ATTRIBUTE BYTE        76346002
XSABFRAL EQU   X'40'                    TIOC BUFFER HAS BEEN    YM05387 76346402
*                                       ALLOCATED               YM05387 76346802
XSA15D   EQU   X'20'                    CHANGE COMPLETTION TO   YM05387 76347202
*                                       15D                     YM05387 76347602
*                  NEXT 5 BITS UNUSED                           YM05387 76348002
XSAF     DS    X                        FLAGS USED BY TPUT. INI- M0094  76350021
*                                       TIALIZED FROM XSAFLAG.          76360021
HSW      EQU   X'80'                    HEADER BFR DONE          M0094  76370021
PSW      EQU   X'40'                    NEED TO TPOST QCB        M0094  76380021
*SATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT          76390021
OSW      EQU   X'10'                    TSBOWIP TURNED ON BY US  M0094  76400021
*                                       (NOT SOME OTHER TPUT)           76410021
XSADMOVE EQU   X'08'                    DATA IS MOVING          YS02019 76420002
XSAAUTH  EQU   X'04'                    USER IS AUTHORIZED      YS02019 77420002
XSAIDENQ EQU   X'02'                    ASID TPUT ASID ENQUEUED YS02019 77470002
XSAPARTO EQU   X'01'                    QCBPARTO IS SET ON      YM01246 77520002
         EJECT                                                  YS02019 78420002
         IHASCVT                                                YS02019 79420002
         EJECT                                                  YS02019 80420002
         IKJTCB                                                 YS02019 81420002
         EJECT                                                  YS02019 82420002
         IEFTCT                                                 YS02019 83420002
         EJECT                                                  YS02019 84420002
         TTCXD                                                  YS02019 85420002
         IKJTIOCP                                               YS02019 86420002
         EJECT                                                  YS02019 87420002
         IKJTSB EXT=YES,LIST=YES                                YS02019 88420003
         EJECT                                                  YS02019 89420002
         IKTTCAST                                               ZA16607 89720003
         EJECT                                                  ZA16607 90020003
         TTSID                                                  YS02019 90420002
         EJECT                                                  YS02019 90470002
         IHAWSAVT                                               YS02019 90520002
         EJECT                                                  YS02019 90570002
         IHASDWA                                                YS02019 90620002
         END                                                            91420002
./  ADD  SSI=80870679,NAME=IGC0009D
         TITLE 'IGC0009D - FIRST LOAD OF SVC 94'                        00050003
IGC0009D CSECT                                                          00100003
*********************************************************************** 00150003
*                                                                     * 00200003
*        VS/2 RELEASE 4.0 CHANGES                                     * 00250003
* A 990254, D 990244                                            ZA26063 00300003
* A 988435-998440,990102,990120-990186,994031,994189,994262     ZA24648 00350003
* A 994431,994456                                               ZA24648 00400003
*D988044                             CODE FOR SU13**********    ZA16607 00450003
*C989874                                                        ZA16607 00500003
*A989614,990640,990783-990795,994247                            ZA16607 00550003
*                                      CODE FOR SU11********  X ZA16607 00600003
*D988198,990098,990102,991083-991099,991883,991887            X ZA16607 00650003
*C988224,989874,990309,990987,991599,992099,992159            X ZA16607 00700003
*A990273-990292,990296,990297,990904-990909,990993,992083-992095ZA16607 00750003
* 990276-990293,990295,990297,990993,992083-992095,           X ZA16607 00800003
* 991107-991307,994428-994450                                 X ZA16607 00850003
* 994428-994447                                               X ZA16607 00900003
* C989874,990105                                                ZA16639 00950003
* A990097,990100,994261,994263,994428-994430,994453-994455      ZA16639 01000003
*                                                                     * 01050003
*        VS/2 DELETIONS                                               * 01100003
*990210,990260,990290,990360                                     YM0341 01150003
*D995439,995779-995879,995919                                    YM2851 01200003
*                                                                     * 01250003
*              TIOC/VTIOC SPLIT                                 OZ27085 01300003
*  RESEQUENCE 988030-988346                                     OZ27085 01350003
*C988224,C988240-988260,D988294-988338,D988426-988434,C988516   OZ27085 01400003
*A988517,D988738,D988754-988762,D988848-988924,D989030          OZ27085 01450003
*D989110-989220,D989240-989610,D989620-989660,D989724           OZ27085 01500003
*D989900-990110,C990309,D990803-990977,D990987-991067,C992091   OZ27085 01550003
*D992023-992087,A991919-992091,A992099,D992319-994027           OZ27085 01600003
*D994059-994187,D994195-994243,D994251-998359,D998399-998699    OZ27085 01650003
*D998743-998744,D998859-998879,D998939-998999,D999351-999371    OZ27085 01700003
*A994195-994203,A988211-988219                                  OZ27085 01750003
*D988858,989720,989954-989994                                   OZ27085 01800003
*STATUS -                                                             * 01850003
*         OCTOBER 1977                                          OZ27085 01900003
*A991076-991090 A994055-994056                                 @ZA29992 01920003
*                                                                     * 01950003
* FUNCTION - THIS MODULE IS THE ENTRY POINT OF SVC 94. ITS FUNCTION   * 02000003
*    IS TO OBTAIN THE LOCAL AND CMS LOCKS, AND PASS CONTROL TO EITHER * 02050003
*    THE TSO/TCAM SVC 94 ROUTER OR THE TSO/VTAM SVC 94 ROUTER.  OZ27085 02100003
*                                                                     * 02150003
* ENTRY POINTS -                                                      * 02200003
*         IGC0009D - CONTROL IS RECEIVED WHEN SVC 94 IS ISSUED.       * 02250003
* INPUT -                                                             * 98834601
*    REG 0 - ENTRY CODE IN HIGH ORDER BYTE,PARAMETERS IN REMAINDER    * 98835401
*    REG 1 - PARAMETERS                                               * 98836201
*    REG 3 - CVT                                                      * 98837001
*    REG 4 - TCB                                                      * 98837801
*    REG 5 - SVRB                                                     * 98838601
*                                                                     * 98839401
* OUTPUT - RETURN CODE IN REGISTER 15                                 * 98840201
*                                                                     * 98841001
* EXTERNAL REFERENCES -                                               * 98841801
*         IKTTMPX2                                              ZA24648 98843501
*            REG 15 RETURN CODE FROM IKTTMPX2                   ZA24648 98843601
*                    RC < 0 NORMAL PROCESSING SHOULD CONTINUE   ZA24648 98843701
*                       >=0 THE SVC SHOULD RETURN TO THE CALLER ZA24648 98843801
*                           PASSING THRU THE VALUE IN REG 15    ZA24648 98843901
*                                                                     * 98844201
* EXITS - NORMAL                                                      * 98845001
*         BRANCH TO NEXT CSECT WITH LOCAL AND CMS LOCKS HELD.         * 98850001
*    REG 0 - ENTRY CODE IN HIGH ORDER BYTE,PARAMETERS IN REMAINDER    * 98850101
*    REG 1 - PARAMETERS                                               * 98850501
*    REG 3 - CVT                                                YS02019 98850801
*    REG 4 - TCB                                                YS02019 98851201
*    REG 5 - SVRB                                               OZ27085 98851403
*    REG 8 - TSB                                                OZ27085 98851603
*    REG 10 - CONSTANTS                                         YS02019 98852401
*    REG 14 - RETURN ADDRESS                                    YS02019 98855401
*                                                                     * 98856201
* EXITS - ERROR                                                       * 98857001
*         BR 14 WITH RETURN CODE IN REGISTER 15                 YS02019 98857801
*                                                                     * 98858601
* TABLES AND WORK AREAS - SEE DSECTS AT END OF MODULE                 * 98859401
*                                                                     * 98860201
* ATTRIBUTES - REENTRANT                                        YS02019 98861001
*                                                                     * 98861801
* CHARACTER CODE DEPENDENCY - NONE                                    * 98862601
*                                                                     * 98863401
* NOTES                                                               * 98864201
*    YS02019 - VS/2 RELEASE 2 CHANGES                                 * 98865001
*                                                                     * 98865801
*********************************************************************** 98866601
*********************************************************************** 98867401
         SPACE 3                                                        98868201
********                                                                98869001
******** REGISTER EQUATES                                               98869801
********                                                                98870601
RPARM0   EQU   0                        PARAMETER REG 0                 98871401
RWORK0   EQU   0                        WORK REGISTER                   98872201
RPARM1   EQU   1                        PARAMETER REG 1                 98873001
RWORK2   EQU   2                        WORK REGISTER                   98874601
RCVT     EQU   3                        POINTS TO CVT                   98877001
RTCB     EQU   4                        POINTS TO TCB                   98879000
RTSB     EQU   8                        POINTS TO TSB           OZ27085 98880003
RRB      EQU   5                        POINTS TO SVRB          YS02019 98882401
RWORK6   EQU   6                        WORK REGISTER           YS02019 98884001
RWORK11  EQU   11                       WORK REGISTER           YS02019 98894001
RBASE    EQU   12                       BASE REGISTER                   98896000
R13      EQU   13                       REGISTER 13                     98899000
R14      EQU   14                       REGISTER 14                     98900000
RLINK    EQU   14                       LINK REGISTER                   98901000
RTRNSTBL EQU   14                       POINTS TO TRANSLATE TABLES      98902000
RBRANCH  EQU   15                       BRANCH REGISTER                 98904000
RCODE    EQU   15                       RETURN CODE REGISTER            98905000
         SPACE 2                                                        98906000
********                                                                98907000
******** DISPLACEMENT,LENGTH AND MASK EQUATES                           98908000
********                                                                98909000
BYTE1    EQU   8                        MASK FOR BYTE 1 IN REG.         98910000
D14      EQU   14                       DISPLACEMENT OF 14              98923000
LNSZ132  EQU   132                      LINE SIZE 132           ZA16607 98961501
         SPACE 3                                                        98967000
********                                                                98969000
******** DEFINE ALTERNATE ENTRY POINTS                                  98970000
********                                                                98971000
         SPACE 3                                                        98974000
********                                                                98975000
******** ESTABLISH BASE REGISTERS AND ADDRESSABILITY                    98976000
********                                                                98977000
         BALR  RBASE,RWORK0             ADDRESSABILITY                  98978000
         USING *,RBASE                  FOR THIS CSECT                  98979000
         USING CVT,RCVT                 CVT ADDRESSABILITY              98980000
         USING TCB,RTCB                 TCB ADDRESSABILITY              98981000
         USING RBSECT,RRB               SVRB ADDRESSABLE        YS02019 98983001
         B     PASTID                   SKIP MODULE ID.         YS02019 98985001
         DC    C'IGC0009D'              MODULE ID.              YS02019 98987001
         DC    X'7269'                  DATE - SEPT  26, 1977   OZ27085 98987203
PASTID   EQU   *                                                YS02019 98987801
         L     RBRANCH,USEREXIT         GET @ OF TERM MGR EXIT  ZA24648 99012001
         LTR   RBRANCH,RBRANCH          IS THERE A USER EXIT    ZA24648 99013001
         BZ    GETLKS                   BRANCH ON NO            ZA24648 99014001
         LR    RWORK11,RLINK            SAVE RETURN @           ZA24648 99015001
         BALR  RLINK,RBRANCH            BRANCH TO USER EXIT     ZA24648 99016001
         LR    RLINK,RWORK11            RESTORE RETURN @        ZA24648 99017001
         LTR   RCODE,RCODE              TEST RETURN CODE        ZA24648 99018001
         BNMR  RLINK                    RETURN ON CODE >=0      ZA24648 99019001
********                                                                99020001
******** GET LOCKS AND ENSURE TCAM AND TSO ARE ACTIVE                   99022001
********                                                                99024001
GETLKS   EQU   *                                                YS02019 99025201
         LA    R13,RBEXSAVE             SAVE AREA FOR SETLOCK   ZA26063 99025401
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=SAVE,       YS02019X99025701
               RELATED=('TSB,TIOCRPT','SVC EXIT PROLOGUE')              99025801
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,REGS=SAVE,         YS02019X99025901
               RELATED=('TSB,TIOCRPT','SVC EXIT PROLOGUE')              99027201
         L     RWORK6,PSAAOLD-PSA       ADDRRESS OF ASCB      X ZA16607 99027401
         USING ASCB,RWORK6              ASCB ADDRESSABILITY   X ZA16607 99027601
         L     RWORK6,ASCBTSB           ADDRESS OF TSB        X ZA16607 99027801
         USING TSB,RWORK6               TSB IS ADDRESSABLE    X ZA16607 99028001
         LTR   RWORK6,RWORK6            CHECK IF BACKGRND TASKX ZA16607 99028201
         BZ    CKTCAM                   CHECK FOR TSO/TCAM UP X ZA16607 99028401
*                                       RWORK11 IS STILL ZERO X ZA16607 99028601
*                                       (NO TSO/TCAM TSB FOUND) ZA16607 99029401
         TM    TSBFLG5,TSBVTAM          IS THIS A TSO/VTAM TSBX ZA16607 99029501
         BO    BRANCH                   YES, INVOKE PROPER MODX ZA16607 99029601
CKTCAM   L     RWORK6,CVTAQAVT          GET ADDR OF TCX       X ZA16607 99029701
         LTR   RWORK6,RWORK6            IS TCAM ACTIVE          YS02019 99029801
         BZ    BACKGRND                 NO, TREAT AS NO-OP      YS02019 99030201
         L     RWORK6,TCXRPT-IEDQTCX(,RWORK6) ADDR OF TIOCRPT   YS02019 99030301
         LTR   RWORK6,RWORK6            IS TIME SHARING ACTIVE  YS02019 99030401
         BNZ   BRANCH                   YES, PROCEED            OZ27085 99030603
BACKGRND EQU   *                                                        99063201
         CLM   RPARM0,BYTE1,T11         IS ENTRY CODE 11?       ZA16607 99063801
         BE    GETSIZ                   YES, DEFAULT GTSIZE     ZA16607 99064401
         SR    RCODE,RCODE              INDICATE SVC94 ISSUED BY BKGND  99065101
         SR    RPARM0,RPARM0            CLEAR REG 0             YM07152 99065501
         SR    RPARM1,RPARM1            CLEAR REG 1             YM07152 99065901
         BR    R14                      RETURN TO CALLER        YS02019 99067101
*******                                                                 99068301
*******  WHEN GTSIZE HAS BEEN ISSUED FROM A BACKGROUND TASK             99069301
*******  PROVIDE A DEFAULT TERMINAL LINESIZE                            99070301
*******                                                                 99071301
GETSIZ   SR    RCODE,RCODE              SUCCESSFUL RETURN CODE  ZA16607 99072301
         SR    RPARM0,RPARM0            DEFAULT SCREENLENGTH=0  ZA16607 99073301
         LA    RPARM1,LNSZ132           DEFAULT LINESIZE=132    ZA16607 99074301
         BR    R14                      RETURN TO CALLER        ZA16607 99075301
*********************************************************************** 99097801
*        GET POINTER TO TSB                                     YS02019 99098201
*********************************************************************** 99098601
BRANCH   EQU   *                                              X ZA16607 99107501
         CLM   RPARM0,BYTE1,T0          IF TCABEND, NOTSB      @ZA29992 99107903
         BE    BRTCAM                   GO TO TCAM MODULE      @ZA29992 99108303
         CLM   RPARM0,BYTE1,T2          IF TSEND, NOTSB        @ZA29992 99108703
         BE    BRTCAM                   GO TO TCAM MODULE      @ZA29992 99109103
         L     RWORK6,PSAAOLD-PSA       ADDRESS OF ASCB       X ZA16607 99109901
         USING ASCB,RWORK6              ASCB ADDRESSABILITY   X ZA16607 99117901
         L     RTSB,ASCBTSB             ADDRESS OF TSB        X ZA16607 99125901
         DROP  RRB                      RB ADDRESSABILITY ENDSX ZA16607 99133901
         DROP  RWORK6                                         X ZA16607 99141901
         USING TSB,RTSB                 TSB IS ADDRESSABLE    X ZA16607 99149901
         LTR   RTSB,RTSB                WAS TCAM TSB FOUND    X ZA16607 99159901
         BZ    BACKGRND                 NO,  BACKGRND TASK      YS02019 99169901
********                                                                99189401
******** BRANCH TO PROPER MODULE                                        99189801
********                                                                99191801
         TM    TSBFLG5,TSBVTAM          IS THIS A TSO VTAM TSB  OZ27085 99193803
         BO    BRVTAM                   YES- VTAM BRANCH        OZ27085 99195803
BRTCAM   L     RWORK2,TCAMMOD           GET TSO/TCAM BRNCH ADDR OZ27085 99197803
         B     BRNCH                    BRANCH TO MODULE      X ZA16607 99209501
BRVTAM   L     RWORK2,VTAMMOD           GET BRANCH ADDRESS      OZ27085 99209703
BRNCH    LR    RBASE,RWORK2             SET UP NEW BASE REG   X ZA16607 99215901
         BR    RBASE                    GO TO PROPER ROUTINE     Y01018 99217901
PAT      DC    13F'0'                   MAINTENANCE PATCH AREA  ZA24648 99218903
         DS    0F                                                       99219903
CONST    EQU   *                                                        99220903
USEREXIT DC    V(IKTTMPX2)              TERMINAL CONTROLER EXIT ZA24648 99221903
TCAMMOD  DC    V(IGG0940H)              TCAM SVC94 ROUTER       OZ27085 99222903
VTAMMOD  DC    V(IKT0009D)              VTAM SVC94 ROUTER       OZ27085 99223903
T0       DC    AL1(0)                   CONSTANT OF 0 FOR CLM  @ZA29992 99224903
T2       DC    AL1(2)                   CONSTANT OF 2 FOR CLM  @ZA29992 99225903
T11      DC    AL1(11)                  CONSTANT OF 11 FOR CLM  ZA16607 99226903
CONSTANT DSECT                                                          99837900
         SPACE 3                                                        99838903
         EJECT                                                  YS02019 99871901
         IKJTCB                                                         99873900
         EJECT                                                          99874301
CVT      DSECT                                                          99875900
         CVT                                                            99877901
         EJECT                                                          99878301
         IKJRB                                                          99879900
         EJECT                                                          99885901
         IKJTSB                                                         99891901
         EJECT                                                          99893901
         IHAASCB                                                        99909101
         EJECT                                                          99919101
         IHAPSA                                                         99929101
         EJECT                                                          99931101
         TTCXD                                                          99933101
         END                                                            99937900
./  ADD  SSI=20720077,NAME=IGG019TX
         TITLE 'IGG019TX - TS CHECK ROUTINE'                            00900020
IGG019TX CSECT                                                          01800020
*********************************************************************** 02700020
*                                                                     * 03600020
* RELEASE 23 DELETIONS/CHANGES                                        * 03700020
* RELEASE 22 DELETIONS/CHANGES                                        * 03800020
* RELEASE 21 DELETIONS/CHANGES                                        * 03900020
*2182535000,756000-774000                                        S21042 03950000
*                                                                     * 04000020
*STATUS CHANGE LEVEL 002                                                04100000
*                                                                     * 04200020
* NAME - IGG019TX - TS CHECK.                                         * 04500020
*                                                                     * 05400020
* FUNCTION - THE MODULE CHECKS THE ECB COMPLETION CODE FOR END OF     * 06000020
*            FILE CONDITION. WHEN THIS CONDITION ARISES, THE MODULE   * 06600020
*            GIVES CONTROL TO USER'S EOD ROUTIN                       * 07200020
*                                                                     * 07800020
* ENTRY POINT - IGG019TX, BEGINNING OF MODULE                         * 08400020
*                                                                     * 09000020
*               CONTROL IS RECEIVED WHEN THE FOLLOWING CONDITIONS ARE * 09600020
*               MET.                                                  * 10200020
*                                                                     * 10800020
*               THE TASK IS TIME SHARING                              * 11400020
*               THE DCB OPENED IS FOR BSAM                            * 12000020
*               A CHECK MACRO INSTRUCTION IS ISSUED                   * 12600020
*                                                                     * 13200020
*               UPON ENTRY TO THIS MODULE                             * 13800020
*                                                                     * 14400020
*                        REGISTER 1 POINTS AT USER DECB ADDRESS       * 15300020
*                        REGISTER 15 POINTS AT ENTRY POINT            * 16200020
*                                                                     * 17100020
* INPUT - DECB NAME, TYPE FIELD, DCB ADDRESS, BUFFER ADDRESS, 'S' OR  * 18000020
*         LENGTH OF DATA.                                             * 18900020
*                                                                     * 19800020
* OUTPUT - N/A.                                                       * 20700020
*                                                                     * 21600020
* EXIT - NORMAL - RETURN CONTROL TO CALLER VIA 'BR 14' INSTRUCTION.   * 22500020
*                 WHEN EOD IS DETECTED, BRANCH TO USER EOD ROUTINE    * 23400020
*                 VIA 'BR 15' INSTRUCTION.                            * 24300020
*                                                                     * 25200020
*        ERROR - AT END OF FILE, NO EOD ROUTINE IS FURNISHED, JOB     * 25800020
*                WILL BE ABENDED WITH SYSTEM CODE 337                 * 26400020
*                                                                     * 27000020
* EXTERNAL REFERENCE - NONE                                           * 27900020
*                                                                     * 28800020
* TABLE/WORK AREAS - NONE                                             * 28900020
*                                                                     * 29000020
* ATTRIBUTES - REENTRANT, REUSABLE                                    * 29100020
*                                                                     * 29200020
* CHARACTER CODE DEPENDENCY -                                         * 29300020
*                                                                     * 29400020
* NOTES -                                                             * 29500020
*                                                                     * 29600020
*********************************************************************** 29700020
         SPACE 3                                                        30600020
********                                                                31500020
******** REGISTER EQUATES                                               32400020
********                                                                33300020
R0       EQU   0                        REGISTER 0                      34200020
R1       EQU   1                        REGISTER 1                      35100020
RDECB    EQU   1                        POINTS AT DECB                  36000020
RDCB     EQU   2                        POINTS AT DCB                   36900020
R3       EQU   3                        WORK REGISTER                   37800020
RECB     EQU   4                        POINTS AT ECB                   38700020
RBASE    EQU   12                       BASE REGISTER                   39600020
R12      EQU   12                       REGISTER 12                     40500020
R13      EQU   13                       CONTAINS ADDR OF SAVE AREA      41400020
R14      EQU   14                       CONTAINS RETURN ADDR            42300020
R15      EQU   15                       CONTAINS ADDR TO BRACH TO       43200020
         SPACE 3                                                        44100020
********                                                                45000020
******** EQUATES FOR MASKS, DISPLACEMENTS, CONSTANTS                    45900020
********                                                                46800020
D0       EQU   0                        DISPLACEMENT OF 0               47700020
D3       EQU   3                        DISPLACEMENT OF 3               48600020
D12      EQU   12                       DISPLACEMENT OF 12              49500020
D20      EQU   20                       DISPLACEMENT OF 20              50400020
M01      EQU   X'01'                    MASK OF X'01'                   51300020
M12      EQU   12                       MASK OF 12                      52200020
EOD      EQU   X'41'                    DENOTES END OF DATA SET         53100020
EABD174  EQU   174                                               S21042 53500000
         SPACE 3                                                        54000020
********                                                                54900020
******** SAVE REGISTERS AND ESTABLISH ADDRESSABILITY                    55800020
********                                                                56700020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  57600020
         LR    RBASE,R15                ENTRY ADDR AS BASE ADDR         58500020
         USING IGG019TX,RBASE           ESTABLISH ADDRESSABILITY        59400020
         USING IHADCB,RDCB              ESTABLISH ADDRESSABILITY        60300020
         USING DECB,RDECB               ESTABLISH ADDRESSABILITY        61200020
         SPACE 3                                                        62100020
********                                                                63000020
******** GET POINTER TO NECESSARY BLOCKS                                63900020
********                                                                64800020
         L     RDCB,DECDCBAD            GET ADDR OF DCB                 65700020
         LA    RECB,DECSDECB            GET ADDR OF ECB                 66600020
         SPACE 3                                                        67500020
********                                                                68400020
******** TEST FOR COMPLETION OF EVENT                                   69300020
********                                                                70200020
         CLI   D0(RECB),EOD             IS EOF REACHED                  71100020
         BNE   RETURN                   BRANCH ON NO                    72000020
CKEOD    EQU   *                                                        72900020
         TM    DCBEODAD+D3,M01          IS EOD EXIT ADDR FURNISHED      73800020
         BZ    GOTHERE                  BRANCH ON YES                   74700020
         DMABCOND EABD174,DCB=(RDCB),SVC=YES                     S21042 75700000
GOTHERE  EQU   *                                                        78300020
         L     R15,DCBEODAD             LOAD EOD EXIT ADDR              79200020
         L     R14,D12(R13)             RESTORE REG 14                  80100020
         LM    R0,R12,D20(R13)          RESTORE REGS 0-12               81000020
         BR    R15                      TAKE EOD EXIT                   81900020
         SPACE 3                                                        82800020
RETURN   EQU   *                                                        83700020
         LM    R14,R12,D12(R13)         RESTORE REGISTER                84600020
         BR    R14                      RETURN CONTROL TO CALLER        85500020
         SPACE 3                                                        86400020
         DS    0F                                                       87300020
DECB     DSECT                                                          88200020
DECSDECB DS    CL4                                                      89100020
DECTYPE  DS    CL2                                                      90000020
DECLNGTH DS    CL2                                                      90900020
DECDCBAD DS    CL4                                                      91800020
DECAREA  DS    CL4                                                      92700020
DECIOBPT DS    CL4                                                      93600020
         SPACE 3                                                        94500020
         DCBD  DSORG=PS                                                 95400020
         END                                                            96300020
./  ADD  SSI=20720076,NAME=IGG019TY
         TITLE 'IGG019TY - TS NOTE-POINT ROUTINE'                       07000020
IGG019TY CSECT                                                          14000020
*********************************************************************** 14100020
*                                                                     * 14200020
* RELEASE 23 DELETIONS/CHANGES                                        * 14300020
* RELEASE 22 DELETIONS/CHANGES                                        * 14400020
* RELEASE 21 DELETIONS/CHANGES                                        * 14500020
*                                                                     * 14600020
* STATUS CHANGE LEVEL - 000                                           * 14700020
*                                                                     * 14800020
* NAME - IGG019TY - TS NOTE/POINT ROUTINE                             * 14900020
*                                                                     * 15000020
* FUNCTION - FOR TIME SHARING TASK, THE NOTE AND POINT MACRO          * 15100020
*            INSTRUCTIONS HAVE NO MEANING.  THIS ROUTINE NOPS THE     * 15200020
*            NOTE AND THE POINT MACRO INSTRUCTIONS                    * 15300020
*                                                                     * 15400020
* ENTRY POINT - IGG019TZ, BEGINNING OF MODULE                         * 15500020
*                                                                     * 15600020
* INPUT - N/A                                                         * 15700020
*                                                                     * 15800020
* OUTPUT - N/A                                                        * 15900020
*                                                                     * 16000020
* EXTERNAL REFERENCE - NONE                                           * 16100020
*                                                                     * 16200020
* EXIT, NORMAL - RETURN CONTROL TO CALLER VIA A 'BR 14' INSTRUCTION   * 16300020
*                                                                     * 16400020
* EXIT, ERROR - NONE                                                  * 16500020
*                                                                     * 16600020
* TABLE/WORK AREAS - NONE                                             * 16700020
*                                                                     * 16800020
* ATTRIBUTES - REENTRANT, REUSABLE                                    * 16900020
*                                                                     * 17000020
* CHARACTER CODE DEPENDENCY - NONE                                    * 17100020
*                                                                     * 17200020
* NOTES -                                                             * 17300020
*                                                                     * 17400020
*********************************************************************** 17500020
         SPACE 3                                                        21000020
********                                                                28000020
******** REGISTER EQUATES                                               35000020
********                                                                42000020
R14      EQU    14                      CONTAINS RETURN ADDRESS         49000020
         SPACE 3                                                        56000020
********                                                                57000020
******** ENTRY POINT FOR NOTE                                           58000020
********                                                                59000020
         BR    R14                      NOP NOTE                        63000020
         DC    AL2(0)                   PADDING FOR NEXT INSTRUCTION    70000020
         SPACE 3                                                        71000020
********                                                                72000020
******** ENTRY POINT FOR POINT                                          73000020
********                                                                74000020
         BR    R14                      NOP POINT                       77000020
         END                                                            84000020
./  ADD  SSI=20720075,NAME=IGG019TZ
         TITLE 'IGG019TZ - TS CNTRL ROUTINE'                            07000020
IGG019TZ CSECT                                                          14000020
*********************************************************************** 14100020
*                                                                       14120020
*                                                                M0691  14140020
*                                                                       14160020
*                                                                     * 14200020
* RELEASE 23 DELETIONS/CHANGES                                        * 14300020
* RELEASE 22 DELETIONS/CHANGES                                        * 14400020
* RELEASE 21 DELETIONS/CHANGES                                        * 14500020
*                                                                     * 14600020
* STATUS CHANGE LEVEL - 000                                           * 14700020
*                                                                     * 14800020
* NAME - IGG019TZ                                                     * 14900020
*                                                                     * 15000020
* FUNCTION - FOR A TIME SHARING TASK, THE CNTRL MACRO INSTRUCTION     * 15100020
*            HAS NO MEANING. THIS ROUTINE MAKES THE CNTRL INSTRUCTION * 15200020
*            NOP                                                      * 15300020
*                                                                     * 15400020
* ENTRY POINT - IGG019TZ, BEGINNING OF MODULE                         * 15500020
*                                                                     * 15600020
* INPUT - N/A                                                         * 15700020
*                                                                     * 15800020
* OUTPUT - N/A                                                        * 15900020
*                                                                     * 16000020
* EXTERNAL REFERENCE - NONE                                           * 16100020
*                                                                     * 16200020
* EXIT, NORMAL - RETURN CONTROL TO CALLER VIA A 'BR 14' INSTRUCTION   * 16300020
*                                                                     * 16400020
* EXIT, ERROR - NONE                                                  * 16500020
*                                                                     * 16600020
* TABLE/WORK AREAS - NONE                                             * 16700020
*                                                                     * 16800020
* ATTRIBUTES - REENTRANT, REUSABLE                                    * 16900020
*                                                                     * 17000020
* CHARACTER CODE DEPENDENCY - NONE                                    * 17100020
*                                                                     * 17200020
* NOTES -                                                             * 17300020
*                                                                     * 17400020
*********************************************************************** 17500020
         SPACE 3                                                        21000020
********                                                                28000020
******** REGISTER EQUATES                                               35000020
********                                                                42000020
R14      EQU    14                      CONTAINS RETURN ADDRESS         45000020
R15      EQU   15                       CONTAINS RETURN CODE            46000020
         SPACE 3                                                        48000020
********                                                                51000020
******** EQUATE FOR DISPLACEMENT                                        54000020
********                                                                57000020
TWO      EQU    2                       DISPLACEMENT OF 2               60000020
ZERO     EQU   X'00'                    CONSTANT OF 0                   61000020
         SPACE 3                                                        63000020
         SR    R15,R15                  SET RETURN CODE TO 0            65000020
         CLI   0(R14),ZERO              IS THERE A 2 BYTE FLAG IN THE   68000020
*                                       MACRO EXPANSION                 73000020
         BNE   0(R14)                   RETURN CONTROL TO CALLER        78000020
         B     TWO(R14)                 BRANCH TO PASS 2 BYTES DC       83000020
         END                                                            91000020
./  ADD  SSI=72410254,NAME=IGG019T3
         TITLE 'IGG019T3 - TS QSAM GET ROUTINE'                         00400020
IGG019T3 CSECT                                                          00800020
*********************************************************************** 01200020
*                                                                     * 01600020
*      VS2  030  PTF                                                    01620003
*                                                                       01640003
*0000592000                                                    @ZA06713 01660003
*0000592000,948100                                             @ZA09612 01680003
*                                                                       01700003
* RELEASE 21 DELETIONS/CHANGES                                        * 01750020
*1395366000,900000-904000                                        S21042 01760021
*1395925600-927200                                               A42898 01770021
*                                                                M6374  01820020
*A828500                                                        SA69128 01830002
*D370000,722600-723333                                          SA69503 01840002
*A368500-370700,722900-723331                                   SA69503 01850002
*STATUS CHANGE LEVEL VS2  030  SU                              @ZA06713 01860003
*                                                                     * 01900020
* NAME - IGG019T3 (TS GET)                                            * 02000020
*                                                                     * 02400020
* FUNCTION/OPERATION - THE FOLLOWING FUNCTIONS WILL BE PERFORMED BY   * 02800020
*                      THIS INTERFACE ROUTINE.                        * 03200020
*                                                                     * 03600020
*                      FURNISH TGET USER BUFFER ADDRESS (MOVE MODE),  * 04000020
*                      AND FIRST BUFFER ADDRESS OF THE BUFFER POOL    * 04400020
*                      CONTROL BLOCK (LOCATE MODE).                   * 04800020
*                                                                     * 05200020
*                      FURNISH TGET BUFFER SIZE.                      * 05600020
*                                                                     * 06000020
*                      ISSUE TGET,WHICH RETRIEVES A RECORD FROM TIOC  * 06400020
*                      BUFFER AND PLACES IT EITHER IN THE FIRST       * 06800020
*                      BUFFER OF THE BUFFER POOL CONTROL BLOCK        * 07200020
*                      (LOCATE MODE), OR IN A USER-DESIGNATED AREA    * 07600020
*                      (MOVE MODE). UPON REGAIN CONTROL FROM TGET,    * 08000020
*                      RETURN TO USER THE RECORD ADDRESS IN REGISTER  * 08400020
*                      1.                                             * 08800020
*                                                                     * 09200020
* ENTRY POINTS - GET - IGG019T3                                       * 09300020
*                TRUNC/RELSE - IGG019T3 + 8                           * 09400020
*                                                                     * 09500020
*                CONTROL IS RECEIVED WHEN THE FOLLOWING CONDITIONS    * 09600020
*                ARE MET.                                             * 09700020
*                                                                     * 09800020
*                THE TASK IS TIME SHARING.                            * 09900020
*                THE DCB OPENED IS FOR QSAM INPUT.                    * 10000020
*                A GET, TRUNC, OR RELSE MACRO IS ISSUED.              * 10100020
*                                                                     * 10200020
* INPUT - USER BUFFER ADDRESS IN REGISTER 0 (OMIT FOR LOCATE MODE).   * 10300020
*         DCB ADDRESS IN REGISTER 1.                                  * 10400020
*                                                                     * 10500020
* OUTPUT - AN DEITED BLOCK OF TEXT IN BUFFER.                         * 10600020
*                                                                     * 10700020
* EXTERNAL REFERENCE - IGC0009C.                                      * 10800020
*                                                                     * 11600020
* EXIT - NORMAL - RETURN CONTROL TO CALLER VIA 'BR 14' INSTRUCTION.   * 12000020
*                 REGISTER 1 CONTAINS RECORD ADDRESS.                 * 12400020
*                                                                     * 12800020
*                 WHEN AN EOD CONDITION IS DETECTED, BRANCH TO USER'S * 13200020
*                 EOD ROUTINE ADDRESS VIA 'BR 15' INSTRUCTION.        * 13600020
*                                                                     * 14000020
*        ERROR - WHEN END OF FILE IS REACHED BUT NO EOD ROUTINE IS    * 14500020
*                FURNISHED, JOB WILL BE ABENDED WITH SYSTEM CODE 337. * 15000020
*                                                                     * 15500020
* TABLE/WORK AREAS - NONE.                                            * 16000020
*                                                                     * 16500020
* ATTRIBUTES - REENTRANT, REUSABLE.                                   * 17000020
*                                                                     * 17500020
* CHARACTER CODE DEPENDENCY -                                         * 18000020
*                                                                     * 18500020
* NOTES -                                                             * 19000020
*********************************************************************** 20400020
         SPACE 3                                                        20800020
********                                                                21200020
******** REGISTER EQUATES                                               21600020
********                                                                22000020
R0       EQU   0                        CONTAINS USER BFR ADDR          22400020
*                                       ALSO CONTAINS BFR SIZE FOR TGET 22800020
R1       EQU   1                        CONTAINS DCB ADDR WHEN THIS     23200020
*                                       MODULE GETS CONTROL             23600020
*                                       ALSO CONTAINS BFR ADDR FOR      24000020
*                                       TGET                            24400020
R2       EQU   2                        REGISTER 2                      24800020
RDCB     EQU   2                        POINTS AT DCB                   25200020
RBUFAD   EQU   3                        CONTAINS BFR ADDR               25600020
RBUFSZ   EQU   4                        CONTAINS BFR SIZE               26000020
RDEB     EQU   7                        POINTS AT DEB                   27000020
RPTR     EQU   9                        POINTS AT BFR FOR FOLDING MSG   27050020
RWORK    EQU   10                       WORK REGISTER                   27100020
RENDMSG  EQU   11                       POINTS AT END OF MESSAGE        27170020
R12      EQU   12                       REGISTER 12                     27200020
RBASE    EQU   12                       BASE REGISTER                   27600020
R13      EQU   13                       REGISTER 13                     28000020
R14      EQU   14                       CONTAINS RETURN ADDR            28400020
RRETURN  EQU   15                       CONTAINS RETURN CODE            28800020
R15      EQU   15                       CONTAINS BRANCH ADDR            29200020
         SPACE 3                                                        29600020
********                                                                30000020
******** LENGTH FIELD, DISPLACEMENT, AND MASK EQUATES                   30400020
********                                                                30800020
D0       EQU   0                        DISPLACEMENT OF 0               31200020
D1       EQU   1                        DISPLACEMENT OF 1               31600020
D2       EQU   2                        DISPLACEMENT OF 2               32000020
D4       EQU   4                        DISPLACEMENT OF 4               32400020
D12      EQU   12                       DISPLACEMENT OF 12              32800020
D20      EQU   20                       DISPLACEMENT OF 20              33200020
D28      EQU   28                       DISPLACEMENT OF 28              33600020
L2       EQU   2                        LENGTH OF 2                     34000020
C3       EQU   3                        CONSTANT OF 3                   34400020
C15      EQU   15                       CONSTANT OF 15                  34600020
M01      EQU   X'01'                    MASK USED TO TEST EOD RTN ADDR  34800020
*                                       MASK FOR DATA MODE IN DCBMACR   35200020
M80      EQU   X'80'                    MASK FOR F-TYPE RECORD          35600020
M40      EQU   X'40'                    V-TYPE RECORD IN DCBRECFM       35700020
MC0      EQU   X'C0'                    U-TYPE RECORD IN DCBRECFM       35800020
M7F      EQU   X'7F'                    MASK FOR TURNING OFF WRITE BIT  36000020
M8       EQU   8                        USED TO SHIFT REGISTER          36400020
M12      EQU   X'12'                    MASK FOR SHIFTING REGISTER      36500020
EABD174  EQU   174                                               S21042 36600021
QSAMLOCT EQU   X'48'                    DCBMACRF=GL                     36800020
*****  MASKS FOR ISOLATING LOWERCASE ALPHA CHAR. FOR FOLDING    SA69503 36850002
M81      EQU   X'81'                    LOWERCASE A             SA69503 36900002
MA9      EQU   X'A9'                    LOWERCASE Z             SA69503 36950002
M89      EQU   X'89'                    LOWERCASE I             SA69503 37000002
M90      EQU   X'90'                    SPECIAL CHAR            SA69503 37050002
M99      EQU   X'99'                    LOWERCASE R             SA69503 37060002
MA1      EQU   X'A1'                    SPECIAL CHAR            SA69503 37070002
UPPER    EQU   X'40'                    USED TO FOLD MSG                37100020
         SPACE 3                                                        37200020
         SPACE 3                                                        40000020
********                                                                40400020
******** GET ENTRY                                                      40800020
********                                                                41200020
         USING IGG019T3,R15             USE ENTRY ADDR AS BASE ADDR     41600020
         B     STARTGET                 BRANCH PAST TRUNC/RELSZ ENTRY   42000020
         DC    X'00000000'              PADDING TO PUSH LOC CTR TO 8    42400020
         SPACE 3                                                        42800020
********                                                                43200020
******** TRUNC/RELSE ENTRY                                              43600020
********                                                                44000020
         BR    R14                      NOP FOR TRUNC & RELSE ROUTINES  44400020
*                                       (RETURN TO USER)                44800020
         B     BRARID                   BRANCH AROUND ID       @ZA06713 44880003
         DC    C'IGG019T3'              MODULE ID              @ZA06713 44960003
         DC    X'6063'                  DATE 03/03/76          @ZA09612 45040003
BRARID   EQU   *                                               @ZA06713 45120003
         SPACE 3                                                        45200020
********                                                                45600020
******** SAVE REGISTER & ESTABLISH ADDRESSABILITY                       46000020
********                                                                46400020
STARTGET EQU   *                                                        46800020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  47200020
         LR    RBASE,R15                LOAD BASE REGISTER              47600020
         DROP  R15                      GET RID OF PREVIOUS BASE REG    48000020
         USING IGG019T3,RBASE           USE REG 12 AS BASE REG          48400020
         SPACE 3                                                        48800020
********                                                                49200020
******** GET DCB ADDRESS                                                49600020
********                                                                50000020
         LR    RDCB,R1                  SAVE DCB ADDR                   50400020
         USING IHADCB,RDCB                                              50800020
         USING DEB,RDEB                 ESTABLISH ADDRESSABILITY        50900020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 51000020
         SPACE 3                                                        51200020
********                                                                51600020
******** TEST FOR LOCATE MODE                                           52000020
********                                                                52400020
         TM    DCBMACRF,QSAMLOCT        CHECK FOR LOCATE MODE           52800020
         BNO   MOVEMD                   NO, GO TO MOVEMD                53200020
         SPACE 3                                                        53600020
********                                                                54000020
******** GET BUFFER ADDRESS                                             54400020
********                                                                54800020
LOCATEMD EQU   *                                                        55200020
         L     RBUFAD,DCBBUFNO          LOAD ADDR OF BFR CONTROL BLOCK  55600020
         L     RBUFAD,D0(RBUFAD)        LOAD ADDR OF BFR                56000020
         B     GETSIZE                  GO TO GET BFR SIZE              56400020
MOVEMD   EQU   *                                                        56800020
         LR    RBUFAD,R0                LOAD USER BFR ADDR              57200020
********                                                                57600020
******** GET BUFFER SIZE                                                58000020
********                                                                58400020
GETSIZE  EQU   *                                                        58800020
         LH    RBUFSZ,DEBLRECL          GET BUFFER SIZE        @ZA09612 59200003
         SPACE 3                                                        59600020
********                                                                60000020
******** TEST FOR RECORD TYPE AND UPDATE BFR ADDR AND BFR SIZE FOR      60400020
******** V-TYPE RECORD                                                  60800020
********                                                                61200020
         TM    DCBRECFM,M80             U-TYPE OR F-TYPE RECORD         61600020
         BO    FIXED                    YES, GO TO FIXED                62000020
VREC     EQU   *                                                        62400020
         TM    DCBMACRF,M01             TEST FOR DATA MODE              62800020
         BO    DATAMODE                 BRANCH IF YES                   63200020
         LA    RBUFAD,D4(RBUFAD)        INCREMENT BFR ADDR TO PAST      63600020
*                                       CONTROL WORD                    64000020
         SH    RBUFSZ,FOUR              DECREMENT BFR SIZE              64400020
         SPACE 3                                                        64800020
********                                                                65200020
******** PREPARE PARAMETERS AND ISSUE TGET                              65600020
********                                                                66000020
DATAMODE EQU   *                                                        66400020
FIXED    EQU   *                                                        66800020
         LR    R1,RBUFAD                LOAD BFR ADDR                   67200020
         LR    R0,RBUFSZ                LOAD BFR SIZE                   67600020
         TGET  (1),(0)                  ISSUE TGET (UPON RETURN R1 HAS  68000020
*                                       MSG LENGTH)                     68400020
         SPACE 3                                                        68800020
********                                                                69200020
******** TEST RETURN CODE FROM TGET                                     69600020
********                                                                70000020
CKATTN   EQU   *                                                        70400020
         CH    RRETURN,EIGHT            CHECK FOR ATTENTION INTERRUPT   70800020
         BE    FIXED                    GO TO REISSUE TGET              71200020
         NI    DCBOFLGS,M7F             TURN OFF WRITE BIT (THIS        71600020
*                                       IS A READ OPERATION)            72000020
         SPACE 3                                                        72020020
********                                                                72040020
******** FOLD INPUT LOWERCASE ALPHA TO UPPERCASE                        72060002
********                                                                72080020
         LTR   R1,R1                    IS THERE ANY MSG TO FOLD        72100020
         BZ    CKMORMSG                 NO, DO NOT FOLD                 72120020
         LR    RPTR,RBUFAD              POINTS AT START OF BFR          72140020
         LA    RWORK,D1                 SET UP LOOP INDEX               72160020
         LR    RENDMSG,RBUFAD           POINTS AT START OF BUFFER       72180020
         AR    RENDMSG,R1               POINTS AT END OF BFR PLUS 1     72200020
         BCTR  RENDMSG,R0               POINTS AT END OF BUFFER         72220020
LOOP     EQU   *                                                        72240020
         CLI   D0(RPTR),M81             COMPARE TO LOWER A      SA69503 72290002
         BL    TEST                     IF LOW, DONT FOLD       SA69503 72300002
         CLI   D0(RPTR),MA9             COMPARE TO LOWER Z      SA69503 72310002
         BH    TEST                     IF HIGH, DONT FOLD      SA69503 72312002
*****                                                                   72314002
*****         ONLY LOWERCASE ALPHA & IMBEDDED SPECIAL CHARACTERS        72316002
*****         WILL FALL THROUGH THE ABOVE TESTS                         72318002
*****                                                                   72318402
         CLI   D0(RPTR),M89             COMPARE TO LOWER I      SA69503 72318802
         BNH   FOLD                     FOLD LOWER A-I          SA69503 72319202
         CLI   D0(RPTR),MA1             COMPARE TO SPEC.        SA69503 72319602
         BH    FOLD                     FOLD LOWER S-Z          SA69503 72319702
         CLI   D0(RPTR),M90             COMPARE TO SPEC         SA69503 72319802
         BNH   TEST                     DONT FOLD SPEC          SA69503 72320002
         CLI   D0(RPTR),M99             COMPARE TO LOWER R      SA69503 72326602
         BH    TEST                     DONT FOLD SPEC          SA69503 72328602
*                                       FOLD LOWER J-R          SA69503 72330602
FOLD     EQU   *                                                SA69503 72332602
         OI    D0(RPTR),UPPER           FOLD LOWERCASE          SA69503 72333002
*                                       ALPHA TO UPPER          SA69503 72333102
TEST     EQU   *                                                        72340020
         BXLE  RPTR,RWORK,LOOP          INCREMENT PTR AND TEST          72360020
         SPACE 3                                                        72380020
CKMORMSG EQU   *                                                        72390020
         CH    RRETURN,TWELVE           IS BFR TOO SMALL FOR MSG        72590020
         BNE   SUCCESS                  NO, GO TO SUCCESS               72800020
         SPACE 3                                                        73600020
********                                                                74000020
******** CHECK FOR V-TYPE RECORD, IF IT IS, FILL IN CONTROL WORD        74400020
********                                                                74800020
DESCRIBE EQU   *                                                        75200020
         TM    DCBRECFM,M40             TEST FOR V-TYPE OR U-TYPE       75600020
*                                       RECORD                          76000020
         BNO   RETURN                   BRANCH IF NO                    76400020
         STH   R1,DCBLRECL              UPDATE DCBLRECL                 76800020
         TM    DCBRECFM,MC0             TEST FOR U-TYPE RECORD          76900020
         BO    RETURN                   BRANCH IF YES                   77000020
         TM    DCBMACRF,M01             TEST FOR DATA MODE              77200020
         BO    RETURN                   BRANCH IF YES                   77600020
         SH    RBUFAD,FOUR              DECREMENT BFR ADDR PTR TO       78000020
*                                       POINT AT CONTROL WORD           78400020
         AH    R1,FOUR                  ADD LENGTH OF RECORD DESCRIPTOR 78800020
*                                       WORD                            79200020
         STC   R1,D1(RBUFAD)            FILL IN LL FIELD OF CONTROL     79600020
*                                       WORD                            80000020
         SRL   R1,M8                    GET THE OTHER L                 80400020
         STC   R1,D0(RBUFAD)            FILL IN LL FIELD OF CONTROL     80800020
*                                       WORD                            81200020
         XC    D2(L2,RBUFAD),D2(RBUFAD) ZERO OUT BB IN CONTROL WORD     81600020
         MVC   DCBLRECL,D0(RBUFAD)      UPDATE LRECL                    82000020
RETURN   EQU   *                                                        82400020
         LR    R1,RBUFAD                LOAD RECORD ADDRESS             82800020
         ST    R1,DCBRECAD              STORE ADD IN INPUT DCB  SA69128 82850002
         L     R14,D12(R13)             RESTORE REG 14                  83200020
         L     R0,D20(R13)              RESTORE REG 0                   83600020
         LM    R2,R12,D28(R13)          RESTORE REGS 2-12               84000020
         BR    R14                      RETURN TO CALLER                84400020
         SPACE 3                                                        84800020
SUCCESS  EQU   *                                                        85200020
         CH    R1,TWO                   IS MESSAGE LENGTH 2             86000020
         BNE   DESCRIBE                 BRANCH IF NOT                   86800020
CKBUF    EQU   *                                                        87600020
         CLC   D0(L2,RBUFAD),END        IS IT /*                        88000020
         BNE   DESCRIBE                 BRANCH IF NOT                   88400020
CKEOD    EQU   *                                                        88800020
         TM    DCBEODAD+C3,M01          IS EOD RTN ADDR FURNISHED       89200020
         BZ    GOTHERE                  YES, GO TO GOTHERE              89600020
ABEND    EQU   *                                                        89800020
         DMABCOND EABD174,DCB=(RDCB),SVC=YES                     S21042 90300021
GOTHERE  EQU   *                                                        90800020
         L     R15,DCBEODAD             LOAD ADDR OF EOD RTN            91200020
         L     R14,D12(R13)             RESTORE REG 14                  91600020
         LM    R0,R12,D20(R13)          RESTORE REGS 0-12               92000020
         BR    R15                      BRANCH TO CALLER EOD ADDR       92400020
         SPACE 3                                                        92480020
         SPACE 3                                                        92800020
********                                                                93200020
******** CONSTANTS                                                      93600020
********                                                                94000020
FOUR     DC    H'4'                     USED TO DECREMENT BFR SIZE      94400020
TWO      DC    H'2'                     CONSTANT OF 2                   94500020
EIGHT    DC    H'8'                     CONSTANT OF 8                   94600020
TWELVE   DC    H'12'                    CONSTANT OF 12                  94700020
SIXTEEN  DC    H'16'                    CONSTANT OF 16                  94730020
END      DC    C'/*'                    DEFINES EOD                     94800020
PATCHIT  DC    10F'0'                   PATCH AREA             @AZ09612 95000003
         SPACE 3                                                        95240020
         DS    0F                                                       95280020
DEB      DSECT                                                          95320020
         DS    CL32                     DEB BASIC SECTION               95360020
         DS    CL4                      DEB EXTENT                      95400020
         DS    CL12                     DEB BSAM/QSAM DEPENDENT SECTION 95440020
DEBBLKSI DS    CL2                      BLOCK SIZE SAVE AREA            95480020
DEBLRECL DS    CL2                      LRECL SAVE AREA                 95520020
         SPACE 3                                                        95600020
         DCBD  DSORG=PS                                                 96000020
         END                                                            96400020
./  ADD  SSI=53350181,NAME=IGG019T4
19T4     TITLE 'IGG019T4 - QSAM TSPUT'                          SA66590 00300002
IGG019T4 CSECT                                                          00600020
*********************************************************************** 00900020
*                                                                     * 01200020
*        VS2  030   SU                                                  01201003
*                                                                       01202003
*0000511100-511200                                             @ZA06431 01203003
*                                                                       01204003
*                                                                       01205003
* RELEASE 21.8 CHANGES                                          SA66590 01210002
*C003000,122600                                                 SA66590 01220002
*A123100,537500-541500,492500,729700                            SA66590 01232002
*D33600-342000                                                  SA69128 01234002
*A333500                                                        SA69128 01234402
* RELEASE 21.0 CHANGES                                                * 01240002
*                                                                 M2432 01340020
*                                                                M3504  01350020
*                                                                 M5508 01355020
*                                                                M7471  01357020
*A433500,510500-512000                                          ZA02232 01359000
*                                                                     * 01360020
* STATUS CHANGE LEVEL - VS2  030 SU                            @ZA06431 01400003
*                                                                     * 01440020
* NAME - IGG019T4.                                                    * 01500020
*                                                                     * 01800020
* FUNCTION/OPERATION - THIS INTERFACE ROUTINE PERFORMS THE FOLLOWING  * 02100020
*                      FUNCTIONS                                      * 02400020
*                                                                     * 02700020
*                      FURNISH TPUT USER BUFFER ADDRESS (MOVE MODE),  * 03000020
*                      OR ADDRESS OF SYSTEM BUFFER IN BFFER POOL      * 03300020
*                      (LOCATE MODE).                                 * 03600020
*                                                                     * 03900020
*                      FURNISH TPUT BUFFER SIZE.                      * 04200020
*                                                                     * 04500020
*                      ISSUE TPUT WHICH CAUSES A RECORD TO BE WRITTEN * 04800020
*                      TO A TERMINAL.                                 * 05100020
*                                                                     * 05400020
*                      UPON REGAIN CONTROL FROM TPUT, RETURN TO USER  * 05700020
*                      THE ADDRESS OF RECORD WRITTEN IN REGISTER 1.   * 06000020
*                                                                     * 06300020
*                      FOR THE FIRST PUT ISSUED IN LOCATE MODE, ONLY  * 06600020
*                      ADDRESS OF BUFFER IS RETURNED IN REGISTER 1.   * 06900020
*                      (THE RECORD IS ACTUALLY WRITTEN OUT ON THE     * 07200020
*                      SECOND AND FOLLOWING PUTS.)                    * 07500020
*                                                                     * 07800020
* ENTRY POINTS - PUT - IGG019T4                                       * 07860020
*                PUTX - IGG019T4 + 4                                  * 07920020
*                TRUNC/RELSE - IGG019T4 + 8                           * 07980020
*                                                                     * 08040020
*                CONTROL IS RECEIVED WHEN THE FOLLOWING CONDITIONS    * 08100020
*                ARE MET.                                             * 08160020
*                                                                     * 08220020
*                THE TASK IS TIME SHARING.                            * 08280020
*                THE DCB OPENED IS FOR QSAM OUTPUT.                   * 08340020
*                A PUT, PUTX, TRUNC, OR RELSE MACRO INSTRUCTION IS    * 08400020
*                ISSED.                                               * 08460020
*                                                                     * 08520020
* INPUT -                                                             * 08580020
*                                                                     * 08700020
*         FOR PUT -                                                   * 09000020
*                                                                     * 09300020
*                   REGISTER 0 HAS USER BUFFER ADDRESS                * 09600020
*                   REGISTER 1 HAS DCB ADDRESS                        * 09900020
*                                                                     * 10200020
*         FOR PUTX -                                                  * 10500020
*                                                                     * 10800020
*                   REGISTER 0 HAS IN DCB ADDRESS                     * 11100020
*                   REGISTER 1 HAS OUT DCB ADDRESS                    * 11400020
*                                                                     * 11700020
* OUTPUT - A RECORD WRITTEN TO A TERMINAL.                            * 11770020
*          THE ADDRESS OF THE RECORD IN REGISTER 1.                   * 11840020
*                                                                     * 11910020
* EXTERNAL REFERENCE - IGC0009C.                                      * 11980020
*                                                                     * 12050020
* EXIT, NORMAL - RETURN CONTROL TO CALLER VIA A 'BR 14' INSTRUCTION.  * 12120020
*                                                                     * 12190020
* EXIT, ERROR - ABEND 002 IF RECFM V LT 4 BYTES, OR             SA66590 12260002
*        RECFM VA OR VM (CONTROL CHAR) LT 5 BYTES.              SA66590 12310002
*                                                                     * 12330020
* TABLE/WORK AREAS - NONE.                                            * 12400020
*                                                                     * 12470020
* ATTRIBUTES - REENTRANT, REUSABLE.                                   * 12540020
*                                                                     * 12610020
* CHARACTER CODE DEPENDENCY -                                         * 12680020
*                                                                     * 12750020
* NOTES -                                                             * 12820020
*                                                                     * 12900020
*********************************************************************** 13200020
         SPACE 3                                                        13500020
********                                                                13800020
******** REGISTER EQUATES                                               14100020
********                                                                14400020
R0       EQU   0                        CONTAINS BFR ADDR WHEN THIS     14700020
*                                       MODULE GETS CONTROL, ALSO       15000020
*                                       CONTAINS BFR SIZE FOR TPUT      15300020
R1       EQU   1                        CONTAINS DCB ADDR WHEN THIS     15600020
*                                       MODULE GETS CONTROL, ALSO       15900020
*                                       CONTAINS BFR ADDR FOR TPUT      16200020
R2       EQU   2                        REGISTER 2                      16500020
RDCB     EQU   2                        POINTS AT DCB                   16800020
RBUFAD   EQU   3                        POINTS AT BUFFER                17100020
RBUFSZ   EQU   4                        CONTAINS BFR SIZE               17400020
RPUTX    EQU   5                        INDICATE ENTRY MADE BY PUTX     17600020
*                                       IF CONTENT IS 1                 17800020
RWORK    EQU   6                        WORK REGISTER                   18000020
REOBAD   EQU   7                        POINTS AT END OF BLOCK ADDR     18060020
*                                       FOR LOCATE MODE                 18120020
RRECAD   EQU   8                        POINTS AT RECORD ADDR FOR       18180020
*                                       LOCATE MODE                     18240020
RDEB     EQU   9                        CONTAIN DEB ADDRESS             18270020
RBASE    EQU   12                       BASE REGISTER                   18300020
R12      EQU   12                       REGISTER 12                     18600020
R14      EQU   14                       CONTAINS RETURN ADDR            18900020
R13      EQU   13                       REGISTER 13                     19200020
R15      EQU   15                       CONTAINS ADDR TO BRANCH TO      19500020
RRETURN  EQU   15                       CONTAINS RETURN CODE            19800020
         SPACE 3                                                        20100020
********                                                                20400020
******** EQUATES FOR DISPLACEMENTS, LENGTH AND MASKS                    20700020
********                                                                21000020
QSAMLOCT EQU   X'48'                    PUT/LOCATE MODE IN DCBMACRF     21300020
D0       EQU   0                        DISPLACEMENT                    21600020
D1       EQU   1                        DISPLACEMENT                    21900020
D2       EQU   2                        DISPLACEMENT                    22200020
D4       EQU   4                        DISPLACEMENT                    22500020
D12      EQU   12                       DISPLACEMENT                    22800020
D20      EQU   20                       DISPLACEMENT OF 20              23100020
D28      EQU   28                       DISPLACEMENT                    23400020
M80      EQU   X'80'                    DENOTES 1ST PUT IN BFR POOL     23700020
*                                       CONTROL BLOCK, AND WRITE BIT    24000020
*                                       IN DCBOFLGS, F-TYPE RECORD IN   24200020
*                                       DCBRECFM                        24400020
M7F      EQU   X'7F'                    MASK TO TURN OFF 1ST PUT        24600020
M06      EQU   X'06'                    ASA OR MACHINE CHAR USED        24900020
MC0      EQU   X'C0'                    U-TYPE RECORD IN DCBRECFM       25200020
M40      EQU   X'40'                    V-TYPE RECORD IN DCBRECFM       25500020
M8       EQU   8                        MASK USED TO SHIFT REGISTER     25800020
         SPACE 3                                                        25830020
         SPACE 3                                                        26100020
********                                                                26400020
******** PUT ENTRY                                                      26700020
********                                                                27000020
         USING IGG019T4,R15             USE ENTRY ADDR AS BASE ADDR     27300020
         B     STARTPUT                 BR PAST PUTX & TRUNC/RELSE      27600020
*                                       ENTRY                           27900020
********                                                                28200020
******** PUTX ENTRY                                                     28500020
********                                                                28800020
         B     STRTPUTX                 BR PAST TRUNC/RELSE ENTRY       29100020
         SPACE 3                                                        29400020
********                                                                29700020
******** TRUNC/RELSE ENTRY                                              30000020
********                                                                30300020
         BR    R14                      NOP FOR TRUNC & RELSE ROUTINES  30600020
*                                       (RETURN TO USER)                30900020
         SPACE 3                                                        31200020
********                                                                31500020
******** SAVE REGISTERS, GET BUFFER ADDRESS FOR PUTX                    31800020
********                                                                32100020
STRTPUTX EQU   *                                                        32400020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  32700020
         LA    RPUTX,D1                 SIGNAL ENTRY MADE BY PUTX       32800020
         USING IHADCB,RDCB              ESTABLISH ADDRESSABILITY        33000020
         LR    RDCB,R0                  SAVE INPUT DCB ADDR             33300020
         L     R0,DCBRECAD              GET REC @ FROM INPUT DCBSA69128 33350002
         B     STUPBASE                 UNCONDITIONAL BRANCH            34500020
         SPACE 3                                                        34800020
********                                                                35100020
******** SAVE REGISTERS AND ESTABLISH ADDRESSABILITY                    35400020
********                                                                35700020
STARTPUT EQU   *                                                        36000020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  36300020
         SR    RPUTX,RPUTX              SIGNAL ENTRY MADE BY PUT        36400020
STUPBASE EQU   *                                                        36600020
         LR    RBASE,R15                GET BASE ADDR                   36900020
         DROP  R15                      GET RID OF PREVIOUS BASE REG    37200020
         USING IGG019T4,RBASE           ESTABLISH ADDRESSABILITY        37500020
         B     BRARID                   BRANCH AROUND ID       @ZA06431 37560003
         DC    C'IGG019T4'              MODULE ID              @ZA06431 37620003
         DC    X'5317'                  DATE 11/13/75          @ZA06431 37680003
BRARID   EQU   *                                               @ZA06431 37740003
         SPACE 3                                                        37800020
********                                                                38100020
******** GET BUFFER ADDRESS FOR PUT                                     38400020
********                                                                38700020
         LR    RDCB,R1                  GET DCB ADDRSS                  39000020
         TM    DCBMACRF+1,QSAMLOCT      TEST FOR PUT/LOCATE MODE        39300020
         BNO   MOVEMD                   NO, GO TO MOVEMD                39600020
LOCATEMD EQU   *                                                        39900020
         LTR   RPUTX,RPUTX              IS ENTRY MADE BY PUTX           40000020
         BNZ   MOVEMD                   BRANCH IF YES                   40100020
         L     RBUFAD,DCBBUFNO          GET BFR POOL CONTROL BLOCK ADDR 40200020
         L     RBUFAD,D0(RBUFAD)        GET BFR ADDR                    40500020
********                                                                40800020
******** TEST FOR FIRST PUT                                             41100020
********                                                                41400020
         L     RWORK,DCBBUFNO           GET ADDR OF BFR POOL CONTROL    41700020
*                                       BLOCK                           42000020
         USING BUFPOOL,RWORK                                            42300020
         TM    PUTFLAG,M80              TEST FOR FIRST PUT              42600020
         BNO   NOTFIRST                 BRANCH IF NO                    42900020
         NI    PUTFLAG,M7F              TURN OFF FLAG FOR FIRST PUT     43200020
         LA    RBUFAD,D0(,RBUFAD)       ZERO FLAG BYTE                  43300020
         MVC   DCBPRECL(2),DCBLRECL     SAVE LENGTH OF NEXT REC ZA02232 43350000
         B     RETBUFAD                 GO TO RETBUFAD                  43500020
NOTFIRST EQU   *                                                        43530020
         TM    DCBRECFM,M80             CHECK FOR U OR F RECORD         43560020
         BNO   VRECORD                  BRANCH IF V-TYPE                43590020
* BYPASS TPUT IF RECAD OR EOBAD HAVE BEEN MODIFIED BY USER.             43600000
* TSPUT DOES NOT HANDLE BLOCKED RECORDS, SO END OF BLOCK CONDITION      43610000
* IS SET UP AT EACH EXIT FROM THIS MODULE.                              43612000
         LM    REOBAD,RRECAD,DCBEOBAD   GET RECAD AND EOBAD             43620020
         CR    REOBAD,RRECAD            ARE THEY THE SAME               43650020
         BNE   RETBUFAD                 BRANCH IF NO                    43680020
         B     FIXED                    GO TO GET MSG LENGTH            43710020
         SPACE 3                                                        43800020
MOVEMD   EQU   *                                                        44100020
         LR    RBUFAD,R0                GET USER BFR ADDRESS            44400020
         SPACE 3                                                        44700020
********                                                                45000020
******** TEST FOR U-TYPE, V-TYPE OR F-TYPE RECORD AND GET BUFFER SIZE   45300020
********                                                                45600020
         TM    DCBRECFM,M80             CHECK FOR U-TYPE OR F-TYPE      46300020
*                                       RECORD                          46700020
         BO    FIXED                    YES, GO TO FIXED                47100020
VRECORD  EQU   *                                                        47700020
         SR    RBUFSZ,RBUFSZ            CLEAR REG                       48000020
         IC    RBUFSZ,D0(RBUFAD)        GET ONE L FROM CONTROL WORD     48300020
         SLL   RBUFSZ,M8                MAKE ROOM FOR OTHER L           48600020
         IC    RBUFSZ,D1(RBUFAD)        GET SECOND L FROM CONTROL WORD  48900020
         SH    RBUFSZ,FOUR              SUBTRACT 4 FOR CONTROL WORD     49200020
         BM    ABEND                    NEG RECORD LENGTH, ABND SA66590 49250002
         LA    RBUFAD,D4(RBUFAD)        UPDATE BFR PTR TO PASS CONTROL  49500020
*                                       WORD                            49800020
         B     CKCHAR                   GO TO READY                     50400020
FIXED    EQU   *                                                        50700020
         LH    RBUFSZ,DCBLRECL          GET RECORD SIZE                 51000020
         TM    DCBRECFM,MC0             FORMAT U RECORD         ZA02232 51050000
         BM    CKCHAR                   NO, BRANCH              ZA02232 51100000
         TM    DCBMACF2,QSAMLOCT        PUT,LOCATE MODE?       @ZA06431 51110003
         BNO   CKCHAR                   NO, BRANCH             @ZA06431 51120003
         LH    RBUFSZ,DCBPRECL          GET LENGTH CURRENT REC  ZA02232 51150000
         MVC   DCBPRECL(2),DCBLRECL     SAVE LENGTH NEXT RECORD ZA02232 51200000
         SPACE 3                                                        51300020
********                                                                51600020
******** CHECK FOR ASA OR MACHINE CHARACTER                             51900020
********                                                                52200020
CKCHAR   EQU   *                                                        52500020
         TM    DCBRECFM,M06             TEST FOR ASA OR MACHINE CHAR    52800020
         BZ    READY                    NO, GO TO READY                 53100020
         LA    RBUFAD,D1(RBUFAD)        UPDAT BFR PTR BY 1              53400020
         BCTR  RBUFSZ,R0                DECREMENT BFR SIZE BY 1         53700020
         LTR   RBUFSZ,RBUFSZ            CHECK FOR NEG SIZE      SA66590 53750002
         BNM   READY                    O.K., GO PUT IT OUT     SA66590 53800002
         SPACE 3                                                        53850002
********                                                                53900002
******** ABEND THE USER - HIS RECORD WAS TOO SHORT              SA66590 53950002
********                                                                54000002
ABEND    EQU   *                                                SA66590 54050002
         L     R1,ABCODE                LOAD ABEND CODE         SA66590 54100002
         ABEND (1)                      ISSUE ABEND SVC         SA66590 54150002
         SPACE 3                                                        54600020
********                                                                54900020
******** PREPARE PARAMETERS AND ISSUE TPUT                              55200020
********                                                                55500020
READY    EQU   *                                                        55800020
         LR    R0,RBUFSZ                LOAD BFR SIZE                   56100020
         LR    R1,RBUFAD                LOAD BFR ADDRESS                56400020
         TPUT  (1),(0)                  ISSUE TPUT                      56700020
         SPACE 3                                                        57000020
********                                                                59700020
******** UPON RETURN FROM TPUT                                          60000020
********                                                                60300020
SUCCESS  EQU   *                                                        60600020
         OI    DCBOFLGS,M80             TURN ON WRITE BIT               60900020
         SPACE 3                                                        61200020
*********                                                               61500020
*********TEST FOR V-TYPE RECORD AND ASA OR MACHINE CHARACTER, AND       61800020
*********RESTORE BUFFER POINTER ACCORDINGLY                             62100020
*********                                                               62400020
CHECK    EQU   *                                                        62700020
         TM    DCBRECFM,M06             IS ASA OR MACHINE CODE USED     63100020
         BZ    CKVREC                   BRANCH IF NO                    63500020
         BCTR  RBUFAD,R0                SET BACK BFR ADDR BY 1          63900020
CKVREC   EQU   *                                                        64500020
         TM    DCBRECFM,M80             CHECK FOR U-TYPE OR F-TYPE      64900020
*                                       RECORD                          65300020
         BO    RETBUFAD                 BRANCH IF YES                   65900020
         SH    RBUFAD,FOUR              SET BACK BFR ADDR BY 4          66600020
         SPACE 3                                                        66900020
********                                                                67200020
******** PUT BUFFER ADDRESS IN REGISTER 1, RESTORE REGISTERS AND        67500020
******** RETURN TO CALLER                                               67800020
********                                                                68100020
RETBUFAD EQU   *                                                        68400020
         LR    R1,RBUFAD                PUT BFR ADDR IN REG 1           68700020
         TM    DCBMACRF+1,QSAMLOCT      CHECK FOR LOCATE MODE           68710020
         BNO   EXIT                     BRANCH IF MOVE MODE             68720020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 68730020
         USING DEB,RDEB                                                 68740020
         AH    RBUFAD,DEBLRECL          POINT AT END OF BFR             68750020
         ST    RBUFAD,DCBEOBAD          UPDATE DCBEOBAD                 68760020
         ST    RBUFAD,DCBRECAD          UPDATE DCBRECAD                 68770020
EXIT     EQU   *                                                        68800020
         L     R14,D12(R13)             RESTORE REG 14                  69000020
         L     R0,D20(R13)              RESTORE REG 0                   69300020
         LM    R2,R12,D28(R13)          RESTORE REGS 2-12               69600020
         BR    R14                      RETURN CONTROL TO CALLER        69900020
         SPACE 3                                                        70200020
********                                                                70500020
******** CONSTANTS                                                      70800020
********                                                                71100020
FOUR     DC    H'4'                     CONSTANTS OF 4                  72300020
         SPACE 3                                                        72930020
         DS    0F                                                       72960020
ABCODE   DC    X'80002000'              DUMP/STEP & COMPL. CODE SA66590 72970002
PATCH    DC    10F'0'                   PATCH AREA                      72980003
DEB      DSECT                                                          72990020
         DS    CL32                     DEB BASIC SECTION               73020020
         DS    CL4                      DEB EXTENT                      73050020
         DS    CL12                     DEB BSAM/QSAM DEPENDENT SECTION 73080020
DEBBLKSI DS    CL2                      BLOCK SIZE SAVE AREA            73110020
DEBLRECL DS    CL2                      LRECL SAVE AREA                 73140020
         SPACE 3                                                        73200020
         DCBD  DSORG=PS                                                 73500020
         DS    0F                                                       73800020
BUFPOOL  DSECT                                                          74100020
PUTFLAG  DS    CL1                      FLAG FOR 1ST PUT SET BY OPEN    74400020
         END                                                            74700020
./  ADD  SSI=81450462,NAME=IGG019T5
19T5     TITLE 'IGG019T5 - TS BSAM READ/WRITE ROUTINE'          SA66590 00300002
IGG019T5 CSECT                                                          00600020
*********************************************************************** 00900020
*                                                                     * 01200020
* RELEASE 21.8 CHANGES                                                * 01240002
*A474500,525500-527920,810500                                   SA66590 01290002
*C003000,110000,014170                                          SA66590 01300002
*D242000,242500,663520-663640                                   SA69503 01310002
*A261500-263920,663580-663791                                   SA69503 01312002
* RELEASE 21 DELETIONS/CHANGES                                        * 01320020
*1395252000,471000-477000,684000,702000-705000,793000-797000     A42898 01340021
*                                                                     * 01360020
*                                                                M3038  01370020
*0000                                                            TS1616 01380020
* RELEASE 037 CHANGES                                            M1565  01385003
*C657000,769000                                               @ZA25486  01388003
*                                                                M5422  01395020
*                                                                M6374  01397020
* STATUS CHANGE LEVEL 002                                       SA66590 01417002
*                                                                     * 01440020
* NAME - IGG019T5 (TS READ/WRITE)                                     * 01500020
*                                                                     * 01800020
* FUNCTION/OPERATION - THIS INTERFACE ROUTINE PERFORMS THE FOLLOWING  * 02100020
*                      FUNCTIONS                                      * 02400020
*                                                                     * 02700020
*                      PREPARE PARAMETERS FOR TGET/TPUT, AND ISSUE    * 03000020
*                      TGET/TPUT MACROS WHICH CAUSE AN EDITED         * 03300020
*                      (SPECIALLY-INDICATED CHARACTERS ARE OMITTED)   * 03600020
*                      BLOCK OF TEXT TO BE TRANSMITTED TO THE         * 03900020
*                      BUFFRR (TGET) OR TO BE WRITTEN OUT TO THE      * 04200020
*                      TERMINAL (TPUT).                               * 04500020
*                                                                     * 04550020
*                      UPON REGAIN CONTROL FROM TGET/TPUT SET EDB     * 04600020
*                      COMPLETION CODE TO X'7F'. WHEN END OF FILE IS  * 04650020
*                      REACHED FOR READ, SET ECB COMPLETION CODE TO   * 04700020
*                      X'41'.                                         * 04750020
*                                                                     * 04800020
* ENTRY POINT - IGG019T7, BEGINNING OF MODULE. CONTROL IS RECEIVED    * 05000020
*               WHEN THE FOLLOWING CONDITIONS ARE MET.                * 05200020
*                                                                     * 05400020
*               THE TASK IS TIME SHARING.                             * 05600020
*               THE DCB OPENED IS FOR BSAM INOUT,OUTIN, OR UPDAT.     * 05800020
*               A READ OR A WRITE MACRO INSTRUCTION IS ISSUED.        * 06000020
*                                                                     * 06600020
* INPUT - DECB NAME, TYPE (IGNORED) DCB ADDRESS, BUFFER ADDRESS, 'S'  * 08400020
*         OR LENGTH OF DATA.                                          * 08700020
*                                                                     * 09000020
* OUTPUT - AN EDITED (SPECIALLY-INDICATED CHARACTERS ARE OMITTED)     * 09300020
*          BLOCK OF TEXT, EITHER MOVED TO THE BUFFER (FOR READ), OR   * 09600020
*          WRITTEN TO THE TERMINAL (FOR WRITE).                       * 09900020
*                                                                     * 10200020
* EXTERNAL REFERENCE - IGC0009C.                                      * 10500020
*                                                                     * 10800020
* EXIT, NORMAL - RETURN CONTROL TO CALLER VIA 'BR 14' INSTRUCTION.    * 10900020
*                                                                     * 11000020
* EXIT, ERROR - ABEND 002 IF VARIABLE-LENGTH RECORD TOO SHORT   SA66590 11100002
*                                                                     * 11200020
* TABLE/WORK AREA - NONE.                                             * 11300020
*                                                                     * 11400020
* ATTRIBUTES - REENTRANT, REUSABLE.                                   * 11500020
*                                                                     * 11600020
* CHARACTER DEPENDENCY -                                              * 11700020
*                                                                     * 11800020
* NOTES -                                                             * 11900020
*                                                                     * 12000020
*********************************************************************** 12300020
         SPACE 3                                                        12600020
********                                                                12900020
******** REGISTER EQUATES                                               13200020
********                                                                13500020
R0       EQU   0                        CONTAINS BFR SIZE FOR TGET/TPUT 13800020
RSW      EQU   0                        SWITCH FOR FOLDING CHARS        13900020
R1       EQU   1                        POINTS AT DECB WHEN THIS        14100020
*                                       ROUTINE GETS CONTROL, CONTAINS  14400020
*                                       BUFR ADDR FOR TPUT              14700020
RDCB     EQU   2                        POINTS AT DCB                   15000020
RDECB    EQU   3                        POINTS AT DECB                  15300020
RECB     EQU   4                        POINTS AT ECB                   15600020
RBUFAD   EQU   5                        POINTS AT BFR ADDR              15900020
RBUFSZ   EQU   6                        CONTAINS BFR SIZE               16200020
RDEB     EQU   8                        POINTS AT DEB                   16600020
RPTR     EQU   9                        POINTS AT BFR FOR FOLDING MSG   16650020
RWORK    EQU   10                       WORK REGISTER                   16700020
RENDMSG  EQU   11                       POINTS AT END OF MSG            16750020
R12      EQU   12                       REGISTER 12                     16800020
RBASE    EQU   12                       BASE REGISTER                   17100020
R13      EQU   13                       POINTS AT CALLER'S SAVE AREA    17400020
R14      EQU   14                       POINTS AT RETURN ADDR           17700020
R15      EQU   15                       POINTS AT ADDR TO BRANCH TO     18000020
RRETURN  EQU   15                       CONTAINS RETURN CODES           18300020
         SPACE 3                                                        18600020
********                                                                18900020
******** EQUATES FOR DISPLACEMENTS, LENGTH, AND MASKS                   19200020
********                                                                19500020
C3       EQU   3                        CONSTANT OF 3                   19800020
C15      EQU   15                       CONSTANT OF 15                  19900020
M01      EQU   X'01'                    MASK USED TO TEST EOD RTN ADDR  20100020
M0C      EQU   X'0C'                    DENOTES CHANNEL END DEVICE END  20200020
ZERO     EQU   X'00'                    CONSTANT 0                      20300020
MC0      EQU   X'C0'                    U-TYPE RECORD IN DCBRECFM       20400020
M80      EQU   X'80'                    READ SF IN DECTYPE+1            20700020
*                                       'S' CODED FOR LENGTH IN DECTYPE 21000020
*                                       WRITE OPERATION IN DCBOFLGS     21300020
*                                       F-TYPE RECORD IN DCBRECFM       21600020
M7F      EQU   X'7F'                    READ OPERATION IN DCBOFLGS      21900020
*                                       COMPLETION BIT IN ECB           22200020
M41      EQU   X'41'                    DENOTES ECB COMPLETE WITH I/O   22300020
*                                       ERROR (EOD)                     22400020
M40      EQU   X'40'                    V-TYPE RECORD IN DCBRECFM       22500020
M06      EQU   X'06'                    ASA/MACHINE CHAR USED IN        22800020
*                                       DCBRECFM                        23100020
MBF      EQU   X'BF'                    USED TO TURN OFF READ BACKWARD  23400020
*                                       IN DCBOFLGS                     23700020
MFE      EQU   X'FE'                    MASK TO ZERO OUT RESIDUAL CT    23800020
M8       EQU   8                        USED TO SHIFT REGISTER          24000020
EOF      EQU   X'20'                    END OF FILE                     24100020
D0       EQU   0                        DISPLACEMENT OF 0               24300020
D1       EQU   1                        DISPLACEMENT OF 1               24600020
D2       EQU   2                        DISPLACEMENT OF 2               24900020
D8       EQU   8                        DISPLACEMENT OF 8        A42898 25200021
D12      EQU   12                       DISPLACEMENT OF 12              25500020
D20      EQU   20                       DISPLACEMENT OF 20              25800020
L2       EQU   2                        LENGTH OF 2                     26100020
*****                                                                   26150002
*****    MASKS FOR ISOLATING LOWERCASE ALPHA FOR FOLD TO UPPERCASE      26200002
*****                                                                   26250002
M81      EQU   X'81'                    LOWERCASE A             SA69503 26300002
MA9      EQU   X'A9'                    LOWERCASE Z             SA69503 26350002
M89      EQU   X'89'                    LOWERCASE I             SA69503 26360002
M90      EQU   X'90'                    SPECIAL CHAR            SA69503 26370002
M99      EQU   X'99'                    LOWERCASE R             SA69503 26380002
MA1      EQU   X'A1'                    SPECIAL CHAR            SA69503 26390002
UPPER    EQU   X'40'                    USED TO FOLD MSG        SA69503 26392002
         SPACE 3                                                        26400020
         SPACE 3                                                        30900020
********                                                                31200020
******** SAVE REGISTERS AND ESTABLISH ADDRESSABILITY                    31500020
********                                                                31800020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  32100020
         LR    RBASE,R15                USE ENTRY ADDR AS BASE ADDR     32400020
         USING IGG019T5,RBASE           ESTABLISH ADDRESSABILITY        32700020
         USING IHADCB,RDCB              ESTABLISH ADDRESSABILITY        33000020
         USING DECB,RDECB               ESTABLISH ADDRESSABILITY        33300020
         USING DEB,RDEB                 ESTABLISH ADDRESSABILITY        33400020
         SPACE 3                                                        33600020
********                                                                33900020
******** INITIALIZATION AND GET BUFFER ADDRESS                          34200020
********                                                                34500020
         LR    RDECB,R1                 SAVE DECB ADDRESS               34800020
         L     RDCB,DECDCBAD            GET DCB ADDRESS                 35100020
         LA    RECB,DECSDECB            GET ADDR OF ECB                 35400020
         L     RBUFAD,DECAREA           GET BUFFER ADDRESS              35700020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 35800020
         TM    DECTYPE+1,M80            IS IT A READ OPERATION          35810020
         BNO   CONTINUE                 BRANCH IF NOT                   35820020
         TM    DCBCIND1,EOF             IS EOF REACHED                  35830020
         BO    RETURN                   RETURN CONTROL TO CALLER        35860020
CONTINUE EQU   *                                                        35880020
         MVI   D0(RECB),M80             SET ECB WAIT BIT                35900020
         LA    RWORK,DCBIOBL            PUT DUMMY IOB ADDR IN REG       36000020
         ST    RWORK,DECIOBPT           PUT DUMMY IOB ADDR IN DECB      36100020
         SPACE 3                                                        36300020
********                                                                36600020
******** TEST RECORD TYPE AND GET BUFFER SIZE                           36900020
********                                                                37200020
         TM    DCBRECFM,MC0             CHECK FOR U-TYPE RECORD         37500020
         BNO   TESTMORE                 NO, GO TO TESTMORE              37800020
UTYPE    EQU   *                                                        38100020
         TM    DECTYPE,M80              IS 'S' SPECIFIED                38500020
         BO    LNGINDCB                 YES, GET LENGTH FROM DCBBLKSI   38700020
LNGNDECB EQU   *                                                        39000020
         LH    RBUFSZ,DECLNGTH          GET BUFFER SIZE                 39300020
         N     RBUFSZ,ZEROHALF          CLEAR HIGH ORDER 2 BYTES        39600020
         B     CKOP                     GO TO CHECK OPERATION IS FOR    39900020
*                                       READ OR FOR WRITE               40200020
LNGINDCB EQU   *                                                        40500020
         LH    RBUFSZ,DCBBLKSI          GET BUFFER SIZE FROM DCB        40800020
         B     CKOP                     GO TO CHECK OPERATION IS FOR    41100020
*                                       READ OR FOR WRITE               41400020
TESTMORE EQU   *                                                        41700020
         TM    DCBRECFM,M40             CHECK FOR V-TYPE RECORD         42000020
         BZ    LNGINDCB                 NO, LENGTH IS IN DCBBLKSI       42300020
VTYPE    EQU   *                                                        42600020
         TM    DECTYPE+1,M80            IS IT A READ OPERATION          42900020
         BO    READOP                   YES, GO TO READOP               43200020
WRITEOP  EQU   *                                                        43500020
         SR    RBUFSZ,RBUFSZ            CLEAR REGISTER                  43800020
         IC    RBUFSZ,D0(RBUFAD)        GET 1 L FROM RECORD DESCRIPTOR  44100020
*                                       WORD                            44400020
         SLL   RBUFSZ,M8                PUT 1ST L IN PLACE              44700020
         IC    RBUFSZ,D1(RBUFAD)        GET OTHER L FROM RECORD         45000020
*                                       DESCRIPTOR WORD                 45300020
         B     MINUS4                   GO TO SUBTRACT LENGTH OF RECORD 45600020
*                                       DESCRIPTOR WORD                 45900020
READOP   EQU   *                                                        46200020
         LH    RBUFSZ,DCBBLKSI          GET BUFFER SIZE FROM DCB        46500020
MINUS4   EQU   *                                                        46800020
         SH    RBUFSZ,EIGHT             TAKE OFF LNG FOR BLK AND A42898 47100021
*                                       RECORD DESCRIPTOR WORDS         47400021
         BM    ABEND                    ABEND IF NEGATIVE       SA66590 47450002
         LA    RBUFAD,D8(RBUFAD)        MOVE UP PTR              A42898 47700021
         SPACE 3                                                        48000020
********                                                                48300020
******** TEST FOR READ OR WRITE AND ISSUE TGET OR TPUT ACCORDINGLY      48600020
********                                                                48900020
CKOP     EQU   *                                                        49200020
         TM    DECTYPE+1,M80            IS IT A READ OPERATION          49500020
         BO    READ                     YES, GO TO READ                 49800020
WRITE    EQU   *                                                        50100020
         SPACE 3                                                        50400020
********                                                                50700020
******** TEST FOR ASA OR MACHINE CHARACTER                              51000020
********                                                                51300020
         TM    DCBRECFM,M06             TEST FOR ASA OR MACHINE CHAR    51600020
         BZ    LDPARMP                  NO, GO TO LOAD PARM FOR TPUT    51900020
         LA    RBUFAD,D1(RBUFAD)        MOVE UP PTR TO BUFFER ADDR      52200020
         BCTR  RBUFSZ,R0                DECREMENT BUFFER SIZE BY 1      52500020
         LTR   RBUFSZ,RBUFSZ            CHECK FOR NEGATIVE      SA66590 52550002
         BNM   LDPARMP                  O.K., PUT IT OUT        SA66590 52600002
         SPACE 3                                                SA66590 52650002
********                                                                52700002
******** ABEND THE USER - RECORD IS TOO SHORT TO PUT OUT        SA66590 52750002
********                                                                52760002
ABEND    EQU   *                                                SA66590 52770002
         L     1,ABENDCOD               DUMP/STEP AND COMP CODE SA66590 52780002
         ABEND (1)                      ISSUE ABEND SVC         SA66590 52792002
         SPACE 3                                                        52800020
********                                                                53100020
******** PREPARE PARAMETER AND ISSUE TPUT                               53400020
********                                                                53700020
LDPARMP  EQU   *                                                        54000020
         LR    R0,RBUFSZ                LOAD BFR SIZE                   54300020
         LR    R1,RBUFAD                LOAD BFR ADDRESS                54600020
         SPACE 3                                                        54900020
         TPUT  (1),(0)                  ISSUE TPUT                      55200020
         SPACE 3                                                        55500020
********                                                                55800020
******** UPON RETURN FROM TPUT                                          56100020
********                                                                56400020
PSUCCESS EQU   *                                                        57900020
         OI    DCBOFLGS,M80             TURN ON WRITE BIT               58200020
         SPACE 3                                                        59100020
********                                                                59400020
******** RESTORE REGISTERS AND RETURN                                   59700020
********                                                                60000020
RETURN   EQU   *                                                        60300020
         MVI   D0(RECB),M7F             SET ECB COMPLETION BIT          60400020
RESTORE  EQU   *                                                        60500020
         L     R14,D12(R13)             RESTORE REG 14                  60600020
         LM    R0,R12,D20(R13)          RESTORE REG 0 - 12              60900020
         BR    R14                      RETURN CONTROL TO USER          61200020
         SPACE 3                                                        61500020
********                                                                61800020
******** PREPARE PARAMETERS AND ISSUE TGET                              62100020
********                                                                62400020
READ     EQU   *                                                        62700020
         LR    R0,RBUFSZ                LOAD BFR SIZE                   63000020
         LR    R1,RBUFAD                LOAD BFR ADDRESS                63300020
         TGET  (1),(0)                  ISSUE TGET MACRO                63600020
         SPACE 3                                                        63900020
********                                                                64200020
******** TEST RETURN CODE FROM TGET                                     64500020
********                                                                64800020
CKATTN   EQU   *                                                        65100020
         CH    RRETURN,EIGHT            TEST FOR ATTENTION INTERRUPT    65400020
         BE    ATTNHT                   BRANCH IF NOT          @ZA25486 65700003
         NI    DCBOFLGS,M7F             TURN OFF WRITE BIT (THIS IS A   66000020
*                                       READ OPERATION)                 66300020
         SPACE 3                                                        66304020
********                                                                66308020
******** FOLD INPUT MESSAGE TO UPPER CASE                               66312020
********                                                                66316020
         LTR   R1,R1                    IS THERE ANY MSG TO FOLD        66320020
         BZ    URECORD                  NO, DO NOT FOLD                 66324020
         LR    RPTR,RBUFAD              POINTS AT START OF BFR          66328020
         LA    RWORK,D1                 SET UP LOOP INDEX               66332020
         LR    RENDMSG,RBUFAD           POINTS AT START OF BUFFER       66336020
         AR    RENDMSG,R1               POINTS AT END OF BFR PLUS 1     66340020
         BCTR  RENDMSG,R0               POINTS AT END OF BUFFER         66344020
LOOP     EQU   *                                                        66348020
         CLI   D0(RPTR),M81             COMPARE TO LOWER A      SA69503 66358002
         BL    TEST                     IF LOW, DONT FOLD       SA69503 66360002
         CLI   D0(RPTR),MA9             COMPARE TO LOWER Z      SA69503 66362002
         BH    TEST                     IF HIGH, DONT FOLD      SA69503 66364002
*****                                                                   66366002
*****        ONLY LOWERCASE ALPHA & IMBEDDED SPECIAL CHARACTERS         66366402
*****        WILL FALL THROUGH THE ABOVE TESTS                          66366802
*****                                                                   66367202
         CLI   D0(RPTR),M89             COMPARE TO LOWER I      SA69503 66367602
         BNH   FOLD                     FOLD LOWER A-I          SA69503 66367702
         CLI   D0(RPTR),MA1             COMPARE TO SPEC         SA69503 66367802
         BH    FOLD                     FOLD LOWER S-Z          SA69503 66367902
         CLI   D0(RPTR),M90             COMPARE TO SPEC         SA69503 66372702
         BNH   TEST                     DONT FOLD SPEC          SA69503 66374702
         CLI   D0(RPTR),M99             COMPARE TO LOWER R      SA69503 66376702
         BH    TEST                     DONT FOLD SPEC          SA69503 66377102
*                                       FOLD LOWER J-R          SA69503 66377502
FOLD     EQU   *                                                SA69503 66378302
         OI    D0(RPTR),UPPER           FOLD LOWERCASE          SA69503 66378702
*                                       ALPHA TO UPPER          SA69503 66379102
TEST     EQU   *                                                        66380002
         BXLE  RPTR,RWORK,LOOP          INCREMENT PTR AND TEST          66382402
         SPACE 3                                                        66387202
********                                                                66392002
******** FOR U/V TYPES OF RECORD, RETURN MESSAGE LENGTH IN              66396802
******** DCBLRECL, RETURN RESIDUAL COUNT IN DUMMY IOB                   66401602
********                                                                66406402
URECORD  EQU   *                                                        66411202
         TM    DCBRECFM,M40             TEST IF TYPE U OR V             66416020
         BO    RESIDUAL                 BRANCH IF YES                   66426020
         NI    DCBIOBA+C3,MFE           ZERO OUT RESIDUAL COUNT         66436020
         B     CKMORMSG                 DO NOT UPDATE LRECL             66446020
RESIDUAL EQU   *                                                        66456020
         SR    RBUFSZ,R1                GET RESIDUAL COUNT              66510020
         MVI   DCBIOBA,M0C              SET STATUS TO CHANNEL END,      66520020
         MVI   DCBIOBA+1,ZERO           DEVICE END IN DUMMY IOB         66530020
         STH   RBUFSZ,DCBIOBA+2         PUT RESIDUAL BYTE COUNT IN      66540020
*                                       DUMMY IOB                       66550020
         TM    DCBRECFM,M80             IS IT U OR F TYPE RECORD        66556020
         BO    RTNLNGTH                 BRANCH IF YES                   66562020
         LR    RWORK,R1                 GET MESSAGE LENGTH              66568020
         AH    RWORK,FOUR               ADD LENGTH OF RECORD            66574020
*                                       DESCRIPTOR WORD                 66580020
         STH   RWORK,DCBLRECL           RETURN PHYSICAL RECORD LENGTH   66586020
         B     CKMORMSG                 GO TO FURTHER CHECK             66589020
RTNLNGTH EQU   *                                                        66592020
         STH   R1,DCBLRECL              RETURN PHYSICAL RECORD LENGTH   66600020
         SPACE 3                                                        66900020
CKMORMSG EQU   *                                                        67200020
         CH    RRETURN,TWELVE           MORE DATA TO GET                67500020
         BNE   GSUCCESS                 BRANCH IF NO                    67800020
         SPACE 3                                                 A42898 68200021
********                                                                68700020
******** TEST FOR V-TYPE RECORD, IF SO FILL IN CONTROL WORD             69000020
********                                                                69300020
DESCRIBE EQU   *                                                 A42898 69400021
         TM    DCBRECFM,M80             CHECK FOR U-TYPE OR F-TYPE      69500020
*                                       RECORD                          69700020
         BO    RETURN                   BRANCH IF YES                   69900020
         SH    RBUFAD,FOUR              RESTORE PTR TO POINT AT  A42898 70200021
*                                       RECORD DESCRIPTOR WORD          70500021
         AH    R1,FOUR                  ADD LENGTH OF RECORD DESCRIPTOR 70800020
*                                       WORD                            71100020
         LR    RWORK,R1                 PUT LENGTH IN WORK       A42898 71120021
*                                       REGISTER                 A42898 71140021
         STC   RWORK,D1(RBUFAD)         PUT LOW ORDER BYTE IN LL A42898 71160021
*                                       FIELD                    A42898 71180021
         SRL   RWORK,M8                 GET HIGH ORDER BYTE      A42898 71200021
         STC   RWORK,D0(RBUFAD)         PUT HIGH ORDER BYTE IN   A42898 71220021
*                                       LL FIEL                  A42898 71240021
         XC    D2(L2,RBUFAD),D2(RBUFAD) ZERO OUT BB FIELD        A42898 71260021
         SH    RBUFAD,FOUR              RESTORE PTR TO POINT AT  A42898 71280021
*                                       BLOCK DESCRIPTOR WORD           71300021
         AH    R1,FOUR                  ADD LENGTH FOR BLOCK     A42898 71320021
*                                       DESCRIPTOR WORD                 71340021
         STC   R1,D1(RBUFAD)            PUT LOW ORDER BYTE IN LL FIELD  71400020
         SRL   R1,M8                    GET HIGH ORDER BYTE             71700020
         STC   R1,D0(RBUFAD)            PUT HIGH ORDER BYTE IN LL FIELD 72000020
         XC    D2(L2,RBUFAD),D2(RBUFAD) ZERO OUT BB FIELD               72300020
         B     RETURN                   GO TO RESTORE REGISTERS         72600020
         SPACE 3                                                        72900020
GSUCCESS EQU   *                                                        73200020
         CH    R1,TWO                   IS MSG LENGTH TWO               73700020
         BNE   DESCRIBE                 BRANCH IF NO                    74200020
         SPACE 3                                                        75000020
CKBUF    EQU   *                                                        75300020
         CLC   D0(L2,RBUFAD),END        IS THERE A /* IN BUFFER         75700020
         BNE   DESCRIBE                 BRANCH IF NO                    76200020
ATTNHT   MVI   D0(RECB),M41             SET ECB COMPLETE WITH I/O ERROR 76900003
         OI    DCBCIND1,EOF             SIGNAL EOF                      77400020
*                                       (EOD)                           77900020
         B     RESTORE                  GO TO RESTORE REGISTERS         78900020
         SPACE 3                                                        79100020
********                                                                80100020
******** CONSTANTS                                                      80400020
********                                                                80700020
         DS    0F                       FORCE WORD BOUNDARY             81000020
ABENDCOD DC    X'80002000'              DUMP/STEP AND COMP CODE SA66590 81050002
ZEROHALF DC    X'0000FFFF'              USED TO CLEAR HIGH ORDER 2      81300020
*                                       BYTES OF REGISTER               81600020
FOUR     DC    H'4'                     CONSTANT OF 4                   81900020
TWO      DC    H'2'                     CONSTANT OF 2                   81970020
EIGHT    DC    H'8'                     CONSTANT OF 8                   82040020
TWELVE   DC    H'12'                    CONSTANT OF 12                  82110020
SIXTEEN  DC    H'16'                    CONSTANT OF 16                  82140020
END      DC    C'/*'                    DENOTE END OF DATA SET          82200020
         SPACE 3                                                        82530020
         DS    0F                                                       82560020
DEB      DSECT                                                          82590020
         DS    CL32                     DEB BASIC SECTION               82620020
         DS    CL4                      DEB EXTENT                      82650020
         DS    CL12                     DEB BSAM/QSAM DEPENDENT SECTION 82680020
DEBBLKSI DS    CL2                      BLOCK SIZE SAVE AREA            82710020
DEBLRECL DS    CL2                      LRECL SAVE AREA                 82740020
         SPACE 3                                                        82800020
         DS    0F                                                       83100020
DECB     DSECT                                                          83400020
DECSDECB DS    CL4                                                      83700020
DECTYPE  DS    CL2                                                      84000020
DECLNGTH DS    CL2                                                      84300020
DECDCBAD DS    CL4                                                      84600020
DECAREA  DS    CL4                                                      84900020
DECIOBPT DS    CL4                                                      85200020
         SPACE 3                                                        85500020
         DCBD  DSORG=PS                                                 85800020
         END                                                            86100020
./  ADD  SSI=40610030,NAME=IGG019T6
19T6     TITLE 'IGG019T6 - TS QSAM GET/PUT ROUTINE'                     00300002
IGG019T6 CSECT                                                          00600020
*********************************************************************** 00900020
*                                                                     * 01200020
* RELEASE 21.8 CHANGES                                                * 01240002
*A828500-829000,931100-932900,942500                            SA66590 01250002
*C003000                                                        SA66590 01290002
*D287500,287700,571300-571600                                   SA69503 01300002
*A315500-317940,571300-571764                                   SA69503 01310002
* RELEASE 21 DELETIONS/CHANGES                                        * 01320020
*1395287000,725000-727000                                        S21042 01325021
*1395931200-932400                                               A42898 01330021
*                                                                 M2432 01340020
*                                                                M6374  01350020
*                                                                     * 01360020
*STATUS CHANGE LEVEL 001                                                01400021
*                                                                     * 01440020
* NAME - IGG019T6 (TS GET/PUT)                                        * 01500020
*                                                                     * 01800020
* FUNCTION/OPERATION - THIS INTERFACE ROUTINE PERFORMS THE FOLLOWING  * 02100020
*                      FUNCTIONS -                                    * 02400020
*                                                                     * 02700020
*                      FOR GET -                                      * 03000020
*                                                                     * 03300020
*                      PREPARE PARAMETERS FOR TGET AND ISSUE TGET,    * 03600020
*                      WHICH CAUSES A RECORD TO BE RETRIEVED FROM     * 03900020
*                      THE TIOC BUFFER AND PLACED IN EITHER THE FIRST * 04200020
*                      BUFFER OF THE BUFFER POOL CONTROL BLOCK (LOCATE* 04500020
*                      MODE) OR IN A USER SPECIFIED AREA (MOVE MODE). * 04800020
*                      UPON REGAIN CONTROL CONTROL FROM TGET, RETURN  * 05100020
*                      ADDRESS OF THE RECORD TO CALLER IN REGISTER 1. * 05400020
*                                                                     * 05700020
*                      FOR PUTX -                                     * 06000020
*                                                                     * 06300020
*                      PREPARE PARAMETERS FOR TPUT AND ISSUE TPUT,    * 06600020
*                      WHICH CAUSES A RECORD FROM THE FIRST BUFFER OF * 06900020
*                      THE BUFFER POOL CONTROL BLOCK (LOCATE MODE),   * 07200020
*                      OR A USER SPECIFIED AREA (MOVE MODE), TO BE    * 07500020
*                      WRITTEN ON THE TERMINAL.                       * 07800020
*                                                                     * 08100020
*                      UPON REGAIN CONTROL FROM TPUT, RETURN ADDRESS  * 08400020
*                      OF BUFFER TO CALLER IN REGISTER 1.             * 08700020
*                                                                     * 09000020
* ENTRY POINTS - GET - IGG019T6                                       * 09200020
*                PUTX - IGG019T6 + 4                                  * 09400020
*                TRUNC/RELSE - IGG019T6 +8                            * 09600020
*                                                                     * 09800020
*                THIS INTERFACE ROUTINE RECEIVES CONTROL WHEN THE     * 10000020
*                FOLLOWING CONDITIONS ARE MET.                        * 10200020
*                                                                     * 10400020
*                THE TASK IS TIME SHARING.                            * 10600020
*                THE DCB OPENED IS FOR QSAM UPDAT.                    * 10800020
*                A GET, PUTX, TRUNC OR RELSE MACRO INSTRUCTION IS     * 11000020
*                ISSED.                                               * 11200020
*                                                                     * 11400020
* INPUT - DCB ADDRESS IN REGISTER 1.                                  * 11600020
*                                                                     * 12900020
* OUTPUT - FOR GET  - AN EDITED (SPECIALLY-INDICATED CHARACTERS ARE   * 13200020
*                     DELETED) BLOCK OF TEXT MOVED IN THE BUFFER.     * 13500020
*                                                                     * 13600020
*          FOR PUTX - AN EDITED (SPECIALLY-INDICATED CHARACTERS ARE   * 13800020
*                     DELETED) BLOCK OF TEXT WRITTEN TO THE TERMINAL. * 14100020
*                                                                     * 14400020
* EXIT, NORMAL - RETURN CONTROL TO CALLER VIA A 'BR 14' INSTRUCTION.  * 14500020
*                                                                     * 14600020
*                WHEN END OF FILE IS REACHED ON GET, TAKE EOD EXIT    * 14700020
*                VIA A 'BR 15' INSTRUCTION.                           * 14800020
*                                                                     * 14900020
* EXIT, ERROR - WHEN END OF FILE IS REACHED ON GET, BUT NO EOD        * 15000020
*               ROUTINE IS FURNISHED, JOB WILL BE ABENDED WITH        * 15100020
*               SYSTEM CODE 337.                                      * 15200020
*             - WHEN VARIABLE-LENGTH RECORDS ARE TOO SHORT (4 OR      * 15250002
*               5 BYTES, DEPENDING ON THE PRESENCE OF CONTROL         * 15260002
*               CHARACTERS), JOB WILL BE ABENDED WITH SYSTEM CODE 002.* 15270002
*                                                                     * 15300020
* EXTERNAL REFERENCE - NONE.                                          * 15400002
*                                                                     * 15500020
* TABLE/WORK AREAS - NONE.                                            * 15600020
*                                                                     * 15700020
* ATTRIBUTES - REENTRANT, REUSABLE.                                   * 15800020
*                                                                     * 15900020
* CHARACTER CODE DEPENDENCY -                                         * 16000020
*                                                                     * 16100020
* NOTES -                                                             * 16200020
*                                                                     * 18000020
*********************************************************************** 18300020
         SPACE 3                                                        18600020
********                                                                18900020
******** REGISTER EQUATES                                               19200020
********                                                                19500020
R0       EQU   0                        POINTS AT IN DCB FROM PUTX      19800020
*                                       MACRO EXPANSION                 20100020
RSW      EQU   0                        SWITCH FOR FOLDING CHARS        20200020
R1       EQU   1                        POINTS DCB ADDR FROM GET/PUTX   20400020
*                                       MACRO EXPANSION                 20700020
R2       EQU   2                        REGISTER 2                      21000020
RDCB     EQU   2                        POINTS AT DCB                   21300020
RBUFAD   EQU   3                        POINTS AT BFR                   21600020
RBUFSZ   EQU   4                        CONTAINS BFR SIZE               21900020
RPUTX    EQU   5                        SIGNALS FOR PUTX                22200020
RDEB     EQU   6                        POINTS AT DEB                   22300020
RPTR     EQU   9                        POINTS AT BFR FOR FOLDING MSG   22360020
RWORK    EQU   10                       WORK REGISTER                   22420020
RENDMSG  EQU   11                       POINTS AT END OF MESSAGE        22480020
RBASE    EQU   12                       BASE REGISTER                   22500020
R12      EQU   12                       REGISTER 12                     22800020
R13      EQU   13                       POINTS AT CALLING RTN SAVE AREA 23100020
R14      EQU   14                       POINTS AT RETURN ADDR OF        23400020
*                                       CALLING RTN                     23700020
R15      EQU   15                       POINTS AT BRANCH ADDR           24000020
RRETURN  EQU   15                       CONTAINS RETURN CODE            24300020
         SPACE 3                                                        24600020
********                                                                24900020
******** EQUATES FOR DISPLACEMENTS, LENGTH, AND MASKS                   25200020
********                                                                25500020
C3       EQU   3                        CONSTANT OF 3                   25800020
C15      EQU   15                       CONSTANT OF 15                  25900020
M01      EQU   X'01'                    MASK USED TO TEST EOD RTN ADDR  26100020
*                                       MASK FOR OUTPUT MODE IN         26400020
*                                       DEBOPATB                        26700020
*                                       MASK FOR DATA MODE IN DECMACR   27000020
MC0      EQU   X'C0'                    U-TYPE RECORD                   27300020
M40      EQU   X'40'                    V-TYPE RECORD                   27600020
M06      EQU   X'06'                    ASA OR MACHINE CHAR USED        27900020
M7F      EQU   X'7F'                    MASK FOR TURNING OFF WRITE BIT  28200020
M80      EQU   X'80'                    WRITE BIT IN DCBOFLGS           28500020
M12      EQU   X'12'                    MASK FOR SHIFTING REGISTER      28600020
EABD174  EQU   174                                               S21042 28670021
M8       EQU   8                        USED TO SHIFT REGISTER          28800020
D0       EQU   0                        DISPLACEMENT                    29100020
D1       EQU   1                        DISPLACEMENT                    29400020
D2       EQU   2                        DISPLACEMENT                    29700020
D4       EQU   4                        DISPLACEMENT                    30000020
D5       EQU   5                        DISPLACEMENT                    30300020
D12      EQU   12                       DISPLACEMENT                    30600020
D20      EQU   20                       DISPLACEMENT                    30900020
D28      EQU   28                       DISPLACEMENT                    31200020
L2       EQU   2                        LENGTH OF 2                     31500020
*****                                                                   31550002
*****       MASKS FOR ISOLATING LOWERCASE ALPHA CHARACTERS              31600002
*****       FOR FOLDING TO UPPERCASE                                    31650002
*****                                                                   31700002
M81      EQU   X'81'                    LOWERCASE A             SA69503 31750002
MA9      EQU   X'A9'                    LOWERCASE Z             SA69503 31760002
M89      EQU   X'89'                    LOWERCASE I             SA69503 31770002
M90      EQU   X'90'                    SPECIAL CHARACTER       SA69503 31780002
M99      EQU   X'99'                    LOWERCASE R             SA69503 31790002
MA1      EQU   X'A1'                    SPECIAL CHARACTER       SA69503 31792002
UPPER    EQU   X'40'                    USED TO FOLD MSG        SA69503 31794002
         SPACE 3                                                        31800020
********                                                                36600020
******** GET ENTRY                                                      36900020
********                                                                37200020
         USING IGG019T6,R15             USE ENTRY ADDR AS BASE ADDR     37500020
         USING IHADCB,RDCB              ESTABLISH ADDRESSABILITY FOR    37800020
*                                       DCB                             38100020
         USING DEB,RDEB                 ESTABLISH ADDRESSABILITY        38200020
         B     STGET                    BR PAST PUTX ENTRY              38400020
********                                                                38700020
******** PUTX ENTRY                                                     39000020
********                                                                39300020
         B     STPUTX                   UNCONDITIONAL BRANCH            39600020
         SPACE 3                                                        39900020
********                                                                40200020
******** TRUNC/RELSE ENTRY                                              40500020
********                                                                40800020
         BR  R14                        NOP RETURN CONTROL TO CALLER    41100020
STGET    EQU   *                                                        41400020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  41700020
         SR    RPUTX,RPUTX              CLEAR REG FOR GET ENTRY         42000020
         B     STUPBASE                 GO TO SET UP BASE               42300020
STPUTX   EQU   *                                                        42600020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  42900020
         LA    RPUTX,D1                 PUT '1' IN REG TO SIGNAL PUTX   43200020
STUPBASE EQU   *                                                        43500020
         LR    RBASE,R15                LOAD BASE REGISTER              43800020
         DROP  R15                      GET RID OF PREVIOUS BASE REG    44100020
         USING IGG019T6,RBASE           USE REG 12 AS BASE REG          44400020
         SPACE 3                                                        44700020
********                                                                45000020
******** GET BUFFER ADDRESS                                             45300020
********                                                                45600020
         LR    RDCB,R1                  SAVE DCB ADDR                   45900020
         L     RBUFAD,DCBBUFCB          LOAD ADDR OF BFR CONTROL BLK    46200020
         L     RBUFAD,D0(RBUFAD)        LOAD ADDR OF BFR                46500020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 46600020
         SPACE 3                                                        46800020
         SPACE 3                                                        47100020
********                                                                47400020
******** TEST FOR GET OR PUT AND TAKE DIFFERENT ROUTES                  47700020
********                                                                48000020
         LTR   RPUTX,RPUTX              IS THIS A GET OPERATION         48300020
         BNZ   PUTOP                    BRANCH IF PUT OPERATION         48600020
         SPACE 3                                                        48900020
********                                                                49200020
******** TEST FOR RECORD TYPE AND GET BFR SIZE FOR GET OPERATION        49500020
********                                                                49800020
GETOP    EQU   *                                                        50100020
         LH    RBUFSZ,DEBLRECL          GET BFR SIZE FROM DEBLRECL      50400020
         TM    DCBRECFM,M80             CHECK FOR U-TYPE OR F-TYPE      50600020
*                                       RECORD                          50800020
         BO    GETREADY                 BRANCH IF YES                   51000020
VRECORD  EQU   *                                                        51300020
         TM    DCBMACRF,M01             TEST FOR DATA MODE              51600020
         BO    GETREADY                 BRANCH IF YES                   51900020
         SH    RBUFSZ,FOUR              SUBTRACT 4 FOR CONTROL WORD     52200020
         LA    RBUFAD,D4(RBUFAD)        UPDATE BFR PTR TO PASS CONTROL  52500020
*                                       WORD                            52800020
GETREADY EQU   *                                                        53100020
         LR    R1,RBUFAD                LOAD BFR ADDR                   53400020
         LR    R0,RBUFSZ                LOAD BFR SIZE                   53700020
         TGET  (1),(0)                  ISSUE TGET (UPON RETURN R1 HAS  54000020
*                                       MSG LENGTH)                     54300020
         SPACE 3                                                        54600020
********                                                                54900020
******** TEST RETURN CODE FROM TGET                                     55200020
********                                                                55500020
CKATTN   EQU   *                                                        55800020
         CH    RRETURN,EIGHT            CHECK FOR ATTENTION INTERRUPT   56100020
         BE    GETREADY                 YES, GO TO REISSUE TGET         56400020
         NI    DCBOFLGS,M7F             TURN OFF WRITE BIT              56700020
*                                       (THIS IS A READ OPERATION)      57000020
         SPACE 3                                                        57010020
********                                                                57020020
******** FOLD INPUT LOWERCASE ALPHA TO UPPERCASE                        57030002
********                                                                57040020
         LTR   R1,R1                    IS THERE ANY MSG TO FOLD        57050020
         BZ    CKMORMSG                 NO, DO NOT FOLD                 57060020
         LR    RPTR,RBUFAD              POINTS AT START OF BFR          57070020
         LA    RWORK,D1                 SET UP LOOP INDEX               57080020
         LR    RENDMSG,RBUFAD           POINTS AT START OF BUFFER       57090020
         AR    RENDMSG,R1               POINTS AT END OF BFR PLUS 1     57100020
         BCTR  RENDMSG,R0               POINTS AT END OF BUFFER         57110020
LOOP     EQU   *                                                        57120020
         CLI   D0(RPTR),M81             COMPARE TO LOWER A      SA69503 57130002
         BL    TEST                     IF LOW, DONT FOLD       SA69503 57140002
         CLI   D0(RPTR),MA9             COMPARE TO LOWER Z      SA69503 57150002
         BH    TEST                     IF HIGH, DONT FOLD      SA69503 57160002
*****                                                                   57162002
*****       ONLY LOWERCASE ALPHA & IMBEDDED SPECIAL CHARACTERS          57164002
*****       WILL FALL THROUGH THE ABOVE TESTS                           57166002
*****                                                                   57168002
         CLI   D0(RPTR),M89             COMPARE TO LOWER I      SA69503 57168402
         BNH   FOLD                     FOLD LOWER A-I          SA69503 57168802
         CLI   D0(RPTR),MA1             COMPARE TO SPEC         SA69503 57169202
         BH    FOLD                     FOLD LOWER S-Z          SA69503 57169602
         CLI   D0(RPTR),M90             COMPARE TO SPEC         SA69503 57169702
         BNH   TEST                     DONT FOLD SPEC          SA69503 57169802
         CLI   D0(RPTR),M99             COMPARE TO LOWER R      SA69503 57169902
         BH    TEST                     DONT FOLD SPEC          SA69503 57173202
*                                       FOLD LOWER J-R          SA69503 57175202
FOLD     EQU   *                                                SA69503 57175602
         OI    D0(RPTR),UPPER           FOLD LOWERCASE          SA69503 57176002
*                                       ALPHA TO UPPER          SA69503 57176402
TEST     EQU   *                                                        57176702
         BXLE  RPTR,RWORK,LOOP          INCREMENT PTR AND TEST          57180020
         SPACE 3                                                        57190020
         SPACE 3                                                        57300020
CKMORMSG EQU   *                                                        57600020
         CH    RRETURN,TWELVE           IS BFR TOO SMALL FOR MSG        57900020
         BNE   SUCCESSG                 BRANCH IF NOT                   58200020
         SPACE 3                                                 A42898 58500021
********                                                                58800020
******** CHECK FOR V-TYPE RECORD, IF IT IS, FILL IN CONTROL WORD        59100020
********                                                                59400020
DESCRIBE EQU   *                                                        59700020
         TM    DCBRECFM,M40             TEST FOR V-TYPE AND U-TYPE      59800020
*                                       RECORD                          59900020
         BNO   RETURN                   BRANCH IF NO                    60000020
         STH   R1,DCBLRECL              UPDATE DCBLRECL                 60200020
         TM    DCBRECFM,MC0             TEST FOR U-TYPE RECORD          60460020
         BO    RETURN                   BRANCH IF YES                   60520020
         TM    DCBMACRF,M01             TEST FOR DATA MODE              60600020
         BO    RETURN                   BRANCH IF YES                   60900020
         SH    RBUFAD,FOUR              DECREMENT BFR ADDR PTR TO       61200020
*                                       POINT AT CONTROL WORD           61500020
         AH    R1,FOUR                  ADD LENGTH OF RECORD DESCRIPTOR 61800020
*                                       WORD                            62100020
         STC   R1,D1(RBUFAD)            FILL IN LL FIELD OF CONTROL     62700020
*                                       WORD                            63000020
         SRL   R1,M8                    GET THE OTHER L                 63300020
         STC   R1,D0(RBUFAD)            FILL IN LL FIELD OF CONTROL     63600020
*                                       WORD                            63900020
         XC    D2(L2,RBUFAD),D2(RBUFAD) ZERO OUT BB IN CONTROL WORD     64200020
         MVC   DCBLRECL,D0(RBUFAD)      UPDATE LRECL                    64500020
         SPACE 3                                                        64800020
********                                                                65100020
******** PUT BUFFER ADDRESS IN REGISTER 1, RESTORE REGISTERS AND        65400020
******** RETURN TO CALLER                                               65700020
********                                                                66000020
RETURN   EQU   *                                                        66300020
         LR    R1,RBUFAD                LOAD RECORD ADDRESS             66600020
         L     R14,D12(R13)             RESTORE REG 14                  66900020
         L     R0,D20(R13)              RESTORE REG 0                   67200020
         LM    R2,R12,D28(R13)          RESTORE REGS 2-12               67500020
         BR    R14                      RETURN TO CALLER                67800020
         SPACE 3                                                        68100020
SUCCESSG EQU   *                                                        68400020
         CH    R1,TWO                   IS MSG LENGTH 2                 69000020
         BNE   DESCRIBE                 BRANCH IF NOT                   69600020
         SPACE 3                                                        70500020
CKBUF    EQU   *                                                        70800020
         CLC   D0(L2,RBUFAD),END        IS THERE A /*                   71100020
         BNE   DESCRIBE                 BRANCH IF NOT                   71400020
CKEOD    EQU   *                                                        71700020
         TM    DCBEODAD+C3,M01          IS EOD RTN ADDR FURNISHED       72000020
         BZ    GOTHERE                  YES, GO TO GOTHERE              72300020
ABEND    EQU   *                                                        72400020
         DMABCOND EABD174,DCB=(RDCB),SVC=YES CALL PD FOR 337     S21042 72600021
*                                       ABEND                    S21042 72800021
GOTHERE  EQU   *                                                        73200020
         L     R15,DCBEODAD             LOAD ADDR OF EOD RTN            73500020
         L     R14,D12(R13)             RESTORE REG 14                  73800020
         LM    R0,R12,D20(R13)          RESTORE REGS 0-12               74100020
         BR    R15                      BRANCH TO CALLER EOD ADDR       74400020
         SPACE 3                                                        74700020
********                                                                75000020
******** FOR PUT OPERATION                                              75300020
********                                                                75600020
PUTOP    EQU   *                                                        75900020
         TM    DCBRECFM,M80             CHECK FOR U-TYPE OR F-TYPE      76100020
*                                       RECORD                          76300020
         BO    SZINDCB                  BRANCH IF YES                   76500020
         TM    DCBMACRF,M01             IS IT DATA MODE                 76800020
         BO    SZINDCB                  BRANCH IF YES                   77100020
         SR    RBUFSZ,RBUFSZ            CLEAR REG                       77400020
         IC    RBUFSZ,D0(RBUFAD)        GET ONE L FROM CONTROL WORD     77700020
         SLL   RBUFSZ,M8                MAKE ROOM FOR OTHER L           78000020
         IC    RBUFSZ,D1(RBUFAD)        GET SECOND L FROM CONTROL WORD  78300020
         AH    RBUFAD,FOUR              ADD 4 TO BFR ADDR               78600020
         SH    RBUFSZ,FOUR              DECREMENT 4 FROM BFR SIZE       78900020
         B     CKCHAR                   GO TO CHECK MACHINE CHAR        79200020
SZINDCB  EQU   *                                                        79500020
         LH    RBUFSZ,DCBLRECL          GET BUFFER SIZE                 79800020
CKCHAR   EQU   *                                                        80100020
         TM    DCBRECFM,M06             TEST FOR ASA OR MACHINE CHAR    80400020
         BZ    PUTREADY                 NO, GO TO ISSUE TPUT            80700020
         LA    RBUFAD,D1(RBUFAD)        UPDAT BFR PTR BY 1              81000020
         BCTR  RBUFSZ,R0                DECREMENT BFR SIZE BY 1         81300020
         SPACE 3                                                        81600020
********                                                                81900020
******** PREPARE PARAMETERS AND ISSUE TPUT                              82200020
********                                                                82500020
PUTREADY EQU   *                                                        82800020
         LTR   RBUFSZ,RBUFSZ            CHECK BFR  SIZE         SA66590 82850002
         BM    ABEND002                 NEGATIVE, TERMINATE JOB SA66590 82900002
         LR    R0,RBUFSZ                LOAD BFR SIZE                   83100020
         LR    R1,RBUFAD                LOAD BFR ADDRESS                84100020
         TPUT  (1),(0)                  ISSUE TPUT MACRO                85100020
********                                                                86700020
******** UPON RETURN FROM TPUT                                          87100020
********                                                                87300020
SUCCESSP EQU   *                                                        87600020
         OI    DCBOFLGS,M80             TURN ON WRITE BIT               87900020
         SPACE 3                                                        88500020
*********                                                               88800020
*********TEST FOR V-TYPE RECORD AND ASA OR MACHINE CHARACTER, AND       89100020
*********RESTORE BUFFER POINTER ACCORDINGLY                             89400020
*********                                                               89700020
CHECK    EQU   *                                                        90000020
         TM    DCBRECFM,M06             TEST FOR ASA OR MACHINE CHAR    90300020
         BZ    CKVREC                   NO, GO TO CHECK V-TYPE RECORD   90600020
         BCTR  RBUFAD,R0                SET BACK BFR ADDRESS BY 1       90900020
CKVREC   EQU   *                                                        91200020
         TM    DCBRECFM,M80             CHECK FOR U-TYPE OR F-TYPE      91400020
*                                       RECORD                          91600020
         BNZ   RETURN                   BRANCH IF YES                   91800020
         TM    DCBMACRF,M01             DATA MODE?                      92100020
         BO    RETURN                   BRANCH IF YES                   92400020
         SH    RBUFAD,FOUR              SET BACK BFR ADDR BY 4          92700020
         B     RETURN                   GO TO RESTORE REGISTERS         93000020
         SPACE 3                                                        93060020
********                                                                93110002
******** USER RECORD WAS TOO SHORT (WOULD HAVE BEEN NEGATIVE TPUT) -    93160002
******** ISSUE 002 ABEND.                                               93210002
********                                                                93260002
ABEND002 EQU   *                                                        93270002
         L     R1,ABCODE                LOAD ABEND CODE         SA66590 93280002
         ABEND (1)                      ISSUE ABEND SVC         SA66590 93290002
         SPACE 3                                                        93300020
********                                                                93600020
******** CONSTANTS                                                      93900020
********                                                                94200020
ABCODE   DS    0F                       ALIGN                   SA66590 94250002
         DC    X'80002000'              DUMP/STEP, AND COMP COD SA66590 94300002
FOUR     DC    H'4'                     CONSTANTS OF 4                  94500020
TWO      DC    H'2'                     CONSTANT OF 2                   94570020
EIGHT    DC    H'8'                     CONSTANT OF 8                   94640020
TWELVE   DC    H'12'                    CONSTANT OF 12                  94710020
SIXTEEN  DC    H'16'                    CONSTANT OF |6                  94740020
END      DC    C'/*'                    DEFINES EOD                     94800020
         SPACE 3                                                        95130020
         DS    0F                                                       95160020
DEB      DSECT                                                          95190020
         DS    CL32                     DEB BASIC SECTION               95220020
         DS    CL4                      DEB EXTENT                      95250020
         DS    CL12                     DEB BSAM/QSAM DEPENDENT SECTION 95280020
DEBBLKSI DS    CL2                      BLOCK SIZE SAVE AREA            95310020
DEBLRECL DS    CL2                      LRECL SAVE AREA                 95340020
         SPACE 3                                                        95400020
         DCBD  DSORG=PS                                                 95700020
         END                                                            96000020
./  ADD  SSI=40610051,NAME=IGG019T7
         TITLE 'IGG019T7 - TS READ'                                     00400020
IGG019T7 CSECT                                                          00800020
*********************************************************************** 01200020
*                                                                     * 01600020
* RELEASE 21 DELETIONS/CHANGES                                        * 01750020
*1395504000-508000,596000,620000-624000,755000-763000            A42898 01770021
*                                                                     * 01800020
*                                                                M3038  01810020
*                                                                M5422  01815020
*0000                                                            TS1616 01820020
*                                                                M2307  01830020
* RELEASE 21.8 MODIFICATIONS                                            01840002
*                                                                       01842002
*D315000,315500,573040-573280                                   SA69503 01842402
*A344500-347900,573060-573580                                   SA69503 01842802
*                                                                       01844002
*STATUS CHANGE LEVEL 001                                                01850021
*                                                                M1565  01870020
*                                                                M6374  01880020
*                                                                       01900020
* NAME - IGG019T7 - TS READ.                                          * 02000020
*                                                                     * 02400020
* FUNCTION/OPERATION - THIS MODULE PERFORMS THE FOLLOWING FUNCTIONS-  * 02800020
*                                                                     * 03200020
*                      FURNISH TGET USER BUFFER ADDRESS.              * 03600020
*                      FURNISH TGET USER BUFFER SIZE                  * 04000020
*                      ISSUE TGET, UPON REGAIN CONTROL FROM TGET, SET * 04400020
*                      ECB COMPLETION CODE TO X'7F'. WHEN END OF      * 04600020
*                      FILE , SET ECB COMPLETION CODE TO X'41'        * 04800020
*                                                                     * 05000020
* ENTRY POINT - IGG019T7, BEGINNING OF MODULE. CONTROL IS RECEIVED    * 05100020
*               WHEN THE FOLLOWING CONDITIONS ARE MET.                * 05200020
*                                                                     * 05300020
*               THE TASK IS TIME SHARING                              * 05400020
*               THE DCB OPENED IS FOR BSAM, OUTPUT                    * 05500020
*               A READ MACRO INSTRUCTION IS ISSUED                    * 05600020
*                                                                     * 05700020
*               UPON ENTRY TO THIS MODULE, REGISTER 1 CONTAINS USER   * 05800020
*               DECB ADDRESS.                                         * 05900020
*                                                                     * 06800020
* INPUT - DECB NAME, TYPE FIELD IS IGNORED, DCB ADDRESS, BUFFER       * 07200020
*         ADDRESS, 'S' OR LENGTH OF DATA.                             * 07600020
*                                                                     * 08000020
* OUTPUT - AN EDITED (SPECIALLY INDICATED CHARACTERS ARE DELETED FROM * 08400020
*          THE DATA READ) BLOCK OF TEXT IN THE USER DESIGNATED AREA.  * 08800020
*                                                                     * 09200020
* EXIT - NORMAL - RETURN CONTROL TO CALLER VIA 'BR 14' INSTRUCTION.   * 09600020
*                 WHEN EOD CONDITION IS DETECTED, BRANCH TO USER EOD  * 10000020
*                 ROUTINE VIA 'BR I5' INSTRUCTION.                    * 10400020
*                                                                     * 10800020
*        ERROR - NONE.                                                * 11600020
*                                                                     * 12400020
* EXTERNAL REFERENCE - IGC0009C.                                      * 12700020
*                                                                     * 13000020
* TABLE /WORK AREA - NONE.                                            * 13300020
*                                                                     * 13600020
* ATTRIBUTES - REENTRANT, REUSABLE.                                   * 13900020
*                                                                     * 14200020
* CHARACTER CODE DEPENDENCY -                                         * 14500020
*                                                                     * 14800020
* NOTES -                                                             * 15100020
*                                                                     * 16000020
*********************************************************************** 16400020
         SPACE 3                                                        16800020
********                                                                17200020
******** REGISTER EQUATES                                               17600020
********                                                                18000020
R0       EQU   0                        CONTAINS BFR SIZE FOR TGET      18400020
RSW      EQU   0                        SWITCH FOR FOLDING CHARS        18600020
R1       EQU   1                        CONTAINS BFR ADDR FOR TGET      18800020
*                                       ALSO CONTAINS MSG LENGTH AFTER  19200020
*                                       A TGET MACRO INSTRUCTION        19600020
*                                       ALSO CONTAINS DECB ADDR WHEN    20000020
*                                       THIS MODULE GETS CONTROL        20400020
RDCB     EQU   2                        POINTS AT DCB                   20800020
RDECB    EQU   3                        POINTS AT DECB                  21200020
RPOINT   EQU   4                        POINTER TO CHAR WHEN FOLDING    21600020
RBUFAD   EQU   5                        CONTAINS BFR ADDRESS            22000020
RBUFSZ   EQU   6                        CONTAINS BFR SIZE               22400020
RECB     EQU   7                        POINTS AT ECB                   22800020
RDEB     EQU   8                        POINTS AT DEB                   22900020
RPTR     EQU   9                        POINTS AT BFR FOR FOLDING MSG   23000020
RWORK    EQU   10                       WORK REGISTER                   23100020
RENDMSG  EQU   11                       POINTS AT END OF MSG            23200020
RBASE    EQU   12                       BASE REGISTER                   23600020
R12      EQU   12                                                       24000020
R13      EQU   13                       CONTAINS USER PGM SAVE AREA     24400020
R14      EQU   14                       CONTAINS RETURN ADDR            24800020
R15      EQU   15                       CONTAINS ADDR TO BRACH TO       25200020
RRETURN  EQU   15                       CONTAINS RETURN CODE            25600020
         SPACE 3                                                        26000020
********                                                                26400020
******** EQUATES FOR DISPLACEMENT, LENGTH AND MASK                      26800020
********                                                                27200020
C3       EQU   3                        CONSTANT OF 3                   27600020
C15      EQU   15                       CONSTANT OF 15                  27700020
ZERO     EQU   X'00'                    CONSTANT 0                      27800020
MFE      EQU   X'FE'                    MASK TO ZERO OUT RESIDUAL CT    27900020
M0C      EQU   X'0C'                    DENOTES CHANNEL END DEVICE END  28000020
M3F      EQU   X'3F'                    MASK TO TURN OFF WT BIT AND     28400020
*                                       TURN OFF READ BACKWARD BIT IN   28800020
*                                       DCB                             29200020
M7F      EQU   X'7F'                    COMPLETION BIT IN ECB           29600020
M41      EQU   X'41'                    DENOTES ECB COMPLETED WITH I/O  29700020
*                                       ERROR (EOD)                     29800020
M80      EQU   X'80'                    DENOTES 'S' SPECIFIED IN DECB   30000020
*                                       MASK FOR F-TYPE RECORD          30400020
MC0      EQU   X'C0'                    DENOTES UNDEFINED RCD LENGTH    30800020
M40      EQU   X'40'                    DENOTES VARIABLE RCD LENGTH     31200020
EOF      EQU   X'20'                    EOF HAS BEEN ENCOUNTERED        31400020
M8       EQU   8                        USED IN SHIFTING                31600020
D0       EQU   0                        DISPLACEMENT OF 0               32000020
D1       EQU   1                        DISPLACEMENT OF 1               32400020
D2       EQU   2                        DISPLACEMENT OF 2               32800020
D4       EQU   4                        DISPLACEMENT OF 4               33200020
D8       EQU   8                        DISPLACEMENT OF 8        A42898 33400021
D12      EQU   12                       DISPLACEMENT OF 12              33600020
D20      EQU   20                       DISPLACEMENT OF 20              34000020
L2       EQU   2                        LENGTH OF 2                     34400020
*****                                                                   34450002
*****       MASKS FOR ISOLATING LOWER CASE ALPHA CHARACTERS             34500002
*****       FOR FOLDING TO UPPERCASE                                    34550002
*****                                                                   34600002
M81      EQU   X'81'                    LOWERCASE A             SA69503 34650002
MA9      EQU   X'A9'                    LOWERCASE Z             SA69503 34700002
M89      EQU   X'89'                    LOWERCASE I             SA69503 34750002
M90      EQU   X'90'                    SPECIAL CHARACTER       SA69503 34760002
M99      EQU   X'99'                    LOWERCASE R             SA69503 34770002
MA1      EQU   X'A1'                    SPECIAL CHARACTER       SA69503 34780002
UPPER    EQU   X'40'                    USED TO FOLD MSG        SA69503 34790002
         SPACE 3                                                        34800020
         SPACE 3                                                        37600020
********                                                                38000020
******** SAVE REGISERS AND ESTABLISH ADDRESSABILITY                     38400020
********                                                                38800020
         STM   R14,R12,D12(R13)         SAVE REGS                       39200020
         LR    RBASE,R15                ENTRY ADDR AS BASE ADDR         39600020
         USING IGG019T7,RBASE           ESTABLISH ADDRESSABILITY        40000020
         USING IHADCB,RDCB              ESTABLISH ADDRESSABILITY        40400020
         USING DECB,RDECB               ESTABLISH ADDRESSABILITY        40800020
         USING DEB,RDEB                 ESTABLISH ADDRESSABILITY        41000020
         SPACE 3                                                        41200020
********                                                                41600020
******** GET BUFFER ADDRESS AND BUFFER SIZE                             42000020
********                                                                42400020
         LR    RDECB,R1                 SAVE DECB ADDR                  42800020
         L     RDCB,DECDCBAD            GET DCB ADDR                    43200020
         LA    RECB,DECSDECB            GET ADDR OF ECB                 43600020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 43700020
         TM    DCBCIND1,EOF             IS EOF REACHED                  43730020
         BO    RETURN                   BRANCH IF YES                   43760020
         MVI   D0(RECB),M80             TURN ON ECB WAIT BIT            43800020
         LA    RWORK,DCBIOBL            PUT DUMMY IOB ADDR IN REG       43860020
         ST    RWORK,DECIOBPT           PUT DUMMY IOB ADDR IN DECB      43920020
         L     RBUFAD,DECAREA           GET BUFFER ADDR                 44000020
         TM    DCBRECFM,MC0             TEST FOR U-TYPE RECORD          44400020
         BNO   NOTU                     NO, GO TO NOTU                  44800020
         TM    DECTYPE,M80              TEST FOR 'S' SPECIFIED IN DECB  45200020
         BZ    DECBLNG                  NO, GO TO GET LNG FROM DECB     45600020
         LH    RBUFSZ,DCBBLKSI          GET BUFFER SIZE FROM DCB        46000020
         B     FIXED                    GO TO FIXED                     46400020
DECBLNG  EQU   *                                                        46800020
         LH    RBUFSZ,DECLNGTH          LOAD BUFFER SIZE                47200020
         N     RBUFSZ,ZEROHALF          ZERO OUT HIGH ORDER 2 BYTES     47600020
         B     FIXED                    GO TO ISSUE TGET                48000020
NOTU     EQU   *                                                        48400020
         LH    RBUFSZ,DCBBLKSI          GET BUFFER SIZE FROM DCB        48800020
         TM    DCBRECFM,M40             TEST FOR V-TYPE RECORD          49200020
         BZ    FIXED                    NO, IT IS F-TYPE, GO TO FIXED   49600020
VTYPE    EQU   *                                                        50000020
         LA    RBUFAD,D8(RBUFAD)        UPDATE PTR TO PASS       A42898 50200021
*                                       CONTROL WDS              A42898 50400021
         SH    RBUFSZ,EIGHT             SUBTRACT LNG FOR CONTROL A42898 50600021
*                                       WDS                      A42898 50800021
********                                                                51200020
******** PREPARE PARAMETERS AND ISSUE TGET                              51600020
********                                                                52000020
FIXED    EQU   *                                                        52400020
         LR    R0,RBUFSZ                LOAD BFR SIZE                   52800020
         LR    R1,RBUFAD                LOAD BFR ADDRESS                53200020
         TGET  (1),(0)                  ISSUE TGET                      53600020
         SPACE 3                                                        54000020
******** TEST RETURN CODE FROM TGET                                     54400020
********                                                                54800020
CKATTN   EQU   *                                                        55200020
         CH    RRETURN,EIGHT            TEST FOR ATTENTION INTERRUPT    55600020
         BE    FIXED                    YES, REISSUE TGET               56000020
         NI    DCBOFLGS,M3F             TURN OFF WRITE BIT (THIS IS A   56400020
*                                       READ OPERATION), AND TURN OFF   56800020
*                                       READ BACKWARD BIT               57200020
         SPACE 3                                                        57208020
********                                                                57216020
******** FOLD INPUT LOWERCASE ALPHA TO UPPERCASE                        57224002
********                                                                57232020
         LTR   R1,R1                    IS THERE ANY MSG TO FOLD        57240020
         BZ    URECORD                  NO, DO NOT FOLD                 57248020
         LR    RPTR,RBUFAD              POINTS AT START OF BFR          57256020
         LA    RWORK,D1                 SET UP LOOP INDEX               57264020
         LR    RENDMSG,RBUFAD           POINTS AT START OF BUFFER       57272020
         AR    RENDMSG,R1               POINTS AT END OF BFR PLUS 1     57280020
         BCTR  RENDMSG,R0               POINTS AT END OF BUFFER         57288020
LOOP     EQU   *                                                        57296020
         CLI   D0(RPTR),M81             COMPARE TO LOWER A      SA69503 57306002
         BL    TEST                     IF LOW, DONT FOLD       SA69503 57316002
         CLI   D0(RPTR),MA9             COMPARE TO LOWER Z      SA69503 57326002
         BH    TEST                     IF HIGH, DONT FOLD      SA69503 57328002
*****                                                                   57330002
*****       ONLY LOWERCASE ALPHA & IMBEDDED SPECIAL CHARACTERS          57332002
*****       WILL FALL THROUGH THE ABOVE TESTS                           57334002
*****                                                                   57334402
         CLI   D0(RPTR),M89             COMPARE TO LOWER I      SA69503 57334802
         BNH   FOLD                     FOLD LOWER A-I          SA69503 57335202
         CLI   D0(RPTR),MA1             COMPARE TO SPEC         SA69503 57335602
         BH    FOLD                     FOLD LOWER S-Z          SA69503 57335702
         CLI   D0(RPTR),M90             COMPARE TO SPEC         SA69503 57335802
         BNH   TEST                     DONT FOLD SPEC          SA69503 57335902
         CLI   D0(RPTR),M99             COMPARE TO LOWER R      SA69503 57346502
         BH    TEST                     DONT FOLD SPEC          SA69503 57356502
*                                       FOLD LOWER J-R          SA69503 57356902
FOLD     EQU   *                                                SA69503 57357002
         OI    D0(RPTR),UPPER           FOLD LOWERCASE          SA69503 57357102
*                                       ALPHA TO UPPER          SA69503 57358002
TEST     EQU   *                                                        57360002
         BXLE  RPTR,RWORK,LOOP          INCREMENT PTR AND TEST          57367802
         SPACE 3                                                        57378402
********                                                                57389002
******** FOR U/V TYPES OF RECORD, RETURN MESSAGE LENGTH IN              57399602
******** DCBLRECL, RETURN RESIDUAL COUNT IN DUMMY IOB                   57410202
********                                                                57420802
URECORD  EQU   *                                                        57431402
         TM    DCBRECFM,M40             TEST IF TYPE U OR V             57442020
         BO    RESIDUAL                 BRANCH IF YES                   57472020
         NI    DCBIOBA+C3,MFE           ZERO OUT RESIDUAL COUNT         57502020
         B     CKMORMSG                 DO NOT UPDATE LRECL             57532020
RESIDUAL EQU   *                                                        57562020
         SR    RBUFSZ,R1                GET RESIDUAL COUNT              57630020
         MVI   DCBIOBA,M0C              SET STATUS TO CHANNEL END,      57660020
         MVI   DCBIOBA+1,ZERO           DEVICE END IN DUMMY IOB         57690020
         STH   RBUFSZ,DCBIOBA+2         PUT RESIDUAL BYTE COUNT IN      57720020
*                                       DUMMY IOB                       57750020
         TM    DCBRECFM,M80             IS IT U OR F TYPE RECORD        57760020
         BO    RTNLNGTH                 BRANCH IF YES                   57765020
         LR    RWORK,R1                 GET MESSAGE LENGTH              57770020
         AH    RWORK,FOUR               ADD LENGTH OF RECORD            57775020
*                                       DESCRIPTOR WORD                 57780020
         STH   RWORK,DCBLRECL           RETURN PHYSICAL RECORD LENGTH   57785020
         B     CKMORMSG                 GO TO FURTHER CHECK             57787020
RTNLNGTH EQU   *                                                        57790020
         STH   R1,DCBLRECL              RETURN PHYSICAL RECORD LENGTH   57800020
CKMORMSG EQU   *                                                        58000020
         CH    RRETURN,TWELVE           ARE THERE MORE DATA TO GET      58400020
         BNE   SUCCESS                  NO, GO TO SUCCESS               58800020
         SPACE 3                                                 A42898 59400021
********                                                                60000020
******** TEST FOR V-TYPE RECORD, IF SO FILL IN CONTROL WORD             60400020
********                                                                60800020
DESCRIBE EQU   *                                                 A42898 61000021
         TM    DCBRECFM,M80             TEST FOR FIXED RECORD           61200020
         BO    RETURN                   BRANCH IF YES                   61600020
         SH    RBUFAD,FOUR              RESTORE PTR TO POINT AT  A42898 62000021
*                                       RECORD DESCRIPTOR WORD          62400021
         AH    R1,FOUR                  ADD LENGTH FOR RCD DESCRIPTOR   62800020
*                                       WORD                            63200020
         LR    RWORK,R1                 PUT LENGTH IN WORK       A42898 63230021
*                                       REGISTER                 A42898 63260021
         STC   RWORK,D1(RBUFAD)         PUT LOW ORDER BYTE IN LL A42898 63290021
*                                       FIELD                    A42898 63320021
         SRL   RWORK,M8                 GET HIGH ORDER BYTE      A42898 63350021
         STC   RWORK,D0(RBUFAD)         PUT LOW ORDER BYTE IN LL A42898 63380021
*                                       FIELD                    A42898 63410021
         XC    D2(L2,RBUFAD),D2(RBUFAD) ZERO OUT BB FIELD        A42898 63440021
         SH    RBUFAD,FOUR              RESTORE PTR TO POINT AT  A42898 63470021
*                                       BLOCK DESCRIPTOR WORD           63500021
         AH    R1,FOUR                  ADD LENGTH FOR BLOCK     A42898 63530021
*                                       DESCRIPTOR WORD                 63560021
         STC   R1,D1(RBUFAD)            PUT LOW ORDER BYTE IN LL FIELD  63600020
         SRL   R1,M8                    GET HIGH ORDER BYTE             64000020
         STC   R1,D0(RBUFAD)            PUT LOW ORDER BYTE IN LL FIELD  64400020
         XC    D2(L2,RBUFAD),D2(RBUFAD) ZERO OUT BB FIELD               64800020
         SPACE 3                                                        65200020
RETURN   EQU   *                                                        65600020
         MVI   D0(RECB),M7F             SET COMPLETION BIT IN ECB       65700020
RESTORE  EQU   *                                                        65800020
         L     R14,D12(R13)             RESTORE REG 14                  66000020
         LM    R0,R12,D20(R13)          RESTORE REGS 0-12               66400020
         BR    R14                      RETURN CONTROL TO CALLER        66800020
         SPACE 3                                                        67200020
SUCCESS  EQU   *                                                        67600020
         CH    R1,TWO                   IS MESSAGE LENGTH 2             68400020
         BNE   DESCRIBE                 BRANCH IF NO                    69200020
CKBUF    EQU   *                                                        70000020
         CLC   D0(L2,RBUFAD),END        IS THERE A /* IN BUFFER         70400020
         BNE   DESCRIBE                 BRANCH IF NO                    70800020
         SPACE 3                                                        71200020
         MVI   D0(RECB),M41             SET ECB I/O ERROR BIT           72200020
         OI    DCBCIND1,EOF             SIGNAL EOF                      72700020
         B     RESTORE                  GO TO RESTORE REGISTERS         74700020
         SPACE 3                                                        75100020
         SPACE 3                                                        76800020
********                                                                77200020
******** CONSTANTS                                                      77600020
********                                                                78000020
         DS    0F                       FORCE WORD BOUNDARY             78400020
ZEROHALF DC    X'0000FFFF'              USED TO CLEAR HIGH ORDER 2      78800020
*                                       BYTES OF REGISTER               79200020
TWO      DC    H'2'                     CONSTANT OF 2                   79300020
EIGHT    DC    H'8'                     CONSTANT OF 8                   79400020
TWELVE   DC    H'12'                    CONSTANT OF 12                  79500020
FOUR     DC    H'4'                     CONSTANT OF 4                   79600020
SIXTEEN  DC    H'16'                    CONSTANT OF |6                  79700020
END      DC    C'/*'                    DENOTE END OF DATA SET          80000020
         SPACE 3                                                        80800020
         DS    0F                                                       81200020
DECB     DSECT                                                          81600020
DECSDECB DS    CL4                                                      82000020
DECTYPE  DS    CL2                                                      82400020
DECLNGTH DS    CL2                                                      82800020
DECDCBAD DS    CL4                                                      83200020
DECAREA  DS    CL4                                                      83600020
DECIOBPT DS    CL4                                                      84000020
         SPACE 3                                                        84400020
         DS    0F                                                       84800020
BUFCB    DSECT                          BUFFER POOL CONTROL BLOCK       85200020
BUFAD    DS    CL4                      ADDR OF FIRST AVAILABLE BFR     85600020
BUFNO    DS    CL2                      NUMBER OF BUFFER REQUESTED      86000020
BUFL     DS    CL2                      LENGTH OF EACH BUFFER           86400020
         SPACE 3                                                        86440020
         DS    0F                                                       86480020
DEB      DSECT                                                          86520020
         DS    CL32                     DEB BASIC SECTION               86560020
         DS    CL4                      DEB EXTENT                      86600020
         DS    CL12                     DEB BSAM/QSAM DEPENDENT SECTION 86640020
DEBBLKSI DS    CL2                      BLOCK SIZE SAVE AREA            86680020
DEBLRECL DS    CL2                      LRECL SAVE AREA                 86720020
         SPACE 3                                                        86800020
         DCBD  DSORG=PS                                                 87200020
         END                                                            87600020
./  ADD  SSI=20720061,NAME=IGG019T8
         TITLE 'IGG019T8 - BSAM TS WRITE'                               00500020
IGG019T8 CSECT                                                          01000020
*********************************************************************** 01500020
*                                                                     * 02000020
* RELEASE 23 DELETIONS/CHANGES                                        * 02070020
* RELEASE 22 DELETIONS/CHANGES                                        * 02140020
* RELEASE 21 DELETIONS/CHANGES                                        * 02210020
*2870320000,550000-560000,800000                                 A42898 02240021
*                                                                     * 02280020
*0000                                                            TS1616 02310020
*STATUS CHANGE LEVEL 002                                                02360021
*                                                                     * 02420020
* NAME - IGG019T8 (TS WRITE).                                         * 02500020
*                                                                     * 03000020
* FUNCTION/OPERATION - THIS INTERFACE ROUTINE PERFORMS THE FOLLOWING  * 03500020
*                      FUNCTION.                                      * 04000020
*                                                                     * 04500020
*                      FURNISH TPUT BUFFER ADDRESS.                   * 05000020
*                      FURNISH TPUT BUFFER SIZE.                      * 05500020
*                      ISSUE TPUT WHICH WRITES A BLOCK OF DATA FROM   * 06000020
*                      USER'S BUFFER TO THE TERMINAL. UPON REGAIN     * 06500020
*                      CONTROL FROM TPUT, SET USER ECB COMPLETION     * 06700020
*                      CODE TO X'7F'                                  * 06900020
*                                                                     * 07100020
* ENTRY POINT - IGG019T8 BEGINNING OF MODULE. CONTROL IS RECEIVED     * 07300020
*               WHEN THE FOLLOWING CONDITIONS ARE MET.                * 07500020
*                                                                     * 07700020
*               THE TASK IS TIME SHARING.                             * 07900020
*               THE DCB OPENED IS FOR BSAM OUTPUT.                    * 08100020
*               A WRITE MACRO INSTRUCTION IS ISSUED.                  * 08300020
*                                                                     * 08500020
*               UPON ENTRY TO THIS MODULE, REGISTER 1 CONTAINS THE    * 08700020
*               ADDRESS OF DECB                                       * 08900020
*                                                                     * 10000020
* INPUT - DECB NAME, ('SF' IS IGNORED), DCB ADDRESS, BUFFER ADDRESS,  * 10500020
*         'S' OR LENGTH OF MESSAGE.                                   * 11000020
*                                                                     * 11500020
* OUTPUT - A BLOCK OF EDITED (SPECIALLY-INDICATED CHARACTERS ARE      * 12000020
*          DELETED FROM THE MESSAGE WRITTEN) TEXT WRITTEN ON TERMINAL.* 12500020
*                                                                     * 13000020
* EXIT, NORMAL - RETURN CONTROL TO CALLER VIA A 'BR 14' INSTRUCTION.  * 13100020
*                                                                     * 13200020
* EXIT, ERROR - NONE.                                                 * 13300020
*                                                                     * 13400020
* EXTERNAL REFERENCE - IGC0009C.                                      * 13500020
*                                                                     * 13600020
* TABLE/WORK AREAS - NONE.                                            * 13700020
*                                                                     * 13800020
* ATTRIBUTES - REENTRANT, REUSABLE.                                   * 13900020
*                                                                     * 14000020
* CHARACTER CODE DEPENDENCY.                                          * 14100020
*                                                                     * 14200020
* NOTES -                                                             * 14300020
*                                                                     * 15000020
*********************************************************************** 15500020
         SPACE 3                                                        16000020
********                                                                16500020
******** REGISTER EQUATES                                               17000020
********                                                                17500020
R0       EQU   0                        CONTAINS BFR SIZE FOR TPUT      18000020
R1       EQU   1                        CONTAINS BFR ADDR FOR TPUT,     18500020
*                                       POINTS AT DECB ADDR WHEN THIS   19000020
*                                       MODULE GETS CONTROL             19500020
RDCB     EQU   2                        POINTS AT DCB                   20000020
RECB     EQU   3                        POINTS AT ECB                   20500020
RDECB    EQU   4                        POINTS AT DECB                  21000020
RBUFAD   EQU   5                        CONTAINS BFR ADDR               21500020
RBUFSZ   EQU   6                        CONTAINS BFR SIZE               22000020
RDEB     EQU   7                        POINTS AT DEB                   22200020
RBASE    EQU   12                       BASE REGISTER                   22500020
R12      EQU   12                       REGISTER 12                     23000020
R13      EQU   13                       POINTS AT SAVE AREA ADDR        23500020
R14      EQU   14                       CONTAINS RETURN ADDR            24000020
R15      EQU   15                       POINTS AT ENTRY ADDR OF THIS    24500020
*                                       MODULE WHEN IT GETS CONTROL     25000020
RRETURN  EQU   15                       CONTAINS RETURN CODE            25500020
         SPACE 3                                                        26000020
********                                                                26500020
******** EQUATES FOR MASKS, DISPLACEMENTS                               27000020
********                                                                27500020
M7F      EQU   X'7F'                    ECB COMPLETION BIT              27700020
MC0      EQU   X'C0'                    DENOTES V-TYPE RECORD           28000020
M80      EQU   X'80'                    'S' SPECIFIED IN DECB           28500020
*                                       WRITE BIT IN DCBOFLGS           29000020
M40      EQU   X'40'                    DENOTES V-TYPE RECORD           29500020
M06      EQU   X'06'                    ASA OR MACHINE CHAR USED        30000020
M8       EQU   8                        USED TO SHIFT REGISTER          30500020
D0       EQU   0                        DISPLACEMENT OF 0               31000020
D1       EQU   1                        DISPLACEMENT OF 1               31500020
D8       EQU   8                        DISPLACEMENT OF 8        A42898 32000021
D12      EQU   12                       DISPLACEMENT OF 12              32500020
D20      EQU   20                       DISPLACEMENT OF 20              33000020
         SPACE 3                                                        33060020
         SPACE 3                                                        33500020
********                                                                34000020
******** SAVE REGISTERS AND ESTABLISH ADDRESSABILITY                    34500020
********                                                                35000020
         STM   R14,R12,D12(R13)         SAVE REGISTERS                  35500020
         LR    RBASE,R15                USE ENTRY ADDR AS BASE ADDR     36000020
         USING IGG019T8,RBASE           ESTABLISH ADDRESSABILITY        36500020
         USING IHADCB,RDCB              ESTABLISH ADDRESSABILITY        37000020
         USING DECB,RDECB               ESTABLISH ADDRESSABILITY        37500020
         USING DEB,RDEB                 ESTABLISH ADDRESSABILITY        37700020
         SPACE 3                                                        38000020
********                                                                38500020
******** INITIALIZATION AND GET BUFFER ADDRESS                          39000020
********                                                                39500020
         LR    RDECB,R1                 SAVE DECB ADDRESS               40000020
         L     RDCB,DECDCBAD            GET DCB ADDRESS                 40500020
         L     RBUFAD,DECAREA           GET BUFFER ADDRESS              41000020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 41200020
         LA    RECB,DECSDECB            GET ADDR OF ECB                 41300020
         MVI   D0(RECB),M80             SET ECB WAIT BIT ON             41400020
         SPACE 3                                                        41500020
********                                                                42000020
******** TEST RECORD TYPE AND GET BUFFER SIZE                           42500020
********                                                                43000020
         TM    DCBRECFM,MC0             IS IT A U-TYPE RECORD           43500020
         BNO   TESTMORE                 NO, GO TO TESTMORE              44000020
UTYPE    EQU   *                                                        44500020
         TM    DECTYPE,M80              IS 'S' SPECIFIED                45000020
         BO    LNGINDCB                 YES, GET LENGTH FROM DCBBLKSI   45500020
LNGNDECB EQU   *                                                        46000020
         LH    RBUFSZ,DECLNGTH          GET BUFFER SIZE                 46500020
         N     RBUFSZ,ZEROHALF          CLEAR HIGH ORDER 2 BYTES        47000020
         B     CKCHAR                   GO TO CKCHAR                    47500020
LNGINDCB EQU   *                                                        48000020
         LH    RBUFSZ,DCBBLKSI          GET BUFFER SIZE FROM DCB TS1616 48100020
         LTR   RBUFSZ,RBUFSZ            IS BLOCK SIZE SPECIFIED  TS1616 48200020
         BNZ   CKCHAR                   BRANCH IF YES            TS1616 48300020
         LH    RBUFSZ,DEBLRECL          GET BUFFER SIZE                 48700020
         B     CKCHAR                   GO TO CHECK CONTROL CHAR        49300020
TESTMORE EQU   *                                                        50000020
         TM    DCBRECFM,M40             IS IT V-TYPE RECORD             50500020
         BZ    LNGINDCB                 NO, LENGTH IS IN DCBBLKSI       51000020
VTYPE    EQU   *                                                        51500020
         SR    RBUFSZ,RBUFSZ            CLEAR REGISTER                  52000020
         IC    RBUFSZ,D0(RBUFAD)        GET 1 L FROM RECORD DESCRIPTOR  52500020
*                                       WORD                            53000020
         SLL   RBUFSZ,M8                PUT 1ST L IN PLACE              53500020
         IC    RBUFSZ,D1(RBUFAD)        GET OTHER L FROM RECORD         54000020
*                                       DESCRIPTOR WORD                 54500020
         SH    RBUFSZ,EIGHT             TAKE OFF LNG FOR BLK AND A42898 55000021
*                                       RECORD DESCRIPTOR WORDS         55500021
         LA    RBUFAD,D8(RBUFAD)        MOVE UP PTR              A42898 56000021
         SPACE 3                                                        56500020
********                                                                57000020
******** TEST FOR ASA OR MACHINE CHARACTER                              57500020
********                                                                58000020
CKCHAR   EQU   *                                                        58500020
         TM    DCBRECFM,M06             TEST FOR ASA OR MACHINE CHAR    59000020
         BZ    LOADPARM                 NO, GO TO LOADPARM              59500020
         LA    RBUFAD,D1(RBUFAD)        MOVE UP PTR TO BUFFER ADDR      60000020
         BCTR  RBUFSZ,R0                DECREMENT BUFFER SIZE BY 1      60500020
         SPACE 3                                                        61000020
********                                                                61500020
******** PREPARE PARAMETER AND ISSUE TPUT                               62000020
********                                                                62500020
LOADPARM EQU   *                                                        63000020
         LR    R0,RBUFSZ                LOAD BFR SIZE                   63500020
         LR    R1,RBUFAD                LOAD BFR ADDRESS                64000020
         SPACE 3                                                        64500020
         TPUT  (1),(0)                  ISSUE TPUT                      65000020
         SPACE 3                                                        65500020
********                                                                66000020
******** UPON RETURN FROM TPUT                                          66500020
********                                                                67000020
SUCCESS  EQU   *                                                        69500020
         OI    DCBOFLGS,M80             TURN ON WRITE BIT               70000020
         MVI   D0(RECB),M7F             SET ECB COMPLETION BIT          70700020
         SPACE 3                                                        71500020
********                                                                72000020
******** RESTORE REGISTERS AND RETURN                                   73000020
********                                                                73500020
RETURN   EQU   *                                                        74000020
         L     R14,D12(R13)             RESTORE REG 14                  74500020
         LM    R0,R12,D20(R13)          RESTORE REG 0 - 12              75000020
         BR    R14                      RETURN CONTROL TO USER          75500020
         SPACE 3                                                        76000020
********                                                                76500020
******** CONSTANTS                                                      77000020
********                                                                77500020
         DS    0F                       FORCE THE FOLLOWING ON WORD     78000020
*                                       BOUNDARY                        78500020
ZEROHALF DC    X'0000FFFF'              USED TO CLEAR HIGH ORDER 2      79000020
*                                       BYTES OF REGISTER               79500020
EIGHT    DC    H'8'                     CONSTANT OF 8            A42898 80000021
         SPACE 3                                                        80500020
         SPACE 3                                                        81500020
         DCBD  DSORG=PS                                                 82000020
         SPACE                                                          82500020
         DS    0F                                                       83000020
DECB     DSECT                                                          83500020
DECSDECB DS    CL4                      EVENT CONTROL BLOCK             83800020
DECTYPE  DS    CL2                      TYPE OF I/O REQUEST             84100020
DECLNGTH  DS   CL2                      LENGTH OF KEY AND DATA          84400020
DECDCBAD DS    CL4                      ADDR OF THE DCB TO WHICH THIS   84700020
*                                       I/O REQUEST IS RELATED          85000020
DECAREA  DS    CL4                      ADDR OF KEY AND DATA            85300020
DECIOBPT DS    CL4                      ADDR OF THE IOB                 85600020
         SPACE 3                                                        86550020
         DS    0F                                                       86600020
DEB      DSECT                                                          86650020
         DS    CL32                     DEB BASIC SECTION               86700020
         DS    CL4                      DEB EXTENT                      86750020
         DS    CL12                     DEB BSAM/QSAM DEPENDENT SECTION 86800020
DEBBLKSI DS    CL2                      BLOCK SIZE SAVE AREA            86850020
DEBLRECL DS    CL2                      LRECL SAVE AREA                 86900020
         END                                                            87000020
./  ADD  SSI=72410255,NAME=IGG0196S
         TITLE 'IGG0196S - TS OPEN EXECUTOR'                            00100020
*                                                                       00200020
IGG0196S CSECT                                                          00300020
*                                                                       00400020
* VS/2-3 SERVICE UPDATE                                                 00410003
*  C 129400                                                     ZA16624 00415003
*0000107700,241100-244000                                      @ZA08323 00420003
*  D 422000,422500                                              ZA09612 00425003
*0000107700,129400,129600                                      @OZ09612 00430003
* VS/2-2 DELETIONS/CHANGES                                      YS02019 00450002
*                                       7/23/1973               YM01426 00452002
*                                       8/20/1973               YM03016 00454002
*                                       9/18/1973               YM03842 00456002
*                                      10/01/1973               YM03948 00458002
*                                                                     * 00460002
* RELEASE 21 DELETIONS/CHANGES                                        * 00490020
*                                                                     * 00520020
*0000215016,215044                                               TS2495 00530020
*                                                                M3415  00540020
*                                                                M3504  00545020
*                                                                M4324  00547020
*                                                                M1565  00547520
*                                                                M2307  00548020
*                                                                 M5005 00549020
*                                                                M5457  00549520
*STATUS CHANGE LEVEL 001                                                00550020
*                                                                     * 00580020
* NAME - IGG0196S, TS OPEN EXECUTOR                                   * 00610020
*                                                                     * 00640020
* FUNCTION - THIS ROUTINE OBTAINS CONTROL WHEN THE DCB BEING OPENED   * 00670020
*            IS A TERMINAL DEVICE AND THE TASK IS UNDER TIME SHARING. * 00700020
*            THE EXECUTOR PERFORMS THE FOLLOWING FUNCTIONS.           * 00730020
*                                                                     * 00760020
*          * DEFAULT DCBBLKSI, DCBLRECL, AND DCBRECFM FOR OUTPUT      * 00770002
*            DATA SET                                                 * 00780002
*                                                                     * 00782002
*          * FOR PUT LOCATE MODE, IT SET ON BIT 0 IN BYTE 0 IN BUFFER * 00790020
*            POOL CONTROL BLOCK TO SIGNAL IGG019T4 (TS PUT ROUTINE)   * 00820020
*            THAT THIS IS THE FIRST PUT                               * 00850020
*                                                                     * 00880020
*          * IT LOADS PROPER INTERFACE ROUTINE(S) FOR SAM AND TERMINAL* 00910020
*            I/O SVC                                                  * 00940020
*                                                                     * 00970020
* ENTRY POINTS - IGG0196S, BEGINNG OF ROUTINE. CONTROL IS RECEIVED    * 01000020
*                FROM IGG0196B OR IGG0193I VIA XCTL             YS02019 01030002
*                                                                     * 01060020
* INPUT - SEE DESCRIPTION OF REGISTERS                                * 01090020
*                                                                     * 01120020
* OUTPUT - PROPER INTERFACE ROUTINES LOADED                           * 01150020
*                                                                     * 01180020
* EXTERNAL REFERENCE - NONE                                           * 01210020
*                                                                     * 01240020
* EXIT, NORMAL - TO OPEN MODULE, IGG0190S VIA XCTL                    * 01270020
*                                                                     * 01300020
* EXIT, ERROR - NONE                                                  * 01330020
*                                                                     * 01360020
* TABLE/WORK AREAS - WHERE-TO-GO TABLE (WTG)                          * 01390020
*                                                                     * 01420020
*      BYTE  0-7  NAME                                                * 01450020
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD          * 01480020
*      BYTE 11    CONCATENATION NUMBER                                * 01510020
*      BYTE 12    ZERO                                                * 01540020
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR      * 01570020
*                        ALIAS 1 BIT                                  * 01600020
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS    * 01630020
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                            * 01660020
*      BYTE 17    ZERO                                                * 01690020
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                    * 01720020
*      BYTE 20    TRANSLATION TABLE                                   * 01750020
*      BYTE 21    ZERO NUMBER OF ENTRIES IN THE NOTE LIST             * 01780020
*      BYTE 22-23 ATTRIBUTES                                          * 01810020
*      BYTE 24-26 TOTAL CONTIGIOUS MAIN STORAGE REQUIRED FOR MODULE   * 01840020
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                         * 01870020
*      BYTE 29    LENGTH OF WHERE-TO-GO TABLE (IN DOUBLE WORDS)       * 01900020
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                      * 01930020
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                     * 01960020
*      BYTE 35    ADDRESS OF STORAGE FOR DCB                          * 01990020
*      BYTE 36-39 TABLE OF IDTTR'S                                    * 02020020
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR NEXT DCB (3 BYTES)          * 02050020
*                   ADDRESS OF STORAGE FOR DCB     (1 BYTE)           * 02080020
*                   IDTTR OF LAST ROUTINE LOADED   (3 BYTES)          * 02110020
*                   NOT USED                       (1 BYTE)           * 02140020
*                                                                     * 02170020
*      OPEN WORK AREA - SEE IECDSECT IN THIS LISTING                  * 02200020
*                                                                     * 02230020
* ATTRIBUTES - REENTRANT, REUSABLE, SUPERVISOR MODE                   * 02260020
*                                                                     * 02290020
* CHARACTER CODE DEPENDENCY -                                         * 02320020
*                                                                     * 02350020
* NOTES -                                                             * 02380020
*                                                                     * 02410020
*********************************************************************** 03200020
*                                                                       03300020
*                                                                       03400020
*********************************************************************** 03500020
*                                                                       03600020
*   REGISTER CONVENTIONS USED THROUGH OUT OPEN EXECUTORS                03700020
*                                                                       03800020
*********************************************************************** 03900020
*                                                                       04000020
RE       EQU   0                        WORK/PARAMETER REGISTER         04100020
RF       EQU   1                        WORK/PARAMETER REGISTER         04200020
RDCB     EQU   2                        ADDR OF USERS DCB               04300020
RBASE    EQU   3                        BASE REGISTER                   04400020
RCORE    EQU   4                        ADDR OF OPEN WORK AREA          04500020
RPAR     EQU   5                        PARAMTER LIST                   04600020
RWTG     EQU   6                        START OF WTG                    04700020
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 04800020
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      04900020
RTIOT    EQU   9                        TIOT ADDR/WORK REGISTER         05000020
RUCB     EQU   10                       UCB ADDR                        05100020
RDEB     EQU   11                       DEB ADDR                        05200020
RB       EQU   12                       WORK AREA BASE REGISTER         05300020
RC       EQU   13                       WORK REGISTER                   05400020
RD       EQU   14                       WORK/PARAMETER REGISTER         05500020
RJ       EQU   15                       WORK/PARAMETER REGISTER         05600020
*                                                                       05700020
*********************************************************************** 05800020
*                                                                       05900020
*                                                                       06000020
*********************************************************************** 06100020
*                                                                       06200020
*   EQUATES                                                             06300020
*                                                                       06400020
*********************************************************************** 06500020
*                                                                       06600020
NULL     EQU   0                        CONSTANT='0'                    06700020
ONE      EQU   1                        CONSTANT='1'                    06800020
TWO      EQU   2                        CONSTANT='2'                    06900020
THREE    EQU   3                        CONSTANT=3                      07000020
FOUR     EQU   4                        CONSTANT='4'                    07100020
FIVE     EQU   5                        CONSTANT='5'                    07150020
SIX      EQU   6                        CONSTANT=6                      07200020
MSK14    EQU   14                       CONSTANT =14                    07400020
MSK24    EQU   24                       CONSTANT=24                     07500020
MSK25    EQU   25                       CONSTANT=25                     07600020
PARMLNGH EQU   16                       LENGTH OF PARM LIST=16          07700020
MSK48    EQU   X'48'                    MASK FOR V/S RECORD             07800020
QSAMLOCT EQU   X'48'                    MACRF=PL OR GL                  07900020
NOTONES  EQU   14                       'BC 14' FOR TEST UNDER MASK     08000020
BLKSIMRG EQU   X'10'                    BLKSI HAS BEEN MERGED           09110020
LRECLMRG EQU   X'80'                    LRECL HAS BEEN MERGED           09120020
RECFMMRG EQU   X'04'                    RECFM HAS BEEM MERGED           09150020
FIRSTPT  EQU   X'80'                    FIRST PUT IN PUT LOCATE MODE    09200020
MSK7     EQU   7                        CONSTANT = 7                    09300020
MSK22    EQU   22                       CONSTANT = 22                   09400020
WGOFF    EQU   8                        OFFSET TO CURRENT WTG ENTRIES   09500020
PLOFF    EQU   4                        OFFSET TO CURRENT DCB ENTRIES   09600020
WAOFF    EQU   32                       OFFSET TO 1ST ENTRY IN WTG TBL  09700020
DEBPRFX  EQU   16                       SIZE OF DEB PREFIX              09750020
NMXD     EQU   X'09'                    CC NOT MIXED AFTER BRANCH       09800002
MSK0E    EQU   X'0E'                    OPEN FLAG FOR INOUT/OUTIN/UPDAT 10000002
*                                                                       10100020
*********************************************************************** 10200020
*                                                                       10300020
*   REGISTER INITIALIZATION                                             10400020
*                                                                       10500020
*********************************************************************** 10600020
*                                                                       10700020
         LR    RBASE,RJ                 SET UP BASE REGISTER    YM01426 10710002
         USING IGG0196S,RBASE           MODULE ADDRESSABLE      YM01426 10720002
         B     GOGOGOGO                 BRANCH AROUND MODULE ID YM01426 10750002
         DC    C'IGG0196S'              MODULE ID               YM01426 10760002
         DC    X'7109'                  JULIAN DATE - 04/19/77  ZA16624 10770003
         USING IHADCB,RDCB              ESTABLISH DCB REG.              11000020
         USING FORCORE,RCORE            ESTABLISH OPEN WORK AREA        11100020
         USING DEBBASIC,RDEB            ESTABLISH DEB REG.              11200002
         USING CVT,RTIOT                ESTABLISH CVT REG.              11300020
         USING TCB,RD                                                   11350020
*                                                                       11400020
*********************************************************************** 11500020
*                                                                       11600020
*                                                                       11700020
*********************************************************************** 11800020
*                                                                       11900020
GOGOGOGO EQU   *                                                        12000020
*                                                                       12100020
*********************************************************************** 12200020
*                                                                       12300020
         L     RDCB,NULL(RPARC)         GET DCB ADDR                    12400020
         L     RCORE,FOUR(RWTGC)        GET WORK AREA                   12500020
         L     RTIOT,CVTPTR             LOAD CVT ADDR                   12650020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS         YS02019 12651002
*                                                                       12652020
*  CHECK IF DCBBLKSI AND DCBLRECL ARE SPECIFIED. IF BOTH ARE            12654020
*  NOT THERE, DEFAULT WITH TERMINAL LINE SIZE WHEN IT IS SMALLER THAN   12656020
*  BUFFER LENGTH. WHEN DCBBUFL IS SMALLER THAN TERMINAL LINE SIZE,      12658020
*  THE FORMER WILL BE USED AS BLOCK SIZE AND LRECL                      12660020
*                                                                       12662020
         LH    RJ,DCBBLKSI              GET BLOCK SIZE          YS02019 12664002
         LTR   RJ,RJ                    IS IT SPECIFIED         YS02019 12666002
         BNZ   OP6050                   BRANCH IF YES                   12668020
         LH    RJ,DCBLRECL              GET LRECL               YS02019 12670002
         LTR   RJ,RJ                    IS IT SPECIFIED         YS02019 12672002
         BZ    OP6060                   BRANCH IF NO                    12674020
         STH   RJ,DCBBLKSI              USE LRECL AS BLOCK SIZE YS02019 12676002
         OI    JFCBMASK+TWO,BLKSIMRG    INDICATE BLKSI MERGED           12678020
         B     OP5666                   GO TO CHECK RECFM               12680020
         SPACE 1                                                        12680402
OP6050   EQU   *                                                        12682020
         LH    RF,DCBLRECL              GET LRECL                       12684020
         LTR   RF,RF                    IS IT SPECIFIED                 12686020
         BNZ   OP5666                   BRANCH IF YES                   12688020
         STH   RJ,DCBLRECL              USE BLOCK SIZE AS LRECL YS02019 12690002
         OI    JFCBMASK+TWO,LRECLMRG    INDICATE LRECL MERGED           12692020
         B     OP5666                   GO TO CHECK RECFM               12694020
         SPACE 1                                                        12694402
*                                                                       12696020
*  GET TERMINAL LINE SIZE FROM TSB                                      12698020
*                                                                       12700020
OP6060   EQU   *                                                        12702020
         L     RD,DEBTCBAD              GET ADDR OF TCB         YS02019 12704002
         L     RB,PSAAOLD-PSA           GET CURRENT ASCB ADDR   YS02019 12714002
         USING ASCB,RB                  ADDRESSABILITY FOR ASCB YS02019 12728002
         L     RF,ASCBTSB               GET TSB ADDRESS         YS02019 12732002
         USING TSB,RF                                                   12736020
*                                                                       12738002
*  CHANGE TO TCAM'S KEY TO GET TSBLNSZ BECAUSE TSB IS FETCH PROTECTED   12738202
*                                                                       12738402
         MODESET EXTKEY=TCAM            CHANGE TO TCAM'S KEY            12738602
         IC    RJ,TSBLNSZ               GET TERMINAL LINE SIZE  YS02019 12738802
*                                                                       12739002
         MODESET EXTKEY=DATAMGT         CHANGE BACK TO DM'S KEY YS02019 12739202
*                                                                       12739402
         LH    RF,DCBBUFL               GET BUFFER LENGTH               12740020
         LTR   RF,RF                    IS IT SPECIFIED                 12742020
         BZ    OP6070                   BRANCH IF NO                    12744020
         CR    RJ,RF                    IS TERMINAL LINE SIZE   YS02019 12746002
*                                       LARGER THAN BUFFER LENGTH       12748020
*                                                                       12750020
*  IF BUFFER LENGTH IS LARGER THAN TERMINAL LINE SIZE, DEFAULT WITH     12752020
*  THE LATTER, OTHERWISE, DEFAULT WITH THE FORMER.                      12754020
*                                                                       12756020
         BH    OP6080                   BRANCH IF YES                   12758020
         SPACE 1                                                        12758402
OP6070   EQU   *                                                        12760020
         STH   RJ,DCBBLKSI              DEFAULT BLOCK SIZE      YS02019 12762002
         STH   RJ,DCBLRECL              DEFAULT LRECL           YS02019 12764002
         OI    JFCBMASK+TWO,BLKSIMRG+LRECLMRG                           12766020
*                                       SET MERGE MASK                  12768020
         B     OP5666                   GO TO CHECK RECFM               12770020
         SPACE 1                                                        12770402
OP6080   EQU   *                                                        12772020
         LR    RJ,RF                    GET BUFFER LENGTH       YS02019 12774002
         B     OP6070                   DEFAULT BLOCK SIZE              12776020
         SPACE 1                                                        12776402
*                                                                       12788020
*  CHECK WHETHER DCBRECFM IS SPECIFIED, IF NOT, DEFAULT TO FIXED        12800020
*                                                                       12900020
OP5666   EQU   *                                                        12910002
         DROP  RB                      RELEASE USAGE            ZA09612 12940003
         LA    RB,DEBDEVED             GET PTR DEV DEPENDENT    ZA16624 12950003
         USING DEBACSMD,RB             SET BASE                 ZA09612 12960003
         MVC   DEBBLKSI,DCBBLKSI       SAVE BLOCKSIZE IN DEB    ZA09612 12970003
         MVC   DEBLRECL,DCBLRECL       SAVE LRECL IN DEB        ZA09612 12980003
         CLI   DCBRECFM,NULL            CHECK RECFM IS SPECIFIED        13000020
         BNE   TSEX010                  BRANCH IF YES                   13100020
         MVI   DCBRECFM,DCBRECF         DEFAULT TO FIXED                13200002
         OI    JFCBMASK+TWO,RECFMMRG    SET MERGE MASK                  13300020
         SPACE 2                                                        13350002
*                                                                       13900020
*********************************************************************** 14000020
*                                                                       14100020
*   LOAD APPROPRIATE SAM ACCESS METHOD ROUTINE AND INITIALIZE FIELDS    14200020
*   IN THE DCB                                                          14300020
*                                                                       14400020
*********************************************************************** 14500020
*                                                                       14600020
*   DETERMINE ACCESS MODE AND LOAD PROPER ROUTINE                       14700020
*                                                                       14800020
TSEX010  EQU   *                                                        14850020
         SR    RJ,RJ                    RESET RJ TO '0'                 14900020
         IC    RJ,DEBAMLNG              INSERT A.M. LENGTH              15000020
         LA    RUCB,WAOFF(RJ,RDEB)      LOAD DEB OFFSET                 15100002
         IC    RJ,DEBNMEXT              INSERT NO. OF EXTENT            15200020
         SLL   RJ,2                     MULTIPLY EXTENT BY '4'          15300020
         AR    RUCB,RJ                  NOW RUCB POINT TO DEBSUBID      15400020
         TM    DCBCIND2,DCBCNQSM        TEST IF BSAM OR QSAM            16200002
         BO    TSEX050                  QSAM,GOTO CHECK PUT OR GET      16300020
         SPACE 2                                                        16350002
*                                                                       16500020
*                                                                       17300020
*   TEST OPEN FOR INOUT, OUTIN OR UPDAT, AND LOAD COMBINED              17450002
*   READ/WRITE ROUTINE                                                  17460002
*                                                                       17500020
TSEX042  EQU   *                                                        17550020
         TM    DEBOPATB,MSK0E           TEST FOR INOUT,OUTIN,UPDAT      17600020
         BC    NMXD,TSEX041             NO,GOTO CHECK READ OR WRITE     17700020
         LA    RJ,RDWRRTN               LOAD ADDR OF READ/WRITE RTN ID  18100002
         B     TSEX070                  GOTO LOAD SUB RTN               18300002
         SPACE 1                                                        18350002
TSEX041  EQU   *                                                        18500020
         TM    DEBOPATB,MSK0E           TEST IF READ IS SPECIFIED       18700020
         BNZ   TSEX060                  NO,GOTO LOAD WRITE ROUTINE      18800020
         LA    RJ,READRTN               LOAD ADDR OF READ RTN ID        19000020
         B     TSEX070                  GOTO,BRANCH TO LOAD ROUTINE     19100020
         SPACE 1                                                        19150002
TSEX060  EQU   *                                                        19300020
         LA    RJ,WRITERTN              LOAD ADDR OF WRITE RTN ID       19500020
         SPACE 1                                                        19550002
*                                                                       19600002
*   LOAD READ/WRITE ROUTINE                                             19650002
*                                                                       19660002
TSEX070  EQU   *                                                        19700020
         BAL   RD,TSEX900               GOTO LOAD ROUTINE               19900020
         MVC   DCBRTNAD(THREE),MSK25(RWTG)   STORE RTN ADDR IN DCB      20000020
         SPACE 1                                                        20050002
TSEX080  EQU   *                                                        20200020
         TM    DCBMACF1,DCBMRCRL        IS CONTROL SPECIFIED FOR INPUT  20310002
         BO    TSEX020                  BRANCH IF YES                   20320020
         TM    DCBMACF2,DCBMRCRL        IS CONTROL SPECIFIED FOR OUTPUT 20330002
         BNO   TSEX025                  BRANCH IF NO                    20340020
         SPACE 3                                                        20342002
*                                                                       20360020
*   LOAD CONTROL ROUTINE                                                20370020
*                                                                       20380020
TSEX020  EQU   *                                                        20382002
         LA    RJ,CNTRLRTN              LOAD ADDR OF CNTRL ROUTINE ID   20390020
         BAL   RD,TSEX900               GO TO LOAD ROUTINE              20400020
         MVC   DCBCNTRL+ONE(THREE),MSK25(RWTG)                          20410002
*                                       STORE CNTRL ROUTINE ADDR IN DCB 20420020
         B     TSEX030                  GO TO LOAD CHECK ROUTINE        20430020
         SPACE 1                                                        20432002
TSEX025  EQU   *                                                        20440020
         TM    DCBMACF1,DCBMRPT1        IS NOTE/POINT SPECIFIED         20446002
*                                       FOR INPUT                       20452020
         BO    TSEX035                  BRANCH IF YES                   20460020
         TM    DCBMACF2,DCBMRPT1        IS NOTE/POINT SPECIFIED FOR     20466002
*                                       OUTPUT                          20472020
         BNO   TSEX030                  GO TO LOAD CHECK ROUTINE        20480020
         SPACE 1                                                        20482002
*                                                                       20500020
*   LOAD NOTE/POINT ROUTINE                                             20510020
*                                                                       20520020
TSEX035  EQU   *                                                        20522002
         LA    RJ,NTPTRTN               LOAD ADDR OF NOTE-POINT RTN ID  20530020
         BAL   RD,TSEX900               GO TO LOAD ROUTINE              20540020
         MVC   DCBPOINT+ONE(THREE),MSK25(RWTG)                          20550002
*                                       STORE NOTE-POINT RTN ADDR       20560020
         SPACE 1                                                        20562002
*                                                                       20580020
*   LOAD CHECK ROUTINE                                                  20590020
*                                                                       20600020
TSEX030  EQU   *                                                        20602002
         LA    RJ,CHECKRTN              LOAD ADDR OF CHECK RTN ID       20610020
         BAL   RD,TSEX900               GO TO LOAD ROUTINE              20620020
         MVC   DCBCKADR(THREE),MSK25(RWTG)                              20630020
*                                       STORE CHECK RTN ADDRESS         20640020
*                                                                       20700020
         B     TSEX090                  GOTO CHECK WTG TABLE ROUTINE    20800020
         SPACE 3                                                        20850002
*                                                                       20900020
*********************************************************************** 21000020
*                                                                       21100020
*                                                                       21300020
*   QSAM IS SPECIFIED                                                   21400020
*                                                                       21500020
*********************************************************************** 21500420
*                                                                     * 21500820
*  TEST FOR LOCATE MODE, IF SO PUT BUFFER ADRESS IN DCBRECAD, PUT     * 21501020
*  BUFFER ADDRESS PLUS LOGICAL RECORD LENGTH IN DCBEOBAD. IF          * 21501220
*  PUT/LOCATE IS SPECIFIED, TURN ON BIT 0 OF BYTE 0 IN BUFFER POOL    * 21501420
*  CONTROL BLOCK TO INDICATE FIRST PUT.                               * 21501620
*                                                                     * 21502020
*********************************************************************** 21502420
*                                                                       21502820
TSEX050  EQU   *                                                        21504802
         TM    DCBMACRF,QSAMLOCT        TEST FOR GET/LOCATE             21510820
         BO    TSEX001                  BRANCH IF YES                   21518820
         TM    DCBMACRF+ONE,QSAMLOCT    TEST FOR PUT/LOCATE             21526802
         BNO   TSEX040                  BRANCH IF NOT                   21534820
         SPACE 1                                                        21536802
TSEX001  EQU   *                                                        21542820
         L     RD,DCBBUFNO              GET ADDR OF BUFCB               21550820
         MODESET KEYADDR=DXUKEY,WORKREG=13  CHANGE INTO         YM03948 21552802
*                                           USER'S KEY          YM03948 21554802
         L     RD,NULL(RD)              GET ADDR OF FIRST BUFFER        21558820
         MODESET EXTKEY=DATAMGT         CHANGE BACK TO DM KEY   YM03948 21560802
         ST    RD,DCBRECAD              PUT ADDR OF BUFFER IN DCB       21566820
         AH    RD,DCBLRECL              ADD LENGTH OF RECORD            21574820
         ST    RD,DCBEOBAD              PUT EOB ADDRESS IN DCB          21582820
         TM    DCBMACRF+ONE,QSAMLOCT    TEST FOR PUT/LOCATE             21590802
         BNO   TSEX040                  BRANCH IF NOT                   21598820
         L     RD,DCBBUFNO              GET ADDR OF BUFCB               21606820
         MODESET KEYADDR=DXUKEY,WORKREG=13  CHANGE IN USER KEY  YM03948 21608802
         OI    NULL(RD),FIRSTPT         TURN ON FLAG FOR FIRST PUT      21614820
         MODESET EXTKEY=DATAMGT         CHANGE BACK TO DM KEY   YM03948 21624802
         SPACE 3                                                        21624920
*                                                                       21664920
*   TEST IF DCB IS OPEND FOR UPDATE                                     21700020
*                                                                       21800020
TSEX040  EQU   *                                                        21850002
         TM    DEBOPATB,MSK0E           TEST IF DCB IS OPENED FOR UPDAT 21900020
         BC    NMXD,TSEX051             NO,GOTO CHECK PUT OR GET        22000020
         LA    RJ,GTPTRTN                LOAD ADDR OF GET/PUT RTN ID    22200020
         B     TSEX110                  GO TO LOAD ROUTINE              22300020
         SPACE 1                                                        22350002
TSEX051  EQU   *                                                        22500020
         TM    DEBOPATB,MSK0E           TEST IF GET IS SPECIFIED        22700020
         BNZ   TSEX100                  NO, GO TO LOAD PUT RTN          22800020
         LA    RJ,GETRTN                LOAD ADDR OF GET RTN ID         23000020
*                                                                       23020020
*   FOR VARIABLE SPANNED RECORD, SAVE BLOCK SIZE IN DEB IF IT           23040020
*   IS SMALLER THAN LRGCL                                               23060020
*                                                                       23080020
TSEX057  EQU   *                                                        23100020
         TM    DCBRECFM,DCBRECV+DCBRECSB TEST FOR V/S TYPE RECORD       23300002
         BNO   TSEX110                  BRANCH IF NO                    23400020
         TM    DCBMACRF,DCBMRLCG        TEST FOR GET/LOCATE MODE        23500002
         BNO   TSEX110                  BRANCH IF NO                    23600020
         LH    RC,DCBBLKSI              LOAD BLOCK SIZE                 23700020
         DROP  RD                                                       23900020
         USING BUFCB,RD                                                 24100020
         L     RD,DCBBUFCB              GET ADDRESS OF BUFCB   @ZA08323 24300003
         MODESET KEYADDR=DXUKEY,WORKREG=9 CHANGE TO USERS KEY  @ZA08323 24330003
*                                                              @ZA08323 24360003
         CH    RC,BUFL                  IS BLOCK SIZE > BFR    @ZA08323 24390003
         BNH   TSEX055                  BRANCH IF NOT          @ZA08323 24420003
         LH    RC,BUFL                  YES GET BFR LENGTH     @ZA08323 24450003
TSEX055  EQU   *                                               @ZA08323 24480003
         MODESET EXTKEY=DATAMGT         CHANGE BACK TO DM KEY  @ZA08323 24510003
*                                                              @ZA08323 24540003
         L     RTIOT,CVTPTR             RELOAD CVT ADDRESS     @ZA08323 24570003
*                                                              @ZA08323 24600003
         SPACE 1                                                        24650002
TSEX056  EQU   *                                                        24700020
         CH    RC,DEBLRECL              IS BLOCK SIZE BIGGER THAN LRECL 24800020
         BNL   TSEX110                  BRANCH IF YES                   24900020
         STH   RC,DEBLRECL              SAVE BLOCK SIZE IN DEB          25000020
         B     TSEX110                  GOTO,BRANCH TO LOAD ROUTINE     25200020
         SPACE 1                                                        25250002
TSEX100  EQU   *                                                        25400020
         LA    RJ,PUTRTN                LOAD ADDR OF PUT RTN ID         25600020
         SPACE 1                                                        25650002
TSEX110  EQU   *                                                        25800020
         BAL   RD,TSEX900               GOTO LOAD ROUTINE               26000020
         MVC   DCBRTNAD(THREE),MSK25(RWTG)   STORE RTN ADDR IN DCB      26100020
*                                                                       26200020
*                                                                       26240020
*   TEST CNTRL IS SPECIFIED, IF YES, LOAD CONTROL ROUTINE               26280020
*                                                                       26320020
         TM    DCBMACF1,DCBMRCRL        IS CONTROL SPECIFIED FOR INPUT  26360002
         BO    TSEX054                  BRANCH IF YES                   26400020
         TM    DCBMACF2,DCBMRCRL        IS CONTROL SPECIFIED FOR OUTPUT 26450002
         BNO   TSEX090                  BRANCH IF NO                    26480020
         SPACE 1                                                        26530002
TSEX054  EQU   *                                                        26560020
         LA    RJ,CNTRLRTN              LOAD ADDR OF CNTRL RTN ID       26600020
         BAL   RD,TSEX900               GO TO LOAD ROUTINE              26640020
         MVC   DCBCNTRL+ONE(THREE),MSK25(RWTG)                          26680002
*                                       STORE CNTRL RTN ADDR IN DCB     26720020
         B     TSEX090                  GOTO CHECK WTG TABLE ROUTINE    26800020
         SPACE 3                                                        26850002
*                                                                       26900020
*                                                                       27000020
*********************************************************************** 27100020
*                                                                       27200020
TSEX900  EQU   *                                                        27300020
*                                                                       27400020
*********************************************************************** 27500020
*                                                                       27600020
*   LOAD SAM SUBROUTINE ROUTINE                                         27700020
*                                                                       27800020
*********************************************************************** 27900020
*                                                                       28000020
         MVC   NULL(TWO,RUCB),NULL(RJ)  STORE ROUTINE ID IN DEB         28100020
         LA    RUCB,TWO(RUCB)           INCREMENT RUCB BY '2'           28200020
         MVC   SIX(TWO,RWTG),NULL(RJ)   MOVE 2 BYTE ID TO DE            28224020
         L     RC,CVTLINK               GET LINKLIB'S DCB ADDR  YM01426 28274002
         LOAD  EPLOC=(RWTG),DCB=(RC)    LOAD ROUTINE            YM03842 28284002
         ST    RE,MSK24(RWTG)           SAVE ADDR OF ROUTINE TEMPORARLY 29000020
*                                                                       29100020
         SR    RJ,RJ                                                    29200020
         IC    RJ,DEBNMSUB              LOAD NO. OF SUBROUTINE          29300020
         LA    RJ,ONE(RJ)               INCREMENT NO. BY '1'            29400020
         STC   RJ,DEBNMSUB              UPDATE NO. OF SUBROUTINE        29500020
*                                                                       29600020
         BR    RD                       GO BACK TO ENTRY POINT          29700020
*                                                                       29800020
*                                                                       29900020
*********************************************************************** 30000020
*                                                                       30100020
*********************************************************************** 30200020
*                                                                       30300020
*                                                                       30400020
TSEX090  EQU   *                                                        30500020
*                                                                       30510002
*********************************************************************** 30520002
*                                                                       30530002
*   UPDATE USER'S DCB                                                   30540002
*                                                                       30550002
*********************************************************************** 30560002
*                                                                       30570002
         USING WTG,RWTG                 WTG TABLE ADDRESSABLE   YM03016 30620002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(RE,RD,WTGPREFX) COPY   YM03016 30670002
*                                       BACK USER'S DCB         YM03016 30720002
         DROP  RWTG                     WTG NOT ADDRESSABLE     YM03016 30770002
         MVC   DEBDCBB,DXUDCBAD+ONE     UPDATE DCB PTR IN DEB   YM03016 30780002
         MVI   NULL(RWTGC),NULL         SET TO GO OUT FROM SAM EXECUTOR 30800020
         SPACE 2                                                        30850002
*                                                                       31300020
*********************************************************************** 31400020
*                                                                       31500020
*   UPDATES WHERE-TO-GO TABLE AND XCTL TO NEXT MODULE                   31600020
*                                                                       31700020
*********************************************************************** 31800020
*                                                                       31900020
RELOOP   EQU   *                                                        31950002
         LA    RWTGC,WGOFF(NULL,RWTGC)  INCREMENT CURRENT WTG ENTRY     32000020
         LA    RPARC,PLOFF(NULL,RPARC)  INCREMENT CURRENT DCB ENTRY     32100020
         CLC   NULL(TWO,RWTGC),AMIDCNST IS THE RTN NEEDED AGAIN         32200020
         BE    GOGOGOGO                 YES,RETURN TO THE BEGINNING     32300020
         CLC   NULL(TWO,RWTGC),OPIDCNST TEST END OF WTG TABLE           32500020
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             32600020
         LR    RPARC,RPAR               RESET REG. TO '0'               32800020
         LA    RWTGC,WAOFF(NULL,RWTG)   RESET WTG REG TO PT +32(WTG)    32900020
         SPACE 1                                                        32950002
ZCHECK   EQU   *                                                        33100020
         CLI   NULL(RWTGC),NULL         TEST IF THIS ENTRY IS COMPLETE  33300020
         BNE   TCTLRTN                  NO,GOTO XCTL                    33400020
         LA    RWTGC,WGOFF(NULL,RWTGC)  GET NEXT ENTRY OF WTG TABLE     33600020
         LA    RPARC,PLOFF(NULL,RPARC)  GET NEXT ENTRY OF DCB           33700020
         B     ZCHECK                   GOTO TEST COMPLETION            33800020
         SPACE 1                                                        33850002
TCTLRTN  EQU   *                                                        34000020
         MVC   SIX(TWO,RWTG),NULL(RWTGC)     STORE ID IN WTG TABLE      34200020
         LA    RJ,DXCCW12                                               34600020
         XCTL  EPLOC=(RWTG),SF=(E,(15)) XCTL TO NEXT MODULE     YM03842 34800002
         SPACE 3                                                        34850002
*                                                                       35300020
*********************************************************************** 35400020
*                                                                       35500020
*   CONSTANTS                                                           35600020
*                                                                       35700020
*********************************************************************** 35800020
*                                                                       36800020
*   FOR WTG TABLE                                                       36900020
*                                                                       37000020
OPIDCNST DC    C'0S'                    LAST MODULE OF OPEN             37100020
AMIDCNST DC    C'6S'                    THIS MODULE                     37200020
GETRTN   DC    C'T3'                    TS GET ROUTINE ID       YM03016 38260002
PUTRTN   DC    C'T4'                    TS PUT ROUTINE ID       YM03016 38290002
RDWRRTN  DC    C'T5'                    TS READ/WRITE RTN ID    YM03016 38320002
GTPTRTN  DC    C'T6'                    TS GET/PUT ROUTINE ID   YM03016 38350002
READRTN  DC    C'T7'                    TS READ ROUTINE TID     YM03016 38380002
WRITERTN DC    C'T8'                    TS WRITE ROUTINE ID     YM03016 38410002
CHECKRTN DC    C'TX'                    TS CHECK ROUTINE ID     YM03016 38440002
NTPTRTN  DC    C'TY'                    TS NOTE/POINT RTN ID    YM03016 38470002
CNTRLRTN DC    C'TZ'                    TS CONTROL ROUTINE ID   YM03016 38500002
PATCH    DC    20F'0'                   PATCH AREA              YM03016 38550002
         EJECT                                                          38730002
         IHAASCB                                                YS02019 38780002
         SPACE 3                                                        38790002
*                                                                       38800020
*                                                                       38900020
*********************************************************************** 39000020
*                                                                       39100020
*   DCB DSECT                                                           39200020
*                                                                       39300020
*********************************************************************** 39400020
*                                                                       39500020
         DCBD  DSORG=PS                                                 39600020
*                                                                       39700020
DCBEND   EQU   *                                                YS02019 39730002
DCBLEN   EQU   DCBEND-IHADCB            LENGTH OF SAME DCB      YS02019 39760002
DCBRTNAD EQU   DCBREAD+1                SAM RTN ADDR                    39800020
DCBPTADR EQU   DCBPOINT+1               ADDR OF DCB POINT/CNTRL RTN     39900020
DCBCKADR EQU   DCBCHECK+1               ADDR OF DCB CHECK RTN           40000020
DCBBLKSZ EQU   DCBBLKSI+1               DCB BLKSIZE                     40100020
DCBLRCL2 EQU   DCBLRECL+1               DCB LRECL+1                     40200020
*                                                                       40300020
*********************************************************************** 40400020
*                                                                       40500020
*   OPEN WORK AREA DSECT                                                40600020
*                                                                       40700020
*********************************************************************** 40800020
*                                                                       40900020
         IECDSECS (MAIN,(IOB,NO)),WTG,PREFX,EXPAND=YES          YM03016 41200002
*                                                                       41300020
*                                                                       41306020
*                                                                       41390020
*********************************************************************** 41400020
*                                                                       41500020
*   DEB DSECT                                                           41600020
*                                                                       41700020
*********************************************************************** 41800020
*                                                                       41900020
*                                                                       42000020
         IEZDEB                                                         42150002
         SPACE 3                                                        42300002
*                                                                       44300020
*                                                                       44400020
*********************************************************************** 48500020
*                                                                       48600020
*   CVT DUMMY SECTION                                                   48700020
*                                                                       48800020
*********************************************************************** 48900020
*                                                                       49000020
CVT      DSECT                                                          49100020
*                                                                       49200020
         CVT                                                            49300020
**********************************************************************  49400020
*                                                                     * 49500020
*                  BUFFER POOL CONTROL BLOCK DSECT                    * 49600020
*                                                                     * 49700020
**********************************************************************  49800020
         DS    0F                                                       49900020
BUFCB    DSECT                                                          50000020
BUFAD    DS    CL4                      BUFFER ADDRESS                  50100002
BUFNO    DS    CL2                      BUFFER NUMBER                   50200002
BUFL     DS    CL2                      BUFFER LENGTH                   50300002
         SPACE 3                                                        50309020
         IHAPSA                                                 YS02019 50311002
         SPACE 3                                                        50313002
         IKJTCB                                                         50318020
         SPACE 3                                                        50327020
         IKJRB                                                  YS02019 50374002
         SPACE 3                                                        50381020
         IKJTSB                                                         50390020
         END                                                            50400020
