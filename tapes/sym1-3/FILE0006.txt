./  ADD  SSI=42490772,NAME=IGG019FA
         TITLE 'IGG019FA-CNTRL MOD. FOR SKIP AND SPACE ON 3525 DEVICE'  00400000
         START                                                          00800000
*********************************************************************** 01200000
*                                                                       01600002
*         RELEASE       DELETIONS/CHANGES                               01680002
*D668000                                                        YA00439 01760002
*C 432000,808000                                               @ZA01573 01840003
*                                                                       01920002
*NAME--              IGG019FA                                           02000000
*                                                                       02400000
*TITLE               'IGG019FA' - CNTRL MODULE FOR 3525 PRINTER         02800000
*                                                                       03200000
*STATUS CHANGE LEVEL 000                                                03600000
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    04000000
*                    NEW MODULE                                         04400000
*                                                                       04800000
*MODULE TYPE--       CONTROL                                            05200000
*                                                                       05600000
*                                                                       06000000
*FUNCTION/OPERATION--BSAM/QSAM CONTROL FOR SKIPPING AND SPACING ON      06400000
*                    THE 3525 CARD PUNCH. MODIFIES COMMAND BYTE IN      06800000
*                    WRITE CCW TO CAUSE REQUESTED SKIP OR SPACE.        07200000
*                    INCREMENTS LINE POSITION COUNTER (DCBLNP) TO       07600000
*                    INDICATE LINE BEING SKIPPED TO OR SPACED TO.       08000000
*                                                                       08400000
*ENTRY POINTS--      IGG019FA FROM CNTRL MACRO EXPANSION.               08800000
*                             SPACE                                     09200000
*                    LA    1,DCB                                        09600000
*                    LA    0,1         (SPACE 1)                        10000000
*                    L     15,84(1,0)                                   10400000
*                    BALR  14,15                                        10800000
*                                                                       11200000
*                             SKIP                                      11600000
*                    LA    1,DCB                                        12000000
*                    LA    0,1         (SKIP 1)                         12400000
*                    LCR   0,0                                          12800000
*                    L     15,84(1,0)                                   13200000
*                    BALR  14,15                                        13600000
*                                                                       14000000
*INPUT--             PARAMETERS                                         14400000
*                    DCB ADDRESS IN REGISTER 1                          14800000
*                    SPACE OR SKIP MASK IN REGISTER 0                   15200000
*                    DCB'S FOLLOWING FIELDS:                            15600000
*                             DCBIOBA--IOB ADDRESS                      16000000
*                             DCBLNP---LINE POSITION COUNTER            16400000
*                             DCBCIND2-X'01' INDICATES QSAM             16800000
*                                                                       17200000
*OUTPUT--            IOB                                                17600000
*                    DCBLNP INCREMENTED TO INDICATE LINE POSITION.      18000000
*                    CONTROL MODIFIER IN OP CODE OF CCW.                18400000
*                                                                       18800000
*EXTERNAL ROUTINES-- IOS SUPERVISOR (EXCP, WAIT)                        19200000
*                                                                       19600000
*EXITS-NORMAL--      RETURN TO CALLING ROUTINE ON REG. 14               20000000
*                                                                       20400000
*EXITS-ERROR--       NONE                                               20800000
*                                                                       21200000
*TABLES/WORKAREA--   CALLING ROUTINE'S SAVE AREA--REGS. 14-9   @ZA01573 21600003
*                    BEGINNING IN SAVE+20.                     @ZA01573 22000003
*                                                                       22400000
*ATTRIBUTES--        REENTRANT AND REUSABLE.                            22800000
*********************************************************************** 23200000
PUTLOC   EQU   X'48'                                                    23600000
QSAM     EQU   X'01'                                                    24000000
ONE      EQU   X'01'                                                    24400000
TWELVE   EQU   X'0C'                                                    24800000
COMP     EQU   X'40'                                                    25200000
RATE     EQU   8                       LAST REG USED BY THIS ROUTINE    25600000
WRKR     EQU   0                                                        26000000
WRKR4    EQU   4                                                        26400000
DCBR     EQU   7                       DCB ADDRESS                      26800000
IOBAR    EQU   2                                                        27200000
COUNTR   EQU   6                                                        27600000
BASR     EQU   5                       BASE REG FOR THIS ROUTINE        28000000
SAVR     EQU   13                                                       28400000
RETR     EQU   14                                                       28800000
ENTR     EQU   15                      CONTAINS BASE OF THIS ROUTINE    29200000
LINECTR  EQU   3                       AT ENTRY                         29600000
PARAM    EQU   1                                                        30000000
CCWR     EQU   8                                                        30400000
ONEBUFF  EQU   X'FE'                                                    30800000
HUNDRD31 EQU   X'83'                                                    31200000
FOUR     EQU   X'04'                                                    31600000
CCOFF    EQU   X'B0'                                                    32000000
CNTRL   EQU   X'08'                                                     32400000
ZERO     EQU   X'00'                                                    32800000
TWENTY4  EQU   X'18'                                                    33200000
FDSSCMD  EQU   X'23'                   FEED, STACKER SELECT COMAND      33600000
RP       EQU   X'60'                   MASK FOR READ/PUNCH DADS         34000000
RW       EQU   X'50'                   MASK FOR READ/WRITE DADS         34400000
PW       EQU   X'30'                   MASK FOR PUNCH/PRINT DADS        34800000
D20      EQU   20                                                       35200000
D08      EQU   8                                                        35600000
D01      EQU   1                                                        36000000
D03      EQU   3                                                        36400000
D40      EQU   40                                                       36800000
D07      EQU   7                                                        37200000
DEBR     EQU   9                                                YA00439 37280002
PCHBIT   EQU   X'20'                                            YA00439 37360002
RDBIT    EQU   X'40'                                            YA00439 37440002
SEQFLAG  EQU   X'08'                                            YA00439 37520002
*                                                                       37600000
*                                                                       38000000
IGG019FA CSECT                                                          38400000
*                                                                       38800000
         USING IHADCB,DCBR                                              39200000
         USING DEBBASIC,DEBR                                    YA00439 39400002
         USING IGG019FA,BASR                                            39600000
*                                                                       40000000
*                                                                       40400000
*                                                                       40800000
*  THIS ROUTINE SAVE REGISTERS AND CHECKS TO SEE IF THE IOB'S ECB IS    41200000
*  POSTED AS BEING COMPLETE. IF NOT A WAIT IS ISSUED TO IOB'S ECB. WHEN 41600000
*  ECB IS POSTED COMPLETE AND CNTRL ISSUED FOR SPACE ADD THIS VALUE TO  42000000
*  LINE COUNTER BUCKET IN 'DCBLNP'.                                     42400000
*                                                                       42800000
         STM   RETR,DEBR,D20(SAVR)     SAVE USER REGS. 14 - 9  @ZA01573 43200003
         LR    BASR,ENTR               GET BASE ADDRESS                 43600000
         LR    DCBR,PARAM              GET DCB ADDRESS                  44000000
         L     DEBR,DCBDEBAD           GET DEB ADDRESS FOR BASE YA00439 44200002
         L     IOBAR,DCBIOBA           LOAD IOB START ADDRESS           44400000
         OI    ZERO(IOBAR),CNTRL       SET CONTROL FLAG IN IOB PREFIX   44800000
         LR    COUNTR,WRKR             COPY REG 0 TO GET SP AND SK PARM 45200000
         L     IOBAR,ZERO(IOBAR)       LINK TO NEXT IOB                 45600000
         TM    DCBCIND2,QSAM           IS QSAM BEING USED               46000000
         BZ    BSAM                    NO,BRANCH                        46400000
         L     PARAM,TWELVE(IOBAR)     LOAD ECB ADDRESS IN A REGISTER   46800000
         TM    ZERO(PARAM),COMP        IS EVENT COMPLETE                47200000
         BO    COMPLETE                YES, BR TO CK FOR SP AND SK PARM 47600000
         LA    WRKR,D01                LOAD WAIT COUNT                  48000000
         WAIT  (0),ECB=(1)                                              48400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 48800000
*                                                                       49200000
COMPLETE LTR   COUNTR,COUNTR           IS THIS A SKIP OR SPACE OPRATION 49600000
         BM    MINUS                   MINUS IS SKIP. PLUS IS SPACE.    50000000
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             50400000
         BM    SPACE                   YES, BRANCH AROUND               50800000
         BO    SPACE                   YES, BRANCH AROUND               51200000
         CLI   DCBLNP,ZERO             LINE POSITION IS ZERO            51600000
         BNE   SPACE                   NO, BRANCH                       52000000
         B     CONTINUE                YES, DO FD, SS COMMAND           52400000
SPACE    EQU   *                                                        52800000
         SR    LINECTR,LINECTR         ZERO OUT REGISTER                53200000
         IC    LINECTR,DCBLNP          GET LINE COUNT BUCKET FROM DCB   53600000
         AR    LINECTR,COUNTR          INCREMENT LINE COUNTER           54000000
         STC   LINECTR,DCBLNP          RESTORE LINE COUNTER IN DCB      54400000
         B     RETURN                  RETURN TO CALLING PROGRAM        54800000
LEVELID  DC    C'05'                   MODULE LEVEL CONTROL             55200000
*                                                                       55600000
*  THIS ROUTINE SKIP TO WHATEVER CHANNEL SPECIFIED ON CNTRL MACRO BY    56000000
*        1.ISSUING A FD,SS COMMAND IS SKIP TO CHANNEL 1 IS SPECIFIED OR 56400000
*          IF THE CHANNEL SPECIFIED IS LESS THAN THE CHANNEL'S PRESENT  56800000
*          LOCATION. THE 'DCBLNP' IS RESET TO CORRESPONDING LINE        57200000
*          POSITION AND EXCP ISSUED TO FEED ANOTHER CARD                57600000
*                                                                       58000000
*        2.UPDATING 'DCBLNP' IF SPECIFIED CHANNEL IS GREATER THAN THE   58400000
*          PRESENT CHANNEL'S LOCATION.                                  58800000
*                                                                       59200000
MINUS    EQU   *                                                        59600000
         LCR   COUNTR,COUNTR           PUT SKIP NUMBER IN PLUS FORM     60000000
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             60400000
         BM    SKIP                    YES, BRANCH AROUND               60800000
         BO    SKIP                    YES, BRANCH AROUND               61200000
         CLI   DCBLNP,ZERO             LINE POSITION IS ZERO            61600000
         BNE   SKIP                    NO, BRANCH                       62000000
         B     CONTINUE                YES, DO FD, SS COMMAND           62400000
SKIP     EQU   *                                                        62800000
         LA    LINECTR,D01             SET UP TO COMPARE FOR CH-1       63200000
         CR    COUNTR,LINECTR          SKIP TO CHANNEL 1                63600000
         BE    CONTINUE                YES, BRANCH TO ISSUE FD,SS CMD   64000000
         SR    LINECTR,LINECTR         ZERO OUT REGISTER                64400000
         IC    LINECTR,DCBLNP          GET LINE COUNT BUCKET FROM DCB   64800000
         LR    WRKR4,COUNTR            SET UP WORK REG FOR COMPARE      65200000
         SLA   WRKR4,ONE               MULTIPLY BY TWO                  65600000
         BCTR  WRKR4,ZERO              SUBTRACT ONE                     66000000
         CLR   LINECTR,WRKR4           SKIP AMOUNT GE TO MASK           66400000
         BL    VALIDSKP                NO, BR TO CONTINUE       YA00439 66800002
         TM    DCBFUNC,PCHBIT          IS PUNCH BIT ON          YA00439 66840002
         BNO   CKRDBIT                 NO, CHECK FOR READ BIT   YA00439 66880002
         L     DCBR,DEBPDCB            GET PUNCH DCB ADDRESS    YA00439 66920002
SEQCK    EQU   *                                                YA00439 66960002
         TM    DCBQSWS,SEQFLAG         IS SEQUENCE FLAG ON      YA00439 67000002
         BZ    PRNTWTP                 NO, BR TO ERROR MSG.     YA00439 67040002
         L     DCBR,DEBDCBAD           GET CURRENT DCB ADDRESS  YA00439 67080002
VALIDSKP EQU   *                                                YA00439 67120002
         STC   WRKR4,DCBLNP            RESTORE LINE COUNTER IN DCB      67200000
         B     RETURN                  BRANCH, TO RETURN TO CALLER      67600000
CKRDBIT  EQU   *                                                YA00439 67660002
         TM    DCBFUNC,RDBIT           IS READ BIT ON           YA00439 67720002
         BNO   CONTINUE                NO, BR TO ISSUE FDSS CMD YA00439 67780002
         L     DCBR,DEBRDCB            IF SO,GET READ DCB ADDR  YA00439 67840002
         B     SEQCK                   GO CHECK FOR SEQ FLAG    YA00439 67900002
CONTINUE TM    DCBFUNC,RP              READ PUNCH ASSOCIATED DATA SET   68000000
         BO    PRNTWTP                 YES, BRANCH FOR ERROR MESSAGE    68400000
         TM    DCBFUNC,RW              READ PRINT ASSOCIATED DATA SET   68800000
         BO    PRNTWTP                 YES, BRANCH FOR ERROR MESSAGE    69200000
         TM    DCBFUNC,PW              PUNCH PRINT ASSOCIATED DATA SET  69600000
         BO    PRNTWTP                 YES, BRANCH FOR ERROR MESSAGE    70000000
         LA    CCWR,D40(IOBAR)         GET CCW ADDRESS                  70400000
         NI    FOUR(CCWR),CCOFF        TURN OFF CMND CHAIN FLAG         70800000
         ST    CCWR,TWENTY4(IOBAR)     PUT CCW START ADDR IN IOB        71200000
         MVI   ZERO(CCWR),FDSSCMD      MOVE IN A FD,SS CMD              71600000
         MVI   D07(CCWR),ONE           LOAD BYTE COUNT OF ONE           72000000
*                                                                       72400000
*  ON SKIP TO CHANNEL Z 'DCBLNP'=2(Z)-1. E.G IF Z=5 THEN 'DCBLNP'=9     72800000
*  SINCE CHANNEL TO SKIP (Z) IS LESS THAN PRESENT CHANNEL POSITION      73200000
*  ISSUE FEED,STACKER,SELECT CCW AND UPDATE 'DCBLNP' WITH LINE VALUE    73600000
*                                                                       74000000
         SLA   COUNTR,ONE               DCBLNP = 2 TIMES CHANNEL VALUE  74400000
         BCTR  COUNTR,ZERO                       MINUS 1                74800000
*                                                                       75200000
         STC   COUNTR,DCBLNP            UPDATE DCBLNP WITH LINE COUNT   75600000
         LA    PARAM,D08(IOBAR)        PUT IOS IOB ADDRESS IN REG 1     76000000
         EXCP  (1)                     EXECUTE CHANNEL PROGRAM          76400000
         TM    DCBMACRF+ONE,PUTLOC     IS THIS IN PUT LOCATE MODE       76800000
         BZ    WAIT                    NO, BRANCH BECAUSE THIS IS BSAM  77200000
         BM    RETURN                  THIS IS QSAM WITHOUT LOCATE MODE 77600000
         CLI   DCBBUFNO,ONEBUFF        QSAM-LOCATE MODE WITH ONE BUFFER 78000000
         BM    RETURN                  NO, MORE THAN ONE BUFFER         78400000
WAIT     EQU   *                                                        78800000
         LA    PARAM,FOUR(IOBAR)       LOAD ECB ADDR IN REG 1           79200000
         LA    WRKR,D01                LOAD WAIT COUNT                  79600000
         WAIT  (0),ECB=(1)             WAIT                             80000000
RETURN   EQU   *                                                        80400000
         LM    RETR,DEBR,D20(SAVR)     RESTORE USER'S REGS     @ZA01573 80800003
         BR    RETR                    RETURN TO CALLING ROUTINE        81200000
*                                                                       81600000
*                                                                       82000000
BSAM     EQU   *                                                        82400000
*                                                                       82800000
*                                                                       83200000
         LA    PARAM,FOUR(IOBAR)       GET ECB ADDRESS                  83600000
         ST    PARAM,TWELVE(IOBAR)      STORE ECB IN IOB                84000000
         B     COMPLETE                 GO DETERMINE TYPE OF CNTRL      84400000
*                                                                       84800000
*                                                                       85200000
PRNTWTP  EQU   *                                                        85600000
         WTO   'IEC950I 003-3 3525 ASSOCIATED DATA SET I/O SEQUENCE ERR*86000000
               OR',ROUTCDE=(11),DESC=4                                  86400000
         LA    ENTR,D03                INDICATE ASSOCIATED DATA SET     86800000
*                                      PRINT SEQUENCE ERROR CODE TO BE  87200000
*                                      PASSED TO USER VIA REGISTER 15   87600000
         L     PARAM,ABEND3            GET SAM ABEND ERROR CODE         88000000
         SLL   PARAM,12                SET UP REGISTER 1 FOR ABEND      88400000
         ABEND (1),DUMP                                                 88800000
*                                                                       89200000
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     89600000
ABEND3   DC    X'00000003'             ABEND CODE OF 3                  90000000
         DC    12CL4'ZAPS'             MAINTENANCE AREA                 90400000
*              THE FOLLOWING CNOP MUST REMAIN ON A HALF-WORD BOUNDARY   90800000
         CNOP  0,8                                                      91200000
         DCBD  DSORG=PS                                                 91600000
         IEZDEB                                                 XA00349 91800002
         END                                                            92000000
./  ADD  SSI=32430453,NAME=IGG019FK
         TITLE 'IGG019FK-EOB RTN FOR 3525 DATA PROTECTION IMAGE (DPI)'  00300000
         START                                                          00600000
*********************************************************************** 00900000
* AOS1 AND AOS2 ADDITIONS/CHANGES/DELETIONS                      Y01898 01200000
*A717000                                                          M1866 01500000
*                                                                       01800000
*NAME--              IGG019FK                                           02100000
*                                                                       02400000
*TITLE--             'IGG019FK' - EOB RTN FOR 3525 DATA PROTECTION      02700000
*                                                                       03000000
*STATUS CHANGE LEVEL 000                                                03300000
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    03600000
*                    NEW MODULE                                         03900000
*                                                                       04200000
*MODULE TYPE--       END OF BLOCK                                       04500000
*                                                                       04800000
*                                                                       05100000
*FUNCTION/OPERATION--SAM END OF BLOCK ROUTINE FOR 3525 RD/PCH (RPD)     05400000
*                    OR RD/PCH/PRT (RPWD) WITH DATA PROTECTION (DPI)    05700000
*                    AND MACHINE C CHARACTERS, ASCII C CHARACTERS       06000000
*                    OR NO C CHARACTERS SPECIFIED. IT WILL BLANK OUT    06300000
*                    BYTES IN BUFFER AREA THAT CORRESPOND TO BLANK      06600000
*                    BYTES IN DPI IMAGE. SETS UP COMMAND BYTE           06900000
*                    (WR,FD,SS) IN THE CCW. THE BUFFER ADDRESS AND      07200000
*                    RECORD LENGTH ARE PASSED FROM PUT OR WRITE         07500000
*                    ROUTINE IN THE CCW. THE CHANNEL PROGRAM IS         07800000
*                    SCHEDULED WITH AN EXCP MACRO.                      08100000
*                                                                       08400000
*ENTRY POINTS--      IGG019FK FROM PUT OR WRITE ROUTINES.               08700000
*                    LA    2,DCB                                        09000000
*                    LA    3,IOB                                        09300000
*                    L     15,76(DCB)       FOR BSAM                    09600000
*                    (OR)                                               09900000
*                    L     15,92(DCB)       FOR QSAM                    10200000
*                    BALR  14,15                                        10500000
*                                                                       10800000
*INPUT--             IOB+40            BUFFER ADDRESS                   11100000
*                    IOB+46            BLOCK SIZE                       11400000
*                    DCBRECFM          TEST FOR MACHINE C CHAR.         11700000
*                                      TEST FOR ASCII C CHAR.           12000000
*                                                                       12300000
*OUTPUT--            IOB+40            WRITE CCW SET WITH C CHAR,       12600000
*                                      BUFFER ADDRESS AND LENGTH.       12900000
*                    IOB+24            LOADED WITH START ADDRESS        13200000
*                                      OF CHANNEL PROGRAM.              13500000
*                                                                       13800000
*EXTERNAL ROUTINES-- NONE                                               14100000
*                                                                       14400000
*EXITS-NORMAL--      RETURN TO PUT OR WRITE ROUTINE ON REG. 14          14700000
*                                                                       15000000
*EXITS-ERROR--       003 - ABEND-- ASSOCIATED DATA SET I/O SEQUENCE     15300000
*                    ERROR. RETURN CODE OF 2 IN REG. 15                 15600000
*                                                                       15900000
*TABLES/WORKAREA--   NONE                                               16200000
*                                                                       16500000
*ATTRIBUTES--        REENTRANT,REUSABLE.                                16800000
*                                                                       17100000
*********************************************************************** 17400000
WRKR0    EQU   0                                                        17700000
WRKR1    EQU   1                       TABLE INCREMENT AMOUNT (2)       18000000
COUNTER  EQU   1                       COUNTER REGISTER                 18300000
LRECLR   EQU   1                       LENGTH OF RECORD REGISTER        18600000
DCBR     EQU   2                       DCB ADDRESS UPON ENTRY           18900000
IOBR     EQU   3                       IOB ADDRESS UPON ENTRY           19200000
WRKR2    EQU   4                       TABLE END ADDRESS                19500000
DPIR     EQU   4                       ADDRESS OF DPI IMAGE             19800000
WRKR3    EQU   5                       TABLE START ADDRESS              20100000
DEBR     EQU   6                       REG. USED FOR DEB DSECT          20400000
BUFR     EQU   6                       BUFFER ADDRESS                   20700000
OPR      EQU   7                       OP CODE REGISTER                 21000000
RETR     EQU   14                      CALLING ROUTINE RETURN ADDRESS   21300000
BASR     EQU   15                      BASE REGISTER                    21600000
*                                                                       21900000
MCHAR    EQU   X'02'                   MACHINE CONTROL CHARACTER MASK   22200000
ASCII    EQU   X'04'                   ASCII CONTROL CHARACTER MASK     22500000
USED     EQU   X'7F'                   DCB USED INDICATOR               22800000
SEQFLAG  EQU   X'08'                                                    23100000
SEQFLGOF EQU   X'F7'                                                    23400000
SSCLEAR  EQU   X'BF'                                                    23700000
BLANK    EQU   X'40'                                                    24000000
THRE     EQU   X'03'                                                    24300000
EIGHTY   EQU   X'50'                   LENGTH MASK FOR COUNTER DECREMNT 24600000
RPW      EQU   X'70'                                                    24900000
SLI      EQU   X'20'                                                    25200000
SIX      EQU   6                                                        25500000
ONE      EQU   1                                                        25800000
N2       EQU   2                                                        26100000
Z0       EQU   0                                                        26400000
*                                                                       26700000
IGG019FK CSECT                                                          27000000
*                                                                       27300000
*                                                                       27600000
*                                                                       27900000
         USING DEBBASIC,DEBR                                            28200000
         USING IGG019FK,BASR                                            28500000
         USING IHADCB,DCBR                                              28800000
         USING IOB,IOBR                                                 29100000
*                                                                       29400000
* ENTRY POINT                                                           29700000
*                                                                       30000000
         L     DEBR,DCBDEBAD           GET DEB ADDRESS                  30300000
READSEQ  EQU   *                                                        30600000
*                                                                       30900000
*  THIS ROUTINE WILL CHECK THE ASSOCIATIVE DATA SET DCB'S TO INSURE     31200000
*  THAT THEY HAVE BEEN OPENED,AND THAT EACH DCB IS BEING PROCESSED IN   31500000
*  THE CORRECT ORDER                                                    31800000
*                                                                       32100000
         CLC   DEBRDCBA(THRE),ZEROES   IS READ DCB OPEN                 32400000
         BE    WRTOPROG                NO, WRITE ERROR MSG. TO PROGMR.  32700000
         L     DCBR,DEBRDCB            YES, GET READ DCB ADDRESS        33000000
         TM    DCBQSWS,SEQFLAG         IS READ SEQUENCE FLAG ON         33300000
         BZ    WRTOPROG                NO, WRT ERROR MSG TO PROGRAMMER  33600000
         NI    DCBQSWS,SEQFLGOF        YES,TURN OFF READ SEQ. FLAG      33900000
         TM    DCBFUNC,RPW             RD/PCH/PRT ASSOC. D. S.          34200000
         BNO   DPI00                   NO, BRANCH                       34500000
         CLC   DEBWDCBA(THRE),ZEROES   PRINT DCB OPEN                   34800000
         BE    DPI00                   NO BRANCH                        35100000
         L     DCBR,DEBWDCB            GET PRINT DCB ADDR.              35400000
         NI    DCBQSWS,SEQFLGOF        TURN OFF PRINT SEQ. FLAG         35700000
         MVI   DCBLNP,Z0               RESET LINE CTR TO ZERO   YA00439 35800002
*                                                                       36000000
DPI00    EQU   *                                                        36300000
*                                                                       36600000
         L     DCBR,DEBDCBAD           GET CURRENT DCB ADDRESS AGAIN    36900000
         TM    DCBQSWS,SEQFLAG         IS PUNCH SEQUENCE FLAG ON        37200000
         BO    WRTOPROG                YES, ERROR INVOLVED. BRANCH      37500000
         OI    DCBQSWS,SEQFLAG         TURN ON PUNCH SEQ. FLAG          37800000
DPI10    EQU   *                                                        38100000
         LA    COUNTER,EIGHTY          LOAD COUNT OF 80                 38400000
         L     BUFR,CCW1AD             GET BUFFER ADDRESS               38700000
         TM    DCBRECFM,SIX            ASCII OR MACHINE CONTROL CHARS.  39000000
         BZ    DPI30                   NO, BRANCH FOR DPI TRANSLATION   39300000
DPI20    EQU   *                                                        39600000
         LA    BUFR,ONE(BUFR)          INCREMENT ADDRESS BY ONE         39900000
*                                                                       40200000
*  THIS ROUTINE WILL BLANK OUT ALL BYTES IN THE BUFFER THAT DOES NOT    40500000
*  CORRESPOND WITH THE 80 BYTE DPI IMAGE LOADED FROM SYS1.IMAGELIB WHEN 40800000
*  DCB WAS OPENED                                                       41100000
*                                                                       41400000
DPI30    LA    DPIR,IOBDPI             GET DPI IMAGE ADDRESS            41700000
DPI40    CLI   0(DPIR),BLANK           IS DPI BYTE BLANK                42000000
         BNE   DPI50                   NO, BRANCH                       42300000
         MVI   0(BUFR),BLANK           BLANK OUT COINCIDING USER BYTE   42600000
DPI50    EQU   *                                                        42900000
         LA    DPIR,ONE(DPIR)          POINT TO NEXT DPI BYTE           43200000
         LA    BUFR,ONE(BUFR)          POINT TO NEXT USER BUFFER BYTE   43500000
         BCT   COUNTER,DPI40           CK ALL DPI BYTES, THEN CONTINUE  43800000
         TM    DCBRECFM,ASCII          ASCII USED                       44100000
         BZ    DDA2                    NO, GO CK FOR MACHINE CNTL CHAR  44400000
DDB2     EQU   *                                                        44700000
         L     BUFR,CCW1AD             GET BUFFER ADDRESS               45000000
         LA    WRKR3,TABLE             LOAD TABLE START ADDRESS         45300000
         LA    WRKR2,TABLY             TABLE END PLUS TWO               45600000
         LA    WRKR1,N2(Z0)            LOAD TABLE INCREMENT AMT         45900000
DDB3     CLC   Z0(ONE,BUFR),Z0(WRKR3)  COMPARE ASCII CHAR TO TABLE      46200000
         BE    DDB4                    BR IF ASCII CHAR IS FOUND        46500000
         BXLE  WRKR3,WRKR1,DDB3        INCR AND REPEAT IF NOT END       46800000
*                                                                       47100000
*  THIS ROUTINE WILL BUILD CCW'S AND ISSUE EXCP TO EXECUTE CCW'S BUILT  47400000
*                                                                       47700000
*                                                                       48000000
DDB4     EQU   *                                                        48300000
         LA    BUFR,ONE(BUFR)          PT TO FIRST CHAR FOR OUTPUT PROC 48600000
         IC    WRKR2,CCW2OP            STORE COMMAND BYTE OF WRT CCW    48900000
         ST    BUFR,CCW2OP             STORE DATA ADDR IN WRITE CCW     49200000
         STC   WRKR2,CCW2OP            RESTORE WRITE COMMAND            49500000
         LH    LRECLR,CCW1LN           LOAD BLOCK LENGTH                49800000
         BCTR  LRECLR,WRKR0            SUBTRACT ONE FROM BLOCK LENGTH   50100000
         STH   LRECLR,CCW2LN           STORE LENGTH IN WRITE CCW        50400000
         NI    CCW2OP,SSCLEAR          CLEAR STACKER SELECT OPTION      50700000
         OC    CCW2OP(ONE),ONE(WRKR3)  OR IN STACKER SELECT/OPTION      51000000
         LA    WRKR3,CCW2OP            START ADDRESS                    51300000
         ST    WRKR3,IOBSTAD           PUNCH START ADDRESS              51600000
         MVI   CCW2FL,SLI              TURN ON SILI BIT IN 2ND CCW      51900000
LABEL    EQU   *                                                        52200000
         LA    WRKR1,IOBIOS            LOAD IOS IOB ADDR FOR EXCP       52500000
         EXCP  (1)                     SCHEDULE I/O                     52800000
         NI    DCBCIND1,USED           INDICATE DCB HAS BEEN USED       53100000
         BCR   15,RETR                 RETURN TO WRITE/PUT ROUTINE      53400000
DDA2     EQU   *                                                        53700000
         IC    OPR,CCW2AD              SAVE OP CODE                     54000000
         L     BUFR,CCW1AD             LOAD BUFFER ADDR FROM CCW        54300000
         LH    LRECLR,CCW1LN           LOAD RECORD LENGTH               54600000
         TM    DCBRECFM,MCHAR          MACHINE CONTROL CHARACTERS USED  54900000
         BZ    DDA3                    NO, BRANCH                       55200000
         BCTR  LRECLR,Z0               SUBTRACT ONE                     55500000
         IC    OPR,0(BUFR)             INSERT CONTROL CHARACTER         55800000
         LA    BUFR,ONE(BUFR)          ADD ONE TO BUFFER ADDRESS        56100000
DDA3     EQU   *                                                        56400000
         ST    BUFR,CCW2AD             STORE RECORD ADDR IN WRITE CCW   56700000
         STH   LRECLR,CCW2LN           STORE LENGTH IN WRITE CCW        57000000
         STC   OPR,CCW2OP              STORE CMND BYTE IN WRITE CCW     57300000
         LA    LRECLR,CCW2OP           LOAD ADDR OF WRITE CCW           57600000
         ST    LRECLR,IOBSTAD          STORE START ADDRESS FOR IOS      57900000
         MVI   CCW2FL,SLI              TURN ON SILI BIT IN 2ND CCW      58200000
         B     LABEL                   BR TO SCHEDULE I/O               58500000
LEVELID  DC    C'01'                   MODULE LEVEL CONTROL             58800000
WRTOPROG EQU   *                                                        59100000
*                                                                       59400000
*  WRITE TO PROGRAMMER (WTP) AND ABEND ROUTINE                          59700000
*                                                                       60000000
         LR    BUFR,BASR               SAVE BASE ADDR                   60300000
         DROP  BASR                    DROP OLD BASE REG                60600000
         USING IGG019FK,BUFR           SET UP NEW BASE                  60900000
         WTO   'IEC950I 003-2 3525 ASSOCIATED DATA SET I/O SEQUENCE ERR*61200000
               OR',ROUTCDE=(11),DESC=4                                  61500000
         LR    BASR,BUFR               SAVE BASE ADDR.                  61800000
         DROP  BUFR                    DROP OLD BASE REG.               62100000
         USING IGG019FK,BASR           SET UP NEW BASE                  62400000
         B     ABEN                    BRANCH TO ISSUE ABNED            62700000
*                                                                       63000000
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     63300000
ABEND3   DC    X'00000003'             ABEND CODE OF 3                  63600000
ZEROES   DC    X'00000000'             WORK DC                          63900000
TABLE    DC    C'V'                    ASCII C CHAR FOR NEXT OP CODE    64200000
         DC    X'01'                   OP CODE-SELECT PUNCH STACKER 1   64500000
         DC    C'W'                    ASCII C CHAR FOR NEXT OP CODE    64800000
         DC    X'41'                   OP CODE-SELECT PUNCH STACKER 2   65100000
TABLY    EQU   TABLE+2                 POINTER                          65400000
*                                                                       65700000
ABEN     EQU   *                                                        66000000
         LA    BASR,N2                 INDICATE ASSOCIATED DATA         66300000
*                                      SET PUNCH SEQUENCE ERROR         66600000
*                                      CODE TO BE PASSED TO USER        66900000
*                                      VIA REGISTER 15                  67200000
         L     WRKR1,ABEND3            GET SAM ABEND ERROR CODE         67500000
         SLL   WRKR1,12                SET UP REGISTER ONE FOR ABEND    67800000
         ABEND (1),DUMP                ISSUE ABEND INSTRUCTION          68100000
         DC    12CL4'ZAPS'              MAINTENANCE AREA          M1866 68400000
*              THE FOLLOWING CNOP MUST REMAIN ON A HALF-WORD BOUNDARY * 68700000
*                                                                       69000000
         CNOP  0,8                     PAD MODULE TO DOUBLE-WD MULTIPLE 69300000
*                                                                       69600000
*  DSECTS  ************************************************************ 69900000
*                                                                       70200000
IOB      DSECT                                                          70500000
IOBLINK  EQU   IOB                                                      70800000
         DS    2F                      ECB AREA & ADDR OF NEXT IOB      71100000
IOBIOS   DS    1F                      IOBFLAGS AND SENSE INFO          71400000
         DS    3F                      ECB ADDR & CSW INFO              71700000
IOBSTAD  DS    1F                      CHANNEL PROG ADDRESS             72000000
         DS    3F                      DCB ADDR & OTHER INFO            72300000
CCW1OP   DS    1F                      OP CODE                          72600000
CCW1AD   EQU   CCW1OP                  CCW OP CODE                      72900000
CCW1FL   DS    1H                      FLAGS                            73200000
CCW1LN   DS    1H                      LENGTH                           73500000
CCW2OP   DS    1F                      OP CODE                          73800000
CCW2AD   EQU   CCW2OP                  CCW OP CODE                      74100000
CCW2FL   DS    1H                      FLAGS                            74400000
CCW2LN   DS    1H                      LENGTH                           74700000
IOBDPI   DS    CL80                    DPI IMAGE FORMAT                 75000000
         DCBD  DSORG=PS                                                 75300000
         IEZDEB                                                         75600000
         END                                                            75900000
./  ADD  SSI=81670160,NAME=IGG019FQ
         TITLE 'IGG019FQ-EOB ROUTINE FOR ALL 3525 PRINT FILES'          00050037
         START                                                          00100037
*********************************************************************** 00150037
* AOS1 AND AOS2 ADDITIONS/CHANGES/DELETIONS                      Y01898 00200037
*A856000                                                          M1866 00250037
*D324000                                                        YA00439 00300037
*                                                              @ZA06630 00350037
*A033500,033700,036200,080500-080700,081100-081300,            @ZA32137 00370037
*A086500-086600,227600-227800                                  @ZA32137 00380037
*                                                                       00400037
*NAME--              IGG019FQ                                           00450037
*                                                                       00500037
*TITLE--             'IGG019FQ' - EOB ROUTINE FOR ALL 3525 PRINT FILES  00550037
*                                                                       00600037
*STATUS CHANGE LEVEL 000                                                00650037
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    00700037
*                    NEW MODULE                                         00750037
*                                                                       00800037
*MODULE TYPE--       END OF BLOCK                                       00850037
*                                                                       00900037
*FUNCTION/OPERATION--SAM END OF BLOCK ROUTINE FOR ALL 3525 PRINT        00950037
*                    FILES. IT TESTS FOR SEQUENCE FLAGS, IN THE CASE    01000037
*                    OF DEVICE ASSOCIATED DATA SETS, TO VERIFY PROPER   01050037
*                    ISSUANCE OF READ, PUNCH AND PRINT COMMANDS. IT     01100037
*                    INCREMENTS THE LINE POSITION COUNTER (DCBLNP) OR   01150037
*                    RESETS IT WHEN NECESSARY. MODIFIES COMMAND         01200037
*                    BYTE IN WRITE CCW TO INCICATE LINE ON WHICH        01250037
*                    PRINTING SHOULD BE DONE. IT SETS UP COMMAND        01300037
*                    BYTE IN THE CCW.  THE BUFFER ADDRESS AND RECORD    01350037
*                    LENGTH ARE PASSED FROM THE PUT OR WRITE ROUTINE.   01400037
*                    THE CHANNEL PROGRAM IS SCHEDULED WITH AN EXCP      01450037
*                    MACRO.                                             01500037
*                                                                       01550037
*ENTRY POINT--       IGG019FQ FROM WRITE OR PUT ROUTINES:               01600037
*                    LA    2,DCB                                        01650037
*                    LA    3,IOB                                        01700037
*                    L     15,76(DCB)       FOR BSAM                    01750037
*                    L     15,92(DCB)       FOR QSAM                    01800037
*                    BALR  14,15                                        01850037
*                                                                       01900037
*INPUT--             DCB ADDRESS IN REGISTER 1                          01950037
*                             DCBIOBA---IOB ADDRESS                     02000037
*                             DCBLNP----LINE POSITION COUNTER           02050037
*                             DCBDEBAD--DEB ADDRESS                     02100037
*                             DCBRECFM--RECORD FORMAT                   02150037
*                                                                       02200037
*OUTPUT--            IOB                                                02250037
*                    DCBLNP INCREMENTED OR RESET TO INCICATE LINE       02300037
*                             POSITION.                                 02350037
*                                                                       02400037
*EXTERNAL ROUTINES-- IOS SUPERVISOR (EXCP AND WAIT)                     02450037
*                                                                       02500037
*EXITS-NORMAL--      RETURN TO CALLING ROUTINE ON REGISTER 14.          02550037
*                                                                       02600037
*EXITS-ERROR--       003 - ABEND--ASSOCIATED DATA SET I/O SEQUENCE      02650037
*                    ERROR. RETURN CODE OF 3 IN REGISTER 15.            02700037
*                                                                       02750037
*TABLES/WORKAREA--   NONE                                               02800037
*                                                                       02850037
*ATTRIBUTES--        REENTRANT, REUSABLE                                02900037
*                                                                       02950037
*********************************************************************** 03000037
WRKR0    EQU   0                                                        03050037
WRKR1    EQU   1                                                        03100037
DCBR     EQU   2                       DCB ADDRESS UPON ENTRY           03150037
IOBAR    EQU   3                       IOB ADDRESS UPON ENTRY           03200037
BUFR     EQU   4                       BUFFER ADDRESS                   03250037
LENR     EQU   5                       LENGTH OF RECORD                 03300037
R5       EQU   5                       USED IN OIL AND NIL     @ZA32137 03350037
OPR      EQU   6                       COMMAND BYTE                     03360037
R6       EQU   6                       USED IN OIL AND NIL     @ZA32137 03370037
SAVR     EQU   13                                                       03400037
RETR     EQU   14                      CALLING ROUTINE RETURN ADDRESS   03450037
DEBR     EQU   7                       DEB ADDRESS                      03500037
WRKR2    EQU   5                        WORK REGISTER                   03550037
WRKR3    EQU   9                                                        03600037
R9       EQU   9                       USED IN OIL AND NIL     @ZA32137 03620037
RLINE    EQU   10                                                       03650037
BASR     EQU   15                      BASE REGISTER                    03700037
SAVE1    EQU   32                                                       03750037
SAVE9    EQU   64                                                       03800037
SAVE11   EQU   16                                                       03850037
SEQFLAG  EQU   X'08'                                                    03900037
SEQFLGOF EQU   X'F7'                                                    03950037
SEGCODE  EQU   X'02'                   FIRST BYTE OF SEGMENT CODE       04000037
ZERO     EQU   X'00'                                                    04050037
ONE      EQU   1                                                        04100037
USED     EQU   X'7F'                   DCB USED INDICATOR               04150037
IOBCC    EQU   X'40'                                                    04200037
IOBOV    EQU   X'80'                   IOB PRTOV INDICATOR              04250037
CLEAR    EQU   X'00'                   CLEAR BYTE MASK                  04300037
CCOFF    EQU   X'BF'                                                    04350037
SLI      EQU   X'20'                                                    04400037
FOUR     EQU   4                                                        04450037
CNTRL    EQU   X'02'                                                    04500037
COMCH    EQU   X'40'                   CCW COMMAND CHAIN BIT            04550037
RP       EQU   X'60'                                                    04600037
FORMV    EQU   X'40'                   VARIABLE RECORD FORMAT MASK      04650037
FORMU    EQU   X'C0'                   UNDEFINED RECORD FORMAT MASK     04700037
PRTOV    EQU   X'30'                   PRTOV MASK                       04750037
MCHAR    EQU   X'02'                   MACHINE CONTROL CHARACTER MASK   04800037
ASCII    EQU   X'04'                   ASCII CONTROL CHARACTER MASK     04850037
THRE     EQU   X'03'                                                    04900037
PW       EQU   X'30'                   PH/PRT    ASSOC. DATA SET MASK   04950037
RW       EQU   X'50'                                                    05000037
CHN9OF   EQU   X'20'                                                    05050037
CHN12OF  EQU   X'10'                                                    05100037
LINE17   EQU   X'11'                                                    05150037
LINE23   EQU   X'17'                                                    05200037
SPACE1   EQU   X'40'                                                    05250037
SPACE2   EQU   X'F0'                                                    05300037
SPACE3   EQU   X'60'                                                    05350037
SUPPRESS EQU   X'4E'                                                    05400037
SKCHAN1  EQU   X'F1'                                                    05450037
SKCHAN2  EQU   X'F2'                                                    05500037
SKCHAN10 EQU   X'C1'                                                    05550037
SKCHAN9  EQU   X'F9'                                                    05600037
SKCHAN12 EQU   X'C3'                                                    05650037
LNEDLT   EQU   X'07'                   MASK TO DELETE LINE CNT FROM CCW 05700037
TWENTY5  EQU   X'19'                                                    05750037
FDSS     EQU   X'23'                                                    05800037
T        EQU   X'02'                                                    05850037
PRTOV9   EQU   X'20'                   CHANNEL 9 MASK                   05900037
PRTOV12  EQU   X'10'                   CHANNEL 12 MASK                  05950037
LINE1    EQU   X'0D'                   PRINT LINE ONE OP CODE           06000037
OFMASK   EQU   X'CF'                   OVERFLOW MASK                    06050037
LINE18   EQU   18                                                       06100037
LINE24   EQU   24                                                       06150037
Z0       EQU   0                                                        06200037
D2       EQU   2                                                        06250037
A19      EQU   19                                                       06300037
*                                                                       06350037
IGG019FQ CSECT                                                          06400037
*                                                                       06450037
*                                                                       06500037
*                                                                       06550037
         USING IGG019FQ,BASR                                            06600037
         USING DEBBASIC,DEBR                                            06650037
         USING IHADCB,DCBR                                              06700037
         USING IOB,IOBAR                                                06750037
*                                                                       06800037
*        ENTRY POINT                                                    06850037
*                                                                       06900037
         STM   WRKR3,RLINE,SAVE9(SAVR)  SAVE REGS. 9 AND 10             06950037
         L     DEBR,DCBDEBAD           GET DEB ADDRESS                  07000037
PRNT1000 EQU   *                                                        07050037
         TM    DCBFUNC,PW              (RD/)PCH/PRT ASSOC. DATA SET     07100037
         BO    PRNT1100                YES, BR TO CK FOR PRINT SEQ FLAG 07150037
         TM    DCBFUNC,RW              READ/PRINT ASSOC. DATA SET       07200037
         BO    PRNT1400                YES, BR TO CK FOR PRT/RD SEQFLGS 07250037
         B     PRNT1500                BR TO TEST FOR CONTROL CHARACTRS 07300037
LEVELID  DC    C'04'                   MODULE LEVEL CONTROL             07350037
PRNT1100 EQU   *                                                        07400037
         TM    DCBQSWS,SEQFLAG         PRINT SEQUENCE FLAG ON           07450037
         BZ    PRNT1300                NO, BR TO CK FOR PUNCH SEQ. FLAG 07500037
PRNT1200 EQU   *                                                        07550037
         LA    WRKR1,CCW2OP            GET ADDRESS OF PRINT CCW         07600037
         ST    WRKR1,IOBSTAD           STORT PRINT CCW @ IN IOB AS PTR. 07650037
         B     PRNT1500                BR TO CK FOR CONTROL CHARACTERS  07700037
PRNT1300 EQU   *                                                        07750037
         CLC   DEBPDCBA(THRE),ZEROES   PUNCH DCB OPEN YET               07800037
         BE    PRNTWTP                 NO, BRANCH                       07850037
         L     DCBR,DEBPDCB            GET PUNCH DCB ADDRESS            07900037
         TM    DCBQSWS,SEQFLAG         PUNCH SEQUENCE FLAG ON           07950037
         BZ    PRNTWTP                 NO, BR TO WRITE ERROR MESSAGE    08000037
*                                      TRUN SEQUENCE FLAG OFF  @ZA32137 08050037
         NIL   DCBQSWS,SEQFLGOF,REF=DCBQSWS,WREGS=(R5,R6,R9)   @ZA32137 08070037
PRNT1350 L     DCBR,DEBDCBAD           GET CURRENT DCB ADDRESS AGAIN    08090037
*                                      TURN ON PRINT SEQ FLAG  @ZA32137 08110037
         OIL   DCBQSWS,SEQFLAG,REF=DCBQSWS,WREGS=(R5,R6,R9)    @ZA32137 08130037
         B     PRNT1200                BR TO PUT CCW ADDRESS IN IOB     08200037
PRNT1400 EQU   *                                                        08250037
         TM    DCBQSWS,SEQFLAG         PRINT SEQUENCE FLAG ON           08300037
         BO    PRNT1200                YES, BR TO SEE CHAN PROG START@  08350037
         CLC   DEBRDCBA(THRE),ZEROES   READ DCB OPEN YET                08400037
         BE    PRNTWTP                 NO, BRANCH                       08450037
         L     DCBR,DEBRDCB            GET READ DCB ADDRESS             08500037
         TM    DCBQSWS,SEQFLAG         READ SEQUENCE FLAG ON            08550037
         BZ    PRNTWTP                 NO, BR TO WRITE ERROR MESSAGE    08600037
*                                      TURN READ SEQ FLAG OFF  @ZA32137 08650037
         NIL   DCBQSWS,SEQFLGOF,REF=DCBQSWS,WREGS=(R5,R6,R9)   @ZA32137 08660037
         B     PRNT1350                BR TO TURN ON PRINT SEQ. FLAG    08700037
PRNT1500 EQU   *                                                        08750037
         LH    LENR,CCW1LN             LOAD BLOCK LENGTH                08800037
         L     BUFR,CCW1AD             LOAD BUFFER ADDRESS              08850037
         MVC   CCW2AD+ONE(THRE),CCW1AD+ONE MOVE BUF @ TO 2ND CCW        08900037
DDA2     EQU   *                                                        08950037
         TM    DCBRECFM,ASCII          ASCII SPECIFIED                  09000037
         BO    PRNT1550                YES, BRANCH                      09050037
         TM    DCBRECFM,MCHAR          MACHINE CONTROL SPECIFIED        09100037
         BZ    PRNT4000                NO, BRANCH                       09150037
         SR    OPR,OPR                 CLEAR WORK REG          @ZA06630 09200037
         SR    WRKR1,WRKR1             CLEAR WORK REG          @ZA06630 09250037
         IC    OPR,ZERO(BUFR)          OBTAIN MACHINE OP CODE  @ZA06630 09300037
         SRL   OPR,THRE                GET LINE NUMBER         @ZA06630 09350037
         IC    WRKR1,DCBLNP            LOAD LAST LINE PRINTED  @ZA06630 09400037
         CR    OPR,WRKR1               COMPARE CURRENT TO OLD  @ZA06630 09450037
         BH    DDA3                    IF CURRENT GREATER THAN @ZA06630 09500037
*                                      OLD, THEN BRANCH        @ZA06630 09550037
         MVI   DCBLNP,ZERO             ZERO TO FEED NEXT CARD  @ZA06630 09600037
DDA3     EQU   *                                               @ZA06630 09650037
         BCTR  LENR,Z0                 DECREMENT                        09700037
         IC    OPR,ZERO(BUFR)          GET CONTROL CHAR FORM BUFFER     09750037
         LA    BUFR,ONE(BUFR)          INCREMENT BUFFER ADDR BY 1       09800037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             09850037
         BNZ   DDA4                    BRANCH IF ONE OR MIXED           09900037
         CLI   DCBLNP,ZERO             IS LINE POSITION EQUAL TO ZERO   09950037
         BNE   DDA31                   NO, BRANCH                       10000037
         LA    WRKR1,CCW1OP            GET ADDRESS OF FD,SS CCW         10050037
         ST    WRKR1,IOBSTAD           STORE PRINT CCW ADDR IN IOB      10100037
         B     DDA4                    BRANCH TO SET UP CCW             10150037
DDA31    EQU   *                                                        10200037
         LA    WRKR1,CCW2OP            GET ADDRESS OF PRINT CCW         10250037
         ST    WRKR1,IOBSTAD           STORE PRINT CCW @ IN IOB AS PTR  10300037
DDA4     EQU *                                                          10350037
         ST    BUFR,CCW2AD             STORE RECORD ADDRESS IN CCW      10400037
         NI    IOBIOS,CCOFF            TURN OFF CC FLAG IN IOB          10450037
         OI    CCW2FL,SLI              TURN ON SILI FLAG IN CCW         10500037
         STH   LENR,CCW2LN             RESTORE LENGTH                   10550037
         STC   OPR,CCW2OP              STORE CMD BYTE IN WRITE CCW      10600037
         SRL   OPR,3                   SHIFT OUT PRINT OP CODE          10650037
         STC   OPR,DCBLNP              STORE LINE POSITION IN DCB       10700037
         B     PRNT4300                BRANCH                           10750037
PRNT1550 EQU   *                                                        10800037
         L     WRKR2,CCW1OP            GET BUFFER ADDRESS               10850037
         LR    WRKR1,WRKR2             GET BUFFER ADDRESS               10900037
         LA    WRKR1,ONE(WRKR1)        INCREMENT BUFFER ADDRESS         10950037
         IC    OPR,CCW2OP              SAVE PRINT COMMAND BYTE          11000037
         ST    WRKR1,CCW2OP            STORE BUFFER ADDRESS IN CCW      11050037
         STC   OPR,CCW2OP              RESTORE OP CODE IN CCW           11100037
         SR    WRKR1,WRKR1             ZERO OUT WORK REGISTER FOR USAGE 11150037
         IC    WRKR1,DCBLNP            GET LINE COUNTER FROM DCB        11200037
         CLI   ZERO(WRKR2),SPACE1      IS CONTROL CHAR FOR SPACE 1      11250037
         BNE   PRNT1700                NO, BRANCH                       11300037
         LA    WRKR3,ONE               YES, GET COUNT OF ONE            11350037
PRNT1600 EQU   *                                                        11400037
         AR    WRKR1,WRKR3             INCREMENT LINE COUNTER           11450037
         CLI   DCBLNP,ZERO             LINE POSITION EQUAL ZERO         11500037
         BNE   PRNT3000                NO, BRANCH                       11550037
         STC   WRKR1,DCBLNP            UPDATE DCB LINE POSITION         11600037
PRNT1650 TM    DCBFUNC,RP              READ OR PUNCH BIT ON             11650037
         BNZ   PRNT3000                BRANCH ON ONE OR MIXED           11700037
         B    PRNT3200                 BRANCH TO SET UP CCW             11750037
PRNT1700 EQU   *                                                        11800037
         LA    WRKR3,D2                SET UP FOR LINE COUNT INCREMENT  11850037
         CLI   Z0(WRKR2),SPACE2        CONTROL CHARACTER FOR SPACE 2    11900037
         BE    PRNT1600                IF SO, INCREMENT LINE COUNT BY 2 11950037
PRNT1800 EQU   *                                                        12000037
         LA    WRKR3,THRE              SET UP FOR LINE COUNT INCREMENT  12050037
         CLI   Z0(WRKR2),SPACE3        CONTROL CHARACTER FOR SPACE 3    12100037
         BE    PRNT1600                IF SO, INCREMENT LINE COUNT BY 3 12150037
PRNT2000 EQU   *                                                        12200037
         CLI   ZERO(WRKR2),SKCHAN1     CONTROL CHAR FOR SKIP TO CHAN 1  12250037
         BNE   PRNT2100                NO, BRANCH                       12300037
PRNT2050 EQU   *                                                        12350037
         LA    WRKR1,ONE               EQUATE LINE COUNTER TO 1         12400037
         STC   WRKR1,DCBLNP            STORE LINE COUNT IN DCB          12450037
         B     PRNT3100                BRANCH                           12500037
PRNT2100 EQU   *                                                        12550037
         LA    RLINE,THRE              SET UP LINE COUNTER MASK         12600037
         LA    WRKR3,SKCHAN2           LOAD SKIP TO CHAN 2 MASK         12650037
         IC    ONE,ZERO(WRKR2)                                          12700037
PRNT2200 EQU   *                                                        12750037
         CR    WRKR3,ONE                                                12800037
         BH    PRNT2400                NO, MUST BE GREATER THAN CHAN 9  12850037
         BE    PRNT2300                YES, BR TO CK FOR VALIDITY       12900037
         LA    WRKR3,ONE(WRKR3)        INCRE SKIP MASK BY 1             12950037
         LA    RLINE,D2(RLINE)         INCRE LINE COUNTER MASK BY 2     13000037
         B     PRNT2200                BRANCH                           13050037
PRNT2300 EQU   *                                                        13100037
         CLI   ZERO(WRKR2),SKCHAN9     IS CHARACTER INVALID             13150037
         BNH   PRNT2350                NO, BRANCH                       13200037
PRNT2325 EQU   *                                                        13250037
         LA    WRKR3,ONE               YES, DEFAULT VALUE USED          13300037
         B     PRNT1600                BRANCH                           13350037
PRNT2335 EQU   *                                                        13400037
*                                                                       13450037
*                                                                       13500037
         CLI   ZERO(WRKR2),SKCHAN12     CONTROL CHARACTER VALID         13550037
         BH    PRNT2325                 NO INVALID CHAR. GO USE DEFAULT 13600037
PRNT2350 EQU   *                                                        13650037
         LR    WRKR1,RLINE             REFLECT LINE POS. IN LINE CTR.   13700037
         IC    RLINE,DCBLNP            SAVE CURRENT LINE POSITION       13750037
         STC   WRKR1,DCBLNP            STORE LINE COUNTER IN DCB        13800037
         LTR   RLINE,RLINE             LINE COUNTER EQUALS ZERO         13850037
         BZ    PRNT1650                YES, BRANCH                      13900037
         CR    WRKR1,RLINE             CURRENT LINE POS GT SKIP TO VALU 13950037
         BNH   PRNT3100                YES, BRANCH TO TEST FOR ASSOC DS 14000037
         B     PRNT2700                BRANCH                           14050037
PRNT2400 EQU   *                                                        14100037
         LA    RLINE,A19               LINE COUNTER MASK                14150037
         LA    WRKR3,SKCHAN10          LOAD SKIP TO CHAN 10 MASK        14200037
         LA    OPR,THRE                LOAD VALUE OF 3 INTO REG         14250037
         IC    ONE,ZERO(WRKR2)                                          14300037
PRNT2500 EQU   *                                                        14350037
         CR    WRKR3,ONE                                                14400037
         BE    PRNT2335                 YES BRANCH TO CK FOR VALIDITY   14450037
         LA    WRKR3,ONE(WRKR3)        NO, INCREMENT CHAN MASK          14500037
         LA    RLINE,D2(RLINE)         INCREMENT LINE CTR MASK          14550037
         BCT   OPR,PRNT2500             LOOP THREE TIMES                14600037
         B     PRNT2325                 INVALID CHAR. GO USE DEFAULT    14650037
PRNT2700 EQU   *                                                        14700037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             14750037
         BZ    PRNT2750                NO, BRANCH                       14800037
         IC    WRKR1,DCBLNP            GET THE LINE COUNT               14850037
         SLL   WRKR1,3                 SHIFT COUNT FOR CCW INSERTION    14900037
         NI    CCW2OP,LNEDLT           DELETE LINE CNT FROM OP CODE     14950037
         IC    WRKR2,CCW2OP            GET CCW OP CODE                  15000037
         OR    WRKR2,WRKR1             OR LINE COUNT INTO OP CODE       15050037
         STC   WRKR2,CCW2OP            RESTORE OP CODE IN CCW           15100037
         B     PRNT2775                BRANCH TO FINISH CCW             15150037
PRNT2750 EQU   *                                                        15200037
         LA    WRKR1,CCW2OP            GET CCW ADDRESS                  15250037
         ST    WRKR1,IOBSTAD           LOAD CCW ADDR IN IOB             15300037
PRNT2760 EQU   *                                                        15350037
         IC    WRKR1,DCBLNP            GET LINE COUNT FROM DCB          15400037
         SLL   WRKR1,3                 SHIFT COUNT FOR CCW INSERTION    15450037
         NI    CCW2OP,LNEDLT           DELETE LINE CNT FROM OP CODE     15500037
         IC    WRKR2,CCW2OP            GET CCW OP CODE                  15550037
         OR    WRKR2,WRKR1             OR LINE COUNT INTO OP CODE       15600037
         STC   WRKR2,CCW2OP            RESTORE OP CODE IN CCW           15650037
PRNT2775 EQU   *                                                        15700037
         MVC   CCW2OP+FOUR(FOUR),CCW1OP+FOUR  SET UP REST OF WRITE CCW  15750037
         TM    DCBRECFM,ASCII          ASCII SPECIFIED          YA00436 15800037
         BNO   PRNT2780                NO, BRANCH               YA00436 15850037
         LH    LENR,CCW1LN             LOAD BLOCK LENGTH        YA00436 15900037
         BCTR  LENR,Z0                 DECREMENT BYTE CNT BY 1  YA00436 15950037
         STH   LENR,CCW2LN             RESTORE LENGTH IN CCW    YA00436 16000037
PRNT2780 EQU   *                                                YA00436 16050037
         OI    CCW2FL,SLI              TURN ON SILI FLAG IN CCW         16100037
         NI    CCW2FL,CCOFF            TURN OFF CC FLAG IN CCW          16150037
         B     PRNT4300                BRANCH                           16200037
PRNT2800 EQU   *                                                        16250037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 16300037
*                   PRINT OVERFLOW ROUTINE                              16350037
*           IF THE RIGHT OVERFOOW COND.EXIST A FEED SS WILL BE          16400037
*           PREFORMED BEFORE PRINTING ON LINE ONE OF NEXT CARD.         16450037
*                                                                       16500037
         TM    DCBDEVT+ONE,PRTOV9      OVERFLOW ON CH. 9                16550037
         BO    PRNT2810                YES, BRANCH                      16600037
         TM    DCBDEVT+ONE,PRTOV12     OVERFLOW ON CH. 12               16650037
         BNO   PRNT4400                NO, BRANCH TO PRINT A LINE       16700037
         TM    DCBIFLGS,PRTOV12        LINE 24 BEEN PRINTED ON          16750037
         BO    PRNT2820                YES,  BRANCH                     16800037
         B     PRNT4400                NO, BRANCH TO PRINT A LINE       16850037
PRNT2810 EQU   *                                                        16900037
         TM    DCBIFLGS,PRTOV9         LINE 18 BEEN PRINTED ON          16950037
         BNO   PRNT4400                NO, BRANCH TO PRINT A LINE       17000037
PRNT2820 EQU   *                                                        17050037
PRNT2900 EQU   *                                                        17100037
         TM    DCBFUNC,RP              IS THIS AN ASSOC. DATA SET       17150037
         BM    PRNTWTP                 YES, BRANCH                      17200037
         BO    PRNTWTP                 YES, BRANCH                      17250037
         MVI   CCW1OP,FDSS             MOVE IN A FEED STACKER EL. CMD.  17300037
         MVI   CCW1FL,COMCH            SET CMD. CHAIN ON IN CCW         17350037
         MVI   DCBDEVT+ONE,ZERO        RESET DCB PRTOV INDICATOR        17400037
         LA    WRKR1,CCW1OP            GET FIRST CCW ADDRESS            17450037
         ST    WRKR1,IOBSTAD           LOAD CCW START ADDR. IN IOB      17500037
         MVI   DCBLNP,ONE              RESET LINE POSITION CTR. TO ONE  17550037
         MVI   CCW2OP,LINE1            SET LINE IN PRT CCW OP CODE TO 1 17600037
         B     PRNT4400                BRANCH                           17650037
*                                                                       17700037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 17750037
PRNT3000 EQU   *                                                        17800037
         STC   WRKR1,DCBLNP            LOAD LINE CTR INTO DCB           17850037
         CLI   DCBLNP,TWENTY5          IS LINE CTR GREATER THAN 25      17900037
         BNH   PRNT2700                NO, BRANCH                       17950037
         B     PRNT2050                YES, BR TO GET DEFAULT VALUE     18000037
PRNT3100 EQU   *                                                        18050037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             18100037
         BO    PRNTWTP                 BOTH ON, BRANCH FOR ERROR MSG.   18150037
         BM    PRNTWTP                 ONE  ON, BRANCH FOR ERROR MSG.   18200037
         OI    IOBIOS,IOBCC            TURN ON CC FLAG IN IOB           18250037
PRNT3200 EQU   *                                                        18300037
         SLL   WRKR1,3                 SHIFT COUNT FOR CCW INSERTION    18350037
         NI    CCW2OP,LNEDLT           DELETE LINE CNT FROM OP CODE     18400037
         IC    WRKR2,CCW2OP            GET CCW OP CODE                  18450037
         OR    WRKR2,WRKR1             OR LINE COUNT INTO OP CODE       18500037
         STC   WRKR2,CCW2OP            RESTORE OP CODE IN CCW           18550037
         LA    WRKR1,CCW1OP            GET CCW ADDRESS                  18600037
         ST    WRKR1,IOBSTAD           STORE CCW ADDRESS IN IOB AS PTR  18650037
         B     PRNT2775                BRANCH                           18700037
PRNT4000 EQU   *                                                        18750037
         TM    DCBFUNC,T               TWO-LINE PRINT SPECIFIED         18800037
         BO    PRNT4100                YES, BRANCH                      18850037
         CLI   DCBLNP,ZERO             LINE POSITION EQUALS ZERO        18900037
         BE    PRNT4200                YES, BRANCH                      18950037
         TM    DCBMACRF+ONE,CNTRL      CNTRL SPECIFIED IN DCB           19000037
         BO    PRNT2700                YES, BRANCH                      19050037
         CLI   DCBLNP,X'19'            LINE POSITION EQUALS 25          19100037
         BE    PRNT2900                YES, BRANCH                      19150037
PRNT4020 IC    WRKR1,DCBLNP            LOAD DCBLNCT IN REGISTER         19200037
         LA    WRKR1,ONE(WRKR1)        INCREMENT AMOUNT BY ONE          19250037
PRNT4050 STC   WRKR1,DCBLNP            RESTORE AMOUNT IN DCB            19300037
         B     PRNT2700                BRANCH                           19350037
PRNT4100 EQU   *                                                        19400037
         CLI   DCBLNP,ZERO             LINE POSITION EQUALS ZERO        19450037
         BE    PRNT4200                YES, BRANCH                      19500037
         CLI   DCBLNP,ONE              LINE POSITION EQUALS 1           19550037
         BNE   PRNT2900                NO, BRANCH                       19600037
         IC    WRKR1,DCBLNP            YES, LOAD LINE CTR IN WORK REG   19650037
         LA    WRKR1,D2(Z0,WRKR1)      POINT TO LINE THREE              19700037
         B     PRNT4050                BRANCH                           19750037
PRNT4200 EQU   *                                                        19800037
         MVI   DCBLNP,ONE              SET LINE POSITION TO ONE         19850037
         IC    WRKR1,DCBLNP            GET LINE COUNT FROM DCB          19900037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             19950037
         BO    PRNT2700                BOTH ON, BRANCH                  20000037
         BM    PRNT2700                ONE  ON, BRANCH                  20050037
         LA    WRKR1,CCW1OP            POINT TO 1ST CCW                 20100037
         ST    WRKR1,IOBSTAD           STORE PRINT CCW @ IN IOB AS PTR  20150037
         B     PRNT2760                FINISH SETTING UP CCW            20200037
PRNT4300 EQU   *                                                        20250037
         TM    DCBDEVT+ONE,PRTOV       PRINT OVERFLOW ISSUED            20300037
         BM    PRNT2800                YES, BRANCH TO OVERFLOW ROUTINE  20350037
PRNT4400 EQU   *                                                        20400037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20450037
*                                                                       20500037
*        THIS ROUTINE WILL SET UP FLAGS FOR AN OVERFOOW CONDITION.      20550037
*  NOTE- OVERFLOW IS DETECTED AFTER PRINTING THE LINE FOLLOWING THE     20600037
*        LINE CORRESPONDING TO CHANNEL 9 OR 12                          20650037
*                                                                       20700037
         NI    DCBIFLGS,OFMASK         CLEAR OVERFOLW INDICATORS        20750037
         CLI   DCBLNP,LINE23           IS THIS CHANNEL 12 OR GREATER    20800037
         BL    PRNT4405                NO, BRANCH                       20850037
         OI    DCBIFLGS,PRTOV12        SET CHAN. 12 OVERFLOW INDICATOR  20900037
         B     PRNT4410                BRANCH                           20950037
PRNT4405 EQU   *                                                        21000037
         CLI   DCBLNP,LINE17           IS THIS CHANNEL 9 OR GREATER     21050037
         BL    PRNT4410                NO, BRANCH                       21100037
         OI    DCBIFLGS,PRTOV9         SET CHAN. 9 OVERFLOW INDICATOR   21150037
PRNT4410 EQU   *                                                        21200037
         TM    DCBMACRF+ONE,CNTRL      CNTRL SPECIFIED IN DCB           21250037
         BZ    PRNT4415                NO, BRANCH                       21300037
         IC    WRKR1,DCBLNP            GET LINE COUNT FROM DCB          21350037
         LA    WRKR1,ONE(WRKR1)        INCREMENT LINE COUNT BY ONE      21400037
         STC   WRKR1,DCBLNP            RESTORE LINE COUNT IN DCB        21450037
PRNT4415 EQU   *                                                        21500037
*                                                                       21550037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21600037
         LA    WRKR1,IOBIOS                                             21650037
         EXCP  (1)                                                      21700037
         NI    DCBCIND1,USED                                            21750037
*   RESTORE REGS. WHICH WILL NOT BE RESTORED IN THE PUT OR WRITE ROUTS. 21800037
         L     WRKR1,SAVE1(SAVR)        RESTORE REG. 1                  21850037
         LM    WRKR3,RLINE,SAVE9(SAVR)  RESTORE REGS. 9 AND 10          21900037
         BR    RETR                    RETURN TO CALLING ROUTINE        21950037
*                                                                       22000037
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     22050037
ABEND3   DC    X'00000003'             AGEND CODE OF 3                  22100037
ZEROES   DC    X'00000000'             WORK DC                          22150037
PRNTWTP  EQU   *                                                        22200037
         LR    RLINE,BASR              LOAD BASE ADDR INTO REG 10       22250037
         DROP  BASR                    DROP OLD BASE REG                22300037
         USING IGG019FQ,RLINE          SET UP NEW BASE                  22350037
         WTO   'IEC950I 003-3 3525 ASSOCIATED DATA SET I/O SEQUENCE ERR*22400037
               OR',ROUTCDE=(11),DESC=4                                  22450037
         LA    BASR,THRE               INDICATE ASSOCIATED DATA SET     22500037
*                                      PRINT SEQUENCE ERROR CODE TO BE  22550037
*                                      PASSED TO USER VIA REGISTER 15   22600037
         L     WRKR1,ABEND3            GET SAM ABEND ERROR CODE         22650037
         SLL   WRKR1,12                SET UP REGISTER 1 FOR ABEND      22700037
         ABEND (1),DUMP                                                 22750037
MODID    DC    CL8'IGG019FQ'            MODULE ID              @ZA32137 22760037
FLAG     DC    CL8'@ZA32137'            FLAG                   @ZA32137 22770037
DATE     DC    CL8'&SYSDATE'            DATE OF LATEST FLAG    @ZA32137 22780037
         DC    12CL4'ZAPS'              MAINTENANCE AREA          M1866 22800037
*                                                                       22850037
*                                                                       22900037
*                                                                       22950037
*              THE FOLLOWING CNOP MUST REMAIN ON A HALF-WORD BOUNDARY   23000037
*                                                                       23050037
         CNOP  0,8                     PAD MODULE TO DBL. WD. BOUNDARY  23100037
*                                                                       23150037
*        DSECTS                                                         23200037
*                                                                       23250037
*                                                                       23300037
IOB      DSECT                                                          23350037
         DS    2F                      SPACE                            23400037
IOBIOS   DS    1F                      SPACE                            23450037
         DS    3F                      SPACE                            23500037
IOBSTAD  DS    1F                      STAUS                            23550037
         DS    3F                      SPACE                            23600037
CCW1OP   DS    1F                      OP CODE                          23650037
CCW1AD   EQU   CCW1OP                  CCW OP CODE                      23700037
CCW1FL   DS    1H                      FLAGS                            23750037
CCW1LN   DS    1H                      LENGTH                           23800037
CCW2OP   DS    1F                      OP CODE                          23850037
CCW2AD   EQU   CCW2OP                  OP CODE                          23900037
CCW2FL   DS    1H                      FLAGS                            23950037
CCW2LN   DS    1H                      LENGTH                           24000037
         DCBD  DSORG=PS                                                 24050037
         IEZDEB                                                         24100037
         END                                                            24150037
./  ADD  SSI=80120124,NAME=IGG019FU
         TITLE 'IGG019FU-EOB ROUTINE FOR 3525 INTERPRET FILE'           00050000
         START                                                          00100000
*********************************************************************** 00150000
*                                                                       00200000
*NAME--              IGG019FU                                           00250000
*                                                                       00300000
*TITLE--             'IGG019FU' - EOB ROUTINE FOR 3525 INTERPRET FILE   00350000
*                                                                       00400000
*STATUS CHANGE LEVEL 020                                       @YA04230 00450000
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    00500000
*                    NEW MODULE                                         00550000
*                                                                       00600000
*MODULE TYPE--       END OF BLOCK                                       00650000
*                                                                       00700000
*                                                                       00750000
*FUNCTION/OPERATION--SAM END OF BLOCK ROUTINE FOR 3525 INTERPRET        00800000
*                    FILE WITH MACHINE C CHARACTERS, ASCII C CHAR.      00850000
*                    OR NO C CHARACTERS. SETS UP COMMAND BYTE IN        00900000
*                    THE FIRST CCW. FIRST CCW IS A WR,FD,SS. BUFFER     00950000
*                    ADDRESS AND RECORD LENGTH ARE PASSED FROM WRITE    01000000
*                    OR PUT ROUTINE IN THIS CCW. SETS UP COMMAND        01050000
*                    BYTE, BUFFER ADDRESS AND LENGTH IN THE LAST        01100000
*                    TWO CCW'S. THESE TWO ARE PRINT CCW'S. THE CHAN.    01150000
*                    PROG. IS SCHEDULED WITH EXCP MACRO.  IT TESTS      01200000
*                    SEQUENCE FLAGS FOR DEVICE ASSOCIATED DATA SETS     01250000
*                    (DADS) TO VERIFY PROPER ISSUANCE OF READ,          01300000
*                    PUNCH AND PRINT COMMANDS.                          01350000
*                                                                       01400000
*ENTRY POINTS--      IGG019FU FROM PUT OR WRITE ROUTINES.               01450000
*                    LA    2,DCB                                        01500000
*                    LA    3,IOB                                        01550000
*                    L     15,76(DCB)       FOR BSAM                    01600000
*                    L     15,92(DCB)       FOR QSAM                    01650000
*                    BALR  14,15                                        01700000
*                                                                       01750000
*INPUT--             IOB+40            BUFFER ADDRESS                   01800000
*                    IOB+46            BLOCK SIZE                       01850000
*                    DCBRECFM          TEST FOR MACHINE C CHAR.,        01900000
*                                      TEST FOR ASCII C CHAR.           01950000
*                                                                       02000000
*OUTPUT--            IOB+40            WRITE CCW SET WITH C CHAR.,      02050000
*                                      BUFFER ADDR. AND LENGTH          02100000
*                    IOB+48            PRINT CCW SET WITH BUFFER        02150000
*                                      ADDR. AND LENGTH                 02200000
*                    IOB+56            PRINT CCW SET WITH BUFFER        02250000
*                                      ADDR. AND LENGTH.                02300000
*                    IOB+24            LOADED WITH START ADDR OF CHAN   02350000
*                                      PROG.                            02400000
*                                                                       02450000
*EXTERNAL ROUTINES-- NONE                                               02500000
*                                                                       02550000
*EXITS-NORMAL--      RETURN TO PUT OR WRITE ROUTINE ON REG. 14          02600000
*                                                                       02650000
*EXITS-ERROR--       NONE                                               02700000
*                                                                       02750000
*TABLES/WORKAREA--   NONE                                               02800000
*                                                                       02850000
*ATTRIBUTES--        REENTRANT, REUSABLE                                02900000
*********************************************************************** 02950000
WRKR0    EQU   0                       WORK REGISTER                    03000000
WRKR1    EQU   1                       TABLE INCREMENT AMOUNT (2)       03050000
DCBR     EQU   2                       DCB ADDRESS UPON ENTRY           03100000
IOBR     EQU   3                       IOB ADDRESS UPON ENTRY           03150000
LRECLR   EQU   4                       LENTGH OF RECORD                 03200000
WRKR3    EQU   5                       TABLE START ADDRESS              03250000
BUFR     EQU   6                       BUFFER ADDRESS                   03300000
DEBR     EQU   6                       DEB ADDRESS                      03350000
OPR      EQU   7                       OP CODE REGISTER                 03400000
RETR     EQU   14                      CALLING ROUTINE RETURN ADDRESS   03450000
BASR     EQU   15                      BASE REGISTER                    03500000
*                                                                       03550000
*              MASKS                                                    03600000
*                                                                       03650000
FORTY8   EQU   48                                                       03700000
ZERO     EQU   X'00'                                                    03750000
SSCLEAR  EQU   X'BF'                                                    03800000
ONE      EQU   X'01'                                                    03850000
HUNDRD12 EQU   X'70'                                                    03900000
SIXTY3   EQU   63                                                       03950000
SIXTY4   EQU   X'40'                                                    04000000
SIXTY5   EQU   65                                                       04050000
DEC80    EQU   80                                              @ZA11830 04100000
DEC81    EQU   81                                              @ZA11830 04150000
BLANK    EQU   X'40'                                                    04200000
SIXTEEN  EQU   X'10'                                                    04250000
STACK2   EQU   X'02'                   STACKER 2 MASK                   04300000
PRTLN1   EQU   X'0D'                   PRINT LINE 1 OP-CODE             04350000
PRTLN3   EQU   X'1D'                   PRINT LINE 3 OP-CODE             04400000
MCHAR    EQU   X'02'                   MACHINE CONTROL CHAR MASK        04450000
ASCII    EQU   X'04'                   ASCII CONTROL CHAR MASK          04500000
MCRFBSAM EQU   X'20'                    MACRO FORM=BSAM                 04550000
USED     EQU   X'7F'                   DCB USED INDICATOR               04600000
STACKER1 EQU   X'01'                    PUNCH USING STACKER # 1         04650000
STACKER2 EQU   C'W'                     ASCII PUNCH STACKER SELECT 2    04700000
WRFDSS2  EQU   X'41'                    OP CODE STACKER SELECT 2        04750000
CCUSED   EQU   X'06'                   MASK FOR MACH AND ASCII          04800000
WRKR4    EQU   4                                                        04850000
*                                                                       04900000
IGG019FU CSECT                                                          04950000
* C 036000,480000,754000,772000                                @YA04230 05000000
* A 468800-471200,480600-488400,653000-655000,712000-716000,   @YA04230 05050000
* A 749000-751000,754000,800800-803200,408500                  @YA04230 05100000
* D 472000,484000-492000,528000                                @YA04230 05150000
* A 324100,324200,452000-464000 (APPROX)                       @ZA11830 05200000
* C45390000                                                    @ZA15325 05250000
         USING IGG019FU,BASR                                            05300000
         USING IHADCB,DCBR                                              05350000
         USING IOB,IOBR                                                 05400000
         MODID BR=YES                                          @YA04230 05450000
*                                                                       05500000
*              ENTRY POINT                                              05550000
*                                                                       05600000
*  THIS ROUTINE SAVE CCW INFORMATION AND BLANK OUT PRINT BUFFER. IT     05650000
*  THEN MOVE LAST SIXTEEN BYTES FROM OUT AREA TO BYTES 49-64 IN         05700000
*  PRINT BUFFER.                                                        05750000
*                                                                       05800000
*                                                                       05850000
         L     BUFR,CCW1AD             GET BUFFER ADDRESS FROM CCW      05900000
         MVI   CCW2OP,ONE              SET WRITE CMD TO WR,FD,SS        05950000
         IC    OPR,CCW2OP              SAVE WTIRE CMD BYTE              06000000
         LA    LRECLR,DEC81            LOAD CC MAXIMUM VALUE   @ZA11830 06050000
         CH    LRECLR,CCW1LN           IS REAL VALUE LESS THAN @ZA11830 06100000
*                                      OR EQUAL                @ZA11830 06150000
         BL    DEFLT81                 NO. BRANCH AND USE DEFAULT       06200000
*                                                              @ZA11830 06250000
         LH    LRECLR,CCW1LN           USE REAL VALUE          @ZA11830 06300000
DEFLT81  EQU   *                                               @ZA11830 06350000
         TM    DCBRECFM,CCUSED         ARE CONTROL CHARS USED  @ZA11830 06400000
         BNZ   DEFLTOK                 YES. BRANCH. VALUE OK   @ZA11830 06450000
         LA    LRECLR,DEC80            LOAD NO CC MAX VALUE    @ZA15325 06500000
         CH    LRECLR,CCW1LN           IS REAL VALUE LESS THAN @ZA11830 06550000
*                                      OR EQUAL                @ZA11830 06600000
         BL    DEFLT80                 NO. BRANCH AND USE DEFAULT       06650000
*                                                              @ZA11830 06700000
         LH    LRECLR,CCW1LN           USE REAL VALUE          @ZA11830 06750000
DEFLT80  EQU   *                                               @ZA11830 06800000
DEFLTOK  EQU   *                                               @ZA11830 06850000
         MVI   IOBBUFR,BLANK           MOVE IN HEX 40                   06900000
         MVC   IOBBUFR+ONE(SIXTY3),IOBBUFR  BLANK OUT PRT BUFFER        06950000
         LA    WRKR3,SIXTY5            LOAD POSSIBLE BUFF LENG @YA04230 07000000
         CR    LRECLR,WRKR3            IS BUFF LENG LT 65      @YA04230 07050000
         BL    DDB1                    YES. DONT COPY BUFFER   @YA04230 07100000
         SR    LRECLR,WRKR3            NO. GET BUFF LENG - 1   @YA04230 07150000
         TM    DCBRECFM,CCUSED         CONTROL CHARACTERS USED          07200000
         BZ    DDAA3                   NO. COPY BUFFER THEN    @YA04230 07250000
*                                      TEST FOR STACK PARAM    @YA04230 07300000
         LTR   LRECLR,LRECLR           IS BUFF LENG NOW ZERO   @YA04230 07350000
         BZ    DDB1                    YES. DONT COPY BUFFER   @YA04230 07400000
         BCTR  LRECLR,0                SUBTRACT 1 FOR CONTROL  @YA04230 07450000
*                                      CHARACTER.              @YA04230 07500000
         EX    LRECLR,MOVE2            COPY BUFFER DATA        @YA04230 07550000
         LH    LRECLR,CCW1LN           RESTORE BUFFER LENGTH   @YA04230 07600000
DDB1     EQU   *                                                        07650000
         TM    DCBRECFM,ASCII          ASCII CONTROL CHARACTERS USED    07700000
         BZ    DDA2                    NO, BR TO CK FOR MACHINE C CHAR  07750000
*                                                                       07800000
*  WHEN ASCII USED THIS ROUTINE CHECKS FOR VALID CHARACTER. IF INVALID  07850000
*  CHARACTER IS USED, A DEFAULT OF X'01' OP CODE (STACKER SELECT=1) IS  07900000
*  USED. THE CCW IS CONSTRUCTED AND THEN EXECUTED                       07950000
*                                                                       08000000
         CLI   ZERO(BUFR),STACKER2      STACKER SELECT 2 SPECIFIED      08050000
         BNE   DDD1                    NO, GO SET STACKER 1 OP CODE     08100000
         LA    WRKR3,WRFDSS2           SET STACKER 2 OP IN CCW          08150000
         B     DDB2                    BRANCH AROUND NEXT STMT          08200000
DDD1     EQU   *                                                        08250000
         LA    WRKR3,STACKER1           LOAD STACKER SELICK 1 OP CODE   08300000
*                                                                       08350000
DDB2     EQU   *                                                        08400000
*                                                                       08450000
*                                                                       08500000
         LA    BUFR,ONE(BUFR)          INCREMENT BUFFER ADDR BY ONE     08550000
         ST    BUFR,CCW2AD             STORE DATA ADDR IN WRITE CCW     08600000
         STC   WRKR3,CCW2OP            RESTORE WRITE COMMAND            08650000
         BCTR  LRECLR,WRKR0            DECREMENT VALUE BY ONE           08700000
         STH   LRECLR,CCW2LN           STORE LENGTH IN WRITE CCW        08750000
         LA    WRKR3,CCW2OP            START ADDRESS                    08800000
         ST    WRKR3,IOBSTAD           PUNCH START ADDRESS              08850000
         B     LABEL                   BRANCH FOR EXCP                  08900000
LEVELID  DC    C'04'                   MODULE LEVEL CONTROL             08950000
DDA2     EQU   *                                                        09000000
         TM    DCBRECFM,MCHAR          MACHINE CONTROL CHARACTERS USED  09050000
*                                                                       09100000
*  THI ROUTINE DETERMINES IF MACHINE CONTROL CHARACTERS ARE USED.IF SO  09150000
*  THE CONTROL CHARACTER IS INSERTED INTO CCW AND EXECUTED              09200000
*                                                                       09250000
         BNO   DDA3                    NO, BRANCH                       09300000
         LH    LRECLR,CCW1LN           LOAD RECORD LENGTH               09350000
         BCTR  LRECLR,WRKR0            DECREMENT                        09400000
         IC    OPR,0(BUFR)             INSERT CONTROL CHARACTER         09450000
         LA    BUFR,ONE(BUFR)          ADD ONE TO BUFFER ADDRESS        09500000
         B     DDA4                    BRANCH TO SET UP CCW1            09550000
DDAA3    EQU   *                                                        09600000
         EX    LRECLR,MOVE1            COPY BUFFER DATA        @YA04230 09650000
         LH    LRECLR,CCW1LN           RESTORE BUFFER LENGTH   @YA04230 09700000
DDA3     EQU   *                                                        09750000
*                                                                       09800000
*  IF ASCII OR MACHINE CONTROL CHARACTERS ARE NOT SPECIFIED THIS        09850000
*  ROUTINE CHECKS TO SEE IF STACKER 2 SPECIFIED IN DCB IF YES THE OP.   09900000
*  CODE IS STORE IN CCW , IF NO STACKER SELECT TO POCKET 1 IS USED.     09950000
*                                                                       10000000
         TM    DCBSTACK,STACK2         IS STACKER 2 SPECIFIED           10050000
         BNO   DDA4                    NO, BRANCH                       10100000
         LA    OPR,WRFDSS2              LOAD OP-CODE FOR STACKER # 2    10150000
*                                                                       10200000
DDA4     EQU   *                                                        10250000
         ST    BUFR,CCW2AD             STORE RECORD ADDR IN WRITE CCW   10300000
         STH   LRECLR,CCW2LN           STORE LENGTH IN WRITE CCW        10350000
         STC   OPR,CCW2OP              STORE CMD BYTE IN WRITE CCW      10400000
         LA    WRKR3,CCW2OP            GET ADDR OF WRITE CCW   @YA04230 10450000
         ST    WRKR3,IOBSTAD           SAVE START ADDR FOR IOS @YA04230 10500000
LABEL    EQU   *                                                        10550000
*                                                                       10600000
*  THIS ROUTINE BUILD THE TWO PRINT CCW THAT ARE CHAINED TO THE PUNCH   10650000
*  WRITE FEED STACKER (1 OR 2)CCW. IT THEN ISSUE EXCP AND EXIT TO       10700000
*  PUT OR WRITE ROUTINE                                                 10750000
*                                                                       10800000
         ST    BUFR,CCW3AD             LOAD ADDR OF DATA IN PRT CCW     10850000
         MVI   CCW3OP,PRTLN1           MOVE IN PRT LINE 1 CCW OP CODE   10900000
         LA    WRKR3,SIXTY4            LOAD 64 FOR COMPARE     @YA04230 10950000
         CR    LRECLR,WRKR3            IS BUFFFER LENG LT 64   @YA04230 11000000
         BL    DDA5                    YES. USE EXACT LENGTH   @YA04230 11050000
         LR    LRECLR,WRKR3            LOAD BYTE COUNT OF 64   @YA04230 11100000
DDA5     EQU   *                                               @YA04230 11150000
         STH   LRECLR,CCW3LN           STORE BYTE COUNT IN PRT CCW      11200000
         LA    BUFR,IOBBUFR            GET PRINT BUFFER ADDRESS         11250000
         ST    BUFR,CCW4AD             PUT PRINT BUFFER ADDR IN CCW     11300000
         MVI   CCW4OP,PRTLN3           MOVE IN PRINT LINE 3 CCW OP      11350000
         STH   WRKR3,CCW4LN            STORE BYTE COUNT OF 64  @YA04230 11400000
         LA    WRKR1,IOBIOS            LOAD IOS IOB ADDR FOR EXCP       11450000
         EXCP  (1)                     SCHEDULE I/O                     11500000
         NI    DCBCIND1,USED           INDICATE DCB HAS BEEN USED       11550000
         L     DEBR,DCBDEBAD           GET DEB ADDRESS                  11600000
         BCR   15,RETR                 RETURN TO WRITE/PUT ROUTINE      11650000
*                                                                       11700000
*                                                                       11750000
MOVE1    MVC   IOBBUFR+FORTY8(ZERO),SIXTY4(BUFR) LOAD PRT BUFF @YA04230 11800000
MOVE2    MVC   IOBBUFR+FORTY8(ZERO),SIXTY5(BUFR) GET PROPER    @YA04230 11850000
*                                      OFFSET FOR PRT LINE 2   @YA04230 11900000
*                                      IF CONTROL CHARS USED   @YA04230 11950000
*                                                                       12000000
         DC    12CL4'ZAPS'             THIS AREA IS FOR MAINTENANCE     12050000
*                                                                       12100000
*              THE FOLLOWING CNOP MUST REMAIN ON A HALFWORD BOUNDARY    12150000
*                                                                       12200000
         CNOP  0,8                     PAD MODULE TO DOUBLE-WD MULTIPLE 12250000
*                                                                       12300000
*              DSECTS                                                   12350000
*                                                                       12400000
IOB      DSECT                                                          12450000
IOBLINK  EQU   IOB                                                      12500000
         DS    2F                      ECB AREA & ADDR OF NEXT IOB      12550000
IOBIOS   DS    1F                      IOBFLAGS AND SENSE INFO          12600000
         DS    3F                      ECB ADDR & CSW INFO              12650000
IOBSTAD  DS    1F                      CHANNEL PROG ADDRESS             12700000
         DS    3F                      DCB ADDR & MISC INFO             12750000
CCW1OP   DS    1F                      OP CODE                          12800000
CCW1AD   EQU   CCW1OP                  CCW OP CODE                      12850000
CCW1FL   DS    1H                      FLAGS                            12900000
CCW1LN   DS    1H                      LENGTH                           12950000
CCW2OP   DS    1F                      OP CODE                          13000000
CCW2AD   EQU   CCW2OP                  CCW OP CODE                      13050000
CCW2FL   DS    1H                      FLAGS                            13100000
CCW2LN   DS    1H                      LENGTH                           13150000
CCW3OP   DS    1F                      OP CODE                          13200000
CCW3AD   EQU   CCW3OP                  CCW OP CODE                      13250000
CCW3FL   DS    1H                      FLAGS                            13300000
CCW3LN   DS    1H                      LENGTH                           13350000
CCW4OP   DS    1F                      OP CODE                          13400000
CCW4AD   EQU   CCW4OP                  CCW OP CODE                      13450000
CCW4FL   DS    1H                      FLAGS                            13500000
CCW4LN   DS    1H                      LENGTH                           13550000
IOBBUFR  DS    CL64                    BUFFER FOR INTERPRET             13600000
*                                                                       13650000
         DCBD  DSORG=PS                                                 13700000
*                                                                       13750000
*                                                                       13800000
         END                                                            13850000
./  ADD  SSI=80120302,NAME=IGG0197L
         TITLE 'IGG0197L-TRANSLATES OMR OR RCE FORMAT CD--3505/3525'    00050000
         START                                                          00100000
IGG0197L CSECT                                                          00150000
*********************************************************************** 00200000
* AOS1 AND AOS2 ADDITIONS/CHANGES/DELETIONS                      Y01898 00250000
*D208000,C285000,C376500,C377000,C377500-377700                @ZA01942 00300000
*A137000                                                          M1865 00350000
*                                                                       00400000
*NAME--              IGG0197L                                           00450000
*                                                                       00500000
*TITLE--            'IGG0197L' - OMR OR RCE FORMAT CARD TRANSLATOR      00550000
*                                                                       00600000
*STATUS CHANGE LEVEL 000                                                00650000
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    00700000
*                    NEW MODULE                                         00750000
*                                                                       00800000
*MODULE TYPE--       OPEN - STAGE 1                                     00850000
*                                                                       00900000
*FUNCTION/OPERATION--THIS ROUTINE IS ENTERED FOR SAM USERS DURING       00950000
*                    OPEN WHEN:                                         01000000
*                             -OMR OR RCE IS SPECIFIED FOR 3505 CARD    01050000
*                             READER.                                   01100000
*                             RCE IS SPECIFIED FOR A 3525 CARD          01150000
*                             PUNCH'S READ ONLY FILE.                   01200000
*                    IT TRANSLATES THE FORMAT CARD AND ISSUES AN        01250000
*                    OMR OR RCE COMMAND TO THE DEVICE TO PUT IT IN      01300000
*                    THE PROPER (OMR OR RCE) MODE.                      01350000
*                                                                       01400000
*ENTRY POINT--       ENTERED FROM IGG0196B BY USE OF THE XCTL MACRO     01450000
*                                                                       01500000
*INPUT--             SEE DESCRIPTION OF REGISTERS                       01550000
*                                                                       01600000
*OUTPUT--            SEE DESCRIPTION OF REGISTERS                       01650000
*                                                                       01700000
*EXTERNAL ROUTINES-- NONE                                               01750000
*                                                                       01800000
*EXITS NORMAL--      XCTL TO IGG0197M TO CONTINUE PROCESSING            01850000
*                                                                       01900000
*EXITS ERROR--       XCTL TO IGG0197M IF FORMAT CARD IS INVALID OR      01950000
*                    IF OMR HAS BEEN SPECIFIED FOR 3525 CARD PUNCH      02000000
*                                                                       02050000
*TABLES/WORKAREAS--  WHERE-TO-GO TABLE                                  02100000
*                    BYTES  0- 7   NAME                                 02150000
*                    BYTES  8-10   RELATIVE DISK ADDRESS(TTR) OF        02200000
*                                  FIRST RECORD                         02250000
*                    BYTE     11   CONCATENATION NUMBER                 02300000
*                    BYTE     12   ZEROES                               02350000
*                    BYTE     13   ALIAS INDICATOR AND USER DATA        02400000
*                                  FIELD DESCRIPTOR:                    02450000
*                                      -ALIAS INDICATOR-- 1 BIT         02500000
*                                      -NUMBER OF TTRS IN USERS         02550000
*                                      DATA FIELD-- 2 BITS              02600000
*                    BYTES 14-16   TTR OF FIRST TEXT RECORD             02650000
*                    BYTE     17   ZEROES                               02700000
*                    BYTES 18-19   TTR OF NOTE LIST OR SCATTER LIST     02750000
*                    BYTE     20   TRANSLATION TABLE                    02800000
*                    BYTE     21   ZEROES OR NUMBER OF ENTRIES IN       02850000
*                                  THE NOTE LIST                        02900000
*                    BYTES 22-23   ATTRIBUTES                           02950000
*                    BYTES 24-26   TOTAL CONTIGUOUS MAIN STORAGE        03000000
*                                  REQUIRED FOR MODULE                  03050000
*                    BYTES 27-28   LENGTH OF FIRST TEXT RECORD          03100000
*                    BYTE     29   LENGTH OF WTG TABLE(IN DOUBLE        03150000
*                                  WORDS)                               03200000
*                    BYTES 30-31   PATH THROUGH LOADS OF ROUTINES       03250000
*                    BYTES 32-34   IDTTR OF EXECUTOR FOR FIRST DCB      03300000
*                    BYTE     35   ADDRESS OF STORAGE FOR DCB           03350000
*                    BYTES 36-39   TABLE OF IDTTR'S                     03400000
*                    BYTE  32+N(8)--                                    03450000
*                            IDTTR OF EXECUTOR FOR NTH DCB (3 BYTES)    03500000
*                            ADDRESS OF STORAGE FOR DCB    (1 BYTE )    03550000
*                            IDTTR OF LAST ROUTINE LOAD    (3 BYTES)    03600000
*                            NOT USED                      (1 BYTE )    03650000
*                    --------------                                     03700000
*                    WORKAREA-     SEE 'FORCORE DSECT'(IECDSECT)        03750000
*                                  IN THIS LISTING.                     03800000
*                                                                       03850000
*ATTRIBUTES--        REENTRANT AND REUSABLE.                            03900000
*                                                                       03950000
*********************************************************************** 04000000
*********************************************************************** 04050000
*                        REGISTER  CONVENTIONS                          04100000
*********************************************************************** 04150000
*                                                                       04200000
RDCB     EQU   2                       DCB REGISTER                     04250000
RBASE    EQU   3                       BASE REGISTER                    04300000
RCORE    EQU   4                       DCB WORK AREA REGISTER           04350000
RPAR     EQU   5                       TOP OF PARAMETER LIST            04400000
RWTG     EQU   6                       TOP OF WHERE-TO-GO (WTG) TABLE   04450000
RPARC    EQU   7                       CURRENT PARAMETER                04500000
RWTGC    EQU   8                       CURRENT TRANS LOAD               04550000
RTIOT    EQU   9                       USED HERE AS WORK REGISTER       04600000
RUCB     EQU   10                      USED HERE AS WORK REGISTER       04650000
RDEB     EQU   11                      USED HERE AS FORMAT CARD POINTER 04700000
RB       EQU   12                      USED HERE AS WRK/SWITCH REGISTER 04750000
RC       EQU   13                      WORK REGISTER                    04800000
RD       EQU   14                      WORK REGISTER                    04850000
RJ       EQU   15                      WORK REGISTER                    04900000
RE       EQU   0                       WORK REGISTER                    04950000
RF       EQU   1                       WORK REGISTER                    05000000
*********************************************************************** 05050000
*                        DISPLACEMENTS AND MASKS                        05100000
*********************************************************************** 05150000
*                                                                       05200000
RCE      EQU   X'10'                                                    05250000
OMR      EQU   X'20'                                                    05300000
P3525    EQU   X'4C'                                                    05350000
R3505    EQU   X'46'                                                    05400000
FDSS     EQU   X'23'                    FEED SS COMMAND                 05450000
OMRCEFSS EQU   X'2B'                    FEED SS CMD WITH OMR/RCE FLAG   05500000
RDONLY   EQU   X'C2'                                                    05550000
OMRCMD   EQU   X'31'                                                    05600000
RCECMD   EQU   X'11'                                                    05650000
UNRELFLG EQU   X'02'                                                    05700000
SLI      EQU   X'20'                                                    05750000
BYTCNT80 EQU   X'50'                                                    05800000
FIVE     EQU   5                                                        05850000
FOUR     EQU   X'04'                                                    05900000
THRE     EQU   X'03'                                                    05950000
TWO      EQU   X'02'                                                    06000000
ONE      EQU   X'01'                                                    06050000
Z        EQU   X'E9'                                                    06100000
SUCCFLCC EQU   X'7F'                                                    06150000
NINE     EQU   X'09'                                                    06200000
EIGHT    EQU   X'08'                                                    06250000
TWELVE   EQU   X'0C'                                                    06300000
SEVENTY1 EQU   X'47'                                                    06350000
SIXTY8   EQU   X'44'                                                    06400000
BLANK    EQU   X'40'                                                    06450000
LFTPAREN EQU   X'4D'                                                    06500000
RGTPAREN EQU   X'5D'                                                    06550000
COMMA    EQU   X'6B'                                                    06600000
ZERO     EQU   X'00'                                                    06650000
SEVEN    EQU   X'07'                                                    06700000
TEN      EQU   10                                                       06750000
D72      EQU   72                                                       06800000
F9       EQU   X'F9'                                                    06850000
F0       EQU   X'F0'                                                    06900000
D15      EQU   15                                                       06950000
D80      EQU   80                                                       07000000
D71      EQU   71                                                       07050000
SIX      EQU   6                                                        07100000
D14      EQU   14                                                       07150000
*                                                                       07200000
**                                                                      07250000
***                                                                     07300000
**                                                                      07350000
*                                                                       07400000
         BALR  RBASE,RE                LOAD BASE ADDR IN BASE REG       07450000
         USING RCE1000,RBASE                                            07500000
         USING FORCORE,RCORE                                            07550000
         USING IHADCB,RDCB                                              07600000
RCE1000  EQU   *                                                        07650000
         L     RDCB,0(RPARC)           GET DCB ADDRESS                  07700000
         L     RCORE,FOUR(RWTGC)       GET WORK AREA ADDRESS            07750000
         MVC   DSCEXT1+NINE(EIGHT),DXDEBAPP SET UP FOR WORK AREA FIRST  07800000
         MVC   DSCEXT2+SEVEN(EIGHT),DXDEBSCC USAGE. SAVE CONTENTS       07850000
         ST    RPAR,DXDEBAPP           SAVE PARAMETER LIST              07900000
         XC    DXLBL(80),DXLBL          BLANK TRANSLATION AREA    M1865 07950000
*                                                                       08000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08050000
*                                                                     * 08100000
*                                 BUILD IOB AND CCW                   * 08150000
*                                                                     * 08200000
         ST    RDCB,IOBWGHT            PUT DCB ADDR IN WORK IOB         08250000
         TM    DCBMODE,RCE             RCE SPECIFIED FOR THIS DEVICE    08300000
         BO    RCE1100                 YES, BRANCH                      08350000
         TM    DCBMODE,OMR             OMR SPECIFIED FOR THIS DEVICE    08400000
         BNO   RCE4300                 NO, BRANCH TO TRANSFER CONTROL   08450000
         TM    DCBDEVT,P3525           3525 CARD PUNCH DEVICE           08500000
         BO    RCE4500                 YES, BRANCH                      08550000
RCE1100  EQU   *                                                        08600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08650000
*        SET UP SWITCH (RB) TO DETERMINE OPERATION TO BE PERFORMED      08700000
*             SWITCH(RB)                                                08750000
*                  0    FIRST FORMAT CARD JUST READ                     08800000
*                  1    READ ONLY CMD MUST BE ISSUED NOW                08850000
*                  2    TRANSLATION OF FORMAT CARD(S) COMPLETE          08900000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08950000
         SR    RB,RB                   SET FIRST FORMAT CD SWITCH TO 0  09000000
RCE1200  EQU   *                                                        09050000
         MVI   DXCCW1,RDONLY           SET READ ONLY CMD IN CCW         09100000
RCE1250  EQU   *                                                        09150000
         LA    RF,DXCCW2               GET DATA ADDRESS FOR CCW         09200000
RCE1300  EQU   *                                                        09250000
         ST    RF,DXDEBUCB             PREPARE DATA ADR FOR CCW STORAGE 09300000
         MVC   DXCCW1+ONE(THRE),DXDEBUCB+ONE  PUT DATA ADDR IN CCW      09350000
         MVI   DXCCW1+FOUR,SLI         TURN ON SLI BIT IN CCW           09400000
         MVI   DXCCW1+SEVEN,BYTCNT80   SET BYTE COUNT TO 80 IN CCW      09450000
*                                                                     * 09500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 09550000
         LA    RF,IOBFLAG1             GET IOB ADDRESS                  09600000
         EXCP  (1)                     EXECUTE CHANNEL PROGRAM          09650000
         LA    RF,DXECB                GET ECB ADDRESS FOR WAIT         09700000
         WAIT  ECB=(1)                                                  09750000
         TM    DXECB,SUCCFLCC          SUCCESSFUL COMPLETION (X'7F')    09800000
         BNO   RCE4500                 NO, BRANCH                       09850000
         XC    DXECB(FOUR),DXECB       ZERO OUT ECB AREA                09900000
         LA    RF,TWO                  SET MASK FOR TEST                09950000
         CLR   RB,RF                   IS TRANSLATION COMPLETE          10000000
         BE    RCE4300                 YES, BRANCH TO TRANSFER CONTROL  10050000
         TM    DXCCW1,FDSS             FEED, SS CMD                     10100000
         BO    RCE1200                 YES, GO BACK AN DO A RD ONLY CMD 10150000
         TM    DXCCW1,RDONLY           IS THIS A READ ONLY COMMAND      10200000
         BO    RCE1400                 YES,BRANCH                       10250000
         LA    RB,TWO                  SET TRANSLATION COMPLETE SWITCH  10300000
         MVI   DXCCW1,OMRCEFSS          SET TRANSLATION COMPLETE FLAG   10350000
         B     RCE1250                 BRANCH                           10400000
RCE1400  EQU   *                                                        10450000
         LTR   RB,RB                   SWITCH EQUALS ZERO               10500000
         BC    7,RCE3100               NO, BRANCH                       10550000
RCE1500  EQU   *                                                        10600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10650000
*        CHECK FIRST NINE COLUMNS OF FIRST FORMAT CARD FOR VALIDITY     10700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10750000
         CLC   DXCCW2(NINE),MYFRMT     ARE FIRST 9 COL. OF FORMAT VALID 10800000
         BNE   RCE4500                 NO, BRANCH                       10850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10900000
*        'COLUMN NUMBER' COUNTER (RC) SPECIFIES THE COLUMN THAT IS      10950000
*        CURRENTLY BEING DIAGNOSED ON THE USER'S FORMAT CARD.           11000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11050000
         LA    RC,TEN                  COLUMN NUMBER COUNTER            11100000
         LA    RDEB,DXCCW2+NINE        POINT TO FIRST DIGIT OF OPERAND  11150000
         SR    RD,RD                   ZERO OUT WORK REGISTER           11200000
RCE1600  EQU   *                                                        11250000
         L     RPAR,F000               SET UP FOR FIRST FORMAT COL. NO. 11300000
         LR    RJ,RPAR                 SET UP FOR NEXT FORMAT COL. NO.  11350000
RCE1650  EQU   *                                                        11400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11450000
*        IF THE 'COLUMN NUMBER' COUNTER IS POINTING AT COLUMN72 AND     11500000
*        A CONTINUATION MARK IS IN COLUMN 72, THEN SAVE LAST 3 CHARS    11550000
*        OF CARD FOR HELP IN DIAGNOSING THE NEXT CARD.                  11600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11650000
         LA    RUCB,D72                LOAD NUMBER FOR COMPARE          11700000
         CLR   RC,RUCB                 IS COLUMN 72 BEING POINTED TO    11750000
         BL    RCE1700                 NO, BRANCH TO TRANSLATE COLUMN   11800000
         CLI   DXCCW2+SEVENTY1,BLANK   CONTINUATION MARK IN COL. 72     11850000
         BE    RCE1700                 NO, BRANCH TO TRANSLATE NEXT COL 11900000
         MVC   JFCBXPDT(THRE),DXCCW2+SIXTY8  SAVE LAST 3 BYTES OF CARD  11950000
RCE1680  EQU   *                                                        12000000
         LA    RB,ONE                  SET SWITCH TO ONE                12050000
         MVI   DXCCW1,FDSS             SET FD,SS CMD IN CCW             12100000
         ST    RJ,DXDEBEHH             SAVE LAST NUMBER OF OPERAND      12150000
         B     RCE1250                 BRANCH                           12200000
RCE1700  EQU   *                                                        12250000
         SR    RUCB,RUCB               ZERO OUT WORK REGISTER           12300000
         IC    RUCB,0(RDEB)            GET CHAR POINTED TO ON FORMAT CD 12350000
RCE1800  EQU   *                                                        12400000
         LA    RE,F9                   LOAD MASK TO CK FOR VALID CHAR   12450000
         CLR   RUCB,RE                 IS CHAR GREATER THAN A NUMBER    12500000
         BH    RCE4500                 YES, BRANCH                      12550000
         LR    RTIOT,RDEB              GET FORMAT POINTER               12600000
         LA    RE,TWO                  GET A VALUE OF 2                 12650000
         SR    RTIOT,RE                POINT BACK 2 COL. ON FORMAT CD   12700000
MOVE     MVC   DXDEBECC(FOUR),ZERO(RTIOT)  GET 4 CHAR OF FORMAT FOR TST 12750000
         LA    RF,F0                   GET MASK TO CK FOR SPECIAL CHAR  12800000
         CLR   RUCB,RF                 IS THIS CHAR A NUMBER            12850000
         BL    RCE2600                 NO, BR.--MUST BE SPECIAL CHAR    12900000
RCE1900  EQU   *                                                        12950000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13000000
*        CONTINUE INTERROGATION OF OPERAND AND SAVE FIRST NUMBER        13050000
*        OF OPERAND IN REG. 5 (RPAR) AND LAST NUMBER IN REG.15 (RJ)     13100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13150000
         CLI   DXDEBECC+ONE,LFTPAREN   IS LEFT PAREN IN THIS FORMAT COL 13200000
         BNE   RCE2200                 NO, BRANCH                       13250000
         CLI   DXDEBECC+THRE,COMMA     COMMA IN THIS FORMAT COLUMN      13300000
         BNE   RCE2100                 NO, BRANCH                       13350000
RCE2000  EQU   *                                                        13400000
         IC    RPAR,ZERO(RDEB)         SAVE CHAR BEING POINTED TO       13450000
         LA    RDEB,TWO(RDEB)          INCRE FORMAT SEARCH ADDR. BY 2   13500000
         LA    RC,TWO(RC)              INCRE 'COLUMN NO.' COUNTER BY 2  13550000
         B     RCE1650                 BRANCH TO CHECK NEXT COLUMN      13600000
RCE2100  EQU   *                                                        13650000
         SR    RPAR,RPAR               ZERO OUT REGISTER                13700000
         IC    RPAR,ZERO(RDEB)         SAVE CHAR BEING POINTED TO       13750000
         SLA   RPAR,8                  PREPARE FOR SECOND DIGIT OF NO.  13800000
RCE2150  EQU   *                                                        13850000
         LA    RDEB,ONE(RDEB)          INCRE FORMAT SEARCH ADDR. BY 1   13900000
         LA    RC,ONE(RC)              INCRE 'COLUMN NO.' COUNTER BY 1  13950000
         B     RCE1650                 BRANCH TO CHECK NEXT COLUMN      14000000
RCE2200  EQU   *                                                        14050000
         CLI   DXDEBECC,LFTPAREN       LEFT PAREN IN THIS FORMAT COLUMN 14100000
         BE    RCE2000                 YES, BRANCH                      14150000
         CLI   DXDEBECC+ONE,COMMA      COMMA IN THIS FORMAT COLUMN      14200000
         BNE   RCE4450                  NO BRANCH                       14250000
         CLI   DXDEBECC+THRE,RGTPAREN  RGT. PAREN IN THIS FORMAT COLUMN 14300000
         BNE   RCE2400                 NO, BRANCH                       14350000
RCE2300  EQU   *                                                        14400000
         IC    RJ,ZERO(RDEB)           GET NUMBER BEING POINTED TO      14450000
         LA    RDEB,TWO(RDEB)          INCRE FORMAT CARD POINTER BY 2   14500000
         LA    RC,TWO(RC)              INCRE 'COLUMN NO.' COUNTER BY 2  14550000
         CLI   ZERO(RDEB),BLANK        IS FORMAT COMPLETED YET          14600000
         BE    RCE3350                  YES GO CK COLUMN 72             14650000
RCE2350  EQU   *                                                        14700000
         CLI   ZERO(RDEB),COMMA        IS THERE STILL ANOTHER OPERAND   14750000
         BNE   RCE2375                 NO, BRANCH                       14800000
         CLI   ONE(RDEB),BLANK         IS NEXT COLUMN BLANK             14850000
         BNE   RCE3400                 NO, BRANCH                       14900000
RCE2375  EQU   *                                                        14950000
         CLI   DXCCW2+SEVENTY1,BLANK   IS COLUMN 72 BLANK               15000000
         BE    RCE4500                 YES, BRANCH                      15050000
         B     RCE3400                 BRANCH TO PROCESS THIS OPERAND   15100000
RCE2400  EQU   *                                                        15150000
         SR    RJ,RJ                   ZERO OUT REG. 15                 15200000
         IC    RJ,ZERO(RDEB)           GET NUMBER BEING POINTED TO      15250000
         SLA   RJ,8                    PREPARE FOR SECOND DIGIT OF NO.  15300000
         B     RCE2150                 BRANCH TO GET SECOND DIGIT       15350000
RCE2600  EQU   *                                                        15400000
         CLI   DXDEBECC+TWO,COMMA      COMMA IN THIS COLUMN             15450000
         BE    RCE2800                  YES BRANCH                      15500000
         CLI   DXDEBECC+TWO,RGTPAREN   RIGHT PAREN IN THIS COLUMN       15550000
         BNE   RCE2950                  NO BRANCH                       15600000
         CLI   DXDEBECC+THRE,BLANK     END OF FORMAT CARD               15650000
         BE    SETEXCP                 YES GO SET UP OMR/RCE CCW        15700000
         B     RCE2150                 BRANCH                           15750000
*                                                                       15800000
RCE2800  EQU   *                                                        15850000
*                                                                       15900000
*                                                                       15950000
         CLI   DXDEBECC+ONE,RGTPAREN    RIGHT PAREN IN THIS COLUMN      16000000
         BE    RCE2150                  GO INCREMENT COUNTERS BY ONE    16050000
RCE2900  EQU   *                                                        16100000
         CLI   DXDEBECC+ONE,LFTPAREN   LEFT PAREN IN THIS COLUMN        16150000
         BE    RCE4500                 YES, BRANCH                      16200000
         B     RCE2150                 NO, BRANCH                       16250000
RCE2950  EQU   *                                                        16300000
*                                                                       16350000
*                                                                       16400000
         CLI   ZERO(RDEB),LFTPAREN      LEFT PAREN IN THIS COLUMN       16450000
         BE    RCE2150                  YES BRANCH                      16500000
         CLI   ZERO(RDEB),BLANK         BLANK IN THIS COLUMN            16550000
         BNE   RCE4500                  NO GO SET UP TO ABEND           16600000
RCE3000  EQU   *                                                        16650000
         CLI   DXCCW2+SEVENTY1,BLANK   COLUMN 72 BLANK                  16700000
         BE    SETEXCP                 YES, GO TO SET UP OMR/RCE CCW    16750000
         LA    RUCB,THRE               LOAD VALUE OF 3 IN WORK REGISTER 16800000
         SR    RDEB,RUCB               PT. BACK 3 COL. ON FORMAT CARD   16850000
         MVC   JFCBXPDT(THRE),ZERO(RDEB)  SAVE LAST 3 CHAR OF THIS CD.  16900000
         B     RCE1680                 BRANCH                           16950000
RCE3100  EQU   *                                                        17000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 17050000
*        TEST FIRST 15 COLUMNS OF CONTINUATION CARDS.  IF OTHER THAN    17100000
*        BLANK(X'40'), THE FORMAT IS INVALID.  IF COLUMNS ARE BLANK     17150000
*        THEN MOVE INTO COLUMNS 13,14 AND 15 OF THIS FORMAT CARD        17200000
*        THE 3 CHARS. SAVED FROM PREVIOUS CARD.                         17250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 17300000
         LA    RC,ONE                  SET REGISTER TO ONE              17350000
         LA    RDEB,DXCCW2                                              17400000
         LA    RUCB,D15                SET UP TO TEST 1ST 15 COL. OF CD 17450000
RCE3200  EQU   *                                                        17500000
         CLI   ZERO(RDEB),BLANK        IS THIS COL. OF FORMAT CD BLANK  17550000
         BNE   RCE4500                 NO, BRANCH                       17600000
         CLR   RC,RUCB                 POINTING AT COL. 15 YET          17650000
         BL    RCE3300                 NO, BRANCH                       17700000
         MVC   DXCCW2+TWELVE(THRE),JFCBXPDT  PUT SAVED CHARS. IN 13-15  17750000
         L     RJ,DXDEBEHH             RELOAD LAST NUMBER               17800000
         B     RCE2150                 BRANCH                           17850000
RCE3300  EQU   *                                                        17900000
         LA    RDEB,ONE(RDEB)          INCRE FORMAT POINTER BY 1        17950000
         LA    RC,ONE(RC)              INCREMENT COUNTER BY ONE         18000000
         B     RCE3200                 BR TO CHECK FOR BLANK COLUMN     18050000
RCE3350  EQU   *                                                        18100000
*                                                                       18150000
*                                                                       18200000
         CLI   DXCCW2+SEVENTY1,BLANK    IS COLUMN 72 BLANK              18250000
         BE    RCE3400                  IF SO GO CONVERT IT TO BINARY   18300000
         LA    RUCB,D72                SET UP TO TEST FOR COLUMN 72     18350000
         CLR   RC,RUCB                  IS THIS COLUMN 72 OR LOWER      18400000
         BNH   RCE4500                  IN NOT GO SET UP TO ABEND       18450000
RCE3400  EQU   *                       IS NO. SAVED FROM LAST OPERAND   18500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18550000
*        TEST LAST NO. OF PREVIOUS OPERAND AGAINST FIRST NO. OF         18600000
*        CURRENT OPERAND.  IF LAST NO. IS LESS THAN FIRST NO., THE      18650000
*        FORMAT IS INVALID.                                             18700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18750000
         CLR   RD,RPAR                 IS PRIVIOUS LAST NUMBER          18800000
*                                      < CURRENT FIRST NUMBER           18850000
         BNL   RCE4500                 IF NO THEN BRANCH                18900000
         CLR   RPAR,RJ                 IS CURRENT FIRST NUMBER @ZA01942 18950000
*                                      <= CUREENT LAST NUMBER  @ZA01942 19000000
         BH    RCE4500                 IF NO THEN BRANCH TO    @ZA01942 19050000
*                                      ABEND                   @ZA01942 19100000
         STH   RPAR,DXDEBSHH           GET FIRST NUMBER OF OPERAND      19150000
EXPACK   PACK  DXCCW12(EIGHT),DXDEBSHH(TWO) PACK THE NUMBER             19200000
         CVB   RPAR,DXCCW12            PUT NO. IN ARITHMETIC FORM       19250000
         ST    RJ,DXDEBEHH             GET LAST NUMBER  OF OPERAND      19300000
         PACK  DXCCW12(EIGHT),DXDEBEHH(FOUR)     PACK THE NUMBER        19350000
         CVB   RJ,DXCCW12              PUT NO. IN ARITHMETIC FORM       19400000
         LTR   RD,RD                   IS THIS THE FIRST FORMAT OPERAND 19450000
         BZ    EEEE                    YES, BRANCH                      19500000
         STH   RD,DXDEBSHH             GET NO. SAVED FROM LAST OPERAND  19550000
         EX    RE,EXPACK               GO TO PACK THE NUMBER            19600000
         CVB   RD,DXCCW12              PUT NO. IN ARITHMETIC FORM       19650000
EEEE     EQU   *                                                        19700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19750000
*        IF NUMBER IS GREATER THAN 80 OR EQUAL TO 0, THEN THE FORMAT    19800000
*        IS INVALID.                                                    19850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19900000
         LA    RTIOT,D80               SET WORK REG TO 80               19950000
         CLR   RPAR,RTIOT              IS FIRST NO. MORE THAN 80        20000000
         BH    RCE4500                 YES, BRANCH                      20050000
         CLR   RJ,RTIOT                IS LAST FIELD OF OPERAND > 80    20100000
         BH    RCE4500                 YES, BRANCH                      20150000
         LTR   RPAR,RPAR               IS FIRST NO. = 0                 20200000
         BZ    RCE4500                 YES, BRANCH                      20250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20300000
*        FOR VALID USE OF OMR, THE DIFFERENCE BETWEEN THE LAST NO.      20350000
*        OF THE PREVIOUS OPERAND AND FIRST NO. OF CURRENT OPERAND       20400000
*        MUST EQUAL TO 2 OR MORE.                                       20450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20500000
         TM    DCBMODE,OMR             OMR SPECIFIED                    20550000
         BNO   RCE3600                 NO, BRANCH                       20600000
         LTR   RD,RD                   IS THIS THE 1ST COMPLETE OPERAND 20650000
         BC    8,RCE3500               YES, BRANCH                      20700000
         LA    RD,TWO(RD)              INCREMENT SAVED NUMBER BY 2      20750000
         SR    RD,RPAR                 SUB. 1ST NO. OF CURR OPERAND TO  20800000
         LTR   RD,RD                   VALID SPACE PROVIDED FOR OMR USE 20850000
         BP    RCE4500                 NO, BRANCH                       20900000
RCE3500  EQU   *                                                        20950000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21000000
*        IF THE  TWO NUMBERS OF THIS OPERAND ARE NOT BOTH EVEN OR       21050000
*        BOTH ODD, THEN THE FORMAT IS INVALID FOR OMR.                  21100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21150000
         STH   RC,DXDEBSCC                                              21200000
         SR    RB,RB                                                    21250000
         LR    RC,RPAR                 LOAD FIRST NO. OF OPERAND IN R13 21300000
         LA    RUCB,TWO                SET DIVISOR TO TWO               21350000
         DR    RB,RUCB                 DIVIDE FIRST NO. TO GET REMAINDR 21400000
         LR    RTIOT,RB                SAVE REMAINDER FOR NEXT TEST     21450000
         SR    RB,RB                                                    21500000
         LR    RC,RJ                   PUT LAST NO. OF OPERAND IN REG13 21550000
         DR    RB,RUCB                 DIVIDE LAST NO. TO GET REMAINDER 21600000
         CLR   RB,RTIOT                ARE BOTH NO. EITHER EVEN OR ODD  21650000
         BNE   RCE4500                 NO, BRANCH                       21700000
         SR    RC,RC                                                    21750000
         LH    RC,DXDEBSCC                                              21800000
RCE3600  EQU   *                                                        21850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21900000
*        BUILD FORMAT TRANSLATION FOR THE DEVICE AS FOLLOWS:  PLACE     21950000
*        CHARACTER IN EACH OMR OR RCE COLUMN AS SPECIFIED VIA THE       22000000
*        USER'S FORMAT CARD(S).                                         22050000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 22100000
         LA    RB,DXLBL                GET @ OF AREA USED FOR TRANSLATN 22150000
         LA    RUCB,ONE                SET WORK REG TO 1                22200000
         SR    RB,RUCB                                                  22250000
         AR    RB,RPAR                 POINT TO COL. SPEC. ON FORMAT CD 22300000
         TM    DCBMODE,OMR             OMR SPECIFIED                    22350000
         BNO   RCE3700                 NO, RCE ASSUMED, BRANCH          22400000
         LA    RUCB,TWO                SET WORK REG TO 2                22450000
RCE3700  EQU   *                                                        22500000
         MVI   ZERO(RB),Z              PUT CHAR IN COL. TO BE RD IN OMR 22550000
         CLR   RPAR,RJ                 HAVE CHAR BEEN PLACED IN ALL COL 22600000
         BE    RCE3900                 YES, BRANCH                      22650000
         AR    RPAR,RUCB               POINT TO NEXT FORMAT COLUMN      22700000
         AR    RB,RUCB                 INCREMENT FORMAT AREA ADDRESS    22750000
         B     RCE3700                 BR TO PLACE CHAR IN THIS COLUMN  22800000
RCE3900  EQU   *                                                        22850000
         L     RD,DXDEBEHH             SAVE LAST NO. IN THIS OPERAND    22900000
         LA    RUCB,D80                SET UP TO TEST FOR FORMAT CD IND 22950000
         CLR   RJ,RUCB                 LAST NUMBER = 80                 23000000
         BNE   RCE1600                 NO, BRANCH                       23050000
         CLI   ZERO(RDEB),BLANK        IS NEXT COL OF FORMAT CARD BLANK 23100000
         BNE   RCE4500                 NO, BRANCH                       23150000
         CLI   DXCCW2+SEVENTY1,BLANK   YES, THEN IS CONTINUATION SPEC   23200000
         BNE   RCE4500                  YES BRANCH TO ABEND             23250000
SETEXCP  EQU   *                                                        23300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 23350000
*        LOAD PROPER OP CODE (X'11' FOR RCE OR X'31' FOR OMR) AND       23400000
*        DATA ADDRESS INTO CCW.                                         23450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 23500000
*                                                                       23550000
         MVI   DXCCW1,OMRCMD            SET OMR COMMAND IN CCW          23600000
         TM    DCBMODE,OMR             OMR SPECIFIED                    23650000
         BO    RCE4200                  BRANCH TO PUT DATA ADDR. IN CCW 23700000
         MVI   DXCCW1,RCECMD           SET RCE CMD IN CCW               23750000
RCE4200  EQU   *                                                        23800000
         LA    RF,DXLBL                GET DATA ADDRESS                 23850000
         B     RCE1300                 BR TO CONTINUE CONSTRUCTION CCW  23900000
RCE4300  EQU   *                                                        23950000
         SR    RB,RB                    SET ENTRY FOR BUFFER CHECKING   24000000
         B     RCE4600                  GO LOAD ID OF IGG0197M          24050000
RCE4450  EQU   *                                                        24100000
*                                                                       24150000
*                                                                       24200000
         CLI   DXDEBECC,COMMA           COMMA IN THIS COLUMN            24250000
         BNE   RCE4500                  IF NOT GO SET UP TO ABEND       24300000
         CLI   DXDEBECC+THRE,RGTPAREN   RIGHT PAREN IN THIS COLUMN      24350000
         BE    RCE2300                  YES GO INCREMENT COUNTERS       24400000
         LA    RUCB,D71                SET UP TO CHECK FOR COLUMN 71    24450000
         CLR   RC,RUCB                  IS THIS COLUMN 71               24500000
         BE    RCE2300                  IF SO GO INCREMENT COUNTERS     24550000
RCE4500  EQU   *                                                        24600000
         LA    RB,FIVE                 LOAD REG. WITH ERROR PARAMETER   24650000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 24700000
*        GET IDTTRL OF NEXT EXECUTOR FROM WTG TABLE.                    24750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 24800000
*                                                                       24850000
*                                                                       24900000
RCE4600  EQU   *                                                        24950000
*                                                                       25000000
*                                                                       25050000
         MVC   DXCCW6(1),DCBEROPT      SAVE FOR QSAM           @ZA15324 25100000
         ST    RB,DXCCW11              STORE CODE IN DCB WORK AREA      25150000
*                                                              @ZA10074 25200000
         LA    RF,SOPN7M               GET ID OF NEXT MODULE            25250000
XCTLGOGO EQU   *                                                        25300000
         L     RPAR,DXDEBAPP           RESTORE PARAMETER LIST           25350000
         LA    RJ,DXDCB                                                 25400000
         ST    RJ,IOBWGHT                                               25450000
         MVC   DXDEBAPP(EIGHT),DSCEXT1+NINE RESTORE WORK                25500000
         MVC   DXDEBSCC(EIGHT),DSCEXT2+SEVEN AREA AFTER USAGE           25550000
         MVC   ZERO(FIVE,RWTGC),ZERO(RF)                                25600000
RELOOP   EQU   *                                                        25650000
         LA    RWTGC,WGOFF(ZERO,RWTGC)                                  25700000
         LA    RPARC,PLOFF(ZERO,RPARC)                                  25750000
         CLC   ZERO(TWO,RWTGC),AMIDCNST                                 25800000
         BCR   8,RBASE                 BRANCH IF EQUAL                  25850000
         CLC   ZERO(TWO,RWTGC),OPIDCNST                                 25900000
         BC    7,RELOOP                BRANCH IF NOT EQUAL              25950000
         LR    RPARC,RPAR                                               26000000
         LA    RWTGC,WAOFF(ZERO,RWTG)                                   26050000
ZCHEK    CLI   ZERO(RWTGC),ZERO                                         26100000
         BC    7,TCTLRTN               BRANCH IF NOT EQUAL              26150000
         LA    RWTGC,WGOFF(ZERO,RWTGC)                                  26200000
         LA    RPARC,PLOFF(ZERO,RPARC)                                  26250000
         BC    15,ZCHEK                BRANCH                           26300000
TCTLRTN  EQU   *                                                        26350000
         MVC   SIX(TWO,RWTG),ZERO(RWTGC)                                26400000
         MVC   D14(THRE,RWTG),TWO(RWTGC)                                26450000
         LA    RJ,DXCCW12                                               26500000
         XCTL  DE=(RWTG),SF=(E,(15))                                    26550000
*********************************************************************** 26600000
*                      DECLARE WTG OFFSETS                              26650000
WAOFF    EQU   32                                                       26700000
WGOFF    EQU   8                                                        26750000
PLOFF    EQU   4                                                        26800000
         DS    0F                                                       26850000
F000     DC    XL4'0000F000'           WORK DC TO BE LOADED IN REG      26900000
OPIDCNST DC    C'0S'                   ID                               26950000
AMIDCNST DC    C'7L'                   THIS MODULE'S ID                 27000000
MYFRMT   DC    C' FORMAT ('            FIRST NINE COL. OF FORMAT CD     27050000
*********************************************************************** 27100000
*                                                                       27150000
         ORG   IGG0197L+1008           LEAVE MAINT SPACE AS REQUIRED    27200000
SOPN7M   DC    C'7M    '               IDTTRL                           27250000
         DC    H'0'                    END OF TABLE MARKER              27300000
         DC    F'0'                    PAD TABLE TO DBL WORD BOUNDRY    27350000
         DC    C'019'                  OPEN SVC CODE                    27400000
         DC    AL1(126)                DBL WD CNST TO TOP OF WTG TABLE  27450000
*********************************************************************** 27500000
*                                                                       27550000
*                                   DSECTS                              27600000
*                                                                       27650000
         DCBD  DSORG=PS                                                 27700000
*                                                                       27750000
**                                                                      27800000
***                                                                     27850000
****                                                                    27900000
**                                                                      27950000
***                                                                     28000000
**                                                                      28050000
FORCORE  DSECT                                                          28100000
         IECDSECT                                                       28150000
         END                                                            28200000
./  ADD  SSI=61660257,NAME=IGG0197M
         TITLE 'IGG0197M  WTO MESSAGE ROUTINE AND ABEND '               00300000
         START                                                          00600000
IGG0197M CSECT                                                          00900000
*********************************************************************** 01200000
*                                                                       01500000
*NAME--              IGG0197M                                           01800000
*                                                                       02100000
*TITLE--             'IGG0197M' - WTO ROUTINE FOR OMR/RCE ERRORS        02400000
*                                                                       02700000
*STATUS CHANGE LEVEL 000                                                03000000
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    03300000
*                    NEW MODULE                                         03600000
*                                                                       03900000
*MODULE TYPE--       OPEN - STAGE 1                                     04200000
*                                                                       04500000
*FUNCTION/OPERATION--THIS ROUTINE IS ENTERED FOR SAM USERS DURING       04800000
*                    OPEN WHEN:                                         05100000
*                             1) FORMAT CARD FOR OMR OR RCE IS          05400000
*                               INVALID.                                05700000
*                             2) INVALID DEVICE HAS BEEN SPECIFIED      06000000
*                                FOR OMR.                               06300000
*                             3) NORMAL XCTL FROM IGG0197L IS TO THIS   06600000
*                                MODULE                                 06900000
*                                                                       07200000
*ENTRY POINT--       IGG0197M IS ENTERED FROM IGG0197L VIA XCTL.        07500000
*                                                                       07800000
*INPUT--             DCB ADDRESS                                        08100000
*                    WORK AREA ADDRESS                                  08400000
*                    WHERE-TO-GO TABLE                                  08700000
*                    PARAMETER LIST                                     09000000
*                    CURRENT ENTRY IN WHERE-TO-GO TABLE                 09300000
*                    CURRENT PARAMETER(DCB)                             09600000
*                                                                       09900000
*OUTPUT--            SEE DESCRIPTION OF REGISTERS.                      10200000
*                                                                       10500000
*EXTERNAL ROUTINES-- NONE                                               10800000
*                                                                       11100000
*EXIT NORMAL--       XCTL TO IGG0191I  OF BUFNO HAS BEEN SPECIFIED      11400000
*                    XCTL TO IGG0197N IF BUFNO HAS NOT BEEN SPECIFIED   11700000
*                                                                       12000000
*EXIT ERROR--        004 ABEND- INVALID OMR OR RCE FORMAT CARD OR       12300000
*                    INVALID DEVICE SPECIFIED FOR OMR. REG 15 WILL      12600000
*                    CONTAIN A RETURN CODE OF 5 TO INDICATE THIS        12900000
*                    CONDITION.                                         13200000
*                                                                       13500000
*TABLES/WORKAREAS--  WHERE-TO-GO TABLE                                  13800000
*                    BYTES  0- 7   NAME                                 14100000
*                    BYTES  8-10   RELATIVE DISK ADDRESS(TTR) OF        14400000
*                                  FIRST RECORD                         14700000
*                    BYTE     11   CONCATENATION NUMBER                 15000000
*                    BYTE     12   ZEROES                               15300000
*                    BYTE     13   ALIAS INDICATOR AND USER DATA        15600000
*                                  FIELD DESCRIPTOR:                    15900000
*                                      -ALIAS INDICATOR-- 1 BIT         16200000
*                                      -NUMBER OF TTRS IN USERS         16500000
*                                      DATA FIELD-- 2 BITS              16800000
*                    BYTES 14-16   TTR OF FIRST TEXT RECORD             17100000
*                    BYTE     17   ZEROES                               17400000
*                    BYTES 18-19   TTR OF NOTE LIST OR SCATTER LIST     17700000
*                    BYTE     20   TRANSLATION TABLE                    18000000
*                    BYTE     21   ZEROES OR NUMBER OF ENTRIES IN       18300000
*                                  THE NOTE LIST                        18600000
*                    BYTES 22-23   ATTRIBUTES                           18900000
*                    BYTES 24-26   TOTAL CONTIGUOUS MAIN STORAGE        19200000
*                                  REQUIRED FOR MODULE                  19500000
*                    BYTES 27-28   LENGTH OF FIRST TEXT RECORD          19800000
*                    BYTE     29   LENGTH OF WTG TABLE(IN DOUBLE        20100000
*                                  WORDS)                               20400000
*                    BYTES 30-31   PATH THROUGH LOADS OF ROUTINES       20700000
*                    BYTES 32-34   IDTTR OF EXECUTOR FOR FIRST DCB      21000000
*                    BYTE     35   ADDRESS OF STORAGE FOR DCB           21300000
*                    BYTES 36-39   TABLE OF IDTTR'S                     21600000
*                    BYTE  32+N(8)--                                    21900000
*                            IDTTR OF EXECUTOR FOR NTH DCB (3 BYTES)    22200000
*                            ADDRESS OF STORAGE FOR DCB    (1 BYTE )    22500000
*                            IDTTR OF LAST ROUTINE LOAD    (3 BYTES)    22800000
*                            NOT USED                      (1 BYTE )    23100000
*                    --------------                                     23400000
*                    WORKAREA-     SEE 'FORCORE DSECT'(IECDSECT)        23700000
*                                  IN THIS LISTING.                     24000000
*                                                                       24300000
*ATTRIBUTES--        REENTRANT AND REUSABLE.                            24600000
*                                                                       24900000
*********************************************************************** 25200000
*********************************************************************** 25500000
*                            REGISTER CONVENTIONS                       25800000
*********************************************************************** 26100000
RDCB     EQU   2                       DCB REGISTER                     26400000
RBASE    EQU   3                       BASE REGISTER                    26700000
RCORE    EQU   4                       DCB WORK AREA REGISTER           27000000
RPAR     EQU   5                       TOP OF PARAMETER LIST            27300000
RWTG     EQU   6                       TOP OF WHERE-TO-GO (WTG) TABLE   27600000
RPARC    EQU   7                       CURRENT PARAMETER                27900000
RWTGC    EQU   8                       CURRENT TRANS LOAD               28200000
RTIOT    EQU   9                       USED HERE AS WORK REGISTER       28500000
RUCB     EQU   10                      USED HERE AS WORK REGISTER       28800000
RDEB     EQU   11                      DEB REGISTER                     29100000
RB       EQU   12                      WORK REGISTER                    29400000
RC       EQU   13                      WORK REGISTER                    29700000
RD       EQU   14                      WORK REGISTER                    30000000
RJ       EQU   15                      WORK REGISTER                    30300000
RE       EQU   0                       WORK REGISTER                    30600000
RF       EQU   1                       WORK REGISTER                    30900000
*********************************************************************** 31200000
*                            DISPLACEMENTS AND MASKS                    31500000
*********************************************************************** 31800000
ZERO     EQU   X'00'                                                    32100000
FOUR     EQU   X'04'                                                    32400000
TWO      EQU   X'02'                                                    32700000
SIX      EQU   X'06'                                                    33000000
C14      EQU   X'0E'                                                    33300000
THRE     EQU   X'03'                                                    33600000
PW       EQU   X'30'                                                    33900000
ONE      EQU   1                                                        34200000
THREE    EQU   3                                                        34500000
D70      EQU   70                                                       34800000
SVC35    EQU   35                                                       35100000
FIVE     EQU   5                                                        35400000
INPUTMSK EQU   X'0F'                                                    35700000
QSAMFLG  EQU   X'01'                                                    36000000
*                                                                       36300000
*                                                                       36600000
**                                                                      36900000
*                                                                       37200000
         BALR  RBASE,RE                LOAD BASE ADDR IN BASE REG       37500000
         USING M1000,RBASE                                              37800000
         USING FORCORE,RCORE                                            38100000
         USING DEBBASIC,RDEB                                            38400000
         USING IHADCB,RDCB                                              38700000
*                                                                       39000000
M1000    EQU   *                                                        39300000
         L     RDCB,ZERO(RPARC)        GET DCB ADDRESS                  39600000
         LA    RDCB,ZERO(RDCB)         CLEAR HIGH ORDER BYTE            39900000
         L     RCORE,FOUR(RWTGC)       GET WORK AREA ADDRESS            40200000
         L     RDEB,DCBDEBAD           GET DEB ADDRESS                  40500000
*                                                                       40800000
         CLC   DXCCW11(FOUR),ERROR     HAS AN ERROR CODE BEEN PASSED    41100000
*                                                              @ZA10074 41150000
         BNE   BYPASMSG                NO, BY PASS ERROR MESSAGE        41400000
**                                                                      41700000
*                                                                       42000000
         MVC   MESSAGEA(D70),WTO0045   MOVE IN WTO MESSAGE              42300000
         LA    RF,MESSAGEA              GET ADDRESS OF WTO MESSAGE      42600000
         SVC   SVC35                   ISSUE WTO MESSAGE                42900000
         LA    RJ,FIVE                 LOAD FORMAT ERROR CODE IN REG 15 43200000
         B     ABEN                    BRANCH TO ISSUE ABEND            43500000
LEVELID  DC    C'02'                   MODULE LEVEL CONTROL             43800000
*                                                                       44100000
BYPASMSG EQU   *                                                        44400000
         SR    RB,RB                                                    44700000
         IC    RB,DCBBUFNO             PICK UP BUFFER NUMBER            45000000
         TM    DCBCIND2,QSAMFLG        USING QSAM                       45300000
         BNO   TESTBSAM                NO, BRANCH TO CHECK BSAM         45600000
         LTR   RB,RB                   HAS A BUFFER NUMBER BEEN SPECIFD 45900000
         BNZ   CONTINUE                YES, BRANCH AND ASSUME CORRECT   46200000
*                                      BUFFER NUMBER.                   46500000
         TM    DEBOPATB,INPUTMSK       CHECK FOR INPUT DATA SET         46800000
         BO    CKOUT                   NO, BRANCH                       47100000
         BM    CKOUT                   NO, BRANCH                       47400000
         TM    DCBFUNC,PW              3525 PUNCH OR PRINT DATA SET     47700000
         BZ    READONLY                YES, BRANCH                      48000000
CKOUT    EQU   *                                                        48300000
         OI    DCBBUFNO,ONE            SET BUFFER NUMBER TO ONE         48600000
         B     CONTINUE                BRANCH                           48900000
READONLY EQU   *                                                        49200000
         OI    DCBBUFNO,TWO            DEFAULT TO TWO BUFFERS           49500000
CONTINUE EQU   *                                                        49800000
         TM    DCBBUFNO+THREE,ONE      BUFFER CONTROL BLOCK SPECIFIED   50100000
         BNO   LIDOF7N                 NO BRANCH                        50400000
TESTBSAM EQU   *                                                        50700000
         TM    DCBBUFNO+THREE,ONE      BUFFER CONTROL BLOCK SPECIFIED   51000000
         BNO   LIDOF7N                 NO, BRANCH                       51300000
         LTR   RB,RB                   HAS A BUFFER NO. BEEN SPECIFIED  51600000
         BZ    LIDOF7N                 NO, BRANCH TO LOAD ID OF 7N      51900000
LIDOF1I  EQU   *                                                        52200000
         LA    RF,SOP7                 LOAD ID OF IGG0191I              52500000
         B     XCTLGOGO                BRANCH TO XCTL ROUTINE           52800000
LIDOF7N  EQU   *                                                        53100000
         LA    RF,SOPN7N               LOAD ID OF IGG0197N              53400000
XCTLGOGO EQU   *                                                        53700000
         MVC   ZERO(FIVE,RWTGC),ZERO(RF) SAVE ID OF NEXT MODULE         54000000
RELOOP   EQU   *                                                        54300000
*                                                                       54600000
         LA    RWTGC,WGOFF(ZERO,RWTGC) INCREMENT CURRENT WTG ENTRY      54900000
         LA    RPARC,PLOFF(ZERO,RPARC) INCRE CURRENT DCB ENTRY POINTER  55200000
         CLC   ZERO(TWO,RWTGC),AMIDCNST THIS ROUTINE NEEDED AGAIN       55500000
         BCR   RWTGC,RBASE             BACK TO OPEN CONTROL ROUTINE     55800000
*                                                                       56100000
         CLC   ZERO(TWO,RWTGC),OPIDCNST END OF TABLE                    56400000
         BNE   RELOOP                  NO, CHECK NEXT ENTRY             56700000
*                                                                       57000000
         LR    RPARC,RPAR                                               57300000
         LA    RWTGC,WAOFF(ZERO,RWTG)  REINITIALIZE WTG LIST POINTER    57600000
ZCHEK    CLI   ZERO(RWTGC),ZERO        ENTRY COMPLETE                   57900000
         BNE   TCTLRTN                 IF NOT, TRANSFER CONTROL         58200000
*                                                                       58500000
         LA    RWTGC,WGOFF(ZERO,RWTGC) GET NEXT ENTRY                   58800000
         LA    RPARC,PLOFF(ZERO,RPARC) GET NEXT ENTRY                   59100000
         B     ZCHEK                   BRANCH TO ZERO CHECK             59400000
*                                                                       59700000
TCTLRTN  EQU   *                                                        60000000
*                                                                       60300000
         MVC   SIX(TWO,RWTG),0(RWTGC)  STORE ID IN WTG TABLE            60600000
         MVC   C14(THRE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE            60900000
*                                                                       61200000
         LA    RJ,DXCCW12              SET UP FOR XCTL                  61500000
*                                                                       61800000
         XCTL  DE=(RWTG),SF=(E,(15))   ISSUE XCTL                       62100000
*                                                                       62400000
**                                                                      62700000
***                                                                     63000000
**                                                                      63300000
*                                                                       63600000
ABEN     EQU   *                                                        63900000
*                                                                       64200000
         L     RF,ABEND4               LOAD ABEND CODE OF 4             64500000
         SLL   RF,12                                                    64800000
         ABEND (1),DUMP                                                 65100000
*                                                                       65400000
*********************************************************************** 65700000
*                                                                       66000000
WAOFF    EQU   32                                                       66300000
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            66600000
PLOFF    EQU   4                       OFFSET OF DCB ENTRIES            66900000
OPIDCNST DC    C'0S'                   ID                               67200000
AMIDCNST DC    C'7M'                   THIS MODULE'S ID                 67500000
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     67800000
ERROR    DC    X'00000005'             CONSTANT USED FOR COMPARES       68100000
ABEND4   DC    X'00000004'             ABEND CODE OF 4                  68400000
*                                                                       68700000
WTO0045  WTO   'IEC951I 004-5 INVALID FORMAT CARD OR INVALID DEVICE FOR*69000000
                OMR',MF=L,ROUTCDE=(11),DESC=4                           69300000
*                                                                       69600000
*********************************************************************** 69900000
*                                                                       70200000
         ORG   IGG0197M+1000           LEAVE MAINT SPACE AS REQ.        70500000
SOP7     DC    C'1I    '               ID OF IGG0191I                   70800000
SOPN7N   DC    C'7N    '               ID OF IGG0197N                   71100000
         DC    H'0'                    END OF TABLE MARKER              71400000
         DC    3H'0'                   FILLER                           71700000
         DC    C'019'                  OPEN SVC CODE                    72000000
EBL      DC    AL1(125)                DBL WD CNST TO TOP OF WTG        72300000
*********************************************************************** 72600000
*************************       DSECTS       ************************** 72900000
*********************************************************************** 73200000
*                                                                       73500000
*                                                                       73800000
         DCBD  DSORG=PS                                                 74100000
         IEZDEB                                                         74400000
FORCORE  DSECT                                                          74700000
         IECDSECT                                                       75000000
         END                                                            75300000
./  ADD  SSI=80120084,NAME=IGG0197N
         START                                                          00050037
         TITLE 'IGGO197N FUNC= PARM VERIF AND DEB LOOK AND HOOK UP'     00100037
IGG0197N CSECT                                                          00150037
*********************************************************************** 00200037
*         VS2037 CHANGES                                                00210037
*                                                                       00220037
* D634000-635600,644000,684100-685700                          @YM06152 00250037
* D012000-016000,321000,330000-360000,396000,404000-410000,    @YM05576 00300037
* D428000-432000,440000-444000,635200,684400-685100,917000,    @YM05576 00350037
* D928000-934000                                               @YM05576 00400037
* C026000,030000,314000,418600,434000,446000,484600,504600,    @YM05576 00450037
* C524600,635600,684800,685100,924000,930000,942000            @YM05576 00500037
* A 380300,381300,476500,477300                                @YM05576 00550037
* C 38400000                                                   @ZA10075 00600037
* A 38400002                                                   @ZA10075 00650037
*C195500,199500,201000                                         @ZA00000 00670037
* MODULE NAME = IGG0197N                                                00700037
*                                                                       00750037
* DESCRIPTIVE NAME= IGG0197N-OPEN FOR 3505/3525                         00800037
*                                                                       00850037
*STATUS CHANGE LEVEL-020                                                00900037
*                                                                       00950037
*FUNCTION  THIS EXECUTOR IS ENTERED FOR SAM BSAM AND QSAM USERS OF THE  01000037
*          3505 OR 3525 DURING OPEN-STAGE2 FOR VERIFICATION OF FUNC=    01050037
*          AND RELATED DCB PARAMETERS. ALSO DEB'S FOR 3525 ASSOCIATED   01100037
*          DATA SETS ARE HOOKED VIA AN ADDRESS FIELD TO IT'S            01150037
*          ASSOCIATED DCB'S.                                            01200037
*                                                                       01250037
*  THERE ARE NOW TWO COPIES OF EACH DCB. ONE IS THE REAL, OR   @YM05576 01300037
*  USER DCB, AND ONE IS THE COPY, OR DATA MANAGEMENT DCB. THE  @YM05576 01350037
*  DCB ADDRESS THAT IS PLACED IN THE DEB MUST BE THE USER DCB  @YM05576 01400037
*  ADDRESS.                                                    @YM05576 01450037
*                                                              @YM05576 01500037
*     OPERATION=                                                        01550037
*          THE FUNC= PARAMETER IS CHECKED FOR A VALID FILE TYPE OR      01600037
*          A VALID COMBINATION. THIS PARAMETER IS ALSO CHECKED IN       01650037
*          REFERENCE TO THE DCB MACRF PARAMETER TO INSURE COMPATIBLE    01700037
*          ACCESS METHODS FOR ASSOCIATE DATA SETS AND TO INSURE STACKER 01750037
*          SELECTION VIA CNTRL IS NOT BEING ATTEMPTED FOR AN INPUT      01800037
*          FILE OF AN ASSOCIATED DATA SET.                              01850037
*                                                                       01900037
* NOTES= PATCH-LABEL = ZAPSZAPS                                         01950037
*                                                                       02000037
* MODULE TYPE= PROCESSOR-ASSEM                                          02050037
*              ATTRIBUTES-REENTRANT                                     02100037
*                                                                       02150037
* ENTRY POINT - IGG0197N                                                02200037
*              ENTERED FROM IGG0193I VIA XCTL                           02250037
*                                                                       02300037
* INPUT     DCB ADDRESS                                                 02350037
*          WORK AREA ADDRESS                                            02400037
*          WHERE TO GO TABLE                                            02450037
*          PARAMETER LIST                                               02500037
*          CURRENT ENTRY IN WHERE TO GO TABLE                           02550037
*          CURRENT PARAMETER (DCB)                                      02600037
*                                                                       02650037
*          THE REFERENCED DEB FIELDS ARE AS FOLLOWS                     02700037
* * * * DEB -- UNIT RECORD AND MAGNETIC TAPE SECTION                    02750037
*                                                                       02800037
*   +36 DEBRDCB    FULLWORD CONTAINING DEBRDCBA POINTER                 02850037
*   +37 DEBRDCBA   ADDRESS OF DCB FOR THE READ ASSOCIATED DATA SET      02900037
*   +40 DEBPDCB    FULLWORD CONTAINING DEBPDCBA POINTER                 02950037
*   +41 DEBPDCBA   ADDRESS OF DCB FOR THE PUNCH ASSOCIATED DATA SET     03000037
*   +44 DEBWDCB    FULLWORD CONTAINING DEBWDCBA POINTER                 03050037
*   +45 DEBWDCBA   ADDRESS OF DCB FOR THE PRINT ASSOCIATED DATA SET     03100037
*                                                                       03150037
*                                                                       03200037
*EXITS --- NORMAL                                                       03250037
*          1 IF NO DEVICE ASSOCIATED DATA SET AND NO FEATURES (OMR,RCE  03300037
*            OR PRINT) SPECIFIED FOR THE 3505 OR 3525 EXIT WILL BE      03350037
*            TO IGG0191G                                                03400037
*                                                                       03450037
*          2.IF A FEATURE OR ASSOCIATED DATA SETS ARE SPECIFIED, AS     03500037
*            STATED ABOVE,EXIT WILL BE TO IGG0197P.                     03550037
*     OUTPUT=                                                           03600037
*          THE ADDRESS OF ANY OPENED ASSOCIATED DATA IS PLACED IN THE   03650037
*          CURRENT DCB'S DEB ALSO THE ADDRESS OF THE CURRENT DCB IS     03700037
*          PLACED IN THE DEB OR DEB'S OF ANY OTHER ASSOCIATED DATA SET  03750037
*          WHICH HAS BEEN OPENED                                        03800037
*                                                                       03850037
* EXIT - ERROR=        004 ABEND,REG 15 WILL HAVE A RETURN CODE OF      03900037
*                      1,2,3 OR 4 WITH THE FOLLOWING MEANINGS.          03950037
*                                                                       04000037
*                      1 INDICATES INVALID DCBFUNC PARAMETERS           04050037
*                      2 INDICATES INVALID FUNC/CNTRL COMBINATION       04100037
*                      3 INDICATES CONFLICTING ASSOCIATED DATA SET      04150037
*                        ACCESS METHODS                                 04200037
*                      4 INDICATES INVALID DCB FOR A 3505 OR 3525       04250037
*                                                                       04300037
* EXTERNAL REFERENCES=                                                  04350037
*       DATA AREA- IECDSECS(O/C/E WORK AREA)                            04400037
*       CONTROL BLOCKS= DCB-U,DEB-M                                     04450037
*                                                                       04500037
*TABLES=  WHERE TO GO TABLE                                             04550037
*                                                                       04600037
* MACROS=MODESET,SETLOCK,XCTL,WTO                                       04650037
*     SERIALIZATION= DEB(LOCAL LOCK)                                    04700037
*                                                                       04750037
* CHANGE ACTIVITY= YM06152,YM05576                                      04800037
*                                                                       04850037
* MESSAGE= IEC952I  004-0 CONFLICTING/INVALID DCB FUNC OR               04900037
*                   RELATED PARAMETERS                                  04950037
*                                                                       05000037
*********************************************************************** 05050037
*                             REGISTER  CONVENTIONS                   * 05100037
*********************************************************************** 05150037
RDCB     EQU   2                       DCB REGISTER                     05200037
RBASE    EQU   3                       BASE REGISTER                    05250037
RCORE    EQU   4                       WORK AREA REGISTER               05300037
RPAR     EQU   5                       TOP OF PARAMTER LIST             05350037
RWTG     EQU   6                       TOP OF WTG TABLE                 05400037
RPARC    EQU   7                       CURRENT PARAMETER                05450037
RWTGC    EQU   8                       CURRENT TRANS LOAD               05500037
RTCB     EQU   9                       ADDRESS OF CURRENT TCB    Y02898 05550037
RUCB     EQU   10                      USED HERE AS WORK REGISTER       05600037
RDEB     EQU   11                      DEB ADDRESS                      05650037
RB       EQU   12                      WORK REG1                        05700037
RC       EQU   13                      WORK REG2                        05750037
RD       EQU   14                      WORK REG3                        05800037
RJ       EQU   15                      WORK REG4                        05850037
RE       EQU   0                       WORK REG5                        05900037
RF       EQU   1                       WORK REG6                        05950037
*                                                                       06000037
*                                                                       06050037
ZERO     EQU   X'00'                                                    06100037
ONE      EQU   X'01'                                                    06150037
TWO      EQU   X'02'                                                    06200037
THRE     EQU   X'03'                                                    06250037
FOUR     EQU   X'04'                                                    06300037
FIVE     EQU   X'05'                                           @YM05576 06350037
D40      EQU   40                                                       06400037
D74      EQU   74                                                       06450037
SVC35    EQU   35                                                       06500037
D5       EQU   5                                                        06550037
D6       EQU   6                                                        06600037
D14      EQU   14                                                       06650037
D8       EQU   8                                               @YM05576 06700037
D32      EQU   32                                              @YM05576 06750037
ENDTAB   EQU   X'80'                                           @YM05576 06800037
CNTRLOPT EQU   X'02'                                                    06850037
GETBIT   EQU   X'40'                                                    06900037
PUTBIT   EQU   X'40'                                                    06950037
GETRD    EQU   X'60'                                                    07000037
PUTWRT   EQU   X'60'                                                    07050037
R3505    EQU   X'46'                                                    07100037
RCE      EQU   X'10'                                                    07150037
OMR      EQU   X'20'                                                    07200037
INPUT    EQU   X'00'                                                    07250037
OUTPUT   EQU   X'07'                    MASK FOR OUTPUT OR OUTIN        07300037
FRTY8    EQU   X'30'                                                    07350037
TWENTY   EQU   X'14'                                                    07400037
INTRPRET EQU   X'80'                                                    07450037
READ     EQU   X'40'                                                    07500037
READWX   EQU   X'54'                                                    07550037
READWXT  EQU   X'56'                                                    07600037
READWT   EQU   X'52'                                                    07650037
READW    EQU   X'50'                                                    07700037
PUNCH    EQU   X'20'                                                    07750037
PUNCHW   EQU   X'30'                                                    07800037
PUNCHWX  EQU   X'34'                                                    07850037
PUNCHWXT EQU   X'36'                                                    07900037
PRINTX   EQU   X'04'                                                    07950037
PRINTW   EQU   X'10'                                                    08000037
PRINTWX  EQU   X'14'                                                    08050037
PRINTWT  EQU   X'12'                                                    08100037
PRINTWXT EQU   X'16'                                                    08150037
RDPUNCH  EQU   X'60'                                                    08200037
RDPHDPI  EQU   X'68'                                                    08250037
RDPHW    EQU   X'70'                                                    08300037
RDPHWX   EQU   X'74'                                                    08350037
RDPHWXT  EQU   X'76'                                                    08400037
RDPHWDPI EQU   X'78'                                                    08450037
*                                                                       08500037
SUFIXCOD EQU   26                       WTO SUFFIX ERROR CODE OFFSET    08550037
COMP1    EQU   X'F1'                                                    08600037
COMP2    EQU   X'F2'                                                    08650037
COMP3    EQU   X'F3'                                                    08700037
COMP4    EQU   X'F4'                                                    08750037
**                                                                      08800037
***                                                                     08850037
**                                                                      08900037
*                                                                       08950037
         BALR  RBASE,RE                PUT BASE ADDR IN BASE REG        09000037
         USING *,RBASE                                         @YM05576 09050037
         USING FORCORE,RCORE                                            09100037
         USING IHADCB,RDCB                                              09150037
         USING DEBBASIC,RDEB                                            09200037
         USING WTG,RWTG                                        @YM05576 09250037
*                                                                       09300037
         MODID BR=YES                                          @YM05576 09350037
*                                                                       09400037
FUNC1000 EQU   *                                                        09450037
         L     RDCB,ZERO(RPARC)        GET DCB ADDRESS                  09500037
         L     RCORE,FOUR(RWTGC)       GET DCB WORK AREA ADDRESS        09550037
         L     RDEB,DCBDEBAD           GET ASSOCIATED DEB ADDRESSY02898 09600037
         CLI   DCBFUNC,ZERO            FUNC PARAMETER OF DCB USED       09650037
         BE    FUNC4000                NO, BRANCH                       09700037
         CLI   DCBDEVT,R3505           IS THIS A 3505 CARD READER       09750037
         BNE   FUNC1100                NO, BRANCH                       09800037
         CLI   DCBFUNC,READ            IS FUNC= READ ONLY FILE          09850037
         BNE   FUNC3600                NO,BRANCH                        09900037
         TM    DCBMODE,OMR             OPTICAL MARK READ SPECIFIED      09950037
         BO    FUNC3800                YES, BRANCH                      10000037
         TM    DCBMODE,RCE             READ COLUMN ELIMINATE SPECIFIED  10050037
         BO    FUNC3800                YES,BRANCH                       10100037
FUNC1100 EQU   *                                                        10150037
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        10200037
         BE    FUNC3800                 YES, BRANCH TO LOAD ID OF '7P'  10250037
         B     FUNC3300                OTHERWISE, CK FOR OTHER FUNCTION 10300037
FUNC1200 EQU   *                                                        10350037
*                                                                       10400037
*    VERIFY VALID USE OF CNTRL ON INPUT FILE OF AN ASSOCIATED DATA SET  10450037
*                                                                       10500037
         TM    DEBOPATB,OUTPUT          IS THIS AN INPUT DATA SET       10550037
         BO    FUNC1300                 NO, BRANCH                      10600037
         TM    DCBMACRF,CNTRLOPT       CHECK FOR INVALID CNTRL          10650037
         BO    FUNC3900                YES, BRANCH TO PRINT ERROR MSG.  10700037
*                                                                       10750037
FUNC1300 EQU   *                                                        10800037
         STM   RDEB,RD,DXREGB          SAVE REGISTERS 11_14      Y02898 10850037
         MODESET EXTKEY=ZERO           SET KEY 0               @YM05576 10900037
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02898X10950037
               RELATED=(DEB,IGG0197N(FUNC1800)) LOCK CPU'S       Y02898 11000037
*                                      CHAIN SO THAT A CHECK FOR Y02898 11050037
*                                      ASSOCIATED DATA SET CAN   Y02898 11100037
*                                      BE MADE                   Y02898 11150037
         MODESET EXTKEY=DATAMGT        SET DATA MANAGEMENT KEY @YM05576 11200037
         LM    RDEB,RD,DXREGB          RESTORE REGISTERS 11_14   Y02898 11250037
         XC    DXCCW2(32),DXCCW2       CLEAR 32 OF 48 BYTES    @ZA10075 11300037
         XC    DXCCW6+1(15),DXCCW6+1   CLEAR LAST 15 BYTES     @ZA10075 11350037
         SR    RB,RB                   CLEAR WORK REGISTERS             11400037
         SR    RC,RC                                                    11450037
         SR    RD,RD                                                    11500037
         L     RUCB,DEBSUCBA           GET DEB "IDENTIFIER"    @YM06152 11550037
         L     RDCB,DXUDCBAD           GET ACTUAL ADDRESS OF DCB Y02898 11600037
*                                      TO BE OPENED              Y02898 11650037
         LA    RDCB,ZERO(RDCB)         CLEAR HIGH ORDER BYTE   @YM05576 11700037
         LA    RUCB,0(RUCB)                 * * *              @YM06152 11750037
         MVC   DXCCW8+ONE(THRE),DXUDCBAD+ONE MOVE IN USER DCB  @YM06152 11800037
         ST    RDCB,DXCCW2              SAVE CURRENT DM DCB    @YM06152 11850037
FUNC1400 EQU   *                                                        11900037
         TM    DEBOPATB,OUTPUT         IS THIS AN INPUT DCB             11950037
         BO    FUNC1500                NO,BRANCH                        12000037
         MVC   DXCCW4+ONE(THRE),DXCCW8+ONE  GET READ DCB ADDR  @YM05576 12050037
         ST    RDEB,DXCCW4+FOUR        SAVE CORRESPONDING DEB  @YM06152 12100037
         B     FUNC1700                BR TO GET POINTER TO NEXT DEB    12150037
FUNC1500 EQU   *                                                        12200037
         TM    DEBOPATB,OUTPUT         IS THIS AN OUTPUT DCB            12250037
         BNO   FUNC1700                NO, BRANCH                       12300037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 12350037
*                                      KEY                       Y02898 12400037
         TM    DCBFUNC,PUNCH           PUNCH DCB                        12450037
         BNO   FUNC1600                NO, PRINT ASSUMED...,BRANCH      12500037
         TM    DCBFUNC,PRINTX          PRINTER BIT ON IN DCB FUNC PARM  12550037
         BO    FUNC1600                YES, BRANCH                      12600037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 12650037
*                                      KEY                       Y02898 12700037
         MVC   DXCCW5+ONE(THRE),DXCCW8+ONE SAVE PUNCH DCB PTR  @YM06152 12750037
         ST    RDEB,DXCCW5+FOUR        SAVE CORRESPONDING DEB  @YM06152 12800037
         B     FUNC1700                BRANCH                           12850037
FUNC1600 EQU   *                                                        12900037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 12950037
*                                      KEY                       Y02898 13000037
         MVC   DXCCW6+ONE(THRE),DXCCW8+ONE SAVE PRINT DCB PTR  @YM06152 13050037
         ST    RDEB,DXCCW6+FOUR        SAVE CORRESPONDING DEB  @YM06152 13100037
FUNC1700 EQU   *                                                        13150037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13200037
*                                                                       13250037
*        CHANGE THE DEB AND DCB ADDRESSES SO THAT THE NEXT DEB IN THE   13300037
*        DEB QUEUE IS BEING POINTED TO AND ITS RELATED DCB IS           13350037
*        BEING POINTED TO.  THESE TWO ADDRESSES WILL BE CHANGED         13400037
*        CONTINUOUSLY UNTIL ALL OF THE DEB'S IN THE DEB QUEUE HAVE      13450037
*        BEEN INTERROGATED.                                             13500037
*                                                                       13550037
         CLC   DEBDEBB(THRE),DXCCW3    ANOTHER DEB IN DEB QUEUE         13600037
         BE    FUNC1800                NO, BRANCH                       13650037
         L     RDEB,DEBDEBAD           YES, GET ADDRESS OF NEXT DEB     13700037
         L     RDCB,DEBDCBAD           GET THIS DCB ADDRESS             13750037
         MVC   DXCCW7+ONE(THRE),DEBSUCBA+ONE  SAVE UCB ADDR.   @YM05576 13800037
         CL    RUCB,DXCCW7             DO UCB PTRS MATCH       @YM05576 13850037
         BNE   FUNC1700                NO, BRANCH              @YM05576 13900037
         LA    RDCB,ZERO(RDCB)         CLEAR HIGH ORDER BYTE   @YM05576 13950037
         LR    RB,RPAR                 GET DCB PARM LIST PTR   @YM05576 14000037
         LR    RC,RWTG                 GET WTG TABLE PTR       @YM05576 14050037
         LA    RC,D32(RC)              INDEX PAST WTG HEADER   @YM05576 14100037
FUNC1725 EQU   *                                               @YM05576 14150037
         L     RD,ZERO(RB)             GET DCB PTR FROM PLIST  @YM05576 14200037
         LA    RD,ZERO(RD)             ZERO HIGH ORDER BYTE    @YM05576 14250037
         CLR   RD,RDCB                 DOES PARM LIST DCB PTR  @YM05576 14300037
*                                      EQUAL DEB DCB PTR       @YM05576 14350037
         BE    FUNC1775                YES. MUST BE DATA       @YM05576 14400037
*                                      MANAGEMENT'S DCB        @YM05576 14450037
         TM    ZERO(RB),ENDTAB         IS IT END OF PARM LIST  @YM05576 14500037
         BO    FUNC1750                YES. MUST BE USER DCB   @YM05576 14550037
         LA    RB,FOUR(RB)             NO. GET NEXT DCB PTR    @YM05576 14600037
         LA    RC,D8(RC)               GET NEXT WTG TAB ENTRY  @YM05576 14650037
         B     FUNC1725                GO COMPARE NEXT DCB     @YM05576 14700037
FUNC1750 EQU   *                                               @YM05576 14750037
         ST    RDCB,DXCCW8             SAVE DEB DCB PTR (USER) @YM05576 14800037
         B     FUNC1400                BRANCH                           14850037
FUNC1775 EQU   *                                               @YM05576 14900037
         L     RC,FOUR(RC)             GET FORECORE ADDR       @YM05576 14950037
         USING FORCORE,RC              ESTAB ADDRESSABILITY    @YM05576 15000037
         L     RD,DXUDCBAD             GET USER DCB PTR        @YM05576 15050037
         DROP  RC                      REESTAB RCORE AS BASE   @YM05576 15100037
         ST    RD,DXCCW8               SAVE USER DCB ADDR.     @YM05576 15150037
         B     FUNC1400                GO PROCESS ASSOC. D.S.  @YM05576 15200037
FUNC1800 EQU   *                                                        15250037
         SR    RB,RB                   ZERO WORK REG           @YM05576 15300037
         SR    RC,RC                   ZERO WORK REG           @YM05576 15350037
         SR    RD,RD                   ZERO WORK REG           @YM05576 15400037
         STM   RDEB,RD,DXREGB          SAVE REGISTERS 11_14      Y02898 15450037
         MODESET EXTKEY=ZERO           SET KEY 0               @YM05576 15500037
         SETLOCK RELEASE,TYPE=LOCAL,                             Y02898X15550037
               RELATED=(DEB,IGG0197N(FUNC1300)) UNLOCK CPU'S     Y02898 15600037
         MODESET EXTKEY=DATAMGT        SET DATA MANAGEMENT KEY @YM05576 15650037
         LM    RDEB,RD,DXREGB          RESTORE REGISTERS 11_14   Y02898 15700037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 15750037
FUNC1850 CLC   DXCCW4(FOUR),DXCCW3     WAS A READ DCB FOUND             15800037
         BE    FUNC2000                NO,BRANCH                        15850037
         L     RDCB,DXCCW4             GET READ DCB ADDR FOR DSECT USE  15900037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 15950037
*                                      KEY                       Y02898 16000037
         TM    DCBMACRF,GETBIT         GET BIT ON IN DCB                16050037
         BNO   FUNC1900                NO, BRANCH                       16100037
         LA    RB,D40                  SET QSAM SWITCH ON               16150037
         B     FUNC2000                BRANCH                           16200037
FUNC1900 EQU   *                                                        16250037
         LA    RB,TWENTY               SET BSAM SWITCH ON               16300037
FUNC2000 EQU   *                                                        16350037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 16400037
*                                      KEY                       Y02898 16450037
FUNC2050 CLC   DXCCW5(FOUR),DXCCW3     WAS A PUNCH DCB ADDR RETAINED    16500037
         BE    FUNC2200                NO, BRANCH                       16550037
         L     RDCB,DXCCW5             GET PUNCH DCB ADDRESS            16600037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 16650037
*                                      KEY                       Y02898 16700037
         TM    DCBMACRF+ONE,PUTBIT     PUT BIT ON IN DCB                16750037
         BNO   FUNC2100                NO, BRANCH                       16800037
         LA    RC,D40                  SET QSAM SWITCH ON               16850037
         B     FUNC2200                BRANCH                           16900037
FUNC2100 EQU   *                                                        16950037
         LA    RC,TWENTY               SET BSAM SWITCH ON               17000037
FUNC2200 EQU   *                                                        17050037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 17100037
*                                      KEY                       Y02898 17150037
         CLC   DXCCW6+1(3),DXCCW3      WAS A PRINT DCB ADDR             17200037
*                                      RETAINED                @ZA14966 17250037
         BE    FUNC2400                NO, BRANCH                       17300037
         L     RDCB,DXCCW6             GET PRINT DCB ADDRESS            17350037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 17400037
*                                      KEY                       Y02898 17450037
         TM    DCBMACRF+ONE,PUTBIT     PUT BIT ON IN DCB                17500037
         BNO   FUNC2300                NO, BRANCH                       17550037
         LA    RD,D40                  SET QSAM SWITCH ON               17600037
         B     FUNC2400                BRANCH                           17650037
FUNC2300 EQU   *                                                        17700037
         LA    RD,TWENTY               TURN ON BSAM SWITCH              17750037
FUNC2400 EQU   *                                                        17800037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 17850037
*                                      KEY                       Y02898 17900037
         LTR   RB,RB                   WORK REG EQUAL ZERO              17950037
         BC    8,FUNC2700              YES, BRANCH                      18000037
         LTR   RC,RC                   THIS SWITCH EQUAL TO ZERO        18050037
         BC    8,FUNC2600              YES, BRANCH                      18100037
         CLR   RB,RC                   SAME ACC. MTHD USED FOR RD & PCH 18150037
         BE    FUNC2600                YES, BRANCH                      18200037
         LA    RCORE,THRE              CONFLICTING ACCESS METHODS.      18250037
         L     RDCB,DXCCW2             GET ACTUAL ADDRESS OF DCB Y02898 18300037
*                                      TO BE OPENED              Y02898 18350037
FUNC2500 EQU   *                                                        18400037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18450037
*                                                                     * 18500037
*     COMPLETION CODE 004-1 IS FOR INVALID DCBFUNC PARAMETERS           18550037
*     COMPLETION CODE 004-2 IS FOR INVALID FUNC/CNTRL COMBINATION       18600037
*     COMPLETION CODE 004-3 IS FOR CONFLICTING ASSOCIATED DATA SET      18650037
*                           ACCESS METHODS                              18700037
*     COMPLETION CODE 004-4 IS FOR AN INVALID DCB FOR A 3505 OR 3525    18750037
*                                                                     * 18800037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18850037
         LR    RD,RCORE                SAVE RETURN CODE                 18900037
         L     RCORE,FOUR(RWTGC)       GET DCB WORKAREA ADDRESS         18950037
         LA    RF,MESSAGEA              GET ADDRESS OF WTO MESSAGEA     19000037
         MVC   MESSAGEA(D74),IECF03I   MOVE IN ERROR MESSAGE            19050037
         O     RD,SUFIXCOD(RF)         OR IN COMP CODE SUFFIX           19100037
         SVC   SVC35                   ISSUE WTO SVC                    19150037
         LR    RJ,RD                   LOAD IN RETURN CODE              19200037
         B     ABEN                    GO TO ISSUE ABEND                19250037
FUNC2600 EQU   *                                                        19300037
         LTR   RD,RD                   THIS SWITCH EQUAL TO ZERO        19350037
         BC    8,FUNC2900              YES, BRANCH                      19400037
         CLR   RB,RD                   SAME ACC. MTHD FOR RD AND PRT    19450037
         BE    FUNC2900                YES, BRANCH                      19500037
         B     FUNC2500                 NO PRINT IECF03I 004-3 @ZA00000 19550037
FUNC2700 EQU   *                                                        19600037
         LTR   RC,RC                   THIS SWITCH ON                   19650037
         BC    8,FUNC2800              NO, BRANCH                       19700037
         LTR   RD,RD                    THIS SWITCH ON                  19750037
         BC    8,FUNC2900              NO, BRANCH                       19800037
         CLR   RC,RD                   SAME ACC. MTHD BEING USED        19850037
         BE    FUNC2900                YES, BRANCH                      19900037
         B     FUNC2500                 NO PRINT IECF03I 004-3 @ZA00000 19950037
FUNC2800 EQU   *                                                        19990037
         LTR   RD,RD                   THIS SWITCH EQUAL TO ZERO        20030037
         BE    FUNC2500                YES PRINT IECF03I 004-3 @ZA00000 20070037
FUNC2900 EQU   *                                                        20150037
         CLC   DXCCW4(FOUR),DXCCW3     WAS A READ DCB FOUND    @YM06152 20200037
         BE    FUNC3100                NO, BRANCH                       20250037
         L     RDCB,DXCCW4             PUT RD DCB ADDR IN DCB REGISTER  20300037
         L     RDEB,DXCCW4+FOUR        GET READ DCB DEB ADDR   @YM06152 20350037
FUNC3000 EQU   *                                                        20400037
         MVC   DEBRDCBA(THRE),DXCCW4+ONE  PUT RD DCB ADDR IN DEB EXT.   20450037
         MVC   DEBPDCBA(THRE),DXCCW5+ONE  PUT PCH DCB ADDR IN DEB EXT.  20500037
         MVC   DEBWDCBA(THRE),DXCCW6+ONE  PUT PRT DCB ADDR IN DEB EXT.  20550037
FUNC3100 EQU   *                                                        20600037
         CLC  DXCCW5(FOUR),DXCCW3      WAS A PCH DCB FOUND     @YM06152 20650037
         BE    FUNC3200                NO, BRANCH                       20700037
         L     RDCB,DXCCW5             PUT PCH DCB ADDR IN DCB REG.     20750037
         L     RDEB,DXCCW5+FOUR        GET PCH DCB DEB ADDR    @YM06152 20800037
         LTR   RC,RC                   PUNCH DEB HOOK COMPLETE          20850037
         BNP   FUNC3200                YES, BRANCH                      20900037
         SR    RC,RC                   ZERO OUT WORK REGISTER           20950037
         B     FUNC3000                BRANCH TO GET DCB ADDR           21000037
FUNC3200 EQU   *                                                        21050037
         CLC   DXCCW6+1(3),DXCCW3      PRINT DCB FOUND         @ZA14966 21100037
         BE    FUNC4300                NO, BRANCH                       21150037
         L     RDCB,DXCCW6             PUT PRT DCB ADDR IN DCB REG.     21200037
         L     RDEB,DXCCW6+FOUR        GET PRINT DCB DEB ADDR  @YM06152 21250037
         LTR   RD,RD                   PRINT DEB HOOK COMPLETE          21300037
         BNP   FUNC4300                YES, BRANCH                      21350037
         SR    RD,RD                   ZERO OUT WORK REGISTER           21400037
         B     FUNC3000                BRANCH TO GET DCB ADDR           21450037
FUNC3300 EQU   *                                                        21500037
         CLI   DCBFUNC,READ            IS FUNC PARM EQUAL TO READ ONLY  21550037
         BNE   FUNC3500                NO, BRANCH                       21600037
         TM    DCBMODE,RCE             READ COLUMN ELIMINATE SPECIFIED  21650037
         BO    FUNC3800                YES, BRANCH                      21700037
FUNC3400 EQU   *                                                        21750037
         LA    RF,SOP5                 GET ID OF EXEC. IGG0191G         21800037
         B     XCTLGOGO                BRANCH TO XCT SUBROUTINE         21850037
*                                                                       21900037
** CHECK FOR TYPE OF DATA SET SPECIFIED                                 21950037
*                                                                       22000037
FUNC3500 EQU   *                                                        22050037
         CLI   DCBFUNC,PUNCH           PUNCH ONLY DATA SET              22100037
         BE    FUNC3400                YES, BRANCH                      22150037
         CLI   DCBFUNC,PRINTW          PRINT ONLY DATA SET              22200037
         BE    FUNC3800                YES, BRANCH                      22250037
         CLI   DCBFUNC,PRINTWT         PRT W/ 2-LINE PRINT DATA SET     22300037
         BE    FUNC3800                YES, BRANCH                      22350037
         CLI   DCBFUNC,PRINTWXT        PRINT W/ 2-LINE PRINT DATA SET   22400037
         BE    FUNC3800                YES, BRANCH                      22450037
         CLI   DCBFUNC,PRINTWX         PRINT ONLY DATA SET              22500037
         BE    FUNC3800                YES, BRANCH                      22550037
         CLI   DCBFUNC,RDPUNCH         RD/PUNCH ASSOCIATED DATA SET     22600037
         BE    FUNC1200                YES, BRANCH                      22650037
         CLI   DCBFUNC,RDPHDPI         RD/PCH W/ DATA PROTECT IMAGE     22700037
         BE    FUNC1200                YES, BRANCH                      22750037
         CLI   DCBFUNC,READW           RD/PRINT ASSOCIATED DATA SET     22800037
         BE    FUNC1300                YES, BRANCH                      22850037
         CLI   DCBFUNC,READWX          PRT PORTION OF RD/PRT ASSOC D.S. 22900037
         BE    FUNC1300                YES, BRANCH                      22950037
         CLI   DCBFUNC,READWXT         RD/PRT W/ 2-LINE PRT ASSOC D.S.  23000037
         BE    FUNC1300                YES, BRANCH                      23050037
         CLI   DCBFUNC,READWT          RD/PRT W/ 2-LINE PRT ASSOC D.S.  23100037
         BE    FUNC1300                YES, BRANCH                      23150037
         CLI   DCBFUNC,PUNCHW          PCH/PRT ASSOCIATED DATA SET      23200037
         BE    FUNC1200                YES, BRANCH                      23250037
         CLI   DCBFUNC,PUNCHWX         PRT PORTION OF PCH/PRT ASSOC. DS 23300037
         BE    FUNC1300                YES, BRANCH                      23350037
         CLI   DCBFUNC,PUNCHWXT        PCH/PRT FILE W/ 2-LINE PRINT     23400037
         BE    FUNC1300                YES, BRANCH                      23450037
         CLI   DCBFUNC,RDPHW           RD/PCH/PRT ASSOCIATED DATA SET   23500037
         BE    FUNC1200                YES, BRANCH                      23550037
         CLI   DCBFUNC,RDPHWX          PRT PART OF RD/PCH/PRT ASSOC. DS 23600037
         BE    FUNC1300                YES, BRANCH                      23650037
         CLI   DCBFUNC,RDPHWXT         RD/PCH/PRT FILE W/ 2-LINE PRINT  23700037
         BE    FUNC1300                YES, BRANCH                      23750037
         CLI   DCBFUNC,RDPHWDPI        RD/PCH/PRT FILE W/ DPI           23800037
         BE    FUNC1200                YES, BRANCH                      23850037
FUNC3600 EQU   *                                                        23900037
         LA    RCORE,ONE               INDICATE INVALID DCBFUNC PARAM   23950037
         B     FUNC2500                BRANCH TO WTO ROUTINE            24000037
FUNC3800 EQU   *                                                        24050037
         LA    RF,IGG0197P             GET ID OF NEXT EXECUTOR          24100037
         B     XCTLGOGO                BRANCH TO XCTL SUBROUTINE        24150037
FUNC3900 EQU   *                                                        24200037
         LA    RCORE,TWO               INDICATE INVALID FUNC/CNTRL COMB 24250037
         B     FUNC2500                BRANCH TO WTO ROUTINE            24300037
FUNC4000 EQU   *                                                        24350037
         TM    DCBDEVT,R3505           3505 CARD READER DEVICE USED     24400037
         BNO   FUNC4200                NO, BRANCH                       24450037
         TM    DCBMODE,OMR             OPTICAL MARK READ SPECIFIED      24500037
         BO    FUNC3800                YES, BRANCH                      24550037
FUNC4100 EQU   *                                                        24600037
         TM    DCBMODE,RCE             READ COL. ELIM. SPECIFIED        24650037
         BO    FUNC3800                YES, BRANCH                      24700037
         B     FUNC3400                BR TO LOAD NEXT EXECUTOR ID      24750037
FUNC4200 EQU   *                                                        24800037
         TM    DCBMACRF,GETRD          GET OR READ USED                 24850037
         BM    FUNC4100                YES, BRANCH                      24900037
         TM    DCBMACRF+ONE,PUTWRT     PUT OR WRITE USED                24950037
         BM    FUNC3400                YES, BRANCH                      25000037
         LA    RCORE,FOUR              INVALID DCB FOR A 3505 OR 3525   25050037
         B     FUNC2500                BRANCH TO WTO ROUTINE            25100037
FUNC4300 EQU   *                                                        25150037
         L     RDCB,DXCCW2             RELOAD CURRENT DCB ADDRESS       25200037
         LA    RF,IGG0197P             LOAD ID OF NEXT EXECUTOR         25250037
XCTLGOGO EQU   *                                                        25300037
*                                      SET SYSTEM TO OPEN PROTECTY02898 25350037
         MODESET EXTKEY=DATAMGT        KEY                       Y02898 25400037
         MVC   ZERO(D5,RWTGC),ZERO(RF) SAVE ID OF NEXT MODULE           25450037
RELOOP   EQU   *                                                        25500037
         LA    RWTGC,WGOFF(ZERO,RWTGC) INCREMENT CURRENT WTG ENTRY      25550037
         LA    RPARC,PLOFF(ZERO,RPARC) INCR CURRENT DCB ENTRY POINTER   25600037
         CLC   ZERO(TWO,RWTGC),AMIDCNST THIS ROUTINE NEEDED AGAIN       25650037
         BCR   8,RBASE                 BACK TO OPEN CONTROL ROUTINDM0I  25700037
*                                                                       25750037
         CLC   ZERO(TWO,RWTGC),OPIDCNST END OF TABLE                    25800037
         BC    7,RELOOP                NO, CHECK NEXT ENTRY             25850037
*                                                                       25900037
         LR    RPARC,RPAR                                               25950037
         LA    RWTGC,WAOFF(ZERO,RWTG)  REINITIALIZE WTG LIST POINTER    26000037
ZCHEK    CLI   0(RWTGC),X'00'          ENTRY COMPLETE                   26050037
         BC    7,TCTLRTN               IF NOT, TRANSFER CONTROL         26100037
*                                                                       26150037
         LA    RWTGC,WGOFF(ZERO,RWTGC) GET NEXT ENTRY                   26200037
         LA    RPARC,PLOFF(ZERO,RPARC) GET NEXT ENTRY                   26250037
         BC    15,ZCHEK                ZERO CHECK                       26300037
*                                                                       26350037
TCTLRTN  EQU   *                                                        26400037
         MVC   D6(TWO,RWTG),ZERO(RWTGC)   STORE ID IN WTG TABLE         26450037
         MVC   D14(THRE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE            26500037
*                                                                       26550037
         LA    RJ,DXCCW12              SET UP FOR XCTL                  26600037
**                                                                      26650037
         XCTL  DE=(RWTG),SF=(E,(15))                                    26700037
**                                                                      26750037
*                                                                       26800037
*********************************************************************** 26850037
*                                                                       26900037
**                                                                      26950037
ABEN     EQU   *                                                        27000037
         L     RF,ABEND4               GET SAM ABEND ERROR CODE         27050037
         SLL   RF,12                   SET UP REGISTER 1 FOR ABEND      27100037
         ABEND (1),DUMP                                                 27150037
*                                                                       27200037
*********************************************************************** 27250037
WAOFF    EQU   32                                                       27300037
PLOFF    EQU   4                       OFFSET OF DCB ENTRIES            27350037
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            27400037
OPIDCNST DC    C'0S'                   ID                               27450037
AMIDCNST DC    C'7N'                   THIS MODULE'S ID                 27500037
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     27550037
ABEND4   DC    X'00000004'             ABEND CODE OF 4                  27600037
*                                                                       27650037
IECF03I  WTO   'IEC952I 004-0 CONFLICTING/INVALID DCB FUNC OR RELATED P*27700037
               ARAMETERS ',MF=L,ROUTCDE=(11),DESC=4                     27750037
         DS    0F                      FULLWORD BOUNDARY       @YM06152 27800037
ZAPSZAPS DC    8C'ZAPSZAPS'            WORK AREA USED BY OPEN    Y02898 27850037
IGG0197P DC    C'7P'                   MODULE ID               @YM05576 27900037
SOP5     DC    C'1G'                   MODULE ID               @YM05576 27950037
*                                                                       28000037
*                                                                       28050037
         DCBD  DSORG=PS                                                 28100037
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @YM05576 28150037
         CVT   DSECT=YES,LIST=YES                              @YM05576 28200037
         IKJTCB                                                  Y02898 28250037
         IHARB                                                   Y02898 28300037
         IHAPSA                                                  Y02898 28350037
         IEZDEB                                                         28400037
         END                                                            28450037
./  ADD  SSI=43500687,NAME=IGG0197P
         TITLE 'IGG0197P-BUILDS IOBS AND CCWS FOR 3505 AND 3525'        00100000
         START                                                          00200000
IGG0197P CSECT                                                          00300000
*********************************************************************** 00400000
* D189000,A188500-189000,A410100-410400                        @ZA01875 00420003
* D 177600,405000,574000-577000                                @YM05576 00450002
* C 175000                                                     @YM05576 00460002
* A 405700                                                     @YM05576 00470002
* D 236300,263300,392300,553000-558000,566000                  @YM06153 00475002
* C 242000,242300,244000,246000,248000,236500                  @YM06153 00480002
* A 458500,459500,410500,240500,235500,402600,490500           @YM06152 00485002
* C 498000                                                     @YM06152 00487002
*                                                                       00500000
* MODULE NAME=    IGG0197P                                              00600002
*                                                                       00700000
* DESCRIPTIVE NAME= IGG0197P-OPEN FOR 3505/3525 FEATURES                00800002
*                                                                       00900000
* STATUS CHANGE LEVEL - OS/VS2 REL 2                                    01000002
*                                                                       01300000
* MODULE TYPE=  PROCESSOR-ASSEM                                         01400002
*               ATTRIBUTES-REENTRANT,REUSABLE                           01460002
*                                                                       01520002
* FUNCTION/OPERATION--THIS ROUTINE WILL GET CORE (GETMAIN) TO SET UP    01600002
*                    THE NECESSARY IOB'S FOR THE 3505 CARD READER       01700000
*                    AND 3525 CARD PUNCH.  IT WILL CLEAR THE CORE       01800000
*                    AND LINK THE IOB'S TOGETHER.  IT WILL CONNECT      01900000
*                    THE DCB AND IOB.  IT WILL SET UP CCW'S FOR THE     02000000
*                    3505 AND 3525.  IT WILL SET UP ANY CONTROL         02100000
*                    COMMANDS NEEDED.                                   02200000
*                                                                       02300000
*                    A BIT IS SET IN THE AUDIT TRAIL TRAIL              02320002
*                    INDICATING THE IOB HAS BEEN OBTAINED AND           02340002
*                    SHOULD BE FREED IF AN ABEND OCCURS DURING          02360002
*                    OPEN PROCESSING                                    02380002
* ENTRY POINTS--      ENTERED FROM IGG0197N BY USE OF THE XCTL MACRO.   02400002
*     INPUT=      SEE DESCRIPTION OF REGISTERS.                         02600002
*                                                                       02700000
* EXITS-NORMAL--      XCTL TO IGG0197Q TO LOAD EOB, CNTRL AND NOTE      03300002
*                    POINT ID'S IN DCB.                                 03400000
*     OUTPUT=        IOB ADDRESS STORED INTO DCB                        03450002
*                                                                       03500000
* EXTERNAL REFERENCES=                                                  04010002
*     DATA AREAS-IECDSECS(O/C/E WORK AREA)                              04020002
*                IHAFCAUD(FORCE CLOSE WORK AREA)                        04030002
*     CONTROL BLOCKS=IOB-C,DCB-U,DEB,U                                  04040002
*                                                                       04050002
* TABLES=           WHERE-TO-GO TABLE                                   04100002
*                    BYTES  0- 7   NAME                                 04200000
*                    BYTES  8-10   RELATIVE DISK ADDRESS(TTR) OF        04300000
*                                  FIRST RECORD                         04400000
*                    BYTE     11   CONCATENATION NUMBER                 04500000
*                    BYTE     12   ZEROES                               04600000
*                    BYTE     13   ALIAS INDICATOR AND USER DATA        04700000
*                                  FIELD DESCRIPTOR:                    04800000
*                                      -ALIAS INDICATOR-- 1 BIT         04900000
*                                      -NUMBER OF TTRS IN USERS         05000000
*                                      DATA FIELD-- 2 BITS              05100000
*                    BYTES 14-16   TTR OF FIRST TEXT RECORD             05200000
*                    BYTE     17   ZEROES                               05300000
*                    BYTES 18-19   TTR OF NOTE LIST OR SCATTER LIST     05400000
*                    BYTE     20   TRANSLATION TABLE                    05500000
*                    BYTE     21   ZEROES OR NUMBER OF ENTRIES IN       05600000
*                                  THE NOTE LIST                        05700000
*                    BYTES 22-23   ATTRIBUTES                           05800000
*                    BYTES 24-26   TOTAL CONTIGUOUS MAIN STORAGE        05900000
*                                  REQUIRED FOR MODULE                  06000000
*                    BYTES 27-28   LENGTH OF FIRST TEXT RECORD          06100000
*                    BYTE     29   LENGTH OF WTG TABLE(IN DOUBLE        06200000
*                                  WORDS)                               06300000
*                    BYTES 30-31   PATH THROUGH LOADS OF ROUTINES       06400000
*                    BYTES 32-34   IDTTR OF EXECUTOR FOR FIRST DCB      06500000
*                    BYTE     35   ADDRESS OF STORAGE FOR DCB           06600000
*                    BYTES 36-39   TABLE OF IDTTR'S                     06700000
*                    BYTE  32+N(8)--                                    06800000
*                            IDTTR OF EXECUTOR FOR NTH DCB (3 BYTES)    06900000
*                            ADDRESS OF STORAGE FOR DCB    (1 BYTE )    07000000
*                            IDTTR OF LAST ROUTINE LOAD    (3 BYTES)    07100000
*                            NOT USED                      (1 BYTE )    07200000
*                                                                       07800000
* MACROS= GETMAIN,MODESET,XCTL                                          07820002
*                                                                       07840002
* CHANGE ACTIVITY= YM05576,YM06152,YM06153                              07860002
*********************************************************************** 07900000
*                                                                       08000000
*                                                                       08100000
*  REGISTER CONVENTIONS USED THROUGHOUT ALL OPEN PASSES                 08200000
*                                                                       08300000
*                                                                       08400000
*********************************************************************** 08500000
RDCB     EQU   2                       DCB REGISTER                     08600000
RBASE    EQU   3                       BASE REGISTER                    08700000
RCORE    EQU   4                       WORK AREA REGISTER               08800000
RPAR     EQU   5                       TOP OF PARAMETER LIST            08900000
RWTG     EQU   6                       TOP OF WTG TABLE                 09000000
RPARC    EQU   7                       CURRENT PARAMETER                09100000
RWTGC    EQU   8                       CURRENT TRANS. LOAD              09200000
RTCB     EQU   9                       ADDRESS OF CURRENT TCB    Y02898 09300002
RUCB     EQU   10                      UCB REGISTER                     09400000
RDEB     EQU   11                      DEB ADDRESS                      09500000
RB       EQU   12                      WORK REGISTER 1                  09600000
RC       EQU   13                      WORK REGISTER 2                  09700000
RD       EQU   14                      WORK REGISTER 3                  09800000
RJ       EQU   15                      WORK REGISTER 4                  09900000
RE       EQU   0                       WORK REGISTER 5                  10000000
RF       EQU   1                       WORK REGISTER 6                  10100000
*                                                                       10200000
**                 MASKS                                                10300000
*                                                                       10400000
QSAM     EQU   X'01'                                                    10500000
SUCCFUL  EQU   X'7F'                                                    10600000
UNDFIND  EQU   X'C0'                                                    10700000
FIXED    EQU   X'80'                                                    10800000
BLKBITOF EQU   X'EF'                                                    10900000
PRTONLY  EQU   X'E9'                                                    11000000
NOTRDPCH EQU   X'97'                                                    11100000
INTORPCH EQU   X'A9'                                                    11200000
FIRSTIOB EQU   X'01'                                                    11300000
CNTRLB   EQU   X'02'                                                    11400000
READONLY EQU   X'C2'                                                    11500000
CCOFF    EQU   X'BF'                                                    11600000
PRT      EQU   X'05'                                                    11700000
READPRT  EQU   X'50'                                                    11800000
PHPRT    EQU   X'30'                                                    11900000
RDFDSS   EQU   X'02'                                                    12000000
OMR      EQU   X'20'                                                    12100000
RCE      EQU   X'10'                                                    12200000
OMRCEFLG EQU   X'08'                                                    12300000
RPW      EQU   X'70'                                                    12400000
DISPSN   EQU   X'00'                                                    12500000
OUTP     EQU   X'07'                                                    12600000
ONE      EQU   X'01'                                                    12700000
TWO      EQU   X'02'                                                    12800000
THREE    EQU   3                                                        12900000
ASCII    EQU   X'04'                                                    13000000
QFOUR    EQU   X'04'                                                    13100000
QTHREE   EQU   X'03'                                                    13200000
CC       EQU   X'40'                                                    13300000
FDSS     EQU   X'23'                                                    13400000
SLI      EQU   X'20'                                                    13500000
MODE2    EQU   X'20'                                                    13600000
NOP      EQU   X'03'                                                    13700000
SLICC    EQU   X'60'                                                    13800000
WRFDSS   EQU   X'01'                                                    13900000
STACK2   EQU   X'40'                                                    14000000
PRINTX   EQU   X'04'                   PRINTER BIT MASK                 14100000
PRINTW   EQU   X'10'                   PRINT BIT MASK                   14200000
DPI      EQU   X'08'                   DPI BIT MASK                     14300000
INTRPRET EQU   X'80'                   INTERPRET DATA SET MASK          14400000
READ     EQU   X'40'                   READ DATA SET MASK               14500000
Z0       EQU   X'00'                                                    14600000
D07      EQU   7                                                        14700000
D10      EQU   10                                                       14800000
D255     EQU   X'FF'                                                    14900000
D12      EQU   12                                                       15000000
D20      EQU   20                                                       15100000
D16      EQU   16                                                       15200000
D14      EQU   14                                                       15300000
SIX      EQU   6                                                        15400000
FIVE     EQU   5                                                        15500000
D13      EQU   13                                                       15600000
D08      EQU   8                                                        15700000
X28      EQU   X'28'                                                    15800000
D24      EQU   24                                                       15900000
D37      EQU   37                                                       16000000
XC9      EQU   X'C9'                                                    16100000
DATA2    EQU   X'80'                   DATA MODE 2 MASK                 16200000
POCKET2  EQU   X'02'                   STACKER 2 MASK                   16300000
RCEMASK  EQU   X'10'                   RCE MASK                         16400000
OMRRCE   EQU   X'08'                   OMR OR RCE OP CODE FLAG          16500000
PRINTBUF EQU   64                      INTERPRET PRINT BUFFER SIZE      16600000
NOFUNC   EQU   X'00'                                                    16700000
FORTYATE EQU   X'30'                                                    16800000
*                                                                       16900000
**                                                                      17000000
***                                                                     17100000
**                                                                      17200000
*                                                                       17300000
         BALR  RBASE,RE                SET BASE                         17400000
         USING *,RBASE                                         @YM05576 17500002
         USING IHADCB,RDCB                                              17600000
         USING FORCORE,RCORE                                            17700000
         USING DEBBASIC,RDEB            SET UP BASE FOR DEB      Y02898 17730002
*                                                                       17800000
         MODID BR=YES                                                   17850002
**                                                                      17900000
NOPN21   EQU   *                                                        18000000
**                                                                      18100000
         SR    RE,RE                                                    18200000
         L     RDCB,Z0(RPARC)          GET DCB ADDR FROM PARM LIST      18300000
         L     RCORE,QFOUR(RWTGC)      GET DCB WORK AREA ADDRESS        18400000
         LA    RDCB,Z0(RDCB)           ZERO OUT HIGH ORDER BYTE         18500000
         L     RDEB,DCBDEBAD           GET ASSOCIATED DEB ADDRESSY02898 18530002
         L     RTCB,DEBTCBAD           GET CURRENT TCB ADDRESS   Y02898 18560002
         LA    RF,D07                  GET DBLWD LENGTH OF IOB & CCWS   18600000
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        18700000
         BNE   NOPN22                  NO, BRANCH                       18800000
         SR    RUCB,RUCB               CLEAR RUCB              @ZA01875 18850003
         LH    RUCB,DCBBUFL            LOAD BUFFER LENGTH      @ZA01875 18900003
         CH    RUCB,DCBBLKSI           IS BUFL > OR = BLKSIZE  @ZA01875 18904003
         BNL   NOPN211                 YES - USE BUFL          @ZA01875 18908003
         LH    RUCB,DCBBLKSI           ELSE USE BLKSIZE        @ZA01875 18912003
NOPN211  EQU  *                                                @ZA01875 18916003
         LA    RUCB,D07(RUCB)          ROUND BUF LNG TO NEXT   @ZA01875 18920003
         SRL   RUCB,THREE              HIGHEST NUMBER DBL WDS  @ZA01875 18940003
         AR    RF,RUCB                 CALCULATE TOTAL JOB     @ZA01875 18960003
*                                      LENGTH                  @ZA01875 18980003
         B     NOPN24                  BRANCH                           19000000
NOPN22   EQU   *                                                        19200000
         TM    DCBFUNC,DPI             DPI BIT ON IN DCB                19300000
         BZ    NOPN24                  NO, BR                           19400000
         LA    RF,D10(RF)              ADD 80 BYTES TO LENGTH           19500000
NOPN24   EQU   *                                                        19600000
         STC   RF,DCBIOBL              STORE IOB LENGTH IN DCB          19700000
         TM    DCBCIND2,QSAM           QSAM BEING USED                  19800000
         BZ    BSAM                    NO, BR FOR BSAM                  19900000
         IC    RE,DCBBUFNO             GET NO. OF BUFFERS REQUIRED      20000000
         B     NOPN26                  BRANCH                           20100000
BSAM     EQU   *                                                        20200000
         IC    RE,DCBNCP               GET NUMBER OF CHANNEL PROGRAMS   20300000
         LTR   RE,RE                   HAS NUMBER BEEN SPECIFIED        20400000
         BNZ   NOPN26                  YES, BRANCH                      20500000
         LA    RE,ONE                  SUPPLY ONE IOB                   20600000
         STC   RE,DCBNCP               SAVE NO. OF BUFFERS SUPPLIED     20700000
NOPN26   EQU   *                                                        20800000
         TM    DCBFUNC,PRINTW          PRINT BIT ON                     20900000
         BZ    NOPN27                  NO, BR                           21000000
         TM    DCBFUNC,PRINTX          3525 PRINTER BIT ON              21100000
         BO    NOPN30                  YES, BR                          21200000
         B     NOPN28                  BRANCH                           21300000
NOPN27   EQU   *                                                        21400000
         CLI   DCBFUNC,INTRPRET        INTERPRET FILE                   21500000
         BE    NOPN30                  YES, BRANCH                      21600000
         B     NOPN29                  OTHERWISE, CK FOR OTHER CASES    21700000
NOPN28   EQU   *                                                        21800000
         CLI   DCBFUNC,PRINTW          PRINT ONLY FILE                  21900000
         BE    NOPN30                  YES, BR                          22000000
NOPN29   EQU   *                                                        22100000
         TM    DCBCIND2,QSAM           QSAM DATA SET                    22200000
         BZ    BSAM1                   NO, BRANCH FOR BSAM              22300000
         LA    RE,ONE                  SUPPLY ONE IOB                   22400000
         STC   RE,DCBBUFNO             STORE BUFNO IN DCB               22500000
         B     NOPN30                  BRANCH                           22600000
BSAM1    EQU   *                                                        22700000
         LA    RE,ONE                  SUPPLY ONE IOB                   22800000
         STC   RE,DCBNCP               STORE IN DCB NO. CHAN. PROGS.    22900000
NOPN30   EQU   *                                                        23000000
         SLL   RF,3                    CHANGE FROM DBLWD TO BYTES       23100000
         LR    RUCB,RE                 SAVE NO. AS COUNTER              23200000
         MR    RE,RE                   COMPUTE SPACE REQUIRED           23300000
         LR    RB,RF                   SAVE FOR FUTURE USED             23400000
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE    @YM06153 23420002
*  IOBS, IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE    @YM06153 23440002
*  EXECUTOR.                                                   @YM06153 23460002
**                                                                   ** 23500000
         ST    RF,DXATEXC2             SAVE IOB LENGTH         @YM06153 23550002
*                                                                Y02898 23600002
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY           @YM05576 23610002
*                                                                Y02898 23640002
         GETMAIN R,LV=(RF),SP=250      GET CORE FOR IOB'S      @YM06153 23650002
**                                                                   ** 23700000
*                                                                     * 23800000
         LR    RJ,RB                   RESTORE LENGTH TO CLEAR          23900000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 23930002
*                                      KEY                       Y02898 23960002
         ST    RF,DCBIOBA              SAVE FIRST IOB ADDRESS           24000000
         OI    FCAOPEN,FCAOIOB         INDIC IOBS CAN BE FREED @YM06153 24050002
         BCTR  RJ,RE                   REDUCE AMOUNT BY ONE             24100000
         LA    RC,D255                 GET MAX AMT BE CLEARED  @YM06153 24200002
         MODESET KEYADDR=DXUKEY,WORKREG=12 USER KEY            @YM06153 24250002
COMPARE  EQU   *                                                        24300000
         CR    RJ,RC                   IS AMT TO CLEAR GT 255  @YM06153 24400002
         BC    12,ONECLEAR             NO,                              24500000
         EX    RC,CLEAR1               CLEAR 256 BYTES         @YM06153 24600002
*                                                                       24700000
         SR    RJ,RC                   AMT CLEARED - 255       @YM06153 24800002
         BCTR  RJ,RE                   SUBTRACT ONE MORE BYTE           24900000
         LA    RF,256(RF)              UPDATE AREA ADDRESS              25000000
         B     COMPARE                 TRYN AGAIN                       25100000
*                                                                       25200000
CLEAR1   XC    Z0(ONE,RF),Z0(RF)       CLEAR INSTRUCTION                25300000
*                                                                       25400000
ONECLEAR EQU   *                                                        25500000
         EX    RJ,CLEAR1               CLEARS LESS THAN 256             25600000
*                                                                       25700000
*********************************************************************** 25800000
*                                                                       25900000
         L     RB,DCBIOBA              GET IOB ADDRESS                  26000000
         LR    RC,RB                   SET UP WORK REGISTERS            26100000
         LR    RD,RB                                                    26200000
NOPN31   EQU   *                                                        26300000
         LTR   RUCB,RUCB               HAVE ALL IOB'S BEEN GENERATED    26400000
         BNZ   NOPN33                  NO. BRANCH                       26500000
*                                                                       26600000
         L     RB,DCBIOBA              GET FIRST IOB ADDRESS            26700000
         ST    RB,0(RD)                LINK FIRST IOB TO LAST IOB       26800000
         OI    0(RB),FIRSTIOB          SET INDICATOR                    26900000
         B     NOPN61                  BRANCH                           27000000
*                                                                       27100000
NOPN33   EQU   *                                                        27200000
*********************************************************************** 27300000
*                                                                       27400000
**             LINK  IOB'S  TOGETHER                                    27500000
*                                                                       27600000
*********************************************************************** 27700000
*                                                                       27800000
         ST    RB,0(RD)                LINK THIS IOB TO LAST IOB        27900000
         LR    RD,RB                   UPDATE WORK REGISTER             28000000
         LA    RB,QFOUR(RB)            POINT TO ECB                     28100000
         OI    0(RB),SUCCFUL           SET ECB COMPLETE WITHOUT ERROR   28200000
         ST    RB,D12(RD)              STORE ECB IN POINTER             28300000
         LA    RC,D20(RB)              PT TO CHAN PROG START ADDR       28400000
*                                                                       28500000
         LA    RB,D16(RC)              POINT TO CHANNEL PROGRAM         28600000
         ST    RB,Z0(RC)               PUT CHAN PROG ADDR IN IOB        28700000
         MVC   QFOUR(QFOUR,RC),DXUDCBAD PUT DCB ADDRESS IN IOB   Y02898 28800002
*                                                                Y02898 28850002
         MVI   D13(RC),ONE             STORE INCREMENT AMOUNT           28900000
         LR    RC,RB                   UPDATE WORK REGISTER             29000000
*                                                                       29100000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 29130002
*                                      KEY                       Y02898 29160002
         TM    DCBCIND2,QSAM           IS THIS A QSAM DCB               29200000
         BZ    NOPN37                  NO, BRANCH                       29300000
         TM    DCBRECFM,UNDFIND        UNDEFINED FORMAT                 29400000
         BNO   NOPN36                  NO, BRANCH                       29500000
         TM    DCBRECFM,FIXED           FIXED FORMAT                    29600000
         BZ    NOPN36                  NO, BRANCH                       29700000
         MVC   DCBBLKSI(TWO),DCBLRECL  REDUCE BLK SIZE TO LOG SIZE      29800000
NOPN36   EQU   *                                                        29900000
         NI    DCBRECFM,BLKBITOF       TURN OFF BOLCKED BIT IF ON       30000000
NOPN37   EQU   *                                                        30100000
         TM    DCBRECFM,ASCII          ASCII CONTROL CHAR. USED         30200000
         BZ    NOTASA                  NO,BRANCH                        30300000
         MVI   DCBCNTRL+THREE,QFOUR    MOVE ID                          30400000
         B     AROUND                  BRANCH                           30500000
NOTASA   EQU   *                                                        30600000
         MVI   DCBCNTRL+THREE,QTHREE   MOVE ID                          30700000
AROUND   EQU   *                                                        30800000
         MODESET KEYADDR=DXUKEY,WORKREG=15                     @YM05576 30830002
         OI    D08(RD),CC              SET CC FLAG ON IN IOB            30900000
*                                                                       31000000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 31030002
*                                      KEY                       Y02898 31060002
         MVI   DCBWCPO,X28             SET WRITE CHAN PROG OFFSET       31100000
         MVC   DCBWCPL(THREE),DCBWCPO  SET WRITE CHAR PROG LGTH         31200000
*********************************************************************** 31300000
*                                                                       31400000
**             BUILD CCW'S FOR IOB                                      31500000
*                                                                       31600000
*********************************************************************** 31700000
         CLI   DCBFUNC,READ            READ ONLY FILE                   31800000
         BE    NOPN52                  YES, BR                          31900000
         CLI   DCBFUNC,NOFUNC          IS THERE ANY DCB FUNC= PARAMETER 32000000
         BE    NOPN52                  NO, BRANCH                       32100000
         TM    DCBFUNC,PRTONLY         PRINT ONLY DATA SET              32200000
         BM    NOPN40                  NO, BR                           32300000
*********************************************************************** 32400000
*                                                                       32500000
**             BUILD CCW'S FOR PRINT ONLY FILE                          32600000
*                                                                       32700000
*********************************************************************** 32800000
         MODESET KEYADDR=DXUKEY,WORKREG=15    USER KEY         @YM05576 32830002
         MVI   Z0(RB),FDSS             SET FEED, SS AND IN CCW OP CODE  32900000
         OI    QFOUR(RB),SLICC         SET SLI AND CMD CHAIN FLAGS ON   33000000
         ST    RB,D24(RD)              STORE CCW PTR IN IOB             33100000
         B     NOPN49                  BRANCH                           33200000
NOPN40   EQU   *                                                        33300000
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        33400000
         BNE   NOPN40A                 BRANCH IF NOT INTERPRET FILE     33500000
*********************************************************************** 33600000
*                                                                       33700000
**             BUILD CCW'S FOR INTERPRET FILE                           33800000
*                                                                       33900000
*********************************************************************** 34000000
         MODESET KEYADDR=DXUKEY,WORKREG=15     USER KEY        @YM05576 34030002
         MVI   Z0(RB),NOP              SET NOP CMD. IN CCW              34100000
         OI    QFOUR(RB),CC            SET CMD CHAIN FLAG IN CCW        34200000
         MVI   D07(RB),ONE             SET BYTE COUNT OF ONE            34300000
         ST    RB,D24(RD)              STORE CCW PTS IN IOB             34400000
         LA    RB,D08(RB)              INCREMENT CCW PTR BY 8           34500000
         MVI   Z0(RB),WRFDSS           SET WR,FD,SS CMDS IN CCW OP      34600000
         OI    QFOUR(RB),SLICC         SET SLI AND CMD CHAIN FLAGS ON   34700000
         B     NOPN49                  BRANCH                           34800000
NOPN40A  EQU   *                                                        34900000
         TM    DCBFUNC,NOTRDPCH        IS ANYTHING SPEC OTHER THAN RP   35000000
         BM    NOPN51                  YES, BRANCH                      35100000
         TM    DISPSN(RPARC),OUTP                                       35200000
         BNO   NOPN43                  NO, BR                           35300000
OUTPUT   EQU   *                                                        35400000
*********************************************************************** 35500000
*                                                                       35600000
**             BUILD CCW'S FOR OUTPUT PORTION OF ASSOCIATED DATA SET    35700000
*                                                                       35800000
*********************************************************************** 35900000
         MODESET KEYADDR=DXUKEY,WORKREG=15    USER KEY         @YM05576 35930002
         MVI   Z0(RB),NOP              SET NOP CMD IN CCW               36000000
         OI    QFOUR(RB),CC            SET CMD CHAIN FLAG IN CCW        36100000
         MVI   D07(RB),ONE             SET BYTE COUNT OF ONE            36200000
         LA    RB,D08(RB)              POINT TO NEXT CCW                36300000
         TM    DCBMODE,DATA2           IS DATA MODE 2 SPECIFIED         36400000
         BNO   NOPN42                  NO, BRANCH                       36500000
         OI    0(RB),MODE2             NO, SET MODE 2 MODIFIER IN CCW   36600000
NOPN42   EQU   *                                                        36700000
         OI    0(RB),WRFDSS            SET WR,FD,SS CMD IN CCW          36800000
         OI    QFOUR(RB),SLI           SET SLI FLAG ON IN CCW           36900000
         TM    DCBSTACK,POCKET2        IS STACKER 2 SPECIFIED           37000000
         BNO   NOPN45                  NO, BRANCH                       37100000
         OI    Z0(RB),STACK2           TURN ON SS 2 INDICATOR           37200000
         B     NOPN45                  BRANCH                           37300000
*                                                                       37400000
NOPN43   EQU   *                                                        37500000
*********************************************************************** 37600000
*                                                                       37700000
**             SET UP INPUT PORTION OF CCW FOR ASSOCIATED DATA SET      37800000
*                                                                       37900000
*********************************************************************** 38000000
         MODESET KEYADDR=DXUKEY,WORKREG=15      USER KEY       @YM05576 38030002
         TM    DCBMODE,RCEMASK         IS RCE SPECIFIED                 38100000
         BNO   NOPN43A                 NO, BRANCH                       38200000
         OI    0(RB),OMRRCE            TURN ON OMR OR RCE FLAG          38300000
NOPN43A  EQU   *                                                        38400000
*                                                                       38500000
         TM    DCBMODE,DATA2           IS DATA MODE 2 SPECIFIED         38600000
         BNO   NOPN44                  NO, BRANCH                       38700000
         OI    0(RB),MODE2                                              38800000
NOPN44   EQU   *                                                        38900000
         OI    0(RB),READONLY          SET READ ONLY CMD IN CCW         39000000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG                 39100000
NOPN45   EQU   *                                                        39200000
         NI    D08(RD),CCOFF           TURN CMD CHAIN FLAG OFF IN IOB   39300000
*                                                                       39400000
*                                                                       39500000
*                                                                       39600000
         TM    DCBCIND2,QSAM           IS THIS A QSAM DCB               39700000
         BO    NOPN48                  YES, BRANCH                      39800000
*                                                                       39900000
         LA    RB,D08(RB)              UPDATE CHANNEL PROG. BY 1 CCW    40000000
*                                                                       40100000
NOPN48   EQU   *                                                        40200000
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 40230002
NOPN480  EQU   *                                               @YM06152 40260002
         LA    RB,D08(RB)              UPDATE CHANNEL PROG BY 1 CCW     40300000
         MVI   D37(RD),Z0              CLEAR INCREMENT AMOUNT           40400000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 40530002
*                                      KEY                       Y02898 40560002
         MVI   DCBWCPL,TWO             CHAN PROG IN DOUBLEWRDS @YM05576 40580002
         CLI   DCBFUNC,INTRPRET        INTERPRET FILE                   40600000
         BNE   NOPN48A                 NO, BRANCH                       40700000
         MVI   DCBWCPL,THREE           CHAN PROG IN DOUBLEWORDS         40800000
NOPN48A  EQU   *                                                        40900000
         BCTR  RUCB,RE                 DECREMENT COUNTER                41000000
         SR    RC,RC                   CLEAR RC                @ZA01875 41010003
         IC    RC,DCBIOBL              IOB DBL WD LENGTH       @ZA01875 41020003
         SLL   RC,THREE                IOB BYTE LENGTH         @ZA01875 41030003
         LA    RB,Z0(RC,RD)            INCREMENT TO NEXT JOB   @ZA01875 41040003
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY   @YM06152         41050002
         B     NOPN31                  GO BACK                          41100000
*                                                                       41200000
NOPN49   EQU   *                                                        41300000
*                                                                       41400000
         TM    DCBSTACK,POCKET2        IS STACKER 2 SPECIFIED           41500000
         BNO   NOPN50                  NO, BRANCH                       41600000
         OI    0(RB),STACK2            TURN ON STACKER 2 BIT            41700000
NOPN50   EQU   *                                                        41800000
         LA    RB,D08(RB)              INCRE CCW PTR BY 8               41900000
         MVI   Z0(RB),PRT              STORE PRINT CMD BYTE             42000000
         OI    QFOUR(RB),SLICC         SET SLI AND CMD CHAIN FLAGS ON   42100000
         TM    DCBFUNC,PRTONLY         IS THIS A PRINT ONLY DATA SET    42200000
         BM    NOPN50A                 NO, BRANCH                       42300000
         NI    QFOUR(RB),CCOFF         TURN OFF CC FLAG IN CCW, IF ON   42400000
NOPN50A  EQU   *                                                        42500000
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        42600000
         BNE   NOPN48                  NO, BRANCH                       42700000
         LA    RB,D08(RB)              POINT TO NEXT CCW                42800000
         MVI   Z0(RB),PRT              SET PRINT CMD IN CCW             42900000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG                 43000000
         LA    RB,PRINTBUF(RB)         POINT TO NEXT IOB PAST PRINT BUF 43100000
         B     NOPN48                  BRNACH                           43200000
*                                                                       43300000
NOPN51   EQU   *                                                        43400000
*                                                                       43500000
         TM    DCBFUNC,INTORPCH        INTRP OR PH FILE OF ANY KIND     43600000
         BM    NOPN58                  YES, BRANCH                      43700000
         TM    DCBFUNC,READPRT         IS THIS A RD/PRT ASSOC. DATA SET 43800000
         BNO   NOPN58                  NO, BRANCH                       43900000
*                                                                       44000000
NOPN52   EQU   *                                                        44100000
*                                                                       44200000
         MODESET KEYADDR=DXUKEY,WORKREG=15    USER KEY         @YM05576 44230002
         TM    DISPSN(RPARC),OUTP      OUTPUT FILE                      44300000
         BO    NOPN57                  YES, BRANCH                      44400000
*********************************************************************** 44500000
*                                                                       44600000
**             BUILD CCW'S FOR READ FILES WITH CNTRL                    44700000
*                                                                       44800000
*********************************************************************** 44900000
         TM    DCBMACRF,CNTRLB         CNTRL SPECIFIED FOR INPUT        45000000
         BNO   NOPN53                  NO, BRANCH                       45100000
         MVI   Z0(RB),NOP              SET NOP CMD IN CCW               45200000
         OI    QFOUR(RB),CC            SET CMD CHAIN FLAG ON IN CCW     45300000
         MVI   D07(RB),ONE             SET BYTE COUNT OF 1              45400000
         LA    RB,D08(RB)              POINT TO NEXT CCW                45500000
         MVI   Z0(RB),READONLY         SET A READ ONLY CMD              45600000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG IN CCW          45700000
         ST    RB,D24(RD)              STORE CHAN PROG START ADDR       45800000
         MODESET EXTKEY=DATAMGT    DATA MGMT KEY               @YM06152 45850002
         MVI   DCBOFFSR,FORTYATE       SET RD CCW OFFSET ACCORDINGLY    45900000
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY           @YM06152 45950002
         B     NOPN54                  BRANCH                           46000000
*                                                                       46100000
NOPN53   EQU   *                                                        46200000
*********************************************************************** 46300000
*                                                                       46400000
**             BUILD CCW'S FOR READ FILES WITHOUT CNTRL                 46500000
*                                                                       46600000
*********************************************************************** 46700000
*                                                                       46800000
         MVI   0(RB),RDFDSS            SET RD,FD,SS CMD IN CCW          46900000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG                 47000000
         NI    D08(RD),CCOFF           TURN OFF CMD CHAIN FLAG, IF ON   47100000
         ST    RB,D24(RD)              STORE CHAN PROG  START ADDR      47200000
NOPN54   EQU   *                                                        47300000
*                                                                       47400000
         TM    DCBMODE,DATA2           IS DATA MODE 2 SPECIFIED         47500000
         BNO   NOPN55                  NO, BRANCH                       47600000
         OI    0(RB),MODE2             SET MODE 2 BIT ON IN CCW OP CODE 47700000
NOPN55   EQU   *                                                        47800000
         TM    DCBSTACK,POCKET2        IS STACKER 2 SPECIFIED           47900000
         BNO   NOPN55A                 NO, BRANCH                       48000000
         OI    0(RB),STACK2            TURN ON STACKER 2 BIT IN OP CIDE 48100000
NOPN55A  EQU   *                                                        48200000
         TM    DCBMODE,OMR             IS OMR SPECIFIED FOR THIS DCB    48300000
         BO    NOPN56                  YES, BRANCH                      48400000
         TM    DCBMODE,RCE             IS RCE SPECIFIED                 48500000
         BNO   NOPN48                  NO, BRANCH                       48600000
NOPN56   EQU   *                                                        48700000
         OI    0(RB),OMRCEFLG          TURN OMR/RCE FLAG ON IN CCW OP   48800000
         B     NOPN48                  BRANCH                           48900000
NOPN57   EQU   *                                                        49000000
         MODESET KEYADDR=DXUKEY,WORKREG=15  SET USER KEY       @YM06152 49050002
         MVI   0(RB),NOP               SET NOP CMD. IN CCW              49100000
         OI    QFOUR(RB),CC            SET CMD CHAIN IN CCW             49200000
         MVI   D07(RB),ONE             SET BYTE COUNT OF ONE            49300000
         LA    RB,D08(RB)              POINT TO NEXT CCW                49400000
         NI    D08(RD),CCOFF           TURN OFF CC FLAG IF ON           49500000
         MVI   Z0(RB),PRT              SET PRT CMD IN CCW OP CODE       49600000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG IN CCW          49700000
         B     NOPN480                 BRANCH                  @YM06152 49800002
*                                                                       49900000
NOPN58   EQU   *                                                        50000000
         TM    DCBFUNC,XC9             IS THIS A PRT FILE OF ANY KIND   50100000
         BM    NOPN59                  NO, BR ANCH                      50200000
         TM    DCBFUNC,PHPRT           PH/PRT ASSOCIATED DATA SET       50300000
         BNO   NOPN59                  NO, BRANCH                       50400000
         B     NOPN60                  BRANCH                           50500000
*                                                                       50600000
NOPN59   EQU   *                                                        50700000
*                                                                       50800000
*        RD/PCH/PRT ASSOCIATED DATA SET ASSUMED                         50900000
*                                                                       51000000
         TM    DISPSN(RPARC),OUTP      IS THIS AN OUTPUT FILE           51100000
         BNO   NOPN43                  NO,BRANCH                        51200000
NOPN60   EQU   *                                                        51300000
         TM    DCBFUNC,PRINTX          PRINTER DEVICE SPECIFIED         51400000
         BO    NOPN57                  YES, BRANCH                      51500000
         B     OUTPUT                  BRANCH TO OUTPUT                 51600000
*                                                                       51700000
NOPN61   EQU   *                                                        51800000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 51830002
*                                      KEY                       Y02898 51860002
         MVC   Z0(FIVE,RWTGC),IGG0197Q SET ID OF NEXT EXECUTOR          51900000
*                                                                     * 52000000
**                                                                   ** 52100000
*********************************************************************** 52200000
**                                                                   ** 52300000
*                                                                     * 52400000
RELOOP   EQU   *                                                        52500000
         LA    RWTGC,WGOFF(Z0,RWTGC)   INCRE CURR WTG ENTRY             52600000
         LA    RPARC,PLOFF(Z0,RPARC)   INCRE CURR DCB ENTRY PTR         52700000
         CLC   Z0(TWO,RWTGC),AMIDCNST  IS THIS ROUTINE NEEDED AGAIN     52800000
         BCR   RWTGC,RBASE             BAKC TO OPEN CONTROL ROUTINE     52900000
*                                                                       53000000
         CLC   Z0(TWO,RWTGC),OPIDCNST  END OF TABLE                     53100000
         BC    7,RELOOP                NO, CHECK NEXT ENTRY             53200000
*                                                                       53300000
         LR    RPARC,RPAR                                               53400000
         LA    RWTGC,WAOFF(Z0,RWTG)    REINITIALIZE WTG LIST PTR        53500000
ZCHEK    CLI   0(RWTGC),X'00'          IS ENTRY COMPLETE                53600000
         BC    7,TCTLRTN               NO, TRANSFER CONTROL             53700000
*                                                                       53800000
         LA    RWTGC,WGOFF(Z0,RWTGC)   GET NEXT ENTRY                   53900000
         LA    RPARC,PLOFF(Z0,RPARC)   GET NEXT ENTRY                   54000000
         B     ZCHEK                   ZERO CHECK                       54100000
*                                                                       54200000
TCTLRTN  EQU   *                                                        54300000
         MVC   SIX(TWO,RWTG),Z0(RWTGC) STORE ID IN WTG TABLE            54400000
         MVC   D14(THREE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE           54500000
*                                                                       54600000
         LA    RJ,DXCCW12              SET UP FOR XCTL                  54700000
**                                                                      54800000
         XCTL  DE=(RWTG),SF=(E,(15))                                    54900000
**                                                                      55000000
*                                                                       55100000
*********************************************************************** 55200000
*                                                                       55900000
WAOFF    EQU   32                                                       56000000
PLOFF    EQU   4                       OFFSET OF DCB ENTRIES            56100000
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            56200000
OPIDCNST DC    C'0S'                   ID                               56300000
AMIDCNST DC    C'7P'                   ID                               56400000
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     56500000
*                                                                       56700000
*********************************************************************** 56800000
*                                                                       56900000
*                                                                       57000000
*                                                                       57100000
ZAPSZAPS DC    8C'ZAPSZAPS'            WORK AREA USED BY OPEN    Y02898 57200002
IGG0197Q DC    C'7Q    '               IDTTRL                           57300000
*                                                                       57350002
*                                                                       57400002
         DCBD  DSORG=PS                                                 57800000
         IEZDEB                                                         57900000
         IECDSECS MAIN,EXPAND=YES                                Y02898 58000002
         IKJTCB                                                  Y02898 58060002
         IHARB                                                   Y02898 58120002
FORCORE  DSECT                                                 @YM06153 58140002
         IHAFCAUD  ORG=YES                                     @YM06153 58170002
         END                                                            58200000
./  ADD  SSI=40981296,NAME=IGG0197Q
         TITLE 'IGG0197Q LOAD DPI IMAGE,LOAD ID OF EOB,CNTRL IN DCB'    00200000
         START                                                          00400000
IGG0197Q CSECT                                                          00600000
*********************************************************************** 00800000
* D 324500,333000,690400-690900,691100,799000,81600-822000     @YM05576 00900002
* A 324500                                                     @YM05576 00950002
* A 463920,464500,562300                                       @YM06152 00960002
* D 690100-690300,691400-691500,691900,448600,464600,562600    @YM06152 00980002
* D 691200,572600                                              @YM06152 00986002
* D 465000,6900000-691800,694000-700000                                 00992002
*                                                                       01000000
* MODULE NAME=          IGG0197Q                                        01200002
*                                                                       01400000
* DESCRIPTIVE NAME= IGG0197Q - 3505/3525 OPEN ROUTINE                   01600002
*                                                                       01800000
* STATUS CHANGE LEVEL - OS/VS REL 2                                     02000002
*                                                                       02200000
* MODULE TYPE= PROCESSOR - ASSEM                                        03000002
*             ATTRIBUTES - REENTRANT, REUSABLE                          03050002
*                                                                       03100002
* NOTES= PATCH-LABEL=ZAPSZAPS                                           03150002
*                                                                       03200000
* FUNCTION=          THIS ROUTINE IS ENTERED FOR SAM USERS DURING       03400002
*                    OPEN WHEN:                                         03600000
*                             DEVICE ASSOCIATED DATA SETS(DADS) HAVE    03800000
*                             BEEN SPECIFIED.                           04000000
*                             OPTICAL MARK READ(OMR) OR READ COLUMN     04200000
*                             ELIMINATE(RCE)  HAVE BEEN SPECIFIED.      04400000
*                             DATA PROTECTION IMAGE(DPI) HAS BEEN       04600000
*                             SPECIFIED.                                04800000
*        OPERATION= IT LOADS THE DPI IMAGE FROM IMAGELIB. IT            05000002
*                    DETERMINES WHAT EOB,CNTRL MACRO AND/OR NOTE        05200000
*                    POINT ROUTINES ARE NEEDED FOR PROPER EXECUTION     05400000
*                    AND SETS UP A CODE IN THE DCBCNTRL FIELD OF        05600000
*                    THE DCB.                                           05800000
*                                                                       06000000
* ENTRY POINT--       ENTERED FROM IGG0197P BY USE OF THE XCTL MACRO.   06200002
*     INPUT--         SEE DESCRIPTION OF REGISTERS                      06600002
*                                                                       06800000
* EXITS NORMAL--      XCTL TO IGG01910                                  08000002
*     OUTPUT=  THE DATA PROTECTION IMAGE IS STORED IN AN AREA           08030002
*              THAT IMMEDIATELY FOLLOWS THE IOB AND CCW'S               08060002
*                                                                       08200000
* EXITS-ERROR--       004 ABEND - DATA PROTECTION IMAGE NOT FOUND.      08400002
*                    REG 15 WILL CONTAIN A RETURN CODE OF 6 TO          08600000
*                    INDICATE THIS CONDITION.                           08800000
*                                                                       09000000
* TABLES=            WHERE-TO-GO TABLE                                  09200002
*                    BYTES  0- 7   NAME                                 09400000
*                    BYTES  8-10   RELATIVE DISK ADDRESS(TTR) OF        09600000
*                                  FIRST RECORD                         09800000
*                    BYTE     11   CONCATENATION NUMBER                 10000000
*                    BYTE     12   ZEROES                               10200000
*                    BYTE     13   ALIAS INDICATOR AND USER DATA        10400000
*                                  FIELD DESCRIPTOR:                    10600000
*                                      -ALIAS INDICATOR-- 1 BIT         10800000
*                                      -NUMBER OF TTRS IN USERS         11000000
*                                      DATA FIELD-- 2 BITS              11200000
*                    BYTES 14-16   TTR OF FIRST TEXT RECORD             11400000
*                    BYTE     17   ZEROES                               11600000
*                    BYTES 18-19   TTR OF NOTE LIST OR SCATTER LIST     11800000
*                    BYTE     20   TRANSLATION TABLE                    12000000
*                    BYTE     21   ZEROES OR NUMBER OF ENTRIES IN       12200000
*                                  THE NOTE LIST                        12400000
*                    BYTES 22-23   ATTRIBUTES                           12600000
*                    BYTES 24-26   TOTAL CONTIGUOUS MAIN STORAGE        12800000
*                                  REQUIRED FOR MODULE                  13000000
*                    BYTES 27-28   LENGTH OF FIRST TEXT RECORD          13200000
*                    BYTE     29   LENGTH OF WTG TABLE(IN DOUBLE        13400000
*                                  WORDS)                               13600000
*                    BYTES 30-31   PATH THROUGH LOADS OF ROUTINES       13800000
*                    BYTES 32-34   IDTTR OF EXECUTOR FOR FIRST DCB      14000000
*                    BYTE     35   ADDRESS OF STORAGE FOR DCB           14200000
*                    BYTES 36-39   TABLE OF IDTTR'S                     14400000
*                    BYTE  32+N(8)--                                    14600000
*                            IDTTR OF EXECUTOR FOR NTH DCB (3 BYTES)    14800000
*                            ADDRESS OF STORAGE FOR DCB    (1 BYTE )    15000000
*                            IDTTR OF LAST ROUTINE LOAD    (3 BYTES)    15200000
*                            NOT USED                      (1 BYTE )    15400000
*                                                                       16600000
* EXTERNAL REFERENCES=                                                  16610002
*     ROUTINES= SVC 69(IMAGELIB ADDR), SVC 13(ABEND)                    16620002
*     DATA AREAS= IECDSECS(O/C/E WORK AREA)                             16630002
*     CONTROL BLOCKS= DCB-M,DEB-U                                       16640002
*                                                                       16650002
* MACRO= BLDL,XCTL,DELETE,LOAD,WTO                                      16660002
*                                                                       16670002
* CHANGE ACTIVITY= YM05576,YM06152                                      16680002
*                                                                       16690002
* MESSAGES= IEC953I  004-6 DATA PROTECTION IMAGE NOT FOUND              16700002
*********************************************************************** 16800000
*********************************************************************** 17000000
*                                                                       17200000
*        REGISTER CONVENTIONS                                           17400000
*                                                                       17600000
*********************************************************************** 17800000
*                                                                       18000000
RDCB     EQU   2                       DCB REGISTER                     18200000
RBASE    EQU   3                       BASE REGISTER                    18400000
RCORE    EQU   4                       WORK AREA REGISTER               18600000
RPAR     EQU   5                       TOP OF PARAMETER LIST            18800000
RWTG     EQU   6                       TOP OF WTG TABLE                 19000000
RPARC    EQU   7                       CURRENT PARAMETER                19200000
RWTGC    EQU   8                       CURRENT TRANS LOAD               19400000
RTCB     EQU   9                       ADDRESS OF CURRENT TCB    Y02898 19600002
RUCB     EQU   10                      USED HERE AS WORK REGISTER       19800000
RDEB     EQU   11                      DEB ADDRESS                      20000000
RB       EQU   12                      WORK REG1                        20200000
RC       EQU   13                      WORK REG2                        20400000
RD       EQU   14                      WORK REG3                        20600000
RJ       EQU   15                      WORK REG4                        20800000
RE       EQU   0                       WORK REG5                        21000000
RF       EQU   1                       WORK REG6                        21200000
*                                                                       21400000
*                                                                       21600000
DPI      EQU   X'08'                                                    21800000
FOUR     EQU   X'04'                                                    22000000
THREE    EQU   X'03'                                                    22200000
TWO      EQU   X'02'                                                    22400000
ONE      EQU   X'01'                                                    22600000
ZERO     EQU   X'00'                                                    22800000
ATE      EQU   X'08'                                                    23000000
PRTONLY  EQU   X'10'                                                    23200000
INTRPRET EQU   X'80'                                                    23400000
RDPUNCH  EQU   X'60'                                                    23600000
CNTRLB   EQU   X'02'                                                    23800000
ASCII    EQU   X'04'                                                    24000000
UTF      EQU   X'02'                                                    24200000
RDPRT    EQU   X'50'                                                    24400000
PHPRT    EQU   X'30'                                                    24600000
RPW      EQU   X'70'                                                    24800000
RDONLY   EQU   X'40'                                                    25000000
PHONLY   EQU   X'20'                                                    25200000
PRTOMSK  EQU   X'E9'                                                    25400000
EOBDPI   EQU   X'15'                                                    25600000
EOBPRT1  EQU   X'16'                                                    25800000
EOBPRT2  EQU   X'17'                                                    26000000
NCNTRL   EQU   X'18'                                                    26200000
OUTP     EQU   X'0F'                                                    26400000
CE       EQU   X'03'                                                    26600000
CF       EQU   X'04'                                                    26800000
CC       EQU   X'02'                                                    27200000
CA       EQU   X'07'                                                    27400000
IPDZ     EQU   X'A9'                                                    27600000
IRDZ     EQU   X'C9'                                                    27800000
PRINTX   EQU   X'04'                                                    28000000
GETRD    EQU   X'60'                                                    28200000
PUTWRT   EQU   X'60'                                                    28400000
*                                                                       28600000
INPUT    EQU   X'0F'                   DEB INPUT MASK                   28800000
GETMOVE  EQU   X'50'                   GET AND MOVE MASK                29000000
RW       EQU   X'50'                                                    29200000
RP       EQU   X'60'                                                    29400000
SW       EQU   X'10'                                                    29600000
**                                                                      29800000
SVC105   EQU   X'69'                                                    30000000
SIXTY    EQU   60                                                       30200000
SVC35    EQU   X'23'                                                    30400000
SIX      EQU   6                                                        30600000
FIFTY6   EQU   56                                                       30800000
EIGHTY   EQU   80                                                       31000000
FIVE     EQU   5                                                        31200000
FOUR10   EQU   14                                                       31400000
***                                                                     31600000
****                                                                    31800000
***                                                                     32000000
**                                                                      32200000
         BALR  RBASE,RE                LOAD BASE ADDRESS IN BASE REG    32400000
         USING *,RBASE                 SET UP BASE FOR PGM     @YM05576 32450002
         USING WTG,RWTG                SET UP BASE FOR WTG     @YM05576 32500002
         USING IHADCB,RDCB             SET UP BASE FOR DCB DSECT        32800000
         USING FORCORE,RCORE           SET UP BASE FOR FORCORE DSECT    33000000
         USING DEBBASIC,RDEB           SET UP BASE FOR DEB DSECT        33200000
         USING TCB,RTCB                BASE REGISTER FOR TCB     Y02898 33300002
*                                                                       33400000
         MODID BR=YES                                          @YM05576 33460002
*                                                                       33520002
DPI100   EQU   *                                                        33600000
*                                                                       33800000
         SR    RE,RE                   INITIALIZE                       34000000
         L     RDCB,0(RPARC)           GET DCB ADDRESS                  34200000
         LA    RDCB,0(RDCB)            CLEAR HI BYTE                    34400000
         L     RCORE,FOUR(RWTGC)       GET WORK AREA ADDRESS            34600000
         L     RDEB,DCBDEBAD           GET DEB @ FROM DCB               34800002
         L     RTCB,DEBTCBAD           GET CURRENT TCB ADDRESS   Y02898 34900002
         TM    DCBFUNC,DPI             DPI SPECIFIED                    35000000
         BNO   DPI140                  NO, BRANCH FOR MORE TESTS        35200000
DPI110   EQU   *                                                        35400000
         SR    RF,RF                   ZERO OUT REGISTER 1              35600000
*                                                                       35800000
         SVC   SVC105                  ISSUE SVC FOR IMAGELIB DCB ADDR  36000000
         LTR   RF,RF                   CK IF DCB ADDRESS IN REG 1       36200000
         BE    ABEN                    IF NOT GO ABEND                  36400000
*                                                                       36600000
         LR    RD,RF                   SAVE IMAGELIB DCB ADDR.          36800000
         MVC   DXCCW1(FOUR),BLDLCNST   MOVE BLDL LENGTH INTO BLDL LIST  37000000
         MVC   DXCCW1+FOUR(FOUR),FORMCNST   INSERT NAME FOR BLDL        37200000
         MVC   DXCCW1+ATE(FOUR),JFCFCBID    GET IMAGE NAME FROM JFCB    37400000
         OC    DXCCW1+ATE(FOUR),ORCNST  BLANK OUT NON-CHAR. COLUMNS     37600000
         LA    RE,DXCCW1               GET ADDRESS OF BLDL LIST         37800000
*********************************************************************** 38000000
*  THE ADDRESS OF THE IMAGELIB DCB WILL BE RETURNED IN REGISTER 1       38200000
*********************************************************************** 38400000
         BLDL  (1),(0)                 BUILD THE IMAGE INTO CORE        38600000
*********************************************************************** 38800000
*   TEST RETURN CODE IN REG. 15 (RJ) AND CHECK FOR THE FOLLOWING:       39000000
*                            X'00'--- IMAGE FOUND                       39200000
*                            X'04'--- IMAGE NOT FOUND                   39400000
*                            X'08'--- PERMANENT I/O ERROR               39600000
*********************************************************************** 39800000
*                                                                       40000000
         LA    RB,FOUR                 SET UP TO TEST RETURN CODE       40200000
         CLR   RB,RJ                   TEST RETURN CODE                 40400000
         BE    DPI120                  RETURN CODE = IMAGE NOT FOUND    40600000
         BH    DPI130                  IMAGE FOUND, CONTINUE NORMAL WRK 40800000
***************************  PERMANENT ERROR ************************** 41000000
*********************************************************************** 41200000
         B     ABEN                    BRANCH TO ISSUE ABEND            41400000
DPI120   EQU   *                                                        41800000
         MVC   MESSAGEA(SIXTY),IECF04I MOVE IN ERROR MESSAGE            42000000
         LA    RF,MESSAGEA              GET ADDRESS OF ERROR MESSAGE    42200000
         SVC   SVC35                   ISSUE ERROR MESSAGE              42400000
         LA    RJ,SIX                  INDICATE 'DPI IMAGE NOT FOUND'   42600000
*              ERROR CODE TO BE PASSED TO USER VIA REG. 15              42800000
*********************************************************************** 43000000
         B     ABEN                    BRANCH TO ISSUE ABEND            43200000
*                                                                       43400000
DPI130   EQU   *                                                        43600000
*                                                                       43800000
*  IMAGE WAS FOUND AND NO ERRORS WERE ENCOUNTERED                       44000000
*                                                                       44200000
         LR    RF,RD                   GET SYS1.IMAGELIB DCB ADDRESS    44400000
         LA    RE,DXCCW1+FOUR          GET ADDRESS OF BLDL NAME         44600000
*                                                                       44800000
         LOAD  DE=(0),DCB=(1)          GET IMAGE FROM IMAGELIB          45000000
*                                                                       45200000
*   THE IMAGE ADDRESS IS STORED IN REGISTER 0 BY THE 'LOAD' MACRO       45400000
*                                                                       45600000
         LR    RB,RE                   SAVE IMAGE ADDR. FOR LATER OPS   45800000
         L     RC,DCBIOBA              GET IOB PREFIX ADDRESS           46000000
         LA    RC,FIFTY6(RC)           POINT PASS IOB AND CCW'S         46200000
*                                                              @YM06152 46220002
*   THE DPI IMAGE OBTAINED VIA THE LOAD IS PUT INTO USER KEY.  @YM06152 46240002
*   THE KEY IS CURRENTLY OBTAINED FROM THE TCB WHICH IS THE    @YM06152 46260002
*   USER'S KEY. THEREFORE, THE LOAD MAY BE ISSUED IN DM KEY    @YM06152 46280002
*   BUT THE MOVE MUST BE IN USER KEY.                          @YM06152 46300002
*                                                              @YM06152 46320002
         MODESET KEYADDR=DXUKEY,WORKREG=15  GET IN USER KEY    @YM06152 46340002
         MVC   ZERO(EIGHTY,RC),ZERO(RB) PUT DPI IMAGE BEHIND IOB & CCW  46400000
*                                                                       46460002
         MODESET EXTKEY=DATAMGT       GET IN DATA MGT KEY      @YM06152 46520002
*                                                                       46600000
DPI140   EQU   *                                                        46800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 47000000
*        THIS ROUTINE WILL SET A FIRST TIME SWITCH WHICH WILL BE USED   47200000
*        AND RESET BY THE "GET" MODULE IGG019AC                         47400000
*                                                                       47600000
         TM    DEBOPATB,INPUT          INPUT DATA SET                   47800000
         BO    DPI145                  NO, BRANCH                       48000000
         BM    DPI145                  NO, BRANCH                       48200000
         TM    DCBMACRF,GETMOVE         IS QSAM IN MOVE MODE BEING USED 48400000
         BNO   DPI145                  NO, BRANCH                       48600000
         TM    DCBFUNC,RW              READ/PRINT DATA SET              48800000
         BO    DPI143                  YES, BRANCH                      49000000
         TM    DCBFUNC,RP              READ/PUNCH DATA SET              49200000
         BNO   DPI145                  NO, BRANCH                       49400000
DPI143   EQU   *                                                        49600000
         OI    DCBQSWS,SW              SET FIRST TIME SWITCH            49800000
DPI145   EQU   *                                                        50000000
*                                                                       50200000
         TM    DCBFUNC,PRTOMSK         PRINT ONLY ASSOCIATED DATA SET   50400000
         BM    DPI160                  NO, BRANCH                       50600000
         TM    DCBFUNC,PRTONLY         PRINT ONLY DATA SET              50800000
         BNO   DPI160                  NO, BR FOR OTHER POSSIBILITIES   51000000
*                                                                       51200000
DPI150   EQU   *                                                        51400000
*                                                                       51600000
         MVI   DCBCNTRL+THREE,EOBPRT1  MOVE ID OF DDD2 INTO DCB         51800000
DPI155   EQU   *                                                        52000000
         TM    DCBMACRF+ONE,CNTRLB     IS  CNTRL   SPECIFIED FOR OUTPUT 52200000
         BNO   DPI280                  NO, BRANCH TO EXIT               52400000
         MVI   DCBCNTRL,NCNTRL         YES, MOVE CNT4 ID INTO DCB       52600000
         B     DPI280                  BRANCH TO TRANSFER CONTROL       52800000
*                                                                       53000000
DPI160   EQU   *                                                        53200000
*                                                                       53400000
         CLI   DCBFUNC,INTRPRET        INTERPRET ASSOC. DATA SET        53600000
         BNE   DPI170                  NO, BRANCH FOR OTHER TESTS       53800000
         MVI   DCBCNTRL+THREE,EOBPRT2  YES, MOVE DDE2 ID INTO DCB       54000000
         B     DPI280                  BRANCH TO LOAD ID OF EXEC        54200000
*                                                                       54400000
DPI170   EQU   *                                                        54600000
*                                                                       54800000
         TM    DCBFUNC,RPW             RD/PUNCH/PRT ASSOC. DATA SET     55000000
         BO    DPI260                  YES, BRANCH                      55200000
         TM    DCBFUNC,RDPUNCH         RD/PH ASSOCIATED DATA SET        55400000
         BNO   DPI230                  NO, BRANCH                       55600000
         TM    DEBOPATB,OUTP           DCB FOR OUTPUT                   55800000
         BNO   DPI210                  NO, BRANCH                       56000000
DPI180   TM    DCBFUNC,DPI             DPI SPECIFIED                    56200000
         BNO   DPI190                  NO, BRANCH              @YM06152 56230002
         LR    RF,RD                   RESTORE IMAGELIB DCB ADDR IN R.1 56600000
         SVC   SVC105                  ISSUE SVC FOR IMAGELIB DCB ADDR  56800000
         LR    RE,RB                   YES, RELOAD IMAGE ADDR. IN REG 0 57000000
         DELETE EPLOC=(0)              DELETE DPI DESCRIPTOR IMAGE      57200000
*                                      KEY                       Y02898 57320002
         MVI   DCBCNTRL+THREE,EOBDPI   MOVE DDC2 ID INTO DCB            57400000
         B     DPI280                  BRANCH TO LOAD ID OF EXEC        57600000
DPI190   EQU   *                                                        57800000
         TM    DCBRECFM,ASCII          ASCII CONTROL CHAR. SPECIFIED    58000000
         BNO   DPI200                  NO, BRANCH TO LOAD ANOTHER ID    58200000
         MVI   DCBCNTRL+THREE,CF       LOAD DDB2 ID INTO DCB            58400000
         B     DPI280                  BRANCH TO LOAD ID OF EXEC        58600000
DPI200   MVI   DCBCNTRL+THREE,CE       LOAD DDA2 ID INTO DCB            58800000
         B     DPI155                  BRANCH TO CHECK FOR CNTRL        59000000
DPI210   EQU   *                                                        59200000
         MVI   DCBCNTRL+THREE,CC       LOAD EGP2 ID INTO DCB            59400000
         B     DPI280                  BRANCH TO LOAD ID OF EXEC        59600000
*                                                                       59800000
DPI230   EQU   *                                                        60000000
*                                                                       60200000
         TM    DCBFUNC,IPDZ            RD/PRT  ASSOCIATED DATA SET      60400000
         BM    DPI250                  NO, BRANCH                       60600000
         TM    DCBFUNC,RDPRT           RD/PRT ASSOCIATED DATA SET       60800000
         BNO   DPI250                  NO, BRANCH                       61000000
         TM    DEBOPATB,OUTP           OUTPUT DATA SET                  61200000
         BO    DPI150                  YES, BRANCH                      61400000
DPI240   EQU   *                                                        61600000
         TM    DCBMACRF,CNTRLB         CNTRL SPECIFIED FOR INPUT        61800000
         BNO   DPI210                  NO, BRANCH                       62000000
         MVI   DCBCNTRL,CA             YES, MOVE CNT1 ID INTO DCB       62200000
         B     DPI210                  BRANCH TO LOAD EOB ID IN DCB     62400000
*                                                                       62600000
DPI250   EQU   *                                                        62800000
*                                                                       63000000
         TM    DCBFUNC,IRDZ            ANY FILE EXCEPT PNCH/PRT         63200000
         BM    DPI270                  YES, BRANCH                      63400000
         TM    DCBFUNC,PHPRT           PUNCH/PRT ASSOCIATED DATA SET    63600000
         BNO   DPI270                  NO, BRANCH                       63800000
         TM    DCBFUNC,PRINTX          OUTPUT FOR PRINT                 64000000
         BO    DPI150                  YES, BRANCH                      64200000
         B     DPI190                  OUTPUT FOR PUNCH                 64400000
*                                                                       64600000
DPI260   EQU   *                                                        64800000
*                                                                       65000000
         TM    DEBOPATB,OUTP           OUTPUT FILE                      65200000
         BNO   DPI210                  NO, BRANCH                       65400000
         TM    DCBFUNC,PRINTX          PRINT OUTPUT FILE                65600000
         BO    DPI150                  YES, BRANCH                      65800000
         B     DPI180                  OUTPUT FOR PUNCH                 66000000
*                                                                       66200000
DPI270   EQU   *                                                        66400000
*                                                                       66600000
         CLI   DCBFUNC,RDONLY          READ ONLY DATA SET               66800000
         BE    DPI240                  YES, BRANCH                      67000000
         CLI   DCBFUNC,PHONLY          PUNCH ONLY DATA SET              67200000
         BE    DPI190                  YES, BRANCH                      67400000
         TM    DCBMACRF,GETRD          GET OR READ SPEC. IN DCB         67600000
         BM    DPI240                  YES, BRANCH                      67800000
         TM    DCBMACRF+ONE,PUTWRT     PUT OR WRITE SPECIFIED IN DCB    68000000
         BM    DPI190                  YES, BRANCH                      68200000
         B     ABEN                    BRANCH TO ISSUE ABEND            68400000
*                                                                       68600000
DPI280   EQU   *                                                        68800000
         MVC   ZERO(FIVE,RWTGC),SOPSLDFT XCTL TO LOAD IGG01910          69200000
*                                                                       70200000
RELOOP   EQU   *                                                        70400000
         LA    RWTGC,WGOFF(ZERO,RWTGC) INCREMENT CURRENT WTG ENTRY      70600000
         LA    RPARC,PLOFF(ZERO,RPARC) INCR CURRENT DCB ENTRY POINTER   70800000
         CLC   ZERO(TWO,RWTGC),AMIDCNST THIS ROUTINE NEEDED AGAIN       71000000
         BCR   RWTGC,RBASE             BACK TO OPEN CONTROL ROUTINE     71200000
*                                                                       71400000
         CLC   ZERO(TWO,RWTGC),OPIDCNST END OF TABLE                    71600000
         BC    7,RELOOP                NO, CHECK NEXT ENTRY             71800000
*                                                                       72000000
         LR    RPARC,RPAR                                               72200000
         LA    RWTGC,WAOFF(ZERO,RWTG)  REINITIALIZE WTG LIST POINTER    72400000
ZCHEK    CLI   0(RWTGC),ZERO           ENTRY COMPLETE                   72600000
         BC    7,TCTLRTN               IF NOT, TRANSFER CONTROL         72800000
*                                                                       73000000
         LA    RWTGC,WGOFF(ZERO,RWTGC) GET NEXT ENTRY                   73200000
         LA    RPARC,PLOFF(ZERO,RPARC) INCR CURRENT DCB ENTRY PTR       73400000
         B     ZCHEK                   ZERO CHECK                       73600000
*                                                                       73800000
TCTLRTN  EQU   *                                                        74000000
         MVC   SIX(TWO,RWTG),ZERO(RWTGC) STORE ID IN WTG TABLE          74200000
         MVC   FOUR10(THREE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE        74400000
*                                                                       74600000
         LA    RJ,DXCCW12              SET UP FOR XCTL                  74800000
**                                                                      75000000
         XCTL  DE=(RWTG),SF=(E,(15))                                    75200000
*                                                                       75400000
**                                                                      75600000
***                                                                     75800000
*********************************************************************** 76000000
*                                                                       76200000
ABEN     EQU   *                                                        76400000
*                                                                       76600000
         L     RF,ABEND4               GET ABEND CODE                   76800000
         SLL   RF,12                                                    77000000
         ABEND (1),DUMP                                                 77200000
*                                                                       77400000
*********************************************************************** 77600000
*                                                                       77800000
WAOFF    EQU   32                                                       78000000
PLOFF    EQU   4                       OFFSET OF DCB ENTRIES            78200000
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            78400000
OPIDCNST DC    C'0S'                   ID                               78600000
AMIDCNST DC    C'7Q'                   THIS MODULE'S ID                 78800000
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     79000000
ABEND4   DC    X'00000004'             ABEND CODE OF 4                  79200000
BLDLCNST DC    X'00010050'             INFO REQUIRED FOR BLDL LIST      79400000
FORMCNST DC    C'FORM'                 FIRST 4 CHAR OF IMAGE NAME       79600000
ORCNST   DC    X'40404040'             BLANKS FOR IMAGE NAME            79800000
IECF04I  WTO   'IEC953I 004-6 DATA PROTECTION IMAGE NOT FOUND',ROUTCDE=*80000000
               (11),DESC=4,MF=L                                         80200000
*                                                                       80400000
*********************************************************************** 80600000
*                                                                       80800000
         DS    0F                      FULLWORD BOUNDARY       @YM06152 81000002
ZAPSZAPS DC    8C'ZAPSZAPS'            WORK AREA USED BY OPEN    Y02898 81200002
SOPSLDFT DC    C'10'               ID                          @YM05576 81400002
*********************************************************************** 82400000
*************************       DSECTS       ************************** 82600000
*********************************************************************** 82800000
*                                                                       83000000
*                                                                       83200000
         DCBD  DSORG=PS                                                 83400000
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @YM05576 83600002
         CVT   DSECT=YES,LIST=YES                              @YM05576 83650002
         IHARB                                                   Y02898 83700002
         IKJTCB                                                  Y02898 83800002
         IEZDEB                                                         84000000
         END                                                            84200000
./  ADD  SSI=82060237,NAME=IGG0201P
         TITLE 'IGG0201P-CLOSE EXECUTOR FOR 3505 OMR AND RCE, AND 3525' 00050037
         START                                                          00100037
IGG0201P CSECT                                                          00150037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00200037
*                                                       @ZA08168        00250037
* C 152000,159000                                              @ZA03830 00300037
* C 155000                                                     @ZA00861 00350037
* D 321200,344400,368300                                       @YM06152 00400037
* D 210500-220000,443400,204450,189500,413000,415000-416000    @YM06152 00450037
* D 507000-510000                                              @YM05576 00500037
* C 204450                                                     @YM05576 00550037
* C 1682000,1747000,1817000,1867000,1927000,19920000,20520000, @ZA29896 00560037
* C 2112000,2192000                                            @ZA29896 00570037
* A 235500-235850,252000-252350                                @ZA33956 00580037
*                                                                       00600037
*                                                                       00650037
* MODULE NAME= IGG0201P                                                 00700037
*                                                                       00750037
* DESCRIPTIVE NAME= CLOSE EXECUTOR FOR 3525 ASSOCIATED DATA SETS OR     00800037
*                   3505 WITH OMR OR RCE USING BSAM AND QSAM            00850037
*                                                                       00900037
* COPYRIGHT= NONE                                                       00950037
*                                                                       01000037
* STATUS = OS/VS2 REL. 3                                                01050037
*                                                                       01100037
* FUNCTION= THIS IS THE FIRST HALF OF THE CLOSE ROUTINE USED WHEN       01150037
*              OMR OR RCE IS SPECIFIED FOR THE 3505 AND WHEN            01200037
*              CLOSING 3525 ASSOCIATED DATA SETS.                       01250037
*                                                                       01300037
*      OPERATION=    THE FOLLOWING OPERATIONS WILL BE PREFORMED BY      01350037
*                   THIS CLOSE EXECUTOR FOR BSAM/QSAM DATA SETS         01400037
*                   IF INPUT-1 DELETE ALL REQUEST FOR DATA (PURGE)      01450037
*                            2 RESET OMR OR RCE MODE VIA AN UNFLAGED    01500037
*                              FEED COMMAND IF THE DEVICE DID NOT       01550037
*                              PRESENT UNIT EXCEPTION WHICH IN ITSELF   01600037
*                              WOULD RESET THE OMR OR RCE MODE.         01650037
*                            3 ISSUE A FEED COMMAND CAUSING LAST CD TO  01700037
*                              BE FED AND STACKER SELECTED IF CNTRL WAS 01750037
*                              SPECIFIED.                               01800037
*                            NOTE-THIS CARD FEED WILL BE IN ADDITION    01850037
*                                 TO THE FEED REFERENCED ABOVE IN       01900037
*                                 ITEM TWO IF OMR OR RCE WAS            01950037
*                                 SPECIFIED.                            02000037
*                                                                       02050037
*                   IF OUTPUT- BSAM ASSUMES QUIESENCE                   02100037
*                              QSAM WILL TRUNCATE AND FLUSH BUFFERS     02150037
*              FOR FORCE CLOSE, THIS ROUTINE WILL BE ENTERED   @YM06153 02200037
*              FOR QSAM OUTPUT DATA SETS ONLY.  IT WILL        @YM06153 02250037
*              PURGE ANY I/O INITIATED FOR PRIMING             @YM06153 02300037
*              INPUT BUFFERS.                                  @YM06153 02350037
*                                                                       02400037
*              THE 3525 HAS A PRINT STATION BETWEEN THE PUNCH-STATION   02450037
*              AND THE STACKER. THUS, CARD MOVEMENT AT CLOSE PRESENTS   02500037
*              AND UNUSUAL SITUATION. THE FOLLOWING RULES APPLY TO      02550037
*              CARD MOVEMENT WHEN THE 3525 FILE(S) ARE CLOSED.          02600037
*                                                                       02650037
*               FILE TYPE              FEED CAUSED BY CLOSE OF          02700037
*                                                                       02750037
*               READ                   READ                             02800037
*               PUNCH                  PUNCH                            02850037
*               PRINT                  PRINT                            02900037
*               READ/PRINT             READ                             02950037
*               READ/PUNCH/PRINT       READ                             03000037
*               READ/PUNCH             READ                             03050037
*               PUNCH/PRINT            PUNCH                            03100037
*               PUNCH/INTERPRET        PUNCH                            03150037
*                                                                       03200037
*                 NOTE- IF A DELIMITER CARD IS USED IT WILL STAY IN THE 03250037
*                       TRANSPORT UNTIL THE NEXT JOB CAUSES A CARD      03300037
*                       FEED OR AN NPRO IS PREFORMED.                   03350037
*                                                                       03400037
* NOTES=                                                                03450037
*   PATCH-LABEL= ZAPSZAPS                                               03500037
*                                                                       03550037
* MODULE TYPE=                                                          03600037
*   PROCESSOR= ASSEM                                                    03650037
*   ATTRIBUTES= REENTRANT                                               03700037
*                                                                       03750037
* ENTRY POINT= XCTL FROM IGG0201A                                       03800037
*   PURPOSE= TO CLOSE 3525 OR 3505 DATA SETS                            03850037
*   INPUT= SEE DESCRIPTION OF REGISTERS                                 03900037
*                                                                       03950037
* EXIT NORMAL= XCTL TO IGG0201R                                         04000037
*                                                                       04050037
* EXIT ERROR=  XCTL TO IGG0201R                                         04100037
*                                                                       04150037
* EXTERNAL REFERENCES=                                                  04200037
*   ROUTINES= DCBPUT(TO OUTPUT LAST BUFFER)                             04250037
*   DATA AREAS= PSA                                                     04300037
*               0/C/E WORK AREA (IECDSECT)                              04350037
*   CONTROL BLOCKS=                                                     04400037
*                  DCB-U,DEB-M,IOB-M,TCB-U,RB-U                         04450037
*                                                                       04500037
* TABLES= WHERE TO GO TABLE (WTG)                                       04550037
*                                                                       04600037
* MACROS=                                                               04650037
*       DEBCHK,MODESET,GETMAIN,FREEMAIN,XCTL,SYNCH                      04700037
*       WAIT,PURGE,EXCP                                                 04750037
*                                                                       04800037
* CHANGE ACTIVITY= VS/2 REL. 2 - Y02898,YM06152,YM05576                 04850037
*                                                                       04900037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04950037
*                                                                       05000037
*        REGISTER USAGE                                                 05050037
*                                                                       05100037
RE       EQU   0                       WORK/PARAMETER REGISTER          05150037
RF       EQU   1                       WORK/PARAMETER REGISTER          05200037
RDCB     EQU   2                       ADDRESS OF USER'S DCB            05250037
RBASE    EQU   3                       BASE REGISTER                    05300037
RCORE    EQU   4                       ADDRESS OF CLOSE WORK AREA       05350037
RPAR     EQU   5                       PARAMETER LIST                   05400037
RWTG     EQU   6                       START OF WTG                     05450037
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  05500037
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       05550037
RTCB     EQU   9                       ADDRESS OF CURRENT TCB    Y02898 05600037
RUCB     EQU   10                      UCB ADDRESS                      05650037
RDEB     EQU   11                      DEB ADDRESS                      05700037
RB       EQU   12                      WORK REGISTER                    05750037
RC       EQU   13                      WORK REGISTER                    05800037
RD       EQU   14                      WORK/PARAMETER REGISTER          05850037
RJ       EQU   15                      WORK/PARAMETER REGISTER          05900037
R2       EQU   2                                               @YM06152 05950037
R12      EQU   12                                              @YM06152 06000037
*                                                                       06050037
CLOSEB   EQU   X'20'                                                    06100037
COMPLETE EQU   X'7F'                                                    06150037
QSAMB    EQU   X'01'                                                    06200037
BYTO     EQU   0                       DISPLACEMENT=0                   06250037
ECBOS    EQU   4                       OFFSET TO ECB                    06300037
ECBADOS  EQU   12                      OFFSET TO ECB ADDRESS            06350037
OUTPUT   EQU   X'07'                    MASK FOR OUTIN OR OUTPUT        06400037
SILIBIT  EQU   X'20'                   SUPPRESS INCORRECT LENGTH IND    06450037
TMFLAG   EQU   X'04'                   TM FLAG FOR CLOSE ROUTINE        06500037
UNUSED   EQU   X'80'                   DCB OPENED-NOT YET USED          06550037
ZERO     EQU   0                       DISPLACEMENT                     06600037
ONE      EQU   1                                                        06650037
TWO      EQU   2                                                        06700037
THREE    EQU   3                                                        06750037
FOUR     EQU   4                                                        06800037
SIX      EQU   6                                                        06850037
EIGHT    EQU   8                                                        06900037
R3505    EQU   X'46'                   3505 DCB DEVICE TYPE MASK        06950037
P3525    EQU   X'4C'                   3525 DCB DEVICE TYPE MASK        07000037
RPMASK   EQU   X'60'                                                    07050037
RWMASK   EQU   X'50'                                                    07100037
PWMASK   EQU   X'30'                                                    07150037
ERMASK   EQU   X'3F'                                                    07200037
SLIFLAG  EQU   X'20'                                                    07250037
WMASK    EQU   X'10'                                                    07300037
WXMASK   EQU   X'14'                                                    07350037
INMASK   EQU   X'0C'                    MASK FOR INOUT OR INPUT         07400037
CNTRL    EQU   X'02'                                                    07450037
SEQMASK  EQU   X'08'                                           @ZA03830 07500037
SEQFDISP EQU   80                      ASSOCIATED DATA SET SQE. DISP.   07550037
DEBOFFST EQU   44                                                       07600037
SEQOFF   EQU   X'C7'                MASK TO TURN OFF SEQ. FLAG @ZA00861 07650037
DEBRPTR  EQU   36                                                       07700037
DEBPPTR  EQU   40                                                       07750037
DEBWPTR  EQU   44                                                       07800037
XMASK    EQU   X'04'                                           @ZA03830 07850037
LOCMASK  EQU   X'14'                                                    07900037
WAOFF    EQU   32                                                       07950037
WGOFF    EQU   8                                                        08000037
PLOFF    EQU   4                                                        08050037
UE       EQU   X'01'                   UNIT EXCEPTION MASK              08100037
STATUSN  EQU   20                      NORM  CH SCH DCB IOB OFFSET      08150037
ECBPNTR  EQU   12                                                       08200037
CCW1     EQU   40                                                       08250037
CPADDR   EQU   24                                                       08300037
CCWFLAGS EQU   44                                                       08350037
FDSS     EQU   X'23'                   FEED SS COMMAND                  08400037
RW       EQU   X'50'                                                    08450037
P        EQU   X'20'                                                    08500037
W        EQU   X'10'                                                    08550037
IRPD     EQU   X'E8'                   INT.,RD,PCH,DPI FLAGS   @ZA11813 08600037
WRTOP    EQU   X'40'                                                    08650037
D14      EQU   14                                                       08700037
PIODSID  EQU   X'B0'                   PURGE OPT               @YM06152 08750037
PALL     EQU   X'D0'                   PURGE OPT               @YM06152 08800037
SAVELG   EQU   76                      SAVE AREA LENGTH        @YM06152 08850037
KEYMASK  EQU   X'80'                   MASK TO DISTINGUISH     @YM06152 08900037
PPLLENTH EQU   12             LENGTH OF PURGE PARM LST         @YM06152 08950037
DCBTRUNC EQU   8              OFFSET INTO PUTRTF OF            @YM06152 09000037
*                             TRUNCATE ROUTINE                 @YM06152 09050037
*                                      SYSTEM AND USER KEY     @YM06152 09100037
*                                                                       09150037
         USING IHADCB,RDCB                                              09200037
         USING CSTART,RBASE                                             09250037
         USING DEBBASIC,RDEB                                            09300037
         USING FORCORE,RCORE                                            09350037
         USING PSA,0                                           @YM06152 09400037
         BALR  RBASE,RE                PUT BASE ADDR IN BASE REG        09450037
CSTART   EQU   *                                                        09500037
         B     GETDCB                                          @ZA33956 09550037
         DC    CL8'IGG0201P'           MODULE NAME             @ZA33956 09560037
         DC    CL8'@ZA33956'           APAR ID                 @ZA33956 09570037
         DC    CL8'&SYSDATE'           DATE                    @ZA33956 09580037
*  SET CLOSE FLAG IN DCB AND INITALIZE REGISTERS AND WORKAREA , SAVE    09600037
*  ADDRESS OF DEB AND ISSUE PURGE MACRO                                 09650037
*                                                                       09700037
*                                                                       09750037
GETDCB   EQU   *                                               @ZA33956 09770037
         L     RCORE,FOUR(RWTGC)       GET DCB'S WORK AREA ADDR.        09800037
         MVI   DXCCW1,ZERO         CLEAR SWITCH                  Y02898 09850037
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY           @YM05576 09900037
         GETMAIN R,LV=SAVELG,SP=230     SAVE AREA              @YM06152 09950037
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY    @YM06152 10000037
         ST    RF,SCWGETMA              SAVE AREA ADDR         @YM06152 10050037
         LR    RC,RF                    SAVE PTR TO SAVE AREA  @YM06152 10100037
         L     RDCB,DXPDCBAD            GET DATA MAN DCB ADDR  @YM06152 10150037
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02898 10200037
         L     RDCB,DXUDCBAD            USER DCB               @YM06152 10250037
*                                                                       10300037
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY           @YM06152 10350037
         L     RB,DCBIOBA              GET CURR IOB ADDR.      @YM05576 10400037
         LA    RB,0(RB)                CLEAR HI ORDER BYTE     @YM05576 10450037
         L     RUCB,DEBSUCBA            GET UCB ADDRESS          Y02898 10500037
         OI    DCBCIND2,CLOSEB          TURN ON CLOSE FLAG       Y02898 10550037
         TM    DEBOPATB,OUTPUT         IS DCB OPENED FOR OUTPUT         10600037
         BNO   AMCL1010                BRANCH IF NOT OUTPUT             10650037
*                                                                       10700037
         TM    DCBCIND2,QSAMB          DCB USING QSAM TO PROCESS        10750037
         BO    TRUNCATE                YES BRANCH                       10800037
AMCL1010 EQU   *                                                        10850037
         USING PPLDSID,RC              PURGE PARM LIST         @YM06152 10900037
         XC    PPLDSID(PPLLENTH),PPLDSID   CLEAR LIST          @YM06152 10950037
         ST    RDEB,PPLDSID            PUT DECB IN LIST        @YM06152 11000037
         MVI   PPLDSID,PALL            PURGE OPT TO QUISE      @YM06152 11050037
         TM    ZERO(RB),WRTOP          LAST OF A WRITE         @YM06152 11100037
         BZ    AMCL1015                NO                      @YM06152 11150037
         MVI   PPLDSID,PIODSID         OPT,HALT I/O DELETE,ETC @YM06152 11200037
AMCL1015 EQU   *                                                        11250037
*                                                                       11300037
         PURGE (1)                                                      11350037
*                                                                       11400037
*                                                                       11450037
         LA    RF,PPLCC       GET PARA LIST ECB ADDRESS        @YM06153 11500037
*                                                                       11550037
         WAIT  ECB=(RF)                                                 11600037
         DROP  RC                                              @YM06153 11650037
*                                                                       11700037
         MODESET EXTKEY=DATAMGT     DATA MANAGEMENT KEY        @YM06152 11750037
         OI    FCACLOS2,FCACPURG    SET PURGE                  @YM06153 11800037
         TM    FCACLOS1,FCACFORC    IS THIS FORCE CLOSE        @YM06153 11850037
         BO    AMCL1040             YES, EXIT                  @YM06153 11900037
RP350090 EQU   *                                                        11950037
*                                                                       12000037
*  DETERMINE DEVICE TYPE. IF 3505 AND UNIT EXCEPTION IS ON IN STATUS OF 12050037
*  IOB EXIT TO IGG0201R. IF NOT TURN OFF ERROR INDICATORS IN DCB AND    12100037
*  RESET DEVICE BY ISSUING A FEED STACKER-SELECT (23) COMMAND.          12150037
*                                                                       12200037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 12250037
         CLI   DCBDEVT,R3505           IS THIS A 3505 CARD READER       12300037
         BNE   RP350400                IF NO GO CK FOR ASSOCIATED DATA  12350037
*                                      ON 3525                          12400037
*                                                                       12450037
*                                                                       12500037
*             CHECK TO SEE IF UNIT EXCEPTION HAS OCCURED                12550037
RP350300 EQU   *                                                        12600037
         L     RB,DCBIOBA              LOAD ADDR OF NORMAL SHC IOB      12650037
         TM    STATUSN(RB),UE          TEST FOR UNIT EXCEPTION          12700037
         BO    AMCL1040                BRANCH IF YES           @YM06152 12750037
RP350310 EQU   *                                                        12800037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 12850037
*                                      KEY                       Y02898 12900037
         NI    DCBIFLGS,ERMASK         TURN OFF ANY ERROR INDICATORS    12950037
*                                                                       13000037
*              DO A FEED STACKER SELECT WITHOUT OMR/RCE FLAG TO         13050037
*              RESET THE 3505 OR 3525                                   13100037
*                                                                       13150037
         L     RB,DCBIOBA              GET IOB ADDRESS                  13200037
         LA    RF,CCW1(RB)             POINT TO FIRST CCW               13250037
         ST    RF,CPADDR(RB)           STORE CP. ADDR IN IOB            13300037
         MVI   CCWFLAGS(RB),SLIFLAG    SET SLI ON CCOFF IN CCW          13350037
         MVI   ZERO(RF),FDSS           STORE AFD SS CMD                 13400037
         LA    RF,FOUR(RB)             GET SPECIAL ECB ADDR.            13450037
         ST    RF,ECBPNTR(RB)          STORE IN IOB ECB PNTR.           13500037
         LA    RF,EIGHT(RB)            POINT TO IOS'S IOB               13550037
*                                                                       13600037
*                                                                       13650037
         EXCP  (1)                                                      13700037
*                                                                       13750037
         WAIT  ECB=4(RB)                                                13800037
         MODESET EXTKEY=DATAMGT        DATA MGT KEY              Y02898 13850037
*                              KEY                                      13900037
         CLI   DXCCW1,ONE              CK IF CONTROL FLAG SWITCH Y02898 13950037
         BNE   AMCL1040                LOAD ID OF NEXT EXEC    @YM06152 14000037
         MVI   DXCCW1,ZERO             CLEAR SWITCH              Y02898 14050037
         B     RP350310                BRANCH TO FEED ANOTHER CARD      14100037
*                                                                       14150037
*                   CHECKING FOR 3525 ASSOCIATED DATA SET               14200037
*                CHANGE THE NAME "DCBMODE+3" WHEN OUR DSECT IS AVAIL    14250037
*                                                                       14300037
*  CHECK TO SEE WHAT TYPE OF DATA SET IS BEIN CLOSED ON 3525. IF INPUT  14350037
*  DATA SET WITH CNTRL ISSUE TWO FEED STACKER-SELECT CCW'S,OTHEWISE     14400037
*  ISSUE ONE FEED STACKER-SELECT CCW.                                   14450037
*                                                                       14500037
RP350400 EQU   *                                                        14550037
         TM    DCBMODE+THREE,RPMASK    IS THIS A READ/PUNCH DATA SET    14600037
*                                                                       14650037
         BO    RP350500                BRANCH IF YES                    14700037
         TM    DCBMODE+THREE,RWMASK    IS THIS A READ/PRINT DATA SET    14750037
         BO    RP350500                BRANCH IF YES                    14800037
         TM    DCBMODE+THREE,PWMASK    IS THIS A PUNCH/PRINT DATA SET   14850037
         BO    RP350500                BRANCH IF YES                    14900037
RP350600 EQU   *                                                        14950037
         CLI   DCBFUNC,WMASK           PRINT ONLY SPECIFIED BY FUNC=W   15000037
         BE    RP350310                BRANCH IF YES                    15050037
         CLI   DCBFUNC,WXMASK          PRINT ONLY SPECIFIED BY FUNC=WX  15100037
         BE    RP350310                BRANCH IF YES                    15150037
         TM    DEBOPATB,INMASK          IS THIS AN INPUT OR INOUT DCB   15200037
         BNZ   RP350310                 NO, BRANCH                      15250037
*                                                                       15300037
*                                                                       15350037
*                                                                       15400037
RP350610 EQU   *                                                        15450037
         TM    DCBMACRF,CNTRL          IS CNTRL SPECIFIED               15500037
         BNO   RP350310                IF NO GO FEED A CARD             15550037
RP350660 EQU   *                                                        15600037
*                                      SET SYSTEM TO OPEN PROTECTY02898 15650037
         MODESET EXTKEY=DATAMGT        KEY                       Y02898 15700037
         MVI   DXCCW1,ONE              SET SWITCH TO ONE         Y02898 15750037
         B     RP350310                BRANCH TO FEED A CARD            15800037
*              TURN ON SEQUENCE FLAGS IN ASSOCIATED DCB'S AND           15850037
*              TURN OFF SEQUENCE FLAGS IN DCB BEING CLOSE               15900037
RP350500 EQU   *                                                        15950037
         NI    DCBQSWS,SEQOFF          TURN OFF SEQUENCE FLAG           16000037
         SR    RB,RB                   SET FLAG TO ZERO                 16050037
         L     RC,DEBRDCB              LOAD ASSOCIATED READ DCB ADDR.   16100037
         LA    RC,0(RC)                ZERO HI ORDER BYTE               16150037
         LR    RD,RC                    SAVE DCB ADDR          @YM06152 16200037
*                                  SET SYSTEM TO OPEN PROTECT  @ZA08168 16250037
         MODESET EXTKEY=DATAMGT    KEY                         @ZA08168 16300037
         CLR   RC,RB                   IS THE READ DCB ADDR ZERO        16350037
         BE    RP350520                IF SO GO CK ON PUNCH DCB         16400037
*                                                                       16450037
*  THIS ROUTINE CHECKS FOR READ ASSOCIATED DATA SET. IF READ IS PART    16500037
*  OF ASSOCIATED DATA SET,ZERO OUT READ DCB ADDRESS IN DEBRDCB FIELD OF 16550037
*  DEB FOR EACH DATA SET OPENED (READ/PUNCH/PRINT)                      16600037
*                                                                       16650037
         CLR   RDCB,RC                 IS CUR DCB FOR READ              16700037
         BNE   RP350520                NO, BRANCH                       16750037
         DEBCHK (RDCB)                 GO TO DEB VALIDITY CHK  @YM06152 16800037
         LR    RDEB,RF                 RESET DEB BASE          @ZA29896 16820037
         ST    RB,DEBRDCB              CLEAR DEB READ DCB POINTER       16850037
         L     RC,DEBPDCB              GET ADDRESS OF PUNCH DCB         16900037
         LA    RC,0(RC)                ZERO HI ORDER BYTE               16950037
         LR    RD,RC                   SAVE DCB ADDR           @YM06152 17000037
         CLR   RB,RC                   PUNCH DATA SET ALSO USED         17050037
         BE    RP350512                IF NO GO CK WRITE DCB            17100037
*                                      SET SYSTEM TO USER PROTECTY02898 17150037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 17200037
         OI    SEQFDISP(RC),SEQMASK    TURN ON SEQ FLAGS                17250037
         L     RC,DEBOFFST(RC)   GET PUNCH DATA SET DEB ADDR     Y02898 17300037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO CLOSE PROTECY02898 17350037
*                                      KEY                       Y02898 17400037
         DEBCHK (RD)                   GO TO DEB VALIDITY      @YM06152 17450037
         LR    RC,RF                   RESET DEB BASE          @ZA29896 17470037
         ST    RB,DEBRPTR(RC)          ZERO READ DCB @ IN PUNCH DEB     17500037
RP350512 EQU   *                                                        17550037
         L     RC,DEBWDCB              GET PRINT DCB ADDRESS            17600037
         LA    RC,0(RC)                ZERO HI ORDER BYTE               17650037
         LR    RD,RC                   SAVE DCB ADDR           @YM06152 17700037
         CLR   RB,RC                   PRINT DATA SET USED              17750037
         BE    RP350520                NO GO CK PUNCH DCB               17800037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 17850037
*                                      KEY                       Y02898 17900037
         OI    SEQFDISP(RC),SEQMASK    TURN ON SEQUENCE MASK            17950037
         L     RC,DEBOFFST(RC)         GET PRINT DCB'S DEB              18000037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO CLOSE PROTECY02898 18050037
*                                      KEY                       Y02898 18100037
         DEBCHK (RD)                   GO TO DEB VALIDITY      @YM06152 18150037
         LR    RC,RF                   RESET DEB BASE          @ZA29896 18170037
         ST    RB,DEBRPTR(RC)          ZERO READ DCD @ IN PRINT DEB     18200037
RP350520 EQU   *                                                        18250037
         L     RC,DEBPDCB              GET PUNCH DCB ADDRESS            18300037
         LA    RC,0(RC)                ZERO HI ORDER BYTE               18350037
         CLR   RC,RB                   PUNCH DCB USED IN ASSOCIATIVE DS 18400037
         BE    RP350530                NO GO CK PRINT DCB               18450037
         CLR   RDCB,RC                 PUNCH DCB BEING CLOSED           18500037
         BNE   RP350530                NO GO CK PRINT DCB               18550037
*                                      SET SYSTEM TO OPEN PROTECTY02898 18600037
         DEBCHK (RDCB)                 GO TO DEB VALIDITY      @YM06152 18650037
         LR    RDEB,RF                 RESET DEB BASE          @ZA29896 18670037
         ST    RB,DEBPDCB              ZERO PUNCH DCB @ IN DEBPDCB      18700037
         L     RC,DEBRDCB              GET @ OF READ DCB IN PUNCH DEB   18750037
         LA    RC,0(RC)                ZERO HI ORDER BYTE               18800037
         LR    RD,RC                   SAVE DCB ADDR           @YM06152 18850037
         CLR   RB,RC                   READ DCB @ IN PUNCH DEB          18900037
         BE    RP350522                IF NO GO CK IF PRINT DATA SET    18950037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 19000037
         OI    SEQFDISP(RC),SEQMASK    TURN ON SEQUENCE FLAG FOR PUNCH  19050037
         L     RC,DEBOFFST(RC)         GET PUNCH DCB DEB ADDRESS        19100037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO CLOSE PROTECY02898 19150037
*                                      KEY                       Y02898 19200037
         DEBCHK (RD)                   GO TO DEB VALIDITY      @YM06152 19250037
         LR    RC,RF                   RESET DEB BASE          @ZA29896 19270037
         ST    RB,DEBPPTR(RC)          ZERO PUNCH DCB @ PTR IN PUNC     19300037
RP350522 EQU   *                                                        19350037
         L     RC,DEBWDCB              CHECK IF PRINT DATA SET EXIST    19400037
         LA    RC,0(RC)                ZERO HI ORDER BYTE               19450037
         LR    RD,RC                   SAVE DCB ADDR           @YM06152 19500037
         CLR   RB,RC                   PRINT DCB @ IN PRINT DEB         19550037
         BE    RP350530                IF NO BRANCH                     19600037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 19650037
         OI    SEQFDISP(RC),SEQMASK    SET PRINT SEQUENCE FLAG          19700037
         L     RC,DEBOFFST(RC)         GET PRINT DCB DEB ADDRESS        19750037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO CLOSE PROTECY02898 19800037
*                                      KEY                       Y02898 19850037
         DEBCHK (RD)                   GO TO DEB VALIDITY      @YM06152 19900037
         LR    RC,RF                   RESET DEB BASE          @ZA29896 19920037
         ST    RB,DEBPPTR(RC)          ZERO PUNCH DCB @ PTR IN PUNC     19950037
*                                                                       20000037
RP350530 EQU   *                                                        20050037
         L     RC,DEBWDCB                                               20100037
         LA    RC,0(RC)                ZERO HI ORDER BYTE               20150037
         CLR   RC,RB                   WRITE DCB OPENED                 20200037
         BE    RP350650                IF NO GO TEST DATA SET TYPE      20250037
         CLR   RDCB,RC                 PRINT DCB NOW BEING CLOSED       20300037
         BNE   RP350650                IF NOT GO TEST DATA SET TYPE     20350037
*                                      SET SYSTEM TO USER PROTECTY02898 20400037
         MODESET EXTKEY=DATAMGT        KEY                       Y02898 20450037
         DEBCHK (RDCB)                 GO TO DEB VALIDITY      @YM06152 20500037
         LR    RDEB,RF                 RESET DEB BASE          @ZA29896 20520037
         ST    RB,DEBWDCB              ZERO PRINT DCB @ IN DEB          20550037
         L     RC,DEBRDCB              GET @ OF READ DCB                20600037
         LA    RC,0(RC)                ZERO HIGHER ORDER BYTE           20650037
         LR    RD,RC                   SAVE DCB ADDR           @YM06152 20700037
         CLR   RB,RC                   READ DCB OPENED                  20750037
         BE    RP350532                IF NOT GO CHECK IF PUNCH OPENED  20800037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 20850037
         OI    SEQFDISP(RC),SEQMASK    SET SEQUENCE FLAG IN READ DCB    20900037
         L     RC,DEBOFFST(RC)         GET READ'S DCB DEB               20950037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO CLOSE PROTECY02898 21000037
*                                      KEY                       Y02898 21050037
         DEBCHK (RD)                   GO TO DEB VALIDITY      @YM06152 21100037
         LR    RC,RF                   RESET DEB BASE          @ZA29896 21120037
         ST    RB,DEBRPTR(RC)          ZERO OUT READ PTR @ IN DEB       21150037
*                                                                       21200037
RP350532 EQU   *                                                        21250037
*                                                                       21300037
         L     RC,DEBPDCB              GET PUNCH DCB ADDRESS            21350037
         LA    RC,0(RC)                ZERO HIGHER ORDER BYTE           21400037
         LR    RD,RC                   SAVE DCB ADDR           @YM06152 21450037
         CLR   RB,RC                   PUNCH DCB OPENED                 21500037
         BE    RP350650                IF NOT GO CK TYPE OF ASSOC.D.SET 21550037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 21600037
*                                      KEY                       Y02898 21650037
         OI    SEQFDISP(RC),SEQMASK    SET SEQUENCE FLAG IN PUNCH DCB   21700037
         L     RC,DEBOFFST(RC)         GET PUNCH DCB'S DEB ADDRESS      21750037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO CLOSE PROTECY02898 21800037
*                                      KEY                       Y02898 21850037
         DEBCHK (RD)                   GO TO DEB VALIDITY      @YM06152 21900037
         LR    RC,RF                   RESET DEB BASE          @ZA29896 21920037
         ST    RB,DEBPPTR(RC)          ZERO OUT PUNCH PTR @ IN DEB      21950037
RP350650 EQU   *                                                        22000037
*                                      SET SYSTEM TO USER PROTECTY02898 22050037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @YM05576 22100037
         TM    DCBFUNC,RWMASK          IS THIS A READ/PRINT DATA SET    22150037
         BO    RP350653                BRANCH IF YES                    22200037
RP350651 EQU   *                                                        22250037
         TM    DCBFUNC,RPMASK          IS THIS A READ/PUNCH DATA SET    22300037
         BO    RP350654                BRANCH IF YES                    22350037
RP350652 EQU   *                                                        22400037
         TM    DCBFUNC,PWMASK          IS THIS A PUNCH/PRINT DATA SET   22450037
         BO    RP350655                BRANCH IF YES                    22500037
         B     RP350300                BRANCH                           22550037
RP350653 EQU   *                                                        22600037
         TM    DEBOPATB,INMASK         IS THIS AN INPUT FILE            22650037
         BZ    RP350610                BRANCH IF YES                    22700037
         B     AMCL1040                BRANCH                  @YM06152 22750037
RP350654 EQU   *                                                        22800037
         TM    DEBOPATB,INMASK                                          22850037
         BZ    RP350310                BRANCH, IF NO                    22900037
         B     AMCL1040                BRANCH                  @YM06152 22950037
RP350655 EQU   *                                                        23000037
         TM    DCBFUNC,XMASK           IS THIS A PRINT DATA SET         23050037
         BO    AMCL1040                BRANCH IF YES           @YM06152 23100037
         B     RP350310                BRANCH                           23150037
TRUNCATE EQU   *                                                        23200037
         TM    DCBCIND2,DCBCNIOE       HAS EOV BEEN ENTERED    @YM06152 23250037
         BO    RP350090                YES, BRANCH                      23300037
         L     RF,DXUDCBAD             GET USER DCB ADDRESS      Y02898 23350037
         LA    RJ,LOADPUT              ADDR OF INST TO GO TO   @YM06152 23400037
*                                      TRUNCATE ROUTINE        @YM06152 23450037
         BAL   RB,SYNCHRTN             GO TO SYNCH RTN         @YM06152 23500037
***                                                            @ZA33956 23550037
         MODESET EXTKEY=DATAMGT                                @ZA33956 23557037
         DEBCHK (RDCB)                                         @ZA33956 23564037
         LR    RDEB,RF                 RELOAD DEB BASE         @ZA33956 23571037
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY            @ZA33956 23578037
***                                                            @ZA33956 23585037
         TM    DCBMACRF+ONE,LOCMASK    DCB USING LOCATE MODE            23600037
         BM    AMCLAD02                NO BRANCH                        23650037
***                                                                     23700037
**                                                                      23750037
*        THIS ROUTINE WILL PREVENT ISSUING A PUT WHEN THE 3525 @ZA11813 23800037
*        PUNCH OR PRINT IS A PART OF AN ASSOCIATED DATA SET    @ZA11813 23850037
*        USING QSAM IN LOCATE MODE.                            @ZA11813 23900037
* NOTE:  THE USER MUST ISSUE A PUT FOR HIS LAST PUNCH OR PRINT @ZA11813 23950037
*        BUFFER WHEN USING QSAM IN LOCATE MODE FOR AN          @ZA11813 24000037
*        ASSOCIATED DATA SET.                                  @ZA11813 24050037
**                                                             @ZA11813 24100037
***                                                            @ZA11813 24150037
         TM    DCBFUNC,IRPD            FUNC OTHER THAN PRT ONLY@ZA11813 24200037
         BM    RP350656                YES, BRANCH             @ZA11813 24250037
         TM    DCBFUNC,W               FUNC EQUALS PRT ONLY    @ZA11813 24300037
         BO    AMCLAD01                YES, BR. TO ISSUE PUT   @ZA11813 24350037
RP350656 EQU   *                                               @ZA11813 24400037
         TM    DCBFUNC,RW              CK FOR READ OR PRINT DATA SET    24450037
         BZ    AMCLAD01                NO, BRANCH TO PUT ROUTINE        24500037
         TM    DCBFUNC,P               CK FOR PUNCH FLAG ONLY           24550037
         BO    AMCLAD02                YES, BYPASS PUT ROUTINE          24600037
         TM    DCBFUNC,W               PRINT FLAG ON                    24650037
         BO    AMCLAD02                YES, BYPASS PUT ROUTINE          24700037
*                                                                       24750037
*                                                                       24800037
AMCLAD01 EQU   *                                                        24850037
*                                                                       24900037
*  MUST ISSUE A PUT ROUTINE IF IN LOCATE MODE TO FLUSH BUFF AFTER TRUNC 24950037
*                                                                       25000037
         LR    RF,RDCB                 SET UP PARAMETER REGISTER Y02898 25050037
         L     RJ,DCBPUT               FOR PUT LOCATE ROUTINE  @YM06152 25100037
         BAL   RB,SYNCHRTN             TO PUT LOCATE ROUTINE   @YM06152 25150037
***                                                            @ZA33956 25200037
         MODESET EXTKEY=DATAMGT                                @ZA33956 25207037
         DEBCHK (RDCB)                                         @ZA33956 25214037
         LR    RDEB,RF                 RELOAD DEB BASE         @ZA33956 25221037
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY           @ZA33956 25228037
***                                                            @ZA33956 25235037
AMCLAD02 EQU   *                                                        25250037
         L     RB,DCBIOBA              LOAD ADDR OF IOB                 25300037
         LA    RB,0(RB)                CLEAR HI ORDER BYTE              25350037
         LR    RUCB,RB                 SAVE IOB ADDR TO LOOP ON         25400037
AMCLAD03 EQU   *                                                        25450037
         LR    RD,RB                   SAVE IOB IN CASE OF ERROR        25500037
         L     RB,BYTO(RB)             GET NEXT IOB                     25550037
         LA    RB,BYTO(RB)             CLEAR HI ORDER BYTE              25600037
         B     AMCLAD05                GO TEST COMPLETION               25650037
*                                                                       25700037
AMCLAD04 EQU   *                       ISSUE WAIT                       25750037
         L     RF,ECBADOS(RB)          GET ECB ADDRESS                  25800037
         WAIT  ECB=(1)                 WAIT ON IOB COMPLETION           25850037
AMCLAD05 TM    ECBOS(RB),COMPLETE      TEST IOB COMPLETE/OUT ERROR      25900037
         BM    AMCL1035                BRANCH COMPLETE BUT IN ERROR     25950037
         BZ    AMCLAD04                GO WAIT NOT YET COMPLETE         26000037
         CR    RUCB,RB                 IS THE NEXT IOB = IOBA           26050037
         BE    RP350090                YES                              26100037
         B     AMCLAD03                GET NEXT IOB                     26150037
AMCL1035 EQU   *                                                        26200037
         ST    RD,DCBIOBA              STORE LAST IOB SCHEDULED         26250037
*                                                                       26300037
AMCL1040 EQU     *                                             @YM06153 26350037
         MODESET KEYADDR=DXUKEY,WORKREG=15                     @YM06153 26400037
         L       RF,SCWGETMA        GET SAVE AREA ADDR         @YM06153 26450037
         FREEMAIN R,LV=SAVELG,A=(1),SP=230  REG SAVE AREA      @YM06153 26500037
         MODESET EXTKEY=DATAMGT                                @YM06153 26550037
         MVC   ZERO(TWO,RWTGC),GOOD   LOAD ID  NEXT EXECUTOR   @YM05576 26600037
         TM      FCACLOS1,FCACFORC  IS THIS FORCE CLOSE        @YM06153 26650037
         BO      AMCL5019           YES                        @YM06153 26700037
*                                                                       26750037
*                                                                       26800037
RELOOP   EQU   *                                                        26850037
         LA    RWTGC,WGOFF(ZERO,RWTGC) STEP TO NEXT ENTRY               26900037
         LA    RPARC,PLOFF(ZERO,RPARC) STEP TO NEXT ENTRY               26950037
         CLC   0(TWO,RWTGC),AMIDCNST                                    27000037
         BCR   EIGHT,RBASE             RECRUSE THRU MODULE              27050037
         CLC   0(TWO,RWTGC),CLLDB       END OF TABLE?          @YM05576 27100037
         BL    RELOOP                  NO BRANCH               @YM05576 27150037
         CLC   0(TWO,RWTGC),CLLDG      END OF TABLE?           @YM05576 27200037
         BH    RELOOP                  NO BRANCH               @YM05576 27250037
*                                                                       27300037
         LR    RPARC,RPAR              INITILIZATION                    27350037
         LA    RWTGC,WAOFF(ZERO,RWTG)  REINITIALIZE WTG LIST POINTER    27400037
*                                                                       27450037
AMCL5011 EQU   *                                                        27500037
         CLI   0(RWTGC),ZERO           IS THIS ENTRY ZERO               27550037
         BNE   AMCL5019                NO BRANCH                        27600037
         LA    RWTGC,WGOFF(ZERO,RWTGC) STEP TO NEXT ENTRY               27650037
         LA    RPARC,PLOFF(ZERO,RPARC) STEP TO NEXT ENTRY               27700037
         B     AMCL5011                BRANCH                           27750037
*                                                                       27800037
AMCL5019 EQU   *                                                        27850037
         MVC   SIX(TWO,RWTG),ZERO(RWTGC) SET UP ROUTINE ID FOR XCTL     27900037
         MVC   D14(THREE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE           27950037
***                                                                     28000037
         XCTL  DE=(RWTG),SF=(E,DXCCW12)                                 28050037
*                                                                       28100037
*THIS ROUTINE TESTS THE CALLERS KEY TO DETERMINE WHETHER TO    @YM06152 28150037
*BALR (IF KEY IS LT 8) OR SYNCH (IF KEY IS GT 7) TO THE ACCESS @YM06152 28200037
*METHOD ROUTINES. CLOSES REGS ARE SAVED IN THE SVRB SAVEAREA   @YM06152 28250037
*AND THE USERS REGISTERS ARE LOADED AND PASSED TO THE ACCESS   @YM06152 28300037
*METHOD ROUTINES (FOR THE CASE AN EOV CONDITION ARISES AND A   @YM06152 28350037
*USER EOV EXIT IS TAKEN).                                      @YM06152 28400037
*                                                                       28450037
SYNCHRTN EQU     *                                             @YM06152 28500037
         L       RTCB,PSATOLD       GET CURRENT TCB@           @YM06152 28550037
         USING   TCB,RTCB                                      @YM06152 28600037
         L       RD,TCBRBP          GET RB ADDR                @YM06152 28650037
         USING   RBSECT,RD          BASE FOR RB                @YM06152 28700037
         MODESET EXTKEY=SUPR                                   @YM06152 28750037
         STM     RF,RB,RBEXSAVE     SAVE CLOSE REG IN SVRB     @YM06152 28800037
         L       RC,SCWGETMA        GET REG SAVE AREA ADDR     @YM06152 28850037
         MODESET KEYADDR=DXUKEY,WORKREG=12                     @YM06152 28900037
         TM      DXUKEY,KEYMASK     CALLER KEY 8 OR HIGHER?    @YM06152 28950037
         BO      PRB                SYNCH IF GT 0R EQ 8        @YM06152 29000037
         LM      R2,R12,RBGRS2      GET USER REGS              @YM06152 29050037
         DROP    RD                                            @YM06152 29100037
         BALR    RD,RJ              PUT ROUTINE                @YM06152 29150037
         USING   *,RD                                          @YM06152 29200037
         B       RELOAD                                        @YM06152 29250037
         DROP    RD                                            @YM06152 29300037
*                                                                       29350037
PRB      EQU     *                                             @YM06152 29400037
         USING   RBSECT,RD                                     @YM06152 29450037
         LM      R2,R12,RBGRS2      GET USERS REGS             @YM06152 29500037
         DROP    RD                                            @YM06152 29550037
         SYNCH   (15)               GO TO USER                 @YM06152 29600037
*                                                                       29650037
RELOAD   EQU     *                                             @YM06152 29700037
         L       RTCB,PSATOLD       CURRENT TCB ADDR           @YM06152 29750037
         USING   TCB,RTCB                                      @YM06152 29800037
         L       RD,TCBRBP          LOAD PTR TO SVRB           @YM06152 29850037
         DROP    RTCB                                          @YM06152 29900037
         USING   RBSECT,RD                                     @YM06152 29950037
         LM      RF,RB,RBEXSAVE     RESTORE CLOSES REG         @YM06152 30000037
         DROP    RD                                            @YM06152 30050037
         BR      RB                 RETURN TO MAIN ROUTINE     @YM06152 30100037
*                                                                       30150037
*INSTRUCTIONS USED TO GO TO THE ACCESS METHOD ROUTINE          @YM06152 30200037
         DROP    RDCB                                          @YM06152 30250037
         USING   IHADCB,RF                                     @YM06152 30300037
LOADPUT  L       RJ,DCBPUT          LOAD PUT RTN ADDR          @YM06152 30350037
         B       DCBTRUNC(RJ)       BR TO TRUNCATE ROUTINE     @YM06152 30400037
AMIDCNST DC    C'1P'                   ID OF THIS MODULE                30450037
*                   MUST BE INSERTED                                    30500037
*                                                                       30550037
ZAPSZAPS DC    8C'ZAPSZAPS'            WORK AREA USED BY CLOSE   Y02898 30600037
GOOD     DC    C'1R'             ID OF SECOND HALF OF 3505/25  @YM05576 30650037
CLLDB    DC   C'0B'                         ID OF IGG0200B     @YM05576 30700037
CLLDG    DC   C'0G'                     ID OF IGG0200G         @YM05576 30750037
*                                                                       30800037
         DCBD  DSORG=PS                                                 30850037
         IEZDEB                                                         30900037
         IECDSECS MAIN,EXPAND=YES                                Y02898 30950037
         IKJTCB                                                  Y02898 31000037
         IHARB                                                   Y02898 31050037
         IHAPSA                                                @YM06152 31100037
         IECDPPL DSECT=YES                                     @YM06152 31150037
FORCORE  DSECT                                                 @YM06152 31200037
         IHAFCAUD ORG=YES                                      @YM06152 31250037
FORCORE  DSECT                                                 @YM06152 31300037
         IGGSCW                                                @YM06152 31350037
         END                                                            31400037
./  ADD  SSI=80450224,NAME=IGG0201R
         TITLE 'IGG0201R-CLOSE EXEC FOR 3525,AND 3505 WITH OMR OR RCE'  00050037
         START                                                          00100037
IGG0201R CSECT                                                          00150037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00200037
* MODULE NAME= IGG0201R                                                 00650037
*                                                                       00700037
* DESCRIPTIVE NAME= CLOSE EXEC FOR 3525 ASSOCIATED DATA SETS OR         00750037
*                   3505 WITH OMR/RCE                                   00800037
*                                                                       00850037
* STATUS = OS/VS2 REL 2                                                 00900037
*                                                                       00950037
* FUNCTION= THIS IS THE LAST HALF OF THE CLOSE ROUTINE USED WHEN        01000037
*              OMR OR RCE IS SPECIFIED FOR THE 3505 AND WHEN CLOSING    01050037
*              ANY TYPE OF 3525 DATA SET.                               01100037
*                                                                       01150037
*   OPERATION= THE FOLLOWING OPERATIONS WILL BE PERFORMED BY            01200037
*              THIS CLOSE EXECUTOR:                                     01250037
*                1. FREE BUFFER SPACE FROM BUFFER POOL                  01300037
*                2. FREE IOB/ICB SPACE                                  01350037
*                3. CLEAR BSAM/QSAM VECTORS IN DCB                      01400037
*                4. FOR FORCED CLOSE, INDICATE IN THE AUDIT             01450037
*                   TRAIL THAT IOBS AND BUFFER POOL HAVE BEEN           01500037
*                   FREED AND SET RETURN CODE OF 0                      01550037
*                                                                       01600037
* NOTES                                                                 01650037
*   PATCH-LABEL= ZAPSZAPS                                               01700037
*                                                                       01750037
* MODULE TYPE                                                           01800037
*   PROCESSOR= ASSEM                                                    01850037
*   ATTRIBUTES= REENTRANT                                               01900037
*                                                                       01950037
* ENTRY POINT- XCTL FROM IGG0201P                                       02000037
*   PURPOSE= TO COMPLETE CLOSING AND CLEAN-UP FOR 3505 WITH OMR/RCE     02050037
*            AND 3525 ASSOCIATED DATA SETS                              02100037
*   INPUT= SEE DESCRIPTION OF REGISTERS                                 02150037
*                                                                       02200037
* EXIT NORMAL- XCTL TO IGG0200B OR IGG0200G(COMMON CLOSE)      @YM05576 02250037
*                                                                       02300037
* EXIT ERROR=  WHEN ENTERED FOR FORCED CLOSE, RETURNS TO                02350037
*              FORCED CLOSE EXECUTORS                                   02400037
*                                                                       02450037
* EXTERNAL REFERENCES                                                   02500037
*   DATA AREAS= O/C/E WORK AREA (IECDSECT)                              02550037
*               FORCE CLOSE WORK AREA (IHAFCAUD)                        02600037
*   CONTROL BLOCKS= DCB-M,DEB-U,IOB-D,ICB-D                             02650037
*                                                                       02700037
* TABLES/WORK AREAS- WHERE TO GO TABLE (WTG)                            02750037
*                                                                       02800037
* MACROS= GETMAIN,FREEMAIN,MODESET,XCTL                                 02850037
*                                                                       02900037
* CHANGE ACTIVITY= Y02898,YM05576,YM06153,YM03519,YA00437               02950037
*                                                                       03000037
* D 502000                                                     @ZA01875 03004037
* A 501500-502900                                              @ZA01875 03008037
* D 207000,386000,460000,783000-795000,873000-882000           @YM05576 03012037
* A 444500,502500,771500-771940,895500                         @YM05576 03016037
* C 387000                                                     @YM05576 03020037
* D 771100-771700                                              @YM06153 03024037
* A 479400,681500,683000,481400                                @YM06153 03028037
* C 394000,480700,682500,682000,683500                         @YM06153 03032037
* C159500                                                      @ZA29895 03036037
* A046100-046200,078500-078740                                 @ZA29895 03038037
*                                                                       03044037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03050037
*                                                                       03100037
*        REGISTER USAGE                                                 03150037
*                                                                       03200037
RE       EQU   0                       WORK/PARAMETER REGISTER          03250037
RF       EQU   1                       WORK/PARAMETER REGISTER          03300037
RDCB     EQU   2                       ADDRESS OF USER'S DCB            03350037
RBASE    EQU   3                       BASE REGISTER                    03400037
RCORE    EQU   4                       ADDRESS OF CLOSE WORK AREA       03450037
RPAR     EQU   5                       PARAMETER LIST                   03500037
RWTG     EQU   6                       START OF WTG                     03550037
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  03600037
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       03650037
RTIOT    EQU   9                       TIOT ADDRESS                     03700037
RTCB     EQU   10                      ADDRESS OF CURRENT TCB    Y02898 03750037
RDEB     EQU   11                      DEB ADDRESS                      03800037
RB       EQU   12                      WORK REGISTER                    03850037
RC       EQU   13                      WORK REGISTER                    03900037
RD       EQU   14                      WORK/PARAMETER REGISTER          03950037
RJ       EQU   15                      WORK/PARAMETER REGISTER          04000037
*                                                                       04050037
*                                                                       04100037
*                                                                       04150037
CLOSEB   EQU   X'20'                                                    04200037
PCIB     EQU   X'40'                                                    04250037
COMPLETE EQU   X'7F'                                                    04300037
QSAMB    EQU   X'01'                                                    04350037
EXCH     EQU   X'01'                                                    04400037
FIRSTIOB EQU   X'01'                                                    04450037
*                                                                       04500037
BLANK    EQU   X'40'                                                    04550037
BYTO     EQU   0                       DISPLACEMENT=0                   04600037
FORCEOFF EQU   X'18'                   OFFSET TO FORCE CLOSE RET ADDR   04610037
*                                                             @ZA29895  04620037
CCWADR   EQU   24                      OFFSET TO CHANNEL PROG IN IOB    04650037
CCW2     EQU   48                      OFFSET TO 2ND CCW                04700037
ECBOS    EQU   4                       OFFSET TO ECB                    04750037
ECBADOS  EQU   12                      OFFSET TO ECB ADDRESS            04800037
IOSIOB   EQU   8                       OFFSET TO IOB STANDARD FIELD     04850037
OUTPUT   EQU   X'0F'                   TEST FOR OUTPUT                  04900037
SILIBIT  EQU   X'20'                   SUPPRESS INCORRECT LENGTH IND    04950037
TMFLAG   EQU   X'04'                   TM FLAG FOR CLOSE ROUTINE        05000037
UNUSED   EQU   X'80'                   DCB OPENED-NOT YET USED          05050037
ZERO     EQU   0                       DISPLACEMENT                     05100037
ONE      EQU   1                                                        05150037
TWO      EQU   2                                                        05200037
THREE    EQU   3                                                        05250037
FOUR     EQU   4                                                        05300037
SIX      EQU   6                                                        05350037
SEVEN    EQU   7                                                        05400037
EIGHT    EQU   8                                                        05450037
D14      EQU   14                                                       05500037
FIVE     EQU   5                                                        05550037
WORK12   EQU   12                      DCB WORK AREA SIZE               05600037
OPTIONS  EQU   X'B0'                   QUIESCE OPTIONS                  05650037
OFFSET16 EQU   16                                                       05700037
OFFSET8  EQU   8                                                        05750037
OFFSET4  EQU   4                                                        05800037
R3505    EQU   X'46'                   3505 DCB DEVICE TYPE MASK        05850037
P3525    EQU   X'47'                   3525 DCB DEVICE TYPE MASK        05900037
RPMASK   EQU   X'60'                                                    05950037
RWMASK   EQU   X'50'                                                    06000037
PWMASK   EQU   X'30'                                                    06050037
ERMASK   EQU   X'3F'                                                    06100037
CCHMASK  EQU   X'40'                                                    06150037
CCWFLAGS EQU   4                       OFFSET IN A CCW TO FLAG BYTE     06200037
SLIFLAG  EQU   X'20'                                                    06250037
FEEDSS   EQU   X'23'                   FEED AND STACKER SELECT          06300037
SSFLAGS  EQU   X'C0'                   STACKER SELECT FLAGS             06350037
WMASK    EQU   X'10'                                                    06400037
WXMASK   EQU   X'14'                                                    06450037
INMASK   EQU   X'0F'                                                    06500037
CNTRL    EQU   X'02'                                                    06550037
SEQMASK  EQU   X'06'                                                    06600037
SEQFDISP EQU   60                                                       06650037
DEBOFFST EQU   45                                                       06700037
DEBRPTR  EQU   36                                                       06750037
DEBPPTR  EQU   40                                                       06800037
DEBWPTR  EQU   44                                                       06850037
XMASK    EQU   X'03'                                                    06900037
LOCMASK  EQU   X'14'                                                    06950037
BUFMASK  EQU   X'08'                                                    07000037
NOT      EQU   X'FF'                                                    07050037
WAOFF    EQU   32                                                       07100037
WGOFF    EQU   8                                                        07150037
PLOFF    EQU   4                                                        07200037
UE       EQU   X'01'                   UNIT EXCEPTION MASK              07250037
OMRRCE   EQU   X'30'                   OMR OR RCE MASK                  07300037
OUTMASK  EQU   X'0F'                   OUTPUT MASK                      07350037
MIOBCNST EQU   48                                                       07400037
CONCAT   EQU   X'20'                                            YM03519 07450037
         USING IHADCB,RDCB                                              07500037
         USING DEBBASIC,RDEB                                            07550037
         USING FORCORE,RCORE                                            07600037
         USING WTG,RWTG                                        @YM06153 07650037
         BALR  RBASE,RE                PUT BASE ADDR IN BASE REG        07700037
         USING *,RBASE                                         @YM05576 07750037
CSTART   EQU   *                                                        07800037
         B     START                                           @ZA29895 07850037
         DC    CL8'IGG0201R'           MODULE NAME             @ZA29895 07858037
         DC    CL8'@ZA29895'           LATEST APAR NUMBER      @ZA29895 07866037
         DC    CL8'&SYSDATE'           DATE OF LATEST FIX      @ZA29895 07874037
START    EQU   *                                                        07882037
         L     RDCB,ZERO(RPARC)        GET DCB BEING CLOSED             07900037
         L     RDEB,DCBDEBAD           GET DCB'S DEB ADDRESS            07950037
         L     RCORE,FOUR(RWTGC)       GET DCB'S WORK AREA              08000037
         L     RDCB,DXUDCBAD           GET USER DCB ADDRESS      Y02898 08050037
*                                      SET SYSTEM TO USER PROTECTY02898 08100037
         MODESET KEYADDR=DXUKEY,WORKREG=15 KEY                 @YM05576 08150037
         L     RB,DCBIOBA              GET CURRENT IOB ADDRESS          08200037
         LA    RB,ZERO(RB)             CLEAR HIGH ORDER BYTE            08250037
*                                                                       08300037
*                                                                       08350037
AMCL2000 EQU   *                                                        08400037
         TM    DCBCIND2,QSAMB          DCB USING QSAM                   08450037
         BNO   AMCL3000                NO BRANCH                        08500037
         TM    DCBCIND1,EXCH           EXCHANGE BUFFERING USED  YA00437 08550037
         BO    AMCL3000                YES BRANCH                       08600037
*                                                                       08650037
         SR    RJ,RJ                                                    08700037
         IC    RJ,DCBBUFNO             GET NUMBER OF BUFFERS TO FREE    08750037
         L     RD,DCBBUFCB             GET BUFF POOL CNTRL BLK @YM05576 08800037
*                                                                       08850037
         TM    DCBOFLGS,CONCAT         CONCATENATION OF UNLIKE  YM03519 08900037
*                                      ATTRIBUTES               YM03519 08950037
         BZ    AMCL2030                NO,DON'T FREE BUFFER     YM03519 09000037
*                                                                       09050037
         TM    DCBCIND2,BUFMASK        DID OPEN ACQUIRE BUFFER POOL     09100037
         BZ    AMCL2030                NO BRANCH TO FREE BUFFERS        09150037
*                                                                       09200037
         LA    RTIOT,0(RD)             SAVE CNTRL BLOCK ADDRESS  Y02898 09250037
         LH    RD,SIX(RD)              GET BUFFER SIZE                  09300037
         MR    RD,RD                   TOTAL AMT REQUIRED FOR BUFFERS   09350037
         LA    RJ,EIGHT(RJ)            ADD EIGHT FOR CNTRL BLOCK        09400037
*                                                                       09450037
*                                                                Y02898 09500037
         LR    RC,RJ                   SAVE BUFFER AREA SIZE     Y02898 09550037
*                                                                Y02898 09600037
         FREEMAIN R,LV=(RC),A=(RTIOT),SP=250 FREE BUFFER POOL    Y02898 09650037
*                                                                Y02898 09700037
         MODESET EXTKEY=DATAMGT         AUDIT TRAIL IN KEY 5   @YM06153 09750037
*                                                                       09800037
         OI   FCACLOS1,FCACBUFC        INDIC BUFFERS FREED     @YM06153 09850037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM06153 09900037
*                                                              @YM06153 09950037
         XC    DCBBUFCA,DCBBUFCA  CLEAR ADDR IN DCB            @YM05576 10000037
         OI    DCBBUFCA+TWO,ONE      SET INVALID ADDRESS       @YM05576 10050037
         B     AMCL3000                BRANCH                           10100037
*                                                                       10150037
AMCL2030 EQU   *                                                        10200037
*                                                                       10250037
* THIS SECTION OF CODE REFORMATS THE BUFFER CONTROL BLOCK      @ZA01875 10300037
* BY LOOPING THROUGH THE CHAINED IOB'S TO GET THE BUFFER       @ZA01875 10350037
* ADDRESSES. THE BUFFERS ARE CHAINED BY OVERLAYING THE FIRST   @ZA01875 10400037
* WORD OF THE BUFFER WITH A CHAIN POINTER. THE CHAIN IS        @ZA01875 10450037
* HOOKED TO THE FIRST WORD OF THE BCB. THERE IS ONE UNIQUE     @ZA01875 10500037
* BUFFER POINTER PER IOB.                                      @ZA01875 10550037
*                                                                       10600037
         SR    RTIOT,RTIOT             ZERO OUT REG            @YM05576 10650037
         IC    RTIOT,DCBOFFSW          GET WRITE CCW OFFSET             10700037
         TM    DEBOPATB,OUTMASK        TEST TYPE OF I/O                 10750037
         BO    AMCL2040                BRANCH IF OUTPUT          Y02898 10800037
*                                                                       10850037
         IC    RTIOT,DCBOFFSR          GET READ CCW OFFSET              10900037
*                                                                       10950037
AMCL2040 EQU   *                                                        11000037
*                                                                       11050037
         LA    RC,0(RTIOT,RB)          GET TO RD/WRT CCW ADDRESS        11100037
         L     RC,0(RC)                GET BUFFER ADDRESS               11150037
         LA    RC,0(RC)                CLEAR HI ORDER BYTE              11200037
AMCL2070 EQU   *                                                        11250037
         MVC   ONE(THREE,RC),ONE(RD)   UPDATE LAST BUFF WITH NEW ONE    11300037
         ST    RC,0(RD)                UPDATE BUFFER POOL CNTRL BLOCK   11350037
         L     RB,0(RB)                GET NEXT IOB IN CHAIN            11400037
         BCT   RJ,AMCL2040             IF MORE IOB'S FREE BUFFER        11450037
*                   RJ HAS THE DCBBUFNO IN IT                           11500037
*                                                                       11550037
*     PREPARE TO FREE SPACE REQUIRED FOR IOB/ICB'S                      11600037
*                                                                       11650037
AMCL3000 EQU   *                                                        11700037
         SR    RD,RD                                                    11750037
         SR    RE,RE                                                    11800037
         SR    RF,RF                                                    11850037
         IC    RE,DCBIOBL              GET LEN OF IOB/ICB (DBL WORDS)   11900037
         SLL   RE,THREE                GET LEN IN BYTES                 11950037
         IC    RF,DCBNCP               GET NUMBER OF BSAM CP.S          12000037
         TM    DCBCIND2,QSAMB          IS QSAM BEING USED               12050037
         BZ    AMCL3010                NO BRANCH                        12100037
*                                                                       12150037
         IC    RF,DCBBUFNO             GET NUMBER OF QSAM CP.S          12200037
*                                                                       12250037
AMCL3010 EQU   *                                                        12300037
*                                                                       12350037
         TM    DCBCIND2,PCIB           WAS DCB USING PCI SCHEDULING     12400037
         BO    AMCL3050                YES BRANCH                       12450037
*                                                                       12500037
AMCL3020 EQU   *                                                        12550037
*                                                                       12600037
         TM    0(RB),FIRSTIOB          THIS THE FIRST IOB IN CHAIN      12650037
         BO    AMCL3060                YES BRANCH                       12700037
         L     RB,0(RB)                GET NEXT IOB                     12750037
         B     AMCL3020                CONTINUE TO LOOP                 12800037
*                                                                       12850037
AMCL3050 EQU   *                                                        12900037
         L     RB,DCBIOBAD             GET MAIN IOB ADDRESS             12950037
         LA    RB,0(RB)                CLEAR HI ORDER BYTE              13000037
         LA    RD,MIOBCNST             CNST OF 48 FOR MIOB              13050037
*                                                                       13100037
AMCL3060 EQU   *                                                        13150037
         LTR   RF,RF                   WERE NO. CP.S SPECIFIED          13200037
         BP    AMCL3065                YES BRANCH                       13250037
         LA    RF,ONE                  NO, PROVIDE ONE                  13300037
*                                                                       13350037
AMCL3065 EQU   *                                                        13400037
         MR    RE,RE                    NUMBER OF CP X IOB/ICB SIZE     13450037
*                                                                       13500037
*                                                                Y02898 13550037
         LA    RTIOT,0(RF,RD)          ADD ANY PCI CNST REQUIRED Y02898 13600037
*                                                                Y02898 13650037
         FREEMAIN R,LV=(RTIOT),A=(RB),SP=250 FREE IOB/ICB SPACE  Y02898 13700037
*                                                                Y02898 13750037
         MODESET EXTKEY=DATAMGT        AUDIT TRAIL IN KEY 5    @YM06153 13800037
*                                                              @YM06153 13850037
         OI   FCACLOS1,FCACIOB         INDIC IOBS FREED        @YM06153 13900037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM06153 13950037
*                                                              @YM06153 14000037
*                                                                       14050037
*      THIS SECTION OF CODE CLEARS BSAM/QSAM VECTORS IN THE DCB         14100037
*                                                                       14150037
AMCL5000 EQU   *                                                        14200037
         SR    RJ,RJ                                                    14250037
         ST    RJ,DCBWCPO              CLEAR OFFSET FIELDS              14300037
         ST    RJ,DCBIOBA              IOB VECTOR CLEARED               14350037
         MVC   DCBCNTRL+ONE(THREE),DCBWCPO  CLEAR CNTRL RT ADDRESS      14400037
         MVC   DCBEOBR+ONE(SEVEN),DCBWCPO   EOB VECTORS CLEARED         14450037
         MVC   DCBREAD+ONE(THREE),DCBWCPO   CLEAR RD/WRT/GET/PUT VECTOR 14500037
*                                                                       14550037
         MVC   DCBPERR+ONE(THREE),DCBWCPO   CLEAR ERROR RT VECTOR       14600037
*                                                                       14650037
         MVI   DCBLNP,ZERO             CLEAR 3525 LINE POSITION         14700037
*                                      COUNTER/INDICATOR                14750037
         OI    DCBPERR+THREE,ONE       SET PERR VECTOR TO ONE           14800037
         OI    DCBEOBW+THREE,ONE       SET EOBW VECTOR TO ONE           14850037
*                                                                       14900037
AMCL5005 EQU   *                                                        14950037
         TM    DCBCIND2,QSAMB          WAS QSAM USED                    15000037
         BZ    AMCL5009                NO, BRANCH                       15050037
*                                                                       15100037
         ST    RJ,DCBEOB               CLEAR VECTOR                     15150037
*                                                                       15200037
AMCL5009 EQU   *                                                        15250037
*                                                                       15300037
         STH   RJ,DCBCIND1             CLEAR SAM INDICATORS             15350037
         OI    DCBREAD+THREE,ONE       SET READ VECTOR TO ONE           15400037
         OI    DCBCNTRL+THREE,ONE      SET CNTRL VECTOR TO ONE          15450037
*                                                                       15500037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO CLOSE PROTECY02898 15550037
*                                      KEY                       Y02898 15600037
         STC   RJ,ZERO(ZERO,RWTGC)     ZERO CURR ENTRY IN WTG TABLE     15650037
         TM   FCACLOS1,FCACFORC        FORCE CLOSE IN CONTROL  @YM06153 15700037
         BNO  RELOOP                   NO. NORMAL EXIT         @YM06153 15750037
         SR   RJ,RJ                    RET CODE FOR FORCE      @YM06153 15800037
*                                      CLOSE TO PASS TO CLOSES @YM06153 15850037
*                                      TRR                     @YM06153 15900037
         L    RD,FORCEOFF(RPAR)        GET ADDR FOR FORCE CLOSE@ZA29895 15950037
         BR   RD                       RET TO FORCE CLOSE EXEC @YM06153 16000037
*                                                                       16050037
RELOOP   EQU   *                                                        16100037
         LA    RWTGC,WGOFF(ZERO,RWTGC) STEP TO NEXT ENTRY               16150037
         LA    RPARC,PLOFF(ZERO,RPARC) STEP TO NEXT ENTRY               16200037
         CLC   0(TWO,RWTGC),AMIDCNST                                    16250037
         BCR   EIGHT,RBASE             RECRUSE THRU MODULE              16300037
*                                                                       16350037
         CLC   0(TWO,RWTGC),CLLDB       END OF TABLE           @YM05576 16400037
         BL    RELOOP                   NO BRANCH              @YM05576 16450037
         CLC   0(TWO,RWTGC),CLLDG       END OF TABLE           @YM05576 16500037
         BH    RELOOP                   NO BRANCH              @YM05576 16550037
         LR    RPARC,RPAR              INITILIZATION                    16600037
         LA    RWTGC,WAOFF(ZERO,RWTG)  REINITIALIZE WTG LIST POINTER    16650037
*                                                                       16700037
AMCL5011 EQU   *                                                        16750037
         CLI   0(RWTGC),ZERO           IS THIS ENTRY ZERO               16800037
         BNE   AMCL5019                NO BRANCH                        16850037
         LA    RWTGC,WGOFF(ZERO,RWTGC) STEP TO NEXT ENTRY               16900037
         LA    RPARC,PLOFF(ZERO,RPARC) STEP TO NEXT ENTRY               16950037
         B     AMCL5011                BRANCH                           17000037
*                                                                       17050037
AMCL5019 EQU   *                                                        17100037
         MVC   SIX(TWO,RWTG),ZERO(RWTGC) SET UP ROUTINE ID FOR XCTL     17150037
         MVC   D14(THREE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE           17200037
***                                                                     17250037
         XCTL  DE=(RWTG),SF=(E,DXCCW12)                                 17300037
AMIDCNST DC    C'1R'                   THIS IS THE ID OF THIS MODULE    17350037
*                                                                       17400037
ZAPSZAPS DC    8C'ZAPSZAPS'            WORK AREA USED BY CLOSE   Y02898 17450037
CLLDB    DC    C'0B'                    ID FOR 200B            @YM05576 17500037
CLLDG    DC    C'0G'                    ID FOR IGG0200G        @YM05576 17550037
         DCBD  DSORG=PS                                                 17600037
         IEZDEB                                                         17650037
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @YM06153 17700037
         ORG  WTG+8                                            @YM06153 17750037
WRKRETRN DS   F                        FORCE CLOSE RETURN ADDR @YM06153 17800037
FORCORE  DSECT                                                 @YM06153 17850037
         IHAFCAUD ORG=YES                                      @YM06153 17900037
         IKJTCB                                                  Y02898 17950037
         IHARB                                                   Y02898 18000037
         IEFUCBOB                                              @YM05576 18050037
         END                                                            18100037
